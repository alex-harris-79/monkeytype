/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/styles/index.scss":
/*!*******************************!*\
  !*** ./src/styles/index.scss ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/scripts/account/all-time-stats.ts":
/*!***********************************************!*\
  !*** ./src/scripts/account/all-time-stats.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = exports.clear = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
function clear() {
    $(".pageAccount .globalTimeTyping .val").text(`-`);
    $(".pageAccount .globalTestsStarted .val").text(`-`);
    $(".pageAccount .globalTestsCompleted .val").text(`-`);
}
exports.clear = clear;
function update() {
    var _a, _b;
    const snapshot = DB.getSnapshot();
    if (snapshot.globalStats !== undefined) {
        // let th = Math.floor(DB.getSnapshot().globalStats.time / 3600);
        // let tm = Math.floor((DB.getSnapshot().globalStats.time % 3600) / 60);
        // let ts = Math.floor((DB.getSnapshot().globalStats.time % 3600) % 60);
        const seconds = (_b = (_a = snapshot === null || snapshot === void 0 ? void 0 : snapshot.globalStats) === null || _a === void 0 ? void 0 : _a.time) !== null && _b !== void 0 ? _b : 0;
        let string = "";
        if (seconds === 0) {
            string = "-";
        }
        else {
            string = Misc.secondsToString(Math.round(seconds), true, true);
        }
        $(".pageAccount .globalTimeTyping .val").text(string);
    }
    if (snapshot.globalStats !== undefined) {
        $(".pageAccount .globalTestsStarted .val").text(snapshot.globalStats.started);
    }
    if (snapshot.globalStats !== undefined) {
        $(".pageAccount .globalTestsCompleted .val").text(snapshot.globalStats.completed);
    }
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/account/mini-result-chart.ts":
/*!**************************************************!*\
  !*** ./src/scripts/account/mini-result-chart.ts ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateData = exports.show = exports.updatePosition = void 0;
const ChartController = __importStar(__webpack_require__(/*! ../controllers/chart-controller */ "./src/scripts/controllers/chart-controller.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const miniResultScaleOptions = ChartController.result.options.scales;
function updatePosition(x, y) {
    $(".pageAccount .miniResultChartWrapper").css({ top: y, left: x });
}
exports.updatePosition = updatePosition;
function show() {
    $(".pageAccount .miniResultChartWrapper").stop(true, true).fadeIn(125);
    $(".pageAccount .miniResultChartBg").stop(true, true).fadeIn(125);
}
exports.show = show;
function hide() {
    $(".pageAccount .miniResultChartWrapper").stop(true, true).fadeOut(125);
    $(".pageAccount .miniResultChartBg").stop(true, true).fadeOut(125);
}
function updateData(data) {
    // let data = filteredResults[filteredId].chartData;
    const labels = [];
    for (let i = 1; i <= data.wpm.length; i++) {
        labels.push(i.toString());
    }
    ChartController.miniResult.data.labels = labels;
    ChartController.miniResult.data.datasets[0].data = data.wpm;
    ChartController.miniResult.data.datasets[1].data = data.raw;
    ChartController.miniResult.data.datasets[2].data = data.err;
    const maxChartVal = Math.max(...[Math.max(...data.wpm), Math.max(...data.raw)]);
    const minChartVal = Math.min(...[Math.min(...data.wpm), Math.min(...data.raw)]);
    miniResultScaleOptions["wpm"].max = Math.round(maxChartVal);
    miniResultScaleOptions["raw"].max = Math.round(maxChartVal);
    if (!config_1.default.startGraphsAtZero) {
        miniResultScaleOptions["wpm"].min = Math.round(minChartVal);
        miniResultScaleOptions["raw"].min = Math.round(minChartVal);
    }
    else {
        miniResultScaleOptions["wpm"].min = 0;
        miniResultScaleOptions["raw"].min = 0;
    }
    ChartController.miniResult.updateColors();
}
exports.updateData = updateData;
$(document).on("click", ".pageAccount .miniResultChartBg", () => {
    hide();
});


/***/ }),

/***/ "./src/scripts/account/pb-tables.ts":
/*!******************************************!*\
  !*** ./src/scripts/account/pb-tables.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
function update() {
    $(".pageAccount .timePbTable tbody").html(`
  <tr>
    <td>15</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>30</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>60</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>120</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  `);
    $(".pageAccount .wordsPbTable tbody").html(`
  <tr>
    <td>10</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>25</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>50</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>100</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  `);
    if (config_1.default.alwaysShowCPM) {
        $(".pageAccount .timePbTable thead tr td:nth-child(2), .pageAccount .wordsPbTable thead tr td:nth-child(2)").html('cpm<br><span class="sub">accuracy</span>');
    }
    else {
        $(".pageAccount .timePbTable thead tr td:nth-child(2), .pageAccount .wordsPbTable thead tr td:nth-child(2)").html('wpm<br><span class="sub">accuracy</span>');
    }
    const pb = DB.getSnapshot().personalBests;
    if (pb === undefined)
        return;
    let pbData;
    let text;
    let dateText = `-<br><span class="sub">-</span>`;
    const multiplier = config_1.default.alwaysShowCPM ? 5 : 1;
    text = "";
    try {
        pbData = pb.time[15].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>15</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>15</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.time[30].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
    <td>30</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>30</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.time[60].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>60</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>60</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.time[120].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>120</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>120</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    $(".pageAccount .timePbTable tbody").html(text);
    text = "";
    try {
        pbData = pb.words[10].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>10</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>10</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.words[25].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>25</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>25</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.words[50].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>50</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>50</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.words[100].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>100</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>100</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    $(".pageAccount .wordsPbTable tbody").html(text);
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/account/result-filters.ts":
/*!***********************************************!*\
  !*** ./src/scripts/account/result-filters.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateTags = exports.toggle = exports.updateActive = exports.reset = exports.loadTags = exports.getFilter = exports.getGroup = exports.getFilters = exports.load = exports.filters = exports.defaultResultFilters = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
exports.defaultResultFilters = {
    difficulty: {
        normal: true,
        expert: true,
        master: true,
    },
    mode: {
        words: true,
        time: true,
        quote: true,
        zen: true,
        custom: true,
    },
    words: {
        10: true,
        25: true,
        50: true,
        100: true,
        custom: true,
    },
    time: {
        15: true,
        30: true,
        60: true,
        120: true,
        custom: true,
    },
    quoteLength: {
        short: true,
        medium: true,
        long: true,
        thicc: true,
    },
    punctuation: {
        on: true,
        off: true,
    },
    numbers: {
        on: true,
        off: true,
    },
    date: {
        last_day: false,
        last_week: false,
        last_month: false,
        last_3months: false,
        all: true,
    },
    tags: {
        none: true,
    },
    language: {},
    funbox: {
        none: true,
    },
};
exports.filters = exports.defaultResultFilters;
function save() {
    window.localStorage.setItem("resultFilters", JSON.stringify(exports.filters));
}
function load() {
    console.log("loading filters");
    try {
        const newResultFilters = window.localStorage.getItem("resultFilters");
        if (newResultFilters != undefined &&
            newResultFilters !== "" &&
            Object.keys(JSON.parse(newResultFilters)).length >=
                Object.keys(exports.defaultResultFilters).length) {
            exports.filters = JSON.parse(newResultFilters);
            // save();
        }
        else {
            exports.filters = exports.defaultResultFilters;
            // save();
        }
        const newTags = { none: false };
        Object.keys(exports.defaultResultFilters.tags).forEach((tag) => {
            if (exports.filters.tags[tag] !== undefined) {
                newTags[tag] = exports.filters.tags[tag];
            }
            else {
                newTags[tag] = true;
            }
        });
        exports.filters.tags = newTags;
        save();
    }
    catch (_a) {
        console.log("error in loading result filters");
        exports.filters = exports.defaultResultFilters;
        save();
    }
}
exports.load = load;
function getFilters() {
    return exports.filters;
}
exports.getFilters = getFilters;
function getGroup(group) {
    return exports.filters[group];
}
exports.getGroup = getGroup;
// export function setFilter(group, filter, value) {
//   filters[group][filter] = value;
// }
function getFilter(group, filter) {
    return exports.filters[group][filter];
}
exports.getFilter = getFilter;
// export function toggleFilter(group, filter) {
//   filters[group][filter] = !filters[group][filter];
// }
function loadTags(tags) {
    console.log("loading tags");
    tags.forEach((tag) => {
        exports.defaultResultFilters.tags[tag._id] = true;
    });
}
exports.loadTags = loadTags;
function reset() {
    exports.filters = exports.defaultResultFilters;
    save();
}
exports.reset = reset;
function updateActive() {
    var _a, _b, _c, _d;
    const aboveChartDisplay = {};
    Object.keys(getFilters()).forEach((group) => {
        aboveChartDisplay[group] = {
            all: true,
            array: [],
        };
        Object.keys(getGroup(group)).forEach((filter) => {
            var _a;
            const groupAboveChartDisplay = aboveChartDisplay[group];
            if (groupAboveChartDisplay === undefined)
                return;
            if (getFilter(group, filter)) {
                (_a = groupAboveChartDisplay["array"]) === null || _a === void 0 ? void 0 : _a.push(filter);
            }
            else {
                if (groupAboveChartDisplay["all"] !== undefined) {
                    groupAboveChartDisplay["all"] = false;
                }
            }
            let buttonEl;
            if (group === "date") {
                buttonEl = $(`.pageAccount .group.topFilters .filterGroup[group="${group}"] .button[filter="${filter}"]`);
            }
            else {
                buttonEl = $(`.pageAccount .group.filterButtons .filterGroup[group="${group}"] .button[filter="${filter}"]`);
            }
            if (getFilter(group, filter)) {
                buttonEl.addClass("active");
            }
            else {
                buttonEl.removeClass("active");
            }
        });
    });
    function addText(group) {
        var _a, _b, _c, _d, _e;
        let ret = "";
        ret += "<div class='group'>";
        if (group == "difficulty") {
            ret += `<span aria-label="Difficulty" data-balloon-pos="up"><i class="fas fa-fw fa-star"></i>`;
        }
        else if (group == "mode") {
            ret += `<span aria-label="Mode" data-balloon-pos="up"><i class="fas fa-fw fa-bars"></i>`;
        }
        else if (group == "punctuation") {
            ret += `<span aria-label="Punctuation" data-balloon-pos="up"><span class="punc" style="font-weight: 900;
      width: 1.25rem;
      text-align: center;
      display: inline-block;
      letter-spacing: -.1rem;">!?</span>`;
        }
        else if (group == "numbers") {
            ret += `<span aria-label="Numbers" data-balloon-pos="up"><span class="numbers" style="font-weight: 900;
        width: 1.25rem;
        text-align: center;
        margin-right: .1rem;
        display: inline-block;
        letter-spacing: -.1rem;">15</span>`;
        }
        else if (group == "words") {
            ret += `<span aria-label="Words" data-balloon-pos="up"><i class="fas fa-fw fa-font"></i>`;
        }
        else if (group == "time") {
            ret += `<span aria-label="Time" data-balloon-pos="up"><i class="fas fa-fw fa-clock"></i>`;
        }
        else if (group == "date") {
            ret += `<span aria-label="Date" data-balloon-pos="up"><i class="fas fa-fw fa-calendar"></i>`;
        }
        else if (group == "tags") {
            ret += `<span aria-label="Tags" data-balloon-pos="up"><i class="fas fa-fw fa-tags"></i>`;
        }
        else if (group == "language") {
            ret += `<span aria-label="Language" data-balloon-pos="up"><i class="fas fa-fw fa-globe-americas"></i>`;
        }
        else if (group == "funbox") {
            ret += `<span aria-label="Funbox" data-balloon-pos="up"><i class="fas fa-fw fa-gamepad"></i>`;
        }
        if ((_a = aboveChartDisplay[group]) === null || _a === void 0 ? void 0 : _a.all) {
            ret += "all";
        }
        else {
            if (group === "tags") {
                ret += (_c = (_b = aboveChartDisplay.tags) === null || _b === void 0 ? void 0 : _b.array) === null || _c === void 0 ? void 0 : _c.map((id) => {
                    var _a, _b;
                    if (id == "none")
                        return id;
                    const snapshot = DB.getSnapshot();
                    const name = (_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.filter((t) => t._id == id)[0];
                    if (name !== undefined) {
                        return (_b = snapshot.tags) === null || _b === void 0 ? void 0 : _b.filter((t) => t._id == id)[0].name;
                    }
                    return name;
                }).join(", ");
            }
            else {
                ret += (_e = (_d = aboveChartDisplay[group]) === null || _d === void 0 ? void 0 : _d.array) === null || _e === void 0 ? void 0 : _e.join(", ").replace(/_/g, " ");
            }
        }
        ret += "</span></div>";
        return ret;
    }
    let chartString = "";
    //date
    chartString += addText("date");
    chartString += `<div class="spacer"></div>`;
    //mode
    chartString += addText("mode");
    chartString += `<div class="spacer"></div>`;
    //time
    if ((_b = (_a = aboveChartDisplay.mode) === null || _a === void 0 ? void 0 : _a.array) === null || _b === void 0 ? void 0 : _b.includes("time")) {
        chartString += addText("time");
        chartString += `<div class="spacer"></div>`;
    }
    //words
    if ((_d = (_c = aboveChartDisplay.mode) === null || _c === void 0 ? void 0 : _c.array) === null || _d === void 0 ? void 0 : _d.includes("words")) {
        chartString += addText("words");
        chartString += `<div class="spacer"></div>`;
    }
    //diff
    chartString += addText("difficulty");
    chartString += `<div class="spacer"></div>`;
    //punc
    chartString += addText("punctuation");
    chartString += `<div class="spacer"></div>`;
    //numbers
    chartString += addText("numbers");
    chartString += `<div class="spacer"></div>`;
    //language
    chartString += addText("language");
    chartString += `<div class="spacer"></div>`;
    //funbox
    chartString += addText("funbox");
    chartString += `<div class="spacer"></div>`;
    //tags
    chartString += addText("tags");
    setTimeout(() => {
        $(".pageAccount .group.chart .above").html(chartString);
    }, 0);
}
exports.updateActive = updateActive;
function toggle(group, filter) {
    try {
        if (group === "date") {
            Object.keys(getGroup("date")).forEach((date) => {
                exports.filters["date"][date] = false;
            });
        }
        exports.filters[group][filter] = !exports.filters[group][filter];
        save();
    }
    catch (e) {
        Notifications.add("Something went wrong toggling filter. Reverting to defaults.", 0);
        console.log("toggling filter error");
        console.error(e);
        reset();
        updateActive();
    }
}
exports.toggle = toggle;
function updateTags() {
    var _a, _b;
    $(".pageAccount .content .filterButtons .buttonsAndTitle.tags .buttons").empty();
    const snapshot = DB.getSnapshot();
    if (((_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.length) || 0 > 0) {
        $(".pageAccount .content .filterButtons .buttonsAndTitle.tags").removeClass("hidden");
        $(".pageAccount .content .filterButtons .buttonsAndTitle.tags .buttons").append(`<div class="button" filter="none">no tag</div>`);
        (_b = snapshot.tags) === null || _b === void 0 ? void 0 : _b.forEach((tag) => {
            $(".pageAccount .content .filterButtons .buttonsAndTitle.tags .buttons").append(`<div class="button" filter="${tag._id}">${tag.name}</div>`);
        });
    }
    else {
        $(".pageAccount .content .filterButtons .buttonsAndTitle.tags").addClass("hidden");
    }
}
exports.updateTags = updateTags;
$(".pageAccount .filterButtons .buttonsAndTitle .buttons, .pageAccount .group.topFilters .buttonsAndTitle.testDate .buttons").on("click", ".button", (e) => {
    const group = $(e.target)
        .parents(".buttons")
        .attr("group");
    const filter = $(e.target).attr("filter");
    if ($(e.target).hasClass("allFilters")) {
        Object.keys(getFilters()).forEach((group) => {
            Object.keys(getGroup(group)).forEach((filter) => {
                if (group === "date") {
                    // TODO figure out why "filter" is never
                    // @ts-ignore
                    exports.filters[group][filter] = false;
                }
                else if (exports.filters[group] !== undefined) {
                    // @ts-ignore
                    exports.filters[group][filter] = true;
                }
            });
        });
        exports.filters.date.all = true;
    }
    else if ($(e.target).hasClass("noFilters")) {
        Object.keys(getFilters()).forEach((group) => {
            if (group !== "date") {
                Object.keys(getGroup(group)).forEach((filter) => {
                    // TODO figure out why "filter" is never
                    // @ts-ignore
                    exports.filters[group][filter] = false;
                });
            }
        });
    }
    else if ($(e.target).hasClass("button")) {
        if (e.shiftKey) {
            Object.keys(getGroup(group)).forEach((filter) => {
                // TODO figure out why "filter" is never
                // @ts-ignore
                exports.filters[group][filter] = false;
            });
            // TODO figure out why "filter" is never
            // @ts-ignore
            exports.filters[group][filter] = true;
        }
        else {
            toggle(group, filter);
            // filters[group][filter] = !filters[group][filter];
        }
    }
    updateActive();
    save();
});
$(".pageAccount .topFilters .button.allFilters").on("click", () => {
    Object.keys(getFilters()).forEach((group) => {
        Object.keys(getGroup(group)).forEach((filter) => {
            if (group === "date") {
                // TODO figure out why "filter" is never
                // @ts-ignore
                exports.filters[group][filter] = false;
            }
            else {
                // TODO figure out why "filter" is never
                // @ts-ignore
                exports.filters[group][filter] = true;
            }
        });
    });
    exports.filters.date.all = true;
    updateActive();
    save();
});
$(".pageAccount .topFilters .button.currentConfigFilter").on("click", () => {
    var _a;
    Object.keys(getFilters()).forEach((group) => {
        Object.keys(getGroup(group)).forEach((filter) => {
            // TODO figure out why "filter" is never
            // @ts-ignore
            exports.filters[group][filter] = false;
        });
    });
    exports.filters["difficulty"][config_1.default.difficulty] = true;
    exports.filters["mode"][config_1.default.mode] = true;
    if (config_1.default.mode === "time") {
        if ([15, 30, 60, 120].includes(config_1.default.time)) {
            const configTime = config_1.default.time;
            exports.filters["time"][configTime] = true;
        }
        else {
            exports.filters.time.custom = true;
        }
    }
    else if (config_1.default.mode === "words") {
        if ([10, 25, 50, 100, 200].includes(config_1.default.words)) {
            const configWords = config_1.default.words;
            exports.filters["words"][configWords] = true;
        }
        else {
            exports.filters.words.custom = true;
        }
    }
    else if (config_1.default.mode === "quote") {
        const filterName = [
            "short",
            "medium",
            "long",
            "thicc",
        ];
        filterName.forEach((ql, index) => {
            if (config_1.default.quoteLength.includes(index)) {
                exports.filters["quoteLength"][ql] = true;
            }
            else {
                exports.filters["quoteLength"][ql] = false;
            }
        });
    }
    if (config_1.default.punctuation) {
        exports.filters.punctuation.on = true;
    }
    else {
        exports.filters.punctuation.off = true;
    }
    if (config_1.default.numbers) {
        exports.filters.numbers.on = true;
    }
    else {
        exports.filters.numbers.off = true;
    }
    if (config_1.default.mode === "quote" && /english.*/.test(config_1.default.language)) {
        exports.filters.language.english = true;
    }
    else {
        exports.filters["language"][config_1.default.language] = true;
    }
    if (config_1.default.funbox === "none") {
        exports.filters.funbox.none = true;
    }
    else {
        exports.filters.funbox[config_1.default.funbox] = true;
    }
    exports.filters.tags.none = true;
    (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
        if (tag.active === true) {
            exports.filters.tags.none = false;
            exports.filters["tags"][tag._id] = true;
        }
    });
    exports.filters.date.all = true;
    updateActive();
    save();
});
$(".pageAccount .topFilters .button.toggleAdvancedFilters").on("click", () => {
    $(".pageAccount .filterButtons").slideToggle(250);
    $(".pageAccount .topFilters .button.toggleAdvancedFilters").toggleClass("active");
});
Misc.getLanguageList().then((languages) => {
    languages.forEach((language) => {
        $(".pageAccount .content .filterButtons .buttonsAndTitle.languages .buttons").append(`<div class="button" filter="${language}">${language.replace("_", " ")}</div>`);
    });
});
$(".pageAccount .content .filterButtons .buttonsAndTitle.funbox .buttons").append(`<div class="button" filter="none">none</div>`);
Misc.getFunboxList().then((funboxModes) => {
    funboxModes.forEach((funbox) => {
        $(".pageAccount .content .filterButtons .buttonsAndTitle.funbox .buttons").append(`<div class="button" filter="${funbox.name}">${funbox.name.replace(/_/g, " ")}</div>`);
    });
});


/***/ }),

/***/ "./src/scripts/account/sign-out-button.ts":
/*!************************************************!*\
  !*** ./src/scripts/account/sign-out-button.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
function show() {
    // $(".signOut").removeClass("hidden").css("opacity", 1);
    $(".signOut")
        .stop(true, true)
        .removeClass("hidden")
        .css({
        opacity: 0,
        transition: "0s",
    })
        .animate({
        opacity: 1,
    }, 125, () => {
        $(".signOut").css({ transition: "0.25s" });
    });
}
exports.show = show;
function hide() {
    $(".signOut")
        .stop(true, true)
        .css({
        opacity: 1,
        transition: "0s",
    })
        .animate({
        opacity: 0,
    }, 125, () => {
        $(".signOut").css({ transition: "0.25s" });
        $(".signOut").addClass("hidden");
    });
    // $(".signOut").css("opacity", 0).addClass("hidden");
}
exports.hide = hide;
// $("#liveWpm").removeClass("hidden").css("opacity", 0).animate(
//   {
//     opacity: Config.timerOpacity,
//   },
//   125
// );


/***/ }),

/***/ "./src/scripts/ape/endpoints/ape-keys.ts":
/*!***********************************************!*\
  !*** ./src/scripts/ape/endpoints/ape-keys.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/ape-keys";
function getApeKeysEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function generate(name, enabled) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = { name, enabled };
            return yield apeClient.post(BASE_PATH, { payload });
        });
    }
    function update(apeKeyId, updates) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = Object.assign({}, updates);
            return yield apeClient.patch(`${BASE_PATH}/${apeKeyId}`, { payload });
        });
    }
    function _delete(apeKeyId) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(`${BASE_PATH}/${apeKeyId}`);
        });
    }
    return {
        get,
        generate,
        update,
        delete: _delete,
    };
}
exports["default"] = getApeKeysEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/configs.ts":
/*!**********************************************!*\
  !*** ./src/scripts/ape/endpoints/configs.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/configs";
function getConfigsEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function save(config) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.patch(BASE_PATH, { payload: { config } });
        });
    }
    return {
        get,
        save,
    };
}
exports["default"] = getConfigsEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/index.ts":
/*!********************************************!*\
  !*** ./src/scripts/ape/endpoints/index.ts ***!
  \********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const configs_1 = __importDefault(__webpack_require__(/*! ./configs */ "./src/scripts/ape/endpoints/configs.ts"));
const leaderboards_1 = __importDefault(__webpack_require__(/*! ./leaderboards */ "./src/scripts/ape/endpoints/leaderboards.ts"));
const presets_1 = __importDefault(__webpack_require__(/*! ./presets */ "./src/scripts/ape/endpoints/presets.ts"));
const psas_1 = __importDefault(__webpack_require__(/*! ./psas */ "./src/scripts/ape/endpoints/psas.ts"));
const quotes_1 = __importDefault(__webpack_require__(/*! ./quotes */ "./src/scripts/ape/endpoints/quotes.ts"));
const results_1 = __importDefault(__webpack_require__(/*! ./results */ "./src/scripts/ape/endpoints/results.ts"));
const users_1 = __importDefault(__webpack_require__(/*! ./users */ "./src/scripts/ape/endpoints/users.ts"));
const ape_keys_1 = __importDefault(__webpack_require__(/*! ./ape-keys */ "./src/scripts/ape/endpoints/ape-keys.ts"));
exports["default"] = {
    getConfigsEndpoints: configs_1.default,
    getLeaderboardsEndpoints: leaderboards_1.default,
    getPresetsEndpoints: presets_1.default,
    getPsasEndpoints: psas_1.default,
    getQuotesEndpoints: quotes_1.default,
    getResultsEndpoints: results_1.default,
    getUsersEndpoints: users_1.default,
    getApeKeysEndpoints: ape_keys_1.default,
};


/***/ }),

/***/ "./src/scripts/ape/endpoints/leaderboards.ts":
/*!***************************************************!*\
  !*** ./src/scripts/ape/endpoints/leaderboards.ts ***!
  \***************************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/leaderboards";
function getLeaderboardsEndpoints(apeClient) {
    function get(language, mode, mode2, skip = 0, limit = 50) {
        return __awaiter(this, void 0, void 0, function* () {
            const searchQuery = {
                language,
                mode,
                mode2,
                skip,
                limit: Math.max(Math.min(limit, 50), 0),
            };
            return yield apeClient.get(BASE_PATH, { searchQuery });
        });
    }
    function getRank(language, mode, mode2) {
        return __awaiter(this, void 0, void 0, function* () {
            const searchQuery = {
                language,
                mode,
                mode2,
            };
            return yield apeClient.get(`${BASE_PATH}/rank`, { searchQuery });
        });
    }
    return { get, getRank };
}
exports["default"] = getLeaderboardsEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/presets.ts":
/*!**********************************************!*\
  !*** ./src/scripts/ape/endpoints/presets.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/presets";
function getPresetsEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function add(presetName, configChanges) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                name: presetName,
                config: configChanges,
            };
            return yield apeClient.post(BASE_PATH, { payload });
        });
    }
    function edit(presetId, presetName, configChanges) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                _id: presetId,
                name: presetName,
                config: configChanges,
            };
            return yield apeClient.patch(BASE_PATH, { payload });
        });
    }
    function _delete(presetId) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(`${BASE_PATH}/${presetId}`);
        });
    }
    return { get, add, edit, delete: _delete };
}
exports["default"] = getPresetsEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/psas.ts":
/*!*******************************************!*\
  !*** ./src/scripts/ape/endpoints/psas.ts ***!
  \*******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const version_1 = __webpack_require__(/*! ../../version */ "./src/scripts/version.ts");
const BASE_PATH = "/psas";
function getPsasEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH, {
                headers: {
                    "Client-Version": version_1.CLIENT_VERSION,
                },
            });
        });
    }
    return { get };
}
exports["default"] = getPsasEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/quotes.ts":
/*!*********************************************!*\
  !*** ./src/scripts/ape/endpoints/quotes.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/quotes";
function getQuotesEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function submit(text, source, language, captcha) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                text,
                source,
                language,
                captcha,
            };
            return yield apeClient.post(BASE_PATH, { payload });
        });
    }
    function approveSubmission(quoteSubmissionId, editText, editSource) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                quoteId: quoteSubmissionId,
                editText,
                editSource,
            };
            return yield apeClient.post(`${BASE_PATH}/approve`, { payload });
        });
    }
    function rejectSubmission(quoteSubmissionId) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.post(`${BASE_PATH}/reject`, {
                payload: { quoteId: quoteSubmissionId },
            });
        });
    }
    function getRating(quote) {
        return __awaiter(this, void 0, void 0, function* () {
            const searchQuery = {
                quoteId: quote.id,
                language: quote.language,
            };
            return yield apeClient.get(`${BASE_PATH}/rating`, { searchQuery });
        });
    }
    function addRating(quote, rating) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                quoteId: quote.id,
                rating,
                language: quote.language,
            };
            return yield apeClient.post(`${BASE_PATH}/rating`, { payload });
        });
    }
    function report(quoteId, quoteLanguage, reason, comment, captcha) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                quoteId,
                quoteLanguage,
                reason,
                comment,
                captcha,
            };
            return yield apeClient.post(`${BASE_PATH}/report`, { payload });
        });
    }
    return {
        get,
        submit,
        approveSubmission,
        rejectSubmission,
        getRating,
        addRating,
        report,
    };
}
exports["default"] = getQuotesEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/results.ts":
/*!**********************************************!*\
  !*** ./src/scripts/ape/endpoints/results.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const version_1 = __webpack_require__(/*! ../../version */ "./src/scripts/version.ts");
const BASE_PATH = "/results";
function getResultsEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function save(result) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.post(BASE_PATH, {
                payload: { result },
                headers: { "Client-Version": version_1.CLIENT_VERSION },
            });
        });
    }
    function updateTags(resultId, tagIds) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.patch(`${BASE_PATH}/tags`, {
                payload: { resultId, tagIds },
            });
        });
    }
    function deleteAll() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(BASE_PATH);
        });
    }
    return { get, save, updateTags, deleteAll };
}
exports["default"] = getResultsEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/users.ts":
/*!********************************************!*\
  !*** ./src/scripts/ape/endpoints/users.ts ***!
  \********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/users";
function getUsersEndpoints(apeClient) {
    function getData() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function create(name, email, uid) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                email,
                name,
                uid,
            };
            return yield apeClient.post(`${BASE_PATH}/signup`, { payload });
        });
    }
    function getNameAvailability(name) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(`${BASE_PATH}/checkName/${name}`);
        });
    }
    function _delete() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(BASE_PATH);
        });
    }
    function updateName(name) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.patch(`${BASE_PATH}/name`, { payload: { name } });
        });
    }
    function updateLeaderboardMemory(mode, mode2, language, rank) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                mode,
                mode2,
                language,
                rank,
            };
            return yield apeClient.patch(`${BASE_PATH}/leaderboardMemory`, { payload });
        });
    }
    function updateEmail(newEmail, previousEmail) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                newEmail,
                previousEmail,
            };
            return yield apeClient.patch(`${BASE_PATH}/email`, { payload });
        });
    }
    function deletePersonalBests() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(`${BASE_PATH}/personalBests`);
        });
    }
    function getTags() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(`${BASE_PATH}/tags`);
        });
    }
    function createTag(tagName) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.post(`${BASE_PATH}/tags`, { payload: { tagName } });
        });
    }
    function editTag(tagId, newName) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                tagId,
                newName,
            };
            return yield apeClient.patch(`${BASE_PATH}/tags`, { payload });
        });
    }
    function deleteTag(tagId) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(`${BASE_PATH}/tags/${tagId}`);
        });
    }
    function deleteTagPersonalBest(tagId) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(`${BASE_PATH}/tags/${tagId}/personalBest`);
        });
    }
    function getCustomThemes() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(`${BASE_PATH}/customThemes`);
        });
    }
    function editCustomTheme(themeId, newTheme) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                themeId: themeId,
                theme: {
                    name: newTheme.name,
                    colors: newTheme.colors,
                },
            };
            return yield apeClient.patch(`${BASE_PATH}/customThemes`, { payload });
        });
    }
    function deleteCustomTheme(themeId) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                themeId: themeId,
            };
            return yield apeClient.delete(`${BASE_PATH}/customThemes`, { payload });
        });
    }
    function addCustomTheme(newTheme) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = { name: newTheme.name, colors: newTheme.colors };
            return yield apeClient.post(`${BASE_PATH}/customThemes`, { payload });
        });
    }
    function linkDiscord(data) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.post(`${BASE_PATH}/discord/link`, {
                payload: { data },
            });
        });
    }
    function unlinkDiscord() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.post(`${BASE_PATH}/discord/unlink`);
        });
    }
    return {
        getData,
        create,
        getNameAvailability,
        delete: _delete,
        updateName,
        updateLeaderboardMemory,
        updateEmail,
        deletePersonalBests,
        getTags,
        createTag,
        editTag,
        deleteTag,
        deleteTagPersonalBest,
        linkDiscord,
        unlinkDiscord,
        getCustomThemes,
        addCustomTheme,
        editCustomTheme,
        deleteCustomTheme,
    };
}
exports["default"] = getUsersEndpoints;


/***/ }),

/***/ "./src/scripts/ape/index.ts":
/*!**********************************!*\
  !*** ./src/scripts/ape/index.ts ***!
  \**********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const axios_1 = __importDefault(__webpack_require__(/*! axios */ "./node_modules/axios/index.js"));
const endpoints_1 = __importDefault(__webpack_require__(/*! ./endpoints */ "./src/scripts/ape/endpoints/index.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const auth_1 = __webpack_require__(/*! firebase/auth */ "./node_modules/firebase/auth/dist/index.esm.js");
const DEV_SERVER_HOST = "http://localhost:5005";
const PROD_SERVER_HOST = "https://api.monkeytype.com";
const API_PATH = "";
const BASE_URL = window.location.hostname === "localhost" ? DEV_SERVER_HOST : PROD_SERVER_HOST;
const API_URL = `${BASE_URL}${API_PATH}`;
// Adapts the ape client's view of request options to the underlying HTTP client.
function adaptRequestOptions(options) {
    return __awaiter(this, void 0, void 0, function* () {
        const currentUser = firebase_1.Auth.currentUser;
        const idToken = currentUser && (yield (0, auth_1.getIdToken)(currentUser));
        return {
            params: options.searchQuery,
            data: options.payload,
            headers: Object.assign(Object.assign(Object.assign({}, options.headers), { Accept: "application/json", "Content-Type": "application/json" }), (idToken && { Authorization: `Bearer ${idToken}` })),
        };
    });
}
// Wrap the underlying HTTP client's method with our own.
function apeifyClientMethod(clientMethod, methodType) {
    return (endpoint, options = {}) => __awaiter(this, void 0, void 0, function* () {
        var _a, _b, _c;
        let errorMessage = "";
        try {
            const requestOptions = yield adaptRequestOptions(options);
            let response;
            if (methodType === "get" || methodType === "delete") {
                response = yield clientMethod(endpoint, requestOptions);
            }
            else {
                response = yield clientMethod(endpoint, requestOptions.data, requestOptions);
            }
            const { message, data } = response.data;
            return {
                status: response.status,
                message,
                data,
            };
        }
        catch (error) {
            console.error(error);
            const typedError = error;
            errorMessage = typedError.message;
            if (axios_1.default.isAxiosError(typedError)) {
                return Object.assign({ status: (_b = (_a = typedError.response) === null || _a === void 0 ? void 0 : _a.status) !== null && _b !== void 0 ? _b : 500, message: typedError.message }, (_c = typedError.response) === null || _c === void 0 ? void 0 : _c.data);
            }
        }
        return {
            status: 500,
            message: errorMessage,
        };
    });
}
const axiosClient = axios_1.default.create({
    baseURL: API_URL,
    timeout: 10000,
});
const apeClient = {
    get: apeifyClientMethod(axiosClient.get, "get"),
    post: apeifyClientMethod(axiosClient.post, "post"),
    put: apeifyClientMethod(axiosClient.put, "put"),
    patch: apeifyClientMethod(axiosClient.patch, "patch"),
    delete: apeifyClientMethod(axiosClient.delete, "delete"),
};
// API Endpoints
const Ape = {
    users: endpoints_1.default.getUsersEndpoints(apeClient),
    configs: endpoints_1.default.getConfigsEndpoints(apeClient),
    results: endpoints_1.default.getResultsEndpoints(apeClient),
    psas: endpoints_1.default.getPsasEndpoints(apeClient),
    quotes: endpoints_1.default.getQuotesEndpoints(apeClient),
    leaderboards: endpoints_1.default.getLeaderboardsEndpoints(apeClient),
    presets: endpoints_1.default.getPresetsEndpoints(apeClient),
    apeKeys: endpoints_1.default.getApeKeysEndpoints(apeClient),
};
exports["default"] = Ape;


/***/ }),

/***/ "./src/scripts/config-validation.ts":
/*!******************************************!*\
  !*** ./src/scripts/config-validation.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.isConfigValueValidAsync = exports.isConfigValueValid = exports.isConfigKeyValid = void 0;
const Misc = __importStar(__webpack_require__(/*! ./utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./elements/notifications */ "./src/scripts/elements/notifications.ts"));
function isConfigKeyValid(name) {
    if (name === null || name === undefined || name === "")
        return false;
    if (name.length > 30)
        return false;
    return /^[0-9a-zA-Z_.\-#+]+$/.test(name);
}
exports.isConfigKeyValid = isConfigKeyValid;
function invalid(key, val, customMessage) {
    if (customMessage === undefined) {
        Notifications.add(`Invalid value for ${key} (${val}). Please try to change this setting again.`, -1);
    }
    else {
        Notifications.add(`Invalid value for ${key} (${val}). ${customMessage}`, -1);
    }
    console.error(`Invalid value key ${key} value ${val} type ${typeof val}`);
}
function isArray(val) {
    return val instanceof Array;
}
function isConfigValueValid(key, val, possibleTypes) {
    let isValid = false;
    // might be used in the future
    // eslint-disable-next-line
    let customMessage = undefined;
    for (const possibleType of possibleTypes) {
        switch (possibleType) {
            case "boolean":
                if (typeof val === "boolean")
                    isValid = true;
                break;
            case "null":
                if (val === null)
                    isValid = true;
                break;
            case "number":
                if (typeof val === "number")
                    isValid = true;
                break;
            case "numberArray":
                if (isArray(val) && val.every((v) => typeof v === "number")) {
                    isValid = true;
                }
                break;
            case "string":
                if (typeof val === "string")
                    isValid = true;
                break;
            case "stringArray":
                if (isArray(val) && val.every((v) => typeof v === "string")) {
                    isValid = true;
                }
                break;
            case "undefined":
                if (typeof val === "undefined" || val === undefined)
                    isValid = true;
                break;
            default:
                if (isArray(possibleType)) {
                    if (possibleType.includes(val))
                        isValid = true;
                }
                break;
        }
    }
    if (!isValid)
        invalid(key, val, customMessage);
    return isValid;
}
exports.isConfigValueValid = isConfigValueValid;
function isConfigValueValidAsync(key, val, possibleTypes) {
    return __awaiter(this, void 0, void 0, function* () {
        let isValid = false;
        let customMessage = undefined;
        for (const possibleType of possibleTypes) {
            switch (possibleType) {
                case "layoutfluid": {
                    if (typeof val !== "string")
                        break;
                    const layoutNames = val.split(/[# ]+/);
                    if (layoutNames.length < 2 || layoutNames.length > 5)
                        break;
                    // convert the layout names to layouts
                    const layouts = yield Promise.all(layoutNames.map((layoutName) => Misc.getLayout(layoutName)));
                    // check if all layouts exist
                    if (!layouts.every((layout) => layout !== undefined)) {
                        const invalidLayoutNames = layoutNames.map((layoutName, index) => [
                            layoutName,
                            layouts[index],
                        ]);
                        const invalidLayouts = invalidLayoutNames
                            .filter(([_, layout]) => layout === undefined)
                            .map(([layoutName]) => layoutName);
                        customMessage = `The following inputted layouts do not exist: ${invalidLayouts.join(", ")}`;
                        break;
                    }
                    isValid = true;
                    break;
                }
            }
        }
        if (!isValid)
            invalid(key, val, customMessage);
        return isValid;
    });
}
exports.isConfigValueValidAsync = isConfigValueValidAsync;


/***/ }),

/***/ "./src/scripts/config.ts":
/*!*******************************!*\
  !*** ./src/scripts/config.ts ***!
  \*******************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.setShowLiveAcc = exports.setShowLiveWpm = exports.setShowTimerProgress = exports.setPaceCaretStyle = exports.setCaretStyle = exports.setPageWidth = exports.setOppositeShiftMode = exports.setStrictSpace = exports.setColorfulMode = exports.setFlipTestColors = exports.setRepeatQuotes = exports.setEnableAds = exports.setQuickEnd = exports.setShowAllLines = exports.setCapsLockWarning = exports.setSingleListCommandLine = exports.setAlwaysShowWordsHistory = exports.setMinBurstCustomSpeed = exports.setMinBurst = exports.setMinAccCustom = exports.setMinAcc = exports.setMinWpmCustomSpeed = exports.setMinWpm = exports.setRepeatedPace = exports.setPaceCaretCustomSpeed = exports.setPaceCaret = exports.setSwapEscAndTab = exports.setShowOutOfFocusWarning = exports.setAlwaysShowCPM = exports.setAlwaysShowDecimalPlaces = exports.setStopOnError = exports.setChartStyle = exports.setChartAccuracy = exports.setBlindMode = exports.setFunbox = exports.setFavThemes = exports.setDifficulty = exports.setSoundVolume = exports.setPlaySoundOnClick = exports.setPlaySoundOnError = exports.setMode = exports.setPunctuation = exports.setNumbers = exports.saveFullConfigToLocalStorage = exports.setChangedBeforeDb = exports.setDbConfigLoaded = exports.setLocalStorageConfig = exports.changedBeforeDb = exports.dbConfigLoaded = exports.localStorageConfig = void 0;
exports.loadPromise = exports.setConfig = exports.getConfigChanges = exports.loadFromLocalStorage = exports.reset = exports.apply = exports.setBurstHeatmap = exports.setMonkeyPowerLevel = exports.setCustomBackgroundFilter = exports.setCustomBackgroundSize = exports.setCustomLayoutfluid = exports.setCustomBackground = exports.setFontSize = exports.setLayout = exports.setKeymapLayout = exports.setKeymapStyle = exports.setKeymapLegendStyle = exports.setKeymapMode = exports.setMonkey = exports.setLanguage = exports.setCustomThemeColors = exports.setLazyMode = exports.setBritishEnglish = exports.setRandomTheme = exports.setThemeDark = exports.setThemeLight = exports.setTheme = exports.setCustomTheme = exports.setAutoSwitchTheme = exports.setIndicateTypos = exports.setConfidenceMode = exports.setFreedomMode = exports.setFontFamily = exports.previewFontFamily = exports.setQuickTabMode = exports.setSmoothLineScroll = exports.setStartGraphsAtZero = exports.setSmoothCaret = exports.setWordCount = exports.setQuoteLength = exports.setTimeConfig = exports.setKeyTips = exports.setTimerOpacity = exports.setTimerColor = exports.setTimerStyle = exports.setHideExtraLetters = exports.setHighlightMode = exports.setShowAverage = exports.setShowLiveBurst = void 0;
const DB = __importStar(__webpack_require__(/*! ./db */ "./src/scripts/db.ts"));
const OutOfFocus = __importStar(__webpack_require__(/*! ./test/out-of-focus */ "./src/scripts/test/out-of-focus.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./elements/notifications */ "./src/scripts/elements/notifications.ts"));
const config_validation_1 = __webpack_require__(/*! ./config-validation */ "./src/scripts/config-validation.ts");
const ConfigEvent = __importStar(__webpack_require__(/*! ./observables/config-event */ "./src/scripts/observables/config-event.ts"));
const default_config_1 = __importDefault(__webpack_require__(/*! ./constants/default-config */ "./src/scripts/constants/default-config.ts"));
const firebase_1 = __webpack_require__(/*! ./firebase */ "./src/scripts/firebase.ts");
const AnalyticsController = __importStar(__webpack_require__(/*! ./controllers/analytics-controller */ "./src/scripts/controllers/analytics-controller.ts"));
exports.dbConfigLoaded = false;
exports.changedBeforeDb = false;
function setLocalStorageConfig(val) {
    exports.localStorageConfig = val;
}
exports.setLocalStorageConfig = setLocalStorageConfig;
function setDbConfigLoaded(val) {
    exports.dbConfigLoaded = val;
}
exports.setDbConfigLoaded = setDbConfigLoaded;
function setChangedBeforeDb(val) {
    exports.changedBeforeDb = val;
}
exports.setChangedBeforeDb = setChangedBeforeDb;
let loadDone;
let config = Object.assign({}, default_config_1.default);
function saveToLocalStorage(key, nosave = false, noDbCheck = false) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!exports.dbConfigLoaded && !noDbCheck && !nosave) {
            setChangedBeforeDb(true);
        }
        if (nosave)
            return;
        const localToSave = config;
        delete localToSave.resultFilters;
        const localToSaveStringified = JSON.stringify(localToSave);
        window.localStorage.setItem("config", localToSaveStringified);
        if (!noDbCheck) {
            // await DB.saveConfig(dbToSave);
            yield saveToDatabase(key);
        }
        ConfigEvent.dispatch("saveToLocalStorage", localToSaveStringified);
    });
}
let configToSend = {};
let saveTimeout = null;
function saveToDatabase(key) {
    return __awaiter(this, void 0, void 0, function* () {
        configToSend[key] = config[key];
        if (saveTimeout === null) {
            saveTimeout = setTimeout(() => __awaiter(this, void 0, void 0, function* () {
                delete configToSend.resultFilters;
                if (Object.keys(configToSend).length > 0)
                    DB.saveConfig(configToSend);
                configToSend = {};
                clearTimeout(saveTimeout);
                saveTimeout = null;
            }), window.location.hostname === "localhost" ? 0 : 1000);
        }
    });
}
function saveFullConfigToLocalStorage(noDbCheck = false) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!exports.dbConfigLoaded && !noDbCheck) {
            setChangedBeforeDb(true);
        }
        const save = config;
        delete save.resultFilters;
        const stringified = JSON.stringify(save);
        window.localStorage.setItem("config", stringified);
        if (!noDbCheck)
            yield DB.saveConfig(save);
        ConfigEvent.dispatch("saveToLocalStorage", stringified);
    });
}
exports.saveFullConfigToLocalStorage = saveFullConfigToLocalStorage;
//numbers
function setNumbers(numb, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("numbers", numb, ["boolean"]))
        return false;
    if (config.mode === "quote") {
        numb = false;
    }
    config.numbers = numb;
    if (!config.numbers) {
        $("#top .config .numbersMode .text-button").removeClass("active");
    }
    else {
        $("#top .config .numbersMode .text-button").addClass("active");
    }
    saveToLocalStorage("numbers", nosave);
    ConfigEvent.dispatch("numbers", config.numbers);
    return true;
}
exports.setNumbers = setNumbers;
//punctuation
function setPunctuation(punc, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("punctuation", punc, ["boolean"]))
        return false;
    if (config.mode === "quote") {
        punc = false;
    }
    config.punctuation = punc;
    if (!config.punctuation) {
        $("#top .config .punctuationMode .text-button").removeClass("active");
    }
    else {
        $("#top .config .punctuationMode .text-button").addClass("active");
    }
    saveToLocalStorage("punctuation", nosave);
    ConfigEvent.dispatch("punctuation", config.punctuation);
    return true;
}
exports.setPunctuation = setPunctuation;
function setMode(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("mode", mode, [
        ["time", "words", "quote", "zen", "custom"],
    ])) {
        return false;
    }
    if (mode !== "words" && config.funbox === "memory") {
        Notifications.add("Memory funbox can only be used with words mode.", 0);
        return false;
    }
    const previous = config.mode;
    config.mode = mode;
    if (config.mode == "custom") {
        setPunctuation(false, true);
        setNumbers(false, true);
    }
    else if (config.mode == "quote") {
        setPunctuation(false, true);
        setNumbers(false, true);
    }
    else if (config.mode == "zen") {
        if (config.paceCaret != "off") {
            Notifications.add(`Pace caret will not work with zen mode.`, 0);
        }
    }
    saveToLocalStorage("mode", nosave);
    ConfigEvent.dispatch("mode", config.mode, nosave, previous);
    return true;
}
exports.setMode = setMode;
function setPlaySoundOnError(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("play sound on error", val, ["boolean"])) {
        return false;
    }
    config.playSoundOnError = val;
    saveToLocalStorage("playSoundOnError", nosave);
    ConfigEvent.dispatch("playSoundOnError", config.playSoundOnError);
    return true;
}
exports.setPlaySoundOnError = setPlaySoundOnError;
function setPlaySoundOnClick(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("play sound on click", val, [
        ["off", "1", "2", "3", "4", "5", "6", "7"],
    ])) {
        return false;
    }
    config.playSoundOnClick = val;
    saveToLocalStorage("playSoundOnClick", nosave);
    ConfigEvent.dispatch("playSoundOnClick", config.playSoundOnClick);
    return true;
}
exports.setPlaySoundOnClick = setPlaySoundOnClick;
function setSoundVolume(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("sound volume", val, [["0.1", "0.5", "1.0"]])) {
        return false;
    }
    config.soundVolume = val;
    saveToLocalStorage("soundVolume", nosave);
    ConfigEvent.dispatch("soundVolume", config.soundVolume);
    return true;
}
exports.setSoundVolume = setSoundVolume;
//difficulty
function setDifficulty(diff, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("difficulty", diff, [["normal", "expert", "master"]])) {
        return false;
    }
    config.difficulty = diff;
    saveToLocalStorage("difficulty", nosave);
    ConfigEvent.dispatch("difficulty", config.difficulty, nosave);
    return true;
}
exports.setDifficulty = setDifficulty;
//set fav themes
function setFavThemes(themes, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("favorite themes", themes, ["stringArray"])) {
        return false;
    }
    config.favThemes = themes;
    saveToLocalStorage("favThemes", nosave);
    ConfigEvent.dispatch("favThemes", config.favThemes);
    return true;
}
exports.setFavThemes = setFavThemes;
function setFunbox(funbox, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("funbox", funbox, ["string"]))
        return false;
    const val = funbox ? funbox : "none";
    config.funbox = val;
    saveToLocalStorage("funbox", nosave);
    ConfigEvent.dispatch("funbox", config.funbox);
    return true;
}
exports.setFunbox = setFunbox;
function setBlindMode(blind, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("blind mode", blind, ["boolean"]))
        return false;
    config.blindMode = blind;
    saveToLocalStorage("blindMode", nosave);
    ConfigEvent.dispatch("blindMode", config.blindMode, nosave);
    return true;
}
exports.setBlindMode = setBlindMode;
function setChartAccuracy(chartAccuracy, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("chart accuracy", chartAccuracy, ["boolean"])) {
        return false;
    }
    config.chartAccuracy = chartAccuracy;
    saveToLocalStorage("chartAccuracy", nosave);
    ConfigEvent.dispatch("chartAccuracy", config.chartAccuracy);
    return true;
}
exports.setChartAccuracy = setChartAccuracy;
function setChartStyle(chartStyle, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("chart style", chartStyle, [["line", "scatter"]])) {
        return false;
    }
    config.chartStyle = chartStyle;
    saveToLocalStorage("chartStyle", nosave);
    ConfigEvent.dispatch("chartStyle", config.chartStyle);
    return true;
}
exports.setChartStyle = setChartStyle;
function setStopOnError(soe, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("stop on error", soe, [["off", "word", "letter"]])) {
        return false;
    }
    config.stopOnError = soe;
    if (config.stopOnError !== "off") {
        config.confidenceMode = "off";
    }
    saveToLocalStorage("stopOnError", nosave);
    ConfigEvent.dispatch("stopOnError", config.stopOnError, nosave);
    return true;
}
exports.setStopOnError = setStopOnError;
function setAlwaysShowDecimalPlaces(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("always show decimal places", val, ["boolean"])) {
        return false;
    }
    config.alwaysShowDecimalPlaces = val;
    saveToLocalStorage("alwaysShowDecimalPlaces", nosave);
    ConfigEvent.dispatch("alwaysShowDecimalPlaces", config.alwaysShowDecimalPlaces);
    return true;
}
exports.setAlwaysShowDecimalPlaces = setAlwaysShowDecimalPlaces;
function setAlwaysShowCPM(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("always show CPM", val, ["boolean"]))
        return false;
    config.alwaysShowCPM = val;
    saveToLocalStorage("alwaysShowCPM", nosave);
    ConfigEvent.dispatch("alwaysShowCPM", config.alwaysShowCPM);
    return true;
}
exports.setAlwaysShowCPM = setAlwaysShowCPM;
function setShowOutOfFocusWarning(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show out of focus warning", val, ["boolean"])) {
        return false;
    }
    config.showOutOfFocusWarning = val;
    if (!config.showOutOfFocusWarning) {
        OutOfFocus.hide();
    }
    saveToLocalStorage("showOutOfFocusWarning", nosave);
    ConfigEvent.dispatch("showOutOfFocusWarning", config.showOutOfFocusWarning);
    return true;
}
exports.setShowOutOfFocusWarning = setShowOutOfFocusWarning;
function setSwapEscAndTab(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("swap esc and tab", val, ["boolean"]))
        return false;
    config.swapEscAndTab = val;
    saveToLocalStorage("swapEscAndTab", nosave);
    ConfigEvent.dispatch("swapEscAndTab", config.swapEscAndTab);
    return true;
}
exports.setSwapEscAndTab = setSwapEscAndTab;
//pace caret
function setPaceCaret(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("pace caret", val, [["custom", "off", "average", "pb"]])) {
        return false;
    }
    if (document.readyState === "complete") {
        if (val == "pb" && firebase_1.Auth.currentUser === null) {
            Notifications.add("PB pace caret is unavailable without an account", 0);
            return false;
        }
    }
    // if (config.mode === "zen" && val != "off") {
    //   Notifications.add(`Can't use pace caret with zen mode.`, 0);
    //   val = "off";
    // }
    config.paceCaret = val;
    saveToLocalStorage("paceCaret", nosave);
    ConfigEvent.dispatch("paceCaret", config.paceCaret, nosave);
    return true;
}
exports.setPaceCaret = setPaceCaret;
function setPaceCaretCustomSpeed(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("pace caret custom speed", val, ["number"])) {
        return false;
    }
    config.paceCaretCustomSpeed = val;
    saveToLocalStorage("paceCaretCustomSpeed", nosave);
    ConfigEvent.dispatch("paceCaretCustomSpeed", config.paceCaretCustomSpeed);
    return true;
}
exports.setPaceCaretCustomSpeed = setPaceCaretCustomSpeed;
function setRepeatedPace(pace, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("repeated pace", pace, ["boolean"]))
        return false;
    config.repeatedPace = pace;
    saveToLocalStorage("repeatedPace", nosave);
    ConfigEvent.dispatch("repeatedPace", config.repeatedPace);
    return true;
}
exports.setRepeatedPace = setRepeatedPace;
//min wpm
function setMinWpm(minwpm, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min WPM", minwpm, [["off", "custom"]]))
        return false;
    config.minWpm = minwpm;
    saveToLocalStorage("minWpm", nosave);
    ConfigEvent.dispatch("minWpm", config.minWpm, nosave);
    return true;
}
exports.setMinWpm = setMinWpm;
function setMinWpmCustomSpeed(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min WPM custom speed", val, ["number"])) {
        return false;
    }
    config.minWpmCustomSpeed = val;
    saveToLocalStorage("minWpmCustomSpeed", nosave);
    ConfigEvent.dispatch("minWpmCustomSpeed", config.minWpmCustomSpeed);
    return true;
}
exports.setMinWpmCustomSpeed = setMinWpmCustomSpeed;
//min acc
function setMinAcc(min, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min acc", min, [["off", "custom"]]))
        return false;
    config.minAcc = min;
    saveToLocalStorage("minAcc", nosave);
    ConfigEvent.dispatch("minAcc", config.minAcc, nosave);
    return true;
}
exports.setMinAcc = setMinAcc;
function setMinAccCustom(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min acc custom", val, ["number"]))
        return false;
    config.minAccCustom = val;
    saveToLocalStorage("minAccCustom", nosave);
    ConfigEvent.dispatch("minAccCustom", config.minAccCustom);
    return true;
}
exports.setMinAccCustom = setMinAccCustom;
//min burst
function setMinBurst(min, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min burst", min, [["off", "fixed", "flex"]])) {
        return false;
    }
    config.minBurst = min;
    saveToLocalStorage("minBurst", nosave);
    ConfigEvent.dispatch("minBurst", config.minBurst, nosave);
    return true;
}
exports.setMinBurst = setMinBurst;
function setMinBurstCustomSpeed(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min burst custom speed", val, ["number"])) {
        return false;
    }
    config.minBurstCustomSpeed = val;
    saveToLocalStorage("minBurstCustomSpeed", nosave);
    ConfigEvent.dispatch("minBurstCustomSpeed", config.minBurstCustomSpeed);
    return true;
}
exports.setMinBurstCustomSpeed = setMinBurstCustomSpeed;
//always show words history
function setAlwaysShowWordsHistory(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("always show words history", val, ["boolean"])) {
        return false;
    }
    config.alwaysShowWordsHistory = val;
    saveToLocalStorage("alwaysShowWordsHistory", nosave);
    ConfigEvent.dispatch("alwaysShowWordsHistory", config.alwaysShowWordsHistory);
    return true;
}
exports.setAlwaysShowWordsHistory = setAlwaysShowWordsHistory;
//single list command line
function setSingleListCommandLine(option, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("single list command line", option, [["manual", "on"]])) {
        return false;
    }
    config.singleListCommandLine = option;
    saveToLocalStorage("singleListCommandLine", nosave);
    ConfigEvent.dispatch("singleListCommandLine", config.singleListCommandLine);
    return true;
}
exports.setSingleListCommandLine = setSingleListCommandLine;
//caps lock warning
function setCapsLockWarning(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("caps lock warning", val, ["boolean"]))
        return false;
    config.capsLockWarning = val;
    saveToLocalStorage("capsLockWarning", nosave);
    ConfigEvent.dispatch("capsLockWarning", config.capsLockWarning);
    return true;
}
exports.setCapsLockWarning = setCapsLockWarning;
function setShowAllLines(sal, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show all lines", sal, ["boolean"]))
        return false;
    config.showAllLines = sal;
    saveToLocalStorage("showAllLines", nosave);
    ConfigEvent.dispatch("showAllLines", config.showAllLines, nosave);
    return true;
}
exports.setShowAllLines = setShowAllLines;
function setQuickEnd(qe, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("quick end", qe, ["boolean"]))
        return false;
    config.quickEnd = qe;
    saveToLocalStorage("quickEnd", nosave);
    ConfigEvent.dispatch("quickEnd", config.quickEnd);
    return true;
}
exports.setQuickEnd = setQuickEnd;
function setEnableAds(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("enable ads", val, [["on", "off", "max"]])) {
        return false;
    }
    config.enableAds = val;
    if (!nosave) {
        saveToLocalStorage("enableAds", nosave);
        setTimeout(() => {
            location.reload();
        }, 3000);
        Notifications.add("Ad settings changed. Refreshing...", 0);
    }
    return true;
}
exports.setEnableAds = setEnableAds;
function setRepeatQuotes(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("repeat quotes", val, [["off", "typing"]])) {
        return false;
    }
    config.repeatQuotes = val;
    saveToLocalStorage("repeatQuotes", nosave);
    ConfigEvent.dispatch("repeatQuotes", config.repeatQuotes);
    return true;
}
exports.setRepeatQuotes = setRepeatQuotes;
//flip colors
function setFlipTestColors(flip, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("flip test colors", flip, ["boolean"]))
        return false;
    config.flipTestColors = flip;
    saveToLocalStorage("flipTestColors", nosave);
    ConfigEvent.dispatch("flipTestColors", config.flipTestColors);
    return true;
}
exports.setFlipTestColors = setFlipTestColors;
//extra color
function setColorfulMode(extra, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("colorful mode", extra, ["boolean"]))
        return false;
    config.colorfulMode = extra;
    saveToLocalStorage("colorfulMode", nosave);
    ConfigEvent.dispatch("colorfulMode", config.colorfulMode);
    return true;
}
exports.setColorfulMode = setColorfulMode;
//strict space
function setStrictSpace(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("strict space", val, ["boolean"]))
        return false;
    config.strictSpace = val;
    saveToLocalStorage("strictSpace", nosave);
    ConfigEvent.dispatch("strictSpace", config.strictSpace);
    return true;
}
exports.setStrictSpace = setStrictSpace;
//opposite shift space
function setOppositeShiftMode(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("opposite shift mode", val, [["off", "on", "keymap"]])) {
        return false;
    }
    config.oppositeShiftMode = val;
    saveToLocalStorage("oppositeShiftMode", nosave);
    ConfigEvent.dispatch("oppositeShiftMode", config.oppositeShiftMode);
    return true;
}
exports.setOppositeShiftMode = setOppositeShiftMode;
function setPageWidth(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("page width", val, [
        ["max", "100", "125", "150", "200"],
    ])) {
        return false;
    }
    config.pageWidth = val;
    $("#centerContent").removeClass("wide125");
    $("#centerContent").removeClass("wide150");
    $("#centerContent").removeClass("wide200");
    $("#centerContent").removeClass("widemax");
    if (val !== "100") {
        $("#centerContent").addClass("wide" + val);
    }
    saveToLocalStorage("pageWidth", nosave);
    ConfigEvent.dispatch("pageWidth", config.pageWidth);
    return true;
}
exports.setPageWidth = setPageWidth;
function setCaretStyle(caretStyle, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("caret style", caretStyle, [
        ["off", "default", "block", "outline", "underline", "carrot", "banana"],
    ])) {
        return false;
    }
    config.caretStyle = caretStyle;
    $("#caret").removeClass("off");
    $("#caret").removeClass("default");
    $("#caret").removeClass("underline");
    $("#caret").removeClass("outline");
    $("#caret").removeClass("block");
    $("#caret").removeClass("carrot");
    $("#caret").removeClass("banana");
    if (caretStyle == "off") {
        $("#caret").addClass("off");
    }
    else if (caretStyle == "default") {
        $("#caret").addClass("default");
    }
    else if (caretStyle == "block") {
        $("#caret").addClass("block");
    }
    else if (caretStyle == "outline") {
        $("#caret").addClass("outline");
    }
    else if (caretStyle == "underline") {
        $("#caret").addClass("underline");
    }
    else if (caretStyle == "carrot") {
        $("#caret").addClass("carrot");
    }
    else if (caretStyle == "banana") {
        $("#caret").addClass("banana");
    }
    saveToLocalStorage("caretStyle", nosave);
    ConfigEvent.dispatch("caretStyle", config.caretStyle);
    return true;
}
exports.setCaretStyle = setCaretStyle;
function setPaceCaretStyle(caretStyle, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("pace caret style", caretStyle, [
        ["off", "default", "block", "outline", "underline", "carrot", "banana"],
    ])) {
        return false;
    }
    config.paceCaretStyle = caretStyle;
    $("#paceCaret").removeClass("off");
    $("#paceCaret").removeClass("default");
    $("#paceCaret").removeClass("underline");
    $("#paceCaret").removeClass("outline");
    $("#paceCaret").removeClass("block");
    $("#paceCaret").removeClass("carrot");
    $("#paceCaret").removeClass("banana");
    if (caretStyle == "default") {
        $("#paceCaret").addClass("default");
    }
    else if (caretStyle == "block") {
        $("#paceCaret").addClass("block");
    }
    else if (caretStyle == "outline") {
        $("#paceCaret").addClass("outline");
    }
    else if (caretStyle == "underline") {
        $("#paceCaret").addClass("underline");
    }
    else if (caretStyle == "carrot") {
        $("#paceCaret").addClass("carrot");
    }
    else if (caretStyle == "banana") {
        $("#paceCaret").addClass("banana");
    }
    saveToLocalStorage("paceCaretStyle", nosave);
    ConfigEvent.dispatch("paceCaretStyle", config.paceCaretStyle);
    return true;
}
exports.setPaceCaretStyle = setPaceCaretStyle;
function setShowTimerProgress(timer, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show timer progress", timer, ["boolean"])) {
        return false;
    }
    config.showTimerProgress = timer;
    saveToLocalStorage("showTimerProgress", nosave);
    ConfigEvent.dispatch("showTimerProgress", config.showTimerProgress);
    return true;
}
exports.setShowTimerProgress = setShowTimerProgress;
function setShowLiveWpm(live, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show live WPM", live, ["boolean"]))
        return false;
    config.showLiveWpm = live;
    saveToLocalStorage("showLiveWpm", nosave);
    ConfigEvent.dispatch("showLiveWpm", config.showLiveWpm);
    return true;
}
exports.setShowLiveWpm = setShowLiveWpm;
function setShowLiveAcc(live, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show live acc", live, ["boolean"]))
        return false;
    config.showLiveAcc = live;
    saveToLocalStorage("showLiveAcc", nosave);
    ConfigEvent.dispatch("showLiveAcc", config.showLiveAcc);
    return true;
}
exports.setShowLiveAcc = setShowLiveAcc;
function setShowLiveBurst(live, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show live burst", live, ["boolean"]))
        return false;
    config.showLiveBurst = live;
    saveToLocalStorage("showLiveBurst", nosave);
    ConfigEvent.dispatch("showLiveBurst", config.showLiveBurst);
    return true;
}
exports.setShowLiveBurst = setShowLiveBurst;
function setShowAverage(value, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show average", value, [["off", "wpm", "acc", "both"]])) {
        return false;
    }
    config.showAverage = value;
    saveToLocalStorage("showAverage", nosave);
    ConfigEvent.dispatch("showAverage", config.showAverage, nosave);
    return true;
}
exports.setShowAverage = setShowAverage;
function setHighlightMode(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("highlight mode", mode, [["off", "letter", "word"]])) {
        return false;
    }
    if (mode === "word" &&
        (config.funbox === "nospace" ||
            config.funbox === "read_ahead" ||
            config.funbox === "read_ahead_easy" ||
            config.funbox === "read_ahead_hard" ||
            config.funbox === "tts" ||
            config.funbox === "arrows")) {
        Notifications.add("Can't use word highlight with this funbox", 0);
        return false;
    }
    config.highlightMode = mode;
    saveToLocalStorage("highlightMode", nosave);
    ConfigEvent.dispatch("highlightMode", config.highlightMode);
    return true;
}
exports.setHighlightMode = setHighlightMode;
function setHideExtraLetters(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("hide extra letters", val, ["boolean"]))
        return false;
    config.hideExtraLetters = val;
    saveToLocalStorage("hideExtraLetters", nosave);
    ConfigEvent.dispatch("hideExtraLetters", config.hideExtraLetters);
    return true;
}
exports.setHideExtraLetters = setHideExtraLetters;
function setTimerStyle(style, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("timer style", style, [["bar", "text", "mini"]])) {
        return false;
    }
    config.timerStyle = style;
    saveToLocalStorage("timerStyle", nosave);
    ConfigEvent.dispatch("timerStyle", config.timerStyle);
    return true;
}
exports.setTimerStyle = setTimerStyle;
function setTimerColor(color, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("timer color", color, [
        ["black", "sub", "text", "main"],
    ])) {
        return false;
    }
    config.timerColor = color;
    $("#timer").removeClass("timerSub");
    $("#timer").removeClass("timerText");
    $("#timer").removeClass("timerMain");
    $("#timerNumber").removeClass("timerSub");
    $("#timerNumber").removeClass("timerText");
    $("#timerNumber").removeClass("timerMain");
    $("#largeLiveWpmAndAcc").removeClass("timerSub");
    $("#largeLiveWpmAndAcc").removeClass("timerText");
    $("#largeLiveWpmAndAcc").removeClass("timerMain");
    $("#miniTimerAndLiveWpm").removeClass("timerSub");
    $("#miniTimerAndLiveWpm").removeClass("timerText");
    $("#miniTimerAndLiveWpm").removeClass("timerMain");
    if (color === "main") {
        $("#timer").addClass("timerMain");
        $("#timerNumber").addClass("timerMain");
        $("#largeLiveWpmAndAcc").addClass("timerMain");
        $("#miniTimerAndLiveWpm").addClass("timerMain");
    }
    else if (color === "sub") {
        $("#timer").addClass("timerSub");
        $("#timerNumber").addClass("timerSub");
        $("#largeLiveWpmAndAcc").addClass("timerSub");
        $("#miniTimerAndLiveWpm").addClass("timerSub");
    }
    else if (color === "text") {
        $("#timer").addClass("timerText");
        $("#timerNumber").addClass("timerText");
        $("#largeLiveWpmAndAcc").addClass("timerText");
        $("#miniTimerAndLiveWpm").addClass("timerText");
    }
    saveToLocalStorage("timerColor", nosave);
    ConfigEvent.dispatch("timerColor", config.timerColor);
    return true;
}
exports.setTimerColor = setTimerColor;
function setTimerOpacity(opacity, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("timer opacity", opacity, [
        ["0.25", "0.5", "0.75", "1"],
    ])) {
        return false;
    }
    config.timerOpacity = opacity;
    saveToLocalStorage("timerOpacity", nosave);
    ConfigEvent.dispatch("timerOpacity", config.timerOpacity);
    return true;
}
exports.setTimerOpacity = setTimerOpacity;
//key tips
function setKeyTips(keyTips, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("key tips", keyTips, ["boolean"]))
        return false;
    config.showKeyTips = keyTips;
    if (config.showKeyTips) {
        $("#bottom .keyTips").removeClass("hidden");
    }
    else {
        $("#bottom .keyTips").addClass("hidden");
    }
    saveToLocalStorage("showKeyTips", nosave);
    ConfigEvent.dispatch("showKeyTips", config.showKeyTips);
    return true;
}
exports.setKeyTips = setKeyTips;
//mode
function setTimeConfig(time, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("time", time, ["number"]))
        return false;
    const newTime = isNaN(time) || time < 0 ? default_config_1.default.time : time;
    $("#top .config .time .text-button").removeClass("active");
    const timeCustom = ![15, 30, 60, 120].includes(newTime) ? "custom" : newTime;
    config.time = newTime;
    $("#top .config .time .text-button[timeConfig='" + timeCustom + "']").addClass("active");
    saveToLocalStorage("time", nosave);
    ConfigEvent.dispatch("time", config.time);
    return true;
}
exports.setTimeConfig = setTimeConfig;
//quote length
function setQuoteLength(len, nosave, multipleMode) {
    if (!(0, config_validation_1.isConfigValueValid)("quote length", len, [
        [-2, -1, 0, 1, 2, 3],
        "numberArray",
    ])) {
        return false;
    }
    if (Array.isArray(len)) {
        //config load
        if (len.length === 1 && len[0] === -1)
            len = [1];
        config.quoteLength = len;
    }
    else {
        if (!Array.isArray(config.quoteLength))
            config.quoteLength = [];
        if (len === null || isNaN(len) || len < -2 || len > 3) {
            len = 1;
        }
        len = parseInt(len.toString());
        if (multipleMode) {
            if (!config.quoteLength.includes(len)) {
                config.quoteLength.push(len);
            }
            else {
                if (config.quoteLength.length > 1) {
                    config.quoteLength = config.quoteLength.filter((ql) => ql !== len);
                }
            }
        }
        else {
            config.quoteLength = [len];
        }
    }
    // if (!nosave) setMode("quote", nosave);
    $("#top .config .quoteLength .text-button").removeClass("active");
    config.quoteLength.forEach((ql) => {
        $("#top .config .quoteLength .text-button[quoteLength='" + ql + "']").addClass("active");
    });
    saveToLocalStorage("quoteLength", nosave);
    ConfigEvent.dispatch("quoteLength", config.quoteLength);
    return true;
}
exports.setQuoteLength = setQuoteLength;
function setWordCount(wordCount, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("words", wordCount, ["number"]))
        return false;
    const newWordCount = wordCount < 0 || wordCount > 100000 ? default_config_1.default.words : wordCount;
    $("#top .config .wordCount .text-button").removeClass("active");
    const wordCustom = ![10, 25, 50, 100, 200].includes(newWordCount)
        ? "custom"
        : newWordCount;
    config.words = newWordCount;
    $("#top .config .wordCount .text-button[wordCount='" + wordCustom + "']").addClass("active");
    saveToLocalStorage("words", nosave);
    ConfigEvent.dispatch("words", config.words);
    return true;
}
exports.setWordCount = setWordCount;
//caret
function setSmoothCaret(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("smooth caret", mode, ["boolean"]))
        return false;
    config.smoothCaret = mode;
    if (mode) {
        $("#caret").css("animation-name", "caretFlashSmooth");
    }
    else {
        $("#caret").css("animation-name", "caretFlashHard");
    }
    saveToLocalStorage("smoothCaret", nosave);
    ConfigEvent.dispatch("smoothCaret", config.smoothCaret);
    return true;
}
exports.setSmoothCaret = setSmoothCaret;
function setStartGraphsAtZero(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("start graphs at zero", mode, ["boolean"])) {
        return false;
    }
    config.startGraphsAtZero = mode;
    saveToLocalStorage("startGraphsAtZero", nosave);
    ConfigEvent.dispatch("startGraphsAtZero", config.startGraphsAtZero);
    return true;
}
exports.setStartGraphsAtZero = setStartGraphsAtZero;
//linescroll
function setSmoothLineScroll(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("smooth line scroll", mode, ["boolean"])) {
        return false;
    }
    config.smoothLineScroll = mode;
    saveToLocalStorage("smoothLineScroll", nosave);
    ConfigEvent.dispatch("smoothLineScroll", config.smoothLineScroll);
    return true;
}
exports.setSmoothLineScroll = setSmoothLineScroll;
//quick tab
function setQuickTabMode(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("quick tab mode", mode, ["boolean"]))
        return false;
    config.quickTab = mode;
    if (!config.quickTab) {
        $("#restartTestButton").removeClass("hidden");
        $("#restartTestButton").css("opacity", 1);
        $("#bottom .keyTips")
            .html(`<key>tab</key> and <key>enter</key> / <key>space</key> - restart test<br>
      <key>ctrl/cmd</key>+<key>shift</key>+<key>p</key> or <key>esc</key> - command line`);
    }
    else {
        $("#restartTestButton").addClass("hidden");
        $("#bottom .keyTips").html(`<key>tab</key> - restart test<br>
    <key>ctrl/cmd</key>+<key>shift</key>+<key>p</key> or <key>esc</key> - command line`);
    }
    saveToLocalStorage("quickTab", nosave);
    ConfigEvent.dispatch("quickTab", config.quickTab);
    return true;
}
exports.setQuickTabMode = setQuickTabMode;
function previewFontFamily(font) {
    if (!(0, config_validation_1.isConfigValueValid)("preview font family", font, ["string"])) {
        return false;
    }
    document.documentElement.style.setProperty("--font", '"' + font.replace(/_/g, " ") + '", "Roboto Mono"');
    return true;
}
exports.previewFontFamily = previewFontFamily;
//font family
function setFontFamily(font, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("font family", font, ["string"]))
        return false;
    if (font === "") {
        font = "roboto_mono";
        Notifications.add("Empty input received, reverted to the default font.", 0, 3, "Custom font");
    }
    if (!(0, config_validation_1.isConfigKeyValid)(font)) {
        Notifications.add(`Invalid font name value: "${font}".`, -1, 3, "Custom font");
        return false;
    }
    config.fontFamily = font;
    document.documentElement.style.setProperty("--font", `"${font.replace(/_/g, " ")}", "Roboto Mono"`);
    saveToLocalStorage("fontFamily", nosave);
    ConfigEvent.dispatch("fontFamily", config.fontFamily);
    return true;
}
exports.setFontFamily = setFontFamily;
//freedom
function setFreedomMode(freedom, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("freedom mode", freedom, ["boolean"]))
        return false;
    if (freedom == null) {
        freedom = false;
    }
    config.freedomMode = freedom;
    if (config.freedomMode && config.confidenceMode !== "off") {
        config.confidenceMode = "off";
    }
    saveToLocalStorage("freedomMode", nosave);
    ConfigEvent.dispatch("freedomMode", config.freedomMode);
    return true;
}
exports.setFreedomMode = setFreedomMode;
function setConfidenceMode(cm, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("confidence mode", cm, [["off", "on", "max"]])) {
        return false;
    }
    config.confidenceMode = cm;
    if (config.confidenceMode !== "off") {
        config.freedomMode = false;
        config.stopOnError = "off";
    }
    saveToLocalStorage("confidenceMode", nosave);
    ConfigEvent.dispatch("confidenceMode", config.confidenceMode, nosave);
    return true;
}
exports.setConfidenceMode = setConfidenceMode;
function setIndicateTypos(value, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("indicate typos", value, [["off", "below", "replace"]])) {
        return false;
    }
    config.indicateTypos = value;
    saveToLocalStorage("indicateTypos", nosave);
    ConfigEvent.dispatch("indicateTypos", config.indicateTypos);
    return true;
}
exports.setIndicateTypos = setIndicateTypos;
function setAutoSwitchTheme(boolean, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("auto switch theme", boolean, ["boolean"])) {
        return false;
    }
    boolean = boolean !== null && boolean !== void 0 ? boolean : default_config_1.default.autoSwitchTheme;
    config.autoSwitchTheme = boolean;
    saveToLocalStorage("autoSwitchTheme", nosave);
    ConfigEvent.dispatch("autoSwitchTheme", config.autoSwitchTheme);
    return true;
}
exports.setAutoSwitchTheme = setAutoSwitchTheme;
function setCustomTheme(boolean, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("custom theme", boolean, ["boolean"]))
        return false;
    config.customTheme = boolean;
    saveToLocalStorage("customTheme", nosave);
    ConfigEvent.dispatch("customTheme", config.customTheme);
    return true;
}
exports.setCustomTheme = setCustomTheme;
function setTheme(name, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("theme", name, ["string"]))
        return false;
    config.theme = name;
    setCustomTheme(false);
    saveToLocalStorage("theme", nosave);
    ConfigEvent.dispatch("theme", config.theme);
    return true;
}
exports.setTheme = setTheme;
function setThemeLight(name, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("theme light", name, ["string"]))
        return false;
    config.themeLight = name;
    saveToLocalStorage("themeLight", nosave);
    ConfigEvent.dispatch("themeLight", config.themeLight, nosave);
    return true;
}
exports.setThemeLight = setThemeLight;
function setThemeDark(name, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("theme dark", name, ["string"]))
        return false;
    config.themeDark = name;
    saveToLocalStorage("themeDark", nosave);
    ConfigEvent.dispatch("themeDark", config.themeDark, nosave);
    return true;
}
exports.setThemeDark = setThemeDark;
function setThemes(theme, customState, customThemeColors, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("themes", theme, ["string"]))
        return false;
    config.customThemeColors = customThemeColors;
    config.theme = theme;
    config.customTheme = customState;
    saveToLocalStorage("theme", nosave);
    ConfigEvent.dispatch("setThemes", customState);
    return true;
}
function setRandomTheme(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("random theme", val, [
        ["off", "on", "fav", "light", "dark", "custom"],
    ])) {
        return false;
    }
    if (val === "custom") {
        if (firebase_1.Auth.currentUser === null) {
            config.randomTheme = val;
            return false;
        }
        if (!DB.getSnapshot())
            return true;
        if (DB.getSnapshot().customThemes.length === 0) {
            Notifications.add("You need to create a custom theme first", 0);
            config.randomTheme = "off";
            return false;
        }
    }
    config.randomTheme = val;
    saveToLocalStorage("randomTheme", nosave);
    ConfigEvent.dispatch("randomTheme", config.randomTheme);
    return true;
}
exports.setRandomTheme = setRandomTheme;
function setBritishEnglish(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("british english", val, ["boolean"]))
        return false;
    if (!val) {
        val = false;
    }
    config.britishEnglish = val;
    saveToLocalStorage("britishEnglish", nosave);
    ConfigEvent.dispatch("britishEnglish", config.britishEnglish);
    return true;
}
exports.setBritishEnglish = setBritishEnglish;
function setLazyMode(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("lazy mode", val, ["boolean"]))
        return false;
    if (!val) {
        val = false;
    }
    config.lazyMode = val;
    saveToLocalStorage("lazyMode", nosave);
    ConfigEvent.dispatch("lazyMode", config.lazyMode, nosave);
    return true;
}
exports.setLazyMode = setLazyMode;
function setCustomThemeColors(colors, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("custom theme colors", colors, ["stringArray"])) {
        return false;
    }
    if (colors !== undefined) {
        config.customThemeColors = colors;
        // ThemeController.set("custom");
        // applyCustomThemeColors();
    }
    saveToLocalStorage("customThemeColors", nosave);
    ConfigEvent.dispatch("customThemeColors", config.customThemeColors, nosave);
    return true;
}
exports.setCustomThemeColors = setCustomThemeColors;
function setLanguage(language, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("language", language, ["string"]))
        return false;
    config.language = language;
    AnalyticsController.log("changedLanguage", { language });
    saveToLocalStorage("language", nosave);
    ConfigEvent.dispatch("language", config.language);
    return true;
}
exports.setLanguage = setLanguage;
function setMonkey(monkey, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("monkey", monkey, ["boolean"]))
        return false;
    config.monkey = monkey;
    saveToLocalStorage("monkey", nosave);
    ConfigEvent.dispatch("monkey", config.monkey);
    return true;
}
exports.setMonkey = setMonkey;
function setKeymapMode(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("keymap mode", mode, [
        ["off", "static", "react", "next"],
    ])) {
        return false;
    }
    $(".active-key").removeClass("active-key");
    $(".keymap-key").attr("style", "");
    config.keymapMode = mode;
    saveToLocalStorage("keymapMode", nosave);
    ConfigEvent.dispatch("keymapMode", config.keymapMode, nosave);
    return true;
}
exports.setKeymapMode = setKeymapMode;
function setKeymapLegendStyle(style, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("keymap legend style", style, [
        ["lowercase", "uppercase", "blank", "dynamic"],
    ])) {
        return false;
    }
    // Remove existing styles
    const keymapLegendStyles = ["lowercase", "uppercase", "blank", "dynamic"];
    keymapLegendStyles.forEach((name) => {
        $(".keymapLegendStyle").removeClass(name);
    });
    style = style || "lowercase";
    // Mutate the keymap in the DOM, if it exists.
    // 1. Remove everything
    $(".keymap-key > .letter").css("display", "");
    $(".keymap-key > .letter").css("text-transform", "");
    // 2. Append special styles onto the DOM elements
    if (style === "uppercase") {
        $(".keymap-key > .letter").css("text-transform", "capitalize");
    }
    if (style === "blank") {
        $(".keymap-key > .letter").css("display", "none");
    }
    // Update and save to cookie for persistence
    $(".keymapLegendStyle").addClass(style);
    config.keymapLegendStyle = style;
    saveToLocalStorage("keymapLegendStyle", nosave);
    ConfigEvent.dispatch("keymapLegendStyle", config.keymapLegendStyle);
    return true;
}
exports.setKeymapLegendStyle = setKeymapLegendStyle;
function setKeymapStyle(style, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("keymap style", style, [
        ["staggered", "alice", "matrix", "split", "split_matrix"],
    ])) {
        return false;
    }
    style = style || "staggered";
    config.keymapStyle = style;
    saveToLocalStorage("keymapStyle", nosave);
    ConfigEvent.dispatch("keymapStyle", config.keymapStyle);
    return true;
}
exports.setKeymapStyle = setKeymapStyle;
function setKeymapLayout(layout, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("keymap layout", layout, ["string"]))
        return false;
    config.keymapLayout = layout;
    saveToLocalStorage("keymapLayout", nosave);
    ConfigEvent.dispatch("keymapLayout", config.keymapLayout);
    return true;
}
exports.setKeymapLayout = setKeymapLayout;
function setLayout(layout, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("layout", layout, ["string"]))
        return false;
    config.layout = layout;
    saveToLocalStorage("layout", nosave);
    ConfigEvent.dispatch("layout", config.layout, nosave);
    return true;
}
exports.setLayout = setLayout;
// export function setSavedLayout(layout: string, nosave?: boolean): boolean {
//   if (layout == null || layout == undefined) {
//     layout = "qwerty";
//   }
//   config.savedLayout = layout;
//   setLayout(layout, nosave);
//   return true;
// }
function setFontSize(fontSize, nosave) {
    fontSize = fontSize.toString(); //todo remove after around a week
    if (!(0, config_validation_1.isConfigValueValid)("font size", fontSize, [
        ["1", "125", "15", "2", "3", "4"],
    ])) {
        return false;
    }
    config.fontSize = fontSize;
    $("#words").removeClass("size125");
    $("#caret, #paceCaret").removeClass("size125");
    $("#words").removeClass("size15");
    $("#caret, #paceCaret").removeClass("size15");
    $("#words").removeClass("size2");
    $("#caret, #paceCaret").removeClass("size2");
    $("#words").removeClass("size3");
    $("#caret, #paceCaret").removeClass("size3");
    $("#words").removeClass("size35");
    $("#caret, #paceCaret").removeClass("size35");
    $("#words").removeClass("size4");
    $("#caret, #paceCaret").removeClass("size4");
    $("#miniTimerAndLiveWpm").removeClass("size125");
    $("#miniTimerAndLiveWpm").removeClass("size15");
    $("#miniTimerAndLiveWpm").removeClass("size2");
    $("#miniTimerAndLiveWpm").removeClass("size3");
    $("#miniTimerAndLiveWpm").removeClass("size35");
    $("#miniTimerAndLiveWpm").removeClass("size4");
    if (fontSize == "125") {
        $("#words").addClass("size125");
        $("#caret, #paceCaret").addClass("size125");
        $("#miniTimerAndLiveWpm").addClass("size125");
    }
    else if (fontSize == "15") {
        $("#words").addClass("size15");
        $("#caret, #paceCaret").addClass("size15");
        $("#miniTimerAndLiveWpm").addClass("size15");
    }
    else if (fontSize == "2") {
        $("#words").addClass("size2");
        $("#caret, #paceCaret").addClass("size2");
        $("#miniTimerAndLiveWpm").addClass("size2");
    }
    else if (fontSize == "3") {
        $("#words").addClass("size3");
        $("#caret, #paceCaret").addClass("size3");
        $("#miniTimerAndLiveWpm").addClass("size3");
    }
    else if (fontSize == "4") {
        $("#words").addClass("size4");
        $("#caret, #paceCaret").addClass("size4");
        $("#miniTimerAndLiveWpm").addClass("size4");
    }
    saveToLocalStorage("fontSize", nosave);
    ConfigEvent.dispatch("fontSize", config.fontSize);
    return true;
}
exports.setFontSize = setFontSize;
function setCustomBackground(value, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("custom background", value, ["string"]))
        return false;
    value = value.trim();
    if ((/(https|http):\/\/(www\.|).+\..+\/.+(\.png|\.gif|\.jpeg|\.jpg)/gi.test(value) &&
        !/[<>]/.test(value)) ||
        value == "") {
        config.customBackground = value;
        saveToLocalStorage("customBackground", nosave);
        ConfigEvent.dispatch("customBackground", config.customBackground);
    }
    else {
        Notifications.add("Invalid custom background URL", 0);
    }
    return true;
}
exports.setCustomBackground = setCustomBackground;
function setCustomLayoutfluid(value, nosave) {
    return __awaiter(this, void 0, void 0, function* () {
        const trimmed = value.trim();
        if (!(yield (0, config_validation_1.isConfigValueValidAsync)("layoutfluid", trimmed, ["layoutfluid"]))) {
            return false;
        }
        const customLayoutfluid = trimmed.replace(/ /g, "#");
        config.customLayoutfluid = customLayoutfluid;
        $(".pageSettings .section.customLayoutfluid input").val(customLayoutfluid.replace(/#/g, " "));
        saveToLocalStorage("customLayoutfluid", nosave);
        ConfigEvent.dispatch("customLayoutFluid", config.customLayoutfluid);
        return true;
    });
}
exports.setCustomLayoutfluid = setCustomLayoutfluid;
function setCustomBackgroundSize(value, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("custom background size", value, [
        ["max", "cover", "contain"],
    ])) {
        return false;
    }
    if (value != "cover" && value != "contain" && value != "max") {
        value = "cover";
    }
    config.customBackgroundSize = value;
    saveToLocalStorage("customBackgroundSize", nosave);
    ConfigEvent.dispatch("customBackgroundSize", config.customBackgroundSize);
    return true;
}
exports.setCustomBackgroundSize = setCustomBackgroundSize;
function setCustomBackgroundFilter(array, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("custom background filter", array, ["numberArray"])) {
        return false;
    }
    config.customBackgroundFilter = array;
    saveToLocalStorage("customBackgroundFilter", nosave);
    ConfigEvent.dispatch("customBackgroundFilter", config.customBackgroundFilter);
    return true;
}
exports.setCustomBackgroundFilter = setCustomBackgroundFilter;
function setMonkeyPowerLevel(level, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("monkey power level", level, [
        ["off", "1", "2", "3", "4"],
    ])) {
        return false;
    }
    if (!["off", "1", "2", "3", "4"].includes(level))
        level = "off";
    config.monkeyPowerLevel = level;
    saveToLocalStorage("monkeyPowerLevel", nosave);
    ConfigEvent.dispatch("monkeyPowerLevel", config.monkeyPowerLevel);
    return true;
}
exports.setMonkeyPowerLevel = setMonkeyPowerLevel;
function setBurstHeatmap(value, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("burst heatmap", value, ["boolean"]))
        return false;
    if (!value) {
        value = false;
    }
    config.burstHeatmap = value;
    saveToLocalStorage("burstHeatmap", nosave);
    ConfigEvent.dispatch("burstHeatmap", config.burstHeatmap);
    return true;
}
exports.setBurstHeatmap = setBurstHeatmap;
function apply(configToApply) {
    if (!configToApply)
        return;
    const configObj = configToApply;
    Object.keys(default_config_1.default).forEach((configKey) => {
        if (configObj[configKey] === undefined) {
            const newValue = default_config_1.default[configKey];
            configObj[configKey] = newValue;
        }
    });
    if (configObj !== undefined && configObj !== null) {
        setThemeLight(configObj.themeLight, true);
        setThemeDark(configObj.themeDark, true);
        setAutoSwitchTheme(configObj.autoSwitchTheme, true);
        setThemes(configObj.theme, configObj.customTheme, configObj.customThemeColors, true);
        setCustomLayoutfluid(configObj.customLayoutfluid, true);
        setCustomBackground(configObj.customBackground, true);
        setCustomBackgroundSize(configObj.customBackgroundSize, true);
        setCustomBackgroundFilter(configObj.customBackgroundFilter, true);
        setQuickTabMode(configObj.quickTab, true);
        setKeyTips(configObj.showKeyTips, true);
        setTimeConfig(configObj.time, true);
        setQuoteLength(configObj.quoteLength, true);
        setWordCount(configObj.words, true);
        setLanguage(configObj.language, true);
        setLayout(configObj.layout, true);
        setFontSize(configObj.fontSize, true);
        setFreedomMode(configObj.freedomMode, true);
        setCaretStyle(configObj.caretStyle, true);
        setPaceCaretStyle(configObj.paceCaretStyle, true);
        setDifficulty(configObj.difficulty, true);
        setBlindMode(configObj.blindMode, true);
        setQuickEnd(configObj.quickEnd, true);
        setFlipTestColors(configObj.flipTestColors, true);
        setColorfulMode(configObj.colorfulMode, true);
        setConfidenceMode(configObj.confidenceMode, true);
        setIndicateTypos(configObj.indicateTypos, true);
        setTimerStyle(configObj.timerStyle, true);
        setTimerColor(configObj.timerColor, true);
        setTimerOpacity(configObj.timerOpacity, true);
        setKeymapMode(configObj.keymapMode, true);
        setKeymapStyle(configObj.keymapStyle, true);
        setKeymapLegendStyle(configObj.keymapLegendStyle, true);
        setKeymapLayout(configObj.keymapLayout, true);
        setFontFamily(configObj.fontFamily, true);
        setSmoothCaret(configObj.smoothCaret, true);
        setSmoothLineScroll(configObj.smoothLineScroll, true);
        setShowLiveWpm(configObj.showLiveWpm, true);
        setShowLiveAcc(configObj.showLiveAcc, true);
        setShowLiveBurst(configObj.showLiveBurst, true);
        setShowTimerProgress(configObj.showTimerProgress, true);
        setAlwaysShowDecimalPlaces(configObj.alwaysShowDecimalPlaces, true);
        setAlwaysShowWordsHistory(configObj.alwaysShowWordsHistory, true);
        setSingleListCommandLine(configObj.singleListCommandLine, true);
        setCapsLockWarning(configObj.capsLockWarning, true);
        setPlaySoundOnError(configObj.playSoundOnError, true);
        setPlaySoundOnClick(configObj.playSoundOnClick, true);
        setSoundVolume(configObj.soundVolume, true);
        setStopOnError(configObj.stopOnError, true);
        setFavThemes(configObj.favThemes, true);
        setFunbox(configObj.funbox, true);
        setRandomTheme(configObj.randomTheme, true);
        setShowAllLines(configObj.showAllLines, true);
        setSwapEscAndTab(configObj.swapEscAndTab, true);
        setShowOutOfFocusWarning(configObj.showOutOfFocusWarning, true);
        setPaceCaret(configObj.paceCaret, true);
        setPaceCaretCustomSpeed(configObj.paceCaretCustomSpeed, true);
        setRepeatedPace(configObj.repeatedPace, true);
        setPageWidth(configObj.pageWidth, true);
        setChartAccuracy(configObj.chartAccuracy, true);
        setChartStyle(configObj.chartStyle, true);
        setMinBurst(configObj.minBurst, true);
        setMinBurstCustomSpeed(configObj.minBurstCustomSpeed, true);
        setMinWpm(configObj.minWpm, true);
        setMinWpmCustomSpeed(configObj.minWpmCustomSpeed, true);
        setMinAcc(configObj.minAcc, true);
        setMinAccCustom(configObj.minAccCustom, true);
        setNumbers(configObj.numbers, true);
        setPunctuation(configObj.punctuation, true);
        setHighlightMode(configObj.highlightMode, true);
        setAlwaysShowCPM(configObj.alwaysShowCPM, true);
        setHideExtraLetters(configObj.hideExtraLetters, true);
        setStartGraphsAtZero(configObj.startGraphsAtZero, true);
        setStrictSpace(configObj.strictSpace, true);
        setOppositeShiftMode(configObj.oppositeShiftMode, true);
        setMode(configObj.mode, true);
        setMonkey(configObj.monkey, true);
        setRepeatQuotes(configObj.repeatQuotes, true);
        setMonkeyPowerLevel(configObj.monkeyPowerLevel, true);
        setBurstHeatmap(configObj.burstHeatmap, true);
        setBritishEnglish(configObj.britishEnglish, true);
        setLazyMode(configObj.lazyMode, true);
        setShowAverage(configObj.showAverage, true);
        try {
            setEnableAds(configObj.enableAds, true);
            if (config.enableAds === "max" || config.enableAds === "on") {
                $("head").append(`
          <script
          src="https://hb.vntsm.com/v3/live/ad-manager.min.js"
          type="text/javascript"
          data-site-id="60b78af12119122b8958910f"
          data-mode="scan"
          id="adScript"
          async
          ></script>
        `);
                if (config.enableAds === "max") {
                    //
                    $("#ad_rich_media").removeClass("hidden");
                    $("#ad_rich_media").html(`<div class="vm-placement" data-id="60bf737ee04cb761c88aafb1" style="display:none"></div>`);
                }
                else {
                    $("#ad_rich_media").remove();
                }
                //<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>
                $("#ad_footer").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_footer").removeClass("hidden");
                // $("#ad_footer2").html(`<div class="vm-placement" data-id="60bf73e9e04cb761c88aafb7"></div>`);
                // $("#ad_footer2").removeClass("hidden");
                $("#ad_about1").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_about1").removeClass("hidden");
                $("#ad_about2").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_about2").removeClass("hidden");
                $("#ad_settings0").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_settings0").removeClass("hidden");
                $("#ad_settings1").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_settings1").removeClass("hidden");
                $("#ad_settings2").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_settings2").removeClass("hidden");
                $("#ad_settings3").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_settings3").removeClass("hidden");
                $("#ad_account").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_account").removeClass("hidden");
                $(".footerads").removeClass("hidden");
            }
            else {
                $("#adScript").remove();
                $(".footerads").remove();
                $("#ad_left").remove();
                $("#ad_right").remove();
                $("#ad_footer").remove();
                $("#ad_footer2").remove();
                $("#ad_footer3").remove();
                $("#ad_settings0").remove();
                $("#ad_settings1").remove();
                $("#ad_settings2").remove();
                $("#ad_settings3").remove();
                $("#ad_account").remove();
                $("#ad_about1").remove();
                $("#ad_about2").remove();
            }
        }
        catch (e) {
            Notifications.add("Error initialising ads: " + e.message);
            console.log("error initialising ads " + e.message);
            $(".footerads").remove();
            $("#ad_left").remove();
            $("#ad_right").remove();
            $("#ad_footer").remove();
            $("#ad_footer2").remove();
            $("#ad_footer3").remove();
            $("#ad_settings0").remove();
            $("#ad_settings1").remove();
            $("#ad_settings2").remove();
            $("#ad_settings3").remove();
            $("#ad_account").remove();
            $("#ad_about1").remove();
            $("#ad_about2").remove();
        }
        ConfigEvent.dispatch("configApplied", undefined, undefined, undefined, config);
    }
}
exports.apply = apply;
function reset() {
    ConfigEvent.dispatch("fullConfigChange");
    apply(default_config_1.default);
    saveFullConfigToLocalStorage();
}
exports.reset = reset;
function loadFromLocalStorage() {
    console.log("loading localStorage config");
    const newConfigString = window.localStorage.getItem("config");
    let newConfig;
    if (newConfigString !== undefined &&
        newConfigString !== null &&
        newConfigString !== "") {
        try {
            newConfig = JSON.parse(newConfigString);
        }
        catch (e) {
            newConfig = {};
        }
        apply(newConfig);
        console.log("applying localStorage config");
        exports.localStorageConfig = newConfig;
        saveFullConfigToLocalStorage(true);
        console.log("saving localStorage config");
    }
    // TestLogic.restart(false, true);
    loadDone();
}
exports.loadFromLocalStorage = loadFromLocalStorage;
function getConfigChanges() {
    const configChanges = {};
    Object.keys(config)
        .filter((key) => {
        return config[key] != default_config_1.default[key];
    })
        .forEach((key) => {
        configChanges[key] = config[key];
    });
    return configChanges;
}
exports.getConfigChanges = getConfigChanges;
function setConfig(newConfig) {
    config = newConfig;
}
exports.setConfig = setConfig;
exports.loadPromise = new Promise((v) => {
    loadDone = v;
});
exports["default"] = config;


/***/ }),

/***/ "./src/scripts/constants/default-config.ts":
/*!*************************************************!*\
  !*** ./src/scripts/constants/default-config.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports["default"] = {
    theme: "serika_dark",
    themeLight: "serika",
    themeDark: "serika_dark",
    autoSwitchTheme: false,
    customTheme: false,
    customThemeColors: [
        "#323437",
        "#e2b714",
        "#e2b714",
        "#646669",
        "#d1d0c5",
        "#ca4754",
        "#7e2a33",
        "#ca4754",
        "#7e2a33",
    ],
    favThemes: [],
    showKeyTips: true,
    showLiveWpm: false,
    showTimerProgress: true,
    smoothCaret: true,
    quickTab: false,
    punctuation: false,
    numbers: false,
    words: 50,
    time: 30,
    mode: "time",
    quoteLength: [1],
    language: "english",
    fontSize: "15",
    freedomMode: false,
    resultFilters: null,
    difficulty: "normal",
    blindMode: false,
    quickEnd: false,
    caretStyle: "default",
    paceCaretStyle: "default",
    flipTestColors: false,
    layout: "default",
    funbox: "none",
    confidenceMode: "off",
    indicateTypos: "off",
    timerStyle: "mini",
    colorfulMode: false,
    randomTheme: "off",
    timerColor: "main",
    timerOpacity: "1",
    stopOnError: "off",
    showAllLines: false,
    keymapMode: "off",
    keymapStyle: "staggered",
    keymapLegendStyle: "lowercase",
    keymapLayout: "overrideSync",
    fontFamily: "Roboto_Mono",
    smoothLineScroll: false,
    alwaysShowDecimalPlaces: false,
    alwaysShowWordsHistory: false,
    singleListCommandLine: "manual",
    capsLockWarning: true,
    playSoundOnError: false,
    playSoundOnClick: "off",
    soundVolume: "0.5",
    startGraphsAtZero: true,
    swapEscAndTab: false,
    showOutOfFocusWarning: true,
    paceCaret: "off",
    paceCaretCustomSpeed: 100,
    repeatedPace: true,
    pageWidth: "100",
    chartAccuracy: true,
    chartStyle: "line",
    minWpm: "off",
    minWpmCustomSpeed: 100,
    highlightMode: "letter",
    alwaysShowCPM: false,
    enableAds: "off",
    hideExtraLetters: false,
    strictSpace: false,
    minAcc: "off",
    minAccCustom: 90,
    showLiveAcc: false,
    showLiveBurst: false,
    monkey: false,
    repeatQuotes: "off",
    oppositeShiftMode: "off",
    customBackground: "",
    customBackgroundSize: "cover",
    customBackgroundFilter: [0, 1, 1, 1, 1],
    customLayoutfluid: "qwerty#dvorak#colemak",
    monkeyPowerLevel: "off",
    minBurst: "off",
    minBurstCustomSpeed: 100,
    burstHeatmap: false,
    britishEnglish: false,
    lazyMode: false,
    showAverage: "off",
};


/***/ }),

/***/ "./src/scripts/constants/default-snapshot.ts":
/*!***************************************************!*\
  !*** ./src/scripts/constants/default-snapshot.ts ***!
  \***************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.defaultSnap = void 0;
exports.defaultSnap = {
    results: undefined,
    personalBests: {
        time: {},
        words: {},
        zen: { zen: [] },
        quote: { custom: [] },
        custom: { custom: [] },
    },
    name: "",
    customThemes: [],
    presets: [],
    tags: [],
    favouriteThemes: [],
    banned: undefined,
    verified: undefined,
    emailVerified: undefined,
    lbMemory: { time: { 15: { english: 0 }, 60: { english: 0 } } },
    globalStats: {
        time: 0,
        started: 0,
        completed: 0,
    },
    quoteRatings: undefined,
    quoteMod: false,
};


/***/ }),

/***/ "./src/scripts/constants/firebase-config.ts":
/*!**************************************************!*\
  !*** ./src/scripts/constants/firebase-config.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, exports) => {


// To find your config, go to https://console.firebase.google.com/ and select your project
// Go to (top left) Settings > Project Settings > General
// scroll down to Your apps > Web Apps (if it doesnt exist, create one) > SDK setup and configuration > select npm
// your config should be visible there
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.firebaseConfig = void 0;
exports.firebaseConfig = {
    apiKey: "AIzaSyC8ZGlCnaYJYsz5bsMtmJGbu8QqtCVpM4g",
    authDomain: "monkeytype-d440a.firebaseapp.com",
    projectId: "monkeytype-d440a",
    storageBucket: "monkeytype-d440a.appspot.com",
    messagingSenderId: "409798745430",
    appId: "1:409798745430:web:6843557b36a25156370af7"
};


/***/ }),

/***/ "./src/scripts/controllers/account-controller.ts":
/*!*******************************************************!*\
  !*** ./src/scripts/controllers/account-controller.ts ***!
  \*******************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.signOut = exports.addPasswordAuth = exports.removeGoogleAuth = exports.addGoogleAuth = exports.signInWithGoogle = exports.signIn = exports.getDataAndInit = exports.sendVerificationEmail = exports.gmailProvider = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const AccountButton = __importStar(__webpack_require__(/*! ../elements/account-button */ "./src/scripts/elements/account-button.ts"));
const Account = __importStar(__webpack_require__(/*! ../pages/account */ "./src/scripts/pages/account.ts"));
const VerificationController = __importStar(__webpack_require__(/*! ./verification-controller */ "./src/scripts/controllers/verification-controller.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const AllTimeStats = __importStar(__webpack_require__(/*! ../account/all-time-stats */ "./src/scripts/account/all-time-stats.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const PageController = __importStar(__webpack_require__(/*! ./page-controller */ "./src/scripts/controllers/page-controller.ts"));
const PSA = __importStar(__webpack_require__(/*! ../elements/psa */ "./src/scripts/elements/psa.ts"));
const Focus = __importStar(__webpack_require__(/*! ../test/focus */ "./src/scripts/test/focus.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const PageTransition = __importStar(__webpack_require__(/*! ../states/page-transition */ "./src/scripts/states/page-transition.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const LoadingPage = __importStar(__webpack_require__(/*! ../pages/loading */ "./src/scripts/pages/loading.ts"));
const ResultFilters = __importStar(__webpack_require__(/*! ../account/result-filters */ "./src/scripts/account/result-filters.ts"));
const PaceCaret = __importStar(__webpack_require__(/*! ../test/pace-caret */ "./src/scripts/test/pace-caret.ts"));
const CommandlineLists = __importStar(__webpack_require__(/*! ../elements/commandline-lists */ "./src/scripts/elements/commandline-lists.ts"));
const TagController = __importStar(__webpack_require__(/*! ./tag-controller */ "./src/scripts/controllers/tag-controller.ts"));
const ResultTagsPopup = __importStar(__webpack_require__(/*! ../popups/result-tags-popup */ "./src/scripts/popups/result-tags-popup.ts"));
const URLHandler = __importStar(__webpack_require__(/*! ../utils/url-handler */ "./src/scripts/utils/url-handler.ts"));
const auth_1 = __webpack_require__(/*! firebase/auth */ "./node_modules/firebase/auth/dist/index.esm.js");
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const differenceInDays_1 = __importDefault(__webpack_require__(/*! date-fns/differenceInDays */ "./node_modules/date-fns/esm/differenceInDays/index.js"));
const default_snapshot_1 = __webpack_require__(/*! ../constants/default-snapshot */ "./src/scripts/constants/default-snapshot.ts");
exports.gmailProvider = new auth_1.GoogleAuthProvider();
function sendVerificationEmail() {
    Loader.show();
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    (0, auth_1.sendEmailVerification)(user)
        .then(() => {
        Loader.hide();
        Notifications.add("Email sent to " + user.email, 4000);
    })
        .catch((e) => {
        Loader.hide();
        Notifications.add("Error: " + e.message, 3000);
        console.error(e.message);
    });
}
exports.sendVerificationEmail = sendVerificationEmail;
function getDataAndInit() {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        try {
            console.log("getting account data");
            if (ActivePage.get() === "loading") {
                LoadingPage.updateBar(90);
            }
            else {
                LoadingPage.updateBar(45);
            }
            LoadingPage.updateText("Downloading user data...");
            yield LoadingPage.showBar();
            yield DB.initSnapshot();
        }
        catch (error) {
            const e = error;
            AccountButton.loading(false);
            if (e.responseCode === 429) {
                Notifications.add("Doing so will save you bandwidth, make the next test be ready faster and will not sign you out (which could mean your new personal best would not save to your account).", 0, 0);
                Notifications.add("You will run into this error if you refresh the website to restart the test. It is NOT recommended to do that. Instead, use tab + enter or just tab (with quick tab mode enabled) to restart the test.", 0, 0);
            }
            const msg = e.message || e;
            Notifications.add("Failed to get user data: " + msg, -1);
            $("#top #menu .account").css("opacity", 1);
            if (ActivePage.get() === "loading")
                PageController.change("");
            return false;
        }
        if (ActivePage.get() == "loading") {
            LoadingPage.updateBar(100);
        }
        else {
            LoadingPage.updateBar(45);
        }
        LoadingPage.updateText("Applying settings...");
        const snapshot = DB.getSnapshot();
        $("#menu .icon-button.account .text").text(snapshot.name);
        ResultFilters.loadTags(snapshot.tags);
        Promise.all([Misc.getLanguageList(), Misc.getFunboxList()]).then((values) => {
            const [languages, funboxes] = values;
            languages.forEach((language) => {
                ResultFilters.defaultResultFilters.language[language] = true;
            });
            funboxes.forEach((funbox) => {
                ResultFilters.defaultResultFilters.funbox[funbox.name] = true;
            });
            // filters = defaultResultFilters;
            ResultFilters.load();
        });
        if (!snapshot.name) {
            //verify username
            //invalid, get new
            let nameGood = false;
            let name = "";
            while (!nameGood) {
                name =
                    (_a = prompt("Please provide a new username (cannot be longer than 16 characters, can only contain letters, numbers, underscores, dots and dashes):")) !== null && _a !== void 0 ? _a : "";
                if (!name) {
                    return false;
                }
                const response = yield ape_1.default.users.updateName(name);
                if (response.status !== 200) {
                    Notifications.add("Failed to update name: " + response.message, -1);
                    return false;
                }
                nameGood = true;
                Notifications.add("Name updated", 1);
                snapshot.name = name;
                DB.setSnapshot(snapshot);
                $("#menu .icon-button.account .text").text(name);
            }
        }
        if (!UpdateConfig.changedBeforeDb) {
            //config didnt change before db loaded
            if (UpdateConfig.localStorageConfig === null && snapshot.config) {
                console.log("no local config, applying db");
                AccountButton.loading(false);
                UpdateConfig.apply(snapshot.config);
                Settings.update();
                UpdateConfig.saveFullConfigToLocalStorage(true);
                TestLogic.restart(false, true);
            }
            else if (snapshot.config !== undefined) {
                //loading db config, keep for now
                let configsDifferent = false;
                Object.keys(config_1.default).forEach((ke) => {
                    var _a, _b;
                    const key = ke;
                    if (configsDifferent)
                        return;
                    try {
                        if (key !== "resultFilters") {
                            if (Array.isArray(config_1.default[key])) {
                                config_1.default[key].forEach((arrval, index) => {
                                    var _a;
                                    const arrayValue = ((_a = snapshot === null || snapshot === void 0 ? void 0 : snapshot.config) === null || _a === void 0 ? void 0 : _a[key])[index];
                                    if (arrval != arrayValue) {
                                        configsDifferent = true;
                                        console.log(`.config is different: ${arrval} != ${arrayValue}`);
                                    }
                                });
                            }
                            else {
                                if (config_1.default[key] != ((_a = snapshot === null || snapshot === void 0 ? void 0 : snapshot.config) === null || _a === void 0 ? void 0 : _a[key])) {
                                    configsDifferent = true;
                                    console.log(`..config is different ${key}: ${config_1.default[key]} != ${(_b = snapshot === null || snapshot === void 0 ? void 0 : snapshot.config) === null || _b === void 0 ? void 0 : _b[key]}`);
                                }
                            }
                        }
                    }
                    catch (e) {
                        console.log(e);
                        configsDifferent = true;
                        console.log(`...config is different`);
                    }
                });
                if (configsDifferent) {
                    console.log("configs are different, applying config from db");
                    AccountButton.loading(false);
                    UpdateConfig.apply(snapshot.config);
                    Settings.update();
                    UpdateConfig.saveFullConfigToLocalStorage(true);
                    if (ActivePage.get() == "test") {
                        TestLogic.restart(false, true);
                    }
                    DB.saveConfig(config_1.default);
                }
            }
            UpdateConfig.setDbConfigLoaded(true);
        }
        else {
            console.log("config changed before db");
            AccountButton.loading(false);
        }
        if (config_1.default.paceCaret === "pb" || config_1.default.paceCaret === "average") {
            if (!TestActive.get()) {
                PaceCaret.init();
            }
        }
        AccountButton.loading(false);
        ResultFilters.updateTags();
        CommandlineLists.updateTagCommands();
        TagController.loadActiveFromLocalStorage();
        ResultTagsPopup.updateButtons();
        Settings.showAccountSection();
        PageTransition.set(false);
        console.log("account loading finished");
        return true;
    });
}
exports.getDataAndInit = getDataAndInit;
function loadUser(user) {
    return __awaiter(this, void 0, void 0, function* () {
        // User is signed in.
        $(".pageAccount .content p.accountVerificatinNotice").remove();
        if (user.emailVerified === false) {
            $(".pageAccount .content").prepend(`<p class="accountVerificatinNotice" style="text-align:center">Your account is not verified. <a class="sendVerificationEmail">Send the verification email again</a>.`);
        }
        PageTransition.set(false);
        AccountButton.update();
        AccountButton.loading(true);
        if ((yield getDataAndInit()) === false) {
            signOut();
        }
        // var displayName = user.displayName;
        // var email = user.email;
        // var emailVerified = user.emailVerified;
        // var photoURL = user.photoURL;
        // var isAnonymous = user.isAnonymous;
        // var uid = user.uid;
        // var providerData = user.providerData;
        $(".pageLogin .preloader").addClass("hidden");
        // showFavouriteThemesAtTheTop();
        let text = "Account created on " + user.metadata.creationTime;
        const creationDate = new Date(user.metadata.creationTime);
        const diffDays = (0, differenceInDays_1.default)(new Date(), creationDate);
        text += ` (${diffDays} day${diffDays != 1 ? "s" : ""} ago)`;
        $(".pageAccount .group.createdDate").text(text);
        if (VerificationController.data !== null) {
            VerificationController.verify(user.uid);
        }
    });
}
const authListener = firebase_1.Auth.onAuthStateChanged(function (user) {
    return __awaiter(this, void 0, void 0, function* () {
        // await UpdateConfig.loadPromise;
        console.log(`auth state changed, user ${user ? true : false}`);
        if (user) {
            yield loadUser(user);
        }
        else {
            if (window.location.pathname == "/account") {
                window.history.replaceState("", "", "/login");
            }
            PageTransition.set(false);
        }
        if (user) {
            if (window.location.pathname == "/login") {
                PageController.change("account");
            }
            else if (window.location.pathname != "/account") {
                PageController.change();
                setTimeout(() => {
                    Focus.set(false);
                }, 125 / 2);
            }
            else {
                Account.update();
                // SignOutButton.show();
            }
        }
        else {
            PageController.change();
            setTimeout(() => {
                Focus.set(false);
            }, 125 / 2);
        }
        URLHandler.loadCustomThemeFromUrl();
        if (/challenge_.+/g.test(window.location.pathname)) {
            Notifications.add("Challenge links temporarily disabled. Please use the command line to load the challenge manually", 0, 7);
            return;
            // Notifications.add("Loading challenge", 0);
            // let challengeName = window.location.pathname.split("_")[1];
            // setTimeout(() => {
            //   ChallengeController.setup(challengeName);
            // }, 1000);
        }
        PSA.show();
    });
});
function signIn() {
    UpdateConfig.setChangedBeforeDb(false);
    authListener();
    $(".pageLogin .preloader").removeClass("hidden");
    $(".pageLogin .button").addClass("disabled");
    const email = $(".pageLogin .login input")[0].value;
    const password = $(".pageLogin .login input")[1].value;
    const persistence = $(".pageLogin .login #rememberMe input").prop("checked")
        ? auth_1.browserLocalPersistence
        : auth_1.browserSessionPersistence;
    (0, auth_1.setPersistence)(firebase_1.Auth, persistence).then(function () {
        return (0, auth_1.signInWithEmailAndPassword)(firebase_1.Auth, email, password)
            .then((e) => __awaiter(this, void 0, void 0, function* () {
            yield loadUser(e.user);
            PageController.change("account");
            if (TestLogic.notSignedInLastResult !== null) {
                TestLogic.setNotSignedInUid(e.user.uid);
                const response = yield ape_1.default.results.save(TestLogic.notSignedInLastResult);
                if (response.status !== 200) {
                    return Notifications.add("Failed to save last result: " + response.message, -1);
                }
                TestLogic.clearNotSignedInResult();
                Notifications.add("Last test result saved", 1);
            }
            //TODO: redirect user to relevant page
        }))
            .catch(function (error) {
            let message = error.message;
            if (error.code === "auth/wrong-password") {
                message = "Incorrect password.";
            }
            else if (error.code === "auth/user-not-found") {
                message = "User not found.";
            }
            Notifications.add(message, -1);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
        });
    });
}
exports.signIn = signIn;
function signInWithGoogle() {
    var _a, _b;
    return __awaiter(this, void 0, void 0, function* () {
        UpdateConfig.setChangedBeforeDb(false);
        $(".pageLogin .preloader").removeClass("hidden");
        $(".pageLogin .button").addClass("disabled");
        authListener();
        let signedInUser;
        try {
            const persistence = $(".pageLogin .login #rememberMe input").prop("checked")
                ? auth_1.browserLocalPersistence
                : auth_1.browserSessionPersistence;
            yield (0, auth_1.setPersistence)(firebase_1.Auth, persistence);
            signedInUser = yield (0, auth_1.signInWithPopup)(firebase_1.Auth, exports.gmailProvider);
            if ((_a = (0, auth_1.getAdditionalUserInfo)(signedInUser)) === null || _a === void 0 ? void 0 : _a.isNewUser) {
                //ask for username
                let nameGood = false;
                let name = "";
                while (!nameGood) {
                    name =
                        prompt("Please provide a new username (cannot be longer than 16 characters, can only contain letters, numbers, underscores, dots and dashes):") || "";
                    if (!name) {
                        signOut();
                        $(".pageLogin .preloader").addClass("hidden");
                        return;
                    }
                    const response = yield ape_1.default.users.getNameAvailability(name);
                    if (response.status !== 200) {
                        return Notifications.add("Failed to check name: " + response.message, -1);
                    }
                    nameGood = true;
                }
                //create database object for the new user
                // try {
                const response = yield ape_1.default.users.create(name);
                if (response.status !== 200) {
                    throw response;
                }
                // } catch (e) {
                //   let msg = e?.response?.data?.message ?? e.message;
                //   Notifications.add("Failed to create account: " + msg, -1);
                //   return;
                // }
                if (response.status === 200) {
                    yield (0, auth_1.updateProfile)(signedInUser.user, { displayName: name });
                    yield (0, auth_1.sendEmailVerification)(signedInUser.user);
                    AllTimeStats.clear();
                    Notifications.add("Account created", 1, 3);
                    $("#menu .icon-button.account .text").text(name);
                    $(".pageLogin .button").removeClass("disabled");
                    $(".pageLogin .preloader").addClass("hidden");
                    yield loadUser(signedInUser.user);
                    PageController.change("account");
                    if (TestLogic.notSignedInLastResult !== null) {
                        TestLogic.setNotSignedInUid(signedInUser.user.uid);
                        const resultsSaveResponse = yield ape_1.default.results.save(TestLogic.notSignedInLastResult);
                        if (resultsSaveResponse.status === 200) {
                            const result = TestLogic.notSignedInLastResult;
                            DB.saveLocalResult(result);
                            DB.updateLocalStats({
                                time: result.testDuration +
                                    result.incompleteTestSeconds -
                                    result.afkDuration,
                                started: 1,
                            });
                        }
                    }
                }
            }
            else {
                yield loadUser(signedInUser.user);
                PageController.change("account");
            }
        }
        catch (e) {
            console.log(e);
            const message = Misc.createErrorMessage(e, "Failed to sign in with Google");
            Notifications.add(message, -1);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
            if (signedInUser && ((_b = (0, auth_1.getAdditionalUserInfo)(signedInUser)) === null || _b === void 0 ? void 0 : _b.isNewUser)) {
                yield ape_1.default.users.delete();
                yield signedInUser.user.delete();
            }
            signOut();
            return;
        }
    });
}
exports.signInWithGoogle = signInWithGoogle;
function addGoogleAuth() {
    return __awaiter(this, void 0, void 0, function* () {
        Loader.show();
        if (firebase_1.Auth.currentUser === null)
            return;
        (0, auth_1.linkWithPopup)(firebase_1.Auth.currentUser, exports.gmailProvider)
            .then(function () {
            Loader.hide();
            Notifications.add("Google authentication added", 1);
            Settings.updateAuthSections();
        })
            .catch(function (error) {
            Loader.hide();
            Notifications.add("Failed to add Google authenication: " + error.message, -1);
        });
    });
}
exports.addGoogleAuth = addGoogleAuth;
function removeGoogleAuth() {
    return __awaiter(this, void 0, void 0, function* () {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (user.providerData.find((provider) => provider.providerId === "password")) {
            Loader.show();
            try {
                yield (0, auth_1.reauthenticateWithPopup)(user, exports.gmailProvider);
            }
            catch (e) {
                Loader.hide();
                const message = Misc.createErrorMessage(e, "Failed to reauthenticate");
                return Notifications.add(message, -1);
            }
            (0, auth_1.unlink)(user, "google.com")
                .then(() => {
                Notifications.add("Google authentication removed", 1);
                Loader.hide();
                Settings.updateAuthSections();
            })
                .catch((error) => {
                Loader.hide();
                Notifications.add("Failed to remove Google authentication: " + error.message, -1);
            });
        }
        else {
            Notifications.add("Password authentication needs to be enabled to remove Google authentication", -1);
        }
    });
}
exports.removeGoogleAuth = removeGoogleAuth;
function addPasswordAuth(email, password) {
    return __awaiter(this, void 0, void 0, function* () {
        Loader.show();
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (user.providerData.find((provider) => provider.providerId === "google.com")) {
            try {
                yield (0, auth_1.reauthenticateWithPopup)(user, exports.gmailProvider);
            }
            catch (e) {
                Loader.hide();
                const message = Misc.createErrorMessage(e, "Failed to reauthenticate");
                return Notifications.add(message, -1);
            }
        }
        const credential = auth_1.EmailAuthProvider.credential(email, password);
        (0, auth_1.linkWithCredential)(user, credential)
            .then(function () {
            Loader.hide();
            Notifications.add("Password authenication added", 1);
            Settings.updateAuthSections();
        })
            .catch(function (error) {
            Loader.hide();
            Notifications.add("Failed to add password authenication: " + error.message, -1);
        });
    });
}
exports.addPasswordAuth = addPasswordAuth;
function signOut() {
    firebase_1.Auth.signOut()
        .then(function () {
        Notifications.add("Signed out", 0, 2);
        AllTimeStats.clear();
        Settings.hideAccountSection();
        AccountButton.update();
        PageController.change("login");
        DB.setSnapshot(default_snapshot_1.defaultSnap);
        $(".pageLogin .button").removeClass("disabled");
    })
        .catch(function (error) {
        Notifications.add(error.message, -1);
    });
}
exports.signOut = signOut;
function signUp() {
    return __awaiter(this, void 0, void 0, function* () {
        $(".pageLogin .button").addClass("disabled");
        $(".pageLogin .preloader").removeClass("hidden");
        const nname = $(".pageLogin .register input")[0].value;
        const email = $(".pageLogin .register input")[1].value;
        const emailVerify = $(".pageLogin .register input")[2]
            .value;
        const password = $(".pageLogin .register input")[3]
            .value;
        const passwordVerify = $(".pageLogin .register input")[4].value;
        if (email !== emailVerify) {
            Notifications.add("Emails do not match", 0, 3);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
            return;
        }
        if (password !== passwordVerify) {
            Notifications.add("Passwords do not match", 0, 3);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
            return;
        }
        const response = yield ape_1.default.users.getNameAvailability(nname);
        if (response.status !== 200) {
            Notifications.add(response.message, -1);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
            return;
        }
        authListener();
        let createdAuthUser;
        try {
            createdAuthUser = yield (0, auth_1.createUserWithEmailAndPassword)(firebase_1.Auth, email, password);
            const signInResponse = yield ape_1.default.users.create(nname, email, createdAuthUser.user.uid);
            if (signInResponse.status !== 200) {
                throw signInResponse;
            }
            yield (0, auth_1.updateProfile)(createdAuthUser.user, { displayName: nname });
            yield (0, auth_1.sendEmailVerification)(createdAuthUser.user);
            AllTimeStats.clear();
            $("#menu .icon-button.account .text").text(nname);
            $(".pageLogin .button").removeClass("disabled");
            $(".pageLogin .preloader").addClass("hidden");
            yield loadUser(createdAuthUser.user);
            if (TestLogic.notSignedInLastResult !== null) {
                TestLogic.setNotSignedInUid(createdAuthUser.user.uid);
                const response = yield ape_1.default.results.save(TestLogic.notSignedInLastResult);
                if (response.status === 200) {
                    const result = TestLogic.notSignedInLastResult;
                    DB.saveLocalResult(result);
                    DB.updateLocalStats({
                        time: result.testDuration +
                            result.incompleteTestSeconds -
                            result.afkDuration,
                        started: 1,
                    });
                }
            }
            PageController.change("account");
            Notifications.add("Account created", 1, 3);
        }
        catch (e) {
            //make sure to do clean up here
            if (createdAuthUser) {
                yield ape_1.default.users.delete();
                yield createdAuthUser.user.delete();
            }
            console.log(e);
            const message = Misc.createErrorMessage(e, "Failed to create account");
            Notifications.add(message, -1);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
            signOut();
            return;
        }
    });
}
$(".pageLogin #forgotPasswordButton").on("click", () => {
    const emailField = $(".pageLogin .login input")[0].value || "";
    const email = prompt("Email address", emailField);
    if (email) {
        (0, auth_1.sendPasswordResetEmail)(firebase_1.Auth, email)
            .then(function () {
            // Email sent.
            Notifications.add("Email sent", 1, 2);
        })
            .catch(function (error) {
            // An error happened.
            Notifications.add(error.message, -1);
        });
    }
});
$(".pageLogin .login input").keyup((e) => {
    if (e.key === "Enter") {
        UpdateConfig.setChangedBeforeDb(false);
        signIn();
    }
});
$(".pageLogin .login .button.signIn").on("click", () => {
    UpdateConfig.setChangedBeforeDb(false);
    signIn();
});
$(".pageLogin .login .button.signInWithGoogle").on("click", () => {
    UpdateConfig.setChangedBeforeDb(false);
    signInWithGoogle();
});
// $(".pageLogin .login .button.signInWithGitHub").on("click",(e) => {
// UpdateConfig.setChangedBeforeDb(false);
// signInWithGitHub();
// });
$(".signOut").on("click", () => {
    signOut();
});
$(".pageLogin .register input").keyup((e) => {
    if ($(".pageLogin .register .button").hasClass("disabled"))
        return;
    if (e.key === "Enter") {
        signUp();
    }
});
$(".pageLogin .register .button").on("click", () => {
    if ($(".pageLogin .register .button").hasClass("disabled"))
        return;
    signUp();
});
$(".pageSettings #addGoogleAuth").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    addGoogleAuth();
}));
$(".pageSettings #removeGoogleAuth").on("click", () => {
    removeGoogleAuth();
});
$(document).on("click", ".pageAccount .sendVerificationEmail", () => {
    sendVerificationEmail();
});


/***/ }),

/***/ "./src/scripts/controllers/analytics-controller.ts":
/*!*********************************************************!*\
  !*** ./src/scripts/controllers/analytics-controller.ts ***!
  \*********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.log = void 0;
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const analytics_1 = __webpack_require__(/*! firebase/analytics */ "./node_modules/firebase/analytics/dist/index.esm.js");
function log(eventName, params) {
    return __awaiter(this, void 0, void 0, function* () {
        try {
            (0, analytics_1.logEvent)(firebase_1.Analytics, eventName, params);
        }
        catch (e) {
            console.log("Analytics unavailable");
        }
    });
}
exports.log = log;


/***/ }),

/***/ "./src/scripts/controllers/challenge-controller.ts":
/*!*********************************************************!*\
  !*** ./src/scripts/controllers/challenge-controller.ts ***!
  \*********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.setup = exports.verify = exports.clearActive = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
const Funbox = __importStar(__webpack_require__(/*! ../test/funbox */ "./src/scripts/test/funbox.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const TestState = __importStar(__webpack_require__(/*! ../test/test-state */ "./src/scripts/test/test-state.ts"));
let challengeLoading = false;
function clearActive() {
    if (TestState.activeChallenge &&
        !challengeLoading &&
        !TestUI.testRestarting) {
        Notifications.add("Challenge cleared", 0);
        TestState.setActiveChallenge(null);
    }
}
exports.clearActive = clearActive;
function verify(result) {
    try {
        if (TestState.activeChallenge) {
            const afk = (result.afkDuration / result.testDuration) * 100;
            if (afk > 10) {
                Notifications.add(`Challenge failed: AFK time is greater than 10%`, 0);
                return null;
            }
            if (!TestState.activeChallenge.requirements) {
                Notifications.add(`${TestState.activeChallenge.display} challenge passed!`, 1);
                return TestState.activeChallenge.name;
            }
            else {
                let requirementsMet = true;
                const failReasons = [];
                for (const requirementType in TestState.activeChallenge.requirements) {
                    if (requirementsMet == false)
                        return null;
                    const requirementValue = TestState.activeChallenge.requirements[requirementType];
                    if (requirementType == "wpm") {
                        const wpmMode = Object.keys(requirementValue)[0];
                        if (wpmMode == "exact") {
                            if (Math.round(result.wpm) != requirementValue["exact"]) {
                                requirementsMet = false;
                                failReasons.push(`WPM not ${requirementValue["exact"]}`);
                            }
                        }
                        else if (wpmMode == "min") {
                            if (result.wpm < requirementValue["min"]) {
                                requirementsMet = false;
                                failReasons.push(`WPM below ${requirementValue["min"]}`);
                            }
                        }
                    }
                    else if (requirementType == "acc") {
                        const accMode = Object.keys(requirementValue)[0];
                        if (accMode == "exact") {
                            if (result.acc != requirementValue["exact"]) {
                                requirementsMet = false;
                                failReasons.push(`Accuracy not ${requirementValue["exact"]}`);
                            }
                        }
                        else if (accMode == "min") {
                            if (result.acc < requirementValue["min"]) {
                                requirementsMet = false;
                                failReasons.push(`Accuracy below ${requirementValue["min"]}`);
                            }
                        }
                    }
                    else if (requirementType == "afk") {
                        const afkMode = Object.keys(requirementValue)[0];
                        if (afkMode == "max") {
                            if (Math.round(afk) > requirementValue["max"]) {
                                requirementsMet = false;
                                failReasons.push(`AFK percentage above ${requirementValue["max"]}`);
                            }
                        }
                    }
                    else if (requirementType == "time") {
                        const timeMode = Object.keys(requirementValue)[0];
                        if (timeMode == "min") {
                            if (Math.round(result.testDuration) < requirementValue["min"]) {
                                requirementsMet = false;
                                failReasons.push(`Test time below ${requirementValue["min"]}`);
                            }
                        }
                    }
                    else if (requirementType == "funbox") {
                        const funboxMode = requirementValue["exact"];
                        if (funboxMode != result.funbox) {
                            requirementsMet = false;
                            failReasons.push(`${funboxMode} funbox not active`);
                        }
                    }
                    else if (requirementType == "raw") {
                        const rawMode = Object.keys(requirementValue)[0];
                        if (rawMode == "exact") {
                            if (Math.round(result.rawWpm) != requirementValue["exact"]) {
                                requirementsMet = false;
                                failReasons.push(`Raw WPM not ${requirementValue["exact"]}`);
                            }
                        }
                    }
                    else if (requirementType == "con") {
                        const conMode = Object.keys(requirementValue)[0];
                        if (conMode == "exact") {
                            if (Math.round(result.consistency) != requirementValue["exact"]) {
                                requirementsMet = false;
                                failReasons.push(`Consistency not ${requirementValue["exact"]}`);
                            }
                        }
                    }
                    else if (requirementType == "config") {
                        for (const configKey in requirementValue) {
                            const configValue = requirementValue[configKey];
                            if (config_1.default[configKey] != configValue) {
                                requirementsMet = false;
                                failReasons.push(`${configKey} not set to ${configValue}`);
                            }
                        }
                    }
                }
                if (requirementsMet) {
                    if (TestState.activeChallenge.autoRole) {
                        Notifications.add("You will receive a role shortly. Please don't post a screenshot in challenge submissions.", 1, 5);
                    }
                    Notifications.add(`${TestState.activeChallenge.display} challenge passed!`, 1);
                    return TestState.activeChallenge.name;
                }
                else {
                    Notifications.add(`${TestState.activeChallenge.display} challenge failed: ${failReasons.join(", ")}`, 0);
                    return null;
                }
            }
        }
        else {
            return null;
        }
    }
    catch (e) {
        console.error(e);
        Notifications.add(`Something went wrong when verifying challenge: ${e.message}`, 0);
        return null;
    }
}
exports.verify = verify;
function setup(challengeName) {
    return __awaiter(this, void 0, void 0, function* () {
        challengeLoading = true;
        UpdateConfig.setFunbox("none");
        const list = yield Misc.getChallengeList();
        const challenge = list.filter((c) => c.name === challengeName)[0];
        let notitext;
        try {
            if (challenge === undefined) {
                Notifications.add("Challenge not found", 0);
                ManualRestart.set();
                setTimeout(() => {
                    $("#top .config").removeClass("hidden");
                    $(".page.pageTest").removeClass("hidden");
                }, 250);
                return false;
            }
            if (challenge.type === "customTime") {
                UpdateConfig.setTimeConfig(challenge.parameters[0], true);
                UpdateConfig.setMode("time", true);
                UpdateConfig.setDifficulty("normal", true);
                if (challenge.name === "englishMaster") {
                    UpdateConfig.setLanguage("english_10k", true);
                    UpdateConfig.setNumbers(true, true);
                    UpdateConfig.setPunctuation(true, true);
                }
            }
            else if (challenge.type === "customWords") {
                UpdateConfig.setWordCount(challenge.parameters[0], true);
                UpdateConfig.setMode("words", true);
                UpdateConfig.setDifficulty("normal", true);
            }
            else if (challenge.type === "customText") {
                CustomText.setText(challenge.parameters[0].split(" "));
                CustomText.setIsTimeRandom(false);
                CustomText.setIsWordRandom(challenge.parameters[1]);
                CustomText.setWord(challenge.parameters[2]);
                CustomText.setTime(-1);
                UpdateConfig.setMode("custom", true);
                UpdateConfig.setDifficulty("normal", true);
            }
            else if (challenge.type === "script") {
                const response = yield fetch("/challenges/" + challenge.parameters[0]);
                const scriptdata = yield response.text();
                let text = scriptdata.trim();
                text = text.replace(/[\n\r\t ]/gm, " ");
                text = text.replace(/ +/gm, " ");
                CustomText.setText(text.split(" "));
                CustomText.setIsWordRandom(false);
                UpdateConfig.setMode("custom", true);
                UpdateConfig.setDifficulty("normal", true);
                if (challenge.parameters[1] != null) {
                    UpdateConfig.setTheme(challenge.parameters[1]);
                }
                if (challenge.parameters[2] != null) {
                    Funbox.activate(challenge.parameters[2]);
                }
            }
            else if (challenge.type === "accuracy") {
                UpdateConfig.setTimeConfig(0, true);
                UpdateConfig.setMode("time", true);
                UpdateConfig.setDifficulty("master", true);
            }
            else if (challenge.type === "funbox") {
                UpdateConfig.setFunbox(challenge.parameters[0], true);
                UpdateConfig.setDifficulty("normal", true);
                if (challenge.parameters[1] === "words") {
                    UpdateConfig.setWordCount(challenge.parameters[2], true);
                }
                else if (challenge.parameters[1] === "time") {
                    UpdateConfig.setTimeConfig(challenge.parameters[2], true);
                }
                UpdateConfig.setMode(challenge.parameters[1], true);
                if (challenge.parameters[3] !== undefined) {
                    UpdateConfig.setDifficulty(challenge.parameters[3], true);
                }
            }
            else if (challenge.type === "special") {
                if (challenge.name === "semimak") {
                    // so can you make a link that sets up 120s, 10k, punct, stop on word, and semimak as the layout?
                    UpdateConfig.setMode("time", true);
                    UpdateConfig.setTimeConfig(120, true);
                    UpdateConfig.setLanguage("english_10k", true);
                    UpdateConfig.setPunctuation(true, true);
                    UpdateConfig.setStopOnError("word", true);
                    UpdateConfig.setLayout("semimak", true);
                    UpdateConfig.setKeymapLayout("overrideSync", true);
                    UpdateConfig.setKeymapMode("static", true);
                }
            }
            ManualRestart.set();
            notitext = challenge.message;
            $("#top .config").removeClass("hidden");
            $(".page.pageTest").removeClass("hidden");
            if (notitext === undefined) {
                Notifications.add(`Challenge '${challenge.display}' loaded.`, 0);
            }
            else {
                Notifications.add("Challenge loaded. " + notitext, 0);
            }
            TestState.setActiveChallenge(challenge);
            challengeLoading = false;
            return true;
        }
        catch (e) {
            Notifications.add("Something went wrong: " + e, -1);
            return false;
        }
    });
}
exports.setup = setup;
ConfigEvent.subscribe((eventKey) => {
    if ([
        "difficulty",
        "numbers",
        "punctuation",
        "mode",
        "funbox",
        "paceCaret",
        "showAllLines",
        "showLiveWpm",
        "highlightMode",
        "time",
        "words",
        "keymapMode",
        "keymapLayout",
        "layout",
    ].includes(eventKey)) {
        clearActive();
    }
});


/***/ }),

/***/ "./src/scripts/controllers/chart-controller.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/controllers/chart-controller.ts ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateAllChartColors = exports.setDefaultFontFamily = exports.updateColors = exports.miniResult = exports.accountActivity = exports.accountHistory = exports.accountHistoryActiveIndex = exports.result = void 0;
const chart_js_1 = __webpack_require__(/*! chart.js */ "./node_modules/chart.js/dist/chart.esm.js");
const chartjs_plugin_trendline_1 = __importDefault(__webpack_require__(/*! chartjs-plugin-trendline */ "./node_modules/chartjs-plugin-trendline/src/chartjs-plugin-trendline.js"));
const chartjs_plugin_annotation_1 = __importDefault(__webpack_require__(/*! chartjs-plugin-annotation */ "./node_modules/chartjs-plugin-annotation/dist/chartjs-plugin-annotation.esm.js"));
chart_js_1.Chart.register(chart_js_1.BarController, chart_js_1.BarElement, chart_js_1.CategoryScale, chart_js_1.Filler, chart_js_1.LinearScale, chart_js_1.LineController, chart_js_1.LineElement, chart_js_1.PointElement, chart_js_1.ScatterController, chart_js_1.TimeScale, chart_js_1.TimeSeriesScale, chart_js_1.Tooltip, chartjs_plugin_trendline_1.default, chartjs_plugin_annotation_1.default);
chart_js_1.Chart.defaults.animation.duration = 0;
chart_js_1.Chart.defaults.elements.line.tension = 0.3;
chart_js_1.Chart.defaults.elements.line.fill = "origin";
const TestInput = __importStar(__webpack_require__(/*! ../test/test-input */ "./src/scripts/test/test-input.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
__webpack_require__(/*! chartjs-adapter-date-fns */ "./node_modules/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.esm.js");
class ChartWithUpdateColors extends chart_js_1.Chart {
    constructor(item, config) {
        super(item, config);
    }
    updateColors() {
        updateColors(this);
    }
}
exports.result = new ChartWithUpdateColors($("#wpmChart"), {
    type: "line",
    data: {
        labels: [],
        datasets: [
            {
                label: "wpm",
                data: [],
                borderColor: "rgba(125, 125, 125, 1)",
                borderWidth: 2,
                yAxisID: "wpm",
                order: 2,
                pointRadius: 2,
            },
            {
                label: "raw",
                data: [],
                borderColor: "rgba(125, 125, 125, 1)",
                borderWidth: 2,
                yAxisID: "raw",
                order: 3,
                pointRadius: 2,
            },
            {
                label: "errors",
                data: [],
                borderColor: "rgba(255, 125, 125, 1)",
                pointBackgroundColor: "rgba(255, 125, 125, 1)",
                borderWidth: 2,
                order: 1,
                yAxisID: "error",
                type: "scatter",
                pointStyle: "crossRot",
                pointRadius: function (context) {
                    const index = context.dataIndex;
                    const value = context.dataset.data[index];
                    return (value !== null && value !== void 0 ? value : 0) <= 0 ? 0 : 3;
                },
                pointHoverRadius: function (context) {
                    const index = context.dataIndex;
                    const value = context.dataset.data[index];
                    return (value !== null && value !== void 0 ? value : 0) <= 0 ? 0 : 5;
                },
            },
        ],
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            x: {
                axis: "x",
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                display: true,
                title: {
                    display: false,
                    text: "Seconds",
                },
            },
            wpm: {
                axis: "y",
                display: true,
                title: {
                    display: true,
                    text: "Words per Minute",
                },
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: true,
                },
            },
            raw: {
                axis: "y",
                display: false,
                title: {
                    display: true,
                    text: "Raw Words per Minute",
                },
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: false,
                },
            },
            error: {
                axis: "y",
                display: true,
                position: "right",
                title: {
                    display: true,
                    text: "Errors",
                },
                beginAtZero: true,
                ticks: {
                    precision: 0,
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: false,
                },
            },
        },
        plugins: {
            annotation: {
                annotations: [],
            },
            tooltip: {
                animation: { duration: 250 },
                mode: "index",
                intersect: false,
                callbacks: {
                    afterLabel: function (ti) {
                        try {
                            $(".wordInputAfter").remove();
                            const wordsToHighlight = TestInput.keypressPerSecond[parseInt(ti.label) - 1].words;
                            const unique = [...new Set(wordsToHighlight)];
                            unique.forEach((wordIndex) => {
                                const wordEl = $($("#resultWordsHistory .words .word")[wordIndex]);
                                const input = wordEl.attr("input");
                                if (input != undefined) {
                                    wordEl.append(`<div class="wordInputAfter">${input
                                        .replace(/\t/g, "_")
                                        .replace(/\n/g, "_")
                                        .replace(/</g, "&lt")
                                        .replace(/>/g, "&gt")}</div>`);
                                }
                            });
                        }
                        catch (_a) { }
                        return "";
                    },
                },
            },
        },
    },
});
exports.accountHistory = new ChartWithUpdateColors($(".pageAccount #accountHistoryChart"), {
    type: "line",
    data: {
        labels: [],
        datasets: [
            {
                yAxisID: "wpm",
                label: "wpm",
                fill: false,
                data: [],
                borderColor: "#f44336",
                borderWidth: 2,
                trendlineLinear: {
                    style: "rgba(255,105,180, .8)",
                    lineStyle: "dotted",
                    width: 4,
                },
            },
            {
                yAxisID: "acc",
                label: "acc",
                fill: false,
                data: [],
                borderColor: "#cccccc",
                borderWidth: 2,
            },
        ],
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        hover: {
            mode: "nearest",
            intersect: false,
        },
        scales: {
            x: {
                axis: "x",
                type: "timeseries",
                bounds: "ticks",
                display: false,
                offset: true,
                title: {
                    display: false,
                    text: "Date",
                },
            },
            wpm: {
                axis: "y",
                beginAtZero: true,
                min: 0,
                ticks: {
                    stepSize: 10,
                },
                display: true,
                title: {
                    display: true,
                    text: "Words per Minute",
                },
            },
            acc: {
                axis: "y",
                beginAtZero: true,
                max: 100,
                display: true,
                position: "right",
                title: {
                    display: true,
                    text: "Error rate (100 - accuracy)",
                },
                grid: {
                    display: false,
                },
            },
        },
        plugins: {
            annotation: {
                annotations: [],
            },
            tooltip: {
                animation: { duration: 250 },
                // Disable the on-canvas tooltip
                enabled: true,
                intersect: false,
                external: function (ctx) {
                    if (!ctx)
                        return;
                    ctx.tooltip.options.displayColors = false;
                },
                callbacks: {
                    title: function () {
                        return "";
                    },
                    beforeLabel: function (tooltipItem) {
                        if (tooltipItem.datasetIndex !== 0) {
                            const resultData = tooltipItem.dataset.data[tooltipItem.dataIndex];
                            return `error rate: ${Misc.roundTo2(resultData.errorRate)}%\nacc: ${Misc.roundTo2(100 - resultData.errorRate)}%`;
                        }
                        const resultData = tooltipItem.dataset.data[tooltipItem.dataIndex];
                        let label = `${config_1.default.alwaysShowCPM ? "cpm" : "wpm"}: ${resultData.wpm}` +
                            "\n" +
                            `raw: ${resultData.raw}` +
                            "\n" +
                            `acc: ${resultData.acc}` +
                            "\n\n" +
                            `mode: ${resultData.mode} `;
                        if (resultData.mode == "time") {
                            label += resultData.mode2;
                        }
                        else if (resultData.mode == "words") {
                            label += resultData.mode2;
                        }
                        let diff = resultData.difficulty;
                        if (diff == undefined) {
                            diff = "normal";
                        }
                        label += "\n" + `difficulty: ${diff}`;
                        label +=
                            "\n" +
                                `punctuation: ${resultData.punctuation}` +
                                "\n" +
                                `language: ${resultData.language}` +
                                "\n\n" +
                                `date: ${(0, format_1.default)(new Date(resultData.timestamp), "dd MMM yyyy HH:mm")}`;
                        return label;
                    },
                    label: function () {
                        return "";
                    },
                    afterLabel: function (tooltip) {
                        exports.accountHistoryActiveIndex = tooltip.dataIndex;
                        return "";
                    },
                },
            },
        },
    },
});
exports.accountActivity = new ChartWithUpdateColors($(".pageAccount #accountActivityChart"), {
    type: "bar",
    data: {
        labels: [],
        datasets: [
            {
                yAxisID: "count",
                label: "Seconds",
                data: [],
                trendlineLinear: {
                    style: "rgba(255,105,180, .8)",
                    lineStyle: "dotted",
                    width: 2,
                },
                order: 3,
            },
            {
                yAxisID: "avgWpm",
                label: "Average Wpm",
                data: [],
                type: "line",
                order: 2,
                tension: 0,
                fill: false,
            },
        ],
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        hover: {
            mode: "nearest",
            intersect: false,
        },
        scales: {
            x: {
                axis: "x",
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                type: "time",
                time: {
                    unit: "day",
                    displayFormats: {
                        day: "d MMM",
                    },
                },
                bounds: "ticks",
                display: true,
                title: {
                    display: false,
                    text: "Date",
                },
                offset: true,
            },
            count: {
                axis: "y",
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                    stepSize: 10,
                },
                display: true,
                title: {
                    display: true,
                    text: "Time Typing",
                },
            },
            avgWpm: {
                axis: "y",
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                    stepSize: 10,
                },
                display: true,
                position: "right",
                title: {
                    display: true,
                    text: "Average Wpm",
                },
                grid: {
                    display: false,
                },
            },
        },
        plugins: {
            annotation: {
                annotations: [],
            },
            tooltip: {
                animation: { duration: 250 },
                callbacks: {
                    title: function (tooltipItem) {
                        const resultData = tooltipItem[0].dataset.data[tooltipItem[0].dataIndex];
                        return (0, format_1.default)(new Date(resultData.x), "dd MMM yyyy");
                    },
                    beforeLabel: function (tooltipItem) {
                        const resultData = tooltipItem.dataset.data[tooltipItem.dataIndex];
                        switch (tooltipItem.datasetIndex) {
                            case 0:
                                return `Time Typing: ${Misc.secondsToString(Math.round(resultData.y), true, true)}\nTests Completed: ${resultData.amount}`;
                            case 1:
                                return `Average ${config_1.default.alwaysShowCPM ? "Cpm" : "Wpm"}: ${Misc.roundTo2(resultData.y)}`;
                            default:
                                return "";
                        }
                    },
                    label: function () {
                        return "";
                    },
                },
            },
        },
    },
});
exports.miniResult = new ChartWithUpdateColors($(".pageAccount #miniResultChart"), {
    type: "line",
    data: {
        labels: [],
        datasets: [
            {
                label: "wpm",
                data: [],
                borderColor: "rgba(125, 125, 125, 1)",
                borderWidth: 2,
                yAxisID: "wpm",
                order: 2,
                pointRadius: 2,
            },
            {
                label: "raw",
                data: [],
                borderColor: "rgba(125, 125, 125, 1)",
                borderWidth: 2,
                yAxisID: "raw",
                order: 3,
                pointRadius: 2,
            },
            {
                label: "errors",
                data: [],
                borderColor: "rgba(255, 125, 125, 1)",
                pointBackgroundColor: "rgba(255, 125, 125, 1)",
                borderWidth: 2,
                order: 1,
                yAxisID: "error",
                type: "scatter",
                pointStyle: "crossRot",
                pointRadius: function (context) {
                    const index = context.dataIndex;
                    const value = context.dataset.data[index];
                    return (value !== null && value !== void 0 ? value : 0) <= 0 ? 0 : 3;
                },
                pointHoverRadius: function (context) {
                    const index = context.dataIndex;
                    const value = context.dataset.data[index];
                    return (value !== null && value !== void 0 ? value : 0) <= 0 ? 0 : 5;
                },
            },
        ],
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            x: {
                axis: "x",
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                display: true,
                title: {
                    display: false,
                    text: "Seconds",
                },
            },
            wpm: {
                axis: "y",
                display: true,
                title: {
                    display: true,
                    text: "Words per Minute",
                },
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: true,
                },
            },
            raw: {
                axis: "y",
                display: false,
                title: {
                    display: true,
                    text: "Raw Words per Minute",
                },
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: false,
                },
            },
            error: {
                display: true,
                position: "right",
                title: {
                    display: true,
                    text: "Errors",
                },
                beginAtZero: true,
                ticks: {
                    precision: 0,
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: false,
                },
            },
        },
        plugins: {
            annotation: {
                annotations: [],
            },
            tooltip: {
                animation: { duration: 250 },
                mode: "index",
                intersect: false,
            },
        },
    },
});
function updateAccuracy() {
    exports.accountHistory.data.datasets[1].hidden = !config_1.default.chartAccuracy;
    exports.accountHistory.options.scales.acc.display =
        config_1.default.chartAccuracy;
    exports.accountHistory.update();
}
function updateStyle() {
    if (config_1.default.chartStyle == "scatter") {
        exports.accountHistory.data.datasets[0].showLine = false;
        exports.accountHistory.data.datasets[1].showLine = false;
    }
    else {
        exports.accountHistory.data.datasets[0].showLine = true;
        exports.accountHistory.data.datasets[1].showLine = true;
    }
    exports.accountHistory.updateColors();
}
function updateColors(chart) {
    return __awaiter(this, void 0, void 0, function* () {
        const bgcolor = yield ThemeColors.get("bg");
        const subcolor = yield ThemeColors.get("sub");
        const maincolor = yield ThemeColors.get("main");
        const errorcolor = yield ThemeColors.get("error");
        if (chart.data.datasets.every((dataset) => dataset.data.length === 0)) {
            return;
        }
        chart.data.datasets[0].borderColor = maincolor;
        chart.data.datasets[1].borderColor = subcolor;
        if (chart.data.datasets[2]) {
            chart.data.datasets[2].borderColor = errorcolor;
        }
        if (chart.data.datasets[0].type === undefined) {
            if (chart.config.type === "line") {
                chart.data.datasets[0].pointBackgroundColor = maincolor;
            }
            else if (chart.config.type === "bar") {
                chart.data.datasets[0].backgroundColor = maincolor;
            }
        }
        else if (chart.data.datasets[0].type === "bar") {
            chart.data.datasets[0].backgroundColor = maincolor;
        }
        else if (chart.data.datasets[0].type === "line") {
            chart.data.datasets[0].pointBackgroundColor = maincolor;
        }
        if (chart.data.datasets[1].type === undefined) {
            if (chart.config.type === "line") {
                chart.data.datasets[1].pointBackgroundColor = subcolor;
            }
            else if (chart.config.type === "bar") {
                chart.data.datasets[1].backgroundColor = subcolor;
            }
        }
        else if (chart.data.datasets[1].type === "bar") {
            chart.data.datasets[1].backgroundColor = subcolor;
        }
        else if (chart.data.datasets[1].type === "line") {
            chart.data.datasets[1].pointBackgroundColor = subcolor;
        }
        const chartScaleOptions = chart.options;
        Object.keys(chartScaleOptions.scales).forEach((scaleID) => {
            const axis = chartScaleOptions.scales[scaleID];
            axis.ticks.color = subcolor;
            axis.title.color = subcolor;
        });
        try {
            chart.data.datasets[0]
                .trendlineLinear.style = subcolor;
            chart.data.datasets[1]
                .trendlineLinear.style = subcolor;
        }
        catch (_a) { }
        chart.options.plugins.annotation
            .annotations.forEach((annotation) => {
            if (annotation.id !== "funbox-label") {
                annotation.borderColor = subcolor;
            }
            annotation.label.backgroundColor = subcolor;
            annotation.label.color = bgcolor;
        });
        chart.update("none");
    });
}
exports.updateColors = updateColors;
function setDefaultFontFamily(font) {
    chart_js_1.Chart.defaults.font.family = font.replace(/_/g, " ");
}
exports.setDefaultFontFamily = setDefaultFontFamily;
function updateAllChartColors() {
    ThemeColors.update();
    exports.accountHistory.updateColors();
    exports.result.updateColors();
    exports.accountActivity.updateColors();
    exports.miniResult.updateColors();
}
exports.updateAllChartColors = updateAllChartColors;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "chartAccuracy")
        updateAccuracy();
    if (eventKey === "chartStyle")
        updateStyle();
    if (eventKey === "fontFamily")
        setDefaultFontFamily(eventValue);
});


/***/ }),

/***/ "./src/scripts/controllers/input-controller.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/controllers/input-controller.ts ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const TestStats = __importStar(__webpack_require__(/*! ../test/test-stats */ "./src/scripts/test/test-stats.ts"));
const Monkey = __importStar(__webpack_require__(/*! ../test/monkey */ "./src/scripts/test/monkey.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Keymap = __importStar(__webpack_require__(/*! ../elements/keymap */ "./src/scripts/elements/keymap.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const LiveAcc = __importStar(__webpack_require__(/*! ../test/live-acc */ "./src/scripts/test/live-acc.ts"));
const LiveBurst = __importStar(__webpack_require__(/*! ../test/live-burst */ "./src/scripts/test/live-burst.ts"));
const Funbox = __importStar(__webpack_require__(/*! ../test/funbox */ "./src/scripts/test/funbox.ts"));
const Sound = __importStar(__webpack_require__(/*! ./sound-controller */ "./src/scripts/controllers/sound-controller.ts"));
const Caret = __importStar(__webpack_require__(/*! ../test/caret */ "./src/scripts/test/caret.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
const PageController = __importStar(__webpack_require__(/*! ./page-controller */ "./src/scripts/controllers/page-controller.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const LayoutEmulator = __importStar(__webpack_require__(/*! ../test/layout-emulator */ "./src/scripts/test/layout-emulator.ts"));
const PaceCaret = __importStar(__webpack_require__(/*! ../test/pace-caret */ "./src/scripts/test/pace-caret.ts"));
const TimerProgress = __importStar(__webpack_require__(/*! ../test/timer-progress */ "./src/scripts/test/timer-progress.ts"));
const Focus = __importStar(__webpack_require__(/*! ../test/focus */ "./src/scripts/test/focus.ts"));
const ShiftTracker = __importStar(__webpack_require__(/*! ../test/shift-tracker */ "./src/scripts/test/shift-tracker.ts"));
const Replay = __importStar(__webpack_require__(/*! ../test/replay */ "./src/scripts/test/replay.ts"));
const MonkeyPower = __importStar(__webpack_require__(/*! ../elements/monkey-power */ "./src/scripts/elements/monkey-power.ts"));
const WeakSpot = __importStar(__webpack_require__(/*! ../test/weak-spot */ "./src/scripts/test/weak-spot.ts"));
const Leaderboards = __importStar(__webpack_require__(/*! ../elements/leaderboards */ "./src/scripts/elements/leaderboards.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const TestInput = __importStar(__webpack_require__(/*! ../test/test-input */ "./src/scripts/test/test-input.ts"));
const TestWords = __importStar(__webpack_require__(/*! ../test/test-words */ "./src/scripts/test/test-words.ts"));
const WordTypedEvent = __importStar(__webpack_require__(/*! ../observables/word-typed-event */ "./src/scripts/observables/word-typed-event.ts"));
let dontInsertSpace = false;
let correctShiftUsed = true;
const wordsInput = document.getElementById("wordsInput");
function setWordsInput(value) {
    // Only change #wordsInput if it's not already the wanted value
    // Avoids Safari triggering unneeded events, causing issues with
    // dead keys.
    // console.log("settings words input to " + value);
    if (value !== wordsInput.value) {
        wordsInput.value = value;
    }
}
function updateUI() {
    const acc = Misc.roundTo2(TestStats.calculateAccuracy());
    if (!isNaN(acc))
        LiveAcc.update(acc);
    if (config_1.default.keymapMode === "next" && config_1.default.mode !== "zen") {
        Keymap.highlightKey(TestWords.words
            .getCurrent()
            .charAt(TestInput.input.current.length)
            .toString()
            .toUpperCase());
    }
}
function backspaceToPrevious() {
    if (!TestActive.get())
        return;
    if (TestInput.input.history.length == 0 ||
        TestUI.currentWordElementIndex == 0) {
        return;
    }
    if ((TestInput.input.history[TestWords.words.currentIndex - 1] ==
        TestWords.words.get(TestWords.words.currentIndex - 1) &&
        !config_1.default.freedomMode) ||
        $($(".word")[TestWords.words.currentIndex - 1]).hasClass("hidden")) {
        return;
    }
    if (config_1.default.confidenceMode === "on" || config_1.default.confidenceMode === "max") {
        return;
    }
    TestInput.input.current = TestInput.input.popHistory();
    TestInput.corrected.popHistory();
    if (config_1.default.funbox === "nospace" || config_1.default.funbox === "arrows") {
        TestInput.input.current = TestInput.input.current.slice(0, -1);
    }
    TestWords.words.decreaseCurrentIndex();
    TestUI.setCurrentWordElementIndex(TestUI.currentWordElementIndex - 1);
    TestUI.updateActiveElement(true);
    Funbox.toggleScript(TestWords.words.getCurrent());
    TestUI.updateWordElement();
    Caret.updatePosition();
    Replay.addReplayEvent("backWord");
}
function handleSpace() {
    var _a;
    if (!TestActive.get())
        return;
    if (TestInput.input.current === "")
        return;
    if (config_1.default.mode == "zen") {
        $("#words .word.active").removeClass("active");
        $("#words").append("<div class='word active'></div>");
    }
    const currentWord = TestWords.words.getCurrent();
    if (config_1.default.funbox === "layoutfluid" && config_1.default.mode !== "time") {
        // here I need to check if Config.customLayoutFluid exists because of my scuffed solution of returning whenever value is undefined in the setCustomLayoutfluid function
        const layouts = config_1.default.customLayoutfluid
            ? config_1.default.customLayoutfluid.split("#")
            : ["qwerty", "dvorak", "colemak"];
        let index = 0;
        const outof = TestWords.words.length;
        index = Math.floor((TestInput.input.history.length + 1) / (outof / layouts.length));
        if (config_1.default.layout !== layouts[index] && layouts[index] !== undefined) {
            Notifications.add(`--- !!! ${layouts[index]} !!! ---`, 0);
        }
        UpdateConfig.setLayout(layouts[index]);
        UpdateConfig.setKeymapLayout(layouts[index]);
        Keymap.highlightKey(TestWords.words
            .getCurrent()
            .charAt(TestInput.input.current.length)
            .toString()
            .toUpperCase());
        (_a = Settings.groups["layout"]) === null || _a === void 0 ? void 0 : _a.updateInput();
    }
    dontInsertSpace = true;
    const burst = TestStats.calculateBurst();
    LiveBurst.update(Math.round(burst));
    TestInput.pushBurstToHistory(burst);
    //correct word or in zen mode
    const isWordCorrect = currentWord == TestInput.input.current || config_1.default.mode == "zen";
    // This will probably break if letter mode is on or something
    const $currentTestWord = $(`#words .word.active`);
    WordTypedEvent.dispatch(currentWord, isWordCorrect, burst, $currentTestWord);
    MonkeyPower.addPower(isWordCorrect, true);
    TestInput.incrementAccuracy(isWordCorrect);
    if (isWordCorrect) {
        PaceCaret.handleSpace(true, currentWord);
        TestInput.input.pushHistory();
        TestWords.words.increaseCurrentIndex();
        TestUI.setCurrentWordElementIndex(TestUI.currentWordElementIndex + 1);
        TestUI.updateActiveElement();
        Funbox.toggleScript(TestWords.words.getCurrent());
        Caret.updatePosition();
        TestInput.incrementKeypressCount();
        TestInput.pushKeypressWord(TestWords.words.currentIndex);
        if (config_1.default.funbox !== "nospace" && config_1.default.funbox !== "arrows") {
            Sound.playClick();
        }
        Replay.addReplayEvent("submitCorrectWord");
    }
    else {
        if (config_1.default.funbox !== "nospace" && config_1.default.funbox !== "arrows") {
            if (!config_1.default.playSoundOnError || config_1.default.blindMode) {
                Sound.playClick();
            }
            else {
                Sound.playError();
            }
        }
        TestInput.pushMissedWord(TestWords.words.getCurrent());
        TestInput.incrementKeypressErrors();
        const cil = TestInput.input.current.length;
        if (cil <= TestWords.words.getCurrent().length) {
            if (cil >= TestInput.corrected.current.length) {
                TestInput.corrected.current += "_";
            }
            else {
                TestInput.corrected.current =
                    TestInput.corrected.current.substring(0, cil) +
                        "_" +
                        TestInput.corrected.current.substring(cil + 1);
            }
        }
        if (config_1.default.stopOnError != "off") {
            if (config_1.default.difficulty == "expert" || config_1.default.difficulty == "master") {
                //failed due to diff when pressing space
                TestLogic.fail("difficulty");
                return;
            }
            if (config_1.default.stopOnError == "word") {
                dontInsertSpace = false;
                Replay.addReplayEvent("incorrectLetter", "_");
                TestUI.updateWordElement(true);
                Caret.updatePosition();
            }
            return;
        }
        PaceCaret.handleSpace(false, currentWord);
        if (config_1.default.blindMode && config_1.default.highlightMode !== "off") {
            $("#words .word.active letter").addClass("correct");
        }
        TestInput.input.pushHistory();
        TestUI.highlightBadWord(TestUI.currentWordElementIndex, !config_1.default.blindMode);
        TestWords.words.increaseCurrentIndex();
        TestUI.setCurrentWordElementIndex(TestUI.currentWordElementIndex + 1);
        TestUI.updateActiveElement();
        Funbox.toggleScript(TestWords.words.getCurrent());
        Caret.updatePosition();
        TestInput.incrementKeypressCount();
        TestInput.pushKeypressWord(TestWords.words.currentIndex);
        TestInput.updateLastKeypress();
        if (config_1.default.difficulty == "expert" || config_1.default.difficulty == "master") {
            TestLogic.fail("difficulty");
            return;
        }
        else if (TestWords.words.currentIndex == TestWords.words.length) {
            //submitted last word that is incorrect
            TestLogic.finish();
            return;
        }
        Replay.addReplayEvent("submitErrorWord");
    }
    let wordLength;
    if (config_1.default.mode === "zen") {
        wordLength = TestInput.input.current.length;
    }
    else {
        wordLength = TestWords.words.getCurrent().length;
    }
    const flex = Misc.whorf(config_1.default.minBurstCustomSpeed, wordLength);
    if ((config_1.default.minBurst === "fixed" && burst < config_1.default.minBurstCustomSpeed) ||
        (config_1.default.minBurst === "flex" && burst < flex)) {
        TestLogic.fail("min burst");
        return;
    }
    TestInput.corrected.pushHistory();
    if (!config_1.default.showAllLines ||
        config_1.default.mode == "time" ||
        (CustomText.isWordRandom && CustomText.word == 0) ||
        CustomText.isTimeRandom) {
        const currentTop = Math.floor(document.querySelectorAll("#words .word")[TestUI.currentWordElementIndex - 1].offsetTop);
        let nextTop;
        try {
            nextTop = Math.floor(document.querySelectorAll("#words .word")[TestUI.currentWordElementIndex].offsetTop);
        }
        catch (e) {
            nextTop = 0;
        }
        if (nextTop > currentTop && !TestUI.lineTransition) {
            TestUI.lineJump(currentTop);
        }
    } //end of line wrap
    if (config_1.default.keymapMode === "react") {
        Keymap.flashKey(" ", true);
    }
    if (config_1.default.mode === "words" ||
        config_1.default.mode === "custom" ||
        config_1.default.mode === "quote" ||
        config_1.default.mode === "zen") {
        TimerProgress.update();
    }
    if (config_1.default.mode == "time" ||
        config_1.default.mode == "words" ||
        config_1.default.mode == "custom" ||
        config_1.default.mode == "quote") {
        TestLogic.addWord();
    }
}
function isCharCorrect(char, charIndex) {
    if (!correctShiftUsed)
        return false;
    if (config_1.default.mode == "zen") {
        return true;
    }
    const originalChar = TestWords.words.getCurrent()[charIndex];
    if (originalChar == char) {
        return true;
    }
    if (config_1.default.language.split("_")[0] == "russian") {
        if ((char === "" || char === "e") && originalChar == "") {
            return true;
        }
        if (char === "" && (originalChar == "" || originalChar === "e")) {
            return true;
        }
    }
    if (config_1.default.funbox === "arrows") {
        if ((char === "w" || char === "ArrowUp") && originalChar == "") {
            return true;
        }
        if ((char === "s" || char === "ArrowDown") && originalChar == "") {
            return true;
        }
        if ((char === "a" || char === "ArrowLeft") && originalChar == "") {
            return true;
        }
        if ((char === "d" || char === "ArrowRight") && originalChar == "") {
            return true;
        }
    }
    if ((char === `` || char === "" || char === "'") &&
        (originalChar == `` || originalChar === "" || originalChar === "'")) {
        return true;
    }
    if ((char === `"` || char === "" || char == "" || char === "") &&
        (originalChar == `"` ||
            originalChar === "" ||
            originalChar === "" ||
            originalChar === "")) {
        return true;
    }
    if ((char === "" || char === "" || char == "-") &&
        (originalChar == "-" || originalChar === "" || originalChar === "")) {
        return true;
    }
    return false;
}
function handleChar(char, charIndex) {
    var _a, _b, _c, _d;
    if (TestUI.resultCalculating || TestUI.resultVisible) {
        return;
    }
    if (char === "") {
        for (let i = 0; i < 3; i++) {
            handleChar(".", charIndex + i);
        }
        return;
    }
    if (char === "\n" && config_1.default.funbox === "58008") {
        char = " ";
    }
    if (char !== "\n" && char !== "\t" && /\s/.test(char)) {
        if (config_1.default.funbox === "nospace" || config_1.default.funbox === "arrows")
            return;
        handleSpace();
        //insert space for expert and master or strict space,
        //or for stop on error set to word,
        //otherwise dont do anything
        if (config_1.default.difficulty !== "normal" ||
            (config_1.default.strictSpace && config_1.default.mode !== "zen") ||
            config_1.default.stopOnError === "word") {
            if (dontInsertSpace) {
                dontInsertSpace = false;
                return;
            }
        }
        else {
            return;
        }
    }
    if (config_1.default.mode !== "zen" &&
        TestWords.words.getCurrent()[charIndex] !== "\n" &&
        char === "\n") {
        return;
    }
    //start the test
    if (!TestActive.get() && !TestLogic.startTest()) {
        return;
    }
    Focus.set(true);
    Caret.stopAnimation();
    const thisCharCorrect = isCharCorrect(char, charIndex);
    if (thisCharCorrect && config_1.default.mode !== "zen") {
        char = TestWords.words.getCurrent().charAt(charIndex);
    }
    if (!thisCharCorrect && char === "\n") {
        if (TestInput.input.current === "")
            return;
        char = " ";
    }
    if (TestInput.input.current === "") {
        TestInput.setBurstStart(performance.now());
    }
    const resultingWord = TestInput.input.current.substring(0, charIndex) +
        char +
        TestInput.input.current.substring(charIndex + 1);
    if (!thisCharCorrect && Misc.trailingComposeChars.test(resultingWord)) {
        TestInput.input.current = resultingWord;
        TestUI.updateWordElement();
        Caret.updatePosition();
        return;
    }
    MonkeyPower.addPower(thisCharCorrect);
    TestInput.incrementAccuracy(thisCharCorrect);
    if (!thisCharCorrect) {
        TestInput.incrementKeypressErrors();
        TestInput.pushMissedWord(TestWords.words.getCurrent());
    }
    WeakSpot.updateScore(config_1.default.mode === "zen" ? char : TestWords.words.getCurrent()[charIndex], thisCharCorrect);
    if (thisCharCorrect) {
        Sound.playClick();
    }
    else {
        if (!config_1.default.playSoundOnError || config_1.default.blindMode) {
            Sound.playClick();
        }
        else {
            Sound.playError();
        }
    }
    if (!correctShiftUsed && config_1.default.difficulty != "master")
        return;
    //update current corrected version. if its empty then add the current char. if its not then replace the last character with the currently pressed one / add it
    if (TestInput.corrected.current === "") {
        TestInput.corrected.current += resultingWord;
    }
    else {
        if (charIndex >= TestInput.corrected.current.length) {
            TestInput.corrected.current += char;
        }
        else if (!thisCharCorrect) {
            TestInput.corrected.current =
                TestInput.corrected.current.substring(0, charIndex) +
                    char +
                    TestInput.corrected.current.substring(charIndex + 1);
        }
    }
    TestInput.incrementKeypressCount();
    TestInput.updateLastKeypress();
    TestInput.pushKeypressWord(TestWords.words.currentIndex);
    if (config_1.default.difficulty !== "master" &&
        config_1.default.stopOnError == "letter" &&
        !thisCharCorrect) {
        return;
    }
    Replay.addReplayEvent(thisCharCorrect ? "correctLetter" : "incorrectLetter", char);
    //update the active word top, but only once
    if (TestInput.input.current.length === 1 &&
        TestWords.words.currentIndex === 0) {
        TestUI.setActiveWordTop((_a = document.querySelector("#words .active")) === null || _a === void 0 ? void 0 : _a.offsetTop);
    }
    //max length of the input is 20 unless in zen mode then its 30
    if ((config_1.default.mode === "zen" && charIndex < 30) ||
        (config_1.default.mode !== "zen" &&
            charIndex < TestWords.words.getCurrent().length + 20)) {
        TestInput.input.current = resultingWord;
    }
    if (!thisCharCorrect && config_1.default.difficulty == "master") {
        TestInput.input.pushHistory();
        TestInput.corrected.pushHistory();
        TestLogic.fail("difficulty");
        return;
    }
    //keymap
    if (config_1.default.keymapMode === "react") {
        Keymap.flashKey(char, thisCharCorrect);
    }
    if (config_1.default.mode != "zen") {
        //not applicable to zen mode
        //auto stop the test if the last word is correct
        const currentWord = TestWords.words.getCurrent();
        const lastindex = TestWords.words.currentIndex;
        if ((currentWord == TestInput.input.current ||
            (config_1.default.quickEnd &&
                currentWord.length == TestInput.input.current.length &&
                config_1.default.stopOnError == "off")) &&
            lastindex == TestWords.words.length - 1) {
            TestInput.input.pushHistory();
            TestInput.corrected.pushHistory();
            TestLogic.finish();
            return;
        }
    }
    const activeWordTopBeforeJump = (_b = document.querySelector("#words .word.active")) === null || _b === void 0 ? void 0 : _b.offsetTop;
    TestUI.updateWordElement();
    if (!config_1.default.hideExtraLetters) {
        const newActiveTop = (_c = document.querySelector("#words .word.active")) === null || _c === void 0 ? void 0 : _c.offsetTop;
        //stop the word jump by slicing off the last character, update word again
        if (activeWordTopBeforeJump < newActiveTop &&
            !TestUI.lineTransition &&
            TestInput.input.current.length > 1) {
            if (config_1.default.mode == "zen") {
                const currentTop = Math.floor((_d = document.querySelectorAll("#words .word")[TestUI.currentWordElementIndex - 1]) === null || _d === void 0 ? void 0 : _d.offsetTop);
                if (!config_1.default.showAllLines)
                    TestUI.lineJump(currentTop);
            }
            else {
                TestInput.input.current = TestInput.input.current.slice(0, -1);
                TestUI.updateWordElement();
            }
        }
    }
    //simulate space press in nospace funbox
    if (((config_1.default.funbox === "nospace" || config_1.default.funbox === "arrows") &&
        TestInput.input.current.length === TestWords.words.getCurrent().length) ||
        (char === "\n" && thisCharCorrect)) {
        handleSpace();
    }
    if (char !== "\n") {
        Caret.updatePosition();
    }
}
function handleTab(event, popupVisible) {
    //todo refactor this mess
    if (TestUI.resultCalculating) {
        event.preventDefault();
    }
    if (ActivePage.get() !== "test" && popupVisible) {
        // event.preventDefault();
        return;
    }
    if ($("#customTextPopup .textarea").is(":focus")) {
        event.preventDefault();
        const area = $("#customTextPopup .textarea")[0];
        const start = area.selectionStart;
        const end = area.selectionEnd;
        // set textarea value to: text before caret + tab + text after caret
        area.value =
            area.value.substring(0, start) + "\t" + area.value.substring(end);
        // put caret at right position again
        area.selectionStart = area.selectionEnd = start + 1;
        return;
    }
    else if (!TestUI.resultCalculating &&
        $("#commandLineWrapper").hasClass("hidden") &&
        $("#simplePopupWrapper").hasClass("hidden") &&
        $("#quoteSubmitPopupWrapper").hasClass("hidden") &&
        ActivePage.get() != "login") {
        if (ActivePage.get() == "test") {
            if (config_1.default.quickTab) {
                if (!$("#leaderboardsWrapper").hasClass("hidden")) {
                    Leaderboards.hide();
                }
                if (popupVisible) {
                    event.preventDefault();
                    return;
                }
                if (TestUI.resultVisible ||
                    !((config_1.default.mode == "zen" && !event.shiftKey) ||
                        (TestWords.hasTab && !event.shiftKey))) {
                    if (event.shiftKey) {
                        ManualRestart.set();
                    }
                    else {
                        ManualRestart.reset();
                    }
                    event.preventDefault();
                    if (TestActive.get() &&
                        config_1.default.repeatQuotes === "typing" &&
                        config_1.default.mode === "quote") {
                        TestLogic.restart(true, false, event);
                    }
                    else {
                        TestLogic.restart(false, false, event);
                    }
                }
                else {
                    event.preventDefault();
                    handleChar("\t", TestInput.input.current.length);
                    setWordsInput(" " + TestInput.input.current);
                }
            }
            else if (!TestUI.resultVisible) {
                if ((TestWords.hasTab && event.shiftKey) ||
                    (!TestWords.hasTab && config_1.default.mode !== "zen") ||
                    (config_1.default.mode === "zen" && event.shiftKey)) {
                    event.preventDefault();
                    $("#restartTestButton").trigger("focus");
                }
                else {
                    event.preventDefault();
                    handleChar("\t", TestInput.input.current.length);
                    setWordsInput(" " + TestInput.input.current);
                }
            }
        }
        else if (config_1.default.quickTab) {
            event.preventDefault();
            PageController.change("test");
        }
    }
}
$(document).keydown((event) => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    if (ActivePage.get() == "loading")
        return event.preventDefault();
    //autofocus
    const wordsFocused = $("#wordsInput").is(":focus");
    const pageTestActive = ActivePage.get() === "test";
    const commandLineVisible = !$("#commandLineWrapper").hasClass("hidden");
    const leaderboardsVisible = !$("#leaderboardsWrapper").hasClass("hidden");
    const popups = document.querySelectorAll(".popupWrapper");
    let popupVisible = false;
    for (const popup of popups) {
        if (!popup.classList.contains("hidden") === true) {
            popupVisible = true;
            break;
        }
    }
    const allowTyping = pageTestActive &&
        !commandLineVisible &&
        !leaderboardsVisible &&
        !popupVisible &&
        !TestUI.resultVisible &&
        (wordsFocused || event.key !== "Enter");
    if (allowTyping && !wordsFocused && event.key !== "Enter") {
        TestUI.focusWords();
        if (config_1.default.showOutOfFocusWarning) {
            event.preventDefault();
        }
    }
    //tab
    if ((event.key == "Tab" && !config_1.default.swapEscAndTab) ||
        (event.key == "Escape" && config_1.default.swapEscAndTab)) {
        handleTab(event, popupVisible);
    }
    if (!allowTyping)
        return;
    if (!((_a = event.originalEvent) === null || _a === void 0 ? void 0 : _a.isTrusted) || TestUI.testRestarting) {
        event.preventDefault();
        return;
    }
    if (TestInput.spacingDebug) {
        console.log("spacing debug", "keypress", event.key, "length", TestInput.keypressTimings.spacing.array.length);
    }
    TestInput.recordKeypressSpacing();
    TestInput.setKeypressDuration(performance.now());
    TestInput.setKeypressNotAfk();
    //blocking firefox from going back in history with backspace
    if (event.key === "Backspace") {
        Sound.playClick();
        const t = /INPUT|SELECT|TEXTAREA/i;
        if (!t.test(event.target.tagName)
        // if this breaks in the future, call mio and tell him to stop being lazy
        // (event.target as unknown as KeyboardEvent).disabled ||
        // (event.target as unknown as Element).readOnly
        ) {
            event.preventDefault();
        }
        if (config_1.default.confidenceMode === "max") {
            event.preventDefault();
            return;
        }
    }
    if (config_1.default.funbox !== "arrows" && /Arrow/i.test(event.key)) {
        event.preventDefault();
        return;
    }
    Monkey.type();
    if (event.key === "Backspace" && TestInput.input.current.length === 0) {
        backspaceToPrevious();
        if (TestInput.input.current) {
            setWordsInput(" " + TestInput.input.current + " ");
        }
    }
    if (event.key === "Enter") {
        if (event.shiftKey && config_1.default.mode == "zen") {
            TestLogic.finish();
        }
        else if (event.shiftKey &&
            ((config_1.default.mode == "time" && config_1.default.time === 0) ||
                (config_1.default.mode == "words" && config_1.default.words === 0))) {
            TestInput.setBailout(true);
            TestLogic.finish();
        }
        else {
            handleChar("\n", TestInput.input.current.length);
            setWordsInput(" " + TestInput.input.current);
        }
    }
    //show dead keys
    if (event.key === "Dead" &&
        !Misc.trailingComposeChars.test(TestInput.input.current)) {
        Sound.playClick();
        const word = document.querySelector("#words .word.active");
        const len = TestInput.input.current.length; // have to do this because prettier wraps the line and causes an error
        word === null || word === void 0 ? void 0 : word.querySelectorAll("letter")[len].classList.toggle("dead");
    }
    if (config_1.default.oppositeShiftMode !== "off") {
        correctShiftUsed =
            (yield ShiftTracker.isUsingOppositeShift(event)) !== false;
    }
    if (config_1.default.funbox === "arrows") {
        let char = event.key;
        if (["ArrowLeft", "ArrowUp", "ArrowRight", "ArrowDown"].includes(char)) {
            if (char === "ArrowLeft")
                char = "a";
            if (char === "ArrowRight")
                char = "d";
            if (char === "ArrowDown")
                char = "s";
            if (char === "ArrowUp")
                char = "w";
            event.preventDefault();
            handleChar(char, TestInput.input.current.length);
            updateUI();
            setWordsInput(" " + TestInput.input.current);
        }
    }
    else if (config_1.default.layout !== "default" &&
        !(event.ctrlKey ||
            (event.altKey && window.navigator.platform.search("Linux") > -1))) {
        const char = yield LayoutEmulator.getCharFromEvent(event);
        if (char !== null) {
            event.preventDefault();
            handleChar(char, TestInput.input.current.length);
            updateUI();
            setWordsInput(" " + TestInput.input.current);
        }
    }
}));
$("#wordsInput").keyup((event) => {
    var _a;
    if (!((_a = event.originalEvent) === null || _a === void 0 ? void 0 : _a.isTrusted) || TestUI.testRestarting) {
        event.preventDefault();
        return;
    }
    if (TestUI.resultVisible)
        return;
    const now = performance.now();
    if (TestInput.keypressTimings.duration.current !== -1) {
        const diff = Math.abs(TestInput.keypressTimings.duration.current - now);
        TestInput.pushKeypressDuration(diff);
    }
    TestInput.setKeypressDuration(now);
    Monkey.stop();
});
$("#wordsInput").on("beforeinput", (event) => {
    var _a;
    if (!((_a = event.originalEvent) === null || _a === void 0 ? void 0 : _a.isTrusted))
        return;
    if (event.target.value === "") {
        event.target.value = " ";
    }
});
$("#wordsInput").on("input", (event) => {
    var _a;
    if (!((_a = event.originalEvent) === null || _a === void 0 ? void 0 : _a.isTrusted) || TestUI.testRestarting) {
        event.target.value = " ";
        return;
    }
    TestInput.setKeypressNotAfk();
    const realInputValue = event.target.value.normalize();
    const inputValue = realInputValue.slice(1);
    // input will be modified even with the preventDefault() in
    // beforeinput/keydown if it's part of a compose sequence. this undoes
    // the effects of that and takes the input out of compose mode.
    if (config_1.default.layout !== "default" &&
        inputValue.length >= TestInput.input.current.length) {
        setWordsInput(" " + TestInput.input.current);
        return;
    }
    if (realInputValue.length === 0 && TestInput.input.current.length === 0) {
        // fallback for when no Backspace keydown event (mobile)
        backspaceToPrevious();
    }
    else if (inputValue.length < TestInput.input.current.length) {
        TestInput.input.current = inputValue;
        TestUI.updateWordElement();
        Caret.updatePosition();
        if (!Misc.trailingComposeChars.test(TestInput.input.current)) {
            Replay.addReplayEvent("setLetterIndex", TestInput.input.current.length);
        }
    }
    else if (inputValue !== TestInput.input.current) {
        let diffStart = 0;
        while (inputValue[diffStart] === TestInput.input.current[diffStart]) {
            diffStart++;
        }
        for (let i = diffStart; i < inputValue.length; i++) {
            handleChar(inputValue[i], i);
        }
    }
    setWordsInput(" " + TestInput.input.current);
    updateUI();
    // force caret at end of input
    // doing it on next cycle because Chromium on Android won't let me edit
    // the selection inside the input event
    setTimeout(() => {
        var _a;
        if (event.target.selectionStart !==
            event.target.value.length &&
            (!Misc.trailingComposeChars.test(event.target.value) ||
                ((_a = event.target.selectionStart) !== null && _a !== void 0 ? _a : 0) <
                    event.target.value.search(Misc.trailingComposeChars))) {
            event.target.selectionStart = event.target.selectionEnd = event.target.value.length;
        }
    }, 0);
});
$("#wordsInput").on("focus", (event) => {
    event.target.selectionStart = event.target.selectionEnd = event.target.value.length;
});
$("#wordsInput").on("copy paste", (event) => {
    event.preventDefault();
});


/***/ }),

/***/ "./src/scripts/controllers/page-controller.ts":
/*!****************************************************!*\
  !*** ./src/scripts/controllers/page-controller.ts ***!
  \****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.change = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const Account = __importStar(__webpack_require__(/*! ../pages/account */ "./src/scripts/pages/account.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const PageTest = __importStar(__webpack_require__(/*! ../pages/test */ "./src/scripts/pages/test.ts"));
const PageAbout = __importStar(__webpack_require__(/*! ../pages/about */ "./src/scripts/pages/about.ts"));
const PageChangeEvent = __importStar(__webpack_require__(/*! ../observables/page-change-event */ "./src/scripts/observables/page-change-event.ts"));
const PageLogin = __importStar(__webpack_require__(/*! ../pages/login */ "./src/scripts/pages/login.ts"));
const PageLoading = __importStar(__webpack_require__(/*! ../pages/loading */ "./src/scripts/pages/loading.ts"));
const PageTransition = __importStar(__webpack_require__(/*! ../states/page-transition */ "./src/scripts/states/page-transition.ts"));
function change(page) {
    if (PageTransition.get()) {
        console.log(`change page ${page} stopped`);
        return;
    }
    console.log(`change page ${page}`);
    if (page === "")
        page = "test";
    if (page == undefined) {
        //use window loacation
        const pages = {
            "/": "test",
            "/login": "login",
            "/settings": "settings",
            "/about": "about",
            "/account": "account",
        };
        let path = pages[window.location.pathname];
        if (!path) {
            path = "test";
        }
        page = path;
    }
    if (ActivePage.get() === page) {
        console.log(`page ${page} already active`);
        return;
    }
    const pages = {
        loading: PageLoading.page,
        test: PageTest.page,
        settings: Settings.page,
        about: PageAbout.page,
        account: Account.page,
        login: PageLogin.page,
    };
    const previousPage = pages[ActivePage.get()];
    const nextPage = pages[page];
    previousPage === null || previousPage === void 0 ? void 0 : previousPage.beforeHide();
    PageTransition.set(true);
    ActivePage.set(undefined);
    $(".page").removeClass("active");
    Misc.swapElements(previousPage.element, nextPage.element, 250, () => {
        PageTransition.set(false);
        ActivePage.set(nextPage.name);
        previousPage === null || previousPage === void 0 ? void 0 : previousPage.afterHide();
        nextPage.element.addClass("active");
        history.pushState(nextPage.pathname, "", nextPage.pathname);
        nextPage === null || nextPage === void 0 ? void 0 : nextPage.afterShow();
    }, () => __awaiter(this, void 0, void 0, function* () {
        yield (nextPage === null || nextPage === void 0 ? void 0 : nextPage.beforeShow());
    }));
    PageChangeEvent.dispatch(previousPage, nextPage);
}
exports.change = change;
$(document).on("click", "#top .logo", () => {
    change("test");
});
$(document).on("click", "#top #menu .icon-button", (e) => {
    if (!$(e.currentTarget).hasClass("leaderboards")) {
        const href = $(e.currentTarget).attr("href");
        ManualRestart.set();
        change(href.replace("/", ""));
    }
    return false;
});
$(".pageTest .loginTip .link").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    change("login");
}));


/***/ }),

/***/ "./src/scripts/controllers/preset-controller.ts":
/*!******************************************************!*\
  !*** ./src/scripts/controllers/preset-controller.ts ***!
  \******************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.apply = void 0;
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const TagController = __importStar(__webpack_require__(/*! ./tag-controller */ "./src/scripts/controllers/tag-controller.ts"));
function apply(_id) {
    var _a;
    // console.log(DB.getSnapshot().presets);
    const snapshot = DB.getSnapshot();
    (_a = snapshot.presets) === null || _a === void 0 ? void 0 : _a.forEach((preset) => {
        if (preset._id == _id) {
            UpdateConfig.apply(preset.config);
            TagController.clear(true);
            if (preset.config.tags) {
                preset.config.tags.forEach((tagid) => {
                    TagController.set(tagid, true, false);
                });
            }
            TestLogic.restart();
            Notifications.add("Preset applied", 1, 2);
            UpdateConfig.saveFullConfigToLocalStorage();
        }
    });
}
exports.apply = apply;


/***/ }),

/***/ "./src/scripts/controllers/quotes-controller.ts":
/*!******************************************************!*\
  !*** ./src/scripts/controllers/quotes-controller.ts ***!
  \******************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
const config_event_1 = __webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts");
const defaultQuoteCollection = {
    quotes: [],
    length: 0,
    language: null,
    groups: [],
};
class QuotesController {
    constructor() {
        this.quoteCollection = defaultQuoteCollection;
        this.quoteQueue = [];
        this.queueIndex = 0;
    }
    getQuotes(language, quoteLengths) {
        return __awaiter(this, void 0, void 0, function* () {
            const normalizedLanguage = language.replace(/_\d*k$/g, "");
            if (this.quoteCollection.language !== normalizedLanguage) {
                try {
                    const data = yield $.getJSON(`quotes/${normalizedLanguage}.json`);
                    if (data.quotes === undefined || data.quotes.length === 0) {
                        return defaultQuoteCollection;
                    }
                    this.quoteCollection = {
                        quotes: [],
                        length: data.quotes.length,
                        groups: [],
                        language: data.language,
                    };
                    // Transform JSON Quote schema to MonkeyTypes Quote schema
                    data.quotes.forEach((quote) => {
                        const monkeyTypeQuote = {
                            text: quote.text,
                            source: quote.source,
                            length: quote.length,
                            id: quote.id,
                            language: data.language,
                            group: 0,
                        };
                        this.quoteCollection.quotes.push(monkeyTypeQuote);
                    });
                    data.groups.forEach((quoteGroup, groupIndex) => {
                        const lower = quoteGroup[0];
                        const upper = quoteGroup[1];
                        this.quoteCollection.groups[groupIndex] =
                            this.quoteCollection.quotes.filter((quote) => {
                                if (quote.length >= lower && quote.length <= upper) {
                                    quote.group = groupIndex;
                                    return true;
                                }
                                return false;
                            });
                    });
                    if (quoteLengths !== undefined) {
                        this.updateQuoteQueue(quoteLengths);
                    }
                }
                catch (_a) {
                    return defaultQuoteCollection;
                }
            }
            return this.quoteCollection;
        });
    }
    getQuoteById(id) {
        const targetQuote = this.quoteCollection.quotes.find((quote) => {
            return quote.id === id;
        });
        return targetQuote;
    }
    updateQuoteQueue(quoteGroups) {
        this.quoteQueue = [];
        quoteGroups.forEach((group) => {
            var _a;
            if (group < 0) {
                return;
            }
            (_a = this.quoteCollection.groups[group]) === null || _a === void 0 ? void 0 : _a.forEach((quote) => {
                this.quoteQueue.push(quote);
            });
        });
        (0, misc_1.shuffle)(this.quoteQueue);
        this.queueIndex = 0;
    }
    getRandomQuote() {
        if (this.quoteQueue.length === 0) {
            return null;
        }
        if (this.queueIndex >= this.quoteQueue.length) {
            this.queueIndex = 0;
            (0, misc_1.shuffle)(this.quoteQueue);
        }
        const randomQuote = this.quoteQueue[this.queueIndex];
        this.queueIndex += 1;
        return randomQuote;
    }
    getCurrentQuote() {
        if (this.quoteQueue.length === 0) {
            return null;
        }
        return this.quoteQueue[this.queueIndex];
    }
}
const quoteController = new QuotesController();
(0, config_event_1.subscribe)((key, newValue) => {
    if (key === "quoteLength") {
        quoteController.updateQuoteQueue(newValue);
    }
});
exports["default"] = quoteController;


/***/ }),

/***/ "./src/scripts/controllers/route-controller.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/controllers/route-controller.ts ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.handleInitialPageClasses = void 0;
// import * as Funbox from "../test/funbox";
const PageController = __importStar(__webpack_require__(/*! ./page-controller */ "./src/scripts/controllers/page-controller.ts"));
// import Config from "../config";
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const mappedRoutes = {
    "/": "pageLoading",
    "/login": "pageLoading",
    "/settings": "pageLoading",
    "/about": "pageLoading",
    "/account": "pageAccount",
    "/verify": "pageLoading",
};
function handleInitialPageClasses(pathname) {
    if (!mappedRoutes[pathname]) {
        pathname = "/";
    }
    const el = $(".page." + mappedRoutes[pathname]);
    $(el).removeClass("hidden");
    $(el).addClass("active");
    let pageName = "loading";
    if (pathname === "/account")
        pageName = "account";
    ActivePage.set(pageName);
}
exports.handleInitialPageClasses = handleInitialPageClasses;
// honestly im not sure what this does
// (function (history): void {
//   const pushState = history.pushState;
//   history.pushState = function (state): void {
//     if (Config.funbox === "memory" && state !== "/") {
//       Funbox.resetMemoryTimer();
//     }
//     // @ts-ignore
//     return pushState.apply(history, arguments);
//   };
// })(window.history);
$(window).on("popstate", (e) => {
    const state = e.originalEvent.state;
    if (state == "" || state == "/") {
        // show test
        PageController.change("test");
    }
    else if (state == "about") {
        // show about
        PageController.change("about");
    }
    else if (state == "account" || state == "login") {
        if (firebase_1.Auth.currentUser) {
            PageController.change("account");
        }
        else {
            PageController.change("login");
        }
    }
});


/***/ }),

/***/ "./src/scripts/controllers/sound-controller.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/controllers/sound-controller.ts ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.setVolume = exports.playError = exports.playClick = exports.previewClick = exports.init = exports.initErrorSound = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const howler_1 = __importStar(__webpack_require__(/*! howler */ "./node_modules/howler/dist/howler.js"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
let errorSound = null;
let clickSounds = null;
function initErrorSound() {
    if (errorSound !== null)
        return;
    errorSound = new howler_1.Howl({ src: ["../sound/error.wav"] });
}
exports.initErrorSound = initErrorSound;
function init() {
    if (clickSounds !== null)
        return;
    clickSounds = {
        1: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click1/click1_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click1/click1_1.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click1/click1_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click1/click1_2.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click1/click1_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click1/click1_3.wav" }),
                ],
                counter: 0,
            },
        ],
        2: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click2/click2_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click2/click2_1.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click2/click2_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click2/click2_2.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click2/click2_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click2/click2_3.wav" }),
                ],
                counter: 0,
            },
        ],
        3: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click3/click3_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click3/click3_1.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click3/click3_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click3/click3_2.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click3/click3_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click3/click3_3.wav" }),
                ],
                counter: 0,
            },
        ],
        4: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_11.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_22.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_33.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_4.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_44.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_5.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_55.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_6.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_66.wav" }),
                ],
                counter: 0,
            },
        ],
        5: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_11.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_22.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_33.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_4.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_44.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_5.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_55.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_6.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_66.wav" }),
                ],
                counter: 0,
            },
        ],
        6: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click6/click6_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click6/click6_11.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click6/click6_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click6/click6_22.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click6/click6_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click6/click6_33.wav" }),
                ],
                counter: 0,
            },
        ],
        7: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click7/click7_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click7/click7_11.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click7/click7_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click7/click7_22.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click7/click7_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click7/click7_33.wav" }),
                ],
                counter: 0,
            },
        ],
    };
}
exports.init = init;
function previewClick(val) {
    if (clickSounds === null)
        init();
    clickSounds[val][0].sounds[0].seek(0);
    clickSounds[val][0].sounds[0].play();
}
exports.previewClick = previewClick;
function playClick() {
    if (config_1.default.playSoundOnClick === "off")
        return;
    if (clickSounds === null)
        init();
    const randomSound = (0, misc_1.randomElementFromArray)(clickSounds[config_1.default.playSoundOnClick]);
    randomSound.counter++;
    if (randomSound.counter === 2)
        randomSound.counter = 0;
    randomSound.sounds[randomSound.counter].seek(0);
    randomSound.sounds[randomSound.counter].play();
}
exports.playClick = playClick;
function playError() {
    if (!config_1.default.playSoundOnError)
        return;
    if (errorSound === null)
        initErrorSound();
    errorSound.seek(0);
    errorSound.play();
}
exports.playError = playError;
function setVolume(val) {
    // not sure why it complains but it works
    // @ts-ignore
    howler_1.default.Howler.volume(val);
}
exports.setVolume = setVolume;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "playSoundOnClick" && eventValue !== "off")
        init();
    if (eventKey === "soundVolume")
        setVolume(eventValue);
});


/***/ }),

/***/ "./src/scripts/controllers/tag-controller.ts":
/*!***************************************************!*\
  !*** ./src/scripts/controllers/tag-controller.ts ***!
  \***************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.loadActiveFromLocalStorage = exports.toggle = exports.set = exports.clear = exports.saveActiveToLocalStorage = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const ModesNotice = __importStar(__webpack_require__(/*! ../elements/modes-notice */ "./src/scripts/elements/modes-notice.ts"));
function saveActiveToLocalStorage() {
    var _a;
    const tags = [];
    try {
        (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
            if (tag.active === true) {
                tags.push(tag._id);
            }
        });
        window.localStorage.setItem("activeTags", JSON.stringify(tags));
    }
    catch (e) { }
}
exports.saveActiveToLocalStorage = saveActiveToLocalStorage;
function clear(nosave = false) {
    var _a;
    const snapshot = DB.getSnapshot();
    snapshot.tags = (_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.map((tag) => {
        tag.active = false;
        return tag;
    });
    DB.setSnapshot(snapshot);
    ModesNotice.update();
    if (!nosave)
        saveActiveToLocalStorage();
}
exports.clear = clear;
function set(tagid, state, nosave = false) {
    var _a;
    const snapshot = DB.getSnapshot();
    snapshot.tags = (_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.map((tag) => {
        if (tag._id === tagid) {
            tag.active = state;
        }
        return tag;
    });
    DB.setSnapshot(snapshot);
    ModesNotice.update();
    if (!nosave)
        saveActiveToLocalStorage();
}
exports.set = set;
function toggle(tagid, nosave = false) {
    var _a;
    (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
        if (tag._id === tagid) {
            if (tag.active === undefined) {
                tag.active = true;
            }
            else {
                tag.active = !tag.active;
            }
        }
    });
    ModesNotice.update();
    if (!nosave)
        saveActiveToLocalStorage();
}
exports.toggle = toggle;
function loadActiveFromLocalStorage() {
    var _a;
    let newTags = window.localStorage.getItem("activeTags");
    if (newTags != undefined && newTags !== "") {
        try {
            newTags = (_a = JSON.parse(newTags)) !== null && _a !== void 0 ? _a : [];
        }
        catch (e) {
            newTags = [];
        }
        newTags.forEach((ntag) => {
            toggle(ntag, true);
        });
        saveActiveToLocalStorage();
    }
}
exports.loadActiveFromLocalStorage = loadActiveFromLocalStorage;


/***/ }),

/***/ "./src/scripts/controllers/theme-controller.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/controllers/theme-controller.ts ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.applyCustomBackground = exports.applyCustomBackgroundSize = exports.clearRandom = exports.randomizeTheme = exports.clearPreview = exports.set = exports.preview = exports.colorVars = exports.randomTheme = void 0;
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const ChartController = __importStar(__webpack_require__(/*! ./chart-controller */ "./src/scripts/controllers/chart-controller.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const BackgroundFilter = __importStar(__webpack_require__(/*! ../elements/custom-background-filter */ "./src/scripts/elements/custom-background-filter.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const AnalyticsController = __importStar(__webpack_require__(/*! ../controllers/analytics-controller */ "./src/scripts/controllers/analytics-controller.ts"));
let isPreviewingTheme = false;
exports.randomTheme = null;
exports.colorVars = [
    "--bg-color",
    "--main-color",
    "--caret-color",
    "--sub-color",
    "--text-color",
    "--error-color",
    "--error-extra-color",
    "--colorful-error-color",
    "--colorful-error-extra-color",
];
function updateFavicon(size, curveSize) {
    return __awaiter(this, void 0, void 0, function* () {
        setTimeout(() => __awaiter(this, void 0, void 0, function* () {
            let maincolor, bgcolor;
            bgcolor = yield ThemeColors.get("bg");
            maincolor = yield ThemeColors.get("main");
            if (window.location.hostname === "localhost") {
                const swap = maincolor;
                maincolor = bgcolor;
                bgcolor = swap;
            }
            if (bgcolor == maincolor) {
                bgcolor = "#111";
                maincolor = "#eee";
            }
            const canvas = document.createElement("canvas");
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext("2d");
            ctx.beginPath();
            ctx.moveTo(0, curveSize);
            //top left
            ctx.quadraticCurveTo(0, 0, curveSize, 0);
            ctx.lineTo(size - curveSize, 0);
            //top right
            ctx.quadraticCurveTo(size, 0, size, curveSize);
            ctx.lineTo(size, size - curveSize);
            ctx.quadraticCurveTo(size, size, size - curveSize, size);
            ctx.lineTo(curveSize, size);
            ctx.quadraticCurveTo(0, size, 0, size - curveSize);
            ctx.fillStyle = bgcolor;
            ctx.fill();
            ctx.font = "900 " + (size / 2) * 1.2 + "px Lexend Deca";
            ctx.textAlign = "center";
            ctx.fillStyle = maincolor;
            ctx.fillText("mt", size / 2 + 1, (size / 3) * 2.1);
            // $("body").prepend(canvas);
            $("#favicon").attr("href", canvas.toDataURL("image/png"));
        }), 125);
    });
}
function clearCustomTheme() {
    exports.colorVars.forEach((e) => {
        document.documentElement.style.setProperty(e, "");
    });
}
const loadStyle = function (name) {
    return __awaiter(this, void 0, void 0, function* () {
        return new Promise((resolve) => {
            const link = document.createElement("link");
            link.type = "text/css";
            link.rel = "stylesheet";
            link.id = "currentTheme";
            link.onload = () => {
                resolve();
            };
            if (name === "custom") {
                link.href = `themes/serika_dark.css`;
            }
            else {
                link.href = `themes/${name}.css`;
            }
            const headScript = document.querySelector("#currentTheme");
            headScript.replaceWith(link);
        });
    });
};
// export function changeCustomTheme(themeId: string, nosave = false): void {
//   const customThemes = DB.getSnapshot().customThemes;
//   const colors = customThemes.find((e) => e._id === themeId)
//     ?.colors as string[];
//   UpdateConfig.setCustomThemeColors(colors, nosave);
// }
function apply(themeName, isCustom, isPreview = false) {
    clearCustomTheme();
    let name = "serika_dark";
    if (!isCustom) {
        name = themeName;
    }
    else {
        name = "custom";
    }
    ThemeColors.reset();
    $(".keymap-key").attr("style", "");
    // $("#currentTheme").attr("href", `themes/${name}.css`);
    loadStyle(name).then(() => {
        var _a, _b;
        ThemeColors.update();
        if (isCustom) {
            let colorValues = config_1.default.customThemeColors;
            const snapshot = DB.getSnapshot();
            if (isCustom && !isPreview && snapshot) {
                const customColors = (_b = (_a = snapshot.customThemes.find((e) => e._id === themeName)) === null || _a === void 0 ? void 0 : _a.colors) !== null && _b !== void 0 ? _b : [];
                if (customColors.length > 0) {
                    UpdateConfig.setCustomThemeColors(customColors);
                }
            }
            if (themeName !== "custom" && snapshot) {
                const customThemes = snapshot.customThemes;
                const customThemeById = customThemes.find((e) => e._id === themeName);
                colorValues = customThemeById === null || customThemeById === void 0 ? void 0 : customThemeById.colors;
            }
            exports.colorVars.forEach((e, index) => {
                document.documentElement.style.setProperty(e, colorValues[index]);
            });
        }
        AnalyticsController.log("changedTheme", { theme: themeName });
        if (!isPreview) {
            ThemeColors.getAll().then((colors) => {
                $(".keymap-key").attr("style", "");
                ChartController.updateAllChartColors();
                updateFavicon(128, 32);
                $("#metaThemeColor").attr("content", colors.bg);
            });
        }
        $(".current-theme .text").text(isCustom ? "custom" : themeName.replace(/_/g, " "));
    });
}
function preview(themeIdentifier, isCustom, randomTheme = false) {
    isPreviewingTheme = true;
    apply(themeIdentifier, isCustom, !randomTheme);
}
exports.preview = preview;
function set(themeIdentifier, isCustom) {
    apply(themeIdentifier, isCustom);
}
exports.set = set;
function clearPreview() {
    if (isPreviewingTheme) {
        isPreviewingTheme = false;
        exports.randomTheme = null;
        if (config_1.default.customTheme) {
            apply("custom", true);
        }
        else {
            apply(config_1.default.theme, false);
        }
    }
}
exports.clearPreview = clearPreview;
function randomizeTheme() {
    let randomList;
    Misc.getThemesList().then((themes) => {
        var _a, _b;
        if (config_1.default.randomTheme === "fav" && config_1.default.favThemes.length > 0) {
            randomList = config_1.default.favThemes;
        }
        else if (config_1.default.randomTheme === "light") {
            randomList = themes
                .filter((t) => Misc.isColorLight(t.bgColor))
                .map((t) => t.name);
        }
        else if (config_1.default.randomTheme === "dark") {
            randomList = themes
                .filter((t) => Misc.isColorDark(t.bgColor))
                .map((t) => t.name);
        }
        else if (config_1.default.randomTheme === "on") {
            randomList = themes.map((t) => {
                return t.name;
            });
        }
        else {
            randomList = DB.getSnapshot().customThemes.map((ct) => ct._id);
        }
        const previousTheme = exports.randomTheme;
        exports.randomTheme = Misc.randomElementFromArray(randomList);
        // if (Config.randomTheme === "custom") {
        // changeCustomTheme(randomTheme, true);
        // } else {
        preview(exports.randomTheme, config_1.default.randomTheme === "custom");
        // }
        if (previousTheme != exports.randomTheme) {
            let name = exports.randomTheme.replace(/_/g, " ");
            if (config_1.default.randomTheme === "custom") {
                name = ((_b = (_a = DB.getSnapshot().customThemes.find((ct) => ct._id === exports.randomTheme)) === null || _a === void 0 ? void 0 : _a.name) !== null && _b !== void 0 ? _b : "custom").replace(/_/g, " ");
            }
            Notifications.add(name, 0);
        }
    });
}
exports.randomizeTheme = randomizeTheme;
function clearRandom() {
    if (exports.randomTheme === null)
        return;
    exports.randomTheme = null;
    if (config_1.default.customTheme) {
        apply("custom", true);
    }
    else {
        apply(config_1.default.theme, false);
    }
}
exports.clearRandom = clearRandom;
function applyCustomBackgroundSize() {
    if (config_1.default.customBackgroundSize == "max") {
        $(".customBackground img").css({
            // width: "calc(100%)",
            // height: "calc(100%)",
            objectFit: "",
        });
    }
    else {
        $(".customBackground img").css({
            objectFit: config_1.default.customBackgroundSize,
        });
    }
}
exports.applyCustomBackgroundSize = applyCustomBackgroundSize;
function applyCustomBackground() {
    // $(".customBackground").css({
    //   backgroundImage: `url(${Config.customBackground})`,
    //   backgroundAttachment: "fixed",
    // });
    if (config_1.default.customBackground === "") {
        $("#words").removeClass("noErrorBorder");
        $("#resultWordsHistory").removeClass("noErrorBorder");
        $(".customBackground img").remove();
    }
    else {
        $("#words").addClass("noErrorBorder");
        $("#resultWordsHistory").addClass("noErrorBorder");
        $(".customBackground").html(`<img src="${config_1.default.customBackground}" />`);
        BackgroundFilter.apply();
        applyCustomBackgroundSize();
    }
}
exports.applyCustomBackground = applyCustomBackground;
(_b = (_a = window
    .matchMedia) === null || _a === void 0 ? void 0 : _a.call(window, "(prefers-color-scheme: dark)")) === null || _b === void 0 ? void 0 : _b.addEventListener("change", (event) => {
    if (!config_1.default.autoSwitchTheme || config_1.default.customTheme)
        return;
    if (event.matches) {
        set(config_1.default.themeDark, false);
    }
    else {
        set(config_1.default.themeLight, false);
    }
});
ConfigEvent.subscribe((eventKey, eventValue, nosave) => {
    if (eventKey === "customTheme") {
        eventValue ? set("custom", true) : set(config_1.default.theme, false);
    }
    if (eventKey === "customThemeColors") {
        nosave ? preview("custom", true) : set("custom", true);
    }
    if (eventKey === "theme") {
        clearPreview();
        set(eventValue, false);
    }
    if (eventKey === "setThemes") {
        clearPreview();
        if (eventValue) {
            set("custom", true);
        }
        else {
            if (config_1.default.autoSwitchTheme) {
                if (window.matchMedia &&
                    window.matchMedia("(prefers-color-scheme: dark)").matches) {
                    set(config_1.default.themeDark, false);
                }
                else {
                    set(config_1.default.themeLight, false);
                }
            }
            else {
                set(config_1.default.theme, false);
            }
        }
    }
    if (eventKey === "randomTheme" && eventValue === "off")
        clearRandom();
    if (eventKey === "customBackground")
        applyCustomBackground();
    if (eventKey === "customBackgroundSize")
        applyCustomBackgroundSize();
    if (eventKey === "autoSwitchTheme") {
        if (eventValue) {
            if (window.matchMedia &&
                window.matchMedia("(prefers-color-scheme: dark)").matches) {
                set(config_1.default.themeDark, false);
            }
            else {
                set(config_1.default.themeLight, false);
            }
        }
        else {
            set(config_1.default.theme, false);
        }
    }
    if (eventKey === "themeLight" &&
        config_1.default.autoSwitchTheme &&
        !(window.matchMedia &&
            window.matchMedia("(prefers-color-scheme: dark)").matches) &&
        !nosave) {
        set(config_1.default.themeLight, false);
    }
    if (eventKey === "themeDark" &&
        config_1.default.autoSwitchTheme &&
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches &&
        !nosave) {
        set(config_1.default.themeDark, false);
    }
});


/***/ }),

/***/ "./src/scripts/controllers/verification-controller.ts":
/*!************************************************************!*\
  !*** ./src/scripts/controllers/verification-controller.ts ***!
  \************************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.verify = exports.set = exports.data = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
exports.data = null;
function set(val) {
    exports.data = val;
}
exports.set = set;
function verify(uid) {
    return __awaiter(this, void 0, void 0, function* () {
        if (exports.data === null)
            return;
        Notifications.add("Linking Discord account", 0, 3);
        Loader.show();
        exports.data.uid = uid;
        const response = yield ape_1.default.users.linkDiscord(exports.data);
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to link Discord: " + response.message, -1);
        }
        Notifications.add("Accounts linked", 1);
        const snapshot = DB.getSnapshot();
        snapshot.discordId = response.data.did;
        DB.setSnapshot(snapshot);
        Settings.updateDiscordSection();
    });
}
exports.verify = verify;


/***/ }),

/***/ "./src/scripts/db.ts":
/*!***************************!*\
  !*** ./src/scripts/db.ts ***!
  \***************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateLocalStats = exports.saveLocalResult = exports.saveConfig = exports.updateLbMemory = exports.saveLocalTagPB = exports.getLocalTagPB = exports.saveLocalPB = exports.getLocalPB = exports.getUserAverage10 = exports.getUserHighestWpm = exports.deleteCustomTheme = exports.editCustomTheme = exports.addCustomTheme = exports.getCustomThemeById = exports.getUserResults = exports.initSnapshot = exports.setSnapshot = exports.getSnapshot = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ./ape */ "./src/scripts/ape/index.ts"));
const AccountButton = __importStar(__webpack_require__(/*! ./elements/account-button */ "./src/scripts/elements/account-button.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./elements/notifications */ "./src/scripts/elements/notifications.ts"));
const LoadingPage = __importStar(__webpack_require__(/*! ./pages/loading */ "./src/scripts/pages/loading.ts"));
const default_config_1 = __importDefault(__webpack_require__(/*! ./constants/default-config */ "./src/scripts/constants/default-config.ts"));
const firebase_1 = __webpack_require__(/*! ./firebase */ "./src/scripts/firebase.ts");
const default_snapshot_1 = __webpack_require__(/*! ./constants/default-snapshot */ "./src/scripts/constants/default-snapshot.ts");
let dbSnapshot;
function getSnapshot() {
    return dbSnapshot;
}
exports.getSnapshot = getSnapshot;
function setSnapshot(newSnapshot) {
    try {
        delete newSnapshot.banned;
    }
    catch (_a) { }
    try {
        delete newSnapshot.verified;
    }
    catch (_b) { }
    dbSnapshot = newSnapshot;
}
exports.setSnapshot = setSnapshot;
function initSnapshot() {
    var _a, _b, _c, _d, _e;
    return __awaiter(this, void 0, void 0, function* () {
        //send api request with token that returns tags, presets, and data needed for snap
        const snap = default_snapshot_1.defaultSnap;
        try {
            if (firebase_1.Auth.currentUser == null)
                return false;
            // if (ActivePage.get() == "loading") {
            //   LoadingPage.updateBar(22.5);
            // } else {
            //   LoadingPage.updateBar(16);
            // }
            // LoadingPage.updateText("Downloading user...");
            const [userResponse, configResponse, tagsResponse, presetsResponse] = yield Promise.all([
                ape_1.default.users.getData(),
                ape_1.default.configs.get(),
                ape_1.default.users.getTags(),
                ape_1.default.presets.get(),
            ]);
            if (userResponse.status !== 200) {
                throw {
                    message: `${userResponse.message} (user)`,
                    responseCode: userResponse.status,
                };
            }
            if (configResponse.status !== 200) {
                throw {
                    message: `${configResponse.message} (config)`,
                    responseCode: configResponse.status,
                };
            }
            if (tagsResponse.status !== 200) {
                throw {
                    message: `${tagsResponse.message} (tags)`,
                    responseCode: tagsResponse.status,
                };
            }
            if (presetsResponse.status !== 200) {
                throw {
                    message: `${presetsResponse.message} (presets)`,
                    responseCode: presetsResponse.status,
                };
            }
            const [userData, configData, tagsData, presetsData] = [
                userResponse,
                configResponse,
                tagsResponse,
                presetsResponse,
            ].map((response) => response.data);
            snap.name = userData.name;
            snap.personalBests = userData.personalBests;
            snap.banned = userData.banned;
            snap.verified = userData.verified;
            snap.discordId = userData.discordId;
            snap.globalStats = {
                time: userData.timeTyping,
                started: userData.startedTests,
                completed: userData.completedTests,
            };
            if (userData.quoteMod === true)
                snap.quoteMod = true;
            snap.quoteRatings = userData.quoteRatings;
            snap.favouriteThemes =
                userData.favouriteThemes === undefined ? [] : userData.favouriteThemes;
            if (((_a = userData.lbMemory) === null || _a === void 0 ? void 0 : _a.time15) || ((_b = userData.lbMemory) === null || _b === void 0 ? void 0 : _b.time60)) {
                //old memory format
                snap.lbMemory = {};
            }
            else if (userData.lbMemory) {
                snap.lbMemory = userData.lbMemory;
            }
            // if (ActivePage.get() == "loading") {
            //   LoadingPage.updateBar(45);
            // } else {
            //   LoadingPage.updateBar(32);
            // }
            // LoadingPage.updateText("Downloading config...");
            if (configData) {
                const newConfig = Object.assign({}, default_config_1.default);
                for (const key in configData.config) {
                    const value = configData.config[key];
                    newConfig[key] = value;
                }
                snap.config = newConfig;
            }
            // if (ActivePage.get() == "loading") {
            //   LoadingPage.updateBar(67.5);
            // } else {
            //   LoadingPage.updateBar(48);
            // }
            // LoadingPage.updateText("Downloading tags...");
            snap.customThemes = (_c = userData.customThemes) !== null && _c !== void 0 ? _c : [];
            snap.tags = tagsData;
            snap.tags = (_d = snap.tags) === null || _d === void 0 ? void 0 : _d.sort((a, b) => {
                if (a.name > b.name) {
                    return 1;
                }
                else if (a.name < b.name) {
                    return -1;
                }
                else {
                    return 0;
                }
            });
            // if (ActivePage.get() == "loading") {
            //   LoadingPage.updateBar(90);
            // } else {
            //   LoadingPage.updateBar(64);
            // }
            // LoadingPage.updateText("Downloading presets...");
            snap.presets = presetsData;
            snap.presets = (_e = snap.presets) === null || _e === void 0 ? void 0 : _e.sort((a, b) => {
                if (a.name > b.name) {
                    return 1;
                }
                else if (a.name < b.name) {
                    return -1;
                }
                else {
                    return 0;
                }
            });
            dbSnapshot = snap;
            return dbSnapshot;
        }
        catch (e) {
            dbSnapshot = default_snapshot_1.defaultSnap;
            throw e;
        }
    });
}
exports.initSnapshot = initSnapshot;
function getUserResults() {
    return __awaiter(this, void 0, void 0, function* () {
        const user = firebase_1.Auth.currentUser;
        if (user == null)
            return false;
        if (dbSnapshot === null)
            return false;
        if (dbSnapshot.results !== undefined) {
            return true;
        }
        else {
            LoadingPage.updateText("Downloading results...");
            LoadingPage.updateBar(90);
            const response = yield ape_1.default.results.get();
            if (response.status !== 200) {
                Notifications.add("Error getting results: " + response.message, -1);
                return false;
            }
            const results = response.data;
            results.forEach((result) => {
                if (result.bailedOut === undefined)
                    result.bailedOut = false;
                if (result.blindMode === undefined)
                    result.blindMode = false;
                if (result.lazyMode === undefined)
                    result.lazyMode = false;
                if (result.difficulty === undefined)
                    result.difficulty = "normal";
                if (result.funbox === undefined)
                    result.funbox = "none";
                if (result.language === undefined || result.language === null) {
                    result.language = "english";
                }
                if (result.numbers === undefined)
                    result.numbers = false;
                if (result.punctuation === undefined)
                    result.punctuation = false;
            });
            dbSnapshot.results = results === null || results === void 0 ? void 0 : results.sort((a, b) => b.timestamp - a.timestamp);
            return true;
        }
    });
}
exports.getUserResults = getUserResults;
function getCustomThemeById(themeID) {
    return dbSnapshot.customThemes.find((t) => t._id === themeID);
}
exports.getCustomThemeById = getCustomThemeById;
function addCustomTheme(theme) {
    return __awaiter(this, void 0, void 0, function* () {
        if (dbSnapshot === null)
            return false;
        if (dbSnapshot.customThemes.length >= 10) {
            Notifications.add("Too many custom themes!", 0);
            return false;
        }
        const response = yield ape_1.default.users.addCustomTheme(theme);
        if (response.status !== 200) {
            Notifications.add("Error adding custom theme: " + response.message, -1);
            return false;
        }
        const newCustomTheme = Object.assign(Object.assign({}, theme), { _id: response.data.theme._id });
        dbSnapshot.customThemes.push(newCustomTheme);
        return true;
    });
}
exports.addCustomTheme = addCustomTheme;
function editCustomTheme(themeId, newTheme) {
    return __awaiter(this, void 0, void 0, function* () {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return false;
        if (dbSnapshot === null)
            return false;
        const customTheme = dbSnapshot.customThemes.find((t) => t._id === themeId);
        if (!customTheme) {
            Notifications.add("Editing failed: Custom theme with id: " + themeId + " does not exist", -1);
            return false;
        }
        const response = yield ape_1.default.users.editCustomTheme(themeId, newTheme);
        if (response.status !== 200) {
            Notifications.add("Error editing custom theme: " + response.message, -1);
            return false;
        }
        const newCustomTheme = Object.assign(Object.assign({}, newTheme), { _id: themeId });
        dbSnapshot.customThemes[dbSnapshot.customThemes.indexOf(customTheme)] =
            newCustomTheme;
        return true;
    });
}
exports.editCustomTheme = editCustomTheme;
function deleteCustomTheme(themeId) {
    return __awaiter(this, void 0, void 0, function* () {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return false;
        if (dbSnapshot === null)
            return false;
        const customTheme = dbSnapshot.customThemes.find((t) => t._id === themeId);
        if (!customTheme)
            return false;
        const response = yield ape_1.default.users.deleteCustomTheme(themeId);
        if (response.status !== 200) {
            Notifications.add("Error deleting custom theme: " + response.message, -1);
            return false;
        }
        dbSnapshot.customThemes = dbSnapshot.customThemes.filter((t) => t._id !== themeId);
        return true;
    });
}
exports.deleteCustomTheme = deleteCustomTheme;
function getUserHighestWpm(mode, mode2, punctuation, language, difficulty, lazyMode) {
    return __awaiter(this, void 0, void 0, function* () {
        function cont() {
            var _a;
            let topWpm = 0;
            (_a = dbSnapshot.results) === null || _a === void 0 ? void 0 : _a.forEach((result) => {
                if (result.mode == mode &&
                    result.mode2 == mode2 &&
                    result.punctuation == punctuation &&
                    result.language == language &&
                    result.difficulty == difficulty &&
                    (result.lazyMode === lazyMode ||
                        (result.lazyMode === undefined && lazyMode === false))) {
                    if (result.wpm > topWpm) {
                        topWpm = result.wpm;
                    }
                }
            });
            return topWpm;
        }
        const retval = dbSnapshot === null || dbSnapshot.results === undefined ? 0 : cont();
        return retval;
    });
}
exports.getUserHighestWpm = getUserHighestWpm;
function getUserAverage10(mode, mode2, punctuation, language, difficulty, lazyMode) {
    return __awaiter(this, void 0, void 0, function* () {
        const snapshot = getSnapshot();
        if (!snapshot)
            return [0, 0];
        function cont() {
            var _a;
            const activeTagIds = [];
            (_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
                if (tag.active === true) {
                    activeTagIds.push(tag._id);
                }
            });
            let wpmSum = 0;
            let accSum = 0;
            let last10Wpm = 0;
            let last10Acc = 0;
            let count = 0;
            let last10Count = 0;
            if (snapshot.results !== undefined) {
                for (const result of snapshot.results) {
                    if (result.mode === mode &&
                        result.punctuation === punctuation &&
                        result.language === language &&
                        result.difficulty === difficulty &&
                        (result.lazyMode === lazyMode ||
                            (result.lazyMode === undefined && lazyMode === false)) &&
                        (activeTagIds.length === 0 ||
                            activeTagIds.some((tagId) => result.tags.includes(tagId)))) {
                        // Continue if the mode2 doesn't match and it's not a quote
                        if (result.mode2 !== mode2 && mode !== "quote") {
                            continue;
                        }
                        // Grab the most recent results from the current mode
                        if (last10Count < 10) {
                            last10Wpm += result.wpm;
                            last10Acc += result.acc;
                            last10Count++;
                        }
                        // Check if the mode2 matches and if it does, add it to the sum, for quotes, this is the quote id
                        if (result.mode2 === mode2) {
                            wpmSum += result.wpm;
                            accSum += result.acc;
                            count++;
                            if (count >= 10)
                                break;
                        }
                    }
                }
            }
            // Return the last 10 average wpm & acc for quote
            // if the current quote id has never been completed before by the user
            if (count === 0 && mode === "quote") {
                return [last10Wpm / last10Count, last10Acc / last10Count];
            }
            return [wpmSum / count, accSum / count];
        }
        const retval = snapshot === null || (yield getUserResults()) === null ? [0, 0] : cont();
        return retval;
    });
}
exports.getUserAverage10 = getUserAverage10;
function getLocalPB(mode, mode2, punctuation, language, difficulty, lazyMode, funbox) {
    return __awaiter(this, void 0, void 0, function* () {
        if (funbox !== "none" && funbox !== "plus_one" && funbox !== "plus_two") {
            return 0;
        }
        function cont() {
            let ret = 0;
            try {
                if (!dbSnapshot.personalBests)
                    return ret;
                dbSnapshot.personalBests[mode][mode2].forEach((pb) => {
                    if (pb.punctuation == punctuation &&
                        pb.difficulty == difficulty &&
                        pb.language == language &&
                        (pb.lazyMode === lazyMode ||
                            (pb.lazyMode === undefined && lazyMode === false))) {
                        ret = pb.wpm;
                    }
                });
                return ret;
            }
            catch (e) {
                return ret;
            }
        }
        const retval = dbSnapshot === null ? 0 : cont();
        return retval;
    });
}
exports.getLocalPB = getLocalPB;
function saveLocalPB(mode, mode2, punctuation, language, difficulty, lazyMode, wpm, acc, raw, consistency) {
    return __awaiter(this, void 0, void 0, function* () {
        if (mode == "quote")
            return;
        function cont() {
            let found = false;
            if (dbSnapshot.personalBests === undefined) {
                dbSnapshot.personalBests = {
                    time: {},
                    words: {},
                    zen: { zen: [] },
                    quote: { custom: [] },
                    custom: { custom: [] },
                };
            }
            if (dbSnapshot.personalBests[mode] === undefined) {
                if (mode === "zen") {
                    dbSnapshot.personalBests["zen"] = { zen: [] };
                }
                else {
                    dbSnapshot.personalBests[mode] = {
                        custom: [],
                    };
                }
            }
            if (dbSnapshot.personalBests[mode][mode2] === undefined) {
                dbSnapshot.personalBests[mode][mode2] =
                    [];
            }
            dbSnapshot.personalBests[mode][mode2].forEach((pb) => {
                if (pb.punctuation == punctuation &&
                    pb.difficulty == difficulty &&
                    pb.language == language &&
                    (pb.lazyMode === lazyMode ||
                        (pb.lazyMode === undefined && lazyMode === false))) {
                    found = true;
                    pb.wpm = wpm;
                    pb.acc = acc;
                    pb.raw = raw;
                    pb.timestamp = Date.now();
                    pb.consistency = consistency;
                    pb.lazyMode = lazyMode;
                }
            });
            if (!found) {
                //nothing found
                dbSnapshot.personalBests[mode][mode2].push({
                    language: language,
                    difficulty: difficulty,
                    lazyMode: lazyMode,
                    punctuation: punctuation,
                    wpm: wpm,
                    acc: acc,
                    raw: raw,
                    timestamp: Date.now(),
                    consistency: consistency,
                });
            }
        }
        if (dbSnapshot != null) {
            cont();
        }
    });
}
exports.saveLocalPB = saveLocalPB;
function getLocalTagPB(tagId, mode, mode2, punctuation, language, difficulty, lazyMode) {
    return __awaiter(this, void 0, void 0, function* () {
        function cont() {
            var _a, _b;
            let ret = 0;
            const filteredtag = ((_a = getSnapshot().tags) !== null && _a !== void 0 ? _a : []).filter((t) => t._id === tagId)[0];
            if (filteredtag === undefined)
                return ret;
            if (filteredtag.personalBests === undefined) {
                filteredtag.personalBests = {
                    time: {},
                    words: {},
                    zen: { zen: [] },
                    quote: { custom: [] },
                    custom: { custom: [] },
                };
            }
            try {
                const personalBests = ((_b = filteredtag.personalBests[mode][mode2]) !== null && _b !== void 0 ? _b : []);
                personalBests.forEach((pb) => {
                    if (pb.punctuation == punctuation &&
                        pb.difficulty == difficulty &&
                        pb.language == language &&
                        (pb.lazyMode === lazyMode ||
                            (pb.lazyMode === undefined && lazyMode === false))) {
                        ret = pb.wpm;
                    }
                });
            }
            catch (e) {
                console.log(e);
            }
            return ret;
        }
        const retval = dbSnapshot === null ? 0 : cont();
        return retval;
    });
}
exports.getLocalTagPB = getLocalTagPB;
function saveLocalTagPB(tagId, mode, mode2, punctuation, language, difficulty, lazyMode, wpm, acc, raw, consistency) {
    return __awaiter(this, void 0, void 0, function* () {
        if (mode == "quote")
            return;
        function cont() {
            var _a;
            const filteredtag = (_a = dbSnapshot.tags) === null || _a === void 0 ? void 0 : _a.filter((t) => t._id === tagId)[0];
            if (!filteredtag.personalBests) {
                filteredtag.personalBests = {
                    time: {},
                    words: {},
                    zen: { zen: [] },
                    quote: { custom: [] },
                    custom: { custom: [] },
                };
            }
            try {
                let found = false;
                if (filteredtag.personalBests[mode][mode2] === undefined) {
                    filteredtag.personalBests[mode][mode2] =
                        [];
                }
                filteredtag.personalBests[mode][mode2].forEach((pb) => {
                    if (pb.punctuation == punctuation &&
                        pb.difficulty == difficulty &&
                        pb.language == language &&
                        (pb.lazyMode === lazyMode ||
                            (pb.lazyMode === undefined && lazyMode === false))) {
                        found = true;
                        pb.wpm = wpm;
                        pb.acc = acc;
                        pb.raw = raw;
                        pb.timestamp = Date.now();
                        pb.consistency = consistency;
                        pb.lazyMode = lazyMode;
                    }
                });
                if (!found) {
                    //nothing found
                    filteredtag.personalBests[mode][mode2].push({
                        language: language,
                        difficulty: difficulty,
                        lazyMode: lazyMode,
                        punctuation: punctuation,
                        wpm: wpm,
                        acc: acc,
                        raw: raw,
                        timestamp: Date.now(),
                        consistency: consistency,
                    });
                }
            }
            catch (e) {
                //that mode or mode2 is not found
                filteredtag.personalBests = {
                    time: {},
                    words: {},
                    zen: { zen: [] },
                    quote: { custom: [] },
                    custom: { custom: [] },
                };
                if (mode === "zen") {
                    filteredtag.personalBests["zen"] = { zen: [] };
                }
                else {
                    filteredtag.personalBests[mode] = {
                        custom: [],
                    };
                }
                filteredtag.personalBests[mode][mode2] = [
                    {
                        language: language,
                        difficulty: difficulty,
                        lazyMode: lazyMode,
                        punctuation: punctuation,
                        wpm: wpm,
                        acc: acc,
                        raw: raw,
                        timestamp: Date.now(),
                        consistency: consistency,
                    },
                ];
            }
        }
        if (dbSnapshot != null) {
            cont();
        }
        return;
    });
}
exports.saveLocalTagPB = saveLocalTagPB;
function updateLbMemory(mode, mode2, language, rank, api = false) {
    return __awaiter(this, void 0, void 0, function* () {
        //could dbSnapshot just be used here instead of getSnapshot()
        if (mode === "time") {
            const timeMode = mode, timeMode2 = mode2;
            const snapshot = getSnapshot();
            if (snapshot.lbMemory === undefined) {
                snapshot.lbMemory = { time: { 15: { english: 0 }, 60: { english: 0 } } };
            }
            if (snapshot.lbMemory[timeMode] === undefined) {
                snapshot.lbMemory[timeMode] = {
                    15: { english: 0 },
                    60: { english: 0 },
                };
            }
            if (snapshot.lbMemory[timeMode][timeMode2] === undefined) {
                snapshot.lbMemory[timeMode][timeMode2] = {};
            }
            const current = snapshot.lbMemory[timeMode][timeMode2][language];
            snapshot.lbMemory[timeMode][timeMode2][language] = rank;
            if (api && current != rank) {
                yield ape_1.default.users.updateLeaderboardMemory(mode, mode2, language, rank);
            }
            setSnapshot(snapshot);
        }
    });
}
exports.updateLbMemory = updateLbMemory;
function saveConfig(config) {
    return __awaiter(this, void 0, void 0, function* () {
        if (firebase_1.Auth.currentUser !== null) {
            AccountButton.loading(true);
            const response = yield ape_1.default.configs.save(config);
            if (response.status !== 200) {
                Notifications.add("Failed to save config: " + response.message, -1);
            }
            AccountButton.loading(false);
        }
    });
}
exports.saveConfig = saveConfig;
function saveLocalResult(result) {
    const snapshot = getSnapshot();
    if (snapshot !== null && snapshot.results !== undefined) {
        snapshot.results.unshift(result);
        setSnapshot(snapshot);
    }
}
exports.saveLocalResult = saveLocalResult;
function updateLocalStats(stats) {
    const snapshot = getSnapshot();
    if (snapshot.globalStats === undefined) {
        snapshot.globalStats = {};
    }
    if (snapshot !== null && snapshot.globalStats !== undefined) {
        if (snapshot.globalStats.time == undefined) {
            snapshot.globalStats.time = stats.time;
        }
        else {
            snapshot.globalStats.time += stats.time;
        }
        if (snapshot.globalStats.started == undefined) {
            snapshot.globalStats.started = stats.started;
        }
        else {
            snapshot.globalStats.started += stats.started;
        }
        if (snapshot.globalStats.completed == undefined) {
            snapshot.globalStats.completed = 1;
        }
        else {
            snapshot.globalStats.completed += 1;
        }
    }
    setSnapshot(snapshot);
}
exports.updateLocalStats = updateLocalStats;
// export async function DB.getLocalTagPB(tagId) {
//   function cont() {
//     let ret = 0;
//     try {
//       ret = dbSnapshot.tags.filter((t) => t.id === tagId)[0].pb;
//       if (ret == undefined) {
//         ret = 0;
//       }
//       return ret;
//     } catch (e) {
//       return ret;
//     }
//   }
//   const retval = dbSnapshot !== null ? cont() : undefined;
//   return retval;
// }
// export async functio(tagId, wpm) {
//   function cont() {
//     dbSnapshot.tags.forEach((tag) => {
//       if (tag._id === tagId) {
//         tag.pb = wpm;
//       }
//     });
//   }
//   if (dbSnapshot != null) {
//     cont();
//   }
// }


/***/ }),

/***/ "./src/scripts/elements/account-button.ts":
/*!************************************************!*\
  !*** ./src/scripts/elements/account-button.ts ***!
  \************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = exports.loading = void 0;
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
function loading(truefalse) {
    if (truefalse) {
        $("#top #menu .account .icon").html('<i class="fas fa-fw fa-spin fa-circle-notch"></i>');
        $("#top #menu .account").css("opacity", 1).css("pointer-events", "none");
    }
    else {
        $("#top #menu .account .icon").html('<i class="fas fa-fw fa-user"></i>');
        $("#top #menu .account").css("opacity", 1).css("pointer-events", "auto");
    }
}
exports.loading = loading;
function update() {
    if (firebase_1.Auth.currentUser != null) {
        Misc.swapElements($("#menu .icon-button.login"), $("#menu .icon-button.account"), 250);
    }
    else {
        Misc.swapElements($("#menu .icon-button.account"), $("#menu .icon-button.login"), 250);
    }
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/elements/commandline-lists.ts":
/*!***************************************************!*\
  !*** ./src/scripts/elements/commandline-lists.ts ***!
  \***************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getList = exports.pushCurrent = exports.setCurrent = exports.defaultCommands = exports.updateThemeCommands = exports.commandsChallenges = exports.themeCommands = exports.updateCustomThemeListCommands = exports.customThemeListCommands = exports.customThemeCommands = exports.commandsEnableAds = exports.updatePresetCommands = exports.updateTagCommands = exports.commandsKeymapLayouts = exports.current = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./notifications */ "./src/scripts/elements/notifications.ts"));
const Sound = __importStar(__webpack_require__(/*! ../controllers/sound-controller */ "./src/scripts/controllers/sound-controller.ts"));
const ThemeController = __importStar(__webpack_require__(/*! ../controllers/theme-controller */ "./src/scripts/controllers/theme-controller.ts"));
const CustomTextPopup = __importStar(__webpack_require__(/*! ../popups/custom-text-popup */ "./src/scripts/popups/custom-text-popup.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const PractiseWords = __importStar(__webpack_require__(/*! ../test/practise-words */ "./src/scripts/test/practise-words.ts"));
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const Funbox = __importStar(__webpack_require__(/*! ../test/funbox */ "./src/scripts/test/funbox.ts"));
const TagController = __importStar(__webpack_require__(/*! ../controllers/tag-controller */ "./src/scripts/controllers/tag-controller.ts"));
const PresetController = __importStar(__webpack_require__(/*! ../controllers/preset-controller */ "./src/scripts/controllers/preset-controller.ts"));
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const ChallengeController = __importStar(__webpack_require__(/*! ../controllers/challenge-controller */ "./src/scripts/controllers/challenge-controller.ts"));
const PaceCaret = __importStar(__webpack_require__(/*! ../test/pace-caret */ "./src/scripts/test/pace-caret.ts"));
const TestInput = __importStar(__webpack_require__(/*! ../test/test-input */ "./src/scripts/test/test-input.ts"));
const ModesNotice = __importStar(__webpack_require__(/*! ../elements/modes-notice */ "./src/scripts/elements/modes-notice.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
exports.current = [];
function canBailOut() {
    return ((config_1.default.mode === "custom" &&
        CustomText.isWordRandom &&
        (CustomText.word >= 5000 || CustomText.word == 0)) ||
        (config_1.default.mode === "custom" &&
            !CustomText.isWordRandom &&
            !CustomText.isTimeRandom &&
            CustomText.text.length >= 5000) ||
        (config_1.default.mode === "custom" &&
            CustomText.isTimeRandom &&
            (CustomText.time >= 3600 || CustomText.time == 0)) ||
        (config_1.default.mode === "words" && config_1.default.words >= 5000) ||
        config_1.default.words === 0 ||
        (config_1.default.mode === "time" && (config_1.default.time >= 3600 || config_1.default.time === 0)) ||
        config_1.default.mode == "zen");
}
const commandsLayouts = {
    title: "Layout emulator...",
    configKey: "layout",
    list: [
        {
            id: "couldnotload",
            display: "Could not load the layouts list :(",
        },
    ],
};
Misc.getLayoutsList().then((layouts) => {
    commandsLayouts.list = [];
    commandsLayouts.list.push({
        id: "changeLayoutDefault",
        display: "off",
        configValue: "default",
        exec: () => {
            UpdateConfig.setLayout("default");
            TestLogic.restart();
        },
    });
    Object.keys(layouts).forEach((layout) => {
        commandsLayouts.list.push({
            id: "changeLayout" + Misc.capitalizeFirstLetterOfEachWord(layout),
            display: layout === "default" ? "off" : layout.replace(/_/g, " "),
            configValue: layout,
            exec: () => {
                // UpdateConfig.setSavedLayout(layout);
                UpdateConfig.setLayout(layout);
                TestLogic.restart();
            },
        });
    });
});
exports.commandsKeymapLayouts = {
    title: "Change keymap layout...",
    configKey: "keymapLayout",
    list: [
        {
            id: "couldnotload",
            display: "Could not load the layouts list :(",
        },
    ],
};
Misc.getLayoutsList().then((layouts) => {
    exports.commandsKeymapLayouts.list = [];
    exports.commandsKeymapLayouts.list.push({
        id: "changeKeymapLayoutOverrideSync",
        display: "emulator sync",
        configValue: "overrideSync",
        exec: () => {
            UpdateConfig.setKeymapLayout("overrideSync");
            TestLogic.restart();
        },
    });
    Object.keys(layouts).forEach((layout) => {
        if (layout.toString() != "default") {
            exports.commandsKeymapLayouts.list.push({
                id: "changeKeymapLayout" + Misc.capitalizeFirstLetterOfEachWord(layout),
                display: layout.replace(/_/g, " "),
                configValue: layout,
                exec: () => {
                    UpdateConfig.setKeymapLayout(layout);
                    TestLogic.restart();
                },
            });
        }
    });
});
const commandsLanguages = {
    title: "Language...",
    configKey: "language",
    list: [
        {
            id: "couldnotload",
            display: "Could not load the languages list :(",
        },
    ],
};
commandsLanguages.list = [];
Misc.getLanguageList().then((languages) => {
    languages.forEach((language) => {
        commandsLanguages.list.push({
            id: "changeLanguage" + Misc.capitalizeFirstLetterOfEachWord(language),
            display: language.replace(/_/g, " "),
            configValue: language,
            exec: () => {
                UpdateConfig.setLanguage(language);
                TestLogic.restart();
            },
        });
    });
});
const commandsFunbox = {
    title: "Funbox...",
    configKey: "funbox",
    list: [
        {
            id: "changeFunboxNone",
            display: "none",
            configValue: "none",
            alias: "off",
            exec: () => {
                if (Funbox.setFunbox("none", null)) {
                    TestLogic.restart();
                }
            },
        },
    ],
};
Misc.getFunboxList().then((funboxes) => {
    funboxes.forEach((funbox) => {
        commandsFunbox.list.push({
            id: "changeFunbox" + funbox.name,
            display: funbox.name.replace(/_/g, " "),
            configValue: funbox.name,
            exec: () => {
                if (Funbox.setFunbox(funbox.name, funbox.type)) {
                    TestLogic.restart();
                }
            },
        });
    });
});
const commandsFonts = {
    title: "Font family...",
    configKey: "fontFamily",
    list: [],
};
Misc.getFontsList().then((fonts) => {
    fonts.forEach((font) => {
        commandsFonts.list.push({
            id: "changeFont" + font.name.replace(/ /g, "_"),
            display: font.display !== undefined ? font.display : font.name,
            configValue: font.name,
            hover: () => {
                UpdateConfig.previewFontFamily(font.name);
            },
            exec: () => {
                UpdateConfig.setFontFamily(font.name.replace(/ /g, "_"));
            },
        });
    });
    commandsFonts.list.push({
        id: "setFontFamilyCustom",
        display: "custom...",
        input: true,
        hover: () => {
            UpdateConfig.previewFontFamily(config_1.default.fontFamily);
        },
        exec: (name) => {
            if (!name)
                return;
            UpdateConfig.setFontFamily(name.replace(/\s/g, "_"));
            // Settings.groups.fontFamily.updateInput();
        },
    });
});
const commandsTags = {
    title: "Change tags...",
    list: [],
};
function updateTagCommands() {
    var _a, _b, _c, _d;
    if ((_c = (_b = (_a = DB.getSnapshot()) === null || _a === void 0 ? void 0 : _a.tags) === null || _b === void 0 ? void 0 : _b.length) !== null && _c !== void 0 ? _c : 0 > 0) {
        commandsTags.list = [];
        commandsTags.list.push({
            id: "clearTags",
            display: `Clear tags`,
            icon: "fa-times",
            exec: () => {
                var _a;
                const snapshot = DB.getSnapshot();
                snapshot.tags = (_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.map((tag) => {
                    tag.active = false;
                    return tag;
                });
                DB.setSnapshot(snapshot);
                ModesNotice.update();
                TagController.saveActiveToLocalStorage();
            },
        });
        (_d = DB.getSnapshot().tags) === null || _d === void 0 ? void 0 : _d.forEach((tag) => {
            let dis = tag.name;
            if (tag.active === true) {
                dis = '<i class="fas fa-fw fa-check"></i>' + dis;
            }
            else {
                dis = '<i class="fas fa-fw"></i>' + dis;
            }
            commandsTags.list.push({
                id: "toggleTag" + tag._id,
                noIcon: true,
                display: dis,
                sticky: true,
                exec: () => {
                    TagController.toggle(tag._id);
                    ModesNotice.update();
                    if (config_1.default.paceCaret === "average") {
                        PaceCaret.init();
                        ModesNotice.update();
                    }
                    let txt = tag.name;
                    if (tag.active === true) {
                        txt = '<i class="fas fa-fw fa-check"></i>' + txt;
                    }
                    else {
                        txt = '<i class="fas fa-fw"></i>' + txt;
                    }
                    if ($("#commandLine").hasClass("allCommands")) {
                        $(`#commandLine .suggestions .entry[command='toggleTag${tag._id}']`).html(`<div class="icon"><i class="fas fa-fw fa-tag"></i></div><div>Tags  > ` +
                            txt);
                    }
                    else {
                        $(`#commandLine .suggestions .entry[command='toggleTag${tag._id}']`).html(txt);
                    }
                },
            });
        });
        // defaultCommands.list[4].visible = true;
    }
}
exports.updateTagCommands = updateTagCommands;
const commandsPresets = {
    title: "Presets...",
    list: [],
};
function updatePresetCommands() {
    const snapshot = DB.getSnapshot();
    if (!snapshot || !snapshot.presets || snapshot.presets.length === 0)
        return;
    commandsPresets.list = [];
    snapshot.presets.forEach((preset) => {
        const dis = preset.name;
        commandsPresets.list.push({
            id: "applyPreset" + preset._id,
            display: dis,
            exec: () => {
                Settings.setEventDisabled(true);
                PresetController.apply(preset._id);
                Settings.setEventDisabled(false);
                Settings.update();
                ModesNotice.update();
            },
        });
    });
}
exports.updatePresetCommands = updatePresetCommands;
const commandsRepeatQuotes = {
    title: "Repeat quotes...",
    configKey: "repeatQuotes",
    list: [
        {
            id: "setRepeatQuotesOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setRepeatQuotes("off");
            },
        },
        {
            id: "setRepeatQuotesTyping",
            display: "typing",
            configValue: "typing",
            exec: () => {
                UpdateConfig.setRepeatQuotes("typing");
            },
        },
    ],
};
const commandsLiveWpm = {
    title: "Live WPM...",
    configKey: "showLiveWpm",
    list: [
        {
            id: "setLiveWpmOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowLiveWpm(false);
            },
        },
        {
            id: "setLiveWpmOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowLiveWpm(true);
            },
        },
    ],
};
const commandsShowAverage = {
    title: "Show average...",
    configKey: "showAverage",
    list: [
        {
            id: "setShowAverageOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setShowAverage("off");
            },
        },
        {
            id: "setShowAverageSpeed",
            display: "wpm",
            configValue: "wpm",
            exec: () => {
                UpdateConfig.setShowAverage("wpm");
            },
        },
        {
            id: "setShowAverageAcc",
            display: "accuracy",
            configValue: "acc",
            exec: () => {
                UpdateConfig.setShowAverage("acc");
            },
        },
        {
            id: "setShowAverageBoth",
            display: "both",
            configValue: "both",
            exec: () => {
                UpdateConfig.setShowAverage("both");
            },
        },
    ],
};
const commandsLiveAcc = {
    title: "Live accuracy...",
    configKey: "showLiveAcc",
    list: [
        {
            id: "setLiveAccOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowLiveAcc(false);
            },
        },
        {
            id: "setLiveAccOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowLiveAcc(true);
            },
        },
    ],
};
const commandsLiveBurst = {
    title: "Live burst...",
    configKey: "showLiveBurst",
    list: [
        {
            id: "setLiveBurstOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowLiveBurst(false);
            },
        },
        {
            id: "setLiveBurstOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowLiveBurst(true);
            },
        },
    ],
};
const commandsShowTimer = {
    title: "Timer/progress...",
    configKey: "showTimerProgress",
    list: [
        {
            id: "setTimerProgressOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowTimerProgress(false);
            },
        },
        {
            id: "setTimerProgressOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowTimerProgress(true);
            },
        },
    ],
};
const commandsKeyTips = {
    title: "Key tips...",
    configKey: "showKeyTips",
    list: [
        {
            id: "setKeyTipsOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setKeyTips(false);
            },
        },
        {
            id: "setKeyTipsOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setKeyTips(true);
            },
        },
    ],
};
const commandsFreedomMode = {
    title: "Freedom mode...",
    configKey: "freedomMode",
    list: [
        {
            id: "setfreedomModeOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setFreedomMode(false);
            },
        },
        {
            id: "setfreedomModeOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setFreedomMode(true);
            },
        },
    ],
};
const commandsStrictSpace = {
    title: "Strict space...",
    configKey: "strictSpace",
    list: [
        {
            id: "setStrictSpaceOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setStrictSpace(false);
            },
        },
        {
            id: "setStrictSpaceOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setStrictSpace(true);
            },
        },
    ],
};
const commandsBlindMode = {
    title: "Blind mode...",
    configKey: "blindMode",
    list: [
        {
            id: "setBlindModeOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setBlindMode(false);
            },
        },
        {
            id: "setBlindModeOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setBlindMode(true);
            },
        },
    ],
};
const commandsShowWordsHistory = {
    title: "Always show words history...",
    configKey: "alwaysShowWordsHistory",
    list: [
        {
            id: "setAlwaysShowWordsHistoryOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setAlwaysShowWordsHistory(false);
            },
        },
        {
            id: "setAlwaysShowWordsHistoryOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setAlwaysShowWordsHistory(true);
            },
        },
    ],
};
const commandsIndicateTypos = {
    title: "Indicate typos...",
    configKey: "indicateTypos",
    list: [
        {
            id: "setIndicateTyposOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setIndicateTypos("off");
            },
        },
        {
            id: "setIndicateTyposBelow",
            display: "below",
            configValue: "below",
            exec: () => {
                UpdateConfig.setIndicateTypos("below");
            },
        },
        {
            id: "setIndicateTyposReplace",
            display: "replace",
            configValue: "replace",
            exec: () => {
                UpdateConfig.setIndicateTypos("replace");
            },
        },
    ],
};
const commandsHideExtraLetters = {
    title: "Hide extra letters...",
    configKey: "hideExtraLetters",
    list: [
        {
            id: "setHideExtraLettersOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setHideExtraLetters(false);
            },
        },
        {
            id: "setHideExtraLettersOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setHideExtraLetters(true);
            },
        },
    ],
};
const commandsQuickEnd = {
    title: "Quick end...",
    configKey: "quickEnd",
    list: [
        {
            id: "setQuickEndOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setQuickEnd(false);
            },
        },
        {
            id: "setQuickEndOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setQuickEnd(true);
            },
        },
    ],
};
const commandsOppositeShiftMode = {
    title: "Change opposite shift mode...",
    configKey: "oppositeShiftMode",
    list: [
        {
            id: "setOppositeShiftModeOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setOppositeShiftMode("off");
                ModesNotice.update();
            },
        },
        {
            id: "setOppositeShiftModeOn",
            display: "on",
            configValue: "on",
            exec: () => {
                UpdateConfig.setOppositeShiftMode("on");
                ModesNotice.update();
            },
        },
        {
            id: "setOppositeShiftModeKeymap",
            display: "keymap",
            configValue: "keymap",
            exec: () => {
                UpdateConfig.setOppositeShiftMode("keymap");
                ModesNotice.update();
            },
        },
    ],
};
const commandsSoundOnError = {
    title: "Sound on error...",
    configKey: "playSoundOnError",
    list: [
        {
            id: "setPlaySoundOnErrorOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setPlaySoundOnError(false);
            },
        },
        {
            id: "setPlaySoundOnErrorOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setPlaySoundOnError(true);
                Sound.playError();
            },
        },
    ],
};
const commandsSoundVolume = {
    title: "Sound volume...",
    configKey: "soundVolume",
    list: [
        {
            id: "setSoundVolume0.1",
            display: "quiet",
            configValue: "0.1",
            exec: () => {
                UpdateConfig.setSoundVolume("0.1");
                Sound.playClick();
            },
        },
        {
            id: "setSoundVolume0.5",
            display: "medium",
            configValue: "0.5",
            exec: () => {
                UpdateConfig.setSoundVolume("0.5");
                Sound.playClick();
            },
        },
        {
            id: "setSoundVolume1.0",
            display: "loud",
            configValue: "1.0",
            exec: () => {
                UpdateConfig.setSoundVolume("1.0");
                Sound.playClick();
            },
        },
    ],
};
const commandsFlipTestColors = {
    title: "Flip test colors...",
    configKey: "flipTestColors",
    list: [
        {
            id: "setFlipTestColorsOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setFlipTestColors(false);
            },
        },
        {
            id: "setFlipTestColorsOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setFlipTestColors(true);
            },
        },
    ],
};
const commandsSmoothLineScroll = {
    title: "Smooth line scroll...",
    configKey: "smoothLineScroll",
    list: [
        {
            id: "setSmoothLineScrollOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setSmoothLineScroll(false);
            },
        },
        {
            id: "setSmoothLineScrollOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setSmoothLineScroll(true);
            },
        },
    ],
};
const commandsAlwaysShowDecimal = {
    title: "Always show decimal places...",
    configKey: "alwaysShowDecimalPlaces",
    list: [
        {
            id: "setAlwaysShowDecimalPlacesOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setAlwaysShowDecimalPlaces(false);
            },
        },
        {
            id: "setAlwaysShowDecimalPlacesOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setAlwaysShowDecimalPlaces(true);
            },
        },
    ],
};
const commandsAlwaysShowCPM = {
    title: "Always show CPM...",
    configKey: "alwaysShowCPM",
    list: [
        {
            id: "setAlwaysShowCPMOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setAlwaysShowCPM(false);
            },
        },
        {
            id: "setAlwaysShowCPMOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setAlwaysShowCPM(true);
            },
        },
    ],
};
const commandsStartGraphsAtZero = {
    title: "Start graphs at zero...",
    configKey: "startGraphsAtZero",
    list: [
        {
            id: "setStartGraphsAtZeroOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setStartGraphsAtZero(false);
            },
        },
        {
            id: "setStartGraphsAtZeroOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setStartGraphsAtZero(true);
            },
        },
    ],
};
const commandsLazyMode = {
    title: "Lazy mode...",
    configKey: "lazyMode",
    list: [
        {
            id: "setLazyModeOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setLazyMode(false);
                TestLogic.restart();
            },
        },
        {
            id: "setLazyModeOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setLazyMode(true);
                TestLogic.restart();
            },
        },
    ],
};
const commandsSwapEscAndTab = {
    title: "Swap esc and tab...",
    configKey: "swapEscAndTab",
    list: [
        {
            id: "setSwapEscAndTabOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setSwapEscAndTab(false);
            },
        },
        {
            id: "setSwapEscAndTabOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setSwapEscAndTab(true);
            },
        },
    ],
};
const commandsShowAllLines = {
    title: "Show all lines...",
    configKey: "showAllLines",
    list: [
        {
            id: "setShowAllLinesOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowAllLines(false);
            },
        },
        {
            id: "setShowAllLinesOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowAllLines(true);
            },
        },
    ],
};
const commandsColorfulMode = {
    title: "Colorful mode...",
    configKey: "colorfulMode",
    list: [
        {
            id: "setColorfulModeOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setColorfulMode(false);
            },
        },
        {
            id: "setColorfulModeOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setColorfulMode(true);
            },
        },
    ],
};
const commandsOutOfFocusWarning = {
    title: "Colorful mode...",
    configKey: "showOutOfFocusWarning",
    list: [
        {
            id: "setShowOutOfFocusWarningOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowOutOfFocusWarning(false);
            },
        },
        {
            id: "setShowOutOfFocusWarningOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowOutOfFocusWarning(true);
            },
        },
    ],
};
const commandsKeymapMode = {
    title: "Keymap mode...",
    configKey: "keymapMode",
    list: [
        {
            id: "setKeymapModeOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setKeymapMode("off");
            },
        },
        {
            id: "setKeymapModeStatic",
            display: "static",
            configValue: "static",
            exec: () => {
                UpdateConfig.setKeymapMode("static");
            },
        },
        {
            id: "setKeymapModeNext",
            display: "next",
            configValue: "next",
            exec: () => {
                UpdateConfig.setKeymapMode("next");
            },
        },
        {
            id: "setKeymapModeReact",
            display: "react",
            alias: "flash",
            configValue: "react",
            exec: () => {
                UpdateConfig.setKeymapMode("react");
            },
        },
    ],
};
const commandsSoundOnClick = {
    title: "Sound on click...",
    configKey: "playSoundOnClick",
    list: [
        {
            id: "setSoundOnClickOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("off");
            },
        },
        {
            id: "setSoundOnClick1",
            display: "click",
            configValue: "1",
            hover: () => {
                Sound.previewClick("1");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("1");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick2",
            display: "beep",
            configValue: "2",
            hover: () => {
                Sound.previewClick("2");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("2");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick3",
            display: "pop",
            configValue: "3",
            hover: () => {
                Sound.previewClick("3");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("3");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick4",
            display: "nk creams",
            configValue: "4",
            hover: () => {
                Sound.previewClick("4");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("4");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick5",
            display: "typewriter",
            configValue: "5",
            hover: () => {
                Sound.previewClick("5");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("5");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick6",
            display: "osu",
            configValue: "6",
            hover: () => {
                Sound.previewClick("6");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("6");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick7",
            display: "hitmarker",
            configValue: "7",
            hover: () => {
                Sound.previewClick("7");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("7");
                Sound.playClick();
            },
        },
    ],
};
const commandsRandomTheme = {
    title: "Random theme...",
    configKey: "randomTheme",
    list: [
        {
            id: "setRandomOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setRandomTheme("off");
            },
        },
        {
            id: "setRandomOn",
            display: "on",
            configValue: "on",
            exec: () => {
                UpdateConfig.setRandomTheme("on");
            },
        },
        {
            id: "setRandomFav",
            display: "fav",
            configValue: "fav",
            exec: () => {
                UpdateConfig.setRandomTheme("fav");
            },
        },
        {
            id: "setRandomLight",
            display: "light",
            configValue: "light",
            exec: () => {
                UpdateConfig.setRandomTheme("light");
            },
        },
        {
            id: "setRandomDark",
            display: "dark",
            configValue: "dark",
            exec: () => {
                UpdateConfig.setRandomTheme("dark");
            },
        },
        {
            id: "setRandomCustom",
            display: "custom",
            configValue: "custom",
            exec: () => {
                if (firebase_1.Auth.currentUser === null) {
                    Notifications.add("Multiple custom themes are available to logged in users only", 0);
                    return;
                }
                UpdateConfig.setRandomTheme("custom");
            },
        },
    ],
};
const commandsDifficulty = {
    title: "Difficulty...",
    configKey: "difficulty",
    list: [
        {
            id: "setDifficultyNormal",
            display: "normal",
            configValue: "normal",
            exec: () => {
                UpdateConfig.setDifficulty("normal");
            },
        },
        {
            id: "setDifficultyExpert",
            display: "expert",
            configValue: "expert",
            exec: () => {
                UpdateConfig.setDifficulty("expert");
            },
        },
        {
            id: "setDifficultyMaster",
            display: "master",
            configValue: "master",
            exec: () => {
                UpdateConfig.setDifficulty("master");
            },
        },
    ],
};
exports.commandsEnableAds = {
    title: "Set enable ads...",
    configKey: "enableAds",
    list: [
        {
            id: "setEnableAdsOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setEnableAds("off");
            },
        },
        {
            id: "setEnableAdsOn",
            display: "on",
            configValue: "on",
            exec: () => {
                UpdateConfig.setEnableAds("on");
            },
        },
        {
            id: "setEnableMax",
            display: "sellout",
            configValue: "max",
            exec: () => {
                UpdateConfig.setEnableAds("max");
            },
        },
    ],
};
exports.customThemeCommands = {
    title: "Custom theme",
    configKey: "customTheme",
    list: [
        {
            id: "setCustomThemeOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setCustomTheme(false);
            },
        },
        {
            id: "setCustomThemeOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setCustomTheme(true);
            },
        },
    ],
};
exports.customThemeListCommands = {
    title: "Custom themes list...",
    // configKey: "customThemeId",
    list: [],
};
function updateCustomThemeListCommands() {
    if (firebase_1.Auth.currentUser === null) {
        return;
    }
    exports.customThemeListCommands.list = [];
    const snapshot = DB.getSnapshot();
    if (!snapshot)
        return;
    if (DB.getSnapshot().customThemes.length < 0) {
        Notifications.add("You need to create a custom theme first", 0);
        return;
    }
    DB.getSnapshot().customThemes.forEach((theme) => {
        exports.customThemeListCommands.list.push({
            id: "setCustomThemeId" + theme._id,
            display: theme.name,
            configValue: theme._id,
            hover: () => {
                ThemeController.preview(theme._id, true);
            },
            exec: () => {
                // UpdateConfig.setCustomThemeId(theme._id);
                UpdateConfig.setCustomTheme(true);
                ThemeController.set(theme._id, true);
            },
        });
    });
    return;
}
exports.updateCustomThemeListCommands = updateCustomThemeListCommands;
const commandsCaretStyle = {
    title: "Change caret style...",
    configKey: "caretStyle",
    list: [
        {
            id: "setCaretStyleOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setCaretStyle("off");
            },
        },
        {
            id: "setCaretStyleDefault",
            display: "line",
            configValue: "default",
            exec: () => {
                UpdateConfig.setCaretStyle("default");
            },
        },
        {
            id: "setCaretStyleBlock",
            display: "block",
            configValue: "block",
            exec: () => {
                UpdateConfig.setCaretStyle("block");
            },
        },
        {
            id: "setCaretStyleOutline",
            display: "outline-block",
            configValue: "outline",
            exec: () => {
                UpdateConfig.setCaretStyle("outline");
            },
        },
        {
            id: "setCaretStyleUnderline",
            display: "underline",
            configValue: "underline",
            exec: () => {
                UpdateConfig.setCaretStyle("underline");
            },
        },
        {
            id: "setCaretStyleCarrot",
            display: "carrot",
            configValue: "carrot",
            visible: false,
            exec: () => {
                UpdateConfig.setCaretStyle("carrot");
            },
        },
        {
            id: "setCaretStyleBanana",
            display: "banana",
            configValue: "banana",
            visible: false,
            exec: () => {
                UpdateConfig.setCaretStyle("banana");
            },
        },
    ],
};
const commandsPaceCaretStyle = {
    title: "Change pace caret style...",
    configKey: "paceCaretStyle",
    list: [
        {
            id: "setPaceCaretStyleDefault",
            display: "line",
            configValue: "default",
            exec: () => {
                UpdateConfig.setPaceCaretStyle("default");
            },
        },
        {
            id: "setPaceCaretStyleBlock",
            display: "block",
            configValue: "block",
            exec: () => {
                UpdateConfig.setPaceCaretStyle("block");
            },
        },
        {
            id: "setPaceCaretStyleOutline",
            display: "outline-block",
            configValue: "outline",
            exec: () => {
                UpdateConfig.setPaceCaretStyle("outline");
            },
        },
        {
            id: "setPaceCaretStyleUnderline",
            display: "underline",
            configValue: "underline",
            exec: () => {
                UpdateConfig.setPaceCaretStyle("underline");
            },
        },
        {
            id: "setPaceCaretStyleCarrot",
            display: "carrot",
            configValue: "carrot",
            visible: false,
            exec: () => {
                UpdateConfig.setPaceCaretStyle("carrot");
            },
        },
        {
            id: "setPaceCaretStyleBanana",
            display: "banana",
            configValue: "banana",
            visible: false,
            exec: () => {
                UpdateConfig.setPaceCaretStyle("banana");
            },
        },
    ],
};
const commandsRepeatedPace = {
    title: "Repeated pace...",
    configKey: "repeatedPace",
    list: [
        {
            id: "setRepeatedPaceOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setRepeatedPace(false);
            },
        },
        {
            id: "setRepeatedPaceOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setRepeatedPace(true);
            },
        },
    ],
};
const commandsPaceCaret = {
    title: "Pace caret mode...",
    configKey: "paceCaret",
    list: [
        {
            id: "setPaceCaretOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setPaceCaret("off");
                TestLogic.restart();
            },
        },
        {
            id: "setPaceCaretPb",
            display: "pb",
            configValue: "pb",
            exec: () => {
                UpdateConfig.setPaceCaret("pb");
                TestLogic.restart();
            },
        },
        {
            id: "setPaceCaretAverage",
            display: "average",
            configValue: "average",
            exec: () => {
                UpdateConfig.setPaceCaret("average");
                TestLogic.restart();
            },
        },
        {
            id: "setPaceCaretCustom",
            display: "custom...",
            configValue: "custom",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setPaceCaretCustomSpeed(parseInt(input));
                UpdateConfig.setPaceCaret("custom");
                TestLogic.restart();
            },
        },
    ],
};
const commandsMinWpm = {
    title: "Change min wpm mode...",
    configKey: "minWpm",
    list: [
        {
            id: "setMinWpmOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setMinWpm("off");
            },
        },
        {
            id: "setMinWpmCustom",
            display: "custom...",
            configValue: "custom",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMinWpmCustomSpeed(parseInt(input));
                UpdateConfig.setMinWpm("custom");
            },
        },
    ],
};
const commandsMinAcc = {
    title: "Change min accuracy mode...",
    configKey: "minAcc",
    list: [
        {
            id: "setMinAccOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setMinAcc("off");
            },
        },
        {
            id: "setMinAccCustom",
            display: "custom...",
            configValue: "custom",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMinAccCustom(parseInt(input));
                UpdateConfig.setMinAcc("custom");
            },
        },
    ],
};
const commandsMinBurst = {
    title: "Change min burst mode...",
    configKey: "minBurst",
    list: [
        {
            id: "setMinBurstOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setMinBurst("off");
            },
        },
        {
            id: "setMinBurstFixed",
            display: "fixed...",
            configValue: "fixed",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMinBurst("fixed");
                UpdateConfig.setMinBurstCustomSpeed(parseInt(input));
            },
        },
        {
            id: "setMinBurstFlex",
            display: "flex...",
            configValue: "flex",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMinBurst("flex");
                UpdateConfig.setMinBurstCustomSpeed(parseInt(input));
            },
        },
    ],
};
const commandsKeymapStyle = {
    title: "Keymap style...",
    configKey: "keymapStyle",
    list: [
        {
            id: "setKeymapStyleStaggered",
            display: "staggered",
            configValue: "staggered",
            exec: () => {
                UpdateConfig.setKeymapStyle("staggered");
            },
        },
        {
            id: "setKeymapStyleAlice",
            display: "alice",
            configValue: "alice",
            exec: () => {
                UpdateConfig.setKeymapStyle("alice");
            },
        },
        {
            id: "setKeymapStyleMatrix",
            display: "matrix",
            configValue: "matrix",
            exec: () => {
                UpdateConfig.setKeymapStyle("matrix");
            },
        },
        {
            id: "setKeymapStyleSplit",
            display: "split",
            configValue: "split",
            exec: () => {
                UpdateConfig.setKeymapStyle("split");
            },
        },
        {
            id: "setKeymapStyleSplitMatrix",
            display: "split matrix",
            configValue: "split_matrix",
            exec: () => {
                UpdateConfig.setKeymapStyle("split_matrix");
            },
        },
    ],
};
const commandsKeymapLegendStyle = {
    title: "Keymap legend style...",
    configKey: "keymapLegendStyle",
    list: [
        {
            id: "setKeymapLegendStyleLowercase",
            display: "lowercase",
            configValue: "lowercase",
            exec: () => {
                UpdateConfig.setKeymapLegendStyle("lowercase");
            },
        },
        {
            id: "setKeymapLegendStyleUppercase",
            display: "uppercase",
            configValue: "uppercase",
            exec: () => {
                UpdateConfig.setKeymapLegendStyle("uppercase");
            },
        },
        {
            id: "setKeymapLegendStyleBlank",
            display: "blank",
            configValue: "blank",
            exec: () => {
                UpdateConfig.setKeymapLegendStyle("blank");
            },
        },
        {
            id: "setKeymapLegendStyleDynamic",
            display: "dynamic",
            configValue: "dynamic",
            exec: () => {
                UpdateConfig.setKeymapLegendStyle("dynamic");
            },
        },
    ],
};
const commandsBritishEnglish = {
    title: "British english...",
    configKey: "britishEnglish",
    list: [
        {
            id: "setBritishEnglishOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setBritishEnglish(false);
                TestLogic.restart();
            },
        },
        {
            id: "setBritishEnglishOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setBritishEnglish(true);
                TestLogic.restart();
            },
        },
    ],
};
const commandsHighlightMode = {
    title: "Highlight mode...",
    configKey: "highlightMode",
    list: [
        {
            id: "setHighlightModeOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setHighlightMode("off");
            },
        },
        {
            id: "setHighlightModeLetter",
            display: "letter",
            configValue: "letter",
            exec: () => {
                UpdateConfig.setHighlightMode("letter");
            },
        },
        {
            id: "setHighlightModeWord",
            display: "word",
            configValue: "word",
            exec: () => {
                UpdateConfig.setHighlightMode("word");
            },
        },
    ],
};
const commandsTimerStyle = {
    title: "Timer/progress style...",
    configKey: "timerStyle",
    list: [
        {
            id: "setTimerStyleBar",
            display: "bar",
            configValue: "bar",
            exec: () => {
                UpdateConfig.setTimerStyle("bar");
            },
        },
        {
            id: "setTimerStyleText",
            display: "text",
            configValue: "text",
            exec: () => {
                UpdateConfig.setTimerStyle("text");
            },
        },
        {
            id: "setTimerStyleMini",
            display: "mini",
            configValue: "mini",
            exec: () => {
                UpdateConfig.setTimerStyle("mini");
            },
        },
    ],
};
const commandsTimerColor = {
    title: "Timer/progress color...",
    configKey: "timerColor",
    list: [
        {
            id: "setTimerColorBlack",
            display: "black",
            configValue: "black",
            exec: () => {
                UpdateConfig.setTimerColor("black");
            },
        },
        {
            id: "setTimerColorSub",
            display: "sub",
            configValue: "sub",
            exec: () => {
                UpdateConfig.setTimerColor("sub");
            },
        },
        {
            id: "setTimerColorText",
            display: "text",
            configValue: "text",
            exec: () => {
                UpdateConfig.setTimerColor("text");
            },
        },
        {
            id: "setTimerColorMain",
            display: "main",
            configValue: "main",
            exec: () => {
                UpdateConfig.setTimerColor("main");
            },
        },
    ],
};
const commandsSingleListCommandLine = {
    title: "Single list command line...",
    configKey: "singleListCommandLine",
    list: [
        {
            id: "singleListCommandLineManual",
            display: "manual",
            configValue: "manual",
            exec: () => {
                UpdateConfig.setSingleListCommandLine("manual");
            },
        },
        {
            id: "singleListCommandLineOn",
            display: "on",
            configValue: "on",
            exec: () => {
                UpdateConfig.setSingleListCommandLine("on");
            },
        },
    ],
};
const commandsCapsLockWarning = {
    title: "Caps lock warning...",
    configKey: "capsLockWarning",
    list: [
        {
            id: "capsLockWarningOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setCapsLockWarning(true);
            },
        },
        {
            id: "capsLockWarningOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setCapsLockWarning(false);
            },
        },
    ],
};
const commandsTimerOpacity = {
    title: "Timer/progress opacity...",
    configKey: "timerOpacity",
    list: [
        {
            id: "setTimerOpacity.25",
            display: ".25",
            configValue: 0.25,
            exec: () => {
                UpdateConfig.setTimerOpacity("0.25");
            },
        },
        {
            id: "setTimerOpacity.5",
            display: ".5",
            configValue: 0.5,
            exec: () => {
                UpdateConfig.setTimerOpacity("0.5");
            },
        },
        {
            id: "setTimerOpacity.75",
            display: ".75",
            configValue: 0.75,
            exec: () => {
                UpdateConfig.setTimerOpacity("0.75");
            },
        },
        {
            id: "setTimerOpacity1",
            display: "1",
            configValue: 1,
            exec: () => {
                UpdateConfig.setTimerOpacity("1");
            },
        },
    ],
};
const commandsWordCount = {
    title: "Change word count...",
    configKey: "words",
    list: [
        {
            id: "changeWordCount10",
            display: "10",
            configValue: 10,
            exec: () => {
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(10);
                TestLogic.restart();
            },
        },
        {
            id: "changeWordCount25",
            display: "25",
            configValue: 25,
            exec: () => {
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(25);
                TestLogic.restart();
            },
        },
        {
            id: "changeWordCount50",
            display: "50",
            configValue: 50,
            exec: () => {
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(50);
                TestLogic.restart();
            },
        },
        {
            id: "changeWordCount100",
            display: "100",
            configValue: 100,
            exec: () => {
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(100);
                TestLogic.restart();
            },
        },
        {
            id: "changeWordCount200",
            display: "200",
            configValue: 200,
            exec: () => {
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(200);
                TestLogic.restart();
            },
        },
        {
            id: "changeWordCountCustom",
            display: "custom...",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(parseInt(input));
                TestLogic.restart();
            },
        },
    ],
};
const commandsQuoteLengthConfig = {
    title: "Change quote length...",
    configKey: "quoteLength",
    list: [
        {
            id: "changeQuoteLengthAll",
            display: "all",
            configValue: [0, 1, 2, 3],
            exec: () => {
                UpdateConfig.setMode("quote");
                UpdateConfig.setQuoteLength([0, 1, 2, 3]);
                TestLogic.restart();
            },
        },
        {
            id: "changeQuoteLengthShort",
            display: "short",
            configValue: 0,
            configValueMode: "include",
            exec: () => {
                UpdateConfig.setMode("quote");
                UpdateConfig.setQuoteLength(0);
                TestLogic.restart();
            },
        },
        {
            id: "changeQuoteLengthMedium",
            display: "medium",
            configValue: 1,
            configValueMode: "include",
            exec: () => {
                UpdateConfig.setMode("quote");
                UpdateConfig.setQuoteLength(1);
                TestLogic.restart();
            },
        },
        {
            id: "changeQuoteLengthLong",
            display: "long",
            configValue: 2,
            configValueMode: "include",
            exec: () => {
                UpdateConfig.setMode("quote");
                UpdateConfig.setQuoteLength(2);
                TestLogic.restart();
            },
        },
        {
            id: "changeQuoteLengthThicc",
            display: "thicc",
            configValue: 3,
            configValueMode: "include",
            exec: () => {
                UpdateConfig.setMode("quote");
                UpdateConfig.setQuoteLength(3);
                TestLogic.restart();
            },
        },
    ],
};
const commandsPunctuation = {
    title: "Change punctuation...",
    configKey: "punctuation",
    list: [
        {
            id: "changePunctuationOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setPunctuation(true);
                TestLogic.restart();
            },
        },
        {
            id: "changePunctuationOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setPunctuation(false);
                TestLogic.restart();
            },
        },
    ],
};
const commandsNumbers = {
    title: "Numbers...",
    configKey: "numbers",
    list: [
        {
            id: "changeNumbersOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setNumbers(true);
                TestLogic.restart();
            },
        },
        {
            id: "changeNumbersOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setNumbers(false);
                TestLogic.restart();
            },
        },
    ],
};
const commandsSmoothCaret = {
    title: "Smooth caret...",
    configKey: "smoothCaret",
    list: [
        {
            id: "changeSmoothCaretOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setSmoothCaret(true);
            },
        },
        {
            id: "changeSmoothCaretOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setSmoothCaret(false);
            },
        },
    ],
};
const commandsQuickTab = {
    title: "Quick tab...",
    configKey: "quickTab",
    list: [
        {
            id: "changeQuickTabOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setQuickTabMode(true);
            },
        },
        {
            id: "changeQuickTabOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setQuickTabMode(false);
            },
        },
    ],
};
const commandsMode = {
    title: "Change mode...",
    configKey: "mode",
    list: [
        {
            id: "changeModeTime",
            display: "time",
            configValue: "time",
            exec: () => {
                UpdateConfig.setMode("time");
                TestLogic.restart();
            },
        },
        {
            id: "changeModeWords",
            display: "words",
            configValue: "words",
            exec: () => {
                UpdateConfig.setMode("words");
                TestLogic.restart();
            },
        },
        {
            id: "changeModeQuote",
            display: "quote",
            configValue: "quote",
            exec: () => {
                UpdateConfig.setMode("quote");
                TestLogic.restart();
            },
        },
        {
            id: "changeModeCustom",
            display: "custom",
            configValue: "custom",
            exec: () => {
                UpdateConfig.setMode("custom");
                TestLogic.restart();
            },
        },
        {
            id: "changeModeZen",
            display: "zen",
            configValue: "zen",
            exec: () => {
                UpdateConfig.setMode("zen");
                ManualRestart.set();
                TestLogic.restart();
            },
        },
    ],
};
const commandsTimeConfig = {
    title: "Change time config...",
    configKey: "time",
    list: [
        {
            id: "changeTimeConfig15",
            display: "15",
            configValue: 15,
            exec: () => {
                UpdateConfig.setMode("time");
                UpdateConfig.setTimeConfig(15);
                TestLogic.restart();
            },
        },
        {
            id: "changeTimeConfig30",
            display: "30",
            configValue: 30,
            exec: () => {
                UpdateConfig.setMode("time");
                UpdateConfig.setTimeConfig(30);
                TestLogic.restart();
            },
        },
        {
            id: "changeTimeConfig60",
            display: "60",
            configValue: 60,
            exec: () => {
                UpdateConfig.setMode("time");
                UpdateConfig.setTimeConfig(60);
                TestLogic.restart();
            },
        },
        {
            id: "changeTimeConfig120",
            display: "120",
            configValue: 120,
            exec: () => {
                UpdateConfig.setMode("time");
                UpdateConfig.setTimeConfig(120);
                TestLogic.restart();
            },
        },
        {
            id: "changeTimeConfigCustom",
            display: "custom...",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMode("time");
                UpdateConfig.setTimeConfig(parseInt(input));
                TestLogic.restart();
            },
        },
    ],
};
const commandsConfidenceMode = {
    title: "Confidence mode...",
    configKey: "confidenceMode",
    list: [
        {
            id: "changeConfidenceModeOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setConfidenceMode("off");
            },
        },
        {
            id: "changeConfidenceModeOn",
            display: "on",
            configValue: "on",
            exec: () => {
                UpdateConfig.setConfidenceMode("on");
            },
        },
        {
            id: "changeConfidenceModeMax",
            display: "max",
            configValue: "max",
            exec: () => {
                UpdateConfig.setConfidenceMode("max");
            },
        },
    ],
};
const commandsStopOnError = {
    title: "Stop on error...",
    configKey: "stopOnError",
    list: [
        {
            id: "changeStopOnErrorOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setStopOnError("off");
            },
        },
        {
            id: "changeStopOnErrorLetter",
            display: "letter",
            configValue: "letter",
            exec: () => {
                UpdateConfig.setStopOnError("letter");
            },
        },
        {
            id: "changeStopOnErrorWord",
            display: "word",
            configValue: "word",
            exec: () => {
                UpdateConfig.setStopOnError("word");
            },
        },
    ],
};
const commandsFontSize = {
    title: "Font size...",
    configKey: "fontSize",
    list: [
        {
            id: "changeFontSize1",
            display: "1x",
            configValue: 1,
            exec: () => {
                UpdateConfig.setFontSize("1");
                TestLogic.restart();
            },
        },
        {
            id: "changeFontSize125",
            display: "1.25x",
            configValue: 125,
            exec: () => {
                UpdateConfig.setFontSize("125");
                TestLogic.restart();
            },
        },
        {
            id: "changeFontSize15",
            display: "1.5x",
            configValue: 15,
            exec: () => {
                UpdateConfig.setFontSize("15");
                TestLogic.restart();
            },
        },
        {
            id: "changeFontSize2",
            display: "2x",
            configValue: 2,
            exec: () => {
                UpdateConfig.setFontSize("2");
                TestLogic.restart();
            },
        },
        {
            id: "changeFontSize3",
            display: "3x",
            configValue: 3,
            exec: () => {
                UpdateConfig.setFontSize("3");
                TestLogic.restart();
            },
        },
        {
            id: "changeFontSize4",
            display: "4x",
            configValue: 4,
            exec: () => {
                UpdateConfig.setFontSize("4");
                TestLogic.restart();
            },
        },
    ],
};
const commandsPageWidth = {
    title: "Page width...",
    configKey: "pageWidth",
    list: [
        {
            id: "setPageWidth100",
            display: "100",
            configValue: "100",
            exec: () => {
                UpdateConfig.setPageWidth("100");
            },
        },
        {
            id: "setPageWidth125",
            display: "125",
            configValue: "125",
            exec: () => {
                UpdateConfig.setPageWidth("125");
            },
        },
        {
            id: "setPageWidth150",
            display: "150",
            configValue: "150",
            exec: () => {
                UpdateConfig.setPageWidth("150");
            },
        },
        {
            id: "setPageWidth200",
            display: "200",
            configValue: "200",
            exec: () => {
                UpdateConfig.setPageWidth("200");
            },
        },
        {
            id: "setPageWidthMax",
            display: "max",
            configValue: "max",
            exec: () => {
                UpdateConfig.setPageWidth("max");
            },
        },
    ],
};
const commandsPractiseWords = {
    title: "Practice words...",
    list: [
        {
            id: "practiseWordsMissed",
            display: "missed",
            noIcon: true,
            exec: () => {
                PractiseWords.init(true, false);
                TestLogic.restart(false, false, undefined, true);
            },
        },
        {
            id: "practiseWordsSlow",
            display: "slow",
            noIcon: true,
            exec: () => {
                PractiseWords.init(false, true);
                TestLogic.restart(false, false, undefined, true);
            },
        },
        {
            id: "practiseWordsBoth",
            display: "both",
            noIcon: true,
            exec: () => {
                PractiseWords.init(true, true);
                TestLogic.restart(false, false, undefined, true);
            },
        },
    ],
};
exports.themeCommands = {
    title: "Theme...",
    configKey: "theme",
    list: [],
};
Misc.getThemesList().then((themes) => {
    themes.forEach((theme) => {
        exports.themeCommands.list.push({
            id: "changeTheme" + Misc.capitalizeFirstLetterOfEachWord(theme.name),
            display: theme.name.replace(/_/g, " "),
            configValue: theme.name,
            hover: () => {
                // previewTheme(theme.name);
                ThemeController.preview(theme.name, false);
            },
            exec: () => {
                UpdateConfig.setTheme(theme.name);
            },
        });
    });
});
exports.commandsChallenges = {
    title: "Load challenge...",
    list: [],
};
Misc.getChallengeList().then((challenges) => {
    challenges.forEach((challenge) => {
        exports.commandsChallenges.list.push({
            id: "loadChallenge" + Misc.capitalizeFirstLetterOfEachWord(challenge.name),
            noIcon: true,
            display: challenge.display,
            exec: () => {
                ChallengeController.setup(challenge.name);
                TestLogic.restart(false, true);
            },
        });
    });
});
// export function showFavouriteThemesAtTheTop() {
function updateThemeCommands() {
    if (config_1.default.favThemes.length > 0) {
        exports.themeCommands.list = [];
        config_1.default.favThemes.forEach((theme) => {
            exports.themeCommands.list.push({
                id: "changeTheme" + Misc.capitalizeFirstLetterOfEachWord(theme),
                display: theme.replace(/_/g, " "),
                hover: () => {
                    // previewTheme(theme);
                    ThemeController.preview(theme, false);
                },
                exec: () => {
                    UpdateConfig.setTheme(theme);
                },
            });
        });
        Misc.getThemesList().then((themes) => {
            themes.forEach((theme) => {
                if (config_1.default.favThemes.includes(theme.name))
                    return;
                exports.themeCommands.list.push({
                    id: "changeTheme" + Misc.capitalizeFirstLetterOfEachWord(theme.name),
                    display: theme.name.replace(/_/g, " "),
                    hover: () => {
                        // previewTheme(theme.name);
                        ThemeController.preview(theme.name, false);
                    },
                    exec: () => {
                        UpdateConfig.setTheme(theme.name);
                    },
                });
            });
        });
    }
}
exports.updateThemeCommands = updateThemeCommands;
const commandsCopyWordsToClipboard = {
    title: "Are you sure...",
    list: [
        {
            id: "copyNo",
            display: "Nevermind",
        },
        {
            id: "copyYes",
            display: "Yes, I am sure",
            exec: () => {
                const words = Misc.getWords();
                navigator.clipboard.writeText(words).then(() => {
                    Notifications.add("Copied to clipboard", 1);
                }, () => {
                    Notifications.add("Failed to copy!", -1);
                });
            },
        },
    ],
};
const commandsMonkeyPowerLevel = {
    title: "Power mode...",
    configKey: "monkeyPowerLevel",
    list: [
        {
            id: "monkeyPowerLevelOff",
            display: "off",
            configValue: "off",
            exec: () => UpdateConfig.setMonkeyPowerLevel("off"),
        },
        {
            id: "monkeyPowerLevel1",
            display: "mellow",
            configValue: "1",
            exec: () => UpdateConfig.setMonkeyPowerLevel("1"),
        },
        {
            id: "monkeyPowerLevel2",
            display: "high",
            configValue: "2",
            exec: () => UpdateConfig.setMonkeyPowerLevel("2"),
        },
        {
            id: "monkeyPowerLevel3",
            display: "ultra",
            configValue: "3",
            exec: () => UpdateConfig.setMonkeyPowerLevel("3"),
        },
        {
            id: "monkeyPowerLevel4",
            display: "over 9000",
            configValue: "4",
            exec: () => UpdateConfig.setMonkeyPowerLevel("4"),
        },
    ],
};
exports.defaultCommands = {
    title: "",
    list: [
        {
            id: "changePunctuation",
            display: "Punctuation...",
            icon: "!?",
            subgroup: commandsPunctuation,
        },
        {
            id: "changeMode",
            display: "Mode...",
            icon: "fa-bars",
            subgroup: commandsMode,
        },
        {
            id: "changeTimeConfig",
            display: "Time...",
            icon: "fa-clock",
            subgroup: commandsTimeConfig,
        },
        {
            id: "changeWordCount",
            display: "Words...",
            alias: "words",
            icon: "fa-font",
            subgroup: commandsWordCount,
        },
        {
            id: "changeQuoteLength",
            display: "Quote length...",
            icon: "fa-quote-right",
            alias: "quotes",
            subgroup: commandsQuoteLengthConfig,
        },
        {
            visible: false,
            id: "changeTags",
            display: "Tags...",
            icon: "fa-tag",
            subgroup: commandsTags,
            beforeSubgroup: () => {
                updateTagCommands();
            },
            // exec: (): void => {
            //   updateTagCommands();
            //   current.push();
            //   Commandline.show();
            // },
        },
        {
            visible: false,
            id: "applyPreset",
            display: "Presets...",
            icon: "fa-sliders-h",
            subgroup: commandsPresets,
            beforeSubgroup: () => {
                updatePresetCommands();
            },
            // exec: (): void => {
            //   updatePresetCommands();
            //   current.push(commandsPresets);
            //   Commandline.show();
            // },
        },
        {
            id: "changeConfidenceMode",
            display: "Confidence mode...",
            icon: "fa-backspace",
            subgroup: commandsConfidenceMode,
        },
        {
            id: "changeStopOnError",
            display: "Stop on error...",
            icon: "fa-hand-paper",
            subgroup: commandsStopOnError,
        },
        {
            id: "changeNumbers",
            display: "Numbers...",
            icon: "15",
            subgroup: commandsNumbers,
        },
        {
            id: "changeSmoothCaret",
            display: "Smooth caret...",
            icon: "fa-i-cursor",
            subgroup: commandsSmoothCaret,
        },
        {
            id: "changeQuickTab",
            display: "Quick tab...",
            icon: "fa-redo-alt",
            subgroup: commandsQuickTab,
        },
        {
            id: "changeRepeatQuotes",
            display: "Repeat quotes...",
            icon: "fa-sync-alt",
            subgroup: commandsRepeatQuotes,
        },
        {
            id: "changeLiveWpm",
            display: "Live WPM...",
            icon: "fa-tachometer-alt",
            subgroup: commandsLiveWpm,
        },
        {
            id: "changeLiveAcc",
            display: "Live accuracy...",
            icon: "fa-percentage",
            subgroup: commandsLiveAcc,
        },
        {
            id: "changeLiveBurst",
            display: "Live burst...",
            icon: "fa-fire-alt",
            subgroup: commandsLiveBurst,
        },
        {
            id: "changeShowTimer",
            display: "Timer/progress...",
            icon: "fa-clock",
            subgroup: commandsShowTimer,
        },
        {
            id: "changeKeyTips",
            display: "Key tips...",
            icon: "fa-question",
            subgroup: commandsKeyTips,
        },
        {
            id: "changeFreedomMode",
            display: "Freedom mode...",
            subgroup: commandsFreedomMode,
        },
        {
            id: "changeStrictSpace",
            display: "Strict space...",
            icon: "fa-minus",
            subgroup: commandsStrictSpace,
        },
        {
            id: "changeBlindMode",
            display: "Blind mode...",
            icon: "fa-eye-slash",
            subgroup: commandsBlindMode,
        },
        {
            id: "changeShowWordsHistory",
            display: "Always show words history...",
            icon: "fa-align-left",
            subgroup: commandsShowWordsHistory,
        },
        {
            id: "changeIndicateTypos",
            display: "Indicate typos...",
            icon: "fa-exclamation",
            subgroup: commandsIndicateTypos,
        },
        {
            id: "changeHideExtraLetters",
            display: "Hide extra letters...",
            icon: "fa-eye-slash",
            subgroup: commandsHideExtraLetters,
        },
        {
            id: "changeQuickEnd",
            display: "Quick end...",
            icon: "fa-step-forward",
            subgroup: commandsQuickEnd,
        },
        {
            id: "singleListCommandLine",
            display: "Single list command line...",
            icon: "fa-list",
            subgroup: commandsSingleListCommandLine,
        },
        {
            id: "capsLockWarning",
            display: "Caps lock warning...",
            icon: "fa-exclamation-triangle",
            subgroup: commandsCapsLockWarning,
        },
        {
            id: "changeMinWpm",
            display: "Minimum wpm...",
            alias: "minimum",
            icon: "fa-bomb",
            subgroup: commandsMinWpm,
        },
        {
            id: "changeMinAcc",
            display: "Minimum accuracy...",
            alias: "minimum",
            icon: "fa-bomb",
            subgroup: commandsMinAcc,
        },
        {
            id: "changeMinBurst",
            display: "Minimum burst...",
            alias: "minimum",
            icon: "fa-bomb",
            subgroup: commandsMinBurst,
        },
        {
            id: "changeOppositeShiftMode",
            display: "Change opposite shift mode...",
            icon: "fa-exchange-alt",
            subgroup: commandsOppositeShiftMode,
        },
        {
            id: "changeSoundOnClick",
            display: "Sound on click...",
            icon: "fa-volume-up",
            subgroup: commandsSoundOnClick,
        },
        {
            id: "changeSoundOnError",
            display: "Sound on error...",
            icon: "fa-volume-mute",
            subgroup: commandsSoundOnError,
        },
        {
            id: "changeSoundVolume",
            display: "Sound volume...",
            icon: "fa-volume-down",
            subgroup: commandsSoundVolume,
        },
        {
            id: "changeFlipTestColors",
            display: "Flip test colors...",
            icon: "fa-adjust",
            subgroup: commandsFlipTestColors,
        },
        {
            id: "changeSmoothLineScroll",
            display: "Smooth line scroll...",
            icon: "fa-align-left",
            subgroup: commandsSmoothLineScroll,
        },
        {
            id: "changeAlwaysShowDecimal",
            display: "Always show decimal places...",
            icon: "00",
            subgroup: commandsAlwaysShowDecimal,
        },
        {
            id: "changeAlwaysShowCPM",
            display: "Always show CPM...",
            icon: "fa-tachometer-alt",
            subgroup: commandsAlwaysShowCPM,
        },
        {
            id: "changeStartGraphsAtZero",
            display: "Start graphs at zero...",
            icon: "fa-chart-line",
            subgroup: commandsStartGraphsAtZero,
        },
        {
            id: "changeSwapEscAndTab",
            display: "Swap esc and tab...",
            icon: "fa-exchange-alt",
            subgroup: commandsSwapEscAndTab,
        },
        {
            id: "changeLazyMode",
            display: "Lazy mode...",
            icon: "fa-couch",
            subgroup: commandsLazyMode,
        },
        {
            id: "changeShowAllLines",
            display: "Show all lines...",
            icon: "fa-align-left",
            subgroup: commandsShowAllLines,
        },
        {
            id: "changeColorfulMode",
            display: "Colorful mode...",
            icon: "fa-fill-drip",
            subgroup: commandsColorfulMode,
        },
        {
            id: "changeOutOfFocusWarning",
            display: "Out of focus warning...",
            icon: "fa-exclamation",
            subgroup: commandsOutOfFocusWarning,
        },
        {
            id: "setEnableAds",
            display: "Enable ads...",
            icon: "fa-ad",
            subgroup: exports.commandsEnableAds,
        },
        {
            id: "changeTheme",
            display: "Theme...",
            icon: "fa-palette",
            subgroup: exports.themeCommands,
        },
        {
            id: "setCustomTheme",
            display: "Custom theme...",
            icon: "fa-palette",
            subgroup: exports.customThemeCommands,
        },
        {
            id: "setCustomThemeId",
            display: "Custom themes...",
            icon: "fa-palette",
            subgroup: exports.customThemeListCommands,
            beforeSubgroup: () => updateCustomThemeListCommands(),
            available: () => {
                return firebase_1.Auth.currentUser !== null;
            },
        },
        {
            id: "changeRandomTheme",
            display: "Random theme...",
            icon: "fa-random",
            subgroup: commandsRandomTheme,
        },
        {
            id: "randomizeTheme",
            display: "Next random theme",
            icon: "fa-random",
            exec: () => ThemeController.randomizeTheme(),
        },
        {
            id: "changeDifficulty",
            display: "Difficulty...",
            icon: "fa-star",
            subgroup: commandsDifficulty,
        },
        {
            id: "changeCaretStyle",
            display: "Caret style...",
            icon: "fa-i-cursor",
            subgroup: commandsCaretStyle,
        },
        {
            id: "changePaceCaret",
            display: "Pace caret mode...",
            icon: "fa-i-cursor",
            subgroup: commandsPaceCaret,
        },
        {
            id: "changePaceCaretStyle",
            display: "Pace caret style...",
            icon: "fa-i-cursor",
            subgroup: commandsPaceCaretStyle,
        },
        {
            id: "changeRepeatedPace",
            display: "Repeated pace...",
            icon: "fa-i-cursor",
            subgroup: commandsRepeatedPace,
        },
        {
            id: "changeTimerStyle",
            display: "Timer/progress style...",
            icon: "fa-clock",
            subgroup: commandsTimerStyle,
        },
        {
            id: "changeTimerColor",
            display: "Timer/progress color...",
            icon: "fa-clock",
            subgroup: commandsTimerColor,
        },
        {
            id: "changeTimerOpacity",
            display: "Timer/progress opacity...",
            icon: "fa-clock",
            subgroup: commandsTimerOpacity,
        },
        {
            id: "changeHighlightMode",
            display: "Highlight mode...",
            icon: "fa-highlighter",
            subgroup: commandsHighlightMode,
        },
        {
            id: "changeShowAverage",
            display: "Show average...",
            icon: "fa-chart-bar",
            subgroup: commandsShowAverage,
        },
        {
            id: "changeCustomBackground",
            display: "Custom background...",
            icon: "fa-image",
            defaultValue: "",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setCustomBackground(input);
            },
        },
        {
            id: "changeLanguage",
            display: "Language...",
            icon: "fa-language",
            subgroup: commandsLanguages,
        },
        {
            id: "changeBritishEnglish",
            display: "British english...",
            icon: "fa-language",
            subgroup: commandsBritishEnglish,
        },
        {
            id: "changeFunbox",
            display: "Funbox...",
            alias: "fun box",
            icon: "fa-gamepad",
            subgroup: commandsFunbox,
        },
        {
            id: "changeLayout",
            display: "Layout emulator...",
            icon: "fa-keyboard",
            subgroup: commandsLayouts,
        },
        {
            id: "toggleKeymap",
            display: "Keymap mode...",
            icon: "fa-keyboard",
            alias: "keyboard",
            subgroup: commandsKeymapMode,
        },
        {
            id: "changeKeymapStyle",
            display: "Keymap style...",
            alias: "keyboard",
            icon: "fa-keyboard",
            subgroup: commandsKeymapStyle,
        },
        {
            id: "changeKeymapLegendStyle",
            display: "Keymap legend style...",
            alias: "keyboard",
            icon: "fa-keyboard",
            subgroup: commandsKeymapLegendStyle,
        },
        {
            id: "changeKeymapLayout",
            display: "Keymap layout...",
            alias: "keyboard",
            icon: "fa-keyboard",
            subgroup: exports.commandsKeymapLayouts,
        },
        {
            id: "changeCustomLayoutfluid",
            display: "Custom layoutfluid...",
            defaultValue: "qwerty dvorak colemak",
            input: true,
            icon: "fa-tint",
            exec: (input) => {
                if (input === undefined)
                    return;
                UpdateConfig.setCustomLayoutfluid(input);
                if (config_1.default.funbox === "layoutfluid")
                    TestLogic.restart();
                // UpdateConfig.setLayout(
                //   Config.customLayoutfluid
                //     ? Config.customLayoutfluid.split("_")[0]
                //     : "qwerty"
                // );
                // UpdateConfig.setKeymapLayout(
                //   Config.customLayoutfluid
                //     ? Config.customLayoutfluid.split("_")[0]
                //     : "qwerty"
                // );
            },
        },
        {
            id: "changeFontSize",
            display: "Font size...",
            icon: "fa-font",
            subgroup: commandsFontSize,
        },
        {
            id: "changeFontFamily",
            display: "Font family...",
            icon: "fa-font",
            subgroup: commandsFonts,
        },
        {
            id: "changePageWidth",
            display: "Page width...",
            icon: "fa-arrows-alt-h",
            subgroup: commandsPageWidth,
        },
        {
            id: "viewTypingPage",
            display: "View Typing Page",
            alias: "start begin type test",
            icon: "fa-keyboard",
            exec: () => {
                $("#top #menu .icon-button.view-start").trigger("click");
            },
        },
        {
            id: "viewLeaderboards",
            display: "View Leaderboards Page",
            icon: "fa-crown",
            exec: () => {
                $("#top #menu .icon-button.view-leaderboards").trigger("click");
            },
        },
        {
            id: "viewAbout",
            display: "View About Page",
            icon: "fa-info",
            exec: () => {
                $("#top #menu .icon-button.view-about").trigger("click");
            },
        },
        {
            id: "viewSettings",
            display: "View Settings Page",
            icon: "fa-cog",
            exec: () => {
                $("#top #menu .icon-button.view-settings").trigger("click");
            },
        },
        {
            id: "viewQuoteSearchPopup",
            display: "Search for quotes",
            icon: "fa-search",
            exec: () => {
                UpdateConfig.setMode("quote");
                $("#quote-search-button").trigger("click");
            },
            shouldFocusTestUI: false,
        },
        {
            id: "viewAccount",
            display: "View Account Page",
            icon: "fa-user",
            alias: "stats",
            exec: () => {
                $("#top #menu .icon-button.view-account").hasClass("hidden")
                    ? $("#top #menu .icon-button.view-login").trigger("click")
                    : $("#top #menu .icon-button.view-account").trigger("click");
            },
        },
        {
            id: "toggleFullscreen",
            display: "Toggle Fullscreen",
            icon: "fa-expand",
            exec: () => {
                Misc.toggleFullscreen();
            },
        },
        {
            id: "bailOut",
            display: "Bail out...",
            icon: "fa-running",
            subgroup: {
                title: "Are you sure...",
                list: [
                    {
                        id: "bailOutNo",
                        display: "Nevermind",
                        available: () => {
                            return canBailOut();
                        },
                    },
                    {
                        id: "bailOutForSure",
                        display: "Yes, I am sure",
                        exec: () => {
                            TestInput.setBailout(true);
                            TestLogic.finish();
                        },
                        available: () => {
                            return canBailOut();
                        },
                    },
                ],
            },
            visible: false,
            available: () => {
                return canBailOut();
            },
        },
        {
            id: "loadChallenge",
            display: "Load challenge...",
            icon: "fa-award",
            subgroup: exports.commandsChallenges,
        },
        {
            id: "joinDiscord",
            display: "Join the Discord server",
            icon: "fa-users",
            exec: () => {
                window.open("https://discord.gg/monkeytype");
            },
        },
        {
            id: "repeatTest",
            display: "Repeat test",
            icon: "fa-sync-alt",
            exec: () => {
                TestLogic.restart(true);
            },
            available: () => {
                return TestUI.resultVisible;
            },
        },
        {
            id: "practiseWords",
            display: "Practice words...",
            icon: "fa-exclamation-triangle",
            subgroup: commandsPractiseWords,
            available: () => {
                return TestUI.resultVisible;
            },
        },
        {
            id: "toggleWordHistory",
            display: "Toggle word history",
            icon: "fa-align-left",
            exec: () => {
                TestUI.toggleResultWords();
            },
            available: () => {
                return TestUI.resultVisible;
            },
        },
        {
            id: "saveScreenshot",
            display: "Save screenshot",
            icon: "fa-image",
            alias: "ss picture",
            exec: () => {
                setTimeout(() => {
                    TestUI.screenshot();
                }, 500);
            },
            available: () => {
                return TestUI.resultVisible;
            },
        },
        {
            id: "changeCustomModeText",
            display: "Change custom text",
            icon: "fa-align-left",
            exec: () => {
                CustomTextPopup.show();
            },
        },
        {
            id: "toggleMonkey",
            display: "Toggle Monkey",
            icon: "fa-egg",
            visible: false,
            exec: () => {
                UpdateConfig.setMonkey(!config_1.default.monkey);
            },
        },
        {
            id: "copyWordsToClipboard",
            display: "Copy words to clipboard",
            icon: "fa-copy",
            subgroup: true,
            exec: () => {
                exports.current.push(commandsCopyWordsToClipboard);
            },
        },
        {
            id: "importSettingsJSON",
            display: "Import settings JSON",
            icon: "fa-cog",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                try {
                    UpdateConfig.apply(JSON.parse(input));
                    UpdateConfig.saveFullConfigToLocalStorage();
                    Settings.update();
                    Notifications.add("Done", 1);
                }
                catch (e) {
                    Notifications.add("An error occured while importing settings: " + e, -1);
                }
            },
        },
        {
            id: "exportSettingsJSON",
            display: "Export settings JSON",
            icon: "fa-cog",
            input: true,
            defaultValue: "",
        },
        {
            id: "monkeyPower",
            display: "Power mode...",
            alias: "powermode",
            icon: "fa-egg",
            visible: false,
            subgroup: commandsMonkeyPowerLevel,
        },
        {
            id: "clearSwCache",
            display: "Clear SW cache",
            icon: "fa-cog",
            exec: () => __awaiter(void 0, void 0, void 0, function* () {
                const clist = yield caches.keys();
                for (const name of clist) {
                    yield caches.delete(name);
                }
                window.location.reload();
            }),
        },
        {
            id: "getSwCache",
            display: "Get SW cache",
            icon: "fa-cog",
            exec: () => __awaiter(void 0, void 0, void 0, function* () {
                alert(yield caches.keys());
            }),
        },
    ],
};
exports.current = [exports.defaultCommands];
function setCurrent(val) {
    exports.current = val;
}
exports.setCurrent = setCurrent;
function pushCurrent(val) {
    exports.current.push(val);
}
exports.pushCurrent = pushCurrent;
const listsObject = {
    commandsChallenges: exports.commandsChallenges,
    commandsLanguages,
    commandsDifficulty,
    commandsLazyMode,
    commandsPaceCaret,
    commandsShowAverage,
    commandsMinWpm,
    commandsMinAcc,
    commandsMinBurst,
    commandsFunbox,
    commandsConfidenceMode,
    commandsStopOnError,
    commandsLayouts,
    commandsOppositeShiftMode,
    commandsTags,
};
function getList(list) {
    return listsObject[list];
}
exports.getList = getList;
ConfigEvent.subscribe((eventKey, eventValue) => {
    var _a;
    if (eventKey === "saveToLocalStorage") {
        exports.defaultCommands.list.filter((command) => command.id == "exportSettingsJSON")[0].defaultValue = eventValue;
    }
    if (eventKey === "customBackground") {
        exports.defaultCommands.list.filter((command) => command.id == "changeCustomBackground")[0].defaultValue = eventValue;
    }
    if (eventKey === "customLayoutFluid") {
        exports.defaultCommands.list.filter((command) => command.id == "changeCustomLayoutfluid")[0].defaultValue = (_a = eventValue) === null || _a === void 0 ? void 0 : _a.replace(/#/g, " ");
    }
});


/***/ }),

/***/ "./src/scripts/elements/commandline.ts":
/*!*********************************************!*\
  !*** ./src/scripts/elements/commandline.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.isSingleListCommandLineActive = void 0;
const ThemeController = __importStar(__webpack_require__(/*! ../controllers/theme-controller */ "./src/scripts/controllers/theme-controller.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Focus = __importStar(__webpack_require__(/*! ../test/focus */ "./src/scripts/test/focus.ts"));
const CommandlineLists = __importStar(__webpack_require__(/*! ./commandline-lists */ "./src/scripts/elements/commandline-lists.ts"));
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const AnalyticsController = __importStar(__webpack_require__(/*! ../controllers/analytics-controller */ "./src/scripts/controllers/analytics-controller.ts"));
const PageTransition = __importStar(__webpack_require__(/*! ../states/page-transition */ "./src/scripts/states/page-transition.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
let commandLineMouseMode = false;
function showInput(command, placeholder, defaultValue = "") {
    $("#commandLineWrapper").removeClass("hidden");
    $("#commandLine").addClass("hidden");
    $("#commandInput").removeClass("hidden");
    $("#commandInput input").attr("placeholder", placeholder);
    $("#commandInput input").val(defaultValue);
    $("#commandInput input").trigger("focus");
    $("#commandInput input").attr("command", "");
    $("#commandInput input").attr("command", command);
    if (defaultValue != "") {
        $("#commandInput input").select();
    }
}
function isSingleListCommandLineActive() {
    return $("#commandLine").hasClass("allCommands");
}
exports.isSingleListCommandLineActive = isSingleListCommandLineActive;
function showFound() {
    $("#commandLine .suggestions").empty();
    let commandsHTML = "";
    const list = CommandlineLists.current[CommandlineLists.current.length - 1];
    $.each(list.list, (_index, obj) => {
        var _a;
        if (obj.found && (obj.available !== undefined ? obj.available() : true)) {
            let icon = (_a = obj.icon) !== null && _a !== void 0 ? _a : "fa-chevron-right";
            const faIcon = /^fa-/g.test(icon);
            if (!faIcon) {
                icon = `<div class="textIcon">${icon}</div>`;
            }
            else {
                icon = `<i class="fas fa-fw ${icon}"></i>`;
            }
            if (list.configKey) {
                if ((obj.configValueMode &&
                    obj.configValueMode === "include" &&
                    // todo figure this out without using any
                    config_1.default[list.configKey].includes(obj.configValue)) ||
                    config_1.default[list.configKey] === obj.configValue) {
                    icon = `<i class="fas fa-fw fa-check"></i>`;
                }
                else {
                    icon = `<i class="fas fa-fw"></i>`;
                }
            }
            let iconHTML = `<div class="icon">${icon}</div>`;
            if (obj.noIcon && !isSingleListCommandLineActive()) {
                iconHTML = "";
            }
            commandsHTML += `<div class="entry" command="${obj.id}">${iconHTML}<div>${obj.display}</div></div>`;
        }
    });
    $("#commandLine .suggestions").html(commandsHTML);
    if ($("#commandLine .suggestions .entry").length == 0) {
        $("#commandLine .separator").css({ height: 0, margin: 0 });
    }
    else {
        $("#commandLine .separator").css({
            height: "1px",
            "margin-bottom": ".5rem",
        });
    }
    const entries = $("#commandLine .suggestions .entry");
    if (entries.length > 0) {
        $(entries[0]).addClass("activeKeyboard");
        try {
            $.each(list.list, (_index, obj) => {
                if (obj.found) {
                    if ((!/theme/gi.test(obj.id) || obj.id === "toggleCustomTheme") &&
                        !ThemeController.randomTheme) {
                        ThemeController.clearPreview();
                    }
                    if (!/font/gi.test(obj.id)) {
                        UpdateConfig.previewFontFamily(config_1.default.fontFamily);
                    }
                    if (obj.hover)
                        obj.hover();
                    return false;
                }
                else {
                    return true;
                }
            });
        }
        catch (e) { }
    }
    $("#commandLine .listTitle").remove();
}
function updateSuggested() {
    const inputVal = $("#commandLine input").val()
        .toLowerCase()
        .split(" ")
        .filter((s, i) => s || i == 0); //remove empty entries after first
    const list = CommandlineLists.current[CommandlineLists.current.length - 1];
    if (inputVal[0] === "" &&
        config_1.default.singleListCommandLine === "on" &&
        CommandlineLists.current.length === 1) {
        $.each(list.list, (_index, obj) => {
            obj.found = false;
        });
        showFound();
        return;
    }
    //ignore the preceeding ">"s in the command line input
    if (inputVal[0] && inputVal[0][0] == ">") {
        inputVal[0] = inputVal[0].replace(/^>+/, "");
    }
    if (inputVal[0] == "" && inputVal.length == 1) {
        $.each(list.list, (_index, obj) => {
            if (obj.visible !== false)
                obj.found = true;
        });
    }
    else {
        $.each(list.list, (_index, obj) => {
            let foundcount = 0;
            $.each(inputVal, (_index2, obj2) => {
                if (obj2 == "")
                    return;
                const escaped = obj2.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&");
                const re = new RegExp("\\b" + escaped, "g");
                const res = obj.display.toLowerCase().match(re);
                const res2 = obj.alias !== undefined ? obj.alias.toLowerCase().match(re) : null;
                if ((res != null && res.length > 0) ||
                    (res2 != null && res2.length > 0)) {
                    foundcount++;
                }
                else {
                    foundcount--;
                }
            });
            if (foundcount > inputVal.length - 1) {
                obj.found = true;
            }
            else {
                obj.found = false;
            }
        });
    }
    showFound();
}
let show = () => {
    if (!$(".page.pageLoading").hasClass("hidden"))
        return;
    Focus.set(false);
    $("#commandLine").removeClass("hidden");
    $("#commandInput").addClass("hidden");
    if ($("#commandLineWrapper").hasClass("hidden")) {
        $("#commandLineWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({
            opacity: 1,
        }, 100);
    }
    $("#commandLine input").val("");
    CommandlineLists.updateThemeCommands();
    updateSuggested();
    $("#commandLine input").trigger("focus");
};
exports.show = show;
function hide(shouldFocusTestUI = true) {
    UpdateConfig.previewFontFamily(config_1.default.fontFamily);
    // applyCustomThemeColors();
    if (!ThemeController.randomTheme) {
        ThemeController.clearPreview();
    }
    $("#commandLineWrapper")
        .stop(true, true)
        .css("opacity", 1)
        .animate({
        opacity: 0,
    }, 100, () => {
        $("#commandLineWrapper").addClass("hidden");
        $("#commandLine").removeClass("allCommands");
        if (shouldFocusTestUI) {
            TestUI.focusWords();
        }
    });
    if (shouldFocusTestUI) {
        TestUI.focusWords();
    }
}
function trigger(command) {
    let subgroup = false;
    let input = false;
    let shouldFocusTestUI = true;
    const list = CommandlineLists.current[CommandlineLists.current.length - 1];
    let sticky = false;
    $.each(list.list, (_index, obj) => {
        var _a;
        if (obj.id == command) {
            if (obj.shouldFocusTestUI !== undefined) {
                shouldFocusTestUI = obj.shouldFocusTestUI;
            }
            if (obj.input) {
                input = true;
                const escaped = (_a = obj.display.split("</i>")[1]) !== null && _a !== void 0 ? _a : obj.display;
                showInput(obj.id, escaped, obj.defaultValue);
            }
            else if (obj.subgroup) {
                subgroup = true;
                if (obj.beforeSubgroup) {
                    obj.beforeSubgroup();
                }
                CommandlineLists.current.push(obj.subgroup);
                (0, exports.show)();
            }
            else {
                if (obj.exec)
                    obj.exec();
                if (obj.sticky === true) {
                    sticky = true;
                }
            }
        }
    });
    if (!subgroup && !input && !sticky) {
        AnalyticsController.log("usedCommandLine", { command });
        hide(shouldFocusTestUI);
    }
}
//todo rewrite this mess
function addChildCommands(unifiedCommands, commandItem, parentCommandDisplay = "", parentCommand) {
    var _a, _b;
    let commandItemDisplay = commandItem.display.replace(/\s?\.\.\.$/g, "");
    let icon = `<i class="fas fa-fw"></i>`;
    if (commandItem.configValue !== undefined &&
        config_1.default[parentCommand === null || parentCommand === void 0 ? void 0 : parentCommand.configKey] ===
            commandItem.configValue) {
        icon = `<i class="fas fa-fw fa-check"></i>`;
    }
    if (commandItem.noIcon) {
        icon = "";
    }
    if (parentCommandDisplay) {
        commandItemDisplay =
            parentCommandDisplay + " > " + icon + commandItemDisplay;
    }
    if (commandItem.subgroup) {
        const command = commandItem;
        if (command.beforeSubgroup)
            command.beforeSubgroup();
        try {
            (_b = ((_a = commandItem) === null || _a === void 0 ? void 0 : _a.subgroup).list) === null || _b === void 0 ? void 0 : _b.forEach((cmd) => {
                commandItem.configKey = commandItem
                    .subgroup.configKey;
                addChildCommands(unifiedCommands, cmd, commandItemDisplay, commandItem);
            });
            // commandItem.exec();
            // const currentCommandsIndex = CommandlineLists.current.length - 1;
            // CommandlineLists.current[currentCommandsIndex].list.forEach((cmd) => {
            //   if (cmd.alias === undefined) cmd.alias = commandItem.alias;
            //   addChildCommands(unifiedCommands, cmd, commandItemDisplay);
            // });
            // CommandlineLists.current.pop();
        }
        catch (e) { }
    }
    else {
        const tempCommandItem = Object.assign({}, commandItem);
        if (parentCommand) {
            tempCommandItem.icon = parentCommand.icon;
        }
        if (parentCommandDisplay)
            tempCommandItem.display = commandItemDisplay;
        unifiedCommands.push(tempCommandItem);
    }
}
function generateSingleListOfCommands() {
    const allCommands = [];
    const oldShowCommandLine = exports.show;
    exports.show = () => {
        //
    };
    CommandlineLists.defaultCommands.list.forEach((c) => addChildCommands(allCommands, c));
    exports.show = oldShowCommandLine;
    return {
        title: "All Commands",
        list: allCommands,
    };
}
function useSingleListCommandLine(sshow = true) {
    const allCommands = generateSingleListOfCommands();
    // if (Config.singleListCommandLine == "manual") {
    // CommandlineLists.pushCurrent(allCommands);
    // } else if (Config.singleListCommandLine == "on") {
    CommandlineLists.setCurrent([allCommands]);
    // }
    if (config_1.default.singleListCommandLine != "manual") {
        $("#commandLine").addClass("allCommands");
    }
    if (sshow)
        (0, exports.show)();
}
function restoreOldCommandLine(sshow = true) {
    if (isSingleListCommandLineActive()) {
        $("#commandLine").removeClass("allCommands");
        CommandlineLists.setCurrent(CommandlineLists.current.filter((l) => l.title != "All Commands"));
        if (CommandlineLists.current.length < 1) {
            CommandlineLists.setCurrent([CommandlineLists.defaultCommands]);
        }
    }
    if (sshow)
        (0, exports.show)();
}
$("#commandLine input").keyup((e) => {
    commandLineMouseMode = false;
    $("#commandLineWrapper #commandLine .suggestions .entry").removeClass("activeMouse");
    if (e.key === "ArrowUp" ||
        e.key === "ArrowDown" ||
        e.key === "Enter" ||
        e.key === "Tab" ||
        e.code == "AltLeft" ||
        (e.key.length > 1 && e.key !== "Backspace" && e.key !== "Delete")) {
        return;
    }
    updateSuggested();
});
$(document).ready(() => {
    $(document).on("keydown", (event) => {
        if (PageTransition.get())
            return event.preventDefault();
        // opens command line if escape, ctrl/cmd + shift + p, or tab is pressed if the setting swapEscAndTab is enabled
        if (event.key === "Escape" ||
            (event.key &&
                event.key.toLowerCase() === "p" &&
                (event.metaKey || event.ctrlKey) &&
                event.shiftKey) ||
            (event.key === "Tab" && config_1.default.swapEscAndTab)) {
            event.preventDefault();
            const popups = document.querySelectorAll(".popupWrapper");
            let popupVisible = false;
            for (const popup of popups) {
                if (!popup.classList.contains("hidden") === true) {
                    popupVisible = true;
                    break;
                }
            }
            if (popupVisible)
                return;
            if (!$("#commandLineWrapper").hasClass("hidden")) {
                if (CommandlineLists.current.length > 1) {
                    CommandlineLists.current.pop();
                    $("#commandLine").removeClass("allCommands");
                    (0, exports.show)();
                }
                else {
                    hide();
                }
                UpdateConfig.setFontFamily(config_1.default.fontFamily, true);
            }
            else if (event.key === "Tab" || !config_1.default.swapEscAndTab) {
                if (config_1.default.singleListCommandLine == "on") {
                    useSingleListCommandLine(false);
                }
                else {
                    CommandlineLists.setCurrent([CommandlineLists.defaultCommands]);
                }
                (0, exports.show)();
            }
        }
    });
});
$("#commandInput input").on("keydown", (e) => {
    if (e.key === "Enter") {
        //enter
        e.preventDefault();
        const command = $("#commandInput input").attr("command");
        const value = $("#commandInput input").val();
        const list = CommandlineLists.current[CommandlineLists.current.length - 1];
        $.each(list.list, (_index, obj) => {
            if (obj.id == command) {
                if (obj.exec)
                    obj.exec(value);
                if (obj.subgroup !== null && obj.subgroup !== undefined) {
                    //TODO: what is this for?
                    // subgroup = obj.subgroup;
                }
            }
        });
        AnalyticsController.log("usedCommandLine", { command: command !== null && command !== void 0 ? command : "" });
        hide();
    }
    return;
});
$(document).on("mousemove", () => {
    if (!commandLineMouseMode)
        commandLineMouseMode = true;
});
$(document).on("mouseenter", "#commandLineWrapper #commandLine .suggestions .entry", (e) => {
    if (!commandLineMouseMode)
        return;
    $(e.target).addClass("activeMouse");
});
$(document).on("mouseleave", "#commandLineWrapper #commandLine .suggestions .entry", (e) => {
    if (!commandLineMouseMode)
        return;
    $(e.target).removeClass("activeMouse");
});
$("#commandLineWrapper #commandLine .suggestions").on("mouseover", (e) => {
    if (!commandLineMouseMode)
        return;
    // console.log("clearing keyboard active");
    $("#commandLineWrapper #commandLine .suggestions .entry").removeClass("activeKeyboard");
    const hoverId = $(e.target).attr("command");
    try {
        const list = CommandlineLists.current[CommandlineLists.current.length - 1];
        $.each(list.list, (_index, obj) => {
            if (obj.id == hoverId) {
                if ((!/theme/gi.test(obj.id) || obj.id === "toggleCustomTheme") &&
                    !ThemeController.randomTheme) {
                    ThemeController.clearPreview();
                }
                if (!/font/gi.test(obj.id)) {
                    UpdateConfig.previewFontFamily(config_1.default.fontFamily);
                }
                if (obj.hover)
                    obj.hover();
            }
        });
    }
    catch (e) { }
});
$(document).on("click", "#commandLineWrapper #commandLine .suggestions .entry", (e) => {
    $(".suggestions .entry").removeClass("activeKeyboard");
    trigger($(e.currentTarget).attr("command"));
});
$("#commandLineWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "commandLineWrapper") {
        hide();
        UpdateConfig.setFontFamily(config_1.default.fontFamily, true);
        // if (Config.customTheme === true) {
        //   applyCustomThemeColors();
        // } else {
        //   setTheme(Config.theme, true);
        // }
    }
});
//might come back to it later
// function shiftCommand(){
//   let activeEntries = $("#commandLineWrapper #commandLine .suggestions .entry.activeKeyboard, #commandLineWrapper #commandLine .suggestions .entry.activeMouse");
//   activeEntries.each((_index, activeEntry) => {
//     let commandId = activeEntry.getAttribute('command');
//     let foundCommand = null;
//     CommandlineLists.defaultCommands.list.forEach(command => {
//       if(foundCommand === null && command.id === commandId){
//         foundCommand = command;
//       }
//     })
//     if(foundCommand.shift){
//       $(activeEntry).find('div').text(foundCommand.shift.display);
//     }
//   })
// }
// let shiftedCommands = false;
// $(document).on("keydown", (e) => {
//   if (e.key === "Shift") {
//     if(shiftedCommands === false){
//       shiftedCommands = true;
//       shiftCommand();
//     }
//   }
// });
// $(document).keyup((e) => {
//   if (e.key === "Shift") {
//     shiftedCommands = false;
//   }
// });
$(document).on("keydown", (e) => {
    var _a, _b;
    // if (isPreviewingTheme) {
    // console.log("applying theme");
    // applyCustomThemeColors();
    // previewTheme(Config.theme, false);
    // }
    if (!$("#commandLineWrapper").hasClass("hidden")) {
        $("#commandLine input").trigger("focus");
        if (e.key == ">" && config_1.default.singleListCommandLine == "manual") {
            if (!isSingleListCommandLineActive()) {
                useSingleListCommandLine(false);
                return;
            }
            else if ($("#commandLine input").val() == ">") {
                //so that it will ignore succeeding ">" when input is already ">"
                e.preventDefault();
                return;
            }
        }
        if (e.key === "Backspace" || e.key === "Delete") {
            setTimeout(() => {
                const inputVal = $("#commandLine input").val();
                if (config_1.default.singleListCommandLine == "manual" &&
                    isSingleListCommandLineActive() &&
                    inputVal[0] !== ">") {
                    restoreOldCommandLine(false);
                }
            }, 1);
        }
        if (e.key === "Enter") {
            //enter
            e.preventDefault();
            const command = $(".suggestions .entry.activeKeyboard").attr("command");
            trigger(command);
            return;
        }
        if (e.key === "ArrowUp" || e.key === "ArrowDown" || e.key === "Tab") {
            e.preventDefault();
            $("#commandLineWrapper #commandLine .suggestions .entry").unbind("mouseenter mouseleave");
            const entries = $(".suggestions .entry");
            let activenum = -1;
            let hoverId;
            $.each(entries, (index, obj) => {
                if ($(obj).hasClass("activeKeyboard"))
                    activenum = index;
            });
            if (e.key === "ArrowUp" || (e.key === "Tab" && e.shiftKey)) {
                entries.removeClass("activeKeyboard");
                if (activenum == 0) {
                    $(entries[entries.length - 1]).addClass("activeKeyboard");
                    hoverId = $(entries[entries.length - 1]).attr("command");
                }
                else {
                    $(entries[--activenum]).addClass("activeKeyboard");
                    hoverId = $(entries[activenum]).attr("command");
                }
            }
            if (e.key === "ArrowDown" || (e.key === "Tab" && !e.shiftKey)) {
                entries.removeClass("activeKeyboard");
                if (activenum + 1 == entries.length) {
                    $(entries[0]).addClass("activeKeyboard");
                    hoverId = $(entries[0]).attr("command");
                }
                else {
                    $(entries[++activenum]).addClass("activeKeyboard");
                    hoverId = $(entries[activenum]).attr("command");
                }
            }
            try {
                const scroll = Math.abs(((_a = $(".suggestions").offset()) === null || _a === void 0 ? void 0 : _a.top) -
                    ((_b = $(".entry.activeKeyboard").offset()) === null || _b === void 0 ? void 0 : _b.top) -
                    $(".suggestions").scrollTop()) -
                    $(".suggestions").outerHeight() / 2 +
                    $($(".entry")[0]).outerHeight();
                $(".suggestions").scrollTop(scroll);
            }
            catch (e) {
                if (e instanceof Error) {
                    console.log("could not scroll suggestions: " + e.message);
                }
            }
            // console.log(`scrolling to ${scroll}`);
            try {
                const list = CommandlineLists.current[CommandlineLists.current.length - 1];
                $.each(list.list, (_index, obj) => {
                    if (obj.id == hoverId) {
                        if ((!/theme/gi.test(obj.id) || obj.id === "toggleCustomTheme") &&
                            !ThemeController.randomTheme) {
                            ThemeController.clearPreview();
                        }
                        if (!/font/gi.test(obj.id)) {
                            UpdateConfig.previewFontFamily(config_1.default.fontFamily);
                        }
                        if (obj.hover)
                            obj.hover();
                    }
                });
            }
            catch (e) { }
            return false;
        }
    }
    return;
});
$(document).on("click", "#commandLineMobileButton", () => {
    if (config_1.default.singleListCommandLine == "on") {
        useSingleListCommandLine(false);
    }
    else {
        CommandlineLists.setCurrent([CommandlineLists.defaultCommands]);
    }
    (0, exports.show)();
});
$(document).on("click", "#keymap .r5 .key-space", () => {
    CommandlineLists.setCurrent([CommandlineLists.commandsKeymapLayouts]);
    (0, exports.show)();
});
$(document).on("click", "#testModesNotice .text-button", (event) => {
    const commands = CommandlineLists.getList($(event.currentTarget).attr("commands"));
    if (commands !== undefined) {
        if ($(event.currentTarget).attr("commands") === "commandsTags") {
            CommandlineLists.updateTagCommands();
        }
        CommandlineLists.pushCurrent(commands);
        (0, exports.show)();
    }
});
$(document).on("click", "#bottom .leftright .right .current-theme", (e) => {
    if (e.shiftKey) {
        if (!config_1.default.customTheme) {
            if (firebase_1.Auth.currentUser !== null) {
                if (DB.getSnapshot().customThemes.length < 1) {
                    Notifications.add("No custom themes!", 0);
                    UpdateConfig.setCustomTheme(false);
                    // UpdateConfig.setCustomThemeId("");
                    return;
                }
                // if (!DB.getCustomThemeById(Config.customThemeId)) {
                //   // Turn on the first custom theme
                //   const firstCustomThemeId = DB.getSnapshot().customThemes[0]._id;
                //   UpdateConfig.setCustomThemeId(firstCustomThemeId);
                // }
            }
            UpdateConfig.setCustomTheme(true);
        }
        else
            UpdateConfig.setCustomTheme(false);
    }
    else {
        if (config_1.default.customTheme)
            CommandlineLists.updateCustomThemeListCommands();
        CommandlineLists.pushCurrent(config_1.default.customTheme
            ? CommandlineLists.customThemeListCommands
            : CommandlineLists.themeCommands);
        (0, exports.show)();
    }
});
$(document.body).on("click", ".pageAbout .aboutEnableAds", () => {
    CommandlineLists.pushCurrent(CommandlineLists.commandsEnableAds);
    (0, exports.show)();
});
$(".supportButtons .button.ads").on("click", () => {
    CommandlineLists.pushCurrent(CommandlineLists.commandsEnableAds);
    (0, exports.show)();
});


/***/ }),

/***/ "./src/scripts/elements/custom-background-filter.ts":
/*!**********************************************************!*\
  !*** ./src/scripts/elements/custom-background-filter.ts ***!
  \**********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.loadConfig = exports.apply = exports.getCSS = void 0;
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./notifications */ "./src/scripts/elements/notifications.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const filters = {
    blur: {
        value: 0,
        default: 0,
    },
    brightness: {
        value: 1,
        default: 1,
    },
    saturate: {
        value: 1,
        default: 1,
    },
    opacity: {
        value: 1,
        default: 1,
    },
};
function getCSS() {
    let ret = "";
    Object.keys(filters).forEach((filterKey) => {
        const key = filterKey;
        if (filters[key].value != filters[key].default) {
            ret += `${filterKey}(${filters[key].value}${filterKey == "blur" ? "rem" : ""}) `;
        }
    });
    return ret;
}
exports.getCSS = getCSS;
function apply() {
    const filterCSS = getCSS();
    const css = {
        filter: filterCSS,
        width: `calc(100% + ${filters.blur.value * 4}rem)`,
        height: `calc(100% + ${filters.blur.value * 4}rem)`,
        left: `-${filters.blur.value * 2}rem`,
        top: `-${filters.blur.value * 2}rem`,
        position: "absolute",
    };
    $(".customBackground img").css(css);
}
exports.apply = apply;
function syncSliders() {
    $(".section.customBackgroundFilter .blur input").val(filters["blur"].value);
    $(".section.customBackgroundFilter .brightness input").val(filters["brightness"].value);
    $(".section.customBackgroundFilter .saturate input").val(filters["saturate"].value);
    $(".section.customBackgroundFilter .opacity input").val(filters["opacity"].value);
}
function updateNumbers() {
    $(".section.customBackgroundFilter .blur .value").html(filters.blur.value.toFixed(1));
    $(".section.customBackgroundFilter .brightness .value").html(filters.brightness.value.toFixed(1));
    $(".section.customBackgroundFilter .saturate .value").html(filters.saturate.value.toFixed(1));
    $(".section.customBackgroundFilter .opacity .value").html(filters.opacity.value.toFixed(1));
}
function loadConfig(config) {
    filters.blur.value = config[0];
    filters.brightness.value = config[1];
    filters.saturate.value = config[2];
    filters.opacity.value = config[3];
    updateNumbers();
    syncSliders();
}
exports.loadConfig = loadConfig;
$(".section.customBackgroundFilter .blur input").on("input", () => {
    filters["blur"].value = parseFloat($(".section.customBackgroundFilter .blur input").val());
    updateNumbers();
    apply();
});
$(".section.customBackgroundFilter .brightness input").on("input", () => {
    filters["brightness"].value = parseFloat($(".section.customBackgroundFilter .brightness input").val());
    updateNumbers();
    apply();
});
$(".section.customBackgroundFilter .saturate input").on("input", () => {
    filters["saturate"].value = parseFloat($(".section.customBackgroundFilter .saturate input").val());
    updateNumbers();
    apply();
});
$(".section.customBackgroundFilter .opacity input").on("input", () => {
    filters["opacity"].value = parseFloat($(".section.customBackgroundFilter .opacity input").val());
    updateNumbers();
    apply();
});
$(".section.customBackgroundFilter  .save.button").on("click", () => {
    const arr = Object.keys(filters).map((filterKey) => filters[filterKey].value);
    UpdateConfig.setCustomBackgroundFilter(arr, false);
    Notifications.add("Custom background filters saved", 1);
});
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "customBackgroundFilter") {
        loadConfig(eventValue.map((ev) => parseFloat(ev)));
        apply();
    }
});


/***/ }),

/***/ "./src/scripts/elements/keymap.ts":
/*!****************************************!*\
  !*** ./src/scripts/elements/keymap.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.refresh = exports.show = exports.hide = exports.flashKey = exports.highlightKey = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ./theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
function highlightKey(currentKey) {
    if (config_1.default.mode === "zen")
        return;
    if (currentKey === "")
        currentKey = " ";
    try {
        if ($(".active-key") != undefined) {
            $(".active-key").removeClass("active-key");
        }
        let highlightKey;
        if (currentKey == " ") {
            highlightKey = "#keymap .key-space, #keymap .key-split-space";
        }
        else if (currentKey == '"') {
            highlightKey = `#keymap .keymap-key[data-key*='${currentKey}']`;
        }
        else {
            highlightKey = `#keymap .keymap-key[data-key*="${currentKey}"]`;
        }
        console.log("highlighting", highlightKey);
        $(highlightKey).addClass("active-key");
    }
    catch (e) {
        if (e instanceof Error) {
            console.log("could not update highlighted keymap key: " + e.message);
        }
    }
}
exports.highlightKey = highlightKey;
function flashKey(key, correct) {
    return __awaiter(this, void 0, void 0, function* () {
        if (key == undefined)
            return;
        if (key == " ") {
            key = "#keymap .key-space, #keymap .key-split-space";
        }
        else if (key == '"') {
            key = `#keymap .keymap-key[data-key*='${key}']`;
        }
        else {
            key = `#keymap .keymap-key[data-key*="${key}"]`;
        }
        const themecolors = yield ThemeColors.getAll();
        try {
            if (correct || config_1.default.blindMode) {
                $(key)
                    .stop(true, true)
                    .css({
                    color: themecolors.bg,
                    backgroundColor: themecolors.main,
                    borderColor: themecolors.main,
                })
                    .animate({
                    color: themecolors.sub,
                    backgroundColor: "transparent",
                    borderColor: themecolors.sub,
                }, SlowTimer.get() ? 0 : 500, "easeOutExpo");
            }
            else {
                $(key)
                    .stop(true, true)
                    .css({
                    color: themecolors.bg,
                    backgroundColor: themecolors.error,
                    borderColor: themecolors.error,
                })
                    .animate({
                    color: themecolors.sub,
                    backgroundColor: "transparent",
                    borderColor: themecolors.sub,
                }, SlowTimer.get() ? 0 : 500, "easeOutExpo");
            }
        }
        catch (e) { }
    });
}
exports.flashKey = flashKey;
function hide() {
    $("#keymap").addClass("hidden");
}
exports.hide = hide;
function show() {
    $("#keymap").removeClass("hidden");
}
exports.show = show;
function refresh(layoutName = config_1.default.layout) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!layoutName)
            return;
        try {
            const layouts = yield Misc.getLayoutsList();
            let lts = layouts[layoutName]; //layout to show
            let layoutString = layoutName;
            if (config_1.default.keymapLayout === "overrideSync") {
                if (config_1.default.layout === "default") {
                    lts = layouts["qwerty"];
                    layoutString = "default";
                }
                else {
                    lts = layouts[config_1.default.layout];
                    layoutString = config_1.default.layout;
                }
            }
            else {
                lts = layouts[config_1.default.keymapLayout];
                layoutString = config_1.default.keymapLayout;
            }
            const showTopRow = lts.keymapShowTopRow;
            const isMatrix = config_1.default.keymapStyle === "matrix" || config_1.default.keymapStyle === "split_matrix";
            let keymapElement = "";
            Object.keys(lts.keys).forEach((row, index) => {
                const rowKeys = lts.keys[row];
                let rowElement = "";
                if (row === "row1" && !showTopRow) {
                    return;
                }
                if ((row === "row2" || row === "row3" || row === "row4") && !isMatrix) {
                    rowElement += "<div></div>";
                }
                if (row === "row4" && lts.type !== "iso" && !isMatrix) {
                    rowElement += "<div></div>";
                }
                if (row === "row5") {
                    let layoutDisplay = layoutString.replace(/_/g, " ");
                    if (config_1.default.keymapLegendStyle === "blank") {
                        layoutDisplay = "";
                    }
                    rowElement += "<div></div>";
                    rowElement += `<div class="keymap-key key-space">
          <div class="letter">${layoutDisplay}</div>
        </div>`;
                    rowElement += `<div class="keymap-split-spacer"></div>`;
                    rowElement += `<div class="keymap-key key-split-space">
          <div class="letter"></div>
        </div>`;
                }
                else {
                    for (let i = 0; i < rowKeys.length; i++) {
                        if (row === "row2" && i === 12)
                            continue;
                        if ((config_1.default.keymapStyle === "matrix" ||
                            config_1.default.keymapStyle === "split_matrix") &&
                            i >= 10) {
                            continue;
                        }
                        const key = rowKeys[i];
                        const bump = row === "row3" && (i === 3 || i === 6) ? true : false;
                        let keyDisplay = key[0];
                        if (config_1.default.keymapLegendStyle === "blank") {
                            keyDisplay = "";
                        }
                        else if (config_1.default.keymapLegendStyle === "uppercase") {
                            keyDisplay = keyDisplay.toUpperCase();
                        }
                        const keyElement = `<div class="keymap-key" data-key="${key.replace('"', "&quot;")}">
              <span class="letter">${keyDisplay}</span>
              ${bump ? "<div class='bump'></div>" : ""}
          </div>`;
                        let splitSpacer = "";
                        if (config_1.default.keymapStyle === "split" ||
                            config_1.default.keymapStyle === "split_matrix" ||
                            config_1.default.keymapStyle === "alice") {
                            if (row === "row4" &&
                                (config_1.default.keymapStyle === "split" ||
                                    config_1.default.keymapStyle === "alice") &&
                                lts.type === "iso") {
                                if (i === 6) {
                                    splitSpacer += `<div class="keymap-split-spacer"></div>`;
                                }
                            }
                            else {
                                if (i === 5) {
                                    splitSpacer += `<div class="keymap-split-spacer"></div>`;
                                }
                            }
                        }
                        if (config_1.default.keymapStyle === "alice" && row === "row4") {
                            if ((lts.type === "iso" && i === 6) ||
                                (lts.type !== "iso" && i === 5)) {
                                splitSpacer += `<div class="extra-key"><span class="letter"></span></div>`;
                            }
                        }
                        rowElement += splitSpacer + keyElement;
                    }
                }
                keymapElement += `<div class="row r${index + 1}">${rowElement}</div>`;
            });
            $("#keymap").html(keymapElement);
            $("#keymap").removeClass("staggered");
            $("#keymap").removeClass("matrix");
            $("#keymap").removeClass("split");
            $("#keymap").removeClass("split_matrix");
            $("#keymap").removeClass("alice");
            $("#keymap").addClass(config_1.default.keymapStyle);
        }
        catch (e) {
            if (e instanceof Error) {
                console.log("something went wrong when changing layout, resettings: " + e.message);
                // UpdateConfig.setKeymapLayout("qwerty", true);
            }
        }
    });
}
exports.refresh = refresh;
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "layout" && config_1.default.keymapLayout === "overrideSync") {
        refresh(config_1.default.keymapLayout);
    }
    if (eventKey === "keymapLayout" || eventKey === "keymapStyle")
        refresh();
});


/***/ }),

/***/ "./src/scripts/elements/last-10-average.ts":
/*!*************************************************!*\
  !*** ./src/scripts/elements/last-10-average.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getAcc = exports.getWPM = exports.update = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestWords = __importStar(__webpack_require__(/*! ../test/test-words */ "./src/scripts/test/test-words.ts"));
let averageWPM = 0;
let averageAcc = 0;
function update() {
    return __awaiter(this, void 0, void 0, function* () {
        const mode2 = Misc.getMode2(config_1.default, TestWords.randomQuote);
        const [wpm, acc] = (yield DB.getUserAverage10(config_1.default.mode, mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode))
            .map(Misc.roundTo2)
            .map((num) => (config_1.default.alwaysShowDecimalPlaces ? Math.round(num) : num));
        averageWPM = wpm;
        averageAcc = acc;
    });
}
exports.update = update;
function getWPM() {
    return averageWPM;
}
exports.getWPM = getWPM;
function getAcc() {
    return averageAcc;
}
exports.getAcc = getAcc;


/***/ }),

/***/ "./src/scripts/elements/leaderboards.ts":
/*!**********************************************!*\
  !*** ./src/scripts/elements/leaderboards.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.hide = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./notifications */ "./src/scripts/elements/notifications.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const currentLeaderboard = "time_15";
let currentData = {
    15: [],
    60: [],
};
let currentRank = {
    15: {},
    60: {},
};
const requesting = {
    15: false,
    60: false,
};
const leaderboardSingleLimit = 50;
let updateTimer;
function clearTable(lb) {
    if (lb === 15) {
        $("#leaderboardsWrapper table.left tbody").empty();
        $("#leaderboardsWrapper table.left tfoot").empty();
    }
    else if (lb === 60) {
        $("#leaderboardsWrapper table.right tbody").empty();
        $("#leaderboardsWrapper table.right tfoot").empty();
    }
}
function reset() {
    currentData = {
        15: [],
        60: [],
    };
    currentRank = {
        15: {},
        60: {},
    };
}
function stopTimer() {
    clearInterval(updateTimer);
    updateTimer = undefined;
    $("#leaderboards .subTitle").text("Next update in: --:--");
}
function updateTimerElement() {
    const date = new Date();
    const minutesToNextUpdate = 14 - (date.getMinutes() % 15);
    const secondsToNextUpdate = 60 - date.getSeconds();
    const totalSeconds = minutesToNextUpdate * 60 + secondsToNextUpdate;
    $("#leaderboards .subTitle").text("Next update in: " + Misc.secondsToString(totalSeconds, true));
}
function startTimer() {
    updateTimerElement();
    updateTimer = setInterval(() => {
        updateTimerElement();
    }, 1000);
}
function showLoader(lb) {
    if (lb === 15) {
        $(`#leaderboardsWrapper .leftTableLoader`).removeClass("hidden");
    }
    else if (lb === 60) {
        $(`#leaderboardsWrapper .rightTableLoader`).removeClass("hidden");
    }
}
function hideLoader(lb) {
    if (lb === 15) {
        $(`#leaderboardsWrapper .leftTableLoader`).addClass("hidden");
    }
    else if (lb === 60) {
        $(`#leaderboardsWrapper .rightTableLoader`).addClass("hidden");
    }
}
function updateFooter(lb) {
    let side;
    if (lb === 15) {
        side = "left";
    }
    else {
        side = "right";
    }
    $(`#leaderboardsWrapper table.${side} tfoot`).html(`
    <tr>
      <td><br><br></td>
      <td colspan="4" style="text-align:center;">Not qualified</>
      <td><br><br></td>
    </tr>
    `);
    let toppercent;
    if (currentRank[lb]) {
        let num = Misc.roundTo2((currentRank[lb]["rank"] / currentRank[lb].count) * 100);
        if (num == 0) {
            num = 0.01;
        }
        toppercent = `Top ${num}%`;
    }
    if (currentRank[lb]) {
        const entry = currentRank[lb];
        const date = new Date(entry.timestamp);
        $(`#leaderboardsWrapper table.${side} tfoot`).html(`
    <tr>
    <td>${entry.rank}</td>
    <td><span class="top">You</span><br><span class="sub">${toppercent}</span></td>
    <td class="alignRight">${(config_1.default.alwaysShowCPM
            ? entry.wpm * 5
            : entry.wpm).toFixed(2)}<br><div class="sub">${entry.acc.toFixed(2)}%</div></td>
    <td class="alignRight">${(config_1.default.alwaysShowCPM
            ? entry.raw * 5
            : entry.raw).toFixed(2)}<br><div class="sub">${!entry.consistency || entry.consistency === "-"
            ? "-"
            : entry.consistency.toFixed(2) + "%"}</div></td>
    <td class="alignRight">time<br><div class="sub">${lb}</div></td>
    <td class="alignRight">${(0, format_1.default)(date, "dd MMM yyyy")}<br>
    <div class='sub'>${(0, format_1.default)(date, "HH:mm")}</div></td>
  </tr>
  `);
    }
}
function checkLbMemory(lb) {
    var _a, _b, _c, _d, _e;
    let side;
    if (lb === 15) {
        side = "left";
    }
    else {
        side = "right";
    }
    const memory = (_e = (_d = (_c = (_b = (_a = DB.getSnapshot()) === null || _a === void 0 ? void 0 : _a.lbMemory) === null || _b === void 0 ? void 0 : _b.time) === null || _c === void 0 ? void 0 : _c[lb]) === null || _d === void 0 ? void 0 : _d["english"]) !== null && _e !== void 0 ? _e : 0;
    if (currentRank[lb]) {
        const difference = memory - currentRank[lb].rank;
        if (difference > 0) {
            DB.updateLbMemory("time", lb, "english", currentRank[lb].rank, true);
            if (memory !== 0) {
                $(`#leaderboardsWrapper table.${side} tfoot tr td .top`).append(` (<i class="fas fa-fw fa-angle-up"></i>${Math.abs(difference)} since you last checked)`);
            }
        }
        else if (difference < 0) {
            DB.updateLbMemory("time", lb, "english", currentRank[lb].rank, true);
            if (memory !== 0) {
                $(`#leaderboardsWrapper table.${side} tfoot tr td .top`).append(` (<i class="fas fa-fw fa-angle-down"></i>${Math.abs(difference)} since you last checked)`);
            }
        }
        else {
            if (memory !== 0) {
                $(`#leaderboardsWrapper table.${side} tfoot tr td .top`).append(` ( = since you last checked)`);
            }
        }
    }
}
function fillTable(lb, prepend) {
    var _a;
    if (!currentData[lb]) {
        return;
    }
    let side;
    if (lb === 15) {
        side = "left";
    }
    else {
        side = "right";
    }
    const loggedInUserName = (_a = DB.getSnapshot()) === null || _a === void 0 ? void 0 : _a.name;
    let a = currentData[lb].length - leaderboardSingleLimit;
    let b = currentData[lb].length;
    if (a < 0)
        a = 0;
    if (prepend) {
        a = 0;
        b = prepend;
    }
    let html = "";
    for (let i = a; i < b; i++) {
        const entry = currentData[lb][i];
        if (!entry) {
            break;
        }
        if (entry.hidden)
            return;
        let meClassString = "";
        if (entry.name == loggedInUserName) {
            meClassString = ' class="me"';
        }
        const date = new Date(entry.timestamp);
        html += `
    <tr ${meClassString}>
    <td>${entry.rank === 1 ? '<i class="fas fa-fw fa-crown"></i>' : entry.rank}</td>
    <td>${entry.name}</td>
    <td class="alignRight">${(config_1.default.alwaysShowCPM
            ? entry.wpm * 5
            : entry.wpm).toFixed(2)}<br><div class="sub">${entry.acc.toFixed(2)}%</div></td>
    <td class="alignRight">${(config_1.default.alwaysShowCPM
            ? entry.raw * 5
            : entry.raw).toFixed(2)}<br><div class="sub">${!entry.consistency || entry.consistency === "-"
            ? "-"
            : entry.consistency.toFixed(2) + "%"}</div></td>
    <td class="alignRight">time<br><div class="sub">${lb}</div></td>
    <td class="alignRight">${(0, format_1.default)(date, "dd MMM yyyy")}<br>
    <div class='sub'>${(0, format_1.default)(date, "HH:mm")}</div></td>
  </tr>
  `;
    }
    if (!prepend) {
        $(`#leaderboardsWrapper table.${side} tbody`).append(html);
    }
    else {
        $(`#leaderboardsWrapper table.${side} tbody`).prepend(html);
    }
}
function hide() {
    $("#leaderboardsWrapper")
        .stop(true, true)
        .css("opacity", 1)
        .animate({
        opacity: 0,
    }, 100, () => {
        clearTable(15);
        clearTable(60);
        reset();
        stopTimer();
        $("#leaderboardsWrapper").addClass("hidden");
    });
}
exports.hide = hide;
function update() {
    return __awaiter(this, void 0, void 0, function* () {
        $("#leaderboardsWrapper .buttons .button").removeClass("active");
        $(`#leaderboardsWrapper .buttons .button[board=${currentLeaderboard}]`).addClass("active");
        showLoader(15);
        showLoader(60);
        const leaderboardRequests = [
            ape_1.default.leaderboards.get("english", "time", "15", 0),
            ape_1.default.leaderboards.get("english", "time", "60", 0),
        ];
        if (firebase_1.Auth.currentUser) {
            leaderboardRequests.push(ape_1.default.leaderboards.getRank("english", "time", "15"), ape_1.default.leaderboards.getRank("english", "time", "60"));
        }
        const responses = yield Promise.all(leaderboardRequests);
        const failedResponse = responses.find((response) => response.status !== 200);
        if (failedResponse) {
            return Notifications.add("Failed to load leaderboards: " + failedResponse.message, -1);
        }
        const [lb15Data, lb60Data, lb15Rank, lb60Rank] = responses.map((response) => response.data);
        currentData[15] = lb15Data;
        currentData[60] = lb60Data;
        currentRank[15] = lb15Rank;
        currentRank[60] = lb60Rank;
        const leaderboardKeys = [15, 60];
        leaderboardKeys.forEach((leaderboardTime) => {
            hideLoader(leaderboardTime);
            clearTable(leaderboardTime);
            updateFooter(leaderboardTime);
            checkLbMemory(leaderboardTime);
            fillTable(leaderboardTime);
        });
        $("#leaderboardsWrapper .leftTableWrapper").removeClass("invisible");
        $("#leaderboardsWrapper .rightTableWrapper").removeClass("invisible");
    });
}
function requestMore(lb, prepend = false) {
    return __awaiter(this, void 0, void 0, function* () {
        if (prepend && currentData[lb][0].rank === 1)
            return;
        if (requesting[lb])
            return;
        requesting[lb] = true;
        showLoader(lb);
        let skipVal = currentData[lb][currentData[lb].length - 1].rank;
        if (prepend) {
            skipVal = currentData[lb][0].rank - leaderboardSingleLimit;
        }
        let limitVal;
        if (skipVal < 0) {
            limitVal = Math.abs(skipVal) - 1;
            skipVal = 0;
        }
        const response = yield ape_1.default.leaderboards.get("english", "time", lb, skipVal, limitVal);
        const data = response.data;
        if (response.status !== 200 || data.length === 0) {
            hideLoader(lb);
            return;
        }
        if (prepend) {
            currentData[lb].unshift(...data);
        }
        else {
            currentData[lb].push(...data);
        }
        if (prepend && !limitVal) {
            limitVal = leaderboardSingleLimit - 1;
        }
        fillTable(lb, limitVal);
        hideLoader(lb);
        requesting[lb] = false;
    });
}
function requestNew(lb, skip) {
    return __awaiter(this, void 0, void 0, function* () {
        showLoader(lb);
        const response = yield ape_1.default.leaderboards.get("english", "time", lb, skip);
        const data = response.data;
        clearTable(lb);
        currentData[lb] = [];
        if (response.status !== 200 || data.length === 0) {
            hideLoader(lb);
            return;
        }
        currentData[lb] = data;
        fillTable(lb);
        hideLoader(lb);
    });
}
function show() {
    if ($("#leaderboardsWrapper").hasClass("hidden")) {
        if (firebase_1.Auth.currentUser) {
            $("#leaderboardsWrapper #leaderboards .rightTableJumpToMe").removeClass("disabled");
            $("#leaderboardsWrapper #leaderboards .leftTableJumpToMe").removeClass("disabled");
        }
        else {
            $("#leaderboardsWrapper #leaderboards .rightTableJumpToMe").addClass("disabled");
            $("#leaderboardsWrapper #leaderboards .leftTableJumpToMe").addClass("disabled");
        }
        if (config_1.default.alwaysShowCPM) {
            $("#leaderboards table thead tr td:nth-child(3)").html('cpm<br><div class="sub">accuracy</div>');
        }
        else {
            $("#leaderboards table thead tr td:nth-child(3)").html('wpm<br><div class="sub">accuracy</div>');
        }
        $("#leaderboardsWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({
            opacity: 1,
        }, 125, () => {
            update();
            startTimer();
        });
    }
}
exports.show = show;
$("#leaderboardsWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "leaderboardsWrapper") {
        hide();
    }
});
// $("#leaderboardsWrapper .buttons .button").on("click",(e) => {
//   currentLeaderboard = $(e.target).attr("board");
//   update();
// });
let leftScrollEnabled = true;
$("#leaderboardsWrapper #leaderboards .leftTableWrapper").scroll((e) => {
    if (!leftScrollEnabled)
        return;
    const elem = $(e.currentTarget);
    if (Math.round(elem.scrollTop()) <= 50) {
        requestMore(15, true);
    }
});
$("#leaderboardsWrapper #leaderboards .leftTableWrapper").scroll((e) => {
    if (!leftScrollEnabled)
        return;
    const elem = $(e.currentTarget);
    if (Math.round(elem[0].scrollHeight - elem.scrollTop()) <=
        Math.round(elem.outerHeight()) + 50) {
        requestMore(15);
    }
});
let rightScrollEnabled = true;
$("#leaderboardsWrapper #leaderboards .rightTableWrapper").scroll((e) => {
    if (!rightScrollEnabled)
        return;
    const elem = $(e.currentTarget);
    if (Math.round(elem.scrollTop()) <= 50) {
        requestMore(60, true);
    }
});
$("#leaderboardsWrapper #leaderboards .rightTableWrapper").scroll((e) => {
    const elem = $(e.currentTarget);
    if (Math.round(elem[0].scrollHeight - elem.scrollTop()) <=
        Math.round(elem.outerHeight() + 50)) {
        requestMore(60);
    }
});
$("#leaderboardsWrapper #leaderboards .leftTableJumpToTop").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    leftScrollEnabled = false;
    $("#leaderboardsWrapper #leaderboards .leftTableWrapper").scrollTop(0);
    yield requestNew(15, 0);
    leftScrollEnabled = true;
}));
$("#leaderboardsWrapper #leaderboards .leftTableJumpToMe").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    if (currentRank[15].rank === undefined)
        return;
    leftScrollEnabled = false;
    yield requestNew(15, currentRank[15].rank - leaderboardSingleLimit / 2);
    const rowHeight = $("#leaderboardsWrapper #leaderboards .leftTableWrapper table tbody td").outerHeight();
    $("#leaderboardsWrapper #leaderboards .leftTableWrapper").animate({
        scrollTop: rowHeight *
            Math.min(currentRank[15].rank, leaderboardSingleLimit / 2) -
            $("#leaderboardsWrapper #leaderboards .leftTableWrapper").outerHeight() /
                2.25,
    }, 0, () => {
        leftScrollEnabled = true;
    });
}));
$("#leaderboardsWrapper #leaderboards .rightTableJumpToTop").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    rightScrollEnabled = false;
    $("#leaderboardsWrapper #leaderboards .rightTableWrapper").scrollTop(0);
    yield requestNew(60, 0);
    rightScrollEnabled = true;
}));
$("#leaderboardsWrapper #leaderboards .rightTableJumpToMe").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    if (currentRank[60].rank === undefined)
        return;
    leftScrollEnabled = false;
    yield requestNew(60, currentRank[60].rank - leaderboardSingleLimit / 2);
    const rowHeight = $("#leaderboardsWrapper #leaderboards .rightTableWrapper table tbody td").outerHeight();
    $("#leaderboardsWrapper #leaderboards .rightTableWrapper").animate({
        scrollTop: rowHeight *
            Math.min(currentRank[60].rank, leaderboardSingleLimit / 2) -
            $("#leaderboardsWrapper #leaderboards .rightTableWrapper").outerHeight() /
                2.25,
    }, 0, () => {
        leftScrollEnabled = true;
    });
}));
$(document).on("click", "#top #menu .icon-button", (e) => {
    if ($(e.currentTarget).hasClass("leaderboards")) {
        show();
    }
    return false;
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" && !$("#leaderboardsWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/elements/loader.ts":
/*!****************************************!*\
  !*** ./src/scripts/elements/loader.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
function show() {
    $("#backgroundLoader").stop(true, true).fadeIn(125);
}
exports.show = show;
function hide() {
    $("#backgroundLoader").stop(true, true).fadeOut(125);
}
exports.hide = hide;


/***/ }),

/***/ "./src/scripts/elements/modes-notice.ts":
/*!**********************************************!*\
  !*** ./src/scripts/elements/modes-notice.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = void 0;
const PaceCaret = __importStar(__webpack_require__(/*! ../test/pace-caret */ "./src/scripts/test/pace-caret.ts"));
const TestState = __importStar(__webpack_require__(/*! ../test/test-state */ "./src/scripts/test/test-state.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Last10Average = __importStar(__webpack_require__(/*! ../elements/last-10-average */ "./src/scripts/elements/last-10-average.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestWords = __importStar(__webpack_require__(/*! ../test/test-words */ "./src/scripts/test/test-words.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
ConfigEvent.subscribe((eventKey) => {
    if ([
        "difficulty",
        "blindMode",
        "stopOnError",
        "paceCaret",
        "minWpm",
        "minAcc",
        "minBurst",
        "confidenceMode",
        "layout",
        "showAverage",
        "alwaysShowCPM",
    ].includes(eventKey)) {
        update();
    }
});
function update() {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        let anim = false;
        if ($(".pageTest #testModesNotice").text() === "")
            anim = true;
        $(".pageTest #testModesNotice").empty();
        if (TestState.isRepeated && config_1.default.mode !== "quote") {
            $(".pageTest #testModesNotice").append(`<div class="text-button restart" style="color:var(--error-color);"><i class="fas fa-sync-alt"></i>repeated</div>`);
        }
        if (TestWords.hasTab) {
            $(".pageTest #testModesNotice").append(`<div class="text-button"><i class="fas fa-long-arrow-alt-right"></i>shift + tab to restart</div>`);
        }
        if (TestState.activeChallenge) {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsChallenges"><i class="fas fa-award"></i>${TestState.activeChallenge.display}</div>`);
        }
        if (config_1.default.mode === "zen") {
            $(".pageTest #testModesNotice").append(`<div class="text-button"><i class="fas fa-poll"></i>shift + enter to finish zen </div>`);
        }
        $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsLanguages"><i class="fas fa-globe-americas"></i>${config_1.default.language.replace(/_/g, " ")}</div>`);
        if (config_1.default.difficulty === "expert") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsDifficulty"><i class="fas fa-star-half-alt"></i>expert</div>`);
        }
        else if (config_1.default.difficulty === "master") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsDifficulty"><i class="fas fa-star"></i>master</div>`);
        }
        if (config_1.default.blindMode) {
            $(".pageTest #testModesNotice").append(`<div class="text-button blind"><i class="fas fa-eye-slash"></i>blind</div>`);
        }
        if (config_1.default.lazyMode) {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsLazyMode"><i class="fas fa-couch"></i>lazy</div>`);
        }
        if (config_1.default.paceCaret !== "off" ||
            (config_1.default.repeatedPace && TestState.isPaceRepeat)) {
            let speed = "";
            try {
                speed = ` (${Math.round(PaceCaret.settings.wpm)} wpm)`;
            }
            catch (_b) { }
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsPaceCaret"><i class="fas fa-tachometer-alt"></i>${config_1.default.paceCaret === "average"
                ? "average"
                : config_1.default.paceCaret === "pb"
                    ? "pb"
                    : "custom"} pace${speed}</div>`);
        }
        if (config_1.default.showAverage !== "off") {
            let avgWPM = Last10Average.getWPM();
            let avgAcc = Last10Average.getAcc();
            if (!config_1.default.alwaysShowDecimalPlaces) {
                avgWPM = Math.round(avgWPM);
                avgAcc = Math.round(avgAcc);
            }
            if (firebase_1.Auth.currentUser && avgWPM > 0) {
                const avgWPMText = ["wpm", "both"].includes(config_1.default.showAverage)
                    ? config_1.default.alwaysShowCPM
                        ? `${Math.round(avgWPM * 5)} cpm`
                        : `${avgWPM} wpm`
                    : "";
                const avgAccText = ["acc", "both"].includes(config_1.default.showAverage)
                    ? `${avgAcc}% acc`
                    : "";
                const text = `${avgWPMText} ${avgAccText}`.trim();
                $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsShowAverage"><i class="fas fa-chart-bar"></i>avg: ${text}</div>`);
            }
        }
        if (config_1.default.minWpm !== "off") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsMinWpm"><i class="fas fa-bomb"></i>min ${config_1.default.minWpmCustomSpeed} wpm</div>`);
        }
        if (config_1.default.minAcc !== "off") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsMinAcc"><i class="fas fa-bomb"></i>min ${config_1.default.minAccCustom}% acc</div>`);
        }
        if (config_1.default.minBurst !== "off") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsMinBurst"><i class="fas fa-bomb"></i>min ${config_1.default.minBurstCustomSpeed} burst ${config_1.default.minBurst === "flex" ? "(flex)" : ""}</div>`);
        }
        if (config_1.default.funbox !== "none") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsFunbox"><i class="fas fa-gamepad"></i>${config_1.default.funbox.replace(/_/g, " ")}</div>`);
        }
        if (config_1.default.confidenceMode === "on") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsConfidenceMode"><i class="fas fa-backspace"></i>confidence</div>`);
        }
        if (config_1.default.confidenceMode === "max") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsConfidenceMode"><i class="fas fa-backspace"></i>max confidence</div>`);
        }
        if (config_1.default.stopOnError != "off") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsStopOnError"><i class="fas fa-hand-paper"></i>stop on ${config_1.default.stopOnError}</div>`);
        }
        if (config_1.default.layout !== "default") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsLayouts"><i class="fas fa-keyboard"></i>emulating ${config_1.default.layout.replace(/_/g, " ")}</div>`);
        }
        if (config_1.default.oppositeShiftMode !== "off") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsOppositeShiftMode"><i class="fas fa-exchange-alt"></i>opposite shift${config_1.default.oppositeShiftMode === "keymap" ? " (keymap)" : ""}</div>`);
        }
        let tagsString = "";
        try {
            (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
                if (tag.active === true) {
                    tagsString += tag.name + ", ";
                }
            });
            if (tagsString !== "") {
                $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsTags"><i class="fas fa-tag"></i>${tagsString.substring(0, tagsString.length - 2)}</div>`);
            }
        }
        catch (_c) { }
        if (anim) {
            $(".pageTest #testModesNotice")
                .css("transition", "none")
                .css("opacity", 0)
                .animate({
                opacity: 1,
            }, 125, () => {
                $(".pageTest #testModesNotice").css("transition", ".125s");
            });
        }
    });
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/elements/monkey-power.ts":
/*!**********************************************!*\
  !*** ./src/scripts/elements/monkey-power.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.addPower = exports.reset = exports.init = void 0;
const ThemeColors = __importStar(__webpack_require__(/*! ./theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
/**
 * @typedef {{ x: number, y: number }} vec2
 * @typedef {vec2 & { prev: vec2, vel: vec2, alpha: number, color: string }} Particle
 * @typedef {{ particles: Particle[], caret: any, canvas: HTMLCanvasElement, context2d: CanvasRenderingContext2D, rendering: boolean, lastFrame: number, deltaTime: number, resetTimeOut: number }} CTX
 */
/**
 * @type {CTX} ctx
 */
const ctx = {
    particles: [],
    rendering: false,
};
const gravity = 1000;
const drag = 0.05;
const particleSize = 4;
const particleFade = 0.6;
const particleInitVel = 1500;
const particleBounceMod = 0.3;
const particleCreateCount = [6, 3];
const shakeAmount = 10;
function createCanvas() {
    const canvas = document.createElement("canvas");
    canvas.style.cssText =
        "position:fixed;top:0;left:0;pointer-events:none;z-index:999999";
    canvas.height = window.innerHeight;
    canvas.width = window.innerWidth;
    window.addEventListener("resize", () => {
        canvas.height = window.innerHeight;
        canvas.width = window.innerWidth;
    });
    document.body.appendChild(canvas);
    return canvas;
}
/**
 * @param {number} x
 * @param {number} y
 * @param {string} color
 * @returns {Particle}
 */
function createParticle(x, y, color) {
    return {
        x,
        y,
        color,
        alpha: 1,
        prev: { x, y },
        vel: {
            x: particleInitVel - Math.random() * particleInitVel * 2,
            y: particleInitVel - Math.random() * particleInitVel * 2,
        },
    };
}
/**
 * @param {Particle} particle
 */
function updateParticle(particle) {
    if (!ctx.canvas || !ctx.deltaTime)
        return;
    particle.prev.x = particle.x;
    particle.prev.y = particle.y;
    // Update pos
    particle.x += particle.vel.x * ctx.deltaTime;
    particle.y += particle.vel.y * ctx.deltaTime;
    if (particle.x > ctx.canvas.width) {
        particle.vel.x *= -particleBounceMod;
        particle.x =
            ctx.canvas.width - (particle.x - ctx.canvas.width) * particleBounceMod;
    }
    else if (particle.x < 0) {
        particle.vel.x *= -particleBounceMod;
        particle.x *= -particleBounceMod;
    }
    if (particle.y > ctx.canvas.height) {
        particle.vel.y *= -particleBounceMod;
        particle.y =
            ctx.canvas.height - (particle.y - ctx.canvas.height) * particleBounceMod;
    }
    else if (particle.y < 0) {
        particle.vel.y *= -1;
        particle.y *= -1;
    }
    particle.vel.y += gravity * ctx.deltaTime;
    particle.vel.x *= 1 - drag * ctx.deltaTime;
    particle.alpha *= 1 - particleFade * ctx.deltaTime;
}
function init() {
    ctx.caret = $("#caret");
    ctx.canvas = createCanvas();
    ctx.context2d = ctx.canvas.getContext("2d");
}
exports.init = init;
function render() {
    if (!ctx.lastFrame || !ctx.context2d || !ctx.canvas)
        return;
    ctx.rendering = true;
    const time = Date.now();
    ctx.deltaTime = (time - ctx.lastFrame) / 1000;
    ctx.lastFrame = time;
    ctx.context2d.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
    const keep = [];
    for (let i = 0; i < ctx.particles.length; i++) {
        const particle = ctx.particles[i];
        if (particle.alpha < 0.1)
            continue;
        updateParticle(particle);
        ctx.context2d.globalAlpha = particle.alpha;
        ctx.context2d.strokeStyle = particle.color;
        ctx.context2d.lineWidth = particleSize;
        ctx.context2d.beginPath();
        ctx.context2d.moveTo(Math.round(particle.prev.x), Math.round(particle.prev.y));
        ctx.context2d.lineTo(Math.round(particle.x), Math.round(particle.y));
        ctx.context2d.stroke();
        keep.push(particle);
    }
    ctx.particles = keep;
    if (ctx.particles.length && !SlowTimer.get()) {
        requestAnimationFrame(render);
    }
    else {
        ctx.context2d.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
        ctx.rendering = false;
    }
}
function reset(immediate = false) {
    if (!ctx.resetTimeOut)
        return;
    delete ctx.resetTimeOut;
    clearTimeout(ctx.resetTimeOut);
    const body = $(document.body);
    body.css("transition", "all .25s, transform 0.8s");
    body.css("transform", `translate(0,0)`);
    setTimeout(() => {
        body.css("transition", "all .25s, transform .05s");
        $("html").css("overflow", "inherit");
        $("html").css("overflow-y", "scroll");
    }, immediate ? 0 : 1000);
}
exports.reset = reset;
function startRender() {
    if (!ctx.rendering) {
        ctx.lastFrame = Date.now();
        render();
    }
}
function randomColor() {
    const r = Math.floor(Math.random() * 256).toString(16);
    const g = Math.floor(Math.random() * 256).toString(16);
    const b = Math.floor(Math.random() * 256).toString(16);
    return `#${r}${g}${b}`;
}
/**
 * @param {boolean} good Good power or not?
 */
function addPower(good = true, extra = false) {
    var _a, _b, _c, _d, _e;
    return __awaiter(this, void 0, void 0, function* () {
        if (config_1.default.monkeyPowerLevel === "off" || SlowTimer.get())
            return;
        // Shake
        if (["3", "4"].includes(config_1.default.monkeyPowerLevel)) {
            $("html").css("overflow", "hidden");
            const shake = [
                Math.round(shakeAmount - Math.random() * shakeAmount),
                Math.round(shakeAmount - Math.random() * shakeAmount),
            ];
            $(document.body).css("transform", `translate(${shake[0]}px, ${shake[1]}px)`);
            if (ctx.resetTimeOut)
                clearTimeout(ctx.resetTimeOut);
            ctx.resetTimeOut = setTimeout(reset, 2000);
        }
        // Sparks
        const offset = (_a = ctx.caret) === null || _a === void 0 ? void 0 : _a.offset();
        const coords = [
            (_b = offset === null || offset === void 0 ? void 0 : offset.left) !== null && _b !== void 0 ? _b : 0,
            ((_c = offset === null || offset === void 0 ? void 0 : offset.top) !== null && _c !== void 0 ? _c : 0) + ((_e = (_d = ctx.caret) === null || _d === void 0 ? void 0 : _d.height()) !== null && _e !== void 0 ? _e : 0),
        ];
        for (let i = Math.round((particleCreateCount[0] + Math.random() * particleCreateCount[1]) *
            (extra ? 2 : 1)); i > 0; i--) {
            const color = ["2", "4"].includes(config_1.default.monkeyPowerLevel)
                ? randomColor()
                : good
                    ? yield ThemeColors.get("caret")
                    : yield ThemeColors.get("error");
            ctx.particles.push(createParticle(...coords, color));
        }
        startRender();
    });
}
exports.addPower = addPower;


/***/ }),

/***/ "./src/scripts/elements/notifications.ts":
/*!***********************************************!*\
  !*** ./src/scripts/elements/notifications.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.addBanner = exports.add = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
let id = 0;
class Notification {
    constructor(type, message, level, duration, customTitle, customIcon, closeCallback = () => {
        //
    }) {
        this.type = type;
        this.message = message;
        this.level = level;
        if (type === "banner") {
            this.duration = duration;
        }
        else {
            if (duration == undefined) {
                if (level === -1) {
                    this.duration = 0;
                }
                else {
                    this.duration = 3000;
                }
            }
            else {
                this.duration = duration * 1000;
            }
        }
        this.customTitle = customTitle;
        this.customIcon = customIcon;
        this.id = id++;
        this.closeCallback = closeCallback;
    }
    //level
    //0 - notice
    //1 - good
    //-1 - bad
    show() {
        let cls = "notice";
        let icon = `<i class="fas fa-fw fa-exclamation"></i>`;
        let title = "Notice";
        if (this.level === 1) {
            cls = "good";
            icon = `<i class="fas fa-fw fa-check"></i>`;
            title = "Success";
        }
        else if (this.level === -1) {
            cls = "bad";
            icon = `<i class="fas fa-fw fa-times"></i>`;
            title = "Error";
            console.error(this.message);
        }
        if (this.customTitle != undefined) {
            title = this.customTitle;
        }
        if (this.type === "banner") {
            icon = `<i class="fas fa-fw fa-bullhorn"></i>`;
        }
        if (this.customIcon != undefined) {
            icon = `<i class="fas fa-fw fa-${this.customIcon}"></i>`;
        }
        if (this.type === "notification") {
            // moveCurrentToHistory();
            const oldHeight = $("#notificationCenter .history").height();
            $("#notificationCenter .history").prepend(`
          
          <div class="notif ${cls}" id=${this.id}>
              <div class="icon">${icon}</div>
              <div class="message"><div class="title">${title}</div>${this.message}</div>
          </div>     

          `);
            const newHeight = $("#notificationCenter .history").height();
            $(`#notificationCenter .notif[id='${this.id}']`).remove();
            $("#notificationCenter .history")
                .css("margin-top", 0)
                .animate({
                marginTop: newHeight - oldHeight,
            }, 125, () => {
                $("#notificationCenter .history").css("margin-top", 0);
                $("#notificationCenter .history").prepend(`
          
                  <div class="notif ${cls}" id=${this.id}>
                      <div class="icon">${icon}</div>
                      <div class="message"><div class="title">${title}</div>${this.message}</div>
                  </div>     

              `);
                $(`#notificationCenter .notif[id='${this.id}']`)
                    .css("opacity", 0)
                    .animate({
                    opacity: 1,
                }, 125, () => {
                    $(`#notificationCenter .notif[id='${this.id}']`).css("opacity", "");
                });
                $(`#notificationCenter .notif[id='${this.id}']`).on("click", () => {
                    this.hide();
                    this.closeCallback();
                });
            });
            $(`#notificationCenter .notif[id='${this.id}']`).hover(() => {
                $(`#notificationCenter .notif[id='${this.id}']`).toggleClass("hover");
            });
        }
        else if (this.type === "banner") {
            let leftside = `<div class="icon lefticon">${icon}</div>`;
            if (/^images\/.*/.test(this.customIcon)) {
                leftside = `<div class="image" style="background-image: url(${this.customIcon})"></div>`;
            }
            $("#bannerCenter").prepend(`
        <div class="banner ${cls}" id="${this.id}">
        <div class="container">
          ${leftside}
          <div class="text">
            ${this.message}
          </div>
          ${this.duration >= 0
                ? `
          <div class="closeButton">
            <i class="fas fa-fw fa-times"></i>
          </div>
          `
                : `<div class="righticon">${icon}</div>`}
        </div>
      </div>
      `);
            const height = $("#bannerCenter").height();
            $("#centerContent").css("padding-top", height + Misc.convertRemToPixels(2) + "px");
            $("#notificationCenter").css("margin-top", height + "px");
            if (this.duration >= 0) {
                $(`#bannerCenter .banner[id='${this.id}'] .closeButton`).on("click", () => {
                    this.hide();
                    this.closeCallback();
                });
            }
        }
        if (this.duration > 0) {
            setTimeout(() => {
                this.hide();
            }, this.duration + 250);
        }
    }
    hide() {
        if (this.type === "notification") {
            $(`#notificationCenter .notif[id='${this.id}']`)
                .css("opacity", 1)
                .animate({
                opacity: 0,
            }, 125, () => {
                $(`#notificationCenter .notif[id='${this.id}']`).animate({
                    height: 0,
                }, 125, () => {
                    $(`#notificationCenter .notif[id='${this.id}']`).remove();
                });
            });
        }
        else if (this.type === "banner") {
            $(`#bannerCenter .banner[id='${this.id}']`).remove();
            const height = $("#bannerCenter").height();
            $("#centerContent").css("padding-top", height + Misc.convertRemToPixels(2) + "px");
            $("#notificationCenter").css("margin-top", height + "px");
        }
    }
}
function add(message, level = 0, duration, customTitle, customIcon, closeCallback) {
    // notificationHistory.push(
    new Notification("notification", message, level, duration, customTitle, customIcon, closeCallback).show();
    // );
}
exports.add = add;
function addBanner(message, level = -1, customIcon = "bullhorn", sticky = false, closeCallback) {
    // notificationHistory.push(
    new Notification("banner", message, level, sticky ? -1 : 0, undefined, customIcon, closeCallback).show();
    // );
}
exports.addBanner = addBanner;


/***/ }),

/***/ "./src/scripts/elements/psa.ts":
/*!*************************************!*\
  !*** ./src/scripts/elements/psa.ts ***!
  \*************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
const Notifications = __importStar(__webpack_require__(/*! ./notifications */ "./src/scripts/elements/notifications.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
function clearMemory() {
    window.localStorage.setItem("confirmedPSAs", JSON.stringify([]));
}
function getMemory() {
    var _a, _b;
    return (_b = JSON.parse((_a = window.localStorage.getItem("confirmedPSAs")) !== null && _a !== void 0 ? _a : "[]")) !== null && _b !== void 0 ? _b : [];
}
function setMemory(id) {
    const list = getMemory();
    list.push(id);
    window.localStorage.setItem("confirmedPSAs", JSON.stringify(list));
}
function getLatest() {
    return __awaiter(this, void 0, void 0, function* () {
        const response = yield ape_1.default.psas.get();
        if (response.message === "Server is down for maintenance") {
            Notifications.addBanner("Server is currently under maintenance. <a target= '_blank' href='https://monkeytype.instatus.com/'>Click here</a> for more info.", -1, "bullhorn", true);
            return [];
        }
        return response.data;
    });
}
function show() {
    return __awaiter(this, void 0, void 0, function* () {
        const latest = yield getLatest();
        if (latest == null || latest.length == 0) {
            clearMemory();
            return;
        }
        const localmemory = getMemory();
        latest.forEach((psa) => {
            var _a;
            if (localmemory.includes(psa._id) && ((_a = psa.sticky) !== null && _a !== void 0 ? _a : false) === false) {
                return;
            }
            if (psa.date) {
                const dateObj = new Date(psa.date);
                const diff = psa.date - Date.now();
                const string = (0, misc_1.secondsToString)(diff / 1000, false, false, "text", false, true);
                psa.message = psa.message.replace("{dateDifference}", string);
                psa.message = psa.message.replace("{dateNoTime}", (0, format_1.default)(dateObj, "dd MMM yyyy"));
                psa.message = psa.message.replace("{date}", (0, format_1.default)(dateObj, "dd MMM yyyy HH:mm"));
            }
            Notifications.addBanner(psa.message, psa.level, "bullhorn", psa.sticky, () => {
                setMemory(psa._id);
            });
        });
    });
}
exports.show = show;


/***/ }),

/***/ "./src/scripts/elements/scroll-to-top.ts":
/*!***********************************************!*\
  !*** ./src/scripts/elements/scroll-to-top.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
let visible = false;
$(".scrollToTopButton").on("click", () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
});
$(window).scroll(() => {
    const page = ActivePage.get();
    if (page == "test")
        return;
    if (page == "about" || page == "settings" || page == "account") {
        const scroll = window.scrollY;
        if (!visible && scroll > 100) {
            $(".scrollToTopButton").removeClass("invisible");
            visible = true;
        }
        else if (visible && scroll < 100) {
            $(".scrollToTopButton").addClass("invisible");
            visible = false;
        }
    }
});


/***/ }),

/***/ "./src/scripts/elements/theme-colors.ts":
/*!**********************************************!*\
  !*** ./src/scripts/elements/theme-colors.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = exports.reset = exports.getAll = exports.get = void 0;
let colors = {
    bg: "#323437",
    main: "#e2b714",
    caret: "#e2b714",
    sub: "#646669",
    text: "#d1d0c5",
    error: "#ca4754",
    errorExtra: "#7e2a33",
    colorfulError: "#ca4754",
    colorfulErrorExtra: "#7e2a33",
};
function get(color) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!colors[color])
            update();
        return colors[color];
    });
}
exports.get = get;
function getAll() {
    return __awaiter(this, void 0, void 0, function* () {
        if (!colors.bg)
            update();
        return colors;
    });
}
exports.getAll = getAll;
function reset() {
    colors = {
        bg: "",
        main: "",
        caret: "",
        sub: "",
        text: "",
        error: "",
        errorExtra: "",
        colorfulError: "",
        colorfulErrorExtra: "",
    };
}
exports.reset = reset;
function update() {
    const st = getComputedStyle(document.body);
    colors.bg = st.getPropertyValue("--bg-color").replace(" ", "");
    colors.main = st.getPropertyValue("--main-color").replace(" ", "");
    colors.caret = st.getPropertyValue("--caret-color").replace(" ", "");
    colors.sub = st.getPropertyValue("--sub-color").replace(" ", "");
    colors.text = st.getPropertyValue("--text-color").replace(" ", "");
    colors.error = st.getPropertyValue("--error-color").replace(" ", "");
    colors.errorExtra = st
        .getPropertyValue("--error-extra-color")
        .replace(" ", "");
    colors.colorfulError = st
        .getPropertyValue("--colorful-error-color")
        .replace(" ", "");
    colors.colorfulErrorExtra = st
        .getPropertyValue("--colorful-error-extra-color")
        .replace(" ", "");
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/elements/version-check.ts":
/*!***********************************************!*\
  !*** ./src/scripts/elements/version-check.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const Notifications = __importStar(__webpack_require__(/*! ./notifications */ "./src/scripts/elements/notifications.ts"));
// import * as VersionPopup from "./version-popup";
function setMemory(v) {
    window.localStorage.setItem("lastSeenVersion", v);
}
function getMemory() {
    var _a;
    return (_a = window.localStorage.getItem("lastSeenVersion")) !== null && _a !== void 0 ? _a : "";
}
function show(version) {
    return __awaiter(this, void 0, void 0, function* () {
        const memory = yield getMemory();
        if (memory === "") {
            setMemory(version);
            return;
        }
        if (window.location.hostname === "localhost" ||
            window.location.hostname === "127.0.0.1") {
            caches.keys().then(function (names) {
                for (const name of names)
                    caches.delete(name);
            });
        }
        if (memory === version)
            return;
        caches.keys().then(function (names) {
            for (const name of names)
                caches.delete(name);
        });
        Notifications.addBanner(`Version ${version} has been released. Click the version number in the bottom right to view the changelog.`, 1, "code-branch", false);
        setMemory(version);
    });
}
exports.show = show;


/***/ }),

/***/ "./src/scripts/firebase.ts":
/*!*********************************!*\
  !*** ./src/scripts/firebase.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.Analytics = exports.Auth = void 0;
// Import the functions you need from the SDKs you need
const app_1 = __webpack_require__(/*! firebase/app */ "./node_modules/firebase/app/dist/index.esm.js");
const auth_1 = __webpack_require__(/*! firebase/auth */ "./node_modules/firebase/auth/dist/index.esm.js");
const firebase_config_1 = __webpack_require__(/*! ./constants/firebase-config */ "./src/scripts/constants/firebase-config.ts"); // eslint-disable-line require-path-exists/exists
const analytics_1 = __webpack_require__(/*! firebase/analytics */ "./node_modules/firebase/analytics/dist/index.esm.js");
// Initialize Firebase
let app;
try {
    app = (0, app_1.initializeApp)(firebase_config_1.firebaseConfig);
    exports.Auth = (0, auth_1.getAuth)(app);
    exports.Analytics = (0, analytics_1.getAnalytics)(app);
}
catch (e) {
    console.error(e);
    $("body").text("Failed to initialize Firebase. Are you sure you have the correct config in the firebase-config.ts file?");
}


/***/ }),

/***/ "./src/scripts/index.ts":
/*!******************************!*\
  !*** ./src/scripts/index.ts ***!
  \******************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


// this file should be concatenated at the top of the legacy js files
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__webpack_require__(/*! ../styles/index.scss */ "./src/styles/index.scss");
__webpack_require__(/*! ./firebase */ "./src/scripts/firebase.ts");
const DB = __importStar(__webpack_require__(/*! ./db */ "./src/scripts/db.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ./config */ "./src/scripts/config.ts"));
const TestStats = __importStar(__webpack_require__(/*! ./test/test-stats */ "./src/scripts/test/test-stats.ts"));
const Replay = __importStar(__webpack_require__(/*! ./test/replay */ "./src/scripts/test/replay.ts"));
const TestTimer = __importStar(__webpack_require__(/*! ./test/test-timer */ "./src/scripts/test/test-timer.ts"));
const Result = __importStar(__webpack_require__(/*! ./test/result */ "./src/scripts/test/result.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test/test-input */ "./src/scripts/test/test-input.ts"));
__webpack_require__(/*! ./controllers/account-controller */ "./src/scripts/controllers/account-controller.ts");
const glarses_mode_1 = __webpack_require__(/*! ./states/glarses-mode */ "./src/scripts/states/glarses-mode.ts");
__webpack_require__(/*! ./test/caps-warning */ "./src/scripts/test/caps-warning.ts");
__webpack_require__(/*! ./popups/support-popup */ "./src/scripts/popups/support-popup.ts");
__webpack_require__(/*! ./popups/contact-popup */ "./src/scripts/popups/contact-popup.ts");
__webpack_require__(/*! ./popups/version-popup */ "./src/scripts/popups/version-popup.ts");
__webpack_require__(/*! ./popups/edit-preset-popup */ "./src/scripts/popups/edit-preset-popup.ts");
__webpack_require__(/*! ./popups/simple-popups */ "./src/scripts/popups/simple-popups.ts");
__webpack_require__(/*! ./controllers/input-controller */ "./src/scripts/controllers/input-controller.ts");
__webpack_require__(/*! ./ready */ "./src/scripts/ready.ts");
__webpack_require__(/*! ./ui */ "./src/scripts/ui.ts");
__webpack_require__(/*! ./pages/about */ "./src/scripts/pages/about.ts");
__webpack_require__(/*! ./popups/pb-tables-popup */ "./src/scripts/popups/pb-tables-popup.ts");
__webpack_require__(/*! ./elements/scroll-to-top */ "./src/scripts/elements/scroll-to-top.ts");
__webpack_require__(/*! ./popups/mobile-test-config-popup */ "./src/scripts/popups/mobile-test-config-popup.ts");
__webpack_require__(/*! ./popups/edit-tags-popup */ "./src/scripts/popups/edit-tags-popup.ts");
const Account = __importStar(__webpack_require__(/*! ./pages/account */ "./src/scripts/pages/account.ts"));
const extendedGlobal = __webpack_require__.g;
extendedGlobal.snapshot = DB.getSnapshot;
extendedGlobal.config = config_1.default;
extendedGlobal.toggleFilterDebug = Account.toggleFilterDebug;
extendedGlobal.glarsesMode = glarses_mode_1.enable;
extendedGlobal.stats = TestStats.getStats;
extendedGlobal.replay = Replay.getReplayExport;
extendedGlobal.enableTimerDebug = TestTimer.enableTimerDebug;
extendedGlobal.getTimerStats = TestTimer.getTimerStats;
extendedGlobal.toggleUnsmoothedRaw = Result.toggleUnsmoothedRaw;
extendedGlobal.enableSpacingDebug = TestInput.enableSpacingDebug;


/***/ }),

/***/ "./src/scripts/observables/config-event.ts":
/*!*************************************************!*\
  !*** ./src/scripts/observables/config-event.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch(key, newValue, nosave, previousValue, fullConfig) {
    subscribers.forEach((fn) => {
        try {
            fn(key, newValue, nosave, previousValue, fullConfig);
        }
        catch (e) {
            console.error("Config event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/observables/page-change-event.ts":
/*!******************************************************!*\
  !*** ./src/scripts/observables/page-change-event.ts ***!
  \******************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch(previousPage, newPage) {
    subscribers.forEach((fn) => {
        try {
            fn(previousPage, newPage);
        }
        catch (e) {
            console.error("Page change event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/observables/reset-requested-event.ts":
/*!**********************************************************!*\
  !*** ./src/scripts/observables/reset-requested-event.ts ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch() {
    subscribers.forEach((fn) => {
        try {
            fn();
        }
        catch (e) {
            console.error("Reset requested event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/observables/results-shown-event.ts":
/*!********************************************************!*\
  !*** ./src/scripts/observables/results-shown-event.ts ***!
  \********************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch(results) {
    subscribers.forEach((fn) => {
        try {
            fn(results);
        }
        catch (e) {
            console.error("Page change event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/observables/timer-event.ts":
/*!************************************************!*\
  !*** ./src/scripts/observables/timer-event.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch(key, value, value2) {
    subscribers.forEach((fn) => {
        try {
            fn(key, value, value2);
        }
        catch (e) {
            console.error("Timer event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/observables/word-typed-event.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/observables/word-typed-event.ts ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch(word, typedCorrectly, burst, currentTestWord) {
    subscribers.forEach((fn) => {
        try {
            fn(word, typedCorrectly, burst, currentTestWord);
        }
        catch (e) {
            console.error("Word Typed event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/pages/about.ts":
/*!************************************!*\
  !*** ./src/scripts/pages/about.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = exports.fill = exports.reset = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
function reset() {
    $(".pageAbout .contributors").empty();
    $(".pageAbout .supporters").empty();
}
exports.reset = reset;
function fill() {
    return __awaiter(this, void 0, void 0, function* () {
        const supporters = yield Misc.getSupportersList();
        const contributors = yield Misc.getContributorsList();
        supporters.forEach((supporter) => {
            $(".pageAbout .supporters").append(`
      <div>${supporter}</div>
    `);
        });
        contributors.forEach((contributor) => {
            $(".pageAbout .contributors").append(`
      <div>${contributor}</div>
    `);
        });
    });
}
exports.fill = fill;
exports.page = new page_1.default("about", $(".page.pageAbout"), "/about", () => {
    //
}, () => __awaiter(void 0, void 0, void 0, function* () {
    reset();
}), () => {
    fill();
}, () => {
    //
});


/***/ }),

/***/ "./src/scripts/pages/account.ts":
/*!**************************************!*\
  !*** ./src/scripts/pages/account.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = exports.update = exports.smoothHistory = exports.reset = exports.toggleFilterDebug = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const ResultFilters = __importStar(__webpack_require__(/*! ../account/result-filters */ "./src/scripts/account/result-filters.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const ChartController = __importStar(__webpack_require__(/*! ../controllers/chart-controller */ "./src/scripts/controllers/chart-controller.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const MiniResultChart = __importStar(__webpack_require__(/*! ../account/mini-result-chart */ "./src/scripts/account/mini-result-chart.ts"));
const AllTimeStats = __importStar(__webpack_require__(/*! ../account/all-time-stats */ "./src/scripts/account/all-time-stats.ts"));
const PbTables = __importStar(__webpack_require__(/*! ../account/pb-tables */ "./src/scripts/account/pb-tables.ts"));
const LoadingPage = __importStar(__webpack_require__(/*! ./loading */ "./src/scripts/pages/loading.ts"));
const Focus = __importStar(__webpack_require__(/*! ../test/focus */ "./src/scripts/test/focus.ts"));
const SignOutButton = __importStar(__webpack_require__(/*! ../account/sign-out-button */ "./src/scripts/account/sign-out-button.ts"));
const TodayTracker = __importStar(__webpack_require__(/*! ../test/today-tracker */ "./src/scripts/test/today-tracker.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
let filterDebug = false;
//toggle filterdebug
function toggleFilterDebug() {
    filterDebug = !filterDebug;
    if (filterDebug) {
        console.log("filterDebug is on");
    }
}
exports.toggleFilterDebug = toggleFilterDebug;
let filteredResults = [];
let visibleTableLines = 0;
function loadMoreLines(lineIndex) {
    var _a, _b;
    if (filteredResults == [] || filteredResults.length == 0)
        return;
    let newVisibleLines;
    if (lineIndex && lineIndex > visibleTableLines) {
        newVisibleLines = Math.ceil(lineIndex / 10) * 10;
    }
    else {
        newVisibleLines = visibleTableLines + 10;
    }
    for (let i = visibleTableLines; i < newVisibleLines; i++) {
        const result = filteredResults[i];
        if (!result)
            continue;
        let diff = result.difficulty;
        if (diff == undefined) {
            diff = "normal";
        }
        let raw;
        try {
            raw = config_1.default.alwaysShowCPM
                ? (result.rawWpm * 5).toFixed(2)
                : result.rawWpm.toFixed(2);
            if (raw == undefined) {
                raw = "-";
            }
        }
        catch (e) {
            raw = "-";
        }
        let icons = `<span aria-label="${(_a = result.language) === null || _a === void 0 ? void 0 : _a.replace("_", " ")}" data-balloon-pos="up"><i class="fas fa-fw fa-globe-americas"></i></span>`;
        if (diff === "normal") {
            icons += `<span aria-label="${result.difficulty}" data-balloon-pos="up"><i class="far fa-fw fa-star"></i></span>`;
        }
        else if (diff === "expert") {
            icons += `<span aria-label="${result.difficulty}" data-balloon-pos="up"><i class="fas fa-fw fa-star-half-alt"></i></span>`;
        }
        else if (diff === "master") {
            icons += `<span aria-label="${result.difficulty}" data-balloon-pos="up"><i class="fas fa-fw fa-star"></i></span>`;
        }
        if (result.punctuation) {
            icons += `<span aria-label="punctuation" data-balloon-pos="up" style="font-weight:900">!?</span>`;
        }
        if (result.numbers) {
            icons += `<span aria-label="numbers" data-balloon-pos="up" style="font-weight:900">15</span>`;
        }
        if (result.blindMode) {
            icons += `<span aria-label="blind mode" data-balloon-pos="up"><i class="fas fa-fw fa-eye-slash"></i></span>`;
        }
        if (result.lazyMode) {
            icons += `<span aria-label="lazy mode" data-balloon-pos="up"><i class="fas fa-fw fa-couch"></i></span>`;
        }
        if (result.funbox !== "none" && result.funbox !== undefined) {
            icons += `<span aria-label="${result.funbox.replace(/_/g, " ")}" data-balloon-pos="up"><i class="fas fa-gamepad"></i></span>`;
        }
        if (result.chartData === undefined) {
            icons += `<span class="miniResultChartButton" aria-label="No chart data found" data-balloon-pos="up"><i class="fas fa-chart-line"></i></span>`;
        }
        else if (result.chartData === "toolong") {
            icons += `<span class="miniResultChartButton" aria-label="Chart history is not available for long tests" data-balloon-pos="up"><i class="fas fa-chart-line"></i></span>`;
        }
        else {
            icons += `<span class="miniResultChartButton" aria-label="View graph" data-balloon-pos="up" filteredResultsId="${i}" style="opacity: 1"><i class="fas fa-chart-line"></i></span>`;
        }
        let tagNames = "";
        if (result.tags !== undefined && result.tags.length > 0) {
            result.tags.forEach((tag) => {
                var _a;
                (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((snaptag) => {
                    if (tag === snaptag._id) {
                        tagNames += snaptag.name + ", ";
                    }
                });
            });
            tagNames = tagNames.substring(0, tagNames.length - 2);
        }
        let restags;
        if (result.tags === undefined) {
            restags = "[]";
        }
        else {
            restags = JSON.stringify(result.tags);
        }
        let tagIcons = `<span id="resultEditTags" resultId="${result._id}" tags='${restags}' aria-label="no tags" data-balloon-pos="up" style="opacity: .25"><i class="fas fa-fw fa-tag"></i></span>`;
        if (tagNames !== "") {
            if (result.tags !== undefined && result.tags.length > 1) {
                tagIcons = `<span id="resultEditTags" resultId="${result._id}" tags='${restags}' aria-label="${tagNames}" data-balloon-pos="up"><i class="fas fa-fw fa-tags"></i></span>`;
            }
            else {
                tagIcons = `<span id="resultEditTags" resultId="${result._id}" tags='${restags}' aria-label="${tagNames}" data-balloon-pos="up"><i class="fas fa-fw fa-tag"></i></span>`;
            }
        }
        let consistency = "-";
        if (result.consistency) {
            consistency = result.consistency.toFixed(2) + "%";
        }
        let pb = (_b = result.isPb) === null || _b === void 0 ? void 0 : _b.toString();
        if (pb) {
            pb = '<i class="fas fa-fw fa-crown"></i>';
        }
        else {
            pb = "";
        }
        let charStats = "-";
        if (result.charStats) {
            charStats = result.charStats.join("/");
        }
        else {
            charStats = result.correctChars + "/" + result.incorrectChars + "/-/-";
        }
        const date = new Date(result.timestamp);
        $(".pageAccount .history table tbody").append(`
    <tr class="resultRow" id="result-${i}">
    <td>${pb}</td>
    <td>${(config_1.default.alwaysShowCPM ? result.wpm * 5 : result.wpm).toFixed(2)}</td>
    <td>${raw}</td>
    <td>${result.acc.toFixed(2)}%</td>
    <td>${consistency}</td>
    <td>${charStats}</td>
    <td>${result.mode} ${result.mode2}</td>
    <td class="infoIcons">${icons}</td>
    <td>${tagIcons}</td>
    <td>${(0, format_1.default)(date, "dd MMM yyyy")}<br>
    ${(0, format_1.default)(date, "HH:mm")}
    </td>
    </tr>`);
    }
    visibleTableLines = newVisibleLines;
    if (visibleTableLines >= filteredResults.length) {
        $(".pageAccount .loadMoreButton").addClass("hidden");
    }
    else {
        $(".pageAccount .loadMoreButton").removeClass("hidden");
    }
}
function reset() {
    $(".pageAccount .history table tbody").empty();
    ChartController.accountActivity.data.datasets[0].data = [];
    ChartController.accountActivity.data.datasets[1].data = [];
    ChartController.accountHistory.data.datasets[0].data = [];
    ChartController.accountHistory.data.datasets[1].data = [];
    ChartController.accountActivity.updateColors();
    ChartController.accountHistory.updateColors();
}
exports.reset = reset;
let totalSecondsFiltered = 0;
let chartData = [];
let accChartData = [];
function smoothHistory(factor) {
    const smoothedWpmData = Misc.smooth(chartData.map((a) => a.y), factor);
    const smoothedAccData = Misc.smooth(accChartData.map((a) => a.y), factor);
    const chartData2 = chartData.map((a, i) => {
        const ret = Object.assign({}, a);
        ret.y = smoothedWpmData[i];
        return ret;
    });
    const accChartData2 = accChartData.map((a, i) => {
        const ret = Object.assign({}, a);
        ret.y = smoothedAccData[i];
        return ret;
    });
    ChartController.accountHistory.data.datasets[0].data = chartData2;
    ChartController.accountHistory.data.datasets[1].data = accChartData2;
    if (chartData2.length || accChartData2.length) {
        ChartController.accountHistory.update();
    }
}
exports.smoothHistory = smoothHistory;
function applyHistorySmoothing() {
    const smoothing = $(".pageAccount .content .below .smoothing input").val();
    $(".pageAccount .content .below .smoothing .value").text(smoothing);
    smoothHistory(parseInt(smoothing));
}
function update() {
    function cont() {
        var _a;
        LoadingPage.updateText("Displaying stats...");
        LoadingPage.updateBar(100);
        console.log("updating account page");
        ThemeColors.update();
        ChartController.accountHistory.updateColors();
        ChartController.accountActivity.updateColors();
        AllTimeStats.update();
        PbTables.update();
        chartData = [];
        accChartData = [];
        const wpmChartData = [];
        visibleTableLines = 0;
        let topWpm = 0;
        let topMode = "";
        let testRestarts = 0;
        let totalWpm = 0;
        let testCount = 0;
        let last10 = 0;
        let wpmLast10total = 0;
        let topAcc = 0;
        let totalAcc = 0;
        let totalAcc10 = 0;
        const rawWpm = {
            total: 0,
            count: 0,
            last10Total: 0,
            last10Count: 0,
            max: 0,
        };
        // let totalSeconds = 0;
        totalSecondsFiltered = 0;
        let topCons = 0;
        let totalCons = 0;
        let totalCons10 = 0;
        let consCount = 0;
        const activityChartData = {};
        filteredResults = [];
        $(".pageAccount .history table tbody").empty();
        (_a = DB.getSnapshot().results) === null || _a === void 0 ? void 0 : _a.forEach((result) => {
            // totalSeconds += tt;
            var _a, _b, _c, _d, _e;
            //apply filters
            try {
                let resdiff = result.difficulty;
                if (resdiff == undefined) {
                    resdiff = "normal";
                }
                if (!ResultFilters.getFilter("difficulty", resdiff)) {
                    if (filterDebug) {
                        console.log(`skipping result due to difficulty filter`, result);
                    }
                    return;
                }
                if (!ResultFilters.getFilter("mode", result.mode)) {
                    if (filterDebug) {
                        console.log(`skipping result due to mode filter`, result);
                    }
                    return;
                }
                if (result.mode == "time") {
                    let timefilter = "custom";
                    if ([15, 30, 60, 120].includes(parseInt(result.mode2))) {
                        timefilter = result.mode2;
                    }
                    if (!ResultFilters.getFilter("time", timefilter)) {
                        if (filterDebug) {
                            console.log(`skipping result due to time filter`, result);
                        }
                        return;
                    }
                }
                else if (result.mode == "words") {
                    let wordfilter = "custom";
                    if ([10, 25, 50, 100, 200].includes(parseInt(result.mode2))) {
                        wordfilter = result.mode2;
                    }
                    if (!ResultFilters.getFilter("words", wordfilter)) {
                        if (filterDebug) {
                            console.log(`skipping result due to word filter`, result);
                        }
                        return;
                    }
                }
                if (result.quoteLength != null) {
                    let filter = undefined;
                    if (result.quoteLength === 0) {
                        filter = "short";
                    }
                    else if (result.quoteLength === 1) {
                        filter = "medium";
                    }
                    else if (result.quoteLength === 2) {
                        filter = "long";
                    }
                    else if (result.quoteLength === 3) {
                        filter = "thicc";
                    }
                    if (filter !== undefined &&
                        !ResultFilters.getFilter("quoteLength", filter)) {
                        if (filterDebug) {
                            console.log(`skipping result due to quoteLength filter`, result);
                        }
                        return;
                    }
                }
                let langFilter = ResultFilters.getFilter("language", (_a = result.language) !== null && _a !== void 0 ? _a : "english");
                if (result.language === "english_expanded" &&
                    ResultFilters.getFilter("language", "english_1k")) {
                    langFilter = true;
                }
                if (!langFilter) {
                    if (filterDebug) {
                        console.log(`skipping result due to language filter`, result);
                    }
                    return;
                }
                let puncfilter = "off";
                if (result.punctuation) {
                    puncfilter = "on";
                }
                if (!ResultFilters.getFilter("punctuation", puncfilter)) {
                    if (filterDebug) {
                        console.log(`skipping result due to punctuation filter`, result);
                    }
                    return;
                }
                let numfilter = "off";
                if (result.numbers) {
                    numfilter = "on";
                }
                if (!ResultFilters.getFilter("numbers", numfilter)) {
                    if (filterDebug) {
                        console.log(`skipping result due to numbers filter`, result);
                    }
                    return;
                }
                if (result.funbox === "none" || result.funbox === undefined) {
                    if (!ResultFilters.getFilter("funbox", "none")) {
                        if (filterDebug) {
                            console.log(`skipping result due to funbox filter`, result);
                        }
                        return;
                    }
                }
                else {
                    if (!ResultFilters.getFilter("funbox", result.funbox)) {
                        if (filterDebug) {
                            console.log(`skipping result due to funbox filter`, result);
                        }
                        return;
                    }
                }
                let tagHide = true;
                if (result.tags === undefined || result.tags.length === 0) {
                    //no tags, show when no tag is enabled
                    if (((_b = DB.getSnapshot().tags) === null || _b === void 0 ? void 0 : _b.length) || 0 > 0) {
                        if (ResultFilters.getFilter("tags", "none"))
                            tagHide = false;
                    }
                    else {
                        tagHide = false;
                    }
                }
                else {
                    //tags exist
                    const validTags = (_c = DB.getSnapshot().tags) === null || _c === void 0 ? void 0 : _c.map((t) => t._id);
                    if (validTags === undefined)
                        return;
                    result.tags.forEach((tag) => {
                        //check if i even need to check tags anymore
                        if (!tagHide)
                            return;
                        //check if tag is valid
                        if (validTags === null || validTags === void 0 ? void 0 : validTags.includes(tag)) {
                            //tag valid, check if filter is on
                            if (ResultFilters.getFilter("tags", tag))
                                tagHide = false;
                        }
                        else {
                            //tag not found in valid tags, meaning probably deleted
                            if (ResultFilters.getFilter("tags", "none"))
                                tagHide = false;
                        }
                    });
                }
                if (tagHide) {
                    if (filterDebug) {
                        console.log(`skipping result due to tag filter`, result);
                    }
                    return;
                }
                const timeSinceTest = Math.abs(result.timestamp - Date.now()) / 1000;
                let datehide = true;
                if (ResultFilters.getFilter("date", "all") ||
                    (ResultFilters.getFilter("date", "last_day") &&
                        timeSinceTest <= 86400) ||
                    (ResultFilters.getFilter("date", "last_week") &&
                        timeSinceTest <= 604800) ||
                    (ResultFilters.getFilter("date", "last_month") &&
                        timeSinceTest <= 2592000) ||
                    (ResultFilters.getFilter("date", "last_3months") &&
                        timeSinceTest <= 7776000)) {
                    datehide = false;
                }
                if (datehide) {
                    if (filterDebug) {
                        console.log(`skipping result due to date filter`, result);
                    }
                    return;
                }
                filteredResults.push(result);
            }
            catch (e) {
                Notifications.add("Something went wrong when filtering. Resetting filters.", 0);
                console.log(result);
                console.error(e);
                ResultFilters.reset();
                ResultFilters.updateActive();
                update();
            }
            //filters done
            //=======================================
            const resultDate = new Date(result.timestamp);
            resultDate.setSeconds(0);
            resultDate.setMinutes(0);
            resultDate.setHours(0);
            resultDate.setMilliseconds(0);
            const resultTimestamp = resultDate.getTime();
            if (Object.keys(activityChartData).includes(String(resultTimestamp))) {
                activityChartData[resultTimestamp].amount++;
                activityChartData[resultTimestamp].time +=
                    result.testDuration +
                        result.incompleteTestSeconds -
                        ((_d = result.afkDuration) !== null && _d !== void 0 ? _d : 0);
                activityChartData[resultTimestamp].totalWpm += result.wpm;
            }
            else {
                activityChartData[resultTimestamp] = {
                    amount: 1,
                    time: result.testDuration +
                        result.incompleteTestSeconds -
                        ((_e = result.afkDuration) !== null && _e !== void 0 ? _e : 0),
                    totalWpm: result.wpm,
                };
            }
            let tt = 0;
            if (result.testDuration == undefined &&
                result.mode2 !== "custom" &&
                result.mode2 !== "zen") {
                //test finished before testDuration field was introduced - estimate
                if (result.mode == "time") {
                    tt = result.mode2;
                }
                else if (result.mode == "words") {
                    tt = (result.mode2 / result.wpm) * 60;
                }
            }
            else {
                tt = parseFloat(result.testDuration); //legacy results could have a string here
            }
            if (result.incompleteTestSeconds != undefined) {
                tt += result.incompleteTestSeconds;
            }
            else if (result.restartCount != undefined &&
                result.restartCount > 0) {
                tt += (tt / 4) * result.restartCount;
            }
            // if (result.incompleteTestSeconds != undefined) {
            //   tt += result.incompleteTestSeconds;
            // } else if (result.restartCount != undefined && result.restartCount > 0) {
            //   tt += (tt / 4) * result.restartCount;
            // }
            totalSecondsFiltered += tt;
            if (last10 < 10) {
                last10++;
                wpmLast10total += result.wpm;
                totalAcc10 += result.acc;
                result.consistency !== undefined
                    ? (totalCons10 += result.consistency)
                    : 0;
            }
            testCount++;
            if (result.consistency !== undefined) {
                consCount++;
                totalCons += result.consistency;
                if (result.consistency > topCons) {
                    topCons = result.consistency;
                }
            }
            if (result.rawWpm != null) {
                if (rawWpm.last10Count < 10) {
                    rawWpm.last10Count++;
                    rawWpm.last10Total += result.rawWpm;
                }
                rawWpm.total += result.rawWpm;
                rawWpm.count++;
                if (result.rawWpm > rawWpm.max) {
                    rawWpm.max = result.rawWpm;
                }
            }
            if (result.acc > topAcc) {
                topAcc = result.acc;
            }
            totalAcc += result.acc;
            if (result.restartCount != undefined) {
                testRestarts += result.restartCount;
            }
            chartData.push({
                x: result.timestamp,
                y: config_1.default.alwaysShowCPM ? Misc.roundTo2(result.wpm * 5) : result.wpm,
                wpm: config_1.default.alwaysShowCPM
                    ? Misc.roundTo2(result.wpm * 5)
                    : result.wpm,
                acc: result.acc,
                mode: result.mode,
                mode2: result.mode2,
                punctuation: result.punctuation,
                language: result.language,
                timestamp: result.timestamp,
                difficulty: result.difficulty,
                raw: config_1.default.alwaysShowCPM
                    ? Misc.roundTo2(result.rawWpm * 5)
                    : result.rawWpm,
            });
            wpmChartData.push(result.wpm);
            accChartData.push({
                x: result.timestamp,
                y: 100 - result.acc,
                errorRate: 100 - result.acc,
            });
            if (result.wpm > topWpm) {
                const puncsctring = result.punctuation ? ",<br>with punctuation" : "";
                const numbsctring = result.numbers
                    ? ",<br> " + (result.punctuation ? "&" : "") + "with numbers"
                    : "";
                topWpm = result.wpm;
                if (result.mode == "custom")
                    topMode = result.mode;
                else {
                    topMode =
                        result.mode + " " + result.mode2 + puncsctring + numbsctring;
                }
            }
            totalWpm += result.wpm;
        });
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .group.history table thead tr td:nth-child(2)").text("cpm");
        }
        else {
            $(".pageAccount .group.history table thead tr td:nth-child(2)").text("wpm");
        }
        loadMoreLines();
        ////////
        const activityChartData_amount = [];
        const activityChartData_time = [];
        const activityChartData_avgWpm = [];
        // let lastTimestamp = 0;
        Object.keys(activityChartData).forEach((date) => {
            const dateInt = parseInt(date);
            activityChartData_amount.push({
                x: dateInt,
                y: activityChartData[dateInt].amount,
            });
            activityChartData_time.push({
                x: dateInt,
                y: Misc.roundTo2(activityChartData[dateInt].time),
                amount: activityChartData[dateInt].amount,
            });
            activityChartData_avgWpm.push({
                x: dateInt,
                y: Misc.roundTo2((config_1.default.alwaysShowCPM
                    ? activityChartData[dateInt].totalWpm * 5
                    : activityChartData[dateInt].totalWpm) /
                    activityChartData[dateInt].amount),
            });
            // lastTimestamp = date;
        });
        const accountActivityScaleOptions = ChartController.accountActivity.options.scales;
        if (config_1.default.alwaysShowCPM) {
            accountActivityScaleOptions["avgWpm"].title.text = "Average Cpm";
        }
        else {
            accountActivityScaleOptions["avgWpm"].title.text = "Average Wpm";
        }
        ChartController.accountActivity.data.datasets[0].data =
            activityChartData_time;
        ChartController.accountActivity.data.datasets[1].data =
            activityChartData_avgWpm;
        const accountHistoryScaleOptions = ChartController.accountHistory.options.scales;
        if (config_1.default.alwaysShowCPM) {
            accountHistoryScaleOptions["wpm"].title.text = "Characters per Minute";
        }
        else {
            accountHistoryScaleOptions["wpm"].title.text = "Words per Minute";
        }
        ChartController.accountHistory.data.datasets[0].data = chartData;
        ChartController.accountHistory.data.datasets[1].data = accChartData;
        const wpms = chartData.map((r) => r.y);
        const minWpmChartVal = Math.min(...wpms);
        const maxWpmChartVal = Math.max(...wpms);
        // let accuracies = accChartData.map((r) => r.y);
        accountHistoryScaleOptions["wpm"].max =
            Math.floor(maxWpmChartVal) + (10 - (Math.floor(maxWpmChartVal) % 10));
        if (!config_1.default.startGraphsAtZero) {
            accountHistoryScaleOptions["wpm"].min = Math.floor(minWpmChartVal);
        }
        else {
            accountHistoryScaleOptions["wpm"].min = 0;
        }
        if (chartData == [] || chartData.length == 0) {
            $(".pageAccount .group.noDataError").removeClass("hidden");
            $(".pageAccount .group.chart").addClass("hidden");
            $(".pageAccount .group.dailyActivityChart").addClass("hidden");
            $(".pageAccount .group.history").addClass("hidden");
            $(".pageAccount .triplegroup.stats").addClass("hidden");
        }
        else {
            $(".pageAccount .group.noDataError").addClass("hidden");
            $(".pageAccount .group.chart").removeClass("hidden");
            $(".pageAccount .group.dailyActivityChart").removeClass("hidden");
            $(".pageAccount .group.history").removeClass("hidden");
            $(".pageAccount .triplegroup.stats").removeClass("hidden");
        }
        $(".pageAccount .timeTotalFiltered .val").text(Misc.secondsToString(Math.round(totalSecondsFiltered), true, true));
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .highestWpm .title").text("highest cpm");
            $(".pageAccount .highestWpm .val").text(Misc.roundTo2(topWpm * 5));
        }
        else {
            $(".pageAccount .highestWpm .title").text("highest wpm");
            $(".pageAccount .highestWpm .val").text(Misc.roundTo2(topWpm));
        }
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .averageWpm .title").text("average cpm");
            $(".pageAccount .averageWpm .val").text(Math.round((totalWpm * 5) / testCount));
        }
        else {
            $(".pageAccount .averageWpm .title").text("average wpm");
            $(".pageAccount .averageWpm .val").text(Math.round(totalWpm / testCount));
        }
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .averageWpm10 .title").text("average cpm (last 10 tests)");
            $(".pageAccount .averageWpm10 .val").text(Math.round((wpmLast10total * 5) / last10));
        }
        else {
            $(".pageAccount .averageWpm10 .title").text("average wpm (last 10 tests)");
            $(".pageAccount .averageWpm10 .val").text(Math.round(wpmLast10total / last10));
        }
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .highestRaw .title").text("highest raw cpm");
            $(".pageAccount .highestRaw .val").text(Misc.roundTo2(rawWpm.max * 5));
        }
        else {
            $(".pageAccount .highestRaw .title").text("highest raw wpm");
            $(".pageAccount .highestRaw .val").text(Misc.roundTo2(rawWpm.max));
        }
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .averageRaw .title").text("average raw cpm");
            $(".pageAccount .averageRaw .val").text(Math.round((rawWpm.total * 5) / rawWpm.count));
        }
        else {
            $(".pageAccount .averageRaw .title").text("average raw wpm");
            $(".pageAccount .averageRaw .val").text(Math.round(rawWpm.total / rawWpm.count));
        }
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .averageRaw10 .title").text("average raw cpm (last 10 tests)");
            $(".pageAccount .averageRaw10 .val").text(Math.round((rawWpm.last10Total * 5) / rawWpm.last10Count));
        }
        else {
            $(".pageAccount .averageRaw10 .title").text("average raw wpm (last 10 tests)");
            $(".pageAccount .averageRaw10 .val").text(Math.round(rawWpm.last10Total / rawWpm.last10Count));
        }
        $(".pageAccount .highestWpm .mode").html(topMode);
        $(".pageAccount .testsTaken .val").text(testCount);
        $(".pageAccount .highestAcc .val").text(topAcc + "%");
        $(".pageAccount .avgAcc .val").text(Math.round(totalAcc / testCount) + "%");
        $(".pageAccount .avgAcc10 .val").text(Math.round(totalAcc10 / last10) + "%");
        if (totalCons == 0 || totalCons == undefined) {
            $(".pageAccount .avgCons .val").text("-");
            $(".pageAccount .avgCons10 .val").text("-");
        }
        else {
            $(".pageAccount .highestCons .val").text(topCons + "%");
            $(".pageAccount .avgCons .val").text(Math.round(totalCons / consCount) + "%");
            $(".pageAccount .avgCons10 .val").text(Math.round(totalCons10 / Math.min(last10, consCount)) + "%");
        }
        $(".pageAccount .testsStarted .val").text(`${testCount + testRestarts}`);
        $(".pageAccount .testsCompleted .val").text(`${testCount}(${Math.floor((testCount / (testCount + testRestarts)) * 100)}%)`);
        $(".pageAccount .testsCompleted .avgres").text(`
      ${(testRestarts / testCount).toFixed(1)} restarts per completed test
    `);
        const wpmPoints = filteredResults.map((r) => r.wpm).reverse();
        const trend = Misc.findLineByLeastSquares(wpmPoints);
        const wpmChange = trend[1][1] - trend[0][1];
        const wpmChangePerHour = wpmChange * (3600 / totalSecondsFiltered);
        const plus = wpmChangePerHour > 0 ? "+" : "";
        $(".pageAccount .group.chart .below .text").text(`Speed change per hour spent typing: ${plus +
            Misc.roundTo2(config_1.default.alwaysShowCPM ? wpmChangePerHour * 5 : wpmChangePerHour)} ${config_1.default.alwaysShowCPM ? "cpm" : "wpm"}.`);
        applyHistorySmoothing();
        ChartController.accountActivity.updateColors();
        LoadingPage.updateBar(100, true);
        setTimeout(() => {
            if (ActivePage.get() == "account")
                SignOutButton.show();
        }, 125);
        Focus.set(false);
        Misc.swapElements($(".pageAccount .preloader"), $(".pageAccount .content"), 250);
    }
    if (DB.getSnapshot() === null) {
        Notifications.add(`Missing account data. Please refresh.`, -1);
        $(".pageAccount .preloader").html("Missing account data. Please refresh.");
    }
    else if (DB.getSnapshot().results === undefined) {
        LoadingPage.updateBar(45, true);
        DB.getUserResults().then((d) => {
            TodayTracker.addAllFromToday();
            if (d) {
                ResultFilters.updateActive();
                update();
            }
        });
    }
    else {
        console.log("using db snap");
        try {
            cont();
        }
        catch (e) {
            console.error(e);
            Notifications.add(`Something went wrong: ${e}`, -1);
        }
    }
}
exports.update = update;
function sortAndRefreshHistory(keyString, headerClass, forceDescending = null) {
    // Removes styling from previous sorting requests:
    $("td").removeClass("header-sorted");
    $("td").children("i").remove();
    $(headerClass).addClass("header-sorted");
    if (filteredResults.length < 2)
        return;
    const key = keyString;
    // This allows to reverse the sorting order when clicking multiple times on the table header
    let descending = true;
    if (forceDescending !== null) {
        if (forceDescending == true) {
            $(headerClass).append('<i class="fas fa-sort-down" aria-hidden="true"></i>');
        }
        else {
            descending = false;
            $(headerClass).append('<i class="fas fa-sort-up" aria-hidden="true"></i>');
        }
    }
    else if (parseInt(filteredResults[0][key]) <=
        parseInt(filteredResults[filteredResults.length - 1][key])) {
        descending = true;
        $(headerClass).append('<i class="fas fa-sort-down" aria-hidden="true"></i>');
    }
    else {
        descending = false;
        $(headerClass).append('<i class="fas fa-sort-up", aria-hidden="true"></i>');
    }
    const temp = [];
    const parsedIndexes = [];
    while (temp.length < filteredResults.length) {
        let lowest = Number.MAX_VALUE;
        let highest = -1;
        let idx = -1;
        for (let i = 0; i < filteredResults.length; i++) {
            //find the lowest wpm with index not already parsed
            if (!descending) {
                if (filteredResults[i][key] <= lowest &&
                    !parsedIndexes.includes(i)) {
                    lowest = filteredResults[i][key];
                    idx = i;
                }
            }
            else {
                if (filteredResults[i][key] >= highest &&
                    !parsedIndexes.includes(i)) {
                    highest = filteredResults[i][key];
                    idx = i;
                }
            }
        }
        temp.push(filteredResults[idx]);
        parsedIndexes.push(idx);
    }
    filteredResults = temp;
    $(".pageAccount .history table tbody").empty();
    visibleTableLines = 0;
    loadMoreLines();
}
$(".pageAccount .toggleAccuracyOnChart").on("click", () => {
    UpdateConfig.setChartAccuracy(!config_1.default.chartAccuracy);
});
$(".pageAccount .toggleChartStyle").on("click", () => {
    if (config_1.default.chartStyle == "line") {
        UpdateConfig.setChartStyle("scatter");
    }
    else {
        UpdateConfig.setChartStyle("line");
    }
});
$(".pageAccount .loadMoreButton").on("click", () => {
    loadMoreLines();
});
$(".pageAccount #accountHistoryChart").on("click", () => {
    var _a, _b, _c;
    const index = ChartController.accountHistoryActiveIndex;
    loadMoreLines(index);
    if (!window)
        return;
    const windowHeight = (_a = $(window).height()) !== null && _a !== void 0 ? _a : 0;
    const offset = (_c = (_b = $(`#result-${index}`).offset()) === null || _b === void 0 ? void 0 : _b.top) !== null && _c !== void 0 ? _c : 0;
    const scrollTo = offset - windowHeight / 2;
    $([document.documentElement, document.body]).animate({
        scrollTop: scrollTo,
    }, 500);
    $(".resultRow").removeClass("active");
    $(`#result-${index}`).addClass("active");
});
$(document).on("click", ".pageAccount .miniResultChartButton", (event) => {
    var _a;
    console.log("updating");
    const filteredId = $(event.currentTarget).attr("filteredResultsId");
    if (filteredId === undefined)
        return;
    MiniResultChart.updateData(filteredResults[parseInt(filteredId)].chartData);
    MiniResultChart.show();
    MiniResultChart.updatePosition(event.pageX - ((_a = $(".pageAccount .miniResultChartWrapper").outerWidth()) !== null && _a !== void 0 ? _a : 0), event.pageY + 30);
});
$(document).on("click", ".history-wpm-header", () => {
    sortAndRefreshHistory("wpm", ".history-wpm-header");
});
$(document).on("click", ".history-raw-header", () => {
    sortAndRefreshHistory("rawWpm", ".history-raw-header");
});
$(document).on("click", ".history-acc-header", () => {
    sortAndRefreshHistory("acc", ".history-acc-header");
});
$(document).on("click", ".history-correct-chars-header", () => {
    sortAndRefreshHistory("correctChars", ".history-correct-chars-header");
});
$(document).on("click", ".history-incorrect-chars-header", () => {
    sortAndRefreshHistory("incorrectChars", ".history-incorrect-chars-header");
});
$(document).on("click", ".history-consistency-header", () => {
    sortAndRefreshHistory("consistency", ".history-consistency-header");
});
$(document).on("click", ".history-date-header", () => {
    sortAndRefreshHistory("timestamp", ".history-date-header");
});
// Resets sorting to by date' when applying filers (normal or advanced)
$(document).on("click", ".buttonsAndTitle .buttons .button", () => {
    // We want to 'force' descending sort:
    sortAndRefreshHistory("timestamp", ".history-date-header", true);
});
$(".pageAccount .topFilters .button, .pageAccount .filterButtons .button ").click(() => {
    setTimeout(() => {
        update();
    }, 0);
});
$(".pageAccount .content .below .smoothing input").on("input", () => {
    applyHistorySmoothing();
});
$(".pageAccount .content .group.aboveHistory .exportCSV").on("click", () => {
    Misc.downloadResultsCSV(filteredResults);
});
exports.page = new page_1.default("account", $(".page.pageAccount"), "/account", () => {
    SignOutButton.hide();
}, () => __awaiter(void 0, void 0, void 0, function* () {
    reset();
}), () => {
    update();
    // SignOutButton.show();
}, () => {
    //
});


/***/ }),

/***/ "./src/scripts/pages/loading.ts":
/*!**************************************!*\
  !*** ./src/scripts/pages/loading.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = exports.showBar = exports.updateText = exports.updateBar = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
function updateBar(percentage, fast) {
    const speed = fast ? 100 : 1000;
    $(".pageLoading .fill, .pageAccount .fill")
        .stop(true, true)
        .animate({
        width: percentage + "%",
    }, speed);
}
exports.updateBar = updateBar;
function updateText(text) {
    $(".pageLoading .text, .pageAccount .text").text(text);
}
exports.updateText = updateText;
function showBar() {
    return new Promise((resolve) => {
        Misc.swapElements($(".pageLoading .icon"), $(".pageLoading .barWrapper"), 125, () => {
            resolve();
        });
        Misc.swapElements($(".pageAccount .icon"), $(".pageAccount .barWrapper"), 125, () => {
            resolve();
        });
    });
}
exports.showBar = showBar;
exports.page = new page_1.default("loading", $(".page.pageLoading"), "/", () => __awaiter(void 0, void 0, void 0, function* () {
    //
}), () => __awaiter(void 0, void 0, void 0, function* () {
    //
}), () => {
    //
}, () => {
    //
});


/***/ }),

/***/ "./src/scripts/pages/login.ts":
/*!************************************!*\
  !*** ./src/scripts/pages/login.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = void 0;
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
exports.page = new page_1.default("login", $(".page.pageLogin"), "/login", () => {
    //
}, () => {
    //
}, () => {
    //
}, () => {
    //
});


/***/ }),

/***/ "./src/scripts/pages/page.ts":
/*!***********************************!*\
  !*** ./src/scripts/pages/page.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
class Page {
    constructor(name, element, pathname, beforeHide, afterHide, beforeShow, afterShow) {
        this.name = name;
        this.element = element;
        this.pathname = pathname;
        this.beforeHide = beforeHide;
        this.afterHide = afterHide;
        this.beforeShow = beforeShow;
        this.afterShow = afterShow;
    }
}
exports["default"] = Page;


/***/ }),

/***/ "./src/scripts/pages/settings.ts":
/*!***************************************!*\
  !*** ./src/scripts/pages/settings.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = exports.setEventDisabled = exports.update = exports.showAccountSection = exports.updateAuthSections = exports.updateDiscordSection = exports.hideAccountSection = exports.fillSettingsPage = exports.reset = exports.groups = void 0;
const settings_group_1 = __importDefault(__webpack_require__(/*! ../settings/settings-group */ "./src/scripts/settings/settings-group.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Sound = __importStar(__webpack_require__(/*! ../controllers/sound-controller */ "./src/scripts/controllers/sound-controller.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Funbox = __importStar(__webpack_require__(/*! ../test/funbox */ "./src/scripts/test/funbox.ts"));
const TagController = __importStar(__webpack_require__(/*! ../controllers/tag-controller */ "./src/scripts/controllers/tag-controller.ts"));
const PresetController = __importStar(__webpack_require__(/*! ../controllers/preset-controller */ "./src/scripts/controllers/preset-controller.ts"));
const ThemePicker = __importStar(__webpack_require__(/*! ../settings/theme-picker */ "./src/scripts/settings/theme-picker.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const ImportExportSettingsPopup = __importStar(__webpack_require__(/*! ../popups/import-export-settings-popup */ "./src/scripts/popups/import-export-settings-popup.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const ApeKeysPopup = __importStar(__webpack_require__(/*! ../popups/ape-keys-popup */ "./src/scripts/popups/ape-keys-popup.ts"));
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
exports.groups = {};
function initGroups() {
    return __awaiter(this, void 0, void 0, function* () {
        yield UpdateConfig.loadPromise;
        exports.groups.smoothCaret = new settings_group_1.default("smoothCaret", UpdateConfig.setSmoothCaret, "button");
        exports.groups.difficulty = new settings_group_1.default("difficulty", UpdateConfig.setDifficulty, "button");
        exports.groups.quickTab = new settings_group_1.default("quickTab", UpdateConfig.setQuickTabMode, "button");
        exports.groups.showLiveWpm = new settings_group_1.default("showLiveWpm", UpdateConfig.setShowLiveWpm, "button", () => {
            exports.groups["keymapMode"].updateInput();
        });
        exports.groups.showLiveAcc = new settings_group_1.default("showLiveAcc", UpdateConfig.setShowLiveAcc, "button");
        exports.groups.showLiveBurst = new settings_group_1.default("showLiveBurst", UpdateConfig.setShowLiveBurst, "button");
        exports.groups.showTimerProgress = new settings_group_1.default("showTimerProgress", UpdateConfig.setShowTimerProgress, "button");
        exports.groups.showAverage = new settings_group_1.default("showAverage", UpdateConfig.setShowAverage, "button");
        exports.groups.keymapMode = new settings_group_1.default("keymapMode", UpdateConfig.setKeymapMode, "button", () => {
            exports.groups["showLiveWpm"].updateInput();
        }, () => {
            if (config_1.default.keymapMode === "off") {
                $(".pageSettings .section.keymapStyle").addClass("hidden");
                $(".pageSettings .section.keymapLayout").addClass("hidden");
                $(".pageSettings .section.keymapLegendStyle").addClass("hidden");
            }
            else {
                $(".pageSettings .section.keymapStyle").removeClass("hidden");
                $(".pageSettings .section.keymapLayout").removeClass("hidden");
                $(".pageSettings .section.keymapLegendStyle").removeClass("hidden");
            }
        });
        exports.groups.keymapMatrix = new settings_group_1.default("keymapStyle", UpdateConfig.setKeymapStyle, "button");
        exports.groups.keymapLayout = new settings_group_1.default("keymapLayout", UpdateConfig.setKeymapLayout, "select");
        exports.groups.keymapLegendStyle = new settings_group_1.default("keymapLegendStyle", UpdateConfig.setKeymapLegendStyle, "button");
        exports.groups.showKeyTips = new settings_group_1.default("showKeyTips", UpdateConfig.setKeyTips, "button", undefined, () => {
            if (config_1.default.showKeyTips) {
                $(".pageSettings .tip").removeClass("hidden");
            }
            else {
                $(".pageSettings .tip").addClass("hidden");
            }
        });
        exports.groups.freedomMode = new settings_group_1.default("freedomMode", UpdateConfig.setFreedomMode, "button", () => {
            exports.groups["confidenceMode"].updateInput();
        });
        exports.groups.strictSpace = new settings_group_1.default("strictSpace", UpdateConfig.setStrictSpace, "button");
        exports.groups.oppositeShiftMode = new settings_group_1.default("oppositeShiftMode", UpdateConfig.setOppositeShiftMode, "button");
        exports.groups.confidenceMode = new settings_group_1.default("confidenceMode", UpdateConfig.setConfidenceMode, "button", () => {
            exports.groups["freedomMode"].updateInput();
            exports.groups["stopOnError"].updateInput();
        });
        exports.groups.indicateTypos = new settings_group_1.default("indicateTypos", UpdateConfig.setIndicateTypos, "button");
        exports.groups.hideExtraLetters = new settings_group_1.default("hideExtraLetters", UpdateConfig.setHideExtraLetters, "button");
        exports.groups.blindMode = new settings_group_1.default("blindMode", UpdateConfig.setBlindMode, "button");
        exports.groups.quickEnd = new settings_group_1.default("quickEnd", UpdateConfig.setQuickEnd, "button");
        exports.groups.repeatQuotes = new settings_group_1.default("repeatQuotes", UpdateConfig.setRepeatQuotes, "button");
        exports.groups.enableAds = new settings_group_1.default("enableAds", UpdateConfig.setEnableAds, "button");
        exports.groups.alwaysShowWordsHistory = new settings_group_1.default("alwaysShowWordsHistory", UpdateConfig.setAlwaysShowWordsHistory, "button");
        exports.groups.britishEnglish = new settings_group_1.default("britishEnglish", UpdateConfig.setBritishEnglish, "button");
        exports.groups.singleListCommandLine = new settings_group_1.default("singleListCommandLine", UpdateConfig.setSingleListCommandLine, "button");
        exports.groups.capsLockWarning = new settings_group_1.default("capsLockWarning", UpdateConfig.setCapsLockWarning, "button");
        exports.groups.flipTestColors = new settings_group_1.default("flipTestColors", UpdateConfig.setFlipTestColors, "button");
        exports.groups.swapEscAndTab = new settings_group_1.default("swapEscAndTab", UpdateConfig.setSwapEscAndTab, "button");
        exports.groups.showOutOfFocusWarning = new settings_group_1.default("showOutOfFocusWarning", UpdateConfig.setShowOutOfFocusWarning, "button");
        exports.groups.colorfulMode = new settings_group_1.default("colorfulMode", UpdateConfig.setColorfulMode, "button");
        exports.groups.startGraphsAtZero = new settings_group_1.default("startGraphsAtZero", UpdateConfig.setStartGraphsAtZero, "button");
        exports.groups.autoSwitchTheme = new settings_group_1.default("autoSwitchTheme", UpdateConfig.setAutoSwitchTheme, "button");
        exports.groups.randomTheme = new settings_group_1.default("randomTheme", UpdateConfig.setRandomTheme, "button");
        exports.groups.stopOnError = new settings_group_1.default("stopOnError", UpdateConfig.setStopOnError, "button", () => {
            exports.groups["confidenceMode"].updateInput();
        });
        exports.groups.soundVolume = new settings_group_1.default("soundVolume", UpdateConfig.setSoundVolume, "button");
        exports.groups.playSoundOnError = new settings_group_1.default("playSoundOnError", UpdateConfig.setPlaySoundOnError, "button", () => {
            if (config_1.default.playSoundOnError)
                Sound.playError();
        });
        exports.groups.playSoundOnClick = new settings_group_1.default("playSoundOnClick", UpdateConfig.setPlaySoundOnClick, "button", () => {
            if (config_1.default.playSoundOnClick !== "off")
                Sound.playClick();
        });
        exports.groups.showAllLines = new settings_group_1.default("showAllLines", UpdateConfig.setShowAllLines, "button");
        exports.groups.paceCaret = new settings_group_1.default("paceCaret", UpdateConfig.setPaceCaret, "button");
        exports.groups.repeatedPace = new settings_group_1.default("repeatedPace", UpdateConfig.setRepeatedPace, "button");
        exports.groups.minWpm = new settings_group_1.default("minWpm", UpdateConfig.setMinWpm, "button");
        exports.groups.minAcc = new settings_group_1.default("minAcc", UpdateConfig.setMinAcc, "button");
        exports.groups.minBurst = new settings_group_1.default("minBurst", UpdateConfig.setMinBurst, "button");
        exports.groups.smoothLineScroll = new settings_group_1.default("smoothLineScroll", UpdateConfig.setSmoothLineScroll, "button");
        exports.groups.lazyMode = new settings_group_1.default("lazyMode", UpdateConfig.setLazyMode, "button");
        exports.groups.layout = new settings_group_1.default("layout", UpdateConfig.setLayout, "select");
        exports.groups.language = new settings_group_1.default("language", UpdateConfig.setLanguage, "select");
        exports.groups.fontSize = new settings_group_1.default("fontSize", UpdateConfig.setFontSize, "button");
        exports.groups.pageWidth = new settings_group_1.default("pageWidth", UpdateConfig.setPageWidth, "button");
        exports.groups.caretStyle = new settings_group_1.default("caretStyle", UpdateConfig.setCaretStyle, "button");
        exports.groups.paceCaretStyle = new settings_group_1.default("paceCaretStyle", UpdateConfig.setPaceCaretStyle, "button");
        exports.groups.timerStyle = new settings_group_1.default("timerStyle", UpdateConfig.setTimerStyle, "button");
        exports.groups.highlightMode = new settings_group_1.default("highlightMode", UpdateConfig.setHighlightMode, "button");
        exports.groups.timerOpacity = new settings_group_1.default("timerOpacity", UpdateConfig.setTimerOpacity, "button");
        exports.groups.timerColor = new settings_group_1.default("timerColor", UpdateConfig.setTimerColor, "button");
        exports.groups.fontFamily = new settings_group_1.default("fontFamily", UpdateConfig.setFontFamily, "button", undefined, () => {
            const customButton = $(".pageSettings .section.fontFamily .buttons .custom");
            if ($(".pageSettings .section.fontFamily .buttons .active").length === 0) {
                customButton.addClass("active");
                customButton.text(`Custom (${config_1.default.fontFamily.replace(/_/g, " ")})`);
            }
            else {
                customButton.text("Custom");
            }
        });
        exports.groups.alwaysShowDecimalPlaces = new settings_group_1.default("alwaysShowDecimalPlaces", UpdateConfig.setAlwaysShowDecimalPlaces, "button");
        exports.groups.alwaysShowCPM = new settings_group_1.default("alwaysShowCPM", UpdateConfig.setAlwaysShowCPM, "button");
        exports.groups.customBackgroundSize = new settings_group_1.default("customBackgroundSize", UpdateConfig.setCustomBackgroundSize, "button");
        // groups.customLayoutfluid = new SettingsGroup(
        //   "customLayoutfluid",
        //   UpdateConfig.setCustomLayoutfluid
        // );
    });
}
function reset() {
    $(".pageSettings .section.themes .favThemes.buttons").empty();
    $(".pageSettings .section.themes .allThemes.buttons").empty();
    $(".pageSettings .section.themes .allCustomThemes.buttons").empty();
    $(".pageSettings .section.languageGroups .buttons").empty();
    $(".pageSettings select").empty().select2("destroy");
    $(".pageSettings .section.funbox .buttons").empty();
    $(".pageSettings .section.fontFamily .buttons").empty();
}
exports.reset = reset;
let groupsInitialized = false;
function fillSettingsPage() {
    return __awaiter(this, void 0, void 0, function* () {
        if (config_1.default.showKeyTips) {
            $(".pageSettings .tip").removeClass("hidden");
        }
        else {
            $(".pageSettings .tip").addClass("hidden");
        }
        // Language Selection Combobox
        const languageEl = $(".pageSettings .section.language select").empty();
        const languageGroups = yield Misc.getLanguageGroups();
        languageGroups.forEach((group) => {
            let langComboBox = `<optgroup label="${group.name}">`;
            group.languages.forEach((language) => {
                langComboBox += `<option value="${language}">
        ${language.replace(/_/g, " ")}
      </option>`;
            });
            langComboBox += `</optgroup>`;
            languageEl.append(langComboBox);
        });
        languageEl.select2({
            width: "100%",
        });
        const layoutEl = $(".pageSettings .section.layout select").empty();
        layoutEl.append(`<option value='default'>off</option>`);
        Object.keys(yield Misc.getLayoutsList()).forEach((layout) => {
            layoutEl.append(`<option value='${layout}'>${layout.replace(/_/g, " ")}</option>`);
        });
        layoutEl.select2({
            width: "100%",
        });
        const keymapEl = $(".pageSettings .section.keymapLayout select").empty();
        keymapEl.append(`<option value='overrideSync'>emulator sync</option>`);
        Object.keys(yield Misc.getLayoutsList()).forEach((layout) => {
            if (layout.toString() != "default") {
                keymapEl.append(`<option value='${layout}'>${layout.replace(/_/g, " ")}</option>`);
            }
        });
        keymapEl.select2({
            width: "100%",
        });
        const themeEl1 = $(".pageSettings .section.autoSwitchThemeInputs select.light").empty();
        const themeEl2 = $(".pageSettings .section.autoSwitchThemeInputs select.dark").empty();
        for (const theme of yield Misc.getThemesList()) {
            themeEl1.append(`<option value='${theme.name}'>${theme.name.replace(/_/g, " ")}</option>`);
            themeEl2.append(`<option value='${theme.name}'>${theme.name.replace(/_/g, " ")}</option>`);
        }
        themeEl1.select2({
            width: "100%",
        });
        themeEl2.select2({
            width: "100%",
        });
        $(`.pageSettings .section.autoSwitchThemeInputs select.light`)
            .val(config_1.default.themeLight)
            .trigger("change.select2");
        $(`.pageSettings .section.autoSwitchThemeInputs select.dark`)
            .val(config_1.default.themeDark)
            .trigger("change.select2");
        const funboxEl = $(".pageSettings .section.funbox .buttons").empty();
        funboxEl.append(`<div class="funbox button" funbox='none'>none</div>`);
        Misc.getFunboxList().then((funboxModes) => {
            funboxModes.forEach((funbox) => {
                if (funbox.name === "mirror") {
                    funboxEl.append(`<div class="funbox button" funbox='${funbox.name}' aria-label="${funbox.info}" data-balloon-pos="up" data-balloon-length="fit" type="${funbox.type}" style="transform:scaleX(-1);">${funbox.name.replace(/_/g, " ")}</div>`);
                }
                else {
                    funboxEl.append(`<div class="funbox button" funbox='${funbox.name}' aria-label="${funbox.info}" data-balloon-pos="up" data-balloon-length="fit" type="${funbox.type}">${funbox.name.replace(/_/g, " ")}</div>`);
                }
            });
        });
        let isCustomFont = true;
        const fontsEl = $(".pageSettings .section.fontFamily .buttons").empty();
        Misc.getFontsList().then((fonts) => {
            fonts.forEach((font) => {
                if (config_1.default.fontFamily === font.name)
                    isCustomFont = false;
                fontsEl.append(`<div class="button${config_1.default.fontFamily === font.name ? " active" : ""}" style="font-family:${font.display !== undefined ? font.display : font.name}" fontFamily="${font.name.replace(/ /g, "_")}" tabindex="0"
        onclick="this.blur();">${font.display !== undefined ? font.display : font.name}</div>`);
            });
            fontsEl.append(isCustomFont
                ? `<div class="button no-auto-handle custom active" onclick="this.blur();">Custom (${config_1.default.fontFamily.replace(/_/g, " ")})</div>`
                : '<div class="button no-auto-handle custom" onclick="this.blur();">Custom</div>');
        });
        $(".pageSettings .section.customBackgroundSize input").val(config_1.default.customBackground);
        $(".pageSettings .section.customLayoutfluid input").val(config_1.default.customLayoutfluid.replace(/#/g, " "));
        setEventDisabled(true);
        if (!groupsInitialized) {
            yield initGroups();
            groupsInitialized = true;
        }
        else {
            Object.keys(exports.groups).forEach((groupKey) => {
                exports.groups[groupKey].updateInput();
            });
        }
        setEventDisabled(false);
        yield ThemePicker.refreshButtons();
        yield UpdateConfig.loadPromise;
    });
}
exports.fillSettingsPage = fillSettingsPage;
// export let settingsFillPromise = fillSettingsPage();
function hideAccountSection() {
    $(`.sectionGroupTitle[group='account']`).addClass("hidden");
    $(`.settingsGroup.account`).addClass("hidden");
    $(`.pageSettings .section.needsAccount`).addClass("hidden");
}
exports.hideAccountSection = hideAccountSection;
function updateDiscordSection() {
    //no code and no discord
    if (firebase_1.Auth.currentUser == null) {
        $(".pageSettings .section.discordIntegration").addClass("hidden");
    }
    else {
        if (DB.getSnapshot() == null)
            return;
        $(".pageSettings .section.discordIntegration").removeClass("hidden");
        if (DB.getSnapshot().discordId == undefined) {
            //show button
            $(".pageSettings .section.discordIntegration .buttons").removeClass("hidden");
            $(".pageSettings .section.discordIntegration .info").addClass("hidden");
        }
        else {
            $(".pageSettings .section.discordIntegration .buttons").addClass("hidden");
            $(".pageSettings .section.discordIntegration .info").removeClass("hidden");
        }
    }
}
exports.updateDiscordSection = updateDiscordSection;
function updateAuthSections() {
    $(".pageSettings .section.passwordAuthSettings .button").addClass("hidden");
    $(".pageSettings .section.googleAuthSettings .button").addClass("hidden");
    const user = firebase_1.Auth.currentUser;
    if (!user)
        return;
    const passwordProvider = user.providerData.find((provider) => provider.providerId === "password");
    const googleProvider = user.providerData.find((provider) => provider.providerId === "google.com");
    if (passwordProvider) {
        $(".pageSettings .section.passwordAuthSettings #emailPasswordAuth").removeClass("hidden");
        $(".pageSettings .section.passwordAuthSettings #passPasswordAuth").removeClass("hidden");
    }
    else {
        $(".pageSettings .section.passwordAuthSettings #addPasswordAuth").removeClass("hidden");
    }
    if (googleProvider) {
        $(".pageSettings .section.googleAuthSettings #removeGoogleAuth").removeClass("hidden");
        if (passwordProvider) {
            $(".pageSettings .section.googleAuthSettings #removeGoogleAuth").removeClass("disabled");
        }
        else {
            $(".pageSettings .section.googleAuthSettings #removeGoogleAuth").addClass("disabled");
        }
    }
    else {
        $(".pageSettings .section.googleAuthSettings #addGoogleAuth").removeClass("hidden");
    }
}
exports.updateAuthSections = updateAuthSections;
function setActiveFunboxButton() {
    $(`.pageSettings .section.funbox .button`).removeClass("active");
    $(`.pageSettings .section.funbox .button[funbox='${config_1.default.funbox}']`).addClass("active");
}
function refreshTagsSettingsSection() {
    var _a;
    if (firebase_1.Auth.currentUser !== null && DB.getSnapshot() !== null) {
        const tagsEl = $(".pageSettings .section.tags .tagsList").empty();
        (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
            // let tagPbString = "No PB found";
            // if (tag.pb != undefined && tag.pb > 0) {
            //   tagPbString = `PB: ${tag.pb}`;
            // }
            tagsEl.append(`

      <div class="buttons tag" id="${tag._id}">
        <div class="button tagButton ${tag.active ? "active" : ""}" active="${tag.active}">
          <div class="title">${tag.name}</div>
        </div>
        <div class="clearPbButton button">
          <i class="fas fa-crown fa-fw"></i>
        </div>
        <div class="editButton button">
          <i class="fas fa-pen fa-fw"></i>
        </div>
        <div class="removeButton button">
          <i class="fas fa-trash fa-fw"></i>
        </div>
      </div>

      `);
        });
        $(".pageSettings .section.tags").removeClass("hidden");
    }
    else {
        $(".pageSettings .section.tags").addClass("hidden");
    }
}
function refreshPresetsSettingsSection() {
    var _a;
    if (firebase_1.Auth.currentUser !== null && DB.getSnapshot() !== null) {
        const presetsEl = $(".pageSettings .section.presets .presetsList").empty();
        (_a = DB.getSnapshot().presets) === null || _a === void 0 ? void 0 : _a.forEach((preset) => {
            presetsEl.append(`
      <div class="buttons preset" id="${preset._id}">
        <div class="button presetButton">
          <div class="title">${preset.name}</div>
        </div>
        <div class="editButton button">
          <i class="fas fa-pen fa-fw"></i>
        </div>
        <div class="removeButton button">
          <i class="fas fa-trash fa-fw"></i>
        </div>
      </div>
      
      `);
        });
        $(".pageSettings .section.presets").removeClass("hidden");
    }
    else {
        $(".pageSettings .section.presets").addClass("hidden");
    }
}
function showAccountSection() {
    $(`.sectionGroupTitle[group='account']`).removeClass("hidden");
    $(`.settingsGroup.account`).removeClass("hidden");
    $(`.pageSettings .section.needsAccount`).removeClass("hidden");
    refreshTagsSettingsSection();
    refreshPresetsSettingsSection();
    updateDiscordSection();
}
exports.showAccountSection = showAccountSection;
function update() {
    Object.keys(exports.groups).forEach((group) => {
        exports.groups[group].updateInput();
    });
    refreshTagsSettingsSection();
    refreshPresetsSettingsSection();
    // LanguagePicker.setActiveGroup(); Shifted from grouped btns to combo-box
    setActiveFunboxButton();
    ThemePicker.updateActiveTab(true);
    ThemePicker.setCustomInputs(true);
    updateDiscordSection();
    updateAuthSections();
    // ThemePicker.updateActiveButton();
    $(".pageSettings .section.paceCaret input.customPaceCaretSpeed").val(config_1.default.paceCaretCustomSpeed);
    $(".pageSettings .section.minWpm input.customMinWpmSpeed").val(config_1.default.minWpmCustomSpeed);
    $(".pageSettings .section.minAcc input.customMinAcc").val(config_1.default.minAccCustom);
    $(".pageSettings .section.minBurst input.customMinBurst").val(config_1.default.minBurstCustomSpeed);
    if (config_1.default.autoSwitchTheme) {
        $(".pageSettings .section.autoSwitchThemeInputs").removeClass("hidden");
    }
    else {
        $(".pageSettings .section.autoSwitchThemeInputs").addClass("hidden");
    }
    if (config_1.default.customBackground !== "") {
        $(".pageSettings .section.customBackgroundFilter").removeClass("hidden");
    }
    else {
        $(".pageSettings .section.customBackgroundFilter").addClass("hidden");
    }
}
exports.update = update;
function toggleSettingsGroup(groupName) {
    $(`.pageSettings .settingsGroup.${groupName}`)
        .stop(true, true)
        .slideToggle(250)
        .toggleClass("slideup");
    if ($(`.pageSettings .settingsGroup.${groupName}`).hasClass("slideup")) {
        $(`.pageSettings .sectionGroupTitle[group=${groupName}] .fas`)
            .stop(true, true)
            .animate({
            deg: -90,
        }, {
            duration: 250,
            step: function (now) {
                $(this).css({
                    transform: "rotate(" + now + "deg)",
                });
            },
        });
    }
    else {
        $(`.pageSettings .sectionGroupTitle[group=${groupName}] .fas`)
            .stop(true, true)
            .animate({
            deg: 0,
        }, {
            duration: 250,
            step: function (now) {
                $(this).css({
                    transform: "rotate(" + now + "deg)",
                });
            },
        });
    }
}
$(document).on("focusout", ".pageSettings .section.paceCaret input.customPaceCaretSpeed", () => {
    UpdateConfig.setPaceCaretCustomSpeed(parseInt($(".pageSettings .section.paceCaret input.customPaceCaretSpeed").val()));
});
$(document).on("click", ".pageSettings .section.paceCaret .button.save", () => {
    UpdateConfig.setPaceCaretCustomSpeed(parseInt($(".pageSettings .section.paceCaret input.customPaceCaretSpeed").val()));
});
$(document).on("focusout", ".pageSettings .section.minWpm input.customMinWpmSpeed", () => {
    UpdateConfig.setMinWpmCustomSpeed(parseInt($(".pageSettings .section.minWpm input.customMinWpmSpeed").val()));
});
$(document).on("click", ".pageSettings .section.minWpm .button.save", () => {
    UpdateConfig.setMinWpmCustomSpeed(parseInt($(".pageSettings .section.minWpm input.customMinWpmSpeed").val()));
});
$(document).on("focusout", ".pageSettings .section.minAcc input.customMinAcc", () => {
    UpdateConfig.setMinAccCustom(parseInt($(".pageSettings .section.minAcc input.customMinAcc").val()));
});
$(document).on("click", ".pageSettings .section.minAcc .button.save", () => {
    UpdateConfig.setMinAccCustom(parseInt($(".pageSettings .section.minAcc input.customMinAcc").val()));
});
$(document).on("focusout", ".pageSettings .section.minBurst input.customMinBurst", () => {
    UpdateConfig.setMinBurstCustomSpeed(parseInt($(".pageSettings .section.minBurst input.customMinBurst").val()));
});
$(document).on("click", ".pageSettings .section.minBurst .button.save", () => {
    UpdateConfig.setMinBurstCustomSpeed(parseInt($(".pageSettings .section.minBurst input.customMinBurst").val()));
});
// Commented because started using combo-box for choosing languages instead of grouped buttons
// languages
// $(document).on(
//   "click",
//   ".pageSettings .section.languageGroups .button",
//   (e) => {
//     const group = $(e.currentTarget).attr("group");
//     LanguagePicker.setActiveGroup(group, true);
//   }
// );
//funbox
$(document).on("click", ".pageSettings .section.funbox .button", (e) => {
    const funbox = $(e.currentTarget).attr("funbox");
    const type = $(e.currentTarget).attr("type");
    Funbox.setFunbox(funbox, type);
    setActiveFunboxButton();
});
//tags
$(document).on("click", ".pageSettings .section.tags .tagsList .tag .tagButton", (e) => {
    const target = e.currentTarget;
    const tagid = $(target).parent(".tag").attr("id");
    TagController.toggle(tagid);
    $(target).toggleClass("active");
});
$(document).on("click", ".pageSettings .section.presets .presetsList .preset .presetButton", (e) => {
    const target = e.currentTarget;
    const presetid = $(target).parent(".preset").attr("id");
    console.log("Applying Preset");
    configEventDisabled = true;
    PresetController.apply(presetid);
    configEventDisabled = false;
    update();
});
$("#importSettingsButton").on("click", () => {
    ImportExportSettingsPopup.show("import");
});
$("#exportSettingsButton").on("click", () => {
    const configJSON = JSON.stringify(config_1.default);
    navigator.clipboard.writeText(configJSON).then(function () {
        Notifications.add("JSON Copied to clipboard", 0);
    }, function () {
        ImportExportSettingsPopup.show("export");
    });
});
$(".pageSettings .sectionGroupTitle").on("click", (e) => {
    toggleSettingsGroup($(e.currentTarget).attr("group"));
});
$(".pageSettings .section.apeKeys #showApeKeysPopup").on("click", () => {
    ApeKeysPopup.show();
});
$(".pageSettings .section.customBackgroundSize .inputAndButton .save").on("click", () => {
    UpdateConfig.setCustomBackground($(".pageSettings .section.customBackgroundSize .inputAndButton input").val());
});
$(".pageSettings .section.customBackgroundSize .inputAndButton input").keypress((e) => {
    if (e.key === "Enter") {
        UpdateConfig.setCustomBackground($(".pageSettings .section.customBackgroundSize .inputAndButton input").val());
    }
});
$(".pageSettings .section.customLayoutfluid .inputAndButton .save").on("click", () => {
    UpdateConfig.setCustomLayoutfluid($(".pageSettings .section.customLayoutfluid .inputAndButton input").val()).then((bool) => {
        if (bool) {
            Notifications.add("Custom layoutfluid saved", 1);
        }
    });
});
$(".pageSettings .section.customLayoutfluid .inputAndButton .input").keypress((e) => {
    if (e.key === "Enter") {
        UpdateConfig.setCustomLayoutfluid($(".pageSettings .section.customLayoutfluid .inputAndButton input").val()).then((bool) => {
            if (bool) {
                Notifications.add("Custom layoutfluid saved", 1);
            }
        });
    }
});
$(".quickNav .links a").on("click", (e) => {
    const settingsGroup = e.target.innerText;
    const isOpen = $(`.pageSettings .settingsGroup.${settingsGroup}`).hasClass("slideup");
    isOpen && toggleSettingsGroup(settingsGroup);
});
$(document).on("change", `.pageSettings .section.autoSwitchThemeInputs select.light`, (e) => {
    const target = $(e.currentTarget);
    if (target.hasClass("disabled") || target.hasClass("no-auto-handle")) {
        return;
    }
    UpdateConfig.setThemeLight(target.val());
});
$(document).on("change", `.pageSettings .section.autoSwitchThemeInputs select.dark`, (e) => {
    const target = $(e.currentTarget);
    if (target.hasClass("disabled") || target.hasClass("no-auto-handle")) {
        return;
    }
    UpdateConfig.setThemeDark(target.val());
});
let configEventDisabled = false;
function setEventDisabled(value) {
    configEventDisabled = value;
}
exports.setEventDisabled = setEventDisabled;
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "fullConfigChange")
        setEventDisabled(true);
    if (eventKey === "fullConfigChangeFinished") {
        setEventDisabled(false);
    }
    if (configEventDisabled || eventKey === "saveToLocalStorage")
        return;
    if (ActivePage.get() === "settings" && eventKey !== "theme") {
        update();
    }
});
exports.page = new page_1.default("settings", $(".page.pageSettings"), "/settings", () => {
    //
}, () => __awaiter(void 0, void 0, void 0, function* () {
    reset();
}), () => __awaiter(void 0, void 0, void 0, function* () {
    yield fillSettingsPage();
    update();
}), () => {
    //
});


/***/ }),

/***/ "./src/scripts/pages/test.ts":
/*!***********************************!*\
  !*** ./src/scripts/pages/test.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestStats = __importStar(__webpack_require__(/*! ../test/test-stats */ "./src/scripts/test/test-stats.ts"));
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const TestConfig = __importStar(__webpack_require__(/*! ../test/test-config */ "./src/scripts/test/test-config.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const Funbox = __importStar(__webpack_require__(/*! ../test/funbox */ "./src/scripts/test/funbox.ts"));
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
exports.page = new page_1.default("test", $(".page.pageTest"), "/", () => __awaiter(void 0, void 0, void 0, function* () {
    TestLogic.restart();
    Funbox.clear();
    TestConfig.hide();
    $("#wordsInput").focusout();
}), () => __awaiter(void 0, void 0, void 0, function* () {
    //
}), () => {
    TestConfig.show();
    TestStats.resetIncomplete();
    ManualRestart.set();
    TestLogic.restart(undefined, undefined, undefined, undefined, true);
    Funbox.activate(config_1.default.funbox);
}, () => {
    TestUI.focusWords();
});


/***/ }),

/***/ "./src/scripts/popups/ape-keys-popup.ts":
/*!**********************************************!*\
  !*** ./src/scripts/popups/ape-keys-popup.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.hide = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
let apeKeys = {};
function getData() {
    return __awaiter(this, void 0, void 0, function* () {
        Loader.show();
        const response = yield ape_1.default.apeKeys.get();
        Loader.hide();
        if (response.status !== 200) {
            Notifications.add("Error getting ape keys: " + response.message, -1);
            return undefined;
        }
        apeKeys = response.data;
    });
}
function refreshList() {
    const data = apeKeys;
    if (!data)
        return;
    const table = $("#apeKeysPopupWrapper table tbody");
    table.empty();
    const apeKeyIds = Object.keys(data);
    if (apeKeyIds.length === 0) {
        table.append("<tr><td colspan='6' style='text-align: center;'>No keys found</td></tr>");
        return;
    }
    apeKeyIds.forEach((apeKeyId) => {
        const key = data[apeKeyId];
        table.append(`
      <tr keyId="${apeKeyId}">
        <td>
          <div class="icon-button">
            ${key.enabled
            ? `<i class="fas fa-check-square"></i>`
            : `<i class="far fa-fw fa-square"></i>`}
          </div>
        </td>
        <td>${key.name}</td>
        <td>${(0, format_1.default)(new Date(key.createdOn), "dd MMM yyyy HH:mm")}</td>
        <td>${(0, format_1.default)(new Date(key.modifiedOn), "dd MMM yyyy HH:mm")}</td>
        <td>${key.lastUsedOn === -1
            ? "-"
            : (0, format_1.default)(new Date(key.lastUsedOn), "dd MMM yyyy HH:mm")}</td>
        <td>
          <div class="keyButtons">
            <div class="button edit">
              <i class="fas fa-fw fa-pen"></i>
            </div>
            <div class="button delete">
              <i class="fas fa-fw fa-trash-alt"></i>
            </div>
          </div>
        </td>
      </tr>
    `);
    });
}
function hide() {
    if (!$("#apeKeysPopupWrapper").hasClass("hidden")) {
        $("#apeKeysPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#apeKeysPopupWrapper").addClass("hidden");
        });
    }
}
exports.hide = hide;
//show the popup
function show() {
    return __awaiter(this, void 0, void 0, function* () {
        if ($("#apeKeysPopupWrapper").hasClass("hidden")) {
            yield getData();
            refreshList();
            $("#apeKeysPopupWrapper")
                .stop(true, true)
                .css("opacity", 0)
                .removeClass("hidden")
                .animate({
                opacity: 1,
            }, 100, () => {
                $("#apeKeysPopup textarea").trigger("focus").select();
            });
        }
    });
}
exports.show = show;
$("#apeKeysPopupWrapper").on("mousedown", (e) => {
    if ($(e.target).attr("id") === "apeKeysPopupWrapper") {
        hide();
    }
});
$("#apeKeysPopup .generateApeKey").on("click", () => {
    hide();
});
$(document).on("click", "#apeKeysPopup table .keyButtons .button", () => {
    hide();
});
$(document).on("click", "#apeKeysPopup table .icon-button", (e) => __awaiter(void 0, void 0, void 0, function* () {
    const keyId = $(e.target).closest("tr").attr("keyId");
    const key = apeKeys === null || apeKeys === void 0 ? void 0 : apeKeys[keyId];
    if (!key || !apeKeys)
        return;
    Loader.show();
    const response = yield ape_1.default.apeKeys.update(keyId, { enabled: !key.enabled });
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to update key: " + response.message, -1);
    }
    apeKeys[keyId].enabled = !key.enabled;
    refreshList();
    if (key.enabled) {
        Notifications.add("Key active", 1);
    }
    else {
        Notifications.add("Key inactive", 1);
    }
}));


/***/ }),

/***/ "./src/scripts/popups/contact-popup.ts":
/*!*********************************************!*\
  !*** ./src/scripts/popups/contact-popup.ts ***!
  \*********************************************/
/***/ (() => {


$(document.body).on("click", "#contactPopupButton", () => {
    $("#contactPopupWrapper")
        .css("opacity", 0)
        .removeClass("hidden")
        .animate({ opacity: 1 }, 125);
});
$(document.body).on("click", "#contactPopupWrapper", (e) => {
    if ($(e.target).attr("id") === "contactPopupWrapper") {
        $("#contactPopupWrapper")
            .css("opacity", 1)
            .animate({ opacity: 0 }, 125, () => {
            $("#contactPopupWrapper").addClass("hidden");
        });
    }
});


/***/ }),

/***/ "./src/scripts/popups/custom-test-duration-popup.ts":
/*!**********************************************************!*\
  !*** ./src/scripts/popups/custom-test-duration-popup.ts ***!
  \**********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function parseInput(input) {
    const re = /((-\s*)?\d+(\.\d+)?\s*[hms]?)/g;
    const seconds = [...input.toLowerCase().matchAll(re)]
        .map((match) => {
        const part = match[0];
        const duration = parseFloat(part.replace(/\s+/g, ""));
        if (part.includes("h")) {
            return 3600 * duration;
        }
        else if (part.includes("m")) {
            return 60 * duration;
        }
        else {
            return duration;
        }
    })
        .reduce((total, dur) => total + dur, 0);
    return Math.floor(seconds);
}
function format(duration) {
    const hours = Math.floor(duration / 3600);
    const minutes = Math.floor((duration % 3600) / 60);
    const seconds = (duration % 3600) % 60;
    const time = [];
    if (hours > 0) {
        time.push(`${hours} hour${hours === 1 ? "" : "s"}`);
    }
    if (minutes > 0) {
        time.push(`${minutes} minute${minutes === 1 ? "" : "s"}`);
    }
    if (seconds > 0) {
        time.push(`${seconds} second${seconds === 1 ? "" : "s"}`);
    }
    if (time.length === 3) {
        return `${time[0]}, ${time[1]} and ${time[2]}`;
    }
    else if (time.length === 2) {
        return `${time[0]} and ${time[1]}`;
    }
    else {
        return `${time[0]}`;
    }
}
function previewDuration() {
    const input = $("#customTestDurationPopup input").val();
    const duration = parseInput(input);
    let formattedDuration = "";
    if (duration < 0) {
        formattedDuration = "NEGATIVE TIME";
    }
    else if (duration == 0) {
        formattedDuration = "Infinite test";
    }
    else {
        formattedDuration = "Total time: " + format(duration);
    }
    $("#customTestDurationPopup .preview").text(formattedDuration);
}
function show() {
    if ($("#customTestDurationPopupWrapper").hasClass("hidden")) {
        $("#customTestDurationPopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#customTestDurationPopup input").trigger("focus").select();
        });
    }
    previewDuration();
}
exports.show = show;
function hide() {
    if (!$("#customTestDurationPopupWrapper").hasClass("hidden")) {
        $("#customTestDurationPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#customTestDurationPopupWrapper").addClass("hidden");
        });
    }
}
exports.hide = hide;
function apply() {
    const val = parseInput($("#customTestDurationPopup input").val());
    if (val !== null && !isNaN(val) && val >= 0) {
        UpdateConfig.setTimeConfig(val);
        ManualRestart.set();
        TestLogic.restart();
        if (val >= 1800) {
            Notifications.add("Stay safe and take breaks!", 0);
        }
        else if (val == 0) {
            Notifications.add("Infinite time! Make sure to use Bail Out from the command line to save your result.", 0, 7);
        }
    }
    else {
        Notifications.add("Custom time must be at least 1", 0);
    }
    hide();
}
$("#customTestDurationPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "customTestDurationPopupWrapper") {
        hide();
    }
});
$("#customTestDurationPopup input").keyup((e) => {
    previewDuration();
    if (e.key === "Enter") {
        apply();
    }
});
$("#customTestDurationPopup .button").on("click", () => {
    apply();
});
$(document).on("click", "#top .config .time .text-button", (e) => {
    const mode = $(e.currentTarget).attr("timeConfig");
    if (mode == "custom") {
        show();
    }
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" &&
        !$("#customTestDurationPopupWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/popups/custom-text-popup.ts":
/*!*************************************************!*\
  !*** ./src/scripts/popups/custom-text-popup.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.isVisible = exports.hide = exports.show = void 0;
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const ChallengeController = __importStar(__webpack_require__(/*! ../controllers/challenge-controller */ "./src/scripts/controllers/challenge-controller.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const WordFilterPopup = __importStar(__webpack_require__(/*! ./word-filter-popup */ "./src/scripts/popups/word-filter-popup.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const SavedTextsPopup = __importStar(__webpack_require__(/*! ./saved-texts-popup */ "./src/scripts/popups/saved-texts-popup.ts"));
const wrapper = "#customTextPopupWrapper";
const popup = "#customTextPopup";
function show() {
    if ($(wrapper).hasClass("hidden")) {
        if ($(`${popup} .checkbox input`).prop("checked")) {
            $(`${popup} .inputs .randomInputFields`).removeClass("hidden");
        }
        else {
            $(`${popup} .inputs .randomInputFields`).addClass("hidden");
        }
        $(wrapper)
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            let newtext = CustomText.text.join(CustomText.delimiter);
            newtext = newtext.replace(/\n /g, "\n");
            $(`${popup} textarea`).val(newtext);
            $(`${popup} .wordcount input`).val(CustomText.word === -1 ? "" : CustomText.word);
            $(`${popup} .time input`).val(CustomText.time === -1 ? "" : CustomText.time);
            $(`${popup} textarea`).trigger("focus");
        });
    }
    setTimeout(() => {
        $(`${popup} textarea`).trigger("focus");
    }, 150);
}
exports.show = show;
$(`${popup} .delimiterCheck input`).change(() => {
    let delimiter;
    if ($(`${popup} .delimiterCheck input`).prop("checked")) {
        delimiter = "|";
    }
    else {
        delimiter = " ";
    }
    if ($(`${popup} textarea`).val() != CustomText.text.join(CustomText.delimiter)) {
        const currentText = $(`${popup} textarea`).val();
        const currentTextSplit = currentText.split(CustomText.delimiter);
        let newtext = currentTextSplit.join(delimiter);
        newtext = newtext.replace(/\n /g, "\n");
        $(`${popup} textarea`).val(newtext);
    }
    else {
        let newtext = CustomText.text.join(delimiter);
        newtext = newtext.replace(/\n /g, "\n");
        $(`${popup} textarea`).val(newtext);
    }
    CustomText.setDelimiter(delimiter);
});
function hide() {
    if (!$(wrapper).hasClass("hidden")) {
        $(wrapper)
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $(wrapper).addClass("hidden");
        });
    }
}
exports.hide = hide;
function isVisible() {
    return !$(wrapper).hasClass("hidden");
}
exports.isVisible = isVisible;
$(wrapper).mousedown((e) => {
    if ($(e.target).attr("id") === "customTextPopupWrapper") {
        hide();
    }
});
$(`${popup} .inputs .checkbox input`).change(() => {
    if ($(`${popup} .checkbox input`).prop("checked")) {
        $(`${popup} .inputs .randomInputFields`).removeClass("hidden");
    }
    else {
        $(`${popup} .inputs .randomInputFields`).addClass("hidden");
    }
});
$(`${popup} textarea`).on("keypress", (e) => {
    if (e.code === "Enter" && e.ctrlKey) {
        $(`${popup} .button.apply`).click();
    }
});
$(`${popup} .randomInputFields .wordcount input`).on("keypress", () => {
    $(`${popup} .randomInputFields .time input`).val("");
});
$(`${popup} .randomInputFields .time input`).on("keypress", () => {
    $(`${popup} .randomInputFields .wordcount input`).val("");
});
$(`${popup} .buttonsTop .showSavedTexts`).on("click", () => {
    SavedTextsPopup.show();
});
$(`${popup} .buttonsTop .saveCustomText`).on("click", () => {
    hide();
});
function apply() {
    let text = $(`${popup} textarea`).val().normalize();
    text = text.trim();
    // text = text.replace(/[\r]/gm, " ");
    text = text.replace(/\\\\t/gm, "\t");
    text = text.replace(/\\\\n/gm, "\n");
    text = text.replace(/\\t/gm, "\t");
    text = text.replace(/\\n/gm, "\n");
    text = text.replace(/ +/gm, " ");
    // text = text.replace(/(\r\n)+/g, "\r\n");
    // text = text.replace(/(\n)+/g, "\n");
    // text = text.replace(/(\r)+/g, "\r");
    text = text.replace(/( *(\r\n|\r|\n) *)/g, "\n ");
    if ($(`${popup} .typographyCheck input`).prop("checked")) {
        text = Misc.cleanTypographySymbols(text);
    }
    // text = Misc.remove_non_ascii(text);
    text = text.replace(/[\u2060]/g, "");
    CustomText.setText(text.split(CustomText.delimiter));
    CustomText.setWord(parseInt($(`${popup} .wordcount input`).val()) || -1);
    CustomText.setTime(parseInt($(`${popup} .time input`).val()) || -1);
    CustomText.setIsWordRandom($(`${popup} .checkbox input`).prop("checked") && CustomText.word > -1);
    CustomText.setIsTimeRandom($(`${popup} .checkbox input`).prop("checked") && CustomText.time > -1);
    if ($(`${popup} .checkbox input`).prop("checked") &&
        !CustomText.isTimeRandom &&
        !CustomText.isWordRandom) {
        Notifications.add("You need to specify word count or time in seconds to start a random custom test.", 0, 5);
        return;
    }
    if ($(`${popup} .checkbox input`).prop("checked") &&
        CustomText.isTimeRandom &&
        CustomText.isWordRandom) {
        Notifications.add("You need to pick between word count or time in seconds to start a random custom test.", 0, 5);
        return;
    }
    if ((CustomText.isWordRandom && CustomText.word === 0) ||
        (CustomText.isTimeRandom && CustomText.time === 0)) {
        Notifications.add("Infinite words! Make sure to use Bail Out from the command line to save your result.", 0, 7);
    }
    ChallengeController.clearActive();
    ManualRestart.set();
    if (config_1.default.mode !== "custom")
        UpdateConfig.setMode("custom");
    TestLogic.restart();
    hide();
}
$(document).on("click", `${popup} .button.apply`, () => {
    apply();
});
$(document).on("click", `${popup} .wordfilter`, () => {
    WordFilterPopup.show();
});
$(document).on("click", "#top .config .customText .text-button", () => {
    show();
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" &&
        !$("#customTextPopupWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/popups/custom-theme-popup.ts":
/*!**************************************************!*\
  !*** ./src/scripts/popups/custom-theme-popup.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, exports) => {


// import Config, * as UpdateConfig from "./config";
// import * as Notifications from "./notifications";
// import * as ThemePicker from "./theme-picker";
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
function show(value) {
    if ($("#customThemeShareWrapper").hasClass("hidden")) {
        // let save = [];
        // $.each(
        //   $(".pageSettings .section.customTheme [type='color']"),
        //   (index, element) => {
        //     save.push($(element).attr("value"));
        //   }
        // );
        // $("#customThemeShareWrapper input").val(JSON.stringify(save));
        $("#customThemeShareWrapper input").val(value);
        $("#customThemeShareWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#customThemeShare input").trigger("focus");
            $("#customThemeShare input").select();
            $("#customThemeShare input").trigger("focus");
        });
    }
}
exports.show = show;
function hide() {
    if (!$("#customThemeShareWrapper").hasClass("hidden")) {
        // try {
        //   UpdateConfig.setCustomThemeColors(
        //     JSON.parse($("#customThemeShareWrapper input").val())
        //   );
        // } catch (e) {
        //   Notifications.add(
        //     "Something went wrong. Reverting to default custom colors.",
        //     0,
        //     4
        //   );
        //   UpdateConfig.setCustomThemeColors(Config.defaultConfig.customThemeColors);
        // }
        // ThemePicker.setCustomInputs();
        $("#customThemeShareWrapper input").val("");
        $("#customThemeShareWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#customThemeShareWrapper").addClass("hidden");
        });
    }
}
$("#customThemeShareWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "customThemeShareWrapper") {
        hide();
    }
});
$("#customThemeShare .button").on("click", () => {
    hide();
});


/***/ }),

/***/ "./src/scripts/popups/custom-word-amount-popup.ts":
/*!********************************************************!*\
  !*** ./src/scripts/popups/custom-word-amount-popup.ts ***!
  \********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function show() {
    if ($("#customWordAmountPopupWrapper").hasClass("hidden")) {
        $("#customWordAmountPopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#customWordAmountPopup input").trigger("focus").select();
        });
    }
}
exports.show = show;
function hide() {
    if (!$("#customWordAmountPopupWrapper").hasClass("hidden")) {
        $("#customWordAmountPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#customWordAmountPopupWrapper").addClass("hidden");
        });
    }
}
exports.hide = hide;
function apply() {
    const val = parseInt($("#customWordAmountPopup input").val());
    if (val !== null && !isNaN(val) && val >= 0) {
        UpdateConfig.setWordCount(val);
        ManualRestart.set();
        TestLogic.restart();
        if (val > 2000) {
            Notifications.add("Stay safe and take breaks!", 0);
        }
        else if (val == 0) {
            Notifications.add("Infinite words! Make sure to use Bail Out from the command line to save your result.", 0, 7);
        }
    }
    else {
        Notifications.add("Custom word amount must be at least 1", 0);
    }
    hide();
}
$("#customWordAmountPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "customWordAmountPopupWrapper") {
        hide();
    }
});
$("#customWordAmountPopup input").on("keypress", (e) => {
    if (e.key === "Enter") {
        apply();
    }
});
$("#customWordAmountPopup .button").on("click", () => {
    apply();
});
$(document).on("click", "#top .config .wordCount .text-button", (e) => {
    const wrd = $(e.currentTarget).attr("wordCount");
    if (wrd == "custom") {
        show();
    }
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" &&
        !$("#customWordAmountPopupWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/popups/edit-preset-popup.ts":
/*!*************************************************!*\
  !*** ./src/scripts/popups/edit-preset-popup.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Config = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function show(action, id, name) {
    if (action === "add") {
        $("#presetWrapper #presetEdit").attr("action", "add");
        $("#presetWrapper #presetEdit .title").html("Create new preset");
        $("#presetWrapper #presetEdit .button").html(`<i class="fas fa-plus"></i>`);
        $("#presetWrapper #presetEdit input.text").val("");
        $("#presetWrapper #presetEdit input.text").removeClass("hidden");
        $("#presetWrapper #presetEdit label").addClass("hidden");
    }
    else if (action === "edit" && id && name) {
        $("#presetWrapper #presetEdit").attr("action", "edit");
        $("#presetWrapper #presetEdit").attr("presetid", id);
        $("#presetWrapper #presetEdit .title").html("Edit preset");
        $("#presetWrapper #presetEdit .button").html(`<i class="fas fa-pen"></i>`);
        $("#presetWrapper #presetEdit input.text").val(name);
        $("#presetWrapper #presetEdit input.text").removeClass("hidden");
        $("#presetWrapper #presetEdit label input").prop("checked", false);
        $("#presetWrapper #presetEdit label").removeClass("hidden");
    }
    else if (action === "remove" && id) {
        $("#presetWrapper #presetEdit").attr("action", "remove");
        $("#presetWrapper #presetEdit").attr("presetid", id);
        $("#presetWrapper #presetEdit .title").html("Remove preset " + name);
        $("#presetWrapper #presetEdit .button").html(`<i class="fas fa-check"></i>`);
        $("#presetWrapper #presetEdit input.text").addClass("hidden");
        $("#presetWrapper #presetEdit label").addClass("hidden");
    }
    if ($("#presetWrapper").hasClass("hidden")) {
        $("#presetWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#presetWrapper #presetEdit input").trigger("focus");
        });
    }
}
exports.show = show;
function hide() {
    if (!$("#presetWrapper").hasClass("hidden")) {
        $("#presetWrapper #presetEdit").attr("action", "");
        $("#presetWrapper #presetEdit").attr("tagid", "");
        $("#presetWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#presetWrapper").addClass("hidden");
        });
    }
}
function apply() {
    return __awaiter(this, void 0, void 0, function* () {
        const action = $("#presetWrapper #presetEdit").attr("action");
        const presetName = $("#presetWrapper #presetEdit input").val();
        const presetId = $("#presetWrapper #presetEdit").attr("presetId");
        const updateConfig = $("#presetWrapper #presetEdit label input").prop("checked");
        let configChanges = {};
        if ((updateConfig && action === "edit") || action === "add") {
            configChanges = Config.getConfigChanges();
            const tags = DB.getSnapshot().tags || [];
            const activeTagIds = tags
                .filter((tag) => tag.active)
                .map((tag) => tag._id);
            configChanges.tags = activeTagIds;
        }
        const snapshotPresets = DB.getSnapshot().presets || [];
        hide();
        Loader.show();
        if (action === "add") {
            const response = yield ape_1.default.presets.add(presetName, configChanges);
            if (response.status !== 200) {
                Notifications.add("Failed to add preset: " + response.message, -1);
            }
            else {
                Notifications.add("Preset added", 1, 2);
                snapshotPresets.push({
                    name: presetName,
                    config: configChanges,
                    _id: response.data.presetId,
                });
            }
        }
        else if (action === "edit") {
            const response = yield ape_1.default.presets.edit(presetId, presetName, configChanges);
            if (response.status !== 200) {
                Notifications.add("Failed to edit preset: " + response.message, -1);
            }
            else {
                Notifications.add("Preset updated", 1);
                const preset = snapshotPresets.filter((preset) => preset._id === presetId)[0];
                preset.name = presetName;
                if (updateConfig) {
                    preset.config = configChanges;
                }
            }
        }
        else if (action === "remove") {
            const response = yield ape_1.default.presets.delete(presetId);
            if (response.status !== 200) {
                Notifications.add("Failed to remove preset: " + response.message, -1);
            }
            else {
                Notifications.add("Preset removed", 1);
                snapshotPresets.forEach((preset, index) => {
                    if (preset._id === presetId) {
                        snapshotPresets.splice(index, 1);
                    }
                });
            }
        }
        Settings.update();
        Loader.hide();
    });
}
$("#presetWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "presetWrapper") {
        hide();
    }
});
$("#presetWrapper #presetEdit .button").on("click", () => {
    apply();
});
$("#presetWrapper #presetEdit input").on("keypress", (e) => {
    if (e.key === "Enter") {
        apply();
    }
});
$(document).on("click", ".pageSettings .section.presets .addPresetButton", () => {
    show("add");
});
$(document).on("click", ".pageSettings .section.presets .editButton", (e) => {
    const presetid = $(e.currentTarget).parent(".preset").attr("id");
    const name = $(e.currentTarget).siblings(".button").children(".title").text();
    show("edit", presetid, name);
});
$(document).on("click", ".pageSettings .section.presets .removeButton", (e) => {
    const presetid = $(e.currentTarget).parent(".preset").attr("id");
    const name = $(e.currentTarget).siblings(".button").children(".title").text();
    show("remove", presetid, name);
});


/***/ }),

/***/ "./src/scripts/popups/edit-tags-popup.ts":
/*!***********************************************!*\
  !*** ./src/scripts/popups/edit-tags-popup.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const ResultFilters = __importStar(__webpack_require__(/*! ../account/result-filters */ "./src/scripts/account/result-filters.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const ResultTagsPopup = __importStar(__webpack_require__(/*! ./result-tags-popup */ "./src/scripts/popups/result-tags-popup.ts"));
function show(action, id, name) {
    if (action === "add") {
        $("#tagsWrapper #tagsEdit").attr("action", "add");
        $("#tagsWrapper #tagsEdit .title").html("Add new tag");
        $("#tagsWrapper #tagsEdit .button").html(`<i class="fas fa-plus"></i>`);
        $("#tagsWrapper #tagsEdit input").val("");
        $("#tagsWrapper #tagsEdit input").removeClass("hidden");
    }
    else if (action === "edit" && id && name) {
        $("#tagsWrapper #tagsEdit").attr("action", "edit");
        $("#tagsWrapper #tagsEdit").attr("tagid", id);
        $("#tagsWrapper #tagsEdit .title").html("Edit tag name");
        $("#tagsWrapper #tagsEdit .button").html(`<i class="fas fa-pen"></i>`);
        $("#tagsWrapper #tagsEdit input").val(name);
        $("#tagsWrapper #tagsEdit input").removeClass("hidden");
    }
    else if (action === "remove" && id && name) {
        $("#tagsWrapper #tagsEdit").attr("action", "remove");
        $("#tagsWrapper #tagsEdit").attr("tagid", id);
        $("#tagsWrapper #tagsEdit .title").html("Remove tag " + name);
        $("#tagsWrapper #tagsEdit .button").html(`<i class="fas fa-check"></i>`);
        $("#tagsWrapper #tagsEdit input").addClass("hidden");
    }
    else if (action === "clearPb" && id && name) {
        $("#tagsWrapper #tagsEdit").attr("action", "clearPb");
        $("#tagsWrapper #tagsEdit").attr("tagid", id);
        $("#tagsWrapper #tagsEdit .title").html("Clear PB for tag " + name);
        $("#tagsWrapper #tagsEdit .button").html(`<i class="fas fa-check"></i>`);
        $("#tagsWrapper #tagsEdit input").addClass("hidden");
    }
    if ($("#tagsWrapper").hasClass("hidden")) {
        $("#tagsWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#tagsWrapper #tagsEdit input").trigger("focus");
        });
    }
}
exports.show = show;
function hide() {
    if (!$("#tagsWrapper").hasClass("hidden")) {
        $("#tagsWrapper #tagsEdit").attr("action", "");
        $("#tagsWrapper #tagsEdit").attr("tagid", "");
        $("#tagsWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#tagsWrapper").addClass("hidden");
        });
    }
}
function apply() {
    var _a, _b, _c, _d;
    return __awaiter(this, void 0, void 0, function* () {
        const action = $("#tagsWrapper #tagsEdit").attr("action");
        const tagName = $("#tagsWrapper #tagsEdit input").val();
        const tagId = $("#tagsWrapper #tagsEdit").attr("tagid");
        hide();
        Loader.show();
        if (action === "add") {
            const response = yield ape_1.default.users.createTag(tagName);
            if (response.status !== 200) {
                Notifications.add("Failed to add tag: " + response.message, -1);
            }
            else {
                Notifications.add("Tag added", 1);
                (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.push({
                    name: response.data.name,
                    _id: response.data._id,
                });
                ResultTagsPopup.updateButtons();
                Settings.update();
                ResultFilters.updateTags();
            }
        }
        else if (action === "edit") {
            const response = yield ape_1.default.users.editTag(tagId, tagName);
            if (response.status !== 200) {
                Notifications.add("Failed to edit tag: " + response.message, -1);
            }
            else {
                Notifications.add("Tag updated", 1);
                (_b = DB.getSnapshot().tags) === null || _b === void 0 ? void 0 : _b.forEach((tag) => {
                    if (tag._id === tagId) {
                        tag.name = tagName;
                    }
                });
                ResultTagsPopup.updateButtons();
                Settings.update();
                ResultFilters.updateTags();
            }
        }
        else if (action === "remove") {
            const response = yield ape_1.default.users.deleteTag(tagId);
            if (response.status !== 200) {
                Notifications.add("Failed to remove tag: " + response.message, -1);
            }
            else {
                Notifications.add("Tag removed", 1);
                (_c = DB.getSnapshot().tags) === null || _c === void 0 ? void 0 : _c.forEach((tag, index) => {
                    var _a;
                    if (tag._id === tagId) {
                        (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.splice(index, 1);
                    }
                });
                ResultTagsPopup.updateButtons();
                Settings.update();
                ResultFilters.updateTags();
            }
        }
        else if (action === "clearPb") {
            const response = yield ape_1.default.users.deleteTagPersonalBest(tagId);
            if (response.status !== 200) {
                Notifications.add("Failed to clear tag pb: " + response.message, -1);
            }
            else {
                Notifications.add("Tag PB cleared", 1);
                (_d = DB.getSnapshot().tags) === null || _d === void 0 ? void 0 : _d.forEach((tag) => {
                    if (tag._id === tagId) {
                        tag.personalBests = {
                            time: {},
                            words: {},
                            custom: { custom: [] },
                            zen: { zen: [] },
                            quote: { custom: [] },
                        };
                    }
                });
                ResultTagsPopup.updateButtons();
                Settings.update();
                ResultFilters.updateTags();
            }
        }
        Loader.hide();
    });
}
$("#tagsWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "tagsWrapper") {
        hide();
    }
});
$("#tagsWrapper #tagsEdit .button").on("click", () => {
    apply();
});
$("#tagsWrapper #tagsEdit input").on("keypress", (e) => {
    if (e.key === "Enter") {
        apply();
    }
});
$(document).on("click", ".pageSettings .section.tags .addTagButton", () => {
    show("add");
});
$(document).on("click", ".pageSettings .section.tags .tagsList .tag .editButton", (e) => {
    const tagid = $(e.currentTarget).parent(".tag").attr("id");
    const name = $(e.currentTarget)
        .siblings(".tagButton")
        .children(".title")
        .text();
    show("edit", tagid, name);
});
$(document).on("click", ".pageSettings .section.tags .tagsList .tag .clearPbButton", (e) => {
    const tagid = $(e.currentTarget).parent(".tag").attr("id");
    const name = $(e.currentTarget)
        .siblings(".tagButton")
        .children(".title")
        .text();
    show("clearPb", tagid, name);
});
$(document).on("click", ".pageSettings .section.tags .tagsList .tag .removeButton", (e) => {
    const tagid = $(e.currentTarget).parent(".tag").attr("id");
    const name = $(e.currentTarget)
        .siblings(".tagButton")
        .children(".title")
        .text();
    show("remove", tagid, name);
});


/***/ }),

/***/ "./src/scripts/popups/import-export-settings-popup.ts":
/*!************************************************************!*\
  !*** ./src/scripts/popups/import-export-settings-popup.ts ***!
  \************************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function show(mode, config) {
    if ($("#settingsImportWrapper").hasClass("hidden")) {
        $("#settingsImportWrapper").attr("mode", mode);
        if (mode === "export") {
            $("#settingsImportWrapper .button").addClass("hidden");
            $("#settingsImportWrapper input").val(config !== null && config !== void 0 ? config : "");
        }
        else if (mode === "import") {
            $("#settingsImportWrapper .button").removeClass("hidden");
        }
        $("#settingsImportWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#settingsImportWrapper input").trigger("focus");
            $("#settingsImportWrapper input").select();
            $("#settingsImportWrapper input").trigger("focus");
        });
    }
}
exports.show = show;
function hide() {
    if (!$("#settingsImportWrapper").hasClass("hidden")) {
        if ($("#settingsImportWrapper input").val() !== "") {
            try {
                UpdateConfig.apply(JSON.parse($("#settingsImportWrapper input").val()));
            }
            catch (e) {
                Notifications.add("An error occured while importing settings: " + e, -1);
            }
            UpdateConfig.saveFullConfigToLocalStorage();
        }
        $("#settingsImportWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({ opacity: 0 }, 100, () => {
            $("#settingsImportWrapper").addClass("hidden");
        });
    }
}
$("#settingsImport .button").on("click", () => {
    hide();
});
$("#settingsImportWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "settingsImportWrapper") {
        hide();
    }
});


/***/ }),

/***/ "./src/scripts/popups/mobile-test-config-popup.ts":
/*!********************************************************!*\
  !*** ./src/scripts/popups/mobile-test-config-popup.ts ***!
  \********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = void 0;
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const CustomWordAmountPopup = __importStar(__webpack_require__(/*! ./custom-word-amount-popup */ "./src/scripts/popups/custom-word-amount-popup.ts"));
const CustomTestDurationPopup = __importStar(__webpack_require__(/*! ./custom-test-duration-popup */ "./src/scripts/popups/custom-test-duration-popup.ts"));
const QuoteSearchPopup = __importStar(__webpack_require__(/*! ./quote-search-popup */ "./src/scripts/popups/quote-search-popup.ts"));
const CustomTextPopup = __importStar(__webpack_require__(/*! ./custom-text-popup */ "./src/scripts/popups/custom-text-popup.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const el = $("#mobileTestConfigPopup");
function update() {
    el.find(".button").removeClass("active");
    el.find(`.modeGroup .button[mode='${config_1.default.mode}']`).addClass("active");
    el.find(".timeGroup").addClass("hidden");
    el.find(".wordsGroup").addClass("hidden");
    el.find(".quoteGroup").addClass("hidden");
    el.find(".customGroup").addClass("hidden");
    el.find(`.${config_1.default.mode}Group`).removeClass("hidden");
    if (config_1.default.punctuation) {
        el.find(".punctuation").addClass("active");
    }
    else {
        el.find(".punctuation").removeClass("active");
    }
    if (config_1.default.numbers) {
        el.find(".numbers").addClass("active");
    }
    else {
        el.find(".numbers").removeClass("active");
    }
    if (config_1.default.mode === "time") {
        el.find(`.timeGroup .button[time='${config_1.default.time}']`).addClass("active");
        el.find(".punctuation").removeClass("disabled");
        el.find(".numbers").removeClass("disabled");
    }
    else if (config_1.default.mode === "words") {
        el.find(`.wordsGroup .button[words='${config_1.default.words}']`).addClass("active");
        el.find(".punctuation").removeClass("disabled");
        el.find(".numbers").removeClass("disabled");
    }
    else if (config_1.default.mode === "quote") {
        el.find(`.quoteGroup .button[quote='${config_1.default.quoteLength}']`).addClass("active");
        el.find(".punctuation").addClass("disabled");
        el.find(".numbers").addClass("disabled");
    }
    else if (config_1.default.mode === "zen") {
        el.find(".punctuation").addClass("disabled");
        el.find(".numbers").addClass("disabled");
    }
    else if (config_1.default.mode === "custom") {
        el.find(".punctuation").removeClass("disabled");
        el.find(".numbers").removeClass("disabled");
    }
}
exports.update = update;
function showPopup() {
    if ($("#mobileTestConfigPopupWrapper").hasClass("hidden")) {
        update();
        $("#mobileTestConfigPopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100);
    }
}
function hidePopup() {
    if (!$("#mobileTestConfigPopupWrapper").hasClass("hidden")) {
        $("#mobileTestConfigPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#mobileTestConfigPopupWrapper").addClass("hidden");
        });
    }
}
$("#mobileTestConfigPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "mobileTestConfigPopupWrapper") {
        hidePopup();
    }
});
$("#top .mobileConfig").on("click", () => {
    showPopup();
});
el.find(".wordsGroup .button").on("click", (e) => {
    const wrd = $(e.currentTarget).attr("words");
    if (wrd == "custom") {
        hidePopup();
        CustomWordAmountPopup.show();
    }
    else if (wrd !== undefined) {
        const wrdNum = parseInt(wrd);
        UpdateConfig.setWordCount(wrdNum);
        ManualRestart.set();
        TestLogic.restart();
    }
});
el.find(".timeGroup .button").on("click", (e) => {
    const time = $(e.currentTarget).attr("time");
    if (time == "custom") {
        hidePopup();
        CustomTestDurationPopup.show();
    }
    else if (time !== undefined) {
        const timeNum = parseInt(time);
        UpdateConfig.setTimeConfig(timeNum);
        ManualRestart.set();
        TestLogic.restart();
    }
});
el.find(".quoteGroup .button").on("click", (e) => {
    var _a;
    let len = ((_a = $(e.currentTarget).attr("quote")) !== null && _a !== void 0 ? _a : 0);
    if (len == -2) {
        // UpdateConfig.setQuoteLength(-2, false, e.shiftKey);
        hidePopup();
        QuoteSearchPopup.show();
    }
    else {
        if (len == -1) {
            len = [0, 1, 2, 3];
        }
        UpdateConfig.setQuoteLength(len, false, e.shiftKey);
        ManualRestart.set();
        TestLogic.restart();
    }
});
el.find(".customChange").on("click", () => {
    hidePopup();
    CustomTextPopup.show();
});
el.find(".punctuation").on("click", () => {
    UpdateConfig.setPunctuation(!config_1.default.punctuation);
    ManualRestart.set();
    TestLogic.restart();
});
el.find(".numbers").on("click", () => {
    UpdateConfig.setNumbers(!config_1.default.numbers);
    ManualRestart.set();
    TestLogic.restart();
});
el.find(".modeGroup .button").on("click", (e) => {
    if ($(e.currentTarget).hasClass("active"))
        return;
    const mode = $(e.currentTarget).attr("mode");
    UpdateConfig.setMode(mode);
    ManualRestart.set();
    TestLogic.restart();
});
$("#mobileTestConfigPopup .button").on("click", () => {
    // hidePopup();
    update();
});
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "mode")
        update();
});


/***/ }),

/***/ "./src/scripts/popups/pb-tables-popup.ts":
/*!***********************************************!*\
  !*** ./src/scripts/popups/pb-tables-popup.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
function update(mode) {
    $("#pbTablesPopup table tbody").empty();
    $($("#pbTablesPopup table thead tr td")[0]).text(mode);
    const snapshot = DB.getSnapshot();
    const allmode2 = (snapshot.personalBests === undefined
        ? undefined
        : snapshot.personalBests[mode]);
    if (allmode2 === undefined)
        return;
    const list = [];
    Object.keys(allmode2).forEach(function (key) {
        let pbs = allmode2[key];
        pbs = pbs.sort(function (a, b) {
            return b.wpm - a.wpm;
            // if (a.difficulty === b.difficulty) {
            //   return (a.language < b.language ? -1 : 1);
            // }
            // return (a.difficulty < b.difficulty ? -1 : 1)
        });
        pbs.forEach(function (pb) {
            pb.mode2 = key;
            list.push(pb);
        });
    });
    let mode2memory;
    list.forEach((pb) => {
        let dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pb.timestamp);
        if (pb.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        $("#pbTablesPopup table tbody").append(`
      <tr>
        <td>${mode2memory === pb.mode2 ? "" : pb.mode2}</td>
        <td>
          ${pb.wpm}
          <br />
          <span class="sub">${pb.acc ? pb.acc + "%" : "-"}</span>
        </td>
        <td>
          ${pb.raw ? pb.raw : "-"}
          <br />
          <span class="sub">${pb.consistency ? pb.consistency + "%" : "-"}</span>
        </td>
        <td>${pb.difficulty}</td>
        <td>${pb.language ? pb.language.replace(/_/g, " ") : "-"}</td>
        <td>${pb.punctuation ? '<i class="fas fa-check"></i>' : ""}</td>
        <td>${pb.lazyMode ? '<i class="fas fa-check"></i>' : ""}</td>
        <td>${dateText}</td>
      </tr>
    `);
        mode2memory = pb.mode2;
    });
}
function show(mode) {
    if ($("#pbTablesPopupWrapper").hasClass("hidden")) {
        update(mode);
        $("#pbTablesPopup .title").text(`All ${mode} personal bests`);
        $("#pbTablesPopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100);
    }
}
function hide() {
    if (!$("#pbTablesPopupWrapper").hasClass("hidden")) {
        $("#pbTablesPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#pbTablesPopupWrapper").addClass("hidden");
            $("#pbTablesPopup table tbody").empty();
        });
    }
}
$("#pbTablesPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "pbTablesPopupWrapper") {
        hide();
    }
});
$(".pageAccount .button.showAllTimePbs").on("click", () => {
    show("time");
});
$(".pageAccount .button.showAllWordsPbs").on("click", () => {
    show("words");
});


/***/ }),

/***/ "./src/scripts/popups/quote-approve-popup.ts":
/*!***************************************************!*\
  !*** ./src/scripts/popups/quote-approve-popup.ts ***!
  \***************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
let quotes = [];
function updateList() {
    $("#quoteApprovePopupWrapper .quotes").empty();
    quotes.forEach((quote, index) => {
        const quoteEl = $(`
      <div class="quote" id="${index}" dbid="${quote._id}">
        <textarea class="text">${quote.text}</textarea>
        <input type="text" class="source" placeholder="Source" value="${quote.source}">
        <div class="buttons">
          <div class="icon-button disabled undo" aria-label="Undo changes" data-balloon-pos="left"><i class="fas fa-fw fa-undo-alt"></i></div>
          <div class="icon-button refuse" aria-label="Refuse quote" data-balloon-pos="left"><i class="fas fa-fw fa-times"></i></div>
          <div class="icon-button approve" aria-label="Approve quote" data-balloon-pos="left"><i class="fas fa-fw fa-check"></i></div>
          <div class="icon-button edit hidden" aria-label="Edit and approve quote" data-balloon-pos="left"><i class="fas fa-fw fa-pen"></i></div>
        </div>
        <div class="bottom">
          <div class="length ${quote.text.length < 60 ? "red" : ""}">Quote length: ${quote.text.length}</div>
          <div class="language">Language: ${quote.language}</div>
          <div class="timestamp">Submitted on: ${(0, format_1.default)(new Date(quote.timestamp), "dd MMM yyyy HH:mm")}</div>
        </div>
      </div>
    `);
        $("#quoteApprovePopupWrapper .quotes").append(quoteEl);
    });
}
function updateQuoteLength(index) {
    var _a;
    const len = (_a = $(`#quoteApprovePopup .quote[id=${index}] .text`).val()) === null || _a === void 0 ? void 0 : _a.length;
    $(`#quoteApprovePopup .quote[id=${index}] .length`).text("Quote length: " + len);
    if (len < 60) {
        $(`#quoteApprovePopup .quote[id=${index}] .length`).addClass("red");
    }
    else {
        $(`#quoteApprovePopup .quote[id=${index}] .length`).removeClass("red");
    }
}
function getQuotes() {
    return __awaiter(this, void 0, void 0, function* () {
        Loader.show();
        const response = yield ape_1.default.quotes.get();
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to get new quotes: " + response.message, -1);
        }
        quotes = response.data;
        updateList();
    });
}
function show(noAnim = false) {
    return __awaiter(this, void 0, void 0, function* () {
        if ($("#quoteApprovePopupWrapper").hasClass("hidden")) {
            quotes = [];
            getQuotes();
            $("#quoteApprovePopupWrapper")
                .stop(true, true)
                .css("opacity", 0)
                .removeClass("hidden")
                .animate({ opacity: 1 }, noAnim ? 0 : 100);
        }
    });
}
exports.show = show;
function hide() {
    if (!$("#quoteApprovePopupWrapper").hasClass("hidden")) {
        $("#quoteApprovePopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#quoteApprovePopupWrapper").addClass("hidden");
            $("#quoteApprovePopupWrapper .quotes").empty();
        });
    }
}
exports.hide = hide;
function resetButtons(target) {
    $(target).closest(".quote").find(".icon-button").removeClass("disabled");
    if ($(target).closest(".quote").find(".edit").hasClass("hidden")) {
        $(target).closest(".quote").find(".undo").addClass("disabled");
    }
}
$("#quoteApprovePopupWrapper").on("mousedown", (e) => {
    if ($(e.target).attr("id") === "quoteApprovePopupWrapper") {
        hide();
    }
});
$("#quoteApprovePopupWrapper .button.refreshList").on("click", () => {
    $("#quoteApprovePopupWrapper .quotes").empty();
    getQuotes();
});
$(document).on("click", "#quoteApprovePopup .quote .undo", (e) => __awaiter(void 0, void 0, void 0, function* () {
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    $(`#quoteApprovePopup .quote[id=${index}] .text`).val(quotes[index].text);
    $(`#quoteApprovePopup .quote[id=${index}] .source`).val(quotes[index].source);
    $(`#quoteApprovePopup .quote[id=${index}] .undo`).addClass("disabled");
    $(`#quoteApprovePopup .quote[id=${index}] .approve`).removeClass("hidden");
    $(`#quoteApprovePopup .quote[id=${index}] .edit`).addClass("hidden");
    updateQuoteLength(index);
}));
$(document).on("click", "#quoteApprovePopup .quote .approve", (e) => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    if (!confirm("Are you sure?"))
        return;
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    const dbid = $(e.target).closest(".quote").attr("dbid");
    const target = e.target;
    $(target).closest(".quote").find(".icon-button").addClass("disabled");
    $(target).closest(".quote").find("textarea, input").prop("disabled", true);
    Loader.show();
    const response = yield ape_1.default.quotes.approveSubmission(dbid);
    Loader.hide();
    if (response.status !== 200) {
        resetButtons(target);
        $(target).closest(".quote").find("textarea, input").prop("disabled", false);
        return Notifications.add("Failed to approve quote: " + response.message, -1);
    }
    Notifications.add((_a = "Quote approved. " + response.message) !== null && _a !== void 0 ? _a : "", 1);
    quotes.splice(index, 1);
    updateList();
}));
$(document).on("click", "#quoteApprovePopup .quote .refuse", (e) => __awaiter(void 0, void 0, void 0, function* () {
    if (!confirm("Are you sure?"))
        return;
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    const dbid = $(e.target).closest(".quote").attr("dbid");
    const target = e.target;
    $(target).closest(".quote").find(".icon-button").addClass("disabled");
    $(target).closest(".quote").find("textarea, input").prop("disabled", true);
    Loader.show();
    const response = yield ape_1.default.quotes.rejectSubmission(dbid);
    Loader.hide();
    if (response.status !== 200) {
        resetButtons(target);
        $(target).closest(".quote").find("textarea, input").prop("disabled", false);
        return Notifications.add("Failed to refuse quote: " + response.message, -1);
    }
    Notifications.add("Quote refused.", 1);
    quotes.splice(index, 1);
    updateList();
}));
$(document).on("click", "#quoteApprovePopup .quote .edit", (e) => __awaiter(void 0, void 0, void 0, function* () {
    var _b;
    if (!confirm("Are you sure?"))
        return;
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    const dbid = $(e.target).closest(".quote").attr("dbid");
    const editText = $(`#quoteApprovePopup .quote[id=${index}] .text`).val();
    const editSource = $(`#quoteApprovePopup .quote[id=${index}] .source`).val();
    const target = e.target;
    $(target).closest(".quote").find(".icon-button").addClass("disabled");
    $(target).closest(".quote").find("textarea, input").prop("disabled", true);
    Loader.show();
    const response = yield ape_1.default.quotes.approveSubmission(dbid, editText, editSource);
    Loader.hide();
    if (response.status !== 200) {
        resetButtons(target);
        $(target).closest(".quote").find("textarea, input").prop("disabled", false);
        return Notifications.add("Failed to approve quote: " + response.message, -1);
    }
    Notifications.add((_b = "Quote edited and approved. " + response.message) !== null && _b !== void 0 ? _b : "", 1);
    quotes.splice(index, 1);
    updateList();
}));
$(document).on("input", "#quoteApprovePopup .quote .text", (e) => __awaiter(void 0, void 0, void 0, function* () {
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    $(`#quoteApprovePopup .quote[id=${index}] .undo`).removeClass("disabled");
    $(`#quoteApprovePopup .quote[id=${index}] .approve`).addClass("hidden");
    $(`#quoteApprovePopup .quote[id=${index}] .edit`).removeClass("hidden");
    updateQuoteLength(index);
}));
$(document).on("input", "#quoteApprovePopup .quote .source", (e) => __awaiter(void 0, void 0, void 0, function* () {
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    $(`#quoteApprovePopup .quote[id=${index}] .undo`).removeClass("disabled");
    $(`#quoteApprovePopup .quote[id=${index}] .approve`).addClass("hidden");
    $(`#quoteApprovePopup .quote[id=${index}] .edit`).removeClass("hidden");
}));


/***/ }),

/***/ "./src/scripts/popups/quote-rate-popup.ts":
/*!************************************************!*\
  !*** ./src/scripts/popups/quote-rate-popup.ts ***!
  \************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.clearQuoteStats = exports.show = exports.getQuoteStats = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const TestWords = __importStar(__webpack_require__(/*! ../test/test-words */ "./src/scripts/test/test-words.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
let rating = 0;
let quoteStats = null;
let currentQuote = null;
function reset() {
    $(`#quoteRatePopup .quote .text`).text("-");
    $(`#quoteRatePopup .quote .source .val`).text("-");
    $(`#quoteRatePopup .quote .id .val`).text("-");
    $(`#quoteRatePopup .quote .length .val`).text("-");
    $("#quoteRatePopup .ratingCount .val").text("-");
    $("#quoteRatePopup .ratingAverage .val").text("-");
}
function getRatingAverage(quoteStats) {
    if (!quoteStats.totalRating || !quoteStats.ratings) {
        return 0;
    }
    return Math.round((quoteStats.totalRating / quoteStats.ratings) * 10) / 10;
}
function getQuoteStats(quote) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!quote) {
            return;
        }
        currentQuote = quote;
        const response = yield ape_1.default.quotes.getRating(currentQuote);
        Loader.hide();
        if (response.status !== 200) {
            Notifications.add("Failed to get quote ratings: " + response.message, -1);
            return;
        }
        if (!response.data) {
            return {};
        }
        quoteStats = response.data;
        if (quoteStats && !quoteStats.average) {
            quoteStats.average = getRatingAverage(quoteStats);
        }
        return quoteStats;
    });
}
exports.getQuoteStats = getQuoteStats;
function refreshStars(force) {
    const limit = force ? force : rating;
    $(`#quoteRatePopup .star`).removeClass("active");
    for (let i = 1; i <= limit; i++) {
        $(`#quoteRatePopup .star[rating=${i}]`).addClass("active");
    }
}
function updateRatingStats() {
    var _a, _b, _c;
    return __awaiter(this, void 0, void 0, function* () {
        if (!quoteStats)
            yield getQuoteStats();
        $("#quoteRatePopup .ratingCount .val").text((_a = quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.ratings) !== null && _a !== void 0 ? _a : "0");
        $("#quoteRatePopup .ratingAverage .val").text((_c = (_b = quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.average) === null || _b === void 0 ? void 0 : _b.toFixed(1)) !== null && _c !== void 0 ? _c : "-");
    });
}
function updateData() {
    if (!currentQuote)
        return;
    let lengthDesc;
    if (currentQuote.group == 0) {
        lengthDesc = "short";
    }
    else if (currentQuote.group == 1) {
        lengthDesc = "medium";
    }
    else if (currentQuote.group == 2) {
        lengthDesc = "long";
    }
    else if (currentQuote.group == 3) {
        lengthDesc = "thicc";
    }
    $(`#quoteRatePopup .quote .text`).text(currentQuote.text);
    $(`#quoteRatePopup .quote .source .val`).text(currentQuote.source);
    $(`#quoteRatePopup .quote .id .val`).text(currentQuote.id);
    $(`#quoteRatePopup .quote .length .val`).text(lengthDesc);
    updateRatingStats();
}
function show(quote, shouldReset = true) {
    var _a, _b;
    if ($("#quoteRatePopupWrapper").hasClass("hidden")) {
        if (shouldReset) {
            reset();
        }
        currentQuote = quote;
        rating = 0;
        const snapshot = DB.getSnapshot();
        const alreadyRated = (_b = (_a = snapshot === null || snapshot === void 0 ? void 0 : snapshot.quoteRatings) === null || _a === void 0 ? void 0 : _a[currentQuote.language]) === null || _b === void 0 ? void 0 : _b[currentQuote.id];
        if (alreadyRated) {
            rating = alreadyRated;
        }
        refreshStars();
        updateData();
        $("#quoteRatePopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 125);
    }
}
exports.show = show;
function hide() {
    if (!$("#quoteRatePopupWrapper").hasClass("hidden")) {
        $("#quoteRatePopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#quoteRatePopupWrapper").addClass("hidden");
        });
    }
}
function clearQuoteStats() {
    quoteStats = null;
}
exports.clearQuoteStats = clearQuoteStats;
function submit() {
    var _a, _b, _c;
    return __awaiter(this, void 0, void 0, function* () {
        if (rating === 0) {
            return Notifications.add("Please select a rating");
        }
        if (!currentQuote) {
            return;
        }
        hide();
        const response = yield ape_1.default.quotes.addRating(currentQuote, rating);
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to submit quote rating: " + response.message, -1);
        }
        const snapshot = DB.getSnapshot();
        const quoteRatings = (_a = snapshot.quoteRatings) !== null && _a !== void 0 ? _a : {};
        if ((_b = quoteRatings === null || quoteRatings === void 0 ? void 0 : quoteRatings[currentQuote.language]) === null || _b === void 0 ? void 0 : _b[currentQuote.id]) {
            const oldRating = quoteRatings[currentQuote.language][currentQuote.id];
            const diff = rating - oldRating;
            quoteRatings[currentQuote.language][currentQuote.id] = rating;
            quoteStats = {
                ratings: quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.ratings,
                totalRating: isNaN(quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.totalRating)
                    ? 0
                    : (quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.totalRating) + diff,
                quoteId: currentQuote.id,
                language: currentQuote.language,
            };
            Notifications.add("Rating updated", 1);
        }
        else {
            if (!quoteRatings[currentQuote.language]) {
                quoteRatings[currentQuote.language] = {};
            }
            quoteRatings[currentQuote.language][currentQuote.id] = rating;
            if ((quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.ratings) && quoteStats.totalRating) {
                quoteStats.ratings++;
                quoteStats.totalRating += rating;
            }
            else {
                quoteStats = {
                    ratings: 1,
                    totalRating: rating,
                    quoteId: currentQuote.id,
                    language: currentQuote.language,
                };
            }
            Notifications.add("Rating submitted", 1);
        }
        snapshot.quoteRatings = quoteRatings;
        DB.setSnapshot(snapshot);
        quoteStats.average = getRatingAverage(quoteStats);
        $(".pageTest #result #rateQuoteButton .rating").text((_c = quoteStats.average) === null || _c === void 0 ? void 0 : _c.toFixed(1));
        $(".pageTest #result #rateQuoteButton .icon").removeClass("far");
        $(".pageTest #result #rateQuoteButton .icon").addClass("fas");
    });
}
$("#quoteRatePopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "quoteRatePopupWrapper") {
        hide();
    }
});
$("#quoteRatePopup .stars .star").hover((e) => {
    const ratingHover = parseInt($(e.currentTarget).attr("rating"));
    refreshStars(ratingHover);
});
$("#quoteRatePopup .stars .star").on("click", (e) => {
    const ratingHover = parseInt($(e.currentTarget).attr("rating"));
    rating = ratingHover;
});
$("#quoteRatePopup .stars .star").mouseout(() => {
    $(`#quoteRatePopup .star`).removeClass("active");
    refreshStars();
});
$("#quoteRatePopup .submitButton").on("click", () => {
    submit();
});
$(".pageTest #rateQuoteButton").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    // TODO remove this when done with TestWords
    show(TestWords.randomQuote);
}));


/***/ }),

/***/ "./src/scripts/popups/quote-report-popup.ts":
/*!**************************************************!*\
  !*** ./src/scripts/popups/quote-report-popup.ts ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestWords = __importStar(__webpack_require__(/*! ../test/test-words */ "./src/scripts/test/test-words.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const quotes_controller_1 = __importDefault(__webpack_require__(/*! ../controllers/quotes-controller */ "./src/scripts/controllers/quotes-controller.ts"));
const CAPTCHA_ID = 1;
const state = {
    previousPopupShowCallback: undefined,
    quoteToReport: undefined,
};
const defaultOptions = {
    quoteId: -1,
    previousPopupShowCallback: () => {
        //
    },
    noAnim: false,
};
function show(options = defaultOptions) {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        if ($("#quoteReportPopupWrapper").hasClass("hidden")) {
            const { quoteId, previousPopupShowCallback, noAnim } = options;
            state.previousPopupShowCallback = previousPopupShowCallback;
            const { quotes } = yield quotes_controller_1.default.getQuotes(config_1.default.language);
            state.quoteToReport = quotes.find((quote) => {
                return quote.id === quoteId;
            });
            $("#quoteReportPopup .quote").text((_a = state.quoteToReport) === null || _a === void 0 ? void 0 : _a.text);
            $("#quoteReportPopup .reason").val("Grammatical error");
            $("#quoteReportPopup .comment").val("");
            $("#quoteReportPopup .characterCount").text("-");
            $("#quoteReportPopup .reason").select2({
                minimumResultsForSearch: Infinity,
            });
            $("#quoteReportPopupWrapper")
                .stop(true, true)
                .css("opacity", 0)
                .removeClass("hidden")
                .animate({ opacity: 1 }, noAnim ? 0 : 100, () => {
                $("#quoteReportPopup textarea").trigger("focus").select();
            });
        }
    });
}
exports.show = show;
function hide() {
    return __awaiter(this, void 0, void 0, function* () {
        if (!$("#quoteReportPopupWrapper").hasClass("hidden")) {
            const noAnim = state.previousPopupShowCallback ? true : false;
            $("#quoteReportPopupWrapper")
                .stop(true, true)
                .css("opacity", 1)
                .animate({
                opacity: 0,
            }, noAnim ? 0 : 100, () => {
                grecaptcha.reset(CAPTCHA_ID);
                $("#quoteReportPopupWrapper").addClass("hidden");
                if (state.previousPopupShowCallback) {
                    state.previousPopupShowCallback();
                }
            });
        }
    });
}
exports.hide = hide;
function submitReport() {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        const captchaResponse = grecaptcha.getResponse(CAPTCHA_ID);
        if (!captchaResponse) {
            return Notifications.add("Please complete the captcha.");
        }
        const quoteId = (_a = state.quoteToReport) === null || _a === void 0 ? void 0 : _a.id.toString();
        const quoteLanguage = config_1.default.language;
        const reason = $("#quoteReportPopup .reason").val();
        const comment = $("#quoteReportPopup .comment").val();
        const captcha = captchaResponse;
        if (!quoteId) {
            return Notifications.add("Please select a quote.");
        }
        if (!reason) {
            return Notifications.add("Please select a valid report reason.");
        }
        const characterDifference = comment.length - 250;
        if (characterDifference > 0) {
            return Notifications.add(`Report comment is ${characterDifference} character(s) too long.`);
        }
        Loader.show();
        const response = yield ape_1.default.quotes.report(quoteId, quoteLanguage, reason, comment, captcha);
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to report quote: " + response.message, -1);
        }
        Notifications.add("Report submitted. Thank you!", 1);
        hide();
    });
}
$("#quoteReportPopupWrapper").on("mousedown", (e) => {
    if ($(e.target).attr("id") === "quoteReportPopupWrapper") {
        hide();
    }
});
$("#quoteReportPopup .comment").on("input", () => {
    setTimeout(() => {
        const len = $("#quoteReportPopup .comment").val().length;
        $("#quoteReportPopup .characterCount").text(len);
        if (len > 250) {
            $("#quoteReportPopup .characterCount").addClass("red");
        }
        else {
            $("#quoteReportPopup .characterCount").removeClass("red");
        }
    }, 1);
});
$("#quoteReportPopup .submit").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    yield submitReport();
}));
$(".pageTest #reportQuoteButton").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    show({
        quoteId: (_a = TestWords.randomQuote) === null || _a === void 0 ? void 0 : _a.id,
        noAnim: false,
    });
}));


/***/ }),

/***/ "./src/scripts/popups/quote-search-popup.ts":
/*!**************************************************!*\
  !*** ./src/scripts/popups/quote-search-popup.ts ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.apply = exports.hide = exports.show = exports.setSelectedId = exports.selectedId = void 0;
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const QuoteSubmitPopup = __importStar(__webpack_require__(/*! ./quote-submit-popup */ "./src/scripts/popups/quote-submit-popup.ts"));
const QuoteApprovePopup = __importStar(__webpack_require__(/*! ./quote-approve-popup */ "./src/scripts/popups/quote-approve-popup.ts"));
const QuoteReportPopup = __importStar(__webpack_require__(/*! ./quote-report-popup */ "./src/scripts/popups/quote-report-popup.ts"));
const search_service_1 = __webpack_require__(/*! ../utils/search-service */ "./src/scripts/utils/search-service.ts");
const debounce_1 = __webpack_require__(/*! ../utils/debounce */ "./src/scripts/utils/debounce.ts");
const strings_1 = __webpack_require__(/*! ../utils/strings */ "./src/scripts/utils/strings.ts");
const quotes_controller_1 = __importDefault(__webpack_require__(/*! ../controllers/quotes-controller */ "./src/scripts/controllers/quotes-controller.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
exports.selectedId = 1;
function setSelectedId(val) {
    exports.selectedId = val;
}
exports.setSelectedId = setSelectedId;
const searchServiceCache = {};
function getSearchService(language, data, textExtractor) {
    if (language in searchServiceCache) {
        return searchServiceCache[language];
    }
    const newSearchService = (0, search_service_1.buildSearchService)(data, textExtractor);
    searchServiceCache[language] = newSearchService;
    return newSearchService;
}
function highlightMatches(text, matchedText) {
    if (matchedText.length === 0) {
        return text;
    }
    const words = (0, strings_1.splitByAndKeep)(text, `.,"/#!$%^&*;:{}=-_\`~() `.split(""));
    const normalizedWords = words.map((word) => {
        const shouldHighlight = matchedText.find((match) => {
            return word.startsWith(match);
        });
        return shouldHighlight ? `<span class="highlight">${word}</span>` : word;
    });
    return normalizedWords.join("");
}
function applyQuoteLengthFilter(quotes) {
    const quoteLengthFilterValue = $("#quoteSearchPopup .quoteLengthFilter").val();
    if (quoteLengthFilterValue.length === 0) {
        return quotes;
    }
    const quoteLengthFilter = quoteLengthFilterValue.map((filterValue) => parseInt(filterValue, 10));
    const filteredQuotes = quotes.filter((quote) => quoteLengthFilter.includes(quote.group));
    return filteredQuotes;
}
function buildQuoteSearchResult(quote, matchedSearchTerms) {
    let lengthDesc;
    if (quote.length < 101) {
        lengthDesc = "short";
    }
    else if (quote.length < 301) {
        lengthDesc = "medium";
    }
    else if (quote.length < 601) {
        lengthDesc = "long";
    }
    else {
        lengthDesc = "thicc";
    }
    const isNotAuthed = !firebase_1.Auth.currentUser;
    return `
  <div class="searchResult" id="${quote.id}">
    <div class="text">
      ${highlightMatches(quote.text, matchedSearchTerms)}
    </div>
    <div class="id">
      <div class="sub">id</div>
      <span class="quote-id">
        ${highlightMatches(quote.id.toString(), matchedSearchTerms)}
      </span>
    </div>
    <div class="length">
      <div class="sub">length</div>
      ${lengthDesc}
    </div>
    <div class="source">
      <div class="sub">source</div>
      ${highlightMatches(quote.source, matchedSearchTerms)}</div>
    <div class="icon-button report ${isNotAuthed && "hidden"}" aria-label="Report quote" data-balloon-pos="left">
      <i class="fas fa-flag report"></i>
    </div>
  </div>
  `;
}
function updateResults(searchText) {
    return __awaiter(this, void 0, void 0, function* () {
        const { quotes } = yield quotes_controller_1.default.getQuotes(config_1.default.language);
        const quoteSearchService = getSearchService(config_1.default.language, quotes, (quote) => {
            return `${quote.text} ${quote.id} ${quote.source}`;
        });
        const { results: matches, matchedQueryTerms } = quoteSearchService.query(searchText);
        const quotesToShow = applyQuoteLengthFilter(searchText === "" ? quotes : matches);
        const resultsList = $("#quoteSearchResults");
        resultsList.empty();
        quotesToShow.slice(0, 100).forEach((quote) => {
            const quoteSearchResult = buildQuoteSearchResult(quote, matchedQueryTerms);
            resultsList.append(quoteSearchResult);
        });
        const resultsExceededText = quotesToShow.length > 100
            ? "<span style='opacity: 0.5'>(only showing 100)</span>"
            : "";
        $("#extraResults").html(`${quotesToShow.length} results ${resultsExceededText}`);
    });
}
function show(clearText = true) {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        if ($("#quoteSearchPopupWrapper").hasClass("hidden")) {
            if (clearText) {
                $("#quoteSearchPopup input").val("");
            }
            const quoteSearchInputValue = $("#quoteSearchPopup input").val();
            if (!firebase_1.Auth.currentUser) {
                $("#quoteSearchPopup #gotoSubmitQuoteButton").addClass("hidden");
            }
            else {
                $("#quoteSearchPopup #gotoSubmitQuoteButton").removeClass("hidden");
            }
            if ((_a = DB.getSnapshot()) === null || _a === void 0 ? void 0 : _a.quoteMod) {
                $("#quoteSearchPopup #goToApproveQuotes").removeClass("hidden");
            }
            else {
                $("#quoteSearchPopup #goToApproveQuotes").addClass("hidden");
            }
            $("#quoteSearchPopup .quoteLengthFilter").select2({
                placeholder: "Filter by length",
                maximumSelectionLength: Infinity,
                multiple: true,
                width: "100%",
                data: [
                    {
                        id: 0,
                        text: "short",
                        selected: false,
                    },
                    {
                        id: 1,
                        text: "medium",
                        selected: false,
                    },
                    {
                        id: 2,
                        text: "long",
                        selected: false,
                    },
                    {
                        id: 3,
                        text: "thicc",
                        selected: false,
                    },
                ],
            });
            $("#quoteSearchPopupWrapper")
                .stop(true, true)
                .css("opacity", 0)
                .removeClass("hidden")
                .animate({ opacity: 1 }, 100, () => {
                if (clearText) {
                    $("#quoteSearchPopup input").trigger("focus").select();
                }
                updateResults(quoteSearchInputValue);
            });
        }
    });
}
exports.show = show;
function hide(noAnim = false, focusWords = true) {
    if (!$("#quoteSearchPopupWrapper").hasClass("hidden")) {
        $("#quoteSearchPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, noAnim ? 0 : 100, () => {
            $("#quoteSearchPopupWrapper").addClass("hidden");
            if (focusWords) {
                TestUI.focusWords();
                $("#quoteSearchPopup .quoteLengthFilter").val([]);
                $("#quoteSearchPopup .quoteLengthFilter").trigger("change");
            }
        });
    }
}
exports.hide = hide;
function apply(val) {
    if (isNaN(val)) {
        val = parseInt(document.getElementById("searchBox").value);
    }
    let ret;
    if (val !== null && !isNaN(val) && val >= 0) {
        UpdateConfig.setQuoteLength(-2, false);
        exports.selectedId = val;
        ManualRestart.set();
        ret = true;
    }
    else {
        Notifications.add("Quote ID must be at least 1", 0);
        ret = false;
    }
    hide();
    return ret;
}
exports.apply = apply;
const searchForQuotes = (0, debounce_1.debounce)(() => {
    const searchText = document.getElementById("searchBox")
        .value;
    updateResults(searchText);
});
$("#quoteSearchPopup .searchBox").on("keyup", (e) => {
    if (e.code === "Escape")
        return;
    searchForQuotes();
});
$("#quoteSearchPopup .quoteLengthFilter").on("change", searchForQuotes);
$("#quoteSearchPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "quoteSearchPopupWrapper") {
        hide();
    }
});
$(document).on("click", "#quoteSearchPopup #gotoSubmitQuoteButton", () => {
    hide(true);
    QuoteSubmitPopup.show(true);
});
$(document).on("click", "#quoteSearchPopup #goToApproveQuotes", () => {
    hide(true);
    QuoteApprovePopup.show(true);
});
$(document).on("click", "#quoteSearchPopup .report", (e) => __awaiter(void 0, void 0, void 0, function* () {
    const quoteId = e.target.closest(".searchResult").id;
    const quoteIdSelectedForReport = parseInt(quoteId);
    hide(true, false);
    QuoteReportPopup.show({
        quoteId: quoteIdSelectedForReport,
        noAnim: true,
        previousPopupShowCallback: () => {
            show(false);
        },
    });
}));
$(document).on("click", "#top .config .quoteLength .text-button", (e) => {
    var _a;
    const len = (_a = $(e.currentTarget).attr("quoteLength")) !== null && _a !== void 0 ? _a : 0;
    if (len == -2) {
        show();
    }
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" &&
        !$("#quoteSearchPopupWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/popups/quote-submit-popup.ts":
/*!**************************************************!*\
  !*** ./src/scripts/popups/quote-submit-popup.ts ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
// import Config from "../config";
// import * as Misc from "../misc";
// let dropdownReady = false;
// async function initDropdown(): Promise<void> {
//   if (dropdownReady) return;
//   const languages = await Misc.getLanguageList();
//   languages.forEach((language) => {
//     if (
//       language === "english_commonly_misspelled" ||
//       language === "hungarian_2.5k"
//     )
//       return;
//     if (!/_\d*k$/g.test(language)) {
//       $("#quoteSubmitPopup #submitQuoteLanguage").append(
//         `<option value="${language}">${language.replace(/_/g, " ")}</option>`
//       );
//     }
//   });
//   $("#quoteSubmitPopup #submitQuoteLanguage").select2();
//   dropdownReady = true;
// }
function submitQuote() {
    return __awaiter(this, void 0, void 0, function* () {
        const text = $("#quoteSubmitPopup #submitQuoteText").val();
        const source = $("#quoteSubmitPopup #submitQuoteSource").val();
        const language = $("#quoteSubmitPopup #submitQuoteLanguage").val();
        const captcha = $("#quoteSubmitPopup #g-recaptcha-response").val();
        if (!text || !source || !language) {
            return Notifications.add("Please fill in all fields", 0);
        }
        Loader.show();
        const response = yield ape_1.default.quotes.submit(text, source, language, captcha);
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to submit quote: " + response.message, -1);
        }
        Notifications.add("Quote submitted.", 1);
        $("#quoteSubmitPopup #submitQuoteText").val("");
        $("#quoteSubmitPopup #submitQuoteSource").val("");
        $("#quoteSubmitPopup .characterCount").removeClass("red");
        $("#quoteSubmitPopup .characterCount").text("-");
        grecaptcha.reset();
    });
}
// @ts-ignore
// eslint-disable-next-line
function show(noAnim = false) {
    return __awaiter(this, void 0, void 0, function* () {
        Notifications.add("Quote submission is disabled temporarily due to a large submission queue.", 0, 5);
        return;
        // if ($("#quoteSubmitPopupWrapper").hasClass("hidden")) {
        //   await initDropdown();
        //   $("#quoteSubmitPopup #submitQuoteLanguage").val(
        //     Config.language.replace(/_\d*k$/g, "")
        //   );
        //   $("#quoteSubmitPopup #submitQuoteLanguage").trigger("change");
        //   $("#quoteSubmitPopup input").val("");
        //   $("#quoteSubmitPopupWrapper")
        //     .stop(true, true)
        //     .css("opacity", 0)
        //     .removeClass("hidden")
        //     .animate({ opacity: 1 }, noAnim ? 0 : 100, () => {
        //       $("#quoteSubmitPopup textarea").trigger("focus").select();
        //     });
        // }
    });
}
exports.show = show;
function hide() {
    if (!$("#quoteSubmitPopupWrapper").hasClass("hidden")) {
        $("#quoteSubmitPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#quoteSubmitPopupWrapper").addClass("hidden");
        });
    }
}
exports.hide = hide;
$("#quoteSubmitPopupWrapper").on("mousedown", (e) => {
    if ($(e.target).attr("id") === "quoteSubmitPopupWrapper") {
        hide();
    }
});
$(document).on("click", "#quoteSubmitPopup #submitQuoteButton", () => {
    submitQuote();
});
$("#quoteSubmitPopup textarea").on("input", () => {
    setTimeout(() => {
        var _a;
        const len = (_a = $("#quoteSubmitPopup textarea").val()) === null || _a === void 0 ? void 0 : _a.length;
        $("#quoteSubmitPopup .characterCount").text(len);
        if (len < 60) {
            $("#quoteSubmitPopup .characterCount").addClass("red");
        }
        else {
            $("#quoteSubmitPopup .characterCount").removeClass("red");
        }
    }, 1);
});
$("#quoteSubmitPopup input").on("keydown", (e) => {
    if (e.key === "Enter") {
        submitQuote();
    }
});


/***/ }),

/***/ "./src/scripts/popups/result-tags-popup.ts":
/*!*************************************************!*\
  !*** ./src/scripts/popups/result-tags-popup.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateButtons = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function show() {
    if ($("#resultEditTagsPanelWrapper").hasClass("hidden")) {
        $("#resultEditTagsPanelWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 125);
    }
}
function hide() {
    if (!$("#resultEditTagsPanelWrapper").hasClass("hidden")) {
        $("#resultEditTagsPanelWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#resultEditTagsPanelWrapper").addClass("hidden");
        });
    }
}
function updateButtons() {
    var _a;
    $("#resultEditTagsPanel .buttons").empty();
    (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
        $("#resultEditTagsPanel .buttons").append(`<div class="button tag" tagid="${tag._id}">${tag.name}</div>`);
    });
}
exports.updateButtons = updateButtons;
function updateActiveButtons(active) {
    if (active === [])
        return;
    $.each($("#resultEditTagsPanel .buttons .button"), (_, obj) => {
        var _a;
        const tagid = (_a = $(obj).attr("tagid")) !== null && _a !== void 0 ? _a : "";
        if (active.includes(tagid)) {
            $(obj).addClass("active");
        }
        else {
            $(obj).removeClass("active");
        }
    });
}
$(document).on("click", ".pageAccount .group.history #resultEditTags", (f) => {
    var _a;
    if (((_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.length) || 0 > 0) {
        const resultid = $(f.target).parents("span").attr("resultid");
        const tags = $(f.target).parents("span").attr("tags");
        $("#resultEditTagsPanel").attr("resultid", resultid);
        $("#resultEditTagsPanel").attr("tags", tags);
        updateActiveButtons(JSON.parse(tags));
        show();
    }
});
$(document).on("click", "#resultEditTagsPanelWrapper .button.tag", (f) => {
    $(f.target).toggleClass("active");
});
$("#resultEditTagsPanelWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "resultEditTagsPanelWrapper") {
        hide();
    }
});
$("#resultEditTagsPanel .confirmButton").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    const resultId = $("#resultEditTagsPanel").attr("resultid");
    // let oldtags = JSON.parse($("#resultEditTagsPanel").attr("tags"));
    const newTags = [];
    $.each($("#resultEditTagsPanel .buttons .button"), (_, obj) => {
        var _a;
        const tagid = (_a = $(obj).attr("tagid")) !== null && _a !== void 0 ? _a : "";
        if ($(obj).hasClass("active")) {
            newTags.push(tagid);
        }
    });
    Loader.show();
    hide();
    const response = yield ape_1.default.results.updateTags(resultId, newTags);
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to update result tags: " + response.message, -1);
    }
    Notifications.add("Tags updated.", 1, 2);
    (_a = DB.getSnapshot().results) === null || _a === void 0 ? void 0 : _a.forEach((result) => {
        if (result._id === resultId) {
            result.tags = newTags;
        }
    });
    let tagNames = "";
    if (newTags.length > 0) {
        newTags.forEach((tag) => {
            var _a;
            (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((snaptag) => {
                if (tag === snaptag._id) {
                    tagNames += snaptag.name + ", ";
                }
            });
        });
        tagNames = tagNames.substring(0, tagNames.length - 2);
    }
    let restags;
    if (newTags === undefined) {
        restags = "[]";
    }
    else {
        restags = JSON.stringify(newTags);
    }
    $(`.pageAccount #resultEditTags[resultid='${resultId}']`).attr("tags", restags);
    if (newTags.length > 0) {
        $(`.pageAccount #resultEditTags[resultid='${resultId}']`).css("opacity", 1);
        $(`.pageAccount #resultEditTags[resultid='${resultId}']`).attr("aria-label", tagNames);
    }
    else {
        $(`.pageAccount #resultEditTags[resultid='${resultId}']`).css("opacity", 0.25);
        $(`.pageAccount #resultEditTags[resultid='${resultId}']`).attr("aria-label", "no tags");
    }
}));


/***/ }),

/***/ "./src/scripts/popups/saved-texts-popup.ts":
/*!*************************************************!*\
  !*** ./src/scripts/popups/saved-texts-popup.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
function show() {
    return __awaiter(this, void 0, void 0, function* () {
        const names = CustomText.getCustomTextNames();
        const listEl = $(`#savedTextsPopup .list`).empty();
        let list = "";
        if (names.length === 0) {
            list += "<div>No saved custom texts found</div>";
        }
        else {
            for (const name of names) {
                list += `<div class="savedText">
      <div class="button name">${name}</div>
      <div class="button delete">
      <i class="fas fa-fw fa-trash"></i>
      </div>
      </div>`;
            }
        }
        listEl.html(list);
        $("#savedTextsPopupWrapper").removeClass("hidden");
        $("#customTextPopupWrapper").addClass("hidden");
    });
}
exports.show = show;
function hide(full = false) {
    $("#savedTextsPopupWrapper").addClass("hidden");
    if (!full)
        $("#customTextPopupWrapper").removeClass("hidden");
}
function applySaved(name) {
    const text = CustomText.getCustomText(name);
    $(`#customTextPopupWrapper textarea`).val(text.join(CustomText.delimiter));
}
$(document).on("click", `#savedTextsPopupWrapper .list .savedText .button.name`, (e) => {
    const name = $(e.target).text();
    applySaved(name);
    hide();
});
$(document).on("click", `#savedTextsPopupWrapper .list .savedText .button.delete`, () => {
    hide(true);
});
$("#savedTextsPopupWrapper").mousedown((e) => {
    if ($(e.target).attr("id") === "savedTextsPopupWrapper") {
        hide();
    }
});


/***/ }),

/***/ "./src/scripts/popups/simple-popups.ts":
/*!*********************************************!*\
  !*** ./src/scripts/popups/simple-popups.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.list = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const AccountController = __importStar(__webpack_require__(/*! ../controllers/account-controller */ "./src/scripts/controllers/account-controller.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const ApeKeysPopup = __importStar(__webpack_require__(/*! ../popups/ape-keys-popup */ "./src/scripts/popups/ape-keys-popup.ts"));
const ThemePicker = __importStar(__webpack_require__(/*! ../settings/theme-picker */ "./src/scripts/settings/theme-picker.ts"));
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
const CustomTextPopup = __importStar(__webpack_require__(/*! ../popups/custom-text-popup */ "./src/scripts/popups/custom-text-popup.ts"));
const SavedTextsPopup = __importStar(__webpack_require__(/*! ./saved-texts-popup */ "./src/scripts/popups/saved-texts-popup.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const auth_1 = __webpack_require__(/*! firebase/auth */ "./node_modules/firebase/auth/dist/index.esm.js");
let activePopup = null;
exports.list = {};
class SimplePopup {
    constructor(id, type, title, inputs = [], text = "", buttonText = "Confirm", execFn, beforeInitFn, beforeShowFn) {
        this.parameters = [];
        this.id = id;
        this.type = type;
        this.execFn = (thisPopup, ...vals) => execFn(thisPopup, ...vals);
        this.title = title;
        this.inputs = inputs;
        this.text = text;
        this.wrapper = $("#simplePopupWrapper");
        this.element = $("#simplePopup");
        this.buttonText = buttonText;
        this.beforeInitFn = (thisPopup) => beforeInitFn(thisPopup);
        this.beforeShowFn = (thisPopup) => beforeShowFn(thisPopup);
        this.canClose = true;
    }
    reset() {
        this.element.html(`
    <div class="title"></div>
    <div class="inputs"></div>
    <div class="text"></div>
    <div class="button"></div>`);
    }
    init() {
        const el = this.element;
        el.find("input").val("");
        // if (el.attr("popupId") !== this.id) {
        this.reset();
        el.attr("popupId", this.id);
        el.find(".title").text(this.title);
        el.find(".text").text(this.text);
        this.initInputs();
        if (this.buttonText === "") {
            el.find(".button").remove();
        }
        else {
            el.find(".button").text(this.buttonText);
        }
        if (this.text === "") {
            el.find(".text").addClass("hidden");
        }
        else {
            el.find(".text").removeClass("hidden");
        }
        // }
    }
    initInputs() {
        const el = this.element;
        if (this.inputs.length > 0) {
            if (this.type === "number") {
                this.inputs.forEach((input) => {
                    el.find(".inputs").append(`
            <input
              type="number"
              min="1"
              value="${input.initVal}"
              placeholder="${input.placeholder}"
              class="${input.hidden ? "hidden" : ""}"
              ${input.hidden ? "" : "required"}
              autocomplete="off"
            >
          `);
                });
            }
            else if (this.type === "text") {
                this.inputs.forEach((input) => {
                    if (input.type) {
                        if (input.type === "textarea") {
                            el.find(".inputs").append(`
                <textarea
                  placeholder="${input.placeholder}"
                  class="${input.hidden ? "hidden" : ""}"
                  ${input.hidden ? "" : "required"}
                  ${input.disabled ? "disabled" : ""}
                  autocomplete="off"
                >${input.initVal}</textarea>
              `);
                        }
                        else if (input.type === "checkbox") {
                            el.find(".inputs").append(`
                <label class="checkbox">
                  <input type="checkbox">
                  <div class="customTextCheckbox"></div>
                  ${input.label}
                </label>
              `);
                        }
                        else {
                            el.find(".inputs").append(`
              <input
              type="${input.type}"
              value="${input.initVal}"
              placeholder="${input.placeholder}"
              class="${input.hidden ? "hidden" : ""}"
              ${input.hidden ? "" : "required"}
              ${input.disabled ? "disabled" : ""}
              autocomplete="off"
              >
              `);
                        }
                    }
                    else {
                        el.find(".inputs").append(`
              <input
                type="text"
                value="${input.initVal}"
                placeholder="${input.placeholder}"
                class="${input.hidden ? "hidden" : ""}"
                ${input.hidden ? "" : "required"}
                ${input.disabled ? "disabled" : ""}
                autocomplete="off"
              >
            `);
                    }
                });
            }
            el.find(".inputs").removeClass("hidden");
        }
        else {
            el.find(".inputs").addClass("hidden");
        }
    }
    exec() {
        if (!this.canClose)
            return;
        const vals = [];
        $.each($("#simplePopup input"), (_, el) => {
            if ($(el).is(":checkbox")) {
                vals.push($(el).is(":checked") ? "true" : "false");
            }
            else {
                vals.push($(el).val());
            }
        });
        this.execFn(this, ...vals);
        this.hide();
    }
    show(parameters = []) {
        activePopup = this;
        this.parameters = parameters;
        this.beforeInitFn(this);
        this.init();
        this.beforeShowFn(this);
        this.wrapper
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 125, () => {
            $($("#simplePopup").find("input")[0]).trigger("focus");
        });
    }
    hide() {
        if (!this.canClose)
            return;
        activePopup = null;
        this.wrapper
            .stop(true, true)
            .css("opacity", 1)
            .removeClass("hidden")
            .animate({ opacity: 0 }, 125, () => {
            this.wrapper.addClass("hidden");
        });
    }
}
function hide() {
    if (activePopup)
        return activePopup.hide();
    $("#simplePopupWrapper")
        .stop(true, true)
        .css("opacity", 1)
        .removeClass("hidden")
        .animate({ opacity: 0 }, 125, () => {
        $("#simplePopupWrapper").addClass("hidden");
    });
}
exports.hide = hide;
$("#simplePopupWrapper").mousedown((e) => {
    if ($(e.target).attr("id") === "simplePopupWrapper") {
        if (activePopup)
            return activePopup.hide();
        $("#simplePopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .removeClass("hidden")
            .animate({ opacity: 0 }, 125, () => {
            $("#simplePopupWrapper").addClass("hidden");
        });
    }
});
$(document).on("click", "#simplePopupWrapper .button", () => {
    var _a;
    const id = (_a = $("#simplePopup").attr("popupId")) !== null && _a !== void 0 ? _a : "";
    exports.list[id].exec();
});
$(document).on("keyup", "#simplePopupWrapper input", (e) => {
    var _a;
    if (e.key === "Enter") {
        e.preventDefault();
        const id = (_a = $("#simplePopup").attr("popupId")) !== null && _a !== void 0 ? _a : "";
        exports.list[id].exec();
    }
});
exports.list.updateEmail = new SimplePopup("updateEmail", "text", "Update Email", [
    {
        placeholder: "Password",
        type: "password",
        initVal: "",
    },
    {
        placeholder: "New email",
        initVal: "",
    },
    {
        placeholder: "Confirm new email",
        initVal: "",
    },
], "", "Update", (_thisPopup, password, email, emailConfirm) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (email !== emailConfirm) {
            Notifications.add("Emails don't match", 0);
            return;
        }
        if (user.providerData[0].providerId === "password") {
            const credential = auth_1.EmailAuthProvider.credential(user.email, password);
            yield (0, auth_1.reauthenticateWithCredential)(user, credential);
        }
        Loader.show();
        const response = yield ape_1.default.users.updateEmail(email, user.email);
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to update email: " + response.message, -1);
        }
        Notifications.add("Email updated", 1);
        setTimeout(() => {
            window.location.reload();
        }, 1000);
    }
    catch (e) {
        const typedError = e;
        if (typedError.code === "auth/wrong-password") {
            Notifications.add("Incorrect password", -1);
        }
        else {
            Notifications.add("Something went wrong: " + e, -1);
        }
    }
}), (thisPopup) => {
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    if (!user.providerData.find((p) => (p === null || p === void 0 ? void 0 : p.providerId) === "password")) {
        thisPopup.inputs = [];
        thisPopup.buttonText = "";
        thisPopup.text = "Password authentication is not enabled";
    }
}, (_thisPopup) => {
    //
});
exports.list.updateName = new SimplePopup("updateName", "text", "Update Name", [
    {
        placeholder: "Password",
        type: "password",
        initVal: "",
    },
    {
        placeholder: "New name",
        type: "text",
        initVal: "",
    },
], "", "Update", (_thisPopup, pass, newName) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (user.providerData[0].providerId === "password") {
            const credential = auth_1.EmailAuthProvider.credential(user.email, pass);
            yield (0, auth_1.reauthenticateWithCredential)(user, credential);
        }
        else if (user.providerData[0].providerId === "google.com") {
            yield (0, auth_1.reauthenticateWithPopup)(user, AccountController.gmailProvider);
        }
        Loader.show();
        const checkNameResponse = yield ape_1.default.users.getNameAvailability(newName);
        if (checkNameResponse.status !== 200) {
            Loader.hide();
            return Notifications.add("Failed to check name: " + checkNameResponse.message, -1);
        }
        const updateNameResponse = yield ape_1.default.users.updateName(newName);
        if (updateNameResponse.status !== 200) {
            Loader.hide();
            return Notifications.add("Failed to update name: " + updateNameResponse.message, -1);
        }
        Notifications.add("Name updated", 1);
        DB.getSnapshot().name = newName;
        $("#menu .icon-button.account .text").text(newName);
    }
    catch (e) {
        const typedError = e;
        if (typedError.code === "auth/wrong-password") {
            Notifications.add("Incorrect password", -1);
        }
        else {
            Notifications.add("Something went wrong: " + e, -1);
        }
    }
    Loader.hide();
}), (thisPopup) => {
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    if (user.providerData[0].providerId === "google.com") {
        thisPopup.inputs[0].hidden = true;
        thisPopup.buttonText = "Reauthenticate to update";
    }
}, (_thisPopup) => {
    //
});
exports.list.updatePassword = new SimplePopup("updatePassword", "text", "Update Password", [
    {
        placeholder: "Password",
        type: "password",
        initVal: "",
    },
    {
        placeholder: "New password",
        type: "password",
        initVal: "",
    },
    {
        placeholder: "Confirm new password",
        type: "password",
        initVal: "",
    },
], "", "Update", (_thisPopup, previousPass, newPass, newPassConfirm) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        const credential = auth_1.EmailAuthProvider.credential(user.email, previousPass);
        if (newPass !== newPassConfirm) {
            Notifications.add("New passwords don't match", 0);
            return;
        }
        Loader.show();
        yield (0, auth_1.reauthenticateWithCredential)(user, credential);
        yield (0, auth_1.updatePassword)(user, newPass);
        Loader.hide();
        Notifications.add("Password updated", 1);
        setTimeout(() => {
            window.location.reload();
        }, 1000);
    }
    catch (e) {
        const typedError = e;
        Loader.hide();
        if (typedError.code === "auth/wrong-password") {
            Notifications.add("Incorrect password", -1);
        }
        else {
            Notifications.add("Something went wrong: " + e, -1);
        }
    }
}), (thisPopup) => {
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    if (!user.providerData.find((p) => (p === null || p === void 0 ? void 0 : p.providerId) === "password")) {
        thisPopup.inputs = [];
        thisPopup.buttonText = "";
        thisPopup.text = "Password authentication is not enabled";
    }
}, (_thisPopup) => {
    //
});
exports.list.addPasswordAuth = new SimplePopup("addPasswordAuth", "text", "Add Password Authentication", [
    {
        placeholder: "email",
        type: "email",
        initVal: "",
    },
    {
        placeholder: "confirm email",
        type: "email",
        initVal: "",
    },
    {
        placeholder: "new password",
        type: "password",
        initVal: "",
    },
    {
        placeholder: "confirm new password",
        type: "password",
        initVal: "",
    },
], "", "Add", (_thisPopup, email, emailConfirm, pass, passConfirm) => __awaiter(void 0, void 0, void 0, function* () {
    if (email !== emailConfirm) {
        Notifications.add("Emails don't match", 0);
        return;
    }
    if (pass !== passConfirm) {
        Notifications.add("Passwords don't match", 0);
        return;
    }
    yield AccountController.addPasswordAuth(email, pass);
}), () => {
    //
}, (_thisPopup) => {
    //
});
exports.list.deleteAccount = new SimplePopup("deleteAccount", "text", "Delete Account", [
    {
        placeholder: "Password",
        type: "password",
        initVal: "",
    },
], "This is the last time you can change your mind. After pressing the button everything is gone.", "Delete", (_thisPopup, password) => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    //
    try {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (user.providerData[0].providerId === "password") {
            const credential = auth_1.EmailAuthProvider.credential(user.email, password);
            yield (0, auth_1.reauthenticateWithCredential)(user, credential);
        }
        else if (user.providerData[0].providerId === "google.com") {
            yield (0, auth_1.reauthenticateWithPopup)(user, AccountController.gmailProvider);
        }
        Loader.show();
        Notifications.add("Deleting stats...", 0);
        const usersResponse = yield ape_1.default.users.delete();
        Loader.hide();
        if (usersResponse.status !== 200) {
            return Notifications.add("Failed to delete user stats: " + usersResponse.message, -1);
        }
        Loader.show();
        Notifications.add("Deleting results...", 0);
        const resultsResponse = yield ape_1.default.results.deleteAll();
        Loader.hide();
        if (resultsResponse.status !== 200) {
            return Notifications.add("Failed to delete user results: " + resultsResponse.message, -1);
        }
        Notifications.add("Deleting login information...", 0);
        yield ((_a = firebase_1.Auth.currentUser) === null || _a === void 0 ? void 0 : _a.delete());
        Notifications.add("Goodbye", 1, 5);
        setTimeout(() => {
            location.reload();
        }, 3000);
    }
    catch (e) {
        const typedError = e;
        Loader.hide();
        if (typedError.code === "auth/wrong-password") {
            Notifications.add("Incorrect password", -1);
        }
        else {
            Notifications.add("Something went wrong: " + e, -1);
        }
    }
}), (thisPopup) => {
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    if (user.providerData[0].providerId === "google.com") {
        thisPopup.inputs = [];
        thisPopup.buttonText = "Reauthenticate to delete";
    }
}, (_thisPopup) => {
    //
});
exports.list.clearTagPb = new SimplePopup("clearTagPb", "text", "Clear Tag PB", [], `Are you sure you want to clear this tags PB?`, "Clear", (thisPopup) => __awaiter(void 0, void 0, void 0, function* () {
    var _b;
    const tagId = thisPopup.parameters[0];
    Loader.show();
    const response = yield ape_1.default.users.deleteTagPersonalBest(tagId);
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to delete tag's PB: " + response.message);
    }
    if (response.data.resultCode === 1) {
        const tag = (_b = DB.getSnapshot().tags) === null || _b === void 0 ? void 0 : _b.filter((t) => t._id === tagId)[0];
        if (tag === undefined)
            return;
        tag.personalBests = {
            time: {},
            words: {},
            zen: { zen: [] },
            quote: { custom: [] },
            custom: { custom: [] },
        };
        $(`.pageSettings .section.tags .tagsList .tag[id="${tagId}"] .clearPbButton`).attr("aria-label", "No PB found");
        Notifications.add("Tag PB cleared.", 0);
    }
    else {
        Notifications.add("Something went wrong: " + response.message, -1);
    }
}), (thisPopup) => {
    thisPopup.text = `Are you sure you want to clear PB for tag ${thisPopup.parameters[1]}?`;
}, (_thisPopup) => {
    //
});
exports.list.applyCustomFont = new SimplePopup("applyCustomFont", "text", "Custom font", [{ placeholder: "Font name", initVal: "" }], "Make sure you have the font installed on your computer before applying.", "Apply", (_thisPopup, fontName) => {
    var _a;
    if (fontName === "")
        return;
    (_a = Settings.groups["fontFamily"]) === null || _a === void 0 ? void 0 : _a.setValue(fontName.replace(/\s/g, "_"));
}, () => {
    //
}, (_thisPopup) => {
    //
});
exports.list.resetPersonalBests = new SimplePopup("resetPersonalBests", "text", "Reset Personal Bests", [
    {
        placeholder: "Password",
        type: "password",
        initVal: "",
    },
], "", "Reset", (_thisPopup, password) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (user.providerData[0].providerId === "password") {
            const credential = auth_1.EmailAuthProvider.credential(user.email, password);
            yield (0, auth_1.reauthenticateWithCredential)(user, credential);
        }
        else if (user.providerData[0].providerId === "google.com") {
            yield (0, auth_1.reauthenticateWithPopup)(user, AccountController.gmailProvider);
        }
        Loader.show();
        const response = yield ape_1.default.users.deletePersonalBests();
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to reset personal bests: " + response.message, -1);
        }
        Notifications.add("Personal bests have been reset", 1);
        DB.getSnapshot().personalBests = {
            time: {},
            words: {},
            zen: { zen: [] },
            quote: { custom: [] },
            custom: { custom: [] },
        };
    }
    catch (e) {
        Loader.hide();
        Notifications.add(e, -1);
    }
}), (thisPopup) => {
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    if (user.providerData[0].providerId === "google.com") {
        thisPopup.inputs = [];
        thisPopup.buttonText = "Reauthenticate to reset";
    }
}, (_thisPopup) => {
    //
});
exports.list.resetSettings = new SimplePopup("resetSettings", "text", "Reset Settings", [], "Are you sure you want to reset all your settings?", "Reset", () => {
    UpdateConfig.reset();
    // setTimeout(() => {
    //   location.reload();
    // }, 1000);
}, () => {
    //
}, (_thisPopup) => {
    //
});
exports.list.unlinkDiscord = new SimplePopup("unlinkDiscord", "text", "Unlink Discord", [], "Are you sure you want to unlink your Discord account?", "Unlink", () => __awaiter(void 0, void 0, void 0, function* () {
    Loader.show();
    const response = yield ape_1.default.users.unlinkDiscord();
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to unlink Discord: " + response.message, -1);
    }
    Notifications.add("Accounts unlinked", 1);
    DB.getSnapshot().discordId = undefined;
    Settings.updateDiscordSection();
}), () => {
    //
}, (_thisPopup) => {
    //
});
exports.list.generateApeKey = new SimplePopup("generateApeKey", "text", "Generate new key", [
    {
        placeholder: "Name",
        initVal: "",
    },
], "", "Generate", (_thisPopup, name) => __awaiter(void 0, void 0, void 0, function* () {
    Loader.show();
    const response = yield ape_1.default.apeKeys.generate(name, false);
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to generate key: " + response.message, -1);
    }
    else {
        const data = response.data;
        exports.list["viewApeKey"].show([data.apeKey]);
    }
}), () => {
    //
}, (_thisPopup) => {
    //
});
exports.list.viewApeKey = new SimplePopup("viewApeKey", "text", "Ape Key", [
    {
        type: "textarea",
        disabled: true,
        placeholder: "Key",
        initVal: "",
    },
], "This is your new Ape Key. Please keep it safe. You will only see it once!", "Close", (_thisPopup) => {
    ApeKeysPopup.show();
}, (_thisPopup) => {
    _thisPopup.inputs[0].initVal = _thisPopup.parameters[0];
}, (_thisPopup) => {
    _thisPopup.canClose = false;
    $("#simplePopup textarea").css("height", "110px");
    $("#simplePopup .button").addClass("hidden");
    setTimeout(() => {
        _thisPopup.canClose = true;
        $("#simplePopup .button").removeClass("hidden");
    }, 3000);
});
exports.list.deleteApeKey = new SimplePopup("deleteApeKey", "text", "Delete Ape Key", [], "Are you sure?", "Delete", (_thisPopup) => __awaiter(void 0, void 0, void 0, function* () {
    Loader.show();
    const response = yield ape_1.default.apeKeys.delete(_thisPopup.parameters[0]);
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to delete key: " + response.message, -1);
    }
    Notifications.add("Key deleted", 1);
    ApeKeysPopup.show();
}), (_thisPopup) => {
    //
}, (_thisPopup) => {
    //
});
exports.list.editApeKey = new SimplePopup("editApeKey", "text", "Edit Ape Key", [
    {
        placeholder: "Name",
        initVal: "",
    },
], "", "Edit", (_thisPopup, input) => __awaiter(void 0, void 0, void 0, function* () {
    Loader.show();
    const response = yield ape_1.default.apeKeys.update(_thisPopup.parameters[0], {
        name: input,
    });
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to update key: " + response.message, -1);
    }
    Notifications.add("Key updated", 1);
    ApeKeysPopup.show();
}), (_thisPopup) => {
    //
}, (_thisPopup) => {
    //
});
exports.list.saveCustomText = new SimplePopup("saveCustomText", "text", "Save custom text", [
    {
        placeholder: "Name",
        initVal: "",
    },
], "", "Save", (_thisPopup, input) => {
    const text = $(`#customTextPopup textarea`).val().normalize();
    CustomText.setCustomText(input, text);
    Notifications.add("Custom text saved", 1);
    CustomTextPopup.show();
}, () => {
    //
}, () => {
    //
});
exports.list.deleteCustomText = new SimplePopup("deleteCustomText", "text", "Delete custom text", [], "Are you sure?", "Delete", (_thisPopup) => {
    CustomText.deleteCustomText(_thisPopup.parameters[0]);
    Notifications.add("Custom text deleted", 1);
    SavedTextsPopup.show();
}, (_thisPopup) => {
    _thisPopup.text = `Are you sure you want to delete custom text ${_thisPopup.parameters[0]}?`;
}, () => {
    //
});
exports.list.updateCustomTheme = new SimplePopup("updateCustomTheme", "text", "Update Custom Theme", [
    {
        type: "text",
        placeholder: "Name",
        initVal: "",
    },
    {
        type: "checkbox",
        initVal: "false",
        label: "Update custom theme to current colors",
    },
], "", "Update", (_thisPopup, name, updateColors) => __awaiter(void 0, void 0, void 0, function* () {
    const snapshot = DB.getSnapshot();
    const customTheme = snapshot.customThemes.find((t) => t._id === _thisPopup.parameters[0]);
    if (customTheme === undefined) {
        Notifications.add("Custom theme does not exist!", -1);
        return;
    }
    let newColors = [];
    if (updateColors === "true") {
        $.each($(".pageSettings .customTheme .customThemeEdit [type='color']"), (_index, element) => {
            newColors.push($(element).attr("value"));
        });
    }
    else {
        newColors = customTheme.colors;
    }
    const newTheme = {
        name: name,
        colors: newColors,
    };
    Loader.show();
    yield DB.editCustomTheme(customTheme._id, newTheme);
    Loader.hide();
    UpdateConfig.setCustomThemeColors(newColors);
    Notifications.add("Custom theme updated", 1);
    ThemePicker.refreshButtons();
}), (_thisPopup) => {
    const snapshot = DB.getSnapshot();
    const customTheme = snapshot.customThemes.find((t) => t._id === _thisPopup.parameters[0]);
    if (!customTheme)
        return;
    _thisPopup.inputs[0].initVal = customTheme.name;
}, (_thisPopup) => {
    //
});
exports.list.deleteCustomTheme = new SimplePopup("deleteCustomTheme", "text", "Delete Custom Theme", [], "Are you sure?", "Delete", (_thisPopup) => __awaiter(void 0, void 0, void 0, function* () {
    Loader.show();
    yield DB.deleteCustomTheme(_thisPopup.parameters[0]);
    Loader.hide();
    Notifications.add("Custom theme deleted", 1);
    ThemePicker.refreshButtons();
}), (_thisPopup) => {
    //
}, (_thisPopup) => {
    //
});
$(".pageSettings .section.discordIntegration #unlinkDiscordButton").on("click", () => {
    exports.list["unlinkDiscord"].show();
});
$("#resetSettingsButton").on("click", () => {
    exports.list["resetSettings"].show();
});
$(".pageSettings #resetPersonalBestsButton").on("click", () => {
    exports.list["resetPersonalBests"].show();
});
$(".pageSettings #updateAccountName").on("click", () => {
    exports.list["updateName"].show();
});
$(".pageSettings #addPasswordAuth").on("click", () => {
    exports.list["addPasswordAuth"].show();
});
$(".pageSettings #emailPasswordAuth").on("click", () => {
    exports.list["updateEmail"].show();
});
$(".pageSettings #passPasswordAuth").on("click", () => {
    exports.list["updatePassword"].show();
});
$(".pageSettings #deleteAccount").on("click", () => {
    exports.list["deleteAccount"].show();
});
$("#apeKeysPopup .generateApeKey").on("click", () => {
    exports.list["generateApeKey"].show();
});
$(`#customTextPopup .buttonsTop .saveCustomText`).on("click", () => {
    exports.list["saveCustomText"].show();
});
$(document).on("click", ".pageSettings .section.themes .customTheme .delButton", (e) => {
    const $parentElement = $(e.currentTarget).parent(".customTheme.button");
    const customThemeId = $parentElement.attr("customThemeId");
    exports.list["deleteCustomTheme"].show([customThemeId]);
});
$(document).on("click", ".pageSettings .section.themes .customTheme .editButton", (e) => {
    const $parentElement = $(e.currentTarget).parent(".customTheme.button");
    const customThemeId = $parentElement.attr("customThemeId");
    exports.list["updateCustomTheme"].show([customThemeId]);
});
$(document).on("click", `#savedTextsPopupWrapper .list .savedText .button.delete`, (e) => {
    const name = $(e.target).siblings(".button.name").text();
    exports.list["deleteCustomText"].show([name]);
});
$(document).on("click", "#apeKeysPopup table tbody tr .button.delete", (e) => {
    const keyId = $(e.target).closest("tr").attr("keyId");
    exports.list["deleteApeKey"].show([keyId]);
});
$(document).on("click", "#apeKeysPopup table tbody tr .button.edit", (e) => {
    const keyId = $(e.target).closest("tr").attr("keyId");
    exports.list["editApeKey"].show([keyId]);
});
$(document).on("click", ".pageSettings .section.fontFamily .button.custom", () => {
    exports.list["applyCustomFont"].show([]);
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" && !$("#simplePopupWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/popups/support-popup.ts":
/*!*********************************************!*\
  !*** ./src/scripts/popups/support-popup.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const Commandline = __importStar(__webpack_require__(/*! ../elements/commandline */ "./src/scripts/elements/commandline.ts"));
const CommandlineLists = __importStar(__webpack_require__(/*! ../elements/commandline-lists */ "./src/scripts/elements/commandline-lists.ts"));
$(document.body).on("click", "#supportMeButton", () => {
    $("#supportMeWrapper")
        .css("opacity", 0)
        .removeClass("hidden")
        .animate({ opacity: 1 }, 125);
});
$(document.body).on("click", "#supportMeWrapper", () => {
    $("#supportMeWrapper")
        .css("opacity", 1)
        .animate({ opacity: 0 }, 125, () => {
        $("#supportMeWrapper").addClass("hidden");
    });
});
$(document.body).on("click", "#supportMeWrapper .button.ads", () => {
    CommandlineLists.pushCurrent(CommandlineLists.commandsEnableAds);
    Commandline.show();
    $("#supportMeWrapper")
        .css("opacity", 1)
        .animate({ opacity: 0 }, 125, () => {
        $("#supportMeWrapper").addClass("hidden");
    });
});
$(document.body).on("click", "#supportMeWrapper a.button", () => {
    $("#supportMeWrapper")
        .css("opacity", 1)
        .animate({ opacity: 0 }, 125, () => {
        $("#supportMeWrapper").addClass("hidden");
    });
});


/***/ }),

/***/ "./src/scripts/popups/version-popup.ts":
/*!*********************************************!*\
  !*** ./src/scripts/popups/version-popup.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
function show() {
    $("#versionHistoryWrapper")
        .css("opacity", 0)
        .removeClass("hidden")
        .animate({ opacity: 1 }, 125);
}
exports.show = show;
$(document.body).on("click", ".version", (e) => {
    if (e.shiftKey)
        return;
    show();
});
$(document.body).on("click", "#versionHistoryWrapper", (e) => {
    if ($(e.target).attr("id") === "versionHistoryWrapper") {
        $("#versionHistoryWrapper")
            .css("opacity", 1)
            .animate({ opacity: 0 }, 125, () => {
            $("#versionHistoryWrapper").addClass("hidden");
        });
    }
});


/***/ }),

/***/ "./src/scripts/popups/word-filter-popup.ts":
/*!*************************************************!*\
  !*** ./src/scripts/popups/word-filter-popup.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
let initialised = false;
function init() {
    return __awaiter(this, void 0, void 0, function* () {
        if (!initialised) {
            $("#wordFilterPopup .languageInput").empty();
            const LanguageList = yield Misc.getLanguageList();
            LanguageList.forEach((language) => {
                let prettyLang = language;
                prettyLang = prettyLang.replace("_", " ");
                $("#wordFilterPopup .languageInput").append(`
        <option value=${language}>${prettyLang}</option>
      `);
            });
            initialised = true;
        }
    });
}
function show() {
    return __awaiter(this, void 0, void 0, function* () {
        yield init();
        $("#wordFilterPopupWrapper").removeClass("hidden");
        $("#customTextPopupWrapper").addClass("hidden");
        $("#wordFilterPopup .languageInput").select2({
            width: "100%",
        });
    });
}
exports.show = show;
function hide() {
    $("#wordFilterPopupWrapper").addClass("hidden");
    $("#customTextPopupWrapper").removeClass("hidden");
}
function filter(language) {
    return __awaiter(this, void 0, void 0, function* () {
        let filterin = $("#wordFilterPopup .wordIncludeInput").val();
        filterin = Misc.escapeRegExp(filterin === null || filterin === void 0 ? void 0 : filterin.trim());
        filterin = filterin.replace(/\s+/gi, "|");
        const regincl = new RegExp(filterin, "i");
        let filterout = $("#wordFilterPopup .wordExcludeInput").val();
        filterout = Misc.escapeRegExp(filterout.trim());
        filterout = filterout.replace(/\s+/gi, "|");
        const regexcl = new RegExp(filterout, "i");
        const filteredWords = [];
        const languageWordList = yield Misc.getLanguage(language);
        const maxLengthInput = $("#wordFilterPopup .wordMaxInput").val();
        const minLengthInput = $("#wordFilterPopup .wordMinInput").val();
        let maxLength;
        let minLength;
        if (maxLengthInput == "") {
            maxLength = 999;
        }
        else {
            maxLength = parseInt(maxLengthInput);
        }
        if (minLengthInput == "") {
            minLength = 1;
        }
        else {
            minLength = parseInt(minLengthInput);
        }
        for (let i = 0; i < languageWordList.words.length; i++) {
            const word = languageWordList.words[i];
            const test1 = regincl.test(word);
            const test2 = regexcl.test(word);
            if (((test1 && !test2) || (test1 && filterout == "")) &&
                word.length <= maxLength &&
                word.length >= minLength) {
                filteredWords.push(word);
            }
        }
        return filteredWords;
    });
}
function apply(set) {
    return __awaiter(this, void 0, void 0, function* () {
        const language = $("#wordFilterPopup .languageInput").val();
        const filteredWords = yield filter(language);
        const customText = filteredWords.join(CustomText.delimiter);
        $("#customTextPopup textarea").val((_, val) => (set ? "" : val + " ") + customText);
        hide();
    });
}
$("#wordFilterPopupWrapper").mousedown((e) => {
    if ($(e.target).attr("id") === "wordFilterPopupWrapper") {
        hide();
    }
});
$("#wordFilterPopup .languageInput").one("select2:open", function () {
    $("input.select2-search__field").prop("placeholder", "search");
});
$("#wordFilterPopupWrapper .button").mousedown((e) => {
    $("#wordFilterPopupWrapper .loadingIndicator").removeClass("hidden");
    $("#wordFilterPopupWrapper .button").addClass("hidden");
    setTimeout(() => {
        apply($(e.target).is("#set")).then(() => {
            $("#wordFilterPopupWrapper .loadingIndicator").addClass("hidden");
            $("#wordFilterPopupWrapper .button").removeClass("hidden");
        });
    }, 1);
});


/***/ }),

/***/ "./src/scripts/ready.ts":
/*!******************************!*\
  !*** ./src/scripts/ready.ts ***!
  \******************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const ManualRestart = __importStar(__webpack_require__(/*! ./test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const config_1 = __importStar(__webpack_require__(/*! ./config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Misc = __importStar(__webpack_require__(/*! ./utils/misc */ "./src/scripts/utils/misc.ts"));
const VerificationController = __importStar(__webpack_require__(/*! ./controllers/verification-controller */ "./src/scripts/controllers/verification-controller.ts"));
const RouteController = __importStar(__webpack_require__(/*! ./controllers/route-controller */ "./src/scripts/controllers/route-controller.ts"));
const PageController = __importStar(__webpack_require__(/*! ./controllers/page-controller */ "./src/scripts/controllers/page-controller.ts"));
const MonkeyPower = __importStar(__webpack_require__(/*! ./elements/monkey-power */ "./src/scripts/elements/monkey-power.ts"));
const NewVersionNotification = __importStar(__webpack_require__(/*! ./elements/version-check */ "./src/scripts/elements/version-check.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Focus = __importStar(__webpack_require__(/*! ./test/focus */ "./src/scripts/test/focus.ts"));
ManualRestart.set();
UpdateConfig.loadFromLocalStorage();
if (window.location.hostname === "localhost") {
    $("#bottom .version .text").text("localhost");
    $("#bottom .version").css("opacity", 1);
}
else {
    Misc.getReleasesFromGitHub().then((v) => {
        NewVersionNotification.show(v[0].name);
    });
}
Focus.set(true, true);
RouteController.handleInitialPageClasses(window.location.pathname);
$(document).ready(() => {
    if (window.location.pathname === "/") {
        // $("#top .config").removeClass("hidden");
    }
    $("body").css("transition", "all .25s, transform .05s");
    if (config_1.default.quickTab) {
        $("#restartTestButton").addClass("hidden");
    }
    if (!window.localStorage.getItem("merchbannerclosed")) {
        Notifications.addBanner(`Checkout our merchandise, available at <a target="_blank" href="https://monkeytype.store/">monkeytype.store</a>`, 1, "images/merchdropwebsite2.png", false, () => {
            window.localStorage.setItem("merchbannerclosed", "true");
        });
    }
    $("#centerContent")
        .css("opacity", "0")
        .removeClass("hidden")
        .stop(true, true)
        .animate({ opacity: 1 }, 250, () => {
        if (window.location.pathname === "/verify") {
            const fragment = new URLSearchParams(window.location.hash.slice(1));
            if (fragment.has("access_token")) {
                const accessToken = fragment.get("access_token");
                const tokenType = fragment.get("token_type");
                VerificationController.set({
                    accessToken: accessToken,
                    tokenType: tokenType,
                });
                history.replaceState("/", "", "/");
            }
            const page = window.location.pathname.replace("/", "");
            PageController.change(page);
        }
        else if (window.location.pathname === "/account") {
            // history.replaceState("/", null, "/");
        }
        else if (/challenge_.+/g.test(window.location.pathname)) {
            //do nothing
            // }
        }
        else if (window.location.pathname !== "/") {
            // let page = window.location.pathname.replace("/", "");
            // PageController.change(page);
        }
    });
    // Settings.settingsFillPromise.then(Settings.update);
    MonkeyPower.init();
});


/***/ }),

/***/ "./src/scripts/settings/settings-group.ts":
/*!************************************************!*\
  !*** ./src/scripts/settings/settings-group.ts ***!
  \************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
class SettingsGroup {
    constructor(configName, configFunction, mode, setCallback, updateCallback) {
        this.configName = configName;
        this.configValue = config_1.default[configName];
        this.mode = mode;
        this.configFunction = configFunction;
        this.setCallback = setCallback;
        this.updateCallback = updateCallback;
        this.updateInput();
        if (this.mode === "select") {
            $(document).on("change", `.pageSettings .section.${this.configName} select`, (e) => {
                const target = $(e.currentTarget);
                if (target.hasClass("disabled") ||
                    target.hasClass("no-auto-handle")) {
                    return;
                }
                this.setValue(target.val());
            });
        }
        else if (this.mode === "button") {
            $(document).on("click", `.pageSettings .section.${this.configName} .button`, (e) => {
                const target = $(e.currentTarget);
                if (target.hasClass("disabled") ||
                    target.hasClass("no-auto-handle")) {
                    return;
                }
                let value = target.attr(configName);
                const params = target.attr("params");
                if (!value && !params)
                    return;
                if (value === "true")
                    value = true;
                if (value === "false")
                    value = false;
                this.setValue(value, params);
            });
        }
    }
    setValue(value, params) {
        if (params === undefined) {
            this.configFunction(value);
        }
        else {
            this.configFunction(value, ...params);
        }
        this.updateInput();
        if (this.setCallback)
            this.setCallback();
    }
    updateInput() {
        this.configValue = config_1.default[this.configName];
        $(`.pageSettings .section.${this.configName} .button`).removeClass("active");
        if (this.mode === "select") {
            $(`.pageSettings .section.${this.configName} select`)
                .val(this.configValue)
                .trigger("change.select2");
        }
        else if (this.mode === "button") {
            $(`.pageSettings .section.${this.configName} .button[${this.configName}='${this.configValue}']`).addClass("active");
        }
        if (this.updateCallback)
            this.updateCallback();
    }
}
exports["default"] = SettingsGroup;


/***/ }),

/***/ "./src/scripts/settings/theme-picker.ts":
/*!**********************************************!*\
  !*** ./src/scripts/settings/theme-picker.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateActiveTab = exports.saveCustomThemeColors = exports.setCustomInputs = exports.refreshButtons = exports.updateActiveButton = void 0;
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const ThemeController = __importStar(__webpack_require__(/*! ../controllers/theme-controller */ "./src/scripts/controllers/theme-controller.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const ChartController = __importStar(__webpack_require__(/*! ../controllers/chart-controller */ "./src/scripts/controllers/chart-controller.ts"));
const CustomThemePopup = __importStar(__webpack_require__(/*! ../popups/custom-theme-popup */ "./src/scripts/popups/custom-theme-popup.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
function updateActiveButton() {
    let activeThemeName = config_1.default.theme;
    if (config_1.default.randomTheme !== "off" &&
        config_1.default.randomTheme !== "custom" &&
        ThemeController.randomTheme !== null) {
        activeThemeName = ThemeController.randomTheme;
    }
    $(`.pageSettings .section.themes .theme`).removeClass("active");
    $(`.pageSettings .section.themes .theme[theme=${activeThemeName}]`).addClass("active");
}
exports.updateActiveButton = updateActiveButton;
function updateColors(colorPicker, color, onlyStyle = false, noThemeUpdate = false) {
    if (onlyStyle) {
        const colorID = colorPicker.find("input[type=color]").attr("id");
        if (colorID === undefined)
            console.error("Could not find color ID!");
        if (!noThemeUpdate && colorID !== undefined) {
            document.documentElement.style.setProperty(colorID, color);
        }
        const pickerButton = colorPicker.find("label");
        pickerButton.val(color);
        pickerButton.attr("value", color);
        if (pickerButton.attr("for") !== "--bg-color") {
            pickerButton.css("background-color", color);
        }
        colorPicker.find("input[type=text]").val(color);
        colorPicker.find("input[type=color]").attr("value", color);
        return;
    }
    const colorREGEX = [
        {
            rule: /\b[0-9]{1,3},\s?[0-9]{1,3},\s?[0-9]{1,3}\s*\b/,
            start: "rgb(",
            end: ")",
        },
        {
            rule: /\b[A-Z, a-z, 0-9]{6}\b/,
            start: "#",
            end: "",
        },
        {
            rule: /\b[0-9]{1,3},\s?[0-9]{1,3}%,\s?[0-9]{1,3}%?\s*\b/,
            start: "hsl(",
            end: ")",
        },
    ];
    color = color.replace("", "");
    for (const regex of colorREGEX) {
        if (color.match(regex.rule)) {
            color = regex.start + color + regex.end;
            break;
        }
    }
    $(".colorConverter").css("color", color);
    const hexColor = Misc.convertRGBtoHEX($(".colorConverter").css("color"));
    if (hexColor === undefined) {
        return;
    }
    color = hexColor;
    const colorID = colorPicker.find("input[type=color]").attr("id");
    if (colorID === undefined)
        console.error("Could not find color ID!");
    if (!noThemeUpdate && colorID !== undefined) {
        document.documentElement.style.setProperty(colorID, color);
    }
    const pickerButton = colorPicker.find("label");
    pickerButton.val(color);
    pickerButton.attr("value", color);
    if (pickerButton.attr("for") !== "--bg-color") {
        pickerButton.css("background-color", color);
    }
    colorPicker.find("input[type=text]").val(color);
    colorPicker.find("input[type=color]").attr("value", color);
}
function refreshButtons() {
    return __awaiter(this, void 0, void 0, function* () {
        if (config_1.default.customTheme) {
            // Update custom theme buttons
            const customThemesEl = $(".pageSettings .section.themes .allCustomThemes.buttons").empty();
            const addButton = $(".pageSettings .section.themes .addCustomThemeButton");
            if (firebase_1.Auth.currentUser === null) {
                $(".pageSettings .section.themes .customThemeEdit .saveCustomThemeButton").text("save");
                return;
            }
            else {
                $(".pageSettings .section.themes .customThemeEdit .saveCustomThemeButton").text("save as new");
            }
            addButton.removeClass("hidden");
            const customThemes = DB.getSnapshot().customThemes;
            customThemes.forEach((customTheme) => {
                // const activeTheme =
                //   Config.customThemeId === customTheme._id ? "active" : "";
                const bgColor = customTheme.colors[0];
                const mainColor = customTheme.colors[1];
                customThemesEl.append(`<div class="customTheme button" customThemeId='${customTheme._id}' 
        style="color:${mainColor};background:${bgColor}">
        <div class="editButton"><i class="fas fa-pen"></i></div>
        <div class="text">${customTheme.name.replace(/_/g, " ")}</div>
        <div class="delButton"><i class="fas fa-trash fa-fw"></i></div>
        </div>`);
            });
        }
        else {
            // Update theme buttons
            const favThemesEl = $(".pageSettings .section.themes .favThemes.buttons").empty();
            const themesEl = $(".pageSettings .section.themes .allThemes.buttons").empty();
            let activeThemeName = config_1.default.theme;
            if (config_1.default.randomTheme !== "off" &&
                config_1.default.randomTheme !== "custom" &&
                ThemeController.randomTheme !== null) {
                activeThemeName = ThemeController.randomTheme;
            }
            const themes = yield Misc.getSortedThemesList();
            //first show favourites
            if (config_1.default.favThemes.length > 0) {
                favThemesEl.css({ paddingBottom: "1rem" });
                themes.forEach((theme) => {
                    if (config_1.default.favThemes.includes(theme.name)) {
                        const activeTheme = activeThemeName === theme.name ? "active" : "";
                        favThemesEl.append(`<div class="theme button ${activeTheme}" theme='${theme.name}' 
            style="color:${theme.mainColor};background:${theme.bgColor}">
            <div class="activeIndicator"><i class="fas fa-circle"></i></div>
            <div class="text">${theme.name.replace(/_/g, " ")}</div>
            <div class="favButton active"><i class="fas fa-star"></i></div></div>`);
                    }
                });
            }
            else {
                favThemesEl.css({ paddingBottom: "0" });
            }
            //then the rest
            themes.forEach((theme) => {
                if (config_1.default.favThemes.includes(theme.name)) {
                    return;
                }
                const activeTheme = activeThemeName === theme.name ? "active" : "";
                themesEl.append(`<div class="theme button ${activeTheme}" theme='${theme.name}' style="color:${theme.mainColor};background:${theme.bgColor}">
        <div class="activeIndicator"><i class="fas fa-circle"></i></div>
        <div class="text">${theme.name.replace(/_/g, " ")}</div>
        <div class="favButton"><i class="far fa-star"></i></div></div>`);
            });
        }
        updateActiveButton();
    });
}
exports.refreshButtons = refreshButtons;
function setCustomInputs(noThemeUpdate = false) {
    $(".pageSettings .section.themes .tabContainer .customTheme .colorPicker").each((_index, element) => {
        const currentColor = config_1.default.customThemeColors[ThemeController.colorVars.indexOf($(element).find("input[type=color]").attr("id"))];
        updateColors($(element), currentColor, false, noThemeUpdate);
    });
}
exports.setCustomInputs = setCustomInputs;
function toggleFavourite(themeName) {
    if (config_1.default.favThemes.includes(themeName)) {
        // already favourite, remove
        UpdateConfig.setFavThemes(config_1.default.favThemes.filter((t) => t !== themeName));
    }
    else {
        // add to favourites
        const newList = config_1.default.favThemes;
        newList.push(themeName);
        UpdateConfig.setFavThemes(newList);
    }
    UpdateConfig.saveFullConfigToLocalStorage();
}
function saveCustomThemeColors() {
    const newColors = [];
    $.each($(".pageSettings .customTheme .customThemeEdit [type='color']"), (_index, element) => {
        newColors.push($(element).attr("value"));
    });
    UpdateConfig.setCustomThemeColors(newColors);
    Notifications.add("Custom theme saved", 1);
}
exports.saveCustomThemeColors = saveCustomThemeColors;
function updateActiveTab(forced = false) {
    // Set force to true only when some change for the active tab has taken place
    // Prevent theme buttons from being added twice by doing an update only when the state has changed
    const $presetTabButton = $(".pageSettings .section.themes .tabs .button[tab='preset']");
    const $customTabButton = $(".pageSettings .section.themes .tabs .button[tab='custom']");
    if (config_1.default.customTheme) {
        $presetTabButton.removeClass("active");
        if (!$customTabButton.hasClass("active") || forced) {
            $customTabButton.addClass("active");
            refreshButtons();
        }
        Misc.swapElements($('.pageSettings [tabContent="preset"]'), $('.pageSettings [tabContent="custom"]'), 250);
    }
    else {
        $customTabButton.removeClass("active");
        if (!$presetTabButton.hasClass("active") || forced) {
            $presetTabButton.addClass("active");
            refreshButtons();
        }
        Misc.swapElements($('.pageSettings [tabContent="custom"]'), $('.pageSettings [tabContent="preset"]'), 250);
    }
}
exports.updateActiveTab = updateActiveTab;
// Add events to the DOM
// Handle click on theme: preset or custom tab
$(".pageSettings .section.themes .tabs .button").on("click", (e) => {
    $(".pageSettings .section.themes .tabs .button").removeClass("active");
    const $target = $(e.currentTarget);
    $target.addClass("active");
    // setCustomInputs();
    if ($target.attr("tab") == "preset") {
        UpdateConfig.setCustomTheme(false);
    }
    else {
        UpdateConfig.setCustomTheme(true);
    }
});
// Handle click on custom theme button
$(document).on("click", ".pageSettings .section.themes .customTheme.button", (e) => {
    var _a;
    // Do not apply if user wanted to delete it
    if ($(e.target).hasClass("delButton"))
        return;
    if ($(e.target).hasClass("editButton"))
        return;
    const customThemeId = (_a = $(e.currentTarget).attr("customThemeId")) !== null && _a !== void 0 ? _a : "";
    ThemeController.set(customThemeId, true);
});
// Handle click on favorite preset theme button
$(document).on("click", ".pageSettings .section.themes .theme .favButton", (e) => {
    const theme = $(e.currentTarget).parents(".theme.button").attr("theme");
    if (theme !== undefined)
        toggleFavourite(theme);
    else {
        console.error("Could not find the theme attribute attached to the button clicked!");
    }
});
// Handle click on preset theme button
$(document).on("click", ".pageSettings .section.themes .theme.button", (e) => {
    const theme = $(e.currentTarget).attr("theme");
    if (!$(e.target).hasClass("favButton") && theme !== undefined) {
        UpdateConfig.setTheme(theme);
        updateActiveButton();
    }
});
$(".pageSettings .section.themes .tabContainer .customTheme input[type=color]").on("input", (e) => {
    const $colorVar = $(e.currentTarget).attr("id");
    const $pickedColor = $(e.currentTarget).val();
    updateColors($(".colorPicker #" + $colorVar).parent(), $pickedColor, true);
});
$(".pageSettings .section.themes .tabContainer .customTheme input[type=color]").on("change", (e) => {
    const $colorVar = $(e.currentTarget).attr("id");
    const $pickedColor = $(e.currentTarget).val();
    updateColors($(".colorPicker #" + $colorVar).parent(), $pickedColor);
});
$(".pageSettings .section.themes .tabContainer .customTheme input[type=text]")
    .on("blur", (e) => {
    if (e.target.id === "name")
        return;
    const $colorVar = $(e.currentTarget).attr("id");
    const $pickedColor = $(e.currentTarget).val();
    updateColors($(".colorPicker #" + $colorVar).parent(), $pickedColor);
})
    .on("keypress", function (e) {
    if (e.target.id === "name")
        return;
    if (e.code === "Enter") {
        $(this).attr("disabled", "disabled");
        const $colorVar = $(e.currentTarget).attr("id");
        const $pickedColor = $(e.currentTarget).val();
        updateColors($(".colorPicker #" + $colorVar).parent(), $pickedColor);
        $(this).removeAttr("disabled");
    }
});
$(".pageSettings #loadCustomColorsFromPreset").on("click", () => {
    // previewTheme(Config.theme);
    $("#currentTheme").attr("href", `themes/${config_1.default.theme}.css`);
    ThemeController.colorVars.forEach((e) => {
        document.documentElement.style.setProperty(e, "");
    });
    setTimeout(() => __awaiter(void 0, void 0, void 0, function* () {
        ChartController.updateAllChartColors();
        const themeColors = yield ThemeColors.getAll();
        ThemeController.colorVars.forEach((colorName) => {
            let color;
            if (colorName === "--bg-color") {
                color = themeColors.bg;
            }
            else if (colorName === "--main-color") {
                color = themeColors.main;
            }
            else if (colorName === "--sub-color") {
                color = themeColors.sub;
            }
            else if (colorName === "--caret-color") {
                color = themeColors.caret;
            }
            else if (colorName === "--text-color") {
                color = themeColors.text;
            }
            else if (colorName === "--error-color") {
                color = themeColors.error;
            }
            else if (colorName === "--error-extra-color") {
                color = themeColors.errorExtra;
            }
            else if (colorName === "--colorful-error-color") {
                color = themeColors.colorfulError;
            }
            else if (colorName === "--colorful-error-extra-color") {
                color = themeColors.colorfulErrorExtra;
            }
            updateColors($(".colorPicker #" + colorName).parent(), color);
        });
    }), 250);
});
// Handles click on share custom theme button
$("#shareCustomThemeButton").on("click", () => {
    const share = [];
    $.each($(".pageSettings .customTheme .customThemeEdit [type='color']"), (_, element) => {
        share.push($(element).attr("value"));
    });
    const url = "https://monkeytype.com?customTheme=" + btoa(JSON.stringify(share));
    navigator.clipboard.writeText(url).then(function () {
        Notifications.add("URL Copied to clipboard", 0);
    }, function () {
        CustomThemePopup.show(url);
    });
});
$(".pageSettings .saveCustomThemeButton").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    saveCustomThemeColors();
    if (firebase_1.Auth.currentUser) {
        const newCustomTheme = {
            name: "custom",
            colors: config_1.default.customThemeColors,
        };
        Loader.show();
        const response = yield DB.addCustomTheme(newCustomTheme);
        Loader.hide();
        if (response) {
            updateActiveTab(true);
        }
    }
    else {
        updateActiveTab(true);
    }
}));
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "customThemeId")
        refreshButtons();
    // if (eventKey === "customTheme") updateActiveTab();
});


/***/ }),

/***/ "./src/scripts/states/active-page.ts":
/*!*******************************************!*\
  !*** ./src/scripts/states/active-page.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.set = exports.get = void 0;
let activePage = "loading";
function get() {
    return activePage;
}
exports.get = get;
function set(active) {
    activePage = active;
}
exports.set = set;


/***/ }),

/***/ "./src/scripts/states/glarses-mode.ts":
/*!********************************************!*\
  !*** ./src/scripts/states/glarses-mode.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.enable = exports.get = void 0;
let glarsesMode = false;
function get() {
    return glarsesMode;
}
exports.get = get;
function enable() {
    glarsesMode = true;
    console.log("Glarses Mode On - test result will be hidden. You can check the stats in the console (here)");
    console.log("To disable Glarses Mode refresh the page.");
}
exports.enable = enable;


/***/ }),

/***/ "./src/scripts/states/page-transition.ts":
/*!***********************************************!*\
  !*** ./src/scripts/states/page-transition.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.get = exports.set = void 0;
let transition = true;
function set(val) {
    transition = val;
}
exports.set = set;
function get() {
    return transition;
}
exports.get = get;


/***/ }),

/***/ "./src/scripts/states/slow-timer.ts":
/*!******************************************!*\
  !*** ./src/scripts/states/slow-timer.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.get = exports.clear = exports.set = void 0;
let slowTimer = false;
function set() {
    if (slowTimer)
        return;
    slowTimer = true;
    console.error("Slow timer, disabling animations");
    // Notifications.add("Slow timer detected", -1, 5);
}
exports.set = set;
function clear() {
    slowTimer = false;
}
exports.clear = clear;
function get() {
    return slowTimer;
}
exports.get = get;


/***/ }),

/***/ "./src/scripts/states/test-active.ts":
/*!*******************************************!*\
  !*** ./src/scripts/states/test-active.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.set = exports.get = void 0;
let testActive = false;
function get() {
    return testActive;
}
exports.get = get;
function set(active) {
    testActive = active;
}
exports.set = set;


/***/ }),

/***/ "./src/scripts/states/time.ts":
/*!************************************!*\
  !*** ./src/scripts/states/time.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.increment = exports.set = exports.get = void 0;
let time = 0;
function get() {
    return time;
}
exports.get = get;
function set(active) {
    time = active;
}
exports.set = set;
function increment() {
    time++;
}
exports.increment = increment;


/***/ }),

/***/ "./src/scripts/test/british-english.ts":
/*!*********************************************!*\
  !*** ./src/scripts/test/british-english.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.replace = exports.getList = void 0;
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
let list = [];
function getList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (list.length === 0) {
            return $.getJSON("languages/britishenglish.json", function (data) {
                list = data;
                return list;
            });
        }
        else {
            return list;
        }
    });
}
exports.getList = getList;
function replace(word) {
    return __awaiter(this, void 0, void 0, function* () {
        const list = yield getList();
        const replacement = list.find((a) => word.match(RegExp(`^([\\W]*${a[0]}[\\W]*)$`, "gi")));
        return replacement
            ? word.replace(RegExp(`^(?:([\\W]*)(${replacement[0]})([\\W]*))$`, "gi"), (_, $1, $2, $3) => $1 +
                ($2.charAt(0) === $2.charAt(0).toUpperCase()
                    ? $2 === $2.toUpperCase()
                        ? replacement[1].toUpperCase()
                        : (0, misc_1.capitalizeFirstLetterOfEachWord)(replacement[1])
                    : replacement[1]) +
                $3)
            : word;
    });
}
exports.replace = replace;


/***/ }),

/***/ "./src/scripts/test/caps-warning.ts":
/*!******************************************!*\
  !*** ./src/scripts/test/caps-warning.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.capsState = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
exports.capsState = false;
function show() {
    if ($("#capsWarning").hasClass("hidden")) {
        $("#capsWarning").removeClass("hidden");
    }
}
function hide() {
    if (!$("#capsWarning").hasClass("hidden")) {
        $("#capsWarning").addClass("hidden");
    }
}
$(document).keydown(function (event) {
    var _a, _b;
    if (((_a = event === null || event === void 0 ? void 0 : event.originalEvent) === null || _a === void 0 ? void 0 : _a.getModifierState) &&
        ((_b = event === null || event === void 0 ? void 0 : event.originalEvent) === null || _b === void 0 ? void 0 : _b.getModifierState("CapsLock"))) {
        exports.capsState = true;
    }
    else {
        exports.capsState = false;
    }
    try {
        if (config_1.default.capsLockWarning && exports.capsState) {
            show();
        }
        else {
            hide();
        }
    }
    catch (_c) { }
});
$(document).keyup(function (event) {
    var _a, _b;
    if (((_a = event === null || event === void 0 ? void 0 : event.originalEvent) === null || _a === void 0 ? void 0 : _a.getModifierState) &&
        ((_b = event === null || event === void 0 ? void 0 : event.originalEvent) === null || _b === void 0 ? void 0 : _b.getModifierState("CapsLock"))) {
        //filthy fix but optional chaining refues to work
        exports.capsState = true;
    }
    else {
        exports.capsState = false;
    }
    try {
        if (config_1.default.capsLockWarning && exports.capsState) {
            show();
        }
        else {
            hide();
        }
    }
    catch (_c) { }
});


/***/ }),

/***/ "./src/scripts/test/caret.ts":
/*!***********************************!*\
  !*** ./src/scripts/test/caret.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.updatePosition = exports.hide = exports.startAnimation = exports.stopAnimation = exports.caretAnimating = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
exports.caretAnimating = true;
function stopAnimation() {
    if (exports.caretAnimating === true) {
        $("#caret").css("animation-name", "none");
        $("#caret").css("opacity", "1");
        exports.caretAnimating = false;
    }
}
exports.stopAnimation = stopAnimation;
function startAnimation() {
    if (exports.caretAnimating === false) {
        if (config_1.default.smoothCaret && !SlowTimer.get()) {
            $("#caret").css("animation-name", "caretFlashSmooth");
        }
        else {
            $("#caret").css("animation-name", "caretFlashHard");
        }
        exports.caretAnimating = true;
    }
}
exports.startAnimation = startAnimation;
function hide() {
    $("#caret").addClass("hidden");
}
exports.hide = hide;
function updatePosition() {
    var _a, _b;
    return __awaiter(this, void 0, void 0, function* () {
        if ($("#wordsWrapper").hasClass("hidden"))
            return;
        // if ($("#caret").hasClass("off")) {
        //   return;
        // }
        const caret = $("#caret");
        let inputLen = TestInput.input.current.length;
        inputLen = Misc.trailingComposeChars.test(TestInput.input.current)
            ? TestInput.input.current.search(Misc.trailingComposeChars) + 1
            : inputLen;
        let currentLetterIndex = inputLen - 1;
        if (currentLetterIndex == -1) {
            currentLetterIndex = 0;
        }
        //insert temporary character so the caret will work in zen mode
        const activeWordEmpty = $("#words .active").children().length == 0;
        if (activeWordEmpty) {
            $("#words .active").append('<letter style="opacity: 0;">_</letter>');
        }
        const currentWordNodeList = (_a = document === null || document === void 0 ? void 0 : document.querySelector("#words .active")) === null || _a === void 0 ? void 0 : _a.querySelectorAll("letter");
        if (!currentWordNodeList)
            return;
        let currentLetter = currentWordNodeList[currentLetterIndex];
        if (inputLen > currentWordNodeList.length) {
            currentLetter = currentWordNodeList[currentWordNodeList.length - 1];
        }
        if (config_1.default.mode != "zen" && $(currentLetter).length == 0)
            return;
        const currentLanguage = yield Misc.getCurrentLanguage(config_1.default.language);
        const isLanguageLeftToRight = currentLanguage.leftToRight;
        const currentLetterPosLeft = isLanguageLeftToRight
            ? currentLetter.offsetLeft
            : currentLetter.offsetLeft + ((_b = $(currentLetter).width()) !== null && _b !== void 0 ? _b : 0);
        const currentLetterPosTop = currentLetter.offsetTop;
        const letterHeight = $(currentLetter).height();
        let newTop = 0;
        let newLeft = 0;
        newTop = currentLetterPosTop - Math.round(letterHeight / 5);
        if (inputLen == 0) {
            newLeft = isLanguageLeftToRight
                ? currentLetterPosLeft - caret.width() / 2
                : currentLetterPosLeft + caret.width() / 2;
        }
        else {
            newLeft = isLanguageLeftToRight
                ? currentLetterPosLeft +
                    $(currentLetter).width() -
                    caret.width() / 2
                : currentLetterPosLeft -
                    $(currentLetter).width() +
                    caret.width() / 2;
        }
        let smoothlinescroll = $("#words .smoothScroller").height();
        if (smoothlinescroll === undefined)
            smoothlinescroll = 0;
        if (config_1.default.smoothCaret) {
            caret.stop(true, false).animate({
                top: newTop - smoothlinescroll,
                left: newLeft,
            }, SlowTimer.get() ? 0 : 100);
        }
        else {
            caret.stop(true, true).animate({
                top: newTop - smoothlinescroll,
                left: newLeft,
            }, 0);
        }
        if (config_1.default.showAllLines) {
            const browserHeight = window.innerHeight;
            const middlePos = browserHeight / 2 - $("#caret").outerHeight() / 2;
            const contentHeight = document.body.scrollHeight;
            if (newTop >= middlePos &&
                contentHeight > browserHeight &&
                TestActive.get()) {
                const newscrolltop = newTop - middlePos / 2;
                // console.log('---------');
                // console.log(newTop);
                // console.log(middlePos);
                // console.log(browserHeight);
                // console.log(contentHeight);
                window.scrollTo({
                    left: 0,
                    top: newscrolltop,
                    behavior: "smooth",
                });
            }
        }
        if (activeWordEmpty) {
            $("#words .active").children().remove();
        }
    });
}
exports.updatePosition = updatePosition;
function show() {
    if ($("#result").hasClass("hidden")) {
        updatePosition();
        $("#caret").removeClass("hidden");
        startAnimation();
    }
}
exports.show = show;


/***/ }),

/***/ "./src/scripts/test/custom-text.ts":
/*!*****************************************!*\
  !*** ./src/scripts/test/custom-text.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getCustomTextNames = exports.deleteCustomText = exports.setCustomText = exports.getCustomText = exports.setDelimiter = exports.setWord = exports.setTime = exports.setIsTimeRandom = exports.setIsWordRandom = exports.setText = exports.delimiter = exports.time = exports.word = exports.isTimeRandom = exports.isWordRandom = exports.text = void 0;
exports.text = [
    "The",
    "quick",
    "brown",
    "fox",
    "jumps",
    "over",
    "the",
    "lazy",
    "dog",
];
exports.isWordRandom = false;
exports.isTimeRandom = false;
exports.delimiter = " ";
function setText(txt) {
    exports.text = txt;
}
exports.setText = setText;
function setIsWordRandom(val) {
    exports.isWordRandom = val;
}
exports.setIsWordRandom = setIsWordRandom;
function setIsTimeRandom(val) {
    exports.isTimeRandom = val;
}
exports.setIsTimeRandom = setIsTimeRandom;
function setTime(val) {
    exports.time = val;
}
exports.setTime = setTime;
function setWord(val) {
    exports.word = val;
}
exports.setWord = setWord;
function setDelimiter(val) {
    exports.delimiter = val;
}
exports.setDelimiter = setDelimiter;
function getCustomText(name) {
    const customText = getCustomTextObject();
    return customText[name].split(/ +/);
}
exports.getCustomText = getCustomText;
function setCustomText(name, text) {
    const customText = getCustomTextObject();
    if (typeof text === "string")
        customText[name] = text;
    else
        customText[name] = text.join(" ");
    window.localStorage.setItem("customText", JSON.stringify(customText));
}
exports.setCustomText = setCustomText;
function deleteCustomText(name) {
    const customText = getCustomTextObject();
    if (customText[name])
        delete customText[name];
    window.localStorage.setItem("customText", JSON.stringify(customText));
}
exports.deleteCustomText = deleteCustomText;
function getCustomTextObject() {
    var _a;
    return JSON.parse((_a = window.localStorage.getItem("customText")) !== null && _a !== void 0 ? _a : "{}");
}
function getCustomTextNames() {
    return Object.keys(getCustomTextObject());
}
exports.getCustomTextNames = getCustomTextNames;


/***/ }),

/***/ "./src/scripts/test/focus.ts":
/*!***********************************!*\
  !*** ./src/scripts/test/focus.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.set = void 0;
const Caret = __importStar(__webpack_require__(/*! ./caret */ "./src/scripts/test/caret.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const unfocusPx = 3;
let state = false;
function set(foc, withCursor = false) {
    if (foc && !state) {
        state = true;
        Caret.stopAnimation();
        $("#top").addClass("focus");
        $("#bottom").addClass("focus");
        if (!withCursor)
            $("body").css("cursor", "none");
        $("#middle").addClass("focus");
        $("#bannerCenter").addClass("focus");
    }
    else if (!foc && state) {
        state = false;
        Caret.startAnimation();
        $("#top").removeClass("focus");
        $("#bottom").removeClass("focus");
        $("body").css("cursor", "default");
        $("#middle").removeClass("focus");
        $("#bannerCenter").removeClass("focus");
    }
}
exports.set = set;
$(document).mousemove(function (event) {
    if (!state)
        return;
    if (ActivePage.get() == "loading")
        return;
    if (ActivePage.get() == "account" && state == true)
        return;
    if ($("#top").hasClass("focus") &&
        event.originalEvent &&
        // To avoid mouse/desk vibration from creating a flashy effect, we'll unfocus @ >5px instead of >0px
        (event.originalEvent.movementX > unfocusPx ||
            event.originalEvent.movementY > unfocusPx)) {
        set(false);
    }
});


/***/ }),

/***/ "./src/scripts/test/funbox.ts":
/*!************************************!*\
  !*** ./src/scripts/test/funbox.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.rememberSettings = exports.activate = exports.clear = exports.setFunbox = exports.toggleScript = exports.reset = exports.startMemoryTimer = exports.resetMemoryTimer = void 0;
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ./manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const TTS = __importStar(__webpack_require__(/*! ./tts */ "./src/scripts/test/tts.ts"));
const ModesNotice = __importStar(__webpack_require__(/*! ../elements/modes-notice */ "./src/scripts/elements/modes-notice.ts"));
let modeSaved = null;
let memoryTimer = null;
let memoryInterval = null;
let settingsMemory = {};
function rememberSetting(settingName, value, setFunction) {
    var _a;
    (_a = settingsMemory[settingName]) !== null && _a !== void 0 ? _a : (settingsMemory[settingName] = {
        value,
        setFunction,
    });
}
function loadMemory() {
    Notifications.add("Reverting funbox settings", 0);
    Object.keys(settingsMemory).forEach((setting) => {
        settingsMemory[setting].setFunction(settingsMemory[setting].value, true);
    });
    settingsMemory = {};
}
function showMemoryTimer() {
    $("#typingTest #memoryTimer").stop(true, true).animate({
        opacity: 1,
    }, 125);
}
function hideMemoryTimer() {
    $("#typingTest #memoryTimer").stop(true, true).animate({
        opacity: 0,
    }, 125);
}
function resetMemoryTimer() {
    if (memoryInterval !== null) {
        clearInterval(memoryInterval);
        memoryInterval = null;
    }
    memoryTimer = null;
    hideMemoryTimer();
}
exports.resetMemoryTimer = resetMemoryTimer;
function updateMemoryTimer(sec) {
    $("#typingTest #memoryTimer").text(`Timer left to memorise all words: ${sec}s`);
}
function startMemoryTimer() {
    resetMemoryTimer();
    memoryTimer = Math.round(Math.pow(TestWords.words.length, 1.2));
    updateMemoryTimer(memoryTimer);
    showMemoryTimer();
    memoryInterval = setInterval(() => {
        if (memoryTimer === null)
            return;
        memoryTimer -= 1;
        memoryTimer == 0 ? hideMemoryTimer() : updateMemoryTimer(memoryTimer);
        if (memoryTimer <= 0) {
            resetMemoryTimer();
            $("#wordsWrapper").addClass("hidden");
        }
    }, 1000);
}
exports.startMemoryTimer = startMemoryTimer;
function reset() {
    resetMemoryTimer();
}
exports.reset = reset;
function toggleScript(...params) {
    if (config_1.default.funbox === "tts") {
        TTS.speak(params[0]);
    }
}
exports.toggleScript = toggleScript;
function setFunbox(funbox, mode) {
    modeSaved = mode;
    UpdateConfig.setFunbox(funbox, false);
    if (funbox === "none")
        loadMemory();
    return true;
}
exports.setFunbox = setFunbox;
function clear() {
    return __awaiter(this, void 0, void 0, function* () {
        $("#funBoxTheme").attr("href", ``);
        $("#words").removeClass("nospace");
        $("#words").removeClass("arrows");
        reset();
        $("#wordsWrapper").removeClass("hidden");
        ManualRestart.set();
        ModesNotice.update();
        return true;
    });
}
exports.clear = clear;
function activate(funbox) {
    return __awaiter(this, void 0, void 0, function* () {
        let mode = modeSaved;
        if (funbox === undefined || funbox === null) {
            funbox = config_1.default.funbox;
        }
        const funboxInfo = yield Misc.getFunbox(funbox);
        $("#funBoxTheme").attr("href", ``);
        $("#words").removeClass("nospace");
        $("#words").removeClass("arrows");
        if ((yield Misc.getCurrentLanguage(config_1.default.language)).ligatures) {
            if (funbox == "choo_choo" || funbox == "earthquake") {
                Notifications.add("Current language does not support this funbox mode", 0);
                UpdateConfig.setFunbox("none", true);
                yield clear();
                return;
            }
        }
        if (funbox !== "none" && (config_1.default.mode === "zen" || config_1.default.mode == "quote")) {
            if ((funboxInfo === null || funboxInfo === void 0 ? void 0 : funboxInfo.affectsWordGeneration) === true) {
                Notifications.add(`${Misc.capitalizeFirstLetterOfEachWord(config_1.default.mode)} mode does not support the ${funbox} funbox`, 0);
                UpdateConfig.setFunbox("none", true);
                yield clear();
                return;
            }
        }
        // if (funbox === "none") {
        reset();
        $("#wordsWrapper").removeClass("hidden");
        // }
        if (funbox === "none" && mode === undefined) {
            mode = null;
        }
        else if ((funbox !== "none" && mode === undefined) ||
            (funbox !== "none" && mode === null)) {
            const list = yield Misc.getFunboxList();
            mode = list.filter((f) => f.name === funbox)[0].type;
        }
        ManualRestart.set();
        if (mode === "style") {
            if (funbox != undefined) {
                $("#funBoxTheme").attr("href", `funbox/${funbox}.css`);
            }
            if (funbox === "simon_says") {
                UpdateConfig.setKeymapMode("next", true);
            }
            if (funbox === "read_ahead" ||
                funbox === "read_ahead_easy" ||
                funbox === "read_ahead_hard") {
                UpdateConfig.setHighlightMode("letter", true);
            }
        }
        else if (mode === "script") {
            if (funbox === "tts") {
                $("#funBoxTheme").attr("href", `funbox/simon_says.css`);
                UpdateConfig.setKeymapMode("off", true);
                UpdateConfig.setHighlightMode("letter", true);
            }
            else if (funbox === "layoutfluid") {
                UpdateConfig.setLayout(config_1.default.customLayoutfluid
                    ? config_1.default.customLayoutfluid.split("#")[0]
                    : "qwerty", true);
                UpdateConfig.setKeymapLayout(config_1.default.customLayoutfluid
                    ? config_1.default.customLayoutfluid.split("#")[0]
                    : "qwerty", true);
            }
            else if (funbox === "memory") {
                UpdateConfig.setMode("words", true);
                UpdateConfig.setShowAllLines(true, true);
                if (config_1.default.keymapMode === "next") {
                    UpdateConfig.setKeymapMode("react", true);
                }
            }
            else if (funbox === "nospace") {
                $("#words").addClass("nospace");
                UpdateConfig.setHighlightMode("letter", true);
            }
            else if (funbox === "arrows") {
                $("#words").addClass("arrows");
                UpdateConfig.setHighlightMode("letter", true);
            }
        }
        // ModesNotice.update();
        return true;
    });
}
exports.activate = activate;
function rememberSettings() {
    return __awaiter(this, void 0, void 0, function* () {
        const funbox = config_1.default.funbox;
        let mode = modeSaved;
        if (funbox === "none" && mode === undefined) {
            mode = null;
        }
        else if ((funbox !== "none" && mode === undefined) ||
            (funbox !== "none" && mode === null)) {
            const list = yield Misc.getFunboxList();
            mode = list.filter((f) => f.name === funbox)[0].type;
        }
        if (mode === "style") {
            if (funbox === "simon_says") {
                rememberSetting("keymapMode", config_1.default.keymapMode, UpdateConfig.setKeymapMode);
            }
            if (funbox === "read_ahead" ||
                funbox === "read_ahead_easy" ||
                funbox === "read_ahead_hard") {
                rememberSetting("highlightMode", config_1.default.highlightMode, UpdateConfig.setHighlightMode);
            }
        }
        else if (mode === "script") {
            if (funbox === "tts") {
                rememberSetting("keymapMode", config_1.default.keymapMode, UpdateConfig.setKeymapMode);
            }
            else if (funbox === "layoutfluid") {
                rememberSetting("keymapMode", config_1.default.keymapMode, UpdateConfig.setKeymapMode);
                rememberSetting("layout", config_1.default.layout, UpdateConfig.setLayout);
                rememberSetting("keymapLayout", config_1.default.keymapLayout, UpdateConfig.setKeymapLayout);
            }
            else if (funbox === "memory") {
                rememberSetting("mode", config_1.default.mode, UpdateConfig.setMode);
                rememberSetting("showAllLines", config_1.default.showAllLines, UpdateConfig.setShowAllLines);
                if (config_1.default.keymapMode === "next") {
                    rememberSetting("keymapMode", config_1.default.keymapMode, UpdateConfig.setKeymapMode);
                }
            }
            else if (funbox === "nospace") {
                rememberSetting("highlightMode", config_1.default.highlightMode, UpdateConfig.setHighlightMode);
            }
            else if (funbox === "arrows") {
                rememberSetting("highlightMode", config_1.default.highlightMode, UpdateConfig.setHighlightMode);
            }
            else if (funbox === "58008") {
                rememberSetting("numbers", config_1.default.numbers, UpdateConfig.setNumbers);
            }
        }
    });
}
exports.rememberSettings = rememberSettings;


/***/ }),

/***/ "./src/scripts/test/layout-emulator.ts":
/*!*********************************************!*\
  !*** ./src/scripts/test/layout-emulator.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getCharFromEvent = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const caps_warning_1 = __webpack_require__(/*! ./caps-warning */ "./src/scripts/test/caps-warning.ts");
function getCharFromEvent(event) {
    return __awaiter(this, void 0, void 0, function* () {
        function emulatedLayoutShouldShiftKey(event, newKeyPreview) {
            if (caps_warning_1.capsState)
                return Misc.isASCIILetter(newKeyPreview) !== event.shiftKey;
            return event.shiftKey;
        }
        const layout = yield Misc.getLayout(config_1.default.layout);
        let keyEventCodes = [];
        if (layout.type === "ansi") {
            keyEventCodes = [
                "Backquote",
                "Digit1",
                "Digit2",
                "Digit3",
                "Digit4",
                "Digit5",
                "Digit6",
                "Digit7",
                "Digit8",
                "Digit9",
                "Digit0",
                "Minus",
                "Equal",
                "KeyQ",
                "KeyW",
                "KeyE",
                "KeyR",
                "KeyT",
                "KeyY",
                "KeyU",
                "KeyI",
                "KeyO",
                "KeyP",
                "BracketLeft",
                "BracketRight",
                "Backslash",
                "KeyA",
                "KeyS",
                "KeyD",
                "KeyF",
                "KeyG",
                "KeyH",
                "KeyJ",
                "KeyK",
                "KeyL",
                "Semicolon",
                "Quote",
                "KeyZ",
                "KeyX",
                "KeyC",
                "KeyV",
                "KeyB",
                "KeyN",
                "KeyM",
                "Comma",
                "Period",
                "Slash",
                "Space",
            ];
        }
        else if (layout.type === "iso") {
            keyEventCodes = [
                "Backquote",
                "Digit1",
                "Digit2",
                "Digit3",
                "Digit4",
                "Digit5",
                "Digit6",
                "Digit7",
                "Digit8",
                "Digit9",
                "Digit0",
                "Minus",
                "Equal",
                "KeyQ",
                "KeyW",
                "KeyE",
                "KeyR",
                "KeyT",
                "KeyY",
                "KeyU",
                "KeyI",
                "KeyO",
                "KeyP",
                "BracketLeft",
                "BracketRight",
                "KeyA",
                "KeyS",
                "KeyD",
                "KeyF",
                "KeyG",
                "KeyH",
                "KeyJ",
                "KeyK",
                "KeyL",
                "Semicolon",
                "Quote",
                "IntlBackslash",
                "Backquote",
                "KeyZ",
                "KeyX",
                "KeyC",
                "KeyV",
                "KeyB",
                "KeyN",
                "KeyM",
                "Comma",
                "Period",
                "Slash",
                "Space",
            ];
        }
        else if (layout.type === "matrix") {
            keyEventCodes = [
                "Backquote",
                "Digit1",
                "Digit2",
                "Digit3",
                "Digit4",
                "Digit5",
                "Digit6",
                "Digit7",
                "Digit8",
                "Digit9",
                "Digit0",
                "Minus",
                "Equal",
                "KeyQ",
                "KeyW",
                "KeyE",
                "KeyR",
                "KeyT",
                "KeyY",
                "KeyU",
                "KeyI",
                "KeyO",
                "KeyP",
                "BracketLeft",
                "BracketRight",
                "Backslash",
                "KeyA",
                "KeyS",
                "KeyD",
                "KeyF",
                "KeyG",
                "KeyH",
                "KeyJ",
                "KeyK",
                "KeyL",
                "Semicolon",
                "Quote",
                "KeyZ",
                "KeyX",
                "KeyC",
                "KeyV",
                "KeyB",
                "KeyN",
                "KeyM",
                "Comma",
                "Period",
                "Slash",
                "Space",
            ];
        }
        const layoutKeys = layout.keys;
        const layoutMap = layoutKeys["row1"]
            .concat(layoutKeys["row2"])
            .concat(layoutKeys["row3"])
            .concat(layoutKeys["row4"])
            .concat(layoutKeys["row5"]);
        let mapIndex = null;
        for (let i = 0; i < keyEventCodes.length; i++) {
            if (event.code == keyEventCodes[i]) {
                mapIndex = i;
            }
        }
        if (!mapIndex) {
            if (event.code.includes("Numpad")) {
                return event.key;
            }
            else {
                return null;
            }
        }
        const newKeyPreview = layoutMap[mapIndex][0];
        const shift = emulatedLayoutShouldShiftKey(event, newKeyPreview) ? 1 : 0;
        const char = layoutMap[mapIndex][shift];
        if (char) {
            return char;
        }
        else {
            return event.key;
        }
    });
}
exports.getCharFromEvent = getCharFromEvent;


/***/ }),

/***/ "./src/scripts/test/lazy-mode.ts":
/*!***************************************!*\
  !*** ./src/scripts/test/lazy-mode.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.replaceAccents = void 0;
const accents = [
    ["", "a"],
    ["", "e"],
    ["", "i"],
    ["", "o"],
    ["", "u"],
    ["", "n"],
    ["", "c"],
    ["", "r"],
    ["", "d"],
    ["", "t"],
    ["", "ae"],
    ["", "oe"],
    ["", "w"],
    ["g", "g"],
    ["", "h"],
    ["", "j"],
    ["", "n"],
    ["", "s"],
    ["", "z"],
    ["", "y"],
    ["", "l"],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
];
function replaceAccents(word, accentsOverride) {
    let newWord = word;
    if (!accents && !accentsOverride)
        return newWord;
    let regex;
    const list = accentsOverride || accents;
    for (let i = 0; i < list.length; i++) {
        regex = new RegExp(`[${list[i][0]}]`, "gi");
        newWord = newWord.replace(regex, list[i][1]);
    }
    return newWord;
}
exports.replaceAccents = replaceAccents;


/***/ }),

/***/ "./src/scripts/test/live-acc.ts":
/*!**************************************!*\
  !*** ./src/scripts/test/live-acc.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = exports.update = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
function update(acc) {
    let number = Math.floor(acc);
    if (config_1.default.blindMode) {
        number = 100;
    }
    document.querySelector("#miniTimerAndLiveWpm .acc").innerHTML =
        number + "%";
    document.querySelector("#liveAcc").innerHTML = number + "%";
}
exports.update = update;
function show() {
    if (!config_1.default.showLiveAcc)
        return;
    if (!TestActive.get())
        return;
    if (config_1.default.timerStyle === "mini") {
        // $("#miniTimerAndLiveWpm .wpm").css("opacity", Config.timerOpacity);
        if (!$("#miniTimerAndLiveWpm .acc").hasClass("hidden"))
            return;
        $("#miniTimerAndLiveWpm .acc")
            .removeClass("hidden")
            .css("opacity", 0)
            .animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
    else {
        // $("#liveWpm").css("opacity", Config.timerOpacity);
        if (!$("#liveAcc").hasClass("hidden"))
            return;
        $("#liveAcc").removeClass("hidden").css("opacity", 0).animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
}
exports.show = show;
function hide() {
    // $("#liveWpm").css("opacity", 0);
    // $("#miniTimerAndLiveWpm .wpm").css("opacity", 0);
    $("#liveAcc").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#liveAcc").addClass("hidden");
    });
    $("#miniTimerAndLiveWpm .acc").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#miniTimerAndLiveWpm .acc").addClass("hidden");
    });
}
exports.hide = hide;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "showLiveAcc")
        eventValue ? show() : hide();
});


/***/ }),

/***/ "./src/scripts/test/live-burst.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/live-burst.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = exports.update = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
function update(burst) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!config_1.default.showLiveBurst)
            return;
        let number = burst;
        if (config_1.default.blindMode) {
            number = 0;
        }
        document.querySelector("#miniTimerAndLiveWpm .burst").innerHTML =
            number.toString();
        document.querySelector("#liveBurst").innerHTML =
            number.toString();
    });
}
exports.update = update;
function show() {
    if (!config_1.default.showLiveBurst)
        return;
    if (!TestActive.get())
        return;
    if (config_1.default.timerStyle === "mini") {
        if (!$("#miniTimerAndLiveWpm .burst").hasClass("hidden"))
            return;
        $("#miniTimerAndLiveWpm .burst")
            .removeClass("hidden")
            .css("opacity", 0)
            .animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
    else {
        if (!$("#liveBurst").hasClass("hidden"))
            return;
        $("#liveBurst").removeClass("hidden").css("opacity", 0).animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
}
exports.show = show;
function hide() {
    $("#liveBurst").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#liveBurst").addClass("hidden");
    });
    $("#miniTimerAndLiveWpm .burst").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#miniTimerAndLiveWpm .burst").addClass("hidden");
    });
}
exports.hide = hide;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "showLiveBurst")
        eventValue ? show() : hide();
});


/***/ }),

/***/ "./src/scripts/test/live-wpm.ts":
/*!**************************************!*\
  !*** ./src/scripts/test/live-wpm.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = exports.update = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const liveWpmElement = document.querySelector("#liveWpm");
const miniLiveWpmElement = document.querySelector("#miniTimerAndLiveWpm .wpm");
function update(wpm, raw) {
    // if (!TestActive.get() || !Config.showLiveWpm) {
    //   hideLiveWpm();
    // } else {
    //   showLiveWpm();
    // }
    let number = wpm;
    if (config_1.default.blindMode) {
        number = raw;
    }
    if (config_1.default.alwaysShowCPM) {
        number = Math.round(number * 5);
    }
    miniLiveWpmElement.innerHTML = number.toString();
    liveWpmElement.innerHTML = number.toString();
}
exports.update = update;
function show() {
    if (!config_1.default.showLiveWpm)
        return;
    if (!TestActive.get())
        return;
    if (config_1.default.timerStyle === "mini") {
        // $("#miniTimerAndLiveWpm .wpm").css("opacity", Config.timerOpacity);
        if (!$("#miniTimerAndLiveWpm .wpm").hasClass("hidden"))
            return;
        $("#miniTimerAndLiveWpm .wpm")
            .removeClass("hidden")
            .css("opacity", 0)
            .animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
    else {
        // $("#liveWpm").css("opacity", Config.timerOpacity);
        if (!$("#liveWpm").hasClass("hidden"))
            return;
        $("#liveWpm").removeClass("hidden").css("opacity", 0).animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
}
exports.show = show;
function hide() {
    $("#liveWpm").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#liveWpm").addClass("hidden");
    });
    $("#miniTimerAndLiveWpm .wpm").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#miniTimerAndLiveWpm .wpm").addClass("hidden");
    });
}
exports.hide = hide;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "showLiveWpm")
        eventValue ? show() : hide();
});


/***/ }),

/***/ "./src/scripts/test/manual-restart-tracker.ts":
/*!****************************************************!*\
  !*** ./src/scripts/test/manual-restart-tracker.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.get = exports.reset = exports.set = void 0;
let state = false;
function set() {
    state = true;
}
exports.set = set;
function reset() {
    state = false;
}
exports.reset = reset;
function get() {
    return state;
}
exports.get = get;


/***/ }),

/***/ "./src/scripts/test/monkey.ts":
/*!************************************!*\
  !*** ./src/scripts/test/monkey.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = exports.stop = exports.type = exports.updateFastOpacity = void 0;
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "monkey" && TestActive.get()) {
        if (config_1.default.monkey) {
            $("#monkey").removeClass("hidden");
        }
        else {
            $("#monkey").addClass("hidden");
        }
    }
});
let left = false;
let right = false;
// 0 hand up
// 1 hand down
// 00 both hands up
// 01 right hand down
// 10 left hand down
// 11 both hands down
const elements = {
    "00": document.querySelector("#monkey .up"),
    "01": document.querySelector("#monkey .right"),
    "10": document.querySelector("#monkey .left"),
    "11": document.querySelector("#monkey .both"),
};
const elementsFast = {
    "00": document.querySelector("#monkey .fast .up"),
    "01": document.querySelector("#monkey .fast .right"),
    "10": document.querySelector("#monkey .fast .left"),
    "11": document.querySelector("#monkey .fast .both"),
};
let last = "right";
function toBit(b) {
    return b ? "1" : "0";
}
function update() {
    var _a, _b, _c;
    if (!config_1.default.monkey)
        return;
    if (!((_a = document.querySelector("#monkey")) === null || _a === void 0 ? void 0 : _a.classList.contains("hidden"))) {
        Object.keys(elements).forEach((key) => {
            var _a;
            (_a = elements[key]) === null || _a === void 0 ? void 0 : _a.classList.add("hidden");
        });
        Object.keys(elementsFast).forEach((key) => {
            var _a;
            (_a = elementsFast[key]) === null || _a === void 0 ? void 0 : _a.classList.add("hidden");
        });
        const id = `${toBit(left)}${toBit(right)}`;
        (_b = elements[id]) === null || _b === void 0 ? void 0 : _b.classList.remove("hidden");
        (_c = elementsFast[id]) === null || _c === void 0 ? void 0 : _c.classList.remove("hidden");
    }
}
function updateFastOpacity(num) {
    if (!config_1.default.monkey)
        return;
    const opacity = (0, misc_1.mapRange)(num, 130, 180, 0, 1);
    $("#monkey .fast").animate({ opacity: opacity }, 1000);
    let animDuration = (0, misc_1.mapRange)(num, 130, 180, 0.25, 0.01);
    if (animDuration == 0.25)
        animDuration = 0;
    $("#monkey").css({ animationDuration: animDuration + "s" });
}
exports.updateFastOpacity = updateFastOpacity;
function type() {
    if (!config_1.default.monkey)
        return;
    if (!left && last == "right") {
        left = true;
        last = "left";
    }
    else if (!right) {
        right = true;
        last = "right";
    }
    update();
}
exports.type = type;
function stop() {
    if (!config_1.default.monkey)
        return;
    if (left) {
        left = false;
    }
    else if (right) {
        right = false;
    }
    update();
}
exports.stop = stop;
function show() {
    if (!config_1.default.monkey)
        return;
    $("#monkey")
        .css("opacity", 0)
        .removeClass("hidden")
        .animate({ opacity: 1 }, 125);
}
exports.show = show;
function hide() {
    $("#monkey")
        .css("opacity", 1)
        .animate({ opacity: 1 }, 125, () => {
        $("#monkey").addClass("hidden");
    });
}
exports.hide = hide;


/***/ }),

/***/ "./src/scripts/test/out-of-focus.ts":
/*!******************************************!*\
  !*** ./src/scripts/test/out-of-focus.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.hide = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const outOfFocusTimeouts = [];
function hide() {
    $("#words").css("transition", "none").removeClass("blurred");
    $(".outOfFocusWarning").addClass("hidden");
    Misc.clearTimeouts(outOfFocusTimeouts);
}
exports.hide = hide;
function show() {
    outOfFocusTimeouts.push(setTimeout(() => {
        $("#words").css("transition", "0.25s").addClass("blurred");
        $(".outOfFocusWarning").removeClass("hidden");
    }, 1000));
}
exports.show = show;


/***/ }),

/***/ "./src/scripts/test/pace-caret.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/pace-caret.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.start = exports.handleSpace = exports.reset = exports.update = exports.init = exports.settings = void 0;
const TestStats = __importStar(__webpack_require__(/*! ./test-stats */ "./src/scripts/test/test-stats.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const TestUI = __importStar(__webpack_require__(/*! ./test-ui */ "./src/scripts/test/test-ui.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const TestState = __importStar(__webpack_require__(/*! ./test-state */ "./src/scripts/test/test-state.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
exports.settings = null;
function resetCaretPosition() {
    var _a;
    if (config_1.default.paceCaret === "off" && !TestState.isPaceRepeat)
        return;
    if (!$("#paceCaret").hasClass("hidden")) {
        $("#paceCaret").addClass("hidden");
    }
    if (config_1.default.mode === "zen")
        return;
    const caret = $("#paceCaret");
    const firstLetter = ((_a = document === null || document === void 0 ? void 0 : document.querySelector("#words .word")) === null || _a === void 0 ? void 0 : _a.querySelector("letter"));
    const firstLetterHeight = $(firstLetter).height();
    if (firstLetter === undefined || firstLetterHeight === undefined)
        return;
    caret.stop(true, true).animate({
        top: firstLetter.offsetTop - firstLetterHeight / 4,
        left: firstLetter.offsetLeft,
    }, 0, "linear");
}
function init() {
    return __awaiter(this, void 0, void 0, function* () {
        $("#paceCaret").addClass("hidden");
        const mode2 = Misc.getMode2(config_1.default, TestWords.randomQuote);
        let wpm;
        if (config_1.default.paceCaret === "pb") {
            wpm = yield DB.getLocalPB(config_1.default.mode, mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode, config_1.default.funbox);
        }
        else if (config_1.default.paceCaret === "average") {
            [wpm] = yield DB.getUserAverage10(config_1.default.mode, mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode);
            wpm = Math.round(wpm);
        }
        else if (config_1.default.paceCaret === "custom") {
            wpm = config_1.default.paceCaretCustomSpeed;
        }
        else if (TestState.isPaceRepeat == true) {
            wpm = TestStats.lastTestWpm;
        }
        if (wpm === undefined || wpm < 1 || Number.isNaN(wpm)) {
            exports.settings = null;
            return;
        }
        const characters = wpm * 5;
        const cps = characters / 60; //characters per step
        const spc = 60 / characters; //seconds per character
        exports.settings = {
            wpm: wpm,
            cps: cps,
            spc: spc,
            correction: 0,
            currentWordIndex: 0,
            currentLetterIndex: -1,
            wordsStatus: {},
            timeout: null,
        };
        resetCaretPosition();
    });
}
exports.init = init;
function update(expectedStepEnd) {
    if (exports.settings === null || !TestActive.get() || TestUI.resultVisible) {
        return;
    }
    // if ($("#paceCaret").hasClass("hidden")) {
    //   $("#paceCaret").removeClass("hidden");
    // }
    try {
        exports.settings.currentLetterIndex++;
        if (exports.settings.currentLetterIndex >=
            TestWords.words.get(exports.settings.currentWordIndex).length) {
            //go to the next word
            exports.settings.currentLetterIndex = -1;
            exports.settings.currentWordIndex++;
        }
        if (!config_1.default.blindMode) {
            if (exports.settings.correction < 0) {
                while (exports.settings.correction < 0) {
                    exports.settings.currentLetterIndex--;
                    if (exports.settings.currentLetterIndex <= -2) {
                        //go to the previous word
                        exports.settings.currentLetterIndex =
                            TestWords.words.get(exports.settings.currentWordIndex - 1).length - 1;
                        exports.settings.currentWordIndex--;
                    }
                    exports.settings.correction++;
                }
            }
            else if (exports.settings.correction > 0) {
                while (exports.settings.correction > 0) {
                    exports.settings.currentLetterIndex++;
                    if (exports.settings.currentLetterIndex >=
                        TestWords.words.get(exports.settings.currentWordIndex).length) {
                        //go to the next word
                        exports.settings.currentLetterIndex = -1;
                        exports.settings.currentWordIndex++;
                    }
                    exports.settings.correction--;
                }
            }
        }
    }
    catch (e) {
        //out of words
        exports.settings = null;
        $("#paceCaret").addClass("hidden");
        return;
    }
    try {
        const caret = $("#paceCaret");
        let currentLetter;
        let newTop;
        let newLeft;
        try {
            const newIndex = exports.settings.currentWordIndex -
                (TestWords.words.currentIndex - TestUI.currentWordElementIndex);
            const word = document.querySelectorAll("#words .word")[newIndex];
            if (exports.settings.currentLetterIndex === -1) {
                currentLetter = word.querySelectorAll("letter")[0];
            }
            else {
                currentLetter = (word.querySelectorAll("letter")[exports.settings.currentLetterIndex]);
            }
            const currentLetterHeight = $(currentLetter).height(), currentLetterWidth = $(currentLetter).width(), caretWidth = caret.width();
            if (currentLetterHeight === undefined ||
                currentLetterWidth === undefined ||
                caretWidth === undefined) {
                throw ``;
            }
            newTop = currentLetter.offsetTop - currentLetterHeight / 5;
            newLeft;
            if (exports.settings.currentLetterIndex === -1) {
                newLeft = currentLetter.offsetLeft;
            }
            else {
                newLeft =
                    currentLetter.offsetLeft + currentLetterWidth - caretWidth / 2;
            }
            caret.removeClass("hidden");
        }
        catch (e) {
            caret.addClass("hidden");
        }
        const duration = expectedStepEnd - performance.now();
        if (newTop !== undefined) {
            let smoothlinescroll = $("#words .smoothScroller").height();
            if (smoothlinescroll === undefined)
                smoothlinescroll = 0;
            $("#paceCaret").css({
                top: newTop - smoothlinescroll,
            });
            if (config_1.default.smoothCaret) {
                caret.stop(true, true).animate({
                    left: newLeft,
                }, SlowTimer.get() ? 0 : duration, "linear");
            }
            else {
                caret.stop(true, true).animate({
                    left: newLeft,
                }, 0, "linear");
            }
        }
        exports.settings.timeout = setTimeout(() => {
            var _a;
            try {
                update(expectedStepEnd + ((_a = exports.settings === null || exports.settings === void 0 ? void 0 : exports.settings.spc) !== null && _a !== void 0 ? _a : 0) * 1000);
            }
            catch (e) {
                exports.settings = null;
            }
        }, duration);
    }
    catch (e) {
        console.error(e);
        $("#paceCaret").addClass("hidden");
    }
}
exports.update = update;
function reset() {
    if (exports.settings !== null && exports.settings.timeout !== null) {
        clearTimeout(exports.settings.timeout);
    }
    exports.settings = null;
}
exports.reset = reset;
function handleSpace(correct, currentWord) {
    if (correct) {
        if (exports.settings !== null &&
            exports.settings.wordsStatus[TestWords.words.currentIndex] === true &&
            !config_1.default.blindMode) {
            exports.settings.wordsStatus[TestWords.words.currentIndex] = undefined;
            exports.settings.correction -= currentWord.length + 1;
        }
    }
    else {
        if (exports.settings !== null &&
            exports.settings.wordsStatus[TestWords.words.currentIndex] === undefined &&
            !config_1.default.blindMode) {
            exports.settings.wordsStatus[TestWords.words.currentIndex] = true;
            exports.settings.correction += currentWord.length + 1;
        }
    }
}
exports.handleSpace = handleSpace;
function start() {
    var _a;
    update(performance.now() + ((_a = exports.settings === null || exports.settings === void 0 ? void 0 : exports.settings.spc) !== null && _a !== void 0 ? _a : 0) * 1000);
}
exports.start = start;
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "paceCaret")
        init();
});


/***/ }),

/***/ "./src/scripts/test/pb-crown.ts":
/*!**************************************!*\
  !*** ./src/scripts/test/pb-crown.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.hide = void 0;
function hide() {
    $("#result .stats .wpm .crown").css("opacity", 0).addClass("hidden");
}
exports.hide = hide;
function show() {
    $("#result .stats .wpm .crown")
        .removeClass("hidden")
        .css("opacity", "0")
        .animate({
        opacity: 1,
    }, 250, "easeOutCubic");
}
exports.show = show;


/***/ }),

/***/ "./src/scripts/test/poetry.ts":
/*!************************************!*\
  !*** ./src/scripts/test/poetry.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getPoem = exports.Poem = void 0;
const axios_1 = __importDefault(__webpack_require__(/*! axios */ "./node_modules/axios/index.js"));
const bannedChars = ["", "_", " "];
const maxWords = 100;
const apiURL = "https://poetrydb.org/random";
class Poem {
    constructor(title, author, words) {
        this.title = title;
        this.author = author;
        this.words = words;
        this.cleanUpText();
    }
    cleanUpText() {
        let count = 0;
        const scrubbedWords = [];
        for (let i = 0; i < this.words.length; i++) {
            let scrubbed = "";
            for (let j = 0; j < this.words[i].length; j++) {
                if (!bannedChars.includes(this.words[i][j])) {
                    scrubbed += this.words[i][j];
                }
            }
            if (scrubbed == "")
                continue;
            scrubbedWords.push(scrubbed);
            count++;
            if (count == maxWords)
                break;
        }
        this.words = scrubbedWords;
    }
}
exports.Poem = Poem;
function getPoem() {
    return __awaiter(this, void 0, void 0, function* () {
        console.log("Getting poem");
        const response = yield axios_1.default.get(apiURL);
        try {
            const poemObj = response.data[0];
            const words = [];
            poemObj.lines.forEach((line) => {
                line.split(/ +/).forEach((word) => {
                    words.push(word);
                });
            });
            return new Poem(poemObj.title, poemObj.author, words);
        }
        catch (e) {
            console.log(e);
        }
        return;
    });
}
exports.getPoem = getPoem;


/***/ }),

/***/ "./src/scripts/test/practise-words.ts":
/*!********************************************!*\
  !*** ./src/scripts/test/practise-words.ts ***!
  \********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hidePopup = exports.showPopup = exports.resetBefore = exports.init = exports.before = void 0;
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const CustomText = __importStar(__webpack_require__(/*! ./custom-text */ "./src/scripts/test/custom-text.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
exports.before = {
    mode: null,
    punctuation: null,
    numbers: null,
};
function init(missed, slow) {
    if (config_1.default.mode === "zen")
        return;
    let limit;
    if ((missed && !slow) || (!missed && slow)) {
        limit = 20;
    }
    else if (missed && slow) {
        limit = 10;
    }
    else {
        limit = 10;
    }
    let sortableMissedWords = [];
    if (missed) {
        Object.keys(TestInput.missedWords).forEach((missedWord) => {
            sortableMissedWords.push([missedWord, TestInput.missedWords[missedWord]]);
        });
        sortableMissedWords.sort((a, b) => {
            return b[1] - a[1];
        });
        sortableMissedWords = sortableMissedWords.slice(0, limit);
    }
    if (missed && !slow && sortableMissedWords.length == 0) {
        Notifications.add("You haven't missed any words", 0);
        return;
    }
    let sortableSlowWords = [];
    if (slow) {
        sortableSlowWords = TestWords.words.get().map((e, i) => [
            e,
            TestInput.burstHistory[i],
        ]);
        sortableSlowWords.sort((a, b) => {
            return a[1] - b[1];
        });
        sortableSlowWords = sortableSlowWords.slice(0, Math.min(limit, Math.round(TestWords.words.length * 0.2)));
    }
    // console.log(sortableMissedWords);
    // console.log(sortableSlowWords);
    if (sortableMissedWords.length == 0 && sortableSlowWords.length == 0) {
        Notifications.add("Could not start a new custom test", 0);
        return;
    }
    const newCustomText = [];
    sortableMissedWords.forEach((missed) => {
        for (let i = 0; i < missed[1]; i++) {
            newCustomText.push(missed[0]);
        }
    });
    sortableSlowWords.forEach((slow, index) => {
        for (let i = 0; i < sortableSlowWords.length - index; i++) {
            newCustomText.push(slow[0]);
        }
    });
    // console.log(newCustomText);
    const mode = exports.before.mode === null ? config_1.default.mode : exports.before.mode;
    const punctuation = exports.before.punctuation === null ? config_1.default.punctuation : exports.before.punctuation;
    const numbers = exports.before.numbers === null ? config_1.default.numbers : exports.before.numbers;
    UpdateConfig.setMode("custom");
    CustomText.setText(newCustomText);
    CustomText.setIsWordRandom(true);
    CustomText.setWord((sortableSlowWords.length + sortableMissedWords.length) * 5);
    CustomText.setTime(-1);
    exports.before.mode = mode;
    exports.before.punctuation = punctuation;
    exports.before.numbers = numbers;
}
exports.init = init;
function resetBefore() {
    exports.before.mode = null;
    exports.before.punctuation = null;
    exports.before.numbers = null;
}
exports.resetBefore = resetBefore;
function showPopup(focus = false) {
    if ($("#practiseWordsPopupWrapper").hasClass("hidden")) {
        if (config_1.default.mode === "zen") {
            Notifications.add("Practice words is unsupported in zen mode", 0);
            return;
        }
        $("#practiseWordsPopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            if (focus) {
                console.log("focusing");
                $("#practiseWordsPopup .missed").trigger("focus");
            }
        });
    }
}
exports.showPopup = showPopup;
function hidePopup() {
    if (!$("#practiseWordsPopupWrapper").hasClass("hidden")) {
        $("#practiseWordsPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#practiseWordsPopupWrapper").addClass("hidden");
        });
    }
}
exports.hidePopup = hidePopup;
$("#practiseWordsPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "practiseWordsPopupWrapper") {
        hidePopup();
    }
});
$("#practiseWordsPopup .button").on("keypress", (e) => {
    if (e.key === "Enter") {
        $(e.currentTarget).click();
    }
});
$("#practiseWordsPopup .button.both").on("focusout", (e) => {
    e.preventDefault();
    $("#practiseWordsPopup .missed").trigger("focus");
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" &&
        !$("#practiseWordsPopupWrapper").hasClass("hidden")) {
        hidePopup();
        event.preventDefault();
    }
});
$(document).on("keypress", "#practiseWordsButton", (event) => {
    if (event.key === "Enter") {
        showPopup(true);
    }
});
$(document.body).on("click", "#practiseWordsButton", () => {
    showPopup();
});
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "mode")
        resetBefore();
});


/***/ }),

/***/ "./src/scripts/test/replay.ts":
/*!************************************!*\
  !*** ./src/scripts/test/replay.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getReplayExport = exports.replayGetWordsList = exports.addReplayEvent = exports.stopReplayRecording = exports.startReplayRecording = exports.pauseReplay = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Sound = __importStar(__webpack_require__(/*! ../controllers/sound-controller */ "./src/scripts/controllers/sound-controller.ts"));
let wordsList = [];
let replayData = [];
let replayStartTime = 0;
let replayRecording = true;
let wordPos = 0;
let curPos = 0;
let targetWordPos = 0;
let targetCurPos = 0;
let timeoutList = [];
let stopwatchList = [];
const toggleButton = (_a = document.getElementById("playpauseReplayButton")) === null || _a === void 0 ? void 0 : _a.children[0];
function replayGetWordsList(wordsListFromScript) {
    wordsList = wordsListFromScript;
}
exports.replayGetWordsList = replayGetWordsList;
function initializeReplayPrompt() {
    const replayWordsElement = document.getElementById("replayWords");
    if (replayWordsElement === null)
        return;
    replayWordsElement.innerHTML = "";
    let wordCount = 0;
    replayData.forEach((item) => {
        //trim wordsList for timed tests
        if (item.action === "backWord") {
            wordCount--;
        }
        else if (item.action === "submitCorrectWord" ||
            item.action === "submitErrorWord") {
            wordCount++;
        }
    });
    wordsList.forEach((item, i) => {
        if (i > wordCount)
            return;
        const x = document.createElement("div");
        x.className = "word";
        for (i = 0; i < item.length; i++) {
            const letter = document.createElement("letter");
            letter.innerHTML = item[i];
            x.appendChild(letter);
        }
        replayWordsElement.appendChild(x);
    });
}
function pauseReplay() {
    var _a;
    timeoutList.forEach((item) => {
        clearTimeout(item);
    });
    timeoutList = [];
    stopwatchList.forEach((item) => {
        clearTimeout(item);
    });
    stopwatchList = [];
    targetCurPos = curPos;
    targetWordPos = wordPos;
    if (toggleButton === undefined)
        return;
    toggleButton.className = "fas fa-play";
    (_a = toggleButton.parentNode) === null || _a === void 0 ? void 0 : _a.setAttribute("aria-label", "Resume replay");
}
exports.pauseReplay = pauseReplay;
function playSound(error = false) {
    if (error) {
        if (config_1.default.playSoundOnError) {
            Sound.playError();
        }
        else {
            Sound.playClick();
        }
    }
    else {
        Sound.playClick();
    }
}
function handleDisplayLogic(item, nosound = false) {
    var _a, _b, _c;
    let activeWord = (_a = document.getElementById("replayWords")) === null || _a === void 0 ? void 0 : _a.children[wordPos];
    if (activeWord === undefined)
        return;
    if (item.action === "correctLetter") {
        if (!nosound)
            playSound();
        activeWord.children[curPos].classList.add("correct");
        curPos++;
    }
    else if (item.action === "incorrectLetter") {
        if (!nosound)
            playSound(true);
        let myElement;
        if (curPos >= activeWord.children.length) {
            //if letter is an extra
            myElement = document.createElement("letter");
            myElement.classList.add("extra");
            myElement.innerHTML = (_c = (_b = item.value) === null || _b === void 0 ? void 0 : _b.toString()) !== null && _c !== void 0 ? _c : "";
            activeWord.appendChild(myElement);
        }
        myElement = activeWord.children[curPos];
        myElement.classList.add("incorrect");
        curPos++;
    }
    else if (item.action === "setLetterIndex" &&
        typeof item.value === "number") {
        if (!nosound)
            playSound();
        curPos = item.value;
        // remove all letters from cursor to end of word
        for (const myElement of [...activeWord.children].slice(curPos)) {
            if (myElement.classList.contains("extra")) {
                myElement.remove();
            }
            else {
                myElement.className = "";
            }
        }
    }
    else if (item.action === "submitCorrectWord") {
        if (!nosound)
            playSound();
        wordPos++;
        curPos = 0;
    }
    else if (item.action === "submitErrorWord") {
        if (!nosound)
            playSound(true);
        activeWord.classList.add("error");
        wordPos++;
        curPos = 0;
    }
    else if (item.action === "backWord") {
        if (!nosound)
            playSound();
        wordPos--;
        const replayWords = document.getElementById("replayWords");
        if (replayWords !== null)
            activeWord = replayWords.children[wordPos];
        curPos = activeWord.children.length;
        while (activeWord.children[curPos - 1].className === "")
            curPos--;
        activeWord.classList.remove("error");
    }
}
function loadOldReplay() {
    let startingIndex = 0;
    curPos = 0;
    wordPos = 0;
    replayData.forEach((item, i) => {
        if (wordPos < targetWordPos ||
            (wordPos === targetWordPos && curPos < targetCurPos)) {
            //quickly display everything up to the target
            handleDisplayLogic(item, true);
            startingIndex = i + 1;
        }
    });
    const time = Math.floor(replayData[startingIndex].time / 1000);
    $("#replayStopwatch").text(time + "s");
    return startingIndex;
}
function toggleReplayDisplay() {
    var _a;
    if ($("#resultReplay").stop(true, true).hasClass("hidden")) {
        initializeReplayPrompt();
        loadOldReplay();
        //show
        if (!$("#watchReplayButton").hasClass("loaded")) {
            $("#words").html(`<div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>`);
            $("#resultReplay")
                .removeClass("hidden")
                .css("display", "none")
                .slideDown(250);
        }
        else {
            $("#resultReplay")
                .removeClass("hidden")
                .css("display", "none")
                .slideDown(250);
        }
    }
    else {
        //hide
        if (((_a = toggleButton === null || toggleButton === void 0 ? void 0 : toggleButton.parentNode) === null || _a === void 0 ? void 0 : _a.getAttribute("aria-label")) !=
            "Start replay") {
            pauseReplay();
        }
        $("#resultReplay").slideUp(250, () => {
            $("#resultReplay").addClass("hidden");
        });
    }
}
function startReplayRecording() {
    if (!$("#resultReplay").stop(true, true).hasClass("hidden")) {
        //hide replay display if user left it open
        toggleReplayDisplay();
    }
    $("#replayStopwatch").text(0 + "s");
    replayData = [];
    replayStartTime = performance.now();
    replayRecording = true;
    targetCurPos = 0;
    targetWordPos = 0;
}
exports.startReplayRecording = startReplayRecording;
function stopReplayRecording() {
    replayRecording = false;
}
exports.stopReplayRecording = stopReplayRecording;
function addReplayEvent(action, value) {
    if (!replayRecording) {
        return;
    }
    const timeDelta = performance.now() - replayStartTime;
    replayData.push({ action: action, value: value, time: timeDelta });
}
exports.addReplayEvent = addReplayEvent;
function playReplay() {
    var _a;
    curPos = 0;
    wordPos = 0;
    if (toggleButton === undefined)
        return;
    toggleButton.className = "fas fa-pause";
    (_a = toggleButton.parentNode) === null || _a === void 0 ? void 0 : _a.setAttribute("aria-label", "Pause replay");
    initializeReplayPrompt();
    const startingIndex = loadOldReplay();
    const lastTime = replayData[startingIndex].time;
    let swTime = Math.round(lastTime / 1000); //starting time
    const swEndTime = Math.round(replayData[replayData.length - 1].time / 1000);
    while (swTime <= swEndTime) {
        const time = swTime;
        stopwatchList.push(setTimeout(() => {
            $("#replayStopwatch").text(time + "s");
        }, time * 1000 - lastTime));
        swTime++;
    }
    replayData.forEach((item, i) => {
        if (i < startingIndex)
            return;
        timeoutList.push(setTimeout(() => {
            handleDisplayLogic(item);
        }, item.time - lastTime));
    });
    timeoutList.push(setTimeout(() => {
        //after the replay has finished, this will run
        targetCurPos = 0;
        targetWordPos = 0;
        toggleButton.className = "fas fa-play";
        toggleButton.parentNode.setAttribute("aria-label", "Start replay");
    }, replayData[replayData.length - 1].time - lastTime));
}
function getReplayExport() {
    return JSON.stringify({
        replayData: replayData,
        wordsList: wordsList,
    });
}
exports.getReplayExport = getReplayExport;
$(".pageTest #playpauseReplayButton").on("click", () => {
    if ((toggleButton === null || toggleButton === void 0 ? void 0 : toggleButton.className) === "fas fa-play") {
        playReplay();
    }
    else if ((toggleButton === null || toggleButton === void 0 ? void 0 : toggleButton.className) === "fas fa-pause") {
        pauseReplay();
    }
});
$("#replayWords").on("click", "letter", (event) => {
    var _a;
    //allows user to click on the place they want to start their replay at
    pauseReplay();
    const replayWords = document.querySelector("#replayWords");
    const words = [...((_a = replayWords === null || replayWords === void 0 ? void 0 : replayWords.children) !== null && _a !== void 0 ? _a : [])];
    targetWordPos = words.indexOf(event.target.parentNode);
    const letters = [...words[targetWordPos].children];
    targetCurPos = letters.indexOf(event.target);
    initializeReplayPrompt();
    loadOldReplay();
});
$(document).on("keypress", "#watchReplayButton", (event) => {
    if (event.key === "Enter") {
        toggleReplayDisplay();
    }
});
$(document.body).on("click", "#watchReplayButton", () => {
    toggleReplayDisplay();
});


/***/ }),

/***/ "./src/scripts/test/result.ts":
/*!************************************!*\
  !*** ./src/scripts/test/result.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = exports.updateRateQuote = exports.updateCrown = exports.hideCrown = exports.showCrown = exports.updateTodayTracker = exports.updateGraphPBLine = exports.toggleUnsmoothedRaw = void 0;
const TestUI = __importStar(__webpack_require__(/*! ./test-ui */ "./src/scripts/test/test-ui.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const TestStats = __importStar(__webpack_require__(/*! ./test-stats */ "./src/scripts/test/test-stats.ts"));
const Keymap = __importStar(__webpack_require__(/*! ../elements/keymap */ "./src/scripts/elements/keymap.ts"));
const ChartController = __importStar(__webpack_require__(/*! ../controllers/chart-controller */ "./src/scripts/controllers/chart-controller.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const TodayTracker = __importStar(__webpack_require__(/*! ./today-tracker */ "./src/scripts/test/today-tracker.ts"));
const PbCrown = __importStar(__webpack_require__(/*! ./pb-crown */ "./src/scripts/test/pb-crown.ts"));
const QuoteRatePopup = __importStar(__webpack_require__(/*! ../popups/quote-rate-popup */ "./src/scripts/popups/quote-rate-popup.ts"));
const GlarsesMode = __importStar(__webpack_require__(/*! ../states/glarses-mode */ "./src/scripts/states/glarses-mode.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const ResultsShownEvent = __importStar(__webpack_require__(/*! ../observables/results-shown-event */ "./src/scripts/observables/results-shown-event.ts"));
const chart_js_1 = __webpack_require__(/*! chart.js */ "./node_modules/chart.js/dist/chart.esm.js");
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
let result;
let maxChartVal;
let useUnsmoothedRaw = false;
function toggleUnsmoothedRaw() {
    useUnsmoothedRaw = !useUnsmoothedRaw;
    Notifications.add(useUnsmoothedRaw ? "on" : "off", 1);
}
exports.toggleUnsmoothedRaw = toggleUnsmoothedRaw;
let resultAnnotation = [];
let resultScaleOptions = ChartController.result.options.scales;
function updateGraph() {
    var _a, _b;
    return __awaiter(this, void 0, void 0, function* () {
        const labels = [];
        for (let i = 1; i <= TestInput.wpmHistory.length; i++) {
            if (TestStats.lastSecondNotRound && i === TestInput.wpmHistory.length) {
                labels.push(Misc.roundTo2(result.testDuration).toString());
            }
            else {
                labels.push(i.toString());
            }
        }
        ChartController.result.data.labels = labels;
        resultScaleOptions["wpm"].title.text = config_1.default.alwaysShowCPM
            ? "Character per Minute"
            : "Words per Minute";
        const chartData1 = config_1.default.alwaysShowCPM
            ? TestInput.wpmHistory.map((a) => a * 5)
            : TestInput.wpmHistory;
        let chartData2;
        if (result.chartData === "toolong")
            return;
        if (useUnsmoothedRaw) {
            chartData2 =
                (_b = (config_1.default.alwaysShowCPM
                    ? (_a = result.chartData.unsmoothedRaw) === null || _a === void 0 ? void 0 : _a.map((a) => a * 5)
                    : result.chartData.unsmoothedRaw)) !== null && _b !== void 0 ? _b : [];
        }
        else {
            chartData2 = config_1.default.alwaysShowCPM
                ? result.chartData.raw.map((a) => a * 5)
                : result.chartData.raw;
        }
        ChartController.result.data.datasets[0].data = chartData1;
        ChartController.result.data.datasets[1].data = chartData2;
        ChartController.result.data.datasets[0].label = config_1.default.alwaysShowCPM
            ? "cpm"
            : "wpm";
        maxChartVal = Math.max(...[Math.max(...chartData2), Math.max(...chartData1)]);
        if (!config_1.default.startGraphsAtZero) {
            const minChartVal = Math.min(...[Math.min(...chartData2), Math.min(...chartData1)]);
            resultScaleOptions["wpm"].min = minChartVal;
            resultScaleOptions["raw"].min = minChartVal;
        }
        else {
            resultScaleOptions["wpm"].min = 0;
            resultScaleOptions["raw"].min = 0;
        }
        ChartController.result.data.datasets[2].data = result.chartData.err;
        const fc = yield ThemeColors.get("sub");
        if (config_1.default.funbox !== "none") {
            let content = config_1.default.funbox;
            if (config_1.default.funbox === "layoutfluid") {
                content += " " + config_1.default.customLayoutfluid.replace(/#/g, " ");
            }
            resultAnnotation.push({
                display: true,
                id: "funbox-label",
                type: "line",
                scaleID: "wpm",
                value: resultScaleOptions["wpm"].min,
                borderColor: "transparent",
                borderWidth: 1,
                borderDash: [2, 2],
                label: {
                    backgroundColor: "transparent",
                    font: {
                        family: config_1.default.fontFamily.replace(/_/g, " "),
                        size: 11,
                        style: "normal",
                        weight: chart_js_1.Chart.defaults.font.weight,
                        lineHeight: chart_js_1.Chart.defaults.font.lineHeight,
                    },
                    color: fc,
                    padding: 3,
                    borderRadius: 3,
                    position: "start",
                    enabled: true,
                    content: `${content}`,
                },
            });
        }
        resultScaleOptions["wpm"].max = maxChartVal;
        resultScaleOptions["raw"].max = maxChartVal;
        resultScaleOptions["error"].max = Math.max(...result.chartData.err) + 1;
    });
}
function updateGraphPBLine() {
    var _a, _b, _c;
    return __awaiter(this, void 0, void 0, function* () {
        const themecolors = yield ThemeColors.getAll();
        const lpb = yield DB.getLocalPB(result.mode, result.mode2, (_a = result.punctuation) !== null && _a !== void 0 ? _a : false, result.language, result.difficulty, (_b = result.lazyMode) !== null && _b !== void 0 ? _b : false, (_c = result.funbox) !== null && _c !== void 0 ? _c : "none");
        if (lpb == 0)
            return;
        const chartlpb = Misc.roundTo2(config_1.default.alwaysShowCPM ? lpb * 5 : lpb).toFixed(2);
        resultAnnotation.push({
            display: true,
            type: "line",
            id: "lpb",
            scaleID: "wpm",
            value: chartlpb,
            borderColor: themecolors["sub"],
            borderWidth: 1,
            borderDash: [2, 2],
            label: {
                backgroundColor: themecolors["sub"],
                font: {
                    family: config_1.default.fontFamily.replace(/_/g, " "),
                    size: 11,
                    style: "normal",
                    weight: chart_js_1.Chart.defaults.font.weight,
                    lineHeight: chart_js_1.Chart.defaults.font.lineHeight,
                },
                color: themecolors["bg"],
                padding: 3,
                borderRadius: 3,
                position: "center",
                enabled: true,
                content: `PB: ${chartlpb}`,
            },
        });
        if (maxChartVal >= parseFloat(chartlpb) - 20 &&
            maxChartVal <= parseFloat(chartlpb) + 20) {
            maxChartVal = parseFloat(chartlpb) + 15;
        }
        resultScaleOptions["wpm"].max = Math.round(maxChartVal + 5);
        resultScaleOptions["raw"].max = Math.round(maxChartVal + 5);
    });
}
exports.updateGraphPBLine = updateGraphPBLine;
function updateWpmAndAcc() {
    let inf = false;
    if (result.wpm >= 1000) {
        inf = true;
    }
    if (config_1.default.alwaysShowDecimalPlaces) {
        if (config_1.default.alwaysShowCPM == false) {
            $("#result .stats .wpm .top .text").text("wpm");
            if (inf) {
                $("#result .stats .wpm .bottom").text("Infinite");
            }
            else {
                $("#result .stats .wpm .bottom").text(Misc.roundTo2(result.wpm).toFixed(2));
            }
            $("#result .stats .raw .bottom").text(Misc.roundTo2(result.rawWpm).toFixed(2));
            $("#result .stats .wpm .bottom").attr("aria-label", Misc.roundTo2(result.wpm * 5).toFixed(2) + " cpm");
        }
        else {
            $("#result .stats .wpm .top .text").text("cpm");
            if (inf) {
                $("#result .stats .wpm .bottom").text("Infinite");
            }
            else {
                $("#result .stats .wpm .bottom").text(Misc.roundTo2(result.wpm * 5).toFixed(2));
            }
            $("#result .stats .raw .bottom").text(Misc.roundTo2(result.rawWpm * 5).toFixed(2));
            $("#result .stats .wpm .bottom").attr("aria-label", Misc.roundTo2(result.wpm).toFixed(2) + " wpm");
        }
        $("#result .stats .acc .bottom").text(result.acc == 100 ? "100%" : Misc.roundTo2(result.acc).toFixed(2) + "%");
        let time = Misc.roundTo2(result.testDuration).toFixed(2) + "s";
        if (result.testDuration > 61) {
            time = Misc.secondsToString(Misc.roundTo2(result.testDuration));
        }
        $("#result .stats .time .bottom .text").text(time);
        $("#result .stats .raw .bottom").removeAttr("aria-label");
        $("#result .stats .acc .bottom").removeAttr("aria-label");
    }
    else {
        //not showing decimal places
        if (config_1.default.alwaysShowCPM == false) {
            $("#result .stats .wpm .top .text").text("wpm");
            $("#result .stats .wpm .bottom").attr("aria-label", result.wpm + ` (${Misc.roundTo2(result.wpm * 5)} cpm)`);
            if (inf) {
                $("#result .stats .wpm .bottom").text("Infinite");
            }
            else {
                $("#result .stats .wpm .bottom").text(Math.round(result.wpm));
            }
            $("#result .stats .raw .bottom").text(Math.round(result.rawWpm));
            $("#result .stats .raw .bottom").attr("aria-label", result.rawWpm);
        }
        else {
            $("#result .stats .wpm .top .text").text("cpm");
            $("#result .stats .wpm .bottom").attr("aria-label", Misc.roundTo2(result.wpm * 5) + ` (${Misc.roundTo2(result.wpm)} wpm)`);
            if (inf) {
                $("#result .stats .wpm .bottom").text("Infinite");
            }
            else {
                $("#result .stats .wpm .bottom").text(Math.round(result.wpm * 5));
            }
            $("#result .stats .raw .bottom").text(Math.round(result.rawWpm * 5));
            $("#result .stats .raw .bottom").attr("aria-label", result.rawWpm * 5);
        }
        $("#result .stats .acc .bottom").text(Math.floor(result.acc) + "%");
        $("#result .stats .acc .bottom").attr("aria-label", result.acc + "%");
    }
}
function updateConsistency() {
    if (config_1.default.alwaysShowDecimalPlaces) {
        $("#result .stats .consistency .bottom").text(Misc.roundTo2(result.consistency).toFixed(2) + "%");
        $("#result .stats .consistency .bottom").attr("aria-label", `${result.keyConsistency.toFixed(2)}% key`);
    }
    else {
        $("#result .stats .consistency .bottom").text(Math.round(result.consistency) + "%");
        $("#result .stats .consistency .bottom").attr("aria-label", `${result.consistency}% (${result.keyConsistency}% key)`);
    }
}
function updateTime() {
    const afkSecondsPercent = Misc.roundTo2((result.afkDuration / result.testDuration) * 100);
    $("#result .stats .time .bottom .afk").text("");
    if (afkSecondsPercent > 0) {
        $("#result .stats .time .bottom .afk").text(afkSecondsPercent + "% afk");
    }
    $("#result .stats .time .bottom").attr("aria-label", `${result.afkDuration}s afk ${afkSecondsPercent}%`);
    if (config_1.default.alwaysShowDecimalPlaces) {
        let time = Misc.roundTo2(result.testDuration).toFixed(2) + "s";
        if (result.testDuration > 61) {
            time = Misc.secondsToString(Misc.roundTo2(result.testDuration));
        }
        $("#result .stats .time .bottom .text").text(time);
    }
    else {
        let time = Math.round(result.testDuration) + "s";
        if (result.testDuration > 61) {
            time = Misc.secondsToString(Math.round(result.testDuration));
        }
        $("#result .stats .time .bottom .text").text(time);
        $("#result .stats .time .bottom").attr("aria-label", `${Misc.roundTo2(result.testDuration)}s (${result.afkDuration}s afk ${afkSecondsPercent}%)`);
    }
}
function updateTodayTracker() {
    $("#result .stats .time .bottom .timeToday").text(TodayTracker.getString());
}
exports.updateTodayTracker = updateTodayTracker;
function updateKey() {
    $("#result .stats .key .bottom").text(result.charStats[0] +
        "/" +
        result.charStats[1] +
        "/" +
        result.charStats[2] +
        "/" +
        result.charStats[3]);
}
function showCrown() {
    PbCrown.show();
}
exports.showCrown = showCrown;
function hideCrown() {
    PbCrown.hide();
    $("#result .stats .wpm .crown").attr("aria-label", "");
}
exports.hideCrown = hideCrown;
function updateCrown() {
    return __awaiter(this, void 0, void 0, function* () {
        let pbDiff = 0;
        const lpb = yield DB.getLocalPB(config_1.default.mode, result.mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode, config_1.default.funbox);
        pbDiff = Math.abs(result.wpm - lpb);
        $("#result .stats .wpm .crown").attr("aria-label", "+" + Misc.roundTo2(pbDiff));
    });
}
exports.updateCrown = updateCrown;
function updateTags(dontSave) {
    var _a;
    const activeTags = [];
    try {
        (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
            if (tag.active === true) {
                activeTags.push(tag);
            }
        });
    }
    catch (e) { }
    $("#result .stats .tags").addClass("hidden");
    if (activeTags.length == 0) {
        $("#result .stats .tags").addClass("hidden");
    }
    else {
        $("#result .stats .tags").removeClass("hidden");
    }
    $("#result .stats .tags .bottom").text("");
    let annotationSide = "start";
    let labelAdjust = 15;
    activeTags.forEach((tag) => __awaiter(this, void 0, void 0, function* () {
        const tpb = yield DB.getLocalTagPB(tag._id, config_1.default.mode, result.mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode);
        $("#result .stats .tags .bottom").append(`
      <div tagid="${tag._id}" aria-label="PB: ${tpb}" data-balloon-pos="up">${tag.name}<i class="fas fa-crown hidden"></i></div>
    `);
        if (config_1.default.mode != "quote" && !dontSave) {
            if (tpb < result.wpm) {
                //new pb for that tag
                DB.saveLocalTagPB(tag._id, config_1.default.mode, result.mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode, result.wpm, result.acc, result.rawWpm, result.consistency);
                $(`#result .stats .tags .bottom div[tagid="${tag._id}"] .fas`).removeClass("hidden");
                $(`#result .stats .tags .bottom div[tagid="${tag._id}"]`).attr("aria-label", "+" + Misc.roundTo2(result.wpm - tpb));
                // console.log("new pb for tag " + tag.name);
            }
            else {
                const themecolors = yield ThemeColors.getAll();
                resultAnnotation.push({
                    display: true,
                    type: "line",
                    id: "tpb",
                    scaleID: "wpm",
                    value: config_1.default.alwaysShowCPM ? tpb * 5 : tpb,
                    borderColor: themecolors["sub"],
                    borderWidth: 1,
                    borderDash: [2, 2],
                    label: {
                        backgroundColor: themecolors["sub"],
                        font: {
                            family: config_1.default.fontFamily.replace(/_/g, " "),
                            size: 11,
                            style: "normal",
                            weight: chart_js_1.Chart.defaults.font.weight,
                            lineHeight: chart_js_1.Chart.defaults.font.lineHeight,
                        },
                        color: themecolors["bg"],
                        padding: 3,
                        borderRadius: 3,
                        position: annotationSide,
                        xAdjust: labelAdjust,
                        enabled: true,
                        content: `${tag.name} PB: ${Misc.roundTo2(config_1.default.alwaysShowCPM ? tpb * 5 : tpb).toFixed(2)}`,
                    },
                });
                if (annotationSide === "start") {
                    annotationSide = "end";
                    labelAdjust = -15;
                }
                else {
                    annotationSide = "start";
                    labelAdjust = 15;
                }
            }
        }
    }));
}
function updateTestType(randomQuote) {
    let testType = "";
    testType += config_1.default.mode;
    if (config_1.default.mode === "time") {
        testType += " " + config_1.default.time;
    }
    else if (config_1.default.mode === "words") {
        testType += " " + config_1.default.words;
    }
    else if (config_1.default.mode === "quote") {
        if (randomQuote.group !== undefined) {
            testType += " " + ["short", "medium", "long", "thicc"][randomQuote.group];
        }
    }
    if (config_1.default.mode != "custom" &&
        config_1.default.funbox !== "gibberish" &&
        config_1.default.funbox !== "ascii" &&
        config_1.default.funbox !== "58008") {
        testType += "<br>" + result.language.replace(/_/g, " ");
    }
    if (config_1.default.punctuation) {
        testType += "<br>punctuation";
    }
    if (config_1.default.numbers) {
        testType += "<br>numbers";
    }
    if (config_1.default.blindMode) {
        testType += "<br>blind";
    }
    if (config_1.default.lazyMode) {
        testType += "<br>lazy";
    }
    if (config_1.default.funbox !== "none") {
        testType += "<br>" + config_1.default.funbox.replace(/_/g, " ");
    }
    if (config_1.default.difficulty == "expert") {
        testType += "<br>expert";
    }
    else if (config_1.default.difficulty == "master") {
        testType += "<br>master";
    }
    $("#result .stats .testType .bottom").html(testType);
}
function updateOther(difficultyFailed, failReason, afkDetected, isRepeated, tooShort) {
    let otherText = "";
    if (difficultyFailed) {
        otherText += `<br>failed (${failReason})`;
    }
    if (afkDetected) {
        otherText += "<br>afk detected";
    }
    if (TestStats.invalid) {
        otherText += "<br>invalid";
        let extra = "";
        if (result.wpm < 0 || result.wpm > 350) {
            extra += "wpm";
        }
        if (result.acc < 75 || result.acc > 100) {
            if (extra.length > 0) {
                extra += ", ";
            }
            extra += "accuracy";
        }
        if (extra.length > 0) {
            otherText += ` (${extra})`;
        }
    }
    if (isRepeated) {
        otherText += "<br>repeated";
    }
    if (result.bailedOut) {
        otherText += "<br>bailed out";
    }
    if (tooShort) {
        otherText += "<br>too short";
    }
    if (otherText == "") {
        $("#result .stats .info").addClass("hidden");
    }
    else {
        $("#result .stats .info").removeClass("hidden");
        otherText = otherText.substring(4);
        $("#result .stats .info .bottom").html(otherText);
    }
}
function updateRateQuote(randomQuote) {
    var _a, _b;
    if (config_1.default.mode === "quote") {
        const userqr = (_b = (_a = DB.getSnapshot().quoteRatings) === null || _a === void 0 ? void 0 : _a[randomQuote.language]) === null || _b === void 0 ? void 0 : _b[randomQuote.id];
        if (userqr) {
            $(".pageTest #result #rateQuoteButton .icon")
                .removeClass("far")
                .addClass("fas");
        }
        QuoteRatePopup.getQuoteStats(randomQuote).then((quoteStats) => {
            var _a, _b;
            $(".pageTest #result #rateQuoteButton .rating").text((_b = (_a = quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.average) === null || _a === void 0 ? void 0 : _a.toFixed(1)) !== null && _b !== void 0 ? _b : "");
            $(".pageTest #result #rateQuoteButton")
                .css({ opacity: 0 })
                .removeClass("hidden")
                .css({ opacity: 1 });
        });
    }
}
exports.updateRateQuote = updateRateQuote;
function updateQuoteSource(randomQuote) {
    if (config_1.default.mode === "quote") {
        $("#result .stats .source").removeClass("hidden");
        $("#result .stats .source .bottom").html(randomQuote.source);
    }
    else {
        $("#result .stats .source").addClass("hidden");
    }
}
function update(res, difficultyFailed, failReason, afkDetected, isRepeated, tooShort, randomQuote, dontSave) {
    return __awaiter(this, void 0, void 0, function* () {
        resultScaleOptions = ChartController.result.options.scales;
        resultAnnotation = [];
        result = res;
        $("#result #resultWordsHistory").addClass("hidden");
        $("#retrySavingResultButton").addClass("hidden");
        $(".pageTest #result #rateQuoteButton .icon")
            .removeClass("fas")
            .addClass("far");
        $(".pageTest #result #rateQuoteButton .rating").text("");
        $(".pageTest #result #rateQuoteButton").addClass("hidden");
        $("#testModesNotice").css("opacity", 0);
        $("#words").removeClass("blurred");
        $("#wordsInput").blur();
        $("#result .stats .time .bottom .afk").text("");
        if (firebase_1.Auth.currentUser != null) {
            $("#result .loginTip").addClass("hidden");
        }
        else {
            $("#result .loginTip").removeClass("hidden");
        }
        updateWpmAndAcc();
        updateConsistency();
        updateTime();
        updateKey();
        updateTestType(randomQuote);
        updateQuoteSource(randomQuote);
        yield updateGraph();
        yield updateGraphPBLine();
        updateTags(dontSave);
        updateOther(difficultyFailed, failReason, afkDetected, isRepeated, tooShort);
        ChartController.result.options
            .plugins.annotation.annotations =
            resultAnnotation;
        ChartController.result.updateColors();
        ChartController.result.resize();
        if ($("#result .stats .tags").hasClass("hidden") &&
            $("#result .stats .info").hasClass("hidden")) {
            $("#result .stats .infoAndTags").addClass("hidden");
        }
        else {
            $("#result .stats .infoAndTags").removeClass("hidden");
        }
        if (GlarsesMode.get()) {
            $("#middle #result .noStressMessage").remove();
            $("#middle #result").prepend(`

      <div class='noStressMessage' style="
        text-align: center;
        grid-column: 1/3;
        font-size: 2rem;
        padding-bottom: 2rem;
      ">
      <i class="fas fa-check"></i>
      </div>

    `);
            $("#middle #result .stats").addClass("hidden");
            $("#middle #result .chart").addClass("hidden");
            $("#middle #result #resultWordsHistory").addClass("hidden");
            $("#middle #result #resultReplay").addClass("hidden");
            $("#middle #result .loginTip").addClass("hidden");
            $("#middle #result #showWordHistoryButton").addClass("hidden");
            $("#middle #result #watchReplayButton").addClass("hidden");
            $("#middle #result #saveScreenshotButton").addClass("hidden");
            console.log(`Test Completed: ${result.wpm} wpm ${result.acc}% acc ${result.rawWpm} raw ${result.consistency}% consistency`);
        }
        else {
            $("#middle #result .stats").removeClass("hidden");
            $("#middle #result .chart").removeClass("hidden");
            // $("#middle #result #resultWordsHistory").removeClass("hidden");
            if (firebase_1.Auth.currentUser == null) {
                $("#middle #result .loginTip").removeClass("hidden");
            }
            $("#middle #result #showWordHistoryButton").removeClass("hidden");
            $("#middle #result #watchReplayButton").removeClass("hidden");
            $("#middle #result #saveScreenshotButton").removeClass("hidden");
        }
        if (window.scrollY > 0) {
            $([document.documentElement, document.body])
                .stop()
                .animate({ scrollTop: 0 }, 250);
        }
        Misc.swapElements($("#typingTest"), $("#result"), 250, () => {
            TestUI.setResultCalculating(false);
            $("#words").empty();
            ChartController.result.resize();
            if (config_1.default.alwaysShowWordsHistory && config_1.default.burstHeatmap) {
                TestUI.applyBurstHeatmap();
            }
            $("#result").trigger("focus");
            window.scrollTo({ top: 0 });
            $("#testModesNotice").addClass("hidden");
        }, () => {
            $("#resultExtraButtons").removeClass("hidden").css("opacity", 0).animate({
                opacity: 1,
            }, 125);
            if (config_1.default.alwaysShowWordsHistory && !GlarsesMode.get()) {
                TestUI.toggleResultWords();
            }
            Keymap.hide();
        });
        ResultsShownEvent.dispatch({
            res,
            difficultyFailed,
            failReason,
            afkDetected,
            isRepeated,
            tooShort,
            randomQuote,
            dontSave,
        });
    });
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/test/shift-tracker.ts":
/*!*******************************************!*\
  !*** ./src/scripts/test/shift-tracker.ts ***!
  \*******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.isUsingOppositeShift = exports.reset = exports.rightState = exports.leftState = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const caps_warning_1 = __webpack_require__(/*! ./caps-warning */ "./src/scripts/test/caps-warning.ts");
exports.leftState = false;
exports.rightState = false;
let caseState = false;
const keymapStrings = {
    left: null,
    right: null,
    keymap: null,
};
function dynamicKeymapLegendStyle(uppercase) {
    const keymapKeys = [
        ...document.getElementsByClassName("keymap-key"),
    ];
    const layoutKeys = keymapKeys.map((el) => el.dataset["key"]);
    const keys = keymapKeys.map((el) => el.childNodes[1]);
    if (caps_warning_1.capsState)
        uppercase = !uppercase;
    if (layoutKeys.filter((v) => v === undefined).length > 2)
        return;
    if ((uppercase && caseState) || (!uppercase && !caseState))
        return;
    caseState = uppercase;
    const index = caseState ? 1 : 0;
    for (let i = 0; i < layoutKeys.length; i++) {
        const layoutKey = layoutKeys[i], key = keys[i];
        if (key === undefined || layoutKey === undefined)
            continue;
        key.textContent = layoutKey[index];
    }
}
function buildKeymapStrings() {
    return __awaiter(this, void 0, void 0, function* () {
        if (keymapStrings.keymap === config_1.default.keymapLayout)
            return;
        const layout = yield Misc.getLayout(config_1.default.keymapLayout);
        if (layout === undefined)
            return;
        const layoutKeys = layout.keys;
        const layoutKeysEntries = Object.entries(layoutKeys);
        keymapStrings.keymap = config_1.default.keymapLayout;
        if (!layout) {
            keymapStrings.left = null;
            keymapStrings.right = null;
        }
        else {
            keymapStrings.left = layoutKeysEntries
                .map(([rowName, row]) => row
                // includes "6" and "y" (buttons on qwerty) into the left hand
                .slice(0, ["row1", "row2"].includes(rowName)
                ? rowName === "row1"
                    ? 7
                    : 6
                : 5)
                .map((key) => key.split("")))
                .flat(2);
            keymapStrings.right = layoutKeysEntries
                .map(([rowName, row]) => row
                // includes "b" (buttons on qwerty) into the right hand
                .slice(["row1", "row4"].includes(rowName)
                ? rowName === "row1"
                    ? 6
                    : 4
                : 5)
                .map((key) => key.split("")))
                .flat(2);
        }
    });
}
$(document).on("keydown", (e) => {
    if (e.code === "ShiftLeft") {
        exports.leftState = true;
        exports.rightState = false;
    }
    else if (e.code === "ShiftRight") {
        exports.leftState = false;
        exports.rightState = true;
    }
    if (config_1.default.keymapLegendStyle === "dynamic") {
        dynamicKeymapLegendStyle(exports.leftState || exports.rightState);
    }
});
$(document).keyup((e) => {
    if (e.code === "ShiftLeft" || e.code === "ShiftRight") {
        exports.leftState = false;
        exports.rightState = false;
    }
    if (config_1.default.keymapLegendStyle === "dynamic") {
        dynamicKeymapLegendStyle(exports.leftState || exports.rightState);
    }
});
function reset() {
    exports.leftState = false;
    exports.rightState = false;
}
exports.reset = reset;
const leftSideKeys = [
    "KeyQ",
    "KeyW",
    "KeyE",
    "KeyR",
    "KeyT",
    "KeyA",
    "KeyS",
    "KeyD",
    "KeyF",
    "KeyG",
    "KeyZ",
    "KeyX",
    "KeyC",
    "KeyV",
    "Backquote",
    "Digit1",
    "Digit2",
    "Digit3",
    "Digit4",
    "Digit5",
];
const rightSideKeys = [
    "KeyU",
    "KeyI",
    "KeyO",
    "KeyP",
    "KeyH",
    "KeyJ",
    "KeyK",
    "KeyL",
    "KeyN",
    "KeyM",
    "Digit7",
    "Digit8",
    "Digit9",
    "Digit0",
    "Backslash",
    "BracketLeft",
    "BracketRight",
    "Semicolon",
    "Quote",
    "Comma",
    "Period",
    "Slash",
];
function isUsingOppositeShift(event) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!exports.leftState && !exports.rightState)
            return null;
        if (config_1.default.oppositeShiftMode === "on") {
            if (!rightSideKeys.includes(event.code) &&
                !leftSideKeys.includes(event.code)) {
                return null;
            }
            if ((exports.leftState && rightSideKeys.includes(event.code)) ||
                (exports.rightState && leftSideKeys.includes(event.code))) {
                return true;
            }
            else {
                return false;
            }
        }
        else if (config_1.default.oppositeShiftMode === "keymap") {
            yield buildKeymapStrings();
            if (!keymapStrings.left || !keymapStrings.right)
                return null;
            if ((exports.leftState && keymapStrings.right.includes(event.key)) ||
                (exports.rightState && keymapStrings.left.includes(event.key))) {
                return true;
            }
            else {
                return false;
            }
        }
        return true;
    });
}
exports.isUsingOppositeShift = isUsingOppositeShift;


/***/ }),

/***/ "./src/scripts/test/tbd-mode.ts":
/*!**************************************!*\
  !*** ./src/scripts/test/tbd-mode.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getTbdMode = void 0;
const wordset_1 = __webpack_require__(/*! ./wordset */ "./src/scripts/test/wordset.ts");
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const PageChangeEvent = __importStar(__webpack_require__(/*! ../observables/page-change-event */ "./src/scripts/observables/page-change-event.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ResultsShownEvent = __importStar(__webpack_require__(/*! ../observables/results-shown-event */ "./src/scripts/observables/results-shown-event.ts"));
const WordTypedEvent = __importStar(__webpack_require__(/*! ../observables/word-typed-event */ "./src/scripts/observables/word-typed-event.ts"));
const ResetRequestedEvent = __importStar(__webpack_require__(/*! ../observables/reset-requested-event */ "./src/scripts/observables/reset-requested-event.ts"));
const debounce_1 = __webpack_require__(/*! ../utils/debounce */ "./src/scripts/utils/debounce.ts");
class TbdConfig {
    init() {
        TbdEvents.addSubscriber("sorterSelectChanged", (data) => {
            this.set("sorter", data["value"]);
        });
        TbdEvents.addSubscriber("configUpdateRequested", (data) => {
            switch (data["configSetting"]) {
                case "targetSpeed":
                    this.processTargetSpeedUpdateRequest();
                    break;
                case "groupSize":
                    this.processGroupSizeUpdateRequest();
                    break;
                case "animations":
                    this.processAnimationToggleRequest();
                    break;
                case "unbeatenWordPercentage":
                    this.processUnbeatenWordPercentageRequest();
                    break;
            }
        });
    }
    get(key, defaultValue = "") {
        const configData = TbdData.getAll().config;
        return configData[key] || defaultValue;
    }
    set(key, value) {
        const original = this.get(key);
        if (original == value) {
            return;
        }
        const data = TbdData.getAll();
        data.config[key] = value;
        TbdData.updateData(data);
        TbdEvents.dispatchEvent(`${key}-changed`, {
            original: original,
            newValue: value,
        });
    }
    bumpTargetSpeed() {
        const current = this.getTargetSpeed();
        this.set("targetSpeed", (current + 5).toString());
    }
    getSorterName() {
        return this.get("sorter", "alphabetical-asc");
    }
    getSorter() {
        return TbdSorting.getSorter(this.getSorterName());
    }
    getTargetSpeed() {
        return parseInt(this.get("targetSpeed", "75"));
    }
    getGroupSize() {
        return parseInt(this.get("groupSize", "30"));
    }
    getUnbeatenWordPercentage() {
        return parseInt(this.get("unbeatenWordPercentage", "60"));
    }
    processTargetSpeedUpdateRequest() {
        const newSpeed = parseInt(prompt("New target speed", this.getTargetSpeed().toString()) || "");
        if (newSpeed > 0) {
            this.set("targetSpeed", newSpeed.toString());
        }
    }
    processAnimationToggleRequest() {
        const enabled = confirm("Confirm to enable, cancel to disable.");
        if (enabled) {
            this.set("animationsEnabled", "1");
        }
        else {
            this.set("animationsEnabled", "0");
        }
    }
    areAnimationsEnabled() {
        return this.get("animationsEnabled", "1") == "1";
    }
    processGroupSizeUpdateRequest() {
        const newSize = parseInt(prompt("New group size", this.getGroupSize().toString()) || "");
        if (newSize > 0) {
            this.set("groupSize", newSize.toString());
        }
    }
    processUnbeatenWordPercentageRequest() {
        const newPercentage = parseInt(prompt(`The odds (still random) that a test word will be one that hasn't been typed faster than the current group threshold. 
        
        Must be between 10-90`, this.getUnbeatenWordPercentage().toString()) || "");
        if (isNaN(newPercentage)) {
            return;
        }
        if (newPercentage < 10 || newPercentage > 90) {
            alert(`${newPercentage} isn't a valid choice.`);
            return;
        }
        this.set("unbeatenWordPercentage", newPercentage.toString());
    }
}
class TbdSorting {
    static getSorter(name) {
        switch (name) {
            case "alphabetical-asc":
                return TbdSorting.alphabeticalAscendingSorter;
            case "alphabetical-desc":
                return TbdSorting.alphabeticalDescendingSorter;
            case "speed-asc":
                return TbdSorting.speedAscendingSorter;
            case "speed-desc":
                return TbdSorting.speedDescendingSorter;
            case "typedCount":
                return TbdSorting.typedCountSorter;
            case "missedCount":
                return TbdSorting.missedCountSorter;
        }
        return TbdSorting.alphabeticalAscendingSorter;
    }
    static randomSorter() {
        return Math.random() < 0.5 ? -1 : 1;
    }
    static alphabeticalDescendingSorter(word, word2) {
        return word.toLowerCase() < word2.toLowerCase() ? 1 : -1;
    }
    static alphabeticalAscendingSorter(word, word2) {
        return word.toLowerCase() < word2.toLowerCase() ? -1 : 1;
    }
    static speedAscendingSorter(word, word2) {
        const speed1 = TbdData.getMedianSpeedForWord(word);
        const speed2 = TbdData.getMedianSpeedForWord(word2);
        return speed1 - speed2;
    }
    static speedDescendingSorter(word, word2) {
        const speed1 = TbdData.getMedianSpeedForWord(word);
        const speed2 = TbdData.getMedianSpeedForWord(word2);
        return speed2 - speed1;
    }
    static typedCountSorter(word, word2) {
        const typed1 = TbdData.getSpeedsForWord(word).length;
        const typed2 = TbdData.getSpeedsForWord(word2).length;
        return typed2 - typed1;
    }
    static missedCountSorter(word, word2) {
        return (TbdData.getMistypedCountForWord(word2) -
            TbdData.getMistypedCountForWord(word));
    }
}
class TbdMode {
    constructor(config) {
        this.previousWord = "";
        this.config = config;
        this.monkeyTypeWordset = new wordset_1.Wordset([]);
        this.currentGroup = new TbdGroup(this.monkeyTypeWordset);
        this.groups = new TbdGroups();
    }
    init() {
        WordTypedEvent.subscribe(this.handleWordTyped.bind(this));
        ResultsShownEvent.subscribe(this.handleResultsShownEvent.bind(this));
        TbdEvents.addSubscriber("resetButtonClicked", this.resetCurrentWords.bind(this));
        TbdEvents.addSubscriber("wordClicked", this.resetWord.bind(this));
        TbdEvents.addSubscriber("targetSpeed-changed", () => {
            this.regenerateGroupsFromWordset(this.monkeyTypeWordset);
        });
        TbdEvents.addSubscriber("groupSize-changed", () => {
            this.regenerateGroupsFromWordset(this.monkeyTypeWordset);
        });
        TbdEvents.addSubscriber("wordsReset", () => {
            this.regenerateGroupsFromWordset(this.monkeyTypeWordset);
        });
        TbdEvents.addSubscriber("nextGroup", (data) => {
            this.currentGroup = data["group"];
        });
        TbdEvents.addSubscriber("groupsRegenerated", () => {
            ResetRequestedEvent.dispatch();
        });
        TbdEvents.addSubscriber("actionButtonClicked", (data) => {
            switch (data["actionValue"]) {
                case "resetCurrentWords":
                    this.handleResetCurrentWordsRequest();
                    break;
                case "resetAllWords":
                    this.handleResetAllWordsRequest();
                    break;
                case "copyAllData":
                    this.handleCopyDataRequest();
                    break;
                case "importData":
                    this.handleImportDataRequest();
                    break;
            }
        });
    }
    handleWordTyped(_word, isCorrect, burst, currentWordElement) {
        if (!isCorrect) {
            return;
        }
        const wordElement = currentWordElement[0];
        const typedAboveTarget = burst > this.getConfig().getTargetSpeed();
        if (typedAboveTarget) {
            TbdEvents.dispatchEvent("wordTypedCorrectly", { wordElement });
        }
        else {
            TbdEvents.dispatchEvent("wordMissed", { wordElement });
        }
    }
    handleResetCurrentWordsRequest() {
        if (confirm("Are you sure you want to reset data for the current wordset? This includes all" +
            " words in the language or custom word set you are using, not just the current group!")) {
            TbdData.resetDataForWords(this.monkeyTypeWordset.words);
        }
    }
    handleCopyDataRequest() {
        navigator.clipboard.writeText(JSON.stringify(TbdData.getAll())).then(() => {
            alert("JSON copied to your clipboard");
        }, () => {
            alert("There was a problem copying the data to your clipboard");
        });
    }
    handleImportDataRequest() {
        const exportJson = prompt("Enter the JSON you got from an export here") || "";
        if (exportJson == "") {
            return;
        }
        const parsed = JSON.parse(exportJson);
        if ("words" in parsed && "config" in parsed) {
            TbdData.updateData(parsed, true);
            location.reload();
        }
        else {
            alert("There was something wrong with your JSON, sorry!");
        }
    }
    getConfig() {
        return this.config;
    }
    getWord(originalWordset) {
        this.handleWordsetForNextWord(originalWordset);
        const group = this.getCurrentGroup();
        const random = Math.random() * 100;
        const unbeatenWordset = group.getUnbeatenWordset();
        const isThereMoreThanOneWord = group.getWordset().length > 1;
        let nextWord;
        if (unbeatenWordset.length > 0 &&
            random <= this.getConfig().getUnbeatenWordPercentage()) {
            nextWord = unbeatenWordset.randomWord();
        }
        else {
            nextWord = group.getWordset().randomWord();
        }
        if (this.previousWord == nextWord && isThereMoreThanOneWord) {
            return this.getWord(originalWordset);
        }
        this.previousWord = nextWord;
        return nextWord;
    }
    getCurrentGroup() {
        return this.currentGroup;
    }
    getFirstIncompleteGroup() {
        return this.groups.getFirstIncompleteGroup(this.config.getTargetSpeed());
    }
    recalculateCurrentGroup() {
        if (this.getCurrentGroup().getUnbeatenWordset().length > 0 &&
            this.getCurrentGroup().getThreshold() <= this.getConfig().getTargetSpeed()) {
            const index = this.groups.getGroups().indexOf(this.getCurrentGroup());
            TbdEvents.dispatchEvent("nextGroup", {
                group: this.getCurrentGroup(),
                groupNumber: index + 1,
            });
            return;
        }
        let next = this.getFirstIncompleteGroup();
        while (next == null) {
            this.getConfig().bumpTargetSpeed(); // side effects, regenerates all groups
            next = this.getFirstIncompleteGroup();
        }
        const index = this.groups.getGroups().indexOf(this.currentGroup);
        TbdEvents.dispatchEvent("nextGroup", {
            group: next,
            groupNumber: index + 1,
        });
    }
    getMonkeyTypeWordset() {
        return this.monkeyTypeWordset;
    }
    handleWordsetForNextWord(wordset) {
        if (this.monkeyTypeWordset.length != wordset.length &&
            wordset.words.join("$") != this.monkeyTypeWordset.words.join("$")) {
            this.handleNewWordset(wordset);
        }
    }
    handleNewWordset(wordset) {
        this.monkeyTypeWordset = wordset;
        this.regenerateGroupsFromWordset(wordset);
    }
    regenerateGroupsFromWordset(wordset) {
        const notAboveTargetSpeed = wordset.words.filter((word) => {
            return !TbdData.hasWordBeenTypedFasterThan(word, this.config.getTargetSpeed());
        });
        const uniqueBelowTarget = new Set(notAboveTargetSpeed);
        if (uniqueBelowTarget.size == 0) {
            this.getConfig().bumpTargetSpeed();
            // Bumping the target triggers a regeneration of groups and infinite loops are no fun
            return;
        }
        this.groups.regenerateGroups(Array.from(uniqueBelowTarget), this.config.getGroupSize());
    }
    handleResultsShownEvent(results) {
        if (!results.difficultyFailed) {
            this.saveBurstsFromLatestResults();
        }
        this.saveMissesFromLatestResult();
        this.recalculateCurrentGroup();
        this.getCurrentGroup().increaseThresholdUntilSomeWordsAreUnbeaten();
        TbdEvents.dispatchEvent("resultsProcessed", {
            currentGroup: this.getCurrentGroup(),
            monkeyTypeWordset: this.monkeyTypeWordset,
            targetSpeed: this.config.getTargetSpeed(),
        });
    }
    saveBurstsFromLatestResults() {
        const resultWords = TestInput.input.history;
        const resultBursts = TestInput.burstHistory;
        for (let i = 0; i < resultWords.length; i++) {
            const word = resultWords[i];
            const burst = resultBursts[i];
            TbdData.addBurst(word, burst);
        }
    }
    resetCurrentWords() {
        if (!confirm("Are you sure you want to reset the stats for the current words?")) {
            return;
        }
        TbdData.resetDataForWords(this.monkeyTypeWordset.words);
    }
    resetWord(data) {
        const word = data["word"];
        if (!confirm(`Reset all data for ${word}?`)) {
            return;
        }
        TbdData.resetDataForWord(word);
    }
    saveMissesFromLatestResult() {
        Object.keys(TestInput.missedWords).forEach((word) => {
            const missedCount = TestInput.missedWords[word];
            TbdData.addToMissedCount(word, missedCount);
        });
    }
    handleResetAllWordsRequest() {
        let confirmationWord = "delete";
        let slowestSpeed = 1000;
        const allData = TbdData.getAll();
        Object.keys(allData.words)
            .filter((word) => TbdData.getMedianSpeedForWord(word) > 0)
            .forEach((word) => {
            const median = TbdData.getMedianSpeedForWord(word);
            if (median > 0 &&
                median < slowestSpeed &&
                word.length >= confirmationWord.length) {
                confirmationWord = word;
                slowestSpeed = median;
            }
        });
        const confirmationString = `${confirmationWord} ${confirmationWord} ${confirmationWord}`;
        const response = prompt(`This will delete ALL your word data. To confirm, type: ${confirmationString}`);
        if (response == null) {
            return;
        }
        if (response == confirmationString) {
            allData.words = {};
            TbdData.updateData(allData, true);
            alert("Ok! Your data has been deleted and you're starting over from scratch.");
            // Lazy, I know
            location.reload();
        }
        else {
            alert(`Good effort, but you typed 
        
        '${response}' 
        
        instead of 
        
        '${confirmationString}' 
        
        No reset for you!`);
        }
    }
}
class TbdUI {
    constructor(tbdMode) {
        this.$groupThreshold = $("#tbdModeGroupThreshold");
        this.$tbdModeGroupCount = $("#tbdModeGroupCount");
        this.$wordInfo = $("#tbdModeWordInfo");
        this.$wordsDiv = $("#tbdmodeInfo .wordsContainer .words");
        this.$progressMeterTotal = $("#tbdmodeInfo .progressMeterTotal");
        this.$targetThreshold = $("#tbdModeTargetThreshold");
        this.$progressMeterGroup = $("#tbdmodeInfo .progressMeterGroup");
        this.$tbdModeInfo = $("#tbdmodeInfo");
        this.$tbdModeHelpButton = $(".tbdModeHelpButton");
        this.$tbdModeHelp = $("#tbdHelp");
        this.$tbdBeatenExample = $(".tbdBeatenExample");
        this.$tbdLostExample = $(".tbdLostExample");
        this.$tbdModeActionsSelect = $("#tbdModeActionsSelect");
        this.$tbdModeActionsButton = $("#tbdModeActionButton");
        this.$tbdModeConfigSettingsSelect = $("#tbdModeConfigSettings");
        this.$tbdModeConfigSettingsUpdateButton = $("#tbdModeUpdateConfigSettingsUpdateButton");
        this.$sorterSelect = $("#tbdModeSorterSelect");
        this.currentlyAnimating = [];
        this.$tbdModeGroupNumber = $("#tbdModeCurrentGroupNumber");
        this.tbdMode = tbdMode;
        const wordsContainer = document.getElementById("tbdModeWordsContainer");
        if (!(wordsContainer instanceof HTMLDivElement)) {
            throw new Error("Could not locate TBD words container");
        }
        this.wordsContainer = wordsContainer;
        this.$wordInfo.hide();
        this.$tbdModeInfo.hide();
    }
    init() {
        this.$tbdModeInfo.show(300);
        PageChangeEvent.subscribe(this.pageChangeHandler.bind(this));
        this.wordsContainer.addEventListener("mousemove", this.updateWordInfo.bind(this));
        this.wordsContainer.addEventListener("click", this.handleWordClicked.bind(this));
        this.wordsContainer.addEventListener("mouseleave", () => {
            return this.$wordInfo.hide(0);
        });
        TbdEvents.addSubscriber("wordTypedCorrectly", (data) => {
            this.animate(data["wordElement"], "tbdBeaten");
        });
        TbdEvents.addSubscriber("wordMissed", (data) => {
            this.animate(data["wordElement"], "tbdLost");
        });
        TbdEvents.addSubscriber("groupThresholdChanged", (data) => {
            this.$groupThreshold.text(data["threshold"]);
        });
        TbdEvents.addSubscriber("resultsProcessed", (data) => {
            const group = data["currentGroup"];
            this.updateUiWords(group.getWordset().words);
        });
        TbdEvents.addSubscriber("resultsProcessed", (data) => {
            this.updateTotalProgressMeter(data["monkeyTypeWordset"], data["targetSpeed"]);
        });
        TbdEvents.addSubscriber("resultsProcessed", (data) => {
            this.updateGroupProgressMeter(data["currentGroup"], data["targetSpeed"]);
        });
        this.$sorterSelect.on("change", (event) => {
            if (!(event.target instanceof HTMLSelectElement)) {
                return;
            }
            TbdEvents.dispatchEvent("sorterSelectChanged", {
                value: event.target.value,
            });
        });
        TbdEvents.addSubscriber("sorter-changed", this.handleSorterChange.bind(this));
        TbdEvents.addSubscriber("nextGroup", (data) => {
            const group = data["group"];
            this.updateUiWords(group.getWordset().words);
        });
        TbdEvents.addSubscriber("nextGroup", () => {
            this.updateGroupProgressMeter(this.tbdMode.getCurrentGroup(), this.tbdMode.getConfig().getTargetSpeed());
            this.updateTotalProgressMeter(this.tbdMode.getMonkeyTypeWordset(), this.tbdMode.getConfig().getTargetSpeed());
        });
        // Can't use targetSpeed-changed because of stupid recursive way of
        // auto bumping threshold to ensure there are always groups
        TbdEvents.addSubscriber("nextGroup", () => {
            this.$targetThreshold.text(this.tbdMode.getConfig().getTargetSpeed().toString());
        });
        this.$tbdModeHelpButton.on("click", () => {
            this.$tbdModeHelp.toggle(250);
            this.$wordsDiv.toggle(250);
        });
        this.$tbdBeatenExample.on("click", (event) => {
            this.animate(event.target, "tbdBeaten");
        });
        this.$tbdLostExample.on("click", (event) => {
            this.animate(event.target, "tbdLost");
        });
        this.$targetThreshold.text(this.tbdMode.getConfig().getTargetSpeed());
        this.$groupThreshold.text(this.tbdMode.getCurrentGroup().getThreshold());
        this.$tbdModeConfigSettingsUpdateButton.on("click", () => {
            const selectValue = this.$tbdModeConfigSettingsSelect.val();
            if (selectValue == "") {
                alert("Select an option from the dropdown first");
            }
            else {
                TbdEvents.dispatchEvent("configUpdateRequested", {
                    configSetting: selectValue,
                });
            }
        });
        this.$tbdModeActionsButton.on("click", () => {
            const selectValue = this.$tbdModeActionsSelect.val();
            if (selectValue == "") {
                alert("Select an option from the dropdown first");
            }
            else {
                TbdEvents.dispatchEvent("actionButtonClicked", {
                    actionValue: selectValue,
                });
            }
        });
        TbdEvents.addSubscriber("wordSaved", (data) => {
            const word = data["word"] || "";
            if (word == "") {
                return;
            }
            const element = this.getWordElement(word);
            if (!element) {
                return;
            }
            this.updateWord(word);
        });
        TbdEvents.addSubscriber("groupsRegenerated", (data) => {
            this.$tbdModeGroupCount.text(data["groups"].length);
        });
        TbdEvents.addSubscriber("nextGroup", (data) => {
            this.$tbdModeGroupNumber.text(data["groupNumber"]);
            this.$groupThreshold.text(data["group"].getThreshold());
        });
        this.$sorterSelect
            .find(`option[value="${this.tbdMode.getConfig().getSorterName()}"]`)
            .attr("selected", "");
    }
    /**
     * @param element
     * @param animation - both the keyframe animation and class with that animation. For simplicity
     * they must be the same.
     */
    animate(element, animation) {
        if (!this.tbdMode.getConfig().areAnimationsEnabled()) {
            return;
        }
        if (this.currentlyAnimating.includes(element)) {
            return;
        }
        const callback = (event) => {
            if (event.animationName !== animation) {
                return;
            }
            const index = this.currentlyAnimating.findIndex((animatingElement) => animatingElement == element);
            if (index >= 0) {
                delete this.currentlyAnimating[index];
            }
            element.classList.remove(animation);
            element.removeEventListener("animationend", callback);
        };
        element.addEventListener("animationend", callback);
        this.currentlyAnimating.push(element);
        element.classList.add(animation);
    }
    handleWordClicked(event) {
        var _a;
        const target = event.target;
        if (!(target instanceof HTMLDivElement)) {
            return;
        }
        if (!target.classList.contains("tbdWord")) {
            return;
        }
        const word = ((_a = target.parentElement) === null || _a === void 0 ? void 0 : _a.dataset["word"]) || "";
        if (word == "") {
            return;
        }
        TbdEvents.dispatchEvent("wordClicked", { word: word });
    }
    handleSorterChange(data) {
        const sorter = TbdSorting.getSorter(data["newValue"] || "");
        this.sortWords(sorter);
    }
    selectSorterOption(sorterName) {
        [...document.querySelectorAll("#tbdModeSorterSelect option")].forEach((option) => {
            if (!(option instanceof HTMLOptionElement)) {
                return;
            }
            if (option["value"] == sorterName) {
                option["selected"] = true;
            }
        });
    }
    updateTotalProgressMeter(monkeyTypeWordset, targetSpeed) {
        const allWords = monkeyTypeWordset.words;
        const count = allWords.length;
        const beatenAtTargetCount = allWords.filter((word) => {
            return TbdData.hasWordBeenTypedFasterThan(word, targetSpeed);
        }).length;
        const percent = (beatenAtTargetCount / count) * 100 || 0;
        this.$progressMeterTotal.css("width", `${percent}%`);
        this.$progressMeterTotal.attr("title", `${beatenAtTargetCount} words of ${count} total have been typed faster than the target of ${targetSpeed}`);
    }
    updateGroupProgressMeter(currentGroup, targetSpeed) {
        const groupWordset = currentGroup.getWordset();
        const beatenAtTargetCount = groupWordset.words.filter((word) => {
            return TbdData.hasWordBeenTypedFasterThan(word, targetSpeed);
        }).length;
        const percent = (beatenAtTargetCount / groupWordset.length) * 100 || 0;
        this.$progressMeterGroup.css("width", `${percent}%`);
        this.$progressMeterGroup.attr("title", `${beatenAtTargetCount} words of ${groupWordset.length} in the current group have been typed faster than the target of ${targetSpeed}`);
    }
    pageChangeHandler(_previousPage, nextPage) {
        const pagesToShowInfo = ["test"];
        if (pagesToShowInfo.includes(nextPage.name)) {
            this.$tbdModeInfo.show();
        }
        else {
            this.$tbdModeInfo.hide();
        }
    }
    updateUiWords(wordsToShow) {
        var _a;
        // Remove words we don't want to show
        this.$wordsDiv.hide();
        (_a = [...document.querySelectorAll(".words .tbdWordContainer")]) === null || _a === void 0 ? void 0 : _a.forEach((wordElement) => {
            // @ts-ignore
            const word = wordElement.dataset["word"];
            if (!wordsToShow.includes(word)) {
                // @ts-ignore
                wordElement.parentElement.removeChild(wordElement);
            }
        });
        wordsToShow.forEach((word) => {
            this.updateWord(word);
        });
        this.sortWords(this.tbdMode.getConfig().getSorter());
        this.$wordsDiv.show();
    }
    updateWord(word) {
        const wordElement = this.getOrCreateWordElement(word);
        const targetSpeed = this.tbdMode.getConfig().getTargetSpeed();
        const groupSpeed = this.tbdMode.getCurrentGroup().getThreshold();
        // Timeout ensures transitions work
        setTimeout(() => {
            var _a;
            wordElement.dataset["beatenAtTarget"] =
                TbdData.hasWordBeenTypedFasterThan(word, targetSpeed) ? "1" : "0";
            wordElement.dataset["beatenAtGroup"] = TbdData.hasWordBeenTypedFasterThan(word, groupSpeed)
                ? "1"
                : "0";
            wordElement.dataset["typed"] =
                TbdData.getSpeedsForWord(word).length == 0 ? "0" : "1";
            wordElement.dataset["missedMore"] =
                TbdData.getMistypedCountForWord(word) >
                    TbdData.getSpeedsForWord(word).length
                    ? "1"
                    : "0";
            const percentComplete = TbdData.getMedianSpeedForWord(word) / targetSpeed;
            const modifier = Math.min(percentComplete, 1);
            const baseScale = 0.75;
            const additional = (1 - baseScale) * modifier;
            // @ts-ignore
            (_a = wordElement.querySelector("div").style) === null || _a === void 0 ? void 0 : _a.transform = `scale(${baseScale + additional})`;
        }, 0);
    }
    sortWords(sorter) {
        var _a;
        const words = (_a = [...document.querySelectorAll(".tbdWordContainer")]) === null || _a === void 0 ? void 0 : _a.map((wordContainerElement) => {
            if (!(wordContainerElement instanceof HTMLDivElement)) {
                throw new Error("RUH ROH");
            }
            return wordContainerElement.dataset["word"] || "";
        });
        const sorted = words.sort(sorter);
        sorted.forEach((word) => {
            const element = this.getOrCreateWordElement(word);
            this.$wordsDiv.append(element);
        });
    }
    getWordElement(word) {
        const query = `.tbdWordContainer[data-word="${word}"]`;
        return document.querySelector(query);
    }
    getOrCreateWordElement(word) {
        const element = this.getWordElement(word);
        if (element) {
            return element;
        }
        const newDiv = document.createElement("div");
        newDiv.innerHTML = `<div class="tbdWord">${word}</div>`;
        newDiv.dataset["word"] = word;
        newDiv.classList.add("tbdWordContainer");
        this.$wordsDiv.append(newDiv);
        return newDiv;
    }
    updateWordInfo(event) {
        var _a;
        const target = event.target;
        if (!(target instanceof HTMLElement)) {
            return;
        }
        if (!target.classList.contains("tbdWord")) {
            return;
        }
        const word = (_a = target.parentElement) === null || _a === void 0 ? void 0 : _a.dataset["word"];
        if (word == undefined) {
            return;
        }
        const wordData = TbdData.getDataForWord(word);
        let wordInfoHtml = `
        <h3>"${word}"</h3>
        <div class="heading">Counts</div>
        <div class="statContainer">
          <span class="label">Correct: </span>
          <span class="stat good">${wordData.speeds.length}</span.>
        </div>
        <div class="statContainer">
          <span class="label">Missed: </span>
          <span class="stat bad">${TbdData.getMistypedCountForWord(word)}</span>
        </div>`;
        if (wordData.speeds.length) {
            wordInfoHtml += `
            <div class="heading">Speeds</div>
        <div class="statContainer">
          <span class="label">Worst: </span>
          <span class="stat bad">${TbdData.getSlowestSpeedForWord(word)}</span>
        </div>
        <div class="statContainer">
          <span class="label">Mean: </span>
          <span class="stat">${TbdData.getMeanSpeedForWord(word)}</span>
        </div>
        <div class="statContainer">
          <span class="label">Median: </span>
          <span class="stat">${TbdData.getMedianSpeedForWord(word)}</span>
        </div>
        <div class="statContainer">
          <span class="label">Best: </span>
          <span class="stat good">${TbdData.getFastestSpeedForWord(word)}</span>
        </div>`;
        }
        wordInfoHtml += `<div class="helpText">click to reset word data</div>`;
        this.$wordInfo.html(wordInfoHtml);
        this.getOrCreateWordElement(word).append(this.$wordInfo[0]);
        this.$wordInfo.show(200);
    }
}
class TbdEvents {
    static dispatchEvent(name, data = {}) {
        const subscribers = this.subscribers[name] || [];
        subscribers.forEach((subscriber) => {
            subscriber(data);
        });
    }
    static addSubscriber(name, callback) {
        if (!Array.isArray(TbdEvents.subscribers[name])) {
            TbdEvents.subscribers[name] = [];
        }
        TbdEvents.subscribers[name].push(callback);
    }
}
TbdEvents.subscribers = {};
TbdEvents.debouncedDispatch = (0, debounce_1.debounce)(TbdEvents.dispatchEvent, 50);
class TbdData {
    static getAll() {
        if (TbdData.data) {
            return TbdData.data;
        }
        TbdData.data = TbdData.getFromLocalStorage();
        return TbdData.data;
    }
    static getFromLocalStorage() {
        const defaultValue = { words: {}, config: {} };
        const storedData = localStorage.getItem(TbdData.localStorageKey);
        if (storedData == null) {
            return defaultValue;
        }
        // Try parsing local storage
        const parsed = JSON.parse(storedData);
        if (typeof parsed == "object") {
            return parsed;
        }
        return defaultValue;
    }
    static updateData(data, immediately = false) {
        TbdData.data = data;
        if (immediately) {
            TbdData.updateLocalStorage(data);
        }
        else {
            TbdData.debouncedUpdateLocalStorage(data);
        }
    }
    static getDataForWord(word) {
        const data = TbdData.getAll();
        if (!data.words[word]) {
            return { speeds: [], missedCount: 0 };
        }
        return data.words[word];
    }
    static resetDataForWord(word) {
        TbdData.saveWordData(word, { speeds: [], missedCount: 0 });
        TbdEvents.dispatchEvent("wordReset", { word: word });
    }
    static resetDataForWords(words) {
        words.forEach((word) => TbdData.resetDataForWord(word));
        TbdEvents.dispatchEvent("wordsReset", { words: words });
    }
    static hasWordBeenTypedFasterThan(word, threshold) {
        return TbdData.getMedianSpeedForWord(word) > threshold;
    }
    static getSpeedsForWord(word) {
        return TbdData.getDataForWord(word).speeds || [];
    }
    static getSlowestSpeedForWord(word) {
        const speeds = TbdData.getSpeedsForWord(word);
        if (speeds.length == 0) {
            return 0;
        }
        return Math.min(...speeds);
    }
    static getFastestSpeedForWord(word) {
        const speeds = TbdData.getSpeedsForWord(word);
        if (speeds.length == 0) {
            return 0;
        }
        return Math.max(...speeds);
    }
    static getMistypedCountForWord(word) {
        return TbdData.getDataForWord(word).missedCount;
    }
    static getMedianSpeedForWord(word) {
        const wordSpeeds = TbdData.getSpeedsForWord(word);
        if (wordSpeeds.length < 1) {
            return 0;
        }
        return (0, misc_1.median)(wordSpeeds);
    }
    static getMeanSpeedForWord(word) {
        const speeds = TbdData.getSpeedsForWord(word);
        if (speeds.length == 0) {
            return 0;
        }
        return Math.round((0, misc_1.mean)(speeds));
    }
    static saveWordData(word, wordData) {
        const data = TbdData.getAll();
        data.words[word] = wordData;
        TbdData.updateData(data);
        TbdEvents.dispatchEvent("wordSaved", { word: word, data: wordData });
    }
    static addBurst(word, speed) {
        if (word == "") {
            return;
        }
        const wordData = TbdData.getDataForWord(word);
        wordData.speeds.push(speed);
        TbdData.saveWordData(word, wordData);
    }
    static addToMissedCount(word, missedCount) {
        const data = TbdData.getDataForWord(word);
        data.missedCount += missedCount;
        TbdData.saveWordData(word, data);
    }
    static updateLocalStorage(data) {
        localStorage.setItem(TbdData.localStorageKey, JSON.stringify(data));
    }
}
TbdData.localStorageKey = "tbdModeData";
TbdData.debouncedUpdateLocalStorage = (0, debounce_1.debounce)(TbdData.updateLocalStorage, 1000);
class TbdGroups {
    constructor() {
        this.groups = [];
    }
    setGroups(groups) {
        this.groups = groups;
    }
    getGroups() {
        return this.groups;
    }
    getFirstIncompleteGroup(targetSpeed) {
        return (this.groups.find((group) => {
            return group
                .getWordset()
                .words.some((word) => !TbdData.hasWordBeenTypedFasterThan(word, targetSpeed));
        }) || null);
    }
    regenerateGroups(words, desiredGroupSize) {
        this.groups = [];
        if (words.length == 0) {
            return;
        }
        const randomlySorted = words.sort(TbdSorting.randomSorter);
        // This is an effort to ensure there are no tiny group sizes, like if there are 200
        // words and a group size of 18. Creating groups of size 18 would mean getting 11 groups
        // of 18 and 1 group of 2. This method ends up creating 8 groups of 17 (136) + 4 groups of
        // 16 (64). I'm sure there is a better way to calculate it but this seems to work and I'm
        // lazy when it comes to math.
        const total = words.length;
        const actualGroupCount = Math.ceil(total / desiredGroupSize);
        const maxGroupSize = Math.ceil(total / actualGroupCount);
        const reducedGroupSize = maxGroupSize - 1;
        const sizesToCreate = [];
        let remainingWords = total;
        for (let i = 0; i < actualGroupCount; i++) {
            if (remainingWords % maxGroupSize == 0) {
                sizesToCreate.push(maxGroupSize);
                remainingWords -= maxGroupSize;
            }
            else {
                sizesToCreate.push(reducedGroupSize);
                remainingWords -= reducedGroupSize;
            }
        }
        let start = 0;
        sizesToCreate.forEach((size) => {
            const words = randomlySorted.slice(start, start + size);
            const wordset = new wordset_1.Wordset(words);
            this.groups.push(new TbdGroup(wordset));
            start = start + size;
        });
        TbdEvents.dispatchEvent("groupsRegenerated", { groups: this.groups });
        TbdEvents.dispatchEvent("nextGroup", {
            group: this.getGroups()[0],
            groupNumber: 1,
        });
    }
}
class TbdGroup {
    constructor(wordset) {
        this.threshold = 1;
        this.wordset = wordset;
    }
    getWordset() {
        return this.wordset;
    }
    getThreshold() {
        return this.threshold;
    }
    bumpThreshold() {
        this.threshold += 1;
        TbdEvents.dispatchEvent("groupThresholdChanged", {
            threshold: this.threshold,
        });
    }
    getUnbeatenWordset() {
        const unbeatenWords = this.wordset.words.filter((word) => {
            return !TbdData.hasWordBeenTypedFasterThan(word, this.getThreshold());
        });
        return new wordset_1.Wordset(unbeatenWords);
    }
    increaseThresholdUntilSomeWordsAreUnbeaten() {
        if (this.wordset.length == 0) {
            return;
        }
        while (this.getUnbeatenWordset().length == 0) {
            this.bumpThreshold();
        }
    }
}
ConfigEvent.subscribe(handleFunboxChange);
function isTbdMode() {
    return config_1.default.funbox == "tbdmode";
}
function handleFunboxChange(key, _newValue, _nosave, _previousValue, _fullConfig) {
    if (key != "funbox") {
        return;
    }
    if (isTbdMode() && !getTbdMode()) {
        const tbdConfig = new TbdConfig();
        tbdConfig.init();
        tbdMode = new TbdMode(tbdConfig);
        tbdMode.init();
        const ui = new TbdUI(tbdMode);
        ui.init();
    }
    else if (!isTbdMode() && getTbdMode()) {
        // This was the easiest way I could think of to ensure there's nothing left over
        // after switching from TBD Mode to something else.
        location.reload();
    }
}
let tbdMode;
function getTbdMode() {
    return tbdMode;
}
exports.getTbdMode = getTbdMode;


/***/ }),

/***/ "./src/scripts/test/test-config.ts":
/*!*****************************************!*\
  !*** ./src/scripts/test/test-config.ts ***!
  \*****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = exports.hide = exports.show = void 0;
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
// export function show() {
//   $("#top .config").removeClass("hidden").css("opacity", 1);
// }
// export function hide() {
//   $("#top .config").css("opacity", 0).addClass("hidden");
// }
function show() {
    $("#top .config")
        .stop(true, true)
        .removeClass("hidden")
        .css("opacity", 0)
        .animate({
        opacity: 1,
    }, 125);
}
exports.show = show;
function hide() {
    $("#top .config")
        .stop(true, true)
        .css("opacity", 1)
        .animate({
        opacity: 0,
    }, 125, () => {
        $("#top .config").addClass("hidden");
    });
}
exports.hide = hide;
function update(previous, current) {
    if (previous === current)
        return;
    $("#top .config .mode .text-button").removeClass("active");
    $("#top .config .mode .text-button[mode='" + current + "']").addClass("active");
    if (current == "time") {
        // $("#top .config .wordCount").addClass("hidden");
        // $("#top .config .time").removeClass("hidden");
        // $("#top .config .customText").addClass("hidden");
        $("#top .config .punctuationMode").removeClass("disabled");
        $("#top .config .numbersMode").removeClass("disabled");
        // $("#top .config .puncAndNum").removeClass("disabled");
        // $("#top .config .punctuationMode").removeClass("hidden");
        // $("#top .config .numbersMode").removeClass("hidden");
        // $("#top .config .quoteLength").addClass("hidden");
    }
    else if (current == "words") {
        // $("#top .config .wordCount").removeClass("hidden");
        // $("#top .config .time").addClass("hidden");
        // $("#top .config .customText").addClass("hidden");
        $("#top .config .punctuationMode").removeClass("disabled");
        $("#top .config .numbersMode").removeClass("disabled");
        // $("#top .config .puncAndNum").removeClass("disabled");
        // $("#top .config .punctuationMode").removeClass("hidden");
        // $("#top .config .numbersMode").removeClass("hidden");
        // $("#top .config .quoteLength").addClass("hidden");
    }
    else if (current == "custom") {
        // $("#top .config .wordCount").addClass("hidden");
        // $("#top .config .time").addClass("hidden");
        // $("#top .config .customText").removeClass("hidden");
        $("#top .config .punctuationMode").removeClass("disabled");
        $("#top .config .numbersMode").removeClass("disabled");
        // $("#top .config .puncAndNum").removeClass("disabled");
        // $("#top .config .punctuationMode").removeClass("hidden");
        // $("#top .config .numbersMode").removeClass("hidden");
        // $("#top .config .quoteLength").addClass("hidden");
    }
    else if (current == "quote") {
        // $("#top .config .wordCount").addClass("hidden");
        // $("#top .config .time").addClass("hidden");
        // $("#top .config .customText").addClass("hidden");
        $("#top .config .punctuationMode").addClass("disabled");
        $("#top .config .numbersMode").addClass("disabled");
        // $("#top .config .puncAndNum").addClass("disabled");
        // $("#top .config .punctuationMode").removeClass("hidden");
        // $("#top .config .numbersMode").removeClass("hidden");
        // $("#result .stats .source").removeClass("hidden");
        // $("#top .config .quoteLength").removeClass("hidden");
    }
    else if (current == "zen") {
        // $("#top .config .wordCount").addClass("hidden");
        // $("#top .config .time").addClass("hidden");
        // $("#top .config .customText").addClass("hidden");
        // $("#top .config .punctuationMode").addClass("hidden");
        // $("#top .config .numbersMode").addClass("hidden");
        // $("#top .config .quoteLength").addClass("hidden");
    }
    const submenu = {
        time: "time",
        words: "wordCount",
        custom: "customText",
        quote: "quoteLength",
        zen: "",
    };
    const animTime = 250;
    if (current == "zen") {
        $(`#top .config .${submenu[previous]}`).animate({
            opacity: 0,
        }, animTime / 2, () => {
            $(`#top .config .${submenu[previous]}`).addClass("hidden");
        });
        $(`#top .config .puncAndNum`).animate({
            opacity: 0,
        }, animTime / 2, () => {
            $(`#top .config .puncAndNum`).addClass("invisible");
        });
        return;
    }
    if (previous == "zen") {
        setTimeout(() => {
            $(`#top .config .${submenu[current]}`).removeClass("hidden");
            $(`#top .config .${submenu[current]}`)
                .css({ opacity: 0 })
                .animate({
                opacity: 1,
            }, animTime / 2);
            $(`#top .config .puncAndNum`).removeClass("invisible");
            $(`#top .config .puncAndNum`)
                .css({ opacity: 0 })
                .animate({
                opacity: 1,
            }, animTime / 2);
        }, animTime / 2);
        return;
    }
    Misc.swapElements($("#top .config ." + submenu[previous]), $("#top .config ." + submenu[current]), animTime);
}
exports.update = update;
ConfigEvent.subscribe((eventKey, eventValue, _nosave, eventPreviousValue) => {
    if (eventKey === "mode") {
        update(eventPreviousValue, eventValue);
    }
});


/***/ }),

/***/ "./src/scripts/test/test-input.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-input.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.restart = exports.pushBurstToHistory = exports.pushToRawHistory = exports.pushToWpmHistory = exports.pushMissedWord = exports.resetKeypressTimings = exports.recordKeypressSpacing = exports.setKeypressDuration = exports.pushKeypressDuration = exports.setKeypressTimingsTooLong = exports.incrementAccuracy = exports.pushKeypressesToHistory = exports.setBurstStart = exports.pushKeypressWord = exports.incrementKeypressErrors = exports.setKeypressNotAfk = exports.incrementKeypressCount = exports.updateLastKeypress = exports.enableSpacingDebug = exports.spacingDebug = exports.setBailout = exports.bailout = exports.burstHistory = exports.rawHistory = exports.wpmHistory = exports.keypressTimings = exports.accuracy = exports.missedWords = exports.currentBurstStart = exports.lastKeypress = exports.currentKeypress = exports.keypressPerSecond = exports.corrected = exports.input = void 0;
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
class Input {
    constructor() {
        this.current = "";
        this.history = [];
        this.historyLength = 0;
        this.length = 0;
    }
    reset() {
        this.current = "";
        this.history = [];
        this.length = 0;
    }
    resetHistory() {
        this.history = [];
        this.length = 0;
    }
    setCurrent(val) {
        this.current = val;
        this.length = this.current.length;
    }
    appendCurrent(val) {
        this.current += val;
        this.length = this.current.length;
    }
    resetCurrent() {
        this.current = "";
    }
    getCurrent() {
        return this.current;
    }
    pushHistory() {
        this.history.push(this.current);
        this.historyLength = this.history.length;
        this.resetCurrent();
    }
    popHistory() {
        var _a;
        const ret = (_a = this.history.pop()) !== null && _a !== void 0 ? _a : "";
        this.historyLength = this.history.length;
        return ret;
    }
    getHistory(i) {
        if (i === undefined) {
            return this.history;
        }
        else {
            return this.history[i];
        }
    }
    getHistoryLast() {
        return this.history[this.history.length - 1];
    }
}
class Corrected {
    constructor() {
        this.current = "";
        this.history = [];
    }
    setCurrent(val) {
        this.current = val;
    }
    appendCurrent(val) {
        this.current += val;
    }
    resetCurrent() {
        this.current = "";
    }
    resetHistory() {
        this.history = [];
    }
    reset() {
        this.resetCurrent();
        this.resetHistory();
    }
    getHistory(i) {
        return this.history[i];
    }
    popHistory() {
        var _a;
        return (_a = this.history.pop()) !== null && _a !== void 0 ? _a : "";
    }
    pushHistory() {
        this.history.push(this.current);
        this.current = "";
    }
}
exports.input = new Input();
exports.corrected = new Corrected();
exports.keypressPerSecond = [];
exports.currentKeypress = {
    count: 0,
    errors: 0,
    words: [],
    afk: true,
};
exports.currentBurstStart = 0;
exports.missedWords = {};
exports.accuracy = {
    correct: 0,
    incorrect: 0,
};
exports.keypressTimings = {
    spacing: {
        current: -1,
        array: [],
    },
    duration: {
        current: -1,
        array: [],
    },
};
exports.wpmHistory = [];
exports.rawHistory = [];
exports.burstHistory = [];
exports.bailout = false;
function setBailout(tf) {
    exports.bailout = tf;
}
exports.setBailout = setBailout;
exports.spacingDebug = false;
function enableSpacingDebug() {
    exports.spacingDebug = true;
    console.clear();
}
exports.enableSpacingDebug = enableSpacingDebug;
function updateLastKeypress() {
    exports.lastKeypress = performance.now();
}
exports.updateLastKeypress = updateLastKeypress;
function incrementKeypressCount() {
    exports.currentKeypress.count++;
}
exports.incrementKeypressCount = incrementKeypressCount;
function setKeypressNotAfk() {
    exports.currentKeypress.afk = false;
}
exports.setKeypressNotAfk = setKeypressNotAfk;
function incrementKeypressErrors() {
    exports.currentKeypress.errors++;
}
exports.incrementKeypressErrors = incrementKeypressErrors;
function pushKeypressWord(wordIndex) {
    exports.currentKeypress.words.push(wordIndex);
}
exports.pushKeypressWord = pushKeypressWord;
function setBurstStart(time) {
    exports.currentBurstStart = time;
}
exports.setBurstStart = setBurstStart;
function pushKeypressesToHistory() {
    exports.keypressPerSecond.push(exports.currentKeypress);
    exports.currentKeypress = {
        count: 0,
        errors: 0,
        words: [],
        afk: true,
    };
}
exports.pushKeypressesToHistory = pushKeypressesToHistory;
function incrementAccuracy(correctincorrect) {
    if (correctincorrect) {
        exports.accuracy.correct++;
    }
    else {
        exports.accuracy.incorrect++;
    }
}
exports.incrementAccuracy = incrementAccuracy;
function setKeypressTimingsTooLong() {
    exports.keypressTimings.spacing.array = "toolong";
    exports.keypressTimings.duration.array = "toolong";
}
exports.setKeypressTimingsTooLong = setKeypressTimingsTooLong;
function pushKeypressDuration(val) {
    exports.keypressTimings.duration.array.push((0, misc_1.roundTo2)(val));
}
exports.pushKeypressDuration = pushKeypressDuration;
function setKeypressDuration(val) {
    exports.keypressTimings.duration.current = (0, misc_1.roundTo2)(val);
}
exports.setKeypressDuration = setKeypressDuration;
function pushKeypressSpacing(val) {
    exports.keypressTimings.spacing.array.push((0, misc_1.roundTo2)(val));
}
function setKeypressSpacing(val) {
    exports.keypressTimings.spacing.current = (0, misc_1.roundTo2)(val);
}
function recordKeypressSpacing() {
    const now = performance.now();
    const diff = Math.abs(exports.keypressTimings.spacing.current - now);
    if (exports.keypressTimings.spacing.current !== -1) {
        pushKeypressSpacing(diff);
        if (exports.spacingDebug) {
            console.log("spacing debug", "push", diff, "length", exports.keypressTimings.spacing.array.length);
        }
    }
    setKeypressSpacing(now);
    if (exports.spacingDebug) {
        console.log("spacing debug", "set", now, "length", exports.keypressTimings.spacing.array.length);
    }
    if (exports.spacingDebug) {
        console.log("spacing debug", "recorded", "length", exports.keypressTimings.spacing.array.length);
    }
}
exports.recordKeypressSpacing = recordKeypressSpacing;
function resetKeypressTimings() {
    exports.keypressTimings = {
        spacing: {
            current: performance.now(),
            array: [],
        },
        duration: {
            current: performance.now(),
            array: [],
        },
    };
    if (exports.spacingDebug)
        console.clear();
}
exports.resetKeypressTimings = resetKeypressTimings;
function pushMissedWord(word) {
    if (!Object.keys(exports.missedWords).includes(word)) {
        exports.missedWords[word] = 1;
    }
    else {
        exports.missedWords[word]++;
    }
}
exports.pushMissedWord = pushMissedWord;
function pushToWpmHistory(wpm) {
    exports.wpmHistory.push(wpm);
}
exports.pushToWpmHistory = pushToWpmHistory;
function pushToRawHistory(raw) {
    exports.rawHistory.push(raw);
}
exports.pushToRawHistory = pushToRawHistory;
function pushBurstToHistory(speed) {
    if (exports.burstHistory[TestWords.words.currentIndex] === undefined) {
        exports.burstHistory.push(speed);
    }
    else {
        //repeated word - override
        exports.burstHistory[TestWords.words.currentIndex] = speed;
    }
}
exports.pushBurstToHistory = pushBurstToHistory;
function restart() {
    exports.wpmHistory = [];
    exports.rawHistory = [];
    exports.burstHistory = [];
    exports.keypressPerSecond = [];
    exports.currentKeypress = {
        count: 0,
        errors: 0,
        words: [],
        afk: true,
    };
    exports.currentBurstStart = 0;
    exports.missedWords = {};
    exports.accuracy = {
        correct: 0,
        incorrect: 0,
    };
    exports.keypressTimings = {
        spacing: {
            current: -1,
            array: [],
        },
        duration: {
            current: -1,
            array: [],
        },
    };
}
exports.restart = restart;


/***/ }),

/***/ "./src/scripts/test/test-logic.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-logic.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.fail = exports.finish = exports.retrySavingResult = exports.addWord = exports.init = exports.restart = exports.startTest = exports.punctuateWord = exports.setNotSignedInUid = exports.clearNotSignedInResult = exports.notSignedInLastResult = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const TestUI = __importStar(__webpack_require__(/*! ./test-ui */ "./src/scripts/test/test-ui.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ./manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const quotes_controller_1 = __importDefault(__webpack_require__(/*! ../controllers/quotes-controller */ "./src/scripts/controllers/quotes-controller.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const CustomText = __importStar(__webpack_require__(/*! ./custom-text */ "./src/scripts/test/custom-text.ts"));
const TestStats = __importStar(__webpack_require__(/*! ./test-stats */ "./src/scripts/test/test-stats.ts"));
const PractiseWords = __importStar(__webpack_require__(/*! ./practise-words */ "./src/scripts/test/practise-words.ts"));
const ShiftTracker = __importStar(__webpack_require__(/*! ./shift-tracker */ "./src/scripts/test/shift-tracker.ts"));
const Focus = __importStar(__webpack_require__(/*! ./focus */ "./src/scripts/test/focus.ts"));
const Funbox = __importStar(__webpack_require__(/*! ./funbox */ "./src/scripts/test/funbox.ts"));
const Keymap = __importStar(__webpack_require__(/*! ../elements/keymap */ "./src/scripts/elements/keymap.ts"));
const ThemeController = __importStar(__webpack_require__(/*! ../controllers/theme-controller */ "./src/scripts/controllers/theme-controller.ts"));
const PaceCaret = __importStar(__webpack_require__(/*! ./pace-caret */ "./src/scripts/test/pace-caret.ts"));
const Caret = __importStar(__webpack_require__(/*! ./caret */ "./src/scripts/test/caret.ts"));
const LiveWpm = __importStar(__webpack_require__(/*! ./live-wpm */ "./src/scripts/test/live-wpm.ts"));
const LiveAcc = __importStar(__webpack_require__(/*! ./live-acc */ "./src/scripts/test/live-acc.ts"));
const LiveBurst = __importStar(__webpack_require__(/*! ./live-burst */ "./src/scripts/test/live-burst.ts"));
const TimerProgress = __importStar(__webpack_require__(/*! ./timer-progress */ "./src/scripts/test/timer-progress.ts"));
const QuoteSearchPopup = __importStar(__webpack_require__(/*! ../popups/quote-search-popup */ "./src/scripts/popups/quote-search-popup.ts"));
const QuoteSubmitPopup = __importStar(__webpack_require__(/*! ../popups/quote-submit-popup */ "./src/scripts/popups/quote-submit-popup.ts"));
const PbCrown = __importStar(__webpack_require__(/*! ./pb-crown */ "./src/scripts/test/pb-crown.ts"));
const TestTimer = __importStar(__webpack_require__(/*! ./test-timer */ "./src/scripts/test/test-timer.ts"));
const OutOfFocus = __importStar(__webpack_require__(/*! ./out-of-focus */ "./src/scripts/test/out-of-focus.ts"));
const AccountButton = __importStar(__webpack_require__(/*! ../elements/account-button */ "./src/scripts/elements/account-button.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Replay = __importStar(__webpack_require__(/*! ./replay */ "./src/scripts/test/replay.ts"));
const Poetry = __importStar(__webpack_require__(/*! ./poetry */ "./src/scripts/test/poetry.ts"));
const Wikipedia = __importStar(__webpack_require__(/*! ./wikipedia */ "./src/scripts/test/wikipedia.ts"));
const TodayTracker = __importStar(__webpack_require__(/*! ./today-tracker */ "./src/scripts/test/today-tracker.ts"));
const WeakSpot = __importStar(__webpack_require__(/*! ./weak-spot */ "./src/scripts/test/weak-spot.ts"));
const Wordset = __importStar(__webpack_require__(/*! ./wordset */ "./src/scripts/test/wordset.ts"));
const ChallengeContoller = __importStar(__webpack_require__(/*! ../controllers/challenge-controller */ "./src/scripts/controllers/challenge-controller.ts"));
const QuoteRatePopup = __importStar(__webpack_require__(/*! ../popups/quote-rate-popup */ "./src/scripts/popups/quote-rate-popup.ts"));
const BritishEnglish = __importStar(__webpack_require__(/*! ./british-english */ "./src/scripts/test/british-english.ts"));
const LazyMode = __importStar(__webpack_require__(/*! ./lazy-mode */ "./src/scripts/test/lazy-mode.ts"));
const Result = __importStar(__webpack_require__(/*! ./result */ "./src/scripts/test/result.ts"));
const MonkeyPower = __importStar(__webpack_require__(/*! ../elements/monkey-power */ "./src/scripts/elements/monkey-power.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const TestState = __importStar(__webpack_require__(/*! ./test-state */ "./src/scripts/test/test-state.ts"));
const ModesNotice = __importStar(__webpack_require__(/*! ../elements/modes-notice */ "./src/scripts/elements/modes-notice.ts"));
const PageTransition = __importStar(__webpack_require__(/*! ../states/page-transition */ "./src/scripts/states/page-transition.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const TimerEvent = __importStar(__webpack_require__(/*! ../observables/timer-event */ "./src/scripts/observables/timer-event.ts"));
const ResetRequestedEvent = __importStar(__webpack_require__(/*! ../observables/reset-requested-event */ "./src/scripts/observables/reset-requested-event.ts"));
const Last10Average = __importStar(__webpack_require__(/*! ../elements/last-10-average */ "./src/scripts/elements/last-10-average.ts"));
const Monkey = __importStar(__webpack_require__(/*! ./monkey */ "./src/scripts/test/monkey.ts"));
const tbd_mode_1 = __webpack_require__(/*! ./tbd-mode */ "./src/scripts/test/tbd-mode.ts");
const object_hash_1 = __importDefault(__webpack_require__(/*! object-hash */ "./node_modules/object-hash/dist/object_hash.js"));
const AnalyticsController = __importStar(__webpack_require__(/*! ../controllers/analytics-controller */ "./src/scripts/controllers/analytics-controller.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
let failReason = "";
exports.notSignedInLastResult = null;
function clearNotSignedInResult() {
    exports.notSignedInLastResult = null;
}
exports.clearNotSignedInResult = clearNotSignedInResult;
function setNotSignedInUid(uid) {
    if (exports.notSignedInLastResult === null)
        return;
    exports.notSignedInLastResult.uid = uid;
    delete exports.notSignedInLastResult.hash;
    exports.notSignedInLastResult.hash = (0, object_hash_1.default)(exports.notSignedInLastResult);
}
exports.setNotSignedInUid = setNotSignedInUid;
let spanishSentenceTracker = "";
function punctuateWord(previousWord, currentWord, index, maxindex) {
    let word = currentWord;
    const currentLanguage = config_1.default.language.split("_")[0];
    const lastChar = Misc.getLastChar(previousWord);
    if (config_1.default.funbox === "58008") {
        if (currentWord.length > 3) {
            if (Math.random() < 0.75) {
                const special = ["/", "*", "-", "+"][Math.floor(Math.random() * 4)];
                word = Misc.setCharAt(word, Math.floor(word.length / 2), special);
            }
        }
    }
    else {
        if ((index == 0 || lastChar == "." || lastChar == "?" || lastChar == "!") &&
            currentLanguage != "code") {
            //always capitalise the first word or if there was a dot unless using a code alphabet
            word = Misc.capitalizeFirstLetterOfEachWord(word);
            if (currentLanguage == "spanish" || currentLanguage == "catalan") {
                const rand = Math.random();
                if (rand > 0.9) {
                    word = "" + word;
                    spanishSentenceTracker = "?";
                }
                else if (rand > 0.8) {
                    word = "" + word;
                    spanishSentenceTracker = "!";
                }
            }
        }
        else if ((Math.random() < 0.1 &&
            lastChar != "." &&
            lastChar != "," &&
            index != maxindex - 2) ||
            index == maxindex - 1) {
            if (currentLanguage == "spanish" || currentLanguage == "catalan") {
                if (spanishSentenceTracker == "?" || spanishSentenceTracker == "!") {
                    word += spanishSentenceTracker;
                    spanishSentenceTracker = "";
                }
            }
            else {
                const rand = Math.random();
                if (rand <= 0.8) {
                    word += ".";
                }
                else if (rand > 0.8 && rand < 0.9) {
                    if (currentLanguage == "french") {
                        word = "?";
                    }
                    else if (currentLanguage == "arabic" ||
                        currentLanguage == "persian" ||
                        currentLanguage == "urdu") {
                        word += "";
                    }
                    else if (currentLanguage == "greek") {
                        word += ";";
                    }
                    else {
                        word += "?";
                    }
                }
                else {
                    if (currentLanguage == "french") {
                        word = "!";
                    }
                    else {
                        word += "!";
                    }
                }
            }
        }
        else if (Math.random() < 0.01 &&
            lastChar != "," &&
            lastChar != "." &&
            currentLanguage !== "russian") {
            word = `"${word}"`;
        }
        else if (Math.random() < 0.011 &&
            lastChar != "," &&
            lastChar != "." &&
            currentLanguage !== "russian" &&
            currentLanguage !== "ukrainian") {
            word = `'${word}'`;
        }
        else if (Math.random() < 0.012 && lastChar != "," && lastChar != ".") {
            if (currentLanguage == "code") {
                const r = Math.random();
                if (r < 0.25) {
                    word = `(${word})`;
                }
                else if (r < 0.5) {
                    word = `{${word}}`;
                }
                else if (r < 0.75) {
                    word = `[${word}]`;
                }
                else {
                    word = `<${word}>`;
                }
            }
            else {
                word = `(${word})`;
            }
        }
        else if (Math.random() < 0.013 &&
            lastChar != "," &&
            lastChar != "." &&
            lastChar != ";" &&
            lastChar != "" &&
            lastChar != ":") {
            if (currentLanguage == "french") {
                word = ":";
            }
            else if (currentLanguage == "greek") {
                word = "";
            }
            else {
                word += ":";
            }
        }
        else if (Math.random() < 0.014 &&
            lastChar != "," &&
            lastChar != "." &&
            previousWord != "-") {
            word = "-";
        }
        else if (Math.random() < 0.015 &&
            lastChar != "," &&
            lastChar != "." &&
            lastChar != ";" &&
            lastChar != "" &&
            lastChar != ":") {
            if (currentLanguage == "french") {
                word = ";";
            }
            else if (currentLanguage == "greek") {
                word = "";
            }
            else if (currentLanguage == "arabic") {
                word += "";
            }
            else {
                word += ";";
            }
        }
        else if (Math.random() < 0.2 && lastChar != ",") {
            if (currentLanguage == "arabic" ||
                currentLanguage == "urdu" ||
                currentLanguage == "persian") {
                word += "";
            }
            else {
                word += ",";
            }
        }
        else if (Math.random() < 0.25 && currentLanguage == "code") {
            const specials = ["{", "}", "[", "]", "(", ")", ";", "=", "+", "%", "/"];
            word = Misc.randomElementFromArray(specials);
        }
    }
    return word;
}
exports.punctuateWord = punctuateWord;
function startTest() {
    if (PageTransition.get()) {
        return false;
    }
    if (!UpdateConfig.dbConfigLoaded) {
        UpdateConfig.setChangedBeforeDb(true);
    }
    if (firebase_1.Auth.currentUser !== null) {
        AnalyticsController.log("testStarted");
    }
    else {
        AnalyticsController.log("testStartedNoLogin");
    }
    TestActive.set(true);
    Replay.startReplayRecording();
    Replay.replayGetWordsList(TestWords.words.list);
    TestInput.resetKeypressTimings();
    TimerProgress.restart();
    TimerProgress.show();
    $("#liveWpm").text("0");
    LiveWpm.show();
    LiveAcc.show();
    LiveBurst.show();
    TimerProgress.update();
    TestTimer.clear();
    Monkey.show();
    if (config_1.default.funbox === "memory") {
        Funbox.resetMemoryTimer();
        $("#wordsWrapper").addClass("hidden");
    }
    try {
        if (config_1.default.paceCaret !== "off" ||
            (config_1.default.repeatedPace && TestState.isPaceRepeat)) {
            PaceCaret.start();
        }
    }
    catch (e) { }
    //use a recursive self-adjusting timer to avoid time drift
    TestStats.setStart(performance.now());
    TestTimer.start();
    return true;
}
exports.startTest = startTest;
function restart(withSameWordset = false, _, // this is nosave and should be renamed to nosave when needed
event, practiseMissed = false, noAnim = false) {
    if (TestUI.testRestarting || TestUI.resultCalculating) {
        event === null || event === void 0 ? void 0 : event.preventDefault();
        return;
    }
    if (ActivePage.get() == "test" && !TestUI.resultVisible) {
        if (!ManualRestart.get()) {
            if (TestWords.hasTab) {
                if (!(event === null || event === void 0 ? void 0 : event.shiftKey))
                    return;
            }
            if (config_1.default.mode !== "zen")
                event === null || event === void 0 ? void 0 : event.preventDefault();
            if (!Misc.canQuickRestart(config_1.default.mode, config_1.default.words, config_1.default.time, CustomText)) {
                let message = "Use your mouse to confirm.";
                if (config_1.default.quickTab) {
                    message = "Press shift + tab or use your mouse to confirm.";
                }
                Notifications.add("Quick restart disabled. " + message, 0, 3);
                return;
            }
            // }else{
            //   return;
            // }
        }
    }
    if (TestActive.get()) {
        TestInput.pushKeypressesToHistory();
        const testSeconds = TestStats.calculateTestSeconds(performance.now());
        const afkseconds = TestStats.calculateAfkSeconds(testSeconds);
        // incompleteTestSeconds += ;
        let tt = testSeconds - afkseconds;
        if (tt < 0)
            tt = 0;
        console.log(`increasing incomplete time by ${tt}s (${testSeconds}s - ${afkseconds}s afk)`);
        TestStats.incrementIncompleteSeconds(tt);
        TestStats.incrementRestartCount();
        if (tt > 600) {
            Notifications.add(`Your time typing just increased by ${Misc.roundTo2(tt / 60)} minutes. If you think this is incorrect please contact Miodec and dont refresh the website.`, -1);
        }
        // restartCount++;
    }
    if (config_1.default.mode == "zen") {
        $("#words").empty();
    }
    if (PractiseWords.before.mode !== null &&
        !withSameWordset &&
        !practiseMissed) {
        Notifications.add("Reverting to previous settings.", 0);
        if (PractiseWords.before.punctuation !== null) {
            UpdateConfig.setPunctuation(PractiseWords.before.punctuation);
        }
        if (PractiseWords.before.numbers !== null) {
            UpdateConfig.setNumbers(PractiseWords.before.numbers);
        }
        UpdateConfig.setMode(PractiseWords.before.mode);
        PractiseWords.resetBefore();
    }
    let repeatWithPace = false;
    if (TestUI.resultVisible && config_1.default.repeatedPace && withSameWordset) {
        repeatWithPace = true;
    }
    ManualRestart.reset();
    TestTimer.clear();
    TestStats.restart();
    TestInput.restart();
    TestInput.corrected.reset();
    ShiftTracker.reset();
    Caret.hide();
    TestActive.set(false);
    Replay.stopReplayRecording();
    LiveWpm.hide();
    LiveAcc.hide();
    LiveBurst.hide();
    TimerProgress.hide();
    Replay.pauseReplay();
    TestInput.setBailout(false);
    PaceCaret.reset();
    Monkey.hide();
    if (config_1.default.showAverage)
        Last10Average.update();
    $("#showWordHistoryButton").removeClass("loaded");
    $("#restartTestButton").blur();
    Funbox.resetMemoryTimer();
    QuoteRatePopup.clearQuoteStats();
    if (ActivePage.get() == "test" && window.scrollY > 0) {
        window.scrollTo({ top: 0, behavior: "smooth" });
    }
    $("#wordsInput").val(" ");
    TestUI.reset();
    $("#timerNumber").css("opacity", 0);
    let el = null;
    if (TestUI.resultVisible) {
        //results are being displayed
        el = $("#result");
    }
    else {
        //words are being displayed
        el = $("#typingTest");
    }
    if (TestUI.resultVisible) {
        if (config_1.default.randomTheme !== "off" &&
            !PageTransition.get()
        // && Config.customThemeId === ""
        ) {
            ThemeController.randomizeTheme();
        }
    }
    TestUI.setResultVisible(false);
    PageTransition.set(true);
    TestUI.setTestRestarting(true);
    el.stop(true, true).animate({
        opacity: 0,
    }, noAnim ? 0 : 125, () => __awaiter(this, void 0, void 0, function* () {
        if (ActivePage.get() == "test")
            Focus.set(false);
        TestUI.focusWords();
        $("#monkey .fast").stop(true, true).css("opacity", 0);
        $("#monkey").stop(true, true).css({ animationDuration: "0s" });
        $("#typingTest").css("opacity", 0).removeClass("hidden");
        $("#wordsInput").val(" ");
        let shouldQuoteRepeat = false;
        if (config_1.default.mode === "quote" &&
            config_1.default.repeatQuotes === "typing" &&
            failReason !== "") {
            shouldQuoteRepeat = true;
        }
        yield Funbox.rememberSettings();
        if (config_1.default.funbox === "arrows") {
            UpdateConfig.setPunctuation(false, true);
            UpdateConfig.setNumbers(false, true);
        }
        else if (config_1.default.funbox === "58008") {
            UpdateConfig.setNumbers(false, true);
        }
        else if (config_1.default.funbox === "specials") {
            UpdateConfig.setPunctuation(false, true);
            UpdateConfig.setNumbers(false, true);
        }
        else if (config_1.default.funbox === "ascii") {
            UpdateConfig.setPunctuation(false, true);
            UpdateConfig.setNumbers(false, true);
        }
        if (withSameWordset &&
            (config_1.default.funbox === "plus_one" || config_1.default.funbox === "plus_two")) {
            Notifications.add("Sorry, this funbox won't work with repeated tests.", 0, 4);
            withSameWordset = false;
        }
        if (!withSameWordset && !shouldQuoteRepeat) {
            TestState.setRepeated(false);
            TestState.setPaceRepeat(repeatWithPace);
            TestWords.setHasTab(false);
            yield init();
            yield PaceCaret.init();
        }
        else {
            TestState.setRepeated(true);
            TestState.setPaceRepeat(repeatWithPace);
            TestActive.set(false);
            Replay.stopReplayRecording();
            TestWords.words.resetCurrentIndex();
            TestInput.input.reset();
            TestUI.showWords();
            if (config_1.default.keymapMode === "next" && config_1.default.mode !== "zen") {
                Keymap.highlightKey(TestWords.words
                    .getCurrent()
                    .substring(TestInput.input.current.length, TestInput.input.current.length + 1)
                    .toString()
                    .toUpperCase());
            }
            Funbox.toggleScript(TestWords.words.getCurrent());
            yield PaceCaret.init();
        }
        failReason = "";
        if (config_1.default.mode === "quote") {
            TestState.setRepeated(false);
        }
        if (config_1.default.keymapMode !== "off") {
            Keymap.show();
        }
        else {
            Keymap.hide();
        }
        (document.querySelector("#miniTimerAndLiveWpm .wpm")).innerHTML = "0";
        (document.querySelector("#miniTimerAndLiveWpm .acc")).innerHTML = "100%";
        (document.querySelector("#miniTimerAndLiveWpm .burst")).innerHTML = "0";
        document.querySelector("#liveWpm").innerHTML = "0";
        document.querySelector("#liveAcc").innerHTML = "100%";
        document.querySelector("#liveBurst").innerHTML = "0";
        if (config_1.default.funbox === "memory") {
            Funbox.startMemoryTimer();
            if (config_1.default.keymapMode === "next") {
                UpdateConfig.setKeymapMode("react");
            }
        }
        const mode2 = Misc.getMode2(config_1.default, TestWords.randomQuote);
        let fbtext = "";
        if (config_1.default.funbox !== "none") {
            fbtext = " " + config_1.default.funbox;
        }
        $(".pageTest #premidTestMode").text(`${config_1.default.mode} ${mode2} ${config_1.default.language.replace(/_/g, " ")}${fbtext}`);
        $(".pageTest #premidSecondsLeft").text(config_1.default.time);
        if (config_1.default.funbox === "layoutfluid") {
            UpdateConfig.setLayout(config_1.default.customLayoutfluid
                ? config_1.default.customLayoutfluid.split("#")[0]
                : "qwerty", true);
            UpdateConfig.setKeymapLayout(config_1.default.customLayoutfluid
                ? config_1.default.customLayoutfluid.split("#")[0]
                : "qwerty", true);
            Keymap.highlightKey(TestWords.words
                .getCurrent()
                .substring(TestInput.input.current.length, TestInput.input.current.length + 1)
                .toString()
                .toUpperCase());
        }
        $("#result").addClass("hidden");
        $("#testModesNotice").removeClass("hidden").css({
            opacity: 1,
        });
        // resetPaceCaret();
        ModesNotice.update();
        $("#typingTest")
            .css("opacity", 0)
            .removeClass("hidden")
            .stop(true, true)
            .animate({
            opacity: 1,
        }, noAnim ? 0 : 125, () => {
            TestUI.setTestRestarting(false);
            // resetPaceCaret();
            PbCrown.hide();
            TestTimer.clear();
            if ($("#commandLineWrapper").hasClass("hidden")) {
                TestUI.focusWords();
            }
            // ChartController.result.update();
            PageTransition.set(false);
            // console.log(TestStats.incompleteSeconds);
            // console.log(TestStats.restartCount);
        });
    }));
}
exports.restart = restart;
function applyFunboxesToWord(word, wordset) {
    var _a;
    if (config_1.default.funbox === "rAnDoMcAsE") {
        let randomcaseword = "";
        for (let i = 0; i < word.length; i++) {
            if (i % 2 != 0) {
                randomcaseword += word[i].toUpperCase();
            }
            else {
                randomcaseword += word[i];
            }
        }
        word = randomcaseword;
    }
    else if (config_1.default.funbox === "capitals") {
        word = Misc.capitalizeFirstLetterOfEachWord(word);
    }
    else if (config_1.default.funbox === "gibberish") {
        word = Misc.getGibberish();
    }
    else if (config_1.default.funbox === "arrows") {
        word = Misc.getArrows();
    }
    else if (config_1.default.funbox === "58008") {
        word = Misc.getNumbers(7);
    }
    else if (config_1.default.funbox === "specials") {
        word = Misc.getSpecials();
    }
    else if (config_1.default.funbox === "ascii") {
        word = Misc.getASCII();
    }
    else if (wordset !== undefined && config_1.default.funbox === "weakspot") {
        word = WeakSpot.getWord(wordset);
    }
    else if (wordset !== undefined && config_1.default.funbox === "tbdmode") {
        word = ((_a = (0, tbd_mode_1.getTbdMode)()) === null || _a === void 0 ? void 0 : _a.getWord(wordset)) || word;
    }
    return word;
}
function applyBritishEnglishToWord(word) {
    return __awaiter(this, void 0, void 0, function* () {
        if (config_1.default.britishEnglish && /english/.test(config_1.default.language)) {
            word = yield BritishEnglish.replace(word);
        }
        return word;
    });
}
function applyLazyModeToWord(word, language) {
    if (config_1.default.lazyMode === true && !language.noLazyMode) {
        word = LazyMode.replaceAccents(word, language.accents);
    }
    return word;
}
function getNextWord(wordset, language, wordsBound) {
    var _a, _b;
    return __awaiter(this, void 0, void 0, function* () {
        let randomWord = wordset.randomWord();
        const previousWord = TestWords.words.get(TestWords.words.length - 1, true);
        const previousWord2 = TestWords.words.get(TestWords.words.length - 2, true);
        if (config_1.default.mode === "quote") {
            randomWord =
                (_b = (_a = TestWords.randomQuote.textSplit) === null || _a === void 0 ? void 0 : _a[TestWords.words.length]) !== null && _b !== void 0 ? _b : "";
        }
        else if (config_1.default.mode == "custom" &&
            !CustomText.isWordRandom &&
            !CustomText.isTimeRandom) {
            randomWord = CustomText.text[TestWords.words.length];
        }
        else if (config_1.default.mode == "custom" &&
            (CustomText.isWordRandom || CustomText.isTimeRandom) &&
            (wordset.length < 4 || PractiseWords.before.mode !== null)) {
            randomWord = wordset.randomWord();
        }
        else {
            let regenarationCount = 0; //infinite loop emergency stop button
            while (regenarationCount < 100 &&
                (previousWord == randomWord ||
                    previousWord2 == randomWord ||
                    (!config_1.default.punctuation && randomWord == "I"))) {
                regenarationCount++;
                randomWord = wordset.randomWord();
            }
        }
        if (randomWord === undefined) {
            randomWord = wordset.randomWord();
        }
        randomWord = randomWord.replace(/ +/gm, " ");
        randomWord = randomWord.replace(/^ | $/gm, "");
        randomWord = applyLazyModeToWord(randomWord, language);
        randomWord = yield applyBritishEnglishToWord(randomWord);
        randomWord = applyFunboxesToWord(randomWord, wordset);
        if (config_1.default.punctuation) {
            randomWord = punctuateWord(TestWords.words.get(TestWords.words.length - 1), randomWord, TestWords.words.length, wordsBound);
        }
        if (config_1.default.numbers) {
            if (Math.random() < 0.1) {
                randomWord = Misc.getNumbers(4);
            }
        }
        return randomWord;
    });
}
let rememberLazyMode;
function init() {
    return __awaiter(this, void 0, void 0, function* () {
        TestActive.set(false);
        MonkeyPower.reset();
        Replay.stopReplayRecording();
        TestWords.words.reset();
        TestUI.setCurrentWordElementIndex(0);
        // accuracy = {
        //   correct: 0,
        //   incorrect: 0,
        // };
        TestInput.input.resetHistory();
        TestInput.input.resetCurrent();
        if (ActivePage.get() == "test") {
            yield Funbox.activate();
        }
        let language = yield Misc.getLanguage(config_1.default.language);
        if (language && language.name !== config_1.default.language) {
            UpdateConfig.setLanguage("english");
        }
        if (!language) {
            UpdateConfig.setLanguage("english");
            language = yield Misc.getLanguage(config_1.default.language);
        }
        if (config_1.default.lazyMode === true && language.noLazyMode) {
            rememberLazyMode = true;
            Notifications.add("This language does not support lazy mode.", 0);
            UpdateConfig.setLazyMode(false, true);
        }
        else if (rememberLazyMode === true && !language.noLazyMode) {
            UpdateConfig.setLazyMode(true, true);
        }
        if (config_1.default.lazyMode === false && !language.noLazyMode) {
            rememberLazyMode = false;
        }
        let wordsBound = 100;
        if (config_1.default.showAllLines) {
            if (config_1.default.mode === "quote") {
                wordsBound = 100;
            }
            else if (config_1.default.mode === "custom") {
                if (CustomText.isWordRandom) {
                    wordsBound = CustomText.word;
                }
                else if (CustomText.isTimeRandom) {
                    wordsBound = 100;
                }
                else {
                    wordsBound = CustomText.text.length;
                }
            }
            else if (config_1.default.mode != "time") {
                wordsBound = config_1.default.words;
            }
        }
        else {
            if (config_1.default.mode === "words" && config_1.default.words < wordsBound) {
                wordsBound = config_1.default.words;
            }
            if (config_1.default.mode == "custom" &&
                CustomText.isWordRandom &&
                CustomText.word < wordsBound) {
                wordsBound = CustomText.word;
            }
            if (config_1.default.mode == "custom" && CustomText.isTimeRandom) {
                wordsBound = 100;
            }
            if (config_1.default.mode == "custom" &&
                !CustomText.isWordRandom &&
                !CustomText.isTimeRandom &&
                CustomText.text.length < wordsBound) {
                wordsBound = CustomText.text.length;
            }
        }
        if ((config_1.default.mode === "custom" &&
            CustomText.isWordRandom &&
            CustomText.word == 0) ||
            (config_1.default.mode === "custom" &&
                CustomText.isTimeRandom &&
                CustomText.time == 0)) {
            wordsBound = 100;
        }
        if (config_1.default.mode === "words" && config_1.default.words === 0) {
            wordsBound = 100;
        }
        if (config_1.default.funbox === "plus_one") {
            wordsBound = 2;
            if (config_1.default.mode === "words" && config_1.default.words < wordsBound) {
                wordsBound = config_1.default.words;
            }
        }
        if (config_1.default.funbox === "plus_two") {
            wordsBound = 3;
            if (config_1.default.mode === "words" && config_1.default.words < wordsBound) {
                wordsBound = config_1.default.words;
            }
        }
        if (config_1.default.mode == "time" ||
            config_1.default.mode == "words" ||
            config_1.default.mode == "custom") {
            let wordList = language.words;
            if (config_1.default.mode == "custom") {
                wordList = CustomText.text;
            }
            const wordset = Wordset.withWords(wordList, config_1.default.funbox);
            if ((config_1.default.funbox == "wikipedia" || config_1.default.funbox == "poetry") &&
                config_1.default.mode != "custom") {
                let wordCount = 0;
                // If mode is words, get as many sections as you need until the wordCount is fullfilled
                while ((config_1.default.mode == "words" && config_1.default.words >= wordCount) ||
                    (config_1.default.mode === "time" && wordCount < 100)) {
                    const section = config_1.default.funbox == "wikipedia"
                        ? yield Wikipedia.getSection(config_1.default.language)
                        : yield Poetry.getPoem();
                    if (section === undefined)
                        continue;
                    for (const word of section.words) {
                        if (wordCount >= config_1.default.words && config_1.default.mode == "words") {
                            wordCount++;
                            break;
                        }
                        wordCount++;
                        TestWords.words.push(word);
                    }
                }
            }
            else {
                for (let i = 0; i < wordsBound; i++) {
                    const randomWord = yield getNextWord(wordset, language, wordsBound);
                    if (/\t/g.test(randomWord)) {
                        TestWords.setHasTab(true);
                    }
                    if (/ +/.test(randomWord)) {
                        const randomList = randomWord.split(" ");
                        let id = 0;
                        while (id < randomList.length) {
                            TestWords.words.push(randomList[id]);
                            id++;
                            if (TestWords.words.length == wordsBound &&
                                config_1.default.mode == "custom" &&
                                CustomText.isWordRandom) {
                                break;
                            }
                        }
                        if (config_1.default.mode == "custom" &&
                            !CustomText.isWordRandom &&
                            !CustomText.isTimeRandom) {
                            //
                        }
                        else {
                            i = TestWords.words.length - 1;
                        }
                    }
                    else {
                        TestWords.words.push(randomWord);
                    }
                }
            }
        }
        else if (config_1.default.mode === "quote") {
            const quotesCollection = yield quotes_controller_1.default.getQuotes(config_1.default.language, config_1.default.quoteLength);
            if (quotesCollection.length === 0) {
                TestUI.setTestRestarting(false);
                Notifications.add(`No ${config_1.default.language.replace(/_\d*k$/g, "")} quotes found`, 0);
                if (firebase_1.Auth.currentUser) {
                    QuoteSubmitPopup.show(false);
                }
                UpdateConfig.setMode("words");
                restart();
                return;
            }
            let rq = undefined;
            if (config_1.default.quoteLength.includes(-2) && config_1.default.quoteLength.length == 1) {
                const targetQuote = quotes_controller_1.default.getQuoteById(QuoteSearchPopup.selectedId);
                if (targetQuote === undefined) {
                    rq = quotesCollection.groups[0][0];
                    Notifications.add("Quote Id Does Not Exist", 0);
                }
                else {
                    rq = targetQuote;
                }
            }
            else {
                const randomQuote = quotes_controller_1.default.getRandomQuote();
                if (randomQuote === null) {
                    Notifications.add("No quotes found for selected quote length", 0);
                    TestUI.setTestRestarting(false);
                    return;
                }
                rq = randomQuote;
            }
            if (rq === undefined)
                return;
            rq.text = rq.text.replace(/ +/gm, " ");
            rq.text = rq.text.replace(/\\\\t/gm, "\t");
            rq.text = rq.text.replace(/\\\\n/gm, "\n");
            rq.text = rq.text.replace(/\\t/gm, "\t");
            rq.text = rq.text.replace(/\\n/gm, "\n");
            rq.text = rq.text.replace(/( *(\r\n|\r|\n) *)/g, "\n ");
            rq.text = rq.text.replace(//g, "...");
            rq.text = rq.text.trim();
            rq.textSplit = rq.text.split(" ");
            rq.language = config_1.default.language.replace(/_\d*k$/g, "");
            TestWords.setRandomQuote(rq);
            const w = TestWords.randomQuote.textSplit;
            if (w === undefined)
                return;
            if (config_1.default.showAllLines) {
                wordsBound = w.length;
            }
            else {
                wordsBound = Math.min(wordsBound, w.length);
            }
            for (let i = 0; i < wordsBound; i++) {
                if (/\t/g.test(w[i])) {
                    TestWords.setHasTab(true);
                }
                w[i] = applyLazyModeToWord(w[i], language);
                w[i] = yield applyBritishEnglishToWord(w[i]);
                w[i] = applyFunboxesToWord(w[i]);
                TestWords.words.push(w[i]);
            }
        }
        //handle right-to-left languages
        if (language.leftToRight) {
            TestUI.arrangeCharactersLeftToRight();
        }
        else {
            TestUI.arrangeCharactersRightToLeft();
        }
        if (language.ligatures) {
            $("#words").addClass("withLigatures");
            $("#resultWordsHistory .words").addClass("withLigatures");
            $("#resultReplay .words").addClass("withLigatures");
        }
        else {
            $("#words").removeClass("withLigatures");
            $("#resultWordsHistory .words").removeClass("withLigatures");
            $("#resultReplay .words").removeClass("withLigatures");
        }
        // if (Config.mode == "zen") {
        //   // Creating an empty active word element for zen mode
        //   $("#words").append('<div class="word active"></div>');
        //   $("#words").css("height", "auto");
        //   $("#wordsWrapper").css("height", "auto");
        // } else {
        TestUI.showWords();
        if (config_1.default.keymapMode === "next" && config_1.default.mode !== "zen") {
            Keymap.highlightKey(TestWords.words
                .getCurrent()
                .substring(TestInput.input.current.length, TestInput.input.current.length + 1)
                .toString()
                .toUpperCase());
        }
        Funbox.toggleScript(TestWords.words.getCurrent());
        // }
    });
}
exports.init = init;
function addWord() {
    var _a, _b;
    return __awaiter(this, void 0, void 0, function* () {
        let bound = 100;
        if (config_1.default.funbox === "plus_one")
            bound = 1;
        if (config_1.default.funbox === "plus_two")
            bound = 2;
        if (TestWords.words.length - TestInput.input.history.length > bound ||
            (config_1.default.mode === "words" &&
                TestWords.words.length >= config_1.default.words &&
                config_1.default.words > 0) ||
            (config_1.default.mode === "custom" &&
                CustomText.isWordRandom &&
                TestWords.words.length >= CustomText.word &&
                CustomText.word != 0) ||
            (config_1.default.mode === "custom" &&
                !CustomText.isWordRandom &&
                !CustomText.isTimeRandom &&
                TestWords.words.length >= CustomText.text.length) ||
            (config_1.default.mode === "quote" &&
                TestWords.words.length >= ((_b = (_a = TestWords.randomQuote.textSplit) === null || _a === void 0 ? void 0 : _a.length) !== null && _b !== void 0 ? _b : 0))) {
            return;
        }
        if (config_1.default.funbox === "wikipedia" || config_1.default.funbox == "poetry") {
            if (TestWords.words.length - TestWords.words.currentIndex < 20) {
                const section = config_1.default.funbox == "wikipedia"
                    ? yield Wikipedia.getSection(config_1.default.language)
                    : yield Poetry.getPoem();
                if (section === undefined)
                    return;
                let wordCount = 0;
                for (const word of section.words) {
                    if (wordCount >= config_1.default.words && config_1.default.mode == "words") {
                        break;
                    }
                    wordCount++;
                    TestWords.words.push(word);
                    TestUI.addWord(word);
                }
            }
            else {
                return;
            }
        }
        const language = config_1.default.mode !== "custom"
            ? yield Misc.getCurrentLanguage(config_1.default.language)
            : Object.assign(Object.assign({}, (yield Misc.getCurrentLanguage(config_1.default.language))), { words: CustomText.text });
        const wordset = Wordset.withWords(language.words, config_1.default.funbox);
        const randomWord = yield getNextWord(wordset, language, bound);
        const split = randomWord.split(" ");
        if (split.length > 1) {
            split.forEach((word) => {
                TestWords.words.push(word);
                TestUI.addWord(word);
            });
        }
        else {
            TestWords.words.push(randomWord);
            TestUI.addWord(randomWord);
        }
    });
}
exports.addWord = addWord;
const retrySaving = {
    completedEvent: null,
    canRetry: false,
};
function retrySavingResult() {
    return __awaiter(this, void 0, void 0, function* () {
        const { completedEvent } = retrySaving;
        if (completedEvent === null) {
            Notifications.add("Could not retry saving the result as the result no longer exists.", 0, -1);
            return;
        }
        if (!retrySaving.canRetry) {
            return;
        }
        retrySaving.canRetry = false;
        $("#retrySavingResultButton").addClass("hidden");
        AccountButton.loading(true);
        Notifications.add("Retrying to save...");
        const response = yield ape_1.default.results.save(completedEvent);
        AccountButton.loading(false);
        Result.hideCrown();
        if (response.status !== 200) {
            retrySaving.canRetry = true;
            $("#retrySavingResultButton").removeClass("hidden");
            return Notifications.add("Result not saved. " + response.message, -1);
        }
        completedEvent._id = response.data.insertedId;
        if (response.data.isPb) {
            completedEvent.isPb = true;
        }
        DB.saveLocalResult(completedEvent);
        DB.updateLocalStats({
            time: completedEvent.testDuration +
                completedEvent.incompleteTestSeconds -
                completedEvent.afkDuration,
            started: TestStats.restartCount + 1,
        });
        AnalyticsController.log("testCompleted");
        if (response.data.isPb) {
            //new pb
            Result.showCrown();
            Result.updateCrown();
            DB.saveLocalPB(config_1.default.mode, completedEvent.mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode, completedEvent.wpm, completedEvent.acc, completedEvent.rawWpm, completedEvent.consistency);
        }
        $("#retrySavingResultButton").addClass("hidden");
        Notifications.add("Result saved", 1);
    });
}
exports.retrySavingResult = retrySavingResult;
function buildCompletedEvent(difficultyFailed) {
    var _a, _b, _c;
    //build completed event object
    const completedEvent = {
        wpm: undefined,
        rawWpm: undefined,
        charStats: undefined,
        acc: undefined,
        mode: config_1.default.mode,
        mode2: undefined,
        quoteLength: -1,
        punctuation: config_1.default.punctuation,
        numbers: config_1.default.numbers,
        lazyMode: config_1.default.lazyMode,
        timestamp: Date.now(),
        language: config_1.default.language,
        restartCount: TestStats.restartCount,
        incompleteTestSeconds: TestStats.incompleteSeconds < 0
            ? 0
            : Misc.roundTo2(TestStats.incompleteSeconds),
        difficulty: config_1.default.difficulty,
        blindMode: config_1.default.blindMode,
        tags: undefined,
        keySpacing: TestInput.keypressTimings.spacing.array,
        keyDuration: TestInput.keypressTimings.duration.array,
        consistency: undefined,
        keyConsistency: undefined,
        funbox: config_1.default.funbox,
        bailedOut: TestInput.bailout,
        chartData: {
            wpm: TestInput.wpmHistory,
            raw: undefined,
            err: undefined,
        },
        customText: undefined,
        testDuration: undefined,
        afkDuration: undefined,
    };
    // stats
    const stats = TestStats.calculateStats();
    if (stats.time % 1 != 0 && config_1.default.mode !== "time") {
        TestStats.setLastSecondNotRound();
    }
    TestStats.setLastTestWpm(stats.wpm);
    completedEvent.wpm = stats.wpm;
    completedEvent.rawWpm = stats.wpmRaw;
    completedEvent.charStats = [
        stats.correctChars + stats.correctSpaces,
        stats.incorrectChars,
        stats.extraChars,
        stats.missedChars,
    ];
    completedEvent.acc = stats.acc;
    // if the last second was not rounded, add another data point to the history
    if (TestStats.lastSecondNotRound && !difficultyFailed) {
        const wpmAndRaw = TestStats.calculateWpmAndRaw();
        TestInput.pushToWpmHistory(wpmAndRaw.wpm);
        TestInput.pushToRawHistory(wpmAndRaw.raw);
        TestInput.pushKeypressesToHistory();
    }
    //consistency
    const rawPerSecond = TestInput.keypressPerSecond.map((f) => Math.round((f.count / 5) * 60));
    const stddev = Misc.stdDev(rawPerSecond);
    const avg = Misc.mean(rawPerSecond);
    let consistency = Misc.roundTo2(Misc.kogasa(stddev / avg));
    let keyConsistencyArray = TestInput.keypressTimings.spacing.array === "toolong"
        ? []
        : TestInput.keypressTimings.spacing.array.slice();
    if (keyConsistencyArray.length > 0) {
        keyConsistencyArray = keyConsistencyArray.slice(0, keyConsistencyArray.length - 1);
    }
    let keyConsistency = Misc.roundTo2(Misc.kogasa(Misc.stdDev(keyConsistencyArray) / Misc.mean(keyConsistencyArray)));
    if (!consistency || isNaN(consistency)) {
        consistency = 0;
    }
    if (!keyConsistency || isNaN(keyConsistency)) {
        keyConsistency = 0;
    }
    completedEvent.keyConsistency = keyConsistency;
    completedEvent.consistency = consistency;
    const smoothedraw = Misc.smooth(rawPerSecond, 1);
    completedEvent.chartData.raw = smoothedraw;
    completedEvent.chartData.unsmoothedRaw = rawPerSecond;
    //smoothed consistency
    const stddev2 = Misc.stdDev(smoothedraw);
    const avg2 = Misc.mean(smoothedraw);
    const smoothConsistency = Misc.roundTo2(Misc.kogasa(stddev2 / avg2));
    completedEvent.smoothConsistency = smoothConsistency;
    //wpm consistency
    const stddev3 = Misc.stdDev((_a = completedEvent.chartData.wpm) !== null && _a !== void 0 ? _a : []);
    const avg3 = Misc.mean((_b = completedEvent.chartData.wpm) !== null && _b !== void 0 ? _b : []);
    const wpmConsistency = Misc.roundTo2(Misc.kogasa(stddev3 / avg3));
    completedEvent.wpmConsistency = wpmConsistency;
    completedEvent.testDuration = parseFloat(stats.time.toString());
    completedEvent.afkDuration = TestStats.calculateAfkSeconds(completedEvent.testDuration);
    completedEvent.chartData.err = [];
    for (let i = 0; i < TestInput.keypressPerSecond.length; i++) {
        completedEvent.chartData.err.push(TestInput.keypressPerSecond[i].errors);
    }
    if (config_1.default.mode === "quote") {
        completedEvent.quoteLength = TestWords.randomQuote.group;
        completedEvent.lang = config_1.default.language.replace(/_\d*k$/g, "");
    }
    // @ts-ignore TODO fix this
    completedEvent.mode2 = Misc.getMode2(config_1.default, TestWords.randomQuote);
    if (config_1.default.mode === "custom") {
        completedEvent.customText = {};
        completedEvent.customText.textLen = CustomText.text.length;
        completedEvent.customText.isWordRandom = CustomText.isWordRandom;
        completedEvent.customText.isTimeRandom = CustomText.isTimeRandom;
        completedEvent.customText.word = CustomText.word;
        completedEvent.customText.time = CustomText.time;
    }
    else {
        delete completedEvent.customText;
    }
    //tags
    const activeTagsIds = [];
    try {
        (_c = DB.getSnapshot().tags) === null || _c === void 0 ? void 0 : _c.forEach((tag) => {
            if (tag.active === true) {
                activeTagsIds.push(tag._id);
            }
        });
    }
    catch (e) { }
    completedEvent.tags = activeTagsIds;
    if (completedEvent.mode != "custom")
        delete completedEvent.customText;
    return completedEvent;
}
function finish(difficultyFailed = false) {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        if (!TestActive.get())
            return;
        if (config_1.default.mode == "zen" && TestInput.input.current.length != 0) {
            TestInput.input.pushHistory();
            TestInput.corrected.pushHistory();
            Replay.replayGetWordsList(TestInput.input.history);
        }
        TestInput.recordKeypressSpacing(); //this is needed in case there is afk time at the end - to make sure test duration makes sense
        TestUI.setResultCalculating(true);
        TestUI.setResultVisible(true);
        TestStats.setEnd(performance.now());
        TestActive.set(false);
        Replay.stopReplayRecording();
        Focus.set(false);
        Caret.hide();
        LiveWpm.hide();
        PbCrown.hide();
        LiveAcc.hide();
        LiveBurst.hide();
        TimerProgress.hide();
        OutOfFocus.hide();
        TestTimer.clear();
        Funbox.clear();
        Monkey.hide();
        //need one more calculation for the last word if test auto ended
        if (TestInput.burstHistory.length !== TestInput.input.getHistory().length) {
            const burst = TestStats.calculateBurst();
            TestInput.pushBurstToHistory(burst);
        }
        //remove afk from zen
        if (config_1.default.mode == "zen" || TestInput.bailout) {
            TestStats.removeAfkData();
        }
        const completedEvent = buildCompletedEvent(difficultyFailed);
        //todo check if any fields are undefined
        ///////// completed event ready
        //afk check
        const kps = TestInput.keypressPerSecond.slice(-5);
        let afkDetected = kps.every((second) => second.afk);
        if (TestInput.bailout)
            afkDetected = false;
        let tooShort = false;
        let dontSave = false;
        //fail checks
        if (difficultyFailed) {
            Notifications.add(`Test failed - ${failReason}`, 0, 1);
            dontSave = true;
        }
        else if (afkDetected) {
            Notifications.add("Test invalid - AFK detected", 0);
            dontSave = true;
        }
        else if (TestState.isRepeated) {
            Notifications.add("Test invalid - repeated", 0);
            dontSave = true;
        }
        else if ((config_1.default.mode === "time" &&
            completedEvent.mode2 < 15 &&
            completedEvent.mode2 > 0) ||
            (config_1.default.mode === "time" &&
                completedEvent.mode2 == 0 &&
                completedEvent.testDuration < 15) ||
            (config_1.default.mode === "words" &&
                completedEvent.mode2 < 10 &&
                completedEvent.mode2 > 0) ||
            (config_1.default.mode === "words" &&
                completedEvent.mode2 == 0 &&
                completedEvent.testDuration < 15) ||
            (config_1.default.mode === "custom" &&
                !CustomText.isWordRandom &&
                !CustomText.isTimeRandom &&
                CustomText.text.length < 10) ||
            (config_1.default.mode === "custom" &&
                CustomText.isWordRandom &&
                !CustomText.isTimeRandom &&
                CustomText.word < 10) ||
            (config_1.default.mode === "custom" &&
                !CustomText.isWordRandom &&
                CustomText.isTimeRandom &&
                CustomText.time < 15) ||
            (config_1.default.mode === "zen" && completedEvent.testDuration < 15)) {
            Notifications.add("Test invalid - too short", 0);
            tooShort = true;
            dontSave = true;
        }
        else if (completedEvent.wpm < 0 || completedEvent.wpm > 350) {
            Notifications.add("Test invalid - wpm", 0);
            TestStats.setInvalid();
            dontSave = true;
        }
        else if (completedEvent.acc < 75 || completedEvent.acc > 100) {
            Notifications.add("Test invalid - accuracy", 0);
            TestStats.setInvalid();
            dontSave = true;
        }
        // test is valid
        if (!dontSave) {
            TodayTracker.addSeconds(completedEvent.testDuration +
                (TestStats.incompleteSeconds < 0
                    ? 0
                    : Misc.roundTo2(TestStats.incompleteSeconds)) -
                completedEvent.afkDuration);
            Result.updateTodayTracker();
        }
        if (firebase_1.Auth.currentUser == null) {
            $(".pageTest #result #rateQuoteButton").addClass("hidden");
            $(".pageTest #result #reportQuoteButton").addClass("hidden");
            AnalyticsController.log("testCompletedNoLogin");
            if (!dontSave)
                exports.notSignedInLastResult = completedEvent;
            dontSave = true;
        }
        else {
            $(".pageTest #result #reportQuoteButton").removeClass("hidden");
        }
        yield Result.update(completedEvent, difficultyFailed, failReason, afkDetected, TestState.isRepeated, tooShort, TestWords.randomQuote, dontSave);
        if (completedEvent.chartData !== "toolong") {
            delete completedEvent.chartData.unsmoothedRaw;
        }
        if (completedEvent.testDuration > 122) {
            completedEvent.chartData = "toolong";
            completedEvent.keySpacing = "toolong";
            completedEvent.keyDuration = "toolong";
            TestInput.setKeypressTimingsTooLong();
        }
        if (dontSave) {
            AnalyticsController.log("testCompletedInvalid");
            return;
        }
        // user is logged in
        if (config_1.default.difficulty == "normal" ||
            ((config_1.default.difficulty == "master" || config_1.default.difficulty == "expert") &&
                !difficultyFailed)) {
            TestStats.resetIncomplete();
        }
        completedEvent.uid = (_a = firebase_1.Auth.currentUser) === null || _a === void 0 ? void 0 : _a.uid;
        Result.updateRateQuote(TestWords.randomQuote);
        AccountButton.loading(true);
        completedEvent.challenge = ChallengeContoller.verify(completedEvent);
        if (completedEvent.challenge === null)
            completedEvent === null || completedEvent === void 0 ? true : delete completedEvent.challenge;
        completedEvent.hash = (0, object_hash_1.default)(completedEvent);
        const response = yield ape_1.default.results.save(completedEvent);
        AccountButton.loading(false);
        if (response.status !== 200) {
            console.log("Error saving result", completedEvent);
            $("#retrySavingResultButton").removeClass("hidden");
            if (response.message === "Incorrect result hash") {
                console.log(completedEvent);
            }
            retrySaving.completedEvent = completedEvent;
            retrySaving.canRetry = true;
            return Notifications.add("Failed to save result: " + response.message, -1);
        }
        Result.hideCrown();
        completedEvent._id = response.data.insertedId;
        if (response.data.isPb) {
            completedEvent.isPb = true;
        }
        DB.saveLocalResult(completedEvent);
        DB.updateLocalStats({
            time: completedEvent.testDuration +
                completedEvent.incompleteTestSeconds -
                completedEvent.afkDuration,
            started: TestStats.restartCount + 1,
        });
        AnalyticsController.log("testCompleted");
        if (response.data.isPb) {
            //new pb
            Result.showCrown();
            Result.updateCrown();
            DB.saveLocalPB(config_1.default.mode, completedEvent.mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode, completedEvent.wpm, completedEvent.acc, completedEvent.rawWpm, completedEvent.consistency);
        }
        $("#retrySavingResultButton").addClass("hidden");
    });
}
exports.finish = finish;
function fail(reason) {
    failReason = reason;
    // input.pushHistory();
    // corrected.pushHistory();
    TestInput.pushKeypressesToHistory();
    finish(true);
    const testSeconds = TestStats.calculateTestSeconds(performance.now());
    const afkseconds = TestStats.calculateAfkSeconds(testSeconds);
    let tt = testSeconds - afkseconds;
    if (tt < 0)
        tt = 0;
    TestStats.incrementIncompleteSeconds(tt);
    TestStats.incrementRestartCount();
}
exports.fail = fail;
$(document).on("click", "#testModesNotice .text-button.restart", () => {
    restart();
});
$(document).on("keypress", "#restartTestButton", (event) => {
    if (event.key === "Enter") {
        ManualRestart.reset();
        if (TestActive.get() &&
            config_1.default.repeatQuotes === "typing" &&
            config_1.default.mode === "quote") {
            restart(true);
        }
        else {
            restart();
        }
    }
});
$(document.body).on("click", "#restartTestButton", () => {
    ManualRestart.set();
    if (TestUI.resultCalculating)
        return;
    if (TestActive.get() &&
        config_1.default.repeatQuotes === "typing" &&
        config_1.default.mode === "quote") {
        restart(true);
    }
    else {
        restart();
    }
});
$(document.body).on("click", "#retrySavingResultButton", retrySavingResult);
$(document).on("keypress", "#nextTestButton", (event) => {
    if (event.key === "Enter") {
        restart();
    }
});
$(document.body).on("click", "#nextTestButton", () => {
    ManualRestart.set();
    restart();
});
$(document.body).on("click", "#restartTestButtonWithSameWordset", () => {
    if (config_1.default.mode == "zen") {
        Notifications.add("Repeat test disabled in zen mode");
        return;
    }
    ManualRestart.set();
    restart(true);
});
$(document).on("keypress", "#restartTestButtonWithSameWordset", (event) => {
    if (config_1.default.mode == "zen") {
        Notifications.add("Repeat test disabled in zen mode");
        return;
    }
    if (event.key === "Enter") {
        restart(true);
    }
});
$(document).on("click", "#top .config .wordCount .text-button", (e) => {
    var _a;
    const wrd = (_a = $(e.currentTarget).attr("wordCount")) !== null && _a !== void 0 ? _a : "15";
    if (wrd != "custom") {
        UpdateConfig.setWordCount(parseInt(wrd));
        ManualRestart.set();
        restart();
    }
});
$(document).on("click", "#top .config .time .text-button", (e) => {
    var _a;
    const mode = (_a = $(e.currentTarget).attr("timeConfig")) !== null && _a !== void 0 ? _a : "10";
    if (mode != "custom") {
        UpdateConfig.setTimeConfig(parseInt(mode));
        ManualRestart.set();
        restart();
    }
});
$(document).on("click", "#top .config .quoteLength .text-button", (e) => {
    var _a;
    let len = parseInt((_a = $(e.currentTarget).attr("quoteLength")) !== null && _a !== void 0 ? _a : "1");
    if (len != -2) {
        if (len == -1) {
            len = [0, 1, 2, 3];
        }
        UpdateConfig.setQuoteLength(len, false, e.shiftKey);
        ManualRestart.set();
        restart();
    }
});
$(document).on("click", "#top .config .punctuationMode .text-button", () => {
    UpdateConfig.setPunctuation(!config_1.default.punctuation);
    ManualRestart.set();
    restart();
});
$(document).on("click", "#top .config .numbersMode .text-button", () => {
    UpdateConfig.setNumbers(!config_1.default.numbers);
    ManualRestart.set();
    restart();
});
$(document).on("click", "#top .config .mode .text-button", (e) => {
    var _a;
    if ($(e.currentTarget).hasClass("active"))
        return;
    const mode = ((_a = $(e.currentTarget).attr("mode")) !== null && _a !== void 0 ? _a : "time");
    if (mode === undefined)
        return;
    UpdateConfig.setMode(mode);
    ManualRestart.set();
    restart();
});
$("#practiseWordsPopup .button.missed").on("click", () => {
    PractiseWords.hidePopup();
    PractiseWords.init(true, false);
    restart(false, false, undefined, true);
});
$("#practiseWordsPopup .button.slow").on("click", () => {
    PractiseWords.hidePopup();
    PractiseWords.init(false, true);
    restart(false, false, undefined, true);
});
$("#practiseWordsPopup .button.both").on("click", () => {
    PractiseWords.hidePopup();
    PractiseWords.init(true, true);
    restart(false, false, undefined, true);
});
$(document).on("click", "#quoteSearchPopup #quoteSearchResults .searchResult", (e) => {
    var _a;
    if (e.target.classList.contains("report")) {
        return;
    }
    const sid = parseInt((_a = $(e.currentTarget).attr("id")) !== null && _a !== void 0 ? _a : "");
    QuoteSearchPopup.setSelectedId(sid);
    if (QuoteSearchPopup.apply(sid) === true)
        restart();
});
$(document).on("click", "#top #menu #startTestButton, #top .logo", () => {
    if (ActivePage.get() === "test")
        restart();
});
// ===============================
ConfigEvent.subscribe((eventKey, eventValue, nosave) => {
    if (eventKey === "difficulty" && !nosave)
        restart(false, nosave);
    if (eventKey === "showAllLines" && !nosave)
        restart();
    if (eventKey === "keymapMode" && !nosave)
        restart(false, nosave);
    if (eventKey === "lazyMode" && eventValue === false && !nosave) {
        rememberLazyMode = false;
    }
});
TimerEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "fail" && eventValue !== undefined)
        fail(eventValue);
    if (eventKey === "finish")
        finish();
});
ResetRequestedEvent.subscribe(() => {
    restart();
});


/***/ }),

/***/ "./src/scripts/test/test-state.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-state.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.setActiveChallenge = exports.setPaceRepeat = exports.setRepeated = exports.activeChallenge = exports.isPaceRepeat = exports.isRepeated = void 0;
exports.isRepeated = false;
exports.isPaceRepeat = false;
exports.activeChallenge = null;
function setRepeated(tf) {
    exports.isRepeated = tf;
}
exports.setRepeated = setRepeated;
function setPaceRepeat(tf) {
    exports.isPaceRepeat = tf;
}
exports.setPaceRepeat = setPaceRepeat;
function setActiveChallenge(val) {
    exports.activeChallenge = val;
}
exports.setActiveChallenge = setActiveChallenge;


/***/ }),

/***/ "./src/scripts/test/test-stats.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-stats.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.calculateStats = exports.removeAfkData = exports.calculateAccuracy = exports.calculateBurst = exports.setLastSecondNotRound = exports.calculateAfkSeconds = exports.setStart = exports.setEnd = exports.calculateWpmAndRaw = exports.calculateTestSeconds = exports.setInvalid = exports.resetIncomplete = exports.incrementIncompleteSeconds = exports.incrementRestartCount = exports.incompleteSeconds = exports.restartCount = exports.restart = exports.getStats = exports.setLastTestWpm = exports.lastTestWpm = exports.lastSecondNotRound = exports.end2 = exports.start2 = exports.end = exports.start = exports.invalid = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
exports.invalid = false;
exports.lastSecondNotRound = false;
exports.lastTestWpm = 0;
function setLastTestWpm(wpm) {
    exports.lastTestWpm = wpm;
}
exports.setLastTestWpm = setLastTestWpm;
function getStats() {
    const ret = {
        start: exports.start,
        end: exports.end,
        wpmHistory: TestInput.wpmHistory,
        rawHistory: TestInput.wpmHistory,
        burstHistory: TestInput.burstHistory,
        keypressPerSecond: TestInput.keypressPerSecond,
        currentKeypress: TestInput.currentKeypress,
        lastKeypress: TestInput.lastKeypress,
        currentBurstStart: TestInput.currentBurstStart,
        lastSecondNotRound: exports.lastSecondNotRound,
        missedWords: TestInput.missedWords,
        accuracy: TestInput.accuracy,
        keypressTimings: TestInput.keypressTimings,
    };
    try {
        ret.keySpacingStats = {
            average: TestInput.keypressTimings.spacing.array.reduce((previous, current) => (current += previous)) / TestInput.keypressTimings.spacing.array.length,
            sd: Misc.stdDev(TestInput.keypressTimings.spacing.array),
        };
    }
    catch (e) {
        //
    }
    try {
        ret.keyDurationStats = {
            average: TestInput.keypressTimings.duration.array.reduce((previous, current) => (current += previous)) / TestInput.keypressTimings.duration.array.length,
            sd: Misc.stdDev(TestInput.keypressTimings.duration.array),
        };
    }
    catch (e) {
        //
    }
    return ret;
}
exports.getStats = getStats;
function restart() {
    exports.start = 0;
    exports.end = 0;
    exports.invalid = false;
    exports.lastSecondNotRound = false;
}
exports.restart = restart;
exports.restartCount = 0;
exports.incompleteSeconds = 0;
function incrementRestartCount() {
    exports.restartCount++;
}
exports.incrementRestartCount = incrementRestartCount;
function incrementIncompleteSeconds(val) {
    exports.incompleteSeconds += val;
}
exports.incrementIncompleteSeconds = incrementIncompleteSeconds;
function resetIncomplete() {
    exports.restartCount = 0;
    exports.incompleteSeconds = 0;
}
exports.resetIncomplete = resetIncomplete;
function setInvalid() {
    exports.invalid = true;
}
exports.setInvalid = setInvalid;
function calculateTestSeconds(now) {
    if (now === undefined) {
        const endAfkSeconds = (exports.end - TestInput.lastKeypress) / 1000;
        if ((config_1.default.mode == "zen" || TestInput.bailout) && endAfkSeconds < 7) {
            return (TestInput.lastKeypress - exports.start) / 1000;
        }
        else {
            return (exports.end - exports.start) / 1000;
        }
    }
    else {
        return (now - exports.start) / 1000;
    }
}
exports.calculateTestSeconds = calculateTestSeconds;
function calculateWpmAndRaw() {
    let chars = 0;
    let correctWordChars = 0;
    let spaces = 0;
    //check input history
    for (let i = 0; i < TestInput.input.history.length; i++) {
        const word = config_1.default.mode == "zen"
            ? TestInput.input.getHistory(i)
            : TestWords.words.get(i);
        if (TestInput.input.getHistory(i) == word) {
            //the word is correct
            //+1 for space
            correctWordChars += word.length;
            if (i < TestInput.input.history.length - 1 &&
                Misc.getLastChar(TestInput.input.getHistory(i)) !== "\n") {
                spaces++;
            }
        }
        chars += TestInput.input.getHistory(i).length;
    }
    if (TestInput.input.current !== "") {
        const word = config_1.default.mode == "zen"
            ? TestInput.input.current
            : TestWords.words.getCurrent();
        //check whats currently typed
        const toAdd = {
            correct: 0,
            incorrect: 0,
            missed: 0,
        };
        for (let c = 0; c < word.length; c++) {
            if (c < TestInput.input.current.length) {
                //on char that still has a word list pair
                if (TestInput.input.current[c] == word[c]) {
                    toAdd.correct++;
                }
                else {
                    toAdd.incorrect++;
                }
            }
            else {
                //on char that is extra
                toAdd.missed++;
            }
        }
        chars += toAdd.correct;
        chars += toAdd.incorrect;
        chars += toAdd.missed;
        if (toAdd.incorrect == 0) {
            //word is correct so far, add chars
            correctWordChars += toAdd.correct;
        }
    }
    if (config_1.default.funbox === "nospace" || config_1.default.funbox === "arrows") {
        spaces = 0;
    }
    chars += TestInput.input.current.length;
    const testSeconds = calculateTestSeconds(performance.now());
    const wpm = Math.round(((correctWordChars + spaces) * (60 / testSeconds)) / 5);
    const raw = Math.round(((chars + spaces) * (60 / testSeconds)) / 5);
    return {
        wpm: wpm,
        raw: raw,
    };
}
exports.calculateWpmAndRaw = calculateWpmAndRaw;
function setEnd(e) {
    exports.end = e;
    exports.end2 = Date.now();
}
exports.setEnd = setEnd;
function setStart(s) {
    exports.start = s;
    exports.start2 = Date.now();
}
exports.setStart = setStart;
function calculateAfkSeconds(testSeconds) {
    let extraAfk = 0;
    if (testSeconds !== undefined) {
        if (config_1.default.mode === "time") {
            extraAfk = Math.round(testSeconds) - TestInput.keypressPerSecond.length;
        }
        else {
            extraAfk = Math.ceil(testSeconds) - TestInput.keypressPerSecond.length;
        }
        if (extraAfk < 0)
            extraAfk = 0;
        // console.log("-- extra afk debug");
        // console.log("should be " + Math.ceil(testSeconds));
        // console.log(keypressPerSecond.length);
        // console.log(
        //   `gonna add extra ${extraAfk} seconds of afk because of no keypress data`
        // );
    }
    const ret = TestInput.keypressPerSecond.filter((x) => x.afk).length;
    return ret + extraAfk;
}
exports.calculateAfkSeconds = calculateAfkSeconds;
function setLastSecondNotRound() {
    exports.lastSecondNotRound = true;
}
exports.setLastSecondNotRound = setLastSecondNotRound;
function calculateBurst() {
    const timeToWrite = (performance.now() - TestInput.currentBurstStart) / 1000;
    let wordLength;
    wordLength = TestInput.input.current.length;
    if (wordLength == 0) {
        wordLength = TestInput.input.getHistoryLast().length;
    }
    const speed = Misc.roundTo2((wordLength * (60 / timeToWrite)) / 5);
    return Math.round(speed);
}
exports.calculateBurst = calculateBurst;
function calculateAccuracy() {
    const acc = (TestInput.accuracy.correct /
        (TestInput.accuracy.correct + TestInput.accuracy.incorrect)) *
        100;
    return isNaN(acc) ? 100 : acc;
}
exports.calculateAccuracy = calculateAccuracy;
function removeAfkData() {
    const testSeconds = calculateTestSeconds();
    TestInput.keypressPerSecond.splice(testSeconds);
    TestInput.keypressTimings.duration.array.splice(testSeconds);
    TestInput.keypressTimings.spacing.array.splice(testSeconds);
    TestInput.wpmHistory.splice(testSeconds);
}
exports.removeAfkData = removeAfkData;
function countChars() {
    let correctWordChars = 0;
    let correctChars = 0;
    let incorrectChars = 0;
    let extraChars = 0;
    let missedChars = 0;
    let spaces = 0;
    let correctspaces = 0;
    for (let i = 0; i < TestInput.input.history.length; i++) {
        const word = config_1.default.mode == "zen"
            ? TestInput.input.getHistory(i)
            : TestWords.words.get(i);
        if (TestInput.input.getHistory(i) === "") {
            //last word that was not started
            continue;
        }
        if (TestInput.input.getHistory(i) == word) {
            //the word is correct
            correctWordChars += word.length;
            correctChars += word.length;
            if (i < TestInput.input.history.length - 1 &&
                Misc.getLastChar(TestInput.input.getHistory(i)) !== "\n") {
                correctspaces++;
            }
        }
        else if (TestInput.input.getHistory(i).length >= word.length) {
            //too many chars
            for (let c = 0; c < TestInput.input.getHistory(i).length; c++) {
                if (c < word.length) {
                    //on char that still has a word list pair
                    if (TestInput.input.getHistory(i)[c] == word[c]) {
                        correctChars++;
                    }
                    else {
                        incorrectChars++;
                    }
                }
                else {
                    //on char that is extra
                    extraChars++;
                }
            }
        }
        else {
            //not enough chars
            const toAdd = {
                correct: 0,
                incorrect: 0,
                missed: 0,
            };
            for (let c = 0; c < word.length; c++) {
                if (c < TestInput.input.getHistory(i).length) {
                    //on char that still has a word list pair
                    if (TestInput.input.getHistory(i)[c] == word[c]) {
                        toAdd.correct++;
                    }
                    else {
                        toAdd.incorrect++;
                    }
                }
                else {
                    //on char that is extra
                    toAdd.missed++;
                }
            }
            correctChars += toAdd.correct;
            incorrectChars += toAdd.incorrect;
            if (i === TestInput.input.history.length - 1 && config_1.default.mode == "time") {
                //last word - check if it was all correct - add to correct word chars
                if (toAdd.incorrect === 0)
                    correctWordChars += toAdd.correct;
            }
            else {
                missedChars += toAdd.missed;
            }
        }
        if (i < TestInput.input.history.length - 1) {
            spaces++;
        }
    }
    if (config_1.default.funbox === "nospace" || config_1.default.funbox === "arrows") {
        spaces = 0;
        correctspaces = 0;
    }
    return {
        spaces: spaces,
        correctWordChars: correctWordChars,
        allCorrectChars: correctChars,
        incorrectChars: config_1.default.mode == "zen" ? TestInput.accuracy.incorrect : incorrectChars,
        extraChars: extraChars,
        missedChars: missedChars,
        correctSpaces: correctspaces,
    };
}
function calculateStats() {
    let testSeconds = calculateTestSeconds();
    // console.log((end2 - start2) / 1000);
    // console.log(testSeconds);
    if (config_1.default.mode != "custom") {
        testSeconds = Misc.roundTo2(testSeconds);
    }
    const chars = countChars();
    const wpm = Misc.roundTo2(((chars.correctWordChars + chars.correctSpaces) * (60 / testSeconds)) / 5);
    const wpmraw = Misc.roundTo2(((chars.allCorrectChars +
        chars.spaces +
        chars.incorrectChars +
        chars.extraChars) *
        (60 / testSeconds)) /
        5);
    const acc = Misc.roundTo2(calculateAccuracy());
    return {
        wpm: isNaN(wpm) ? 0 : wpm,
        wpmRaw: isNaN(wpmraw) ? 0 : wpmraw,
        acc: acc,
        correctChars: chars.correctWordChars,
        incorrectChars: chars.incorrectChars,
        missedChars: chars.missedChars,
        extraChars: chars.extraChars,
        allChars: chars.allCorrectChars +
            chars.spaces +
            chars.incorrectChars +
            chars.extraChars,
        time: Misc.roundTo2(testSeconds),
        spaces: chars.spaces,
        correctSpaces: chars.correctSpaces,
    };
}
exports.calculateStats = calculateStats;


/***/ }),

/***/ "./src/scripts/test/test-timer.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-timer.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


//most of the code is thanks to
//https://stackoverflow.com/questions/29971898/how-to-create-an-accurate-timer-in-javascript
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.start = exports.getTimerStats = exports.clear = exports.enableTimerDebug = void 0;
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const CustomText = __importStar(__webpack_require__(/*! ./custom-text */ "./src/scripts/test/custom-text.ts"));
const TimerProgress = __importStar(__webpack_require__(/*! ./timer-progress */ "./src/scripts/test/timer-progress.ts"));
const LiveWpm = __importStar(__webpack_require__(/*! ./live-wpm */ "./src/scripts/test/live-wpm.ts"));
const TestStats = __importStar(__webpack_require__(/*! ./test-stats */ "./src/scripts/test/test-stats.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const Monkey = __importStar(__webpack_require__(/*! ./monkey */ "./src/scripts/test/monkey.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Caret = __importStar(__webpack_require__(/*! ./caret */ "./src/scripts/test/caret.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const Time = __importStar(__webpack_require__(/*! ../states/time */ "./src/scripts/states/time.ts"));
const TimerEvent = __importStar(__webpack_require__(/*! ../observables/timer-event */ "./src/scripts/observables/timer-event.ts"));
let slowTimerCount = 0;
let timer = null;
const interval = 1000;
let expected = 0;
let timerDebug = false;
function enableTimerDebug() {
    timerDebug = true;
}
exports.enableTimerDebug = enableTimerDebug;
function clear() {
    Time.set(0);
    if (timer !== null)
        clearTimeout(timer);
}
exports.clear = clear;
function premid() {
    if (timerDebug)
        console.time("premid");
    const premidSecondsLeft = document.querySelector("#premidSecondsLeft");
    if (premidSecondsLeft !== null) {
        premidSecondsLeft.innerHTML = (config_1.default.time - Time.get()).toString();
    }
    if (timerDebug)
        console.timeEnd("premid");
}
function updateTimer() {
    if (timerDebug)
        console.time("timer progress update");
    if (config_1.default.mode === "time" ||
        (config_1.default.mode === "custom" && CustomText.isTimeRandom)) {
        TimerProgress.update();
    }
    if (timerDebug)
        console.timeEnd("timer progress update");
}
function calculateWpmRaw() {
    if (timerDebug)
        console.time("calculate wpm and raw");
    const wpmAndRaw = TestStats.calculateWpmAndRaw();
    if (timerDebug)
        console.timeEnd("calculate wpm and raw");
    if (timerDebug)
        console.time("update live wpm");
    LiveWpm.update(wpmAndRaw.wpm, wpmAndRaw.raw);
    if (timerDebug)
        console.timeEnd("update live wpm");
    if (timerDebug)
        console.time("push to history");
    TestInput.pushToWpmHistory(wpmAndRaw.wpm);
    TestInput.pushToRawHistory(wpmAndRaw.raw);
    if (timerDebug)
        console.timeEnd("push to history");
    return wpmAndRaw;
}
function monkey(wpmAndRaw) {
    if (timerDebug)
        console.time("update monkey");
    const num = config_1.default.blindMode ? wpmAndRaw.raw : wpmAndRaw.wpm;
    Monkey.updateFastOpacity(num);
    if (timerDebug)
        console.timeEnd("update monkey");
}
function calculateAcc() {
    if (timerDebug)
        console.time("calculate acc");
    const acc = Misc.roundTo2(TestStats.calculateAccuracy());
    if (timerDebug)
        console.timeEnd("calculate acc");
    return acc;
}
function layoutfluid() {
    if (timerDebug)
        console.time("layoutfluid");
    if (config_1.default.funbox === "layoutfluid" && config_1.default.mode === "time") {
        const layouts = config_1.default.customLayoutfluid
            ? config_1.default.customLayoutfluid.split("#")
            : ["qwerty", "dvorak", "colemak"];
        const switchTime = config_1.default.time / layouts.length;
        const time = Time.get();
        const index = Math.floor(time / switchTime);
        const layout = layouts[index];
        const flooredSwitchTimes = [];
        for (let i = 1; i < layouts.length; i++) {
            flooredSwitchTimes.push(Math.floor(switchTime * i));
        }
        if (flooredSwitchTimes.includes(time + 3)) {
            Notifications.add("3", 0, 1);
        }
        else if (flooredSwitchTimes.includes(time + 2)) {
            Notifications.add("2", 0, 1);
        }
        else if (flooredSwitchTimes.includes(time + 1)) {
            Notifications.add("1", 0, 1);
        }
        if (config_1.default.layout !== layout && layout !== undefined) {
            Notifications.add(`--- !!! ${layout} !!! ---`, 0);
            UpdateConfig.setLayout(layout, true);
            UpdateConfig.setKeymapLayout(layout, true);
        }
    }
    if (timerDebug)
        console.timeEnd("layoutfluid");
}
function checkIfFailed(wpmAndRaw, acc) {
    if (timerDebug)
        console.time("fail conditions");
    TestInput.pushKeypressesToHistory();
    if (config_1.default.minWpm === "custom" &&
        wpmAndRaw.wpm < config_1.default.minWpmCustomSpeed &&
        TestWords.words.currentIndex > 3) {
        if (timer !== null)
            clearTimeout(timer);
        SlowTimer.clear();
        slowTimerCount = 0;
        TimerEvent.dispatch("fail", "min wpm");
        return;
    }
    if (config_1.default.minAcc === "custom" &&
        acc < config_1.default.minAccCustom &&
        TestWords.words.currentIndex > 3) {
        if (timer !== null)
            clearTimeout(timer);
        SlowTimer.clear();
        slowTimerCount = 0;
        TimerEvent.dispatch("fail", "min accuracy");
        return;
    }
    if (timerDebug)
        console.timeEnd("fail conditions");
}
function checkIfTimeIsUp() {
    if (timerDebug)
        console.time("times up check");
    if (config_1.default.mode == "time" ||
        (config_1.default.mode === "custom" && CustomText.isTimeRandom)) {
        if ((Time.get() >= config_1.default.time &&
            config_1.default.time !== 0 &&
            config_1.default.mode === "time") ||
            (Time.get() >= CustomText.time &&
                CustomText.time !== 0 &&
                config_1.default.mode === "custom")) {
            //times up
            if (timer !== null)
                clearTimeout(timer);
            Caret.hide();
            TestInput.input.pushHistory();
            TestInput.corrected.pushHistory();
            SlowTimer.clear();
            slowTimerCount = 0;
            TimerEvent.dispatch("finish");
            return;
        }
    }
    if (timerDebug)
        console.timeEnd("times up check");
}
// ---------------------------------------
let timerStats = [];
function getTimerStats() {
    return timerStats;
}
exports.getTimerStats = getTimerStats;
function timerStep() {
    return __awaiter(this, void 0, void 0, function* () {
        if (timerDebug)
            console.time("timer step -----------------------------");
        Time.increment();
        premid();
        updateTimer();
        const wpmAndRaw = calculateWpmRaw();
        const acc = calculateAcc();
        monkey(wpmAndRaw);
        layoutfluid();
        checkIfFailed(wpmAndRaw, acc);
        checkIfTimeIsUp();
        if (timerDebug)
            console.timeEnd("timer step -----------------------------");
    });
}
function start() {
    return __awaiter(this, void 0, void 0, function* () {
        SlowTimer.clear();
        slowTimerCount = 0;
        timerStats = [];
        expected = TestStats.start + interval;
        (function loop() {
            const delay = expected - performance.now();
            timerStats.push({
                dateNow: Date.now(),
                now: performance.now(),
                expected: expected,
                nextDelay: delay,
            });
            if ((config_1.default.mode === "time" && config_1.default.time < 130 && config_1.default.time > 0) ||
                (config_1.default.mode === "words" && config_1.default.words < 250 && config_1.default.words > 0)) {
                if (delay < interval / 2) {
                    //slow timer
                    SlowTimer.set();
                }
                if (delay < interval / 10) {
                    slowTimerCount++;
                    if (slowTimerCount > 5) {
                        //slow timer
                        if (window.navigator.userAgent.includes("Edg")) {
                            Notifications.add('This bad performance could be caused by "efficiency mode" on Microsoft Edge.');
                        }
                        Notifications.add("Stopping the test due to bad performance. This would cause test calculations to be incorrect. If this happens a lot, please report this.", -1);
                        TimerEvent.dispatch("fail", "slow timer");
                    }
                }
            }
            timer = setTimeout(function () {
                // time++;
                if (!TestActive.get()) {
                    if (timer !== null)
                        clearTimeout(timer);
                    SlowTimer.clear();
                    slowTimerCount = 0;
                    return;
                }
                timerStep();
                expected += interval;
                loop();
            }, delay);
        })();
    });
}
exports.start = start;


/***/ }),

/***/ "./src/scripts/test/test-ui.ts":
/*!*************************************!*\
  !*** ./src/scripts/test/test-ui.ts ***!
  \*************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.highlightBadWord = exports.applyBurstHeatmap = exports.toggleResultWords = exports.arrangeCharactersLeftToRight = exports.arrangeCharactersRightToLeft = exports.lineJump = exports.updateWordElement = exports.screenshot = exports.colorful = exports.flipColors = exports.addWord = exports.showWords = exports.updateActiveElement = exports.focusWords = exports.reset = exports.setResultCalculating = exports.setTestRestarting = exports.setActiveWordTop = exports.setCurrentWordElementIndex = exports.setResultVisible = exports.resultCalculating = exports.currentTestLine = exports.lineTransition = exports.testRestartingPromise = exports.testRestarting = exports.activeWordTop = exports.resultVisible = exports.currentWordElementIndex = void 0;
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const CustomText = __importStar(__webpack_require__(/*! ./custom-text */ "./src/scripts/test/custom-text.ts"));
const Caret = __importStar(__webpack_require__(/*! ./caret */ "./src/scripts/test/caret.ts"));
const OutOfFocus = __importStar(__webpack_require__(/*! ./out-of-focus */ "./src/scripts/test/out-of-focus.ts"));
const Replay = __importStar(__webpack_require__(/*! ./replay */ "./src/scripts/test/replay.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventValue === undefined || typeof eventValue !== "boolean")
        return;
    if (eventKey === "flipTestColors")
        flipColors(eventValue);
    if (eventKey === "colorfulMode")
        colorful(eventValue);
    if (eventKey === "highlightMode")
        updateWordElement(eventValue);
    if (eventKey === "burstHeatmap")
        applyBurstHeatmap();
});
exports.currentWordElementIndex = 0;
exports.resultVisible = false;
exports.activeWordTop = 0;
exports.testRestarting = false;
exports.lineTransition = false;
exports.currentTestLine = 0;
exports.resultCalculating = false;
function setResultVisible(val) {
    exports.resultVisible = val;
}
exports.setResultVisible = setResultVisible;
function setCurrentWordElementIndex(val) {
    exports.currentWordElementIndex = val;
}
exports.setCurrentWordElementIndex = setCurrentWordElementIndex;
function setActiveWordTop(val) {
    exports.activeWordTop = val;
}
exports.setActiveWordTop = setActiveWordTop;
let restartingResolve;
function setTestRestarting(val) {
    exports.testRestarting = val;
    if (val === true) {
        exports.testRestartingPromise = new Promise((resolve) => {
            restartingResolve = resolve;
        });
    }
    else {
        if (restartingResolve)
            restartingResolve();
        restartingResolve = null;
    }
}
exports.setTestRestarting = setTestRestarting;
function setResultCalculating(val) {
    exports.resultCalculating = val;
}
exports.setResultCalculating = setResultCalculating;
function reset() {
    exports.currentTestLine = 0;
    exports.currentWordElementIndex = 0;
}
exports.reset = reset;
function focusWords() {
    if (!$("#wordsWrapper").hasClass("hidden")) {
        $("#wordsInput").trigger("focus");
    }
}
exports.focusWords = focusWords;
function updateActiveElement(backspace) {
    const active = document.querySelector("#words .active");
    if (config_1.default.mode == "zen" && backspace) {
        active === null || active === void 0 ? void 0 : active.remove();
    }
    else if (active !== null) {
        if (config_1.default.highlightMode == "word") {
            active.querySelectorAll("letter").forEach((e) => {
                e.classList.remove("correct");
            });
        }
        active.classList.remove("active");
    }
    try {
        const activeWord = document.querySelectorAll("#words .word")[exports.currentWordElementIndex];
        activeWord.classList.add("active");
        activeWord.classList.remove("error");
        exports.activeWordTop = document.querySelector("#words .active")
            .offsetTop;
        if (config_1.default.highlightMode == "word") {
            activeWord.querySelectorAll("letter").forEach((e) => {
                e.classList.add("correct");
            });
        }
    }
    catch (e) { }
}
exports.updateActiveElement = updateActiveElement;
function getWordHTML(word) {
    let newlineafter = false;
    let retval = `<div class='word'>`;
    for (let c = 0; c < word.length; c++) {
        if (config_1.default.funbox === "arrows") {
            if (word.charAt(c) === "") {
                retval += `<letter><i class="fas fa-arrow-up"></i></letter>`;
            }
            if (word.charAt(c) === "") {
                retval += `<letter><i class="fas fa-arrow-down"></i></letter>`;
            }
            if (word.charAt(c) === "") {
                retval += `<letter><i class="fas fa-arrow-left"></i></letter>`;
            }
            if (word.charAt(c) === "") {
                retval += `<letter><i class="fas fa-arrow-right"></i></letter>`;
            }
        }
        else if (word.charAt(c) === "\t") {
            retval += `<letter class='tabChar'><i class="fas fa-long-arrow-alt-right"></i></letter>`;
        }
        else if (word.charAt(c) === "\n") {
            newlineafter = true;
            retval += `<letter class='nlChar'><i class="fas fa-angle-down"></i></letter>`;
        }
        else {
            retval += "<letter>" + word.charAt(c) + "</letter>";
        }
    }
    retval += "</div>";
    if (newlineafter)
        retval += "<div class='newline'></div>";
    return retval;
}
function showWords() {
    $("#words").empty();
    let wordsHTML = "";
    if (config_1.default.mode !== "zen") {
        for (let i = 0; i < TestWords.words.length; i++) {
            wordsHTML += getWordHTML(TestWords.words.get(i));
        }
    }
    else {
        wordsHTML =
            '<div class="word">word height</div><div class="word active"></div>';
    }
    $("#words").html(wordsHTML);
    $("#wordsWrapper").removeClass("hidden");
    const wordHeight = ($(document.querySelector(".word")).outerHeight(true));
    const wordsHeight = ($(document.querySelector("#words")).outerHeight(true));
    if (config_1.default.showAllLines &&
        config_1.default.mode != "time" &&
        !(CustomText.isWordRandom && CustomText.word == 0) &&
        !CustomText.isTimeRandom) {
        $("#words").css("height", "auto");
        $("#wordsWrapper").css("height", "auto");
        let nh = wordHeight * 3;
        if (nh > wordsHeight) {
            nh = wordsHeight;
        }
        $(".outOfFocusWarning").css("line-height", nh + "px");
    }
    else {
        $("#words")
            .css("height", wordHeight * 4 + "px")
            .css("overflow", "hidden");
        $("#wordsWrapper")
            .css("height", wordHeight * 3 + "px")
            .css("overflow", "hidden");
        $(".outOfFocusWarning").css("line-height", wordHeight * 3 + "px");
    }
    if (config_1.default.mode === "zen") {
        $(document.querySelector(".word")).remove();
    }
    updateActiveElement();
    Caret.updatePosition();
}
exports.showWords = showWords;
function addWord(word) {
    $("#words").append(getWordHTML(word));
}
exports.addWord = addWord;
function flipColors(tf) {
    if (tf) {
        $("#words").addClass("flipped");
    }
    else {
        $("#words").removeClass("flipped");
    }
}
exports.flipColors = flipColors;
function colorful(tc) {
    if (tc) {
        $("#words").addClass("colorfulMode");
    }
    else {
        $("#words").removeClass("colorfulMode");
    }
}
exports.colorful = colorful;
function screenshot() {
    return __awaiter(this, void 0, void 0, function* () {
        let revealReplay = false;
        function revertScreenshot() {
            $("#notificationCenter").removeClass("hidden");
            $("#commandLineMobileButton").removeClass("hidden");
            $(".pageTest .ssWatermark").addClass("hidden");
            $(".pageTest .ssWatermark").text("monkeytype.com");
            $(".pageTest .buttons").removeClass("hidden");
            if (revealReplay)
                $("#resultReplay").removeClass("hidden");
            if (firebase_1.Auth.currentUser == null) {
                $(".pageTest .loginTip").removeClass("hidden");
            }
        }
        if (!$("#resultReplay").hasClass("hidden")) {
            revealReplay = true;
            Replay.pauseReplay();
        }
        const dateNow = new Date(Date.now());
        $("#resultReplay").addClass("hidden");
        $(".pageTest .ssWatermark").removeClass("hidden");
        $(".pageTest .ssWatermark").text((0, format_1.default)(dateNow, "dd MMM yyyy HH:mm") + " | monkeytype.com ");
        if (firebase_1.Auth.currentUser != null) {
            $(".pageTest .ssWatermark").text(DB.getSnapshot().name +
                " | " +
                (0, format_1.default)(dateNow, "dd MMM yyyy HH:mm") +
                " | monkeytype.com  ");
        }
        $(".pageTest .buttons").addClass("hidden");
        const src = $("#middle");
        const sourceX = src.position().left; /*X position from div#target*/
        const sourceY = src.position().top; /*Y position from div#target*/
        const sourceWidth = (src.outerWidth(true)); /*clientWidth/offsetWidth from div#target*/
        const sourceHeight = (src.outerHeight(true)); /*clientHeight/offsetHeight from div#target*/
        $("#notificationCenter").addClass("hidden");
        $("#commandLineMobileButton").addClass("hidden");
        $(".pageTest .loginTip").addClass("hidden");
        try {
            const paddingX = 50;
            const paddingY = 25;
            html2canvas(document.body, {
                backgroundColor: yield ThemeColors.get("bg"),
                width: sourceWidth + paddingX * 2,
                height: sourceHeight + paddingY * 2,
                x: sourceX - paddingX,
                y: sourceY - paddingY,
            }).then((canvas) => {
                canvas.toBlob((blob) => {
                    try {
                        if (blob === null)
                            return;
                        if (navigator.userAgent.toLowerCase().indexOf("firefox") > -1) {
                            open(URL.createObjectURL(blob));
                            revertScreenshot();
                        }
                        else {
                            navigator.clipboard
                                .write([
                                new ClipboardItem(Object.defineProperty({}, blob.type, {
                                    value: blob,
                                    enumerable: true,
                                })),
                            ])
                                .then(() => {
                                Notifications.add("Copied to clipboard", 1, 2);
                                revertScreenshot();
                            });
                        }
                    }
                    catch (e) {
                        Notifications.add("Error saving image to clipboard: " + e.message, -1);
                        revertScreenshot();
                    }
                });
            });
        }
        catch (e) {
            Notifications.add("Error creating image: " + e.message, -1);
            revertScreenshot();
        }
        setTimeout(() => {
            revertScreenshot();
        }, 3000);
    });
}
exports.screenshot = screenshot;
function updateWordElement(showError = !config_1.default.blindMode) {
    const input = TestInput.input.current;
    const wordAtIndex = document.querySelector("#words .word.active");
    const currentWord = TestWords.words.getCurrent();
    if (!currentWord && config_1.default.mode !== "zen")
        return;
    let ret = "";
    let newlineafter = false;
    if (config_1.default.mode === "zen") {
        for (let i = 0; i < TestInput.input.current.length; i++) {
            if (TestInput.input.current[i] === "\t") {
                ret += `<letter class='tabChar correct' style="opacity: 0"><i class="fas fa-long-arrow-alt-right"></i></letter>`;
            }
            else if (TestInput.input.current[i] === "\n") {
                newlineafter = true;
                ret += `<letter class='nlChar correct' style="opacity: 0"><i class="fas fa-angle-down"></i></letter>`;
            }
            else {
                ret += `<letter class="correct">${TestInput.input.current[i]}</letter>`;
            }
        }
    }
    else {
        let correctSoFar = false;
        // slice earlier if input has trailing compose characters
        const inputWithoutComposeLength = Misc.trailingComposeChars.test(input)
            ? input.search(Misc.trailingComposeChars)
            : input.length;
        if (input.search(Misc.trailingComposeChars) < currentWord.length &&
            currentWord.slice(0, inputWithoutComposeLength) ===
                input.slice(0, inputWithoutComposeLength)) {
            correctSoFar = true;
        }
        let wordHighlightClassString = correctSoFar ? "correct" : "incorrect";
        if (config_1.default.blindMode) {
            wordHighlightClassString = "correct";
        }
        for (let i = 0; i < input.length; i++) {
            const charCorrect = currentWord[i] == input[i];
            let correctClass = "correct";
            if (config_1.default.highlightMode == "off") {
                correctClass = "";
            }
            let currentLetter = currentWord[i];
            let tabChar = "";
            let nlChar = "";
            if (config_1.default.funbox === "arrows") {
                if (currentLetter === "") {
                    currentLetter = `<i class="fas fa-arrow-up"></i>`;
                }
                if (currentLetter === "") {
                    currentLetter = `<i class="fas fa-arrow-down"></i>`;
                }
                if (currentLetter === "") {
                    currentLetter = `<i class="fas fa-arrow-left"></i>`;
                }
                if (currentLetter === "") {
                    currentLetter = `<i class="fas fa-arrow-right"></i>`;
                }
            }
            else if (currentLetter === "\t") {
                tabChar = "tabChar";
                currentLetter = `<i class="fas fa-long-arrow-alt-right"></i>`;
            }
            else if (currentLetter === "\n") {
                nlChar = "nlChar";
                currentLetter = `<i class="fas fa-angle-down"></i>`;
            }
            if (Misc.trailingComposeChars.test(input) &&
                i > input.search(Misc.trailingComposeChars)) {
                continue;
            }
            if (charCorrect) {
                ret += `<letter class="${config_1.default.highlightMode == "word"
                    ? wordHighlightClassString
                    : correctClass} ${tabChar}${nlChar}">${currentLetter}</letter>`;
            }
            else if (currentLetter !== undefined &&
                Misc.trailingComposeChars.test(input) &&
                i === input.search(Misc.trailingComposeChars)) {
                ret += `<letter class="${config_1.default.highlightMode == "word" ? wordHighlightClassString : ""} dead">${currentLetter}</letter>`;
            }
            else if (!showError) {
                if (currentLetter !== undefined) {
                    ret += `<letter class="${config_1.default.highlightMode == "word"
                        ? wordHighlightClassString
                        : correctClass} ${tabChar}${nlChar}">${currentLetter}</letter>`;
                }
            }
            else if (currentLetter === undefined) {
                if (!config_1.default.hideExtraLetters) {
                    let letter = input[i];
                    if (letter == " " || letter == "\t" || letter == "\n") {
                        letter = "_";
                    }
                    ret += `<letter class="${config_1.default.highlightMode == "word"
                        ? wordHighlightClassString
                        : "incorrect"} extra ${tabChar}${nlChar}">${letter}</letter>`;
                }
            }
            else {
                ret +=
                    `<letter class="${config_1.default.highlightMode == "word"
                        ? wordHighlightClassString
                        : "incorrect"} ${tabChar}${nlChar}">` +
                        (config_1.default.indicateTypos === "replace"
                            ? input[i] == " "
                                ? "_"
                                : input[i]
                            : currentLetter) +
                        (config_1.default.indicateTypos === "below" ? `<hint>${input[i]}</hint>` : "") +
                        "</letter>";
            }
        }
        const inputWithSingleComposeLength = Misc.trailingComposeChars.test(input)
            ? input.search(Misc.trailingComposeChars) + 1
            : input.length;
        if (inputWithSingleComposeLength < currentWord.length) {
            for (let i = inputWithSingleComposeLength; i < currentWord.length; i++) {
                if (config_1.default.funbox === "arrows") {
                    if (currentWord[i] === "") {
                        ret += `<letter><i class="fas fa-arrow-up"></i></letter>`;
                    }
                    if (currentWord[i] === "") {
                        ret += `<letter><i class="fas fa-arrow-down"></i></letter>`;
                    }
                    if (currentWord[i] === "") {
                        ret += `<letter><i class="fas fa-arrow-left"></i></letter>`;
                    }
                    if (currentWord[i] === "") {
                        ret += `<letter><i class="fas fa-arrow-right"></i></letter>`;
                    }
                }
                else if (currentWord[i] === "\t") {
                    ret += `<letter class='tabChar'><i class="fas fa-long-arrow-alt-right"></i></letter>`;
                }
                else if (currentWord[i] === "\n") {
                    ret += `<letter class='nlChar'><i class="fas fa-angle-down"></i></letter>`;
                }
                else {
                    ret +=
                        `<letter class="${config_1.default.highlightMode == "word" ? wordHighlightClassString : ""}">` +
                            currentWord[i] +
                            "</letter>";
                }
            }
        }
        if (config_1.default.highlightMode === "letter" && config_1.default.hideExtraLetters) {
            if (input.length > currentWord.length && !config_1.default.blindMode) {
                $(wordAtIndex).addClass("error");
            }
            else if (input.length == currentWord.length) {
                $(wordAtIndex).removeClass("error");
            }
        }
    }
    wordAtIndex.innerHTML = ret;
    if (newlineafter)
        $("#words").append("<div class='newline'></div>");
}
exports.updateWordElement = updateWordElement;
function lineJump(currentTop) {
    var _a;
    //last word of the line
    if (exports.currentTestLine > 0) {
        const hideBound = currentTop;
        const toHide = [];
        const wordElements = $("#words .word");
        for (let i = 0; i < exports.currentWordElementIndex; i++) {
            if ($(wordElements[i]).hasClass("hidden"))
                continue;
            const forWordTop = Math.floor(wordElements[i].offsetTop);
            if (forWordTop < hideBound - 10) {
                toHide.push($($("#words .word")[i]));
            }
        }
        const wordHeight = ($(document.querySelector(".word")).outerHeight(true));
        if (config_1.default.smoothLineScroll && toHide.length > 0) {
            exports.lineTransition = true;
            $("#words").prepend(`<div class="smoothScroller" style="position: fixed;height:${wordHeight}px;width:100%"></div>`);
            $("#words .smoothScroller").animate({
                height: 0,
            }, SlowTimer.get() ? 0 : 125, () => {
                $("#words .smoothScroller").remove();
            });
            $("#paceCaret").animate({
                top: ((_a = document.querySelector("#paceCaret")) === null || _a === void 0 ? void 0 : _a.offsetTop) -
                    wordHeight,
            }, SlowTimer.get() ? 0 : 125);
            $("#words").animate({
                marginTop: `-${wordHeight}px`,
            }, SlowTimer.get() ? 0 : 125, () => {
                exports.activeWordTop = (document.querySelector("#words .active")).offsetTop;
                exports.currentWordElementIndex -= toHide.length;
                exports.lineTransition = false;
                toHide.forEach((el) => el.remove());
                $("#words").css("marginTop", "0");
            });
        }
        else {
            toHide.forEach((el) => el.remove());
            exports.currentWordElementIndex -= toHide.length;
            $("#paceCaret").css({
                top: document.querySelector("#paceCaret").offsetTop -
                    wordHeight,
            });
        }
    }
    exports.currentTestLine++;
}
exports.lineJump = lineJump;
function arrangeCharactersRightToLeft() {
    $("#words").addClass("rightToLeftTest");
    $("#resultWordsHistory .words").addClass("rightToLeftTest");
    $("#resultReplay .words").addClass("rightToLeftTest");
}
exports.arrangeCharactersRightToLeft = arrangeCharactersRightToLeft;
function arrangeCharactersLeftToRight() {
    $("#words").removeClass("rightToLeftTest");
    $("#resultWordsHistory .words").removeClass("rightToLeftTest");
    $("#resultReplay .words").removeClass("rightToLeftTest");
}
exports.arrangeCharactersLeftToRight = arrangeCharactersLeftToRight;
function loadWordsHistory() {
    return __awaiter(this, void 0, void 0, function* () {
        $("#resultWordsHistory .words").empty();
        let wordsHTML = "";
        for (let i = 0; i < TestInput.input.history.length + 2; i++) {
            const input = TestInput.input.getHistory(i);
            const word = TestWords.words.get(i);
            let wordEl = "";
            try {
                if (input === "")
                    throw new Error("empty input word");
                if (TestInput.corrected.getHistory(i) !== undefined &&
                    TestInput.corrected.getHistory(i) !== "") {
                    wordEl = `<div class='word' burst="${TestInput.burstHistory[i]}" input="${TestInput.corrected
                        .getHistory(i)
                        .replace(/"/g, "&quot;")
                        .replace(/ /g, "_")}">`;
                }
                else {
                    wordEl = `<div class='word' burst="${TestInput.burstHistory[i]}" input="${input.replace(/"/g, "&quot;").replace(/ /g, "_")}">`;
                }
                if (i === TestInput.input.history.length - 1) {
                    //last word
                    const wordstats = {
                        correct: 0,
                        incorrect: 0,
                        missed: 0,
                    };
                    const length = config_1.default.mode == "zen" ? input.length : word.length;
                    for (let c = 0; c < length; c++) {
                        if (c < input.length) {
                            //on char that still has a word list pair
                            if (config_1.default.mode == "zen" || input[c] == word[c]) {
                                wordstats.correct++;
                            }
                            else {
                                wordstats.incorrect++;
                            }
                        }
                        else {
                            //on char that is extra
                            wordstats.missed++;
                        }
                    }
                    if (wordstats.incorrect !== 0 || config_1.default.mode !== "time") {
                        if (config_1.default.mode != "zen" && input !== word) {
                            wordEl = `<div class='word error' burst="${TestInput.burstHistory[i]}" input="${input.replace(/"/g, "&quot;").replace(/ /g, "_")}">`;
                        }
                    }
                }
                else {
                    if (config_1.default.mode != "zen" && input !== word) {
                        wordEl = `<div class='word error' burst="${TestInput.burstHistory[i]}" input="${input.replace(/"/g, "&quot;").replace(/ /g, "_")}">`;
                    }
                }
                let loop;
                if (config_1.default.mode == "zen" || input.length > word.length) {
                    //input is longer - extra characters possible (loop over input)
                    loop = input.length;
                }
                else {
                    //input is shorter or equal (loop over word list)
                    loop = word.length;
                }
                for (let c = 0; c < loop; c++) {
                    let correctedChar;
                    try {
                        correctedChar = TestInput.corrected.getHistory(i)[c];
                    }
                    catch (e) {
                        correctedChar = undefined;
                    }
                    let extraCorrected = "";
                    if (c + 1 === loop &&
                        TestInput.corrected.getHistory(i) !== undefined &&
                        TestInput.corrected.getHistory(i).length > input.length) {
                        extraCorrected = "extraCorrected";
                    }
                    if (config_1.default.mode == "zen" || word[c] !== undefined) {
                        if (config_1.default.mode == "zen" || input[c] === word[c]) {
                            if (correctedChar === input[c] || correctedChar === undefined) {
                                wordEl += `<letter class="correct ${extraCorrected}">${input[c]}</letter>`;
                            }
                            else {
                                wordEl +=
                                    `<letter class="corrected ${extraCorrected}">` +
                                        input[c] +
                                        "</letter>";
                            }
                        }
                        else {
                            if (input[c] === TestInput.input.current) {
                                wordEl +=
                                    `<letter class='correct ${extraCorrected}'>` +
                                        word[c] +
                                        "</letter>";
                            }
                            else if (input[c] === undefined) {
                                wordEl += "<letter>" + word[c] + "</letter>";
                            }
                            else {
                                wordEl +=
                                    `<letter class="incorrect ${extraCorrected}">` +
                                        word[c] +
                                        "</letter>";
                            }
                        }
                    }
                    else {
                        wordEl += '<letter class="incorrect extra">' + input[c] + "</letter>";
                    }
                }
                wordEl += "</div>";
            }
            catch (e) {
                try {
                    wordEl = "<div class='word'>";
                    for (let c = 0; c < word.length; c++) {
                        wordEl += "<letter>" + word[c] + "</letter>";
                    }
                    wordEl += "</div>";
                }
                catch (_a) { }
            }
            wordsHTML += wordEl;
        }
        $("#resultWordsHistory .words").html(wordsHTML);
        $("#showWordHistoryButton").addClass("loaded");
        return true;
    });
}
function toggleResultWords() {
    if (exports.resultVisible) {
        if ($("#resultWordsHistory").stop(true, true).hasClass("hidden")) {
            //show
            if (!$("#showWordHistoryButton").hasClass("loaded")) {
                $("#words").html(`<div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>`);
                loadWordsHistory().then(() => {
                    if (config_1.default.burstHeatmap) {
                        applyBurstHeatmap();
                    }
                    $("#resultWordsHistory")
                        .removeClass("hidden")
                        .css("display", "none")
                        .slideDown(250, () => {
                        if (config_1.default.burstHeatmap) {
                            applyBurstHeatmap();
                        }
                    });
                });
            }
            else {
                if (config_1.default.burstHeatmap) {
                    applyBurstHeatmap();
                }
                $("#resultWordsHistory")
                    .removeClass("hidden")
                    .css("display", "none")
                    .slideDown(250);
            }
        }
        else {
            //hide
            $("#resultWordsHistory").slideUp(250, () => {
                $("#resultWordsHistory").addClass("hidden");
            });
        }
    }
}
exports.toggleResultWords = toggleResultWords;
function applyBurstHeatmap() {
    var _a, _b;
    if (config_1.default.burstHeatmap) {
        $("#resultWordsHistory .heatmapLegend").removeClass("hidden");
        let burstlist = [...TestInput.burstHistory];
        burstlist = burstlist.filter((x) => x !== Infinity);
        burstlist = burstlist.filter((x) => x < 350);
        if (((_a = TestInput.input.getHistory(TestInput.input.getHistory().length - 1)) === null || _a === void 0 ? void 0 : _a.length) !== ((_b = TestWords.words.getCurrent()) === null || _b === void 0 ? void 0 : _b.length)) {
            burstlist = burstlist.splice(0, burstlist.length - 1);
        }
        const median = Misc.median(burstlist);
        const adatm = [];
        burstlist.forEach((burst) => {
            adatm.push(Math.abs(median - burst));
        });
        const step = Misc.mean(adatm);
        const steps = [
            {
                val: 0,
                class: "heatmap-0",
            },
            {
                val: median - step * 1.5,
                class: "heatmap-1",
            },
            {
                val: median - step * 0.5,
                class: "heatmap-2",
            },
            {
                val: median + step * 0.5,
                class: "heatmap-3",
            },
            {
                val: median + step * 1.5,
                class: "heatmap-4",
            },
        ];
        $("#resultWordsHistory .words .word").each((_, word) => {
            const wordBurstVal = parseInt($(word).attr("burst"));
            let cls = "";
            steps.forEach((step) => {
                if (wordBurstVal > step.val)
                    cls = step.class;
            });
            $(word).addClass(cls);
        });
    }
    else {
        $("#resultWordsHistory .heatmapLegend").addClass("hidden");
        $("#resultWordsHistory .words .word").removeClass("heatmap-0");
        $("#resultWordsHistory .words .word").removeClass("heatmap-1");
        $("#resultWordsHistory .words .word").removeClass("heatmap-2");
        $("#resultWordsHistory .words .word").removeClass("heatmap-3");
        $("#resultWordsHistory .words .word").removeClass("heatmap-4");
    }
}
exports.applyBurstHeatmap = applyBurstHeatmap;
function highlightBadWord(index, showError) {
    if (!showError)
        return;
    $($("#words .word")[index]).addClass("error");
}
exports.highlightBadWord = highlightBadWord;
$(document.body).on("click", "#saveScreenshotButton", () => {
    screenshot();
});
$(document).on("click", "#testModesNotice .text-button.blind", () => {
    UpdateConfig.setBlindMode(!config_1.default.blindMode);
});
$(".pageTest #copyWordsListButton").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    try {
        let words;
        if (config_1.default.mode == "zen") {
            words = TestInput.input.history.join(" ");
        }
        else {
            words = TestWords.words.get()
                .slice(0, TestInput.input.history.length)
                .join(" ");
        }
        yield navigator.clipboard.writeText(words);
        Notifications.add("Copied to clipboard", 0, 2);
    }
    catch (e) {
        Notifications.add("Could not copy to clipboard: " + e, -1);
    }
}));
$(".pageTest #toggleBurstHeatmap").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    UpdateConfig.setBurstHeatmap(!config_1.default.burstHeatmap);
}));
$(document).on("mouseleave", "#resultWordsHistory .words .word", () => {
    $(".wordInputAfter").remove();
});
$("#wpmChart").on("mouseleave", () => {
    $(".wordInputAfter").remove();
});
$(document).on("mouseenter", "#resultWordsHistory .words .word", (e) => {
    if (exports.resultVisible) {
        const input = $(e.currentTarget).attr("input");
        const burst = parseInt($(e.currentTarget).attr("burst"));
        if (input != undefined) {
            $(e.currentTarget).append(`<div class="wordInputAfter">
          <div class="text">
          ${input
                .replace(/\t/g, "_")
                .replace(/\n/g, "_")
                .replace(/</g, "&lt")
                .replace(/>/g, "&gt")}
          </div>
          <div class="speed">
          ${Math.round(config_1.default.alwaysShowCPM ? burst * 5 : burst)}${config_1.default.alwaysShowCPM ? "cpm" : "wpm"}
          </div>
          </div>`);
        }
    }
});
$("#wordsInput").on("focus", () => {
    if (!exports.resultVisible && config_1.default.showOutOfFocusWarning) {
        OutOfFocus.hide();
    }
    Caret.show();
});
$("#wordsInput").on("focusout", () => {
    if (!exports.resultVisible && config_1.default.showOutOfFocusWarning) {
        OutOfFocus.show();
    }
    Caret.hide();
});
$(document).on("keypress", "#showWordHistoryButton", (event) => {
    if (event.key === "Enter") {
        toggleResultWords();
    }
});
$(document.body).on("click", "#showWordHistoryButton", () => {
    toggleResultWords();
});
$("#wordsWrapper").on("click", () => {
    focusWords();
});


/***/ }),

/***/ "./src/scripts/test/test-words.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-words.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.setHasTab = exports.setRandomQuote = exports.randomQuote = exports.hasTab = exports.words = void 0;
class Words {
    constructor() {
        this.list = [];
        this.length = 0;
        this.currentIndex = 0;
    }
    get(i, raw = false) {
        var _a, _b;
        if (i === undefined) {
            return this.list;
        }
        else {
            if (raw) {
                return (_b = (_a = this.list[i]) === null || _a === void 0 ? void 0 : _a.replace(/[.?!":\-,]/g, "")) === null || _b === void 0 ? void 0 : _b.toLowerCase();
            }
            else {
                return this.list[i];
            }
        }
    }
    getCurrent() {
        return this.list[this.currentIndex];
    }
    getLast() {
        return this.list[this.list.length - 1];
    }
    push(word) {
        this.list.push(word);
        this.length = this.list.length;
    }
    reset() {
        this.list = [];
        this.currentIndex = 0;
        this.length = this.list.length;
    }
    resetCurrentIndex() {
        this.currentIndex = 0;
    }
    decreaseCurrentIndex() {
        this.currentIndex--;
    }
    increaseCurrentIndex() {
        this.currentIndex++;
    }
    clean() {
        for (const s of this.list) {
            if (/ +/.test(s)) {
                const id = this.list.indexOf(s);
                const tempList = s.split(" ");
                this.list.splice(id, 1);
                for (let i = 0; i < tempList.length; i++) {
                    this.list.splice(id + i, 0, tempList[i]);
                }
            }
        }
    }
}
exports.words = new Words();
exports.hasTab = false;
exports.randomQuote = null;
function setRandomQuote(rq) {
    exports.randomQuote = rq;
}
exports.setRandomQuote = setRandomQuote;
function setHasTab(tf) {
    exports.hasTab = tf;
}
exports.setHasTab = setHasTab;


/***/ }),

/***/ "./src/scripts/test/timer-progress.ts":
/*!********************************************!*\
  !*** ./src/scripts/test/timer-progress.ts ***!
  \********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateStyle = exports.update = exports.restart = exports.hide = exports.show = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const CustomText = __importStar(__webpack_require__(/*! ./custom-text */ "./src/scripts/test/custom-text.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const Time = __importStar(__webpack_require__(/*! ../states/time */ "./src/scripts/states/time.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
function show() {
    const op = config_1.default.showTimerProgress ? config_1.default.timerOpacity : 0;
    if (config_1.default.mode != "zen" && config_1.default.timerStyle === "bar") {
        $("#timerWrapper").stop(true, true).removeClass("hidden").animate({
            opacity: op,
        }, 125);
    }
    else if (config_1.default.timerStyle === "text") {
        $("#timerNumber")
            .stop(true, true)
            .removeClass("hidden")
            .css("opacity", 0)
            .animate({
            opacity: op,
        }, 125);
    }
    else if (config_1.default.mode == "zen" || config_1.default.timerStyle === "mini") {
        if (op > 0) {
            $("#miniTimerAndLiveWpm .time")
                .stop(true, true)
                .removeClass("hidden")
                .animate({
                opacity: op,
            }, 125);
        }
    }
}
exports.show = show;
function hide() {
    $("#timerWrapper").stop(true, true).animate({
        opacity: 0,
    }, 125);
    $("#miniTimerAndLiveWpm .time")
        .stop(true, true)
        .animate({
        opacity: 0,
    }, 125, () => {
        $("#miniTimerAndLiveWpm .time").addClass("hidden");
    });
    $("#timerNumber").stop(true, true).animate({
        opacity: 0,
    }, 125);
}
exports.hide = hide;
function restart() {
    if (config_1.default.timerStyle === "bar") {
        if (config_1.default.mode === "time") {
            $("#timer").stop(true, true).animate({
                width: "100vw",
            }, 0);
        }
        else if (config_1.default.mode === "words" || config_1.default.mode === "custom") {
            $("#timer").stop(true, true).animate({
                width: "0vw",
            }, 0);
        }
    }
}
exports.restart = restart;
const timerNumberElement = document.querySelector("#timerNumber");
const miniTimerNumberElement = document.querySelector("#miniTimerAndLiveWpm .time");
function update() {
    var _a, _b, _c;
    const time = Time.get();
    if (config_1.default.mode === "time" ||
        (config_1.default.mode === "custom" && CustomText.isTimeRandom)) {
        let maxtime = config_1.default.time;
        if (config_1.default.mode === "custom" && CustomText.isTimeRandom) {
            maxtime = CustomText.time;
        }
        if (config_1.default.timerStyle === "bar") {
            const percent = 100 - ((time + 1) / maxtime) * 100;
            $("#timer")
                .stop(true, true)
                .animate({
                width: percent + "vw",
            }, SlowTimer.get() ? 0 : 1000, "linear");
        }
        else if (config_1.default.timerStyle === "text") {
            let displayTime = Misc.secondsToString(maxtime - time);
            if (maxtime === 0) {
                displayTime = Misc.secondsToString(time);
            }
            if (timerNumberElement !== null) {
                timerNumberElement.innerHTML = "<div>" + displayTime + "</div>";
            }
        }
        else if (config_1.default.timerStyle === "mini") {
            let displayTime = Misc.secondsToString(maxtime - time);
            if (maxtime === 0) {
                displayTime = Misc.secondsToString(time);
            }
            if (miniTimerNumberElement !== null) {
                miniTimerNumberElement.innerHTML = displayTime;
            }
        }
    }
    else if (config_1.default.mode === "words" ||
        config_1.default.mode === "custom" ||
        config_1.default.mode === "quote") {
        let outof = TestWords.words.length;
        if (config_1.default.mode === "words") {
            outof = config_1.default.words;
        }
        if (config_1.default.mode === "custom") {
            if (CustomText.isWordRandom) {
                outof = CustomText.word;
            }
            else {
                outof = CustomText.text.length;
            }
        }
        if (config_1.default.mode === "quote") {
            outof = (_c = (_b = (_a = TestWords.randomQuote) === null || _a === void 0 ? void 0 : _a.textSplit) === null || _b === void 0 ? void 0 : _b.length) !== null && _c !== void 0 ? _c : 1;
        }
        if (config_1.default.timerStyle === "bar") {
            const percent = Math.floor(((TestWords.words.currentIndex + 1) / outof) * 100);
            $("#timer")
                .stop(true, true)
                .animate({
                width: percent + "vw",
            }, SlowTimer.get() ? 0 : 250);
        }
        else if (config_1.default.timerStyle === "text") {
            if (outof === 0) {
                if (timerNumberElement !== null) {
                    timerNumberElement.innerHTML =
                        "<div>" + `${TestInput.input.history.length}` + "</div>";
                }
            }
            else {
                if (timerNumberElement !== null) {
                    timerNumberElement.innerHTML =
                        "<div>" + `${TestInput.input.history.length}/${outof}` + "</div>";
                }
            }
        }
        else if (config_1.default.timerStyle === "mini") {
            if (config_1.default.words === 0) {
                if (miniTimerNumberElement !== null) {
                    miniTimerNumberElement.innerHTML = `${TestInput.input.history.length}`;
                }
            }
            else {
                if (miniTimerNumberElement !== null) {
                    miniTimerNumberElement.innerHTML = `${TestInput.input.history.length}/${outof}`;
                }
            }
        }
    }
    else if (config_1.default.mode == "zen") {
        if (config_1.default.timerStyle === "text") {
            if (timerNumberElement !== null) {
                timerNumberElement.innerHTML =
                    "<div>" + `${TestInput.input.history.length}` + "</div>";
            }
        }
        else {
            if (miniTimerNumberElement !== null) {
                miniTimerNumberElement.innerHTML = `${TestInput.input.history.length}`;
            }
        }
    }
}
exports.update = update;
function updateStyle() {
    if (!TestActive.get())
        return;
    hide();
    update();
    setTimeout(() => {
        show();
    }, 125);
}
exports.updateStyle = updateStyle;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "showTimerProgress") {
        if (eventValue === true && TestActive.get()) {
            show();
        }
        else {
            hide();
        }
    }
    if (eventKey === "timerStyle")
        updateStyle();
});


/***/ }),

/***/ "./src/scripts/test/today-tracker.ts":
/*!*******************************************!*\
  !*** ./src/scripts/test/today-tracker.ts ***!
  \*******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.addAllFromToday = exports.getString = exports.addSeconds = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
let seconds = 0;
let addedAllToday = false;
let dayToday;
function addSeconds(s) {
    if (addedAllToday) {
        const nowDate = new Date().getDate();
        if (nowDate > dayToday) {
            seconds = s;
            return;
        }
    }
    seconds += s;
}
exports.addSeconds = addSeconds;
function getString() {
    const secString = Misc.secondsToString(Math.round(seconds), true, true);
    return secString + (addedAllToday === true ? " today" : " session");
}
exports.getString = getString;
function addAllFromToday() {
    const todayDate = new Date();
    todayDate.setSeconds(0);
    todayDate.setMinutes(0);
    todayDate.setHours(0);
    todayDate.setMilliseconds(0);
    dayToday = todayDate.getDate();
    const todayDateMS = todayDate.getTime();
    seconds = 0;
    const results = DB.getSnapshot().results;
    results === null || results === void 0 ? void 0 : results.forEach((result) => {
        const resultDate = new Date(result.timestamp);
        resultDate.setSeconds(0);
        resultDate.setMinutes(0);
        resultDate.setHours(0);
        resultDate.setMilliseconds(0);
        const resultDateMS = resultDate.getTime();
        if (resultDateMS >= todayDateMS) {
            seconds +=
                result.testDuration + result.incompleteTestSeconds - result.afkDuration;
        }
    });
    addedAllToday = true;
}
exports.addAllFromToday = addAllFromToday;


/***/ }),

/***/ "./src/scripts/test/tts.ts":
/*!*********************************!*\
  !*** ./src/scripts/test/tts.ts ***!
  \*********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.speak = exports.clear = exports.init = exports.setLanguage = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
let voice;
function setLanguage(lang = config_1.default.language) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!voice)
            return;
        const language = yield Misc.getLanguage(lang);
        const bcp = language.bcp47 ? language.bcp47 : "en-US";
        voice.lang = bcp;
    });
}
exports.setLanguage = setLanguage;
function init() {
    return __awaiter(this, void 0, void 0, function* () {
        voice = new SpeechSynthesisUtterance();
        setLanguage();
    });
}
exports.init = init;
function clear() {
    voice = undefined;
}
exports.clear = clear;
function speak(text) {
    window.speechSynthesis.cancel();
    if (voice === undefined)
        init();
    if (voice !== undefined) {
        voice.text = text;
        window.speechSynthesis.speak(voice);
    }
}
exports.speak = speak;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "funbox") {
        if (eventValue === "none") {
            clear();
        }
        else if (eventValue === "tts") {
            init();
        }
    }
    if (eventKey === "language" && config_1.default.funbox === "tts")
        setLanguage();
});


/***/ }),

/***/ "./src/scripts/test/weak-spot.ts":
/*!***************************************!*\
  !*** ./src/scripts/test/weak-spot.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getWord = exports.updateScore = void 0;
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
// Changes how quickly it 'learns' scores - very roughly the score for a char
// is based on last perCharCount occurrences. Make it smaller to adjust faster.
const perCharCount = 50;
// Choose the highest scoring word from this many random words. Higher values
// will choose words with more weak letters on average.
const wordSamples = 20;
// Score penatly (in milliseconds) for getting a letter wrong.
const incorrectPenalty = 5000;
const scores = {};
class Score {
    constructor() {
        this.average = 0.0;
        this.count = 0;
    }
    update(score) {
        if (this.count < perCharCount) {
            this.count++;
        }
        const adjustRate = 1.0 / this.count;
        // Keep an exponential moving average of the score over time.
        this.average = score * adjustRate + this.average * (1 - adjustRate);
    }
}
function updateScore(char, isCorrect) {
    const timings = TestInput.keypressTimings.spacing.array;
    if (timings.length === 0 || typeof timings === "string") {
        return;
    }
    let score = timings[timings.length - 1];
    if (!isCorrect) {
        score += incorrectPenalty;
    }
    if (!(char in scores)) {
        scores[char] = new Score();
    }
    scores[char].update(score);
}
exports.updateScore = updateScore;
function score(word) {
    let total = 0.0;
    let numChars = 0;
    for (const c of word) {
        if (c in scores) {
            total += scores[c].average;
            numChars++;
        }
    }
    return numChars == 0 ? 0.0 : total / numChars;
}
function getWord(wordset) {
    let highScore;
    let randomWord = "";
    for (let i = 0; i < wordSamples; i++) {
        const newWord = wordset.randomWord();
        const newScore = score(newWord);
        if (i == 0 || highScore === undefined || newScore > highScore) {
            randomWord = newWord;
            highScore = newScore;
        }
    }
    return randomWord;
}
exports.getWord = getWord;


/***/ }),

/***/ "./src/scripts/test/wikipedia.ts":
/*!***************************************!*\
  !*** ./src/scripts/test/wikipedia.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getSection = exports.getTLD = exports.Section = void 0;
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
class Section {
    constructor(title, author, words) {
        this.title = title;
        this.author = author;
        this.words = words;
    }
}
exports.Section = Section;
function getTLD(languageGroup) {
    return __awaiter(this, void 0, void 0, function* () {
        // language group to tld
        switch (languageGroup.name) {
            case "english":
                return "en";
            case "spanish":
                return "es";
            case "french":
                return "fr";
            case "german":
                return "de";
            case "portuguese":
                return "pt";
            case "italian":
                return "it";
            case "dutch":
                return "nl";
            default:
                return "en";
        }
    });
}
exports.getTLD = getTLD;
function getSection(language) {
    return __awaiter(this, void 0, void 0, function* () {
        // console.log("Getting section");
        Loader.show();
        // get TLD for wikipedia according to language group
        let urlTLD = "en";
        const currentLanguageGroup = yield Misc.findCurrentGroup(language);
        if (currentLanguageGroup !== undefined) {
            urlTLD = yield getTLD(currentLanguageGroup);
        }
        const randomPostURL = `https://${urlTLD}.wikipedia.org/api/rest_v1/page/random/summary`;
        const sectionObj = { title: "", author: "" };
        const randomPostReq = yield fetch(randomPostURL);
        let pageid = 0;
        if (randomPostReq.status == 200) {
            const postObj = yield randomPostReq.json();
            sectionObj.title = postObj.title;
            sectionObj.author = postObj.author;
            pageid = postObj.pageid;
        }
        return new Promise((res, rej) => {
            if (randomPostReq.status != 200) {
                Loader.hide();
                rej(randomPostReq.status);
            }
            const sectionURL = `https://${urlTLD}.wikipedia.org/w/api.php?action=query&format=json&pageids=${pageid}&prop=extracts&exintro=true&origin=*`;
            const sectionReq = new XMLHttpRequest();
            sectionReq.onload = () => {
                if (sectionReq.readyState == 4) {
                    if (sectionReq.status == 200) {
                        let sectionText = JSON.parse(sectionReq.responseText).query
                            .pages[pageid.toString()].extract;
                        const words = [];
                        // Remove double whitespaces and finally trailing whitespaces.
                        sectionText = sectionText.replace(/<\/p><p>+/g, " ");
                        sectionText = $("<div/>").html(sectionText).text();
                        sectionText = sectionText.replace(/\s+/g, " ");
                        sectionText = sectionText.trim();
                        // // Add spaces
                        // sectionText = sectionText.replace(/[a-zA-Z0-9]{3,}\.[a-zA-Z]/g, (x) =>
                        //   x.replace(/\./, ". ")
                        // );
                        sectionText.split(" ").forEach((word) => {
                            words.push(word);
                        });
                        const section = new Section(sectionObj.title, sectionObj.author, words);
                        Loader.hide();
                        res(section);
                    }
                    else {
                        Loader.hide();
                        rej(sectionReq.status);
                    }
                }
            };
            sectionReq.open("GET", sectionURL);
            sectionReq.send();
        });
    });
}
exports.getSection = getSection;


/***/ }),

/***/ "./src/scripts/test/wordset.ts":
/*!*************************************!*\
  !*** ./src/scripts/test/wordset.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.withWords = exports.Wordset = void 0;
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
let currentWordset = null;
let currentWordGenerator = null;
class Wordset {
    constructor(words) {
        this.words = words;
        this.length = this.words.length;
    }
    randomWord() {
        return (0, misc_1.randomElementFromArray)(this.words);
    }
}
exports.Wordset = Wordset;
const prefixSize = 2;
class CharDistribution {
    constructor() {
        this.chars = {};
        this.count = 0;
    }
    addChar(char) {
        this.count++;
        if (char in this.chars) {
            this.chars[char]++;
        }
        else {
            this.chars[char] = 1;
        }
    }
    randomChar() {
        const randomIndex = (0, misc_1.randomIntFromRange)(0, this.count - 1);
        let runningCount = 0;
        for (const [char, charCount] of Object.entries(this.chars)) {
            runningCount += charCount;
            if (runningCount > randomIndex) {
                return char;
            }
        }
        return Object.keys(this.chars)[0];
    }
}
class WordGenerator extends Wordset {
    constructor(words) {
        super(words);
        this.ngrams = {};
        // Can generate an unbounded number of words in theory.
        this.length = Infinity;
        for (let word of words) {
            // Mark the end of each word with a space.
            word += " ";
            let prefix = "";
            for (const c of word) {
                // Add `c` to the distribution of chars that can come after `prefix`.
                if (!(prefix in this.ngrams)) {
                    this.ngrams[prefix] = new CharDistribution();
                }
                this.ngrams[prefix].addChar(c);
                prefix = (prefix + c).substr(-prefixSize);
            }
        }
    }
    randomWord() {
        let word = "";
        for (;;) {
            const prefix = word.substr(-prefixSize);
            const charDistribution = this.ngrams[prefix];
            if (!charDistribution) {
                // This shouldn't happen if this.ngrams is complete. If it does
                // somehow, start generating a new word.
                word = "";
                continue;
            }
            // Pick a random char from the distribution that comes after `prefix`.
            const nextChar = charDistribution.randomChar();
            if (nextChar == " ") {
                // A space marks the end of the word, so stop generating and return.
                break;
            }
            word += nextChar;
        }
        return word;
    }
}
function withWords(words, funbox) {
    if (funbox == "pseudolang") {
        if (currentWordGenerator == null || words !== currentWordGenerator.words) {
            currentWordGenerator = new WordGenerator(words);
        }
        return currentWordGenerator;
    }
    else {
        if (currentWordset == null || words !== currentWordset.words) {
            currentWordset = new Wordset(words);
        }
        return currentWordset;
    }
}
exports.withWords = withWords;


/***/ }),

/***/ "./src/scripts/ui.ts":
/*!***************************!*\
  !*** ./src/scripts/ui.ts ***!
  \***************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateKeytips = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ./config */ "./src/scripts/config.ts"));
const Caret = __importStar(__webpack_require__(/*! ./test/caret */ "./src/scripts/test/caret.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./elements/notifications */ "./src/scripts/elements/notifications.ts"));
const CustomText = __importStar(__webpack_require__(/*! ./test/custom-text */ "./src/scripts/test/custom-text.ts"));
const TestActive = __importStar(__webpack_require__(/*! ./states/test-active */ "./src/scripts/states/test-active.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ./observables/config-event */ "./src/scripts/observables/config-event.ts"));
function updateKeytips() {
    if (config_1.default.swapEscAndTab) {
        $(".pageSettings .tip").html(`
    tip: You can also change all these settings quickly using the
    command line (
    <key>tab</key>
    )`);
        $("#bottom .keyTips").html(`
    <key>esc</key> - restart test<br>
      <key>tab</key> - command line`);
    }
    else {
        $(".pageSettings .tip").html(`
    tip: You can also change all these settings quickly using the
    command line (
    <key>esc</key>
    )`);
        $("#bottom .keyTips").html(`
    <key>tab</key> - restart test<br>
      <key>esc</key> or <key>ctrl/cmd</key>+<key>shift</key>+<key>p</key> - command line`);
    }
}
exports.updateKeytips = updateKeytips;
if (window.location.hostname === "localhost") {
    window.onerror = function (error) {
        Notifications.add(error.toString(), -1);
    };
    $("#top .logo .top").text("localhost");
    $("head title").text($("head title").text() + " (localhost)");
    $("body").append(`<div class="devIndicator tl">local</div><div class="devIndicator br">local</div>`);
    $(".pageSettings .discordIntegration .buttons a").attr("href", "https://discord.com/api/oauth2/authorize?client_id=798272335035498557&redirect_uri=http%3A%2F%2Flocalhost%3A5000%2Fverify&response_type=token&scope=identify");
}
//stop space scrolling
window.addEventListener("keydown", function (e) {
    if (e.code === "Space" && e.target === document.body) {
        e.preventDefault();
    }
});
window.addEventListener("beforeunload", (event) => {
    // Cancel the event as stated by the standard.
    if ((config_1.default.mode === "words" && config_1.default.words < 1000) ||
        (config_1.default.mode === "time" && config_1.default.time < 3600) ||
        config_1.default.mode === "quote" ||
        (config_1.default.mode === "custom" &&
            CustomText.isWordRandom &&
            CustomText.word < 1000) ||
        (config_1.default.mode === "custom" &&
            CustomText.isTimeRandom &&
            CustomText.time < 1000) ||
        (config_1.default.mode === "custom" &&
            !CustomText.isWordRandom &&
            CustomText.text.length < 1000)) {
        //ignore
    }
    else {
        if (TestActive.get()) {
            event.preventDefault();
            // Chrome requires returnValue to be set.
            event.returnValue = "";
        }
    }
});
$(window).on("resize", () => {
    console.log("Updating caret position");
    Caret.updatePosition();
});
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "swapEscAndTab")
        updateKeytips();
});


/***/ }),

/***/ "./src/scripts/utils/debounce.ts":
/*!***************************************!*\
  !*** ./src/scripts/utils/debounce.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.debounce = void 0;
function debounce(fn, ms = 250) {
    let timeoutId;
    return function (...args) {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => fn.apply(this, args), ms);
    };
}
exports.debounce = debounce;


/***/ }),

/***/ "./src/scripts/utils/misc.ts":
/*!***********************************!*\
  !*** ./src/scripts/utils/misc.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.regexIndexOf = exports.setCharAt = exports.clearTimeouts = exports.canQuickRestart = exports.mapRange = exports.isUsernameValid = exports.cleanTypographySymbols = exports.escapeRegExp = exports.remove_non_ascii = exports.getWords = exports.toggleFullscreen = exports.objectToQueryString = exports.findGetParameter = exports.getPositionString = exports.getArrows = exports.getASCII = exports.getSpecials = exports.getNumbers = exports.secondsToString = exports.getGibberish = exports.findLineByLeastSquares = exports.roundTo2 = exports.whorf = exports.kogasa = exports.isASCIILetter = exports.capitalizeFirstLetterOfEachWord = exports.getLastChar = exports.getReleasesFromGitHub = exports.median = exports.mean = exports.stdDev = exports.smooth = exports.getChallengeList = exports.findCurrentGroup = exports.getCurrentLanguage = exports.getLanguage = exports.getLanguageGroups = exports.getLanguageList = exports.getContributorsList = exports.getSupportersList = exports.getFontsList = exports.getLayout = exports.getLayoutsList = exports.getFunbox = exports.getFunboxList = exports.getSortedThemesList = exports.getThemesList = exports.isColorDark = exports.isColorLight = exports.getuid = void 0;
exports.createErrorMessage = exports.randomElementFromObject = exports.randomElementFromArray = exports.shuffle = exports.randomIntFromRange = exports.downloadResultsCSV = exports.getMode2 = exports.swapElements = exports.convertRemToPixels = exports.trailingComposeChars = exports.convertRGBtoHEX = void 0;
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
function getuid() {
    var _a;
    console.error("Only share this uid with Miodec and nobody else!");
    console.log((_a = firebase_1.Auth.currentUser) === null || _a === void 0 ? void 0 : _a.uid);
    console.error("Only share this uid with Miodec and nobody else!");
}
exports.getuid = getuid;
function hexToHSL(hex) {
    // Convert hex to RGB first
    let r;
    let g;
    let b;
    if (hex.length == 4) {
        r = ("0x" + hex[1] + hex[1]);
        g = ("0x" + hex[2] + hex[2]);
        b = ("0x" + hex[3] + hex[3]);
    }
    else if (hex.length == 7) {
        r = ("0x" + hex[1] + hex[2]);
        g = ("0x" + hex[3] + hex[4]);
        b = ("0x" + hex[5] + hex[6]);
    }
    else {
        r = 0x00;
        g = 0x00;
        b = 0x00;
    }
    // Then to HSL
    r /= 255;
    g /= 255;
    b /= 255;
    const cmin = Math.min(r, g, b);
    const cmax = Math.max(r, g, b);
    const delta = cmax - cmin;
    let h = 0;
    let s = 0;
    let l = 0;
    if (delta == 0)
        h = 0;
    else if (cmax == r)
        h = ((g - b) / delta) % 6;
    else if (cmax == g)
        h = (b - r) / delta + 2;
    else
        h = (r - g) / delta + 4;
    h = Math.round(h * 60);
    if (h < 0)
        h += 360;
    l = (cmax + cmin) / 2;
    s = delta == 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));
    s = +(s * 100).toFixed(1);
    l = +(l * 100).toFixed(1);
    return {
        hue: h,
        sat: s,
        lgt: l,
        string: "hsl(" + h + "," + s + "%," + l + "%)",
    };
}
function isColorLight(hex) {
    const hsl = hexToHSL(hex);
    return hsl.lgt >= 50;
}
exports.isColorLight = isColorLight;
function isColorDark(hex) {
    const hsl = hexToHSL(hex);
    return hsl.lgt < 50;
}
exports.isColorDark = isColorDark;
let themesList = [];
function getThemesList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (themesList.length == 0) {
            return $.getJSON("themes/_list.json", function (data) {
                const list = data.sort(function (a, b) {
                    const nameA = a.name.toLowerCase();
                    const nameB = b.name.toLowerCase();
                    if (nameA < nameB)
                        return -1;
                    if (nameA > nameB)
                        return 1;
                    return 0;
                });
                themesList = list;
                return themesList;
            });
        }
        else {
            return themesList;
        }
    });
}
exports.getThemesList = getThemesList;
let sortedThemesList = [];
function getSortedThemesList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (sortedThemesList.length === 0) {
            if (themesList.length === 0) {
                yield getThemesList();
            }
            let sorted = [...themesList];
            sorted = sorted.sort((a, b) => {
                const b1 = hexToHSL(a.bgColor);
                const b2 = hexToHSL(b.bgColor);
                return b2.lgt - b1.lgt;
            });
            sortedThemesList = sorted;
            return sortedThemesList;
        }
        else {
            return sortedThemesList;
        }
    });
}
exports.getSortedThemesList = getSortedThemesList;
let funboxList = [];
function getFunboxList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (funboxList.length === 0) {
            return $.getJSON("funbox/_list.json", function (data) {
                funboxList = data.sort(function (a, b) {
                    const nameA = a.name.toLowerCase();
                    const nameB = b.name.toLowerCase();
                    if (nameA < nameB)
                        return -1;
                    if (nameA > nameB)
                        return 1;
                    return 0;
                });
                return funboxList;
            });
        }
        else {
            return funboxList;
        }
    });
}
exports.getFunboxList = getFunboxList;
function getFunbox(funbox) {
    return __awaiter(this, void 0, void 0, function* () {
        const list = yield getFunboxList();
        return list.find(function (element) {
            return element.name == funbox;
        });
    });
}
exports.getFunbox = getFunbox;
let layoutsList = {};
function getLayoutsList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (Object.keys(layoutsList).length === 0) {
            return $.getJSON("layouts/_list.json", function (data) {
                layoutsList = data;
                return layoutsList;
            });
        }
        else {
            return layoutsList;
        }
    });
}
exports.getLayoutsList = getLayoutsList;
function getLayout(layoutName) {
    return __awaiter(this, void 0, void 0, function* () {
        if (Object.keys(layoutsList).length === 0) {
            yield getLayoutsList();
        }
        return layoutsList[layoutName];
    });
}
exports.getLayout = getLayout;
let fontsList = [];
function getFontsList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (fontsList.length === 0) {
            return $.getJSON("fonts/_list.json", function (data) {
                fontsList = data.sort(function (a, b) {
                    const nameA = a.name.toLowerCase();
                    const nameB = b.name.toLowerCase();
                    if (nameA < nameB)
                        return -1;
                    if (nameA > nameB)
                        return 1;
                    return 0;
                });
                return fontsList;
            });
        }
        else {
            return fontsList;
        }
    });
}
exports.getFontsList = getFontsList;
let supportersList = [];
function getSupportersList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (supportersList.length === 0) {
            return $.getJSON("about/supporters.json", function (data) {
                supportersList = data;
                return supportersList;
            });
        }
        else {
            return supportersList;
        }
    });
}
exports.getSupportersList = getSupportersList;
let contributorsList = [];
function getContributorsList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (contributorsList.length === 0) {
            return $.getJSON("about/contributors.json", function (data) {
                contributorsList = data;
                return contributorsList;
            });
        }
        else {
            return contributorsList;
        }
    });
}
exports.getContributorsList = getContributorsList;
let languageList = [];
function getLanguageList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (languageList.length === 0) {
            return $.getJSON("languages/_list.json", function (data) {
                languageList = data;
                return languageList;
            });
        }
        else {
            return languageList;
        }
    });
}
exports.getLanguageList = getLanguageList;
let languageGroupList = [];
function getLanguageGroups() {
    return __awaiter(this, void 0, void 0, function* () {
        if (languageGroupList.length === 0) {
            return $.getJSON("languages/_groups.json", function (data) {
                languageGroupList = data;
                return languageGroupList;
            });
        }
        else {
            return languageGroupList;
        }
    });
}
exports.getLanguageGroups = getLanguageGroups;
let currentLanguage;
function getLanguage(lang) {
    return __awaiter(this, void 0, void 0, function* () {
        try {
            if (currentLanguage == undefined || currentLanguage.name !== lang) {
                console.log("getting language json");
                yield $.getJSON(`languages/${lang}.json`, function (data) {
                    currentLanguage = data;
                });
            }
            return currentLanguage;
        }
        catch (e) {
            console.error(`error getting language`);
            console.error(e);
            yield $.getJSON(`languages/english.json`, function (data) {
                currentLanguage = data;
            });
            return currentLanguage;
        }
    });
}
exports.getLanguage = getLanguage;
function getCurrentLanguage(languageName) {
    return __awaiter(this, void 0, void 0, function* () {
        return yield getLanguage(languageName);
    });
}
exports.getCurrentLanguage = getCurrentLanguage;
function findCurrentGroup(language) {
    return __awaiter(this, void 0, void 0, function* () {
        let retgroup;
        const groups = yield getLanguageGroups();
        groups.forEach((group) => {
            if (retgroup === undefined) {
                if (group.languages.includes(language)) {
                    retgroup = group;
                }
            }
        });
        return retgroup;
    });
}
exports.findCurrentGroup = findCurrentGroup;
let challengeList = [];
function getChallengeList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (challengeList.length === 0) {
            return $.getJSON("challenges/_list.json", function (data) {
                challengeList = data;
                return challengeList;
            });
        }
        else {
            return challengeList;
        }
    });
}
exports.getChallengeList = getChallengeList;
function smooth(arr, windowSize, getter = (value) => value) {
    const get = getter;
    const result = [];
    for (let i = 0; i < arr.length; i += 1) {
        const leftOffeset = i - windowSize;
        const from = leftOffeset >= 0 ? leftOffeset : 0;
        const to = i + windowSize + 1;
        let count = 0;
        let sum = 0;
        for (let j = from; j < to && j < arr.length; j += 1) {
            sum += get(arr[j]);
            count += 1;
        }
        result[i] = sum / count;
    }
    return result;
}
exports.smooth = smooth;
function stdDev(array) {
    try {
        const n = array.length;
        const mean = array.reduce((a, b) => a + b) / n;
        return Math.sqrt(array.map((x) => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / n);
    }
    catch (e) {
        return 0;
    }
}
exports.stdDev = stdDev;
function mean(array) {
    try {
        return (array.reduce((previous, current) => (current += previous)) / array.length);
    }
    catch (e) {
        return 0;
    }
}
exports.mean = mean;
//https://www.w3resource.com/javascript-exercises/fundamental/javascript-fundamental-exercise-88.php
function median(arr) {
    try {
        const mid = Math.floor(arr.length / 2), nums = [...arr].sort((a, b) => a - b);
        return arr.length % 2 !== 0 ? nums[mid] : (nums[mid - 1] + nums[mid]) / 2;
    }
    catch (e) {
        return 0;
    }
}
exports.median = median;
function getReleasesFromGitHub() {
    return __awaiter(this, void 0, void 0, function* () {
        return $.getJSON("https://api.github.com/repos/Miodec/monkeytype/releases", (data) => {
            $("#bottom .version .text").text(data[0].name);
            $("#bottom .version").css("opacity", 1);
            $("#versionHistory .releases").empty();
            data.forEach((release) => {
                if (!release.draft && !release.prerelease) {
                    $("#versionHistory .releases").append(`
          <div class="release">
            <div class="title">${release.name}</div>
            <div class="date">${(0, format_1.default)(new Date(release.published_at), "dd MMM yyyy")}</div>
            <div class="body">${release.body.replace(/\r\n/g, "<br>")}</div>
          </div>
        `);
                }
            });
        });
    });
}
exports.getReleasesFromGitHub = getReleasesFromGitHub;
// function getPatreonNames() {
//   let namesel = $(".pageAbout .section .supporters");
//   firebase
//     .functions()
//     .httpsCallable("getPatreons")()
//     .then((data) => {
//       let names = data.data;
//       names.forEach((name) => {
//         namesel.append(`<div>${name}</div>`);
//       });
//     });
// }
function getLastChar(word) {
    try {
        return word.charAt(word.length - 1);
    }
    catch (_a) {
        return "";
    }
}
exports.getLastChar = getLastChar;
function capitalizeFirstLetterOfEachWord(str) {
    return str
        .split(/ +/)
        .map((s) => s.charAt(0).toUpperCase() + s.slice(1))
        .join(" ");
}
exports.capitalizeFirstLetterOfEachWord = capitalizeFirstLetterOfEachWord;
function isASCIILetter(c) {
    return c.length === 1 && /[a-z]/i.test(c);
}
exports.isASCIILetter = isASCIILetter;
function kogasa(cov) {
    return (100 * (1 - Math.tanh(cov + Math.pow(cov, 3) / 3 + Math.pow(cov, 5) / 5)));
}
exports.kogasa = kogasa;
function whorf(speed, wordlen) {
    return Math.min(speed, Math.floor(speed * Math.pow(1.03, -2 * (wordlen - 3))));
}
exports.whorf = whorf;
function roundTo2(num) {
    return Math.round((num + Number.EPSILON) * 100) / 100;
}
exports.roundTo2 = roundTo2;
function findLineByLeastSquares(values_y) {
    let sum_x = 0;
    let sum_y = 0;
    let sum_xy = 0;
    let sum_xx = 0;
    let count = 0;
    /*
     * We'll use those letiables for faster read/write access.
     */
    let x = 0;
    let y = 0;
    const values_length = values_y.length;
    /*
     * Nothing to do.
     */
    if (values_length === 0) {
        return [[], []];
    }
    /*
     * Calculate the sum for each of the parts necessary.
     */
    for (let v = 0; v < values_length; v++) {
        x = v + 1;
        y = values_y[v];
        sum_x += x;
        sum_y += y;
        sum_xx += x * x;
        sum_xy += x * y;
        count++;
    }
    /*
     * Calculate m and b for the formular:
     * y = x * m + b
     */
    const m = (count * sum_xy - sum_x * sum_y) / (count * sum_xx - sum_x * sum_x);
    const b = sum_y / count - (m * sum_x) / count;
    const returnpoint1 = [1, 1 * m + b];
    const returnpoint2 = [values_length, values_length * m + b];
    return [returnpoint1, returnpoint2];
}
exports.findLineByLeastSquares = findLineByLeastSquares;
function getGibberish() {
    const randLen = randomIntFromRange(1, 7);
    let ret = "";
    for (let i = 0; i < randLen; i++) {
        ret += String.fromCharCode(97 + randomIntFromRange(0, 25));
    }
    return ret;
}
exports.getGibberish = getGibberish;
function secondsToString(sec, alwaysShowMinutes = false, alwaysShowHours = false, delimiter = ":", showSeconds = true, showDays = false) {
    sec = Math.abs(sec);
    let days = 0;
    let hours;
    if (showDays) {
        days = Math.floor(sec / 86400);
        hours = Math.floor((sec % 86400) / 3600);
    }
    else {
        hours = Math.floor(sec / 3600);
    }
    const minutes = Math.floor((sec % 3600) / 60);
    const seconds = roundTo2((sec % 3600) % 60);
    let daysString;
    let hoursString;
    let minutesString;
    let secondsString;
    if (showDays) {
        days < 10 && delimiter !== "text"
            ? (daysString = "0" + days)
            : (daysString = days);
    }
    hours < 10 && delimiter !== "text"
        ? (hoursString = "0" + hours)
        : (hoursString = hours);
    minutes < 10 && delimiter !== "text"
        ? (minutesString = "0" + minutes)
        : (minutesString = minutes);
    seconds < 10 &&
        (minutes > 0 || hours > 0 || alwaysShowMinutes) &&
        delimiter !== "text"
        ? (secondsString = "0" + seconds)
        : (secondsString = seconds);
    let ret = "";
    if (days > 0 && showDays) {
        ret += daysString;
        if (delimiter === "text") {
            if (days == 1) {
                ret += " day ";
            }
            else {
                ret += " days ";
            }
        }
        else {
            ret += delimiter;
        }
    }
    if (hours > 0 || alwaysShowHours) {
        ret += hoursString;
        if (delimiter === "text") {
            if (hours == 1) {
                ret += " hour ";
            }
            else {
                ret += " hours ";
            }
        }
        else {
            ret += delimiter;
        }
    }
    if (minutes > 0 || hours > 0 || alwaysShowMinutes) {
        ret += minutesString;
        if (delimiter === "text") {
            if (minutes == 1) {
                ret += " minute ";
            }
            else {
                ret += " minutes ";
            }
        }
        else if (showSeconds) {
            ret += delimiter;
        }
    }
    if (showSeconds) {
        ret += secondsString;
        if (delimiter === "text") {
            if (seconds == 1) {
                ret += " second";
            }
            else {
                ret += " seconds";
            }
        }
    }
    if (hours === 0 && minutes === 0 && !showSeconds && delimiter === "text") {
        ret = "less than 1 minute";
    }
    return ret.trim();
}
exports.secondsToString = secondsToString;
function getNumbers(len) {
    const randLen = randomIntFromRange(1, len);
    let ret = "";
    for (let i = 0; i < randLen; i++) {
        const randomNum = randomIntFromRange(0, 9);
        ret += randomNum.toString();
    }
    return ret;
}
exports.getNumbers = getNumbers;
function getSpecials() {
    const randLen = randomIntFromRange(1, 7);
    let ret = "";
    const specials = [
        "!",
        "@",
        "#",
        "$",
        "%",
        "^",
        "&",
        "*",
        "(",
        ")",
        "-",
        "_",
        "=",
        "+",
        "{",
        "}",
        "[",
        "]",
        "'",
        '"',
        "/",
        "\\",
        "|",
    ];
    for (let i = 0; i < randLen; i++) {
        ret += randomElementFromArray(specials);
    }
    return ret;
}
exports.getSpecials = getSpecials;
function getASCII() {
    const randLen = randomIntFromRange(1, 10);
    let ret = "";
    for (let i = 0; i < randLen; i++) {
        let ran = 33 + randomIntFromRange(0, 93);
        while (ran == 96 || ran == 94)
            ran = 33 + randomIntFromRange(0, 93); //todo remove when input rewrite is fixed
        ret += String.fromCharCode(ran);
    }
    return ret;
}
exports.getASCII = getASCII;
function getArrows() {
    const arrowArray = ["", "", "", ""];
    let arrowWord = "";
    let lastchar;
    for (let i = 0; i < 5; i++) {
        let random = randomElementFromArray(arrowArray);
        while (random === lastchar) {
            random = randomElementFromArray(arrowArray);
        }
        lastchar = random;
        arrowWord += random;
    }
    return arrowWord;
}
exports.getArrows = getArrows;
function getPositionString(number) {
    let numend = "th";
    const t = number % 10;
    const h = number % 100;
    if (t == 1 && h != 11) {
        numend = "st";
    }
    if (t == 2 && h != 12) {
        numend = "nd";
    }
    if (t == 3 && h != 13) {
        numend = "rd";
    }
    return number + numend;
}
exports.getPositionString = getPositionString;
function findGetParameter(parameterName) {
    let result = null;
    let tmp = [];
    location.search
        .substr(1)
        .split("&")
        .forEach(function (item) {
        tmp = item.split("=");
        if (tmp[0] === parameterName)
            result = decodeURIComponent(tmp[1]);
    });
    return result;
}
exports.findGetParameter = findGetParameter;
function objectToQueryString(obj) {
    const str = [];
    for (const p in obj) {
        if (Object.prototype.hasOwnProperty.call(obj, p)) {
            // Arrays get encoded as a comma(%2C)-separated list
            str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
        }
    }
    return str.join("&");
}
exports.objectToQueryString = objectToQueryString;
function toggleFullscreen() {
    const elem = document.documentElement;
    if (!document.fullscreenElement &&
        !document.mozFullScreenElement &&
        !document.webkitFullscreenElement &&
        !document.msFullscreenElement) {
        if (elem.requestFullscreen) {
            elem.requestFullscreen();
        }
        else if (elem.msRequestFullscreen) {
            elem.msRequestFullscreen();
        }
        else if (elem.mozRequestFullScreen) {
            elem.mozRequestFullScreen();
        }
        else if (elem.webkitRequestFullscreen) {
            // @ts-ignore
            elem.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
        }
    }
    else {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        }
        else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
        else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        }
        else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
        }
    }
}
exports.toggleFullscreen = toggleFullscreen;
function getWords() {
    const words = [...document.querySelectorAll("#words .word")]
        .map((word) => {
        return [...word.querySelectorAll("letter")]
            .map((letter) => letter.textContent)
            .join("");
    })
        .join(" ");
    return words;
}
exports.getWords = getWords;
//credit: https://www.w3resource.com/javascript-exercises/javascript-string-exercise-32.php
function remove_non_ascii(str) {
    if (str === null || str === "")
        return "";
    else
        str = str.toString();
    return str.replace(/[^\x20-\x7E]/g, "");
}
exports.remove_non_ascii = remove_non_ascii;
function escapeRegExp(str) {
    return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
}
exports.escapeRegExp = escapeRegExp;
function cleanTypographySymbols(textToClean) {
    const specials = {
        "": '"',
        "": '"',
        "": "'",
        "": "'",
        ",": ",",
        "": "-",
        "": "...",
        "": "<<",
        "": ">>",
        "": "-",
        "": " ",
        "": " ",
        "": " ",
    };
    return textToClean.replace(/[,\u2007\u202F\u00A0]/g, (char) => specials[char] || "");
}
exports.cleanTypographySymbols = cleanTypographySymbols;
function isUsernameValid(name) {
    if (name === null || name === undefined || name === "")
        return false;
    if (/miodec/.test(name.toLowerCase()))
        return false;
    if (/bitly/.test(name.toLowerCase()))
        return false;
    if (name.length > 14)
        return false;
    if (/^\..*/.test(name.toLowerCase()))
        return false;
    return /^[0-9a-zA-Z_.-]+$/.test(name);
}
exports.isUsernameValid = isUsernameValid;
function mapRange(x, in_min, in_max, out_min, out_max) {
    let num = ((x - in_min) * (out_max - out_min)) / (in_max - in_min) + out_min;
    if (out_min > out_max) {
        if (num > out_min) {
            num = out_min;
        }
        else if (num < out_max) {
            num = out_max;
        }
    }
    else {
        if (num < out_min) {
            num = out_min;
        }
        else if (num > out_max) {
            num = out_max;
        }
    }
    return num;
}
exports.mapRange = mapRange;
function canQuickRestart(mode, words, time, CustomText) {
    if ((mode === "words" && words < 1000) ||
        (mode === "time" && time < 3600) ||
        mode === "quote" ||
        (mode === "custom" && CustomText.isWordRandom && CustomText.word < 1000) ||
        (mode === "custom" && CustomText.isTimeRandom && CustomText.time < 3600) ||
        (mode === "custom" &&
            !CustomText.isWordRandom &&
            CustomText.text.length < 1000)) {
        return true;
    }
    else {
        return false;
    }
}
exports.canQuickRestart = canQuickRestart;
function clearTimeouts(timeouts) {
    timeouts.forEach((to) => {
        if (typeof to === "number")
            clearTimeout(to);
        else
            clearTimeout(to);
    });
}
exports.clearTimeouts = clearTimeouts;
//https://stackoverflow.com/questions/1431094/how-do-i-replace-a-character-at-a-particular-index-in-javascript
function setCharAt(str, index, chr) {
    if (index > str.length - 1)
        return str;
    return str.substring(0, index) + chr + str.substring(index + 1);
}
exports.setCharAt = setCharAt;
//https://stackoverflow.com/questions/273789/is-there-a-version-of-javascripts-string-indexof-that-allows-for-regular-expr
function regexIndexOf(string, regex, startpos) {
    const indexOf = string.substring(startpos || 0).search(regex);
    return indexOf >= 0 ? indexOf + (startpos || 0) : indexOf;
}
exports.regexIndexOf = regexIndexOf;
function convertRGBtoHEX(rgb) {
    const match = rgb.match(/^rgb\((\d+), \s*(\d+), \s*(\d+)\)$/);
    if (match === null)
        return;
    if (match.length < 3)
        return;
    function hexCode(i) {
        // Take the last 2 characters and convert
        // them to Hexadecimal.
        return ("0" + parseInt(i).toString(16)).slice(-2);
    }
    return "#" + hexCode(match[1]) + hexCode(match[2]) + hexCode(match[3]);
}
exports.convertRGBtoHEX = convertRGBtoHEX;
String.prototype.lastIndexOfRegex = function (regex) {
    const match = this.match(regex);
    return match ? this.lastIndexOf(match[match.length - 1]) : -1;
};
exports.trailingComposeChars = /[\u02B0-\u02FF`^~]+$|.*$/;
//https://stackoverflow.com/questions/36532307/rem-px-in-javascript
function convertRemToPixels(rem) {
    return rem * parseFloat(getComputedStyle(document.documentElement).fontSize);
}
exports.convertRemToPixels = convertRemToPixels;
function swapElements(el1, el2, totalDuration, callback = function () {
    return;
}, middleCallback = function () {
    return;
}) {
    if ((el1.hasClass("hidden") && !el2.hasClass("hidden")) ||
        (!el1.hasClass("hidden") && el2.hasClass("hidden"))) {
        //one of them is hidden and the other is visible
        if (el1.hasClass("hidden")) {
            callback();
            return false;
        }
        $(el1)
            .removeClass("hidden")
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, totalDuration / 2, () => {
            middleCallback();
            $(el1).addClass("hidden");
            $(el2)
                .removeClass("hidden")
                .css("opacity", 0)
                .animate({
                opacity: 1,
            }, totalDuration / 2, () => {
                callback();
            });
        });
    }
    else if (el1.hasClass("hidden") && el2.hasClass("hidden")) {
        //both are hidden, only fade in the second
        $(el2)
            .removeClass("hidden")
            .css("opacity", 0)
            .animate({
            opacity: 1,
        }, totalDuration, () => {
            callback();
        });
    }
    else {
        callback();
    }
    return;
}
exports.swapElements = swapElements;
function getMode2(config, randomQuote) {
    const mode = config.mode;
    if (mode === "time") {
        return config.time.toString();
    }
    else if (mode === "words") {
        return config.words.toString();
    }
    else if (mode === "custom") {
        return "custom";
    }
    else if (mode === "zen") {
        return "zen";
    }
    else if (mode === "quote") {
        return randomQuote.id.toString();
    }
    return "";
}
exports.getMode2 = getMode2;
function downloadResultsCSV(array) {
    return __awaiter(this, void 0, void 0, function* () {
        Loader.show();
        const csvString = [
            [
                "_id",
                "isPb",
                "wpm",
                "acc",
                "rawWpm",
                "consistency",
                "charStats",
                "mode",
                "mode2",
                "quoteLength",
                "restartCount",
                "testDuration",
                "afkDuration",
                "incompleteTestSeconds",
                "punctuation",
                "numbers",
                "language",
                "funbox",
                "difficulty",
                "lazyMode",
                "blindMode",
                "bailedOut",
                "tags",
                "timestamp",
            ],
            ...array.map((item) => [
                item._id,
                item.isPb,
                item.wpm,
                item.acc,
                item.rawWpm,
                item.consistency,
                item.charStats.join(","),
                item.mode,
                item.mode2,
                item.quoteLength,
                item.restartCount,
                item.testDuration,
                item.afkDuration,
                item.incompleteTestSeconds,
                item.punctuation,
                item.numbers,
                item.language,
                item.funbox,
                item.difficulty,
                item.lazyMode,
                item.blindMode,
                item.bailedOut,
                item.tags.join(","),
                item.timestamp,
            ]),
        ]
            .map((e) => e.join("|"))
            .join("\n");
        const blob = new Blob([csvString], { type: "text/csv" });
        const href = window.URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.setAttribute("href", href);
        link.setAttribute("download", "results.csv");
        document.body.appendChild(link); // Required for FF
        link.click();
        link.remove();
        Loader.hide();
    });
}
exports.downloadResultsCSV = downloadResultsCSV;
/**
 * Gets an integer between min and max, both are inclusive.
 * @param min
 * @param max
 * @returns Random integer betwen min and max.
 */
function randomIntFromRange(min, max) {
    const minNorm = Math.ceil(min);
    const maxNorm = Math.floor(max);
    return Math.floor(Math.random() * (maxNorm - minNorm + 1) + minNorm);
}
exports.randomIntFromRange = randomIntFromRange;
/**
 * Shuffle an array of elements using the FisherYates algorithm.
 * This function mutates the input array.
 * @param elements
 */
function shuffle(elements) {
    for (let i = elements.length - 1; i > 0; --i) {
        const j = randomIntFromRange(0, i);
        const temp = elements[j];
        elements[j] = elements[i];
        elements[i] = temp;
    }
}
exports.shuffle = shuffle;
function randomElementFromArray(array) {
    return array[randomIntFromRange(0, array.length - 1)];
}
exports.randomElementFromArray = randomElementFromArray;
function randomElementFromObject(object) {
    return randomElementFromArray(Object.values(object));
}
exports.randomElementFromObject = randomElementFromObject;
function createErrorMessage(error, message) {
    if (error instanceof Error)
        return `${message}: ${error.message}`;
    return `${message}`;
}
exports.createErrorMessage = createErrorMessage;


/***/ }),

/***/ "./src/scripts/utils/search-service.ts":
/*!*********************************************!*\
  !*** ./src/scripts/utils/search-service.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.buildSearchService = void 0;
const stemmer_1 = __webpack_require__(/*! stemmer */ "./node_modules/stemmer/index.js");
const damerau_levenshtein_1 = __importDefault(__webpack_require__(/*! damerau-levenshtein */ "./node_modules/damerau-levenshtein/index.js"));
const DEFAULT_OPTIONS = {
    fuzzyMatchSensitivity: 0.2,
    scoreForSimilarMatch: 0.5,
    scoreForExactMatch: 1, // When ranking results, the score a match gets for having an exact match with a token in the search query.
};
function inverseDocumentFrequency(numberOfDocuments, numberOfDocumentsWithTerm) {
    if (numberOfDocumentsWithTerm === 0) {
        return 0;
    }
    return Math.log10(numberOfDocuments / numberOfDocumentsWithTerm);
}
function tokenize(text) {
    return text.match(/[^\\\][.,"/#!?$%^&*;:{}=\-_`~()\s]+/g) || [];
}
const buildSearchService = (documents, getSearchableText, options = DEFAULT_OPTIONS) => {
    const reverseIndex = {};
    const normalizedTokenToOriginal = {};
    documents.forEach((document, documentIndex) => {
        const rawTokens = tokenize(getSearchableText(document));
        const internalDocument = {
            id: documentIndex,
        };
        rawTokens.forEach((token) => {
            const stemmedToken = (0, stemmer_1.stemmer)(token);
            if (!(stemmedToken in normalizedTokenToOriginal)) {
                normalizedTokenToOriginal[stemmedToken] = new Set();
            }
            normalizedTokenToOriginal[stemmedToken].add(token);
            if (!(stemmedToken in reverseIndex)) {
                reverseIndex[stemmedToken] = new Set();
            }
            reverseIndex[stemmedToken].add(internalDocument);
        });
    });
    const tokenSet = Object.keys(reverseIndex);
    const query = (searchQuery) => {
        const searchResult = {
            results: [],
            matchedQueryTerms: [],
        };
        const normalizedSearchQuery = new Set(tokenize(searchQuery).map((token) => (0, stemmer_1.stemmer)(token)));
        if (normalizedSearchQuery.size === 0) {
            return searchResult;
        }
        const results = new Map();
        const matchedTokens = new Set();
        normalizedSearchQuery.forEach((searchToken) => {
            tokenSet.forEach((token) => {
                const { similarity } = (0, damerau_levenshtein_1.default)(searchToken, token);
                const matchesSearchToken = token === searchToken;
                const isSimilar = similarity >= 1 - options.fuzzyMatchSensitivity;
                if (matchesSearchToken || isSimilar) {
                    const documentMatches = reverseIndex[token];
                    const idf = inverseDocumentFrequency(documents.length, documentMatches.size);
                    documentMatches.forEach((document) => {
                        var _a;
                        const currentScore = (_a = results.get(document.id)) !== null && _a !== void 0 ? _a : 0;
                        const scoreForExactMatch = matchesSearchToken
                            ? options.scoreForExactMatch
                            : 0;
                        const scoreForSimilarity = isSimilar
                            ? options.scoreForSimilarMatch
                            : 0;
                        const score = scoreForExactMatch + scoreForSimilarity;
                        const scoreForToken = score * idf;
                        results.set(document.id, currentScore + scoreForToken);
                    });
                    normalizedTokenToOriginal[token].forEach((originalToken) => {
                        matchedTokens.add(originalToken);
                    });
                }
            });
        });
        const orderedResults = [...results]
            .sort((match1, match2) => {
            return match2[1] - match1[1];
        })
            .map((match) => documents[match[0]]);
        searchResult.results = orderedResults;
        searchResult.matchedQueryTerms = [...matchedTokens];
        return searchResult;
    };
    return {
        query,
    };
};
exports.buildSearchService = buildSearchService;


/***/ }),

/***/ "./src/scripts/utils/strings.ts":
/*!**************************************!*\
  !*** ./src/scripts/utils/strings.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.splitByAndKeep = void 0;
/**
 *
 * @param text String to split
 * @param delimiters Single character delimiters.
 */
function splitByAndKeep(text, delimiters) {
    const splitString = [];
    let currentToken = [];
    const delimiterSet = new Set(delimiters);
    for (const char of text) {
        if (delimiterSet.has(char)) {
            if (currentToken.length > 0) {
                splitString.push(currentToken.join(""));
            }
            splitString.push(char);
            currentToken = [];
        }
        else {
            currentToken.push(char);
        }
    }
    if (currentToken.length > 0) {
        splitString.push(currentToken.join(""));
    }
    return splitString;
}
exports.splitByAndKeep = splitByAndKeep;


/***/ }),

/***/ "./src/scripts/utils/url-handler.ts":
/*!******************************************!*\
  !*** ./src/scripts/utils/url-handler.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.loadCustomThemeFromUrl = void 0;
const Misc = __importStar(__webpack_require__(/*! ./misc */ "./src/scripts/utils/misc.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function loadCustomThemeFromUrl() {
    var _a;
    const getValue = Misc.findGetParameter("customTheme");
    if (getValue === null)
        return;
    const urlEncoded = getValue.split(",");
    let base64decoded = null;
    try {
        base64decoded = JSON.parse((_a = atob(getValue)) !== null && _a !== void 0 ? _a : "");
    }
    catch (e) {
        //
    }
    let colorArray = [];
    if (Array.isArray(urlEncoded) && urlEncoded.length === 9) {
        colorArray = urlEncoded;
    }
    else if (Array.isArray(base64decoded) && base64decoded.length === 9) {
        colorArray = base64decoded;
    }
    if (colorArray.length === 0) {
        return Notifications.add("Invalid custom theme ", 0);
    }
    const oldCustomTheme = config_1.default.customTheme;
    const oldCustomThemeColors = config_1.default.customThemeColors;
    try {
        UpdateConfig.setCustomThemeColors(colorArray);
        Notifications.add("Custom theme applied", 1);
        if (!config_1.default.customTheme)
            UpdateConfig.setCustomTheme(true);
    }
    catch (e) {
        Notifications.add("Something went wrong. Reverting to previous state.", 0);
        console.error(e);
        UpdateConfig.setCustomTheme(oldCustomTheme);
        UpdateConfig.setCustomThemeColors(oldCustomThemeColors);
    }
}
exports.loadCustomThemeFromUrl = loadCustomThemeFromUrl;


/***/ }),

/***/ "./src/scripts/version.ts":
/*!********************************!*\
  !*** ./src/scripts/version.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CLIENT_VERSION = void 0;
exports.CLIENT_VERSION = "DEVELOPMENT-CLIENT";
$(document.body).on("click", ".version", (e) => {
    if (e.shiftKey) {
        alert(exports.CLIENT_VERSION);
    }
});


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = __webpack_modules__;
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/chunk loaded */
/******/ 	(() => {
/******/ 		var deferred = [];
/******/ 		__webpack_require__.O = (result, chunkIds, fn, priority) => {
/******/ 			if(chunkIds) {
/******/ 				priority = priority || 0;
/******/ 				for(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];
/******/ 				deferred[i] = [chunkIds, fn, priority];
/******/ 				return;
/******/ 			}
/******/ 			var notFulfilled = Infinity;
/******/ 			for (var i = 0; i < deferred.length; i++) {
/******/ 				var [chunkIds, fn, priority] = deferred[i];
/******/ 				var fulfilled = true;
/******/ 				for (var j = 0; j < chunkIds.length; j++) {
/******/ 					if ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {
/******/ 						chunkIds.splice(j--, 1);
/******/ 					} else {
/******/ 						fulfilled = false;
/******/ 						if(priority < notFulfilled) notFulfilled = priority;
/******/ 					}
/******/ 				}
/******/ 				if(fulfilled) {
/******/ 					deferred.splice(i--, 1)
/******/ 					var r = fn();
/******/ 					if (r !== undefined) result = r;
/******/ 				}
/******/ 			}
/******/ 			return result;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/global */
/******/ 	(() => {
/******/ 		__webpack_require__.g = (function() {
/******/ 			if (typeof globalThis === 'object') return globalThis;
/******/ 			try {
/******/ 				return this || new Function('return this')();
/******/ 			} catch (e) {
/******/ 				if (typeof window === 'object') return window;
/******/ 			}
/******/ 		})();
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/jsonp chunk loading */
/******/ 	(() => {
/******/ 		// no baseURI
/******/ 		
/******/ 		// object to store loaded and loading chunks
/******/ 		// undefined = chunk not loaded, null = chunk preloaded/prefetched
/******/ 		// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded
/******/ 		var installedChunks = {
/******/ 			"monkeytype": 0
/******/ 		};
/******/ 		
/******/ 		// no chunk on demand loading
/******/ 		
/******/ 		// no prefetching
/******/ 		
/******/ 		// no preloaded
/******/ 		
/******/ 		// no HMR
/******/ 		
/******/ 		// no HMR manifest
/******/ 		
/******/ 		__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);
/******/ 		
/******/ 		// install a JSONP callback for chunk loading
/******/ 		var webpackJsonpCallback = (parentChunkLoadingFunction, data) => {
/******/ 			var [chunkIds, moreModules, runtime] = data;
/******/ 			// add "moreModules" to the modules object,
/******/ 			// then flag all "chunkIds" as loaded and fire callback
/******/ 			var moduleId, chunkId, i = 0;
/******/ 			if(chunkIds.some((id) => (installedChunks[id] !== 0))) {
/******/ 				for(moduleId in moreModules) {
/******/ 					if(__webpack_require__.o(moreModules, moduleId)) {
/******/ 						__webpack_require__.m[moduleId] = moreModules[moduleId];
/******/ 					}
/******/ 				}
/******/ 				if(runtime) var result = runtime(__webpack_require__);
/******/ 			}
/******/ 			if(parentChunkLoadingFunction) parentChunkLoadingFunction(data);
/******/ 			for(;i < chunkIds.length; i++) {
/******/ 				chunkId = chunkIds[i];
/******/ 				if(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {
/******/ 					installedChunks[chunkId][0]();
/******/ 				}
/******/ 				installedChunks[chunkId] = 0;
/******/ 			}
/******/ 			return __webpack_require__.O(result);
/******/ 		}
/******/ 		
/******/ 		var chunkLoadingGlobal = self["webpackChunkmonkeytype_frontend"] = self["webpackChunkmonkeytype_frontend"] || [];
/******/ 		chunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));
/******/ 		chunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module depends on other loaded chunks and execution need to be delayed
/******/ 	var __webpack_exports__ = __webpack_require__.O(undefined, ["vendor"], () => (__webpack_require__("./src/scripts/index.ts")))
/******/ 	__webpack_exports__ = __webpack_require__.O(__webpack_exports__);
/******/ 	
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHVDQUF1Qyx3QkFBd0Isa0RBQWtEO0FBQzdILFlBQVksdUNBQXVDLHdCQUF3QixrRUFBa0U7QUFDN0ksWUFBWSxTQUFTO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHVDQUF1Qyx3QkFBd0Isa0RBQWtEO0FBQzdILFlBQVksdUNBQXVDLHdCQUF3QixrRUFBa0U7QUFDN0ksWUFBWSxTQUFTO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHVDQUF1Qyx3QkFBd0Isa0RBQWtEO0FBQzdILFlBQVksdUNBQXVDLHdCQUF3QixrRUFBa0U7QUFDN0ksWUFBWSxTQUFTO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHVDQUF1Qyx3QkFBd0Isa0RBQWtEO0FBQzdILFlBQVksdUNBQXVDLHdCQUF3QixrRUFBa0U7QUFDN0ksWUFBWSxTQUFTO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSx1Q0FBdUMsd0JB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QXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFD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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLE9BQU87QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9EQUFvRDtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0MscUNBQXFDO0FBQzdFLHdDQUF3QyxxQ0FBcUM7QUFDN0U7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0Esd0NBQXdDLHFDQUFxQztBQUM3RSx3Q0FBd0MscUNBQXFDO0FBQzdFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHdDQUF3QyxxQ0FBcUM7QUFDN0Usd0NBQXdDLHFDQUFxQztBQUM3RTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLHFDQUFxQztBQUM3RSx3Q0FBd0Msc0NBQXNDO0FBQzlFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHdDQUF3QyxxQ0FBcUM7QUFDN0Usd0NBQXdDLHNDQUFzQztBQUM5RTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSx3Q0FBd0MscUNBQXFDO0FBQzdFLHdDQUF3QyxzQ0FBc0M7QUFDOUU7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0Esd0NBQXdDLHFDQUFxQztBQUM3RSx3Q0FBd0Msc0NBQXNDO0FBQzlFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHdDQUF3QyxxQ0FBcUM7QUFDN0Usd0NBQXdDLHNDQUFzQztBQUM5RTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSx3Q0FBd0MscUNBQXFDO0FBQzdFLHdDQUF3QyxzQ0FBc0M7QUFDOUU7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxxQ0FBcUM7QUFDN0Usd0NBQXdDLHNDQUFzQztBQUM5RTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSx3Q0FBd0MscUNBQXFDO0FBQzdFLHdDQUF3QyxzQ0FBc0M7QUFDOUU7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0Esd0NBQXdDLHFDQUFxQztBQUM3RSx3Q0FBd0Msc0NBQXNDO0FBQzlFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHdDQUF3QyxxQ0FBcUM7QUFDN0Usd0NB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QUFDVDtBQUNBO0FBQ0E7QUFDQSxJQUFJLGtDQUFrQztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnRkFBZ0YsUUFBUTtBQUN4RjtBQUNBO0FBQ0E7QUFDQSxnRkFBZ0YsUUFBUTtBQUN4RjtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksb0NBQW9DO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLO0FBQ0wsQ0FBQztBQUNELDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSwwQkFBMEI7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCLHFCQUFxQjtBQUNyQjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQSxJQUFJLGVBQWU7QUFDbkI7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7Ozs7Ozs7Ozs7O0FDdnNHWTtBQUNiO0FBQ0E7QUFDQSxtQ0FBbUMsb0NBQW9DLGdCQUFnQjtBQUN2RixDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLDBDQUEwQyw0QkFBNEI7QUFDdEUsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELFlBQVksR0FBRyxxQ0FBcUM7QUFDcEQscUNBQXFDLG1CQUFPLENBQUMsc0ZBQWlDO0FBQzlFLDhCQUE4QixtQkFBTyxDQUFDLDBDQUFXO0FBQ2pELDJCQUEyQixtQkFBTyxDQUFDLGtEQUFlO0FBQ2xELHNDQUFzQyxtQkFBTyxDQUFDLHdFQUFxQjtBQUNuRSw0QkFBNEIsbUJBQU8sQ0FBQyxzREFBaUI7QUFDckQsd0JBQXdCLG1CQUFPLENBQUMsa0NBQU87QUFDdkMsbUNBQW1DLG1CQUFPLENBQUMsMEVBQTJCO0FBQ3RFLHlDQUF5QyxtQkFBTyxDQUFDLDhGQUFxQztBQUN0RixvQ0FBb0MsbUJBQU8sQ0FBQywwRUFBMkI7QUFDdkUsbUJBQW1CLG1CQUFPLENBQUMsOENBQWE7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRCxLQUFLO0FBQ3JEO0FBQ0E7QUFDQSw4Q0FBOEMsS0FBSztBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRCxLQUFLO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBLDJEQUEyRCxPQUFPLElBQUksU0FBUyxPQUFPLFlBQVk7QUFDbEc7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDJDQUEyQyxzQkFBc0I7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscURBQXFEO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EscURBQXFELFNBQVM7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0Q7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksWUFBWTtBQUNoQjtBQUNBO0FBQ0E7QUFDQSxJQUFJLFlBQVk7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxxREFBcUQsZ0VBQWdFO0FBQ3JIO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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UztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzREFBc0Q7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxREFBcUQseUJBQXlCO0FBQzlFLHVEQUF1RCxVQUFVLEdBQUcsMkRBQTJEO0FBQy9IO0FBQ0EsUUFBUSx1Q0FBdUM7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0dBQWdHO0FBQ2hHLHFHQUFxRyxFQUFFLCtDQUErQztBQUN0SjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQsRUFBRTtBQUN6RDtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsNEJBQTRCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxNQUFNO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLGlCQUFpQixNQUFNO0FBQ3ZCLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRCxZ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QSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLFlBQVk7QUFDbkM7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLFlBQVk7QUFDL0I7QUFDQSxLQUFLO0FBQ0w7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixZQUFZO0FBQ25DO0FBQ0EsU0FBUztBQUNUO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNELHdCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0QsdUJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNELDJCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRCw0QkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0QsMEJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNB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O0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsOENBQThDLHVCQUF1QjtBQUNyRTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLDBCQUEwQjtBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSx3QkFBd0I7Ozs7Ozs7Ozs7O0FDMU9YO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsK0NBQStDO0FBQ3JFO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEM7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQzs7Ozs7Ozs7Ozs7QUN2VFk7QUFDYjtBQUNB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTRELGFBQWE7QUFDekU7QUFDQTtBQUNBLG9EQUFvRCxhQUFhO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0RBQWdEO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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QUFDQSwwQkFBMEIsNEJBQTRCO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMseUJBQXlCO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyx1QkFBdUIsRUFBRSxPQUFPLEVBQUUsNkNBQTZDLEVBQUUsT0FBTztBQUN2STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsaUJBQWlCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUM7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLGdCQUFnQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLGtEQUFrRDtBQUMxRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixnQkFBZ0I7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxpRUFBaUUsd0JBQXdCO0FBQ3JJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlCQUFpQjtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQix3Q0FBd0M7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDLFdBQVc7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDZCQUE2QjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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LENBQUMsNEVBQTRCO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixvQkFBb0I7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLFFBQVE7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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eUNBQXlDLHdDQUF3QztXQUNqRjtXQUNBO1dBQ0E7Ozs7O1dDUEE7V0FDQTtXQUNBO1dBQ0E7V0FDQSxHQUFHO1dBQ0g7V0FDQTtXQUNBLENBQUM7Ozs7O1dDUEQ7Ozs7O1dDQUE7V0FDQTtXQUNBO1dBQ0EsdURBQXVELGlCQUFpQjtXQUN4RTtXQUNBLGdEQUFnRCxhQUFhO1dBQzdEOzs7OztXQ05BOztXQUVBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTs7V0FFQTs7V0FFQTs7V0FFQTs7V0FFQTs7V0FFQTs7V0FFQTs7V0FFQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQSxNQUFNLHFCQUFxQjtXQUMzQjtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBOztXQUVBO1dBQ0E7V0FDQTs7Ozs7VUVoREE7VUFDQTtVQUNBO1VBQ0E7VUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc3R5bGVzL2luZGV4LnNjc3M/ODZlYyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvYWNjb3VudC9hbGwtdGltZS1zdGF0cy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvYWNjb3VudC9taW5pLXJlc3VsdC1jaGFydC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvYWNjb3VudC9wYi10YWJsZXMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2FjY291bnQvcmVzdWx0LWZpbHRlcnMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2FjY291bnQvc2lnbi1vdXQtYnV0dG9uLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9hcGUvZW5kcG9pbnRzL2FwZS1rZXlzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9hcGUvZW5kcG9pbnRzL2NvbmZpZ3MudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2FwZS9lbmRwb2ludHMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2FwZS9lbmRwb2ludHMvbGVhZGVyYm9hcmRzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9hcGUvZW5kcG9pbnRzL3ByZXNldHMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2FwZS9lbmRwb2ludHMvcHNhcy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvYXBlL2VuZHBvaW50cy9xdW90ZXMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2FwZS9lbmRwb2ludHMvcmVzdWx0cy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvYXBlL2VuZHBvaW50cy91c2Vycy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvYXBlL2luZGV4LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb25maWctdmFsaWRhdGlvbi50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29uZmlnLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb25zdGFudHMvZGVmYXVsdC1jb25maWcudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbnN0YW50cy9kZWZhdWx0LXNuYXBzaG90LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb25zdGFudHMvZmlyZWJhc2UtY29uZmlnLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb250cm9sbGVycy9hY2NvdW50LWNvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbnRyb2xsZXJzL2FuYWx5dGljcy1jb250cm9sbGVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb250cm9sbGVycy9jaGFsbGVuZ2UtY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29udHJvbGxlcnMvY2hhcnQtY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29udHJvbGxlcnMvaW5wdXQtY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29udHJvbGxlcnMvcGFnZS1jb250cm9sbGVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb250cm9sbGVycy9wcmVzZXQtY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29udHJvbGxlcnMvcXVvdGVzLWNvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbnRyb2xsZXJzL3JvdXRlLWNvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbnRyb2xsZXJzL3NvdW5kLWNvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbnRyb2xsZXJzL3RhZy1jb250cm9sbGVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb250cm9sbGVycy90aGVtZS1jb250cm9sbGVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb250cm9sbGVycy92ZXJpZmljYXRpb24tY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvZGIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2VsZW1lbnRzL2FjY291bnQtYnV0dG9uLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9lbGVtZW50cy9jb21tYW5kbGluZS1saXN0cy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvZWxlbWVudHMvY29tbWFuZGxpbmUudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2VsZW1lbnRzL2N1c3RvbS1iYWNrZ3JvdW5kLWZpbHRlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvZWxlbWVudHMva2V5bWFwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9lbGVtZW50cy9sYXN0LTEwLWF2ZXJhZ2UudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2VsZW1lbnRzL2xlYWRlcmJvYXJkcy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvZWxlbWVudHMvbG9hZGVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9lbGVtZW50cy9tb2Rlcy1ub3RpY2UudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2VsZW1lbnRzL21vbmtleS1wb3dlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvZWxlbWVudHMvbm90aWZpY2F0aW9ucy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvZWxlbWVudHMvcHNhLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9lbGVtZW50cy9zY3JvbGwtdG8tdG9wLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9lbGVtZW50cy90aGVtZS1jb2xvcnMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2VsZW1lbnRzL3ZlcnNpb24tY2hlY2sudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2ZpcmViYXNlLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9pbmRleC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9vYnNlcnZhYmxlcy9wYWdlLWNoYW5nZS1ldmVudC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvb2JzZXJ2YWJsZXMvcmVzZXQtcmVxdWVzdGVkLWV2ZW50LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9vYnNlcnZhYmxlcy9yZXN1bHRzLXNob3duLWV2ZW50LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9vYnNlcnZhYmxlcy90aW1lci1ldmVudC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvb2JzZXJ2YWJsZXMvd29yZC10eXBlZC1ldmVudC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcGFnZXMvYWJvdXQudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BhZ2VzL2FjY291bnQudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BhZ2VzL2xvYWRpbmcudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BhZ2VzL2xvZ2luLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wYWdlcy9wYWdlLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wYWdlcy9zZXR0aW5ncy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcGFnZXMvdGVzdC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL2FwZS1rZXlzLXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvY29udGFjdC1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL2N1c3RvbS10ZXN0LWR1cmF0aW9uLXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvY3VzdG9tLXRleHQtcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9jdXN0b20tdGhlbWUtcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9jdXN0b20td29yZC1hbW91bnQtcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9lZGl0LXByZXNldC1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL2VkaXQtdGFncy1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL2ltcG9ydC1leHBvcnQtc2V0dGluZ3MtcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9tb2JpbGUtdGVzdC1jb25maWctcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9wYi10YWJsZXMtcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9xdW90ZS1hcHByb3ZlLXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvcXVvdGUtcmF0ZS1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL3F1b3RlLXJlcG9ydC1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL3F1b3RlLXNlYXJjaC1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL3F1b3RlLXN1Ym1pdC1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL3Jlc3VsdC10YWdzLXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvc2F2ZWQtdGV4dHMtcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9zaW1wbGUtcG9wdXBzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvc3VwcG9ydC1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL3ZlcnNpb24tcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy93b3JkLWZpbHRlci1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcmVhZHkudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3NldHRpbmdzL3NldHRpbmdzLWdyb3VwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9zZXR0aW5ncy90aGVtZS1waWNrZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3N0YXRlcy9hY3RpdmUtcGFnZS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvc3RhdGVzL2dsYXJzZXMtbW9kZS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvc3RhdGVzL3BhZ2UtdHJhbnNpdGlvbi50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvc3RhdGVzL3Nsb3ctdGltZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3N0YXRlcy90ZXN0LWFjdGl2ZS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvc3RhdGVzL3RpbWUudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvYnJpdGlzaC1lbmdsaXNoLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L2NhcHMtd2FybmluZy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9jYXJldC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9jdXN0b20tdGV4dC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9mb2N1cy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9mdW5ib3gudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvbGF5b3V0LWVtdWxhdG9yLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L2xhenktbW9kZS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9saXZlLWFjYy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9saXZlLWJ1cnN0LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L2xpdmUtd3BtLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L21hbnVhbC1yZXN0YXJ0LXRyYWNrZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvbW9ua2V5LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L291dC1vZi1mb2N1cy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9wYWNlLWNhcmV0LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3BiLWNyb3duLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3BvZXRyeS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9wcmFjdGlzZS13b3Jkcy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9yZXBsYXkudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvcmVzdWx0LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3NoaWZ0LXRyYWNrZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvdGJkLW1vZGUudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvdGVzdC1jb25maWcudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvdGVzdC1pbnB1dC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC90ZXN0LWxvZ2ljLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3Rlc3Qtc3RhdGUudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvdGVzdC1zdGF0cy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC90ZXN0LXRpbWVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3Rlc3QtdWkudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvdGVzdC13b3Jkcy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC90aW1lci1wcm9ncmVzcy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC90b2RheS10cmFja2VyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3R0cy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC93ZWFrLXNwb3QudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3Qvd2lraXBlZGlhLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3dvcmRzZXQudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3VpLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy91dGlscy9kZWJvdW5jZS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdXRpbHMvbWlzYy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdXRpbHMvc2VhcmNoLXNlcnZpY2UudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3V0aWxzL3N0cmluZ3MudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3V0aWxzL3VybC1oYW5kbGVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy92ZXJzaW9uLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC93ZWJwYWNrL3J1bnRpbWUvY2h1bmsgbG9hZGVkIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvd2VicGFjay9ydW50aW1lL2dsb2JhbCIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvd2VicGFjay9ydW50aW1lL2pzb25wIGNodW5rIGxvYWRpbmciLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC93ZWJwYWNrL2JlZm9yZS1zdGFydHVwIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvd2VicGFjay9zdGFydHVwIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvd2VicGFjay9hZnRlci1zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGV4dHJhY3RlZCBieSBtaW5pLWNzcy1leHRyYWN0LXBsdWdpblxuZXhwb3J0IHt9OyIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZSA9IGV4cG9ydHMuY2xlYXIgPSB2b2lkIDA7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5mdW5jdGlvbiBjbGVhcigpIHtcbiAgICAkKFwiLnBhZ2VBY2NvdW50IC5nbG9iYWxUaW1lVHlwaW5nIC52YWxcIikudGV4dChgLWApO1xuICAgICQoXCIucGFnZUFjY291bnQgLmdsb2JhbFRlc3RzU3RhcnRlZCAudmFsXCIpLnRleHQoYC1gKTtcbiAgICAkKFwiLnBhZ2VBY2NvdW50IC5nbG9iYWxUZXN0c0NvbXBsZXRlZCAudmFsXCIpLnRleHQoYC1gKTtcbn1cbmV4cG9ydHMuY2xlYXIgPSBjbGVhcjtcbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGNvbnN0IHNuYXBzaG90ID0gREIuZ2V0U25hcHNob3QoKTtcbiAgICBpZiAoc25hcHNob3QuZ2xvYmFsU3RhdHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAvLyBsZXQgdGggPSBNYXRoLmZsb29yKERCLmdldFNuYXBzaG90KCkuZ2xvYmFsU3RhdHMudGltZSAvIDM2MDApO1xuICAgICAgICAvLyBsZXQgdG0gPSBNYXRoLmZsb29yKChEQi5nZXRTbmFwc2hvdCgpLmdsb2JhbFN0YXRzLnRpbWUgJSAzNjAwKSAvIDYwKTtcbiAgICAgICAgLy8gbGV0IHRzID0gTWF0aC5mbG9vcigoREIuZ2V0U25hcHNob3QoKS5nbG9iYWxTdGF0cy50aW1lICUgMzYwMCkgJSA2MCk7XG4gICAgICAgIGNvbnN0IHNlY29uZHMgPSAoX2IgPSAoX2EgPSBzbmFwc2hvdCA9PT0gbnVsbCB8fCBzbmFwc2hvdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogc25hcHNob3QuZ2xvYmFsU3RhdHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50aW1lKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAwO1xuICAgICAgICBsZXQgc3RyaW5nID0gXCJcIjtcbiAgICAgICAgaWYgKHNlY29uZHMgPT09IDApIHtcbiAgICAgICAgICAgIHN0cmluZyA9IFwiLVwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3RyaW5nID0gTWlzYy5zZWNvbmRzVG9TdHJpbmcoTWF0aC5yb3VuZChzZWNvbmRzKSwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuZ2xvYmFsVGltZVR5cGluZyAudmFsXCIpLnRleHQoc3RyaW5nKTtcbiAgICB9XG4gICAgaWYgKHNuYXBzaG90Lmdsb2JhbFN0YXRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuZ2xvYmFsVGVzdHNTdGFydGVkIC52YWxcIikudGV4dChzbmFwc2hvdC5nbG9iYWxTdGF0cy5zdGFydGVkKTtcbiAgICB9XG4gICAgaWYgKHNuYXBzaG90Lmdsb2JhbFN0YXRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuZ2xvYmFsVGVzdHNDb21wbGV0ZWQgLnZhbFwiKS50ZXh0KHNuYXBzaG90Lmdsb2JhbFN0YXRzLmNvbXBsZXRlZCk7XG4gICAgfVxufVxuZXhwb3J0cy51cGRhdGUgPSB1cGRhdGU7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51cGRhdGVEYXRhID0gZXhwb3J0cy5zaG93ID0gZXhwb3J0cy51cGRhdGVQb3NpdGlvbiA9IHZvaWQgMDtcbmNvbnN0IENoYXJ0Q29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvY2hhcnQtY29udHJvbGxlclwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IG1pbmlSZXN1bHRTY2FsZU9wdGlvbnMgPSBDaGFydENvbnRyb2xsZXIucmVzdWx0Lm9wdGlvbnMuc2NhbGVzO1xuZnVuY3Rpb24gdXBkYXRlUG9zaXRpb24oeCwgeSkge1xuICAgICQoXCIucGFnZUFjY291bnQgLm1pbmlSZXN1bHRDaGFydFdyYXBwZXJcIikuY3NzKHsgdG9wOiB5LCBsZWZ0OiB4IH0pO1xufVxuZXhwb3J0cy51cGRhdGVQb3NpdGlvbiA9IHVwZGF0ZVBvc2l0aW9uO1xuZnVuY3Rpb24gc2hvdygpIHtcbiAgICAkKFwiLnBhZ2VBY2NvdW50IC5taW5pUmVzdWx0Q2hhcnRXcmFwcGVyXCIpLnN0b3AodHJ1ZSwgdHJ1ZSkuZmFkZUluKDEyNSk7XG4gICAgJChcIi5wYWdlQWNjb3VudCAubWluaVJlc3VsdENoYXJ0QmdcIikuc3RvcCh0cnVlLCB0cnVlKS5mYWRlSW4oMTI1KTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgICQoXCIucGFnZUFjY291bnQgLm1pbmlSZXN1bHRDaGFydFdyYXBwZXJcIikuc3RvcCh0cnVlLCB0cnVlKS5mYWRlT3V0KDEyNSk7XG4gICAgJChcIi5wYWdlQWNjb3VudCAubWluaVJlc3VsdENoYXJ0QmdcIikuc3RvcCh0cnVlLCB0cnVlKS5mYWRlT3V0KDEyNSk7XG59XG5mdW5jdGlvbiB1cGRhdGVEYXRhKGRhdGEpIHtcbiAgICAvLyBsZXQgZGF0YSA9IGZpbHRlcmVkUmVzdWx0c1tmaWx0ZXJlZElkXS5jaGFydERhdGE7XG4gICAgY29uc3QgbGFiZWxzID0gW107XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gZGF0YS53cG0ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbGFiZWxzLnB1c2goaS50b1N0cmluZygpKTtcbiAgICB9XG4gICAgQ2hhcnRDb250cm9sbGVyLm1pbmlSZXN1bHQuZGF0YS5sYWJlbHMgPSBsYWJlbHM7XG4gICAgQ2hhcnRDb250cm9sbGVyLm1pbmlSZXN1bHQuZGF0YS5kYXRhc2V0c1swXS5kYXRhID0gZGF0YS53cG07XG4gICAgQ2hhcnRDb250cm9sbGVyLm1pbmlSZXN1bHQuZGF0YS5kYXRhc2V0c1sxXS5kYXRhID0gZGF0YS5yYXc7XG4gICAgQ2hhcnRDb250cm9sbGVyLm1pbmlSZXN1bHQuZGF0YS5kYXRhc2V0c1syXS5kYXRhID0gZGF0YS5lcnI7XG4gICAgY29uc3QgbWF4Q2hhcnRWYWwgPSBNYXRoLm1heCguLi5bTWF0aC5tYXgoLi4uZGF0YS53cG0pLCBNYXRoLm1heCguLi5kYXRhLnJhdyldKTtcbiAgICBjb25zdCBtaW5DaGFydFZhbCA9IE1hdGgubWluKC4uLltNYXRoLm1pbiguLi5kYXRhLndwbSksIE1hdGgubWluKC4uLmRhdGEucmF3KV0pO1xuICAgIG1pbmlSZXN1bHRTY2FsZU9wdGlvbnNbXCJ3cG1cIl0ubWF4ID0gTWF0aC5yb3VuZChtYXhDaGFydFZhbCk7XG4gICAgbWluaVJlc3VsdFNjYWxlT3B0aW9uc1tcInJhd1wiXS5tYXggPSBNYXRoLnJvdW5kKG1heENoYXJ0VmFsKTtcbiAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuc3RhcnRHcmFwaHNBdFplcm8pIHtcbiAgICAgICAgbWluaVJlc3VsdFNjYWxlT3B0aW9uc1tcIndwbVwiXS5taW4gPSBNYXRoLnJvdW5kKG1pbkNoYXJ0VmFsKTtcbiAgICAgICAgbWluaVJlc3VsdFNjYWxlT3B0aW9uc1tcInJhd1wiXS5taW4gPSBNYXRoLnJvdW5kKG1pbkNoYXJ0VmFsKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG1pbmlSZXN1bHRTY2FsZU9wdGlvbnNbXCJ3cG1cIl0ubWluID0gMDtcbiAgICAgICAgbWluaVJlc3VsdFNjYWxlT3B0aW9uc1tcInJhd1wiXS5taW4gPSAwO1xuICAgIH1cbiAgICBDaGFydENvbnRyb2xsZXIubWluaVJlc3VsdC51cGRhdGVDb2xvcnMoKTtcbn1cbmV4cG9ydHMudXBkYXRlRGF0YSA9IHVwZGF0ZURhdGE7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VBY2NvdW50IC5taW5pUmVzdWx0Q2hhcnRCZ1wiLCAoKSA9PiB7XG4gICAgaGlkZSgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51cGRhdGUgPSB2b2lkIDA7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IGZvcm1hdF8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJkYXRlLWZucy9mb3JtYXRcIikpO1xuZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgICQoXCIucGFnZUFjY291bnQgLnRpbWVQYlRhYmxlIHRib2R5XCIpLmh0bWwoYFxuICA8dHI+XG4gICAgPHRkPjE1PC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gIDwvdHI+XG4gIDx0cj5cbiAgICA8dGQ+MzA8L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgPC90cj5cbiAgPHRyPlxuICAgIDx0ZD42MDwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICA8L3RyPlxuICA8dHI+XG4gICAgPHRkPjEyMDwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICA8L3RyPlxuICBgKTtcbiAgICAkKFwiLnBhZ2VBY2NvdW50IC53b3Jkc1BiVGFibGUgdGJvZHlcIikuaHRtbChgXG4gIDx0cj5cbiAgICA8dGQ+MTA8L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgPC90cj5cbiAgPHRyPlxuICAgIDx0ZD4yNTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICA8L3RyPlxuICA8dHI+XG4gICAgPHRkPjUwPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gIDwvdHI+XG4gIDx0cj5cbiAgICA8dGQ+MTAwPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gIDwvdHI+XG4gIGApO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0pIHtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAudGltZVBiVGFibGUgdGhlYWQgdHIgdGQ6bnRoLWNoaWxkKDIpLCAucGFnZUFjY291bnQgLndvcmRzUGJUYWJsZSB0aGVhZCB0ciB0ZDpudGgtY2hpbGQoMilcIikuaHRtbCgnY3BtPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+YWNjdXJhY3k8L3NwYW4+Jyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC50aW1lUGJUYWJsZSB0aGVhZCB0ciB0ZDpudGgtY2hpbGQoMiksIC5wYWdlQWNjb3VudCAud29yZHNQYlRhYmxlIHRoZWFkIHRyIHRkOm50aC1jaGlsZCgyKVwiKS5odG1sKCd3cG08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj5hY2N1cmFjeTwvc3Bhbj4nKTtcbiAgICB9XG4gICAgY29uc3QgcGIgPSBEQi5nZXRTbmFwc2hvdCgpLnBlcnNvbmFsQmVzdHM7XG4gICAgaWYgKHBiID09PSB1bmRlZmluZWQpXG4gICAgICAgIHJldHVybjtcbiAgICBsZXQgcGJEYXRhO1xuICAgIGxldCB0ZXh0O1xuICAgIGxldCBkYXRlVGV4dCA9IGAtPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj5gO1xuICAgIGNvbnN0IG11bHRpcGxpZXIgPSBjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0gPyA1IDogMTtcbiAgICB0ZXh0ID0gXCJcIjtcbiAgICB0cnkge1xuICAgICAgICBwYkRhdGEgPSBwYi50aW1lWzE1XS5zb3J0KChhLCBiKSA9PiBiLndwbSAtIGEud3BtKVswXTtcbiAgICAgICAgZGF0ZVRleHQgPSBgLTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+YDtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHBiRGF0YS50aW1lc3RhbXApO1xuICAgICAgICBpZiAocGJEYXRhLnRpbWVzdGFtcCkge1xuICAgICAgICAgICAgZGF0ZVRleHQgPVxuICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcImRkIE1NTSB5eXl5XCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8YnI+PGRpdiBjbGFzcz0nc3ViJz5cIiArXG4gICAgICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcIkhIOm1tXCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8L2Rpdj5cIjtcbiAgICAgICAgfVxuICAgICAgICB0ZXh0ICs9IGA8dHI+XG4gICAgICA8dGQ+MTU8L3RkPlxuICAgICAgPHRkPiR7TWlzYy5yb3VuZFRvMihwYkRhdGEud3BtICogbXVsdGlwbGllcil9PGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYkRhdGEuYWNjID09PSB1bmRlZmluZWQgPyBcIi1cIiA6IHBiRGF0YS5hY2MgKyBcIiVcIn08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4ke01pc2Mucm91bmRUbzIocGJEYXRhLnJhdyAqIG11bHRpcGxpZXIpfTxicj48c3BhbiBjbGFzcz1cInN1YlwiPiR7cGJEYXRhLmNvbnNpc3RlbmN5ID09PSB1bmRlZmluZWQgPyBcIi1cIiA6IHBiRGF0YS5jb25zaXN0ZW5jeSArIFwiJVwifTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPiR7ZGF0ZVRleHR9PC90ZD5cbiAgICA8L3RyPmA7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHRleHQgKz0gYDx0cj5cbiAgICAgIDx0ZD4xNTwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgPC90cj5gO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBwYkRhdGEgPSBwYi50aW1lWzMwXS5zb3J0KChhLCBiKSA9PiBiLndwbSAtIGEud3BtKVswXTtcbiAgICAgICAgZGF0ZVRleHQgPSBgLTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+YDtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHBiRGF0YS50aW1lc3RhbXApO1xuICAgICAgICBpZiAocGJEYXRhLnRpbWVzdGFtcCkge1xuICAgICAgICAgICAgZGF0ZVRleHQgPVxuICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcImRkIE1NTSB5eXl5XCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8YnI+PGRpdiBjbGFzcz0nc3ViJz5cIiArXG4gICAgICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcIkhIOm1tXCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8L2Rpdj5cIjtcbiAgICAgICAgfVxuICAgICAgICB0ZXh0ICs9IGA8dHI+XG4gICAgPHRkPjMwPC90ZD5cbiAgICAgIDx0ZD4ke01pc2Mucm91bmRUbzIocGJEYXRhLndwbSAqIG11bHRpcGxpZXIpfTxicj48c3BhbiBjbGFzcz1cInN1YlwiPiR7cGJEYXRhLmFjYyA9PT0gdW5kZWZpbmVkID8gXCItXCIgOiBwYkRhdGEuYWNjICsgXCIlXCJ9PC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+JHtNaXNjLnJvdW5kVG8yKHBiRGF0YS5yYXcgKiBtdWx0aXBsaWVyKX08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiRGF0YS5jb25zaXN0ZW5jeSA9PT0gdW5kZWZpbmVkID8gXCItXCIgOiBwYkRhdGEuY29uc2lzdGVuY3kgKyBcIiVcIn08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4ke2RhdGVUZXh0fTwvdGQ+XG4gICAgPC90cj5gO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICB0ZXh0ICs9IGA8dHI+XG4gICAgICA8dGQ+MzA8L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgIDwvdHI+YDtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgcGJEYXRhID0gcGIudGltZVs2MF0uc29ydCgoYSwgYikgPT4gYi53cG0gLSBhLndwbSlbMF07XG4gICAgICAgIGRhdGVUZXh0ID0gYC08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPmA7XG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShwYkRhdGEudGltZXN0YW1wKTtcbiAgICAgICAgaWYgKHBiRGF0YS50aW1lc3RhbXApIHtcbiAgICAgICAgICAgIGRhdGVUZXh0ID1cbiAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJkZCBNTU0geXl5eVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPGJyPjxkaXYgY2xhc3M9J3N1Yic+XCIgK1xuICAgICAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJISDptbVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPC9kaXY+XCI7XG4gICAgICAgIH1cbiAgICAgICAgdGV4dCArPSBgPHRyPlxuICAgICAgPHRkPjYwPC90ZD5cbiAgICAgIDx0ZD4ke01pc2Mucm91bmRUbzIocGJEYXRhLndwbSAqIG11bHRpcGxpZXIpfTxicj48c3BhbiBjbGFzcz1cInN1YlwiPiR7cGJEYXRhLmFjYyA9PT0gdW5kZWZpbmVkID8gXCItXCIgOiBwYkRhdGEuYWNjICsgXCIlXCJ9PC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+JHtNaXNjLnJvdW5kVG8yKHBiRGF0YS5yYXcgKiBtdWx0aXBsaWVyKX08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiRGF0YS5jb25zaXN0ZW5jeSA9PT0gdW5kZWZpbmVkID8gXCItXCIgOiBwYkRhdGEuY29uc2lzdGVuY3kgKyBcIiVcIn08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4ke2RhdGVUZXh0fTwvdGQ+XG4gICAgPC90cj5gO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICB0ZXh0ICs9IGA8dHI+XG4gICAgICA8dGQ+NjA8L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgIDwvdHI+YDtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgcGJEYXRhID0gcGIudGltZVsxMjBdLnNvcnQoKGEsIGIpID0+IGIud3BtIC0gYS53cG0pWzBdO1xuICAgICAgICBkYXRlVGV4dCA9IGAtPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj5gO1xuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUocGJEYXRhLnRpbWVzdGFtcCk7XG4gICAgICAgIGlmIChwYkRhdGEudGltZXN0YW1wKSB7XG4gICAgICAgICAgICBkYXRlVGV4dCA9XG4gICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiZGQgTU1NIHl5eXlcIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjxicj48ZGl2IGNsYXNzPSdzdWInPlwiICtcbiAgICAgICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiSEg6bW1cIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjwvZGl2PlwiO1xuICAgICAgICB9XG4gICAgICAgIHRleHQgKz0gYDx0cj5cbiAgICAgIDx0ZD4xMjA8L3RkPlxuICAgICAgPHRkPiR7TWlzYy5yb3VuZFRvMihwYkRhdGEud3BtICogbXVsdGlwbGllcil9PGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYkRhdGEuYWNjID09PSB1bmRlZmluZWQgPyBcIi1cIiA6IHBiRGF0YS5hY2MgKyBcIiVcIn08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4ke01pc2Mucm91bmRUbzIocGJEYXRhLnJhdyAqIG11bHRpcGxpZXIpfTxicj48c3BhbiBjbGFzcz1cInN1YlwiPiR7cGJEYXRhLmNvbnNpc3RlbmN5ID09PSB1bmRlZmluZWQgPyBcIi1cIiA6IHBiRGF0YS5jb25zaXN0ZW5jeSArIFwiJVwifTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPiR7ZGF0ZVRleHR9PC90ZD5cbiAgICA8L3RyPmA7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHRleHQgKz0gYDx0cj5cbiAgICAgIDx0ZD4xMjA8L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgIDwvdHI+YDtcbiAgICB9XG4gICAgJChcIi5wYWdlQWNjb3VudCAudGltZVBiVGFibGUgdGJvZHlcIikuaHRtbCh0ZXh0KTtcbiAgICB0ZXh0ID0gXCJcIjtcbiAgICB0cnkge1xuICAgICAgICBwYkRhdGEgPSBwYi53b3Jkc1sxMF0uc29ydCgoYSwgYikgPT4gYi53cG0gLSBhLndwbSlbMF07XG4gICAgICAgIGRhdGVUZXh0ID0gYC08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPmA7XG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShwYkRhdGEudGltZXN0YW1wKTtcbiAgICAgICAgaWYgKHBiRGF0YS50aW1lc3RhbXApIHtcbiAgICAgICAgICAgIGRhdGVUZXh0ID1cbiAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJkZCBNTU0geXl5eVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPGJyPjxkaXYgY2xhc3M9J3N1Yic+XCIgK1xuICAgICAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJISDptbVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPC9kaXY+XCI7XG4gICAgICAgIH1cbiAgICAgICAgdGV4dCArPSBgPHRyPlxuICAgICAgPHRkPjEwPC90ZD5cbiAgICAgIDx0ZD4ke01pc2Mucm91bmRUbzIocGJEYXRhLndwbSAqIG11bHRpcGxpZXIpfTxicj48c3BhbiBjbGFzcz1cInN1YlwiPiR7cGJEYXRhLmFjYyA9PT0gdW5kZWZpbmVkID8gXCItXCIgOiBwYkRhdGEuYWNjICsgXCIlXCJ9PC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+JHtNaXNjLnJvdW5kVG8yKHBiRGF0YS5yYXcgKiBtdWx0aXBsaWVyKX08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiRGF0YS5jb25zaXN0ZW5jeSA9PT0gdW5kZWZpbmVkID8gXCItXCIgOiBwYkRhdGEuY29uc2lzdGVuY3kgKyBcIiVcIn08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4ke2RhdGVUZXh0fTwvdGQ+XG4gICAgPC90cj5gO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICB0ZXh0ICs9IGA8dHI+XG4gICAgICA8dGQ+MTA8L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgIDwvdHI+YDtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgcGJEYXRhID0gcGIud29yZHNbMjVdLnNvcnQoKGEsIGIpID0+IGIud3BtIC0gYS53cG0pWzBdO1xuICAgICAgICBkYXRlVGV4dCA9IGAtPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj5gO1xuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUocGJEYXRhLnRpbWVzdGFtcCk7XG4gICAgICAgIGlmIChwYkRhdGEudGltZXN0YW1wKSB7XG4gICAgICAgICAgICBkYXRlVGV4dCA9XG4gICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiZGQgTU1NIHl5eXlcIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjxicj48ZGl2IGNsYXNzPSdzdWInPlwiICtcbiAgICAgICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiSEg6bW1cIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjwvZGl2PlwiO1xuICAgICAgICB9XG4gICAgICAgIHRleHQgKz0gYDx0cj5cbiAgICAgIDx0ZD4yNTwvdGQ+XG4gICAgICA8dGQ+JHtNaXNjLnJvdW5kVG8yKHBiRGF0YS53cG0gKiBtdWx0aXBsaWVyKX08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiRGF0YS5hY2MgPT09IHVuZGVmaW5lZCA/IFwiLVwiIDogcGJEYXRhLmFjYyArIFwiJVwifTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPiR7TWlzYy5yb3VuZFRvMihwYkRhdGEucmF3ICogbXVsdGlwbGllcil9PGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYkRhdGEuY29uc2lzdGVuY3kgPT09IHVuZGVmaW5lZCA/IFwiLVwiIDogcGJEYXRhLmNvbnNpc3RlbmN5ICsgXCIlXCJ9PC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+JHtkYXRlVGV4dH08L3RkPlxuICAgIDwvdHI+YDtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgdGV4dCArPSBgPHRyPlxuICAgICAgPHRkPjI1PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICA8L3RyPmA7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIHBiRGF0YSA9IHBiLndvcmRzWzUwXS5zb3J0KChhLCBiKSA9PiBiLndwbSAtIGEud3BtKVswXTtcbiAgICAgICAgZGF0ZVRleHQgPSBgLTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+YDtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHBiRGF0YS50aW1lc3RhbXApO1xuICAgICAgICBpZiAocGJEYXRhLnRpbWVzdGFtcCkge1xuICAgICAgICAgICAgZGF0ZVRleHQgPVxuICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcImRkIE1NTSB5eXl5XCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8YnI+PGRpdiBjbGFzcz0nc3ViJz5cIiArXG4gICAgICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcIkhIOm1tXCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8L2Rpdj5cIjtcbiAgICAgICAgfVxuICAgICAgICB0ZXh0ICs9IGA8dHI+XG4gICAgICA8dGQ+NTA8L3RkPlxuICAgICAgPHRkPiR7TWlzYy5yb3VuZFRvMihwYkRhdGEud3BtICogbXVsdGlwbGllcil9PGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYkRhdGEuYWNjID09PSB1bmRlZmluZWQgPyBcIi1cIiA6IHBiRGF0YS5hY2MgKyBcIiVcIn08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4ke01pc2Mucm91bmRUbzIocGJEYXRhLnJhdyAqIG11bHRpcGxpZXIpfTxicj48c3BhbiBjbGFzcz1cInN1YlwiPiR7cGJEYXRhLmNvbnNpc3RlbmN5ID09PSB1bmRlZmluZWQgPyBcIi1cIiA6IHBiRGF0YS5jb25zaXN0ZW5jeSArIFwiJVwifTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPiR7ZGF0ZVRleHR9PC90ZD5cbiAgICA8L3RyPmA7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHRleHQgKz0gYDx0cj5cbiAgICAgIDx0ZD41MDwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgPC90cj5gO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBwYkRhdGEgPSBwYi53b3Jkc1sxMDBdLnNvcnQoKGEsIGIpID0+IGIud3BtIC0gYS53cG0pWzBdO1xuICAgICAgICBkYXRlVGV4dCA9IGAtPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj5gO1xuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUocGJEYXRhLnRpbWVzdGFtcCk7XG4gICAgICAgIGlmIChwYkRhdGEudGltZXN0YW1wKSB7XG4gICAgICAgICAgICBkYXRlVGV4dCA9XG4gICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiZGQgTU1NIHl5eXlcIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjxicj48ZGl2IGNsYXNzPSdzdWInPlwiICtcbiAgICAgICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiSEg6bW1cIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjwvZGl2PlwiO1xuICAgICAgICB9XG4gICAgICAgIHRleHQgKz0gYDx0cj5cbiAgICAgIDx0ZD4xMDA8L3RkPlxuICAgICAgPHRkPiR7TWlzYy5yb3VuZFRvMihwYkRhdGEud3BtICogbXVsdGlwbGllcil9PGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYkRhdGEuYWNjID09PSB1bmRlZmluZWQgPyBcIi1cIiA6IHBiRGF0YS5hY2MgKyBcIiVcIn08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4ke01pc2Mucm91bmRUbzIocGJEYXRhLnJhdyAqIG11bHRpcGxpZXIpfTxicj48c3BhbiBjbGFzcz1cInN1YlwiPiR7cGJEYXRhLmNvbnNpc3RlbmN5ID09PSB1bmRlZmluZWQgPyBcIi1cIiA6IHBiRGF0YS5jb25zaXN0ZW5jeSArIFwiJVwifTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPiR7ZGF0ZVRleHR9PC90ZD5cbiAgICA8L3RyPmA7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHRleHQgKz0gYDx0cj5cbiAgICAgIDx0ZD4xMDA8L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgIDwvdHI+YDtcbiAgICB9XG4gICAgJChcIi5wYWdlQWNjb3VudCAud29yZHNQYlRhYmxlIHRib2R5XCIpLmh0bWwodGV4dCk7XG59XG5leHBvcnRzLnVwZGF0ZSA9IHVwZGF0ZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZVRhZ3MgPSBleHBvcnRzLnRvZ2dsZSA9IGV4cG9ydHMudXBkYXRlQWN0aXZlID0gZXhwb3J0cy5yZXNldCA9IGV4cG9ydHMubG9hZFRhZ3MgPSBleHBvcnRzLmdldEZpbHRlciA9IGV4cG9ydHMuZ2V0R3JvdXAgPSBleHBvcnRzLmdldEZpbHRlcnMgPSBleHBvcnRzLmxvYWQgPSBleHBvcnRzLmZpbHRlcnMgPSBleHBvcnRzLmRlZmF1bHRSZXN1bHRGaWx0ZXJzID0gdm9pZCAwO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmV4cG9ydHMuZGVmYXVsdFJlc3VsdEZpbHRlcnMgPSB7XG4gICAgZGlmZmljdWx0eToge1xuICAgICAgICBub3JtYWw6IHRydWUsXG4gICAgICAgIGV4cGVydDogdHJ1ZSxcbiAgICAgICAgbWFzdGVyOiB0cnVlLFxuICAgIH0sXG4gICAgbW9kZToge1xuICAgICAgICB3b3JkczogdHJ1ZSxcbiAgICAgICAgdGltZTogdHJ1ZSxcbiAgICAgICAgcXVvdGU6IHRydWUsXG4gICAgICAgIHplbjogdHJ1ZSxcbiAgICAgICAgY3VzdG9tOiB0cnVlLFxuICAgIH0sXG4gICAgd29yZHM6IHtcbiAgICAgICAgMTA6IHRydWUsXG4gICAgICAgIDI1OiB0cnVlLFxuICAgICAgICA1MDogdHJ1ZSxcbiAgICAgICAgMTAwOiB0cnVlLFxuICAgICAgICBjdXN0b206IHRydWUsXG4gICAgfSxcbiAgICB0aW1lOiB7XG4gICAgICAgIDE1OiB0cnVlLFxuICAgICAgICAzMDogdHJ1ZSxcbiAgICAgICAgNjA6IHRydWUsXG4gICAgICAgIDEyMDogdHJ1ZSxcbiAgICAgICAgY3VzdG9tOiB0cnVlLFxuICAgIH0sXG4gICAgcXVvdGVMZW5ndGg6IHtcbiAgICAgICAgc2hvcnQ6IHRydWUsXG4gICAgICAgIG1lZGl1bTogdHJ1ZSxcbiAgICAgICAgbG9uZzogdHJ1ZSxcbiAgICAgICAgdGhpY2M6IHRydWUsXG4gICAgfSxcbiAgICBwdW5jdHVhdGlvbjoge1xuICAgICAgICBvbjogdHJ1ZSxcbiAgICAgICAgb2ZmOiB0cnVlLFxuICAgIH0sXG4gICAgbnVtYmVyczoge1xuICAgICAgICBvbjogdHJ1ZSxcbiAgICAgICAgb2ZmOiB0cnVlLFxuICAgIH0sXG4gICAgZGF0ZToge1xuICAgICAgICBsYXN0X2RheTogZmFsc2UsXG4gICAgICAgIGxhc3Rfd2VlazogZmFsc2UsXG4gICAgICAgIGxhc3RfbW9udGg6IGZhbHNlLFxuICAgICAgICBsYXN0XzNtb250aHM6IGZhbHNlLFxuICAgICAgICBhbGw6IHRydWUsXG4gICAgfSxcbiAgICB0YWdzOiB7XG4gICAgICAgIG5vbmU6IHRydWUsXG4gICAgfSxcbiAgICBsYW5ndWFnZToge30sXG4gICAgZnVuYm94OiB7XG4gICAgICAgIG5vbmU6IHRydWUsXG4gICAgfSxcbn07XG5leHBvcnRzLmZpbHRlcnMgPSBleHBvcnRzLmRlZmF1bHRSZXN1bHRGaWx0ZXJzO1xuZnVuY3Rpb24gc2F2ZSgpIHtcbiAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJyZXN1bHRGaWx0ZXJzXCIsIEpTT04uc3RyaW5naWZ5KGV4cG9ydHMuZmlsdGVycykpO1xufVxuZnVuY3Rpb24gbG9hZCgpIHtcbiAgICBjb25zb2xlLmxvZyhcImxvYWRpbmcgZmlsdGVyc1wiKTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBuZXdSZXN1bHRGaWx0ZXJzID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwicmVzdWx0RmlsdGVyc1wiKTtcbiAgICAgICAgaWYgKG5ld1Jlc3VsdEZpbHRlcnMgIT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICBuZXdSZXN1bHRGaWx0ZXJzICE9PSBcIlwiICYmXG4gICAgICAgICAgICBPYmplY3Qua2V5cyhKU09OLnBhcnNlKG5ld1Jlc3VsdEZpbHRlcnMpKS5sZW5ndGggPj1cbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhleHBvcnRzLmRlZmF1bHRSZXN1bHRGaWx0ZXJzKS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVycyA9IEpTT04ucGFyc2UobmV3UmVzdWx0RmlsdGVycyk7XG4gICAgICAgICAgICAvLyBzYXZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBleHBvcnRzLmZpbHRlcnMgPSBleHBvcnRzLmRlZmF1bHRSZXN1bHRGaWx0ZXJzO1xuICAgICAgICAgICAgLy8gc2F2ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5ld1RhZ3MgPSB7IG5vbmU6IGZhbHNlIH07XG4gICAgICAgIE9iamVjdC5rZXlzKGV4cG9ydHMuZGVmYXVsdFJlc3VsdEZpbHRlcnMudGFncykuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXhwb3J0cy5maWx0ZXJzLnRhZ3NbdGFnXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgbmV3VGFnc1t0YWddID0gZXhwb3J0cy5maWx0ZXJzLnRhZ3NbdGFnXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG5ld1RhZ3NbdGFnXSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBleHBvcnRzLmZpbHRlcnMudGFncyA9IG5ld1RhZ3M7XG4gICAgICAgIHNhdmUoKTtcbiAgICB9XG4gICAgY2F0Y2ggKF9hKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgaW4gbG9hZGluZyByZXN1bHQgZmlsdGVyc1wiKTtcbiAgICAgICAgZXhwb3J0cy5maWx0ZXJzID0gZXhwb3J0cy5kZWZhdWx0UmVzdWx0RmlsdGVycztcbiAgICAgICAgc2F2ZSgpO1xuICAgIH1cbn1cbmV4cG9ydHMubG9hZCA9IGxvYWQ7XG5mdW5jdGlvbiBnZXRGaWx0ZXJzKCkge1xuICAgIHJldHVybiBleHBvcnRzLmZpbHRlcnM7XG59XG5leHBvcnRzLmdldEZpbHRlcnMgPSBnZXRGaWx0ZXJzO1xuZnVuY3Rpb24gZ2V0R3JvdXAoZ3JvdXApIHtcbiAgICByZXR1cm4gZXhwb3J0cy5maWx0ZXJzW2dyb3VwXTtcbn1cbmV4cG9ydHMuZ2V0R3JvdXAgPSBnZXRHcm91cDtcbi8vIGV4cG9ydCBmdW5jdGlvbiBzZXRGaWx0ZXIoZ3JvdXAsIGZpbHRlciwgdmFsdWUpIHtcbi8vICAgZmlsdGVyc1tncm91cF1bZmlsdGVyXSA9IHZhbHVlO1xuLy8gfVxuZnVuY3Rpb24gZ2V0RmlsdGVyKGdyb3VwLCBmaWx0ZXIpIHtcbiAgICByZXR1cm4gZXhwb3J0cy5maWx0ZXJzW2dyb3VwXVtmaWx0ZXJdO1xufVxuZXhwb3J0cy5nZXRGaWx0ZXIgPSBnZXRGaWx0ZXI7XG4vLyBleHBvcnQgZnVuY3Rpb24gdG9nZ2xlRmlsdGVyKGdyb3VwLCBmaWx0ZXIpIHtcbi8vICAgZmlsdGVyc1tncm91cF1bZmlsdGVyXSA9ICFmaWx0ZXJzW2dyb3VwXVtmaWx0ZXJdO1xuLy8gfVxuZnVuY3Rpb24gbG9hZFRhZ3ModGFncykge1xuICAgIGNvbnNvbGUubG9nKFwibG9hZGluZyB0YWdzXCIpO1xuICAgIHRhZ3MuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgIGV4cG9ydHMuZGVmYXVsdFJlc3VsdEZpbHRlcnMudGFnc1t0YWcuX2lkXSA9IHRydWU7XG4gICAgfSk7XG59XG5leHBvcnRzLmxvYWRUYWdzID0gbG9hZFRhZ3M7XG5mdW5jdGlvbiByZXNldCgpIHtcbiAgICBleHBvcnRzLmZpbHRlcnMgPSBleHBvcnRzLmRlZmF1bHRSZXN1bHRGaWx0ZXJzO1xuICAgIHNhdmUoKTtcbn1cbmV4cG9ydHMucmVzZXQgPSByZXNldDtcbmZ1bmN0aW9uIHVwZGF0ZUFjdGl2ZSgpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgY29uc3QgYWJvdmVDaGFydERpc3BsYXkgPSB7fTtcbiAgICBPYmplY3Qua2V5cyhnZXRGaWx0ZXJzKCkpLmZvckVhY2goKGdyb3VwKSA9PiB7XG4gICAgICAgIGFib3ZlQ2hhcnREaXNwbGF5W2dyb3VwXSA9IHtcbiAgICAgICAgICAgIGFsbDogdHJ1ZSxcbiAgICAgICAgICAgIGFycmF5OiBbXSxcbiAgICAgICAgfTtcbiAgICAgICAgT2JqZWN0LmtleXMoZ2V0R3JvdXAoZ3JvdXApKS5mb3JFYWNoKChmaWx0ZXIpID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIGNvbnN0IGdyb3VwQWJvdmVDaGFydERpc3BsYXkgPSBhYm92ZUNoYXJ0RGlzcGxheVtncm91cF07XG4gICAgICAgICAgICBpZiAoZ3JvdXBBYm92ZUNoYXJ0RGlzcGxheSA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGlmIChnZXRGaWx0ZXIoZ3JvdXAsIGZpbHRlcikpIHtcbiAgICAgICAgICAgICAgICAoX2EgPSBncm91cEFib3ZlQ2hhcnREaXNwbGF5W1wiYXJyYXlcIl0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5wdXNoKGZpbHRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoZ3JvdXBBYm92ZUNoYXJ0RGlzcGxheVtcImFsbFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGdyb3VwQWJvdmVDaGFydERpc3BsYXlbXCJhbGxcIl0gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgYnV0dG9uRWw7XG4gICAgICAgICAgICBpZiAoZ3JvdXAgPT09IFwiZGF0ZVwiKSB7XG4gICAgICAgICAgICAgICAgYnV0dG9uRWwgPSAkKGAucGFnZUFjY291bnQgLmdyb3VwLnRvcEZpbHRlcnMgLmZpbHRlckdyb3VwW2dyb3VwPVwiJHtncm91cH1cIl0gLmJ1dHRvbltmaWx0ZXI9XCIke2ZpbHRlcn1cIl1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGJ1dHRvbkVsID0gJChgLnBhZ2VBY2NvdW50IC5ncm91cC5maWx0ZXJCdXR0b25zIC5maWx0ZXJHcm91cFtncm91cD1cIiR7Z3JvdXB9XCJdIC5idXR0b25bZmlsdGVyPVwiJHtmaWx0ZXJ9XCJdYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ2V0RmlsdGVyKGdyb3VwLCBmaWx0ZXIpKSB7XG4gICAgICAgICAgICAgICAgYnV0dG9uRWwuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBidXR0b25FbC5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgZnVuY3Rpb24gYWRkVGV4dChncm91cCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lO1xuICAgICAgICBsZXQgcmV0ID0gXCJcIjtcbiAgICAgICAgcmV0ICs9IFwiPGRpdiBjbGFzcz0nZ3JvdXAnPlwiO1xuICAgICAgICBpZiAoZ3JvdXAgPT0gXCJkaWZmaWN1bHR5XCIpIHtcbiAgICAgICAgICAgIHJldCArPSBgPHNwYW4gYXJpYS1sYWJlbD1cIkRpZmZpY3VsdHlcIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1zdGFyXCI+PC9pPmA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZ3JvdXAgPT0gXCJtb2RlXCIpIHtcbiAgICAgICAgICAgIHJldCArPSBgPHNwYW4gYXJpYS1sYWJlbD1cIk1vZGVcIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1iYXJzXCI+PC9pPmA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZ3JvdXAgPT0gXCJwdW5jdHVhdGlvblwiKSB7XG4gICAgICAgICAgICByZXQgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCJQdW5jdHVhdGlvblwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxzcGFuIGNsYXNzPVwicHVuY1wiIHN0eWxlPVwiZm9udC13ZWlnaHQ6IDkwMDtcbiAgICAgIHdpZHRoOiAxLjI1cmVtO1xuICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICAgICAgbGV0dGVyLXNwYWNpbmc6IC0uMXJlbTtcIj4hPzwvc3Bhbj5gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGdyb3VwID09IFwibnVtYmVyc1wiKSB7XG4gICAgICAgICAgICByZXQgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCJOdW1iZXJzXCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PHNwYW4gY2xhc3M9XCJudW1iZXJzXCIgc3R5bGU9XCJmb250LXdlaWdodDogOTAwO1xuICAgICAgICB3aWR0aDogMS4yNXJlbTtcbiAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgICAgICBtYXJnaW4tcmlnaHQ6IC4xcmVtO1xuICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gICAgICAgIGxldHRlci1zcGFjaW5nOiAtLjFyZW07XCI+MTU8L3NwYW4+YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChncm91cCA9PSBcIndvcmRzXCIpIHtcbiAgICAgICAgICAgIHJldCArPSBgPHNwYW4gYXJpYS1sYWJlbD1cIldvcmRzXCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtZm9udFwiPjwvaT5gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGdyb3VwID09IFwidGltZVwiKSB7XG4gICAgICAgICAgICByZXQgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCJUaW1lXCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtY2xvY2tcIj48L2k+YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChncm91cCA9PSBcImRhdGVcIikge1xuICAgICAgICAgICAgcmV0ICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwiRGF0ZVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWNhbGVuZGFyXCI+PC9pPmA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZ3JvdXAgPT0gXCJ0YWdzXCIpIHtcbiAgICAgICAgICAgIHJldCArPSBgPHNwYW4gYXJpYS1sYWJlbD1cIlRhZ3NcIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS10YWdzXCI+PC9pPmA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZ3JvdXAgPT0gXCJsYW5ndWFnZVwiKSB7XG4gICAgICAgICAgICByZXQgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCJMYW5ndWFnZVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWdsb2JlLWFtZXJpY2FzXCI+PC9pPmA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZ3JvdXAgPT0gXCJmdW5ib3hcIikge1xuICAgICAgICAgICAgcmV0ICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwiRnVuYm94XCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtZ2FtZXBhZFwiPjwvaT5gO1xuICAgICAgICB9XG4gICAgICAgIGlmICgoX2EgPSBhYm92ZUNoYXJ0RGlzcGxheVtncm91cF0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5hbGwpIHtcbiAgICAgICAgICAgIHJldCArPSBcImFsbFwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKGdyb3VwID09PSBcInRhZ3NcIikge1xuICAgICAgICAgICAgICAgIHJldCArPSAoX2MgPSAoX2IgPSBhYm92ZUNoYXJ0RGlzcGxheS50YWdzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuYXJyYXkpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5tYXAoKGlkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpZCA9PSBcIm5vbmVcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpZDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdCgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gKF9hID0gc25hcHNob3QudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpbHRlcigodCkgPT4gdC5faWQgPT0gaWQpWzBdO1xuICAgICAgICAgICAgICAgICAgICBpZiAobmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKF9iID0gc25hcHNob3QudGFncykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmZpbHRlcigodCkgPT4gdC5faWQgPT0gaWQpWzBdLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hbWU7XG4gICAgICAgICAgICAgICAgfSkuam9pbihcIiwgXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0ICs9IChfZSA9IChfZCA9IGFib3ZlQ2hhcnREaXNwbGF5W2dyb3VwXSkgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmFycmF5KSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Uuam9pbihcIiwgXCIpLnJlcGxhY2UoL18vZywgXCIgXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldCArPSBcIjwvc3Bhbj48L2Rpdj5cIjtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9XG4gICAgbGV0IGNoYXJ0U3RyaW5nID0gXCJcIjtcbiAgICAvL2RhdGVcbiAgICBjaGFydFN0cmluZyArPSBhZGRUZXh0KFwiZGF0ZVwiKTtcbiAgICBjaGFydFN0cmluZyArPSBgPGRpdiBjbGFzcz1cInNwYWNlclwiPjwvZGl2PmA7XG4gICAgLy9tb2RlXG4gICAgY2hhcnRTdHJpbmcgKz0gYWRkVGV4dChcIm1vZGVcIik7XG4gICAgY2hhcnRTdHJpbmcgKz0gYDxkaXYgY2xhc3M9XCJzcGFjZXJcIj48L2Rpdj5gO1xuICAgIC8vdGltZVxuICAgIGlmICgoX2IgPSAoX2EgPSBhYm92ZUNoYXJ0RGlzcGxheS5tb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuYXJyYXkpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5pbmNsdWRlcyhcInRpbWVcIikpIHtcbiAgICAgICAgY2hhcnRTdHJpbmcgKz0gYWRkVGV4dChcInRpbWVcIik7XG4gICAgICAgIGNoYXJ0U3RyaW5nICs9IGA8ZGl2IGNsYXNzPVwic3BhY2VyXCI+PC9kaXY+YDtcbiAgICB9XG4gICAgLy93b3Jkc1xuICAgIGlmICgoX2QgPSAoX2MgPSBhYm92ZUNoYXJ0RGlzcGxheS5tb2RlKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuYXJyYXkpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5pbmNsdWRlcyhcIndvcmRzXCIpKSB7XG4gICAgICAgIGNoYXJ0U3RyaW5nICs9IGFkZFRleHQoXCJ3b3Jkc1wiKTtcbiAgICAgICAgY2hhcnRTdHJpbmcgKz0gYDxkaXYgY2xhc3M9XCJzcGFjZXJcIj48L2Rpdj5gO1xuICAgIH1cbiAgICAvL2RpZmZcbiAgICBjaGFydFN0cmluZyArPSBhZGRUZXh0KFwiZGlmZmljdWx0eVwiKTtcbiAgICBjaGFydFN0cmluZyArPSBgPGRpdiBjbGFzcz1cInNwYWNlclwiPjwvZGl2PmA7XG4gICAgLy9wdW5jXG4gICAgY2hhcnRTdHJpbmcgKz0gYWRkVGV4dChcInB1bmN0dWF0aW9uXCIpO1xuICAgIGNoYXJ0U3RyaW5nICs9IGA8ZGl2IGNsYXNzPVwic3BhY2VyXCI+PC9kaXY+YDtcbiAgICAvL251bWJlcnNcbiAgICBjaGFydFN0cmluZyArPSBhZGRUZXh0KFwibnVtYmVyc1wiKTtcbiAgICBjaGFydFN0cmluZyArPSBgPGRpdiBjbGFzcz1cInNwYWNlclwiPjwvZGl2PmA7XG4gICAgLy9sYW5ndWFnZVxuICAgIGNoYXJ0U3RyaW5nICs9IGFkZFRleHQoXCJsYW5ndWFnZVwiKTtcbiAgICBjaGFydFN0cmluZyArPSBgPGRpdiBjbGFzcz1cInNwYWNlclwiPjwvZGl2PmA7XG4gICAgLy9mdW5ib3hcbiAgICBjaGFydFN0cmluZyArPSBhZGRUZXh0KFwiZnVuYm94XCIpO1xuICAgIGNoYXJ0U3RyaW5nICs9IGA8ZGl2IGNsYXNzPVwic3BhY2VyXCI+PC9kaXY+YDtcbiAgICAvL3RhZ3NcbiAgICBjaGFydFN0cmluZyArPSBhZGRUZXh0KFwidGFnc1wiKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuZ3JvdXAuY2hhcnQgLmFib3ZlXCIpLmh0bWwoY2hhcnRTdHJpbmcpO1xuICAgIH0sIDApO1xufVxuZXhwb3J0cy51cGRhdGVBY3RpdmUgPSB1cGRhdGVBY3RpdmU7XG5mdW5jdGlvbiB0b2dnbGUoZ3JvdXAsIGZpbHRlcikge1xuICAgIHRyeSB7XG4gICAgICAgIGlmIChncm91cCA9PT0gXCJkYXRlXCIpIHtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGdldEdyb3VwKFwiZGF0ZVwiKSkuZm9yRWFjaCgoZGF0ZSkgPT4ge1xuICAgICAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVyc1tcImRhdGVcIl1bZGF0ZV0gPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGV4cG9ydHMuZmlsdGVyc1tncm91cF1bZmlsdGVyXSA9ICFleHBvcnRzLmZpbHRlcnNbZ3JvdXBdW2ZpbHRlcl07XG4gICAgICAgIHNhdmUoKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJTb21ldGhpbmcgd2VudCB3cm9uZyB0b2dnbGluZyBmaWx0ZXIuIFJldmVydGluZyB0byBkZWZhdWx0cy5cIiwgMCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwidG9nZ2xpbmcgZmlsdGVyIGVycm9yXCIpO1xuICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICByZXNldCgpO1xuICAgICAgICB1cGRhdGVBY3RpdmUoKTtcbiAgICB9XG59XG5leHBvcnRzLnRvZ2dsZSA9IHRvZ2dsZTtcbmZ1bmN0aW9uIHVwZGF0ZVRhZ3MoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICAkKFwiLnBhZ2VBY2NvdW50IC5jb250ZW50IC5maWx0ZXJCdXR0b25zIC5idXR0b25zQW5kVGl0bGUudGFncyAuYnV0dG9uc1wiKS5lbXB0eSgpO1xuICAgIGNvbnN0IHNuYXBzaG90ID0gREIuZ2V0U25hcHNob3QoKTtcbiAgICBpZiAoKChfYSA9IHNuYXBzaG90LnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpIHx8IDAgPiAwKSB7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmNvbnRlbnQgLmZpbHRlckJ1dHRvbnMgLmJ1dHRvbnNBbmRUaXRsZS50YWdzXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5jb250ZW50IC5maWx0ZXJCdXR0b25zIC5idXR0b25zQW5kVGl0bGUudGFncyAuYnV0dG9uc1wiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJidXR0b25cIiBmaWx0ZXI9XCJub25lXCI+bm8gdGFnPC9kaXY+YCk7XG4gICAgICAgIChfYiA9IHNuYXBzaG90LnRhZ3MpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmNvbnRlbnQgLmZpbHRlckJ1dHRvbnMgLmJ1dHRvbnNBbmRUaXRsZS50YWdzIC5idXR0b25zXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cImJ1dHRvblwiIGZpbHRlcj1cIiR7dGFnLl9pZH1cIj4ke3RhZy5uYW1lfTwvZGl2PmApO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmNvbnRlbnQgLmZpbHRlckJ1dHRvbnMgLmJ1dHRvbnNBbmRUaXRsZS50YWdzXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbn1cbmV4cG9ydHMudXBkYXRlVGFncyA9IHVwZGF0ZVRhZ3M7XG4kKFwiLnBhZ2VBY2NvdW50IC5maWx0ZXJCdXR0b25zIC5idXR0b25zQW5kVGl0bGUgLmJ1dHRvbnMsIC5wYWdlQWNjb3VudCAuZ3JvdXAudG9wRmlsdGVycyAuYnV0dG9uc0FuZFRpdGxlLnRlc3REYXRlIC5idXR0b25zXCIpLm9uKFwiY2xpY2tcIiwgXCIuYnV0dG9uXCIsIChlKSA9PiB7XG4gICAgY29uc3QgZ3JvdXAgPSAkKGUudGFyZ2V0KVxuICAgICAgICAucGFyZW50cyhcIi5idXR0b25zXCIpXG4gICAgICAgIC5hdHRyKFwiZ3JvdXBcIik7XG4gICAgY29uc3QgZmlsdGVyID0gJChlLnRhcmdldCkuYXR0cihcImZpbHRlclwiKTtcbiAgICBpZiAoJChlLnRhcmdldCkuaGFzQ2xhc3MoXCJhbGxGaWx0ZXJzXCIpKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKGdldEZpbHRlcnMoKSkuZm9yRWFjaCgoZ3JvdXApID0+IHtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGdldEdyb3VwKGdyb3VwKSkuZm9yRWFjaCgoZmlsdGVyKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGdyb3VwID09PSBcImRhdGVcIikge1xuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPIGZpZ3VyZSBvdXQgd2h5IFwiZmlsdGVyXCIgaXMgbmV2ZXJcbiAgICAgICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgICAgICBleHBvcnRzLmZpbHRlcnNbZ3JvdXBdW2ZpbHRlcl0gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZXhwb3J0cy5maWx0ZXJzW2dyb3VwXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzW2dyb3VwXVtmaWx0ZXJdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGV4cG9ydHMuZmlsdGVyc1tcImRhdGVcIl1bXCJhbGxcIl0gPSB0cnVlO1xuICAgIH1cbiAgICBlbHNlIGlmICgkKGUudGFyZ2V0KS5oYXNDbGFzcyhcIm5vRmlsdGVyc1wiKSkge1xuICAgICAgICBPYmplY3Qua2V5cyhnZXRGaWx0ZXJzKCkpLmZvckVhY2goKGdyb3VwKSA9PiB7XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT09IFwiZGF0ZVwiKSB7XG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoZ2V0R3JvdXAoZ3JvdXApKS5mb3JFYWNoKChmaWx0ZXIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyBmaWd1cmUgb3V0IHdoeSBcImZpbHRlclwiIGlzIG5ldmVyXG4gICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzW2dyb3VwXVtmaWx0ZXJdID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIGlmICgkKGUudGFyZ2V0KS5oYXNDbGFzcyhcImJ1dHRvblwiKSkge1xuICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xuICAgICAgICAgICAgT2JqZWN0LmtleXMoZ2V0R3JvdXAoZ3JvdXApKS5mb3JFYWNoKChmaWx0ZXIpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPIGZpZ3VyZSBvdXQgd2h5IFwiZmlsdGVyXCIgaXMgbmV2ZXJcbiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzW2dyb3VwXVtmaWx0ZXJdID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIFRPRE8gZmlndXJlIG91dCB3aHkgXCJmaWx0ZXJcIiBpcyBuZXZlclxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzW2dyb3VwXVtmaWx0ZXJdID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRvZ2dsZShncm91cCwgZmlsdGVyKTtcbiAgICAgICAgICAgIC8vIGZpbHRlcnNbZ3JvdXBdW2ZpbHRlcl0gPSAhZmlsdGVyc1tncm91cF1bZmlsdGVyXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB1cGRhdGVBY3RpdmUoKTtcbiAgICBzYXZlKCk7XG59KTtcbiQoXCIucGFnZUFjY291bnQgLnRvcEZpbHRlcnMgLmJ1dHRvbi5hbGxGaWx0ZXJzXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIE9iamVjdC5rZXlzKGdldEZpbHRlcnMoKSkuZm9yRWFjaCgoZ3JvdXApID0+IHtcbiAgICAgICAgT2JqZWN0LmtleXMoZ2V0R3JvdXAoZ3JvdXApKS5mb3JFYWNoKChmaWx0ZXIpID0+IHtcbiAgICAgICAgICAgIGlmIChncm91cCA9PT0gXCJkYXRlXCIpIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPIGZpZ3VyZSBvdXQgd2h5IFwiZmlsdGVyXCIgaXMgbmV2ZXJcbiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzW2dyb3VwXVtmaWx0ZXJdID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPIGZpZ3VyZSBvdXQgd2h5IFwiZmlsdGVyXCIgaXMgbmV2ZXJcbiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzW2dyb3VwXVtmaWx0ZXJdID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgZXhwb3J0cy5maWx0ZXJzW1wiZGF0ZVwiXVtcImFsbFwiXSA9IHRydWU7XG4gICAgdXBkYXRlQWN0aXZlKCk7XG4gICAgc2F2ZSgpO1xufSk7XG4kKFwiLnBhZ2VBY2NvdW50IC50b3BGaWx0ZXJzIC5idXR0b24uY3VycmVudENvbmZpZ0ZpbHRlclwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgT2JqZWN0LmtleXMoZ2V0RmlsdGVycygpKS5mb3JFYWNoKChncm91cCkgPT4ge1xuICAgICAgICBPYmplY3Qua2V5cyhnZXRHcm91cChncm91cCkpLmZvckVhY2goKGZpbHRlcikgPT4ge1xuICAgICAgICAgICAgLy8gVE9ETyBmaWd1cmUgb3V0IHdoeSBcImZpbHRlclwiIGlzIG5ldmVyXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBleHBvcnRzLmZpbHRlcnNbZ3JvdXBdW2ZpbHRlcl0gPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgZXhwb3J0cy5maWx0ZXJzW1wiZGlmZmljdWx0eVwiXVtjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHldID0gdHJ1ZTtcbiAgICBleHBvcnRzLmZpbHRlcnNbXCJtb2RlXCJdW2NvbmZpZ18xLmRlZmF1bHQubW9kZV0gPSB0cnVlO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwidGltZVwiKSB7XG4gICAgICAgIGlmIChbMTUsIDMwLCA2MCwgMTIwXS5pbmNsdWRlcyhjb25maWdfMS5kZWZhdWx0LnRpbWUpKSB7XG4gICAgICAgICAgICBjb25zdCBjb25maWdUaW1lID0gY29uZmlnXzEuZGVmYXVsdC50aW1lO1xuICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzW1widGltZVwiXVtjb25maWdUaW1lXSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBleHBvcnRzLmZpbHRlcnNbXCJ0aW1lXCJdW1wiY3VzdG9tXCJdID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIikge1xuICAgICAgICBpZiAoWzEwLCAyNSwgNTAsIDEwMCwgMjAwXS5pbmNsdWRlcyhjb25maWdfMS5kZWZhdWx0LndvcmRzKSkge1xuICAgICAgICAgICAgY29uc3QgY29uZmlnV29yZHMgPSBjb25maWdfMS5kZWZhdWx0LndvcmRzO1xuICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzW1wid29yZHNcIl1bY29uZmlnV29yZHNdID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVyc1tcIndvcmRzXCJdW1wiY3VzdG9tXCJdID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICBjb25zdCBmaWx0ZXJOYW1lID0gW1xuICAgICAgICAgICAgXCJzaG9ydFwiLFxuICAgICAgICAgICAgXCJtZWRpdW1cIixcbiAgICAgICAgICAgIFwibG9uZ1wiLFxuICAgICAgICAgICAgXCJ0aGljY1wiLFxuICAgICAgICBdO1xuICAgICAgICBmaWx0ZXJOYW1lLmZvckVhY2goKHFsLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucXVvdGVMZW5ndGguaW5jbHVkZXMoaW5kZXgpKSB7XG4gICAgICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzW1wicXVvdGVMZW5ndGhcIl1bcWxdID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVyc1tcInF1b3RlTGVuZ3RoXCJdW3FsXSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucHVuY3R1YXRpb24pIHtcbiAgICAgICAgZXhwb3J0cy5maWx0ZXJzW1wicHVuY3R1YXRpb25cIl1bXCJvblwiXSA9IHRydWU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBleHBvcnRzLmZpbHRlcnNbXCJwdW5jdHVhdGlvblwiXVtcIm9mZlwiXSA9IHRydWU7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm51bWJlcnMpIHtcbiAgICAgICAgZXhwb3J0cy5maWx0ZXJzW1wibnVtYmVyc1wiXVtcIm9uXCJdID0gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGV4cG9ydHMuZmlsdGVyc1tcIm51bWJlcnNcIl1bXCJvZmZcIl0gPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInF1b3RlXCIgJiYgL2VuZ2xpc2guKi8udGVzdChjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKSkge1xuICAgICAgICBleHBvcnRzLmZpbHRlcnNbXCJsYW5ndWFnZVwiXVtcImVuZ2xpc2hcIl0gPSB0cnVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZXhwb3J0cy5maWx0ZXJzW1wibGFuZ3VhZ2VcIl1bY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZV0gPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwibm9uZVwiKSB7XG4gICAgICAgIGV4cG9ydHMuZmlsdGVycy5mdW5ib3gubm9uZSA9IHRydWU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBleHBvcnRzLmZpbHRlcnMuZnVuYm94W2NvbmZpZ18xLmRlZmF1bHQuZnVuYm94XSA9IHRydWU7XG4gICAgfVxuICAgIGV4cG9ydHMuZmlsdGVyc1tcInRhZ3NcIl1bXCJub25lXCJdID0gdHJ1ZTtcbiAgICAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgaWYgKHRhZy5hY3RpdmUgPT09IHRydWUpIHtcbiAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVyc1tcInRhZ3NcIl1bXCJub25lXCJdID0gZmFsc2U7XG4gICAgICAgICAgICBleHBvcnRzLmZpbHRlcnNbXCJ0YWdzXCJdW3RhZy5faWRdID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGV4cG9ydHMuZmlsdGVyc1tcImRhdGVcIl1bXCJhbGxcIl0gPSB0cnVlO1xuICAgIHVwZGF0ZUFjdGl2ZSgpO1xuICAgIHNhdmUoKTtcbn0pO1xuJChcIi5wYWdlQWNjb3VudCAudG9wRmlsdGVycyAuYnV0dG9uLnRvZ2dsZUFkdmFuY2VkRmlsdGVyc1wiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICAkKFwiLnBhZ2VBY2NvdW50IC5maWx0ZXJCdXR0b25zXCIpLnNsaWRlVG9nZ2xlKDI1MCk7XG4gICAgJChcIi5wYWdlQWNjb3VudCAudG9wRmlsdGVycyAuYnV0dG9uLnRvZ2dsZUFkdmFuY2VkRmlsdGVyc1wiKS50b2dnbGVDbGFzcyhcImFjdGl2ZVwiKTtcbn0pO1xuTWlzYy5nZXRMYW5ndWFnZUxpc3QoKS50aGVuKChsYW5ndWFnZXMpID0+IHtcbiAgICBsYW5ndWFnZXMuZm9yRWFjaCgobGFuZ3VhZ2UpID0+IHtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuY29udGVudCAuZmlsdGVyQnV0dG9ucyAuYnV0dG9uc0FuZFRpdGxlLmxhbmd1YWdlcyAuYnV0dG9uc1wiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJidXR0b25cIiBmaWx0ZXI9XCIke2xhbmd1YWdlfVwiPiR7bGFuZ3VhZ2UucmVwbGFjZShcIl9cIiwgXCIgXCIpfTwvZGl2PmApO1xuICAgIH0pO1xufSk7XG4kKFwiLnBhZ2VBY2NvdW50IC5jb250ZW50IC5maWx0ZXJCdXR0b25zIC5idXR0b25zQW5kVGl0bGUuZnVuYm94IC5idXR0b25zXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cImJ1dHRvblwiIGZpbHRlcj1cIm5vbmVcIj5ub25lPC9kaXY+YCk7XG5NaXNjLmdldEZ1bmJveExpc3QoKS50aGVuKChmdW5ib3hNb2RlcykgPT4ge1xuICAgIGZ1bmJveE1vZGVzLmZvckVhY2goKGZ1bmJveCkgPT4ge1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5jb250ZW50IC5maWx0ZXJCdXR0b25zIC5idXR0b25zQW5kVGl0bGUuZnVuYm94IC5idXR0b25zXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cImJ1dHRvblwiIGZpbHRlcj1cIiR7ZnVuYm94Lm5hbWV9XCI+JHtmdW5ib3gubmFtZS5yZXBsYWNlKC9fL2csIFwiIFwiKX08L2Rpdj5gKTtcbiAgICB9KTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmhpZGUgPSBleHBvcnRzLnNob3cgPSB2b2lkIDA7XG5mdW5jdGlvbiBzaG93KCkge1xuICAgIC8vICQoXCIuc2lnbk91dFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKS5jc3MoXCJvcGFjaXR5XCIsIDEpO1xuICAgICQoXCIuc2lnbk91dFwiKVxuICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgLmNzcyh7XG4gICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIHRyYW5zaXRpb246IFwiMHNcIixcbiAgICB9KVxuICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IDEsXG4gICAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICQoXCIuc2lnbk91dFwiKS5jc3MoeyB0cmFuc2l0aW9uOiBcIjAuMjVzXCIgfSk7XG4gICAgfSk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAkKFwiLnNpZ25PdXRcIilcbiAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgLmNzcyh7XG4gICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgIHRyYW5zaXRpb246IFwiMHNcIixcbiAgICB9KVxuICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IDAsXG4gICAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICQoXCIuc2lnbk91dFwiKS5jc3MoeyB0cmFuc2l0aW9uOiBcIjAuMjVzXCIgfSk7XG4gICAgICAgICQoXCIuc2lnbk91dFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbiAgICAvLyAkKFwiLnNpZ25PdXRcIikuY3NzKFwib3BhY2l0eVwiLCAwKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG4vLyAkKFwiI2xpdmVXcG1cIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIikuY3NzKFwib3BhY2l0eVwiLCAwKS5hbmltYXRlKFxuLy8gICB7XG4vLyAgICAgb3BhY2l0eTogQ29uZmlnLnRpbWVyT3BhY2l0eSxcbi8vICAgfSxcbi8vICAgMTI1XG4vLyApO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IEJBU0VfUEFUSCA9IFwiL2FwZS1rZXlzXCI7XG5mdW5jdGlvbiBnZXRBcGVLZXlzRW5kcG9pbnRzKGFwZUNsaWVudCkge1xuICAgIGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZ2V0KEJBU0VfUEFUSCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBnZW5lcmF0ZShuYW1lLCBlbmFibGVkKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0geyBuYW1lLCBlbmFibGVkIH07XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBvc3QoQkFTRV9QQVRILCB7IHBheWxvYWQgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiB1cGRhdGUoYXBlS2V5SWQsIHVwZGF0ZXMpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSBPYmplY3QuYXNzaWduKHt9LCB1cGRhdGVzKTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucGF0Y2goYCR7QkFTRV9QQVRIfS8ke2FwZUtleUlkfWAsIHsgcGF5bG9hZCB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIF9kZWxldGUoYXBlS2V5SWQpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZGVsZXRlKGAke0JBU0VfUEFUSH0vJHthcGVLZXlJZH1gKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIGdldCxcbiAgICAgICAgZ2VuZXJhdGUsXG4gICAgICAgIHVwZGF0ZSxcbiAgICAgICAgZGVsZXRlOiBfZGVsZXRlLFxuICAgIH07XG59XG5leHBvcnRzLmRlZmF1bHQgPSBnZXRBcGVLZXlzRW5kcG9pbnRzO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IEJBU0VfUEFUSCA9IFwiL2NvbmZpZ3NcIjtcbmZ1bmN0aW9uIGdldENvbmZpZ3NFbmRwb2ludHMoYXBlQ2xpZW50KSB7XG4gICAgZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5nZXQoQkFTRV9QQVRIKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHNhdmUoY29uZmlnKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBhdGNoKEJBU0VfUEFUSCwgeyBwYXlsb2FkOiB7IGNvbmZpZyB9IH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0LFxuICAgICAgICBzYXZlLFxuICAgIH07XG59XG5leHBvcnRzLmRlZmF1bHQgPSBnZXRDb25maWdzRW5kcG9pbnRzO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBjb25maWdzXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vY29uZmlnc1wiKSk7XG5jb25zdCBsZWFkZXJib2FyZHNfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9sZWFkZXJib2FyZHNcIikpO1xuY29uc3QgcHJlc2V0c18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL3ByZXNldHNcIikpO1xuY29uc3QgcHNhc18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL3BzYXNcIikpO1xuY29uc3QgcXVvdGVzXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vcXVvdGVzXCIpKTtcbmNvbnN0IHJlc3VsdHNfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9yZXN1bHRzXCIpKTtcbmNvbnN0IHVzZXJzXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vdXNlcnNcIikpO1xuY29uc3QgYXBlX2tleXNfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9hcGUta2V5c1wiKSk7XG5leHBvcnRzLmRlZmF1bHQgPSB7XG4gICAgZ2V0Q29uZmlnc0VuZHBvaW50czogY29uZmlnc18xLmRlZmF1bHQsXG4gICAgZ2V0TGVhZGVyYm9hcmRzRW5kcG9pbnRzOiBsZWFkZXJib2FyZHNfMS5kZWZhdWx0LFxuICAgIGdldFByZXNldHNFbmRwb2ludHM6IHByZXNldHNfMS5kZWZhdWx0LFxuICAgIGdldFBzYXNFbmRwb2ludHM6IHBzYXNfMS5kZWZhdWx0LFxuICAgIGdldFF1b3Rlc0VuZHBvaW50czogcXVvdGVzXzEuZGVmYXVsdCxcbiAgICBnZXRSZXN1bHRzRW5kcG9pbnRzOiByZXN1bHRzXzEuZGVmYXVsdCxcbiAgICBnZXRVc2Vyc0VuZHBvaW50czogdXNlcnNfMS5kZWZhdWx0LFxuICAgIGdldEFwZUtleXNFbmRwb2ludHM6IGFwZV9rZXlzXzEuZGVmYXVsdCxcbn07XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgQkFTRV9QQVRIID0gXCIvbGVhZGVyYm9hcmRzXCI7XG5mdW5jdGlvbiBnZXRMZWFkZXJib2FyZHNFbmRwb2ludHMoYXBlQ2xpZW50KSB7XG4gICAgZnVuY3Rpb24gZ2V0KGxhbmd1YWdlLCBtb2RlLCBtb2RlMiwgc2tpcCA9IDAsIGxpbWl0ID0gNTApIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlYXJjaFF1ZXJ5ID0ge1xuICAgICAgICAgICAgICAgIGxhbmd1YWdlLFxuICAgICAgICAgICAgICAgIG1vZGUsXG4gICAgICAgICAgICAgICAgbW9kZTIsXG4gICAgICAgICAgICAgICAgc2tpcCxcbiAgICAgICAgICAgICAgICBsaW1pdDogTWF0aC5tYXgoTWF0aC5taW4obGltaXQsIDUwKSwgMCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5nZXQoQkFTRV9QQVRILCB7IHNlYXJjaFF1ZXJ5IH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZ2V0UmFuayhsYW5ndWFnZSwgbW9kZSwgbW9kZTIpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlYXJjaFF1ZXJ5ID0ge1xuICAgICAgICAgICAgICAgIGxhbmd1YWdlLFxuICAgICAgICAgICAgICAgIG1vZGUsXG4gICAgICAgICAgICAgICAgbW9kZTIsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5nZXQoYCR7QkFTRV9QQVRIfS9yYW5rYCwgeyBzZWFyY2hRdWVyeSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiB7IGdldCwgZ2V0UmFuayB9O1xufVxuZXhwb3J0cy5kZWZhdWx0ID0gZ2V0TGVhZGVyYm9hcmRzRW5kcG9pbnRzO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IEJBU0VfUEFUSCA9IFwiL3ByZXNldHNcIjtcbmZ1bmN0aW9uIGdldFByZXNldHNFbmRwb2ludHMoYXBlQ2xpZW50KSB7XG4gICAgZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5nZXQoQkFTRV9QQVRIKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGFkZChwcmVzZXROYW1lLCBjb25maWdDaGFuZ2VzKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICAgICAgICAgIG5hbWU6IHByZXNldE5hbWUsXG4gICAgICAgICAgICAgICAgY29uZmlnOiBjb25maWdDaGFuZ2VzLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucG9zdChCQVNFX1BBVEgsIHsgcGF5bG9hZCB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGVkaXQocHJlc2V0SWQsIHByZXNldE5hbWUsIGNvbmZpZ0NoYW5nZXMpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgX2lkOiBwcmVzZXRJZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBwcmVzZXROYW1lLFxuICAgICAgICAgICAgICAgIGNvbmZpZzogY29uZmlnQ2hhbmdlcyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBhdGNoKEJBU0VfUEFUSCwgeyBwYXlsb2FkIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gX2RlbGV0ZShwcmVzZXRJZCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5kZWxldGUoYCR7QkFTRV9QQVRIfS8ke3ByZXNldElkfWApO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHsgZ2V0LCBhZGQsIGVkaXQsIGRlbGV0ZTogX2RlbGV0ZSB9O1xufVxuZXhwb3J0cy5kZWZhdWx0ID0gZ2V0UHJlc2V0c0VuZHBvaW50cztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCB2ZXJzaW9uXzEgPSByZXF1aXJlKFwiLi4vLi4vdmVyc2lvblwiKTtcbmNvbnN0IEJBU0VfUEFUSCA9IFwiL3BzYXNcIjtcbmZ1bmN0aW9uIGdldFBzYXNFbmRwb2ludHMoYXBlQ2xpZW50KSB7XG4gICAgZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5nZXQoQkFTRV9QQVRILCB7XG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICBcIkNsaWVudC1WZXJzaW9uXCI6IHZlcnNpb25fMS5DTElFTlRfVkVSU0lPTixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4geyBnZXQgfTtcbn1cbmV4cG9ydHMuZGVmYXVsdCA9IGdldFBzYXNFbmRwb2ludHM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgQkFTRV9QQVRIID0gXCIvcXVvdGVzXCI7XG5mdW5jdGlvbiBnZXRRdW90ZXNFbmRwb2ludHMoYXBlQ2xpZW50KSB7XG4gICAgZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5nZXQoQkFTRV9QQVRIKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHN1Ym1pdCh0ZXh0LCBzb3VyY2UsIGxhbmd1YWdlLCBjYXB0Y2hhKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICAgICAgc291cmNlLFxuICAgICAgICAgICAgICAgIGxhbmd1YWdlLFxuICAgICAgICAgICAgICAgIGNhcHRjaGEsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wb3N0KEJBU0VfUEFUSCwgeyBwYXlsb2FkIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gYXBwcm92ZVN1Ym1pc3Npb24ocXVvdGVTdWJtaXNzaW9uSWQsIGVkaXRUZXh0LCBlZGl0U291cmNlKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICAgICAgICAgIHF1b3RlSWQ6IHF1b3RlU3VibWlzc2lvbklkLFxuICAgICAgICAgICAgICAgIGVkaXRUZXh0LFxuICAgICAgICAgICAgICAgIGVkaXRTb3VyY2UsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wb3N0KGAke0JBU0VfUEFUSH0vYXBwcm92ZWAsIHsgcGF5bG9hZCB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHJlamVjdFN1Ym1pc3Npb24ocXVvdGVTdWJtaXNzaW9uSWQpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucG9zdChgJHtCQVNFX1BBVEh9L3JlamVjdGAsIHtcbiAgICAgICAgICAgICAgICBwYXlsb2FkOiB7IHF1b3RlSWQ6IHF1b3RlU3VibWlzc2lvbklkIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGdldFJhdGluZyhxdW90ZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3Qgc2VhcmNoUXVlcnkgPSB7XG4gICAgICAgICAgICAgICAgcXVvdGVJZDogcXVvdGUuaWQsXG4gICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IHF1b3RlLmxhbmd1YWdlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZ2V0KGAke0JBU0VfUEFUSH0vcmF0aW5nYCwgeyBzZWFyY2hRdWVyeSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGFkZFJhdGluZyhxdW90ZSwgcmF0aW5nKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICAgICAgICAgIHF1b3RlSWQ6IHF1b3RlLmlkLFxuICAgICAgICAgICAgICAgIHJhdGluZyxcbiAgICAgICAgICAgICAgICBsYW5ndWFnZTogcXVvdGUubGFuZ3VhZ2UsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wb3N0KGAke0JBU0VfUEFUSH0vcmF0aW5nYCwgeyBwYXlsb2FkIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gcmVwb3J0KHF1b3RlSWQsIHF1b3RlTGFuZ3VhZ2UsIHJlYXNvbiwgY29tbWVudCwgY2FwdGNoYSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgICAgICBxdW90ZUlkLFxuICAgICAgICAgICAgICAgIHF1b3RlTGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgcmVhc29uLFxuICAgICAgICAgICAgICAgIGNvbW1lbnQsXG4gICAgICAgICAgICAgICAgY2FwdGNoYSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBvc3QoYCR7QkFTRV9QQVRIfS9yZXBvcnRgLCB7IHBheWxvYWQgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBnZXQsXG4gICAgICAgIHN1Ym1pdCxcbiAgICAgICAgYXBwcm92ZVN1Ym1pc3Npb24sXG4gICAgICAgIHJlamVjdFN1Ym1pc3Npb24sXG4gICAgICAgIGdldFJhdGluZyxcbiAgICAgICAgYWRkUmF0aW5nLFxuICAgICAgICByZXBvcnQsXG4gICAgfTtcbn1cbmV4cG9ydHMuZGVmYXVsdCA9IGdldFF1b3Rlc0VuZHBvaW50cztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCB2ZXJzaW9uXzEgPSByZXF1aXJlKFwiLi4vLi4vdmVyc2lvblwiKTtcbmNvbnN0IEJBU0VfUEFUSCA9IFwiL3Jlc3VsdHNcIjtcbmZ1bmN0aW9uIGdldFJlc3VsdHNFbmRwb2ludHMoYXBlQ2xpZW50KSB7XG4gICAgZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5nZXQoQkFTRV9QQVRIKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHNhdmUocmVzdWx0KSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBvc3QoQkFTRV9QQVRILCB7XG4gICAgICAgICAgICAgICAgcGF5bG9hZDogeyByZXN1bHQgfSxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7IFwiQ2xpZW50LVZlcnNpb25cIjogdmVyc2lvbl8xLkNMSUVOVF9WRVJTSU9OIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHVwZGF0ZVRhZ3MocmVzdWx0SWQsIHRhZ0lkcykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wYXRjaChgJHtCQVNFX1BBVEh9L3RhZ3NgLCB7XG4gICAgICAgICAgICAgICAgcGF5bG9hZDogeyByZXN1bHRJZCwgdGFnSWRzIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGRlbGV0ZUFsbCgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZGVsZXRlKEJBU0VfUEFUSCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4geyBnZXQsIHNhdmUsIHVwZGF0ZVRhZ3MsIGRlbGV0ZUFsbCB9O1xufVxuZXhwb3J0cy5kZWZhdWx0ID0gZ2V0UmVzdWx0c0VuZHBvaW50cztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBCQVNFX1BBVEggPSBcIi91c2Vyc1wiO1xuZnVuY3Rpb24gZ2V0VXNlcnNFbmRwb2ludHMoYXBlQ2xpZW50KSB7XG4gICAgZnVuY3Rpb24gZ2V0RGF0YSgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZ2V0KEJBU0VfUEFUSCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBjcmVhdGUobmFtZSwgZW1haWwsIHVpZCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgICAgICBlbWFpbCxcbiAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgIHVpZCxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBvc3QoYCR7QkFTRV9QQVRIfS9zaWdudXBgLCB7IHBheWxvYWQgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBnZXROYW1lQXZhaWxhYmlsaXR5KG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZ2V0KGAke0JBU0VfUEFUSH0vY2hlY2tOYW1lLyR7bmFtZX1gKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIF9kZWxldGUoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmRlbGV0ZShCQVNFX1BBVEgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gdXBkYXRlTmFtZShuYW1lKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBhdGNoKGAke0JBU0VfUEFUSH0vbmFtZWAsIHsgcGF5bG9hZDogeyBuYW1lIH0gfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiB1cGRhdGVMZWFkZXJib2FyZE1lbW9yeShtb2RlLCBtb2RlMiwgbGFuZ3VhZ2UsIHJhbmspIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgbW9kZSxcbiAgICAgICAgICAgICAgICBtb2RlMixcbiAgICAgICAgICAgICAgICBsYW5ndWFnZSxcbiAgICAgICAgICAgICAgICByYW5rLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucGF0Y2goYCR7QkFTRV9QQVRIfS9sZWFkZXJib2FyZE1lbW9yeWAsIHsgcGF5bG9hZCB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHVwZGF0ZUVtYWlsKG5ld0VtYWlsLCBwcmV2aW91c0VtYWlsKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICAgICAgICAgIG5ld0VtYWlsLFxuICAgICAgICAgICAgICAgIHByZXZpb3VzRW1haWwsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wYXRjaChgJHtCQVNFX1BBVEh9L2VtYWlsYCwgeyBwYXlsb2FkIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZGVsZXRlUGVyc29uYWxCZXN0cygpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZGVsZXRlKGAke0JBU0VfUEFUSH0vcGVyc29uYWxCZXN0c2ApO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZ2V0VGFncygpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZ2V0KGAke0JBU0VfUEFUSH0vdGFnc2ApO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gY3JlYXRlVGFnKHRhZ05hbWUpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucG9zdChgJHtCQVNFX1BBVEh9L3RhZ3NgLCB7IHBheWxvYWQ6IHsgdGFnTmFtZSB9IH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZWRpdFRhZyh0YWdJZCwgbmV3TmFtZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgICAgICB0YWdJZCxcbiAgICAgICAgICAgICAgICBuZXdOYW1lLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucGF0Y2goYCR7QkFTRV9QQVRIfS90YWdzYCwgeyBwYXlsb2FkIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZGVsZXRlVGFnKHRhZ0lkKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmRlbGV0ZShgJHtCQVNFX1BBVEh9L3RhZ3MvJHt0YWdJZH1gKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGRlbGV0ZVRhZ1BlcnNvbmFsQmVzdCh0YWdJZCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5kZWxldGUoYCR7QkFTRV9QQVRIfS90YWdzLyR7dGFnSWR9L3BlcnNvbmFsQmVzdGApO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZ2V0Q3VzdG9tVGhlbWVzKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5nZXQoYCR7QkFTRV9QQVRIfS9jdXN0b21UaGVtZXNgKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGVkaXRDdXN0b21UaGVtZSh0aGVtZUlkLCBuZXdUaGVtZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgICAgICB0aGVtZUlkOiB0aGVtZUlkLFxuICAgICAgICAgICAgICAgIHRoZW1lOiB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IG5ld1RoZW1lLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yczogbmV3VGhlbWUuY29sb3JzLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wYXRjaChgJHtCQVNFX1BBVEh9L2N1c3RvbVRoZW1lc2AsIHsgcGF5bG9hZCB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGRlbGV0ZUN1c3RvbVRoZW1lKHRoZW1lSWQpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgdGhlbWVJZDogdGhlbWVJZCxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmRlbGV0ZShgJHtCQVNFX1BBVEh9L2N1c3RvbVRoZW1lc2AsIHsgcGF5bG9hZCB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGFkZEN1c3RvbVRoZW1lKG5ld1RoZW1lKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0geyBuYW1lOiBuZXdUaGVtZS5uYW1lLCBjb2xvcnM6IG5ld1RoZW1lLmNvbG9ycyB9O1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wb3N0KGAke0JBU0VfUEFUSH0vY3VzdG9tVGhlbWVzYCwgeyBwYXlsb2FkIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gbGlua0Rpc2NvcmQoZGF0YSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wb3N0KGAke0JBU0VfUEFUSH0vZGlzY29yZC9saW5rYCwge1xuICAgICAgICAgICAgICAgIHBheWxvYWQ6IHsgZGF0YSB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiB1bmxpbmtEaXNjb3JkKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wb3N0KGAke0JBU0VfUEFUSH0vZGlzY29yZC91bmxpbmtgKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIGdldERhdGEsXG4gICAgICAgIGNyZWF0ZSxcbiAgICAgICAgZ2V0TmFtZUF2YWlsYWJpbGl0eSxcbiAgICAgICAgZGVsZXRlOiBfZGVsZXRlLFxuICAgICAgICB1cGRhdGVOYW1lLFxuICAgICAgICB1cGRhdGVMZWFkZXJib2FyZE1lbW9yeSxcbiAgICAgICAgdXBkYXRlRW1haWwsXG4gICAgICAgIGRlbGV0ZVBlcnNvbmFsQmVzdHMsXG4gICAgICAgIGdldFRhZ3MsXG4gICAgICAgIGNyZWF0ZVRhZyxcbiAgICAgICAgZWRpdFRhZyxcbiAgICAgICAgZGVsZXRlVGFnLFxuICAgICAgICBkZWxldGVUYWdQZXJzb25hbEJlc3QsXG4gICAgICAgIGxpbmtEaXNjb3JkLFxuICAgICAgICB1bmxpbmtEaXNjb3JkLFxuICAgICAgICBnZXRDdXN0b21UaGVtZXMsXG4gICAgICAgIGFkZEN1c3RvbVRoZW1lLFxuICAgICAgICBlZGl0Q3VzdG9tVGhlbWUsXG4gICAgICAgIGRlbGV0ZUN1c3RvbVRoZW1lLFxuICAgIH07XG59XG5leHBvcnRzLmRlZmF1bHQgPSBnZXRVc2Vyc0VuZHBvaW50cztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBheGlvc18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJheGlvc1wiKSk7XG5jb25zdCBlbmRwb2ludHNfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9lbmRwb2ludHNcIikpO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuLi9maXJlYmFzZVwiKTtcbmNvbnN0IGF1dGhfMSA9IHJlcXVpcmUoXCJmaXJlYmFzZS9hdXRoXCIpO1xuY29uc3QgREVWX1NFUlZFUl9IT1NUID0gXCJodHRwOi8vbG9jYWxob3N0OjUwMDVcIjtcbmNvbnN0IFBST0RfU0VSVkVSX0hPU1QgPSBcImh0dHBzOi8vYXBpLm1vbmtleXR5cGUuY29tXCI7XG5jb25zdCBBUElfUEFUSCA9IFwiXCI7XG5jb25zdCBCQVNFX1VSTCA9IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSA9PT0gXCJsb2NhbGhvc3RcIiA/IERFVl9TRVJWRVJfSE9TVCA6IFBST0RfU0VSVkVSX0hPU1Q7XG5jb25zdCBBUElfVVJMID0gYCR7QkFTRV9VUkx9JHtBUElfUEFUSH1gO1xuLy8gQWRhcHRzIHRoZSBhcGUgY2xpZW50J3MgdmlldyBvZiByZXF1ZXN0IG9wdGlvbnMgdG8gdGhlIHVuZGVybHlpbmcgSFRUUCBjbGllbnQuXG5mdW5jdGlvbiBhZGFwdFJlcXVlc3RPcHRpb25zKG9wdGlvbnMpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCBjdXJyZW50VXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICAgICAgY29uc3QgaWRUb2tlbiA9IGN1cnJlbnRVc2VyICYmICh5aWVsZCAoMCwgYXV0aF8xLmdldElkVG9rZW4pKGN1cnJlbnRVc2VyKSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwYXJhbXM6IG9wdGlvbnMuc2VhcmNoUXVlcnksXG4gICAgICAgICAgICBkYXRhOiBvcHRpb25zLnBheWxvYWQsXG4gICAgICAgICAgICBoZWFkZXJzOiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucy5oZWFkZXJzKSwgeyBBY2NlcHQ6IFwiYXBwbGljYXRpb24vanNvblwiLCBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIiB9KSwgKGlkVG9rZW4gJiYgeyBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7aWRUb2tlbn1gIH0pKSxcbiAgICAgICAgfTtcbiAgICB9KTtcbn1cbi8vIFdyYXAgdGhlIHVuZGVybHlpbmcgSFRUUCBjbGllbnQncyBtZXRob2Qgd2l0aCBvdXIgb3duLlxuZnVuY3Rpb24gYXBlaWZ5Q2xpZW50TWV0aG9kKGNsaWVudE1ldGhvZCwgbWV0aG9kVHlwZSkge1xuICAgIHJldHVybiAoZW5kcG9pbnQsIG9wdGlvbnMgPSB7fSkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9IFwiXCI7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0T3B0aW9ucyA9IHlpZWxkIGFkYXB0UmVxdWVzdE9wdGlvbnMob3B0aW9ucyk7XG4gICAgICAgICAgICBsZXQgcmVzcG9uc2U7XG4gICAgICAgICAgICBpZiAobWV0aG9kVHlwZSA9PT0gXCJnZXRcIiB8fCBtZXRob2RUeXBlID09PSBcImRlbGV0ZVwiKSB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB5aWVsZCBjbGllbnRNZXRob2QoZW5kcG9pbnQsIHJlcXVlc3RPcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlID0geWllbGQgY2xpZW50TWV0aG9kKGVuZHBvaW50LCByZXF1ZXN0T3B0aW9ucy5kYXRhLCByZXF1ZXN0T3B0aW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IG1lc3NhZ2UsIGRhdGEgfSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgZGF0YSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIGNvbnN0IHR5cGVkRXJyb3IgPSBlcnJvcjtcbiAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9IHR5cGVkRXJyb3IubWVzc2FnZTtcbiAgICAgICAgICAgIGlmIChheGlvc18xLmRlZmF1bHQuaXNBeGlvc0Vycm9yKHR5cGVkRXJyb3IpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oeyBzdGF0dXM6IChfYiA9IChfYSA9IHR5cGVkRXJyb3IucmVzcG9uc2UpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGF0dXMpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IDUwMCwgbWVzc2FnZTogdHlwZWRFcnJvci5tZXNzYWdlIH0sIChfYyA9IHR5cGVkRXJyb3IucmVzcG9uc2UpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3RhdHVzOiA1MDAsXG4gICAgICAgICAgICBtZXNzYWdlOiBlcnJvck1lc3NhZ2UsXG4gICAgICAgIH07XG4gICAgfSk7XG59XG5jb25zdCBheGlvc0NsaWVudCA9IGF4aW9zXzEuZGVmYXVsdC5jcmVhdGUoe1xuICAgIGJhc2VVUkw6IEFQSV9VUkwsXG4gICAgdGltZW91dDogMTAwMDAsXG59KTtcbmNvbnN0IGFwZUNsaWVudCA9IHtcbiAgICBnZXQ6IGFwZWlmeUNsaWVudE1ldGhvZChheGlvc0NsaWVudC5nZXQsIFwiZ2V0XCIpLFxuICAgIHBvc3Q6IGFwZWlmeUNsaWVudE1ldGhvZChheGlvc0NsaWVudC5wb3N0LCBcInBvc3RcIiksXG4gICAgcHV0OiBhcGVpZnlDbGllbnRNZXRob2QoYXhpb3NDbGllbnQucHV0LCBcInB1dFwiKSxcbiAgICBwYXRjaDogYXBlaWZ5Q2xpZW50TWV0aG9kKGF4aW9zQ2xpZW50LnBhdGNoLCBcInBhdGNoXCIpLFxuICAgIGRlbGV0ZTogYXBlaWZ5Q2xpZW50TWV0aG9kKGF4aW9zQ2xpZW50LmRlbGV0ZSwgXCJkZWxldGVcIiksXG59O1xuLy8gQVBJIEVuZHBvaW50c1xuY29uc3QgQXBlID0ge1xuICAgIHVzZXJzOiBlbmRwb2ludHNfMS5kZWZhdWx0LmdldFVzZXJzRW5kcG9pbnRzKGFwZUNsaWVudCksXG4gICAgY29uZmlnczogZW5kcG9pbnRzXzEuZGVmYXVsdC5nZXRDb25maWdzRW5kcG9pbnRzKGFwZUNsaWVudCksXG4gICAgcmVzdWx0czogZW5kcG9pbnRzXzEuZGVmYXVsdC5nZXRSZXN1bHRzRW5kcG9pbnRzKGFwZUNsaWVudCksXG4gICAgcHNhczogZW5kcG9pbnRzXzEuZGVmYXVsdC5nZXRQc2FzRW5kcG9pbnRzKGFwZUNsaWVudCksXG4gICAgcXVvdGVzOiBlbmRwb2ludHNfMS5kZWZhdWx0LmdldFF1b3Rlc0VuZHBvaW50cyhhcGVDbGllbnQpLFxuICAgIGxlYWRlcmJvYXJkczogZW5kcG9pbnRzXzEuZGVmYXVsdC5nZXRMZWFkZXJib2FyZHNFbmRwb2ludHMoYXBlQ2xpZW50KSxcbiAgICBwcmVzZXRzOiBlbmRwb2ludHNfMS5kZWZhdWx0LmdldFByZXNldHNFbmRwb2ludHMoYXBlQ2xpZW50KSxcbiAgICBhcGVLZXlzOiBlbmRwb2ludHNfMS5kZWZhdWx0LmdldEFwZUtleXNFbmRwb2ludHMoYXBlQ2xpZW50KSxcbn07XG5leHBvcnRzLmRlZmF1bHQgPSBBcGU7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmlzQ29uZmlnVmFsdWVWYWxpZEFzeW5jID0gZXhwb3J0cy5pc0NvbmZpZ1ZhbHVlVmFsaWQgPSBleHBvcnRzLmlzQ29uZmlnS2V5VmFsaWQgPSB2b2lkIDA7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3V0aWxzL21pc2NcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmZ1bmN0aW9uIGlzQ29uZmlnS2V5VmFsaWQobmFtZSkge1xuICAgIGlmIChuYW1lID09PSBudWxsIHx8IG5hbWUgPT09IHVuZGVmaW5lZCB8fCBuYW1lID09PSBcIlwiKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgaWYgKG5hbWUubGVuZ3RoID4gMzApXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gL15bMC05YS16QS1aXy5cXC0jK10rJC8udGVzdChuYW1lKTtcbn1cbmV4cG9ydHMuaXNDb25maWdLZXlWYWxpZCA9IGlzQ29uZmlnS2V5VmFsaWQ7XG5mdW5jdGlvbiBpbnZhbGlkKGtleSwgdmFsLCBjdXN0b21NZXNzYWdlKSB7XG4gICAgaWYgKGN1c3RvbU1lc3NhZ2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgSW52YWxpZCB2YWx1ZSBmb3IgJHtrZXl9ICgke3ZhbH0pLiBQbGVhc2UgdHJ5IHRvIGNoYW5nZSB0aGlzIHNldHRpbmcgYWdhaW4uYCwgLTEpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoYEludmFsaWQgdmFsdWUgZm9yICR7a2V5fSAoJHt2YWx9KS4gJHtjdXN0b21NZXNzYWdlfWAsIC0xKTtcbiAgICB9XG4gICAgY29uc29sZS5lcnJvcihgSW52YWxpZCB2YWx1ZSBrZXkgJHtrZXl9IHZhbHVlICR7dmFsfSB0eXBlICR7dHlwZW9mIHZhbH1gKTtcbn1cbmZ1bmN0aW9uIGlzQXJyYXkodmFsKSB7XG4gICAgcmV0dXJuIHZhbCBpbnN0YW5jZW9mIEFycmF5O1xufVxuZnVuY3Rpb24gaXNDb25maWdWYWx1ZVZhbGlkKGtleSwgdmFsLCBwb3NzaWJsZVR5cGVzKSB7XG4gICAgbGV0IGlzVmFsaWQgPSBmYWxzZTtcbiAgICAvLyBtaWdodCBiZSB1c2VkIGluIHRoZSBmdXR1cmVcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICBsZXQgY3VzdG9tTWVzc2FnZSA9IHVuZGVmaW5lZDtcbiAgICBmb3IgKGNvbnN0IHBvc3NpYmxlVHlwZSBvZiBwb3NzaWJsZVR5cGVzKSB7XG4gICAgICAgIHN3aXRjaCAocG9zc2libGVUeXBlKSB7XG4gICAgICAgICAgICBjYXNlIFwiYm9vbGVhblwiOlxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsID09PSBcImJvb2xlYW5cIilcbiAgICAgICAgICAgICAgICAgICAgaXNWYWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibnVsbFwiOlxuICAgICAgICAgICAgICAgIGlmICh2YWwgPT09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIm51bWJlclwiOlxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsID09PSBcIm51bWJlclwiKVxuICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJudW1iZXJBcnJheVwiOlxuICAgICAgICAgICAgICAgIGlmIChpc0FycmF5KHZhbCkgJiYgdmFsLmV2ZXJ5KCh2KSA9PiB0eXBlb2YgdiA9PT0gXCJudW1iZXJcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgaXNWYWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInN0cmluZ1wiOlxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsID09PSBcInN0cmluZ1wiKVxuICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJzdHJpbmdBcnJheVwiOlxuICAgICAgICAgICAgICAgIGlmIChpc0FycmF5KHZhbCkgJiYgdmFsLmV2ZXJ5KCh2KSA9PiB0eXBlb2YgdiA9PT0gXCJzdHJpbmdcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgaXNWYWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInVuZGVmaW5lZFwiOlxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsID09PSBcInVuZGVmaW5lZFwiIHx8IHZhbCA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgaWYgKGlzQXJyYXkocG9zc2libGVUeXBlKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocG9zc2libGVUeXBlLmluY2x1ZGVzKHZhbCkpXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFpc1ZhbGlkKVxuICAgICAgICBpbnZhbGlkKGtleSwgdmFsLCBjdXN0b21NZXNzYWdlKTtcbiAgICByZXR1cm4gaXNWYWxpZDtcbn1cbmV4cG9ydHMuaXNDb25maWdWYWx1ZVZhbGlkID0gaXNDb25maWdWYWx1ZVZhbGlkO1xuZnVuY3Rpb24gaXNDb25maWdWYWx1ZVZhbGlkQXN5bmMoa2V5LCB2YWwsIHBvc3NpYmxlVHlwZXMpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBsZXQgaXNWYWxpZCA9IGZhbHNlO1xuICAgICAgICBsZXQgY3VzdG9tTWVzc2FnZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgZm9yIChjb25zdCBwb3NzaWJsZVR5cGUgb2YgcG9zc2libGVUeXBlcykge1xuICAgICAgICAgICAgc3dpdGNoIChwb3NzaWJsZVR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwibGF5b3V0Zmx1aWRcIjoge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbCAhPT0gXCJzdHJpbmdcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXlvdXROYW1lcyA9IHZhbC5zcGxpdCgvWyMgXSsvKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxheW91dE5hbWVzLmxlbmd0aCA8IDIgfHwgbGF5b3V0TmFtZXMubGVuZ3RoID4gNSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAvLyBjb252ZXJ0IHRoZSBsYXlvdXQgbmFtZXMgdG8gbGF5b3V0c1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXlvdXRzID0geWllbGQgUHJvbWlzZS5hbGwobGF5b3V0TmFtZXMubWFwKChsYXlvdXROYW1lKSA9PiBNaXNjLmdldExheW91dChsYXlvdXROYW1lKSkpO1xuICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiBhbGwgbGF5b3V0cyBleGlzdFxuICAgICAgICAgICAgICAgICAgICBpZiAoIWxheW91dHMuZXZlcnkoKGxheW91dCkgPT4gbGF5b3V0ICE9PSB1bmRlZmluZWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnZhbGlkTGF5b3V0TmFtZXMgPSBsYXlvdXROYW1lcy5tYXAoKGxheW91dE5hbWUsIGluZGV4KSA9PiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5b3V0TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXlvdXRzW2luZGV4XSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW52YWxpZExheW91dHMgPSBpbnZhbGlkTGF5b3V0TmFtZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChbXywgbGF5b3V0XSkgPT4gbGF5b3V0ID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCgoW2xheW91dE5hbWVdKSA9PiBsYXlvdXROYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbU1lc3NhZ2UgPSBgVGhlIGZvbGxvd2luZyBpbnB1dHRlZCBsYXlvdXRzIGRvIG5vdCBleGlzdDogJHtpbnZhbGlkTGF5b3V0cy5qb2luKFwiLCBcIil9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFpc1ZhbGlkKVxuICAgICAgICAgICAgaW52YWxpZChrZXksIHZhbCwgY3VzdG9tTWVzc2FnZSk7XG4gICAgICAgIHJldHVybiBpc1ZhbGlkO1xuICAgIH0pO1xufVxuZXhwb3J0cy5pc0NvbmZpZ1ZhbHVlVmFsaWRBc3luYyA9IGlzQ29uZmlnVmFsdWVWYWxpZEFzeW5jO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zZXRTaG93TGl2ZUFjYyA9IGV4cG9ydHMuc2V0U2hvd0xpdmVXcG0gPSBleHBvcnRzLnNldFNob3dUaW1lclByb2dyZXNzID0gZXhwb3J0cy5zZXRQYWNlQ2FyZXRTdHlsZSA9IGV4cG9ydHMuc2V0Q2FyZXRTdHlsZSA9IGV4cG9ydHMuc2V0UGFnZVdpZHRoID0gZXhwb3J0cy5zZXRPcHBvc2l0ZVNoaWZ0TW9kZSA9IGV4cG9ydHMuc2V0U3RyaWN0U3BhY2UgPSBleHBvcnRzLnNldENvbG9yZnVsTW9kZSA9IGV4cG9ydHMuc2V0RmxpcFRlc3RDb2xvcnMgPSBleHBvcnRzLnNldFJlcGVhdFF1b3RlcyA9IGV4cG9ydHMuc2V0RW5hYmxlQWRzID0gZXhwb3J0cy5zZXRRdWlja0VuZCA9IGV4cG9ydHMuc2V0U2hvd0FsbExpbmVzID0gZXhwb3J0cy5zZXRDYXBzTG9ja1dhcm5pbmcgPSBleHBvcnRzLnNldFNpbmdsZUxpc3RDb21tYW5kTGluZSA9IGV4cG9ydHMuc2V0QWx3YXlzU2hvd1dvcmRzSGlzdG9yeSA9IGV4cG9ydHMuc2V0TWluQnVyc3RDdXN0b21TcGVlZCA9IGV4cG9ydHMuc2V0TWluQnVyc3QgPSBleHBvcnRzLnNldE1pbkFjY0N1c3RvbSA9IGV4cG9ydHMuc2V0TWluQWNjID0gZXhwb3J0cy5zZXRNaW5XcG1DdXN0b21TcGVlZCA9IGV4cG9ydHMuc2V0TWluV3BtID0gZXhwb3J0cy5zZXRSZXBlYXRlZFBhY2UgPSBleHBvcnRzLnNldFBhY2VDYXJldEN1c3RvbVNwZWVkID0gZXhwb3J0cy5zZXRQYWNlQ2FyZXQgPSBleHBvcnRzLnNldFN3YXBFc2NBbmRUYWIgPSBleHBvcnRzLnNldFNob3dPdXRPZkZvY3VzV2FybmluZyA9IGV4cG9ydHMuc2V0QWx3YXlzU2hvd0NQTSA9IGV4cG9ydHMuc2V0QWx3YXlzU2hvd0RlY2ltYWxQbGFjZXMgPSBleHBvcnRzLnNldFN0b3BPbkVycm9yID0gZXhwb3J0cy5zZXRDaGFydFN0eWxlID0gZXhwb3J0cy5zZXRDaGFydEFjY3VyYWN5ID0gZXhwb3J0cy5zZXRCbGluZE1vZGUgPSBleHBvcnRzLnNldEZ1bmJveCA9IGV4cG9ydHMuc2V0RmF2VGhlbWVzID0gZXhwb3J0cy5zZXREaWZmaWN1bHR5ID0gZXhwb3J0cy5zZXRTb3VuZFZvbHVtZSA9IGV4cG9ydHMuc2V0UGxheVNvdW5kT25DbGljayA9IGV4cG9ydHMuc2V0UGxheVNvdW5kT25FcnJvciA9IGV4cG9ydHMuc2V0TW9kZSA9IGV4cG9ydHMuc2V0UHVuY3R1YXRpb24gPSBleHBvcnRzLnNldE51bWJlcnMgPSBleHBvcnRzLnNhdmVGdWxsQ29uZmlnVG9Mb2NhbFN0b3JhZ2UgPSBleHBvcnRzLnNldENoYW5nZWRCZWZvcmVEYiA9IGV4cG9ydHMuc2V0RGJDb25maWdMb2FkZWQgPSBleHBvcnRzLnNldExvY2FsU3RvcmFnZUNvbmZpZyA9IGV4cG9ydHMuY2hhbmdlZEJlZm9yZURiID0gZXhwb3J0cy5kYkNvbmZpZ0xvYWRlZCA9IGV4cG9ydHMubG9jYWxTdG9yYWdlQ29uZmlnID0gdm9pZCAwO1xuZXhwb3J0cy5sb2FkUHJvbWlzZSA9IGV4cG9ydHMuc2V0Q29uZmlnID0gZXhwb3J0cy5nZXRDb25maWdDaGFuZ2VzID0gZXhwb3J0cy5sb2FkRnJvbUxvY2FsU3RvcmFnZSA9IGV4cG9ydHMucmVzZXQgPSBleHBvcnRzLmFwcGx5ID0gZXhwb3J0cy5zZXRCdXJzdEhlYXRtYXAgPSBleHBvcnRzLnNldE1vbmtleVBvd2VyTGV2ZWwgPSBleHBvcnRzLnNldEN1c3RvbUJhY2tncm91bmRGaWx0ZXIgPSBleHBvcnRzLnNldEN1c3RvbUJhY2tncm91bmRTaXplID0gZXhwb3J0cy5zZXRDdXN0b21MYXlvdXRmbHVpZCA9IGV4cG9ydHMuc2V0Q3VzdG9tQmFja2dyb3VuZCA9IGV4cG9ydHMuc2V0Rm9udFNpemUgPSBleHBvcnRzLnNldExheW91dCA9IGV4cG9ydHMuc2V0S2V5bWFwTGF5b3V0ID0gZXhwb3J0cy5zZXRLZXltYXBTdHlsZSA9IGV4cG9ydHMuc2V0S2V5bWFwTGVnZW5kU3R5bGUgPSBleHBvcnRzLnNldEtleW1hcE1vZGUgPSBleHBvcnRzLnNldE1vbmtleSA9IGV4cG9ydHMuc2V0TGFuZ3VhZ2UgPSBleHBvcnRzLnNldEN1c3RvbVRoZW1lQ29sb3JzID0gZXhwb3J0cy5zZXRMYXp5TW9kZSA9IGV4cG9ydHMuc2V0QnJpdGlzaEVuZ2xpc2ggPSBleHBvcnRzLnNldFJhbmRvbVRoZW1lID0gZXhwb3J0cy5zZXRUaGVtZURhcmsgPSBleHBvcnRzLnNldFRoZW1lTGlnaHQgPSBleHBvcnRzLnNldFRoZW1lID0gZXhwb3J0cy5zZXRDdXN0b21UaGVtZSA9IGV4cG9ydHMuc2V0QXV0b1N3aXRjaFRoZW1lID0gZXhwb3J0cy5zZXRJbmRpY2F0ZVR5cG9zID0gZXhwb3J0cy5zZXRDb25maWRlbmNlTW9kZSA9IGV4cG9ydHMuc2V0RnJlZWRvbU1vZGUgPSBleHBvcnRzLnNldEZvbnRGYW1pbHkgPSBleHBvcnRzLnByZXZpZXdGb250RmFtaWx5ID0gZXhwb3J0cy5zZXRRdWlja1RhYk1vZGUgPSBleHBvcnRzLnNldFNtb290aExpbmVTY3JvbGwgPSBleHBvcnRzLnNldFN0YXJ0R3JhcGhzQXRaZXJvID0gZXhwb3J0cy5zZXRTbW9vdGhDYXJldCA9IGV4cG9ydHMuc2V0V29yZENvdW50ID0gZXhwb3J0cy5zZXRRdW90ZUxlbmd0aCA9IGV4cG9ydHMuc2V0VGltZUNvbmZpZyA9IGV4cG9ydHMuc2V0S2V5VGlwcyA9IGV4cG9ydHMuc2V0VGltZXJPcGFjaXR5ID0gZXhwb3J0cy5zZXRUaW1lckNvbG9yID0gZXhwb3J0cy5zZXRUaW1lclN0eWxlID0gZXhwb3J0cy5zZXRIaWRlRXh0cmFMZXR0ZXJzID0gZXhwb3J0cy5zZXRIaWdobGlnaHRNb2RlID0gZXhwb3J0cy5zZXRTaG93QXZlcmFnZSA9IGV4cG9ydHMuc2V0U2hvd0xpdmVCdXJzdCA9IHZvaWQgMDtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2RiXCIpKTtcbmNvbnN0IE91dE9mRm9jdXMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC9vdXQtb2YtZm9jdXNcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IGNvbmZpZ192YWxpZGF0aW9uXzEgPSByZXF1aXJlKFwiLi9jb25maWctdmFsaWRhdGlvblwiKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBkZWZhdWx0X2NvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL2NvbnN0YW50cy9kZWZhdWx0LWNvbmZpZ1wiKSk7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4vZmlyZWJhc2VcIik7XG5jb25zdCBBbmFseXRpY3NDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2NvbnRyb2xsZXJzL2FuYWx5dGljcy1jb250cm9sbGVyXCIpKTtcbmV4cG9ydHMuZGJDb25maWdMb2FkZWQgPSBmYWxzZTtcbmV4cG9ydHMuY2hhbmdlZEJlZm9yZURiID0gZmFsc2U7XG5mdW5jdGlvbiBzZXRMb2NhbFN0b3JhZ2VDb25maWcodmFsKSB7XG4gICAgZXhwb3J0cy5sb2NhbFN0b3JhZ2VDb25maWcgPSB2YWw7XG59XG5leHBvcnRzLnNldExvY2FsU3RvcmFnZUNvbmZpZyA9IHNldExvY2FsU3RvcmFnZUNvbmZpZztcbmZ1bmN0aW9uIHNldERiQ29uZmlnTG9hZGVkKHZhbCkge1xuICAgIGV4cG9ydHMuZGJDb25maWdMb2FkZWQgPSB2YWw7XG59XG5leHBvcnRzLnNldERiQ29uZmlnTG9hZGVkID0gc2V0RGJDb25maWdMb2FkZWQ7XG5mdW5jdGlvbiBzZXRDaGFuZ2VkQmVmb3JlRGIodmFsKSB7XG4gICAgZXhwb3J0cy5jaGFuZ2VkQmVmb3JlRGIgPSB2YWw7XG59XG5leHBvcnRzLnNldENoYW5nZWRCZWZvcmVEYiA9IHNldENoYW5nZWRCZWZvcmVEYjtcbmxldCBsb2FkRG9uZTtcbmxldCBjb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0X2NvbmZpZ18xLmRlZmF1bHQpO1xuZnVuY3Rpb24gc2F2ZVRvTG9jYWxTdG9yYWdlKGtleSwgbm9zYXZlID0gZmFsc2UsIG5vRGJDaGVjayA9IGZhbHNlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCFleHBvcnRzLmRiQ29uZmlnTG9hZGVkICYmICFub0RiQ2hlY2sgJiYgIW5vc2F2ZSkge1xuICAgICAgICAgICAgc2V0Q2hhbmdlZEJlZm9yZURiKHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub3NhdmUpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGxvY2FsVG9TYXZlID0gY29uZmlnO1xuICAgICAgICBkZWxldGUgbG9jYWxUb1NhdmUucmVzdWx0RmlsdGVycztcbiAgICAgICAgY29uc3QgbG9jYWxUb1NhdmVTdHJpbmdpZmllZCA9IEpTT04uc3RyaW5naWZ5KGxvY2FsVG9TYXZlKTtcbiAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiY29uZmlnXCIsIGxvY2FsVG9TYXZlU3RyaW5naWZpZWQpO1xuICAgICAgICBpZiAoIW5vRGJDaGVjaykge1xuICAgICAgICAgICAgLy8gYXdhaXQgREIuc2F2ZUNvbmZpZyhkYlRvU2F2ZSk7XG4gICAgICAgICAgICB5aWVsZCBzYXZlVG9EYXRhYmFzZShrZXkpO1xuICAgICAgICB9XG4gICAgICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic2F2ZVRvTG9jYWxTdG9yYWdlXCIsIGxvY2FsVG9TYXZlU3RyaW5naWZpZWQpO1xuICAgIH0pO1xufVxubGV0IGNvbmZpZ1RvU2VuZCA9IHt9O1xubGV0IHNhdmVUaW1lb3V0ID0gbnVsbDtcbmZ1bmN0aW9uIHNhdmVUb0RhdGFiYXNlKGtleSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbmZpZ1RvU2VuZFtrZXldID0gY29uZmlnW2tleV07XG4gICAgICAgIGlmIChzYXZlVGltZW91dCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgc2F2ZVRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgY29uZmlnVG9TZW5kLnJlc3VsdEZpbHRlcnM7XG4gICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGNvbmZpZ1RvU2VuZCkubGVuZ3RoID4gMClcbiAgICAgICAgICAgICAgICAgICAgREIuc2F2ZUNvbmZpZyhjb25maWdUb1NlbmQpO1xuICAgICAgICAgICAgICAgIGNvbmZpZ1RvU2VuZCA9IHt9O1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChzYXZlVGltZW91dCk7XG4gICAgICAgICAgICAgICAgc2F2ZVRpbWVvdXQgPSBudWxsO1xuICAgICAgICAgICAgfSksIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSA9PT0gXCJsb2NhbGhvc3RcIiA/IDAgOiAxMDAwKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZnVuY3Rpb24gc2F2ZUZ1bGxDb25maWdUb0xvY2FsU3RvcmFnZShub0RiQ2hlY2sgPSBmYWxzZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmICghZXhwb3J0cy5kYkNvbmZpZ0xvYWRlZCAmJiAhbm9EYkNoZWNrKSB7XG4gICAgICAgICAgICBzZXRDaGFuZ2VkQmVmb3JlRGIodHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2F2ZSA9IGNvbmZpZztcbiAgICAgICAgZGVsZXRlIHNhdmUucmVzdWx0RmlsdGVycztcbiAgICAgICAgY29uc3Qgc3RyaW5naWZpZWQgPSBKU09OLnN0cmluZ2lmeShzYXZlKTtcbiAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiY29uZmlnXCIsIHN0cmluZ2lmaWVkKTtcbiAgICAgICAgaWYgKCFub0RiQ2hlY2spXG4gICAgICAgICAgICB5aWVsZCBEQi5zYXZlQ29uZmlnKHNhdmUpO1xuICAgICAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInNhdmVUb0xvY2FsU3RvcmFnZVwiLCBzdHJpbmdpZmllZCk7XG4gICAgfSk7XG59XG5leHBvcnRzLnNhdmVGdWxsQ29uZmlnVG9Mb2NhbFN0b3JhZ2UgPSBzYXZlRnVsbENvbmZpZ1RvTG9jYWxTdG9yYWdlO1xuLy9udW1iZXJzXG5mdW5jdGlvbiBzZXROdW1iZXJzKG51bWIsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcIm51bWJlcnNcIiwgbnVtYiwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAoY29uZmlnLm1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICBudW1iID0gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5udW1iZXJzID0gbnVtYjtcbiAgICBpZiAoIWNvbmZpZy5udW1iZXJzKSB7XG4gICAgICAgICQoXCIjdG9wIC5jb25maWcgLm51bWJlcnNNb2RlIC50ZXh0LWJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIjdG9wIC5jb25maWcgLm51bWJlcnNNb2RlIC50ZXh0LWJ1dHRvblwiKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICB9XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwibnVtYmVyc1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwibnVtYmVyc1wiLCBjb25maWcubnVtYmVycyk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldE51bWJlcnMgPSBzZXROdW1iZXJzO1xuLy9wdW5jdHVhdGlvblxuZnVuY3Rpb24gc2V0UHVuY3R1YXRpb24ocHVuYywgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwicHVuY3R1YXRpb25cIiwgcHVuYywgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAoY29uZmlnLm1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICBwdW5jID0gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5wdW5jdHVhdGlvbiA9IHB1bmM7XG4gICAgaWYgKCFjb25maWcucHVuY3R1YXRpb24pIHtcbiAgICAgICAgJChcIiN0b3AgLmNvbmZpZyAucHVuY3R1YXRpb25Nb2RlIC50ZXh0LWJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIjdG9wIC5jb25maWcgLnB1bmN0dWF0aW9uTW9kZSAudGV4dC1idXR0b25cIikuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgfVxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInB1bmN0dWF0aW9uXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJwdW5jdHVhdGlvblwiLCBjb25maWcucHVuY3R1YXRpb24pO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRQdW5jdHVhdGlvbiA9IHNldFB1bmN0dWF0aW9uO1xuZnVuY3Rpb24gc2V0TW9kZShtb2RlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJtb2RlXCIsIG1vZGUsIFtcbiAgICAgICAgW1widGltZVwiLCBcIndvcmRzXCIsIFwicXVvdGVcIiwgXCJ6ZW5cIiwgXCJjdXN0b21cIl0sXG4gICAgXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAobW9kZSAhPT0gXCJ3b3Jkc1wiICYmIGNvbmZpZy5mdW5ib3ggPT09IFwibWVtb3J5XCIpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJNZW1vcnkgZnVuYm94IGNhbiBvbmx5IGJlIHVzZWQgd2l0aCB3b3JkcyBtb2RlLlwiLCAwKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBwcmV2aW91cyA9IGNvbmZpZy5tb2RlO1xuICAgIGNvbmZpZy5tb2RlID0gbW9kZTtcbiAgICBpZiAoY29uZmlnLm1vZGUgPT0gXCJjdXN0b21cIikge1xuICAgICAgICBzZXRQdW5jdHVhdGlvbihmYWxzZSwgdHJ1ZSk7XG4gICAgICAgIHNldE51bWJlcnMoZmFsc2UsIHRydWUpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWcubW9kZSA9PSBcInF1b3RlXCIpIHtcbiAgICAgICAgc2V0UHVuY3R1YXRpb24oZmFsc2UsIHRydWUpO1xuICAgICAgICBzZXROdW1iZXJzKGZhbHNlLCB0cnVlKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnLm1vZGUgPT0gXCJ6ZW5cIikge1xuICAgICAgICBpZiAoY29uZmlnLnBhY2VDYXJldCAhPSBcIm9mZlwiKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgUGFjZSBjYXJldCB3aWxsIG5vdCB3b3JrIHdpdGggemVuIG1vZGUuYCwgMCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwibW9kZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwibW9kZVwiLCBjb25maWcubW9kZSwgbm9zYXZlLCBwcmV2aW91cyk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldE1vZGUgPSBzZXRNb2RlO1xuZnVuY3Rpb24gc2V0UGxheVNvdW5kT25FcnJvcih2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInBsYXkgc291bmQgb24gZXJyb3JcIiwgdmFsLCBbXCJib29sZWFuXCJdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5wbGF5U291bmRPbkVycm9yID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInBsYXlTb3VuZE9uRXJyb3JcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInBsYXlTb3VuZE9uRXJyb3JcIiwgY29uZmlnLnBsYXlTb3VuZE9uRXJyb3IpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRQbGF5U291bmRPbkVycm9yID0gc2V0UGxheVNvdW5kT25FcnJvcjtcbmZ1bmN0aW9uIHNldFBsYXlTb3VuZE9uQ2xpY2sodmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJwbGF5IHNvdW5kIG9uIGNsaWNrXCIsIHZhbCwgW1xuICAgICAgICBbXCJvZmZcIiwgXCIxXCIsIFwiMlwiLCBcIjNcIiwgXCI0XCIsIFwiNVwiLCBcIjZcIiwgXCI3XCJdLFxuICAgIF0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnBsYXlTb3VuZE9uQ2xpY2sgPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwicGxheVNvdW5kT25DbGlja1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwicGxheVNvdW5kT25DbGlja1wiLCBjb25maWcucGxheVNvdW5kT25DbGljayk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFBsYXlTb3VuZE9uQ2xpY2sgPSBzZXRQbGF5U291bmRPbkNsaWNrO1xuZnVuY3Rpb24gc2V0U291bmRWb2x1bWUodmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJzb3VuZCB2b2x1bWVcIiwgdmFsLCBbW1wiMC4xXCIsIFwiMC41XCIsIFwiMS4wXCJdXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuc291bmRWb2x1bWUgPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwic291bmRWb2x1bWVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInNvdW5kVm9sdW1lXCIsIGNvbmZpZy5zb3VuZFZvbHVtZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFNvdW5kVm9sdW1lID0gc2V0U291bmRWb2x1bWU7XG4vL2RpZmZpY3VsdHlcbmZ1bmN0aW9uIHNldERpZmZpY3VsdHkoZGlmZiwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiZGlmZmljdWx0eVwiLCBkaWZmLCBbW1wibm9ybWFsXCIsIFwiZXhwZXJ0XCIsIFwibWFzdGVyXCJdXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuZGlmZmljdWx0eSA9IGRpZmY7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiZGlmZmljdWx0eVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiZGlmZmljdWx0eVwiLCBjb25maWcuZGlmZmljdWx0eSwgbm9zYXZlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0RGlmZmljdWx0eSA9IHNldERpZmZpY3VsdHk7XG4vL3NldCBmYXYgdGhlbWVzXG5mdW5jdGlvbiBzZXRGYXZUaGVtZXModGhlbWVzLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJmYXZvcml0ZSB0aGVtZXNcIiwgdGhlbWVzLCBbXCJzdHJpbmdBcnJheVwiXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuZmF2VGhlbWVzID0gdGhlbWVzO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImZhdlRoZW1lc1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiZmF2VGhlbWVzXCIsIGNvbmZpZy5mYXZUaGVtZXMpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRGYXZUaGVtZXMgPSBzZXRGYXZUaGVtZXM7XG5mdW5jdGlvbiBzZXRGdW5ib3goZnVuYm94LCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJmdW5ib3hcIiwgZnVuYm94LCBbXCJzdHJpbmdcIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uc3QgdmFsID0gZnVuYm94ID8gZnVuYm94IDogXCJub25lXCI7XG4gICAgY29uZmlnLmZ1bmJveCA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJmdW5ib3hcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImZ1bmJveFwiLCBjb25maWcuZnVuYm94KTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0RnVuYm94ID0gc2V0RnVuYm94O1xuZnVuY3Rpb24gc2V0QmxpbmRNb2RlKGJsaW5kLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJibGluZCBtb2RlXCIsIGJsaW5kLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5ibGluZE1vZGUgPSBibGluZDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJibGluZE1vZGVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImJsaW5kTW9kZVwiLCBjb25maWcuYmxpbmRNb2RlLCBub3NhdmUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRCbGluZE1vZGUgPSBzZXRCbGluZE1vZGU7XG5mdW5jdGlvbiBzZXRDaGFydEFjY3VyYWN5KGNoYXJ0QWNjdXJhY3ksIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImNoYXJ0IGFjY3VyYWN5XCIsIGNoYXJ0QWNjdXJhY3ksIFtcImJvb2xlYW5cIl0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmNoYXJ0QWNjdXJhY3kgPSBjaGFydEFjY3VyYWN5O1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImNoYXJ0QWNjdXJhY3lcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImNoYXJ0QWNjdXJhY3lcIiwgY29uZmlnLmNoYXJ0QWNjdXJhY3kpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRDaGFydEFjY3VyYWN5ID0gc2V0Q2hhcnRBY2N1cmFjeTtcbmZ1bmN0aW9uIHNldENoYXJ0U3R5bGUoY2hhcnRTdHlsZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiY2hhcnQgc3R5bGVcIiwgY2hhcnRTdHlsZSwgW1tcImxpbmVcIiwgXCJzY2F0dGVyXCJdXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuY2hhcnRTdHlsZSA9IGNoYXJ0U3R5bGU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiY2hhcnRTdHlsZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiY2hhcnRTdHlsZVwiLCBjb25maWcuY2hhcnRTdHlsZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldENoYXJ0U3R5bGUgPSBzZXRDaGFydFN0eWxlO1xuZnVuY3Rpb24gc2V0U3RvcE9uRXJyb3Ioc29lLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJzdG9wIG9uIGVycm9yXCIsIHNvZSwgW1tcIm9mZlwiLCBcIndvcmRcIiwgXCJsZXR0ZXJcIl1dKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5zdG9wT25FcnJvciA9IHNvZTtcbiAgICBpZiAoY29uZmlnLnN0b3BPbkVycm9yICE9PSBcIm9mZlwiKSB7XG4gICAgICAgIGNvbmZpZy5jb25maWRlbmNlTW9kZSA9IFwib2ZmXCI7XG4gICAgfVxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInN0b3BPbkVycm9yXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzdG9wT25FcnJvclwiLCBjb25maWcuc3RvcE9uRXJyb3IsIG5vc2F2ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFN0b3BPbkVycm9yID0gc2V0U3RvcE9uRXJyb3I7XG5mdW5jdGlvbiBzZXRBbHdheXNTaG93RGVjaW1hbFBsYWNlcyh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImFsd2F5cyBzaG93IGRlY2ltYWwgcGxhY2VzXCIsIHZhbCwgW1wiYm9vbGVhblwiXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuYWx3YXlzU2hvd0RlY2ltYWxQbGFjZXMgPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiYWx3YXlzU2hvd0RlY2ltYWxQbGFjZXNcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzXCIsIGNvbmZpZy5hbHdheXNTaG93RGVjaW1hbFBsYWNlcyk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzID0gc2V0QWx3YXlzU2hvd0RlY2ltYWxQbGFjZXM7XG5mdW5jdGlvbiBzZXRBbHdheXNTaG93Q1BNKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiYWx3YXlzIHNob3cgQ1BNXCIsIHZhbCwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcuYWx3YXlzU2hvd0NQTSA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJhbHdheXNTaG93Q1BNXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJhbHdheXNTaG93Q1BNXCIsIGNvbmZpZy5hbHdheXNTaG93Q1BNKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0QWx3YXlzU2hvd0NQTSA9IHNldEFsd2F5c1Nob3dDUE07XG5mdW5jdGlvbiBzZXRTaG93T3V0T2ZGb2N1c1dhcm5pbmcodmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJzaG93IG91dCBvZiBmb2N1cyB3YXJuaW5nXCIsIHZhbCwgW1wiYm9vbGVhblwiXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuc2hvd091dE9mRm9jdXNXYXJuaW5nID0gdmFsO1xuICAgIGlmICghY29uZmlnLnNob3dPdXRPZkZvY3VzV2FybmluZykge1xuICAgICAgICBPdXRPZkZvY3VzLmhpZGUoKTtcbiAgICB9XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwic2hvd091dE9mRm9jdXNXYXJuaW5nXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzaG93T3V0T2ZGb2N1c1dhcm5pbmdcIiwgY29uZmlnLnNob3dPdXRPZkZvY3VzV2FybmluZyk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFNob3dPdXRPZkZvY3VzV2FybmluZyA9IHNldFNob3dPdXRPZkZvY3VzV2FybmluZztcbmZ1bmN0aW9uIHNldFN3YXBFc2NBbmRUYWIodmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJzd2FwIGVzYyBhbmQgdGFiXCIsIHZhbCwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcuc3dhcEVzY0FuZFRhYiA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJzd2FwRXNjQW5kVGFiXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzd2FwRXNjQW5kVGFiXCIsIGNvbmZpZy5zd2FwRXNjQW5kVGFiKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0U3dhcEVzY0FuZFRhYiA9IHNldFN3YXBFc2NBbmRUYWI7XG4vL3BhY2UgY2FyZXRcbmZ1bmN0aW9uIHNldFBhY2VDYXJldCh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInBhY2UgY2FyZXRcIiwgdmFsLCBbW1wiY3VzdG9tXCIsIFwib2ZmXCIsIFwiYXZlcmFnZVwiLCBcInBiXCJdXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gXCJjb21wbGV0ZVwiKSB7XG4gICAgICAgIGlmICh2YWwgPT0gXCJwYlwiICYmIGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciA9PT0gbnVsbCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJQQiBwYWNlIGNhcmV0IGlzIHVuYXZhaWxhYmxlIHdpdGhvdXQgYW4gYWNjb3VudFwiLCAwKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBpZiAoY29uZmlnLm1vZGUgPT09IFwiemVuXCIgJiYgdmFsICE9IFwib2ZmXCIpIHtcbiAgICAvLyAgIE5vdGlmaWNhdGlvbnMuYWRkKGBDYW4ndCB1c2UgcGFjZSBjYXJldCB3aXRoIHplbiBtb2RlLmAsIDApO1xuICAgIC8vICAgdmFsID0gXCJvZmZcIjtcbiAgICAvLyB9XG4gICAgY29uZmlnLnBhY2VDYXJldCA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJwYWNlQ2FyZXRcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInBhY2VDYXJldFwiLCBjb25maWcucGFjZUNhcmV0LCBub3NhdmUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRQYWNlQ2FyZXQgPSBzZXRQYWNlQ2FyZXQ7XG5mdW5jdGlvbiBzZXRQYWNlQ2FyZXRDdXN0b21TcGVlZCh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInBhY2UgY2FyZXQgY3VzdG9tIHNwZWVkXCIsIHZhbCwgW1wibnVtYmVyXCJdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5wYWNlQ2FyZXRDdXN0b21TcGVlZCA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJwYWNlQ2FyZXRDdXN0b21TcGVlZFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwicGFjZUNhcmV0Q3VzdG9tU3BlZWRcIiwgY29uZmlnLnBhY2VDYXJldEN1c3RvbVNwZWVkKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0UGFjZUNhcmV0Q3VzdG9tU3BlZWQgPSBzZXRQYWNlQ2FyZXRDdXN0b21TcGVlZDtcbmZ1bmN0aW9uIHNldFJlcGVhdGVkUGFjZShwYWNlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJyZXBlYXRlZCBwYWNlXCIsIHBhY2UsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLnJlcGVhdGVkUGFjZSA9IHBhY2U7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwicmVwZWF0ZWRQYWNlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJyZXBlYXRlZFBhY2VcIiwgY29uZmlnLnJlcGVhdGVkUGFjZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFJlcGVhdGVkUGFjZSA9IHNldFJlcGVhdGVkUGFjZTtcbi8vbWluIHdwbVxuZnVuY3Rpb24gc2V0TWluV3BtKG1pbndwbSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwibWluIFdQTVwiLCBtaW53cG0sIFtbXCJvZmZcIiwgXCJjdXN0b21cIl1dKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5taW5XcG0gPSBtaW53cG07XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwibWluV3BtXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJtaW5XcG1cIiwgY29uZmlnLm1pbldwbSwgbm9zYXZlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0TWluV3BtID0gc2V0TWluV3BtO1xuZnVuY3Rpb24gc2V0TWluV3BtQ3VzdG9tU3BlZWQodmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJtaW4gV1BNIGN1c3RvbSBzcGVlZFwiLCB2YWwsIFtcIm51bWJlclwiXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcubWluV3BtQ3VzdG9tU3BlZWQgPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwibWluV3BtQ3VzdG9tU3BlZWRcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcIm1pbldwbUN1c3RvbVNwZWVkXCIsIGNvbmZpZy5taW5XcG1DdXN0b21TcGVlZCk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldE1pbldwbUN1c3RvbVNwZWVkID0gc2V0TWluV3BtQ3VzdG9tU3BlZWQ7XG4vL21pbiBhY2NcbmZ1bmN0aW9uIHNldE1pbkFjYyhtaW4sIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcIm1pbiBhY2NcIiwgbWluLCBbW1wib2ZmXCIsIFwiY3VzdG9tXCJdXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcubWluQWNjID0gbWluO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcIm1pbkFjY1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwibWluQWNjXCIsIGNvbmZpZy5taW5BY2MsIG5vc2F2ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldE1pbkFjYyA9IHNldE1pbkFjYztcbmZ1bmN0aW9uIHNldE1pbkFjY0N1c3RvbSh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcIm1pbiBhY2MgY3VzdG9tXCIsIHZhbCwgW1wibnVtYmVyXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5taW5BY2NDdXN0b20gPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwibWluQWNjQ3VzdG9tXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJtaW5BY2NDdXN0b21cIiwgY29uZmlnLm1pbkFjY0N1c3RvbSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldE1pbkFjY0N1c3RvbSA9IHNldE1pbkFjY0N1c3RvbTtcbi8vbWluIGJ1cnN0XG5mdW5jdGlvbiBzZXRNaW5CdXJzdChtaW4sIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcIm1pbiBidXJzdFwiLCBtaW4sIFtbXCJvZmZcIiwgXCJmaXhlZFwiLCBcImZsZXhcIl1dKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5taW5CdXJzdCA9IG1pbjtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJtaW5CdXJzdFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwibWluQnVyc3RcIiwgY29uZmlnLm1pbkJ1cnN0LCBub3NhdmUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRNaW5CdXJzdCA9IHNldE1pbkJ1cnN0O1xuZnVuY3Rpb24gc2V0TWluQnVyc3RDdXN0b21TcGVlZCh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcIm1pbiBidXJzdCBjdXN0b20gc3BlZWRcIiwgdmFsLCBbXCJudW1iZXJcIl0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLm1pbkJ1cnN0Q3VzdG9tU3BlZWQgPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwibWluQnVyc3RDdXN0b21TcGVlZFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwibWluQnVyc3RDdXN0b21TcGVlZFwiLCBjb25maWcubWluQnVyc3RDdXN0b21TcGVlZCk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldE1pbkJ1cnN0Q3VzdG9tU3BlZWQgPSBzZXRNaW5CdXJzdEN1c3RvbVNwZWVkO1xuLy9hbHdheXMgc2hvdyB3b3JkcyBoaXN0b3J5XG5mdW5jdGlvbiBzZXRBbHdheXNTaG93V29yZHNIaXN0b3J5KHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiYWx3YXlzIHNob3cgd29yZHMgaGlzdG9yeVwiLCB2YWwsIFtcImJvb2xlYW5cIl0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmFsd2F5c1Nob3dXb3Jkc0hpc3RvcnkgPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiYWx3YXlzU2hvd1dvcmRzSGlzdG9yeVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiYWx3YXlzU2hvd1dvcmRzSGlzdG9yeVwiLCBjb25maWcuYWx3YXlzU2hvd1dvcmRzSGlzdG9yeSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEFsd2F5c1Nob3dXb3Jkc0hpc3RvcnkgPSBzZXRBbHdheXNTaG93V29yZHNIaXN0b3J5O1xuLy9zaW5nbGUgbGlzdCBjb21tYW5kIGxpbmVcbmZ1bmN0aW9uIHNldFNpbmdsZUxpc3RDb21tYW5kTGluZShvcHRpb24sIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInNpbmdsZSBsaXN0IGNvbW1hbmQgbGluZVwiLCBvcHRpb24sIFtbXCJtYW51YWxcIiwgXCJvblwiXV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnNpbmdsZUxpc3RDb21tYW5kTGluZSA9IG9wdGlvbjtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJzaW5nbGVMaXN0Q29tbWFuZExpbmVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInNpbmdsZUxpc3RDb21tYW5kTGluZVwiLCBjb25maWcuc2luZ2xlTGlzdENvbW1hbmRMaW5lKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0U2luZ2xlTGlzdENvbW1hbmRMaW5lID0gc2V0U2luZ2xlTGlzdENvbW1hbmRMaW5lO1xuLy9jYXBzIGxvY2sgd2FybmluZ1xuZnVuY3Rpb24gc2V0Q2Fwc0xvY2tXYXJuaW5nKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiY2FwcyBsb2NrIHdhcm5pbmdcIiwgdmFsLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5jYXBzTG9ja1dhcm5pbmcgPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiY2Fwc0xvY2tXYXJuaW5nXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJjYXBzTG9ja1dhcm5pbmdcIiwgY29uZmlnLmNhcHNMb2NrV2FybmluZyk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldENhcHNMb2NrV2FybmluZyA9IHNldENhcHNMb2NrV2FybmluZztcbmZ1bmN0aW9uIHNldFNob3dBbGxMaW5lcyhzYWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInNob3cgYWxsIGxpbmVzXCIsIHNhbCwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcuc2hvd0FsbExpbmVzID0gc2FsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInNob3dBbGxMaW5lc1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic2hvd0FsbExpbmVzXCIsIGNvbmZpZy5zaG93QWxsTGluZXMsIG5vc2F2ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFNob3dBbGxMaW5lcyA9IHNldFNob3dBbGxMaW5lcztcbmZ1bmN0aW9uIHNldFF1aWNrRW5kKHFlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJxdWljayBlbmRcIiwgcWUsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLnF1aWNrRW5kID0gcWU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwicXVpY2tFbmRcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInF1aWNrRW5kXCIsIGNvbmZpZy5xdWlja0VuZCk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFF1aWNrRW5kID0gc2V0UXVpY2tFbmQ7XG5mdW5jdGlvbiBzZXRFbmFibGVBZHModmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJlbmFibGUgYWRzXCIsIHZhbCwgW1tcIm9uXCIsIFwib2ZmXCIsIFwibWF4XCJdXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuZW5hYmxlQWRzID0gdmFsO1xuICAgIGlmICghbm9zYXZlKSB7XG4gICAgICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImVuYWJsZUFkc1wiLCBub3NhdmUpO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICB9LCAzMDAwKTtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJBZCBzZXR0aW5ncyBjaGFuZ2VkLiBSZWZyZXNoaW5nLi4uXCIsIDApO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0RW5hYmxlQWRzID0gc2V0RW5hYmxlQWRzO1xuZnVuY3Rpb24gc2V0UmVwZWF0UXVvdGVzKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwicmVwZWF0IHF1b3Rlc1wiLCB2YWwsIFtbXCJvZmZcIiwgXCJ0eXBpbmdcIl1dKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5yZXBlYXRRdW90ZXMgPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwicmVwZWF0UXVvdGVzXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJyZXBlYXRRdW90ZXNcIiwgY29uZmlnLnJlcGVhdFF1b3Rlcyk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFJlcGVhdFF1b3RlcyA9IHNldFJlcGVhdFF1b3Rlcztcbi8vZmxpcCBjb2xvcnNcbmZ1bmN0aW9uIHNldEZsaXBUZXN0Q29sb3JzKGZsaXAsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImZsaXAgdGVzdCBjb2xvcnNcIiwgZmxpcCwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcuZmxpcFRlc3RDb2xvcnMgPSBmbGlwO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImZsaXBUZXN0Q29sb3JzXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJmbGlwVGVzdENvbG9yc1wiLCBjb25maWcuZmxpcFRlc3RDb2xvcnMpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRGbGlwVGVzdENvbG9ycyA9IHNldEZsaXBUZXN0Q29sb3JzO1xuLy9leHRyYSBjb2xvclxuZnVuY3Rpb24gc2V0Q29sb3JmdWxNb2RlKGV4dHJhLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJjb2xvcmZ1bCBtb2RlXCIsIGV4dHJhLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5jb2xvcmZ1bE1vZGUgPSBleHRyYTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJjb2xvcmZ1bE1vZGVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImNvbG9yZnVsTW9kZVwiLCBjb25maWcuY29sb3JmdWxNb2RlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0Q29sb3JmdWxNb2RlID0gc2V0Q29sb3JmdWxNb2RlO1xuLy9zdHJpY3Qgc3BhY2VcbmZ1bmN0aW9uIHNldFN0cmljdFNwYWNlKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwic3RyaWN0IHNwYWNlXCIsIHZhbCwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcuc3RyaWN0U3BhY2UgPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwic3RyaWN0U3BhY2VcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInN0cmljdFNwYWNlXCIsIGNvbmZpZy5zdHJpY3RTcGFjZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFN0cmljdFNwYWNlID0gc2V0U3RyaWN0U3BhY2U7XG4vL29wcG9zaXRlIHNoaWZ0IHNwYWNlXG5mdW5jdGlvbiBzZXRPcHBvc2l0ZVNoaWZ0TW9kZSh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcIm9wcG9zaXRlIHNoaWZ0IG1vZGVcIiwgdmFsLCBbW1wib2ZmXCIsIFwib25cIiwgXCJrZXltYXBcIl1dKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5vcHBvc2l0ZVNoaWZ0TW9kZSA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJvcHBvc2l0ZVNoaWZ0TW9kZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwib3Bwb3NpdGVTaGlmdE1vZGVcIiwgY29uZmlnLm9wcG9zaXRlU2hpZnRNb2RlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0T3Bwb3NpdGVTaGlmdE1vZGUgPSBzZXRPcHBvc2l0ZVNoaWZ0TW9kZTtcbmZ1bmN0aW9uIHNldFBhZ2VXaWR0aCh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInBhZ2Ugd2lkdGhcIiwgdmFsLCBbXG4gICAgICAgIFtcIm1heFwiLCBcIjEwMFwiLCBcIjEyNVwiLCBcIjE1MFwiLCBcIjIwMFwiXSxcbiAgICBdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5wYWdlV2lkdGggPSB2YWw7XG4gICAgJChcIiNjZW50ZXJDb250ZW50XCIpLnJlbW92ZUNsYXNzKFwid2lkZTEyNVwiKTtcbiAgICAkKFwiI2NlbnRlckNvbnRlbnRcIikucmVtb3ZlQ2xhc3MoXCJ3aWRlMTUwXCIpO1xuICAgICQoXCIjY2VudGVyQ29udGVudFwiKS5yZW1vdmVDbGFzcyhcIndpZGUyMDBcIik7XG4gICAgJChcIiNjZW50ZXJDb250ZW50XCIpLnJlbW92ZUNsYXNzKFwid2lkZW1heFwiKTtcbiAgICBpZiAodmFsICE9PSBcIjEwMFwiKSB7XG4gICAgICAgICQoXCIjY2VudGVyQ29udGVudFwiKS5hZGRDbGFzcyhcIndpZGVcIiArIHZhbCk7XG4gICAgfVxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInBhZ2VXaWR0aFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwicGFnZVdpZHRoXCIsIGNvbmZpZy5wYWdlV2lkdGgpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRQYWdlV2lkdGggPSBzZXRQYWdlV2lkdGg7XG5mdW5jdGlvbiBzZXRDYXJldFN0eWxlKGNhcmV0U3R5bGUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImNhcmV0IHN0eWxlXCIsIGNhcmV0U3R5bGUsIFtcbiAgICAgICAgW1wib2ZmXCIsIFwiZGVmYXVsdFwiLCBcImJsb2NrXCIsIFwib3V0bGluZVwiLCBcInVuZGVybGluZVwiLCBcImNhcnJvdFwiLCBcImJhbmFuYVwiXSxcbiAgICBdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5jYXJldFN0eWxlID0gY2FyZXRTdHlsZTtcbiAgICAkKFwiI2NhcmV0XCIpLnJlbW92ZUNsYXNzKFwib2ZmXCIpO1xuICAgICQoXCIjY2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJkZWZhdWx0XCIpO1xuICAgICQoXCIjY2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJ1bmRlcmxpbmVcIik7XG4gICAgJChcIiNjYXJldFwiKS5yZW1vdmVDbGFzcyhcIm91dGxpbmVcIik7XG4gICAgJChcIiNjYXJldFwiKS5yZW1vdmVDbGFzcyhcImJsb2NrXCIpO1xuICAgICQoXCIjY2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJjYXJyb3RcIik7XG4gICAgJChcIiNjYXJldFwiKS5yZW1vdmVDbGFzcyhcImJhbmFuYVwiKTtcbiAgICBpZiAoY2FyZXRTdHlsZSA9PSBcIm9mZlwiKSB7XG4gICAgICAgICQoXCIjY2FyZXRcIikuYWRkQ2xhc3MoXCJvZmZcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNhcmV0U3R5bGUgPT0gXCJkZWZhdWx0XCIpIHtcbiAgICAgICAgJChcIiNjYXJldFwiKS5hZGRDbGFzcyhcImRlZmF1bHRcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNhcmV0U3R5bGUgPT0gXCJibG9ja1wiKSB7XG4gICAgICAgICQoXCIjY2FyZXRcIikuYWRkQ2xhc3MoXCJibG9ja1wiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY2FyZXRTdHlsZSA9PSBcIm91dGxpbmVcIikge1xuICAgICAgICAkKFwiI2NhcmV0XCIpLmFkZENsYXNzKFwib3V0bGluZVwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY2FyZXRTdHlsZSA9PSBcInVuZGVybGluZVwiKSB7XG4gICAgICAgICQoXCIjY2FyZXRcIikuYWRkQ2xhc3MoXCJ1bmRlcmxpbmVcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNhcmV0U3R5bGUgPT0gXCJjYXJyb3RcIikge1xuICAgICAgICAkKFwiI2NhcmV0XCIpLmFkZENsYXNzKFwiY2Fycm90XCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjYXJldFN0eWxlID09IFwiYmFuYW5hXCIpIHtcbiAgICAgICAgJChcIiNjYXJldFwiKS5hZGRDbGFzcyhcImJhbmFuYVwiKTtcbiAgICB9XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiY2FyZXRTdHlsZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiY2FyZXRTdHlsZVwiLCBjb25maWcuY2FyZXRTdHlsZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldENhcmV0U3R5bGUgPSBzZXRDYXJldFN0eWxlO1xuZnVuY3Rpb24gc2V0UGFjZUNhcmV0U3R5bGUoY2FyZXRTdHlsZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwicGFjZSBjYXJldCBzdHlsZVwiLCBjYXJldFN0eWxlLCBbXG4gICAgICAgIFtcIm9mZlwiLCBcImRlZmF1bHRcIiwgXCJibG9ja1wiLCBcIm91dGxpbmVcIiwgXCJ1bmRlcmxpbmVcIiwgXCJjYXJyb3RcIiwgXCJiYW5hbmFcIl0sXG4gICAgXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcucGFjZUNhcmV0U3R5bGUgPSBjYXJldFN0eWxlO1xuICAgICQoXCIjcGFjZUNhcmV0XCIpLnJlbW92ZUNsYXNzKFwib2ZmXCIpO1xuICAgICQoXCIjcGFjZUNhcmV0XCIpLnJlbW92ZUNsYXNzKFwiZGVmYXVsdFwiKTtcbiAgICAkKFwiI3BhY2VDYXJldFwiKS5yZW1vdmVDbGFzcyhcInVuZGVybGluZVwiKTtcbiAgICAkKFwiI3BhY2VDYXJldFwiKS5yZW1vdmVDbGFzcyhcIm91dGxpbmVcIik7XG4gICAgJChcIiNwYWNlQ2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJibG9ja1wiKTtcbiAgICAkKFwiI3BhY2VDYXJldFwiKS5yZW1vdmVDbGFzcyhcImNhcnJvdFwiKTtcbiAgICAkKFwiI3BhY2VDYXJldFwiKS5yZW1vdmVDbGFzcyhcImJhbmFuYVwiKTtcbiAgICBpZiAoY2FyZXRTdHlsZSA9PSBcImRlZmF1bHRcIikge1xuICAgICAgICAkKFwiI3BhY2VDYXJldFwiKS5hZGRDbGFzcyhcImRlZmF1bHRcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNhcmV0U3R5bGUgPT0gXCJibG9ja1wiKSB7XG4gICAgICAgICQoXCIjcGFjZUNhcmV0XCIpLmFkZENsYXNzKFwiYmxvY2tcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNhcmV0U3R5bGUgPT0gXCJvdXRsaW5lXCIpIHtcbiAgICAgICAgJChcIiNwYWNlQ2FyZXRcIikuYWRkQ2xhc3MoXCJvdXRsaW5lXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjYXJldFN0eWxlID09IFwidW5kZXJsaW5lXCIpIHtcbiAgICAgICAgJChcIiNwYWNlQ2FyZXRcIikuYWRkQ2xhc3MoXCJ1bmRlcmxpbmVcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNhcmV0U3R5bGUgPT0gXCJjYXJyb3RcIikge1xuICAgICAgICAkKFwiI3BhY2VDYXJldFwiKS5hZGRDbGFzcyhcImNhcnJvdFwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY2FyZXRTdHlsZSA9PSBcImJhbmFuYVwiKSB7XG4gICAgICAgICQoXCIjcGFjZUNhcmV0XCIpLmFkZENsYXNzKFwiYmFuYW5hXCIpO1xuICAgIH1cbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJwYWNlQ2FyZXRTdHlsZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwicGFjZUNhcmV0U3R5bGVcIiwgY29uZmlnLnBhY2VDYXJldFN0eWxlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0UGFjZUNhcmV0U3R5bGUgPSBzZXRQYWNlQ2FyZXRTdHlsZTtcbmZ1bmN0aW9uIHNldFNob3dUaW1lclByb2dyZXNzKHRpbWVyLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJzaG93IHRpbWVyIHByb2dyZXNzXCIsIHRpbWVyLCBbXCJib29sZWFuXCJdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5zaG93VGltZXJQcm9ncmVzcyA9IHRpbWVyO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInNob3dUaW1lclByb2dyZXNzXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzaG93VGltZXJQcm9ncmVzc1wiLCBjb25maWcuc2hvd1RpbWVyUHJvZ3Jlc3MpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRTaG93VGltZXJQcm9ncmVzcyA9IHNldFNob3dUaW1lclByb2dyZXNzO1xuZnVuY3Rpb24gc2V0U2hvd0xpdmVXcG0obGl2ZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwic2hvdyBsaXZlIFdQTVwiLCBsaXZlLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5zaG93TGl2ZVdwbSA9IGxpdmU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwic2hvd0xpdmVXcG1cIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInNob3dMaXZlV3BtXCIsIGNvbmZpZy5zaG93TGl2ZVdwbSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFNob3dMaXZlV3BtID0gc2V0U2hvd0xpdmVXcG07XG5mdW5jdGlvbiBzZXRTaG93TGl2ZUFjYyhsaXZlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJzaG93IGxpdmUgYWNjXCIsIGxpdmUsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLnNob3dMaXZlQWNjID0gbGl2ZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJzaG93TGl2ZUFjY1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic2hvd0xpdmVBY2NcIiwgY29uZmlnLnNob3dMaXZlQWNjKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0U2hvd0xpdmVBY2MgPSBzZXRTaG93TGl2ZUFjYztcbmZ1bmN0aW9uIHNldFNob3dMaXZlQnVyc3QobGl2ZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwic2hvdyBsaXZlIGJ1cnN0XCIsIGxpdmUsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLnNob3dMaXZlQnVyc3QgPSBsaXZlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInNob3dMaXZlQnVyc3RcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInNob3dMaXZlQnVyc3RcIiwgY29uZmlnLnNob3dMaXZlQnVyc3QpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRTaG93TGl2ZUJ1cnN0ID0gc2V0U2hvd0xpdmVCdXJzdDtcbmZ1bmN0aW9uIHNldFNob3dBdmVyYWdlKHZhbHVlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJzaG93IGF2ZXJhZ2VcIiwgdmFsdWUsIFtbXCJvZmZcIiwgXCJ3cG1cIiwgXCJhY2NcIiwgXCJib3RoXCJdXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuc2hvd0F2ZXJhZ2UgPSB2YWx1ZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJzaG93QXZlcmFnZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic2hvd0F2ZXJhZ2VcIiwgY29uZmlnLnNob3dBdmVyYWdlLCBub3NhdmUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRTaG93QXZlcmFnZSA9IHNldFNob3dBdmVyYWdlO1xuZnVuY3Rpb24gc2V0SGlnaGxpZ2h0TW9kZShtb2RlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJoaWdobGlnaHQgbW9kZVwiLCBtb2RlLCBbW1wib2ZmXCIsIFwibGV0dGVyXCIsIFwid29yZFwiXV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKG1vZGUgPT09IFwid29yZFwiICYmXG4gICAgICAgIChjb25maWcuZnVuYm94ID09PSBcIm5vc3BhY2VcIiB8fFxuICAgICAgICAgICAgY29uZmlnLmZ1bmJveCA9PT0gXCJyZWFkX2FoZWFkXCIgfHxcbiAgICAgICAgICAgIGNvbmZpZy5mdW5ib3ggPT09IFwicmVhZF9haGVhZF9lYXN5XCIgfHxcbiAgICAgICAgICAgIGNvbmZpZy5mdW5ib3ggPT09IFwicmVhZF9haGVhZF9oYXJkXCIgfHxcbiAgICAgICAgICAgIGNvbmZpZy5mdW5ib3ggPT09IFwidHRzXCIgfHxcbiAgICAgICAgICAgIGNvbmZpZy5mdW5ib3ggPT09IFwiYXJyb3dzXCIpKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ2FuJ3QgdXNlIHdvcmQgaGlnaGxpZ2h0IHdpdGggdGhpcyBmdW5ib3hcIiwgMCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmhpZ2hsaWdodE1vZGUgPSBtb2RlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImhpZ2hsaWdodE1vZGVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImhpZ2hsaWdodE1vZGVcIiwgY29uZmlnLmhpZ2hsaWdodE1vZGUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRIaWdobGlnaHRNb2RlID0gc2V0SGlnaGxpZ2h0TW9kZTtcbmZ1bmN0aW9uIHNldEhpZGVFeHRyYUxldHRlcnModmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJoaWRlIGV4dHJhIGxldHRlcnNcIiwgdmFsLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5oaWRlRXh0cmFMZXR0ZXJzID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImhpZGVFeHRyYUxldHRlcnNcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImhpZGVFeHRyYUxldHRlcnNcIiwgY29uZmlnLmhpZGVFeHRyYUxldHRlcnMpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRIaWRlRXh0cmFMZXR0ZXJzID0gc2V0SGlkZUV4dHJhTGV0dGVycztcbmZ1bmN0aW9uIHNldFRpbWVyU3R5bGUoc3R5bGUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInRpbWVyIHN0eWxlXCIsIHN0eWxlLCBbW1wiYmFyXCIsIFwidGV4dFwiLCBcIm1pbmlcIl1dKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy50aW1lclN0eWxlID0gc3R5bGU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwidGltZXJTdHlsZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwidGltZXJTdHlsZVwiLCBjb25maWcudGltZXJTdHlsZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFRpbWVyU3R5bGUgPSBzZXRUaW1lclN0eWxlO1xuZnVuY3Rpb24gc2V0VGltZXJDb2xvcihjb2xvciwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwidGltZXIgY29sb3JcIiwgY29sb3IsIFtcbiAgICAgICAgW1wiYmxhY2tcIiwgXCJzdWJcIiwgXCJ0ZXh0XCIsIFwibWFpblwiXSxcbiAgICBdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy50aW1lckNvbG9yID0gY29sb3I7XG4gICAgJChcIiN0aW1lclwiKS5yZW1vdmVDbGFzcyhcInRpbWVyU3ViXCIpO1xuICAgICQoXCIjdGltZXJcIikucmVtb3ZlQ2xhc3MoXCJ0aW1lclRleHRcIik7XG4gICAgJChcIiN0aW1lclwiKS5yZW1vdmVDbGFzcyhcInRpbWVyTWFpblwiKTtcbiAgICAkKFwiI3RpbWVyTnVtYmVyXCIpLnJlbW92ZUNsYXNzKFwidGltZXJTdWJcIik7XG4gICAgJChcIiN0aW1lck51bWJlclwiKS5yZW1vdmVDbGFzcyhcInRpbWVyVGV4dFwiKTtcbiAgICAkKFwiI3RpbWVyTnVtYmVyXCIpLnJlbW92ZUNsYXNzKFwidGltZXJNYWluXCIpO1xuICAgICQoXCIjbGFyZ2VMaXZlV3BtQW5kQWNjXCIpLnJlbW92ZUNsYXNzKFwidGltZXJTdWJcIik7XG4gICAgJChcIiNsYXJnZUxpdmVXcG1BbmRBY2NcIikucmVtb3ZlQ2xhc3MoXCJ0aW1lclRleHRcIik7XG4gICAgJChcIiNsYXJnZUxpdmVXcG1BbmRBY2NcIikucmVtb3ZlQ2xhc3MoXCJ0aW1lck1haW5cIik7XG4gICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtXCIpLnJlbW92ZUNsYXNzKFwidGltZXJTdWJcIik7XG4gICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtXCIpLnJlbW92ZUNsYXNzKFwidGltZXJUZXh0XCIpO1xuICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbVwiKS5yZW1vdmVDbGFzcyhcInRpbWVyTWFpblwiKTtcbiAgICBpZiAoY29sb3IgPT09IFwibWFpblwiKSB7XG4gICAgICAgICQoXCIjdGltZXJcIikuYWRkQ2xhc3MoXCJ0aW1lck1haW5cIik7XG4gICAgICAgICQoXCIjdGltZXJOdW1iZXJcIikuYWRkQ2xhc3MoXCJ0aW1lck1haW5cIik7XG4gICAgICAgICQoXCIjbGFyZ2VMaXZlV3BtQW5kQWNjXCIpLmFkZENsYXNzKFwidGltZXJNYWluXCIpO1xuICAgICAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG1cIikuYWRkQ2xhc3MoXCJ0aW1lck1haW5cIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbG9yID09PSBcInN1YlwiKSB7XG4gICAgICAgICQoXCIjdGltZXJcIikuYWRkQ2xhc3MoXCJ0aW1lclN1YlwiKTtcbiAgICAgICAgJChcIiN0aW1lck51bWJlclwiKS5hZGRDbGFzcyhcInRpbWVyU3ViXCIpO1xuICAgICAgICAkKFwiI2xhcmdlTGl2ZVdwbUFuZEFjY1wiKS5hZGRDbGFzcyhcInRpbWVyU3ViXCIpO1xuICAgICAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG1cIikuYWRkQ2xhc3MoXCJ0aW1lclN1YlwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29sb3IgPT09IFwidGV4dFwiKSB7XG4gICAgICAgICQoXCIjdGltZXJcIikuYWRkQ2xhc3MoXCJ0aW1lclRleHRcIik7XG4gICAgICAgICQoXCIjdGltZXJOdW1iZXJcIikuYWRkQ2xhc3MoXCJ0aW1lclRleHRcIik7XG4gICAgICAgICQoXCIjbGFyZ2VMaXZlV3BtQW5kQWNjXCIpLmFkZENsYXNzKFwidGltZXJUZXh0XCIpO1xuICAgICAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG1cIikuYWRkQ2xhc3MoXCJ0aW1lclRleHRcIik7XG4gICAgfVxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInRpbWVyQ29sb3JcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInRpbWVyQ29sb3JcIiwgY29uZmlnLnRpbWVyQ29sb3IpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRUaW1lckNvbG9yID0gc2V0VGltZXJDb2xvcjtcbmZ1bmN0aW9uIHNldFRpbWVyT3BhY2l0eShvcGFjaXR5LCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJ0aW1lciBvcGFjaXR5XCIsIG9wYWNpdHksIFtcbiAgICAgICAgW1wiMC4yNVwiLCBcIjAuNVwiLCBcIjAuNzVcIiwgXCIxXCJdLFxuICAgIF0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnRpbWVyT3BhY2l0eSA9IG9wYWNpdHk7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwidGltZXJPcGFjaXR5XCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJ0aW1lck9wYWNpdHlcIiwgY29uZmlnLnRpbWVyT3BhY2l0eSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFRpbWVyT3BhY2l0eSA9IHNldFRpbWVyT3BhY2l0eTtcbi8va2V5IHRpcHNcbmZ1bmN0aW9uIHNldEtleVRpcHMoa2V5VGlwcywgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwia2V5IHRpcHNcIiwga2V5VGlwcywgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcuc2hvd0tleVRpcHMgPSBrZXlUaXBzO1xuICAgIGlmIChjb25maWcuc2hvd0tleVRpcHMpIHtcbiAgICAgICAgJChcIiNib3R0b20gLmtleVRpcHNcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiI2JvdHRvbSAua2V5VGlwc1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwic2hvd0tleVRpcHNcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInNob3dLZXlUaXBzXCIsIGNvbmZpZy5zaG93S2V5VGlwcyk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEtleVRpcHMgPSBzZXRLZXlUaXBzO1xuLy9tb2RlXG5mdW5jdGlvbiBzZXRUaW1lQ29uZmlnKHRpbWUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInRpbWVcIiwgdGltZSwgW1wibnVtYmVyXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbnN0IG5ld1RpbWUgPSBpc05hTih0aW1lKSB8fCB0aW1lIDwgMCA/IGRlZmF1bHRfY29uZmlnXzEuZGVmYXVsdC50aW1lIDogdGltZTtcbiAgICAkKFwiI3RvcCAuY29uZmlnIC50aW1lIC50ZXh0LWJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICBjb25zdCB0aW1lQ3VzdG9tID0gIVsxNSwgMzAsIDYwLCAxMjBdLmluY2x1ZGVzKG5ld1RpbWUpID8gXCJjdXN0b21cIiA6IG5ld1RpbWU7XG4gICAgY29uZmlnLnRpbWUgPSBuZXdUaW1lO1xuICAgICQoXCIjdG9wIC5jb25maWcgLnRpbWUgLnRleHQtYnV0dG9uW3RpbWVDb25maWc9J1wiICsgdGltZUN1c3RvbSArIFwiJ11cIikuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwidGltZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwidGltZVwiLCBjb25maWcudGltZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFRpbWVDb25maWcgPSBzZXRUaW1lQ29uZmlnO1xuLy9xdW90ZSBsZW5ndGhcbmZ1bmN0aW9uIHNldFF1b3RlTGVuZ3RoKGxlbiwgbm9zYXZlLCBtdWx0aXBsZU1vZGUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJxdW90ZSBsZW5ndGhcIiwgbGVuLCBbXG4gICAgICAgIFstMiwgLTEsIDAsIDEsIDIsIDNdLFxuICAgICAgICBcIm51bWJlckFycmF5XCIsXG4gICAgXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoQXJyYXkuaXNBcnJheShsZW4pKSB7XG4gICAgICAgIC8vY29uZmlnIGxvYWRcbiAgICAgICAgaWYgKGxlbi5sZW5ndGggPT09IDEgJiYgbGVuWzBdID09PSAtMSlcbiAgICAgICAgICAgIGxlbiA9IFsxXTtcbiAgICAgICAgY29uZmlnLnF1b3RlTGVuZ3RoID0gbGVuO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGNvbmZpZy5xdW90ZUxlbmd0aCkpXG4gICAgICAgICAgICBjb25maWcucXVvdGVMZW5ndGggPSBbXTtcbiAgICAgICAgaWYgKGxlbiA9PT0gbnVsbCB8fCBpc05hTihsZW4pIHx8IGxlbiA8IC0yIHx8IGxlbiA+IDMpIHtcbiAgICAgICAgICAgIGxlbiA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgbGVuID0gcGFyc2VJbnQobGVuLnRvU3RyaW5nKCkpO1xuICAgICAgICBpZiAobXVsdGlwbGVNb2RlKSB7XG4gICAgICAgICAgICBpZiAoIWNvbmZpZy5xdW90ZUxlbmd0aC5pbmNsdWRlcyhsZW4pKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLnF1b3RlTGVuZ3RoLnB1c2gobGVuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChjb25maWcucXVvdGVMZW5ndGgubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICBjb25maWcucXVvdGVMZW5ndGggPSBjb25maWcucXVvdGVMZW5ndGguZmlsdGVyKChxbCkgPT4gcWwgIT09IGxlbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uZmlnLnF1b3RlTGVuZ3RoID0gW2xlbl07XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gaWYgKCFub3NhdmUpIHNldE1vZGUoXCJxdW90ZVwiLCBub3NhdmUpO1xuICAgICQoXCIjdG9wIC5jb25maWcgLnF1b3RlTGVuZ3RoIC50ZXh0LWJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICBjb25maWcucXVvdGVMZW5ndGguZm9yRWFjaCgocWwpID0+IHtcbiAgICAgICAgJChcIiN0b3AgLmNvbmZpZyAucXVvdGVMZW5ndGggLnRleHQtYnV0dG9uW3F1b3RlTGVuZ3RoPSdcIiArIHFsICsgXCInXVwiKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICB9KTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJxdW90ZUxlbmd0aFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwicXVvdGVMZW5ndGhcIiwgY29uZmlnLnF1b3RlTGVuZ3RoKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0UXVvdGVMZW5ndGggPSBzZXRRdW90ZUxlbmd0aDtcbmZ1bmN0aW9uIHNldFdvcmRDb3VudCh3b3JkQ291bnQsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcIndvcmRzXCIsIHdvcmRDb3VudCwgW1wibnVtYmVyXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbnN0IG5ld1dvcmRDb3VudCA9IHdvcmRDb3VudCA8IDAgfHwgd29yZENvdW50ID4gMTAwMDAwID8gZGVmYXVsdF9jb25maWdfMS5kZWZhdWx0LndvcmRzIDogd29yZENvdW50O1xuICAgICQoXCIjdG9wIC5jb25maWcgLndvcmRDb3VudCAudGV4dC1idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgY29uc3Qgd29yZEN1c3RvbSA9ICFbMTAsIDI1LCA1MCwgMTAwLCAyMDBdLmluY2x1ZGVzKG5ld1dvcmRDb3VudClcbiAgICAgICAgPyBcImN1c3RvbVwiXG4gICAgICAgIDogbmV3V29yZENvdW50O1xuICAgIGNvbmZpZy53b3JkcyA9IG5ld1dvcmRDb3VudDtcbiAgICAkKFwiI3RvcCAuY29uZmlnIC53b3JkQ291bnQgLnRleHQtYnV0dG9uW3dvcmRDb3VudD0nXCIgKyB3b3JkQ3VzdG9tICsgXCInXVwiKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJ3b3Jkc1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwid29yZHNcIiwgY29uZmlnLndvcmRzKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0V29yZENvdW50ID0gc2V0V29yZENvdW50O1xuLy9jYXJldFxuZnVuY3Rpb24gc2V0U21vb3RoQ2FyZXQobW9kZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwic21vb3RoIGNhcmV0XCIsIG1vZGUsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLnNtb290aENhcmV0ID0gbW9kZTtcbiAgICBpZiAobW9kZSkge1xuICAgICAgICAkKFwiI2NhcmV0XCIpLmNzcyhcImFuaW1hdGlvbi1uYW1lXCIsIFwiY2FyZXRGbGFzaFNtb290aFwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIjY2FyZXRcIikuY3NzKFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJjYXJldEZsYXNoSGFyZFwiKTtcbiAgICB9XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwic21vb3RoQ2FyZXRcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInNtb290aENhcmV0XCIsIGNvbmZpZy5zbW9vdGhDYXJldCk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFNtb290aENhcmV0ID0gc2V0U21vb3RoQ2FyZXQ7XG5mdW5jdGlvbiBzZXRTdGFydEdyYXBoc0F0WmVybyhtb2RlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJzdGFydCBncmFwaHMgYXQgemVyb1wiLCBtb2RlLCBbXCJib29sZWFuXCJdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5zdGFydEdyYXBoc0F0WmVybyA9IG1vZGU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwic3RhcnRHcmFwaHNBdFplcm9cIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInN0YXJ0R3JhcGhzQXRaZXJvXCIsIGNvbmZpZy5zdGFydEdyYXBoc0F0WmVybyk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFN0YXJ0R3JhcGhzQXRaZXJvID0gc2V0U3RhcnRHcmFwaHNBdFplcm87XG4vL2xpbmVzY3JvbGxcbmZ1bmN0aW9uIHNldFNtb290aExpbmVTY3JvbGwobW9kZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwic21vb3RoIGxpbmUgc2Nyb2xsXCIsIG1vZGUsIFtcImJvb2xlYW5cIl0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnNtb290aExpbmVTY3JvbGwgPSBtb2RlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInNtb290aExpbmVTY3JvbGxcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInNtb290aExpbmVTY3JvbGxcIiwgY29uZmlnLnNtb290aExpbmVTY3JvbGwpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRTbW9vdGhMaW5lU2Nyb2xsID0gc2V0U21vb3RoTGluZVNjcm9sbDtcbi8vcXVpY2sgdGFiXG5mdW5jdGlvbiBzZXRRdWlja1RhYk1vZGUobW9kZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwicXVpY2sgdGFiIG1vZGVcIiwgbW9kZSwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcucXVpY2tUYWIgPSBtb2RlO1xuICAgIGlmICghY29uZmlnLnF1aWNrVGFiKSB7XG4gICAgICAgICQoXCIjcmVzdGFydFRlc3RCdXR0b25cIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjcmVzdGFydFRlc3RCdXR0b25cIikuY3NzKFwib3BhY2l0eVwiLCAxKTtcbiAgICAgICAgJChcIiNib3R0b20gLmtleVRpcHNcIilcbiAgICAgICAgICAgIC5odG1sKGA8a2V5PnRhYjwva2V5PiBhbmQgPGtleT5lbnRlcjwva2V5PiAvIDxrZXk+c3BhY2U8L2tleT4gLSByZXN0YXJ0IHRlc3Q8YnI+XG4gICAgICA8a2V5PmN0cmwvY21kPC9rZXk+KzxrZXk+c2hpZnQ8L2tleT4rPGtleT5wPC9rZXk+IG9yIDxrZXk+ZXNjPC9rZXk+IC0gY29tbWFuZCBsaW5lYCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiI3Jlc3RhcnRUZXN0QnV0dG9uXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI2JvdHRvbSAua2V5VGlwc1wiKS5odG1sKGA8a2V5PnRhYjwva2V5PiAtIHJlc3RhcnQgdGVzdDxicj5cbiAgICA8a2V5PmN0cmwvY21kPC9rZXk+KzxrZXk+c2hpZnQ8L2tleT4rPGtleT5wPC9rZXk+IG9yIDxrZXk+ZXNjPC9rZXk+IC0gY29tbWFuZCBsaW5lYCk7XG4gICAgfVxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInF1aWNrVGFiXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJxdWlja1RhYlwiLCBjb25maWcucXVpY2tUYWIpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRRdWlja1RhYk1vZGUgPSBzZXRRdWlja1RhYk1vZGU7XG5mdW5jdGlvbiBwcmV2aWV3Rm9udEZhbWlseShmb250KSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwicHJldmlldyBmb250IGZhbWlseVwiLCBmb250LCBbXCJzdHJpbmdcIl0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KFwiLS1mb250XCIsICdcIicgKyBmb250LnJlcGxhY2UoL18vZywgXCIgXCIpICsgJ1wiLCBcIlJvYm90byBNb25vXCInKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMucHJldmlld0ZvbnRGYW1pbHkgPSBwcmV2aWV3Rm9udEZhbWlseTtcbi8vZm9udCBmYW1pbHlcbmZ1bmN0aW9uIHNldEZvbnRGYW1pbHkoZm9udCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiZm9udCBmYW1pbHlcIiwgZm9udCwgW1wic3RyaW5nXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChmb250ID09PSBcIlwiKSB7XG4gICAgICAgIGZvbnQgPSBcInJvYm90b19tb25vXCI7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRW1wdHkgaW5wdXQgcmVjZWl2ZWQsIHJldmVydGVkIHRvIHRoZSBkZWZhdWx0IGZvbnQuXCIsIDAsIDMsIFwiQ3VzdG9tIGZvbnRcIik7XG4gICAgfVxuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdLZXlWYWxpZCkoZm9udCkpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoYEludmFsaWQgZm9udCBuYW1lIHZhbHVlOiBcIiR7Zm9udH1cIi5gLCAtMSwgMywgXCJDdXN0b20gZm9udFwiKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuZm9udEZhbWlseSA9IGZvbnQ7XG4gICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KFwiLS1mb250XCIsIGBcIiR7Zm9udC5yZXBsYWNlKC9fL2csIFwiIFwiKX1cIiwgXCJSb2JvdG8gTW9ub1wiYCk7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiZm9udEZhbWlseVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiZm9udEZhbWlseVwiLCBjb25maWcuZm9udEZhbWlseSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEZvbnRGYW1pbHkgPSBzZXRGb250RmFtaWx5O1xuLy9mcmVlZG9tXG5mdW5jdGlvbiBzZXRGcmVlZG9tTW9kZShmcmVlZG9tLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJmcmVlZG9tIG1vZGVcIiwgZnJlZWRvbSwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAoZnJlZWRvbSA9PSBudWxsKSB7XG4gICAgICAgIGZyZWVkb20gPSBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmZyZWVkb21Nb2RlID0gZnJlZWRvbTtcbiAgICBpZiAoY29uZmlnLmZyZWVkb21Nb2RlICYmIGNvbmZpZy5jb25maWRlbmNlTW9kZSAhPT0gXCJvZmZcIikge1xuICAgICAgICBjb25maWcuY29uZmlkZW5jZU1vZGUgPSBcIm9mZlwiO1xuICAgIH1cbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJmcmVlZG9tTW9kZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiZnJlZWRvbU1vZGVcIiwgY29uZmlnLmZyZWVkb21Nb2RlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0RnJlZWRvbU1vZGUgPSBzZXRGcmVlZG9tTW9kZTtcbmZ1bmN0aW9uIHNldENvbmZpZGVuY2VNb2RlKGNtLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJjb25maWRlbmNlIG1vZGVcIiwgY20sIFtbXCJvZmZcIiwgXCJvblwiLCBcIm1heFwiXV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmNvbmZpZGVuY2VNb2RlID0gY207XG4gICAgaWYgKGNvbmZpZy5jb25maWRlbmNlTW9kZSAhPT0gXCJvZmZcIikge1xuICAgICAgICBjb25maWcuZnJlZWRvbU1vZGUgPSBmYWxzZTtcbiAgICAgICAgY29uZmlnLnN0b3BPbkVycm9yID0gXCJvZmZcIjtcbiAgICB9XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiY29uZmlkZW5jZU1vZGVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImNvbmZpZGVuY2VNb2RlXCIsIGNvbmZpZy5jb25maWRlbmNlTW9kZSwgbm9zYXZlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0Q29uZmlkZW5jZU1vZGUgPSBzZXRDb25maWRlbmNlTW9kZTtcbmZ1bmN0aW9uIHNldEluZGljYXRlVHlwb3ModmFsdWUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImluZGljYXRlIHR5cG9zXCIsIHZhbHVlLCBbW1wib2ZmXCIsIFwiYmVsb3dcIiwgXCJyZXBsYWNlXCJdXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuaW5kaWNhdGVUeXBvcyA9IHZhbHVlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImluZGljYXRlVHlwb3NcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImluZGljYXRlVHlwb3NcIiwgY29uZmlnLmluZGljYXRlVHlwb3MpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRJbmRpY2F0ZVR5cG9zID0gc2V0SW5kaWNhdGVUeXBvcztcbmZ1bmN0aW9uIHNldEF1dG9Td2l0Y2hUaGVtZShib29sZWFuLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJhdXRvIHN3aXRjaCB0aGVtZVwiLCBib29sZWFuLCBbXCJib29sZWFuXCJdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGJvb2xlYW4gPSBib29sZWFuICE9PSBudWxsICYmIGJvb2xlYW4gIT09IHZvaWQgMCA/IGJvb2xlYW4gOiBkZWZhdWx0X2NvbmZpZ18xLmRlZmF1bHQuYXV0b1N3aXRjaFRoZW1lO1xuICAgIGNvbmZpZy5hdXRvU3dpdGNoVGhlbWUgPSBib29sZWFuO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImF1dG9Td2l0Y2hUaGVtZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiYXV0b1N3aXRjaFRoZW1lXCIsIGNvbmZpZy5hdXRvU3dpdGNoVGhlbWUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRBdXRvU3dpdGNoVGhlbWUgPSBzZXRBdXRvU3dpdGNoVGhlbWU7XG5mdW5jdGlvbiBzZXRDdXN0b21UaGVtZShib29sZWFuLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJjdXN0b20gdGhlbWVcIiwgYm9vbGVhbiwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcuY3VzdG9tVGhlbWUgPSBib29sZWFuO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImN1c3RvbVRoZW1lXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJjdXN0b21UaGVtZVwiLCBjb25maWcuY3VzdG9tVGhlbWUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRDdXN0b21UaGVtZSA9IHNldEN1c3RvbVRoZW1lO1xuZnVuY3Rpb24gc2V0VGhlbWUobmFtZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwidGhlbWVcIiwgbmFtZSwgW1wic3RyaW5nXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy50aGVtZSA9IG5hbWU7XG4gICAgc2V0Q3VzdG9tVGhlbWUoZmFsc2UpO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInRoZW1lXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJ0aGVtZVwiLCBjb25maWcudGhlbWUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRUaGVtZSA9IHNldFRoZW1lO1xuZnVuY3Rpb24gc2V0VGhlbWVMaWdodChuYW1lLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJ0aGVtZSBsaWdodFwiLCBuYW1lLCBbXCJzdHJpbmdcIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLnRoZW1lTGlnaHQgPSBuYW1lO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInRoZW1lTGlnaHRcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInRoZW1lTGlnaHRcIiwgY29uZmlnLnRoZW1lTGlnaHQsIG5vc2F2ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFRoZW1lTGlnaHQgPSBzZXRUaGVtZUxpZ2h0O1xuZnVuY3Rpb24gc2V0VGhlbWVEYXJrKG5hbWUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInRoZW1lIGRhcmtcIiwgbmFtZSwgW1wic3RyaW5nXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy50aGVtZURhcmsgPSBuYW1lO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInRoZW1lRGFya1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwidGhlbWVEYXJrXCIsIGNvbmZpZy50aGVtZURhcmssIG5vc2F2ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFRoZW1lRGFyayA9IHNldFRoZW1lRGFyaztcbmZ1bmN0aW9uIHNldFRoZW1lcyh0aGVtZSwgY3VzdG9tU3RhdGUsIGN1c3RvbVRoZW1lQ29sb3JzLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJ0aGVtZXNcIiwgdGhlbWUsIFtcInN0cmluZ1wiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcuY3VzdG9tVGhlbWVDb2xvcnMgPSBjdXN0b21UaGVtZUNvbG9ycztcbiAgICBjb25maWcudGhlbWUgPSB0aGVtZTtcbiAgICBjb25maWcuY3VzdG9tVGhlbWUgPSBjdXN0b21TdGF0ZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJ0aGVtZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic2V0VGhlbWVzXCIsIGN1c3RvbVN0YXRlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmZ1bmN0aW9uIHNldFJhbmRvbVRoZW1lKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwicmFuZG9tIHRoZW1lXCIsIHZhbCwgW1xuICAgICAgICBbXCJvZmZcIiwgXCJvblwiLCBcImZhdlwiLCBcImxpZ2h0XCIsIFwiZGFya1wiLCBcImN1c3RvbVwiXSxcbiAgICBdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmICh2YWwgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciA9PT0gbnVsbCkge1xuICAgICAgICAgICAgY29uZmlnLnJhbmRvbVRoZW1lID0gdmFsO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghREIuZ2V0U25hcHNob3QoKSlcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICBpZiAoREIuZ2V0U25hcHNob3QoKS5jdXN0b21UaGVtZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIllvdSBuZWVkIHRvIGNyZWF0ZSBhIGN1c3RvbSB0aGVtZSBmaXJzdFwiLCAwKTtcbiAgICAgICAgICAgIGNvbmZpZy5yYW5kb21UaGVtZSA9IFwib2ZmXCI7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uZmlnLnJhbmRvbVRoZW1lID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInJhbmRvbVRoZW1lXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJyYW5kb21UaGVtZVwiLCBjb25maWcucmFuZG9tVGhlbWUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRSYW5kb21UaGVtZSA9IHNldFJhbmRvbVRoZW1lO1xuZnVuY3Rpb24gc2V0QnJpdGlzaEVuZ2xpc2godmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJicml0aXNoIGVuZ2xpc2hcIiwgdmFsLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmICghdmFsKSB7XG4gICAgICAgIHZhbCA9IGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuYnJpdGlzaEVuZ2xpc2ggPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiYnJpdGlzaEVuZ2xpc2hcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImJyaXRpc2hFbmdsaXNoXCIsIGNvbmZpZy5icml0aXNoRW5nbGlzaCk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEJyaXRpc2hFbmdsaXNoID0gc2V0QnJpdGlzaEVuZ2xpc2g7XG5mdW5jdGlvbiBzZXRMYXp5TW9kZSh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImxhenkgbW9kZVwiLCB2YWwsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgaWYgKCF2YWwpIHtcbiAgICAgICAgdmFsID0gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5sYXp5TW9kZSA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJsYXp5TW9kZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwibGF6eU1vZGVcIiwgY29uZmlnLmxhenlNb2RlLCBub3NhdmUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRMYXp5TW9kZSA9IHNldExhenlNb2RlO1xuZnVuY3Rpb24gc2V0Q3VzdG9tVGhlbWVDb2xvcnMoY29sb3JzLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJjdXN0b20gdGhlbWUgY29sb3JzXCIsIGNvbG9ycywgW1wic3RyaW5nQXJyYXlcIl0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKGNvbG9ycyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbmZpZy5jdXN0b21UaGVtZUNvbG9ycyA9IGNvbG9ycztcbiAgICAgICAgLy8gVGhlbWVDb250cm9sbGVyLnNldChcImN1c3RvbVwiKTtcbiAgICAgICAgLy8gYXBwbHlDdXN0b21UaGVtZUNvbG9ycygpO1xuICAgIH1cbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJjdXN0b21UaGVtZUNvbG9yc1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiY3VzdG9tVGhlbWVDb2xvcnNcIiwgY29uZmlnLmN1c3RvbVRoZW1lQ29sb3JzLCBub3NhdmUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRDdXN0b21UaGVtZUNvbG9ycyA9IHNldEN1c3RvbVRoZW1lQ29sb3JzO1xuZnVuY3Rpb24gc2V0TGFuZ3VhZ2UobGFuZ3VhZ2UsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImxhbmd1YWdlXCIsIGxhbmd1YWdlLCBbXCJzdHJpbmdcIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLmxhbmd1YWdlID0gbGFuZ3VhZ2U7XG4gICAgQW5hbHl0aWNzQ29udHJvbGxlci5sb2coXCJjaGFuZ2VkTGFuZ3VhZ2VcIiwgeyBsYW5ndWFnZSB9KTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJsYW5ndWFnZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwibGFuZ3VhZ2VcIiwgY29uZmlnLmxhbmd1YWdlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0TGFuZ3VhZ2UgPSBzZXRMYW5ndWFnZTtcbmZ1bmN0aW9uIHNldE1vbmtleShtb25rZXksIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcIm1vbmtleVwiLCBtb25rZXksIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLm1vbmtleSA9IG1vbmtleTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJtb25rZXlcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcIm1vbmtleVwiLCBjb25maWcubW9ua2V5KTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0TW9ua2V5ID0gc2V0TW9ua2V5O1xuZnVuY3Rpb24gc2V0S2V5bWFwTW9kZShtb2RlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJrZXltYXAgbW9kZVwiLCBtb2RlLCBbXG4gICAgICAgIFtcIm9mZlwiLCBcInN0YXRpY1wiLCBcInJlYWN0XCIsIFwibmV4dFwiXSxcbiAgICBdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgICQoXCIuYWN0aXZlLWtleVwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZS1rZXlcIik7XG4gICAgJChcIi5rZXltYXAta2V5XCIpLmF0dHIoXCJzdHlsZVwiLCBcIlwiKTtcbiAgICBjb25maWcua2V5bWFwTW9kZSA9IG1vZGU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwia2V5bWFwTW9kZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwia2V5bWFwTW9kZVwiLCBjb25maWcua2V5bWFwTW9kZSwgbm9zYXZlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0S2V5bWFwTW9kZSA9IHNldEtleW1hcE1vZGU7XG5mdW5jdGlvbiBzZXRLZXltYXBMZWdlbmRTdHlsZShzdHlsZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwia2V5bWFwIGxlZ2VuZCBzdHlsZVwiLCBzdHlsZSwgW1xuICAgICAgICBbXCJsb3dlcmNhc2VcIiwgXCJ1cHBlcmNhc2VcIiwgXCJibGFua1wiLCBcImR5bmFtaWNcIl0sXG4gICAgXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvLyBSZW1vdmUgZXhpc3Rpbmcgc3R5bGVzXG4gICAgY29uc3Qga2V5bWFwTGVnZW5kU3R5bGVzID0gW1wibG93ZXJjYXNlXCIsIFwidXBwZXJjYXNlXCIsIFwiYmxhbmtcIiwgXCJkeW5hbWljXCJdO1xuICAgIGtleW1hcExlZ2VuZFN0eWxlcy5mb3JFYWNoKChuYW1lKSA9PiB7XG4gICAgICAgICQoXCIua2V5bWFwTGVnZW5kU3R5bGVcIikucmVtb3ZlQ2xhc3MobmFtZSk7XG4gICAgfSk7XG4gICAgc3R5bGUgPSBzdHlsZSB8fCBcImxvd2VyY2FzZVwiO1xuICAgIC8vIE11dGF0ZSB0aGUga2V5bWFwIGluIHRoZSBET00sIGlmIGl0IGV4aXN0cy5cbiAgICAvLyAxLiBSZW1vdmUgZXZlcnl0aGluZ1xuICAgICQoXCIua2V5bWFwLWtleSA+IC5sZXR0ZXJcIikuY3NzKFwiZGlzcGxheVwiLCBcIlwiKTtcbiAgICAkKFwiLmtleW1hcC1rZXkgPiAubGV0dGVyXCIpLmNzcyhcInRleHQtdHJhbnNmb3JtXCIsIFwiXCIpO1xuICAgIC8vIDIuIEFwcGVuZCBzcGVjaWFsIHN0eWxlcyBvbnRvIHRoZSBET00gZWxlbWVudHNcbiAgICBpZiAoc3R5bGUgPT09IFwidXBwZXJjYXNlXCIpIHtcbiAgICAgICAgJChcIi5rZXltYXAta2V5ID4gLmxldHRlclwiKS5jc3MoXCJ0ZXh0LXRyYW5zZm9ybVwiLCBcImNhcGl0YWxpemVcIik7XG4gICAgfVxuICAgIGlmIChzdHlsZSA9PT0gXCJibGFua1wiKSB7XG4gICAgICAgICQoXCIua2V5bWFwLWtleSA+IC5sZXR0ZXJcIikuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XG4gICAgfVxuICAgIC8vIFVwZGF0ZSBhbmQgc2F2ZSB0byBjb29raWUgZm9yIHBlcnNpc3RlbmNlXG4gICAgJChcIi5rZXltYXBMZWdlbmRTdHlsZVwiKS5hZGRDbGFzcyhzdHlsZSk7XG4gICAgY29uZmlnLmtleW1hcExlZ2VuZFN0eWxlID0gc3R5bGU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwia2V5bWFwTGVnZW5kU3R5bGVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImtleW1hcExlZ2VuZFN0eWxlXCIsIGNvbmZpZy5rZXltYXBMZWdlbmRTdHlsZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEtleW1hcExlZ2VuZFN0eWxlID0gc2V0S2V5bWFwTGVnZW5kU3R5bGU7XG5mdW5jdGlvbiBzZXRLZXltYXBTdHlsZShzdHlsZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwia2V5bWFwIHN0eWxlXCIsIHN0eWxlLCBbXG4gICAgICAgIFtcInN0YWdnZXJlZFwiLCBcImFsaWNlXCIsIFwibWF0cml4XCIsIFwic3BsaXRcIiwgXCJzcGxpdF9tYXRyaXhcIl0sXG4gICAgXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBzdHlsZSA9IHN0eWxlIHx8IFwic3RhZ2dlcmVkXCI7XG4gICAgY29uZmlnLmtleW1hcFN0eWxlID0gc3R5bGU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwia2V5bWFwU3R5bGVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImtleW1hcFN0eWxlXCIsIGNvbmZpZy5rZXltYXBTdHlsZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEtleW1hcFN0eWxlID0gc2V0S2V5bWFwU3R5bGU7XG5mdW5jdGlvbiBzZXRLZXltYXBMYXlvdXQobGF5b3V0LCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJrZXltYXAgbGF5b3V0XCIsIGxheW91dCwgW1wic3RyaW5nXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5rZXltYXBMYXlvdXQgPSBsYXlvdXQ7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwia2V5bWFwTGF5b3V0XCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJrZXltYXBMYXlvdXRcIiwgY29uZmlnLmtleW1hcExheW91dCk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEtleW1hcExheW91dCA9IHNldEtleW1hcExheW91dDtcbmZ1bmN0aW9uIHNldExheW91dChsYXlvdXQsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImxheW91dFwiLCBsYXlvdXQsIFtcInN0cmluZ1wiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcubGF5b3V0ID0gbGF5b3V0O1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImxheW91dFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwibGF5b3V0XCIsIGNvbmZpZy5sYXlvdXQsIG5vc2F2ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldExheW91dCA9IHNldExheW91dDtcbi8vIGV4cG9ydCBmdW5jdGlvbiBzZXRTYXZlZExheW91dChsYXlvdXQ6IHN0cmluZywgbm9zYXZlPzogYm9vbGVhbik6IGJvb2xlYW4ge1xuLy8gICBpZiAobGF5b3V0ID09IG51bGwgfHwgbGF5b3V0ID09IHVuZGVmaW5lZCkge1xuLy8gICAgIGxheW91dCA9IFwicXdlcnR5XCI7XG4vLyAgIH1cbi8vICAgY29uZmlnLnNhdmVkTGF5b3V0ID0gbGF5b3V0O1xuLy8gICBzZXRMYXlvdXQobGF5b3V0LCBub3NhdmUpO1xuLy8gICByZXR1cm4gdHJ1ZTtcbi8vIH1cbmZ1bmN0aW9uIHNldEZvbnRTaXplKGZvbnRTaXplLCBub3NhdmUpIHtcbiAgICBmb250U2l6ZSA9IGZvbnRTaXplLnRvU3RyaW5nKCk7IC8vdG9kbyByZW1vdmUgYWZ0ZXIgYXJvdW5kIGEgd2Vla1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImZvbnQgc2l6ZVwiLCBmb250U2l6ZSwgW1xuICAgICAgICBbXCIxXCIsIFwiMTI1XCIsIFwiMTVcIiwgXCIyXCIsIFwiM1wiLCBcIjRcIl0sXG4gICAgXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuZm9udFNpemUgPSBmb250U2l6ZTtcbiAgICAkKFwiI3dvcmRzXCIpLnJlbW92ZUNsYXNzKFwic2l6ZTEyNVwiKTtcbiAgICAkKFwiI2NhcmV0LCAjcGFjZUNhcmV0XCIpLnJlbW92ZUNsYXNzKFwic2l6ZTEyNVwiKTtcbiAgICAkKFwiI3dvcmRzXCIpLnJlbW92ZUNsYXNzKFwic2l6ZTE1XCIpO1xuICAgICQoXCIjY2FyZXQsICNwYWNlQ2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJzaXplMTVcIik7XG4gICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcInNpemUyXCIpO1xuICAgICQoXCIjY2FyZXQsICNwYWNlQ2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJzaXplMlwiKTtcbiAgICAkKFwiI3dvcmRzXCIpLnJlbW92ZUNsYXNzKFwic2l6ZTNcIik7XG4gICAgJChcIiNjYXJldCwgI3BhY2VDYXJldFwiKS5yZW1vdmVDbGFzcyhcInNpemUzXCIpO1xuICAgICQoXCIjd29yZHNcIikucmVtb3ZlQ2xhc3MoXCJzaXplMzVcIik7XG4gICAgJChcIiNjYXJldCwgI3BhY2VDYXJldFwiKS5yZW1vdmVDbGFzcyhcInNpemUzNVwiKTtcbiAgICAkKFwiI3dvcmRzXCIpLnJlbW92ZUNsYXNzKFwic2l6ZTRcIik7XG4gICAgJChcIiNjYXJldCwgI3BhY2VDYXJldFwiKS5yZW1vdmVDbGFzcyhcInNpemU0XCIpO1xuICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbVwiKS5yZW1vdmVDbGFzcyhcInNpemUxMjVcIik7XG4gICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtXCIpLnJlbW92ZUNsYXNzKFwic2l6ZTE1XCIpO1xuICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbVwiKS5yZW1vdmVDbGFzcyhcInNpemUyXCIpO1xuICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbVwiKS5yZW1vdmVDbGFzcyhcInNpemUzXCIpO1xuICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbVwiKS5yZW1vdmVDbGFzcyhcInNpemUzNVwiKTtcbiAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG1cIikucmVtb3ZlQ2xhc3MoXCJzaXplNFwiKTtcbiAgICBpZiAoZm9udFNpemUgPT0gXCIxMjVcIikge1xuICAgICAgICAkKFwiI3dvcmRzXCIpLmFkZENsYXNzKFwic2l6ZTEyNVwiKTtcbiAgICAgICAgJChcIiNjYXJldCwgI3BhY2VDYXJldFwiKS5hZGRDbGFzcyhcInNpemUxMjVcIik7XG4gICAgICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbVwiKS5hZGRDbGFzcyhcInNpemUxMjVcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGZvbnRTaXplID09IFwiMTVcIikge1xuICAgICAgICAkKFwiI3dvcmRzXCIpLmFkZENsYXNzKFwic2l6ZTE1XCIpO1xuICAgICAgICAkKFwiI2NhcmV0LCAjcGFjZUNhcmV0XCIpLmFkZENsYXNzKFwic2l6ZTE1XCIpO1xuICAgICAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG1cIikuYWRkQ2xhc3MoXCJzaXplMTVcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGZvbnRTaXplID09IFwiMlwiKSB7XG4gICAgICAgICQoXCIjd29yZHNcIikuYWRkQ2xhc3MoXCJzaXplMlwiKTtcbiAgICAgICAgJChcIiNjYXJldCwgI3BhY2VDYXJldFwiKS5hZGRDbGFzcyhcInNpemUyXCIpO1xuICAgICAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG1cIikuYWRkQ2xhc3MoXCJzaXplMlwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZm9udFNpemUgPT0gXCIzXCIpIHtcbiAgICAgICAgJChcIiN3b3Jkc1wiKS5hZGRDbGFzcyhcInNpemUzXCIpO1xuICAgICAgICAkKFwiI2NhcmV0LCAjcGFjZUNhcmV0XCIpLmFkZENsYXNzKFwic2l6ZTNcIik7XG4gICAgICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbVwiKS5hZGRDbGFzcyhcInNpemUzXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChmb250U2l6ZSA9PSBcIjRcIikge1xuICAgICAgICAkKFwiI3dvcmRzXCIpLmFkZENsYXNzKFwic2l6ZTRcIik7XG4gICAgICAgICQoXCIjY2FyZXQsICNwYWNlQ2FyZXRcIikuYWRkQ2xhc3MoXCJzaXplNFwiKTtcbiAgICAgICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtXCIpLmFkZENsYXNzKFwic2l6ZTRcIik7XG4gICAgfVxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImZvbnRTaXplXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJmb250U2l6ZVwiLCBjb25maWcuZm9udFNpemUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRGb250U2l6ZSA9IHNldEZvbnRTaXplO1xuZnVuY3Rpb24gc2V0Q3VzdG9tQmFja2dyb3VuZCh2YWx1ZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiY3VzdG9tIGJhY2tncm91bmRcIiwgdmFsdWUsIFtcInN0cmluZ1wiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB2YWx1ZSA9IHZhbHVlLnRyaW0oKTtcbiAgICBpZiAoKC8oaHR0cHN8aHR0cCk6XFwvXFwvKHd3d1xcLnwpLitcXC4uK1xcLy4rKFxcLnBuZ3xcXC5naWZ8XFwuanBlZ3xcXC5qcGcpL2dpLnRlc3QodmFsdWUpICYmXG4gICAgICAgICEvWzw+XS8udGVzdCh2YWx1ZSkpIHx8XG4gICAgICAgIHZhbHVlID09IFwiXCIpIHtcbiAgICAgICAgY29uZmlnLmN1c3RvbUJhY2tncm91bmQgPSB2YWx1ZTtcbiAgICAgICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiY3VzdG9tQmFja2dyb3VuZFwiLCBub3NhdmUpO1xuICAgICAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImN1c3RvbUJhY2tncm91bmRcIiwgY29uZmlnLmN1c3RvbUJhY2tncm91bmQpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJJbnZhbGlkIGN1c3RvbSBiYWNrZ3JvdW5kIFVSTFwiLCAwKTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEN1c3RvbUJhY2tncm91bmQgPSBzZXRDdXN0b21CYWNrZ3JvdW5kO1xuZnVuY3Rpb24gc2V0Q3VzdG9tTGF5b3V0Zmx1aWQodmFsdWUsIG5vc2F2ZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IHRyaW1tZWQgPSB2YWx1ZS50cmltKCk7XG4gICAgICAgIGlmICghKHlpZWxkICgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZEFzeW5jKShcImxheW91dGZsdWlkXCIsIHRyaW1tZWQsIFtcImxheW91dGZsdWlkXCJdKSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjdXN0b21MYXlvdXRmbHVpZCA9IHRyaW1tZWQucmVwbGFjZSgvIC9nLCBcIiNcIik7XG4gICAgICAgIGNvbmZpZy5jdXN0b21MYXlvdXRmbHVpZCA9IGN1c3RvbUxheW91dGZsdWlkO1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5jdXN0b21MYXlvdXRmbHVpZCBpbnB1dFwiKS52YWwoY3VzdG9tTGF5b3V0Zmx1aWQucmVwbGFjZSgvIy9nLCBcIiBcIikpO1xuICAgICAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJjdXN0b21MYXlvdXRmbHVpZFwiLCBub3NhdmUpO1xuICAgICAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImN1c3RvbUxheW91dEZsdWlkXCIsIGNvbmZpZy5jdXN0b21MYXlvdXRmbHVpZCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xufVxuZXhwb3J0cy5zZXRDdXN0b21MYXlvdXRmbHVpZCA9IHNldEN1c3RvbUxheW91dGZsdWlkO1xuZnVuY3Rpb24gc2V0Q3VzdG9tQmFja2dyb3VuZFNpemUodmFsdWUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImN1c3RvbSBiYWNrZ3JvdW5kIHNpemVcIiwgdmFsdWUsIFtcbiAgICAgICAgW1wibWF4XCIsIFwiY292ZXJcIiwgXCJjb250YWluXCJdLFxuICAgIF0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHZhbHVlICE9IFwiY292ZXJcIiAmJiB2YWx1ZSAhPSBcImNvbnRhaW5cIiAmJiB2YWx1ZSAhPSBcIm1heFwiKSB7XG4gICAgICAgIHZhbHVlID0gXCJjb3ZlclwiO1xuICAgIH1cbiAgICBjb25maWcuY3VzdG9tQmFja2dyb3VuZFNpemUgPSB2YWx1ZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJjdXN0b21CYWNrZ3JvdW5kU2l6ZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiY3VzdG9tQmFja2dyb3VuZFNpemVcIiwgY29uZmlnLmN1c3RvbUJhY2tncm91bmRTaXplKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0Q3VzdG9tQmFja2dyb3VuZFNpemUgPSBzZXRDdXN0b21CYWNrZ3JvdW5kU2l6ZTtcbmZ1bmN0aW9uIHNldEN1c3RvbUJhY2tncm91bmRGaWx0ZXIoYXJyYXksIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImN1c3RvbSBiYWNrZ3JvdW5kIGZpbHRlclwiLCBhcnJheSwgW1wibnVtYmVyQXJyYXlcIl0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgPSBhcnJheTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJjdXN0b21CYWNrZ3JvdW5kRmlsdGVyXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJjdXN0b21CYWNrZ3JvdW5kRmlsdGVyXCIsIGNvbmZpZy5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0Q3VzdG9tQmFja2dyb3VuZEZpbHRlciA9IHNldEN1c3RvbUJhY2tncm91bmRGaWx0ZXI7XG5mdW5jdGlvbiBzZXRNb25rZXlQb3dlckxldmVsKGxldmVsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJtb25rZXkgcG93ZXIgbGV2ZWxcIiwgbGV2ZWwsIFtcbiAgICAgICAgW1wib2ZmXCIsIFwiMVwiLCBcIjJcIiwgXCIzXCIsIFwiNFwiXSxcbiAgICBdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmICghW1wib2ZmXCIsIFwiMVwiLCBcIjJcIiwgXCIzXCIsIFwiNFwiXS5pbmNsdWRlcyhsZXZlbCkpXG4gICAgICAgIGxldmVsID0gXCJvZmZcIjtcbiAgICBjb25maWcubW9ua2V5UG93ZXJMZXZlbCA9IGxldmVsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcIm1vbmtleVBvd2VyTGV2ZWxcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcIm1vbmtleVBvd2VyTGV2ZWxcIiwgY29uZmlnLm1vbmtleVBvd2VyTGV2ZWwpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRNb25rZXlQb3dlckxldmVsID0gc2V0TW9ua2V5UG93ZXJMZXZlbDtcbmZ1bmN0aW9uIHNldEJ1cnN0SGVhdG1hcCh2YWx1ZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiYnVyc3QgaGVhdG1hcFwiLCB2YWx1ZSwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICAgIHZhbHVlID0gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5idXJzdEhlYXRtYXAgPSB2YWx1ZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJidXJzdEhlYXRtYXBcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImJ1cnN0SGVhdG1hcFwiLCBjb25maWcuYnVyc3RIZWF0bWFwKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0QnVyc3RIZWF0bWFwID0gc2V0QnVyc3RIZWF0bWFwO1xuZnVuY3Rpb24gYXBwbHkoY29uZmlnVG9BcHBseSkge1xuICAgIGlmICghY29uZmlnVG9BcHBseSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IGNvbmZpZ09iaiA9IGNvbmZpZ1RvQXBwbHk7XG4gICAgT2JqZWN0LmtleXMoZGVmYXVsdF9jb25maWdfMS5kZWZhdWx0KS5mb3JFYWNoKChjb25maWdLZXkpID0+IHtcbiAgICAgICAgaWYgKGNvbmZpZ09ialtjb25maWdLZXldID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gZGVmYXVsdF9jb25maWdfMS5kZWZhdWx0W2NvbmZpZ0tleV07XG4gICAgICAgICAgICBjb25maWdPYmpbY29uZmlnS2V5XSA9IG5ld1ZhbHVlO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgaWYgKGNvbmZpZ09iaiAhPT0gdW5kZWZpbmVkICYmIGNvbmZpZ09iaiAhPT0gbnVsbCkge1xuICAgICAgICBzZXRUaGVtZUxpZ2h0KGNvbmZpZ09iai50aGVtZUxpZ2h0LCB0cnVlKTtcbiAgICAgICAgc2V0VGhlbWVEYXJrKGNvbmZpZ09iai50aGVtZURhcmssIHRydWUpO1xuICAgICAgICBzZXRBdXRvU3dpdGNoVGhlbWUoY29uZmlnT2JqLmF1dG9Td2l0Y2hUaGVtZSwgdHJ1ZSk7XG4gICAgICAgIHNldFRoZW1lcyhjb25maWdPYmoudGhlbWUsIGNvbmZpZ09iai5jdXN0b21UaGVtZSwgY29uZmlnT2JqLmN1c3RvbVRoZW1lQ29sb3JzLCB0cnVlKTtcbiAgICAgICAgc2V0Q3VzdG9tTGF5b3V0Zmx1aWQoY29uZmlnT2JqLmN1c3RvbUxheW91dGZsdWlkLCB0cnVlKTtcbiAgICAgICAgc2V0Q3VzdG9tQmFja2dyb3VuZChjb25maWdPYmouY3VzdG9tQmFja2dyb3VuZCwgdHJ1ZSk7XG4gICAgICAgIHNldEN1c3RvbUJhY2tncm91bmRTaXplKGNvbmZpZ09iai5jdXN0b21CYWNrZ3JvdW5kU2l6ZSwgdHJ1ZSk7XG4gICAgICAgIHNldEN1c3RvbUJhY2tncm91bmRGaWx0ZXIoY29uZmlnT2JqLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIsIHRydWUpO1xuICAgICAgICBzZXRRdWlja1RhYk1vZGUoY29uZmlnT2JqLnF1aWNrVGFiLCB0cnVlKTtcbiAgICAgICAgc2V0S2V5VGlwcyhjb25maWdPYmouc2hvd0tleVRpcHMsIHRydWUpO1xuICAgICAgICBzZXRUaW1lQ29uZmlnKGNvbmZpZ09iai50aW1lLCB0cnVlKTtcbiAgICAgICAgc2V0UXVvdGVMZW5ndGgoY29uZmlnT2JqLnF1b3RlTGVuZ3RoLCB0cnVlKTtcbiAgICAgICAgc2V0V29yZENvdW50KGNvbmZpZ09iai53b3JkcywgdHJ1ZSk7XG4gICAgICAgIHNldExhbmd1YWdlKGNvbmZpZ09iai5sYW5ndWFnZSwgdHJ1ZSk7XG4gICAgICAgIHNldExheW91dChjb25maWdPYmoubGF5b3V0LCB0cnVlKTtcbiAgICAgICAgc2V0Rm9udFNpemUoY29uZmlnT2JqLmZvbnRTaXplLCB0cnVlKTtcbiAgICAgICAgc2V0RnJlZWRvbU1vZGUoY29uZmlnT2JqLmZyZWVkb21Nb2RlLCB0cnVlKTtcbiAgICAgICAgc2V0Q2FyZXRTdHlsZShjb25maWdPYmouY2FyZXRTdHlsZSwgdHJ1ZSk7XG4gICAgICAgIHNldFBhY2VDYXJldFN0eWxlKGNvbmZpZ09iai5wYWNlQ2FyZXRTdHlsZSwgdHJ1ZSk7XG4gICAgICAgIHNldERpZmZpY3VsdHkoY29uZmlnT2JqLmRpZmZpY3VsdHksIHRydWUpO1xuICAgICAgICBzZXRCbGluZE1vZGUoY29uZmlnT2JqLmJsaW5kTW9kZSwgdHJ1ZSk7XG4gICAgICAgIHNldFF1aWNrRW5kKGNvbmZpZ09iai5xdWlja0VuZCwgdHJ1ZSk7XG4gICAgICAgIHNldEZsaXBUZXN0Q29sb3JzKGNvbmZpZ09iai5mbGlwVGVzdENvbG9ycywgdHJ1ZSk7XG4gICAgICAgIHNldENvbG9yZnVsTW9kZShjb25maWdPYmouY29sb3JmdWxNb2RlLCB0cnVlKTtcbiAgICAgICAgc2V0Q29uZmlkZW5jZU1vZGUoY29uZmlnT2JqLmNvbmZpZGVuY2VNb2RlLCB0cnVlKTtcbiAgICAgICAgc2V0SW5kaWNhdGVUeXBvcyhjb25maWdPYmouaW5kaWNhdGVUeXBvcywgdHJ1ZSk7XG4gICAgICAgIHNldFRpbWVyU3R5bGUoY29uZmlnT2JqLnRpbWVyU3R5bGUsIHRydWUpO1xuICAgICAgICBzZXRUaW1lckNvbG9yKGNvbmZpZ09iai50aW1lckNvbG9yLCB0cnVlKTtcbiAgICAgICAgc2V0VGltZXJPcGFjaXR5KGNvbmZpZ09iai50aW1lck9wYWNpdHksIHRydWUpO1xuICAgICAgICBzZXRLZXltYXBNb2RlKGNvbmZpZ09iai5rZXltYXBNb2RlLCB0cnVlKTtcbiAgICAgICAgc2V0S2V5bWFwU3R5bGUoY29uZmlnT2JqLmtleW1hcFN0eWxlLCB0cnVlKTtcbiAgICAgICAgc2V0S2V5bWFwTGVnZW5kU3R5bGUoY29uZmlnT2JqLmtleW1hcExlZ2VuZFN0eWxlLCB0cnVlKTtcbiAgICAgICAgc2V0S2V5bWFwTGF5b3V0KGNvbmZpZ09iai5rZXltYXBMYXlvdXQsIHRydWUpO1xuICAgICAgICBzZXRGb250RmFtaWx5KGNvbmZpZ09iai5mb250RmFtaWx5LCB0cnVlKTtcbiAgICAgICAgc2V0U21vb3RoQ2FyZXQoY29uZmlnT2JqLnNtb290aENhcmV0LCB0cnVlKTtcbiAgICAgICAgc2V0U21vb3RoTGluZVNjcm9sbChjb25maWdPYmouc21vb3RoTGluZVNjcm9sbCwgdHJ1ZSk7XG4gICAgICAgIHNldFNob3dMaXZlV3BtKGNvbmZpZ09iai5zaG93TGl2ZVdwbSwgdHJ1ZSk7XG4gICAgICAgIHNldFNob3dMaXZlQWNjKGNvbmZpZ09iai5zaG93TGl2ZUFjYywgdHJ1ZSk7XG4gICAgICAgIHNldFNob3dMaXZlQnVyc3QoY29uZmlnT2JqLnNob3dMaXZlQnVyc3QsIHRydWUpO1xuICAgICAgICBzZXRTaG93VGltZXJQcm9ncmVzcyhjb25maWdPYmouc2hvd1RpbWVyUHJvZ3Jlc3MsIHRydWUpO1xuICAgICAgICBzZXRBbHdheXNTaG93RGVjaW1hbFBsYWNlcyhjb25maWdPYmouYWx3YXlzU2hvd0RlY2ltYWxQbGFjZXMsIHRydWUpO1xuICAgICAgICBzZXRBbHdheXNTaG93V29yZHNIaXN0b3J5KGNvbmZpZ09iai5hbHdheXNTaG93V29yZHNIaXN0b3J5LCB0cnVlKTtcbiAgICAgICAgc2V0U2luZ2xlTGlzdENvbW1hbmRMaW5lKGNvbmZpZ09iai5zaW5nbGVMaXN0Q29tbWFuZExpbmUsIHRydWUpO1xuICAgICAgICBzZXRDYXBzTG9ja1dhcm5pbmcoY29uZmlnT2JqLmNhcHNMb2NrV2FybmluZywgdHJ1ZSk7XG4gICAgICAgIHNldFBsYXlTb3VuZE9uRXJyb3IoY29uZmlnT2JqLnBsYXlTb3VuZE9uRXJyb3IsIHRydWUpO1xuICAgICAgICBzZXRQbGF5U291bmRPbkNsaWNrKGNvbmZpZ09iai5wbGF5U291bmRPbkNsaWNrLCB0cnVlKTtcbiAgICAgICAgc2V0U291bmRWb2x1bWUoY29uZmlnT2JqLnNvdW5kVm9sdW1lLCB0cnVlKTtcbiAgICAgICAgc2V0U3RvcE9uRXJyb3IoY29uZmlnT2JqLnN0b3BPbkVycm9yLCB0cnVlKTtcbiAgICAgICAgc2V0RmF2VGhlbWVzKGNvbmZpZ09iai5mYXZUaGVtZXMsIHRydWUpO1xuICAgICAgICBzZXRGdW5ib3goY29uZmlnT2JqLmZ1bmJveCwgdHJ1ZSk7XG4gICAgICAgIHNldFJhbmRvbVRoZW1lKGNvbmZpZ09iai5yYW5kb21UaGVtZSwgdHJ1ZSk7XG4gICAgICAgIHNldFNob3dBbGxMaW5lcyhjb25maWdPYmouc2hvd0FsbExpbmVzLCB0cnVlKTtcbiAgICAgICAgc2V0U3dhcEVzY0FuZFRhYihjb25maWdPYmouc3dhcEVzY0FuZFRhYiwgdHJ1ZSk7XG4gICAgICAgIHNldFNob3dPdXRPZkZvY3VzV2FybmluZyhjb25maWdPYmouc2hvd091dE9mRm9jdXNXYXJuaW5nLCB0cnVlKTtcbiAgICAgICAgc2V0UGFjZUNhcmV0KGNvbmZpZ09iai5wYWNlQ2FyZXQsIHRydWUpO1xuICAgICAgICBzZXRQYWNlQ2FyZXRDdXN0b21TcGVlZChjb25maWdPYmoucGFjZUNhcmV0Q3VzdG9tU3BlZWQsIHRydWUpO1xuICAgICAgICBzZXRSZXBlYXRlZFBhY2UoY29uZmlnT2JqLnJlcGVhdGVkUGFjZSwgdHJ1ZSk7XG4gICAgICAgIHNldFBhZ2VXaWR0aChjb25maWdPYmoucGFnZVdpZHRoLCB0cnVlKTtcbiAgICAgICAgc2V0Q2hhcnRBY2N1cmFjeShjb25maWdPYmouY2hhcnRBY2N1cmFjeSwgdHJ1ZSk7XG4gICAgICAgIHNldENoYXJ0U3R5bGUoY29uZmlnT2JqLmNoYXJ0U3R5bGUsIHRydWUpO1xuICAgICAgICBzZXRNaW5CdXJzdChjb25maWdPYmoubWluQnVyc3QsIHRydWUpO1xuICAgICAgICBzZXRNaW5CdXJzdEN1c3RvbVNwZWVkKGNvbmZpZ09iai5taW5CdXJzdEN1c3RvbVNwZWVkLCB0cnVlKTtcbiAgICAgICAgc2V0TWluV3BtKGNvbmZpZ09iai5taW5XcG0sIHRydWUpO1xuICAgICAgICBzZXRNaW5XcG1DdXN0b21TcGVlZChjb25maWdPYmoubWluV3BtQ3VzdG9tU3BlZWQsIHRydWUpO1xuICAgICAgICBzZXRNaW5BY2MoY29uZmlnT2JqLm1pbkFjYywgdHJ1ZSk7XG4gICAgICAgIHNldE1pbkFjY0N1c3RvbShjb25maWdPYmoubWluQWNjQ3VzdG9tLCB0cnVlKTtcbiAgICAgICAgc2V0TnVtYmVycyhjb25maWdPYmoubnVtYmVycywgdHJ1ZSk7XG4gICAgICAgIHNldFB1bmN0dWF0aW9uKGNvbmZpZ09iai5wdW5jdHVhdGlvbiwgdHJ1ZSk7XG4gICAgICAgIHNldEhpZ2hsaWdodE1vZGUoY29uZmlnT2JqLmhpZ2hsaWdodE1vZGUsIHRydWUpO1xuICAgICAgICBzZXRBbHdheXNTaG93Q1BNKGNvbmZpZ09iai5hbHdheXNTaG93Q1BNLCB0cnVlKTtcbiAgICAgICAgc2V0SGlkZUV4dHJhTGV0dGVycyhjb25maWdPYmouaGlkZUV4dHJhTGV0dGVycywgdHJ1ZSk7XG4gICAgICAgIHNldFN0YXJ0R3JhcGhzQXRaZXJvKGNvbmZpZ09iai5zdGFydEdyYXBoc0F0WmVybywgdHJ1ZSk7XG4gICAgICAgIHNldFN0cmljdFNwYWNlKGNvbmZpZ09iai5zdHJpY3RTcGFjZSwgdHJ1ZSk7XG4gICAgICAgIHNldE9wcG9zaXRlU2hpZnRNb2RlKGNvbmZpZ09iai5vcHBvc2l0ZVNoaWZ0TW9kZSwgdHJ1ZSk7XG4gICAgICAgIHNldE1vZGUoY29uZmlnT2JqLm1vZGUsIHRydWUpO1xuICAgICAgICBzZXRNb25rZXkoY29uZmlnT2JqLm1vbmtleSwgdHJ1ZSk7XG4gICAgICAgIHNldFJlcGVhdFF1b3Rlcyhjb25maWdPYmoucmVwZWF0UXVvdGVzLCB0cnVlKTtcbiAgICAgICAgc2V0TW9ua2V5UG93ZXJMZXZlbChjb25maWdPYmoubW9ua2V5UG93ZXJMZXZlbCwgdHJ1ZSk7XG4gICAgICAgIHNldEJ1cnN0SGVhdG1hcChjb25maWdPYmouYnVyc3RIZWF0bWFwLCB0cnVlKTtcbiAgICAgICAgc2V0QnJpdGlzaEVuZ2xpc2goY29uZmlnT2JqLmJyaXRpc2hFbmdsaXNoLCB0cnVlKTtcbiAgICAgICAgc2V0TGF6eU1vZGUoY29uZmlnT2JqLmxhenlNb2RlLCB0cnVlKTtcbiAgICAgICAgc2V0U2hvd0F2ZXJhZ2UoY29uZmlnT2JqLnNob3dBdmVyYWdlLCB0cnVlKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHNldEVuYWJsZUFkcyhjb25maWdPYmouZW5hYmxlQWRzLCB0cnVlKTtcbiAgICAgICAgICAgIGlmIChjb25maWcuZW5hYmxlQWRzID09PSBcIm1heFwiIHx8IGNvbmZpZy5lbmFibGVBZHMgPT09IFwib25cIikge1xuICAgICAgICAgICAgICAgICQoXCJoZWFkXCIpLmFwcGVuZChgXG4gICAgICAgICAgPHNjcmlwdFxuICAgICAgICAgIHNyYz1cImh0dHBzOi8vaGIudm50c20uY29tL3YzL2xpdmUvYWQtbWFuYWdlci5taW4uanNcIlxuICAgICAgICAgIHR5cGU9XCJ0ZXh0L2phdmFzY3JpcHRcIlxuICAgICAgICAgIGRhdGEtc2l0ZS1pZD1cIjYwYjc4YWYxMjExOTEyMmI4OTU4OTEwZlwiXG4gICAgICAgICAgZGF0YS1tb2RlPVwic2NhblwiXG4gICAgICAgICAgaWQ9XCJhZFNjcmlwdFwiXG4gICAgICAgICAgYXN5bmNcbiAgICAgICAgICA+PC9zY3JpcHQ+XG4gICAgICAgIGApO1xuICAgICAgICAgICAgICAgIGlmIChjb25maWcuZW5hYmxlQWRzID09PSBcIm1heFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICAgICQoXCIjYWRfcmljaF9tZWRpYVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIiNhZF9yaWNoX21lZGlhXCIpLmh0bWwoYDxkaXYgY2xhc3M9XCJ2bS1wbGFjZW1lbnRcIiBkYXRhLWlkPVwiNjBiZjczN2VlMDRjYjc2MWM4OGFhZmIxXCIgc3R5bGU9XCJkaXNwbGF5Om5vbmVcIj48L2Rpdj5gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQoXCIjYWRfcmljaF9tZWRpYVwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy88ZGl2IGNsYXNzPVwidm0tcGxhY2VtZW50XCIgZGF0YS1pZD1cIjYwYmY3M2RhZTA0Y2I3NjFjODhhYWZiNVwiPjwvZGl2PlxuICAgICAgICAgICAgICAgICQoXCIjYWRfZm9vdGVyXCIpLmh0bWwoYDxkaXYgY2xhc3M9XCJ2bS1wbGFjZW1lbnRcIiBkYXRhLWlkPVwiNjBiZjczZGFlMDRjYjc2MWM4OGFhZmI1XCI+PC9kaXY+YCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9mb290ZXJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgLy8gJChcIiNhZF9mb290ZXIyXCIpLmh0bWwoYDxkaXYgY2xhc3M9XCJ2bS1wbGFjZW1lbnRcIiBkYXRhLWlkPVwiNjBiZjczZTllMDRjYjc2MWM4OGFhZmI3XCI+PC9kaXY+YCk7XG4gICAgICAgICAgICAgICAgLy8gJChcIiNhZF9mb290ZXIyXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfYWJvdXQxXCIpLmh0bWwoYDxkaXYgY2xhc3M9XCJ2bS1wbGFjZW1lbnRcIiBkYXRhLWlkPVwiNjBiZjczZGFlMDRjYjc2MWM4OGFhZmI1XCI+PC9kaXY+YCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9hYm91dDFcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9hYm91dDJcIikuaHRtbChgPGRpdiBjbGFzcz1cInZtLXBsYWNlbWVudFwiIGRhdGEtaWQ9XCI2MGJmNzNkYWUwNGNiNzYxYzg4YWFmYjVcIj48L2Rpdj5gKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX2Fib3V0MlwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX3NldHRpbmdzMFwiKS5odG1sKGA8ZGl2IGNsYXNzPVwidm0tcGxhY2VtZW50XCIgZGF0YS1pZD1cIjYwYmY3M2RhZTA0Y2I3NjFjODhhYWZiNVwiPjwvZGl2PmApO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfc2V0dGluZ3MwXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfc2V0dGluZ3MxXCIpLmh0bWwoYDxkaXYgY2xhc3M9XCJ2bS1wbGFjZW1lbnRcIiBkYXRhLWlkPVwiNjBiZjczZGFlMDRjYjc2MWM4OGFhZmI1XCI+PC9kaXY+YCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9zZXR0aW5nczFcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9zZXR0aW5nczJcIikuaHRtbChgPGRpdiBjbGFzcz1cInZtLXBsYWNlbWVudFwiIGRhdGEtaWQ9XCI2MGJmNzNkYWUwNGNiNzYxYzg4YWFmYjVcIj48L2Rpdj5gKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX3NldHRpbmdzMlwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX3NldHRpbmdzM1wiKS5odG1sKGA8ZGl2IGNsYXNzPVwidm0tcGxhY2VtZW50XCIgZGF0YS1pZD1cIjYwYmY3M2RhZTA0Y2I3NjFjODhhYWZiNVwiPjwvZGl2PmApO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfc2V0dGluZ3MzXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfYWNjb3VudFwiKS5odG1sKGA8ZGl2IGNsYXNzPVwidm0tcGxhY2VtZW50XCIgZGF0YS1pZD1cIjYwYmY3M2RhZTA0Y2I3NjFjODhhYWZiNVwiPjwvZGl2PmApO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfYWNjb3VudFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAkKFwiLmZvb3RlcmFkc1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICQoXCIjYWRTY3JpcHRcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJChcIi5mb290ZXJhZHNcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9sZWZ0XCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfcmlnaHRcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9mb290ZXJcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9mb290ZXIyXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfZm9vdGVyM1wiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX3NldHRpbmdzMFwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX3NldHRpbmdzMVwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX3NldHRpbmdzMlwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX3NldHRpbmdzM1wiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX2FjY291bnRcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9hYm91dDFcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9hYm91dDJcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRXJyb3IgaW5pdGlhbGlzaW5nIGFkczogXCIgKyBlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvciBpbml0aWFsaXNpbmcgYWRzIFwiICsgZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICQoXCIuZm9vdGVyYWRzXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgJChcIiNhZF9sZWZ0XCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgJChcIiNhZF9yaWdodFwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICQoXCIjYWRfZm9vdGVyXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgJChcIiNhZF9mb290ZXIyXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgJChcIiNhZF9mb290ZXIzXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgJChcIiNhZF9zZXR0aW5nczBcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAkKFwiI2FkX3NldHRpbmdzMVwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICQoXCIjYWRfc2V0dGluZ3MyXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgJChcIiNhZF9zZXR0aW5nczNcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAkKFwiI2FkX2FjY291bnRcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAkKFwiI2FkX2Fib3V0MVwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICQoXCIjYWRfYWJvdXQyXCIpLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiY29uZmlnQXBwbGllZFwiLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBjb25maWcpO1xuICAgIH1cbn1cbmV4cG9ydHMuYXBwbHkgPSBhcHBseTtcbmZ1bmN0aW9uIHJlc2V0KCkge1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiZnVsbENvbmZpZ0NoYW5nZVwiKTtcbiAgICBhcHBseShkZWZhdWx0X2NvbmZpZ18xLmRlZmF1bHQpO1xuICAgIHNhdmVGdWxsQ29uZmlnVG9Mb2NhbFN0b3JhZ2UoKTtcbn1cbmV4cG9ydHMucmVzZXQgPSByZXNldDtcbmZ1bmN0aW9uIGxvYWRGcm9tTG9jYWxTdG9yYWdlKCkge1xuICAgIGNvbnNvbGUubG9nKFwibG9hZGluZyBsb2NhbFN0b3JhZ2UgY29uZmlnXCIpO1xuICAgIGNvbnN0IG5ld0NvbmZpZ1N0cmluZyA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImNvbmZpZ1wiKTtcbiAgICBsZXQgbmV3Q29uZmlnO1xuICAgIGlmIChuZXdDb25maWdTdHJpbmcgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICBuZXdDb25maWdTdHJpbmcgIT09IG51bGwgJiZcbiAgICAgICAgbmV3Q29uZmlnU3RyaW5nICE9PSBcIlwiKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBuZXdDb25maWcgPSBKU09OLnBhcnNlKG5ld0NvbmZpZ1N0cmluZyk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIG5ld0NvbmZpZyA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIGFwcGx5KG5ld0NvbmZpZyk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiYXBwbHlpbmcgbG9jYWxTdG9yYWdlIGNvbmZpZ1wiKTtcbiAgICAgICAgZXhwb3J0cy5sb2NhbFN0b3JhZ2VDb25maWcgPSBuZXdDb25maWc7XG4gICAgICAgIHNhdmVGdWxsQ29uZmlnVG9Mb2NhbFN0b3JhZ2UodHJ1ZSk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwic2F2aW5nIGxvY2FsU3RvcmFnZSBjb25maWdcIik7XG4gICAgfVxuICAgIC8vIFRlc3RMb2dpYy5yZXN0YXJ0KGZhbHNlLCB0cnVlKTtcbiAgICBsb2FkRG9uZSgpO1xufVxuZXhwb3J0cy5sb2FkRnJvbUxvY2FsU3RvcmFnZSA9IGxvYWRGcm9tTG9jYWxTdG9yYWdlO1xuZnVuY3Rpb24gZ2V0Q29uZmlnQ2hhbmdlcygpIHtcbiAgICBjb25zdCBjb25maWdDaGFuZ2VzID0ge307XG4gICAgT2JqZWN0LmtleXMoY29uZmlnKVxuICAgICAgICAuZmlsdGVyKChrZXkpID0+IHtcbiAgICAgICAgcmV0dXJuIGNvbmZpZ1trZXldICE9IGRlZmF1bHRfY29uZmlnXzEuZGVmYXVsdFtrZXldO1xuICAgIH0pXG4gICAgICAgIC5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgY29uZmlnQ2hhbmdlc1trZXldID0gY29uZmlnW2tleV07XG4gICAgfSk7XG4gICAgcmV0dXJuIGNvbmZpZ0NoYW5nZXM7XG59XG5leHBvcnRzLmdldENvbmZpZ0NoYW5nZXMgPSBnZXRDb25maWdDaGFuZ2VzO1xuZnVuY3Rpb24gc2V0Q29uZmlnKG5ld0NvbmZpZykge1xuICAgIGNvbmZpZyA9IG5ld0NvbmZpZztcbn1cbmV4cG9ydHMuc2V0Q29uZmlnID0gc2V0Q29uZmlnO1xuZXhwb3J0cy5sb2FkUHJvbWlzZSA9IG5ldyBQcm9taXNlKCh2KSA9PiB7XG4gICAgbG9hZERvbmUgPSB2O1xufSk7XG5leHBvcnRzLmRlZmF1bHQgPSBjb25maWc7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZGVmYXVsdCA9IHtcbiAgICB0aGVtZTogXCJzZXJpa2FfZGFya1wiLFxuICAgIHRoZW1lTGlnaHQ6IFwic2VyaWthXCIsXG4gICAgdGhlbWVEYXJrOiBcInNlcmlrYV9kYXJrXCIsXG4gICAgYXV0b1N3aXRjaFRoZW1lOiBmYWxzZSxcbiAgICBjdXN0b21UaGVtZTogZmFsc2UsXG4gICAgY3VzdG9tVGhlbWVDb2xvcnM6IFtcbiAgICAgICAgXCIjMzIzNDM3XCIsXG4gICAgICAgIFwiI2UyYjcxNFwiLFxuICAgICAgICBcIiNlMmI3MTRcIixcbiAgICAgICAgXCIjNjQ2NjY5XCIsXG4gICAgICAgIFwiI2QxZDBjNVwiLFxuICAgICAgICBcIiNjYTQ3NTRcIixcbiAgICAgICAgXCIjN2UyYTMzXCIsXG4gICAgICAgIFwiI2NhNDc1NFwiLFxuICAgICAgICBcIiM3ZTJhMzNcIixcbiAgICBdLFxuICAgIGZhdlRoZW1lczogW10sXG4gICAgc2hvd0tleVRpcHM6IHRydWUsXG4gICAgc2hvd0xpdmVXcG06IGZhbHNlLFxuICAgIHNob3dUaW1lclByb2dyZXNzOiB0cnVlLFxuICAgIHNtb290aENhcmV0OiB0cnVlLFxuICAgIHF1aWNrVGFiOiBmYWxzZSxcbiAgICBwdW5jdHVhdGlvbjogZmFsc2UsXG4gICAgbnVtYmVyczogZmFsc2UsXG4gICAgd29yZHM6IDUwLFxuICAgIHRpbWU6IDMwLFxuICAgIG1vZGU6IFwidGltZVwiLFxuICAgIHF1b3RlTGVuZ3RoOiBbMV0sXG4gICAgbGFuZ3VhZ2U6IFwiZW5nbGlzaFwiLFxuICAgIGZvbnRTaXplOiBcIjE1XCIsXG4gICAgZnJlZWRvbU1vZGU6IGZhbHNlLFxuICAgIHJlc3VsdEZpbHRlcnM6IG51bGwsXG4gICAgZGlmZmljdWx0eTogXCJub3JtYWxcIixcbiAgICBibGluZE1vZGU6IGZhbHNlLFxuICAgIHF1aWNrRW5kOiBmYWxzZSxcbiAgICBjYXJldFN0eWxlOiBcImRlZmF1bHRcIixcbiAgICBwYWNlQ2FyZXRTdHlsZTogXCJkZWZhdWx0XCIsXG4gICAgZmxpcFRlc3RDb2xvcnM6IGZhbHNlLFxuICAgIGxheW91dDogXCJkZWZhdWx0XCIsXG4gICAgZnVuYm94OiBcIm5vbmVcIixcbiAgICBjb25maWRlbmNlTW9kZTogXCJvZmZcIixcbiAgICBpbmRpY2F0ZVR5cG9zOiBcIm9mZlwiLFxuICAgIHRpbWVyU3R5bGU6IFwibWluaVwiLFxuICAgIGNvbG9yZnVsTW9kZTogZmFsc2UsXG4gICAgcmFuZG9tVGhlbWU6IFwib2ZmXCIsXG4gICAgdGltZXJDb2xvcjogXCJtYWluXCIsXG4gICAgdGltZXJPcGFjaXR5OiBcIjFcIixcbiAgICBzdG9wT25FcnJvcjogXCJvZmZcIixcbiAgICBzaG93QWxsTGluZXM6IGZhbHNlLFxuICAgIGtleW1hcE1vZGU6IFwib2ZmXCIsXG4gICAga2V5bWFwU3R5bGU6IFwic3RhZ2dlcmVkXCIsXG4gICAga2V5bWFwTGVnZW5kU3R5bGU6IFwibG93ZXJjYXNlXCIsXG4gICAga2V5bWFwTGF5b3V0OiBcIm92ZXJyaWRlU3luY1wiLFxuICAgIGZvbnRGYW1pbHk6IFwiUm9ib3RvX01vbm9cIixcbiAgICBzbW9vdGhMaW5lU2Nyb2xsOiBmYWxzZSxcbiAgICBhbHdheXNTaG93RGVjaW1hbFBsYWNlczogZmFsc2UsXG4gICAgYWx3YXlzU2hvd1dvcmRzSGlzdG9yeTogZmFsc2UsXG4gICAgc2luZ2xlTGlzdENvbW1hbmRMaW5lOiBcIm1hbnVhbFwiLFxuICAgIGNhcHNMb2NrV2FybmluZzogdHJ1ZSxcbiAgICBwbGF5U291bmRPbkVycm9yOiBmYWxzZSxcbiAgICBwbGF5U291bmRPbkNsaWNrOiBcIm9mZlwiLFxuICAgIHNvdW5kVm9sdW1lOiBcIjAuNVwiLFxuICAgIHN0YXJ0R3JhcGhzQXRaZXJvOiB0cnVlLFxuICAgIHN3YXBFc2NBbmRUYWI6IGZhbHNlLFxuICAgIHNob3dPdXRPZkZvY3VzV2FybmluZzogdHJ1ZSxcbiAgICBwYWNlQ2FyZXQ6IFwib2ZmXCIsXG4gICAgcGFjZUNhcmV0Q3VzdG9tU3BlZWQ6IDEwMCxcbiAgICByZXBlYXRlZFBhY2U6IHRydWUsXG4gICAgcGFnZVdpZHRoOiBcIjEwMFwiLFxuICAgIGNoYXJ0QWNjdXJhY3k6IHRydWUsXG4gICAgY2hhcnRTdHlsZTogXCJsaW5lXCIsXG4gICAgbWluV3BtOiBcIm9mZlwiLFxuICAgIG1pbldwbUN1c3RvbVNwZWVkOiAxMDAsXG4gICAgaGlnaGxpZ2h0TW9kZTogXCJsZXR0ZXJcIixcbiAgICBhbHdheXNTaG93Q1BNOiBmYWxzZSxcbiAgICBlbmFibGVBZHM6IFwib2ZmXCIsXG4gICAgaGlkZUV4dHJhTGV0dGVyczogZmFsc2UsXG4gICAgc3RyaWN0U3BhY2U6IGZhbHNlLFxuICAgIG1pbkFjYzogXCJvZmZcIixcbiAgICBtaW5BY2NDdXN0b206IDkwLFxuICAgIHNob3dMaXZlQWNjOiBmYWxzZSxcbiAgICBzaG93TGl2ZUJ1cnN0OiBmYWxzZSxcbiAgICBtb25rZXk6IGZhbHNlLFxuICAgIHJlcGVhdFF1b3RlczogXCJvZmZcIixcbiAgICBvcHBvc2l0ZVNoaWZ0TW9kZTogXCJvZmZcIixcbiAgICBjdXN0b21CYWNrZ3JvdW5kOiBcIlwiLFxuICAgIGN1c3RvbUJhY2tncm91bmRTaXplOiBcImNvdmVyXCIsXG4gICAgY3VzdG9tQmFja2dyb3VuZEZpbHRlcjogWzAsIDEsIDEsIDEsIDFdLFxuICAgIGN1c3RvbUxheW91dGZsdWlkOiBcInF3ZXJ0eSNkdm9yYWsjY29sZW1ha1wiLFxuICAgIG1vbmtleVBvd2VyTGV2ZWw6IFwib2ZmXCIsXG4gICAgbWluQnVyc3Q6IFwib2ZmXCIsXG4gICAgbWluQnVyc3RDdXN0b21TcGVlZDogMTAwLFxuICAgIGJ1cnN0SGVhdG1hcDogZmFsc2UsXG4gICAgYnJpdGlzaEVuZ2xpc2g6IGZhbHNlLFxuICAgIGxhenlNb2RlOiBmYWxzZSxcbiAgICBzaG93QXZlcmFnZTogXCJvZmZcIixcbn07XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZGVmYXVsdFNuYXAgPSB2b2lkIDA7XG5leHBvcnRzLmRlZmF1bHRTbmFwID0ge1xuICAgIHJlc3VsdHM6IHVuZGVmaW5lZCxcbiAgICBwZXJzb25hbEJlc3RzOiB7XG4gICAgICAgIHRpbWU6IHt9LFxuICAgICAgICB3b3Jkczoge30sXG4gICAgICAgIHplbjogeyB6ZW46IFtdIH0sXG4gICAgICAgIHF1b3RlOiB7IGN1c3RvbTogW10gfSxcbiAgICAgICAgY3VzdG9tOiB7IGN1c3RvbTogW10gfSxcbiAgICB9LFxuICAgIG5hbWU6IFwiXCIsXG4gICAgY3VzdG9tVGhlbWVzOiBbXSxcbiAgICBwcmVzZXRzOiBbXSxcbiAgICB0YWdzOiBbXSxcbiAgICBmYXZvdXJpdGVUaGVtZXM6IFtdLFxuICAgIGJhbm5lZDogdW5kZWZpbmVkLFxuICAgIHZlcmlmaWVkOiB1bmRlZmluZWQsXG4gICAgZW1haWxWZXJpZmllZDogdW5kZWZpbmVkLFxuICAgIGxiTWVtb3J5OiB7IHRpbWU6IHsgMTU6IHsgZW5nbGlzaDogMCB9LCA2MDogeyBlbmdsaXNoOiAwIH0gfSB9LFxuICAgIGdsb2JhbFN0YXRzOiB7XG4gICAgICAgIHRpbWU6IDAsXG4gICAgICAgIHN0YXJ0ZWQ6IDAsXG4gICAgICAgIGNvbXBsZXRlZDogMCxcbiAgICB9LFxuICAgIHF1b3RlUmF0aW5nczogdW5kZWZpbmVkLFxuICAgIHF1b3RlTW9kOiBmYWxzZSxcbn07XG4iLCJcInVzZSBzdHJpY3RcIjtcbi8vIFRvIGZpbmQgeW91ciBjb25maWcsIGdvIHRvIGh0dHBzOi8vY29uc29sZS5maXJlYmFzZS5nb29nbGUuY29tLyBhbmQgc2VsZWN0IHlvdXIgcHJvamVjdFxuLy8gR28gdG8gKHRvcCBsZWZ0KSBTZXR0aW5ncyA+IFByb2plY3QgU2V0dGluZ3MgPiBHZW5lcmFsXG4vLyBzY3JvbGwgZG93biB0byBZb3VyIGFwcHMgPiBXZWIgQXBwcyAoaWYgaXQgZG9lc250IGV4aXN0LCBjcmVhdGUgb25lKSA+IFNESyBzZXR1cCBhbmQgY29uZmlndXJhdGlvbiA+IHNlbGVjdCBucG1cbi8vIHlvdXIgY29uZmlnIHNob3VsZCBiZSB2aXNpYmxlIHRoZXJlXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmZpcmViYXNlQ29uZmlnID0gdm9pZCAwO1xuZXhwb3J0cy5maXJlYmFzZUNvbmZpZyA9IHtcbiAgICBhcGlLZXk6IFwiQUl6YVN5QzhaR2xDbmFZSllzejVic010bUpHYnU4UXF0Q1ZwTTRnXCIsXG4gICAgYXV0aERvbWFpbjogXCJtb25rZXl0eXBlLWQ0NDBhLmZpcmViYXNlYXBwLmNvbVwiLFxuICAgIHByb2plY3RJZDogXCJtb25rZXl0eXBlLWQ0NDBhXCIsXG4gICAgc3RvcmFnZUJ1Y2tldDogXCJtb25rZXl0eXBlLWQ0NDBhLmFwcHNwb3QuY29tXCIsXG4gICAgbWVzc2FnaW5nU2VuZGVySWQ6IFwiNDA5Nzk4NzQ1NDMwXCIsXG4gICAgYXBwSWQ6IFwiMTo0MDk3OTg3NDU0MzA6d2ViOjY4NDM1NTdiMzZhMjUxNTYzNzBhZjdcIlxufTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2lnbk91dCA9IGV4cG9ydHMuYWRkUGFzc3dvcmRBdXRoID0gZXhwb3J0cy5yZW1vdmVHb29nbGVBdXRoID0gZXhwb3J0cy5hZGRHb29nbGVBdXRoID0gZXhwb3J0cy5zaWduSW5XaXRoR29vZ2xlID0gZXhwb3J0cy5zaWduSW4gPSBleHBvcnRzLmdldERhdGFBbmRJbml0ID0gZXhwb3J0cy5zZW5kVmVyaWZpY2F0aW9uRW1haWwgPSBleHBvcnRzLmdtYWlsUHJvdmlkZXIgPSB2b2lkIDA7XG5jb25zdCBhcGVfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vYXBlXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgQWNjb3VudEJ1dHRvbiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvYWNjb3VudC1idXR0b25cIikpO1xuY29uc3QgQWNjb3VudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcGFnZXMvYWNjb3VudFwiKSk7XG5jb25zdCBWZXJpZmljYXRpb25Db250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3ZlcmlmaWNhdGlvbi1jb250cm9sbGVyXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgU2V0dGluZ3MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BhZ2VzL3NldHRpbmdzXCIpKTtcbmNvbnN0IEFsbFRpbWVTdGF0cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vYWNjb3VudC9hbGwtdGltZS1zdGF0c1wiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgVGVzdExvZ2ljID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtbG9naWNcIikpO1xuY29uc3QgUGFnZUNvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vcGFnZS1jb250cm9sbGVyXCIpKTtcbmNvbnN0IFBTQSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvcHNhXCIpKTtcbmNvbnN0IEZvY3VzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2ZvY3VzXCIpKTtcbmNvbnN0IExvYWRlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbG9hZGVyXCIpKTtcbmNvbnN0IFBhZ2VUcmFuc2l0aW9uID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvcGFnZS10cmFuc2l0aW9uXCIpKTtcbmNvbnN0IEFjdGl2ZVBhZ2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9hY3RpdmUtcGFnZVwiKSk7XG5jb25zdCBUZXN0QWN0aXZlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvdGVzdC1hY3RpdmVcIikpO1xuY29uc3QgTG9hZGluZ1BhZ2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BhZ2VzL2xvYWRpbmdcIikpO1xuY29uc3QgUmVzdWx0RmlsdGVycyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vYWNjb3VudC9yZXN1bHQtZmlsdGVyc1wiKSk7XG5jb25zdCBQYWNlQ2FyZXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvcGFjZS1jYXJldFwiKSk7XG5jb25zdCBDb21tYW5kbGluZUxpc3RzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9jb21tYW5kbGluZS1saXN0c1wiKSk7XG5jb25zdCBUYWdDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3RhZy1jb250cm9sbGVyXCIpKTtcbmNvbnN0IFJlc3VsdFRhZ3NQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcG9wdXBzL3Jlc3VsdC10YWdzLXBvcHVwXCIpKTtcbmNvbnN0IFVSTEhhbmRsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL3VybC1oYW5kbGVyXCIpKTtcbmNvbnN0IGF1dGhfMSA9IHJlcXVpcmUoXCJmaXJlYmFzZS9hdXRoXCIpO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuLi9maXJlYmFzZVwiKTtcbmNvbnN0IGRpZmZlcmVuY2VJbkRheXNfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiZGF0ZS1mbnMvZGlmZmVyZW5jZUluRGF5c1wiKSk7XG5jb25zdCBkZWZhdWx0X3NuYXBzaG90XzEgPSByZXF1aXJlKFwiLi4vY29uc3RhbnRzL2RlZmF1bHQtc25hcHNob3RcIik7XG5leHBvcnRzLmdtYWlsUHJvdmlkZXIgPSBuZXcgYXV0aF8xLkdvb2dsZUF1dGhQcm92aWRlcigpO1xuZnVuY3Rpb24gc2VuZFZlcmlmaWNhdGlvbkVtYWlsKCkge1xuICAgIExvYWRlci5zaG93KCk7XG4gICAgY29uc3QgdXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICBpZiAodXNlciA9PT0gbnVsbClcbiAgICAgICAgcmV0dXJuO1xuICAgICgwLCBhdXRoXzEuc2VuZEVtYWlsVmVyaWZpY2F0aW9uKSh1c2VyKVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRW1haWwgc2VudCB0byBcIiArIHVzZXIuZW1haWwsIDQwMDApO1xuICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZSkgPT4ge1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVycm9yOiBcIiArIGUubWVzc2FnZSwgMzAwMCk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZS5tZXNzYWdlKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc2VuZFZlcmlmaWNhdGlvbkVtYWlsID0gc2VuZFZlcmlmaWNhdGlvbkVtYWlsO1xuZnVuY3Rpb24gZ2V0RGF0YUFuZEluaXQoKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImdldHRpbmcgYWNjb3VudCBkYXRhXCIpO1xuICAgICAgICAgICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT09IFwibG9hZGluZ1wiKSB7XG4gICAgICAgICAgICAgICAgTG9hZGluZ1BhZ2UudXBkYXRlQmFyKDkwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIExvYWRpbmdQYWdlLnVwZGF0ZUJhcig0NSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBMb2FkaW5nUGFnZS51cGRhdGVUZXh0KFwiRG93bmxvYWRpbmcgdXNlciBkYXRhLi4uXCIpO1xuICAgICAgICAgICAgeWllbGQgTG9hZGluZ1BhZ2Uuc2hvd0JhcigpO1xuICAgICAgICAgICAgeWllbGQgREIuaW5pdFNuYXBzaG90KCk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gZXJyb3I7XG4gICAgICAgICAgICBBY2NvdW50QnV0dG9uLmxvYWRpbmcoZmFsc2UpO1xuICAgICAgICAgICAgaWYgKGUucmVzcG9uc2VDb2RlID09PSA0MjkpIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkRvaW5nIHNvIHdpbGwgc2F2ZSB5b3UgYmFuZHdpZHRoLCBtYWtlIHRoZSBuZXh0IHRlc3QgYmUgcmVhZHkgZmFzdGVyIGFuZCB3aWxsIG5vdCBzaWduIHlvdSBvdXQgKHdoaWNoIGNvdWxkIG1lYW4geW91ciBuZXcgcGVyc29uYWwgYmVzdCB3b3VsZCBub3Qgc2F2ZSB0byB5b3VyIGFjY291bnQpLlwiLCAwLCAwKTtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIllvdSB3aWxsIHJ1biBpbnRvIHRoaXMgZXJyb3IgaWYgeW91IHJlZnJlc2ggdGhlIHdlYnNpdGUgdG8gcmVzdGFydCB0aGUgdGVzdC4gSXQgaXMgTk9UIHJlY29tbWVuZGVkIHRvIGRvIHRoYXQuIEluc3RlYWQsIHVzZSB0YWIgKyBlbnRlciBvciBqdXN0IHRhYiAod2l0aCBxdWljayB0YWIgbW9kZSBlbmFibGVkKSB0byByZXN0YXJ0IHRoZSB0ZXN0LlwiLCAwLCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IG1zZyA9IGUubWVzc2FnZSB8fCBlO1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gZ2V0IHVzZXIgZGF0YTogXCIgKyBtc2csIC0xKTtcbiAgICAgICAgICAgICQoXCIjdG9wICNtZW51IC5hY2NvdW50XCIpLmNzcyhcIm9wYWNpdHlcIiwgMSk7XG4gICAgICAgICAgICBpZiAoQWN0aXZlUGFnZS5nZXQoKSA9PT0gXCJsb2FkaW5nXCIpXG4gICAgICAgICAgICAgICAgUGFnZUNvbnRyb2xsZXIuY2hhbmdlKFwiXCIpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09IFwibG9hZGluZ1wiKSB7XG4gICAgICAgICAgICBMb2FkaW5nUGFnZS51cGRhdGVCYXIoMTAwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIExvYWRpbmdQYWdlLnVwZGF0ZUJhcig0NSk7XG4gICAgICAgIH1cbiAgICAgICAgTG9hZGluZ1BhZ2UudXBkYXRlVGV4dChcIkFwcGx5aW5nIHNldHRpbmdzLi4uXCIpO1xuICAgICAgICBjb25zdCBzbmFwc2hvdCA9IERCLmdldFNuYXBzaG90KCk7XG4gICAgICAgICQoXCIjbWVudSAuaWNvbi1idXR0b24uYWNjb3VudCAudGV4dFwiKS50ZXh0KHNuYXBzaG90Lm5hbWUpO1xuICAgICAgICBSZXN1bHRGaWx0ZXJzLmxvYWRUYWdzKHNuYXBzaG90LnRhZ3MpO1xuICAgICAgICBQcm9taXNlLmFsbChbTWlzYy5nZXRMYW5ndWFnZUxpc3QoKSwgTWlzYy5nZXRGdW5ib3hMaXN0KCldKS50aGVuKCh2YWx1ZXMpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IFtsYW5ndWFnZXMsIGZ1bmJveGVzXSA9IHZhbHVlcztcbiAgICAgICAgICAgIGxhbmd1YWdlcy5mb3JFYWNoKChsYW5ndWFnZSkgPT4ge1xuICAgICAgICAgICAgICAgIFJlc3VsdEZpbHRlcnMuZGVmYXVsdFJlc3VsdEZpbHRlcnMubGFuZ3VhZ2VbbGFuZ3VhZ2VdID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZnVuYm94ZXMuZm9yRWFjaCgoZnVuYm94KSA9PiB7XG4gICAgICAgICAgICAgICAgUmVzdWx0RmlsdGVycy5kZWZhdWx0UmVzdWx0RmlsdGVycy5mdW5ib3hbZnVuYm94Lm5hbWVdID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gZmlsdGVycyA9IGRlZmF1bHRSZXN1bHRGaWx0ZXJzO1xuICAgICAgICAgICAgUmVzdWx0RmlsdGVycy5sb2FkKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIXNuYXBzaG90Lm5hbWUpIHtcbiAgICAgICAgICAgIC8vdmVyaWZ5IHVzZXJuYW1lXG4gICAgICAgICAgICAvL2ludmFsaWQsIGdldCBuZXdcbiAgICAgICAgICAgIGxldCBuYW1lR29vZCA9IGZhbHNlO1xuICAgICAgICAgICAgbGV0IG5hbWUgPSBcIlwiO1xuICAgICAgICAgICAgd2hpbGUgKCFuYW1lR29vZCkge1xuICAgICAgICAgICAgICAgIG5hbWUgPVxuICAgICAgICAgICAgICAgICAgICAoX2EgPSBwcm9tcHQoXCJQbGVhc2UgcHJvdmlkZSBhIG5ldyB1c2VybmFtZSAoY2Fubm90IGJlIGxvbmdlciB0aGFuIDE2IGNoYXJhY3RlcnMsIGNhbiBvbmx5IGNvbnRhaW4gbGV0dGVycywgbnVtYmVycywgdW5kZXJzY29yZXMsIGRvdHMgYW5kIGRhc2hlcyk6XCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIlwiO1xuICAgICAgICAgICAgICAgIGlmICghbmFtZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy51cGRhdGVOYW1lKG5hbWUpO1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byB1cGRhdGUgbmFtZTogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbmFtZUdvb2QgPSB0cnVlO1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiTmFtZSB1cGRhdGVkXCIsIDEpO1xuICAgICAgICAgICAgICAgIHNuYXBzaG90Lm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgICAgIERCLnNldFNuYXBzaG90KHNuYXBzaG90KTtcbiAgICAgICAgICAgICAgICAkKFwiI21lbnUgLmljb24tYnV0dG9uLmFjY291bnQgLnRleHRcIikudGV4dChuYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIVVwZGF0ZUNvbmZpZy5jaGFuZ2VkQmVmb3JlRGIpIHtcbiAgICAgICAgICAgIC8vY29uZmlnIGRpZG50IGNoYW5nZSBiZWZvcmUgZGIgbG9hZGVkXG4gICAgICAgICAgICBpZiAoVXBkYXRlQ29uZmlnLmxvY2FsU3RvcmFnZUNvbmZpZyA9PT0gbnVsbCAmJiBzbmFwc2hvdC5jb25maWcpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIm5vIGxvY2FsIGNvbmZpZywgYXBwbHlpbmcgZGJcIik7XG4gICAgICAgICAgICAgICAgQWNjb3VudEJ1dHRvbi5sb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuYXBwbHkoc25hcHNob3QuY29uZmlnKTtcbiAgICAgICAgICAgICAgICBTZXR0aW5ncy51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2F2ZUZ1bGxDb25maWdUb0xvY2FsU3RvcmFnZSh0cnVlKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydChmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChzbmFwc2hvdC5jb25maWcgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIC8vbG9hZGluZyBkYiBjb25maWcsIGtlZXAgZm9yIG5vd1xuICAgICAgICAgICAgICAgIGxldCBjb25maWdzRGlmZmVyZW50ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoY29uZmlnXzEuZGVmYXVsdCkuZm9yRWFjaCgoa2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qga2V5ID0ga2U7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdzRGlmZmVyZW50KVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSAhPT0gXCJyZXN1bHRGaWx0ZXJzXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWdfMS5kZWZhdWx0W2tleV0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHRba2V5XS5mb3JFYWNoKChhcnJ2YWwsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhcnJheVZhbHVlID0gKChfYSA9IHNuYXBzaG90ID09PSBudWxsIHx8IHNuYXBzaG90ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzbmFwc2hvdC5jb25maWcpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVtrZXldKVtpbmRleF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJydmFsICE9IGFycmF5VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWdzRGlmZmVyZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgLmNvbmZpZyBpcyBkaWZmZXJlbnQ6ICR7YXJydmFsfSAhPSAke2FycmF5VmFsdWV9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHRba2V5XSAhPSAoKF9hID0gc25hcHNob3QgPT09IG51bGwgfHwgc25hcHNob3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNuYXBzaG90LmNvbmZpZykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hW2tleV0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWdzRGlmZmVyZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAuLmNvbmZpZyBpcyBkaWZmZXJlbnQgJHtrZXl9OiAke2NvbmZpZ18xLmRlZmF1bHRba2V5XX0gIT0gJHsoX2IgPSBzbmFwc2hvdCA9PT0gbnVsbCB8fCBzbmFwc2hvdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogc25hcHNob3QuY29uZmlnKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Jba2V5XX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWdzRGlmZmVyZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAuLi5jb25maWcgaXMgZGlmZmVyZW50YCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnc0RpZmZlcmVudCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvbmZpZ3MgYXJlIGRpZmZlcmVudCwgYXBwbHlpbmcgY29uZmlnIGZyb20gZGJcIik7XG4gICAgICAgICAgICAgICAgICAgIEFjY291bnRCdXR0b24ubG9hZGluZyhmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5hcHBseShzbmFwc2hvdC5jb25maWcpO1xuICAgICAgICAgICAgICAgICAgICBTZXR0aW5ncy51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNhdmVGdWxsQ29uZmlnVG9Mb2NhbFN0b3JhZ2UodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09IFwidGVzdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydChmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgREIuc2F2ZUNvbmZpZyhjb25maWdfMS5kZWZhdWx0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RGJDb25maWdMb2FkZWQodHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvbmZpZyBjaGFuZ2VkIGJlZm9yZSBkYlwiKTtcbiAgICAgICAgICAgIEFjY291bnRCdXR0b24ubG9hZGluZyhmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucGFjZUNhcmV0ID09PSBcInBiXCIgfHwgY29uZmlnXzEuZGVmYXVsdC5wYWNlQ2FyZXQgPT09IFwiYXZlcmFnZVwiKSB7XG4gICAgICAgICAgICBpZiAoIVRlc3RBY3RpdmUuZ2V0KCkpIHtcbiAgICAgICAgICAgICAgICBQYWNlQ2FyZXQuaW5pdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIEFjY291bnRCdXR0b24ubG9hZGluZyhmYWxzZSk7XG4gICAgICAgIFJlc3VsdEZpbHRlcnMudXBkYXRlVGFncygpO1xuICAgICAgICBDb21tYW5kbGluZUxpc3RzLnVwZGF0ZVRhZ0NvbW1hbmRzKCk7XG4gICAgICAgIFRhZ0NvbnRyb2xsZXIubG9hZEFjdGl2ZUZyb21Mb2NhbFN0b3JhZ2UoKTtcbiAgICAgICAgUmVzdWx0VGFnc1BvcHVwLnVwZGF0ZUJ1dHRvbnMoKTtcbiAgICAgICAgU2V0dGluZ3Muc2hvd0FjY291bnRTZWN0aW9uKCk7XG4gICAgICAgIFBhZ2VUcmFuc2l0aW9uLnNldChmYWxzZSk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiYWNjb3VudCBsb2FkaW5nIGZpbmlzaGVkXCIpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0RGF0YUFuZEluaXQgPSBnZXREYXRhQW5kSW5pdDtcbmZ1bmN0aW9uIGxvYWRVc2VyKHVzZXIpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAvLyBVc2VyIGlzIHNpZ25lZCBpbi5cbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuY29udGVudCBwLmFjY291bnRWZXJpZmljYXRpbk5vdGljZVwiKS5yZW1vdmUoKTtcbiAgICAgICAgaWYgKHVzZXIuZW1haWxWZXJpZmllZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmNvbnRlbnRcIikucHJlcGVuZChgPHAgY2xhc3M9XCJhY2NvdW50VmVyaWZpY2F0aW5Ob3RpY2VcIiBzdHlsZT1cInRleHQtYWxpZ246Y2VudGVyXCI+WW91ciBhY2NvdW50IGlzIG5vdCB2ZXJpZmllZC4gPGEgY2xhc3M9XCJzZW5kVmVyaWZpY2F0aW9uRW1haWxcIj5TZW5kIHRoZSB2ZXJpZmljYXRpb24gZW1haWwgYWdhaW48L2E+LmApO1xuICAgICAgICB9XG4gICAgICAgIFBhZ2VUcmFuc2l0aW9uLnNldChmYWxzZSk7XG4gICAgICAgIEFjY291bnRCdXR0b24udXBkYXRlKCk7XG4gICAgICAgIEFjY291bnRCdXR0b24ubG9hZGluZyh0cnVlKTtcbiAgICAgICAgaWYgKCh5aWVsZCBnZXREYXRhQW5kSW5pdCgpKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHNpZ25PdXQoKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB2YXIgZGlzcGxheU5hbWUgPSB1c2VyLmRpc3BsYXlOYW1lO1xuICAgICAgICAvLyB2YXIgZW1haWwgPSB1c2VyLmVtYWlsO1xuICAgICAgICAvLyB2YXIgZW1haWxWZXJpZmllZCA9IHVzZXIuZW1haWxWZXJpZmllZDtcbiAgICAgICAgLy8gdmFyIHBob3RvVVJMID0gdXNlci5waG90b1VSTDtcbiAgICAgICAgLy8gdmFyIGlzQW5vbnltb3VzID0gdXNlci5pc0Fub255bW91cztcbiAgICAgICAgLy8gdmFyIHVpZCA9IHVzZXIudWlkO1xuICAgICAgICAvLyB2YXIgcHJvdmlkZXJEYXRhID0gdXNlci5wcm92aWRlckRhdGE7XG4gICAgICAgICQoXCIucGFnZUxvZ2luIC5wcmVsb2FkZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIC8vIHNob3dGYXZvdXJpdGVUaGVtZXNBdFRoZVRvcCgpO1xuICAgICAgICBsZXQgdGV4dCA9IFwiQWNjb3VudCBjcmVhdGVkIG9uIFwiICsgdXNlci5tZXRhZGF0YS5jcmVhdGlvblRpbWU7XG4gICAgICAgIGNvbnN0IGNyZWF0aW9uRGF0ZSA9IG5ldyBEYXRlKHVzZXIubWV0YWRhdGEuY3JlYXRpb25UaW1lKTtcbiAgICAgICAgY29uc3QgZGlmZkRheXMgPSAoMCwgZGlmZmVyZW5jZUluRGF5c18xLmRlZmF1bHQpKG5ldyBEYXRlKCksIGNyZWF0aW9uRGF0ZSk7XG4gICAgICAgIHRleHQgKz0gYCAoJHtkaWZmRGF5c30gZGF5JHtkaWZmRGF5cyAhPSAxID8gXCJzXCIgOiBcIlwifSBhZ28pYDtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuZ3JvdXAuY3JlYXRlZERhdGVcIikudGV4dCh0ZXh0KTtcbiAgICAgICAgaWYgKFZlcmlmaWNhdGlvbkNvbnRyb2xsZXIuZGF0YSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgVmVyaWZpY2F0aW9uQ29udHJvbGxlci52ZXJpZnkodXNlci51aWQpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5jb25zdCBhdXRoTGlzdGVuZXIgPSBmaXJlYmFzZV8xLkF1dGgub25BdXRoU3RhdGVDaGFuZ2VkKGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgLy8gYXdhaXQgVXBkYXRlQ29uZmlnLmxvYWRQcm9taXNlO1xuICAgICAgICBjb25zb2xlLmxvZyhgYXV0aCBzdGF0ZSBjaGFuZ2VkLCB1c2VyICR7dXNlciA/IHRydWUgOiBmYWxzZX1gKTtcbiAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICAgIHlpZWxkIGxvYWRVc2VyKHVzZXIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PSBcIi9hY2NvdW50XCIpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUoXCJcIiwgXCJcIiwgXCIvbG9naW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBQYWdlVHJhbnNpdGlvbi5zZXQoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09IFwiL2xvZ2luXCIpIHtcbiAgICAgICAgICAgICAgICBQYWdlQ29udHJvbGxlci5jaGFuZ2UoXCJhY2NvdW50XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lICE9IFwiL2FjY291bnRcIikge1xuICAgICAgICAgICAgICAgIFBhZ2VDb250cm9sbGVyLmNoYW5nZSgpO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBGb2N1cy5zZXQoZmFsc2UpO1xuICAgICAgICAgICAgICAgIH0sIDEyNSAvIDIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgQWNjb3VudC51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICAvLyBTaWduT3V0QnV0dG9uLnNob3coKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIFBhZ2VDb250cm9sbGVyLmNoYW5nZSgpO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgRm9jdXMuc2V0KGZhbHNlKTtcbiAgICAgICAgICAgIH0sIDEyNSAvIDIpO1xuICAgICAgICB9XG4gICAgICAgIFVSTEhhbmRsZXIubG9hZEN1c3RvbVRoZW1lRnJvbVVybCgpO1xuICAgICAgICBpZiAoL2NoYWxsZW5nZV8uKy9nLnRlc3Qod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lKSkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDaGFsbGVuZ2UgbGlua3MgdGVtcG9yYXJpbHkgZGlzYWJsZWQuIFBsZWFzZSB1c2UgdGhlIGNvbW1hbmQgbGluZSB0byBsb2FkIHRoZSBjaGFsbGVuZ2UgbWFudWFsbHlcIiwgMCwgNyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAvLyBOb3RpZmljYXRpb25zLmFkZChcIkxvYWRpbmcgY2hhbGxlbmdlXCIsIDApO1xuICAgICAgICAgICAgLy8gbGV0IGNoYWxsZW5nZU5hbWUgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuc3BsaXQoXCJfXCIpWzFdO1xuICAgICAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAvLyAgIENoYWxsZW5nZUNvbnRyb2xsZXIuc2V0dXAoY2hhbGxlbmdlTmFtZSk7XG4gICAgICAgICAgICAvLyB9LCAxMDAwKTtcbiAgICAgICAgfVxuICAgICAgICBQU0Euc2hvdygpO1xuICAgIH0pO1xufSk7XG5mdW5jdGlvbiBzaWduSW4oKSB7XG4gICAgVXBkYXRlQ29uZmlnLnNldENoYW5nZWRCZWZvcmVEYihmYWxzZSk7XG4gICAgYXV0aExpc3RlbmVyKCk7XG4gICAgJChcIi5wYWdlTG9naW4gLnByZWxvYWRlclwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAkKFwiLnBhZ2VMb2dpbiAuYnV0dG9uXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgY29uc3QgZW1haWwgPSAkKFwiLnBhZ2VMb2dpbiAubG9naW4gaW5wdXRcIilbMF0udmFsdWU7XG4gICAgY29uc3QgcGFzc3dvcmQgPSAkKFwiLnBhZ2VMb2dpbiAubG9naW4gaW5wdXRcIilbMV0udmFsdWU7XG4gICAgY29uc3QgcGVyc2lzdGVuY2UgPSAkKFwiLnBhZ2VMb2dpbiAubG9naW4gI3JlbWVtYmVyTWUgaW5wdXRcIikucHJvcChcImNoZWNrZWRcIilcbiAgICAgICAgPyBhdXRoXzEuYnJvd3NlckxvY2FsUGVyc2lzdGVuY2VcbiAgICAgICAgOiBhdXRoXzEuYnJvd3NlclNlc3Npb25QZXJzaXN0ZW5jZTtcbiAgICAoMCwgYXV0aF8xLnNldFBlcnNpc3RlbmNlKShmaXJlYmFzZV8xLkF1dGgsIHBlcnNpc3RlbmNlKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICgwLCBhdXRoXzEuc2lnbkluV2l0aEVtYWlsQW5kUGFzc3dvcmQpKGZpcmViYXNlXzEuQXV0aCwgZW1haWwsIHBhc3N3b3JkKVxuICAgICAgICAgICAgLnRoZW4oKGUpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHlpZWxkIGxvYWRVc2VyKGUudXNlcik7XG4gICAgICAgICAgICBQYWdlQ29udHJvbGxlci5jaGFuZ2UoXCJhY2NvdW50XCIpO1xuICAgICAgICAgICAgaWYgKFRlc3RMb2dpYy5ub3RTaWduZWRJbkxhc3RSZXN1bHQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMuc2V0Tm90U2lnbmVkSW5VaWQoZS51c2VyLnVpZCk7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnJlc3VsdHMuc2F2ZShUZXN0TG9naWMubm90U2lnbmVkSW5MYXN0UmVzdWx0KTtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHNhdmUgbGFzdCByZXN1bHQ6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBUZXN0TG9naWMuY2xlYXJOb3RTaWduZWRJblJlc3VsdCgpO1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiTGFzdCB0ZXN0IHJlc3VsdCBzYXZlZFwiLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vVE9ETzogcmVkaXJlY3QgdXNlciB0byByZWxldmFudCBwYWdlXG4gICAgICAgIH0pKVxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlO1xuICAgICAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09IFwiYXV0aC93cm9uZy1wYXNzd29yZFwiKSB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZSA9IFwiSW5jb3JyZWN0IHBhc3N3b3JkLlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZXJyb3IuY29kZSA9PT0gXCJhdXRoL3VzZXItbm90LWZvdW5kXCIpIHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlID0gXCJVc2VyIG5vdCBmb3VuZC5cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKG1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgICQoXCIucGFnZUxvZ2luIC5wcmVsb2FkZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VMb2dpbiAuYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZXhwb3J0cy5zaWduSW4gPSBzaWduSW47XG5mdW5jdGlvbiBzaWduSW5XaXRoR29vZ2xlKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldENoYW5nZWRCZWZvcmVEYihmYWxzZSk7XG4gICAgICAgICQoXCIucGFnZUxvZ2luIC5wcmVsb2FkZXJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIucGFnZUxvZ2luIC5idXR0b25cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgYXV0aExpc3RlbmVyKCk7XG4gICAgICAgIGxldCBzaWduZWRJblVzZXI7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBwZXJzaXN0ZW5jZSA9ICQoXCIucGFnZUxvZ2luIC5sb2dpbiAjcmVtZW1iZXJNZSBpbnB1dFwiKS5wcm9wKFwiY2hlY2tlZFwiKVxuICAgICAgICAgICAgICAgID8gYXV0aF8xLmJyb3dzZXJMb2NhbFBlcnNpc3RlbmNlXG4gICAgICAgICAgICAgICAgOiBhdXRoXzEuYnJvd3NlclNlc3Npb25QZXJzaXN0ZW5jZTtcbiAgICAgICAgICAgIHlpZWxkICgwLCBhdXRoXzEuc2V0UGVyc2lzdGVuY2UpKGZpcmViYXNlXzEuQXV0aCwgcGVyc2lzdGVuY2UpO1xuICAgICAgICAgICAgc2lnbmVkSW5Vc2VyID0geWllbGQgKDAsIGF1dGhfMS5zaWduSW5XaXRoUG9wdXApKGZpcmViYXNlXzEuQXV0aCwgZXhwb3J0cy5nbWFpbFByb3ZpZGVyKTtcbiAgICAgICAgICAgIGlmICgoX2EgPSAoMCwgYXV0aF8xLmdldEFkZGl0aW9uYWxVc2VySW5mbykoc2lnbmVkSW5Vc2VyKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlzTmV3VXNlcikge1xuICAgICAgICAgICAgICAgIC8vYXNrIGZvciB1c2VybmFtZVxuICAgICAgICAgICAgICAgIGxldCBuYW1lR29vZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGxldCBuYW1lID0gXCJcIjtcbiAgICAgICAgICAgICAgICB3aGlsZSAoIW5hbWVHb29kKSB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWUgPVxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvbXB0KFwiUGxlYXNlIHByb3ZpZGUgYSBuZXcgdXNlcm5hbWUgKGNhbm5vdCBiZSBsb25nZXIgdGhhbiAxNiBjaGFyYWN0ZXJzLCBjYW4gb25seSBjb250YWluIGxldHRlcnMsIG51bWJlcnMsIHVuZGVyc2NvcmVzLCBkb3RzIGFuZCBkYXNoZXMpOlwiKSB8fCBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25PdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCIucGFnZUxvZ2luIC5wcmVsb2FkZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmdldE5hbWVBdmFpbGFiaWxpdHkobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGNoZWNrIG5hbWU6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG5hbWVHb29kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy9jcmVhdGUgZGF0YWJhc2Ugb2JqZWN0IGZvciB0aGUgbmV3IHVzZXJcbiAgICAgICAgICAgICAgICAvLyB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5jcmVhdGUobmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IHJlc3BvbnNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgLy8gICBsZXQgbXNnID0gZT8ucmVzcG9uc2U/LmRhdGE/Lm1lc3NhZ2UgPz8gZS5tZXNzYWdlO1xuICAgICAgICAgICAgICAgIC8vICAgTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gY3JlYXRlIGFjY291bnQ6IFwiICsgbXNnLCAtMSk7XG4gICAgICAgICAgICAgICAgLy8gICByZXR1cm47XG4gICAgICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICB5aWVsZCAoMCwgYXV0aF8xLnVwZGF0ZVByb2ZpbGUpKHNpZ25lZEluVXNlci51c2VyLCB7IGRpc3BsYXlOYW1lOiBuYW1lIH0pO1xuICAgICAgICAgICAgICAgICAgICB5aWVsZCAoMCwgYXV0aF8xLnNlbmRFbWFpbFZlcmlmaWNhdGlvbikoc2lnbmVkSW5Vc2VyLnVzZXIpO1xuICAgICAgICAgICAgICAgICAgICBBbGxUaW1lU3RhdHMuY2xlYXIoKTtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJBY2NvdW50IGNyZWF0ZWRcIiwgMSwgMyk7XG4gICAgICAgICAgICAgICAgICAgICQoXCIjbWVudSAuaWNvbi1idXR0b24uYWNjb3VudCAudGV4dFwiKS50ZXh0KG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiLnBhZ2VMb2dpbiAuYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICQoXCIucGFnZUxvZ2luIC5wcmVsb2FkZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgICAgIHlpZWxkIGxvYWRVc2VyKHNpZ25lZEluVXNlci51c2VyKTtcbiAgICAgICAgICAgICAgICAgICAgUGFnZUNvbnRyb2xsZXIuY2hhbmdlKFwiYWNjb3VudFwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFRlc3RMb2dpYy5ub3RTaWduZWRJbkxhc3RSZXN1bHQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5zZXROb3RTaWduZWRJblVpZChzaWduZWRJblVzZXIudXNlci51aWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0c1NhdmVSZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucmVzdWx0cy5zYXZlKFRlc3RMb2dpYy5ub3RTaWduZWRJbkxhc3RSZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdHNTYXZlUmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBUZXN0TG9naWMubm90U2lnbmVkSW5MYXN0UmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIERCLnNhdmVMb2NhbFJlc3VsdChyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIERCLnVwZGF0ZUxvY2FsU3RhdHMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lOiByZXN1bHQudGVzdER1cmF0aW9uICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5pbmNvbXBsZXRlVGVzdFNlY29uZHMgLVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmFma0R1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydGVkOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgeWllbGQgbG9hZFVzZXIoc2lnbmVkSW5Vc2VyLnVzZXIpO1xuICAgICAgICAgICAgICAgIFBhZ2VDb250cm9sbGVyLmNoYW5nZShcImFjY291bnRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IE1pc2MuY3JlYXRlRXJyb3JNZXNzYWdlKGUsIFwiRmFpbGVkIHRvIHNpZ24gaW4gd2l0aCBHb29nbGVcIik7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChtZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICAkKFwiLnBhZ2VMb2dpbiAucHJlbG9hZGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlTG9naW4gLmJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgaWYgKHNpZ25lZEluVXNlciAmJiAoKF9iID0gKDAsIGF1dGhfMS5nZXRBZGRpdGlvbmFsVXNlckluZm8pKHNpZ25lZEluVXNlcikpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5pc05ld1VzZXIpKSB7XG4gICAgICAgICAgICAgICAgeWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5kZWxldGUoKTtcbiAgICAgICAgICAgICAgICB5aWVsZCBzaWduZWRJblVzZXIudXNlci5kZWxldGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNpZ25PdXQoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5zaWduSW5XaXRoR29vZ2xlID0gc2lnbkluV2l0aEdvb2dsZTtcbmZ1bmN0aW9uIGFkZEdvb2dsZUF1dGgoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgTG9hZGVyLnNob3coKTtcbiAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciA9PT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgKDAsIGF1dGhfMS5saW5rV2l0aFBvcHVwKShmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIsIGV4cG9ydHMuZ21haWxQcm92aWRlcilcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkdvb2dsZSBhdXRoZW50aWNhdGlvbiBhZGRlZFwiLCAxKTtcbiAgICAgICAgICAgIFNldHRpbmdzLnVwZGF0ZUF1dGhTZWN0aW9ucygpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGFkZCBHb29nbGUgYXV0aGVuaWNhdGlvbjogXCIgKyBlcnJvci5tZXNzYWdlLCAtMSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZXhwb3J0cy5hZGRHb29nbGVBdXRoID0gYWRkR29vZ2xlQXV0aDtcbmZ1bmN0aW9uIHJlbW92ZUdvb2dsZUF1dGgoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgdXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICAgICAgaWYgKHVzZXIgPT09IG51bGwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmICh1c2VyLnByb3ZpZGVyRGF0YS5maW5kKChwcm92aWRlcikgPT4gcHJvdmlkZXIucHJvdmlkZXJJZCA9PT0gXCJwYXNzd29yZFwiKSkge1xuICAgICAgICAgICAgTG9hZGVyLnNob3coKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgeWllbGQgKDAsIGF1dGhfMS5yZWF1dGhlbnRpY2F0ZVdpdGhQb3B1cCkodXNlciwgZXhwb3J0cy5nbWFpbFByb3ZpZGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gTWlzYy5jcmVhdGVFcnJvck1lc3NhZ2UoZSwgXCJGYWlsZWQgdG8gcmVhdXRoZW50aWNhdGVcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKG1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICgwLCBhdXRoXzEudW5saW5rKSh1c2VyLCBcImdvb2dsZS5jb21cIilcbiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJHb29nbGUgYXV0aGVudGljYXRpb24gcmVtb3ZlZFwiLCAxKTtcbiAgICAgICAgICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICAgICAgICAgIFNldHRpbmdzLnVwZGF0ZUF1dGhTZWN0aW9ucygpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byByZW1vdmUgR29vZ2xlIGF1dGhlbnRpY2F0aW9uOiBcIiArIGVycm9yLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJQYXNzd29yZCBhdXRoZW50aWNhdGlvbiBuZWVkcyB0byBiZSBlbmFibGVkIHRvIHJlbW92ZSBHb29nbGUgYXV0aGVudGljYXRpb25cIiwgLTEpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLnJlbW92ZUdvb2dsZUF1dGggPSByZW1vdmVHb29nbGVBdXRoO1xuZnVuY3Rpb24gYWRkUGFzc3dvcmRBdXRoKGVtYWlsLCBwYXNzd29yZCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgICAgIGlmICh1c2VyID09PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAodXNlci5wcm92aWRlckRhdGEuZmluZCgocHJvdmlkZXIpID0+IHByb3ZpZGVyLnByb3ZpZGVySWQgPT09IFwiZ29vZ2xlLmNvbVwiKSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB5aWVsZCAoMCwgYXV0aF8xLnJlYXV0aGVudGljYXRlV2l0aFBvcHVwKSh1c2VyLCBleHBvcnRzLmdtYWlsUHJvdmlkZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBNaXNjLmNyZWF0ZUVycm9yTWVzc2FnZShlLCBcIkZhaWxlZCB0byByZWF1dGhlbnRpY2F0ZVwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQobWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNyZWRlbnRpYWwgPSBhdXRoXzEuRW1haWxBdXRoUHJvdmlkZXIuY3JlZGVudGlhbChlbWFpbCwgcGFzc3dvcmQpO1xuICAgICAgICAoMCwgYXV0aF8xLmxpbmtXaXRoQ3JlZGVudGlhbCkodXNlciwgY3JlZGVudGlhbClcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlBhc3N3b3JkIGF1dGhlbmljYXRpb24gYWRkZWRcIiwgMSk7XG4gICAgICAgICAgICBTZXR0aW5ncy51cGRhdGVBdXRoU2VjdGlvbnMoKTtcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBhZGQgcGFzc3dvcmQgYXV0aGVuaWNhdGlvbjogXCIgKyBlcnJvci5tZXNzYWdlLCAtMSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZXhwb3J0cy5hZGRQYXNzd29yZEF1dGggPSBhZGRQYXNzd29yZEF1dGg7XG5mdW5jdGlvbiBzaWduT3V0KCkge1xuICAgIGZpcmViYXNlXzEuQXV0aC5zaWduT3V0KClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlNpZ25lZCBvdXRcIiwgMCwgMik7XG4gICAgICAgIEFsbFRpbWVTdGF0cy5jbGVhcigpO1xuICAgICAgICBTZXR0aW5ncy5oaWRlQWNjb3VudFNlY3Rpb24oKTtcbiAgICAgICAgQWNjb3VudEJ1dHRvbi51cGRhdGUoKTtcbiAgICAgICAgUGFnZUNvbnRyb2xsZXIuY2hhbmdlKFwibG9naW5cIik7XG4gICAgICAgIERCLnNldFNuYXBzaG90KGRlZmF1bHRfc25hcHNob3RfMS5kZWZhdWx0U25hcCk7XG4gICAgICAgICQoXCIucGFnZUxvZ2luIC5idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICB9KVxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGVycm9yLm1lc3NhZ2UsIC0xKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc2lnbk91dCA9IHNpZ25PdXQ7XG5mdW5jdGlvbiBzaWduVXAoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgJChcIi5wYWdlTG9naW4gLmJ1dHRvblwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAkKFwiLnBhZ2VMb2dpbiAucHJlbG9hZGVyXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICBjb25zdCBubmFtZSA9ICQoXCIucGFnZUxvZ2luIC5yZWdpc3RlciBpbnB1dFwiKVswXS52YWx1ZTtcbiAgICAgICAgY29uc3QgZW1haWwgPSAkKFwiLnBhZ2VMb2dpbiAucmVnaXN0ZXIgaW5wdXRcIilbMV0udmFsdWU7XG4gICAgICAgIGNvbnN0IGVtYWlsVmVyaWZ5ID0gJChcIi5wYWdlTG9naW4gLnJlZ2lzdGVyIGlucHV0XCIpWzJdXG4gICAgICAgICAgICAudmFsdWU7XG4gICAgICAgIGNvbnN0IHBhc3N3b3JkID0gJChcIi5wYWdlTG9naW4gLnJlZ2lzdGVyIGlucHV0XCIpWzNdXG4gICAgICAgICAgICAudmFsdWU7XG4gICAgICAgIGNvbnN0IHBhc3N3b3JkVmVyaWZ5ID0gJChcIi5wYWdlTG9naW4gLnJlZ2lzdGVyIGlucHV0XCIpWzRdLnZhbHVlO1xuICAgICAgICBpZiAoZW1haWwgIT09IGVtYWlsVmVyaWZ5KSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVtYWlscyBkbyBub3QgbWF0Y2hcIiwgMCwgMyk7XG4gICAgICAgICAgICAkKFwiLnBhZ2VMb2dpbiAucHJlbG9hZGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlTG9naW4gLmJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXNzd29yZCAhPT0gcGFzc3dvcmRWZXJpZnkpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUGFzc3dvcmRzIGRvIG5vdCBtYXRjaFwiLCAwLCAzKTtcbiAgICAgICAgICAgICQoXCIucGFnZUxvZ2luIC5wcmVsb2FkZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VMb2dpbiAuYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmdldE5hbWVBdmFpbGFiaWxpdHkobm5hbWUpO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgICQoXCIucGFnZUxvZ2luIC5wcmVsb2FkZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VMb2dpbiAuYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgYXV0aExpc3RlbmVyKCk7XG4gICAgICAgIGxldCBjcmVhdGVkQXV0aFVzZXI7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjcmVhdGVkQXV0aFVzZXIgPSB5aWVsZCAoMCwgYXV0aF8xLmNyZWF0ZVVzZXJXaXRoRW1haWxBbmRQYXNzd29yZCkoZmlyZWJhc2VfMS5BdXRoLCBlbWFpbCwgcGFzc3dvcmQpO1xuICAgICAgICAgICAgY29uc3Qgc2lnbkluUmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmNyZWF0ZShubmFtZSwgZW1haWwsIGNyZWF0ZWRBdXRoVXNlci51c2VyLnVpZCk7XG4gICAgICAgICAgICBpZiAoc2lnbkluUmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBzaWduSW5SZXNwb25zZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHlpZWxkICgwLCBhdXRoXzEudXBkYXRlUHJvZmlsZSkoY3JlYXRlZEF1dGhVc2VyLnVzZXIsIHsgZGlzcGxheU5hbWU6IG5uYW1lIH0pO1xuICAgICAgICAgICAgeWllbGQgKDAsIGF1dGhfMS5zZW5kRW1haWxWZXJpZmljYXRpb24pKGNyZWF0ZWRBdXRoVXNlci51c2VyKTtcbiAgICAgICAgICAgIEFsbFRpbWVTdGF0cy5jbGVhcigpO1xuICAgICAgICAgICAgJChcIiNtZW51IC5pY29uLWJ1dHRvbi5hY2NvdW50IC50ZXh0XCIpLnRleHQobm5hbWUpO1xuICAgICAgICAgICAgJChcIi5wYWdlTG9naW4gLmJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlTG9naW4gLnByZWxvYWRlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIHlpZWxkIGxvYWRVc2VyKGNyZWF0ZWRBdXRoVXNlci51c2VyKTtcbiAgICAgICAgICAgIGlmIChUZXN0TG9naWMubm90U2lnbmVkSW5MYXN0UmVzdWx0ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnNldE5vdFNpZ25lZEluVWlkKGNyZWF0ZWRBdXRoVXNlci51c2VyLnVpZCk7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnJlc3VsdHMuc2F2ZShUZXN0TG9naWMubm90U2lnbmVkSW5MYXN0UmVzdWx0KTtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gVGVzdExvZ2ljLm5vdFNpZ25lZEluTGFzdFJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgREIuc2F2ZUxvY2FsUmVzdWx0KHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIERCLnVwZGF0ZUxvY2FsU3RhdHMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogcmVzdWx0LnRlc3REdXJhdGlvbiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmluY29tcGxldGVUZXN0U2Vjb25kcyAtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmFma0R1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRlZDogMSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgUGFnZUNvbnRyb2xsZXIuY2hhbmdlKFwiYWNjb3VudFwiKTtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQWNjb3VudCBjcmVhdGVkXCIsIDEsIDMpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvL21ha2Ugc3VyZSB0byBkbyBjbGVhbiB1cCBoZXJlXG4gICAgICAgICAgICBpZiAoY3JlYXRlZEF1dGhVc2VyKSB7XG4gICAgICAgICAgICAgICAgeWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5kZWxldGUoKTtcbiAgICAgICAgICAgICAgICB5aWVsZCBjcmVhdGVkQXV0aFVzZXIudXNlci5kZWxldGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IE1pc2MuY3JlYXRlRXJyb3JNZXNzYWdlKGUsIFwiRmFpbGVkIHRvIGNyZWF0ZSBhY2NvdW50XCIpO1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQobWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgJChcIi5wYWdlTG9naW4gLnByZWxvYWRlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUxvZ2luIC5idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIHNpZ25PdXQoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuJChcIi5wYWdlTG9naW4gI2ZvcmdvdFBhc3N3b3JkQnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGVtYWlsRmllbGQgPSAkKFwiLnBhZ2VMb2dpbiAubG9naW4gaW5wdXRcIilbMF0udmFsdWUgfHwgXCJcIjtcbiAgICBjb25zdCBlbWFpbCA9IHByb21wdChcIkVtYWlsIGFkZHJlc3NcIiwgZW1haWxGaWVsZCk7XG4gICAgaWYgKGVtYWlsKSB7XG4gICAgICAgICgwLCBhdXRoXzEuc2VuZFBhc3N3b3JkUmVzZXRFbWFpbCkoZmlyZWJhc2VfMS5BdXRoLCBlbWFpbClcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIEVtYWlsIHNlbnQuXG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVtYWlsIHNlbnRcIiwgMSwgMik7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAvLyBBbiBlcnJvciBoYXBwZW5lZC5cbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGVycm9yLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG4kKFwiLnBhZ2VMb2dpbiAubG9naW4gaW5wdXRcIikua2V5dXAoKGUpID0+IHtcbiAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0Q2hhbmdlZEJlZm9yZURiKGZhbHNlKTtcbiAgICAgICAgc2lnbkluKCk7XG4gICAgfVxufSk7XG4kKFwiLnBhZ2VMb2dpbiAubG9naW4gLmJ1dHRvbi5zaWduSW5cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnNldENoYW5nZWRCZWZvcmVEYihmYWxzZSk7XG4gICAgc2lnbkluKCk7XG59KTtcbiQoXCIucGFnZUxvZ2luIC5sb2dpbiAuYnV0dG9uLnNpZ25JbldpdGhHb29nbGVcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnNldENoYW5nZWRCZWZvcmVEYihmYWxzZSk7XG4gICAgc2lnbkluV2l0aEdvb2dsZSgpO1xufSk7XG4vLyAkKFwiLnBhZ2VMb2dpbiAubG9naW4gLmJ1dHRvbi5zaWduSW5XaXRoR2l0SHViXCIpLm9uKFwiY2xpY2tcIiwoZSkgPT4ge1xuLy8gVXBkYXRlQ29uZmlnLnNldENoYW5nZWRCZWZvcmVEYihmYWxzZSk7XG4vLyBzaWduSW5XaXRoR2l0SHViKCk7XG4vLyB9KTtcbiQoXCIuc2lnbk91dFwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBzaWduT3V0KCk7XG59KTtcbiQoXCIucGFnZUxvZ2luIC5yZWdpc3RlciBpbnB1dFwiKS5rZXl1cCgoZSkgPT4ge1xuICAgIGlmICgkKFwiLnBhZ2VMb2dpbiAucmVnaXN0ZXIgLmJ1dHRvblwiKS5oYXNDbGFzcyhcImRpc2FibGVkXCIpKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgc2lnblVwKCk7XG4gICAgfVxufSk7XG4kKFwiLnBhZ2VMb2dpbiAucmVnaXN0ZXIgLmJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBpZiAoJChcIi5wYWdlTG9naW4gLnJlZ2lzdGVyIC5idXR0b25cIikuaGFzQ2xhc3MoXCJkaXNhYmxlZFwiKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIHNpZ25VcCgpO1xufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAjYWRkR29vZ2xlQXV0aFwiKS5vbihcImNsaWNrXCIsICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIGFkZEdvb2dsZUF1dGgoKTtcbn0pKTtcbiQoXCIucGFnZVNldHRpbmdzICNyZW1vdmVHb29nbGVBdXRoXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHJlbW92ZUdvb2dsZUF1dGgoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlQWNjb3VudCAuc2VuZFZlcmlmaWNhdGlvbkVtYWlsXCIsICgpID0+IHtcbiAgICBzZW5kVmVyaWZpY2F0aW9uRW1haWwoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMubG9nID0gdm9pZCAwO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuLi9maXJlYmFzZVwiKTtcbmNvbnN0IGFuYWx5dGljc18xID0gcmVxdWlyZShcImZpcmViYXNlL2FuYWx5dGljc1wiKTtcbmZ1bmN0aW9uIGxvZyhldmVudE5hbWUsIHBhcmFtcykge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAoMCwgYW5hbHl0aWNzXzEubG9nRXZlbnQpKGZpcmViYXNlXzEuQW5hbHl0aWNzLCBldmVudE5hbWUsIHBhcmFtcyk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQW5hbHl0aWNzIHVuYXZhaWxhYmxlXCIpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmxvZyA9IGxvZztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2V0dXAgPSBleHBvcnRzLnZlcmlmeSA9IGV4cG9ydHMuY2xlYXJBY3RpdmUgPSB2b2lkIDA7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgTWFudWFsUmVzdGFydCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9tYW51YWwtcmVzdGFydC10cmFja2VyXCIpKTtcbmNvbnN0IEN1c3RvbVRleHQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvY3VzdG9tLXRleHRcIikpO1xuY29uc3QgRnVuYm94ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2Z1bmJveFwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBUZXN0VUkgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC11aVwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmNvbnN0IFRlc3RTdGF0ZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LXN0YXRlXCIpKTtcbmxldCBjaGFsbGVuZ2VMb2FkaW5nID0gZmFsc2U7XG5mdW5jdGlvbiBjbGVhckFjdGl2ZSgpIHtcbiAgICBpZiAoVGVzdFN0YXRlLmFjdGl2ZUNoYWxsZW5nZSAmJlxuICAgICAgICAhY2hhbGxlbmdlTG9hZGluZyAmJlxuICAgICAgICAhVGVzdFVJLnRlc3RSZXN0YXJ0aW5nKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ2hhbGxlbmdlIGNsZWFyZWRcIiwgMCk7XG4gICAgICAgIFRlc3RTdGF0ZS5zZXRBY3RpdmVDaGFsbGVuZ2UobnVsbCk7XG4gICAgfVxufVxuZXhwb3J0cy5jbGVhckFjdGl2ZSA9IGNsZWFyQWN0aXZlO1xuZnVuY3Rpb24gdmVyaWZ5KHJlc3VsdCkge1xuICAgIHRyeSB7XG4gICAgICAgIGlmIChUZXN0U3RhdGUuYWN0aXZlQ2hhbGxlbmdlKSB7XG4gICAgICAgICAgICBjb25zdCBhZmsgPSAocmVzdWx0LmFma0R1cmF0aW9uIC8gcmVzdWx0LnRlc3REdXJhdGlvbikgKiAxMDA7XG4gICAgICAgICAgICBpZiAoYWZrID4gMTApIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgQ2hhbGxlbmdlIGZhaWxlZDogQUZLIHRpbWUgaXMgZ3JlYXRlciB0aGFuIDEwJWAsIDApO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFUZXN0U3RhdGUuYWN0aXZlQ2hhbGxlbmdlLnJlcXVpcmVtZW50cykge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGAke1Rlc3RTdGF0ZS5hY3RpdmVDaGFsbGVuZ2UuZGlzcGxheX0gY2hhbGxlbmdlIHBhc3NlZCFgLCAxKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gVGVzdFN0YXRlLmFjdGl2ZUNoYWxsZW5nZS5uYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbGV0IHJlcXVpcmVtZW50c01ldCA9IHRydWU7XG4gICAgICAgICAgICAgICAgY29uc3QgZmFpbFJlYXNvbnMgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHJlcXVpcmVtZW50VHlwZSBpbiBUZXN0U3RhdGUuYWN0aXZlQ2hhbGxlbmdlLnJlcXVpcmVtZW50cykge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVxdWlyZW1lbnRzTWV0ID09IGZhbHNlKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcXVpcmVtZW50VmFsdWUgPSBUZXN0U3RhdGUuYWN0aXZlQ2hhbGxlbmdlLnJlcXVpcmVtZW50c1tyZXF1aXJlbWVudFR5cGVdO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVxdWlyZW1lbnRUeXBlID09IFwid3BtXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHdwbU1vZGUgPSBPYmplY3Qua2V5cyhyZXF1aXJlbWVudFZhbHVlKVswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3cG1Nb2RlID09IFwiZXhhY3RcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLnJvdW5kKHJlc3VsdC53cG0pICE9IHJlcXVpcmVtZW50VmFsdWVbXCJleGFjdFwiXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlbWVudHNNZXQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbFJlYXNvbnMucHVzaChgV1BNIG5vdCAke3JlcXVpcmVtZW50VmFsdWVbXCJleGFjdFwiXX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh3cG1Nb2RlID09IFwibWluXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LndwbSA8IHJlcXVpcmVtZW50VmFsdWVbXCJtaW5cIl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZW1lbnRzTWV0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxSZWFzb25zLnB1c2goYFdQTSBiZWxvdyAke3JlcXVpcmVtZW50VmFsdWVbXCJtaW5cIl19YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlcXVpcmVtZW50VHlwZSA9PSBcImFjY1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhY2NNb2RlID0gT2JqZWN0LmtleXMocmVxdWlyZW1lbnRWYWx1ZSlbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWNjTW9kZSA9PSBcImV4YWN0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmFjYyAhPSByZXF1aXJlbWVudFZhbHVlW1wiZXhhY3RcIl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZW1lbnRzTWV0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxSZWFzb25zLnB1c2goYEFjY3VyYWN5IG5vdCAke3JlcXVpcmVtZW50VmFsdWVbXCJleGFjdFwiXX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChhY2NNb2RlID09IFwibWluXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmFjYyA8IHJlcXVpcmVtZW50VmFsdWVbXCJtaW5cIl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZW1lbnRzTWV0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxSZWFzb25zLnB1c2goYEFjY3VyYWN5IGJlbG93ICR7cmVxdWlyZW1lbnRWYWx1ZVtcIm1pblwiXX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVxdWlyZW1lbnRUeXBlID09IFwiYWZrXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFma01vZGUgPSBPYmplY3Qua2V5cyhyZXF1aXJlbWVudFZhbHVlKVswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhZmtNb2RlID09IFwibWF4XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5yb3VuZChhZmspID4gcmVxdWlyZW1lbnRWYWx1ZVtcIm1heFwiXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlbWVudHNNZXQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbFJlYXNvbnMucHVzaChgQUZLIHBlcmNlbnRhZ2UgYWJvdmUgJHtyZXF1aXJlbWVudFZhbHVlW1wibWF4XCJdfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXF1aXJlbWVudFR5cGUgPT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVNb2RlID0gT2JqZWN0LmtleXMocmVxdWlyZW1lbnRWYWx1ZSlbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGltZU1vZGUgPT0gXCJtaW5cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLnJvdW5kKHJlc3VsdC50ZXN0RHVyYXRpb24pIDwgcmVxdWlyZW1lbnRWYWx1ZVtcIm1pblwiXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlbWVudHNNZXQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbFJlYXNvbnMucHVzaChgVGVzdCB0aW1lIGJlbG93ICR7cmVxdWlyZW1lbnRWYWx1ZVtcIm1pblwiXX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVxdWlyZW1lbnRUeXBlID09IFwiZnVuYm94XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZ1bmJveE1vZGUgPSByZXF1aXJlbWVudFZhbHVlW1wiZXhhY3RcIl07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZnVuYm94TW9kZSAhPSByZXN1bHQuZnVuYm94KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZW1lbnRzTWV0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbFJlYXNvbnMucHVzaChgJHtmdW5ib3hNb2RlfSBmdW5ib3ggbm90IGFjdGl2ZWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlcXVpcmVtZW50VHlwZSA9PSBcInJhd1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByYXdNb2RlID0gT2JqZWN0LmtleXMocmVxdWlyZW1lbnRWYWx1ZSlbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmF3TW9kZSA9PSBcImV4YWN0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5yb3VuZChyZXN1bHQucmF3V3BtKSAhPSByZXF1aXJlbWVudFZhbHVlW1wiZXhhY3RcIl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZW1lbnRzTWV0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxSZWFzb25zLnB1c2goYFJhdyBXUE0gbm90ICR7cmVxdWlyZW1lbnRWYWx1ZVtcImV4YWN0XCJdfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXF1aXJlbWVudFR5cGUgPT0gXCJjb25cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29uTW9kZSA9IE9iamVjdC5rZXlzKHJlcXVpcmVtZW50VmFsdWUpWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbk1vZGUgPT0gXCJleGFjdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGgucm91bmQocmVzdWx0LmNvbnNpc3RlbmN5KSAhPSByZXF1aXJlbWVudFZhbHVlW1wiZXhhY3RcIl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZW1lbnRzTWV0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxSZWFzb25zLnB1c2goYENvbnNpc3RlbmN5IG5vdCAke3JlcXVpcmVtZW50VmFsdWVbXCJleGFjdFwiXX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVxdWlyZW1lbnRUeXBlID09IFwiY29uZmlnXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY29uZmlnS2V5IGluIHJlcXVpcmVtZW50VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb25maWdWYWx1ZSA9IHJlcXVpcmVtZW50VmFsdWVbY29uZmlnS2V5XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdFtjb25maWdLZXldICE9IGNvbmZpZ1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVtZW50c01ldCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsUmVhc29ucy5wdXNoKGAke2NvbmZpZ0tleX0gbm90IHNldCB0byAke2NvbmZpZ1ZhbHVlfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocmVxdWlyZW1lbnRzTWV0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChUZXN0U3RhdGUuYWN0aXZlQ2hhbGxlbmdlLmF1dG9Sb2xlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIllvdSB3aWxsIHJlY2VpdmUgYSByb2xlIHNob3J0bHkuIFBsZWFzZSBkb24ndCBwb3N0IGEgc2NyZWVuc2hvdCBpbiBjaGFsbGVuZ2Ugc3VibWlzc2lvbnMuXCIsIDEsIDUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGAke1Rlc3RTdGF0ZS5hY3RpdmVDaGFsbGVuZ2UuZGlzcGxheX0gY2hhbGxlbmdlIHBhc3NlZCFgLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRlc3RTdGF0ZS5hY3RpdmVDaGFsbGVuZ2UubmFtZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGAke1Rlc3RTdGF0ZS5hY3RpdmVDaGFsbGVuZ2UuZGlzcGxheX0gY2hhbGxlbmdlIGZhaWxlZDogJHtmYWlsUmVhc29ucy5qb2luKFwiLCBcIil9YCwgMCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGBTb21ldGhpbmcgd2VudCB3cm9uZyB3aGVuIHZlcmlmeWluZyBjaGFsbGVuZ2U6ICR7ZS5tZXNzYWdlfWAsIDApO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG5leHBvcnRzLnZlcmlmeSA9IHZlcmlmeTtcbmZ1bmN0aW9uIHNldHVwKGNoYWxsZW5nZU5hbWUpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjaGFsbGVuZ2VMb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZ1bmJveChcIm5vbmVcIik7XG4gICAgICAgIGNvbnN0IGxpc3QgPSB5aWVsZCBNaXNjLmdldENoYWxsZW5nZUxpc3QoKTtcbiAgICAgICAgY29uc3QgY2hhbGxlbmdlID0gbGlzdC5maWx0ZXIoKGMpID0+IGMubmFtZSA9PT0gY2hhbGxlbmdlTmFtZSlbMF07XG4gICAgICAgIGxldCBub3RpdGV4dDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChjaGFsbGVuZ2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ2hhbGxlbmdlIG5vdCBmb3VuZFwiLCAwKTtcbiAgICAgICAgICAgICAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAkKFwiI3RvcCAuY29uZmlnXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiLnBhZ2UucGFnZVRlc3RcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgfSwgMjUwKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY2hhbGxlbmdlLnR5cGUgPT09IFwiY3VzdG9tVGltZVwiKSB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVDb25maWcoY2hhbGxlbmdlLnBhcmFtZXRlcnNbMF0sIHRydWUpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwidGltZVwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RGlmZmljdWx0eShcIm5vcm1hbFwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBpZiAoY2hhbGxlbmdlLm5hbWUgPT09IFwiZW5nbGlzaE1hc3RlclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRMYW5ndWFnZShcImVuZ2xpc2hfMTBrXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TnVtYmVycyh0cnVlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFB1bmN0dWF0aW9uKHRydWUsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNoYWxsZW5nZS50eXBlID09PSBcImN1c3RvbVdvcmRzXCIpIHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0V29yZENvdW50KGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzBdLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcIndvcmRzXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXREaWZmaWN1bHR5KFwibm9ybWFsXCIsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY2hhbGxlbmdlLnR5cGUgPT09IFwiY3VzdG9tVGV4dFwiKSB7XG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC5zZXRUZXh0KGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzBdLnNwbGl0KFwiIFwiKSk7XG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC5zZXRJc1RpbWVSYW5kb20oZmFsc2UpO1xuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQuc2V0SXNXb3JkUmFuZG9tKGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzFdKTtcbiAgICAgICAgICAgICAgICBDdXN0b21UZXh0LnNldFdvcmQoY2hhbGxlbmdlLnBhcmFtZXRlcnNbMl0pO1xuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQuc2V0VGltZSgtMSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJjdXN0b21cIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldERpZmZpY3VsdHkoXCJub3JtYWxcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjaGFsbGVuZ2UudHlwZSA9PT0gXCJzY3JpcHRcIikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgZmV0Y2goXCIvY2hhbGxlbmdlcy9cIiArIGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzBdKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzY3JpcHRkYXRhID0geWllbGQgcmVzcG9uc2UudGV4dCgpO1xuICAgICAgICAgICAgICAgIGxldCB0ZXh0ID0gc2NyaXB0ZGF0YS50cmltKCk7XG4gICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvW1xcblxcclxcdCBdL2dtLCBcIiBcIik7XG4gICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvICsvZ20sIFwiIFwiKTtcbiAgICAgICAgICAgICAgICBDdXN0b21UZXh0LnNldFRleHQodGV4dC5zcGxpdChcIiBcIikpO1xuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQuc2V0SXNXb3JkUmFuZG9tKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcImN1c3RvbVwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RGlmZmljdWx0eShcIm5vcm1hbFwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBpZiAoY2hhbGxlbmdlLnBhcmFtZXRlcnNbMV0gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGhlbWUoY2hhbGxlbmdlLnBhcmFtZXRlcnNbMV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY2hhbGxlbmdlLnBhcmFtZXRlcnNbMl0gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBGdW5ib3guYWN0aXZhdGUoY2hhbGxlbmdlLnBhcmFtZXRlcnNbMl0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNoYWxsZW5nZS50eXBlID09PSBcImFjY3VyYWN5XCIpIHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZUNvbmZpZygwLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcInRpbWVcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldERpZmZpY3VsdHkoXCJtYXN0ZXJcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjaGFsbGVuZ2UudHlwZSA9PT0gXCJmdW5ib3hcIikge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGdW5ib3goY2hhbGxlbmdlLnBhcmFtZXRlcnNbMF0sIHRydWUpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXREaWZmaWN1bHR5KFwibm9ybWFsXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIGlmIChjaGFsbGVuZ2UucGFyYW1ldGVyc1sxXSA9PT0gXCJ3b3Jkc1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRXb3JkQ291bnQoY2hhbGxlbmdlLnBhcmFtZXRlcnNbMl0sIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjaGFsbGVuZ2UucGFyYW1ldGVyc1sxXSA9PT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVDb25maWcoY2hhbGxlbmdlLnBhcmFtZXRlcnNbMl0sIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShjaGFsbGVuZ2UucGFyYW1ldGVyc1sxXSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzNdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldERpZmZpY3VsdHkoY2hhbGxlbmdlLnBhcmFtZXRlcnNbM10sIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNoYWxsZW5nZS50eXBlID09PSBcInNwZWNpYWxcIikge1xuICAgICAgICAgICAgICAgIGlmIChjaGFsbGVuZ2UubmFtZSA9PT0gXCJzZW1pbWFrXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gc28gY2FuIHlvdSBtYWtlIGEgbGluayB0aGF0IHNldHMgdXAgMTIwcywgMTBrLCBwdW5jdCwgc3RvcCBvbiB3b3JkLCBhbmQgc2VtaW1hayBhcyB0aGUgbGF5b3V0P1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcInRpbWVcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lQ29uZmlnKDEyMCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRMYW5ndWFnZShcImVuZ2xpc2hfMTBrXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UHVuY3R1YXRpb24odHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTdG9wT25FcnJvcihcIndvcmRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRMYXlvdXQoXCJzZW1pbWFrXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTGF5b3V0KFwib3ZlcnJpZGVTeW5jXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTW9kZShcInN0YXRpY1wiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgICAgICAgICAgbm90aXRleHQgPSBjaGFsbGVuZ2UubWVzc2FnZTtcbiAgICAgICAgICAgICQoXCIjdG9wIC5jb25maWdcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2UucGFnZVRlc3RcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICBpZiAobm90aXRleHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGBDaGFsbGVuZ2UgJyR7Y2hhbGxlbmdlLmRpc3BsYXl9JyBsb2FkZWQuYCwgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkNoYWxsZW5nZSBsb2FkZWQuIFwiICsgbm90aXRleHQsIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgVGVzdFN0YXRlLnNldEFjdGl2ZUNoYWxsZW5nZShjaGFsbGVuZ2UpO1xuICAgICAgICAgICAgY2hhbGxlbmdlTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiU29tZXRoaW5nIHdlbnQgd3Jvbmc6IFwiICsgZSwgLTEpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLnNldHVwID0gc2V0dXA7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5KSA9PiB7XG4gICAgaWYgKFtcbiAgICAgICAgXCJkaWZmaWN1bHR5XCIsXG4gICAgICAgIFwibnVtYmVyc1wiLFxuICAgICAgICBcInB1bmN0dWF0aW9uXCIsXG4gICAgICAgIFwibW9kZVwiLFxuICAgICAgICBcImZ1bmJveFwiLFxuICAgICAgICBcInBhY2VDYXJldFwiLFxuICAgICAgICBcInNob3dBbGxMaW5lc1wiLFxuICAgICAgICBcInNob3dMaXZlV3BtXCIsXG4gICAgICAgIFwiaGlnaGxpZ2h0TW9kZVwiLFxuICAgICAgICBcInRpbWVcIixcbiAgICAgICAgXCJ3b3Jkc1wiLFxuICAgICAgICBcImtleW1hcE1vZGVcIixcbiAgICAgICAgXCJrZXltYXBMYXlvdXRcIixcbiAgICAgICAgXCJsYXlvdXRcIixcbiAgICBdLmluY2x1ZGVzKGV2ZW50S2V5KSkge1xuICAgICAgICBjbGVhckFjdGl2ZSgpO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51cGRhdGVBbGxDaGFydENvbG9ycyA9IGV4cG9ydHMuc2V0RGVmYXVsdEZvbnRGYW1pbHkgPSBleHBvcnRzLnVwZGF0ZUNvbG9ycyA9IGV4cG9ydHMubWluaVJlc3VsdCA9IGV4cG9ydHMuYWNjb3VudEFjdGl2aXR5ID0gZXhwb3J0cy5hY2NvdW50SGlzdG9yeSA9IGV4cG9ydHMuYWNjb3VudEhpc3RvcnlBY3RpdmVJbmRleCA9IGV4cG9ydHMucmVzdWx0ID0gdm9pZCAwO1xuY29uc3QgY2hhcnRfanNfMSA9IHJlcXVpcmUoXCJjaGFydC5qc1wiKTtcbmNvbnN0IGNoYXJ0anNfcGx1Z2luX3RyZW5kbGluZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJjaGFydGpzLXBsdWdpbi10cmVuZGxpbmVcIikpO1xuY29uc3QgY2hhcnRqc19wbHVnaW5fYW5ub3RhdGlvbl8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJjaGFydGpzLXBsdWdpbi1hbm5vdGF0aW9uXCIpKTtcbmNoYXJ0X2pzXzEuQ2hhcnQucmVnaXN0ZXIoY2hhcnRfanNfMS5CYXJDb250cm9sbGVyLCBjaGFydF9qc18xLkJhckVsZW1lbnQsIGNoYXJ0X2pzXzEuQ2F0ZWdvcnlTY2FsZSwgY2hhcnRfanNfMS5GaWxsZXIsIGNoYXJ0X2pzXzEuTGluZWFyU2NhbGUsIGNoYXJ0X2pzXzEuTGluZUNvbnRyb2xsZXIsIGNoYXJ0X2pzXzEuTGluZUVsZW1lbnQsIGNoYXJ0X2pzXzEuUG9pbnRFbGVtZW50LCBjaGFydF9qc18xLlNjYXR0ZXJDb250cm9sbGVyLCBjaGFydF9qc18xLlRpbWVTY2FsZSwgY2hhcnRfanNfMS5UaW1lU2VyaWVzU2NhbGUsIGNoYXJ0X2pzXzEuVG9vbHRpcCwgY2hhcnRqc19wbHVnaW5fdHJlbmRsaW5lXzEuZGVmYXVsdCwgY2hhcnRqc19wbHVnaW5fYW5ub3RhdGlvbl8xLmRlZmF1bHQpO1xuY2hhcnRfanNfMS5DaGFydC5kZWZhdWx0cy5hbmltYXRpb24uZHVyYXRpb24gPSAwO1xuY2hhcnRfanNfMS5DaGFydC5kZWZhdWx0cy5lbGVtZW50cy5saW5lLnRlbnNpb24gPSAwLjM7XG5jaGFydF9qc18xLkNoYXJ0LmRlZmF1bHRzLmVsZW1lbnRzLmxpbmUuZmlsbCA9IFwib3JpZ2luXCI7XG5jb25zdCBUZXN0SW5wdXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC1pbnB1dFwiKSk7XG5jb25zdCBUaGVtZUNvbG9ycyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvdGhlbWUtY29sb3JzXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmNvbnN0IGZvcm1hdF8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJkYXRlLWZucy9mb3JtYXRcIikpO1xucmVxdWlyZShcImNoYXJ0anMtYWRhcHRlci1kYXRlLWZuc1wiKTtcbmNsYXNzIENoYXJ0V2l0aFVwZGF0ZUNvbG9ycyBleHRlbmRzIGNoYXJ0X2pzXzEuQ2hhcnQge1xuICAgIGNvbnN0cnVjdG9yKGl0ZW0sIGNvbmZpZykge1xuICAgICAgICBzdXBlcihpdGVtLCBjb25maWcpO1xuICAgIH1cbiAgICB1cGRhdGVDb2xvcnMoKSB7XG4gICAgICAgIHVwZGF0ZUNvbG9ycyh0aGlzKTtcbiAgICB9XG59XG5leHBvcnRzLnJlc3VsdCA9IG5ldyBDaGFydFdpdGhVcGRhdGVDb2xvcnMoJChcIiN3cG1DaGFydFwiKSwge1xuICAgIHR5cGU6IFwibGluZVwiLFxuICAgIGRhdGE6IHtcbiAgICAgICAgbGFiZWxzOiBbXSxcbiAgICAgICAgZGF0YXNldHM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJ3cG1cIixcbiAgICAgICAgICAgICAgICBkYXRhOiBbXSxcbiAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogXCJyZ2JhKDEyNSwgMTI1LCAxMjUsIDEpXCIsXG4gICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDIsXG4gICAgICAgICAgICAgICAgeUF4aXNJRDogXCJ3cG1cIixcbiAgICAgICAgICAgICAgICBvcmRlcjogMixcbiAgICAgICAgICAgICAgICBwb2ludFJhZGl1czogMixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbGFiZWw6IFwicmF3XCIsXG4gICAgICAgICAgICAgICAgZGF0YTogW10sXG4gICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IFwicmdiYSgxMjUsIDEyNSwgMTI1LCAxKVwiLFxuICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAyLFxuICAgICAgICAgICAgICAgIHlBeGlzSUQ6IFwicmF3XCIsXG4gICAgICAgICAgICAgICAgb3JkZXI6IDMsXG4gICAgICAgICAgICAgICAgcG9pbnRSYWRpdXM6IDIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGxhYmVsOiBcImVycm9yc1wiLFxuICAgICAgICAgICAgICAgIGRhdGE6IFtdLFxuICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiBcInJnYmEoMjU1LCAxMjUsIDEyNSwgMSlcIixcbiAgICAgICAgICAgICAgICBwb2ludEJhY2tncm91bmRDb2xvcjogXCJyZ2JhKDI1NSwgMTI1LCAxMjUsIDEpXCIsXG4gICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDIsXG4gICAgICAgICAgICAgICAgb3JkZXI6IDEsXG4gICAgICAgICAgICAgICAgeUF4aXNJRDogXCJlcnJvclwiLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwic2NhdHRlclwiLFxuICAgICAgICAgICAgICAgIHBvaW50U3R5bGU6IFwiY3Jvc3NSb3RcIixcbiAgICAgICAgICAgICAgICBwb2ludFJhZGl1czogZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBjb250ZXh0LmRhdGFJbmRleDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBjb250ZXh0LmRhdGFzZXQuZGF0YVtpbmRleF07XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAodmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHZvaWQgMCA/IHZhbHVlIDogMCkgPD0gMCA/IDAgOiAzO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcG9pbnRIb3ZlclJhZGl1czogZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBjb250ZXh0LmRhdGFJbmRleDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBjb250ZXh0LmRhdGFzZXQuZGF0YVtpbmRleF07XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAodmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHZvaWQgMCA/IHZhbHVlIDogMCkgPD0gMCA/IDAgOiA1O1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgIH0sXG4gICAgb3B0aW9uczoge1xuICAgICAgICByZXNwb25zaXZlOiB0cnVlLFxuICAgICAgICBtYWludGFpbkFzcGVjdFJhdGlvOiBmYWxzZSxcbiAgICAgICAgc2NhbGVzOiB7XG4gICAgICAgICAgICB4OiB7XG4gICAgICAgICAgICAgICAgYXhpczogXCJ4XCIsXG4gICAgICAgICAgICAgICAgdGlja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwUGFkZGluZzogMjAsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIlNlY29uZHNcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHdwbToge1xuICAgICAgICAgICAgICAgIGF4aXM6IFwieVwiLFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJXb3JkcyBwZXIgTWludXRlXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBiZWdpbkF0WmVybzogdHJ1ZSxcbiAgICAgICAgICAgICAgICBtaW46IDAsXG4gICAgICAgICAgICAgICAgdGlja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwUGFkZGluZzogMjAsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBncmlkOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByYXc6IHtcbiAgICAgICAgICAgICAgICBheGlzOiBcInlcIixcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIlJhdyBXb3JkcyBwZXIgTWludXRlXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBiZWdpbkF0WmVybzogdHJ1ZSxcbiAgICAgICAgICAgICAgICBtaW46IDAsXG4gICAgICAgICAgICAgICAgdGlja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwUGFkZGluZzogMjAsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBncmlkOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgICAgICBheGlzOiBcInlcIixcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBcInJpZ2h0XCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJFcnJvcnNcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJlZ2luQXRaZXJvOiB0cnVlLFxuICAgICAgICAgICAgICAgIHRpY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgIHByZWNpc2lvbjogMCxcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwUGFkZGluZzogMjAsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBncmlkOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBwbHVnaW5zOiB7XG4gICAgICAgICAgICBhbm5vdGF0aW9uOiB7XG4gICAgICAgICAgICAgICAgYW5ub3RhdGlvbnM6IFtdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRvb2x0aXA6IHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHsgZHVyYXRpb246IDI1MCB9LFxuICAgICAgICAgICAgICAgIG1vZGU6IFwiaW5kZXhcIixcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3Q6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrczoge1xuICAgICAgICAgICAgICAgICAgICBhZnRlckxhYmVsOiBmdW5jdGlvbiAodGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIi53b3JkSW5wdXRBZnRlclwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB3b3Jkc1RvSGlnaGxpZ2h0ID0gVGVzdElucHV0LmtleXByZXNzUGVyU2Vjb25kW3BhcnNlSW50KHRpLmxhYmVsKSAtIDFdLndvcmRzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVuaXF1ZSA9IFsuLi5uZXcgU2V0KHdvcmRzVG9IaWdobGlnaHQpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmlxdWUuZm9yRWFjaCgod29yZEluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmRFbCA9ICQoJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLndvcmRzIC53b3JkXCIpW3dvcmRJbmRleF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnB1dCA9IHdvcmRFbC5hdHRyKFwiaW5wdXRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRFbC5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ3b3JkSW5wdXRBZnRlclwiPiR7aW5wdXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFx0L2csIFwiX1wiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXG4vZywgXCJfXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLzwvZywgXCImbHRcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvPi9nLCBcIiZndFwiKX08L2Rpdj5gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKF9hKSB7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIH0sXG59KTtcbmV4cG9ydHMuYWNjb3VudEhpc3RvcnkgPSBuZXcgQ2hhcnRXaXRoVXBkYXRlQ29sb3JzKCQoXCIucGFnZUFjY291bnQgI2FjY291bnRIaXN0b3J5Q2hhcnRcIiksIHtcbiAgICB0eXBlOiBcImxpbmVcIixcbiAgICBkYXRhOiB7XG4gICAgICAgIGxhYmVsczogW10sXG4gICAgICAgIGRhdGFzZXRzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgeUF4aXNJRDogXCJ3cG1cIixcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJ3cG1cIixcbiAgICAgICAgICAgICAgICBmaWxsOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBkYXRhOiBbXSxcbiAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogXCIjZjQ0MzM2XCIsXG4gICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDIsXG4gICAgICAgICAgICAgICAgdHJlbmRsaW5lTGluZWFyOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0eWxlOiBcInJnYmEoMjU1LDEwNSwxODAsIC44KVwiLFxuICAgICAgICAgICAgICAgICAgICBsaW5lU3R5bGU6IFwiZG90dGVkXCIsXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiA0LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHlBeGlzSUQ6IFwiYWNjXCIsXG4gICAgICAgICAgICAgICAgbGFiZWw6IFwiYWNjXCIsXG4gICAgICAgICAgICAgICAgZmlsbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgZGF0YTogW10sXG4gICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IFwiI2NjY2NjY1wiLFxuICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAyLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICB9LFxuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgcmVzcG9uc2l2ZTogdHJ1ZSxcbiAgICAgICAgbWFpbnRhaW5Bc3BlY3RSYXRpbzogZmFsc2UsXG4gICAgICAgIGhvdmVyOiB7XG4gICAgICAgICAgICBtb2RlOiBcIm5lYXJlc3RcIixcbiAgICAgICAgICAgIGludGVyc2VjdDogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICAgIHNjYWxlczoge1xuICAgICAgICAgICAgeDoge1xuICAgICAgICAgICAgICAgIGF4aXM6IFwieFwiLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwidGltZXNlcmllc1wiLFxuICAgICAgICAgICAgICAgIGJvdW5kczogXCJ0aWNrc1wiLFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxuICAgICAgICAgICAgICAgIG9mZnNldDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJEYXRlXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3cG06IHtcbiAgICAgICAgICAgICAgICBheGlzOiBcInlcIixcbiAgICAgICAgICAgICAgICBiZWdpbkF0WmVybzogdHJ1ZSxcbiAgICAgICAgICAgICAgICBtaW46IDAsXG4gICAgICAgICAgICAgICAgdGlja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgc3RlcFNpemU6IDEwLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIldvcmRzIHBlciBNaW51dGVcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFjYzoge1xuICAgICAgICAgICAgICAgIGF4aXM6IFwieVwiLFxuICAgICAgICAgICAgICAgIGJlZ2luQXRaZXJvOiB0cnVlLFxuICAgICAgICAgICAgICAgIG1heDogMTAwLFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IFwicmlnaHRcIixcbiAgICAgICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIkVycm9yIHJhdGUgKDEwMCAtIGFjY3VyYWN5KVwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZ3JpZDoge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgcGx1Z2luczoge1xuICAgICAgICAgICAgYW5ub3RhdGlvbjoge1xuICAgICAgICAgICAgICAgIGFubm90YXRpb25zOiBbXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0b29sdGlwOiB7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB7IGR1cmF0aW9uOiAyNTAgfSxcbiAgICAgICAgICAgICAgICAvLyBEaXNhYmxlIHRoZSBvbi1jYW52YXMgdG9vbHRpcFxuICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0OiBmYWxzZSxcbiAgICAgICAgICAgICAgICBleHRlcm5hbDogZnVuY3Rpb24gKGN0eCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWN0eClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnRvb2x0aXAub3B0aW9ucy5kaXNwbGF5Q29sb3JzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjYWxsYmFja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBiZWZvcmVMYWJlbDogZnVuY3Rpb24gKHRvb2x0aXBJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9vbHRpcEl0ZW0uZGF0YXNldEluZGV4ICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0RGF0YSA9IHRvb2x0aXBJdGVtLmRhdGFzZXQuZGF0YVt0b29sdGlwSXRlbS5kYXRhSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgZXJyb3IgcmF0ZTogJHtNaXNjLnJvdW5kVG8yKHJlc3VsdERhdGEuZXJyb3JSYXRlKX0lXFxuYWNjOiAke01pc2Mucm91bmRUbzIoMTAwIC0gcmVzdWx0RGF0YS5lcnJvclJhdGUpfSVgO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0RGF0YSA9IHRvb2x0aXBJdGVtLmRhdGFzZXQuZGF0YVt0b29sdGlwSXRlbS5kYXRhSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGxhYmVsID0gYCR7Y29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNID8gXCJjcG1cIiA6IFwid3BtXCJ9OiAke3Jlc3VsdERhdGEud3BtfWAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiXFxuXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGByYXc6ICR7cmVzdWx0RGF0YS5yYXd9YCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJcXG5cIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYGFjYzogJHtyZXN1bHREYXRhLmFjY31gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlxcblxcblwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgbW9kZTogJHtyZXN1bHREYXRhLm1vZGV9IGA7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0RGF0YS5tb2RlID09IFwidGltZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgKz0gcmVzdWx0RGF0YS5tb2RlMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlc3VsdERhdGEubW9kZSA9PSBcIndvcmRzXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCArPSByZXN1bHREYXRhLm1vZGUyO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRpZmYgPSByZXN1bHREYXRhLmRpZmZpY3VsdHk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlmZiA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWZmID0gXCJub3JtYWxcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsICs9IFwiXFxuXCIgKyBgZGlmZmljdWx0eTogJHtkaWZmfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCArPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiXFxuXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgcHVuY3R1YXRpb246ICR7cmVzdWx0RGF0YS5wdW5jdHVhdGlvbn1gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJcXG5cIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBsYW5ndWFnZTogJHtyZXN1bHREYXRhLmxhbmd1YWdlfWAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlxcblxcblwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGRhdGU6ICR7KDAsIGZvcm1hdF8xLmRlZmF1bHQpKG5ldyBEYXRlKHJlc3VsdERhdGEudGltZXN0YW1wKSwgXCJkZCBNTU0geXl5eSBISDptbVwiKX1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxhYmVsO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGFmdGVyTGFiZWw6IGZ1bmN0aW9uICh0b29sdGlwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHBvcnRzLmFjY291bnRIaXN0b3J5QWN0aXZlSW5kZXggPSB0b29sdGlwLmRhdGFJbmRleDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIH0sXG59KTtcbmV4cG9ydHMuYWNjb3VudEFjdGl2aXR5ID0gbmV3IENoYXJ0V2l0aFVwZGF0ZUNvbG9ycygkKFwiLnBhZ2VBY2NvdW50ICNhY2NvdW50QWN0aXZpdHlDaGFydFwiKSwge1xuICAgIHR5cGU6IFwiYmFyXCIsXG4gICAgZGF0YToge1xuICAgICAgICBsYWJlbHM6IFtdLFxuICAgICAgICBkYXRhc2V0czogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHlBeGlzSUQ6IFwiY291bnRcIixcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJTZWNvbmRzXCIsXG4gICAgICAgICAgICAgICAgZGF0YTogW10sXG4gICAgICAgICAgICAgICAgdHJlbmRsaW5lTGluZWFyOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0eWxlOiBcInJnYmEoMjU1LDEwNSwxODAsIC44KVwiLFxuICAgICAgICAgICAgICAgICAgICBsaW5lU3R5bGU6IFwiZG90dGVkXCIsXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb3JkZXI6IDMsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHlBeGlzSUQ6IFwiYXZnV3BtXCIsXG4gICAgICAgICAgICAgICAgbGFiZWw6IFwiQXZlcmFnZSBXcG1cIixcbiAgICAgICAgICAgICAgICBkYXRhOiBbXSxcbiAgICAgICAgICAgICAgICB0eXBlOiBcImxpbmVcIixcbiAgICAgICAgICAgICAgICBvcmRlcjogMixcbiAgICAgICAgICAgICAgICB0ZW5zaW9uOiAwLFxuICAgICAgICAgICAgICAgIGZpbGw6IGZhbHNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICB9LFxuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgcmVzcG9uc2l2ZTogdHJ1ZSxcbiAgICAgICAgbWFpbnRhaW5Bc3BlY3RSYXRpbzogZmFsc2UsXG4gICAgICAgIGhvdmVyOiB7XG4gICAgICAgICAgICBtb2RlOiBcIm5lYXJlc3RcIixcbiAgICAgICAgICAgIGludGVyc2VjdDogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICAgIHNjYWxlczoge1xuICAgICAgICAgICAgeDoge1xuICAgICAgICAgICAgICAgIGF4aXM6IFwieFwiLFxuICAgICAgICAgICAgICAgIHRpY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcFBhZGRpbmc6IDIwLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdHlwZTogXCJ0aW1lXCIsXG4gICAgICAgICAgICAgICAgdGltZToge1xuICAgICAgICAgICAgICAgICAgICB1bml0OiBcImRheVwiLFxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5Rm9ybWF0czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF5OiBcImQgTU1NXCIsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBib3VuZHM6IFwidGlja3NcIixcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIkRhdGVcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9mZnNldDogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb3VudDoge1xuICAgICAgICAgICAgICAgIGF4aXM6IFwieVwiLFxuICAgICAgICAgICAgICAgIGJlZ2luQXRaZXJvOiB0cnVlLFxuICAgICAgICAgICAgICAgIG1pbjogMCxcbiAgICAgICAgICAgICAgICB0aWNrczoge1xuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXBQYWRkaW5nOiAyMCxcbiAgICAgICAgICAgICAgICAgICAgc3RlcFNpemU6IDEwLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIlRpbWUgVHlwaW5nXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhdmdXcG06IHtcbiAgICAgICAgICAgICAgICBheGlzOiBcInlcIixcbiAgICAgICAgICAgICAgICBiZWdpbkF0WmVybzogdHJ1ZSxcbiAgICAgICAgICAgICAgICBtaW46IDAsXG4gICAgICAgICAgICAgICAgdGlja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwUGFkZGluZzogMjAsXG4gICAgICAgICAgICAgICAgICAgIHN0ZXBTaXplOiAxMCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IFwicmlnaHRcIixcbiAgICAgICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIkF2ZXJhZ2UgV3BtXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBncmlkOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBwbHVnaW5zOiB7XG4gICAgICAgICAgICBhbm5vdGF0aW9uOiB7XG4gICAgICAgICAgICAgICAgYW5ub3RhdGlvbnM6IFtdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRvb2x0aXA6IHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHsgZHVyYXRpb246IDI1MCB9LFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrczoge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogZnVuY3Rpb24gKHRvb2x0aXBJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHREYXRhID0gdG9vbHRpcEl0ZW1bMF0uZGF0YXNldC5kYXRhW3Rvb2x0aXBJdGVtWzBdLmRhdGFJbmRleF07XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKDAsIGZvcm1hdF8xLmRlZmF1bHQpKG5ldyBEYXRlKHJlc3VsdERhdGEueCksIFwiZGQgTU1NIHl5eXlcIik7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGJlZm9yZUxhYmVsOiBmdW5jdGlvbiAodG9vbHRpcEl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdERhdGEgPSB0b29sdGlwSXRlbS5kYXRhc2V0LmRhdGFbdG9vbHRpcEl0ZW0uZGF0YUluZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodG9vbHRpcEl0ZW0uZGF0YXNldEluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYFRpbWUgVHlwaW5nOiAke01pc2Muc2Vjb25kc1RvU3RyaW5nKE1hdGgucm91bmQocmVzdWx0RGF0YS55KSwgdHJ1ZSwgdHJ1ZSl9XFxuVGVzdHMgQ29tcGxldGVkOiAke3Jlc3VsdERhdGEuYW1vdW50fWA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYEF2ZXJhZ2UgJHtjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0gPyBcIkNwbVwiIDogXCJXcG1cIn06ICR7TWlzYy5yb3VuZFRvMihyZXN1bHREYXRhLnkpfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICB9LFxufSk7XG5leHBvcnRzLm1pbmlSZXN1bHQgPSBuZXcgQ2hhcnRXaXRoVXBkYXRlQ29sb3JzKCQoXCIucGFnZUFjY291bnQgI21pbmlSZXN1bHRDaGFydFwiKSwge1xuICAgIHR5cGU6IFwibGluZVwiLFxuICAgIGRhdGE6IHtcbiAgICAgICAgbGFiZWxzOiBbXSxcbiAgICAgICAgZGF0YXNldHM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJ3cG1cIixcbiAgICAgICAgICAgICAgICBkYXRhOiBbXSxcbiAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogXCJyZ2JhKDEyNSwgMTI1LCAxMjUsIDEpXCIsXG4gICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDIsXG4gICAgICAgICAgICAgICAgeUF4aXNJRDogXCJ3cG1cIixcbiAgICAgICAgICAgICAgICBvcmRlcjogMixcbiAgICAgICAgICAgICAgICBwb2ludFJhZGl1czogMixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbGFiZWw6IFwicmF3XCIsXG4gICAgICAgICAgICAgICAgZGF0YTogW10sXG4gICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IFwicmdiYSgxMjUsIDEyNSwgMTI1LCAxKVwiLFxuICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAyLFxuICAgICAgICAgICAgICAgIHlBeGlzSUQ6IFwicmF3XCIsXG4gICAgICAgICAgICAgICAgb3JkZXI6IDMsXG4gICAgICAgICAgICAgICAgcG9pbnRSYWRpdXM6IDIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGxhYmVsOiBcImVycm9yc1wiLFxuICAgICAgICAgICAgICAgIGRhdGE6IFtdLFxuICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiBcInJnYmEoMjU1LCAxMjUsIDEyNSwgMSlcIixcbiAgICAgICAgICAgICAgICBwb2ludEJhY2tncm91bmRDb2xvcjogXCJyZ2JhKDI1NSwgMTI1LCAxMjUsIDEpXCIsXG4gICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDIsXG4gICAgICAgICAgICAgICAgb3JkZXI6IDEsXG4gICAgICAgICAgICAgICAgeUF4aXNJRDogXCJlcnJvclwiLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwic2NhdHRlclwiLFxuICAgICAgICAgICAgICAgIHBvaW50U3R5bGU6IFwiY3Jvc3NSb3RcIixcbiAgICAgICAgICAgICAgICBwb2ludFJhZGl1czogZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBjb250ZXh0LmRhdGFJbmRleDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBjb250ZXh0LmRhdGFzZXQuZGF0YVtpbmRleF07XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAodmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHZvaWQgMCA/IHZhbHVlIDogMCkgPD0gMCA/IDAgOiAzO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcG9pbnRIb3ZlclJhZGl1czogZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBjb250ZXh0LmRhdGFJbmRleDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBjb250ZXh0LmRhdGFzZXQuZGF0YVtpbmRleF07XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAodmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHZvaWQgMCA/IHZhbHVlIDogMCkgPD0gMCA/IDAgOiA1O1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgIH0sXG4gICAgb3B0aW9uczoge1xuICAgICAgICByZXNwb25zaXZlOiB0cnVlLFxuICAgICAgICBtYWludGFpbkFzcGVjdFJhdGlvOiBmYWxzZSxcbiAgICAgICAgc2NhbGVzOiB7XG4gICAgICAgICAgICB4OiB7XG4gICAgICAgICAgICAgICAgYXhpczogXCJ4XCIsXG4gICAgICAgICAgICAgICAgdGlja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwUGFkZGluZzogMjAsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIlNlY29uZHNcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHdwbToge1xuICAgICAgICAgICAgICAgIGF4aXM6IFwieVwiLFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJXb3JkcyBwZXIgTWludXRlXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBiZWdpbkF0WmVybzogdHJ1ZSxcbiAgICAgICAgICAgICAgICBtaW46IDAsXG4gICAgICAgICAgICAgICAgdGlja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwUGFkZGluZzogMjAsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBncmlkOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByYXc6IHtcbiAgICAgICAgICAgICAgICBheGlzOiBcInlcIixcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIlJhdyBXb3JkcyBwZXIgTWludXRlXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBiZWdpbkF0WmVybzogdHJ1ZSxcbiAgICAgICAgICAgICAgICBtaW46IDAsXG4gICAgICAgICAgICAgICAgdGlja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwUGFkZGluZzogMjAsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBncmlkOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBcInJpZ2h0XCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJFcnJvcnNcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJlZ2luQXRaZXJvOiB0cnVlLFxuICAgICAgICAgICAgICAgIHRpY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgIHByZWNpc2lvbjogMCxcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwUGFkZGluZzogMjAsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBncmlkOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBwbHVnaW5zOiB7XG4gICAgICAgICAgICBhbm5vdGF0aW9uOiB7XG4gICAgICAgICAgICAgICAgYW5ub3RhdGlvbnM6IFtdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRvb2x0aXA6IHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHsgZHVyYXRpb246IDI1MCB9LFxuICAgICAgICAgICAgICAgIG1vZGU6IFwiaW5kZXhcIixcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3Q6IGZhbHNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICB9LFxufSk7XG5mdW5jdGlvbiB1cGRhdGVBY2N1cmFjeSgpIHtcbiAgICBleHBvcnRzLmFjY291bnRIaXN0b3J5LmRhdGEuZGF0YXNldHNbMV0uaGlkZGVuID0gIWNvbmZpZ18xLmRlZmF1bHQuY2hhcnRBY2N1cmFjeTtcbiAgICBleHBvcnRzLmFjY291bnRIaXN0b3J5Lm9wdGlvbnMuc2NhbGVzW1wiYWNjXCJdLmRpc3BsYXkgPVxuICAgICAgICBjb25maWdfMS5kZWZhdWx0LmNoYXJ0QWNjdXJhY3k7XG4gICAgZXhwb3J0cy5hY2NvdW50SGlzdG9yeS51cGRhdGUoKTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZVN0eWxlKCkge1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmNoYXJ0U3R5bGUgPT0gXCJzY2F0dGVyXCIpIHtcbiAgICAgICAgZXhwb3J0cy5hY2NvdW50SGlzdG9yeS5kYXRhLmRhdGFzZXRzWzBdLnNob3dMaW5lID0gZmFsc2U7XG4gICAgICAgIGV4cG9ydHMuYWNjb3VudEhpc3RvcnkuZGF0YS5kYXRhc2V0c1sxXS5zaG93TGluZSA9IGZhbHNlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZXhwb3J0cy5hY2NvdW50SGlzdG9yeS5kYXRhLmRhdGFzZXRzWzBdLnNob3dMaW5lID0gdHJ1ZTtcbiAgICAgICAgZXhwb3J0cy5hY2NvdW50SGlzdG9yeS5kYXRhLmRhdGFzZXRzWzFdLnNob3dMaW5lID0gdHJ1ZTtcbiAgICB9XG4gICAgZXhwb3J0cy5hY2NvdW50SGlzdG9yeS51cGRhdGVDb2xvcnMoKTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZUNvbG9ycyhjaGFydCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IGJnY29sb3IgPSB5aWVsZCBUaGVtZUNvbG9ycy5nZXQoXCJiZ1wiKTtcbiAgICAgICAgY29uc3Qgc3ViY29sb3IgPSB5aWVsZCBUaGVtZUNvbG9ycy5nZXQoXCJzdWJcIik7XG4gICAgICAgIGNvbnN0IG1haW5jb2xvciA9IHlpZWxkIFRoZW1lQ29sb3JzLmdldChcIm1haW5cIik7XG4gICAgICAgIGNvbnN0IGVycm9yY29sb3IgPSB5aWVsZCBUaGVtZUNvbG9ycy5nZXQoXCJlcnJvclwiKTtcbiAgICAgICAgaWYgKGNoYXJ0LmRhdGEuZGF0YXNldHMuZXZlcnkoKGRhdGFzZXQpID0+IGRhdGFzZXQuZGF0YS5sZW5ndGggPT09IDApKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY2hhcnQuZGF0YS5kYXRhc2V0c1swXS5ib3JkZXJDb2xvciA9IG1haW5jb2xvcjtcbiAgICAgICAgY2hhcnQuZGF0YS5kYXRhc2V0c1sxXS5ib3JkZXJDb2xvciA9IHN1YmNvbG9yO1xuICAgICAgICBpZiAoY2hhcnQuZGF0YS5kYXRhc2V0c1syXSkge1xuICAgICAgICAgICAgY2hhcnQuZGF0YS5kYXRhc2V0c1syXS5ib3JkZXJDb2xvciA9IGVycm9yY29sb3I7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoYXJ0LmRhdGEuZGF0YXNldHNbMF0udHlwZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZiAoY2hhcnQuY29uZmlnLnR5cGUgPT09IFwibGluZVwiKSB7XG4gICAgICAgICAgICAgICAgY2hhcnQuZGF0YS5kYXRhc2V0c1swXS5wb2ludEJhY2tncm91bmRDb2xvciA9IG1haW5jb2xvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNoYXJ0LmNvbmZpZy50eXBlID09PSBcImJhclwiKSB7XG4gICAgICAgICAgICAgICAgY2hhcnQuZGF0YS5kYXRhc2V0c1swXS5iYWNrZ3JvdW5kQ29sb3IgPSBtYWluY29sb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY2hhcnQuZGF0YS5kYXRhc2V0c1swXS50eXBlID09PSBcImJhclwiKSB7XG4gICAgICAgICAgICBjaGFydC5kYXRhLmRhdGFzZXRzWzBdLmJhY2tncm91bmRDb2xvciA9IG1haW5jb2xvcjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjaGFydC5kYXRhLmRhdGFzZXRzWzBdLnR5cGUgPT09IFwibGluZVwiKSB7XG4gICAgICAgICAgICBjaGFydC5kYXRhLmRhdGFzZXRzWzBdLnBvaW50QmFja2dyb3VuZENvbG9yID0gbWFpbmNvbG9yO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGFydC5kYXRhLmRhdGFzZXRzWzFdLnR5cGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYgKGNoYXJ0LmNvbmZpZy50eXBlID09PSBcImxpbmVcIikge1xuICAgICAgICAgICAgICAgIGNoYXJ0LmRhdGEuZGF0YXNldHNbMV0ucG9pbnRCYWNrZ3JvdW5kQ29sb3IgPSBzdWJjb2xvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNoYXJ0LmNvbmZpZy50eXBlID09PSBcImJhclwiKSB7XG4gICAgICAgICAgICAgICAgY2hhcnQuZGF0YS5kYXRhc2V0c1sxXS5iYWNrZ3JvdW5kQ29sb3IgPSBzdWJjb2xvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjaGFydC5kYXRhLmRhdGFzZXRzWzFdLnR5cGUgPT09IFwiYmFyXCIpIHtcbiAgICAgICAgICAgIGNoYXJ0LmRhdGEuZGF0YXNldHNbMV0uYmFja2dyb3VuZENvbG9yID0gc3ViY29sb3I7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY2hhcnQuZGF0YS5kYXRhc2V0c1sxXS50eXBlID09PSBcImxpbmVcIikge1xuICAgICAgICAgICAgY2hhcnQuZGF0YS5kYXRhc2V0c1sxXS5wb2ludEJhY2tncm91bmRDb2xvciA9IHN1YmNvbG9yO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNoYXJ0U2NhbGVPcHRpb25zID0gY2hhcnQub3B0aW9ucztcbiAgICAgICAgT2JqZWN0LmtleXMoY2hhcnRTY2FsZU9wdGlvbnMuc2NhbGVzKS5mb3JFYWNoKChzY2FsZUlEKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBheGlzID0gY2hhcnRTY2FsZU9wdGlvbnMuc2NhbGVzW3NjYWxlSURdO1xuICAgICAgICAgICAgYXhpcy50aWNrcy5jb2xvciA9IHN1YmNvbG9yO1xuICAgICAgICAgICAgYXhpcy50aXRsZS5jb2xvciA9IHN1YmNvbG9yO1xuICAgICAgICB9KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNoYXJ0LmRhdGEuZGF0YXNldHNbMF1cbiAgICAgICAgICAgICAgICAudHJlbmRsaW5lTGluZWFyLnN0eWxlID0gc3ViY29sb3I7XG4gICAgICAgICAgICBjaGFydC5kYXRhLmRhdGFzZXRzWzFdXG4gICAgICAgICAgICAgICAgLnRyZW5kbGluZUxpbmVhci5zdHlsZSA9IHN1YmNvbG9yO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChfYSkgeyB9XG4gICAgICAgIGNoYXJ0Lm9wdGlvbnMucGx1Z2lucy5hbm5vdGF0aW9uXG4gICAgICAgICAgICAuYW5ub3RhdGlvbnMuZm9yRWFjaCgoYW5ub3RhdGlvbikgPT4ge1xuICAgICAgICAgICAgaWYgKGFubm90YXRpb24uaWQgIT09IFwiZnVuYm94LWxhYmVsXCIpIHtcbiAgICAgICAgICAgICAgICBhbm5vdGF0aW9uLmJvcmRlckNvbG9yID0gc3ViY29sb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhbm5vdGF0aW9uLmxhYmVsLmJhY2tncm91bmRDb2xvciA9IHN1YmNvbG9yO1xuICAgICAgICAgICAgYW5ub3RhdGlvbi5sYWJlbC5jb2xvciA9IGJnY29sb3I7XG4gICAgICAgIH0pO1xuICAgICAgICBjaGFydC51cGRhdGUoXCJub25lXCIpO1xuICAgIH0pO1xufVxuZXhwb3J0cy51cGRhdGVDb2xvcnMgPSB1cGRhdGVDb2xvcnM7XG5mdW5jdGlvbiBzZXREZWZhdWx0Rm9udEZhbWlseShmb250KSB7XG4gICAgY2hhcnRfanNfMS5DaGFydC5kZWZhdWx0cy5mb250LmZhbWlseSA9IGZvbnQucmVwbGFjZSgvXy9nLCBcIiBcIik7XG59XG5leHBvcnRzLnNldERlZmF1bHRGb250RmFtaWx5ID0gc2V0RGVmYXVsdEZvbnRGYW1pbHk7XG5mdW5jdGlvbiB1cGRhdGVBbGxDaGFydENvbG9ycygpIHtcbiAgICBUaGVtZUNvbG9ycy51cGRhdGUoKTtcbiAgICBleHBvcnRzLmFjY291bnRIaXN0b3J5LnVwZGF0ZUNvbG9ycygpO1xuICAgIGV4cG9ydHMucmVzdWx0LnVwZGF0ZUNvbG9ycygpO1xuICAgIGV4cG9ydHMuYWNjb3VudEFjdGl2aXR5LnVwZGF0ZUNvbG9ycygpO1xuICAgIGV4cG9ydHMubWluaVJlc3VsdC51cGRhdGVDb2xvcnMoKTtcbn1cbmV4cG9ydHMudXBkYXRlQWxsQ2hhcnRDb2xvcnMgPSB1cGRhdGVBbGxDaGFydENvbG9ycztcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXksIGV2ZW50VmFsdWUpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiY2hhcnRBY2N1cmFjeVwiKVxuICAgICAgICB1cGRhdGVBY2N1cmFjeSgpO1xuICAgIGlmIChldmVudEtleSA9PT0gXCJjaGFydFN0eWxlXCIpXG4gICAgICAgIHVwZGF0ZVN0eWxlKCk7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImZvbnRGYW1pbHlcIilcbiAgICAgICAgc2V0RGVmYXVsdEZvbnRGYW1pbHkoZXZlbnRWYWx1ZSk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IFRlc3RMb2dpYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LWxvZ2ljXCIpKTtcbmNvbnN0IFRlc3RVSSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LXVpXCIpKTtcbmNvbnN0IFRlc3RTdGF0cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LXN0YXRzXCIpKTtcbmNvbnN0IE1vbmtleSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9tb25rZXlcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgS2V5bWFwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9rZXltYXBcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBMaXZlQWNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2xpdmUtYWNjXCIpKTtcbmNvbnN0IExpdmVCdXJzdCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9saXZlLWJ1cnN0XCIpKTtcbmNvbnN0IEZ1bmJveCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9mdW5ib3hcIikpO1xuY29uc3QgU291bmQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vc291bmQtY29udHJvbGxlclwiKSk7XG5jb25zdCBDYXJldCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9jYXJldFwiKSk7XG5jb25zdCBNYW51YWxSZXN0YXJ0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L21hbnVhbC1yZXN0YXJ0LXRyYWNrZXJcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBDdXN0b21UZXh0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2N1c3RvbS10ZXh0XCIpKTtcbmNvbnN0IFBhZ2VDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3BhZ2UtY29udHJvbGxlclwiKSk7XG5jb25zdCBTZXR0aW5ncyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcGFnZXMvc2V0dGluZ3NcIikpO1xuY29uc3QgTGF5b3V0RW11bGF0b3IgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvbGF5b3V0LWVtdWxhdG9yXCIpKTtcbmNvbnN0IFBhY2VDYXJldCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9wYWNlLWNhcmV0XCIpKTtcbmNvbnN0IFRpbWVyUHJvZ3Jlc3MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGltZXItcHJvZ3Jlc3NcIikpO1xuY29uc3QgRm9jdXMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvZm9jdXNcIikpO1xuY29uc3QgU2hpZnRUcmFja2VyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3NoaWZ0LXRyYWNrZXJcIikpO1xuY29uc3QgUmVwbGF5ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3JlcGxheVwiKSk7XG5jb25zdCBNb25rZXlQb3dlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbW9ua2V5LXBvd2VyXCIpKTtcbmNvbnN0IFdlYWtTcG90ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3dlYWstc3BvdFwiKSk7XG5jb25zdCBMZWFkZXJib2FyZHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2xlYWRlcmJvYXJkc1wiKSk7XG5jb25zdCBBY3RpdmVQYWdlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvYWN0aXZlLXBhZ2VcIikpO1xuY29uc3QgVGVzdEFjdGl2ZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3Rlc3QtYWN0aXZlXCIpKTtcbmNvbnN0IFRlc3RJbnB1dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LWlucHV0XCIpKTtcbmNvbnN0IFRlc3RXb3JkcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LXdvcmRzXCIpKTtcbmNvbnN0IFdvcmRUeXBlZEV2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy93b3JkLXR5cGVkLWV2ZW50XCIpKTtcbmxldCBkb250SW5zZXJ0U3BhY2UgPSBmYWxzZTtcbmxldCBjb3JyZWN0U2hpZnRVc2VkID0gdHJ1ZTtcbmNvbnN0IHdvcmRzSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIndvcmRzSW5wdXRcIik7XG5mdW5jdGlvbiBzZXRXb3Jkc0lucHV0KHZhbHVlKSB7XG4gICAgLy8gT25seSBjaGFuZ2UgI3dvcmRzSW5wdXQgaWYgaXQncyBub3QgYWxyZWFkeSB0aGUgd2FudGVkIHZhbHVlXG4gICAgLy8gQXZvaWRzIFNhZmFyaSB0cmlnZ2VyaW5nIHVubmVlZGVkIGV2ZW50cywgY2F1c2luZyBpc3N1ZXMgd2l0aFxuICAgIC8vIGRlYWQga2V5cy5cbiAgICAvLyBjb25zb2xlLmxvZyhcInNldHRpbmdzIHdvcmRzIGlucHV0IHRvIFwiICsgdmFsdWUpO1xuICAgIGlmICh2YWx1ZSAhPT0gd29yZHNJbnB1dC52YWx1ZSkge1xuICAgICAgICB3b3Jkc0lucHV0LnZhbHVlID0gdmFsdWU7XG4gICAgfVxufVxuZnVuY3Rpb24gdXBkYXRlVUkoKSB7XG4gICAgY29uc3QgYWNjID0gTWlzYy5yb3VuZFRvMihUZXN0U3RhdHMuY2FsY3VsYXRlQWNjdXJhY3koKSk7XG4gICAgaWYgKCFpc05hTihhY2MpKVxuICAgICAgICBMaXZlQWNjLnVwZGF0ZShhY2MpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmtleW1hcE1vZGUgPT09IFwibmV4dFwiICYmIGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJ6ZW5cIikge1xuICAgICAgICBLZXltYXAuaGlnaGxpZ2h0S2V5KFRlc3RXb3Jkcy53b3Jkc1xuICAgICAgICAgICAgLmdldEN1cnJlbnQoKVxuICAgICAgICAgICAgLmNoYXJBdChUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGgpXG4gICAgICAgICAgICAudG9TdHJpbmcoKVxuICAgICAgICAgICAgLnRvVXBwZXJDYXNlKCkpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGJhY2tzcGFjZVRvUHJldmlvdXMoKSB7XG4gICAgaWYgKCFUZXN0QWN0aXZlLmdldCgpKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aCA9PSAwIHx8XG4gICAgICAgIFRlc3RVSS5jdXJyZW50V29yZEVsZW1lbnRJbmRleCA9PSAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKChUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeVtUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4IC0gMV0gPT1cbiAgICAgICAgVGVzdFdvcmRzLndvcmRzLmdldChUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4IC0gMSkgJiZcbiAgICAgICAgIWNvbmZpZ18xLmRlZmF1bHQuZnJlZWRvbU1vZGUpIHx8XG4gICAgICAgICQoJChcIi53b3JkXCIpW1Rlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXggLSAxXSkuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5jb25maWRlbmNlTW9kZSA9PT0gXCJvblwiIHx8IGNvbmZpZ18xLmRlZmF1bHQuY29uZmlkZW5jZU1vZGUgPT09IFwibWF4XCIpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCA9IFRlc3RJbnB1dC5pbnB1dC5wb3BIaXN0b3J5KCk7XG4gICAgVGVzdElucHV0LmNvcnJlY3RlZC5wb3BIaXN0b3J5KCk7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcIm5vc3BhY2VcIiB8fCBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCA9IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50LnNsaWNlKDAsIC0xKTtcbiAgICB9XG4gICAgVGVzdFdvcmRzLndvcmRzLmRlY3JlYXNlQ3VycmVudEluZGV4KCk7XG4gICAgVGVzdFVJLnNldEN1cnJlbnRXb3JkRWxlbWVudEluZGV4KFRlc3RVSS5jdXJyZW50V29yZEVsZW1lbnRJbmRleCAtIDEpO1xuICAgIFRlc3RVSS51cGRhdGVBY3RpdmVFbGVtZW50KHRydWUpO1xuICAgIEZ1bmJveC50b2dnbGVTY3JpcHQoVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKSk7XG4gICAgVGVzdFVJLnVwZGF0ZVdvcmRFbGVtZW50KCk7XG4gICAgQ2FyZXQudXBkYXRlUG9zaXRpb24oKTtcbiAgICBSZXBsYXkuYWRkUmVwbGF5RXZlbnQoXCJiYWNrV29yZFwiKTtcbn1cbmZ1bmN0aW9uIGhhbmRsZVNwYWNlKCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAoIVRlc3RBY3RpdmUuZ2V0KCkpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoVGVzdElucHV0LmlucHV0LmN1cnJlbnQgPT09IFwiXCIpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIpIHtcbiAgICAgICAgJChcIiN3b3JkcyAud29yZC5hY3RpdmVcIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICQoXCIjd29yZHNcIikuYXBwZW5kKFwiPGRpdiBjbGFzcz0nd29yZCBhY3RpdmUnPjwvZGl2PlwiKTtcbiAgICB9XG4gICAgY29uc3QgY3VycmVudFdvcmQgPSBUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJsYXlvdXRmbHVpZFwiICYmIGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgLy8gaGVyZSBJIG5lZWQgdG8gY2hlY2sgaWYgQ29uZmlnLmN1c3RvbUxheW91dEZsdWlkIGV4aXN0cyBiZWNhdXNlIG9mIG15IHNjdWZmZWQgc29sdXRpb24gb2YgcmV0dXJuaW5nIHdoZW5ldmVyIHZhbHVlIGlzIHVuZGVmaW5lZCBpbiB0aGUgc2V0Q3VzdG9tTGF5b3V0Zmx1aWQgZnVuY3Rpb25cbiAgICAgICAgY29uc3QgbGF5b3V0cyA9IGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tTGF5b3V0Zmx1aWRcbiAgICAgICAgICAgID8gY29uZmlnXzEuZGVmYXVsdC5jdXN0b21MYXlvdXRmbHVpZC5zcGxpdChcIiNcIilcbiAgICAgICAgICAgIDogW1wicXdlcnR5XCIsIFwiZHZvcmFrXCIsIFwiY29sZW1ha1wiXTtcbiAgICAgICAgbGV0IGluZGV4ID0gMDtcbiAgICAgICAgY29uc3Qgb3V0b2YgPSBUZXN0V29yZHMud29yZHMubGVuZ3RoO1xuICAgICAgICBpbmRleCA9IE1hdGguZmxvb3IoKFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aCArIDEpIC8gKG91dG9mIC8gbGF5b3V0cy5sZW5ndGgpKTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubGF5b3V0ICE9PSBsYXlvdXRzW2luZGV4XSAmJiBsYXlvdXRzW2luZGV4XSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgLS0tICEhISAke2xheW91dHNbaW5kZXhdfSAhISEgLS0tYCwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldExheW91dChsYXlvdXRzW2luZGV4XSk7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBMYXlvdXQobGF5b3V0c1tpbmRleF0pO1xuICAgICAgICBLZXltYXAuaGlnaGxpZ2h0S2V5KFRlc3RXb3Jkcy53b3Jkc1xuICAgICAgICAgICAgLmdldEN1cnJlbnQoKVxuICAgICAgICAgICAgLmNoYXJBdChUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGgpXG4gICAgICAgICAgICAudG9TdHJpbmcoKVxuICAgICAgICAgICAgLnRvVXBwZXJDYXNlKCkpO1xuICAgICAgICAoX2EgPSBTZXR0aW5ncy5ncm91cHNbXCJsYXlvdXRcIl0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS51cGRhdGVJbnB1dCgpO1xuICAgIH1cbiAgICBkb250SW5zZXJ0U3BhY2UgPSB0cnVlO1xuICAgIGNvbnN0IGJ1cnN0ID0gVGVzdFN0YXRzLmNhbGN1bGF0ZUJ1cnN0KCk7XG4gICAgTGl2ZUJ1cnN0LnVwZGF0ZShNYXRoLnJvdW5kKGJ1cnN0KSk7XG4gICAgVGVzdElucHV0LnB1c2hCdXJzdFRvSGlzdG9yeShidXJzdCk7XG4gICAgLy9jb3JyZWN0IHdvcmQgb3IgaW4gemVuIG1vZGVcbiAgICBjb25zdCBpc1dvcmRDb3JyZWN0ID0gY3VycmVudFdvcmQgPT0gVGVzdElucHV0LmlucHV0LmN1cnJlbnQgfHwgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCI7XG4gICAgLy8gVGhpcyB3aWxsIHByb2JhYmx5IGJyZWFrIGlmIGxldHRlciBtb2RlIGlzIG9uIG9yIHNvbWV0aGluZ1xuICAgIGNvbnN0ICRjdXJyZW50VGVzdFdvcmQgPSAkKGAjd29yZHMgLndvcmQuYWN0aXZlYCk7XG4gICAgV29yZFR5cGVkRXZlbnQuZGlzcGF0Y2goY3VycmVudFdvcmQsIGlzV29yZENvcnJlY3QsIGJ1cnN0LCAkY3VycmVudFRlc3RXb3JkKTtcbiAgICBNb25rZXlQb3dlci5hZGRQb3dlcihpc1dvcmRDb3JyZWN0LCB0cnVlKTtcbiAgICBUZXN0SW5wdXQuaW5jcmVtZW50QWNjdXJhY3koaXNXb3JkQ29ycmVjdCk7XG4gICAgaWYgKGlzV29yZENvcnJlY3QpIHtcbiAgICAgICAgUGFjZUNhcmV0LmhhbmRsZVNwYWNlKHRydWUsIGN1cnJlbnRXb3JkKTtcbiAgICAgICAgVGVzdElucHV0LmlucHV0LnB1c2hIaXN0b3J5KCk7XG4gICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5pbmNyZWFzZUN1cnJlbnRJbmRleCgpO1xuICAgICAgICBUZXN0VUkuc2V0Q3VycmVudFdvcmRFbGVtZW50SW5kZXgoVGVzdFVJLmN1cnJlbnRXb3JkRWxlbWVudEluZGV4ICsgMSk7XG4gICAgICAgIFRlc3RVSS51cGRhdGVBY3RpdmVFbGVtZW50KCk7XG4gICAgICAgIEZ1bmJveC50b2dnbGVTY3JpcHQoVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKSk7XG4gICAgICAgIENhcmV0LnVwZGF0ZVBvc2l0aW9uKCk7XG4gICAgICAgIFRlc3RJbnB1dC5pbmNyZW1lbnRLZXlwcmVzc0NvdW50KCk7XG4gICAgICAgIFRlc3RJbnB1dC5wdXNoS2V5cHJlc3NXb3JkKFRlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXgpO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggIT09IFwibm9zcGFjZVwiICYmIGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ICE9PSBcImFycm93c1wiKSB7XG4gICAgICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICAgICAgfVxuICAgICAgICBSZXBsYXkuYWRkUmVwbGF5RXZlbnQoXCJzdWJtaXRDb3JyZWN0V29yZFwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCAhPT0gXCJub3NwYWNlXCIgJiYgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggIT09IFwiYXJyb3dzXCIpIHtcbiAgICAgICAgICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5wbGF5U291bmRPbkVycm9yIHx8IGNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlKSB7XG4gICAgICAgICAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBTb3VuZC5wbGF5RXJyb3IoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBUZXN0SW5wdXQucHVzaE1pc3NlZFdvcmQoVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKSk7XG4gICAgICAgIFRlc3RJbnB1dC5pbmNyZW1lbnRLZXlwcmVzc0Vycm9ycygpO1xuICAgICAgICBjb25zdCBjaWwgPSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGg7XG4gICAgICAgIGlmIChjaWwgPD0gVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChjaWwgPj0gVGVzdElucHV0LmNvcnJlY3RlZC5jdXJyZW50Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQuY3VycmVudCArPSBcIl9cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQuY3VycmVudCA9XG4gICAgICAgICAgICAgICAgICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQuY3VycmVudC5zdWJzdHJpbmcoMCwgY2lsKSArXG4gICAgICAgICAgICAgICAgICAgICAgICBcIl9cIiArXG4gICAgICAgICAgICAgICAgICAgICAgICBUZXN0SW5wdXQuY29ycmVjdGVkLmN1cnJlbnQuc3Vic3RyaW5nKGNpbCArIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnN0b3BPbkVycm9yICE9IFwib2ZmXCIpIHtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHkgPT0gXCJleHBlcnRcIiB8fCBjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHkgPT0gXCJtYXN0ZXJcIikge1xuICAgICAgICAgICAgICAgIC8vZmFpbGVkIGR1ZSB0byBkaWZmIHdoZW4gcHJlc3Npbmcgc3BhY2VcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMuZmFpbChcImRpZmZpY3VsdHlcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc3RvcE9uRXJyb3IgPT0gXCJ3b3JkXCIpIHtcbiAgICAgICAgICAgICAgICBkb250SW5zZXJ0U3BhY2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBSZXBsYXkuYWRkUmVwbGF5RXZlbnQoXCJpbmNvcnJlY3RMZXR0ZXJcIiwgXCJfXCIpO1xuICAgICAgICAgICAgICAgIFRlc3RVSS51cGRhdGVXb3JkRWxlbWVudCh0cnVlKTtcbiAgICAgICAgICAgICAgICBDYXJldC51cGRhdGVQb3NpdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIFBhY2VDYXJldC5oYW5kbGVTcGFjZShmYWxzZSwgY3VycmVudFdvcmQpO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUgJiYgY29uZmlnXzEuZGVmYXVsdC5oaWdobGlnaHRNb2RlICE9PSBcIm9mZlwiKSB7XG4gICAgICAgICAgICAkKFwiI3dvcmRzIC53b3JkLmFjdGl2ZSBsZXR0ZXJcIikuYWRkQ2xhc3MoXCJjb3JyZWN0XCIpO1xuICAgICAgICB9XG4gICAgICAgIFRlc3RJbnB1dC5pbnB1dC5wdXNoSGlzdG9yeSgpO1xuICAgICAgICBUZXN0VUkuaGlnaGxpZ2h0QmFkV29yZChUZXN0VUkuY3VycmVudFdvcmRFbGVtZW50SW5kZXgsICFjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSk7XG4gICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5pbmNyZWFzZUN1cnJlbnRJbmRleCgpO1xuICAgICAgICBUZXN0VUkuc2V0Q3VycmVudFdvcmRFbGVtZW50SW5kZXgoVGVzdFVJLmN1cnJlbnRXb3JkRWxlbWVudEluZGV4ICsgMSk7XG4gICAgICAgIFRlc3RVSS51cGRhdGVBY3RpdmVFbGVtZW50KCk7XG4gICAgICAgIEZ1bmJveC50b2dnbGVTY3JpcHQoVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKSk7XG4gICAgICAgIENhcmV0LnVwZGF0ZVBvc2l0aW9uKCk7XG4gICAgICAgIFRlc3RJbnB1dC5pbmNyZW1lbnRLZXlwcmVzc0NvdW50KCk7XG4gICAgICAgIFRlc3RJbnB1dC5wdXNoS2V5cHJlc3NXb3JkKFRlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXgpO1xuICAgICAgICBUZXN0SW5wdXQudXBkYXRlTGFzdEtleXByZXNzKCk7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHkgPT0gXCJleHBlcnRcIiB8fCBjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHkgPT0gXCJtYXN0ZXJcIikge1xuICAgICAgICAgICAgVGVzdExvZ2ljLmZhaWwoXCJkaWZmaWN1bHR5XCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKFRlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXggPT0gVGVzdFdvcmRzLndvcmRzLmxlbmd0aCkge1xuICAgICAgICAgICAgLy9zdWJtaXR0ZWQgbGFzdCB3b3JkIHRoYXQgaXMgaW5jb3JyZWN0XG4gICAgICAgICAgICBUZXN0TG9naWMuZmluaXNoKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgUmVwbGF5LmFkZFJlcGxheUV2ZW50KFwic3VibWl0RXJyb3JXb3JkXCIpO1xuICAgIH1cbiAgICBsZXQgd29yZExlbmd0aDtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInplblwiKSB7XG4gICAgICAgIHdvcmRMZW5ndGggPSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGg7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB3b3JkTGVuZ3RoID0gVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKS5sZW5ndGg7XG4gICAgfVxuICAgIGNvbnN0IGZsZXggPSBNaXNjLndob3JmKGNvbmZpZ18xLmRlZmF1bHQubWluQnVyc3RDdXN0b21TcGVlZCwgd29yZExlbmd0aCk7XG4gICAgaWYgKChjb25maWdfMS5kZWZhdWx0Lm1pbkJ1cnN0ID09PSBcImZpeGVkXCIgJiYgYnVyc3QgPCBjb25maWdfMS5kZWZhdWx0Lm1pbkJ1cnN0Q3VzdG9tU3BlZWQpIHx8XG4gICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1pbkJ1cnN0ID09PSBcImZsZXhcIiAmJiBidXJzdCA8IGZsZXgpKSB7XG4gICAgICAgIFRlc3RMb2dpYy5mYWlsKFwibWluIGJ1cnN0XCIpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQucHVzaEhpc3RvcnkoKTtcbiAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuc2hvd0FsbExpbmVzIHx8XG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInRpbWVcIiB8fFxuICAgICAgICAoQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gJiYgQ3VzdG9tVGV4dC53b3JkID09IDApIHx8XG4gICAgICAgIEN1c3RvbVRleHQuaXNUaW1lUmFuZG9tKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRUb3AgPSBNYXRoLmZsb29yKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIjd29yZHMgLndvcmRcIilbVGVzdFVJLmN1cnJlbnRXb3JkRWxlbWVudEluZGV4IC0gMV0ub2Zmc2V0VG9wKTtcbiAgICAgICAgbGV0IG5leHRUb3A7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBuZXh0VG9wID0gTWF0aC5mbG9vcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiI3dvcmRzIC53b3JkXCIpW1Rlc3RVSS5jdXJyZW50V29yZEVsZW1lbnRJbmRleF0ub2Zmc2V0VG9wKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgbmV4dFRvcCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5leHRUb3AgPiBjdXJyZW50VG9wICYmICFUZXN0VUkubGluZVRyYW5zaXRpb24pIHtcbiAgICAgICAgICAgIFRlc3RVSS5saW5lSnVtcChjdXJyZW50VG9wKTtcbiAgICAgICAgfVxuICAgIH0gLy9lbmQgb2YgbGluZSB3cmFwXG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTW9kZSA9PT0gXCJyZWFjdFwiKSB7XG4gICAgICAgIEtleW1hcC5mbGFzaEtleShcIiBcIiwgdHJ1ZSk7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIiB8fFxuICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgfHxcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInF1b3RlXCIgfHxcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInplblwiKSB7XG4gICAgICAgIFRpbWVyUHJvZ3Jlc3MudXBkYXRlKCk7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ0aW1lXCIgfHxcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwid29yZHNcIiB8fFxuICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJjdXN0b21cIiB8fFxuICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJxdW90ZVwiKSB7XG4gICAgICAgIFRlc3RMb2dpYy5hZGRXb3JkKCk7XG4gICAgfVxufVxuZnVuY3Rpb24gaXNDaGFyQ29ycmVjdChjaGFyLCBjaGFySW5kZXgpIHtcbiAgICBpZiAoIWNvcnJlY3RTaGlmdFVzZWQpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNvbnN0IG9yaWdpbmFsQ2hhciA9IFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KClbY2hhckluZGV4XTtcbiAgICBpZiAob3JpZ2luYWxDaGFyID09IGNoYXIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlLnNwbGl0KFwiX1wiKVswXSA9PSBcInJ1c3NpYW5cIikge1xuICAgICAgICBpZiAoKGNoYXIgPT09IFwi0LVcIiB8fCBjaGFyID09PSBcImVcIikgJiYgb3JpZ2luYWxDaGFyID09IFwi0ZFcIikge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoYXIgPT09IFwi0ZFcIiAmJiAob3JpZ2luYWxDaGFyID09IFwi0LVcIiB8fCBvcmlnaW5hbENoYXIgPT09IFwiZVwiKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcImFycm93c1wiKSB7XG4gICAgICAgIGlmICgoY2hhciA9PT0gXCJ3XCIgfHwgY2hhciA9PT0gXCJBcnJvd1VwXCIpICYmIG9yaWdpbmFsQ2hhciA9PSBcIuKGkVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKGNoYXIgPT09IFwic1wiIHx8IGNoYXIgPT09IFwiQXJyb3dEb3duXCIpICYmIG9yaWdpbmFsQ2hhciA9PSBcIuKGk1wiKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKGNoYXIgPT09IFwiYVwiIHx8IGNoYXIgPT09IFwiQXJyb3dMZWZ0XCIpICYmIG9yaWdpbmFsQ2hhciA9PSBcIuKGkFwiKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKGNoYXIgPT09IFwiZFwiIHx8IGNoYXIgPT09IFwiQXJyb3dSaWdodFwiKSAmJiBvcmlnaW5hbENoYXIgPT0gXCLihpJcIikge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKChjaGFyID09PSBg4oCZYCB8fCBjaGFyID09PSBcIuKAmFwiIHx8IGNoYXIgPT09IFwiJ1wiKSAmJlxuICAgICAgICAob3JpZ2luYWxDaGFyID09IGDigJlgIHx8IG9yaWdpbmFsQ2hhciA9PT0gXCLigJhcIiB8fCBvcmlnaW5hbENoYXIgPT09IFwiJ1wiKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKChjaGFyID09PSBgXCJgIHx8IGNoYXIgPT09IFwi4oCdXCIgfHwgY2hhciA9PSBcIuKAnFwiIHx8IGNoYXIgPT09IFwi4oCeXCIpICYmXG4gICAgICAgIChvcmlnaW5hbENoYXIgPT0gYFwiYCB8fFxuICAgICAgICAgICAgb3JpZ2luYWxDaGFyID09PSBcIuKAnVwiIHx8XG4gICAgICAgICAgICBvcmlnaW5hbENoYXIgPT09IFwi4oCcXCIgfHxcbiAgICAgICAgICAgIG9yaWdpbmFsQ2hhciA9PT0gXCLigJ5cIikpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmICgoY2hhciA9PT0gXCLigJNcIiB8fCBjaGFyID09PSBcIuKAlFwiIHx8IGNoYXIgPT0gXCItXCIpICYmXG4gICAgICAgIChvcmlnaW5hbENoYXIgPT0gXCItXCIgfHwgb3JpZ2luYWxDaGFyID09PSBcIuKAk1wiIHx8IG9yaWdpbmFsQ2hhciA9PT0gXCLigJRcIikpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbmZ1bmN0aW9uIGhhbmRsZUNoYXIoY2hhciwgY2hhckluZGV4KSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICAgIGlmIChUZXN0VUkucmVzdWx0Q2FsY3VsYXRpbmcgfHwgVGVzdFVJLnJlc3VsdFZpc2libGUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY2hhciA9PT0gXCLigKZcIikge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDM7IGkrKykge1xuICAgICAgICAgICAgaGFuZGxlQ2hhcihcIi5cIiwgY2hhckluZGV4ICsgaSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY2hhciA9PT0gXCJcXG5cIiAmJiBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCI1ODAwOFwiKSB7XG4gICAgICAgIGNoYXIgPSBcIiBcIjtcbiAgICB9XG4gICAgaWYgKGNoYXIgIT09IFwiXFxuXCIgJiYgY2hhciAhPT0gXCJcXHRcIiAmJiAvXFxzLy50ZXN0KGNoYXIpKSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJub3NwYWNlXCIgfHwgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwiYXJyb3dzXCIpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGhhbmRsZVNwYWNlKCk7XG4gICAgICAgIC8vaW5zZXJ0IHNwYWNlIGZvciBleHBlcnQgYW5kIG1hc3RlciBvciBzdHJpY3Qgc3BhY2UsXG4gICAgICAgIC8vb3IgZm9yIHN0b3Agb24gZXJyb3Igc2V0IHRvIHdvcmQsXG4gICAgICAgIC8vb3RoZXJ3aXNlIGRvbnQgZG8gYW55dGhpbmdcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSAhPT0gXCJub3JtYWxcIiB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQuc3RyaWN0U3BhY2UgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9PSBcInplblwiKSB8fFxuICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5zdG9wT25FcnJvciA9PT0gXCJ3b3JkXCIpIHtcbiAgICAgICAgICAgIGlmIChkb250SW5zZXJ0U3BhY2UpIHtcbiAgICAgICAgICAgICAgICBkb250SW5zZXJ0U3BhY2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJ6ZW5cIiAmJlxuICAgICAgICBUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpW2NoYXJJbmRleF0gIT09IFwiXFxuXCIgJiZcbiAgICAgICAgY2hhciA9PT0gXCJcXG5cIikge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vc3RhcnQgdGhlIHRlc3RcbiAgICBpZiAoIVRlc3RBY3RpdmUuZ2V0KCkgJiYgIVRlc3RMb2dpYy5zdGFydFRlc3QoKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIEZvY3VzLnNldCh0cnVlKTtcbiAgICBDYXJldC5zdG9wQW5pbWF0aW9uKCk7XG4gICAgY29uc3QgdGhpc0NoYXJDb3JyZWN0ID0gaXNDaGFyQ29ycmVjdChjaGFyLCBjaGFySW5kZXgpO1xuICAgIGlmICh0aGlzQ2hhckNvcnJlY3QgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9PSBcInplblwiKSB7XG4gICAgICAgIGNoYXIgPSBUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpLmNoYXJBdChjaGFySW5kZXgpO1xuICAgIH1cbiAgICBpZiAoIXRoaXNDaGFyQ29ycmVjdCAmJiBjaGFyID09PSBcIlxcblwiKSB7XG4gICAgICAgIGlmIChUZXN0SW5wdXQuaW5wdXQuY3VycmVudCA9PT0gXCJcIilcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY2hhciA9IFwiIFwiO1xuICAgIH1cbiAgICBpZiAoVGVzdElucHV0LmlucHV0LmN1cnJlbnQgPT09IFwiXCIpIHtcbiAgICAgICAgVGVzdElucHV0LnNldEJ1cnN0U3RhcnQocGVyZm9ybWFuY2Uubm93KCkpO1xuICAgIH1cbiAgICBjb25zdCByZXN1bHRpbmdXb3JkID0gVGVzdElucHV0LmlucHV0LmN1cnJlbnQuc3Vic3RyaW5nKDAsIGNoYXJJbmRleCkgK1xuICAgICAgICBjaGFyICtcbiAgICAgICAgVGVzdElucHV0LmlucHV0LmN1cnJlbnQuc3Vic3RyaW5nKGNoYXJJbmRleCArIDEpO1xuICAgIGlmICghdGhpc0NoYXJDb3JyZWN0ICYmIE1pc2MudHJhaWxpbmdDb21wb3NlQ2hhcnMudGVzdChyZXN1bHRpbmdXb3JkKSkge1xuICAgICAgICBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCA9IHJlc3VsdGluZ1dvcmQ7XG4gICAgICAgIFRlc3RVSS51cGRhdGVXb3JkRWxlbWVudCgpO1xuICAgICAgICBDYXJldC51cGRhdGVQb3NpdGlvbigpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIE1vbmtleVBvd2VyLmFkZFBvd2VyKHRoaXNDaGFyQ29ycmVjdCk7XG4gICAgVGVzdElucHV0LmluY3JlbWVudEFjY3VyYWN5KHRoaXNDaGFyQ29ycmVjdCk7XG4gICAgaWYgKCF0aGlzQ2hhckNvcnJlY3QpIHtcbiAgICAgICAgVGVzdElucHV0LmluY3JlbWVudEtleXByZXNzRXJyb3JzKCk7XG4gICAgICAgIFRlc3RJbnB1dC5wdXNoTWlzc2VkV29yZChUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpKTtcbiAgICB9XG4gICAgV2Vha1Nwb3QudXBkYXRlU2NvcmUoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInplblwiID8gY2hhciA6IFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KClbY2hhckluZGV4XSwgdGhpc0NoYXJDb3JyZWN0KTtcbiAgICBpZiAodGhpc0NoYXJDb3JyZWN0KSB7XG4gICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LnBsYXlTb3VuZE9uRXJyb3IgfHwgY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUpIHtcbiAgICAgICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgU291bmQucGxheUVycm9yKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFjb3JyZWN0U2hpZnRVc2VkICYmIGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSAhPSBcIm1hc3RlclwiKVxuICAgICAgICByZXR1cm47XG4gICAgLy91cGRhdGUgY3VycmVudCBjb3JyZWN0ZWQgdmVyc2lvbi4gaWYgaXRzIGVtcHR5IHRoZW4gYWRkIHRoZSBjdXJyZW50IGNoYXIuIGlmIGl0cyBub3QgdGhlbiByZXBsYWNlIHRoZSBsYXN0IGNoYXJhY3RlciB3aXRoIHRoZSBjdXJyZW50bHkgcHJlc3NlZCBvbmUgLyBhZGQgaXRcbiAgICBpZiAoVGVzdElucHV0LmNvcnJlY3RlZC5jdXJyZW50ID09PSBcIlwiKSB7XG4gICAgICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQuY3VycmVudCArPSByZXN1bHRpbmdXb3JkO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGNoYXJJbmRleCA+PSBUZXN0SW5wdXQuY29ycmVjdGVkLmN1cnJlbnQubGVuZ3RoKSB7XG4gICAgICAgICAgICBUZXN0SW5wdXQuY29ycmVjdGVkLmN1cnJlbnQgKz0gY2hhcjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICghdGhpc0NoYXJDb3JyZWN0KSB7XG4gICAgICAgICAgICBUZXN0SW5wdXQuY29ycmVjdGVkLmN1cnJlbnQgPVxuICAgICAgICAgICAgICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQuY3VycmVudC5zdWJzdHJpbmcoMCwgY2hhckluZGV4KSArXG4gICAgICAgICAgICAgICAgICAgIGNoYXIgK1xuICAgICAgICAgICAgICAgICAgICBUZXN0SW5wdXQuY29ycmVjdGVkLmN1cnJlbnQuc3Vic3RyaW5nKGNoYXJJbmRleCArIDEpO1xuICAgICAgICB9XG4gICAgfVxuICAgIFRlc3RJbnB1dC5pbmNyZW1lbnRLZXlwcmVzc0NvdW50KCk7XG4gICAgVGVzdElucHV0LnVwZGF0ZUxhc3RLZXlwcmVzcygpO1xuICAgIFRlc3RJbnB1dC5wdXNoS2V5cHJlc3NXb3JkKFRlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXgpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHkgIT09IFwibWFzdGVyXCIgJiZcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5zdG9wT25FcnJvciA9PSBcImxldHRlclwiICYmXG4gICAgICAgICF0aGlzQ2hhckNvcnJlY3QpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBSZXBsYXkuYWRkUmVwbGF5RXZlbnQodGhpc0NoYXJDb3JyZWN0ID8gXCJjb3JyZWN0TGV0dGVyXCIgOiBcImluY29ycmVjdExldHRlclwiLCBjaGFyKTtcbiAgICAvL3VwZGF0ZSB0aGUgYWN0aXZlIHdvcmQgdG9wLCBidXQgb25seSBvbmNlXG4gICAgaWYgKFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCA9PT0gMSAmJlxuICAgICAgICBUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4ID09PSAwKSB7XG4gICAgICAgIFRlc3RVSS5zZXRBY3RpdmVXb3JkVG9wKChfYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjd29yZHMgLmFjdGl2ZVwiKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm9mZnNldFRvcCk7XG4gICAgfVxuICAgIC8vbWF4IGxlbmd0aCBvZiB0aGUgaW5wdXQgaXMgMjAgdW5sZXNzIGluIHplbiBtb2RlIHRoZW4gaXRzIDMwXG4gICAgaWYgKChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiemVuXCIgJiYgY2hhckluZGV4IDwgMzApIHx8XG4gICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT09IFwiemVuXCIgJiZcbiAgICAgICAgICAgIGNoYXJJbmRleCA8IFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KCkubGVuZ3RoICsgMjApKSB7XG4gICAgICAgIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50ID0gcmVzdWx0aW5nV29yZDtcbiAgICB9XG4gICAgaWYgKCF0aGlzQ2hhckNvcnJlY3QgJiYgY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ID09IFwibWFzdGVyXCIpIHtcbiAgICAgICAgVGVzdElucHV0LmlucHV0LnB1c2hIaXN0b3J5KCk7XG4gICAgICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQucHVzaEhpc3RvcnkoKTtcbiAgICAgICAgVGVzdExvZ2ljLmZhaWwoXCJkaWZmaWN1bHR5XCIpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIC8va2V5bWFwXG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTW9kZSA9PT0gXCJyZWFjdFwiKSB7XG4gICAgICAgIEtleW1hcC5mbGFzaEtleShjaGFyLCB0aGlzQ2hhckNvcnJlY3QpO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9IFwiemVuXCIpIHtcbiAgICAgICAgLy9ub3QgYXBwbGljYWJsZSB0byB6ZW4gbW9kZVxuICAgICAgICAvL2F1dG8gc3RvcCB0aGUgdGVzdCBpZiB0aGUgbGFzdCB3b3JkIGlzIGNvcnJlY3RcbiAgICAgICAgY29uc3QgY3VycmVudFdvcmQgPSBUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpO1xuICAgICAgICBjb25zdCBsYXN0aW5kZXggPSBUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4O1xuICAgICAgICBpZiAoKGN1cnJlbnRXb3JkID09IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50IHx8XG4gICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5xdWlja0VuZCAmJlxuICAgICAgICAgICAgICAgIGN1cnJlbnRXb3JkLmxlbmd0aCA9PSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGggJiZcbiAgICAgICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0LnN0b3BPbkVycm9yID09IFwib2ZmXCIpKSAmJlxuICAgICAgICAgICAgbGFzdGluZGV4ID09IFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICBUZXN0SW5wdXQuaW5wdXQucHVzaEhpc3RvcnkoKTtcbiAgICAgICAgICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQucHVzaEhpc3RvcnkoKTtcbiAgICAgICAgICAgIFRlc3RMb2dpYy5maW5pc2goKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBhY3RpdmVXb3JkVG9wQmVmb3JlSnVtcCA9IChfYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjd29yZHMgLndvcmQuYWN0aXZlXCIpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iub2Zmc2V0VG9wO1xuICAgIFRlc3RVSS51cGRhdGVXb3JkRWxlbWVudCgpO1xuICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5oaWRlRXh0cmFMZXR0ZXJzKSB7XG4gICAgICAgIGNvbnN0IG5ld0FjdGl2ZVRvcCA9IChfYyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjd29yZHMgLndvcmQuYWN0aXZlXCIpKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Mub2Zmc2V0VG9wO1xuICAgICAgICAvL3N0b3AgdGhlIHdvcmQganVtcCBieSBzbGljaW5nIG9mZiB0aGUgbGFzdCBjaGFyYWN0ZXIsIHVwZGF0ZSB3b3JkIGFnYWluXG4gICAgICAgIGlmIChhY3RpdmVXb3JkVG9wQmVmb3JlSnVtcCA8IG5ld0FjdGl2ZVRvcCAmJlxuICAgICAgICAgICAgIVRlc3RVSS5saW5lVHJhbnNpdGlvbiAmJlxuICAgICAgICAgICAgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFRvcCA9IE1hdGguZmxvb3IoKF9kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIiN3b3JkcyAud29yZFwiKVtUZXN0VUkuY3VycmVudFdvcmRFbGVtZW50SW5kZXggLSAxXSkgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLm9mZnNldFRvcCk7XG4gICAgICAgICAgICAgICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LnNob3dBbGxMaW5lcylcbiAgICAgICAgICAgICAgICAgICAgVGVzdFVJLmxpbmVKdW1wKGN1cnJlbnRUb3ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgVGVzdElucHV0LmlucHV0LmN1cnJlbnQgPSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5zbGljZSgwLCAtMSk7XG4gICAgICAgICAgICAgICAgVGVzdFVJLnVwZGF0ZVdvcmRFbGVtZW50KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy9zaW11bGF0ZSBzcGFjZSBwcmVzcyBpbiBub3NwYWNlIGZ1bmJveFxuICAgIGlmICgoKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcIm5vc3BhY2VcIiB8fCBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIikgJiZcbiAgICAgICAgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoID09PSBUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpLmxlbmd0aCkgfHxcbiAgICAgICAgKGNoYXIgPT09IFwiXFxuXCIgJiYgdGhpc0NoYXJDb3JyZWN0KSkge1xuICAgICAgICBoYW5kbGVTcGFjZSgpO1xuICAgIH1cbiAgICBpZiAoY2hhciAhPT0gXCJcXG5cIikge1xuICAgICAgICBDYXJldC51cGRhdGVQb3NpdGlvbigpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGhhbmRsZVRhYihldmVudCwgcG9wdXBWaXNpYmxlKSB7XG4gICAgLy90b2RvIHJlZmFjdG9yIHRoaXMgbWVzc1xuICAgIGlmIChUZXN0VUkucmVzdWx0Q2FsY3VsYXRpbmcpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgIT09IFwidGVzdFwiICYmIHBvcHVwVmlzaWJsZSkge1xuICAgICAgICAvLyBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICgkKFwiI2N1c3RvbVRleHRQb3B1cCAudGV4dGFyZWFcIikuaXMoXCI6Zm9jdXNcIikpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc3QgYXJlYSA9ICQoXCIjY3VzdG9tVGV4dFBvcHVwIC50ZXh0YXJlYVwiKVswXTtcbiAgICAgICAgY29uc3Qgc3RhcnQgPSBhcmVhLnNlbGVjdGlvblN0YXJ0O1xuICAgICAgICBjb25zdCBlbmQgPSBhcmVhLnNlbGVjdGlvbkVuZDtcbiAgICAgICAgLy8gc2V0IHRleHRhcmVhIHZhbHVlIHRvOiB0ZXh0IGJlZm9yZSBjYXJldCArIHRhYiArIHRleHQgYWZ0ZXIgY2FyZXRcbiAgICAgICAgYXJlYS52YWx1ZSA9XG4gICAgICAgICAgICBhcmVhLnZhbHVlLnN1YnN0cmluZygwLCBzdGFydCkgKyBcIlxcdFwiICsgYXJlYS52YWx1ZS5zdWJzdHJpbmcoZW5kKTtcbiAgICAgICAgLy8gcHV0IGNhcmV0IGF0IHJpZ2h0IHBvc2l0aW9uIGFnYWluXG4gICAgICAgIGFyZWEuc2VsZWN0aW9uU3RhcnQgPSBhcmVhLnNlbGVjdGlvbkVuZCA9IHN0YXJ0ICsgMTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBlbHNlIGlmICghVGVzdFVJLnJlc3VsdENhbGN1bGF0aW5nICYmXG4gICAgICAgICQoXCIjY29tbWFuZExpbmVXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpICYmXG4gICAgICAgICQoXCIjc2ltcGxlUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpICYmXG4gICAgICAgICQoXCIjcXVvdGVTdWJtaXRQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikgJiZcbiAgICAgICAgQWN0aXZlUGFnZS5nZXQoKSAhPSBcImxvZ2luXCIpIHtcbiAgICAgICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT0gXCJ0ZXN0XCIpIHtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnF1aWNrVGFiKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgICAgICAgICAgICAgTGVhZGVyYm9hcmRzLmhpZGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHBvcHVwVmlzaWJsZSkge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChUZXN0VUkucmVzdWx0VmlzaWJsZSB8fFxuICAgICAgICAgICAgICAgICAgICAhKChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIiAmJiAhZXZlbnQuc2hpZnRLZXkpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAoVGVzdFdvcmRzLmhhc1RhYiAmJiAhZXZlbnQuc2hpZnRLZXkpKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBNYW51YWxSZXN0YXJ0LnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFRlc3RBY3RpdmUuZ2V0KCkgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQucmVwZWF0UXVvdGVzID09PSBcInR5cGluZ1wiICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQodHJ1ZSwgZmFsc2UsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KGZhbHNlLCBmYWxzZSwgZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVDaGFyKFwiXFx0XCIsIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgIHNldFdvcmRzSW5wdXQoXCIgXCIgKyBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIVRlc3RVSS5yZXN1bHRWaXNpYmxlKSB7XG4gICAgICAgICAgICAgICAgaWYgKChUZXN0V29yZHMuaGFzVGFiICYmIGV2ZW50LnNoaWZ0S2V5KSB8fFxuICAgICAgICAgICAgICAgICAgICAoIVRlc3RXb3Jkcy5oYXNUYWIgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9PSBcInplblwiKSB8fFxuICAgICAgICAgICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInplblwiICYmIGV2ZW50LnNoaWZ0S2V5KSkge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiI3Jlc3RhcnRUZXN0QnV0dG9uXCIpLnRyaWdnZXIoXCJmb2N1c1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZUNoYXIoXCJcXHRcIiwgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgc2V0V29yZHNJbnB1dChcIiBcIiArIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5xdWlja1RhYikge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIFBhZ2VDb250cm9sbGVyLmNoYW5nZShcInRlc3RcIik7XG4gICAgICAgIH1cbiAgICB9XG59XG4kKGRvY3VtZW50KS5rZXlkb3duKChldmVudCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdmFyIF9hO1xuICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09IFwibG9hZGluZ1wiKVxuICAgICAgICByZXR1cm4gZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAvL2F1dG9mb2N1c1xuICAgIGNvbnN0IHdvcmRzRm9jdXNlZCA9ICQoXCIjd29yZHNJbnB1dFwiKS5pcyhcIjpmb2N1c1wiKTtcbiAgICBjb25zdCBwYWdlVGVzdEFjdGl2ZSA9IEFjdGl2ZVBhZ2UuZ2V0KCkgPT09IFwidGVzdFwiO1xuICAgIGNvbnN0IGNvbW1hbmRMaW5lVmlzaWJsZSA9ICEkKFwiI2NvbW1hbmRMaW5lV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKTtcbiAgICBjb25zdCBsZWFkZXJib2FyZHNWaXNpYmxlID0gISQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKTtcbiAgICBjb25zdCBwb3B1cHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwV3JhcHBlclwiKTtcbiAgICBsZXQgcG9wdXBWaXNpYmxlID0gZmFsc2U7XG4gICAgZm9yIChjb25zdCBwb3B1cCBvZiBwb3B1cHMpIHtcbiAgICAgICAgaWYgKCFwb3B1cC5jbGFzc0xpc3QuY29udGFpbnMoXCJoaWRkZW5cIikgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHBvcHVwVmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBhbGxvd1R5cGluZyA9IHBhZ2VUZXN0QWN0aXZlICYmXG4gICAgICAgICFjb21tYW5kTGluZVZpc2libGUgJiZcbiAgICAgICAgIWxlYWRlcmJvYXJkc1Zpc2libGUgJiZcbiAgICAgICAgIXBvcHVwVmlzaWJsZSAmJlxuICAgICAgICAhVGVzdFVJLnJlc3VsdFZpc2libGUgJiZcbiAgICAgICAgKHdvcmRzRm9jdXNlZCB8fCBldmVudC5rZXkgIT09IFwiRW50ZXJcIik7XG4gICAgaWYgKGFsbG93VHlwaW5nICYmICF3b3Jkc0ZvY3VzZWQgJiYgZXZlbnQua2V5ICE9PSBcIkVudGVyXCIpIHtcbiAgICAgICAgVGVzdFVJLmZvY3VzV29yZHMoKTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc2hvd091dE9mRm9jdXNXYXJuaW5nKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vdGFiXG4gICAgaWYgKChldmVudC5rZXkgPT0gXCJUYWJcIiAmJiAhY29uZmlnXzEuZGVmYXVsdC5zd2FwRXNjQW5kVGFiKSB8fFxuICAgICAgICAoZXZlbnQua2V5ID09IFwiRXNjYXBlXCIgJiYgY29uZmlnXzEuZGVmYXVsdC5zd2FwRXNjQW5kVGFiKSkge1xuICAgICAgICBoYW5kbGVUYWIoZXZlbnQsIHBvcHVwVmlzaWJsZSk7XG4gICAgfVxuICAgIGlmICghYWxsb3dUeXBpbmcpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoISgoX2EgPSBldmVudC5vcmlnaW5hbEV2ZW50KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaXNUcnVzdGVkKSB8fCBUZXN0VUkudGVzdFJlc3RhcnRpbmcpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoVGVzdElucHV0LnNwYWNpbmdEZWJ1Zykge1xuICAgICAgICBjb25zb2xlLmxvZyhcInNwYWNpbmcgZGVidWdcIiwgXCJrZXlwcmVzc1wiLCBldmVudC5rZXksIFwibGVuZ3RoXCIsIFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3Muc3BhY2luZy5hcnJheS5sZW5ndGgpO1xuICAgIH1cbiAgICBUZXN0SW5wdXQucmVjb3JkS2V5cHJlc3NTcGFjaW5nKCk7XG4gICAgVGVzdElucHV0LnNldEtleXByZXNzRHVyYXRpb24ocGVyZm9ybWFuY2Uubm93KCkpO1xuICAgIFRlc3RJbnB1dC5zZXRLZXlwcmVzc05vdEFmaygpO1xuICAgIC8vYmxvY2tpbmcgZmlyZWZveCBmcm9tIGdvaW5nIGJhY2sgaW4gaGlzdG9yeSB3aXRoIGJhY2tzcGFjZVxuICAgIGlmIChldmVudC5rZXkgPT09IFwiQmFja3NwYWNlXCIpIHtcbiAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgICAgIGNvbnN0IHQgPSAvSU5QVVR8U0VMRUNUfFRFWFRBUkVBL2k7XG4gICAgICAgIGlmICghdC50ZXN0KGV2ZW50LnRhcmdldC50YWdOYW1lKVxuICAgICAgICAvLyBpZiB0aGlzIGJyZWFrcyBpbiB0aGUgZnV0dXJlLCBjYWxsIG1pbyBhbmQgdGVsbCBoaW0gdG8gc3RvcCBiZWluZyBsYXp5XG4gICAgICAgIC8vIChldmVudC50YXJnZXQgYXMgdW5rbm93biBhcyBLZXlib2FyZEV2ZW50KS5kaXNhYmxlZCB8fFxuICAgICAgICAvLyAoZXZlbnQudGFyZ2V0IGFzIHVua25vd24gYXMgRWxlbWVudCkucmVhZE9ubHlcbiAgICAgICAgKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmNvbmZpZGVuY2VNb2RlID09PSBcIm1heFwiKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCAhPT0gXCJhcnJvd3NcIiAmJiAvQXJyb3cvaS50ZXN0KGV2ZW50LmtleSkpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBNb25rZXkudHlwZSgpO1xuICAgIGlmIChldmVudC5rZXkgPT09IFwiQmFja3NwYWNlXCIgJiYgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGJhY2tzcGFjZVRvUHJldmlvdXMoKTtcbiAgICAgICAgaWYgKFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50KSB7XG4gICAgICAgICAgICBzZXRXb3Jkc0lucHV0KFwiIFwiICsgVGVzdElucHV0LmlucHV0LmN1cnJlbnQgKyBcIiBcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIGlmIChldmVudC5zaGlmdEtleSAmJiBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIikge1xuICAgICAgICAgICAgVGVzdExvZ2ljLmZpbmlzaCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGV2ZW50LnNoaWZ0S2V5ICYmXG4gICAgICAgICAgICAoKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInRpbWVcIiAmJiBjb25maWdfMS5kZWZhdWx0LnRpbWUgPT09IDApIHx8XG4gICAgICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcIndvcmRzXCIgJiYgY29uZmlnXzEuZGVmYXVsdC53b3JkcyA9PT0gMCkpKSB7XG4gICAgICAgICAgICBUZXN0SW5wdXQuc2V0QmFpbG91dCh0cnVlKTtcbiAgICAgICAgICAgIFRlc3RMb2dpYy5maW5pc2goKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGhhbmRsZUNoYXIoXCJcXG5cIiwgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoKTtcbiAgICAgICAgICAgIHNldFdvcmRzSW5wdXQoXCIgXCIgKyBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy9zaG93IGRlYWQga2V5c1xuICAgIGlmIChldmVudC5rZXkgPT09IFwiRGVhZFwiICYmXG4gICAgICAgICFNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzLnRlc3QoVGVzdElucHV0LmlucHV0LmN1cnJlbnQpKSB7XG4gICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgICAgICBjb25zdCB3b3JkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN3b3JkcyAud29yZC5hY3RpdmVcIik7XG4gICAgICAgIGNvbnN0IGxlbiA9IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aDsgLy8gaGF2ZSB0byBkbyB0aGlzIGJlY2F1c2UgcHJldHRpZXIgd3JhcHMgdGhlIGxpbmUgYW5kIGNhdXNlcyBhbiBlcnJvclxuICAgICAgICB3b3JkID09PSBudWxsIHx8IHdvcmQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHdvcmQucXVlcnlTZWxlY3RvckFsbChcImxldHRlclwiKVtsZW5dLmNsYXNzTGlzdC50b2dnbGUoXCJkZWFkXCIpO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5vcHBvc2l0ZVNoaWZ0TW9kZSAhPT0gXCJvZmZcIikge1xuICAgICAgICBjb3JyZWN0U2hpZnRVc2VkID1cbiAgICAgICAgICAgICh5aWVsZCBTaGlmdFRyYWNrZXIuaXNVc2luZ09wcG9zaXRlU2hpZnQoZXZlbnQpKSAhPT0gZmFsc2U7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICBsZXQgY2hhciA9IGV2ZW50LmtleTtcbiAgICAgICAgaWYgKFtcIkFycm93TGVmdFwiLCBcIkFycm93VXBcIiwgXCJBcnJvd1JpZ2h0XCIsIFwiQXJyb3dEb3duXCJdLmluY2x1ZGVzKGNoYXIpKSB7XG4gICAgICAgICAgICBpZiAoY2hhciA9PT0gXCJBcnJvd0xlZnRcIilcbiAgICAgICAgICAgICAgICBjaGFyID0gXCJhXCI7XG4gICAgICAgICAgICBpZiAoY2hhciA9PT0gXCJBcnJvd1JpZ2h0XCIpXG4gICAgICAgICAgICAgICAgY2hhciA9IFwiZFwiO1xuICAgICAgICAgICAgaWYgKGNoYXIgPT09IFwiQXJyb3dEb3duXCIpXG4gICAgICAgICAgICAgICAgY2hhciA9IFwic1wiO1xuICAgICAgICAgICAgaWYgKGNoYXIgPT09IFwiQXJyb3dVcFwiKVxuICAgICAgICAgICAgICAgIGNoYXIgPSBcIndcIjtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBoYW5kbGVDaGFyKGNoYXIsIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCk7XG4gICAgICAgICAgICB1cGRhdGVVSSgpO1xuICAgICAgICAgICAgc2V0V29yZHNJbnB1dChcIiBcIiArIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LmxheW91dCAhPT0gXCJkZWZhdWx0XCIgJiZcbiAgICAgICAgIShldmVudC5jdHJsS2V5IHx8XG4gICAgICAgICAgICAoZXZlbnQuYWx0S2V5ICYmIHdpbmRvdy5uYXZpZ2F0b3IucGxhdGZvcm0uc2VhcmNoKFwiTGludXhcIikgPiAtMSkpKSB7XG4gICAgICAgIGNvbnN0IGNoYXIgPSB5aWVsZCBMYXlvdXRFbXVsYXRvci5nZXRDaGFyRnJvbUV2ZW50KGV2ZW50KTtcbiAgICAgICAgaWYgKGNoYXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBoYW5kbGVDaGFyKGNoYXIsIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCk7XG4gICAgICAgICAgICB1cGRhdGVVSSgpO1xuICAgICAgICAgICAgc2V0V29yZHNJbnB1dChcIiBcIiArIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50KTtcbiAgICAgICAgfVxuICAgIH1cbn0pKTtcbiQoXCIjd29yZHNJbnB1dFwiKS5rZXl1cCgoZXZlbnQpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKCEoKF9hID0gZXZlbnQub3JpZ2luYWxFdmVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlzVHJ1c3RlZCkgfHwgVGVzdFVJLnRlc3RSZXN0YXJ0aW5nKSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKFRlc3RVSS5yZXN1bHRWaXNpYmxlKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3Qgbm93ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgaWYgKFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3MuZHVyYXRpb24uY3VycmVudCAhPT0gLTEpIHtcbiAgICAgICAgY29uc3QgZGlmZiA9IE1hdGguYWJzKFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3MuZHVyYXRpb24uY3VycmVudCAtIG5vdyk7XG4gICAgICAgIFRlc3RJbnB1dC5wdXNoS2V5cHJlc3NEdXJhdGlvbihkaWZmKTtcbiAgICB9XG4gICAgVGVzdElucHV0LnNldEtleXByZXNzRHVyYXRpb24obm93KTtcbiAgICBNb25rZXkuc3RvcCgpO1xufSk7XG4kKFwiI3dvcmRzSW5wdXRcIikub24oXCJiZWZvcmVpbnB1dFwiLCAoZXZlbnQpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKCEoKF9hID0gZXZlbnQub3JpZ2luYWxFdmVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlzVHJ1c3RlZCkpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoZXZlbnQudGFyZ2V0LnZhbHVlID09PSBcIlwiKSB7XG4gICAgICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9IFwiIFwiO1xuICAgIH1cbn0pO1xuJChcIiN3b3Jkc0lucHV0XCIpLm9uKFwiaW5wdXRcIiwgKGV2ZW50KSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGlmICghKChfYSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc1RydXN0ZWQpIHx8IFRlc3RVSS50ZXN0UmVzdGFydGluZykge1xuICAgICAgICBldmVudC50YXJnZXQudmFsdWUgPSBcIiBcIjtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBUZXN0SW5wdXQuc2V0S2V5cHJlc3NOb3RBZmsoKTtcbiAgICBjb25zdCByZWFsSW5wdXRWYWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZS5ub3JtYWxpemUoKTtcbiAgICBjb25zdCBpbnB1dFZhbHVlID0gcmVhbElucHV0VmFsdWUuc2xpY2UoMSk7XG4gICAgLy8gaW5wdXQgd2lsbCBiZSBtb2RpZmllZCBldmVuIHdpdGggdGhlIHByZXZlbnREZWZhdWx0KCkgaW5cbiAgICAvLyBiZWZvcmVpbnB1dC9rZXlkb3duIGlmIGl0J3MgcGFydCBvZiBhIGNvbXBvc2Ugc2VxdWVuY2UuIHRoaXMgdW5kb2VzXG4gICAgLy8gdGhlIGVmZmVjdHMgb2YgdGhhdCBhbmQgdGFrZXMgdGhlIGlucHV0IG91dCBvZiBjb21wb3NlIG1vZGUuXG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubGF5b3V0ICE9PSBcImRlZmF1bHRcIiAmJlxuICAgICAgICBpbnB1dFZhbHVlLmxlbmd0aCA+PSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGgpIHtcbiAgICAgICAgc2V0V29yZHNJbnB1dChcIiBcIiArIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAocmVhbElucHV0VmFsdWUubGVuZ3RoID09PSAwICYmIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAvLyBmYWxsYmFjayBmb3Igd2hlbiBubyBCYWNrc3BhY2Uga2V5ZG93biBldmVudCAobW9iaWxlKVxuICAgICAgICBiYWNrc3BhY2VUb1ByZXZpb3VzKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGlucHV0VmFsdWUubGVuZ3RoIDwgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoKSB7XG4gICAgICAgIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50ID0gaW5wdXRWYWx1ZTtcbiAgICAgICAgVGVzdFVJLnVwZGF0ZVdvcmRFbGVtZW50KCk7XG4gICAgICAgIENhcmV0LnVwZGF0ZVBvc2l0aW9uKCk7XG4gICAgICAgIGlmICghTWlzYy50cmFpbGluZ0NvbXBvc2VDaGFycy50ZXN0KFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50KSkge1xuICAgICAgICAgICAgUmVwbGF5LmFkZFJlcGxheUV2ZW50KFwic2V0TGV0dGVySW5kZXhcIiwgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChpbnB1dFZhbHVlICE9PSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCkge1xuICAgICAgICBsZXQgZGlmZlN0YXJ0ID0gMDtcbiAgICAgICAgd2hpbGUgKGlucHV0VmFsdWVbZGlmZlN0YXJ0XSA9PT0gVGVzdElucHV0LmlucHV0LmN1cnJlbnRbZGlmZlN0YXJ0XSkge1xuICAgICAgICAgICAgZGlmZlN0YXJ0Kys7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IGRpZmZTdGFydDsgaSA8IGlucHV0VmFsdWUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGhhbmRsZUNoYXIoaW5wdXRWYWx1ZVtpXSwgaSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0V29yZHNJbnB1dChcIiBcIiArIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50KTtcbiAgICB1cGRhdGVVSSgpO1xuICAgIC8vIGZvcmNlIGNhcmV0IGF0IGVuZCBvZiBpbnB1dFxuICAgIC8vIGRvaW5nIGl0IG9uIG5leHQgY3ljbGUgYmVjYXVzZSBDaHJvbWl1bSBvbiBBbmRyb2lkIHdvbid0IGxldCBtZSBlZGl0XG4gICAgLy8gdGhlIHNlbGVjdGlvbiBpbnNpZGUgdGhlIGlucHV0IGV2ZW50XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5zZWxlY3Rpb25TdGFydCAhPT1cbiAgICAgICAgICAgIGV2ZW50LnRhcmdldC52YWx1ZS5sZW5ndGggJiZcbiAgICAgICAgICAgICghTWlzYy50cmFpbGluZ0NvbXBvc2VDaGFycy50ZXN0KGV2ZW50LnRhcmdldC52YWx1ZSkgfHxcbiAgICAgICAgICAgICAgICAoKF9hID0gZXZlbnQudGFyZ2V0LnNlbGVjdGlvblN0YXJ0KSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAwKSA8XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC52YWx1ZS5zZWFyY2goTWlzYy50cmFpbGluZ0NvbXBvc2VDaGFycykpKSB7XG4gICAgICAgICAgICBldmVudC50YXJnZXQuc2VsZWN0aW9uU3RhcnQgPSBldmVudC50YXJnZXQuc2VsZWN0aW9uRW5kID0gZXZlbnQudGFyZ2V0LnZhbHVlLmxlbmd0aDtcbiAgICAgICAgfVxuICAgIH0sIDApO1xufSk7XG4kKFwiI3dvcmRzSW5wdXRcIikub24oXCJmb2N1c1wiLCAoZXZlbnQpID0+IHtcbiAgICBldmVudC50YXJnZXQuc2VsZWN0aW9uU3RhcnQgPSBldmVudC50YXJnZXQuc2VsZWN0aW9uRW5kID0gZXZlbnQudGFyZ2V0LnZhbHVlLmxlbmd0aDtcbn0pO1xuJChcIiN3b3Jkc0lucHV0XCIpLm9uKFwiY29weSBwYXN0ZVwiLCAoZXZlbnQpID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmNoYW5nZSA9IHZvaWQgMDtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgQWN0aXZlUGFnZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL2FjdGl2ZS1wYWdlXCIpKTtcbmNvbnN0IFNldHRpbmdzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wYWdlcy9zZXR0aW5nc1wiKSk7XG5jb25zdCBBY2NvdW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wYWdlcy9hY2NvdW50XCIpKTtcbmNvbnN0IE1hbnVhbFJlc3RhcnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvbWFudWFsLXJlc3RhcnQtdHJhY2tlclwiKSk7XG5jb25zdCBQYWdlVGVzdCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcGFnZXMvdGVzdFwiKSk7XG5jb25zdCBQYWdlQWJvdXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BhZ2VzL2Fib3V0XCIpKTtcbmNvbnN0IFBhZ2VDaGFuZ2VFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvcGFnZS1jaGFuZ2UtZXZlbnRcIikpO1xuY29uc3QgUGFnZUxvZ2luID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wYWdlcy9sb2dpblwiKSk7XG5jb25zdCBQYWdlTG9hZGluZyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcGFnZXMvbG9hZGluZ1wiKSk7XG5jb25zdCBQYWdlVHJhbnNpdGlvbiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3BhZ2UtdHJhbnNpdGlvblwiKSk7XG5mdW5jdGlvbiBjaGFuZ2UocGFnZSkge1xuICAgIGlmIChQYWdlVHJhbnNpdGlvbi5nZXQoKSkge1xuICAgICAgICBjb25zb2xlLmxvZyhgY2hhbmdlIHBhZ2UgJHtwYWdlfSBzdG9wcGVkYCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc29sZS5sb2coYGNoYW5nZSBwYWdlICR7cGFnZX1gKTtcbiAgICBpZiAocGFnZSA9PT0gXCJcIilcbiAgICAgICAgcGFnZSA9IFwidGVzdFwiO1xuICAgIGlmIChwYWdlID09IHVuZGVmaW5lZCkge1xuICAgICAgICAvL3VzZSB3aW5kb3cgbG9hY2F0aW9uXG4gICAgICAgIGNvbnN0IHBhZ2VzID0ge1xuICAgICAgICAgICAgXCIvXCI6IFwidGVzdFwiLFxuICAgICAgICAgICAgXCIvbG9naW5cIjogXCJsb2dpblwiLFxuICAgICAgICAgICAgXCIvc2V0dGluZ3NcIjogXCJzZXR0aW5nc1wiLFxuICAgICAgICAgICAgXCIvYWJvdXRcIjogXCJhYm91dFwiLFxuICAgICAgICAgICAgXCIvYWNjb3VudFwiOiBcImFjY291bnRcIixcbiAgICAgICAgfTtcbiAgICAgICAgbGV0IHBhdGggPSBwYWdlc1t3aW5kb3cubG9jYXRpb24ucGF0aG5hbWVdO1xuICAgICAgICBpZiAoIXBhdGgpIHtcbiAgICAgICAgICAgIHBhdGggPSBcInRlc3RcIjtcbiAgICAgICAgfVxuICAgICAgICBwYWdlID0gcGF0aDtcbiAgICB9XG4gICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT09IHBhZ2UpIHtcbiAgICAgICAgY29uc29sZS5sb2coYHBhZ2UgJHtwYWdlfSBhbHJlYWR5IGFjdGl2ZWApO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHBhZ2VzID0ge1xuICAgICAgICBsb2FkaW5nOiBQYWdlTG9hZGluZy5wYWdlLFxuICAgICAgICB0ZXN0OiBQYWdlVGVzdC5wYWdlLFxuICAgICAgICBzZXR0aW5nczogU2V0dGluZ3MucGFnZSxcbiAgICAgICAgYWJvdXQ6IFBhZ2VBYm91dC5wYWdlLFxuICAgICAgICBhY2NvdW50OiBBY2NvdW50LnBhZ2UsXG4gICAgICAgIGxvZ2luOiBQYWdlTG9naW4ucGFnZSxcbiAgICB9O1xuICAgIGNvbnN0IHByZXZpb3VzUGFnZSA9IHBhZ2VzW0FjdGl2ZVBhZ2UuZ2V0KCldO1xuICAgIGNvbnN0IG5leHRQYWdlID0gcGFnZXNbcGFnZV07XG4gICAgcHJldmlvdXNQYWdlID09PSBudWxsIHx8IHByZXZpb3VzUGFnZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcHJldmlvdXNQYWdlLmJlZm9yZUhpZGUoKTtcbiAgICBQYWdlVHJhbnNpdGlvbi5zZXQodHJ1ZSk7XG4gICAgQWN0aXZlUGFnZS5zZXQodW5kZWZpbmVkKTtcbiAgICAkKFwiLnBhZ2VcIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgTWlzYy5zd2FwRWxlbWVudHMocHJldmlvdXNQYWdlLmVsZW1lbnQsIG5leHRQYWdlLmVsZW1lbnQsIDI1MCwgKCkgPT4ge1xuICAgICAgICBQYWdlVHJhbnNpdGlvbi5zZXQoZmFsc2UpO1xuICAgICAgICBBY3RpdmVQYWdlLnNldChuZXh0UGFnZS5uYW1lKTtcbiAgICAgICAgcHJldmlvdXNQYWdlID09PSBudWxsIHx8IHByZXZpb3VzUGFnZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcHJldmlvdXNQYWdlLmFmdGVySGlkZSgpO1xuICAgICAgICBuZXh0UGFnZS5lbGVtZW50LmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICBoaXN0b3J5LnB1c2hTdGF0ZShuZXh0UGFnZS5wYXRobmFtZSwgXCJcIiwgbmV4dFBhZ2UucGF0aG5hbWUpO1xuICAgICAgICBuZXh0UGFnZSA9PT0gbnVsbCB8fCBuZXh0UGFnZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmV4dFBhZ2UuYWZ0ZXJTaG93KCk7XG4gICAgfSwgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICB5aWVsZCAobmV4dFBhZ2UgPT09IG51bGwgfHwgbmV4dFBhZ2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5leHRQYWdlLmJlZm9yZVNob3coKSk7XG4gICAgfSkpO1xuICAgIFBhZ2VDaGFuZ2VFdmVudC5kaXNwYXRjaChwcmV2aW91c1BhZ2UsIG5leHRQYWdlKTtcbn1cbmV4cG9ydHMuY2hhbmdlID0gY2hhbmdlO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0b3AgLmxvZ29cIiwgKCkgPT4ge1xuICAgIGNoYW5nZShcInRlc3RcIik7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjdG9wICNtZW51IC5pY29uLWJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIGlmICghJChlLmN1cnJlbnRUYXJnZXQpLmhhc0NsYXNzKFwibGVhZGVyYm9hcmRzXCIpKSB7XG4gICAgICAgIGNvbnN0IGhyZWYgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcImhyZWZcIik7XG4gICAgICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgICAgIGNoYW5nZShocmVmLnJlcGxhY2UoXCIvXCIsIFwiXCIpKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufSk7XG4kKFwiLnBhZ2VUZXN0IC5sb2dpblRpcCAubGlua1wiKS5vbihcImNsaWNrXCIsICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIGNoYW5nZShcImxvZ2luXCIpO1xufSkpO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuYXBwbHkgPSB2b2lkIDA7XG5jb25zdCBVcGRhdGVDb25maWcgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBUZXN0TG9naWMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC1sb2dpY1wiKSk7XG5jb25zdCBUYWdDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3RhZy1jb250cm9sbGVyXCIpKTtcbmZ1bmN0aW9uIGFwcGx5KF9pZCkge1xuICAgIHZhciBfYTtcbiAgICAvLyBjb25zb2xlLmxvZyhEQi5nZXRTbmFwc2hvdCgpLnByZXNldHMpO1xuICAgIGNvbnN0IHNuYXBzaG90ID0gREIuZ2V0U25hcHNob3QoKTtcbiAgICAoX2EgPSBzbmFwc2hvdC5wcmVzZXRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgocHJlc2V0KSA9PiB7XG4gICAgICAgIGlmIChwcmVzZXQuX2lkID09IF9pZCkge1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLmFwcGx5KHByZXNldC5jb25maWcpO1xuICAgICAgICAgICAgVGFnQ29udHJvbGxlci5jbGVhcih0cnVlKTtcbiAgICAgICAgICAgIGlmIChwcmVzZXQuY29uZmlnLnRhZ3MpIHtcbiAgICAgICAgICAgICAgICBwcmVzZXQuY29uZmlnLnRhZ3MuZm9yRWFjaCgodGFnaWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgVGFnQ29udHJvbGxlci5zZXQodGFnaWQsIHRydWUsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlByZXNldCBhcHBsaWVkXCIsIDEsIDIpO1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNhdmVGdWxsQ29uZmlnVG9Mb2NhbFN0b3JhZ2UoKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5hcHBseSA9IGFwcGx5O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IG1pc2NfMSA9IHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpO1xuY29uc3QgY29uZmlnX2V2ZW50XzEgPSByZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpO1xuY29uc3QgZGVmYXVsdFF1b3RlQ29sbGVjdGlvbiA9IHtcbiAgICBxdW90ZXM6IFtdLFxuICAgIGxlbmd0aDogMCxcbiAgICBsYW5ndWFnZTogbnVsbCxcbiAgICBncm91cHM6IFtdLFxufTtcbmNsYXNzIFF1b3Rlc0NvbnRyb2xsZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnF1b3RlQ29sbGVjdGlvbiA9IGRlZmF1bHRRdW90ZUNvbGxlY3Rpb247XG4gICAgICAgIHRoaXMucXVvdGVRdWV1ZSA9IFtdO1xuICAgICAgICB0aGlzLnF1ZXVlSW5kZXggPSAwO1xuICAgIH1cbiAgICBnZXRRdW90ZXMobGFuZ3VhZ2UsIHF1b3RlTGVuZ3Rocykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZExhbmd1YWdlID0gbGFuZ3VhZ2UucmVwbGFjZSgvX1xcZCprJC9nLCBcIlwiKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnF1b3RlQ29sbGVjdGlvbi5sYW5ndWFnZSAhPT0gbm9ybWFsaXplZExhbmd1YWdlKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHlpZWxkICQuZ2V0SlNPTihgcXVvdGVzLyR7bm9ybWFsaXplZExhbmd1YWdlfS5qc29uYCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnF1b3RlcyA9PT0gdW5kZWZpbmVkIHx8IGRhdGEucXVvdGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRRdW90ZUNvbGxlY3Rpb247XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5xdW90ZUNvbGxlY3Rpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBxdW90ZXM6IFtdLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoOiBkYXRhLnF1b3Rlcy5sZW5ndGgsXG4gICAgICAgICAgICAgICAgICAgICAgICBncm91cHM6IFtdLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IGRhdGEubGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIC8vIFRyYW5zZm9ybSBKU09OIFF1b3RlIHNjaGVtYSB0byBNb25rZXlUeXBlcyBRdW90ZSBzY2hlbWFcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5xdW90ZXMuZm9yRWFjaCgocXVvdGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vbmtleVR5cGVRdW90ZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBxdW90ZS50ZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogcXVvdGUuc291cmNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aDogcXVvdGUubGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBxdW90ZS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogZGF0YS5sYW5ndWFnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnF1b3RlQ29sbGVjdGlvbi5xdW90ZXMucHVzaChtb25rZXlUeXBlUXVvdGUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5ncm91cHMuZm9yRWFjaCgocXVvdGVHcm91cCwgZ3JvdXBJbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbG93ZXIgPSBxdW90ZUdyb3VwWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBwZXIgPSBxdW90ZUdyb3VwWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5xdW90ZUNvbGxlY3Rpb24uZ3JvdXBzW2dyb3VwSW5kZXhdID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnF1b3RlQ29sbGVjdGlvbi5xdW90ZXMuZmlsdGVyKChxdW90ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocXVvdGUubGVuZ3RoID49IGxvd2VyICYmIHF1b3RlLmxlbmd0aCA8PSB1cHBlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVvdGUuZ3JvdXAgPSBncm91cEluZGV4O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHF1b3RlTGVuZ3RocyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVF1b3RlUXVldWUocXVvdGVMZW5ndGhzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoX2EpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRRdW90ZUNvbGxlY3Rpb247XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucXVvdGVDb2xsZWN0aW9uO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0UXVvdGVCeUlkKGlkKSB7XG4gICAgICAgIGNvbnN0IHRhcmdldFF1b3RlID0gdGhpcy5xdW90ZUNvbGxlY3Rpb24ucXVvdGVzLmZpbmQoKHF1b3RlKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcXVvdGUuaWQgPT09IGlkO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRhcmdldFF1b3RlO1xuICAgIH1cbiAgICB1cGRhdGVRdW90ZVF1ZXVlKHF1b3RlR3JvdXBzKSB7XG4gICAgICAgIHRoaXMucXVvdGVRdWV1ZSA9IFtdO1xuICAgICAgICBxdW90ZUdyb3Vwcy5mb3JFYWNoKChncm91cCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgaWYgKGdyb3VwIDwgMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIChfYSA9IHRoaXMucXVvdGVDb2xsZWN0aW9uLmdyb3Vwc1tncm91cF0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKChxdW90ZSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucXVvdGVRdWV1ZS5wdXNoKHF1b3RlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgKDAsIG1pc2NfMS5zaHVmZmxlKSh0aGlzLnF1b3RlUXVldWUpO1xuICAgICAgICB0aGlzLnF1ZXVlSW5kZXggPSAwO1xuICAgIH1cbiAgICBnZXRSYW5kb21RdW90ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMucXVvdGVRdWV1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnF1ZXVlSW5kZXggPj0gdGhpcy5xdW90ZVF1ZXVlLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5xdWV1ZUluZGV4ID0gMDtcbiAgICAgICAgICAgICgwLCBtaXNjXzEuc2h1ZmZsZSkodGhpcy5xdW90ZVF1ZXVlKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByYW5kb21RdW90ZSA9IHRoaXMucXVvdGVRdWV1ZVt0aGlzLnF1ZXVlSW5kZXhdO1xuICAgICAgICB0aGlzLnF1ZXVlSW5kZXggKz0gMTtcbiAgICAgICAgcmV0dXJuIHJhbmRvbVF1b3RlO1xuICAgIH1cbiAgICBnZXRDdXJyZW50UXVvdGUoKSB7XG4gICAgICAgIGlmICh0aGlzLnF1b3RlUXVldWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5xdW90ZVF1ZXVlW3RoaXMucXVldWVJbmRleF07XG4gICAgfVxufVxuY29uc3QgcXVvdGVDb250cm9sbGVyID0gbmV3IFF1b3Rlc0NvbnRyb2xsZXIoKTtcbigwLCBjb25maWdfZXZlbnRfMS5zdWJzY3JpYmUpKChrZXksIG5ld1ZhbHVlKSA9PiB7XG4gICAgaWYgKGtleSA9PT0gXCJxdW90ZUxlbmd0aFwiKSB7XG4gICAgICAgIHF1b3RlQ29udHJvbGxlci51cGRhdGVRdW90ZVF1ZXVlKG5ld1ZhbHVlKTtcbiAgICB9XG59KTtcbmV4cG9ydHMuZGVmYXVsdCA9IHF1b3RlQ29udHJvbGxlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmhhbmRsZUluaXRpYWxQYWdlQ2xhc3NlcyA9IHZvaWQgMDtcbi8vIGltcG9ydCAqIGFzIEZ1bmJveCBmcm9tIFwiLi4vdGVzdC9mdW5ib3hcIjtcbmNvbnN0IFBhZ2VDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3BhZ2UtY29udHJvbGxlclwiKSk7XG4vLyBpbXBvcnQgQ29uZmlnIGZyb20gXCIuLi9jb25maWdcIjtcbmNvbnN0IEFjdGl2ZVBhZ2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9hY3RpdmUtcGFnZVwiKSk7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xuY29uc3QgbWFwcGVkUm91dGVzID0ge1xuICAgIFwiL1wiOiBcInBhZ2VMb2FkaW5nXCIsXG4gICAgXCIvbG9naW5cIjogXCJwYWdlTG9hZGluZ1wiLFxuICAgIFwiL3NldHRpbmdzXCI6IFwicGFnZUxvYWRpbmdcIixcbiAgICBcIi9hYm91dFwiOiBcInBhZ2VMb2FkaW5nXCIsXG4gICAgXCIvYWNjb3VudFwiOiBcInBhZ2VBY2NvdW50XCIsXG4gICAgXCIvdmVyaWZ5XCI6IFwicGFnZUxvYWRpbmdcIixcbn07XG5mdW5jdGlvbiBoYW5kbGVJbml0aWFsUGFnZUNsYXNzZXMocGF0aG5hbWUpIHtcbiAgICBpZiAoIW1hcHBlZFJvdXRlc1twYXRobmFtZV0pIHtcbiAgICAgICAgcGF0aG5hbWUgPSBcIi9cIjtcbiAgICB9XG4gICAgY29uc3QgZWwgPSAkKFwiLnBhZ2UuXCIgKyBtYXBwZWRSb3V0ZXNbcGF0aG5hbWVdKTtcbiAgICAkKGVsKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAkKGVsKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICBsZXQgcGFnZU5hbWUgPSBcImxvYWRpbmdcIjtcbiAgICBpZiAocGF0aG5hbWUgPT09IFwiL2FjY291bnRcIilcbiAgICAgICAgcGFnZU5hbWUgPSBcImFjY291bnRcIjtcbiAgICBBY3RpdmVQYWdlLnNldChwYWdlTmFtZSk7XG59XG5leHBvcnRzLmhhbmRsZUluaXRpYWxQYWdlQ2xhc3NlcyA9IGhhbmRsZUluaXRpYWxQYWdlQ2xhc3Nlcztcbi8vIGhvbmVzdGx5IGltIG5vdCBzdXJlIHdoYXQgdGhpcyBkb2VzXG4vLyAoZnVuY3Rpb24gKGhpc3RvcnkpOiB2b2lkIHtcbi8vICAgY29uc3QgcHVzaFN0YXRlID0gaGlzdG9yeS5wdXNoU3RhdGU7XG4vLyAgIGhpc3RvcnkucHVzaFN0YXRlID0gZnVuY3Rpb24gKHN0YXRlKTogdm9pZCB7XG4vLyAgICAgaWYgKENvbmZpZy5mdW5ib3ggPT09IFwibWVtb3J5XCIgJiYgc3RhdGUgIT09IFwiL1wiKSB7XG4vLyAgICAgICBGdW5ib3gucmVzZXRNZW1vcnlUaW1lcigpO1xuLy8gICAgIH1cbi8vICAgICAvLyBAdHMtaWdub3JlXG4vLyAgICAgcmV0dXJuIHB1c2hTdGF0ZS5hcHBseShoaXN0b3J5LCBhcmd1bWVudHMpO1xuLy8gICB9O1xuLy8gfSkod2luZG93Lmhpc3RvcnkpO1xuJCh3aW5kb3cpLm9uKFwicG9wc3RhdGVcIiwgKGUpID0+IHtcbiAgICBjb25zdCBzdGF0ZSA9IGUub3JpZ2luYWxFdmVudC5zdGF0ZTtcbiAgICBpZiAoc3RhdGUgPT0gXCJcIiB8fCBzdGF0ZSA9PSBcIi9cIikge1xuICAgICAgICAvLyBzaG93IHRlc3RcbiAgICAgICAgUGFnZUNvbnRyb2xsZXIuY2hhbmdlKFwidGVzdFwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoc3RhdGUgPT0gXCJhYm91dFwiKSB7XG4gICAgICAgIC8vIHNob3cgYWJvdXRcbiAgICAgICAgUGFnZUNvbnRyb2xsZXIuY2hhbmdlKFwiYWJvdXRcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKHN0YXRlID09IFwiYWNjb3VudFwiIHx8IHN0YXRlID09IFwibG9naW5cIikge1xuICAgICAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyKSB7XG4gICAgICAgICAgICBQYWdlQ29udHJvbGxlci5jaGFuZ2UoXCJhY2NvdW50XCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgUGFnZUNvbnRyb2xsZXIuY2hhbmdlKFwibG9naW5cIik7XG4gICAgICAgIH1cbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNldFZvbHVtZSA9IGV4cG9ydHMucGxheUVycm9yID0gZXhwb3J0cy5wbGF5Q2xpY2sgPSBleHBvcnRzLnByZXZpZXdDbGljayA9IGV4cG9ydHMuaW5pdCA9IGV4cG9ydHMuaW5pdEVycm9yU291bmQgPSB2b2lkIDA7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IGhvd2xlcl8xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCJob3dsZXJcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBtaXNjXzEgPSByZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKTtcbmxldCBlcnJvclNvdW5kID0gbnVsbDtcbmxldCBjbGlja1NvdW5kcyA9IG51bGw7XG5mdW5jdGlvbiBpbml0RXJyb3JTb3VuZCgpIHtcbiAgICBpZiAoZXJyb3JTb3VuZCAhPT0gbnVsbClcbiAgICAgICAgcmV0dXJuO1xuICAgIGVycm9yU291bmQgPSBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogW1wiLi4vc291bmQvZXJyb3Iud2F2XCJdIH0pO1xufVxuZXhwb3J0cy5pbml0RXJyb3JTb3VuZCA9IGluaXRFcnJvclNvdW5kO1xuZnVuY3Rpb24gaW5pdCgpIHtcbiAgICBpZiAoY2xpY2tTb3VuZHMgIT09IG51bGwpXG4gICAgICAgIHJldHVybjtcbiAgICBjbGlja1NvdW5kcyA9IHtcbiAgICAgICAgMTogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazEvY2xpY2sxXzEud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMS9jbGljazFfMS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazEvY2xpY2sxXzIud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMS9jbGljazFfMi53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazEvY2xpY2sxXzMud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMS9jbGljazFfMy53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICAyOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMi9jbGljazJfMS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2syL2NsaWNrMl8xLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMi9jbGljazJfMi53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2syL2NsaWNrMl8yLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMi9jbGljazJfMy53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2syL2NsaWNrMl8zLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIDM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2szL2NsaWNrM18xLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazMvY2xpY2szXzEud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2szL2NsaWNrM18yLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazMvY2xpY2szXzIud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2szL2NsaWNrM18zLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazMvY2xpY2szXzMud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgNDogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazQvY2xpY2s0XzEud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNC9jbGljazRfMTEud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s0L2NsaWNrNF8yLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazQvY2xpY2s0XzIyLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNC9jbGljazRfMy53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s0L2NsaWNrNF8zMy53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazQvY2xpY2s0XzQud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNC9jbGljazRfNDQud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s0L2NsaWNrNF81LndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazQvY2xpY2s0XzU1LndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNC9jbGljazRfNi53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s0L2NsaWNrNF82Ni53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICA1OiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNS9jbGljazVfMS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s1L2NsaWNrNV8xMS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazUvY2xpY2s1XzIud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNS9jbGljazVfMjIud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s1L2NsaWNrNV8zLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazUvY2xpY2s1XzMzLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNS9jbGljazVfNC53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s1L2NsaWNrNV80NC53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazUvY2xpY2s1XzUud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNS9jbGljazVfNTUud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s1L2NsaWNrNV82LndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazUvY2xpY2s1XzY2LndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIDY6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s2L2NsaWNrNl8xLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazYvY2xpY2s2XzExLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNi9jbGljazZfMi53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s2L2NsaWNrNl8yMi53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazYvY2xpY2s2XzMud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNi9jbGljazZfMzMud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgNzogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazcvY2xpY2s3XzEud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNy9jbGljazdfMTEud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s3L2NsaWNrN18yLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazcvY2xpY2s3XzIyLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNy9jbGljazdfMy53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s3L2NsaWNrN18zMy53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgIH07XG59XG5leHBvcnRzLmluaXQgPSBpbml0O1xuZnVuY3Rpb24gcHJldmlld0NsaWNrKHZhbCkge1xuICAgIGlmIChjbGlja1NvdW5kcyA9PT0gbnVsbClcbiAgICAgICAgaW5pdCgpO1xuICAgIGNsaWNrU291bmRzW3ZhbF1bMF0uc291bmRzWzBdLnNlZWsoMCk7XG4gICAgY2xpY2tTb3VuZHNbdmFsXVswXS5zb3VuZHNbMF0ucGxheSgpO1xufVxuZXhwb3J0cy5wcmV2aWV3Q2xpY2sgPSBwcmV2aWV3Q2xpY2s7XG5mdW5jdGlvbiBwbGF5Q2xpY2soKSB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucGxheVNvdW5kT25DbGljayA9PT0gXCJvZmZcIilcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChjbGlja1NvdW5kcyA9PT0gbnVsbClcbiAgICAgICAgaW5pdCgpO1xuICAgIGNvbnN0IHJhbmRvbVNvdW5kID0gKDAsIG1pc2NfMS5yYW5kb21FbGVtZW50RnJvbUFycmF5KShjbGlja1NvdW5kc1tjb25maWdfMS5kZWZhdWx0LnBsYXlTb3VuZE9uQ2xpY2tdKTtcbiAgICByYW5kb21Tb3VuZC5jb3VudGVyKys7XG4gICAgaWYgKHJhbmRvbVNvdW5kLmNvdW50ZXIgPT09IDIpXG4gICAgICAgIHJhbmRvbVNvdW5kLmNvdW50ZXIgPSAwO1xuICAgIHJhbmRvbVNvdW5kLnNvdW5kc1tyYW5kb21Tb3VuZC5jb3VudGVyXS5zZWVrKDApO1xuICAgIHJhbmRvbVNvdW5kLnNvdW5kc1tyYW5kb21Tb3VuZC5jb3VudGVyXS5wbGF5KCk7XG59XG5leHBvcnRzLnBsYXlDbGljayA9IHBsYXlDbGljaztcbmZ1bmN0aW9uIHBsYXlFcnJvcigpIHtcbiAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQucGxheVNvdW5kT25FcnJvcilcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChlcnJvclNvdW5kID09PSBudWxsKVxuICAgICAgICBpbml0RXJyb3JTb3VuZCgpO1xuICAgIGVycm9yU291bmQuc2VlaygwKTtcbiAgICBlcnJvclNvdW5kLnBsYXkoKTtcbn1cbmV4cG9ydHMucGxheUVycm9yID0gcGxheUVycm9yO1xuZnVuY3Rpb24gc2V0Vm9sdW1lKHZhbCkge1xuICAgIC8vIG5vdCBzdXJlIHdoeSBpdCBjb21wbGFpbnMgYnV0IGl0IHdvcmtzXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGhvd2xlcl8xLmRlZmF1bHQuSG93bGVyLnZvbHVtZSh2YWwpO1xufVxuZXhwb3J0cy5zZXRWb2x1bWUgPSBzZXRWb2x1bWU7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5LCBldmVudFZhbHVlKSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcInBsYXlTb3VuZE9uQ2xpY2tcIiAmJiBldmVudFZhbHVlICE9PSBcIm9mZlwiKVxuICAgICAgICBpbml0KCk7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcInNvdW5kVm9sdW1lXCIpXG4gICAgICAgIHNldFZvbHVtZShldmVudFZhbHVlKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMubG9hZEFjdGl2ZUZyb21Mb2NhbFN0b3JhZ2UgPSBleHBvcnRzLnRvZ2dsZSA9IGV4cG9ydHMuc2V0ID0gZXhwb3J0cy5jbGVhciA9IGV4cG9ydHMuc2F2ZUFjdGl2ZVRvTG9jYWxTdG9yYWdlID0gdm9pZCAwO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IE1vZGVzTm90aWNlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9tb2Rlcy1ub3RpY2VcIikpO1xuZnVuY3Rpb24gc2F2ZUFjdGl2ZVRvTG9jYWxTdG9yYWdlKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB0YWdzID0gW107XG4gICAgdHJ5IHtcbiAgICAgICAgKF9hID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgICAgICBpZiAodGFnLmFjdGl2ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRhZ3MucHVzaCh0YWcuX2lkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImFjdGl2ZVRhZ3NcIiwgSlNPTi5zdHJpbmdpZnkodGFncykpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkgeyB9XG59XG5leHBvcnRzLnNhdmVBY3RpdmVUb0xvY2FsU3RvcmFnZSA9IHNhdmVBY3RpdmVUb0xvY2FsU3RvcmFnZTtcbmZ1bmN0aW9uIGNsZWFyKG5vc2F2ZSA9IGZhbHNlKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHNuYXBzaG90ID0gREIuZ2V0U25hcHNob3QoKTtcbiAgICBzbmFwc2hvdC50YWdzID0gKF9hID0gc25hcHNob3QudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1hcCgodGFnKSA9PiB7XG4gICAgICAgIHRhZy5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRhZztcbiAgICB9KTtcbiAgICBEQi5zZXRTbmFwc2hvdChzbmFwc2hvdCk7XG4gICAgTW9kZXNOb3RpY2UudXBkYXRlKCk7XG4gICAgaWYgKCFub3NhdmUpXG4gICAgICAgIHNhdmVBY3RpdmVUb0xvY2FsU3RvcmFnZSgpO1xufVxuZXhwb3J0cy5jbGVhciA9IGNsZWFyO1xuZnVuY3Rpb24gc2V0KHRhZ2lkLCBzdGF0ZSwgbm9zYXZlID0gZmFsc2UpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3Qgc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdCgpO1xuICAgIHNuYXBzaG90LnRhZ3MgPSAoX2EgPSBzbmFwc2hvdC50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWFwKCh0YWcpID0+IHtcbiAgICAgICAgaWYgKHRhZy5faWQgPT09IHRhZ2lkKSB7XG4gICAgICAgICAgICB0YWcuYWN0aXZlID0gc3RhdGU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRhZztcbiAgICB9KTtcbiAgICBEQi5zZXRTbmFwc2hvdChzbmFwc2hvdCk7XG4gICAgTW9kZXNOb3RpY2UudXBkYXRlKCk7XG4gICAgaWYgKCFub3NhdmUpXG4gICAgICAgIHNhdmVBY3RpdmVUb0xvY2FsU3RvcmFnZSgpO1xufVxuZXhwb3J0cy5zZXQgPSBzZXQ7XG5mdW5jdGlvbiB0b2dnbGUodGFnaWQsIG5vc2F2ZSA9IGZhbHNlKSB7XG4gICAgdmFyIF9hO1xuICAgIChfYSA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICBpZiAodGFnLl9pZCA9PT0gdGFnaWQpIHtcbiAgICAgICAgICAgIGlmICh0YWcuYWN0aXZlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0YWcuYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRhZy5hY3RpdmUgPSAhdGFnLmFjdGl2ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuICAgIE1vZGVzTm90aWNlLnVwZGF0ZSgpO1xuICAgIGlmICghbm9zYXZlKVxuICAgICAgICBzYXZlQWN0aXZlVG9Mb2NhbFN0b3JhZ2UoKTtcbn1cbmV4cG9ydHMudG9nZ2xlID0gdG9nZ2xlO1xuZnVuY3Rpb24gbG9hZEFjdGl2ZUZyb21Mb2NhbFN0b3JhZ2UoKSB7XG4gICAgdmFyIF9hO1xuICAgIGxldCBuZXdUYWdzID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiYWN0aXZlVGFnc1wiKTtcbiAgICBpZiAobmV3VGFncyAhPSB1bmRlZmluZWQgJiYgbmV3VGFncyAhPT0gXCJcIikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbmV3VGFncyA9IChfYSA9IEpTT04ucGFyc2UobmV3VGFncykpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFtdO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBuZXdUYWdzID0gW107XG4gICAgICAgIH1cbiAgICAgICAgbmV3VGFncy5mb3JFYWNoKChudGFnKSA9PiB7XG4gICAgICAgICAgICB0b2dnbGUobnRhZywgdHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBzYXZlQWN0aXZlVG9Mb2NhbFN0b3JhZ2UoKTtcbiAgICB9XG59XG5leHBvcnRzLmxvYWRBY3RpdmVGcm9tTG9jYWxTdG9yYWdlID0gbG9hZEFjdGl2ZUZyb21Mb2NhbFN0b3JhZ2U7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX2EsIF9iO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5hcHBseUN1c3RvbUJhY2tncm91bmQgPSBleHBvcnRzLmFwcGx5Q3VzdG9tQmFja2dyb3VuZFNpemUgPSBleHBvcnRzLmNsZWFyUmFuZG9tID0gZXhwb3J0cy5yYW5kb21pemVUaGVtZSA9IGV4cG9ydHMuY2xlYXJQcmV2aWV3ID0gZXhwb3J0cy5zZXQgPSBleHBvcnRzLnByZXZpZXcgPSBleHBvcnRzLmNvbG9yVmFycyA9IGV4cG9ydHMucmFuZG9tVGhlbWUgPSB2b2lkIDA7XG5jb25zdCBUaGVtZUNvbG9ycyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvdGhlbWUtY29sb3JzXCIpKTtcbmNvbnN0IENoYXJ0Q29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jaGFydC1jb250cm9sbGVyXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgQmFja2dyb3VuZEZpbHRlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvY3VzdG9tLWJhY2tncm91bmQtZmlsdGVyXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgQW5hbHl0aWNzQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvYW5hbHl0aWNzLWNvbnRyb2xsZXJcIikpO1xubGV0IGlzUHJldmlld2luZ1RoZW1lID0gZmFsc2U7XG5leHBvcnRzLnJhbmRvbVRoZW1lID0gbnVsbDtcbmV4cG9ydHMuY29sb3JWYXJzID0gW1xuICAgIFwiLS1iZy1jb2xvclwiLFxuICAgIFwiLS1tYWluLWNvbG9yXCIsXG4gICAgXCItLWNhcmV0LWNvbG9yXCIsXG4gICAgXCItLXN1Yi1jb2xvclwiLFxuICAgIFwiLS10ZXh0LWNvbG9yXCIsXG4gICAgXCItLWVycm9yLWNvbG9yXCIsXG4gICAgXCItLWVycm9yLWV4dHJhLWNvbG9yXCIsXG4gICAgXCItLWNvbG9yZnVsLWVycm9yLWNvbG9yXCIsXG4gICAgXCItLWNvbG9yZnVsLWVycm9yLWV4dHJhLWNvbG9yXCIsXG5dO1xuZnVuY3Rpb24gdXBkYXRlRmF2aWNvbihzaXplLCBjdXJ2ZVNpemUpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGxldCBtYWluY29sb3IsIGJnY29sb3I7XG4gICAgICAgICAgICBiZ2NvbG9yID0geWllbGQgVGhlbWVDb2xvcnMuZ2V0KFwiYmdcIik7XG4gICAgICAgICAgICBtYWluY29sb3IgPSB5aWVsZCBUaGVtZUNvbG9ycy5nZXQoXCJtYWluXCIpO1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSA9PT0gXCJsb2NhbGhvc3RcIikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN3YXAgPSBtYWluY29sb3I7XG4gICAgICAgICAgICAgICAgbWFpbmNvbG9yID0gYmdjb2xvcjtcbiAgICAgICAgICAgICAgICBiZ2NvbG9yID0gc3dhcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChiZ2NvbG9yID09IG1haW5jb2xvcikge1xuICAgICAgICAgICAgICAgIGJnY29sb3IgPSBcIiMxMTFcIjtcbiAgICAgICAgICAgICAgICBtYWluY29sb3IgPSBcIiNlZWVcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgICAgICAgICBjYW52YXMud2lkdGggPSBzaXplO1xuICAgICAgICAgICAgY2FudmFzLmhlaWdodCA9IHNpemU7XG4gICAgICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgY3R4Lm1vdmVUbygwLCBjdXJ2ZVNpemUpO1xuICAgICAgICAgICAgLy90b3AgbGVmdFxuICAgICAgICAgICAgY3R4LnF1YWRyYXRpY0N1cnZlVG8oMCwgMCwgY3VydmVTaXplLCAwKTtcbiAgICAgICAgICAgIGN0eC5saW5lVG8oc2l6ZSAtIGN1cnZlU2l6ZSwgMCk7XG4gICAgICAgICAgICAvL3RvcCByaWdodFxuICAgICAgICAgICAgY3R4LnF1YWRyYXRpY0N1cnZlVG8oc2l6ZSwgMCwgc2l6ZSwgY3VydmVTaXplKTtcbiAgICAgICAgICAgIGN0eC5saW5lVG8oc2l6ZSwgc2l6ZSAtIGN1cnZlU2l6ZSk7XG4gICAgICAgICAgICBjdHgucXVhZHJhdGljQ3VydmVUbyhzaXplLCBzaXplLCBzaXplIC0gY3VydmVTaXplLCBzaXplKTtcbiAgICAgICAgICAgIGN0eC5saW5lVG8oY3VydmVTaXplLCBzaXplKTtcbiAgICAgICAgICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKDAsIHNpemUsIDAsIHNpemUgLSBjdXJ2ZVNpemUpO1xuICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGJnY29sb3I7XG4gICAgICAgICAgICBjdHguZmlsbCgpO1xuICAgICAgICAgICAgY3R4LmZvbnQgPSBcIjkwMCBcIiArIChzaXplIC8gMikgKiAxLjIgKyBcInB4IExleGVuZCBEZWNhXCI7XG4gICAgICAgICAgICBjdHgudGV4dEFsaWduID0gXCJjZW50ZXJcIjtcbiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBtYWluY29sb3I7XG4gICAgICAgICAgICBjdHguZmlsbFRleHQoXCJtdFwiLCBzaXplIC8gMiArIDEsIChzaXplIC8gMykgKiAyLjEpO1xuICAgICAgICAgICAgLy8gJChcImJvZHlcIikucHJlcGVuZChjYW52YXMpO1xuICAgICAgICAgICAgJChcIiNmYXZpY29uXCIpLmF0dHIoXCJocmVmXCIsIGNhbnZhcy50b0RhdGFVUkwoXCJpbWFnZS9wbmdcIikpO1xuICAgICAgICB9KSwgMTI1KTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGNsZWFyQ3VzdG9tVGhlbWUoKSB7XG4gICAgZXhwb3J0cy5jb2xvclZhcnMuZm9yRWFjaCgoZSkgPT4ge1xuICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoZSwgXCJcIik7XG4gICAgfSk7XG59XG5jb25zdCBsb2FkU3R5bGUgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsaW5rXCIpO1xuICAgICAgICAgICAgbGluay50eXBlID0gXCJ0ZXh0L2Nzc1wiO1xuICAgICAgICAgICAgbGluay5yZWwgPSBcInN0eWxlc2hlZXRcIjtcbiAgICAgICAgICAgIGxpbmsuaWQgPSBcImN1cnJlbnRUaGVtZVwiO1xuICAgICAgICAgICAgbGluay5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChuYW1lID09PSBcImN1c3RvbVwiKSB7XG4gICAgICAgICAgICAgICAgbGluay5ocmVmID0gYHRoZW1lcy9zZXJpa2FfZGFyay5jc3NgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbGluay5ocmVmID0gYHRoZW1lcy8ke25hbWV9LmNzc2A7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBoZWFkU2NyaXB0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjdXJyZW50VGhlbWVcIik7XG4gICAgICAgICAgICBoZWFkU2NyaXB0LnJlcGxhY2VXaXRoKGxpbmspO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn07XG4vLyBleHBvcnQgZnVuY3Rpb24gY2hhbmdlQ3VzdG9tVGhlbWUodGhlbWVJZDogc3RyaW5nLCBub3NhdmUgPSBmYWxzZSk6IHZvaWQge1xuLy8gICBjb25zdCBjdXN0b21UaGVtZXMgPSBEQi5nZXRTbmFwc2hvdCgpLmN1c3RvbVRoZW1lcztcbi8vICAgY29uc3QgY29sb3JzID0gY3VzdG9tVGhlbWVzLmZpbmQoKGUpID0+IGUuX2lkID09PSB0aGVtZUlkKVxuLy8gICAgID8uY29sb3JzIGFzIHN0cmluZ1tdO1xuLy8gICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWVDb2xvcnMoY29sb3JzLCBub3NhdmUpO1xuLy8gfVxuZnVuY3Rpb24gYXBwbHkodGhlbWVOYW1lLCBpc0N1c3RvbSwgaXNQcmV2aWV3ID0gZmFsc2UpIHtcbiAgICBjbGVhckN1c3RvbVRoZW1lKCk7XG4gICAgbGV0IG5hbWUgPSBcInNlcmlrYV9kYXJrXCI7XG4gICAgaWYgKCFpc0N1c3RvbSkge1xuICAgICAgICBuYW1lID0gdGhlbWVOYW1lO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgbmFtZSA9IFwiY3VzdG9tXCI7XG4gICAgfVxuICAgIFRoZW1lQ29sb3JzLnJlc2V0KCk7XG4gICAgJChcIi5rZXltYXAta2V5XCIpLmF0dHIoXCJzdHlsZVwiLCBcIlwiKTtcbiAgICAvLyAkKFwiI2N1cnJlbnRUaGVtZVwiKS5hdHRyKFwiaHJlZlwiLCBgdGhlbWVzLyR7bmFtZX0uY3NzYCk7XG4gICAgbG9hZFN0eWxlKG5hbWUpLnRoZW4oKCkgPT4ge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBUaGVtZUNvbG9ycy51cGRhdGUoKTtcbiAgICAgICAgaWYgKGlzQ3VzdG9tKSB7XG4gICAgICAgICAgICBsZXQgY29sb3JWYWx1ZXMgPSBjb25maWdfMS5kZWZhdWx0LmN1c3RvbVRoZW1lQ29sb3JzO1xuICAgICAgICAgICAgY29uc3Qgc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdCgpO1xuICAgICAgICAgICAgaWYgKGlzQ3VzdG9tICYmICFpc1ByZXZpZXcgJiYgc25hcHNob3QpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXN0b21Db2xvcnMgPSAoX2IgPSAoX2EgPSBzbmFwc2hvdC5jdXN0b21UaGVtZXMuZmluZCgoZSkgPT4gZS5faWQgPT09IHRoZW1lTmFtZSkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jb2xvcnMpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IFtdO1xuICAgICAgICAgICAgICAgIGlmIChjdXN0b21Db2xvcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWVDb2xvcnMoY3VzdG9tQ29sb3JzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhlbWVOYW1lICE9PSBcImN1c3RvbVwiICYmIHNuYXBzaG90KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VzdG9tVGhlbWVzID0gc25hcHNob3QuY3VzdG9tVGhlbWVzO1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1c3RvbVRoZW1lQnlJZCA9IGN1c3RvbVRoZW1lcy5maW5kKChlKSA9PiBlLl9pZCA9PT0gdGhlbWVOYW1lKTtcbiAgICAgICAgICAgICAgICBjb2xvclZhbHVlcyA9IGN1c3RvbVRoZW1lQnlJZCA9PT0gbnVsbCB8fCBjdXN0b21UaGVtZUJ5SWQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGN1c3RvbVRoZW1lQnlJZC5jb2xvcnM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBleHBvcnRzLmNvbG9yVmFycy5mb3JFYWNoKChlLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eShlLCBjb2xvclZhbHVlc1tpbmRleF0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgQW5hbHl0aWNzQ29udHJvbGxlci5sb2coXCJjaGFuZ2VkVGhlbWVcIiwgeyB0aGVtZTogdGhlbWVOYW1lIH0pO1xuICAgICAgICBpZiAoIWlzUHJldmlldykge1xuICAgICAgICAgICAgVGhlbWVDb2xvcnMuZ2V0QWxsKCkudGhlbigoY29sb3JzKSA9PiB7XG4gICAgICAgICAgICAgICAgJChcIi5rZXltYXAta2V5XCIpLmF0dHIoXCJzdHlsZVwiLCBcIlwiKTtcbiAgICAgICAgICAgICAgICBDaGFydENvbnRyb2xsZXIudXBkYXRlQWxsQ2hhcnRDb2xvcnMoKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVGYXZpY29uKDEyOCwgMzIpO1xuICAgICAgICAgICAgICAgICQoXCIjbWV0YVRoZW1lQ29sb3JcIikuYXR0cihcImNvbnRlbnRcIiwgY29sb3JzLmJnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgICQoXCIuY3VycmVudC10aGVtZSAudGV4dFwiKS50ZXh0KGlzQ3VzdG9tID8gXCJjdXN0b21cIiA6IHRoZW1lTmFtZS5yZXBsYWNlKC9fL2csIFwiIFwiKSk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBwcmV2aWV3KHRoZW1lSWRlbnRpZmllciwgaXNDdXN0b20sIHJhbmRvbVRoZW1lID0gZmFsc2UpIHtcbiAgICBpc1ByZXZpZXdpbmdUaGVtZSA9IHRydWU7XG4gICAgYXBwbHkodGhlbWVJZGVudGlmaWVyLCBpc0N1c3RvbSwgIXJhbmRvbVRoZW1lKTtcbn1cbmV4cG9ydHMucHJldmlldyA9IHByZXZpZXc7XG5mdW5jdGlvbiBzZXQodGhlbWVJZGVudGlmaWVyLCBpc0N1c3RvbSkge1xuICAgIGFwcGx5KHRoZW1lSWRlbnRpZmllciwgaXNDdXN0b20pO1xufVxuZXhwb3J0cy5zZXQgPSBzZXQ7XG5mdW5jdGlvbiBjbGVhclByZXZpZXcoKSB7XG4gICAgaWYgKGlzUHJldmlld2luZ1RoZW1lKSB7XG4gICAgICAgIGlzUHJldmlld2luZ1RoZW1lID0gZmFsc2U7XG4gICAgICAgIGV4cG9ydHMucmFuZG9tVGhlbWUgPSBudWxsO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5jdXN0b21UaGVtZSkge1xuICAgICAgICAgICAgYXBwbHkoXCJjdXN0b21cIiwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhcHBseShjb25maWdfMS5kZWZhdWx0LnRoZW1lLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLmNsZWFyUHJldmlldyA9IGNsZWFyUHJldmlldztcbmZ1bmN0aW9uIHJhbmRvbWl6ZVRoZW1lKCkge1xuICAgIGxldCByYW5kb21MaXN0O1xuICAgIE1pc2MuZ2V0VGhlbWVzTGlzdCgpLnRoZW4oKHRoZW1lcykgPT4ge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5yYW5kb21UaGVtZSA9PT0gXCJmYXZcIiAmJiBjb25maWdfMS5kZWZhdWx0LmZhdlRoZW1lcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByYW5kb21MaXN0ID0gY29uZmlnXzEuZGVmYXVsdC5mYXZUaGVtZXM7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5yYW5kb21UaGVtZSA9PT0gXCJsaWdodFwiKSB7XG4gICAgICAgICAgICByYW5kb21MaXN0ID0gdGhlbWVzXG4gICAgICAgICAgICAgICAgLmZpbHRlcigodCkgPT4gTWlzYy5pc0NvbG9yTGlnaHQodC5iZ0NvbG9yKSlcbiAgICAgICAgICAgICAgICAubWFwKCh0KSA9PiB0Lm5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQucmFuZG9tVGhlbWUgPT09IFwiZGFya1wiKSB7XG4gICAgICAgICAgICByYW5kb21MaXN0ID0gdGhlbWVzXG4gICAgICAgICAgICAgICAgLmZpbHRlcigodCkgPT4gTWlzYy5pc0NvbG9yRGFyayh0LmJnQ29sb3IpKVxuICAgICAgICAgICAgICAgIC5tYXAoKHQpID0+IHQubmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5yYW5kb21UaGVtZSA9PT0gXCJvblwiKSB7XG4gICAgICAgICAgICByYW5kb21MaXN0ID0gdGhlbWVzLm1hcCgodCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0Lm5hbWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJhbmRvbUxpc3QgPSBEQi5nZXRTbmFwc2hvdCgpLmN1c3RvbVRoZW1lcy5tYXAoKGN0KSA9PiBjdC5faWQpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHByZXZpb3VzVGhlbWUgPSBleHBvcnRzLnJhbmRvbVRoZW1lO1xuICAgICAgICBleHBvcnRzLnJhbmRvbVRoZW1lID0gTWlzYy5yYW5kb21FbGVtZW50RnJvbUFycmF5KHJhbmRvbUxpc3QpO1xuICAgICAgICAvLyBpZiAoQ29uZmlnLnJhbmRvbVRoZW1lID09PSBcImN1c3RvbVwiKSB7XG4gICAgICAgIC8vIGNoYW5nZUN1c3RvbVRoZW1lKHJhbmRvbVRoZW1lLCB0cnVlKTtcbiAgICAgICAgLy8gfSBlbHNlIHtcbiAgICAgICAgcHJldmlldyhleHBvcnRzLnJhbmRvbVRoZW1lLCBjb25maWdfMS5kZWZhdWx0LnJhbmRvbVRoZW1lID09PSBcImN1c3RvbVwiKTtcbiAgICAgICAgLy8gfVxuICAgICAgICBpZiAocHJldmlvdXNUaGVtZSAhPSBleHBvcnRzLnJhbmRvbVRoZW1lKSB7XG4gICAgICAgICAgICBsZXQgbmFtZSA9IGV4cG9ydHMucmFuZG9tVGhlbWUucmVwbGFjZSgvXy9nLCBcIiBcIik7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5yYW5kb21UaGVtZSA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICAgICAgICAgIG5hbWUgPSAoKF9iID0gKF9hID0gREIuZ2V0U25hcHNob3QoKS5jdXN0b21UaGVtZXMuZmluZCgoY3QpID0+IGN0Ll9pZCA9PT0gZXhwb3J0cy5yYW5kb21UaGVtZSkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5uYW1lKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBcImN1c3RvbVwiKS5yZXBsYWNlKC9fL2csIFwiIFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKG5hbWUsIDApO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLnJhbmRvbWl6ZVRoZW1lID0gcmFuZG9taXplVGhlbWU7XG5mdW5jdGlvbiBjbGVhclJhbmRvbSgpIHtcbiAgICBpZiAoZXhwb3J0cy5yYW5kb21UaGVtZSA9PT0gbnVsbClcbiAgICAgICAgcmV0dXJuO1xuICAgIGV4cG9ydHMucmFuZG9tVGhlbWUgPSBudWxsO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmN1c3RvbVRoZW1lKSB7XG4gICAgICAgIGFwcGx5KFwiY3VzdG9tXCIsIHRydWUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgYXBwbHkoY29uZmlnXzEuZGVmYXVsdC50aGVtZSwgZmFsc2UpO1xuICAgIH1cbn1cbmV4cG9ydHMuY2xlYXJSYW5kb20gPSBjbGVhclJhbmRvbTtcbmZ1bmN0aW9uIGFwcGx5Q3VzdG9tQmFja2dyb3VuZFNpemUoKSB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tQmFja2dyb3VuZFNpemUgPT0gXCJtYXhcIikge1xuICAgICAgICAkKFwiLmN1c3RvbUJhY2tncm91bmQgaW1nXCIpLmNzcyh7XG4gICAgICAgICAgICAvLyB3aWR0aDogXCJjYWxjKDEwMCUpXCIsXG4gICAgICAgICAgICAvLyBoZWlnaHQ6IFwiY2FsYygxMDAlKVwiLFxuICAgICAgICAgICAgb2JqZWN0Rml0OiBcIlwiLFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIuY3VzdG9tQmFja2dyb3VuZCBpbWdcIikuY3NzKHtcbiAgICAgICAgICAgIG9iamVjdEZpdDogY29uZmlnXzEuZGVmYXVsdC5jdXN0b21CYWNrZ3JvdW5kU2l6ZSxcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5hcHBseUN1c3RvbUJhY2tncm91bmRTaXplID0gYXBwbHlDdXN0b21CYWNrZ3JvdW5kU2l6ZTtcbmZ1bmN0aW9uIGFwcGx5Q3VzdG9tQmFja2dyb3VuZCgpIHtcbiAgICAvLyAkKFwiLmN1c3RvbUJhY2tncm91bmRcIikuY3NzKHtcbiAgICAvLyAgIGJhY2tncm91bmRJbWFnZTogYHVybCgke0NvbmZpZy5jdXN0b21CYWNrZ3JvdW5kfSlgLFxuICAgIC8vICAgYmFja2dyb3VuZEF0dGFjaG1lbnQ6IFwiZml4ZWRcIixcbiAgICAvLyB9KTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5jdXN0b21CYWNrZ3JvdW5kID09PSBcIlwiKSB7XG4gICAgICAgICQoXCIjd29yZHNcIikucmVtb3ZlQ2xhc3MoXCJub0Vycm9yQm9yZGVyXCIpO1xuICAgICAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeVwiKS5yZW1vdmVDbGFzcyhcIm5vRXJyb3JCb3JkZXJcIik7XG4gICAgICAgICQoXCIuY3VzdG9tQmFja2dyb3VuZCBpbWdcIikucmVtb3ZlKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiI3dvcmRzXCIpLmFkZENsYXNzKFwibm9FcnJvckJvcmRlclwiKTtcbiAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnlcIikuYWRkQ2xhc3MoXCJub0Vycm9yQm9yZGVyXCIpO1xuICAgICAgICAkKFwiLmN1c3RvbUJhY2tncm91bmRcIikuaHRtbChgPGltZyBzcmM9XCIke2NvbmZpZ18xLmRlZmF1bHQuY3VzdG9tQmFja2dyb3VuZH1cIiAvPmApO1xuICAgICAgICBCYWNrZ3JvdW5kRmlsdGVyLmFwcGx5KCk7XG4gICAgICAgIGFwcGx5Q3VzdG9tQmFja2dyb3VuZFNpemUoKTtcbiAgICB9XG59XG5leHBvcnRzLmFwcGx5Q3VzdG9tQmFja2dyb3VuZCA9IGFwcGx5Q3VzdG9tQmFja2dyb3VuZDtcbihfYiA9IChfYSA9IHdpbmRvd1xuICAgIC5tYXRjaE1lZGlhKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2FsbCh3aW5kb3csIFwiKHByZWZlcnMtY29sb3Itc2NoZW1lOiBkYXJrKVwiKSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgKGV2ZW50KSA9PiB7XG4gICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LmF1dG9Td2l0Y2hUaGVtZSB8fCBjb25maWdfMS5kZWZhdWx0LmN1c3RvbVRoZW1lKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKGV2ZW50Lm1hdGNoZXMpIHtcbiAgICAgICAgc2V0KGNvbmZpZ18xLmRlZmF1bHQudGhlbWVEYXJrLCBmYWxzZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBzZXQoY29uZmlnXzEuZGVmYXVsdC50aGVtZUxpZ2h0LCBmYWxzZSk7XG4gICAgfVxufSk7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5LCBldmVudFZhbHVlLCBub3NhdmUpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiY3VzdG9tVGhlbWVcIikge1xuICAgICAgICBldmVudFZhbHVlID8gc2V0KFwiY3VzdG9tXCIsIHRydWUpIDogc2V0KGNvbmZpZ18xLmRlZmF1bHQudGhlbWUsIGZhbHNlKTtcbiAgICB9XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImN1c3RvbVRoZW1lQ29sb3JzXCIpIHtcbiAgICAgICAgbm9zYXZlID8gcHJldmlldyhcImN1c3RvbVwiLCB0cnVlKSA6IHNldChcImN1c3RvbVwiLCB0cnVlKTtcbiAgICB9XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcInRoZW1lXCIpIHtcbiAgICAgICAgY2xlYXJQcmV2aWV3KCk7XG4gICAgICAgIHNldChldmVudFZhbHVlLCBmYWxzZSk7XG4gICAgfVxuICAgIGlmIChldmVudEtleSA9PT0gXCJzZXRUaGVtZXNcIikge1xuICAgICAgICBjbGVhclByZXZpZXcoKTtcbiAgICAgICAgaWYgKGV2ZW50VmFsdWUpIHtcbiAgICAgICAgICAgIHNldChcImN1c3RvbVwiLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmF1dG9Td2l0Y2hUaGVtZSkge1xuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cubWF0Y2hNZWRpYSAmJlxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubWF0Y2hNZWRpYShcIihwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaylcIikubWF0Y2hlcykge1xuICAgICAgICAgICAgICAgICAgICBzZXQoY29uZmlnXzEuZGVmYXVsdC50aGVtZURhcmssIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNldChjb25maWdfMS5kZWZhdWx0LnRoZW1lTGlnaHQsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZXQoY29uZmlnXzEuZGVmYXVsdC50aGVtZSwgZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChldmVudEtleSA9PT0gXCJyYW5kb21UaGVtZVwiICYmIGV2ZW50VmFsdWUgPT09IFwib2ZmXCIpXG4gICAgICAgIGNsZWFyUmFuZG9tKCk7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImN1c3RvbUJhY2tncm91bmRcIilcbiAgICAgICAgYXBwbHlDdXN0b21CYWNrZ3JvdW5kKCk7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImN1c3RvbUJhY2tncm91bmRTaXplXCIpXG4gICAgICAgIGFwcGx5Q3VzdG9tQmFja2dyb3VuZFNpemUoKTtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiYXV0b1N3aXRjaFRoZW1lXCIpIHtcbiAgICAgICAgaWYgKGV2ZW50VmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cubWF0Y2hNZWRpYSAmJlxuICAgICAgICAgICAgICAgIHdpbmRvdy5tYXRjaE1lZGlhKFwiKHByZWZlcnMtY29sb3Itc2NoZW1lOiBkYXJrKVwiKS5tYXRjaGVzKSB7XG4gICAgICAgICAgICAgICAgc2V0KGNvbmZpZ18xLmRlZmF1bHQudGhlbWVEYXJrLCBmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZXQoY29uZmlnXzEuZGVmYXVsdC50aGVtZUxpZ2h0LCBmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzZXQoY29uZmlnXzEuZGVmYXVsdC50aGVtZSwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChldmVudEtleSA9PT0gXCJ0aGVtZUxpZ2h0XCIgJiZcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5hdXRvU3dpdGNoVGhlbWUgJiZcbiAgICAgICAgISh3aW5kb3cubWF0Y2hNZWRpYSAmJlxuICAgICAgICAgICAgd2luZG93Lm1hdGNoTWVkaWEoXCIocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspXCIpLm1hdGNoZXMpICYmXG4gICAgICAgICFub3NhdmUpIHtcbiAgICAgICAgc2V0KGNvbmZpZ18xLmRlZmF1bHQudGhlbWVMaWdodCwgZmFsc2UpO1xuICAgIH1cbiAgICBpZiAoZXZlbnRLZXkgPT09IFwidGhlbWVEYXJrXCIgJiZcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5hdXRvU3dpdGNoVGhlbWUgJiZcbiAgICAgICAgd2luZG93Lm1hdGNoTWVkaWEgJiZcbiAgICAgICAgd2luZG93Lm1hdGNoTWVkaWEoXCIocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspXCIpLm1hdGNoZXMgJiZcbiAgICAgICAgIW5vc2F2ZSkge1xuICAgICAgICBzZXQoY29uZmlnXzEuZGVmYXVsdC50aGVtZURhcmssIGZhbHNlKTtcbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudmVyaWZ5ID0gZXhwb3J0cy5zZXQgPSBleHBvcnRzLmRhdGEgPSB2b2lkIDA7XG5jb25zdCBhcGVfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vYXBlXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgU2V0dGluZ3MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BhZ2VzL3NldHRpbmdzXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBMb2FkZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2xvYWRlclwiKSk7XG5leHBvcnRzLmRhdGEgPSBudWxsO1xuZnVuY3Rpb24gc2V0KHZhbCkge1xuICAgIGV4cG9ydHMuZGF0YSA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0ID0gc2V0O1xuZnVuY3Rpb24gdmVyaWZ5KHVpZCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChleHBvcnRzLmRhdGEgPT09IG51bGwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiTGlua2luZyBEaXNjb3JkIGFjY291bnRcIiwgMCwgMyk7XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIGV4cG9ydHMuZGF0YS51aWQgPSB1aWQ7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5saW5rRGlzY29yZChleHBvcnRzLmRhdGEpO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBsaW5rIERpc2NvcmQ6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQWNjb3VudHMgbGlua2VkXCIsIDEpO1xuICAgICAgICBjb25zdCBzbmFwc2hvdCA9IERCLmdldFNuYXBzaG90KCk7XG4gICAgICAgIHNuYXBzaG90LmRpc2NvcmRJZCA9IHJlc3BvbnNlLmRhdGEuZGlkO1xuICAgICAgICBEQi5zZXRTbmFwc2hvdChzbmFwc2hvdCk7XG4gICAgICAgIFNldHRpbmdzLnVwZGF0ZURpc2NvcmRTZWN0aW9uKCk7XG4gICAgfSk7XG59XG5leHBvcnRzLnZlcmlmeSA9IHZlcmlmeTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudXBkYXRlTG9jYWxTdGF0cyA9IGV4cG9ydHMuc2F2ZUxvY2FsUmVzdWx0ID0gZXhwb3J0cy5zYXZlQ29uZmlnID0gZXhwb3J0cy51cGRhdGVMYk1lbW9yeSA9IGV4cG9ydHMuc2F2ZUxvY2FsVGFnUEIgPSBleHBvcnRzLmdldExvY2FsVGFnUEIgPSBleHBvcnRzLnNhdmVMb2NhbFBCID0gZXhwb3J0cy5nZXRMb2NhbFBCID0gZXhwb3J0cy5nZXRVc2VyQXZlcmFnZTEwID0gZXhwb3J0cy5nZXRVc2VySGlnaGVzdFdwbSA9IGV4cG9ydHMuZGVsZXRlQ3VzdG9tVGhlbWUgPSBleHBvcnRzLmVkaXRDdXN0b21UaGVtZSA9IGV4cG9ydHMuYWRkQ3VzdG9tVGhlbWUgPSBleHBvcnRzLmdldEN1c3RvbVRoZW1lQnlJZCA9IGV4cG9ydHMuZ2V0VXNlclJlc3VsdHMgPSBleHBvcnRzLmluaXRTbmFwc2hvdCA9IGV4cG9ydHMuc2V0U25hcHNob3QgPSBleHBvcnRzLmdldFNuYXBzaG90ID0gdm9pZCAwO1xuY29uc3QgYXBlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vYXBlXCIpKTtcbmNvbnN0IEFjY291bnRCdXR0b24gPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vZWxlbWVudHMvYWNjb3VudC1idXR0b25cIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IExvYWRpbmdQYWdlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3BhZ2VzL2xvYWRpbmdcIikpO1xuY29uc3QgZGVmYXVsdF9jb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9jb25zdGFudHMvZGVmYXVsdC1jb25maWdcIikpO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuL2ZpcmViYXNlXCIpO1xuY29uc3QgZGVmYXVsdF9zbmFwc2hvdF8xID0gcmVxdWlyZShcIi4vY29uc3RhbnRzL2RlZmF1bHQtc25hcHNob3RcIik7XG5sZXQgZGJTbmFwc2hvdDtcbmZ1bmN0aW9uIGdldFNuYXBzaG90KCkge1xuICAgIHJldHVybiBkYlNuYXBzaG90O1xufVxuZXhwb3J0cy5nZXRTbmFwc2hvdCA9IGdldFNuYXBzaG90O1xuZnVuY3Rpb24gc2V0U25hcHNob3QobmV3U25hcHNob3QpIHtcbiAgICB0cnkge1xuICAgICAgICBkZWxldGUgbmV3U25hcHNob3QuYmFubmVkO1xuICAgIH1cbiAgICBjYXRjaCAoX2EpIHsgfVxuICAgIHRyeSB7XG4gICAgICAgIGRlbGV0ZSBuZXdTbmFwc2hvdC52ZXJpZmllZDtcbiAgICB9XG4gICAgY2F0Y2ggKF9iKSB7IH1cbiAgICBkYlNuYXBzaG90ID0gbmV3U25hcHNob3Q7XG59XG5leHBvcnRzLnNldFNuYXBzaG90ID0gc2V0U25hcHNob3Q7XG5mdW5jdGlvbiBpbml0U25hcHNob3QoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZTtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAvL3NlbmQgYXBpIHJlcXVlc3Qgd2l0aCB0b2tlbiB0aGF0IHJldHVybnMgdGFncywgcHJlc2V0cywgYW5kIGRhdGEgbmVlZGVkIGZvciBzbmFwXG4gICAgICAgIGNvbnN0IHNuYXAgPSBkZWZhdWx0X3NuYXBzaG90XzEuZGVmYXVsdFNuYXA7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyID09IG51bGwpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgLy8gaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT0gXCJsb2FkaW5nXCIpIHtcbiAgICAgICAgICAgIC8vICAgTG9hZGluZ1BhZ2UudXBkYXRlQmFyKDIyLjUpO1xuICAgICAgICAgICAgLy8gfSBlbHNlIHtcbiAgICAgICAgICAgIC8vICAgTG9hZGluZ1BhZ2UudXBkYXRlQmFyKDE2KTtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIC8vIExvYWRpbmdQYWdlLnVwZGF0ZVRleHQoXCJEb3dubG9hZGluZyB1c2VyLi4uXCIpO1xuICAgICAgICAgICAgY29uc3QgW3VzZXJSZXNwb25zZSwgY29uZmlnUmVzcG9uc2UsIHRhZ3NSZXNwb25zZSwgcHJlc2V0c1Jlc3BvbnNlXSA9IHlpZWxkIFByb21pc2UuYWxsKFtcbiAgICAgICAgICAgICAgICBhcGVfMS5kZWZhdWx0LnVzZXJzLmdldERhdGEoKSxcbiAgICAgICAgICAgICAgICBhcGVfMS5kZWZhdWx0LmNvbmZpZ3MuZ2V0KCksXG4gICAgICAgICAgICAgICAgYXBlXzEuZGVmYXVsdC51c2Vycy5nZXRUYWdzKCksXG4gICAgICAgICAgICAgICAgYXBlXzEuZGVmYXVsdC5wcmVzZXRzLmdldCgpLFxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICBpZiAodXNlclJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cge1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBgJHt1c2VyUmVzcG9uc2UubWVzc2FnZX0gKHVzZXIpYCxcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VDb2RlOiB1c2VyUmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY29uZmlnUmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyB7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGAke2NvbmZpZ1Jlc3BvbnNlLm1lc3NhZ2V9IChjb25maWcpYCxcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VDb2RlOiBjb25maWdSZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0YWdzUmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyB7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGAke3RhZ3NSZXNwb25zZS5tZXNzYWdlfSAodGFncylgLFxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZUNvZGU6IHRhZ3NSZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwcmVzZXRzUmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyB7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGAke3ByZXNldHNSZXNwb25zZS5tZXNzYWdlfSAocHJlc2V0cylgLFxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZUNvZGU6IHByZXNldHNSZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IFt1c2VyRGF0YSwgY29uZmlnRGF0YSwgdGFnc0RhdGEsIHByZXNldHNEYXRhXSA9IFtcbiAgICAgICAgICAgICAgICB1c2VyUmVzcG9uc2UsXG4gICAgICAgICAgICAgICAgY29uZmlnUmVzcG9uc2UsXG4gICAgICAgICAgICAgICAgdGFnc1Jlc3BvbnNlLFxuICAgICAgICAgICAgICAgIHByZXNldHNSZXNwb25zZSxcbiAgICAgICAgICAgIF0ubWFwKChyZXNwb25zZSkgPT4gcmVzcG9uc2UuZGF0YSk7XG4gICAgICAgICAgICBzbmFwLm5hbWUgPSB1c2VyRGF0YS5uYW1lO1xuICAgICAgICAgICAgc25hcC5wZXJzb25hbEJlc3RzID0gdXNlckRhdGEucGVyc29uYWxCZXN0cztcbiAgICAgICAgICAgIHNuYXAuYmFubmVkID0gdXNlckRhdGEuYmFubmVkO1xuICAgICAgICAgICAgc25hcC52ZXJpZmllZCA9IHVzZXJEYXRhLnZlcmlmaWVkO1xuICAgICAgICAgICAgc25hcC5kaXNjb3JkSWQgPSB1c2VyRGF0YS5kaXNjb3JkSWQ7XG4gICAgICAgICAgICBzbmFwLmdsb2JhbFN0YXRzID0ge1xuICAgICAgICAgICAgICAgIHRpbWU6IHVzZXJEYXRhLnRpbWVUeXBpbmcsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogdXNlckRhdGEuc3RhcnRlZFRlc3RzLFxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogdXNlckRhdGEuY29tcGxldGVkVGVzdHMsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKHVzZXJEYXRhLnF1b3RlTW9kID09PSB0cnVlKVxuICAgICAgICAgICAgICAgIHNuYXAucXVvdGVNb2QgPSB0cnVlO1xuICAgICAgICAgICAgc25hcC5xdW90ZVJhdGluZ3MgPSB1c2VyRGF0YS5xdW90ZVJhdGluZ3M7XG4gICAgICAgICAgICBzbmFwLmZhdm91cml0ZVRoZW1lcyA9XG4gICAgICAgICAgICAgICAgdXNlckRhdGEuZmF2b3VyaXRlVGhlbWVzID09PSB1bmRlZmluZWQgPyBbXSA6IHVzZXJEYXRhLmZhdm91cml0ZVRoZW1lcztcbiAgICAgICAgICAgIGlmICgoKF9hID0gdXNlckRhdGEubGJNZW1vcnkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50aW1lMTUpIHx8ICgoX2IgPSB1c2VyRGF0YS5sYk1lbW9yeSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnRpbWU2MCkpIHtcbiAgICAgICAgICAgICAgICAvL29sZCBtZW1vcnkgZm9ybWF0XG4gICAgICAgICAgICAgICAgc25hcC5sYk1lbW9yeSA9IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodXNlckRhdGEubGJNZW1vcnkpIHtcbiAgICAgICAgICAgICAgICBzbmFwLmxiTWVtb3J5ID0gdXNlckRhdGEubGJNZW1vcnk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBpZiAoQWN0aXZlUGFnZS5nZXQoKSA9PSBcImxvYWRpbmdcIikge1xuICAgICAgICAgICAgLy8gICBMb2FkaW5nUGFnZS51cGRhdGVCYXIoNDUpO1xuICAgICAgICAgICAgLy8gfSBlbHNlIHtcbiAgICAgICAgICAgIC8vICAgTG9hZGluZ1BhZ2UudXBkYXRlQmFyKDMyKTtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIC8vIExvYWRpbmdQYWdlLnVwZGF0ZVRleHQoXCJEb3dubG9hZGluZyBjb25maWcuLi5cIik7XG4gICAgICAgICAgICBpZiAoY29uZmlnRGF0YSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0NvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRfY29uZmlnXzEuZGVmYXVsdCk7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gY29uZmlnRGF0YS5jb25maWcpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBjb25maWdEYXRhLmNvbmZpZ1trZXldO1xuICAgICAgICAgICAgICAgICAgICBuZXdDb25maWdba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzbmFwLmNvbmZpZyA9IG5ld0NvbmZpZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGlmIChBY3RpdmVQYWdlLmdldCgpID09IFwibG9hZGluZ1wiKSB7XG4gICAgICAgICAgICAvLyAgIExvYWRpbmdQYWdlLnVwZGF0ZUJhcig2Ny41KTtcbiAgICAgICAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyAgIExvYWRpbmdQYWdlLnVwZGF0ZUJhcig0OCk7XG4gICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAvLyBMb2FkaW5nUGFnZS51cGRhdGVUZXh0KFwiRG93bmxvYWRpbmcgdGFncy4uLlwiKTtcbiAgICAgICAgICAgIHNuYXAuY3VzdG9tVGhlbWVzID0gKF9jID0gdXNlckRhdGEuY3VzdG9tVGhlbWVzKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiBbXTtcbiAgICAgICAgICAgIHNuYXAudGFncyA9IHRhZ3NEYXRhO1xuICAgICAgICAgICAgc25hcC50YWdzID0gKF9kID0gc25hcC50YWdzKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Quc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChhLm5hbWUgPiBiLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGEubmFtZSA8IGIubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIGlmIChBY3RpdmVQYWdlLmdldCgpID09IFwibG9hZGluZ1wiKSB7XG4gICAgICAgICAgICAvLyAgIExvYWRpbmdQYWdlLnVwZGF0ZUJhcig5MCk7XG4gICAgICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gICBMb2FkaW5nUGFnZS51cGRhdGVCYXIoNjQpO1xuICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgLy8gTG9hZGluZ1BhZ2UudXBkYXRlVGV4dChcIkRvd25sb2FkaW5nIHByZXNldHMuLi5cIik7XG4gICAgICAgICAgICBzbmFwLnByZXNldHMgPSBwcmVzZXRzRGF0YTtcbiAgICAgICAgICAgIHNuYXAucHJlc2V0cyA9IChfZSA9IHNuYXAucHJlc2V0cykgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoYS5uYW1lID4gYi5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChhLm5hbWUgPCBiLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkYlNuYXBzaG90ID0gc25hcDtcbiAgICAgICAgICAgIHJldHVybiBkYlNuYXBzaG90O1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBkYlNuYXBzaG90ID0gZGVmYXVsdF9zbmFwc2hvdF8xLmRlZmF1bHRTbmFwO1xuICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5pbml0U25hcHNob3QgPSBpbml0U25hcHNob3Q7XG5mdW5jdGlvbiBnZXRVc2VyUmVzdWx0cygpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCB1c2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgICAgICBpZiAodXNlciA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAoZGJTbmFwc2hvdCA9PT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKGRiU25hcHNob3QucmVzdWx0cyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIExvYWRpbmdQYWdlLnVwZGF0ZVRleHQoXCJEb3dubG9hZGluZyByZXN1bHRzLi4uXCIpO1xuICAgICAgICAgICAgTG9hZGluZ1BhZ2UudXBkYXRlQmFyKDkwKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5yZXN1bHRzLmdldCgpO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJFcnJvciBnZXR0aW5nIHJlc3VsdHM6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgcmVzdWx0cy5mb3JFYWNoKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmJhaWxlZE91dCA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQuYmFpbGVkT3V0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5ibGluZE1vZGUgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmJsaW5kTW9kZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubGF6eU1vZGUgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmxhenlNb2RlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5kaWZmaWN1bHR5ID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kaWZmaWN1bHR5ID0gXCJub3JtYWxcIjtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmZ1bmJveCA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQuZnVuYm94ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5sYW5ndWFnZSA9PT0gdW5kZWZpbmVkIHx8IHJlc3VsdC5sYW5ndWFnZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQubGFuZ3VhZ2UgPSBcImVuZ2xpc2hcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5udW1iZXJzID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5udW1iZXJzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5wdW5jdHVhdGlvbiA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVuY3R1YXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGJTbmFwc2hvdC5yZXN1bHRzID0gcmVzdWx0cyA9PT0gbnVsbCB8fCByZXN1bHRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXN1bHRzLnNvcnQoKGEsIGIpID0+IGIudGltZXN0YW1wIC0gYS50aW1lc3RhbXApO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0VXNlclJlc3VsdHMgPSBnZXRVc2VyUmVzdWx0cztcbmZ1bmN0aW9uIGdldEN1c3RvbVRoZW1lQnlJZCh0aGVtZUlEKSB7XG4gICAgcmV0dXJuIGRiU25hcHNob3QuY3VzdG9tVGhlbWVzLmZpbmQoKHQpID0+IHQuX2lkID09PSB0aGVtZUlEKTtcbn1cbmV4cG9ydHMuZ2V0Q3VzdG9tVGhlbWVCeUlkID0gZ2V0Q3VzdG9tVGhlbWVCeUlkO1xuZnVuY3Rpb24gYWRkQ3VzdG9tVGhlbWUodGhlbWUpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoZGJTbmFwc2hvdCA9PT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKGRiU25hcHNob3QuY3VzdG9tVGhlbWVzLmxlbmd0aCA+PSAxMCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJUb28gbWFueSBjdXN0b20gdGhlbWVzIVwiLCAwKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMuYWRkQ3VzdG9tVGhlbWUodGhlbWUpO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRXJyb3IgYWRkaW5nIGN1c3RvbSB0aGVtZTogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmV3Q3VzdG9tVGhlbWUgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHRoZW1lKSwgeyBfaWQ6IHJlc3BvbnNlLmRhdGEudGhlbWUuX2lkIH0pO1xuICAgICAgICBkYlNuYXBzaG90LmN1c3RvbVRoZW1lcy5wdXNoKG5ld0N1c3RvbVRoZW1lKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG59XG5leHBvcnRzLmFkZEN1c3RvbVRoZW1lID0gYWRkQ3VzdG9tVGhlbWU7XG5mdW5jdGlvbiBlZGl0Q3VzdG9tVGhlbWUodGhlbWVJZCwgbmV3VGhlbWUpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCB1c2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgICAgICBpZiAodXNlciA9PT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKGRiU25hcHNob3QgPT09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGNvbnN0IGN1c3RvbVRoZW1lID0gZGJTbmFwc2hvdC5jdXN0b21UaGVtZXMuZmluZCgodCkgPT4gdC5faWQgPT09IHRoZW1lSWQpO1xuICAgICAgICBpZiAoIWN1c3RvbVRoZW1lKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVkaXRpbmcgZmFpbGVkOiBDdXN0b20gdGhlbWUgd2l0aCBpZDogXCIgKyB0aGVtZUlkICsgXCIgZG9lcyBub3QgZXhpc3RcIiwgLTEpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5lZGl0Q3VzdG9tVGhlbWUodGhlbWVJZCwgbmV3VGhlbWUpO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRXJyb3IgZWRpdGluZyBjdXN0b20gdGhlbWU6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5ld0N1c3RvbVRoZW1lID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBuZXdUaGVtZSksIHsgX2lkOiB0aGVtZUlkIH0pO1xuICAgICAgICBkYlNuYXBzaG90LmN1c3RvbVRoZW1lc1tkYlNuYXBzaG90LmN1c3RvbVRoZW1lcy5pbmRleE9mKGN1c3RvbVRoZW1lKV0gPVxuICAgICAgICAgICAgbmV3Q3VzdG9tVGhlbWU7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xufVxuZXhwb3J0cy5lZGl0Q3VzdG9tVGhlbWUgPSBlZGl0Q3VzdG9tVGhlbWU7XG5mdW5jdGlvbiBkZWxldGVDdXN0b21UaGVtZSh0aGVtZUlkKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgdXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICAgICAgaWYgKHVzZXIgPT09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmIChkYlNuYXBzaG90ID09PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBjb25zdCBjdXN0b21UaGVtZSA9IGRiU25hcHNob3QuY3VzdG9tVGhlbWVzLmZpbmQoKHQpID0+IHQuX2lkID09PSB0aGVtZUlkKTtcbiAgICAgICAgaWYgKCFjdXN0b21UaGVtZSlcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmRlbGV0ZUN1c3RvbVRoZW1lKHRoZW1lSWQpO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRXJyb3IgZGVsZXRpbmcgY3VzdG9tIHRoZW1lOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBkYlNuYXBzaG90LmN1c3RvbVRoZW1lcyA9IGRiU25hcHNob3QuY3VzdG9tVGhlbWVzLmZpbHRlcigodCkgPT4gdC5faWQgIT09IHRoZW1lSWQpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZGVsZXRlQ3VzdG9tVGhlbWUgPSBkZWxldGVDdXN0b21UaGVtZTtcbmZ1bmN0aW9uIGdldFVzZXJIaWdoZXN0V3BtKG1vZGUsIG1vZGUyLCBwdW5jdHVhdGlvbiwgbGFuZ3VhZ2UsIGRpZmZpY3VsdHksIGxhenlNb2RlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgZnVuY3Rpb24gY29udCgpIHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIGxldCB0b3BXcG0gPSAwO1xuICAgICAgICAgICAgKF9hID0gZGJTbmFwc2hvdC5yZXN1bHRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5tb2RlID09IG1vZGUgJiZcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lm1vZGUyID09IG1vZGUyICYmXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdW5jdHVhdGlvbiA9PSBwdW5jdHVhdGlvbiAmJlxuICAgICAgICAgICAgICAgICAgICByZXN1bHQubGFuZ3VhZ2UgPT0gbGFuZ3VhZ2UgJiZcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRpZmZpY3VsdHkgPT0gZGlmZmljdWx0eSAmJlxuICAgICAgICAgICAgICAgICAgICAocmVzdWx0LmxhenlNb2RlID09PSBsYXp5TW9kZSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgKHJlc3VsdC5sYXp5TW9kZSA9PT0gdW5kZWZpbmVkICYmIGxhenlNb2RlID09PSBmYWxzZSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQud3BtID4gdG9wV3BtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3BXcG0gPSByZXN1bHQud3BtO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdG9wV3BtO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJldHZhbCA9IGRiU25hcHNob3QgPT09IG51bGwgfHwgZGJTbmFwc2hvdC5yZXN1bHRzID09PSB1bmRlZmluZWQgPyAwIDogY29udCgpO1xuICAgICAgICByZXR1cm4gcmV0dmFsO1xuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRVc2VySGlnaGVzdFdwbSA9IGdldFVzZXJIaWdoZXN0V3BtO1xuZnVuY3Rpb24gZ2V0VXNlckF2ZXJhZ2UxMChtb2RlLCBtb2RlMiwgcHVuY3R1YXRpb24sIGxhbmd1YWdlLCBkaWZmaWN1bHR5LCBsYXp5TW9kZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IHNuYXBzaG90ID0gZ2V0U25hcHNob3QoKTtcbiAgICAgICAgaWYgKCFzbmFwc2hvdClcbiAgICAgICAgICAgIHJldHVybiBbMCwgMF07XG4gICAgICAgIGZ1bmN0aW9uIGNvbnQoKSB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICBjb25zdCBhY3RpdmVUYWdJZHMgPSBbXTtcbiAgICAgICAgICAgIChfYSA9IHNuYXBzaG90LnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGFnLmFjdGl2ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBhY3RpdmVUYWdJZHMucHVzaCh0YWcuX2lkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxldCB3cG1TdW0gPSAwO1xuICAgICAgICAgICAgbGV0IGFjY1N1bSA9IDA7XG4gICAgICAgICAgICBsZXQgbGFzdDEwV3BtID0gMDtcbiAgICAgICAgICAgIGxldCBsYXN0MTBBY2MgPSAwO1xuICAgICAgICAgICAgbGV0IGNvdW50ID0gMDtcbiAgICAgICAgICAgIGxldCBsYXN0MTBDb3VudCA9IDA7XG4gICAgICAgICAgICBpZiAoc25hcHNob3QucmVzdWx0cyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCByZXN1bHQgb2Ygc25hcHNob3QucmVzdWx0cykge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lm1vZGUgPT09IG1vZGUgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdW5jdHVhdGlvbiA9PT0gcHVuY3R1YXRpb24gJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5sYW5ndWFnZSA9PT0gbGFuZ3VhZ2UgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kaWZmaWN1bHR5ID09PSBkaWZmaWN1bHR5ICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAocmVzdWx0LmxhenlNb2RlID09PSBsYXp5TW9kZSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChyZXN1bHQubGF6eU1vZGUgPT09IHVuZGVmaW5lZCAmJiBsYXp5TW9kZSA9PT0gZmFsc2UpKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgKGFjdGl2ZVRhZ0lkcy5sZW5ndGggPT09IDAgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVUYWdJZHMuc29tZSgodGFnSWQpID0+IHJlc3VsdC50YWdzLmluY2x1ZGVzKHRhZ0lkKSkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDb250aW51ZSBpZiB0aGUgbW9kZTIgZG9lc24ndCBtYXRjaCBhbmQgaXQncyBub3QgYSBxdW90ZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5tb2RlMiAhPT0gbW9kZTIgJiYgbW9kZSAhPT0gXCJxdW90ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBHcmFiIHRoZSBtb3N0IHJlY2VudCByZXN1bHRzIGZyb20gdGhlIGN1cnJlbnQgbW9kZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3QxMENvdW50IDwgMTApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0MTBXcG0gKz0gcmVzdWx0LndwbTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0MTBBY2MgKz0gcmVzdWx0LmFjYztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0MTBDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIG1vZGUyIG1hdGNoZXMgYW5kIGlmIGl0IGRvZXMsIGFkZCBpdCB0byB0aGUgc3VtLCBmb3IgcXVvdGVzLCB0aGlzIGlzIHRoZSBxdW90ZSBpZFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5tb2RlMiA9PT0gbW9kZTIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cG1TdW0gKz0gcmVzdWx0LndwbTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NTdW0gKz0gcmVzdWx0LmFjYztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCA+PSAxMClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBSZXR1cm4gdGhlIGxhc3QgMTAgYXZlcmFnZSB3cG0gJiBhY2MgZm9yIHF1b3RlXG4gICAgICAgICAgICAvLyBpZiB0aGUgY3VycmVudCBxdW90ZSBpZCBoYXMgbmV2ZXIgYmVlbiBjb21wbGV0ZWQgYmVmb3JlIGJ5IHRoZSB1c2VyXG4gICAgICAgICAgICBpZiAoY291bnQgPT09IDAgJiYgbW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtsYXN0MTBXcG0gLyBsYXN0MTBDb3VudCwgbGFzdDEwQWNjIC8gbGFzdDEwQ291bnRdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFt3cG1TdW0gLyBjb3VudCwgYWNjU3VtIC8gY291bnRdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJldHZhbCA9IHNuYXBzaG90ID09PSBudWxsIHx8ICh5aWVsZCBnZXRVc2VyUmVzdWx0cygpKSA9PT0gbnVsbCA/IFswLCAwXSA6IGNvbnQoKTtcbiAgICAgICAgcmV0dXJuIHJldHZhbDtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0VXNlckF2ZXJhZ2UxMCA9IGdldFVzZXJBdmVyYWdlMTA7XG5mdW5jdGlvbiBnZXRMb2NhbFBCKG1vZGUsIG1vZGUyLCBwdW5jdHVhdGlvbiwgbGFuZ3VhZ2UsIGRpZmZpY3VsdHksIGxhenlNb2RlLCBmdW5ib3gpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoZnVuYm94ICE9PSBcIm5vbmVcIiAmJiBmdW5ib3ggIT09IFwicGx1c19vbmVcIiAmJiBmdW5ib3ggIT09IFwicGx1c190d29cIikge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gY29udCgpIHtcbiAgICAgICAgICAgIGxldCByZXQgPSAwO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAoIWRiU25hcHNob3QucGVyc29uYWxCZXN0cylcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgICAgICAgICBkYlNuYXBzaG90LnBlcnNvbmFsQmVzdHNbbW9kZV1bbW9kZTJdLmZvckVhY2goKHBiKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYi5wdW5jdHVhdGlvbiA9PSBwdW5jdHVhdGlvbiAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgcGIuZGlmZmljdWx0eSA9PSBkaWZmaWN1bHR5ICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBwYi5sYW5ndWFnZSA9PSBsYW5ndWFnZSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgKHBiLmxhenlNb2RlID09PSBsYXp5TW9kZSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwYi5sYXp5TW9kZSA9PT0gdW5kZWZpbmVkICYmIGxhenlNb2RlID09PSBmYWxzZSkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBwYi53cG07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJldHZhbCA9IGRiU25hcHNob3QgPT09IG51bGwgPyAwIDogY29udCgpO1xuICAgICAgICByZXR1cm4gcmV0dmFsO1xuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRMb2NhbFBCID0gZ2V0TG9jYWxQQjtcbmZ1bmN0aW9uIHNhdmVMb2NhbFBCKG1vZGUsIG1vZGUyLCBwdW5jdHVhdGlvbiwgbGFuZ3VhZ2UsIGRpZmZpY3VsdHksIGxhenlNb2RlLCB3cG0sIGFjYywgcmF3LCBjb25zaXN0ZW5jeSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChtb2RlID09IFwicXVvdGVcIilcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgZnVuY3Rpb24gY29udCgpIHtcbiAgICAgICAgICAgIGxldCBmb3VuZCA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKGRiU25hcHNob3QucGVyc29uYWxCZXN0cyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgZGJTbmFwc2hvdC5wZXJzb25hbEJlc3RzID0ge1xuICAgICAgICAgICAgICAgICAgICB0aW1lOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgd29yZHM6IHt9LFxuICAgICAgICAgICAgICAgICAgICB6ZW46IHsgemVuOiBbXSB9LFxuICAgICAgICAgICAgICAgICAgICBxdW90ZTogeyBjdXN0b206IFtdIH0sXG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbTogeyBjdXN0b206IFtdIH0sXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkYlNuYXBzaG90LnBlcnNvbmFsQmVzdHNbbW9kZV0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGlmIChtb2RlID09PSBcInplblwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGRiU25hcHNob3QucGVyc29uYWxCZXN0c1tcInplblwiXSA9IHsgemVuOiBbXSB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGJTbmFwc2hvdC5wZXJzb25hbEJlc3RzW21vZGVdID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGJTbmFwc2hvdC5wZXJzb25hbEJlc3RzW21vZGVdW21vZGUyXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgZGJTbmFwc2hvdC5wZXJzb25hbEJlc3RzW21vZGVdW21vZGUyXSA9XG4gICAgICAgICAgICAgICAgICAgIFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGJTbmFwc2hvdC5wZXJzb25hbEJlc3RzW21vZGVdW21vZGUyXS5mb3JFYWNoKChwYikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChwYi5wdW5jdHVhdGlvbiA9PSBwdW5jdHVhdGlvbiAmJlxuICAgICAgICAgICAgICAgICAgICBwYi5kaWZmaWN1bHR5ID09IGRpZmZpY3VsdHkgJiZcbiAgICAgICAgICAgICAgICAgICAgcGIubGFuZ3VhZ2UgPT0gbGFuZ3VhZ2UgJiZcbiAgICAgICAgICAgICAgICAgICAgKHBiLmxhenlNb2RlID09PSBsYXp5TW9kZSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgKHBiLmxhenlNb2RlID09PSB1bmRlZmluZWQgJiYgbGF6eU1vZGUgPT09IGZhbHNlKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBwYi53cG0gPSB3cG07XG4gICAgICAgICAgICAgICAgICAgIHBiLmFjYyA9IGFjYztcbiAgICAgICAgICAgICAgICAgICAgcGIucmF3ID0gcmF3O1xuICAgICAgICAgICAgICAgICAgICBwYi50aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgICAgICAgICBwYi5jb25zaXN0ZW5jeSA9IGNvbnNpc3RlbmN5O1xuICAgICAgICAgICAgICAgICAgICBwYi5sYXp5TW9kZSA9IGxhenlNb2RlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCFmb3VuZCkge1xuICAgICAgICAgICAgICAgIC8vbm90aGluZyBmb3VuZFxuICAgICAgICAgICAgICAgIGRiU25hcHNob3QucGVyc29uYWxCZXN0c1ttb2RlXVttb2RlMl0ucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlOiBsYW5ndWFnZSxcbiAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eTogZGlmZmljdWx0eSxcbiAgICAgICAgICAgICAgICAgICAgbGF6eU1vZGU6IGxhenlNb2RlLFxuICAgICAgICAgICAgICAgICAgICBwdW5jdHVhdGlvbjogcHVuY3R1YXRpb24sXG4gICAgICAgICAgICAgICAgICAgIHdwbTogd3BtLFxuICAgICAgICAgICAgICAgICAgICBhY2M6IGFjYyxcbiAgICAgICAgICAgICAgICAgICAgcmF3OiByYXcsXG4gICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgICAgICAgICAgICAgY29uc2lzdGVuY3k6IGNvbnNpc3RlbmN5LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChkYlNuYXBzaG90ICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnQoKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5zYXZlTG9jYWxQQiA9IHNhdmVMb2NhbFBCO1xuZnVuY3Rpb24gZ2V0TG9jYWxUYWdQQih0YWdJZCwgbW9kZSwgbW9kZTIsIHB1bmN0dWF0aW9uLCBsYW5ndWFnZSwgZGlmZmljdWx0eSwgbGF6eU1vZGUpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBmdW5jdGlvbiBjb250KCkge1xuICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgIGxldCByZXQgPSAwO1xuICAgICAgICAgICAgY29uc3QgZmlsdGVyZWR0YWcgPSAoKF9hID0gZ2V0U25hcHNob3QoKS50YWdzKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBbXSkuZmlsdGVyKCh0KSA9PiB0Ll9pZCA9PT0gdGFnSWQpWzBdO1xuICAgICAgICAgICAgaWYgKGZpbHRlcmVkdGFnID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgICAgIGlmIChmaWx0ZXJlZHRhZy5wZXJzb25hbEJlc3RzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJlZHRhZy5wZXJzb25hbEJlc3RzID0ge1xuICAgICAgICAgICAgICAgICAgICB0aW1lOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgd29yZHM6IHt9LFxuICAgICAgICAgICAgICAgICAgICB6ZW46IHsgemVuOiBbXSB9LFxuICAgICAgICAgICAgICAgICAgICBxdW90ZTogeyBjdXN0b206IFtdIH0sXG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbTogeyBjdXN0b206IFtdIH0sXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGVyc29uYWxCZXN0cyA9ICgoX2IgPSBmaWx0ZXJlZHRhZy5wZXJzb25hbEJlc3RzW21vZGVdW21vZGUyXSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogW10pO1xuICAgICAgICAgICAgICAgIHBlcnNvbmFsQmVzdHMuZm9yRWFjaCgocGIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBiLnB1bmN0dWF0aW9uID09IHB1bmN0dWF0aW9uICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBwYi5kaWZmaWN1bHR5ID09IGRpZmZpY3VsdHkgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHBiLmxhbmd1YWdlID09IGxhbmd1YWdlICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAocGIubGF6eU1vZGUgPT09IGxhenlNb2RlIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKHBiLmxhenlNb2RlID09PSB1bmRlZmluZWQgJiYgbGF6eU1vZGUgPT09IGZhbHNlKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IHBiLndwbTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmV0dmFsID0gZGJTbmFwc2hvdCA9PT0gbnVsbCA/IDAgOiBjb250KCk7XG4gICAgICAgIHJldHVybiByZXR2YWw7XG4gICAgfSk7XG59XG5leHBvcnRzLmdldExvY2FsVGFnUEIgPSBnZXRMb2NhbFRhZ1BCO1xuZnVuY3Rpb24gc2F2ZUxvY2FsVGFnUEIodGFnSWQsIG1vZGUsIG1vZGUyLCBwdW5jdHVhdGlvbiwgbGFuZ3VhZ2UsIGRpZmZpY3VsdHksIGxhenlNb2RlLCB3cG0sIGFjYywgcmF3LCBjb25zaXN0ZW5jeSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChtb2RlID09IFwicXVvdGVcIilcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgZnVuY3Rpb24gY29udCgpIHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlcmVkdGFnID0gKF9hID0gZGJTbmFwc2hvdC50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmlsdGVyKCh0KSA9PiB0Ll9pZCA9PT0gdGFnSWQpWzBdO1xuICAgICAgICAgICAgaWYgKCFmaWx0ZXJlZHRhZy5wZXJzb25hbEJlc3RzKSB7XG4gICAgICAgICAgICAgICAgZmlsdGVyZWR0YWcucGVyc29uYWxCZXN0cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgdGltZToge30sXG4gICAgICAgICAgICAgICAgICAgIHdvcmRzOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgemVuOiB7IHplbjogW10gfSxcbiAgICAgICAgICAgICAgICAgICAgcXVvdGU6IHsgY3VzdG9tOiBbXSB9LFxuICAgICAgICAgICAgICAgICAgICBjdXN0b206IHsgY3VzdG9tOiBbXSB9LFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGxldCBmb3VuZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJlZHRhZy5wZXJzb25hbEJlc3RzW21vZGVdW21vZGUyXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkdGFnLnBlcnNvbmFsQmVzdHNbbW9kZV1bbW9kZTJdID1cbiAgICAgICAgICAgICAgICAgICAgICAgIFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmaWx0ZXJlZHRhZy5wZXJzb25hbEJlc3RzW21vZGVdW21vZGUyXS5mb3JFYWNoKChwYikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAocGIucHVuY3R1YXRpb24gPT0gcHVuY3R1YXRpb24gJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHBiLmRpZmZpY3VsdHkgPT0gZGlmZmljdWx0eSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgcGIubGFuZ3VhZ2UgPT0gbGFuZ3VhZ2UgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIChwYi5sYXp5TW9kZSA9PT0gbGF6eU1vZGUgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAocGIubGF6eU1vZGUgPT09IHVuZGVmaW5lZCAmJiBsYXp5TW9kZSA9PT0gZmFsc2UpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGIud3BtID0gd3BtO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGIuYWNjID0gYWNjO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGIucmF3ID0gcmF3O1xuICAgICAgICAgICAgICAgICAgICAgICAgcGIudGltZXN0YW1wID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBiLmNvbnNpc3RlbmN5ID0gY29uc2lzdGVuY3k7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYi5sYXp5TW9kZSA9IGxhenlNb2RlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkge1xuICAgICAgICAgICAgICAgICAgICAvL25vdGhpbmcgZm91bmRcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWR0YWcucGVyc29uYWxCZXN0c1ttb2RlXVttb2RlMl0ucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogbGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5OiBkaWZmaWN1bHR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgbGF6eU1vZGU6IGxhenlNb2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHVuY3R1YXRpb246IHB1bmN0dWF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgd3BtOiB3cG0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhY2M6IGFjYyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhdzogcmF3LFxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc2lzdGVuY3k6IGNvbnNpc3RlbmN5LFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIC8vdGhhdCBtb2RlIG9yIG1vZGUyIGlzIG5vdCBmb3VuZFxuICAgICAgICAgICAgICAgIGZpbHRlcmVkdGFnLnBlcnNvbmFsQmVzdHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWU6IHt9LFxuICAgICAgICAgICAgICAgICAgICB3b3Jkczoge30sXG4gICAgICAgICAgICAgICAgICAgIHplbjogeyB6ZW46IFtdIH0sXG4gICAgICAgICAgICAgICAgICAgIHF1b3RlOiB7IGN1c3RvbTogW10gfSxcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tOiB7IGN1c3RvbTogW10gfSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGlmIChtb2RlID09PSBcInplblwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkdGFnLnBlcnNvbmFsQmVzdHNbXCJ6ZW5cIl0gPSB7IHplbjogW10gfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkdGFnLnBlcnNvbmFsQmVzdHNbbW9kZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXN0b206IFtdLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmaWx0ZXJlZHRhZy5wZXJzb25hbEJlc3RzW21vZGVdW21vZGUyXSA9IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IGxhbmd1YWdlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eTogZGlmZmljdWx0eSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhenlNb2RlOiBsYXp5TW9kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHB1bmN0dWF0aW9uOiBwdW5jdHVhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHdwbTogd3BtLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWNjOiBhY2MsXG4gICAgICAgICAgICAgICAgICAgICAgICByYXc6IHJhdyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNpc3RlbmN5OiBjb25zaXN0ZW5jeSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChkYlNuYXBzaG90ICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnQoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgfSk7XG59XG5leHBvcnRzLnNhdmVMb2NhbFRhZ1BCID0gc2F2ZUxvY2FsVGFnUEI7XG5mdW5jdGlvbiB1cGRhdGVMYk1lbW9yeShtb2RlLCBtb2RlMiwgbGFuZ3VhZ2UsIHJhbmssIGFwaSA9IGZhbHNlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgLy9jb3VsZCBkYlNuYXBzaG90IGp1c3QgYmUgdXNlZCBoZXJlIGluc3RlYWQgb2YgZ2V0U25hcHNob3QoKVxuICAgICAgICBpZiAobW9kZSA9PT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHRpbWVNb2RlID0gbW9kZSwgdGltZU1vZGUyID0gbW9kZTI7XG4gICAgICAgICAgICBjb25zdCBzbmFwc2hvdCA9IGdldFNuYXBzaG90KCk7XG4gICAgICAgICAgICBpZiAoc25hcHNob3QubGJNZW1vcnkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHNuYXBzaG90LmxiTWVtb3J5ID0geyB0aW1lOiB7IDE1OiB7IGVuZ2xpc2g6IDAgfSwgNjA6IHsgZW5nbGlzaDogMCB9IH0gfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzbmFwc2hvdC5sYk1lbW9yeVt0aW1lTW9kZV0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHNuYXBzaG90LmxiTWVtb3J5W3RpbWVNb2RlXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgMTU6IHsgZW5nbGlzaDogMCB9LFxuICAgICAgICAgICAgICAgICAgICA2MDogeyBlbmdsaXNoOiAwIH0sXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzbmFwc2hvdC5sYk1lbW9yeVt0aW1lTW9kZV1bdGltZU1vZGUyXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgc25hcHNob3QubGJNZW1vcnlbdGltZU1vZGVdW3RpbWVNb2RlMl0gPSB7fTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnQgPSBzbmFwc2hvdC5sYk1lbW9yeVt0aW1lTW9kZV1bdGltZU1vZGUyXVtsYW5ndWFnZV07XG4gICAgICAgICAgICBzbmFwc2hvdC5sYk1lbW9yeVt0aW1lTW9kZV1bdGltZU1vZGUyXVtsYW5ndWFnZV0gPSByYW5rO1xuICAgICAgICAgICAgaWYgKGFwaSAmJiBjdXJyZW50ICE9IHJhbmspIHtcbiAgICAgICAgICAgICAgICB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLnVwZGF0ZUxlYWRlcmJvYXJkTWVtb3J5KG1vZGUsIG1vZGUyLCBsYW5ndWFnZSwgcmFuayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZXRTbmFwc2hvdChzbmFwc2hvdCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMudXBkYXRlTGJNZW1vcnkgPSB1cGRhdGVMYk1lbW9yeTtcbmZ1bmN0aW9uIHNhdmVDb25maWcoY29uZmlnKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgQWNjb3VudEJ1dHRvbi5sb2FkaW5nKHRydWUpO1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LmNvbmZpZ3Muc2F2ZShjb25maWcpO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gc2F2ZSBjb25maWc6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgQWNjb3VudEJ1dHRvbi5sb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5zYXZlQ29uZmlnID0gc2F2ZUNvbmZpZztcbmZ1bmN0aW9uIHNhdmVMb2NhbFJlc3VsdChyZXN1bHQpIHtcbiAgICBjb25zdCBzbmFwc2hvdCA9IGdldFNuYXBzaG90KCk7XG4gICAgaWYgKHNuYXBzaG90ICE9PSBudWxsICYmIHNuYXBzaG90LnJlc3VsdHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBzbmFwc2hvdC5yZXN1bHRzLnVuc2hpZnQocmVzdWx0KTtcbiAgICAgICAgc2V0U25hcHNob3Qoc25hcHNob3QpO1xuICAgIH1cbn1cbmV4cG9ydHMuc2F2ZUxvY2FsUmVzdWx0ID0gc2F2ZUxvY2FsUmVzdWx0O1xuZnVuY3Rpb24gdXBkYXRlTG9jYWxTdGF0cyhzdGF0cykge1xuICAgIGNvbnN0IHNuYXBzaG90ID0gZ2V0U25hcHNob3QoKTtcbiAgICBpZiAoc25hcHNob3QuZ2xvYmFsU3RhdHMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBzbmFwc2hvdC5nbG9iYWxTdGF0cyA9IHt9O1xuICAgIH1cbiAgICBpZiAoc25hcHNob3QgIT09IG51bGwgJiYgc25hcHNob3QuZ2xvYmFsU3RhdHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoc25hcHNob3QuZ2xvYmFsU3RhdHMudGltZSA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHNuYXBzaG90Lmdsb2JhbFN0YXRzLnRpbWUgPSBzdGF0cy50aW1lO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc25hcHNob3QuZ2xvYmFsU3RhdHMudGltZSArPSBzdGF0cy50aW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzbmFwc2hvdC5nbG9iYWxTdGF0cy5zdGFydGVkID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgc25hcHNob3QuZ2xvYmFsU3RhdHMuc3RhcnRlZCA9IHN0YXRzLnN0YXJ0ZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzbmFwc2hvdC5nbG9iYWxTdGF0cy5zdGFydGVkICs9IHN0YXRzLnN0YXJ0ZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNuYXBzaG90Lmdsb2JhbFN0YXRzLmNvbXBsZXRlZCA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHNuYXBzaG90Lmdsb2JhbFN0YXRzLmNvbXBsZXRlZCA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzbmFwc2hvdC5nbG9iYWxTdGF0cy5jb21wbGV0ZWQgKz0gMTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXRTbmFwc2hvdChzbmFwc2hvdCk7XG59XG5leHBvcnRzLnVwZGF0ZUxvY2FsU3RhdHMgPSB1cGRhdGVMb2NhbFN0YXRzO1xuLy8gZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIERCLmdldExvY2FsVGFnUEIodGFnSWQpIHtcbi8vICAgZnVuY3Rpb24gY29udCgpIHtcbi8vICAgICBsZXQgcmV0ID0gMDtcbi8vICAgICB0cnkge1xuLy8gICAgICAgcmV0ID0gZGJTbmFwc2hvdC50YWdzLmZpbHRlcigodCkgPT4gdC5pZCA9PT0gdGFnSWQpWzBdLnBiO1xuLy8gICAgICAgaWYgKHJldCA9PSB1bmRlZmluZWQpIHtcbi8vICAgICAgICAgcmV0ID0gMDtcbi8vICAgICAgIH1cbi8vICAgICAgIHJldHVybiByZXQ7XG4vLyAgICAgfSBjYXRjaCAoZSkge1xuLy8gICAgICAgcmV0dXJuIHJldDtcbi8vICAgICB9XG4vLyAgIH1cbi8vICAgY29uc3QgcmV0dmFsID0gZGJTbmFwc2hvdCAhPT0gbnVsbCA/IGNvbnQoKSA6IHVuZGVmaW5lZDtcbi8vICAgcmV0dXJuIHJldHZhbDtcbi8vIH1cbi8vIGV4cG9ydCBhc3luYyBmdW5jdGlvKHRhZ0lkLCB3cG0pIHtcbi8vICAgZnVuY3Rpb24gY29udCgpIHtcbi8vICAgICBkYlNuYXBzaG90LnRhZ3MuZm9yRWFjaCgodGFnKSA9PiB7XG4vLyAgICAgICBpZiAodGFnLl9pZCA9PT0gdGFnSWQpIHtcbi8vICAgICAgICAgdGFnLnBiID0gd3BtO1xuLy8gICAgICAgfVxuLy8gICAgIH0pO1xuLy8gICB9XG4vLyAgIGlmIChkYlNuYXBzaG90ICE9IG51bGwpIHtcbi8vICAgICBjb250KCk7XG4vLyAgIH1cbi8vIH1cbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZSA9IGV4cG9ydHMubG9hZGluZyA9IHZvaWQgMDtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi4vZmlyZWJhc2VcIik7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmZ1bmN0aW9uIGxvYWRpbmcodHJ1ZWZhbHNlKSB7XG4gICAgaWYgKHRydWVmYWxzZSkge1xuICAgICAgICAkKFwiI3RvcCAjbWVudSAuYWNjb3VudCAuaWNvblwiKS5odG1sKCc8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1zcGluIGZhLWNpcmNsZS1ub3RjaFwiPjwvaT4nKTtcbiAgICAgICAgJChcIiN0b3AgI21lbnUgLmFjY291bnRcIikuY3NzKFwib3BhY2l0eVwiLCAxKS5jc3MoXCJwb2ludGVyLWV2ZW50c1wiLCBcIm5vbmVcIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiI3RvcCAjbWVudSAuYWNjb3VudCAuaWNvblwiKS5odG1sKCc8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS11c2VyXCI+PC9pPicpO1xuICAgICAgICAkKFwiI3RvcCAjbWVudSAuYWNjb3VudFwiKS5jc3MoXCJvcGFjaXR5XCIsIDEpLmNzcyhcInBvaW50ZXItZXZlbnRzXCIsIFwiYXV0b1wiKTtcbiAgICB9XG59XG5leHBvcnRzLmxvYWRpbmcgPSBsb2FkaW5nO1xuZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgIT0gbnVsbCkge1xuICAgICAgICBNaXNjLnN3YXBFbGVtZW50cygkKFwiI21lbnUgLmljb24tYnV0dG9uLmxvZ2luXCIpLCAkKFwiI21lbnUgLmljb24tYnV0dG9uLmFjY291bnRcIiksIDI1MCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBNaXNjLnN3YXBFbGVtZW50cygkKFwiI21lbnUgLmljb24tYnV0dG9uLmFjY291bnRcIiksICQoXCIjbWVudSAuaWNvbi1idXR0b24ubG9naW5cIiksIDI1MCk7XG4gICAgfVxufVxuZXhwb3J0cy51cGRhdGUgPSB1cGRhdGU7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmdldExpc3QgPSBleHBvcnRzLnB1c2hDdXJyZW50ID0gZXhwb3J0cy5zZXRDdXJyZW50ID0gZXhwb3J0cy5kZWZhdWx0Q29tbWFuZHMgPSBleHBvcnRzLnVwZGF0ZVRoZW1lQ29tbWFuZHMgPSBleHBvcnRzLmNvbW1hbmRzQ2hhbGxlbmdlcyA9IGV4cG9ydHMudGhlbWVDb21tYW5kcyA9IGV4cG9ydHMudXBkYXRlQ3VzdG9tVGhlbWVMaXN0Q29tbWFuZHMgPSBleHBvcnRzLmN1c3RvbVRoZW1lTGlzdENvbW1hbmRzID0gZXhwb3J0cy5jdXN0b21UaGVtZUNvbW1hbmRzID0gZXhwb3J0cy5jb21tYW5kc0VuYWJsZUFkcyA9IGV4cG9ydHMudXBkYXRlUHJlc2V0Q29tbWFuZHMgPSBleHBvcnRzLnVwZGF0ZVRhZ0NvbW1hbmRzID0gZXhwb3J0cy5jb21tYW5kc0tleW1hcExheW91dHMgPSBleHBvcnRzLmN1cnJlbnQgPSB2b2lkIDA7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgU291bmQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL3NvdW5kLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgVGhlbWVDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy90aGVtZS1jb250cm9sbGVyXCIpKTtcbmNvbnN0IEN1c3RvbVRleHRQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcG9wdXBzL2N1c3RvbS10ZXh0LXBvcHVwXCIpKTtcbmNvbnN0IE1hbnVhbFJlc3RhcnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvbWFudWFsLXJlc3RhcnQtdHJhY2tlclwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBQcmFjdGlzZVdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3ByYWN0aXNlLXdvcmRzXCIpKTtcbmNvbnN0IFRlc3RVSSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LXVpXCIpKTtcbmNvbnN0IFRlc3RMb2dpYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LWxvZ2ljXCIpKTtcbmNvbnN0IEZ1bmJveCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9mdW5ib3hcIikpO1xuY29uc3QgVGFnQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvdGFnLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgUHJlc2V0Q29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvcHJlc2V0LWNvbnRyb2xsZXJcIikpO1xuY29uc3QgQ3VzdG9tVGV4dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9jdXN0b20tdGV4dFwiKSk7XG5jb25zdCBTZXR0aW5ncyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcGFnZXMvc2V0dGluZ3NcIikpO1xuY29uc3QgQ2hhbGxlbmdlQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvY2hhbGxlbmdlLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgUGFjZUNhcmV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3BhY2UtY2FyZXRcIikpO1xuY29uc3QgVGVzdElucHV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtaW5wdXRcIikpO1xuY29uc3QgTW9kZXNOb3RpY2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL21vZGVzLW5vdGljZVwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi4vZmlyZWJhc2VcIik7XG5leHBvcnRzLmN1cnJlbnQgPSBbXTtcbmZ1bmN0aW9uIGNhbkJhaWxPdXQoKSB7XG4gICAgcmV0dXJuICgoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiICYmXG4gICAgICAgIEN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmXG4gICAgICAgIChDdXN0b21UZXh0LndvcmQgPj0gNTAwMCB8fCBDdXN0b21UZXh0LndvcmQgPT0gMCkpIHx8XG4gICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgICFDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgIUN1c3RvbVRleHQuaXNUaW1lUmFuZG9tICYmXG4gICAgICAgICAgICBDdXN0b21UZXh0LnRleHQubGVuZ3RoID49IDUwMDApIHx8XG4gICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgIEN1c3RvbVRleHQuaXNUaW1lUmFuZG9tICYmXG4gICAgICAgICAgICAoQ3VzdG9tVGV4dC50aW1lID49IDM2MDAgfHwgQ3VzdG9tVGV4dC50aW1lID09IDApKSB8fFxuICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIgJiYgY29uZmlnXzEuZGVmYXVsdC53b3JkcyA+PSA1MDAwKSB8fFxuICAgICAgICBjb25maWdfMS5kZWZhdWx0LndvcmRzID09PSAwIHx8XG4gICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwidGltZVwiICYmIChjb25maWdfMS5kZWZhdWx0LnRpbWUgPj0gMzYwMCB8fCBjb25maWdfMS5kZWZhdWx0LnRpbWUgPT09IDApKSB8fFxuICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIik7XG59XG5jb25zdCBjb21tYW5kc0xheW91dHMgPSB7XG4gICAgdGl0bGU6IFwiTGF5b3V0IGVtdWxhdG9yLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImxheW91dFwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY291bGRub3Rsb2FkXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkNvdWxkIG5vdCBsb2FkIHRoZSBsYXlvdXRzIGxpc3QgOihcIixcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbk1pc2MuZ2V0TGF5b3V0c0xpc3QoKS50aGVuKChsYXlvdXRzKSA9PiB7XG4gICAgY29tbWFuZHNMYXlvdXRzLmxpc3QgPSBbXTtcbiAgICBjb21tYW5kc0xheW91dHMubGlzdC5wdXNoKHtcbiAgICAgICAgaWQ6IFwiY2hhbmdlTGF5b3V0RGVmYXVsdFwiLFxuICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICBjb25maWdWYWx1ZTogXCJkZWZhdWx0XCIsXG4gICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRMYXlvdXQoXCJkZWZhdWx0XCIpO1xuICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgfSxcbiAgICB9KTtcbiAgICBPYmplY3Qua2V5cyhsYXlvdXRzKS5mb3JFYWNoKChsYXlvdXQpID0+IHtcbiAgICAgICAgY29tbWFuZHNMYXlvdXRzLmxpc3QucHVzaCh7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VMYXlvdXRcIiArIE1pc2MuY2FwaXRhbGl6ZUZpcnN0TGV0dGVyT2ZFYWNoV29yZChsYXlvdXQpLFxuICAgICAgICAgICAgZGlzcGxheTogbGF5b3V0ID09PSBcImRlZmF1bHRcIiA/IFwib2ZmXCIgOiBsYXlvdXQucmVwbGFjZSgvXy9nLCBcIiBcIiksXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogbGF5b3V0LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZUNvbmZpZy5zZXRTYXZlZExheW91dChsYXlvdXQpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRMYXlvdXQobGF5b3V0KTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbmV4cG9ydHMuY29tbWFuZHNLZXltYXBMYXlvdXRzID0ge1xuICAgIHRpdGxlOiBcIkNoYW5nZSBrZXltYXAgbGF5b3V0Li4uXCIsXG4gICAgY29uZmlnS2V5OiBcImtleW1hcExheW91dFwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY291bGRub3Rsb2FkXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkNvdWxkIG5vdCBsb2FkIHRoZSBsYXlvdXRzIGxpc3QgOihcIixcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbk1pc2MuZ2V0TGF5b3V0c0xpc3QoKS50aGVuKChsYXlvdXRzKSA9PiB7XG4gICAgZXhwb3J0cy5jb21tYW5kc0tleW1hcExheW91dHMubGlzdCA9IFtdO1xuICAgIGV4cG9ydHMuY29tbWFuZHNLZXltYXBMYXlvdXRzLmxpc3QucHVzaCh7XG4gICAgICAgIGlkOiBcImNoYW5nZUtleW1hcExheW91dE92ZXJyaWRlU3luY1wiLFxuICAgICAgICBkaXNwbGF5OiBcImVtdWxhdG9yIHN5bmNcIixcbiAgICAgICAgY29uZmlnVmFsdWU6IFwib3ZlcnJpZGVTeW5jXCIsXG4gICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBMYXlvdXQoXCJvdmVycmlkZVN5bmNcIik7XG4gICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICB9LFxuICAgIH0pO1xuICAgIE9iamVjdC5rZXlzKGxheW91dHMpLmZvckVhY2goKGxheW91dCkgPT4ge1xuICAgICAgICBpZiAobGF5b3V0LnRvU3RyaW5nKCkgIT0gXCJkZWZhdWx0XCIpIHtcbiAgICAgICAgICAgIGV4cG9ydHMuY29tbWFuZHNLZXltYXBMYXlvdXRzLmxpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgaWQ6IFwiY2hhbmdlS2V5bWFwTGF5b3V0XCIgKyBNaXNjLmNhcGl0YWxpemVGaXJzdExldHRlck9mRWFjaFdvcmQobGF5b3V0KSxcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiBsYXlvdXQucmVwbGFjZSgvXy9nLCBcIiBcIiksXG4gICAgICAgICAgICAgICAgY29uZmlnVmFsdWU6IGxheW91dCxcbiAgICAgICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBMYXlvdXQobGF5b3V0KTtcbiAgICAgICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pO1xuY29uc3QgY29tbWFuZHNMYW5ndWFnZXMgPSB7XG4gICAgdGl0bGU6IFwiTGFuZ3VhZ2UuLi5cIixcbiAgICBjb25maWdLZXk6IFwibGFuZ3VhZ2VcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNvdWxkbm90bG9hZFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJDb3VsZCBub3QgbG9hZCB0aGUgbGFuZ3VhZ2VzIGxpc3QgOihcIixcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbW1hbmRzTGFuZ3VhZ2VzLmxpc3QgPSBbXTtcbk1pc2MuZ2V0TGFuZ3VhZ2VMaXN0KCkudGhlbigobGFuZ3VhZ2VzKSA9PiB7XG4gICAgbGFuZ3VhZ2VzLmZvckVhY2goKGxhbmd1YWdlKSA9PiB7XG4gICAgICAgIGNvbW1hbmRzTGFuZ3VhZ2VzLmxpc3QucHVzaCh7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VMYW5ndWFnZVwiICsgTWlzYy5jYXBpdGFsaXplRmlyc3RMZXR0ZXJPZkVhY2hXb3JkKGxhbmd1YWdlKSxcbiAgICAgICAgICAgIGRpc3BsYXk6IGxhbmd1YWdlLnJlcGxhY2UoL18vZywgXCIgXCIpLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGxhbmd1YWdlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRMYW5ndWFnZShsYW5ndWFnZSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG5jb25zdCBjb21tYW5kc0Z1bmJveCA9IHtcbiAgICB0aXRsZTogXCJGdW5ib3guLi5cIixcbiAgICBjb25maWdLZXk6IFwiZnVuYm94XCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VGdW5ib3hOb25lXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm5vbmVcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm5vbmVcIixcbiAgICAgICAgICAgIGFsaWFzOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChGdW5ib3guc2V0RnVuYm94KFwibm9uZVwiLCBudWxsKSkge1xuICAgICAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5NaXNjLmdldEZ1bmJveExpc3QoKS50aGVuKChmdW5ib3hlcykgPT4ge1xuICAgIGZ1bmJveGVzLmZvckVhY2goKGZ1bmJveCkgPT4ge1xuICAgICAgICBjb21tYW5kc0Z1bmJveC5saXN0LnB1c2goe1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlRnVuYm94XCIgKyBmdW5ib3gubmFtZSxcbiAgICAgICAgICAgIGRpc3BsYXk6IGZ1bmJveC5uYW1lLnJlcGxhY2UoL18vZywgXCIgXCIpLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZ1bmJveC5uYW1lLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChGdW5ib3guc2V0RnVuYm94KGZ1bmJveC5uYW1lLCBmdW5ib3gudHlwZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuY29uc3QgY29tbWFuZHNGb250cyA9IHtcbiAgICB0aXRsZTogXCJGb250IGZhbWlseS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJmb250RmFtaWx5XCIsXG4gICAgbGlzdDogW10sXG59O1xuTWlzYy5nZXRGb250c0xpc3QoKS50aGVuKChmb250cykgPT4ge1xuICAgIGZvbnRzLmZvckVhY2goKGZvbnQpID0+IHtcbiAgICAgICAgY29tbWFuZHNGb250cy5saXN0LnB1c2goe1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlRm9udFwiICsgZm9udC5uYW1lLnJlcGxhY2UoLyAvZywgXCJfXCIpLFxuICAgICAgICAgICAgZGlzcGxheTogZm9udC5kaXNwbGF5ICE9PSB1bmRlZmluZWQgPyBmb250LmRpc3BsYXkgOiBmb250Lm5hbWUsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZm9udC5uYW1lLFxuICAgICAgICAgICAgaG92ZXI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcucHJldmlld0ZvbnRGYW1pbHkoZm9udC5uYW1lKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZvbnRGYW1pbHkoZm9udC5uYW1lLnJlcGxhY2UoLyAvZywgXCJfXCIpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGNvbW1hbmRzRm9udHMubGlzdC5wdXNoKHtcbiAgICAgICAgaWQ6IFwic2V0Rm9udEZhbWlseUN1c3RvbVwiLFxuICAgICAgICBkaXNwbGF5OiBcImN1c3RvbS4uLlwiLFxuICAgICAgICBpbnB1dDogdHJ1ZSxcbiAgICAgICAgaG92ZXI6ICgpID0+IHtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5wcmV2aWV3Rm9udEZhbWlseShjb25maWdfMS5kZWZhdWx0LmZvbnRGYW1pbHkpO1xuICAgICAgICB9LFxuICAgICAgICBleGVjOiAobmFtZSkgPT4ge1xuICAgICAgICAgICAgaWYgKCFuYW1lKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGb250RmFtaWx5KG5hbWUucmVwbGFjZSgvXFxzL2csIFwiX1wiKSk7XG4gICAgICAgICAgICAvLyBTZXR0aW5ncy5ncm91cHMuZm9udEZhbWlseS51cGRhdGVJbnB1dCgpO1xuICAgICAgICB9LFxuICAgIH0pO1xufSk7XG5jb25zdCBjb21tYW5kc1RhZ3MgPSB7XG4gICAgdGl0bGU6IFwiQ2hhbmdlIHRhZ3MuLi5cIixcbiAgICBsaXN0OiBbXSxcbn07XG5mdW5jdGlvbiB1cGRhdGVUYWdDb21tYW5kcygpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgaWYgKChfYyA9IChfYiA9IChfYSA9IERCLmdldFNuYXBzaG90KCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50YWdzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGVuZ3RoKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiAwID4gMCkge1xuICAgICAgICBjb21tYW5kc1RhZ3MubGlzdCA9IFtdO1xuICAgICAgICBjb21tYW5kc1RhZ3MubGlzdC5wdXNoKHtcbiAgICAgICAgICAgIGlkOiBcImNsZWFyVGFnc1wiLFxuICAgICAgICAgICAgZGlzcGxheTogYENsZWFyIHRhZ3NgLFxuICAgICAgICAgICAgaWNvbjogXCJmYS10aW1lc1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICBjb25zdCBzbmFwc2hvdCA9IERCLmdldFNuYXBzaG90KCk7XG4gICAgICAgICAgICAgICAgc25hcHNob3QudGFncyA9IChfYSA9IHNuYXBzaG90LnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tYXAoKHRhZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0YWcuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0YWc7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgREIuc2V0U25hcHNob3Qoc25hcHNob3QpO1xuICAgICAgICAgICAgICAgIE1vZGVzTm90aWNlLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIFRhZ0NvbnRyb2xsZXIuc2F2ZUFjdGl2ZVRvTG9jYWxTdG9yYWdlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgKF9kID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgICAgICBsZXQgZGlzID0gdGFnLm5hbWU7XG4gICAgICAgICAgICBpZiAodGFnLmFjdGl2ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGRpcyA9ICc8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1jaGVja1wiPjwvaT4nICsgZGlzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZGlzID0gJzxpIGNsYXNzPVwiZmFzIGZhLWZ3XCI+PC9pPicgKyBkaXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb21tYW5kc1RhZ3MubGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgICBpZDogXCJ0b2dnbGVUYWdcIiArIHRhZy5faWQsXG4gICAgICAgICAgICAgICAgbm9JY29uOiB0cnVlLFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IGRpcyxcbiAgICAgICAgICAgICAgICBzdGlja3k6IHRydWUsXG4gICAgICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBUYWdDb250cm9sbGVyLnRvZ2dsZSh0YWcuX2lkKTtcbiAgICAgICAgICAgICAgICAgICAgTW9kZXNOb3RpY2UudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnBhY2VDYXJldCA9PT0gXCJhdmVyYWdlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFBhY2VDYXJldC5pbml0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBNb2Rlc05vdGljZS51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsZXQgdHh0ID0gdGFnLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YWcuYWN0aXZlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eHQgPSAnPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtY2hlY2tcIj48L2k+JyArIHR4dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR4dCA9ICc8aSBjbGFzcz1cImZhcyBmYS1md1wiPjwvaT4nICsgdHh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICgkKFwiI2NvbW1hbmRMaW5lXCIpLmhhc0NsYXNzKFwiYWxsQ29tbWFuZHNcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoYCNjb21tYW5kTGluZSAuc3VnZ2VzdGlvbnMgLmVudHJ5W2NvbW1hbmQ9J3RvZ2dsZVRhZyR7dGFnLl9pZH0nXWApLmh0bWwoYDxkaXYgY2xhc3M9XCJpY29uXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtdGFnXCI+PC9pPjwvZGl2PjxkaXY+VGFncyAgPiBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgJChgI2NvbW1hbmRMaW5lIC5zdWdnZXN0aW9ucyAuZW50cnlbY29tbWFuZD0ndG9nZ2xlVGFnJHt0YWcuX2lkfSddYCkuaHRtbCh0eHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gZGVmYXVsdENvbW1hbmRzLmxpc3RbNF0udmlzaWJsZSA9IHRydWU7XG4gICAgfVxufVxuZXhwb3J0cy51cGRhdGVUYWdDb21tYW5kcyA9IHVwZGF0ZVRhZ0NvbW1hbmRzO1xuY29uc3QgY29tbWFuZHNQcmVzZXRzID0ge1xuICAgIHRpdGxlOiBcIlByZXNldHMuLi5cIixcbiAgICBsaXN0OiBbXSxcbn07XG5mdW5jdGlvbiB1cGRhdGVQcmVzZXRDb21tYW5kcygpIHtcbiAgICBjb25zdCBzbmFwc2hvdCA9IERCLmdldFNuYXBzaG90KCk7XG4gICAgaWYgKCFzbmFwc2hvdCB8fCAhc25hcHNob3QucHJlc2V0cyB8fCBzbmFwc2hvdC5wcmVzZXRzLmxlbmd0aCA9PT0gMClcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbW1hbmRzUHJlc2V0cy5saXN0ID0gW107XG4gICAgc25hcHNob3QucHJlc2V0cy5mb3JFYWNoKChwcmVzZXQpID0+IHtcbiAgICAgICAgY29uc3QgZGlzID0gcHJlc2V0Lm5hbWU7XG4gICAgICAgIGNvbW1hbmRzUHJlc2V0cy5saXN0LnB1c2goe1xuICAgICAgICAgICAgaWQ6IFwiYXBwbHlQcmVzZXRcIiArIHByZXNldC5faWQsXG4gICAgICAgICAgICBkaXNwbGF5OiBkaXMsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgU2V0dGluZ3Muc2V0RXZlbnREaXNhYmxlZCh0cnVlKTtcbiAgICAgICAgICAgICAgICBQcmVzZXRDb250cm9sbGVyLmFwcGx5KHByZXNldC5faWQpO1xuICAgICAgICAgICAgICAgIFNldHRpbmdzLnNldEV2ZW50RGlzYWJsZWQoZmFsc2UpO1xuICAgICAgICAgICAgICAgIFNldHRpbmdzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIE1vZGVzTm90aWNlLnVwZGF0ZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5leHBvcnRzLnVwZGF0ZVByZXNldENvbW1hbmRzID0gdXBkYXRlUHJlc2V0Q29tbWFuZHM7XG5jb25zdCBjb21tYW5kc1JlcGVhdFF1b3RlcyA9IHtcbiAgICB0aXRsZTogXCJSZXBlYXQgcXVvdGVzLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInJlcGVhdFF1b3Rlc1wiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UmVwZWF0UXVvdGVzT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFJlcGVhdFF1b3RlcyhcIm9mZlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFJlcGVhdFF1b3Rlc1R5cGluZ1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJ0eXBpbmdcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcInR5cGluZ1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRSZXBlYXRRdW90ZXMoXCJ0eXBpbmdcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNMaXZlV3BtID0ge1xuICAgIHRpdGxlOiBcIkxpdmUgV1BNLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInNob3dMaXZlV3BtXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRMaXZlV3BtT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaG93TGl2ZVdwbShmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRMaXZlV3BtT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaG93TGl2ZVdwbSh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1Nob3dBdmVyYWdlID0ge1xuICAgIHRpdGxlOiBcIlNob3cgYXZlcmFnZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJzaG93QXZlcmFnZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U2hvd0F2ZXJhZ2VPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2hvd0F2ZXJhZ2UoXCJvZmZcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTaG93QXZlcmFnZVNwZWVkXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIndwbVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwid3BtXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNob3dBdmVyYWdlKFwid3BtXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U2hvd0F2ZXJhZ2VBY2NcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiYWNjdXJhY3lcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImFjY1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaG93QXZlcmFnZShcImFjY1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNob3dBdmVyYWdlQm90aFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJib3RoXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJib3RoXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNob3dBdmVyYWdlKFwiYm90aFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0xpdmVBY2MgPSB7XG4gICAgdGl0bGU6IFwiTGl2ZSBhY2N1cmFjeS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJzaG93TGl2ZUFjY1wiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0TGl2ZUFjY09mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2hvd0xpdmVBY2MoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0TGl2ZUFjY09uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2hvd0xpdmVBY2ModHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNMaXZlQnVyc3QgPSB7XG4gICAgdGl0bGU6IFwiTGl2ZSBidXJzdC4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJzaG93TGl2ZUJ1cnN0XCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRMaXZlQnVyc3RPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNob3dMaXZlQnVyc3QoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0TGl2ZUJ1cnN0T25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaG93TGl2ZUJ1cnN0KHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzU2hvd1RpbWVyID0ge1xuICAgIHRpdGxlOiBcIlRpbWVyL3Byb2dyZXNzLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInNob3dUaW1lclByb2dyZXNzXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRUaW1lclByb2dyZXNzT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaG93VGltZXJQcm9ncmVzcyhmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRUaW1lclByb2dyZXNzT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaG93VGltZXJQcm9ncmVzcyh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0tleVRpcHMgPSB7XG4gICAgdGl0bGU6IFwiS2V5IHRpcHMuLi5cIixcbiAgICBjb25maWdLZXk6IFwic2hvd0tleVRpcHNcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEtleVRpcHNPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleVRpcHMoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0S2V5VGlwc09uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5VGlwcyh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0ZyZWVkb21Nb2RlID0ge1xuICAgIHRpdGxlOiBcIkZyZWVkb20gbW9kZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJmcmVlZG9tTW9kZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0ZnJlZWRvbU1vZGVPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZyZWVkb21Nb2RlKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldGZyZWVkb21Nb2RlT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGcmVlZG9tTW9kZSh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1N0cmljdFNwYWNlID0ge1xuICAgIHRpdGxlOiBcIlN0cmljdCBzcGFjZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJzdHJpY3RTcGFjZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U3RyaWN0U3BhY2VPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFN0cmljdFNwYWNlKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFN0cmljdFNwYWNlT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTdHJpY3RTcGFjZSh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0JsaW5kTW9kZSA9IHtcbiAgICB0aXRsZTogXCJCbGluZCBtb2RlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImJsaW5kTW9kZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0QmxpbmRNb2RlT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRCbGluZE1vZGUoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0QmxpbmRNb2RlT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRCbGluZE1vZGUodHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNTaG93V29yZHNIaXN0b3J5ID0ge1xuICAgIHRpdGxlOiBcIkFsd2F5cyBzaG93IHdvcmRzIGhpc3RvcnkuLi5cIixcbiAgICBjb25maWdLZXk6IFwiYWx3YXlzU2hvd1dvcmRzSGlzdG9yeVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0QWx3YXlzU2hvd1dvcmRzSGlzdG9yeU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0QWx3YXlzU2hvd1dvcmRzSGlzdG9yeShmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRBbHdheXNTaG93V29yZHNIaXN0b3J5T25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRBbHdheXNTaG93V29yZHNIaXN0b3J5KHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzSW5kaWNhdGVUeXBvcyA9IHtcbiAgICB0aXRsZTogXCJJbmRpY2F0ZSB0eXBvcy4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJpbmRpY2F0ZVR5cG9zXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRJbmRpY2F0ZVR5cG9zT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEluZGljYXRlVHlwb3MoXCJvZmZcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRJbmRpY2F0ZVR5cG9zQmVsb3dcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiYmVsb3dcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImJlbG93XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEluZGljYXRlVHlwb3MoXCJiZWxvd1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEluZGljYXRlVHlwb3NSZXBsYWNlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInJlcGxhY2VcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcInJlcGxhY2VcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0SW5kaWNhdGVUeXBvcyhcInJlcGxhY2VcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNIaWRlRXh0cmFMZXR0ZXJzID0ge1xuICAgIHRpdGxlOiBcIkhpZGUgZXh0cmEgbGV0dGVycy4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJoaWRlRXh0cmFMZXR0ZXJzXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRIaWRlRXh0cmFMZXR0ZXJzT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRIaWRlRXh0cmFMZXR0ZXJzKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEhpZGVFeHRyYUxldHRlcnNPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEhpZGVFeHRyYUxldHRlcnModHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNRdWlja0VuZCA9IHtcbiAgICB0aXRsZTogXCJRdWljayBlbmQuLi5cIixcbiAgICBjb25maWdLZXk6IFwicXVpY2tFbmRcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFF1aWNrRW5kT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRRdWlja0VuZChmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRRdWlja0VuZE9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UXVpY2tFbmQodHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNPcHBvc2l0ZVNoaWZ0TW9kZSA9IHtcbiAgICB0aXRsZTogXCJDaGFuZ2Ugb3Bwb3NpdGUgc2hpZnQgbW9kZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJvcHBvc2l0ZVNoaWZ0TW9kZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0T3Bwb3NpdGVTaGlmdE1vZGVPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0T3Bwb3NpdGVTaGlmdE1vZGUoXCJvZmZcIik7XG4gICAgICAgICAgICAgICAgTW9kZXNOb3RpY2UudXBkYXRlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRPcHBvc2l0ZVNoaWZ0TW9kZU9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvblwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRPcHBvc2l0ZVNoaWZ0TW9kZShcIm9uXCIpO1xuICAgICAgICAgICAgICAgIE1vZGVzTm90aWNlLnVwZGF0ZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0T3Bwb3NpdGVTaGlmdE1vZGVLZXltYXBcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwia2V5bWFwXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJrZXltYXBcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0T3Bwb3NpdGVTaGlmdE1vZGUoXCJrZXltYXBcIik7XG4gICAgICAgICAgICAgICAgTW9kZXNOb3RpY2UudXBkYXRlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNTb3VuZE9uRXJyb3IgPSB7XG4gICAgdGl0bGU6IFwiU291bmQgb24gZXJyb3IuLi5cIixcbiAgICBjb25maWdLZXk6IFwicGxheVNvdW5kT25FcnJvclwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UGxheVNvdW5kT25FcnJvck9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGxheVNvdW5kT25FcnJvcihmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRQbGF5U291bmRPbkVycm9yT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQbGF5U291bmRPbkVycm9yKHRydWUpO1xuICAgICAgICAgICAgICAgIFNvdW5kLnBsYXlFcnJvcigpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzU291bmRWb2x1bWUgPSB7XG4gICAgdGl0bGU6IFwiU291bmQgdm9sdW1lLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInNvdW5kVm9sdW1lXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTb3VuZFZvbHVtZTAuMVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJxdWlldFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiMC4xXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNvdW5kVm9sdW1lKFwiMC4xXCIpO1xuICAgICAgICAgICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U291bmRWb2x1bWUwLjVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibWVkaXVtXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCIwLjVcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U291bmRWb2x1bWUoXCIwLjVcIik7XG4gICAgICAgICAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTb3VuZFZvbHVtZTEuMFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJsb3VkXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCIxLjBcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U291bmRWb2x1bWUoXCIxLjBcIik7XG4gICAgICAgICAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNGbGlwVGVzdENvbG9ycyA9IHtcbiAgICB0aXRsZTogXCJGbGlwIHRlc3QgY29sb3JzLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImZsaXBUZXN0Q29sb3JzXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRGbGlwVGVzdENvbG9yc09mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RmxpcFRlc3RDb2xvcnMoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0RmxpcFRlc3RDb2xvcnNPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZsaXBUZXN0Q29sb3JzKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzU21vb3RoTGluZVNjcm9sbCA9IHtcbiAgICB0aXRsZTogXCJTbW9vdGggbGluZSBzY3JvbGwuLi5cIixcbiAgICBjb25maWdLZXk6IFwic21vb3RoTGluZVNjcm9sbFwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U21vb3RoTGluZVNjcm9sbE9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U21vb3RoTGluZVNjcm9sbChmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTbW9vdGhMaW5lU2Nyb2xsT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTbW9vdGhMaW5lU2Nyb2xsKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzQWx3YXlzU2hvd0RlY2ltYWwgPSB7XG4gICAgdGl0bGU6IFwiQWx3YXlzIHNob3cgZGVjaW1hbCBwbGFjZXMuLi5cIixcbiAgICBjb25maWdLZXk6IFwiYWx3YXlzU2hvd0RlY2ltYWxQbGFjZXNcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRBbHdheXNTaG93RGVjaW1hbFBsYWNlcyhmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRBbHdheXNTaG93RGVjaW1hbFBsYWNlc09uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0QWx3YXlzU2hvd0RlY2ltYWxQbGFjZXModHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNBbHdheXNTaG93Q1BNID0ge1xuICAgIHRpdGxlOiBcIkFsd2F5cyBzaG93IENQTS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJhbHdheXNTaG93Q1BNXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRBbHdheXNTaG93Q1BNT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRBbHdheXNTaG93Q1BNKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEFsd2F5c1Nob3dDUE1PblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEFsd2F5c1Nob3dDUE0odHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNTdGFydEdyYXBoc0F0WmVybyA9IHtcbiAgICB0aXRsZTogXCJTdGFydCBncmFwaHMgYXQgemVyby4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJzdGFydEdyYXBoc0F0WmVyb1wiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U3RhcnRHcmFwaHNBdFplcm9PZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFN0YXJ0R3JhcGhzQXRaZXJvKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFN0YXJ0R3JhcGhzQXRaZXJvT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTdGFydEdyYXBoc0F0WmVybyh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0xhenlNb2RlID0ge1xuICAgIHRpdGxlOiBcIkxhenkgbW9kZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJsYXp5TW9kZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0TGF6eU1vZGVPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldExhenlNb2RlKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0TGF6eU1vZGVPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldExhenlNb2RlKHRydWUpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNTd2FwRXNjQW5kVGFiID0ge1xuICAgIHRpdGxlOiBcIlN3YXAgZXNjIGFuZCB0YWIuLi5cIixcbiAgICBjb25maWdLZXk6IFwic3dhcEVzY0FuZFRhYlwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U3dhcEVzY0FuZFRhYk9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U3dhcEVzY0FuZFRhYihmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTd2FwRXNjQW5kVGFiT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTd2FwRXNjQW5kVGFiKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzU2hvd0FsbExpbmVzID0ge1xuICAgIHRpdGxlOiBcIlNob3cgYWxsIGxpbmVzLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInNob3dBbGxMaW5lc1wiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U2hvd0FsbExpbmVzT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaG93QWxsTGluZXMoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U2hvd0FsbExpbmVzT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaG93QWxsTGluZXModHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNDb2xvcmZ1bE1vZGUgPSB7XG4gICAgdGl0bGU6IFwiQ29sb3JmdWwgbW9kZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJjb2xvcmZ1bE1vZGVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldENvbG9yZnVsTW9kZU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q29sb3JmdWxNb2RlKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldENvbG9yZnVsTW9kZU9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q29sb3JmdWxNb2RlKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzT3V0T2ZGb2N1c1dhcm5pbmcgPSB7XG4gICAgdGl0bGU6IFwiQ29sb3JmdWwgbW9kZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJzaG93T3V0T2ZGb2N1c1dhcm5pbmdcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNob3dPdXRPZkZvY3VzV2FybmluZ09mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2hvd091dE9mRm9jdXNXYXJuaW5nKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNob3dPdXRPZkZvY3VzV2FybmluZ09uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2hvd091dE9mRm9jdXNXYXJuaW5nKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzS2V5bWFwTW9kZSA9IHtcbiAgICB0aXRsZTogXCJLZXltYXAgbW9kZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJrZXltYXBNb2RlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRLZXltYXBNb2RlT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcE1vZGUoXCJvZmZcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRLZXltYXBNb2RlU3RhdGljXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInN0YXRpY1wiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwic3RhdGljXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcE1vZGUoXCJzdGF0aWNcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRLZXltYXBNb2RlTmV4dFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJuZXh0XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJuZXh0XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcE1vZGUoXCJuZXh0XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0S2V5bWFwTW9kZVJlYWN0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInJlYWN0XCIsXG4gICAgICAgICAgICBhbGlhczogXCJmbGFzaFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwicmVhY3RcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTW9kZShcInJlYWN0XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzU291bmRPbkNsaWNrID0ge1xuICAgIHRpdGxlOiBcIlNvdW5kIG9uIGNsaWNrLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInBsYXlTb3VuZE9uQ2xpY2tcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNvdW5kT25DbGlja09mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQbGF5U291bmRPbkNsaWNrKFwib2ZmXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U291bmRPbkNsaWNrMVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJjbGlja1wiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiMVwiLFxuICAgICAgICAgICAgaG92ZXI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBTb3VuZC5wcmV2aWV3Q2xpY2soXCIxXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGxheVNvdW5kT25DbGljayhcIjFcIik7XG4gICAgICAgICAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTb3VuZE9uQ2xpY2syXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImJlZXBcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjJcIixcbiAgICAgICAgICAgIGhvdmVyOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgU291bmQucHJldmlld0NsaWNrKFwiMlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBsYXlTb3VuZE9uQ2xpY2soXCIyXCIpO1xuICAgICAgICAgICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U291bmRPbkNsaWNrM1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJwb3BcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjNcIixcbiAgICAgICAgICAgIGhvdmVyOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgU291bmQucHJldmlld0NsaWNrKFwiM1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBsYXlTb3VuZE9uQ2xpY2soXCIzXCIpO1xuICAgICAgICAgICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U291bmRPbkNsaWNrNFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJuayBjcmVhbXNcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjRcIixcbiAgICAgICAgICAgIGhvdmVyOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgU291bmQucHJldmlld0NsaWNrKFwiNFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBsYXlTb3VuZE9uQ2xpY2soXCI0XCIpO1xuICAgICAgICAgICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U291bmRPbkNsaWNrNVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJ0eXBld3JpdGVyXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCI1XCIsXG4gICAgICAgICAgICBob3ZlcjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFNvdW5kLnByZXZpZXdDbGljayhcIjVcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQbGF5U291bmRPbkNsaWNrKFwiNVwiKTtcbiAgICAgICAgICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNvdW5kT25DbGljazZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib3N1XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCI2XCIsXG4gICAgICAgICAgICBob3ZlcjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFNvdW5kLnByZXZpZXdDbGljayhcIjZcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQbGF5U291bmRPbkNsaWNrKFwiNlwiKTtcbiAgICAgICAgICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNvdW5kT25DbGljazdcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiaGl0bWFya2VyXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCI3XCIsXG4gICAgICAgICAgICBob3ZlcjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFNvdW5kLnByZXZpZXdDbGljayhcIjdcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQbGF5U291bmRPbkNsaWNrKFwiN1wiKTtcbiAgICAgICAgICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1JhbmRvbVRoZW1lID0ge1xuICAgIHRpdGxlOiBcIlJhbmRvbSB0aGVtZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJyYW5kb21UaGVtZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UmFuZG9tT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFJhbmRvbVRoZW1lKFwib2ZmXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UmFuZG9tT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9uXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFJhbmRvbVRoZW1lKFwib25cIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRSYW5kb21GYXZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiZmF2XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJmYXZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UmFuZG9tVGhlbWUoXCJmYXZcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRSYW5kb21MaWdodFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJsaWdodFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwibGlnaHRcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UmFuZG9tVGhlbWUoXCJsaWdodFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFJhbmRvbURhcmtcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiZGFya1wiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiZGFya1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRSYW5kb21UaGVtZShcImRhcmtcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRSYW5kb21DdXN0b21cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiY3VzdG9tXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJjdXN0b21cIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiTXVsdGlwbGUgY3VzdG9tIHRoZW1lcyBhcmUgYXZhaWxhYmxlIHRvIGxvZ2dlZCBpbiB1c2VycyBvbmx5XCIsIDApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRSYW5kb21UaGVtZShcImN1c3RvbVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0RpZmZpY3VsdHkgPSB7XG4gICAgdGl0bGU6IFwiRGlmZmljdWx0eS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJkaWZmaWN1bHR5XCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXREaWZmaWN1bHR5Tm9ybWFsXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm5vcm1hbFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwibm9ybWFsXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldERpZmZpY3VsdHkoXCJub3JtYWxcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXREaWZmaWN1bHR5RXhwZXJ0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImV4cGVydFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiZXhwZXJ0XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldERpZmZpY3VsdHkoXCJleHBlcnRcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXREaWZmaWN1bHR5TWFzdGVyXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm1hc3RlclwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwibWFzdGVyXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldERpZmZpY3VsdHkoXCJtYXN0ZXJcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuZXhwb3J0cy5jb21tYW5kc0VuYWJsZUFkcyA9IHtcbiAgICB0aXRsZTogXCJTZXQgZW5hYmxlIGFkcy4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJlbmFibGVBZHNcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEVuYWJsZUFkc09mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRFbmFibGVBZHMoXCJvZmZcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRFbmFibGVBZHNPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib25cIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RW5hYmxlQWRzKFwib25cIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRFbmFibGVNYXhcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwic2VsbG91dFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwibWF4XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEVuYWJsZUFkcyhcIm1heFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5leHBvcnRzLmN1c3RvbVRoZW1lQ29tbWFuZHMgPSB7XG4gICAgdGl0bGU6IFwiQ3VzdG9tIHRoZW1lXCIsXG4gICAgY29uZmlnS2V5OiBcImN1c3RvbVRoZW1lXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRDdXN0b21UaGVtZU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWUoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0Q3VzdG9tVGhlbWVPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmV4cG9ydHMuY3VzdG9tVGhlbWVMaXN0Q29tbWFuZHMgPSB7XG4gICAgdGl0bGU6IFwiQ3VzdG9tIHRoZW1lcyBsaXN0Li4uXCIsXG4gICAgLy8gY29uZmlnS2V5OiBcImN1c3RvbVRoZW1lSWRcIixcbiAgICBsaXN0OiBbXSxcbn07XG5mdW5jdGlvbiB1cGRhdGVDdXN0b21UaGVtZUxpc3RDb21tYW5kcygpIHtcbiAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZXhwb3J0cy5jdXN0b21UaGVtZUxpc3RDb21tYW5kcy5saXN0ID0gW107XG4gICAgY29uc3Qgc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdCgpO1xuICAgIGlmICghc25hcHNob3QpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoREIuZ2V0U25hcHNob3QoKS5jdXN0b21UaGVtZXMubGVuZ3RoIDwgMCkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIllvdSBuZWVkIHRvIGNyZWF0ZSBhIGN1c3RvbSB0aGVtZSBmaXJzdFwiLCAwKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBEQi5nZXRTbmFwc2hvdCgpLmN1c3RvbVRoZW1lcy5mb3JFYWNoKCh0aGVtZSkgPT4ge1xuICAgICAgICBleHBvcnRzLmN1c3RvbVRoZW1lTGlzdENvbW1hbmRzLmxpc3QucHVzaCh7XG4gICAgICAgICAgICBpZDogXCJzZXRDdXN0b21UaGVtZUlkXCIgKyB0aGVtZS5faWQsXG4gICAgICAgICAgICBkaXNwbGF5OiB0aGVtZS5uYW1lLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRoZW1lLl9pZCxcbiAgICAgICAgICAgIGhvdmVyOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVGhlbWVDb250cm9sbGVyLnByZXZpZXcodGhlbWUuX2lkLCB0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lSWQodGhlbWUuX2lkKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgVGhlbWVDb250cm9sbGVyLnNldCh0aGVtZS5faWQsIHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuO1xufVxuZXhwb3J0cy51cGRhdGVDdXN0b21UaGVtZUxpc3RDb21tYW5kcyA9IHVwZGF0ZUN1c3RvbVRoZW1lTGlzdENvbW1hbmRzO1xuY29uc3QgY29tbWFuZHNDYXJldFN0eWxlID0ge1xuICAgIHRpdGxlOiBcIkNoYW5nZSBjYXJldCBzdHlsZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJjYXJldFN0eWxlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRDYXJldFN0eWxlT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldENhcmV0U3R5bGUoXCJvZmZcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRDYXJldFN0eWxlRGVmYXVsdFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJsaW5lXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJkZWZhdWx0XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldENhcmV0U3R5bGUoXCJkZWZhdWx0XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0Q2FyZXRTdHlsZUJsb2NrXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImJsb2NrXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJibG9ja1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDYXJldFN0eWxlKFwiYmxvY2tcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRDYXJldFN0eWxlT3V0bGluZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvdXRsaW5lLWJsb2NrXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvdXRsaW5lXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldENhcmV0U3R5bGUoXCJvdXRsaW5lXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0Q2FyZXRTdHlsZVVuZGVybGluZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJ1bmRlcmxpbmVcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcInVuZGVybGluZVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDYXJldFN0eWxlKFwidW5kZXJsaW5lXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0Q2FyZXRTdHlsZUNhcnJvdFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJjYXJyb3RcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImNhcnJvdFwiLFxuICAgICAgICAgICAgdmlzaWJsZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldENhcmV0U3R5bGUoXCJjYXJyb3RcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRDYXJldFN0eWxlQmFuYW5hXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImJhbmFuYVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiYmFuYW5hXCIsXG4gICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q2FyZXRTdHlsZShcImJhbmFuYVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1BhY2VDYXJldFN0eWxlID0ge1xuICAgIHRpdGxlOiBcIkNoYW5nZSBwYWNlIGNhcmV0IHN0eWxlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInBhY2VDYXJldFN0eWxlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRQYWNlQ2FyZXRTdHlsZURlZmF1bHRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibGluZVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiZGVmYXVsdFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWNlQ2FyZXRTdHlsZShcImRlZmF1bHRcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRQYWNlQ2FyZXRTdHlsZUJsb2NrXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImJsb2NrXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJibG9ja1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWNlQ2FyZXRTdHlsZShcImJsb2NrXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UGFjZUNhcmV0U3R5bGVPdXRsaW5lXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm91dGxpbmUtYmxvY2tcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm91dGxpbmVcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGFjZUNhcmV0U3R5bGUoXCJvdXRsaW5lXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UGFjZUNhcmV0U3R5bGVVbmRlcmxpbmVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwidW5kZXJsaW5lXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJ1bmRlcmxpbmVcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGFjZUNhcmV0U3R5bGUoXCJ1bmRlcmxpbmVcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRQYWNlQ2FyZXRTdHlsZUNhcnJvdFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJjYXJyb3RcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImNhcnJvdFwiLFxuICAgICAgICAgICAgdmlzaWJsZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBhY2VDYXJldFN0eWxlKFwiY2Fycm90XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UGFjZUNhcmV0U3R5bGVCYW5hbmFcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiYmFuYW5hXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJiYW5hbmFcIixcbiAgICAgICAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWNlQ2FyZXRTdHlsZShcImJhbmFuYVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1JlcGVhdGVkUGFjZSA9IHtcbiAgICB0aXRsZTogXCJSZXBlYXRlZCBwYWNlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInJlcGVhdGVkUGFjZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UmVwZWF0ZWRQYWNlT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRSZXBlYXRlZFBhY2UoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UmVwZWF0ZWRQYWNlT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRSZXBlYXRlZFBhY2UodHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNQYWNlQ2FyZXQgPSB7XG4gICAgdGl0bGU6IFwiUGFjZSBjYXJldCBtb2RlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInBhY2VDYXJldFwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UGFjZUNhcmV0T2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBhY2VDYXJldChcIm9mZlwiKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UGFjZUNhcmV0UGJcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwicGJcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcInBiXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBhY2VDYXJldChcInBiXCIpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRQYWNlQ2FyZXRBdmVyYWdlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImF2ZXJhZ2VcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImF2ZXJhZ2VcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGFjZUNhcmV0KFwiYXZlcmFnZVwiKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UGFjZUNhcmV0Q3VzdG9tXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImN1c3RvbS4uLlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiY3VzdG9tXCIsXG4gICAgICAgICAgICBpbnB1dDogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6IChpbnB1dCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghaW5wdXQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGFjZUNhcmV0Q3VzdG9tU3BlZWQocGFyc2VJbnQoaW5wdXQpKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGFjZUNhcmV0KFwiY3VzdG9tXCIpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNNaW5XcG0gPSB7XG4gICAgdGl0bGU6IFwiQ2hhbmdlIG1pbiB3cG0gbW9kZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJtaW5XcG1cIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldE1pbldwbU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNaW5XcG0oXCJvZmZcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRNaW5XcG1DdXN0b21cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiY3VzdG9tLi4uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJjdXN0b21cIixcbiAgICAgICAgICAgIGlucHV0OiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKGlucHV0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFpbnB1dClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNaW5XcG1DdXN0b21TcGVlZChwYXJzZUludChpbnB1dCkpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNaW5XcG0oXCJjdXN0b21cIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNNaW5BY2MgPSB7XG4gICAgdGl0bGU6IFwiQ2hhbmdlIG1pbiBhY2N1cmFjeSBtb2RlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcIm1pbkFjY1wiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0TWluQWNjT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1pbkFjYyhcIm9mZlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldE1pbkFjY0N1c3RvbVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJjdXN0b20uLi5cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImN1c3RvbVwiLFxuICAgICAgICAgICAgaW5wdXQ6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoaW5wdXQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWlucHV0KVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1pbkFjY0N1c3RvbShwYXJzZUludChpbnB1dCkpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNaW5BY2MoXCJjdXN0b21cIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNNaW5CdXJzdCA9IHtcbiAgICB0aXRsZTogXCJDaGFuZ2UgbWluIGJ1cnN0IG1vZGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwibWluQnVyc3RcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldE1pbkJ1cnN0T2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1pbkJ1cnN0KFwib2ZmXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0TWluQnVyc3RGaXhlZFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJmaXhlZC4uLlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiZml4ZWRcIixcbiAgICAgICAgICAgIGlucHV0OiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKGlucHV0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFpbnB1dClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNaW5CdXJzdChcImZpeGVkXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNaW5CdXJzdEN1c3RvbVNwZWVkKHBhcnNlSW50KGlucHV0KSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRNaW5CdXJzdEZsZXhcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiZmxleC4uLlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiZmxleFwiLFxuICAgICAgICAgICAgaW5wdXQ6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoaW5wdXQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWlucHV0KVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1pbkJ1cnN0KFwiZmxleFwiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TWluQnVyc3RDdXN0b21TcGVlZChwYXJzZUludChpbnB1dCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzS2V5bWFwU3R5bGUgPSB7XG4gICAgdGl0bGU6IFwiS2V5bWFwIHN0eWxlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImtleW1hcFN0eWxlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRLZXltYXBTdHlsZVN0YWdnZXJlZFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJzdGFnZ2VyZWRcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcInN0YWdnZXJlZFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBTdHlsZShcInN0YWdnZXJlZFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEtleW1hcFN0eWxlQWxpY2VcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiYWxpY2VcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImFsaWNlXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcFN0eWxlKFwiYWxpY2VcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRLZXltYXBTdHlsZU1hdHJpeFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJtYXRyaXhcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm1hdHJpeFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBTdHlsZShcIm1hdHJpeFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEtleW1hcFN0eWxlU3BsaXRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwic3BsaXRcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcInNwbGl0XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcFN0eWxlKFwic3BsaXRcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRLZXltYXBTdHlsZVNwbGl0TWF0cml4XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInNwbGl0IG1hdHJpeFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwic3BsaXRfbWF0cml4XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcFN0eWxlKFwic3BsaXRfbWF0cml4XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzS2V5bWFwTGVnZW5kU3R5bGUgPSB7XG4gICAgdGl0bGU6IFwiS2V5bWFwIGxlZ2VuZCBzdHlsZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJrZXltYXBMZWdlbmRTdHlsZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0S2V5bWFwTGVnZW5kU3R5bGVMb3dlcmNhc2VcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibG93ZXJjYXNlXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJsb3dlcmNhc2VcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTGVnZW5kU3R5bGUoXCJsb3dlcmNhc2VcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRLZXltYXBMZWdlbmRTdHlsZVVwcGVyY2FzZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJ1cHBlcmNhc2VcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcInVwcGVyY2FzZVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBMZWdlbmRTdHlsZShcInVwcGVyY2FzZVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEtleW1hcExlZ2VuZFN0eWxlQmxhbmtcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiYmxhbmtcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImJsYW5rXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcExlZ2VuZFN0eWxlKFwiYmxhbmtcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRLZXltYXBMZWdlbmRTdHlsZUR5bmFtaWNcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiZHluYW1pY1wiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiZHluYW1pY1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBMZWdlbmRTdHlsZShcImR5bmFtaWNcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNCcml0aXNoRW5nbGlzaCA9IHtcbiAgICB0aXRsZTogXCJCcml0aXNoIGVuZ2xpc2guLi5cIixcbiAgICBjb25maWdLZXk6IFwiYnJpdGlzaEVuZ2xpc2hcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEJyaXRpc2hFbmdsaXNoT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRCcml0aXNoRW5nbGlzaChmYWxzZSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEJyaXRpc2hFbmdsaXNoT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRCcml0aXNoRW5nbGlzaCh0cnVlKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzSGlnaGxpZ2h0TW9kZSA9IHtcbiAgICB0aXRsZTogXCJIaWdobGlnaHQgbW9kZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJoaWdobGlnaHRNb2RlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRIaWdobGlnaHRNb2RlT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEhpZ2hsaWdodE1vZGUoXCJvZmZcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRIaWdobGlnaHRNb2RlTGV0dGVyXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImxldHRlclwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwibGV0dGVyXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEhpZ2hsaWdodE1vZGUoXCJsZXR0ZXJcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRIaWdobGlnaHRNb2RlV29yZFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJ3b3JkXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJ3b3JkXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEhpZ2hsaWdodE1vZGUoXCJ3b3JkXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzVGltZXJTdHlsZSA9IHtcbiAgICB0aXRsZTogXCJUaW1lci9wcm9ncmVzcyBzdHlsZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJ0aW1lclN0eWxlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRUaW1lclN0eWxlQmFyXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImJhclwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiYmFyXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVyU3R5bGUoXCJiYXJcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRUaW1lclN0eWxlVGV4dFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJ0ZXh0XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJ0ZXh0XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVyU3R5bGUoXCJ0ZXh0XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0VGltZXJTdHlsZU1pbmlcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibWluaVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwibWluaVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lclN0eWxlKFwibWluaVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1RpbWVyQ29sb3IgPSB7XG4gICAgdGl0bGU6IFwiVGltZXIvcHJvZ3Jlc3MgY29sb3IuLi5cIixcbiAgICBjb25maWdLZXk6IFwidGltZXJDb2xvclwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0VGltZXJDb2xvckJsYWNrXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImJsYWNrXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJibGFja1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lckNvbG9yKFwiYmxhY2tcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRUaW1lckNvbG9yU3ViXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInN1YlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwic3ViXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVyQ29sb3IoXCJzdWJcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRUaW1lckNvbG9yVGV4dFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJ0ZXh0XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJ0ZXh0XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVyQ29sb3IoXCJ0ZXh0XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0VGltZXJDb2xvck1haW5cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibWFpblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwibWFpblwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lckNvbG9yKFwibWFpblwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1NpbmdsZUxpc3RDb21tYW5kTGluZSA9IHtcbiAgICB0aXRsZTogXCJTaW5nbGUgbGlzdCBjb21tYW5kIGxpbmUuLi5cIixcbiAgICBjb25maWdLZXk6IFwic2luZ2xlTGlzdENvbW1hbmRMaW5lXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzaW5nbGVMaXN0Q29tbWFuZExpbmVNYW51YWxcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibWFudWFsXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJtYW51YWxcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2luZ2xlTGlzdENvbW1hbmRMaW5lKFwibWFudWFsXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2luZ2xlTGlzdENvbW1hbmRMaW5lT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9uXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNpbmdsZUxpc3RDb21tYW5kTGluZShcIm9uXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzQ2Fwc0xvY2tXYXJuaW5nID0ge1xuICAgIHRpdGxlOiBcIkNhcHMgbG9jayB3YXJuaW5nLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImNhcHNMb2NrV2FybmluZ1wiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2Fwc0xvY2tXYXJuaW5nT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDYXBzTG9ja1dhcm5pbmcodHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjYXBzTG9ja1dhcm5pbmdPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldENhcHNMb2NrV2FybmluZyhmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNUaW1lck9wYWNpdHkgPSB7XG4gICAgdGl0bGU6IFwiVGltZXIvcHJvZ3Jlc3Mgb3BhY2l0eS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJ0aW1lck9wYWNpdHlcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFRpbWVyT3BhY2l0eS4yNVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIuMjVcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAwLjI1LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lck9wYWNpdHkoXCIwLjI1XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0VGltZXJPcGFjaXR5LjVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiLjVcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAwLjUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVyT3BhY2l0eShcIjAuNVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFRpbWVyT3BhY2l0eS43NVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIuNzVcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAwLjc1LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lck9wYWNpdHkoXCIwLjc1XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0VGltZXJPcGFjaXR5MVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIxXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZXJPcGFjaXR5KFwiMVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1dvcmRDb3VudCA9IHtcbiAgICB0aXRsZTogXCJDaGFuZ2Ugd29yZCBjb3VudC4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJ3b3Jkc1wiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlV29yZENvdW50MTBcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiMTBcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAxMCxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcIndvcmRzXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRXb3JkQ291bnQoMTApO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VXb3JkQ291bnQyNVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIyNVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDI1LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwid29yZHNcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFdvcmRDb3VudCgyNSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVdvcmRDb3VudDUwXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjUwXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogNTAsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ3b3Jkc1wiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0V29yZENvdW50KDUwKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlV29yZENvdW50MTAwXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjEwMFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDEwMCxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcIndvcmRzXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRXb3JkQ291bnQoMTAwKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlV29yZENvdW50MjAwXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjIwMFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDIwMCxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcIndvcmRzXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRXb3JkQ291bnQoMjAwKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlV29yZENvdW50Q3VzdG9tXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImN1c3RvbS4uLlwiLFxuICAgICAgICAgICAgaW5wdXQ6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoaW5wdXQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWlucHV0KVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ3b3Jkc1wiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0V29yZENvdW50KHBhcnNlSW50KGlucHV0KSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1F1b3RlTGVuZ3RoQ29uZmlnID0ge1xuICAgIHRpdGxlOiBcIkNoYW5nZSBxdW90ZSBsZW5ndGguLi5cIixcbiAgICBjb25maWdLZXk6IFwicXVvdGVMZW5ndGhcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVF1b3RlTGVuZ3RoQWxsXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImFsbFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFswLCAxLCAyLCAzXSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcInF1b3RlXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRRdW90ZUxlbmd0aChbMCwgMSwgMiwgM10pO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VRdW90ZUxlbmd0aFNob3J0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInNob3J0XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMCxcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlTW9kZTogXCJpbmNsdWRlXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJxdW90ZVwiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UXVvdGVMZW5ndGgoMCk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVF1b3RlTGVuZ3RoTWVkaXVtXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm1lZGl1bVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDEsXG4gICAgICAgICAgICBjb25maWdWYWx1ZU1vZGU6IFwiaW5jbHVkZVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwicXVvdGVcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFF1b3RlTGVuZ3RoKDEpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VRdW90ZUxlbmd0aExvbmdcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibG9uZ1wiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZU1vZGU6IFwiaW5jbHVkZVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwicXVvdGVcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFF1b3RlTGVuZ3RoKDIpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VRdW90ZUxlbmd0aFRoaWNjXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInRoaWNjXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMyxcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlTW9kZTogXCJpbmNsdWRlXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJxdW90ZVwiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UXVvdGVMZW5ndGgoMyk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1B1bmN0dWF0aW9uID0ge1xuICAgIHRpdGxlOiBcIkNoYW5nZSBwdW5jdHVhdGlvbi4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJwdW5jdHVhdGlvblwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUHVuY3R1YXRpb25PblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFB1bmN0dWF0aW9uKHRydWUpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VQdW5jdHVhdGlvbk9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UHVuY3R1YXRpb24oZmFsc2UpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNOdW1iZXJzID0ge1xuICAgIHRpdGxlOiBcIk51bWJlcnMuLi5cIixcbiAgICBjb25maWdLZXk6IFwibnVtYmVyc1wiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTnVtYmVyc09uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TnVtYmVycyh0cnVlKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTnVtYmVyc09mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TnVtYmVycyhmYWxzZSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1Ntb290aENhcmV0ID0ge1xuICAgIHRpdGxlOiBcIlNtb290aCBjYXJldC4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJzbW9vdGhDYXJldFwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU21vb3RoQ2FyZXRPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNtb290aENhcmV0KHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU21vb3RoQ2FyZXRPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNtb290aENhcmV0KGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1F1aWNrVGFiID0ge1xuICAgIHRpdGxlOiBcIlF1aWNrIHRhYi4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJxdWlja1RhYlwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUXVpY2tUYWJPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFF1aWNrVGFiTW9kZSh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVF1aWNrVGFiT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRRdWlja1RhYk1vZGUoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzTW9kZSA9IHtcbiAgICB0aXRsZTogXCJDaGFuZ2UgbW9kZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJtb2RlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VNb2RlVGltZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJ0aW1lXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJ0aW1lXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ0aW1lXCIpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VNb2RlV29yZHNcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwid29yZHNcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIndvcmRzXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ3b3Jkc1wiKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTW9kZVF1b3RlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInF1b3RlXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJxdW90ZVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwicXVvdGVcIik7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZU1vZGVDdXN0b21cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiY3VzdG9tXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJjdXN0b21cIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcImN1c3RvbVwiKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTW9kZVplblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJ6ZW5cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcInplblwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwiemVuXCIpO1xuICAgICAgICAgICAgICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1RpbWVDb25maWcgPSB7XG4gICAgdGl0bGU6IFwiQ2hhbmdlIHRpbWUgY29uZmlnLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInRpbWVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVRpbWVDb25maWcxNVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIxNVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDE1LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwidGltZVwiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZUNvbmZpZygxNSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVRpbWVDb25maWczMFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIzMFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDMwLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwidGltZVwiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZUNvbmZpZygzMCk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVRpbWVDb25maWc2MFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCI2MFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDYwLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwidGltZVwiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZUNvbmZpZyg2MCk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVRpbWVDb25maWcxMjBcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiMTIwXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMTIwLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwidGltZVwiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZUNvbmZpZygxMjApO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VUaW1lQ29uZmlnQ3VzdG9tXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImN1c3RvbS4uLlwiLFxuICAgICAgICAgICAgaW5wdXQ6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoaW5wdXQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWlucHV0KVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ0aW1lXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lQ29uZmlnKHBhcnNlSW50KGlucHV0KSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0NvbmZpZGVuY2VNb2RlID0ge1xuICAgIHRpdGxlOiBcIkNvbmZpZGVuY2UgbW9kZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJjb25maWRlbmNlTW9kZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlQ29uZmlkZW5jZU1vZGVPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q29uZmlkZW5jZU1vZGUoXCJvZmZcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VDb25maWRlbmNlTW9kZU9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvblwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDb25maWRlbmNlTW9kZShcIm9uXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlQ29uZmlkZW5jZU1vZGVNYXhcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibWF4XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJtYXhcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q29uZmlkZW5jZU1vZGUoXCJtYXhcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNTdG9wT25FcnJvciA9IHtcbiAgICB0aXRsZTogXCJTdG9wIG9uIGVycm9yLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInN0b3BPbkVycm9yXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTdG9wT25FcnJvck9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTdG9wT25FcnJvcihcIm9mZlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVN0b3BPbkVycm9yTGV0dGVyXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImxldHRlclwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwibGV0dGVyXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFN0b3BPbkVycm9yKFwibGV0dGVyXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU3RvcE9uRXJyb3JXb3JkXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIndvcmRcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIndvcmRcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U3RvcE9uRXJyb3IoXCJ3b3JkXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzRm9udFNpemUgPSB7XG4gICAgdGl0bGU6IFwiRm9udCBzaXplLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImZvbnRTaXplXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VGb250U2l6ZTFcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiMXhcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAxLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGb250U2l6ZShcIjFcIik7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUZvbnRTaXplMTI1XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjEuMjV4XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMTI1LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGb250U2l6ZShcIjEyNVwiKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlRm9udFNpemUxNVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIxLjV4XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMTUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZvbnRTaXplKFwiMTVcIik7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUZvbnRTaXplMlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIyeFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZvbnRTaXplKFwiMlwiKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlRm9udFNpemUzXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjN4XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMyxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Rm9udFNpemUoXCIzXCIpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VGb250U2l6ZTRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiNHhcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiA0LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGb250U2l6ZShcIjRcIik7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1BhZ2VXaWR0aCA9IHtcbiAgICB0aXRsZTogXCJQYWdlIHdpZHRoLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInBhZ2VXaWR0aFwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UGFnZVdpZHRoMTAwXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjEwMFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiMTAwXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBhZ2VXaWR0aChcIjEwMFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFBhZ2VXaWR0aDEyNVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIxMjVcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjEyNVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWdlV2lkdGgoXCIxMjVcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRQYWdlV2lkdGgxNTBcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiMTUwXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCIxNTBcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGFnZVdpZHRoKFwiMTUwXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UGFnZVdpZHRoMjAwXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjIwMFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiMjAwXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBhZ2VXaWR0aChcIjIwMFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFBhZ2VXaWR0aE1heFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJtYXhcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm1heFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWdlV2lkdGgoXCJtYXhcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNQcmFjdGlzZVdvcmRzID0ge1xuICAgIHRpdGxlOiBcIlByYWN0aWNlIHdvcmRzLi4uXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJwcmFjdGlzZVdvcmRzTWlzc2VkXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm1pc3NlZFwiLFxuICAgICAgICAgICAgbm9JY29uOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFByYWN0aXNlV29yZHMuaW5pdCh0cnVlLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoZmFsc2UsIGZhbHNlLCB1bmRlZmluZWQsIHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwicHJhY3Rpc2VXb3Jkc1Nsb3dcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwic2xvd1wiLFxuICAgICAgICAgICAgbm9JY29uOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFByYWN0aXNlV29yZHMuaW5pdChmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoZmFsc2UsIGZhbHNlLCB1bmRlZmluZWQsIHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwicHJhY3Rpc2VXb3Jkc0JvdGhcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiYm90aFwiLFxuICAgICAgICAgICAgbm9JY29uOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFByYWN0aXNlV29yZHMuaW5pdCh0cnVlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydChmYWxzZSwgZmFsc2UsIHVuZGVmaW5lZCwgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuZXhwb3J0cy50aGVtZUNvbW1hbmRzID0ge1xuICAgIHRpdGxlOiBcIlRoZW1lLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInRoZW1lXCIsXG4gICAgbGlzdDogW10sXG59O1xuTWlzYy5nZXRUaGVtZXNMaXN0KCkudGhlbigodGhlbWVzKSA9PiB7XG4gICAgdGhlbWVzLmZvckVhY2goKHRoZW1lKSA9PiB7XG4gICAgICAgIGV4cG9ydHMudGhlbWVDb21tYW5kcy5saXN0LnB1c2goe1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlVGhlbWVcIiArIE1pc2MuY2FwaXRhbGl6ZUZpcnN0TGV0dGVyT2ZFYWNoV29yZCh0aGVtZS5uYW1lKSxcbiAgICAgICAgICAgIGRpc3BsYXk6IHRoZW1lLm5hbWUucmVwbGFjZSgvXy9nLCBcIiBcIiksXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdGhlbWUubmFtZSxcbiAgICAgICAgICAgIGhvdmVyOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gcHJldmlld1RoZW1lKHRoZW1lLm5hbWUpO1xuICAgICAgICAgICAgICAgIFRoZW1lQ29udHJvbGxlci5wcmV2aWV3KHRoZW1lLm5hbWUsIGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRoZW1lKHRoZW1lLm5hbWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbmV4cG9ydHMuY29tbWFuZHNDaGFsbGVuZ2VzID0ge1xuICAgIHRpdGxlOiBcIkxvYWQgY2hhbGxlbmdlLi4uXCIsXG4gICAgbGlzdDogW10sXG59O1xuTWlzYy5nZXRDaGFsbGVuZ2VMaXN0KCkudGhlbigoY2hhbGxlbmdlcykgPT4ge1xuICAgIGNoYWxsZW5nZXMuZm9yRWFjaCgoY2hhbGxlbmdlKSA9PiB7XG4gICAgICAgIGV4cG9ydHMuY29tbWFuZHNDaGFsbGVuZ2VzLmxpc3QucHVzaCh7XG4gICAgICAgICAgICBpZDogXCJsb2FkQ2hhbGxlbmdlXCIgKyBNaXNjLmNhcGl0YWxpemVGaXJzdExldHRlck9mRWFjaFdvcmQoY2hhbGxlbmdlLm5hbWUpLFxuICAgICAgICAgICAgbm9JY29uOiB0cnVlLFxuICAgICAgICAgICAgZGlzcGxheTogY2hhbGxlbmdlLmRpc3BsYXksXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgQ2hhbGxlbmdlQ29udHJvbGxlci5zZXR1cChjaGFsbGVuZ2UubmFtZSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbi8vIGV4cG9ydCBmdW5jdGlvbiBzaG93RmF2b3VyaXRlVGhlbWVzQXRUaGVUb3AoKSB7XG5mdW5jdGlvbiB1cGRhdGVUaGVtZUNvbW1hbmRzKCkge1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZhdlRoZW1lcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGV4cG9ydHMudGhlbWVDb21tYW5kcy5saXN0ID0gW107XG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQuZmF2VGhlbWVzLmZvckVhY2goKHRoZW1lKSA9PiB7XG4gICAgICAgICAgICBleHBvcnRzLnRoZW1lQ29tbWFuZHMubGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgICBpZDogXCJjaGFuZ2VUaGVtZVwiICsgTWlzYy5jYXBpdGFsaXplRmlyc3RMZXR0ZXJPZkVhY2hXb3JkKHRoZW1lKSxcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiB0aGVtZS5yZXBsYWNlKC9fL2csIFwiIFwiKSxcbiAgICAgICAgICAgICAgICBob3ZlcjogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBwcmV2aWV3VGhlbWUodGhlbWUpO1xuICAgICAgICAgICAgICAgICAgICBUaGVtZUNvbnRyb2xsZXIucHJldmlldyh0aGVtZSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGhlbWUodGhlbWUpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIE1pc2MuZ2V0VGhlbWVzTGlzdCgpLnRoZW4oKHRoZW1lcykgPT4ge1xuICAgICAgICAgICAgdGhlbWVzLmZvckVhY2goKHRoZW1lKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZmF2VGhlbWVzLmluY2x1ZGVzKHRoZW1lLm5hbWUpKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgZXhwb3J0cy50aGVtZUNvbW1hbmRzLmxpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBcImNoYW5nZVRoZW1lXCIgKyBNaXNjLmNhcGl0YWxpemVGaXJzdExldHRlck9mRWFjaFdvcmQodGhlbWUubmFtZSksXG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRoZW1lLm5hbWUucmVwbGFjZSgvXy9nLCBcIiBcIiksXG4gICAgICAgICAgICAgICAgICAgIGhvdmVyOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBwcmV2aWV3VGhlbWUodGhlbWUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBUaGVtZUNvbnRyb2xsZXIucHJldmlldyh0aGVtZS5uYW1lLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaGVtZSh0aGVtZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLnVwZGF0ZVRoZW1lQ29tbWFuZHMgPSB1cGRhdGVUaGVtZUNvbW1hbmRzO1xuY29uc3QgY29tbWFuZHNDb3B5V29yZHNUb0NsaXBib2FyZCA9IHtcbiAgICB0aXRsZTogXCJBcmUgeW91IHN1cmUuLi5cIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNvcHlOb1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJOZXZlcm1pbmRcIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY29weVllc1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJZZXMsIEkgYW0gc3VyZVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHdvcmRzID0gTWlzYy5nZXRXb3JkcygpO1xuICAgICAgICAgICAgICAgIG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KHdvcmRzKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDb3BpZWQgdG8gY2xpcGJvYXJkXCIsIDEpO1xuICAgICAgICAgICAgICAgIH0sICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gY29weSFcIiwgLTEpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzTW9ua2V5UG93ZXJMZXZlbCA9IHtcbiAgICB0aXRsZTogXCJQb3dlciBtb2RlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcIm1vbmtleVBvd2VyTGV2ZWxcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcIm1vbmtleVBvd2VyTGV2ZWxPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IFVwZGF0ZUNvbmZpZy5zZXRNb25rZXlQb3dlckxldmVsKFwib2ZmXCIpLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJtb25rZXlQb3dlckxldmVsMVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJtZWxsb3dcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjFcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IFVwZGF0ZUNvbmZpZy5zZXRNb25rZXlQb3dlckxldmVsKFwiMVwiKSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwibW9ua2V5UG93ZXJMZXZlbDJcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiaGlnaFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiMlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4gVXBkYXRlQ29uZmlnLnNldE1vbmtleVBvd2VyTGV2ZWwoXCIyXCIpLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJtb25rZXlQb3dlckxldmVsM1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJ1bHRyYVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiM1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4gVXBkYXRlQ29uZmlnLnNldE1vbmtleVBvd2VyTGV2ZWwoXCIzXCIpLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJtb25rZXlQb3dlckxldmVsNFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvdmVyIDkwMDBcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjRcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IFVwZGF0ZUNvbmZpZy5zZXRNb25rZXlQb3dlckxldmVsKFwiNFwiKSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmV4cG9ydHMuZGVmYXVsdENvbW1hbmRzID0ge1xuICAgIHRpdGxlOiBcIlwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUHVuY3R1YXRpb25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiUHVuY3R1YXRpb24uLi5cIixcbiAgICAgICAgICAgIGljb246IFwiIT9cIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1B1bmN0dWF0aW9uLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VNb2RlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIk1vZGUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtYmFyc1wiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzTW9kZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlVGltZUNvbmZpZ1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJUaW1lLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWNsb2NrXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNUaW1lQ29uZmlnLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VXb3JkQ291bnRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiV29yZHMuLi5cIixcbiAgICAgICAgICAgIGFsaWFzOiBcIndvcmRzXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWZvbnRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1dvcmRDb3VudCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUXVvdGVMZW5ndGhcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiUXVvdGUgbGVuZ3RoLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXF1b3RlLXJpZ2h0XCIsXG4gICAgICAgICAgICBhbGlhczogXCJxdW90ZXNcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1F1b3RlTGVuZ3RoQ29uZmlnLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVRhZ3NcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiVGFncy4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS10YWdcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1RhZ3MsXG4gICAgICAgICAgICBiZWZvcmVTdWJncm91cDogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHVwZGF0ZVRhZ0NvbW1hbmRzKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gZXhlYzogKCk6IHZvaWQgPT4ge1xuICAgICAgICAgICAgLy8gICB1cGRhdGVUYWdDb21tYW5kcygpO1xuICAgICAgICAgICAgLy8gICBjdXJyZW50LnB1c2goKTtcbiAgICAgICAgICAgIC8vICAgQ29tbWFuZGxpbmUuc2hvdygpO1xuICAgICAgICAgICAgLy8gfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgdmlzaWJsZTogZmFsc2UsXG4gICAgICAgICAgICBpZDogXCJhcHBseVByZXNldFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJQcmVzZXRzLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXNsaWRlcnMtaFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzUHJlc2V0cyxcbiAgICAgICAgICAgIGJlZm9yZVN1Ymdyb3VwOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdXBkYXRlUHJlc2V0Q29tbWFuZHMoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBleGVjOiAoKTogdm9pZCA9PiB7XG4gICAgICAgICAgICAvLyAgIHVwZGF0ZVByZXNldENvbW1hbmRzKCk7XG4gICAgICAgICAgICAvLyAgIGN1cnJlbnQucHVzaChjb21tYW5kc1ByZXNldHMpO1xuICAgICAgICAgICAgLy8gICBDb21tYW5kbGluZS5zaG93KCk7XG4gICAgICAgICAgICAvLyB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VDb25maWRlbmNlTW9kZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJDb25maWRlbmNlIG1vZGUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtYmFja3NwYWNlXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNDb25maWRlbmNlTW9kZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU3RvcE9uRXJyb3JcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiU3RvcCBvbiBlcnJvci4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1oYW5kLXBhcGVyXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNTdG9wT25FcnJvcixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTnVtYmVyc1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJOdW1iZXJzLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcIjE1XCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNOdW1iZXJzLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTbW9vdGhDYXJldFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJTbW9vdGggY2FyZXQuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtaS1jdXJzb3JcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1Ntb290aENhcmV0LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VRdWlja1RhYlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJRdWljayB0YWIuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtcmVkby1hbHRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1F1aWNrVGFiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VSZXBlYXRRdW90ZXNcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiUmVwZWF0IHF1b3Rlcy4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1zeW5jLWFsdFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzUmVwZWF0UXVvdGVzLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VMaXZlV3BtXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkxpdmUgV1BNLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXRhY2hvbWV0ZXItYWx0XCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNMaXZlV3BtLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VMaXZlQWNjXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkxpdmUgYWNjdXJhY3kuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtcGVyY2VudGFnZVwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzTGl2ZUFjYyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTGl2ZUJ1cnN0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkxpdmUgYnVyc3QuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtZmlyZS1hbHRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0xpdmVCdXJzdCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU2hvd1RpbWVyXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlRpbWVyL3Byb2dyZXNzLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWNsb2NrXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNTaG93VGltZXIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUtleVRpcHNcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiS2V5IHRpcHMuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtcXVlc3Rpb25cIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0tleVRpcHMsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUZyZWVkb21Nb2RlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkZyZWVkb20gbW9kZS4uLlwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzRnJlZWRvbU1vZGUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVN0cmljdFNwYWNlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlN0cmljdCBzcGFjZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1taW51c1wiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzU3RyaWN0U3BhY2UsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUJsaW5kTW9kZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJCbGluZCBtb2RlLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWV5ZS1zbGFzaFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzQmxpbmRNb2RlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTaG93V29yZHNIaXN0b3J5XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkFsd2F5cyBzaG93IHdvcmRzIGhpc3RvcnkuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtYWxpZ24tbGVmdFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzU2hvd1dvcmRzSGlzdG9yeSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlSW5kaWNhdGVUeXBvc1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJJbmRpY2F0ZSB0eXBvcy4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1leGNsYW1hdGlvblwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzSW5kaWNhdGVUeXBvcyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlSGlkZUV4dHJhTGV0dGVyc1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJIaWRlIGV4dHJhIGxldHRlcnMuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtZXllLXNsYXNoXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNIaWRlRXh0cmFMZXR0ZXJzLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VRdWlja0VuZFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJRdWljayBlbmQuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtc3RlcC1mb3J3YXJkXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNRdWlja0VuZCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2luZ2xlTGlzdENvbW1hbmRMaW5lXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlNpbmdsZSBsaXN0IGNvbW1hbmQgbGluZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1saXN0XCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNTaW5nbGVMaXN0Q29tbWFuZExpbmUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNhcHNMb2NrV2FybmluZ1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJDYXBzIGxvY2sgd2FybmluZy4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1leGNsYW1hdGlvbi10cmlhbmdsZVwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzQ2Fwc0xvY2tXYXJuaW5nLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VNaW5XcG1cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiTWluaW11bSB3cG0uLi5cIixcbiAgICAgICAgICAgIGFsaWFzOiBcIm1pbmltdW1cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtYm9tYlwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzTWluV3BtLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VNaW5BY2NcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiTWluaW11bSBhY2N1cmFjeS4uLlwiLFxuICAgICAgICAgICAgYWxpYXM6IFwibWluaW11bVwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1ib21iXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNNaW5BY2MsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZU1pbkJ1cnN0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIk1pbmltdW0gYnVyc3QuLi5cIixcbiAgICAgICAgICAgIGFsaWFzOiBcIm1pbmltdW1cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtYm9tYlwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzTWluQnVyc3QsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZU9wcG9zaXRlU2hpZnRNb2RlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkNoYW5nZSBvcHBvc2l0ZSBzaGlmdCBtb2RlLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWV4Y2hhbmdlLWFsdFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzT3Bwb3NpdGVTaGlmdE1vZGUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVNvdW5kT25DbGlja1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJTb3VuZCBvbiBjbGljay4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS12b2x1bWUtdXBcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1NvdW5kT25DbGljayxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU291bmRPbkVycm9yXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlNvdW5kIG9uIGVycm9yLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXZvbHVtZS1tdXRlXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNTb3VuZE9uRXJyb3IsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVNvdW5kVm9sdW1lXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlNvdW5kIHZvbHVtZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS12b2x1bWUtZG93blwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzU291bmRWb2x1bWUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUZsaXBUZXN0Q29sb3JzXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkZsaXAgdGVzdCBjb2xvcnMuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtYWRqdXN0XCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNGbGlwVGVzdENvbG9ycyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU21vb3RoTGluZVNjcm9sbFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJTbW9vdGggbGluZSBzY3JvbGwuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtYWxpZ24tbGVmdFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzU21vb3RoTGluZVNjcm9sbCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlQWx3YXlzU2hvd0RlY2ltYWxcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQWx3YXlzIHNob3cgZGVjaW1hbCBwbGFjZXMuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiMDBcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0Fsd2F5c1Nob3dEZWNpbWFsLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VBbHdheXNTaG93Q1BNXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkFsd2F5cyBzaG93IENQTS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS10YWNob21ldGVyLWFsdFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzQWx3YXlzU2hvd0NQTSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU3RhcnRHcmFwaHNBdFplcm9cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiU3RhcnQgZ3JhcGhzIGF0IHplcm8uLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtY2hhcnQtbGluZVwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzU3RhcnRHcmFwaHNBdFplcm8sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVN3YXBFc2NBbmRUYWJcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiU3dhcCBlc2MgYW5kIHRhYi4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1leGNoYW5nZS1hbHRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1N3YXBFc2NBbmRUYWIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUxhenlNb2RlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkxhenkgbW9kZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1jb3VjaFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzTGF6eU1vZGUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVNob3dBbGxMaW5lc1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJTaG93IGFsbCBsaW5lcy4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1hbGlnbi1sZWZ0XCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNTaG93QWxsTGluZXMsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUNvbG9yZnVsTW9kZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJDb2xvcmZ1bCBtb2RlLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWZpbGwtZHJpcFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzQ29sb3JmdWxNb2RlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VPdXRPZkZvY3VzV2FybmluZ1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJPdXQgb2YgZm9jdXMgd2FybmluZy4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1leGNsYW1hdGlvblwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzT3V0T2ZGb2N1c1dhcm5pbmcsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEVuYWJsZUFkc1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJFbmFibGUgYWRzLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWFkXCIsXG4gICAgICAgICAgICBzdWJncm91cDogZXhwb3J0cy5jb21tYW5kc0VuYWJsZUFkcyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlVGhlbWVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiVGhlbWUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtcGFsZXR0ZVwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGV4cG9ydHMudGhlbWVDb21tYW5kcyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0Q3VzdG9tVGhlbWVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQ3VzdG9tIHRoZW1lLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXBhbGV0dGVcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBleHBvcnRzLmN1c3RvbVRoZW1lQ29tbWFuZHMsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEN1c3RvbVRoZW1lSWRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQ3VzdG9tIHRoZW1lcy4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1wYWxldHRlXCIsXG4gICAgICAgICAgICBzdWJncm91cDogZXhwb3J0cy5jdXN0b21UaGVtZUxpc3RDb21tYW5kcyxcbiAgICAgICAgICAgIGJlZm9yZVN1Ymdyb3VwOiAoKSA9PiB1cGRhdGVDdXN0b21UaGVtZUxpc3RDb21tYW5kcygpLFxuICAgICAgICAgICAgYXZhaWxhYmxlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciAhPT0gbnVsbDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVJhbmRvbVRoZW1lXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlJhbmRvbSB0aGVtZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1yYW5kb21cIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1JhbmRvbVRoZW1lLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJyYW5kb21pemVUaGVtZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJOZXh0IHJhbmRvbSB0aGVtZVwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1yYW5kb21cIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IFRoZW1lQ29udHJvbGxlci5yYW5kb21pemVUaGVtZSgpLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VEaWZmaWN1bHR5XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkRpZmZpY3VsdHkuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtc3RhclwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzRGlmZmljdWx0eSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlQ2FyZXRTdHlsZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJDYXJldCBzdHlsZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1pLWN1cnNvclwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzQ2FyZXRTdHlsZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUGFjZUNhcmV0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlBhY2UgY2FyZXQgbW9kZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1pLWN1cnNvclwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzUGFjZUNhcmV0LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VQYWNlQ2FyZXRTdHlsZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJQYWNlIGNhcmV0IHN0eWxlLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWktY3Vyc29yXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNQYWNlQ2FyZXRTdHlsZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUmVwZWF0ZWRQYWNlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlJlcGVhdGVkIHBhY2UuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtaS1jdXJzb3JcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1JlcGVhdGVkUGFjZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlVGltZXJTdHlsZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJUaW1lci9wcm9ncmVzcyBzdHlsZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1jbG9ja1wiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzVGltZXJTdHlsZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlVGltZXJDb2xvclwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJUaW1lci9wcm9ncmVzcyBjb2xvci4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1jbG9ja1wiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzVGltZXJDb2xvcixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlVGltZXJPcGFjaXR5XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlRpbWVyL3Byb2dyZXNzIG9wYWNpdHkuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtY2xvY2tcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1RpbWVyT3BhY2l0eSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlSGlnaGxpZ2h0TW9kZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJIaWdobGlnaHQgbW9kZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1oaWdobGlnaHRlclwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzSGlnaGxpZ2h0TW9kZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU2hvd0F2ZXJhZ2VcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiU2hvdyBhdmVyYWdlLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWNoYXJ0LWJhclwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzU2hvd0F2ZXJhZ2UsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUN1c3RvbUJhY2tncm91bmRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQ3VzdG9tIGJhY2tncm91bmQuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtaW1hZ2VcIixcbiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogXCJcIixcbiAgICAgICAgICAgIGlucHV0OiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKGlucHV0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFpbnB1dClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21CYWNrZ3JvdW5kKGlucHV0KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUxhbmd1YWdlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkxhbmd1YWdlLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWxhbmd1YWdlXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNMYW5ndWFnZXMsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUJyaXRpc2hFbmdsaXNoXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkJyaXRpc2ggZW5nbGlzaC4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1sYW5ndWFnZVwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzQnJpdGlzaEVuZ2xpc2gsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUZ1bmJveFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJGdW5ib3guLi5cIixcbiAgICAgICAgICAgIGFsaWFzOiBcImZ1biBib3hcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtZ2FtZXBhZFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzRnVuYm94LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VMYXlvdXRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiTGF5b3V0IGVtdWxhdG9yLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWtleWJvYXJkXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNMYXlvdXRzLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJ0b2dnbGVLZXltYXBcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiS2V5bWFwIG1vZGUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEta2V5Ym9hcmRcIixcbiAgICAgICAgICAgIGFsaWFzOiBcImtleWJvYXJkXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNLZXltYXBNb2RlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VLZXltYXBTdHlsZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJLZXltYXAgc3R5bGUuLi5cIixcbiAgICAgICAgICAgIGFsaWFzOiBcImtleWJvYXJkXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWtleWJvYXJkXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNLZXltYXBTdHlsZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlS2V5bWFwTGVnZW5kU3R5bGVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiS2V5bWFwIGxlZ2VuZCBzdHlsZS4uLlwiLFxuICAgICAgICAgICAgYWxpYXM6IFwia2V5Ym9hcmRcIixcbiAgICAgICAgICAgIGljb246IFwiZmEta2V5Ym9hcmRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0tleW1hcExlZ2VuZFN0eWxlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VLZXltYXBMYXlvdXRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiS2V5bWFwIGxheW91dC4uLlwiLFxuICAgICAgICAgICAgYWxpYXM6IFwia2V5Ym9hcmRcIixcbiAgICAgICAgICAgIGljb246IFwiZmEta2V5Ym9hcmRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBleHBvcnRzLmNvbW1hbmRzS2V5bWFwTGF5b3V0cyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlQ3VzdG9tTGF5b3V0Zmx1aWRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQ3VzdG9tIGxheW91dGZsdWlkLi4uXCIsXG4gICAgICAgICAgICBkZWZhdWx0VmFsdWU6IFwicXdlcnR5IGR2b3JhayBjb2xlbWFrXCIsXG4gICAgICAgICAgICBpbnB1dDogdHJ1ZSxcbiAgICAgICAgICAgIGljb246IFwiZmEtdGludFwiLFxuICAgICAgICAgICAgZXhlYzogKGlucHV0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGlucHV0ID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tTGF5b3V0Zmx1aWQoaW5wdXQpO1xuICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJsYXlvdXRmbHVpZFwiKVxuICAgICAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZUNvbmZpZy5zZXRMYXlvdXQoXG4gICAgICAgICAgICAgICAgLy8gICBDb25maWcuY3VzdG9tTGF5b3V0Zmx1aWRcbiAgICAgICAgICAgICAgICAvLyAgICAgPyBDb25maWcuY3VzdG9tTGF5b3V0Zmx1aWQuc3BsaXQoXCJfXCIpWzBdXG4gICAgICAgICAgICAgICAgLy8gICAgIDogXCJxd2VydHlcIlxuICAgICAgICAgICAgICAgIC8vICk7XG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlQ29uZmlnLnNldEtleW1hcExheW91dChcbiAgICAgICAgICAgICAgICAvLyAgIENvbmZpZy5jdXN0b21MYXlvdXRmbHVpZFxuICAgICAgICAgICAgICAgIC8vICAgICA/IENvbmZpZy5jdXN0b21MYXlvdXRmbHVpZC5zcGxpdChcIl9cIilbMF1cbiAgICAgICAgICAgICAgICAvLyAgICAgOiBcInF3ZXJ0eVwiXG4gICAgICAgICAgICAgICAgLy8gKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUZvbnRTaXplXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkZvbnQgc2l6ZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1mb250XCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNGb250U2l6ZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlRm9udEZhbWlseVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJGb250IGZhbWlseS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1mb250XCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNGb250cyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUGFnZVdpZHRoXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlBhZ2Ugd2lkdGguLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtYXJyb3dzLWFsdC1oXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNQYWdlV2lkdGgsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInZpZXdUeXBpbmdQYWdlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlZpZXcgVHlwaW5nIFBhZ2VcIixcbiAgICAgICAgICAgIGFsaWFzOiBcInN0YXJ0IGJlZ2luIHR5cGUgdGVzdFwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1rZXlib2FyZFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICQoXCIjdG9wICNtZW51IC5pY29uLWJ1dHRvbi52aWV3LXN0YXJ0XCIpLnRyaWdnZXIoXCJjbGlja1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInZpZXdMZWFkZXJib2FyZHNcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiVmlldyBMZWFkZXJib2FyZHMgUGFnZVwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1jcm93blwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICQoXCIjdG9wICNtZW51IC5pY29uLWJ1dHRvbi52aWV3LWxlYWRlcmJvYXJkc1wiKS50cmlnZ2VyKFwiY2xpY2tcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJ2aWV3QWJvdXRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiVmlldyBBYm91dCBQYWdlXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWluZm9cIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAkKFwiI3RvcCAjbWVudSAuaWNvbi1idXR0b24udmlldy1hYm91dFwiKS50cmlnZ2VyKFwiY2xpY2tcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJ2aWV3U2V0dGluZ3NcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiVmlldyBTZXR0aW5ncyBQYWdlXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWNvZ1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICQoXCIjdG9wICNtZW51IC5pY29uLWJ1dHRvbi52aWV3LXNldHRpbmdzXCIpLnRyaWdnZXIoXCJjbGlja1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInZpZXdRdW90ZVNlYXJjaFBvcHVwXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlNlYXJjaCBmb3IgcXVvdGVzXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXNlYXJjaFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwicXVvdGVcIik7XG4gICAgICAgICAgICAgICAgJChcIiNxdW90ZS1zZWFyY2gtYnV0dG9uXCIpLnRyaWdnZXIoXCJjbGlja1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzaG91bGRGb2N1c1Rlc3RVSTogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInZpZXdBY2NvdW50XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlZpZXcgQWNjb3VudCBQYWdlXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXVzZXJcIixcbiAgICAgICAgICAgIGFsaWFzOiBcInN0YXRzXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgJChcIiN0b3AgI21lbnUgLmljb24tYnV0dG9uLnZpZXctYWNjb3VudFwiKS5oYXNDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgICAgICAgICA/ICQoXCIjdG9wICNtZW51IC5pY29uLWJ1dHRvbi52aWV3LWxvZ2luXCIpLnRyaWdnZXIoXCJjbGlja1wiKVxuICAgICAgICAgICAgICAgICAgICA6ICQoXCIjdG9wICNtZW51IC5pY29uLWJ1dHRvbi52aWV3LWFjY291bnRcIikudHJpZ2dlcihcImNsaWNrXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwidG9nZ2xlRnVsbHNjcmVlblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJUb2dnbGUgRnVsbHNjcmVlblwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1leHBhbmRcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBNaXNjLnRvZ2dsZUZ1bGxzY3JlZW4oKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImJhaWxPdXRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQmFpbCBvdXQuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtcnVubmluZ1wiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IHtcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJBcmUgeW91IHN1cmUuLi5cIixcbiAgICAgICAgICAgICAgICBsaXN0OiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBcImJhaWxPdXROb1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogXCJOZXZlcm1pbmRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYW5CYWlsT3V0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogXCJiYWlsT3V0Rm9yU3VyZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogXCJZZXMsIEkgYW0gc3VyZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRlc3RJbnB1dC5zZXRCYWlsb3V0KHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5maW5pc2goKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhdmFpbGFibGU6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FuQmFpbE91dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAgICAgICAgYXZhaWxhYmxlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbkJhaWxPdXQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImxvYWRDaGFsbGVuZ2VcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiTG9hZCBjaGFsbGVuZ2UuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtYXdhcmRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBleHBvcnRzLmNvbW1hbmRzQ2hhbGxlbmdlcyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiam9pbkRpc2NvcmRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiSm9pbiB0aGUgRGlzY29yZCBzZXJ2ZXJcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtdXNlcnNcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB3aW5kb3cub3BlbihcImh0dHBzOi8vZGlzY29yZC5nZy9tb25rZXl0eXBlXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwicmVwZWF0VGVzdFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJSZXBlYXQgdGVzdFwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1zeW5jLWFsdFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGF2YWlsYWJsZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBUZXN0VUkucmVzdWx0VmlzaWJsZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInByYWN0aXNlV29yZHNcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiUHJhY3RpY2Ugd29yZHMuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtZXhjbGFtYXRpb24tdHJpYW5nbGVcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1ByYWN0aXNlV29yZHMsXG4gICAgICAgICAgICBhdmFpbGFibGU6ICgpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gVGVzdFVJLnJlc3VsdFZpc2libGU7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJ0b2dnbGVXb3JkSGlzdG9yeVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJUb2dnbGUgd29yZCBoaXN0b3J5XCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWFsaWduLWxlZnRcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBUZXN0VUkudG9nZ2xlUmVzdWx0V29yZHMoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhdmFpbGFibGU6ICgpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gVGVzdFVJLnJlc3VsdFZpc2libGU7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzYXZlU2NyZWVuc2hvdFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJTYXZlIHNjcmVlbnNob3RcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtaW1hZ2VcIixcbiAgICAgICAgICAgIGFsaWFzOiBcInNzIHBpY3R1cmVcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgVGVzdFVJLnNjcmVlbnNob3QoKTtcbiAgICAgICAgICAgICAgICB9LCA1MDApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGF2YWlsYWJsZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBUZXN0VUkucmVzdWx0VmlzaWJsZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUN1c3RvbU1vZGVUZXh0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkNoYW5nZSBjdXN0b20gdGV4dFwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1hbGlnbi1sZWZ0XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dFBvcHVwLnNob3coKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInRvZ2dsZU1vbmtleVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJUb2dnbGUgTW9ua2V5XCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWVnZ1wiLFxuICAgICAgICAgICAgdmlzaWJsZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vbmtleSghY29uZmlnXzEuZGVmYXVsdC5tb25rZXkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY29weVdvcmRzVG9DbGlwYm9hcmRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQ29weSB3b3JkcyB0byBjbGlwYm9hcmRcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtY29weVwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZXhwb3J0cy5jdXJyZW50LnB1c2goY29tbWFuZHNDb3B5V29yZHNUb0NsaXBib2FyZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJpbXBvcnRTZXR0aW5nc0pTT05cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiSW1wb3J0IHNldHRpbmdzIEpTT05cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtY29nXCIsXG4gICAgICAgICAgICBpbnB1dDogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6IChpbnB1dCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghaW5wdXQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuYXBwbHkoSlNPTi5wYXJzZShpbnB1dCkpO1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2F2ZUZ1bGxDb25maWdUb0xvY2FsU3RvcmFnZSgpO1xuICAgICAgICAgICAgICAgICAgICBTZXR0aW5ncy51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJEb25lXCIsIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkFuIGVycm9yIG9jY3VyZWQgd2hpbGUgaW1wb3J0aW5nIHNldHRpbmdzOiBcIiArIGUsIC0xKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJleHBvcnRTZXR0aW5nc0pTT05cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiRXhwb3J0IHNldHRpbmdzIEpTT05cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtY29nXCIsXG4gICAgICAgICAgICBpbnB1dDogdHJ1ZSxcbiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogXCJcIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwibW9ua2V5UG93ZXJcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiUG93ZXIgbW9kZS4uLlwiLFxuICAgICAgICAgICAgYWxpYXM6IFwicG93ZXJtb2RlXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWVnZ1wiLFxuICAgICAgICAgICAgdmlzaWJsZTogZmFsc2UsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNNb25rZXlQb3dlckxldmVsLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjbGVhclN3Q2FjaGVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQ2xlYXIgU1cgY2FjaGVcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtY29nXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjbGlzdCA9IHlpZWxkIGNhY2hlcy5rZXlzKCk7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBuYW1lIG9mIGNsaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIHlpZWxkIGNhY2hlcy5kZWxldGUobmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJnZXRTd0NhY2hlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkdldCBTVyBjYWNoZVwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1jb2dcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgICAgIGFsZXJ0KHlpZWxkIGNhY2hlcy5rZXlzKCkpO1xuICAgICAgICAgICAgfSksXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5leHBvcnRzLmN1cnJlbnQgPSBbZXhwb3J0cy5kZWZhdWx0Q29tbWFuZHNdO1xuZnVuY3Rpb24gc2V0Q3VycmVudCh2YWwpIHtcbiAgICBleHBvcnRzLmN1cnJlbnQgPSB2YWw7XG59XG5leHBvcnRzLnNldEN1cnJlbnQgPSBzZXRDdXJyZW50O1xuZnVuY3Rpb24gcHVzaEN1cnJlbnQodmFsKSB7XG4gICAgZXhwb3J0cy5jdXJyZW50LnB1c2godmFsKTtcbn1cbmV4cG9ydHMucHVzaEN1cnJlbnQgPSBwdXNoQ3VycmVudDtcbmNvbnN0IGxpc3RzT2JqZWN0ID0ge1xuICAgIGNvbW1hbmRzQ2hhbGxlbmdlczogZXhwb3J0cy5jb21tYW5kc0NoYWxsZW5nZXMsXG4gICAgY29tbWFuZHNMYW5ndWFnZXMsXG4gICAgY29tbWFuZHNEaWZmaWN1bHR5LFxuICAgIGNvbW1hbmRzTGF6eU1vZGUsXG4gICAgY29tbWFuZHNQYWNlQ2FyZXQsXG4gICAgY29tbWFuZHNTaG93QXZlcmFnZSxcbiAgICBjb21tYW5kc01pbldwbSxcbiAgICBjb21tYW5kc01pbkFjYyxcbiAgICBjb21tYW5kc01pbkJ1cnN0LFxuICAgIGNvbW1hbmRzRnVuYm94LFxuICAgIGNvbW1hbmRzQ29uZmlkZW5jZU1vZGUsXG4gICAgY29tbWFuZHNTdG9wT25FcnJvcixcbiAgICBjb21tYW5kc0xheW91dHMsXG4gICAgY29tbWFuZHNPcHBvc2l0ZVNoaWZ0TW9kZSxcbiAgICBjb21tYW5kc1RhZ3MsXG59O1xuZnVuY3Rpb24gZ2V0TGlzdChsaXN0KSB7XG4gICAgcmV0dXJuIGxpc3RzT2JqZWN0W2xpc3RdO1xufVxuZXhwb3J0cy5nZXRMaXN0ID0gZ2V0TGlzdDtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXksIGV2ZW50VmFsdWUpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcInNhdmVUb0xvY2FsU3RvcmFnZVwiKSB7XG4gICAgICAgIGV4cG9ydHMuZGVmYXVsdENvbW1hbmRzLmxpc3QuZmlsdGVyKChjb21tYW5kKSA9PiBjb21tYW5kLmlkID09IFwiZXhwb3J0U2V0dGluZ3NKU09OXCIpWzBdLmRlZmF1bHRWYWx1ZSA9IGV2ZW50VmFsdWU7XG4gICAgfVxuICAgIGlmIChldmVudEtleSA9PT0gXCJjdXN0b21CYWNrZ3JvdW5kXCIpIHtcbiAgICAgICAgZXhwb3J0cy5kZWZhdWx0Q29tbWFuZHMubGlzdC5maWx0ZXIoKGNvbW1hbmQpID0+IGNvbW1hbmQuaWQgPT0gXCJjaGFuZ2VDdXN0b21CYWNrZ3JvdW5kXCIpWzBdLmRlZmF1bHRWYWx1ZSA9IGV2ZW50VmFsdWU7XG4gICAgfVxuICAgIGlmIChldmVudEtleSA9PT0gXCJjdXN0b21MYXlvdXRGbHVpZFwiKSB7XG4gICAgICAgIGV4cG9ydHMuZGVmYXVsdENvbW1hbmRzLmxpc3QuZmlsdGVyKChjb21tYW5kKSA9PiBjb21tYW5kLmlkID09IFwiY2hhbmdlQ3VzdG9tTGF5b3V0Zmx1aWRcIilbMF0uZGVmYXVsdFZhbHVlID0gKF9hID0gZXZlbnRWYWx1ZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlcGxhY2UoLyMvZywgXCIgXCIpO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2hvdyA9IGV4cG9ydHMuaXNTaW5nbGVMaXN0Q29tbWFuZExpbmVBY3RpdmUgPSB2b2lkIDA7XG5jb25zdCBUaGVtZUNvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL3RoZW1lLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgRm9jdXMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvZm9jdXNcIikpO1xuY29uc3QgQ29tbWFuZGxpbmVMaXN0cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jb21tYW5kbGluZS1saXN0c1wiKSk7XG5jb25zdCBUZXN0VUkgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC11aVwiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBBbmFseXRpY3NDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9hbmFseXRpY3MtY29udHJvbGxlclwiKSk7XG5jb25zdCBQYWdlVHJhbnNpdGlvbiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3BhZ2UtdHJhbnNpdGlvblwiKSk7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xubGV0IGNvbW1hbmRMaW5lTW91c2VNb2RlID0gZmFsc2U7XG5mdW5jdGlvbiBzaG93SW5wdXQoY29tbWFuZCwgcGxhY2Vob2xkZXIsIGRlZmF1bHRWYWx1ZSA9IFwiXCIpIHtcbiAgICAkKFwiI2NvbW1hbmRMaW5lV3JhcHBlclwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAkKFwiI2NvbW1hbmRMaW5lXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICQoXCIjY29tbWFuZElucHV0XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICQoXCIjY29tbWFuZElucHV0IGlucHV0XCIpLmF0dHIoXCJwbGFjZWhvbGRlclwiLCBwbGFjZWhvbGRlcik7XG4gICAgJChcIiNjb21tYW5kSW5wdXQgaW5wdXRcIikudmFsKGRlZmF1bHRWYWx1ZSk7XG4gICAgJChcIiNjb21tYW5kSW5wdXQgaW5wdXRcIikudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgICQoXCIjY29tbWFuZElucHV0IGlucHV0XCIpLmF0dHIoXCJjb21tYW5kXCIsIFwiXCIpO1xuICAgICQoXCIjY29tbWFuZElucHV0IGlucHV0XCIpLmF0dHIoXCJjb21tYW5kXCIsIGNvbW1hbmQpO1xuICAgIGlmIChkZWZhdWx0VmFsdWUgIT0gXCJcIikge1xuICAgICAgICAkKFwiI2NvbW1hbmRJbnB1dCBpbnB1dFwiKS5zZWxlY3QoKTtcbiAgICB9XG59XG5mdW5jdGlvbiBpc1NpbmdsZUxpc3RDb21tYW5kTGluZUFjdGl2ZSgpIHtcbiAgICByZXR1cm4gJChcIiNjb21tYW5kTGluZVwiKS5oYXNDbGFzcyhcImFsbENvbW1hbmRzXCIpO1xufVxuZXhwb3J0cy5pc1NpbmdsZUxpc3RDb21tYW5kTGluZUFjdGl2ZSA9IGlzU2luZ2xlTGlzdENvbW1hbmRMaW5lQWN0aXZlO1xuZnVuY3Rpb24gc2hvd0ZvdW5kKCkge1xuICAgICQoXCIjY29tbWFuZExpbmUgLnN1Z2dlc3Rpb25zXCIpLmVtcHR5KCk7XG4gICAgbGV0IGNvbW1hbmRzSFRNTCA9IFwiXCI7XG4gICAgY29uc3QgbGlzdCA9IENvbW1hbmRsaW5lTGlzdHMuY3VycmVudFtDb21tYW5kbGluZUxpc3RzLmN1cnJlbnQubGVuZ3RoIC0gMV07XG4gICAgJC5lYWNoKGxpc3QubGlzdCwgKF9pbmRleCwgb2JqKSA9PiB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgaWYgKG9iai5mb3VuZCAmJiAob2JqLmF2YWlsYWJsZSAhPT0gdW5kZWZpbmVkID8gb2JqLmF2YWlsYWJsZSgpIDogdHJ1ZSkpIHtcbiAgICAgICAgICAgIGxldCBpY29uID0gKF9hID0gb2JqLmljb24pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiZmEtY2hldnJvbi1yaWdodFwiO1xuICAgICAgICAgICAgY29uc3QgZmFJY29uID0gL15mYS0vZy50ZXN0KGljb24pO1xuICAgICAgICAgICAgaWYgKCFmYUljb24pIHtcbiAgICAgICAgICAgICAgICBpY29uID0gYDxkaXYgY2xhc3M9XCJ0ZXh0SWNvblwiPiR7aWNvbn08L2Rpdj5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWNvbiA9IGA8aSBjbGFzcz1cImZhcyBmYS1mdyAke2ljb259XCI+PC9pPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobGlzdC5jb25maWdLZXkpIHtcbiAgICAgICAgICAgICAgICBpZiAoKG9iai5jb25maWdWYWx1ZU1vZGUgJiZcbiAgICAgICAgICAgICAgICAgICAgb2JqLmNvbmZpZ1ZhbHVlTW9kZSA9PT0gXCJpbmNsdWRlXCIgJiZcbiAgICAgICAgICAgICAgICAgICAgLy8gdG9kbyBmaWd1cmUgdGhpcyBvdXQgd2l0aG91dCB1c2luZyBhbnlcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdFtsaXN0LmNvbmZpZ0tleV0uaW5jbHVkZXMob2JqLmNvbmZpZ1ZhbHVlKSkgfHxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdFtsaXN0LmNvbmZpZ0tleV0gPT09IG9iai5jb25maWdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpY29uID0gYDxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWNoZWNrXCI+PC9pPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpY29uID0gYDxpIGNsYXNzPVwiZmFzIGZhLWZ3XCI+PC9pPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGljb25IVE1MID0gYDxkaXYgY2xhc3M9XCJpY29uXCI+JHtpY29ufTwvZGl2PmA7XG4gICAgICAgICAgICBpZiAob2JqLm5vSWNvbiAmJiAhaXNTaW5nbGVMaXN0Q29tbWFuZExpbmVBY3RpdmUoKSkge1xuICAgICAgICAgICAgICAgIGljb25IVE1MID0gXCJcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbW1hbmRzSFRNTCArPSBgPGRpdiBjbGFzcz1cImVudHJ5XCIgY29tbWFuZD1cIiR7b2JqLmlkfVwiPiR7aWNvbkhUTUx9PGRpdj4ke29iai5kaXNwbGF5fTwvZGl2PjwvZGl2PmA7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICAkKFwiI2NvbW1hbmRMaW5lIC5zdWdnZXN0aW9uc1wiKS5odG1sKGNvbW1hbmRzSFRNTCk7XG4gICAgaWYgKCQoXCIjY29tbWFuZExpbmUgLnN1Z2dlc3Rpb25zIC5lbnRyeVwiKS5sZW5ndGggPT0gMCkge1xuICAgICAgICAkKFwiI2NvbW1hbmRMaW5lIC5zZXBhcmF0b3JcIikuY3NzKHsgaGVpZ2h0OiAwLCBtYXJnaW46IDAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiI2NvbW1hbmRMaW5lIC5zZXBhcmF0b3JcIikuY3NzKHtcbiAgICAgICAgICAgIGhlaWdodDogXCIxcHhcIixcbiAgICAgICAgICAgIFwibWFyZ2luLWJvdHRvbVwiOiBcIi41cmVtXCIsXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBlbnRyaWVzID0gJChcIiNjb21tYW5kTGluZSAuc3VnZ2VzdGlvbnMgLmVudHJ5XCIpO1xuICAgIGlmIChlbnRyaWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgJChlbnRyaWVzWzBdKS5hZGRDbGFzcyhcImFjdGl2ZUtleWJvYXJkXCIpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgJC5lYWNoKGxpc3QubGlzdCwgKF9pbmRleCwgb2JqKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5mb3VuZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoKCEvdGhlbWUvZ2kudGVzdChvYmouaWQpIHx8IG9iai5pZCA9PT0gXCJ0b2dnbGVDdXN0b21UaGVtZVwiKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgIVRoZW1lQ29udHJvbGxlci5yYW5kb21UaGVtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgVGhlbWVDb250cm9sbGVyLmNsZWFyUHJldmlldygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghL2ZvbnQvZ2kudGVzdChvYmouaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcucHJldmlld0ZvbnRGYW1pbHkoY29uZmlnXzEuZGVmYXVsdC5mb250RmFtaWx5KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmhvdmVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmhvdmVyKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IH1cbiAgICB9XG4gICAgJChcIiNjb21tYW5kTGluZSAubGlzdFRpdGxlXCIpLnJlbW92ZSgpO1xufVxuZnVuY3Rpb24gdXBkYXRlU3VnZ2VzdGVkKCkge1xuICAgIGNvbnN0IGlucHV0VmFsID0gJChcIiNjb21tYW5kTGluZSBpbnB1dFwiKS52YWwoKVxuICAgICAgICAudG9Mb3dlckNhc2UoKVxuICAgICAgICAuc3BsaXQoXCIgXCIpXG4gICAgICAgIC5maWx0ZXIoKHMsIGkpID0+IHMgfHwgaSA9PSAwKTsgLy9yZW1vdmUgZW1wdHkgZW50cmllcyBhZnRlciBmaXJzdFxuICAgIGNvbnN0IGxpc3QgPSBDb21tYW5kbGluZUxpc3RzLmN1cnJlbnRbQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50Lmxlbmd0aCAtIDFdO1xuICAgIGlmIChpbnB1dFZhbFswXSA9PT0gXCJcIiAmJlxuICAgICAgICBjb25maWdfMS5kZWZhdWx0LnNpbmdsZUxpc3RDb21tYW5kTGluZSA9PT0gXCJvblwiICYmXG4gICAgICAgIENvbW1hbmRsaW5lTGlzdHMuY3VycmVudC5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgJC5lYWNoKGxpc3QubGlzdCwgKF9pbmRleCwgb2JqKSA9PiB7XG4gICAgICAgICAgICBvYmouZm91bmQgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHNob3dGb3VuZCgpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vaWdub3JlIHRoZSBwcmVjZWVkaW5nIFwiPlwicyBpbiB0aGUgY29tbWFuZCBsaW5lIGlucHV0XG4gICAgaWYgKGlucHV0VmFsWzBdICYmIGlucHV0VmFsWzBdWzBdID09IFwiPlwiKSB7XG4gICAgICAgIGlucHV0VmFsWzBdID0gaW5wdXRWYWxbMF0ucmVwbGFjZSgvXj4rLywgXCJcIik7XG4gICAgfVxuICAgIGlmIChpbnB1dFZhbFswXSA9PSBcIlwiICYmIGlucHV0VmFsLmxlbmd0aCA9PSAxKSB7XG4gICAgICAgICQuZWFjaChsaXN0Lmxpc3QsIChfaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICAgICAgaWYgKG9iai52aXNpYmxlICE9PSBmYWxzZSlcbiAgICAgICAgICAgICAgICBvYmouZm91bmQgPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQuZWFjaChsaXN0Lmxpc3QsIChfaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICAgICAgbGV0IGZvdW5kY291bnQgPSAwO1xuICAgICAgICAgICAgJC5lYWNoKGlucHV0VmFsLCAoX2luZGV4Miwgb2JqMikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChvYmoyID09IFwiXCIpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBjb25zdCBlc2NhcGVkID0gb2JqMi5yZXBsYWNlKC9bLVtcXF17fSgpKis/LixcXFxcXiR8I1xcc10vZywgXCJcXFxcJCZcIik7XG4gICAgICAgICAgICAgICAgY29uc3QgcmUgPSBuZXcgUmVnRXhwKFwiXFxcXGJcIiArIGVzY2FwZWQsIFwiZ1wiKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZXMgPSBvYmouZGlzcGxheS50b0xvd2VyQ2FzZSgpLm1hdGNoKHJlKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZXMyID0gb2JqLmFsaWFzICE9PSB1bmRlZmluZWQgPyBvYmouYWxpYXMudG9Mb3dlckNhc2UoKS5tYXRjaChyZSkgOiBudWxsO1xuICAgICAgICAgICAgICAgIGlmICgocmVzICE9IG51bGwgJiYgcmVzLmxlbmd0aCA+IDApIHx8XG4gICAgICAgICAgICAgICAgICAgIChyZXMyICE9IG51bGwgJiYgcmVzMi5sZW5ndGggPiAwKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZGNvdW50Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZGNvdW50LS07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoZm91bmRjb3VudCA+IGlucHV0VmFsLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICBvYmouZm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgb2JqLmZvdW5kID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzaG93Rm91bmQoKTtcbn1cbmxldCBzaG93ID0gKCkgPT4ge1xuICAgIGlmICghJChcIi5wYWdlLnBhZ2VMb2FkaW5nXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKVxuICAgICAgICByZXR1cm47XG4gICAgRm9jdXMuc2V0KGZhbHNlKTtcbiAgICAkKFwiI2NvbW1hbmRMaW5lXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICQoXCIjY29tbWFuZElucHV0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIGlmICgkKFwiI2NvbW1hbmRMaW5lV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI2NvbW1hbmRMaW5lV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgIH0sIDEwMCk7XG4gICAgfVxuICAgICQoXCIjY29tbWFuZExpbmUgaW5wdXRcIikudmFsKFwiXCIpO1xuICAgIENvbW1hbmRsaW5lTGlzdHMudXBkYXRlVGhlbWVDb21tYW5kcygpO1xuICAgIHVwZGF0ZVN1Z2dlc3RlZCgpO1xuICAgICQoXCIjY29tbWFuZExpbmUgaW5wdXRcIikudHJpZ2dlcihcImZvY3VzXCIpO1xufTtcbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKHNob3VsZEZvY3VzVGVzdFVJID0gdHJ1ZSkge1xuICAgIFVwZGF0ZUNvbmZpZy5wcmV2aWV3Rm9udEZhbWlseShjb25maWdfMS5kZWZhdWx0LmZvbnRGYW1pbHkpO1xuICAgIC8vIGFwcGx5Q3VzdG9tVGhlbWVDb2xvcnMoKTtcbiAgICBpZiAoIVRoZW1lQ29udHJvbGxlci5yYW5kb21UaGVtZSkge1xuICAgICAgICBUaGVtZUNvbnRyb2xsZXIuY2xlYXJQcmV2aWV3KCk7XG4gICAgfVxuICAgICQoXCIjY29tbWFuZExpbmVXcmFwcGVyXCIpXG4gICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogMCxcbiAgICB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgJChcIiNjb21tYW5kTGluZVdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjY29tbWFuZExpbmVcIikucmVtb3ZlQ2xhc3MoXCJhbGxDb21tYW5kc1wiKTtcbiAgICAgICAgaWYgKHNob3VsZEZvY3VzVGVzdFVJKSB7XG4gICAgICAgICAgICBUZXN0VUkuZm9jdXNXb3JkcygpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgaWYgKHNob3VsZEZvY3VzVGVzdFVJKSB7XG4gICAgICAgIFRlc3RVSS5mb2N1c1dvcmRzKCk7XG4gICAgfVxufVxuZnVuY3Rpb24gdHJpZ2dlcihjb21tYW5kKSB7XG4gICAgbGV0IHN1Ymdyb3VwID0gZmFsc2U7XG4gICAgbGV0IGlucHV0ID0gZmFsc2U7XG4gICAgbGV0IHNob3VsZEZvY3VzVGVzdFVJID0gdHJ1ZTtcbiAgICBjb25zdCBsaXN0ID0gQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50W0NvbW1hbmRsaW5lTGlzdHMuY3VycmVudC5sZW5ndGggLSAxXTtcbiAgICBsZXQgc3RpY2t5ID0gZmFsc2U7XG4gICAgJC5lYWNoKGxpc3QubGlzdCwgKF9pbmRleCwgb2JqKSA9PiB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgaWYgKG9iai5pZCA9PSBjb21tYW5kKSB7XG4gICAgICAgICAgICBpZiAob2JqLnNob3VsZEZvY3VzVGVzdFVJICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBzaG91bGRGb2N1c1Rlc3RVSSA9IG9iai5zaG91bGRGb2N1c1Rlc3RVSTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvYmouaW5wdXQpIHtcbiAgICAgICAgICAgICAgICBpbnB1dCA9IHRydWU7XG4gICAgICAgICAgICAgICAgY29uc3QgZXNjYXBlZCA9IChfYSA9IG9iai5kaXNwbGF5LnNwbGl0KFwiPC9pPlwiKVsxXSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogb2JqLmRpc3BsYXk7XG4gICAgICAgICAgICAgICAgc2hvd0lucHV0KG9iai5pZCwgZXNjYXBlZCwgb2JqLmRlZmF1bHRWYWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChvYmouc3ViZ3JvdXApIHtcbiAgICAgICAgICAgICAgICBzdWJncm91cCA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5iZWZvcmVTdWJncm91cCkge1xuICAgICAgICAgICAgICAgICAgICBvYmouYmVmb3JlU3ViZ3JvdXAoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50LnB1c2gob2JqLnN1Ymdyb3VwKTtcbiAgICAgICAgICAgICAgICAoMCwgZXhwb3J0cy5zaG93KSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5leGVjKVxuICAgICAgICAgICAgICAgICAgICBvYmouZXhlYygpO1xuICAgICAgICAgICAgICAgIGlmIChvYmouc3RpY2t5ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0aWNreSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG4gICAgaWYgKCFzdWJncm91cCAmJiAhaW5wdXQgJiYgIXN0aWNreSkge1xuICAgICAgICBBbmFseXRpY3NDb250cm9sbGVyLmxvZyhcInVzZWRDb21tYW5kTGluZVwiLCB7IGNvbW1hbmQgfSk7XG4gICAgICAgIGhpZGUoc2hvdWxkRm9jdXNUZXN0VUkpO1xuICAgIH1cbn1cbi8vdG9kbyByZXdyaXRlIHRoaXMgbWVzc1xuZnVuY3Rpb24gYWRkQ2hpbGRDb21tYW5kcyh1bmlmaWVkQ29tbWFuZHMsIGNvbW1hbmRJdGVtLCBwYXJlbnRDb21tYW5kRGlzcGxheSA9IFwiXCIsIHBhcmVudENvbW1hbmQpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGxldCBjb21tYW5kSXRlbURpc3BsYXkgPSBjb21tYW5kSXRlbS5kaXNwbGF5LnJlcGxhY2UoL1xccz9cXC5cXC5cXC4kL2csIFwiXCIpO1xuICAgIGxldCBpY29uID0gYDxpIGNsYXNzPVwiZmFzIGZhLWZ3XCI+PC9pPmA7XG4gICAgaWYgKGNvbW1hbmRJdGVtLmNvbmZpZ1ZhbHVlICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdFtwYXJlbnRDb21tYW5kID09PSBudWxsIHx8IHBhcmVudENvbW1hbmQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBhcmVudENvbW1hbmQuY29uZmlnS2V5XSA9PT1cbiAgICAgICAgICAgIGNvbW1hbmRJdGVtLmNvbmZpZ1ZhbHVlKSB7XG4gICAgICAgIGljb24gPSBgPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtY2hlY2tcIj48L2k+YDtcbiAgICB9XG4gICAgaWYgKGNvbW1hbmRJdGVtLm5vSWNvbikge1xuICAgICAgICBpY29uID0gXCJcIjtcbiAgICB9XG4gICAgaWYgKHBhcmVudENvbW1hbmREaXNwbGF5KSB7XG4gICAgICAgIGNvbW1hbmRJdGVtRGlzcGxheSA9XG4gICAgICAgICAgICBwYXJlbnRDb21tYW5kRGlzcGxheSArIFwiID4gXCIgKyBpY29uICsgY29tbWFuZEl0ZW1EaXNwbGF5O1xuICAgIH1cbiAgICBpZiAoY29tbWFuZEl0ZW0uc3ViZ3JvdXApIHtcbiAgICAgICAgY29uc3QgY29tbWFuZCA9IGNvbW1hbmRJdGVtO1xuICAgICAgICBpZiAoY29tbWFuZC5iZWZvcmVTdWJncm91cClcbiAgICAgICAgICAgIGNvbW1hbmQuYmVmb3JlU3ViZ3JvdXAoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIChfYiA9ICgoX2EgPSBjb21tYW5kSXRlbSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN1Ymdyb3VwKS5saXN0KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZm9yRWFjaCgoY21kKSA9PiB7XG4gICAgICAgICAgICAgICAgY29tbWFuZEl0ZW0uY29uZmlnS2V5ID0gY29tbWFuZEl0ZW1cbiAgICAgICAgICAgICAgICAgICAgLnN1Ymdyb3VwLmNvbmZpZ0tleTtcbiAgICAgICAgICAgICAgICBhZGRDaGlsZENvbW1hbmRzKHVuaWZpZWRDb21tYW5kcywgY21kLCBjb21tYW5kSXRlbURpc3BsYXksIGNvbW1hbmRJdGVtKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gY29tbWFuZEl0ZW0uZXhlYygpO1xuICAgICAgICAgICAgLy8gY29uc3QgY3VycmVudENvbW1hbmRzSW5kZXggPSBDb21tYW5kbGluZUxpc3RzLmN1cnJlbnQubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgIC8vIENvbW1hbmRsaW5lTGlzdHMuY3VycmVudFtjdXJyZW50Q29tbWFuZHNJbmRleF0ubGlzdC5mb3JFYWNoKChjbWQpID0+IHtcbiAgICAgICAgICAgIC8vICAgaWYgKGNtZC5hbGlhcyA9PT0gdW5kZWZpbmVkKSBjbWQuYWxpYXMgPSBjb21tYW5kSXRlbS5hbGlhcztcbiAgICAgICAgICAgIC8vICAgYWRkQ2hpbGRDb21tYW5kcyh1bmlmaWVkQ29tbWFuZHMsIGNtZCwgY29tbWFuZEl0ZW1EaXNwbGF5KTtcbiAgICAgICAgICAgIC8vIH0pO1xuICAgICAgICAgICAgLy8gQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50LnBvcCgpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IHRlbXBDb21tYW5kSXRlbSA9IE9iamVjdC5hc3NpZ24oe30sIGNvbW1hbmRJdGVtKTtcbiAgICAgICAgaWYgKHBhcmVudENvbW1hbmQpIHtcbiAgICAgICAgICAgIHRlbXBDb21tYW5kSXRlbS5pY29uID0gcGFyZW50Q29tbWFuZC5pY29uO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJlbnRDb21tYW5kRGlzcGxheSlcbiAgICAgICAgICAgIHRlbXBDb21tYW5kSXRlbS5kaXNwbGF5ID0gY29tbWFuZEl0ZW1EaXNwbGF5O1xuICAgICAgICB1bmlmaWVkQ29tbWFuZHMucHVzaCh0ZW1wQ29tbWFuZEl0ZW0pO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGdlbmVyYXRlU2luZ2xlTGlzdE9mQ29tbWFuZHMoKSB7XG4gICAgY29uc3QgYWxsQ29tbWFuZHMgPSBbXTtcbiAgICBjb25zdCBvbGRTaG93Q29tbWFuZExpbmUgPSBleHBvcnRzLnNob3c7XG4gICAgZXhwb3J0cy5zaG93ID0gKCkgPT4ge1xuICAgICAgICAvL1xuICAgIH07XG4gICAgQ29tbWFuZGxpbmVMaXN0cy5kZWZhdWx0Q29tbWFuZHMubGlzdC5mb3JFYWNoKChjKSA9PiBhZGRDaGlsZENvbW1hbmRzKGFsbENvbW1hbmRzLCBjKSk7XG4gICAgZXhwb3J0cy5zaG93ID0gb2xkU2hvd0NvbW1hbmRMaW5lO1xuICAgIHJldHVybiB7XG4gICAgICAgIHRpdGxlOiBcIkFsbCBDb21tYW5kc1wiLFxuICAgICAgICBsaXN0OiBhbGxDb21tYW5kcyxcbiAgICB9O1xufVxuZnVuY3Rpb24gdXNlU2luZ2xlTGlzdENvbW1hbmRMaW5lKHNzaG93ID0gdHJ1ZSkge1xuICAgIGNvbnN0IGFsbENvbW1hbmRzID0gZ2VuZXJhdGVTaW5nbGVMaXN0T2ZDb21tYW5kcygpO1xuICAgIC8vIGlmIChDb25maWcuc2luZ2xlTGlzdENvbW1hbmRMaW5lID09IFwibWFudWFsXCIpIHtcbiAgICAvLyBDb21tYW5kbGluZUxpc3RzLnB1c2hDdXJyZW50KGFsbENvbW1hbmRzKTtcbiAgICAvLyB9IGVsc2UgaWYgKENvbmZpZy5zaW5nbGVMaXN0Q29tbWFuZExpbmUgPT0gXCJvblwiKSB7XG4gICAgQ29tbWFuZGxpbmVMaXN0cy5zZXRDdXJyZW50KFthbGxDb21tYW5kc10pO1xuICAgIC8vIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zaW5nbGVMaXN0Q29tbWFuZExpbmUgIT0gXCJtYW51YWxcIikge1xuICAgICAgICAkKFwiI2NvbW1hbmRMaW5lXCIpLmFkZENsYXNzKFwiYWxsQ29tbWFuZHNcIik7XG4gICAgfVxuICAgIGlmIChzc2hvdylcbiAgICAgICAgKDAsIGV4cG9ydHMuc2hvdykoKTtcbn1cbmZ1bmN0aW9uIHJlc3RvcmVPbGRDb21tYW5kTGluZShzc2hvdyA9IHRydWUpIHtcbiAgICBpZiAoaXNTaW5nbGVMaXN0Q29tbWFuZExpbmVBY3RpdmUoKSkge1xuICAgICAgICAkKFwiI2NvbW1hbmRMaW5lXCIpLnJlbW92ZUNsYXNzKFwiYWxsQ29tbWFuZHNcIik7XG4gICAgICAgIENvbW1hbmRsaW5lTGlzdHMuc2V0Q3VycmVudChDb21tYW5kbGluZUxpc3RzLmN1cnJlbnQuZmlsdGVyKChsKSA9PiBsLnRpdGxlICE9IFwiQWxsIENvbW1hbmRzXCIpKTtcbiAgICAgICAgaWYgKENvbW1hbmRsaW5lTGlzdHMuY3VycmVudC5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgICBDb21tYW5kbGluZUxpc3RzLnNldEN1cnJlbnQoW0NvbW1hbmRsaW5lTGlzdHMuZGVmYXVsdENvbW1hbmRzXSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHNzaG93KVxuICAgICAgICAoMCwgZXhwb3J0cy5zaG93KSgpO1xufVxuJChcIiNjb21tYW5kTGluZSBpbnB1dFwiKS5rZXl1cCgoZSkgPT4ge1xuICAgIGNvbW1hbmRMaW5lTW91c2VNb2RlID0gZmFsc2U7XG4gICAgJChcIiNjb21tYW5kTGluZVdyYXBwZXIgI2NvbW1hbmRMaW5lIC5zdWdnZXN0aW9ucyAuZW50cnlcIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVNb3VzZVwiKTtcbiAgICBpZiAoZS5rZXkgPT09IFwiQXJyb3dVcFwiIHx8XG4gICAgICAgIGUua2V5ID09PSBcIkFycm93RG93blwiIHx8XG4gICAgICAgIGUua2V5ID09PSBcIkVudGVyXCIgfHxcbiAgICAgICAgZS5rZXkgPT09IFwiVGFiXCIgfHxcbiAgICAgICAgZS5jb2RlID09IFwiQWx0TGVmdFwiIHx8XG4gICAgICAgIChlLmtleS5sZW5ndGggPiAxICYmIGUua2V5ICE9PSBcIkJhY2tzcGFjZVwiICYmIGUua2V5ICE9PSBcIkRlbGV0ZVwiKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHVwZGF0ZVN1Z2dlc3RlZCgpO1xufSk7XG4kKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG4gICAgJChkb2N1bWVudCkub24oXCJrZXlkb3duXCIsIChldmVudCkgPT4ge1xuICAgICAgICBpZiAoUGFnZVRyYW5zaXRpb24uZ2V0KCkpXG4gICAgICAgICAgICByZXR1cm4gZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgLy8gb3BlbnMgY29tbWFuZCBsaW5lIGlmIGVzY2FwZSwgY3RybC9jbWQgKyBzaGlmdCArIHAsIG9yIHRhYiBpcyBwcmVzc2VkIGlmIHRoZSBzZXR0aW5nIHN3YXBFc2NBbmRUYWIgaXMgZW5hYmxlZFxuICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiIHx8XG4gICAgICAgICAgICAoZXZlbnQua2V5ICYmXG4gICAgICAgICAgICAgICAgZXZlbnQua2V5LnRvTG93ZXJDYXNlKCkgPT09IFwicFwiICYmXG4gICAgICAgICAgICAgICAgKGV2ZW50Lm1ldGFLZXkgfHwgZXZlbnQuY3RybEtleSkgJiZcbiAgICAgICAgICAgICAgICBldmVudC5zaGlmdEtleSkgfHxcbiAgICAgICAgICAgIChldmVudC5rZXkgPT09IFwiVGFiXCIgJiYgY29uZmlnXzEuZGVmYXVsdC5zd2FwRXNjQW5kVGFiKSkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGNvbnN0IHBvcHVwcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucG9wdXBXcmFwcGVyXCIpO1xuICAgICAgICAgICAgbGV0IHBvcHVwVmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgZm9yIChjb25zdCBwb3B1cCBvZiBwb3B1cHMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXBvcHVwLmNsYXNzTGlzdC5jb250YWlucyhcImhpZGRlblwiKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBwb3B1cFZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocG9wdXBWaXNpYmxlKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGlmICghJChcIiNjb21tYW5kTGluZVdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgICAgICAgICBpZiAoQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50LnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiI2NvbW1hbmRMaW5lXCIpLnJlbW92ZUNsYXNzKFwiYWxsQ29tbWFuZHNcIik7XG4gICAgICAgICAgICAgICAgICAgICgwLCBleHBvcnRzLnNob3cpKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBoaWRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGb250RmFtaWx5KGNvbmZpZ18xLmRlZmF1bHQuZm9udEZhbWlseSwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChldmVudC5rZXkgPT09IFwiVGFiXCIgfHwgIWNvbmZpZ18xLmRlZmF1bHQuc3dhcEVzY0FuZFRhYikge1xuICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnNpbmdsZUxpc3RDb21tYW5kTGluZSA9PSBcIm9uXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdXNlU2luZ2xlTGlzdENvbW1hbmRMaW5lKGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIENvbW1hbmRsaW5lTGlzdHMuc2V0Q3VycmVudChbQ29tbWFuZGxpbmVMaXN0cy5kZWZhdWx0Q29tbWFuZHNdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKDAsIGV4cG9ydHMuc2hvdykoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufSk7XG4kKFwiI2NvbW1hbmRJbnB1dCBpbnB1dFwiKS5vbihcImtleWRvd25cIiwgKGUpID0+IHtcbiAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICAvL2VudGVyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc3QgY29tbWFuZCA9ICQoXCIjY29tbWFuZElucHV0IGlucHV0XCIpLmF0dHIoXCJjb21tYW5kXCIpO1xuICAgICAgICBjb25zdCB2YWx1ZSA9ICQoXCIjY29tbWFuZElucHV0IGlucHV0XCIpLnZhbCgpO1xuICAgICAgICBjb25zdCBsaXN0ID0gQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50W0NvbW1hbmRsaW5lTGlzdHMuY3VycmVudC5sZW5ndGggLSAxXTtcbiAgICAgICAgJC5lYWNoKGxpc3QubGlzdCwgKF9pbmRleCwgb2JqKSA9PiB7XG4gICAgICAgICAgICBpZiAob2JqLmlkID09IGNvbW1hbmQpIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqLmV4ZWMpXG4gICAgICAgICAgICAgICAgICAgIG9iai5leGVjKHZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAob2JqLnN1Ymdyb3VwICE9PSBudWxsICYmIG9iai5zdWJncm91cCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vVE9ETzogd2hhdCBpcyB0aGlzIGZvcj9cbiAgICAgICAgICAgICAgICAgICAgLy8gc3ViZ3JvdXAgPSBvYmouc3ViZ3JvdXA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgQW5hbHl0aWNzQ29udHJvbGxlci5sb2coXCJ1c2VkQ29tbWFuZExpbmVcIiwgeyBjb21tYW5kOiBjb21tYW5kICE9PSBudWxsICYmIGNvbW1hbmQgIT09IHZvaWQgMCA/IGNvbW1hbmQgOiBcIlwiIH0pO1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxuICAgIHJldHVybjtcbn0pO1xuJChkb2N1bWVudCkub24oXCJtb3VzZW1vdmVcIiwgKCkgPT4ge1xuICAgIGlmICghY29tbWFuZExpbmVNb3VzZU1vZGUpXG4gICAgICAgIGNvbW1hbmRMaW5lTW91c2VNb2RlID0gdHJ1ZTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJtb3VzZWVudGVyXCIsIFwiI2NvbW1hbmRMaW5lV3JhcHBlciAjY29tbWFuZExpbmUgLnN1Z2dlc3Rpb25zIC5lbnRyeVwiLCAoZSkgPT4ge1xuICAgIGlmICghY29tbWFuZExpbmVNb3VzZU1vZGUpXG4gICAgICAgIHJldHVybjtcbiAgICAkKGUudGFyZ2V0KS5hZGRDbGFzcyhcImFjdGl2ZU1vdXNlXCIpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcIm1vdXNlbGVhdmVcIiwgXCIjY29tbWFuZExpbmVXcmFwcGVyICNjb21tYW5kTGluZSAuc3VnZ2VzdGlvbnMgLmVudHJ5XCIsIChlKSA9PiB7XG4gICAgaWYgKCFjb21tYW5kTGluZU1vdXNlTW9kZSlcbiAgICAgICAgcmV0dXJuO1xuICAgICQoZS50YXJnZXQpLnJlbW92ZUNsYXNzKFwiYWN0aXZlTW91c2VcIik7XG59KTtcbiQoXCIjY29tbWFuZExpbmVXcmFwcGVyICNjb21tYW5kTGluZSAuc3VnZ2VzdGlvbnNcIikub24oXCJtb3VzZW92ZXJcIiwgKGUpID0+IHtcbiAgICBpZiAoIWNvbW1hbmRMaW5lTW91c2VNb2RlKVxuICAgICAgICByZXR1cm47XG4gICAgLy8gY29uc29sZS5sb2coXCJjbGVhcmluZyBrZXlib2FyZCBhY3RpdmVcIik7XG4gICAgJChcIiNjb21tYW5kTGluZVdyYXBwZXIgI2NvbW1hbmRMaW5lIC5zdWdnZXN0aW9ucyAuZW50cnlcIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVLZXlib2FyZFwiKTtcbiAgICBjb25zdCBob3ZlcklkID0gJChlLnRhcmdldCkuYXR0cihcImNvbW1hbmRcIik7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbGlzdCA9IENvbW1hbmRsaW5lTGlzdHMuY3VycmVudFtDb21tYW5kbGluZUxpc3RzLmN1cnJlbnQubGVuZ3RoIC0gMV07XG4gICAgICAgICQuZWFjaChsaXN0Lmxpc3QsIChfaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICAgICAgaWYgKG9iai5pZCA9PSBob3ZlcklkKSB7XG4gICAgICAgICAgICAgICAgaWYgKCghL3RoZW1lL2dpLnRlc3Qob2JqLmlkKSB8fCBvYmouaWQgPT09IFwidG9nZ2xlQ3VzdG9tVGhlbWVcIikgJiZcbiAgICAgICAgICAgICAgICAgICAgIVRoZW1lQ29udHJvbGxlci5yYW5kb21UaGVtZSkge1xuICAgICAgICAgICAgICAgICAgICBUaGVtZUNvbnRyb2xsZXIuY2xlYXJQcmV2aWV3KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghL2ZvbnQvZ2kudGVzdChvYmouaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5wcmV2aWV3Rm9udEZhbWlseShjb25maWdfMS5kZWZhdWx0LmZvbnRGYW1pbHkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAob2JqLmhvdmVyKVxuICAgICAgICAgICAgICAgICAgICBvYmouaG92ZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7IH1cbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNjb21tYW5kTGluZVdyYXBwZXIgI2NvbW1hbmRMaW5lIC5zdWdnZXN0aW9ucyAuZW50cnlcIiwgKGUpID0+IHtcbiAgICAkKFwiLnN1Z2dlc3Rpb25zIC5lbnRyeVwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZUtleWJvYXJkXCIpO1xuICAgIHRyaWdnZXIoJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJjb21tYW5kXCIpKTtcbn0pO1xuJChcIiNjb21tYW5kTGluZVdyYXBwZXJcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwiY29tbWFuZExpbmVXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0Rm9udEZhbWlseShjb25maWdfMS5kZWZhdWx0LmZvbnRGYW1pbHksIHRydWUpO1xuICAgICAgICAvLyBpZiAoQ29uZmlnLmN1c3RvbVRoZW1lID09PSB0cnVlKSB7XG4gICAgICAgIC8vICAgYXBwbHlDdXN0b21UaGVtZUNvbG9ycygpO1xuICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICAvLyAgIHNldFRoZW1lKENvbmZpZy50aGVtZSwgdHJ1ZSk7XG4gICAgICAgIC8vIH1cbiAgICB9XG59KTtcbi8vbWlnaHQgY29tZSBiYWNrIHRvIGl0IGxhdGVyXG4vLyBmdW5jdGlvbiBzaGlmdENvbW1hbmQoKXtcbi8vICAgbGV0IGFjdGl2ZUVudHJpZXMgPSAkKFwiI2NvbW1hbmRMaW5lV3JhcHBlciAjY29tbWFuZExpbmUgLnN1Z2dlc3Rpb25zIC5lbnRyeS5hY3RpdmVLZXlib2FyZCwgI2NvbW1hbmRMaW5lV3JhcHBlciAjY29tbWFuZExpbmUgLnN1Z2dlc3Rpb25zIC5lbnRyeS5hY3RpdmVNb3VzZVwiKTtcbi8vICAgYWN0aXZlRW50cmllcy5lYWNoKChfaW5kZXgsIGFjdGl2ZUVudHJ5KSA9PiB7XG4vLyAgICAgbGV0IGNvbW1hbmRJZCA9IGFjdGl2ZUVudHJ5LmdldEF0dHJpYnV0ZSgnY29tbWFuZCcpO1xuLy8gICAgIGxldCBmb3VuZENvbW1hbmQgPSBudWxsO1xuLy8gICAgIENvbW1hbmRsaW5lTGlzdHMuZGVmYXVsdENvbW1hbmRzLmxpc3QuZm9yRWFjaChjb21tYW5kID0+IHtcbi8vICAgICAgIGlmKGZvdW5kQ29tbWFuZCA9PT0gbnVsbCAmJiBjb21tYW5kLmlkID09PSBjb21tYW5kSWQpe1xuLy8gICAgICAgICBmb3VuZENvbW1hbmQgPSBjb21tYW5kO1xuLy8gICAgICAgfVxuLy8gICAgIH0pXG4vLyAgICAgaWYoZm91bmRDb21tYW5kLnNoaWZ0KXtcbi8vICAgICAgICQoYWN0aXZlRW50cnkpLmZpbmQoJ2RpdicpLnRleHQoZm91bmRDb21tYW5kLnNoaWZ0LmRpc3BsYXkpO1xuLy8gICAgIH1cbi8vICAgfSlcbi8vIH1cbi8vIGxldCBzaGlmdGVkQ29tbWFuZHMgPSBmYWxzZTtcbi8vICQoZG9jdW1lbnQpLm9uKFwia2V5ZG93blwiLCAoZSkgPT4ge1xuLy8gICBpZiAoZS5rZXkgPT09IFwiU2hpZnRcIikge1xuLy8gICAgIGlmKHNoaWZ0ZWRDb21tYW5kcyA9PT0gZmFsc2Upe1xuLy8gICAgICAgc2hpZnRlZENvbW1hbmRzID0gdHJ1ZTtcbi8vICAgICAgIHNoaWZ0Q29tbWFuZCgpO1xuLy8gICAgIH1cbi8vICAgfVxuLy8gfSk7XG4vLyAkKGRvY3VtZW50KS5rZXl1cCgoZSkgPT4ge1xuLy8gICBpZiAoZS5rZXkgPT09IFwiU2hpZnRcIikge1xuLy8gICAgIHNoaWZ0ZWRDb21tYW5kcyA9IGZhbHNlO1xuLy8gICB9XG4vLyB9KTtcbiQoZG9jdW1lbnQpLm9uKFwia2V5ZG93blwiLCAoZSkgPT4ge1xuICAgIHZhciBfYSwgX2I7XG4gICAgLy8gaWYgKGlzUHJldmlld2luZ1RoZW1lKSB7XG4gICAgLy8gY29uc29sZS5sb2coXCJhcHBseWluZyB0aGVtZVwiKTtcbiAgICAvLyBhcHBseUN1c3RvbVRoZW1lQ29sb3JzKCk7XG4gICAgLy8gcHJldmlld1RoZW1lKENvbmZpZy50aGVtZSwgZmFsc2UpO1xuICAgIC8vIH1cbiAgICBpZiAoISQoXCIjY29tbWFuZExpbmVXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjY29tbWFuZExpbmUgaW5wdXRcIikudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgICAgICBpZiAoZS5rZXkgPT0gXCI+XCIgJiYgY29uZmlnXzEuZGVmYXVsdC5zaW5nbGVMaXN0Q29tbWFuZExpbmUgPT0gXCJtYW51YWxcIikge1xuICAgICAgICAgICAgaWYgKCFpc1NpbmdsZUxpc3RDb21tYW5kTGluZUFjdGl2ZSgpKSB7XG4gICAgICAgICAgICAgICAgdXNlU2luZ2xlTGlzdENvbW1hbmRMaW5lKGZhbHNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICgkKFwiI2NvbW1hbmRMaW5lIGlucHV0XCIpLnZhbCgpID09IFwiPlwiKSB7XG4gICAgICAgICAgICAgICAgLy9zbyB0aGF0IGl0IHdpbGwgaWdub3JlIHN1Y2NlZWRpbmcgXCI+XCIgd2hlbiBpbnB1dCBpcyBhbHJlYWR5IFwiPlwiXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZS5rZXkgPT09IFwiQmFja3NwYWNlXCIgfHwgZS5rZXkgPT09IFwiRGVsZXRlXCIpIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0VmFsID0gJChcIiNjb21tYW5kTGluZSBpbnB1dFwiKS52YWwoKTtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zaW5nbGVMaXN0Q29tbWFuZExpbmUgPT0gXCJtYW51YWxcIiAmJlxuICAgICAgICAgICAgICAgICAgICBpc1NpbmdsZUxpc3RDb21tYW5kTGluZUFjdGl2ZSgpICYmXG4gICAgICAgICAgICAgICAgICAgIGlucHV0VmFsWzBdICE9PSBcIj5cIikge1xuICAgICAgICAgICAgICAgICAgICByZXN0b3JlT2xkQ29tbWFuZExpbmUoZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIDEpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAvL2VudGVyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBjb25zdCBjb21tYW5kID0gJChcIi5zdWdnZXN0aW9ucyAuZW50cnkuYWN0aXZlS2V5Ym9hcmRcIikuYXR0cihcImNvbW1hbmRcIik7XG4gICAgICAgICAgICB0cmlnZ2VyKGNvbW1hbmQpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlLmtleSA9PT0gXCJBcnJvd1VwXCIgfHwgZS5rZXkgPT09IFwiQXJyb3dEb3duXCIgfHwgZS5rZXkgPT09IFwiVGFiXCIpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICQoXCIjY29tbWFuZExpbmVXcmFwcGVyICNjb21tYW5kTGluZSAuc3VnZ2VzdGlvbnMgLmVudHJ5XCIpLnVuYmluZChcIm1vdXNlZW50ZXIgbW91c2VsZWF2ZVwiKTtcbiAgICAgICAgICAgIGNvbnN0IGVudHJpZXMgPSAkKFwiLnN1Z2dlc3Rpb25zIC5lbnRyeVwiKTtcbiAgICAgICAgICAgIGxldCBhY3RpdmVudW0gPSAtMTtcbiAgICAgICAgICAgIGxldCBob3ZlcklkO1xuICAgICAgICAgICAgJC5lYWNoKGVudHJpZXMsIChpbmRleCwgb2JqKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCQob2JqKS5oYXNDbGFzcyhcImFjdGl2ZUtleWJvYXJkXCIpKVxuICAgICAgICAgICAgICAgICAgICBhY3RpdmVudW0gPSBpbmRleDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGUua2V5ID09PSBcIkFycm93VXBcIiB8fCAoZS5rZXkgPT09IFwiVGFiXCIgJiYgZS5zaGlmdEtleSkpIHtcbiAgICAgICAgICAgICAgICBlbnRyaWVzLnJlbW92ZUNsYXNzKFwiYWN0aXZlS2V5Ym9hcmRcIik7XG4gICAgICAgICAgICAgICAgaWYgKGFjdGl2ZW51bSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICQoZW50cmllc1tlbnRyaWVzLmxlbmd0aCAtIDFdKS5hZGRDbGFzcyhcImFjdGl2ZUtleWJvYXJkXCIpO1xuICAgICAgICAgICAgICAgICAgICBob3ZlcklkID0gJChlbnRyaWVzW2VudHJpZXMubGVuZ3RoIC0gMV0pLmF0dHIoXCJjb21tYW5kXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJChlbnRyaWVzWy0tYWN0aXZlbnVtXSkuYWRkQ2xhc3MoXCJhY3RpdmVLZXlib2FyZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgaG92ZXJJZCA9ICQoZW50cmllc1thY3RpdmVudW1dKS5hdHRyKFwiY29tbWFuZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZS5rZXkgPT09IFwiQXJyb3dEb3duXCIgfHwgKGUua2V5ID09PSBcIlRhYlwiICYmICFlLnNoaWZ0S2V5KSkge1xuICAgICAgICAgICAgICAgIGVudHJpZXMucmVtb3ZlQ2xhc3MoXCJhY3RpdmVLZXlib2FyZFwiKTtcbiAgICAgICAgICAgICAgICBpZiAoYWN0aXZlbnVtICsgMSA9PSBlbnRyaWVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAkKGVudHJpZXNbMF0pLmFkZENsYXNzKFwiYWN0aXZlS2V5Ym9hcmRcIik7XG4gICAgICAgICAgICAgICAgICAgIGhvdmVySWQgPSAkKGVudHJpZXNbMF0pLmF0dHIoXCJjb21tYW5kXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJChlbnRyaWVzWysrYWN0aXZlbnVtXSkuYWRkQ2xhc3MoXCJhY3RpdmVLZXlib2FyZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgaG92ZXJJZCA9ICQoZW50cmllc1thY3RpdmVudW1dKS5hdHRyKFwiY29tbWFuZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNjcm9sbCA9IE1hdGguYWJzKCgoX2EgPSAkKFwiLnN1Z2dlc3Rpb25zXCIpLm9mZnNldCgpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudG9wKSAtXG4gICAgICAgICAgICAgICAgICAgICgoX2IgPSAkKFwiLmVudHJ5LmFjdGl2ZUtleWJvYXJkXCIpLm9mZnNldCgpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudG9wKSAtXG4gICAgICAgICAgICAgICAgICAgICQoXCIuc3VnZ2VzdGlvbnNcIikuc2Nyb2xsVG9wKCkpIC1cbiAgICAgICAgICAgICAgICAgICAgJChcIi5zdWdnZXN0aW9uc1wiKS5vdXRlckhlaWdodCgpIC8gMiArXG4gICAgICAgICAgICAgICAgICAgICQoJChcIi5lbnRyeVwiKVswXSkub3V0ZXJIZWlnaHQoKTtcbiAgICAgICAgICAgICAgICAkKFwiLnN1Z2dlc3Rpb25zXCIpLnNjcm9sbFRvcChzY3JvbGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY291bGQgbm90IHNjcm9sbCBzdWdnZXN0aW9uczogXCIgKyBlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGBzY3JvbGxpbmcgdG8gJHtzY3JvbGx9YCk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGxpc3QgPSBDb21tYW5kbGluZUxpc3RzLmN1cnJlbnRbQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50Lmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgICAgICQuZWFjaChsaXN0Lmxpc3QsIChfaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmlkID09IGhvdmVySWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoIS90aGVtZS9naS50ZXN0KG9iai5pZCkgfHwgb2JqLmlkID09PSBcInRvZ2dsZUN1c3RvbVRoZW1lXCIpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIVRoZW1lQ29udHJvbGxlci5yYW5kb21UaGVtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoZW1lQ29udHJvbGxlci5jbGVhclByZXZpZXcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghL2ZvbnQvZ2kudGVzdChvYmouaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnByZXZpZXdGb250RmFtaWx5KGNvbmZpZ18xLmRlZmF1bHQuZm9udEZhbWlseSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmhvdmVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5ob3ZlcigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkgeyB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI2NvbW1hbmRMaW5lTW9iaWxlQnV0dG9uXCIsICgpID0+IHtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zaW5nbGVMaXN0Q29tbWFuZExpbmUgPT0gXCJvblwiKSB7XG4gICAgICAgIHVzZVNpbmdsZUxpc3RDb21tYW5kTGluZShmYWxzZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBDb21tYW5kbGluZUxpc3RzLnNldEN1cnJlbnQoW0NvbW1hbmRsaW5lTGlzdHMuZGVmYXVsdENvbW1hbmRzXSk7XG4gICAgfVxuICAgICgwLCBleHBvcnRzLnNob3cpKCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIja2V5bWFwIC5yNSAua2V5LXNwYWNlXCIsICgpID0+IHtcbiAgICBDb21tYW5kbGluZUxpc3RzLnNldEN1cnJlbnQoW0NvbW1hbmRsaW5lTGlzdHMuY29tbWFuZHNLZXltYXBMYXlvdXRzXSk7XG4gICAgKDAsIGV4cG9ydHMuc2hvdykoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0ZXN0TW9kZXNOb3RpY2UgLnRleHQtYnV0dG9uXCIsIChldmVudCkgPT4ge1xuICAgIGNvbnN0IGNvbW1hbmRzID0gQ29tbWFuZGxpbmVMaXN0cy5nZXRMaXN0KCQoZXZlbnQuY3VycmVudFRhcmdldCkuYXR0cihcImNvbW1hbmRzXCIpKTtcbiAgICBpZiAoY29tbWFuZHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoJChldmVudC5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiY29tbWFuZHNcIikgPT09IFwiY29tbWFuZHNUYWdzXCIpIHtcbiAgICAgICAgICAgIENvbW1hbmRsaW5lTGlzdHMudXBkYXRlVGFnQ29tbWFuZHMoKTtcbiAgICAgICAgfVxuICAgICAgICBDb21tYW5kbGluZUxpc3RzLnB1c2hDdXJyZW50KGNvbW1hbmRzKTtcbiAgICAgICAgKDAsIGV4cG9ydHMuc2hvdykoKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjYm90dG9tIC5sZWZ0cmlnaHQgLnJpZ2h0IC5jdXJyZW50LXRoZW1lXCIsIChlKSA9PiB7XG4gICAgaWYgKGUuc2hpZnRLZXkpIHtcbiAgICAgICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LmN1c3RvbVRoZW1lKSB7XG4gICAgICAgICAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKERCLmdldFNuYXBzaG90KCkuY3VzdG9tVGhlbWVzLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJObyBjdXN0b20gdGhlbWVzIVwiLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lSWQoXCJcIik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gaWYgKCFEQi5nZXRDdXN0b21UaGVtZUJ5SWQoQ29uZmlnLmN1c3RvbVRoZW1lSWQpKSB7XG4gICAgICAgICAgICAgICAgLy8gICAvLyBUdXJuIG9uIHRoZSBmaXJzdCBjdXN0b20gdGhlbWVcbiAgICAgICAgICAgICAgICAvLyAgIGNvbnN0IGZpcnN0Q3VzdG9tVGhlbWVJZCA9IERCLmdldFNuYXBzaG90KCkuY3VzdG9tVGhlbWVzWzBdLl9pZDtcbiAgICAgICAgICAgICAgICAvLyAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZUlkKGZpcnN0Q3VzdG9tVGhlbWVJZCk7XG4gICAgICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lKHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZShmYWxzZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5jdXN0b21UaGVtZSlcbiAgICAgICAgICAgIENvbW1hbmRsaW5lTGlzdHMudXBkYXRlQ3VzdG9tVGhlbWVMaXN0Q29tbWFuZHMoKTtcbiAgICAgICAgQ29tbWFuZGxpbmVMaXN0cy5wdXNoQ3VycmVudChjb25maWdfMS5kZWZhdWx0LmN1c3RvbVRoZW1lXG4gICAgICAgICAgICA/IENvbW1hbmRsaW5lTGlzdHMuY3VzdG9tVGhlbWVMaXN0Q29tbWFuZHNcbiAgICAgICAgICAgIDogQ29tbWFuZGxpbmVMaXN0cy50aGVtZUNvbW1hbmRzKTtcbiAgICAgICAgKDAsIGV4cG9ydHMuc2hvdykoKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQuYm9keSkub24oXCJjbGlja1wiLCBcIi5wYWdlQWJvdXQgLmFib3V0RW5hYmxlQWRzXCIsICgpID0+IHtcbiAgICBDb21tYW5kbGluZUxpc3RzLnB1c2hDdXJyZW50KENvbW1hbmRsaW5lTGlzdHMuY29tbWFuZHNFbmFibGVBZHMpO1xuICAgICgwLCBleHBvcnRzLnNob3cpKCk7XG59KTtcbiQoXCIuc3VwcG9ydEJ1dHRvbnMgLmJ1dHRvbi5hZHNcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgQ29tbWFuZGxpbmVMaXN0cy5wdXNoQ3VycmVudChDb21tYW5kbGluZUxpc3RzLmNvbW1hbmRzRW5hYmxlQWRzKTtcbiAgICAoMCwgZXhwb3J0cy5zaG93KSgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5sb2FkQ29uZmlnID0gZXhwb3J0cy5hcHBseSA9IGV4cG9ydHMuZ2V0Q1NTID0gdm9pZCAwO1xuY29uc3QgVXBkYXRlQ29uZmlnID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuY29uc3QgZmlsdGVycyA9IHtcbiAgICBibHVyOiB7XG4gICAgICAgIHZhbHVlOiAwLFxuICAgICAgICBkZWZhdWx0OiAwLFxuICAgIH0sXG4gICAgYnJpZ2h0bmVzczoge1xuICAgICAgICB2YWx1ZTogMSxcbiAgICAgICAgZGVmYXVsdDogMSxcbiAgICB9LFxuICAgIHNhdHVyYXRlOiB7XG4gICAgICAgIHZhbHVlOiAxLFxuICAgICAgICBkZWZhdWx0OiAxLFxuICAgIH0sXG4gICAgb3BhY2l0eToge1xuICAgICAgICB2YWx1ZTogMSxcbiAgICAgICAgZGVmYXVsdDogMSxcbiAgICB9LFxufTtcbmZ1bmN0aW9uIGdldENTUygpIHtcbiAgICBsZXQgcmV0ID0gXCJcIjtcbiAgICBPYmplY3Qua2V5cyhmaWx0ZXJzKS5mb3JFYWNoKChmaWx0ZXJLZXkpID0+IHtcbiAgICAgICAgY29uc3Qga2V5ID0gZmlsdGVyS2V5O1xuICAgICAgICBpZiAoZmlsdGVyc1trZXldLnZhbHVlICE9IGZpbHRlcnNba2V5XS5kZWZhdWx0KSB7XG4gICAgICAgICAgICByZXQgKz0gYCR7ZmlsdGVyS2V5fSgke2ZpbHRlcnNba2V5XS52YWx1ZX0ke2ZpbHRlcktleSA9PSBcImJsdXJcIiA/IFwicmVtXCIgOiBcIlwifSkgYDtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiByZXQ7XG59XG5leHBvcnRzLmdldENTUyA9IGdldENTUztcbmZ1bmN0aW9uIGFwcGx5KCkge1xuICAgIGNvbnN0IGZpbHRlckNTUyA9IGdldENTUygpO1xuICAgIGNvbnN0IGNzcyA9IHtcbiAgICAgICAgZmlsdGVyOiBmaWx0ZXJDU1MsXG4gICAgICAgIHdpZHRoOiBgY2FsYygxMDAlICsgJHtmaWx0ZXJzLmJsdXIudmFsdWUgKiA0fXJlbSlgLFxuICAgICAgICBoZWlnaHQ6IGBjYWxjKDEwMCUgKyAke2ZpbHRlcnMuYmx1ci52YWx1ZSAqIDR9cmVtKWAsXG4gICAgICAgIGxlZnQ6IGAtJHtmaWx0ZXJzLmJsdXIudmFsdWUgKiAyfXJlbWAsXG4gICAgICAgIHRvcDogYC0ke2ZpbHRlcnMuYmx1ci52YWx1ZSAqIDJ9cmVtYCxcbiAgICAgICAgcG9zaXRpb246IFwiYWJzb2x1dGVcIixcbiAgICB9O1xuICAgICQoXCIuY3VzdG9tQmFja2dyb3VuZCBpbWdcIikuY3NzKGNzcyk7XG59XG5leHBvcnRzLmFwcGx5ID0gYXBwbHk7XG5mdW5jdGlvbiBzeW5jU2xpZGVycygpIHtcbiAgICAkKFwiLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlciAuYmx1ciBpbnB1dFwiKS52YWwoZmlsdGVyc1tcImJsdXJcIl0udmFsdWUpO1xuICAgICQoXCIuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyIC5icmlnaHRuZXNzIGlucHV0XCIpLnZhbChmaWx0ZXJzW1wiYnJpZ2h0bmVzc1wiXS52YWx1ZSk7XG4gICAgJChcIi5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgLnNhdHVyYXRlIGlucHV0XCIpLnZhbChmaWx0ZXJzW1wic2F0dXJhdGVcIl0udmFsdWUpO1xuICAgICQoXCIuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyIC5vcGFjaXR5IGlucHV0XCIpLnZhbChmaWx0ZXJzW1wib3BhY2l0eVwiXS52YWx1ZSk7XG59XG5mdW5jdGlvbiB1cGRhdGVOdW1iZXJzKCkge1xuICAgICQoXCIuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyIC5ibHVyIC52YWx1ZVwiKS5odG1sKGZpbHRlcnMuYmx1ci52YWx1ZS50b0ZpeGVkKDEpKTtcbiAgICAkKFwiLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlciAuYnJpZ2h0bmVzcyAudmFsdWVcIikuaHRtbChmaWx0ZXJzLmJyaWdodG5lc3MudmFsdWUudG9GaXhlZCgxKSk7XG4gICAgJChcIi5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgLnNhdHVyYXRlIC52YWx1ZVwiKS5odG1sKGZpbHRlcnMuc2F0dXJhdGUudmFsdWUudG9GaXhlZCgxKSk7XG4gICAgJChcIi5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgLm9wYWNpdHkgLnZhbHVlXCIpLmh0bWwoZmlsdGVycy5vcGFjaXR5LnZhbHVlLnRvRml4ZWQoMSkpO1xufVxuZnVuY3Rpb24gbG9hZENvbmZpZyhjb25maWcpIHtcbiAgICBmaWx0ZXJzLmJsdXIudmFsdWUgPSBjb25maWdbMF07XG4gICAgZmlsdGVycy5icmlnaHRuZXNzLnZhbHVlID0gY29uZmlnWzFdO1xuICAgIGZpbHRlcnMuc2F0dXJhdGUudmFsdWUgPSBjb25maWdbMl07XG4gICAgZmlsdGVycy5vcGFjaXR5LnZhbHVlID0gY29uZmlnWzNdO1xuICAgIHVwZGF0ZU51bWJlcnMoKTtcbiAgICBzeW5jU2xpZGVycygpO1xufVxuZXhwb3J0cy5sb2FkQ29uZmlnID0gbG9hZENvbmZpZztcbiQoXCIuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyIC5ibHVyIGlucHV0XCIpLm9uKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgIGZpbHRlcnNbXCJibHVyXCJdLnZhbHVlID0gcGFyc2VGbG9hdCgkKFwiLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlciAuYmx1ciBpbnB1dFwiKS52YWwoKSk7XG4gICAgdXBkYXRlTnVtYmVycygpO1xuICAgIGFwcGx5KCk7XG59KTtcbiQoXCIuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyIC5icmlnaHRuZXNzIGlucHV0XCIpLm9uKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgIGZpbHRlcnNbXCJicmlnaHRuZXNzXCJdLnZhbHVlID0gcGFyc2VGbG9hdCgkKFwiLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlciAuYnJpZ2h0bmVzcyBpbnB1dFwiKS52YWwoKSk7XG4gICAgdXBkYXRlTnVtYmVycygpO1xuICAgIGFwcGx5KCk7XG59KTtcbiQoXCIuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyIC5zYXR1cmF0ZSBpbnB1dFwiKS5vbihcImlucHV0XCIsICgpID0+IHtcbiAgICBmaWx0ZXJzW1wic2F0dXJhdGVcIl0udmFsdWUgPSBwYXJzZUZsb2F0KCQoXCIuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyIC5zYXR1cmF0ZSBpbnB1dFwiKS52YWwoKSk7XG4gICAgdXBkYXRlTnVtYmVycygpO1xuICAgIGFwcGx5KCk7XG59KTtcbiQoXCIuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyIC5vcGFjaXR5IGlucHV0XCIpLm9uKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgIGZpbHRlcnNbXCJvcGFjaXR5XCJdLnZhbHVlID0gcGFyc2VGbG9hdCgkKFwiLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlciAub3BhY2l0eSBpbnB1dFwiKS52YWwoKSk7XG4gICAgdXBkYXRlTnVtYmVycygpO1xuICAgIGFwcGx5KCk7XG59KTtcbiQoXCIuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyICAuc2F2ZS5idXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY29uc3QgYXJyID0gT2JqZWN0LmtleXMoZmlsdGVycykubWFwKChmaWx0ZXJLZXkpID0+IGZpbHRlcnNbZmlsdGVyS2V5XS52YWx1ZSk7XG4gICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbUJhY2tncm91bmRGaWx0ZXIoYXJyLCBmYWxzZSk7XG4gICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDdXN0b20gYmFja2dyb3VuZCBmaWx0ZXJzIHNhdmVkXCIsIDEpO1xufSk7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5LCBldmVudFZhbHVlKSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImN1c3RvbUJhY2tncm91bmRGaWx0ZXJcIikge1xuICAgICAgICBsb2FkQ29uZmlnKGV2ZW50VmFsdWUubWFwKChldikgPT4gcGFyc2VGbG9hdChldikpKTtcbiAgICAgICAgYXBwbHkoKTtcbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucmVmcmVzaCA9IGV4cG9ydHMuc2hvdyA9IGV4cG9ydHMuaGlkZSA9IGV4cG9ydHMuZmxhc2hLZXkgPSBleHBvcnRzLmhpZ2hsaWdodEtleSA9IHZvaWQgMDtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgVGhlbWVDb2xvcnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGhlbWUtY29sb3JzXCIpKTtcbmNvbnN0IFNsb3dUaW1lciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3Nsb3ctdGltZXJcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmZ1bmN0aW9uIGhpZ2hsaWdodEtleShjdXJyZW50S2V5KSB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ6ZW5cIilcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChjdXJyZW50S2V5ID09PSBcIlwiKVxuICAgICAgICBjdXJyZW50S2V5ID0gXCIgXCI7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCQoXCIuYWN0aXZlLWtleVwiKSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICQoXCIuYWN0aXZlLWtleVwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZS1rZXlcIik7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGhpZ2hsaWdodEtleTtcbiAgICAgICAgaWYgKGN1cnJlbnRLZXkgPT0gXCIgXCIpIHtcbiAgICAgICAgICAgIGhpZ2hsaWdodEtleSA9IFwiI2tleW1hcCAua2V5LXNwYWNlLCAja2V5bWFwIC5rZXktc3BsaXQtc3BhY2VcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjdXJyZW50S2V5ID09ICdcIicpIHtcbiAgICAgICAgICAgIGhpZ2hsaWdodEtleSA9IGAja2V5bWFwIC5rZXltYXAta2V5W2RhdGEta2V5Kj0nJHtjdXJyZW50S2V5fSddYDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGhpZ2hsaWdodEtleSA9IGAja2V5bWFwIC5rZXltYXAta2V5W2RhdGEta2V5Kj1cIiR7Y3VycmVudEtleX1cIl1gO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKFwiaGlnaGxpZ2h0aW5nXCIsIGhpZ2hsaWdodEtleSk7XG4gICAgICAgICQoaGlnaGxpZ2h0S2V5KS5hZGRDbGFzcyhcImFjdGl2ZS1rZXlcIik7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY291bGQgbm90IHVwZGF0ZSBoaWdobGlnaHRlZCBrZXltYXAga2V5OiBcIiArIGUubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLmhpZ2hsaWdodEtleSA9IGhpZ2hsaWdodEtleTtcbmZ1bmN0aW9uIGZsYXNoS2V5KGtleSwgY29ycmVjdCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChrZXkgPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAoa2V5ID09IFwiIFwiKSB7XG4gICAgICAgICAgICBrZXkgPSBcIiNrZXltYXAgLmtleS1zcGFjZSwgI2tleW1hcCAua2V5LXNwbGl0LXNwYWNlXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoa2V5ID09ICdcIicpIHtcbiAgICAgICAgICAgIGtleSA9IGAja2V5bWFwIC5rZXltYXAta2V5W2RhdGEta2V5Kj0nJHtrZXl9J11gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAga2V5ID0gYCNrZXltYXAgLmtleW1hcC1rZXlbZGF0YS1rZXkqPVwiJHtrZXl9XCJdYDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0aGVtZWNvbG9ycyA9IHlpZWxkIFRoZW1lQ29sb3JzLmdldEFsbCgpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKGNvcnJlY3QgfHwgY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUpIHtcbiAgICAgICAgICAgICAgICAkKGtleSlcbiAgICAgICAgICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiB0aGVtZWNvbG9ycy5iZyxcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiB0aGVtZWNvbG9ycy5tYWluLFxuICAgICAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogdGhlbWVjb2xvcnMubWFpbixcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiB0aGVtZWNvbG9ycy5zdWIsXG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogXCJ0cmFuc3BhcmVudFwiLFxuICAgICAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogdGhlbWVjb2xvcnMuc3ViLFxuICAgICAgICAgICAgICAgIH0sIFNsb3dUaW1lci5nZXQoKSA/IDAgOiA1MDAsIFwiZWFzZU91dEV4cG9cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKGtleSlcbiAgICAgICAgICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiB0aGVtZWNvbG9ycy5iZyxcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiB0aGVtZWNvbG9ycy5lcnJvcixcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IHRoZW1lY29sb3JzLmVycm9yLFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IHRoZW1lY29sb3JzLnN1YixcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBcInRyYW5zcGFyZW50XCIsXG4gICAgICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiB0aGVtZWNvbG9ycy5zdWIsXG4gICAgICAgICAgICAgICAgfSwgU2xvd1RpbWVyLmdldCgpID8gMCA6IDUwMCwgXCJlYXNlT3V0RXhwb1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkgeyB9XG4gICAgfSk7XG59XG5leHBvcnRzLmZsYXNoS2V5ID0gZmxhc2hLZXk7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgICQoXCIja2V5bWFwXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgJChcIiNrZXltYXBcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gcmVmcmVzaChsYXlvdXROYW1lID0gY29uZmlnXzEuZGVmYXVsdC5sYXlvdXQpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoIWxheW91dE5hbWUpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBsYXlvdXRzID0geWllbGQgTWlzYy5nZXRMYXlvdXRzTGlzdCgpO1xuICAgICAgICAgICAgbGV0IGx0cyA9IGxheW91dHNbbGF5b3V0TmFtZV07IC8vbGF5b3V0IHRvIHNob3dcbiAgICAgICAgICAgIGxldCBsYXlvdXRTdHJpbmcgPSBsYXlvdXROYW1lO1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTGF5b3V0ID09PSBcIm92ZXJyaWRlU3luY1wiKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubGF5b3V0ID09PSBcImRlZmF1bHRcIikge1xuICAgICAgICAgICAgICAgICAgICBsdHMgPSBsYXlvdXRzW1wicXdlcnR5XCJdO1xuICAgICAgICAgICAgICAgICAgICBsYXlvdXRTdHJpbmcgPSBcImRlZmF1bHRcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGx0cyA9IGxheW91dHNbY29uZmlnXzEuZGVmYXVsdC5sYXlvdXRdO1xuICAgICAgICAgICAgICAgICAgICBsYXlvdXRTdHJpbmcgPSBjb25maWdfMS5kZWZhdWx0LmxheW91dDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsdHMgPSBsYXlvdXRzW2NvbmZpZ18xLmRlZmF1bHQua2V5bWFwTGF5b3V0XTtcbiAgICAgICAgICAgICAgICBsYXlvdXRTdHJpbmcgPSBjb25maWdfMS5kZWZhdWx0LmtleW1hcExheW91dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHNob3dUb3BSb3cgPSBsdHMua2V5bWFwU2hvd1RvcFJvdztcbiAgICAgICAgICAgIGNvbnN0IGlzTWF0cml4ID0gY29uZmlnXzEuZGVmYXVsdC5rZXltYXBTdHlsZSA9PT0gXCJtYXRyaXhcIiB8fCBjb25maWdfMS5kZWZhdWx0LmtleW1hcFN0eWxlID09PSBcInNwbGl0X21hdHJpeFwiO1xuICAgICAgICAgICAgbGV0IGtleW1hcEVsZW1lbnQgPSBcIlwiO1xuICAgICAgICAgICAgT2JqZWN0LmtleXMobHRzLmtleXMpLmZvckVhY2goKHJvdywgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByb3dLZXlzID0gbHRzLmtleXNbcm93XTtcbiAgICAgICAgICAgICAgICBsZXQgcm93RWxlbWVudCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgaWYgKHJvdyA9PT0gXCJyb3cxXCIgJiYgIXNob3dUb3BSb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoKHJvdyA9PT0gXCJyb3cyXCIgfHwgcm93ID09PSBcInJvdzNcIiB8fCByb3cgPT09IFwicm93NFwiKSAmJiAhaXNNYXRyaXgpIHtcbiAgICAgICAgICAgICAgICAgICAgcm93RWxlbWVudCArPSBcIjxkaXY+PC9kaXY+XCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyb3cgPT09IFwicm93NFwiICYmIGx0cy50eXBlICE9PSBcImlzb1wiICYmICFpc01hdHJpeCkge1xuICAgICAgICAgICAgICAgICAgICByb3dFbGVtZW50ICs9IFwiPGRpdj48L2Rpdj5cIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJvdyA9PT0gXCJyb3c1XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGxheW91dERpc3BsYXkgPSBsYXlvdXRTdHJpbmcucmVwbGFjZSgvXy9nLCBcIiBcIik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmtleW1hcExlZ2VuZFN0eWxlID09PSBcImJsYW5rXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dERpc3BsYXkgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJvd0VsZW1lbnQgKz0gXCI8ZGl2PjwvZGl2PlwiO1xuICAgICAgICAgICAgICAgICAgICByb3dFbGVtZW50ICs9IGA8ZGl2IGNsYXNzPVwia2V5bWFwLWtleSBrZXktc3BhY2VcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwibGV0dGVyXCI+JHtsYXlvdXREaXNwbGF5fTwvZGl2PlxuICAgICAgICA8L2Rpdj5gO1xuICAgICAgICAgICAgICAgICAgICByb3dFbGVtZW50ICs9IGA8ZGl2IGNsYXNzPVwia2V5bWFwLXNwbGl0LXNwYWNlclwiPjwvZGl2PmA7XG4gICAgICAgICAgICAgICAgICAgIHJvd0VsZW1lbnQgKz0gYDxkaXYgY2xhc3M9XCJrZXltYXAta2V5IGtleS1zcGxpdC1zcGFjZVwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJsZXR0ZXJcIj48L2Rpdj5cbiAgICAgICAgPC9kaXY+YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm93S2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvdyA9PT0gXCJyb3cyXCIgJiYgaSA9PT0gMTIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwU3R5bGUgPT09IFwibWF0cml4XCIgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0LmtleW1hcFN0eWxlID09PSBcInNwbGl0X21hdHJpeFwiKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPj0gMTApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IHJvd0tleXNbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBidW1wID0gcm93ID09PSBcInJvdzNcIiAmJiAoaSA9PT0gMyB8fCBpID09PSA2KSA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBrZXlEaXNwbGF5ID0ga2V5WzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTGVnZW5kU3R5bGUgPT09IFwiYmxhbmtcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleURpc3BsYXkgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBMZWdlbmRTdHlsZSA9PT0gXCJ1cHBlcmNhc2VcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleURpc3BsYXkgPSBrZXlEaXNwbGF5LnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXlFbGVtZW50ID0gYDxkaXYgY2xhc3M9XCJrZXltYXAta2V5XCIgZGF0YS1rZXk9XCIke2tleS5yZXBsYWNlKCdcIicsIFwiJnF1b3Q7XCIpfVwiPlxuICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImxldHRlclwiPiR7a2V5RGlzcGxheX08L3NwYW4+XG4gICAgICAgICAgICAgICR7YnVtcCA/IFwiPGRpdiBjbGFzcz0nYnVtcCc+PC9kaXY+XCIgOiBcIlwifVxuICAgICAgICAgIDwvZGl2PmA7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgc3BsaXRTcGFjZXIgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwU3R5bGUgPT09IFwic3BsaXRcIiB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwU3R5bGUgPT09IFwic3BsaXRfbWF0cml4XCIgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0LmtleW1hcFN0eWxlID09PSBcImFsaWNlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93ID09PSBcInJvdzRcIiAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBTdHlsZSA9PT0gXCJzcGxpdFwiIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0LmtleW1hcFN0eWxlID09PSBcImFsaWNlXCIpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGx0cy50eXBlID09PSBcImlzb1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID09PSA2KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGxpdFNwYWNlciArPSBgPGRpdiBjbGFzcz1cImtleW1hcC1zcGxpdC1zcGFjZXJcIj48L2Rpdj5gO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gNSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BsaXRTcGFjZXIgKz0gYDxkaXYgY2xhc3M9XCJrZXltYXAtc3BsaXQtc3BhY2VyXCI+PC9kaXY+YDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmtleW1hcFN0eWxlID09PSBcImFsaWNlXCIgJiYgcm93ID09PSBcInJvdzRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgobHRzLnR5cGUgPT09IFwiaXNvXCIgJiYgaSA9PT0gNikgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGx0cy50eXBlICE9PSBcImlzb1wiICYmIGkgPT09IDUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwbGl0U3BhY2VyICs9IGA8ZGl2IGNsYXNzPVwiZXh0cmEta2V5XCI+PHNwYW4gY2xhc3M9XCJsZXR0ZXJcIj48L3NwYW4+PC9kaXY+YDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByb3dFbGVtZW50ICs9IHNwbGl0U3BhY2VyICsga2V5RWxlbWVudDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBrZXltYXBFbGVtZW50ICs9IGA8ZGl2IGNsYXNzPVwicm93IHIke2luZGV4ICsgMX1cIj4ke3Jvd0VsZW1lbnR9PC9kaXY+YDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJChcIiNrZXltYXBcIikuaHRtbChrZXltYXBFbGVtZW50KTtcbiAgICAgICAgICAgICQoXCIja2V5bWFwXCIpLnJlbW92ZUNsYXNzKFwic3RhZ2dlcmVkXCIpO1xuICAgICAgICAgICAgJChcIiNrZXltYXBcIikucmVtb3ZlQ2xhc3MoXCJtYXRyaXhcIik7XG4gICAgICAgICAgICAkKFwiI2tleW1hcFwiKS5yZW1vdmVDbGFzcyhcInNwbGl0XCIpO1xuICAgICAgICAgICAgJChcIiNrZXltYXBcIikucmVtb3ZlQ2xhc3MoXCJzcGxpdF9tYXRyaXhcIik7XG4gICAgICAgICAgICAkKFwiI2tleW1hcFwiKS5yZW1vdmVDbGFzcyhcImFsaWNlXCIpO1xuICAgICAgICAgICAgJChcIiNrZXltYXBcIikuYWRkQ2xhc3MoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBTdHlsZSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInNvbWV0aGluZyB3ZW50IHdyb25nIHdoZW4gY2hhbmdpbmcgbGF5b3V0LCByZXNldHRpbmdzOiBcIiArIGUubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlQ29uZmlnLnNldEtleW1hcExheW91dChcInF3ZXJ0eVwiLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5yZWZyZXNoID0gcmVmcmVzaDtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXkpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwibGF5b3V0XCIgJiYgY29uZmlnXzEuZGVmYXVsdC5rZXltYXBMYXlvdXQgPT09IFwib3ZlcnJpZGVTeW5jXCIpIHtcbiAgICAgICAgcmVmcmVzaChjb25maWdfMS5kZWZhdWx0LmtleW1hcExheW91dCk7XG4gICAgfVxuICAgIGlmIChldmVudEtleSA9PT0gXCJrZXltYXBMYXlvdXRcIiB8fCBldmVudEtleSA9PT0gXCJrZXltYXBTdHlsZVwiKVxuICAgICAgICByZWZyZXNoKCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZ2V0QWNjID0gZXhwb3J0cy5nZXRXUE0gPSBleHBvcnRzLnVwZGF0ZSA9IHZvaWQgMDtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgVGVzdFdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3Qtd29yZHNcIikpO1xubGV0IGF2ZXJhZ2VXUE0gPSAwO1xubGV0IGF2ZXJhZ2VBY2MgPSAwO1xuZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IG1vZGUyID0gTWlzYy5nZXRNb2RlMihjb25maWdfMS5kZWZhdWx0LCBUZXN0V29yZHMucmFuZG9tUXVvdGUpO1xuICAgICAgICBjb25zdCBbd3BtLCBhY2NdID0gKHlpZWxkIERCLmdldFVzZXJBdmVyYWdlMTAoY29uZmlnXzEuZGVmYXVsdC5tb2RlLCBtb2RlMiwgY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbiwgY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSwgY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5LCBjb25maWdfMS5kZWZhdWx0LmxhenlNb2RlKSlcbiAgICAgICAgICAgIC5tYXAoTWlzYy5yb3VuZFRvMilcbiAgICAgICAgICAgIC5tYXAoKG51bSkgPT4gKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0RlY2ltYWxQbGFjZXMgPyBNYXRoLnJvdW5kKG51bSkgOiBudW0pKTtcbiAgICAgICAgYXZlcmFnZVdQTSA9IHdwbTtcbiAgICAgICAgYXZlcmFnZUFjYyA9IGFjYztcbiAgICB9KTtcbn1cbmV4cG9ydHMudXBkYXRlID0gdXBkYXRlO1xuZnVuY3Rpb24gZ2V0V1BNKCkge1xuICAgIHJldHVybiBhdmVyYWdlV1BNO1xufVxuZXhwb3J0cy5nZXRXUE0gPSBnZXRXUE07XG5mdW5jdGlvbiBnZXRBY2MoKSB7XG4gICAgcmV0dXJuIGF2ZXJhZ2VBY2M7XG59XG5leHBvcnRzLmdldEFjYyA9IGdldEFjYztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2hvdyA9IGV4cG9ydHMuaGlkZSA9IHZvaWQgMDtcbmNvbnN0IGFwZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9hcGVcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgZm9ybWF0XzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImRhdGUtZm5zL2Zvcm1hdFwiKSk7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xuY29uc3QgY3VycmVudExlYWRlcmJvYXJkID0gXCJ0aW1lXzE1XCI7XG5sZXQgY3VycmVudERhdGEgPSB7XG4gICAgMTU6IFtdLFxuICAgIDYwOiBbXSxcbn07XG5sZXQgY3VycmVudFJhbmsgPSB7XG4gICAgMTU6IHt9LFxuICAgIDYwOiB7fSxcbn07XG5jb25zdCByZXF1ZXN0aW5nID0ge1xuICAgIDE1OiBmYWxzZSxcbiAgICA2MDogZmFsc2UsXG59O1xuY29uc3QgbGVhZGVyYm9hcmRTaW5nbGVMaW1pdCA9IDUwO1xubGV0IHVwZGF0ZVRpbWVyO1xuZnVuY3Rpb24gY2xlYXJUYWJsZShsYikge1xuICAgIGlmIChsYiA9PT0gMTUpIHtcbiAgICAgICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyIHRhYmxlLmxlZnQgdGJvZHlcIikuZW1wdHkoKTtcbiAgICAgICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyIHRhYmxlLmxlZnQgdGZvb3RcIikuZW1wdHkoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAobGIgPT09IDYwKSB7XG4gICAgICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciB0YWJsZS5yaWdodCB0Ym9keVwiKS5lbXB0eSgpO1xuICAgICAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgdGFibGUucmlnaHQgdGZvb3RcIikuZW1wdHkoKTtcbiAgICB9XG59XG5mdW5jdGlvbiByZXNldCgpIHtcbiAgICBjdXJyZW50RGF0YSA9IHtcbiAgICAgICAgMTU6IFtdLFxuICAgICAgICA2MDogW10sXG4gICAgfTtcbiAgICBjdXJyZW50UmFuayA9IHtcbiAgICAgICAgMTU6IHt9LFxuICAgICAgICA2MDoge30sXG4gICAgfTtcbn1cbmZ1bmN0aW9uIHN0b3BUaW1lcigpIHtcbiAgICBjbGVhckludGVydmFsKHVwZGF0ZVRpbWVyKTtcbiAgICB1cGRhdGVUaW1lciA9IHVuZGVmaW5lZDtcbiAgICAkKFwiI2xlYWRlcmJvYXJkcyAuc3ViVGl0bGVcIikudGV4dChcIk5leHQgdXBkYXRlIGluOiAtLTotLVwiKTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZVRpbWVyRWxlbWVudCgpIHtcbiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCBtaW51dGVzVG9OZXh0VXBkYXRlID0gMTQgLSAoZGF0ZS5nZXRNaW51dGVzKCkgJSAxNSk7XG4gICAgY29uc3Qgc2Vjb25kc1RvTmV4dFVwZGF0ZSA9IDYwIC0gZGF0ZS5nZXRTZWNvbmRzKCk7XG4gICAgY29uc3QgdG90YWxTZWNvbmRzID0gbWludXRlc1RvTmV4dFVwZGF0ZSAqIDYwICsgc2Vjb25kc1RvTmV4dFVwZGF0ZTtcbiAgICAkKFwiI2xlYWRlcmJvYXJkcyAuc3ViVGl0bGVcIikudGV4dChcIk5leHQgdXBkYXRlIGluOiBcIiArIE1pc2Muc2Vjb25kc1RvU3RyaW5nKHRvdGFsU2Vjb25kcywgdHJ1ZSkpO1xufVxuZnVuY3Rpb24gc3RhcnRUaW1lcigpIHtcbiAgICB1cGRhdGVUaW1lckVsZW1lbnQoKTtcbiAgICB1cGRhdGVUaW1lciA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgdXBkYXRlVGltZXJFbGVtZW50KCk7XG4gICAgfSwgMTAwMCk7XG59XG5mdW5jdGlvbiBzaG93TG9hZGVyKGxiKSB7XG4gICAgaWYgKGxiID09PSAxNSkge1xuICAgICAgICAkKGAjbGVhZGVyYm9hcmRzV3JhcHBlciAubGVmdFRhYmxlTG9hZGVyYCkucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGxiID09PSA2MCkge1xuICAgICAgICAkKGAjbGVhZGVyYm9hcmRzV3JhcHBlciAucmlnaHRUYWJsZUxvYWRlcmApLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGhpZGVMb2FkZXIobGIpIHtcbiAgICBpZiAobGIgPT09IDE1KSB7XG4gICAgICAgICQoYCNsZWFkZXJib2FyZHNXcmFwcGVyIC5sZWZ0VGFibGVMb2FkZXJgKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAobGIgPT09IDYwKSB7XG4gICAgICAgICQoYCNsZWFkZXJib2FyZHNXcmFwcGVyIC5yaWdodFRhYmxlTG9hZGVyYCkuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxufVxuZnVuY3Rpb24gdXBkYXRlRm9vdGVyKGxiKSB7XG4gICAgbGV0IHNpZGU7XG4gICAgaWYgKGxiID09PSAxNSkge1xuICAgICAgICBzaWRlID0gXCJsZWZ0XCI7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBzaWRlID0gXCJyaWdodFwiO1xuICAgIH1cbiAgICAkKGAjbGVhZGVyYm9hcmRzV3JhcHBlciB0YWJsZS4ke3NpZGV9IHRmb290YCkuaHRtbChgXG4gICAgPHRyPlxuICAgICAgPHRkPjxicj48YnI+PC90ZD5cbiAgICAgIDx0ZCBjb2xzcGFuPVwiNFwiIHN0eWxlPVwidGV4dC1hbGlnbjpjZW50ZXI7XCI+Tm90IHF1YWxpZmllZDwvPlxuICAgICAgPHRkPjxicj48YnI+PC90ZD5cbiAgICA8L3RyPlxuICAgIGApO1xuICAgIGxldCB0b3BwZXJjZW50O1xuICAgIGlmIChjdXJyZW50UmFua1tsYl0pIHtcbiAgICAgICAgbGV0IG51bSA9IE1pc2Mucm91bmRUbzIoKGN1cnJlbnRSYW5rW2xiXVtcInJhbmtcIl0gLyBjdXJyZW50UmFua1tsYl0uY291bnQpICogMTAwKTtcbiAgICAgICAgaWYgKG51bSA9PSAwKSB7XG4gICAgICAgICAgICBudW0gPSAwLjAxO1xuICAgICAgICB9XG4gICAgICAgIHRvcHBlcmNlbnQgPSBgVG9wICR7bnVtfSVgO1xuICAgIH1cbiAgICBpZiAoY3VycmVudFJhbmtbbGJdKSB7XG4gICAgICAgIGNvbnN0IGVudHJ5ID0gY3VycmVudFJhbmtbbGJdO1xuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoZW50cnkudGltZXN0YW1wKTtcbiAgICAgICAgJChgI2xlYWRlcmJvYXJkc1dyYXBwZXIgdGFibGUuJHtzaWRlfSB0Zm9vdGApLmh0bWwoYFxuICAgIDx0cj5cbiAgICA8dGQ+JHtlbnRyeS5yYW5rfTwvdGQ+XG4gICAgPHRkPjxzcGFuIGNsYXNzPVwidG9wXCI+WW91PC9zcGFuPjxicj48c3BhbiBjbGFzcz1cInN1YlwiPiR7dG9wcGVyY2VudH08L3NwYW4+PC90ZD5cbiAgICA8dGQgY2xhc3M9XCJhbGlnblJpZ2h0XCI+JHsoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNXG4gICAgICAgICAgICA/IGVudHJ5LndwbSAqIDVcbiAgICAgICAgICAgIDogZW50cnkud3BtKS50b0ZpeGVkKDIpfTxicj48ZGl2IGNsYXNzPVwic3ViXCI+JHtlbnRyeS5hY2MudG9GaXhlZCgyKX0lPC9kaXY+PC90ZD5cbiAgICA8dGQgY2xhc3M9XCJhbGlnblJpZ2h0XCI+JHsoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNXG4gICAgICAgICAgICA/IGVudHJ5LnJhdyAqIDVcbiAgICAgICAgICAgIDogZW50cnkucmF3KS50b0ZpeGVkKDIpfTxicj48ZGl2IGNsYXNzPVwic3ViXCI+JHshZW50cnkuY29uc2lzdGVuY3kgfHwgZW50cnkuY29uc2lzdGVuY3kgPT09IFwiLVwiXG4gICAgICAgICAgICA/IFwiLVwiXG4gICAgICAgICAgICA6IGVudHJ5LmNvbnNpc3RlbmN5LnRvRml4ZWQoMikgKyBcIiVcIn08L2Rpdj48L3RkPlxuICAgIDx0ZCBjbGFzcz1cImFsaWduUmlnaHRcIj50aW1lPGJyPjxkaXYgY2xhc3M9XCJzdWJcIj4ke2xifTwvZGl2PjwvdGQ+XG4gICAgPHRkIGNsYXNzPVwiYWxpZ25SaWdodFwiPiR7KDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiZGQgTU1NIHl5eXlcIil9PGJyPlxuICAgIDxkaXYgY2xhc3M9J3N1Yic+JHsoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJISDptbVwiKX08L2Rpdj48L3RkPlxuICA8L3RyPlxuICBgKTtcbiAgICB9XG59XG5mdW5jdGlvbiBjaGVja0xiTWVtb3J5KGxiKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZTtcbiAgICBsZXQgc2lkZTtcbiAgICBpZiAobGIgPT09IDE1KSB7XG4gICAgICAgIHNpZGUgPSBcImxlZnRcIjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHNpZGUgPSBcInJpZ2h0XCI7XG4gICAgfVxuICAgIGNvbnN0IG1lbW9yeSA9IChfZSA9IChfZCA9IChfYyA9IChfYiA9IChfYSA9IERCLmdldFNuYXBzaG90KCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sYk1lbW9yeSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnRpbWUpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfY1tsYl0pID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZFtcImVuZ2xpc2hcIl0pICE9PSBudWxsICYmIF9lICE9PSB2b2lkIDAgPyBfZSA6IDA7XG4gICAgaWYgKGN1cnJlbnRSYW5rW2xiXSkge1xuICAgICAgICBjb25zdCBkaWZmZXJlbmNlID0gbWVtb3J5IC0gY3VycmVudFJhbmtbbGJdLnJhbms7XG4gICAgICAgIGlmIChkaWZmZXJlbmNlID4gMCkge1xuICAgICAgICAgICAgREIudXBkYXRlTGJNZW1vcnkoXCJ0aW1lXCIsIGxiLCBcImVuZ2xpc2hcIiwgY3VycmVudFJhbmtbbGJdLnJhbmssIHRydWUpO1xuICAgICAgICAgICAgaWYgKG1lbW9yeSAhPT0gMCkge1xuICAgICAgICAgICAgICAgICQoYCNsZWFkZXJib2FyZHNXcmFwcGVyIHRhYmxlLiR7c2lkZX0gdGZvb3QgdHIgdGQgLnRvcGApLmFwcGVuZChgICg8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1hbmdsZS11cFwiPjwvaT4ke01hdGguYWJzKGRpZmZlcmVuY2UpfSBzaW5jZSB5b3UgbGFzdCBjaGVja2VkKWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGRpZmZlcmVuY2UgPCAwKSB7XG4gICAgICAgICAgICBEQi51cGRhdGVMYk1lbW9yeShcInRpbWVcIiwgbGIsIFwiZW5nbGlzaFwiLCBjdXJyZW50UmFua1tsYl0ucmFuaywgdHJ1ZSk7XG4gICAgICAgICAgICBpZiAobWVtb3J5ICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgJChgI2xlYWRlcmJvYXJkc1dyYXBwZXIgdGFibGUuJHtzaWRlfSB0Zm9vdCB0ciB0ZCAudG9wYCkuYXBwZW5kKGAgKDxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWFuZ2xlLWRvd25cIj48L2k+JHtNYXRoLmFicyhkaWZmZXJlbmNlKX0gc2luY2UgeW91IGxhc3QgY2hlY2tlZClgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChtZW1vcnkgIT09IDApIHtcbiAgICAgICAgICAgICAgICAkKGAjbGVhZGVyYm9hcmRzV3JhcHBlciB0YWJsZS4ke3NpZGV9IHRmb290IHRyIHRkIC50b3BgKS5hcHBlbmQoYCAoID0gc2luY2UgeW91IGxhc3QgY2hlY2tlZClgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGZpbGxUYWJsZShsYiwgcHJlcGVuZCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAoIWN1cnJlbnREYXRhW2xiXSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCBzaWRlO1xuICAgIGlmIChsYiA9PT0gMTUpIHtcbiAgICAgICAgc2lkZSA9IFwibGVmdFwiO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgc2lkZSA9IFwicmlnaHRcIjtcbiAgICB9XG4gICAgY29uc3QgbG9nZ2VkSW5Vc2VyTmFtZSA9IChfYSA9IERCLmdldFNuYXBzaG90KCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5uYW1lO1xuICAgIGxldCBhID0gY3VycmVudERhdGFbbGJdLmxlbmd0aCAtIGxlYWRlcmJvYXJkU2luZ2xlTGltaXQ7XG4gICAgbGV0IGIgPSBjdXJyZW50RGF0YVtsYl0ubGVuZ3RoO1xuICAgIGlmIChhIDwgMClcbiAgICAgICAgYSA9IDA7XG4gICAgaWYgKHByZXBlbmQpIHtcbiAgICAgICAgYSA9IDA7XG4gICAgICAgIGIgPSBwcmVwZW5kO1xuICAgIH1cbiAgICBsZXQgaHRtbCA9IFwiXCI7XG4gICAgZm9yIChsZXQgaSA9IGE7IGkgPCBiOyBpKyspIHtcbiAgICAgICAgY29uc3QgZW50cnkgPSBjdXJyZW50RGF0YVtsYl1baV07XG4gICAgICAgIGlmICghZW50cnkpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlbnRyeS5oaWRkZW4pXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGxldCBtZUNsYXNzU3RyaW5nID0gXCJcIjtcbiAgICAgICAgaWYgKGVudHJ5Lm5hbWUgPT0gbG9nZ2VkSW5Vc2VyTmFtZSkge1xuICAgICAgICAgICAgbWVDbGFzc1N0cmluZyA9ICcgY2xhc3M9XCJtZVwiJztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoZW50cnkudGltZXN0YW1wKTtcbiAgICAgICAgaHRtbCArPSBgXG4gICAgPHRyICR7bWVDbGFzc1N0cmluZ30+XG4gICAgPHRkPiR7ZW50cnkucmFuayA9PT0gMSA/ICc8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1jcm93blwiPjwvaT4nIDogZW50cnkucmFua308L3RkPlxuICAgIDx0ZD4ke2VudHJ5Lm5hbWV9PC90ZD5cbiAgICA8dGQgY2xhc3M9XCJhbGlnblJpZ2h0XCI+JHsoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNXG4gICAgICAgICAgICA/IGVudHJ5LndwbSAqIDVcbiAgICAgICAgICAgIDogZW50cnkud3BtKS50b0ZpeGVkKDIpfTxicj48ZGl2IGNsYXNzPVwic3ViXCI+JHtlbnRyeS5hY2MudG9GaXhlZCgyKX0lPC9kaXY+PC90ZD5cbiAgICA8dGQgY2xhc3M9XCJhbGlnblJpZ2h0XCI+JHsoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNXG4gICAgICAgICAgICA/IGVudHJ5LnJhdyAqIDVcbiAgICAgICAgICAgIDogZW50cnkucmF3KS50b0ZpeGVkKDIpfTxicj48ZGl2IGNsYXNzPVwic3ViXCI+JHshZW50cnkuY29uc2lzdGVuY3kgfHwgZW50cnkuY29uc2lzdGVuY3kgPT09IFwiLVwiXG4gICAgICAgICAgICA/IFwiLVwiXG4gICAgICAgICAgICA6IGVudHJ5LmNvbnNpc3RlbmN5LnRvRml4ZWQoMikgKyBcIiVcIn08L2Rpdj48L3RkPlxuICAgIDx0ZCBjbGFzcz1cImFsaWduUmlnaHRcIj50aW1lPGJyPjxkaXYgY2xhc3M9XCJzdWJcIj4ke2xifTwvZGl2PjwvdGQ+XG4gICAgPHRkIGNsYXNzPVwiYWxpZ25SaWdodFwiPiR7KDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiZGQgTU1NIHl5eXlcIil9PGJyPlxuICAgIDxkaXYgY2xhc3M9J3N1Yic+JHsoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJISDptbVwiKX08L2Rpdj48L3RkPlxuICA8L3RyPlxuICBgO1xuICAgIH1cbiAgICBpZiAoIXByZXBlbmQpIHtcbiAgICAgICAgJChgI2xlYWRlcmJvYXJkc1dyYXBwZXIgdGFibGUuJHtzaWRlfSB0Ym9keWApLmFwcGVuZChodG1sKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoYCNsZWFkZXJib2FyZHNXcmFwcGVyIHRhYmxlLiR7c2lkZX0gdGJvZHlgKS5wcmVwZW5kKGh0bWwpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyXCIpXG4gICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogMCxcbiAgICB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgY2xlYXJUYWJsZSgxNSk7XG4gICAgICAgIGNsZWFyVGFibGUoNjApO1xuICAgICAgICByZXNldCgpO1xuICAgICAgICBzdG9wVGltZXIoKTtcbiAgICAgICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgLmJ1dHRvbnMgLmJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgJChgI2xlYWRlcmJvYXJkc1dyYXBwZXIgLmJ1dHRvbnMgLmJ1dHRvbltib2FyZD0ke2N1cnJlbnRMZWFkZXJib2FyZH1dYCkuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgIHNob3dMb2FkZXIoMTUpO1xuICAgICAgICBzaG93TG9hZGVyKDYwKTtcbiAgICAgICAgY29uc3QgbGVhZGVyYm9hcmRSZXF1ZXN0cyA9IFtcbiAgICAgICAgICAgIGFwZV8xLmRlZmF1bHQubGVhZGVyYm9hcmRzLmdldChcImVuZ2xpc2hcIiwgXCJ0aW1lXCIsIFwiMTVcIiwgMCksXG4gICAgICAgICAgICBhcGVfMS5kZWZhdWx0LmxlYWRlcmJvYXJkcy5nZXQoXCJlbmdsaXNoXCIsIFwidGltZVwiLCBcIjYwXCIsIDApLFxuICAgICAgICBdO1xuICAgICAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyKSB7XG4gICAgICAgICAgICBsZWFkZXJib2FyZFJlcXVlc3RzLnB1c2goYXBlXzEuZGVmYXVsdC5sZWFkZXJib2FyZHMuZ2V0UmFuayhcImVuZ2xpc2hcIiwgXCJ0aW1lXCIsIFwiMTVcIiksIGFwZV8xLmRlZmF1bHQubGVhZGVyYm9hcmRzLmdldFJhbmsoXCJlbmdsaXNoXCIsIFwidGltZVwiLCBcIjYwXCIpKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXNwb25zZXMgPSB5aWVsZCBQcm9taXNlLmFsbChsZWFkZXJib2FyZFJlcXVlc3RzKTtcbiAgICAgICAgY29uc3QgZmFpbGVkUmVzcG9uc2UgPSByZXNwb25zZXMuZmluZCgocmVzcG9uc2UpID0+IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKTtcbiAgICAgICAgaWYgKGZhaWxlZFJlc3BvbnNlKSB7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gbG9hZCBsZWFkZXJib2FyZHM6IFwiICsgZmFpbGVkUmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IFtsYjE1RGF0YSwgbGI2MERhdGEsIGxiMTVSYW5rLCBsYjYwUmFua10gPSByZXNwb25zZXMubWFwKChyZXNwb25zZSkgPT4gcmVzcG9uc2UuZGF0YSk7XG4gICAgICAgIGN1cnJlbnREYXRhWzE1XSA9IGxiMTVEYXRhO1xuICAgICAgICBjdXJyZW50RGF0YVs2MF0gPSBsYjYwRGF0YTtcbiAgICAgICAgY3VycmVudFJhbmtbMTVdID0gbGIxNVJhbms7XG4gICAgICAgIGN1cnJlbnRSYW5rWzYwXSA9IGxiNjBSYW5rO1xuICAgICAgICBjb25zdCBsZWFkZXJib2FyZEtleXMgPSBbMTUsIDYwXTtcbiAgICAgICAgbGVhZGVyYm9hcmRLZXlzLmZvckVhY2goKGxlYWRlcmJvYXJkVGltZSkgPT4ge1xuICAgICAgICAgICAgaGlkZUxvYWRlcihsZWFkZXJib2FyZFRpbWUpO1xuICAgICAgICAgICAgY2xlYXJUYWJsZShsZWFkZXJib2FyZFRpbWUpO1xuICAgICAgICAgICAgdXBkYXRlRm9vdGVyKGxlYWRlcmJvYXJkVGltZSk7XG4gICAgICAgICAgICBjaGVja0xiTWVtb3J5KGxlYWRlcmJvYXJkVGltZSk7XG4gICAgICAgICAgICBmaWxsVGFibGUobGVhZGVyYm9hcmRUaW1lKTtcbiAgICAgICAgfSk7XG4gICAgICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAubGVmdFRhYmxlV3JhcHBlclwiKS5yZW1vdmVDbGFzcyhcImludmlzaWJsZVwiKTtcbiAgICAgICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyIC5yaWdodFRhYmxlV3JhcHBlclwiKS5yZW1vdmVDbGFzcyhcImludmlzaWJsZVwiKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHJlcXVlc3RNb3JlKGxiLCBwcmVwZW5kID0gZmFsc2UpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAocHJlcGVuZCAmJiBjdXJyZW50RGF0YVtsYl1bMF0ucmFuayA9PT0gMSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKHJlcXVlc3RpbmdbbGJdKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICByZXF1ZXN0aW5nW2xiXSA9IHRydWU7XG4gICAgICAgIHNob3dMb2FkZXIobGIpO1xuICAgICAgICBsZXQgc2tpcFZhbCA9IGN1cnJlbnREYXRhW2xiXVtjdXJyZW50RGF0YVtsYl0ubGVuZ3RoIC0gMV0ucmFuaztcbiAgICAgICAgaWYgKHByZXBlbmQpIHtcbiAgICAgICAgICAgIHNraXBWYWwgPSBjdXJyZW50RGF0YVtsYl1bMF0ucmFuayAtIGxlYWRlcmJvYXJkU2luZ2xlTGltaXQ7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGxpbWl0VmFsO1xuICAgICAgICBpZiAoc2tpcFZhbCA8IDApIHtcbiAgICAgICAgICAgIGxpbWl0VmFsID0gTWF0aC5hYnMoc2tpcFZhbCkgLSAxO1xuICAgICAgICAgICAgc2tpcFZhbCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LmxlYWRlcmJvYXJkcy5nZXQoXCJlbmdsaXNoXCIsIFwidGltZVwiLCBsYiwgc2tpcFZhbCwgbGltaXRWYWwpO1xuICAgICAgICBjb25zdCBkYXRhID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwIHx8IGRhdGEubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBoaWRlTG9hZGVyKGxiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAocHJlcGVuZCkge1xuICAgICAgICAgICAgY3VycmVudERhdGFbbGJdLnVuc2hpZnQoLi4uZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjdXJyZW50RGF0YVtsYl0ucHVzaCguLi5kYXRhKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocHJlcGVuZCAmJiAhbGltaXRWYWwpIHtcbiAgICAgICAgICAgIGxpbWl0VmFsID0gbGVhZGVyYm9hcmRTaW5nbGVMaW1pdCAtIDE7XG4gICAgICAgIH1cbiAgICAgICAgZmlsbFRhYmxlKGxiLCBsaW1pdFZhbCk7XG4gICAgICAgIGhpZGVMb2FkZXIobGIpO1xuICAgICAgICByZXF1ZXN0aW5nW2xiXSA9IGZhbHNlO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gcmVxdWVzdE5ldyhsYiwgc2tpcCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHNob3dMb2FkZXIobGIpO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQubGVhZGVyYm9hcmRzLmdldChcImVuZ2xpc2hcIiwgXCJ0aW1lXCIsIGxiLCBza2lwKTtcbiAgICAgICAgY29uc3QgZGF0YSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIGNsZWFyVGFibGUobGIpO1xuICAgICAgICBjdXJyZW50RGF0YVtsYl0gPSBbXTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwIHx8IGRhdGEubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBoaWRlTG9hZGVyKGxiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjdXJyZW50RGF0YVtsYl0gPSBkYXRhO1xuICAgICAgICBmaWxsVGFibGUobGIpO1xuICAgICAgICBoaWRlTG9hZGVyKGxiKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgaWYgKCQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyKSB7XG4gICAgICAgICAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAucmlnaHRUYWJsZUp1bXBUb01lXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAubGVmdFRhYmxlSnVtcFRvTWVcIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5yaWdodFRhYmxlSnVtcFRvTWVcIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5sZWZ0VGFibGVKdW1wVG9NZVwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0pIHtcbiAgICAgICAgICAgICQoXCIjbGVhZGVyYm9hcmRzIHRhYmxlIHRoZWFkIHRyIHRkOm50aC1jaGlsZCgzKVwiKS5odG1sKCdjcG08YnI+PGRpdiBjbGFzcz1cInN1YlwiPmFjY3VyYWN5PC9kaXY+Jyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiI2xlYWRlcmJvYXJkcyB0YWJsZSB0aGVhZCB0ciB0ZDpudGgtY2hpbGQoMylcIikuaHRtbCgnd3BtPGJyPjxkaXYgY2xhc3M9XCJzdWJcIj5hY2N1cmFjeTwvZGl2PicpO1xuICAgICAgICB9XG4gICAgICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAgICAgdXBkYXRlKCk7XG4gICAgICAgICAgICBzdGFydFRpbWVyKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG4kKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXJcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwibGVhZGVyYm9hcmRzV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbi8vICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAuYnV0dG9ucyAuYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwoZSkgPT4ge1xuLy8gICBjdXJyZW50TGVhZGVyYm9hcmQgPSAkKGUudGFyZ2V0KS5hdHRyKFwiYm9hcmRcIik7XG4vLyAgIHVwZGF0ZSgpO1xuLy8gfSk7XG5sZXQgbGVmdFNjcm9sbEVuYWJsZWQgPSB0cnVlO1xuJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLmxlZnRUYWJsZVdyYXBwZXJcIikuc2Nyb2xsKChlKSA9PiB7XG4gICAgaWYgKCFsZWZ0U2Nyb2xsRW5hYmxlZClcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IGVsZW0gPSAkKGUuY3VycmVudFRhcmdldCk7XG4gICAgaWYgKE1hdGgucm91bmQoZWxlbS5zY3JvbGxUb3AoKSkgPD0gNTApIHtcbiAgICAgICAgcmVxdWVzdE1vcmUoMTUsIHRydWUpO1xuICAgIH1cbn0pO1xuJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLmxlZnRUYWJsZVdyYXBwZXJcIikuc2Nyb2xsKChlKSA9PiB7XG4gICAgaWYgKCFsZWZ0U2Nyb2xsRW5hYmxlZClcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IGVsZW0gPSAkKGUuY3VycmVudFRhcmdldCk7XG4gICAgaWYgKE1hdGgucm91bmQoZWxlbVswXS5zY3JvbGxIZWlnaHQgLSBlbGVtLnNjcm9sbFRvcCgpKSA8PVxuICAgICAgICBNYXRoLnJvdW5kKGVsZW0ub3V0ZXJIZWlnaHQoKSkgKyA1MCkge1xuICAgICAgICByZXF1ZXN0TW9yZSgxNSk7XG4gICAgfVxufSk7XG5sZXQgcmlnaHRTY3JvbGxFbmFibGVkID0gdHJ1ZTtcbiQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5yaWdodFRhYmxlV3JhcHBlclwiKS5zY3JvbGwoKGUpID0+IHtcbiAgICBpZiAoIXJpZ2h0U2Nyb2xsRW5hYmxlZClcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IGVsZW0gPSAkKGUuY3VycmVudFRhcmdldCk7XG4gICAgaWYgKE1hdGgucm91bmQoZWxlbS5zY3JvbGxUb3AoKSkgPD0gNTApIHtcbiAgICAgICAgcmVxdWVzdE1vcmUoNjAsIHRydWUpO1xuICAgIH1cbn0pO1xuJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLnJpZ2h0VGFibGVXcmFwcGVyXCIpLnNjcm9sbCgoZSkgPT4ge1xuICAgIGNvbnN0IGVsZW0gPSAkKGUuY3VycmVudFRhcmdldCk7XG4gICAgaWYgKE1hdGgucm91bmQoZWxlbVswXS5zY3JvbGxIZWlnaHQgLSBlbGVtLnNjcm9sbFRvcCgpKSA8PVxuICAgICAgICBNYXRoLnJvdW5kKGVsZW0ub3V0ZXJIZWlnaHQoKSArIDUwKSkge1xuICAgICAgICByZXF1ZXN0TW9yZSg2MCk7XG4gICAgfVxufSk7XG4kKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAubGVmdFRhYmxlSnVtcFRvVG9wXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgbGVmdFNjcm9sbEVuYWJsZWQgPSBmYWxzZTtcbiAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAubGVmdFRhYmxlV3JhcHBlclwiKS5zY3JvbGxUb3AoMCk7XG4gICAgeWllbGQgcmVxdWVzdE5ldygxNSwgMCk7XG4gICAgbGVmdFNjcm9sbEVuYWJsZWQgPSB0cnVlO1xufSkpO1xuJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLmxlZnRUYWJsZUp1bXBUb01lXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgaWYgKGN1cnJlbnRSYW5rWzE1XS5yYW5rID09PSB1bmRlZmluZWQpXG4gICAgICAgIHJldHVybjtcbiAgICBsZWZ0U2Nyb2xsRW5hYmxlZCA9IGZhbHNlO1xuICAgIHlpZWxkIHJlcXVlc3ROZXcoMTUsIGN1cnJlbnRSYW5rWzE1XS5yYW5rIC0gbGVhZGVyYm9hcmRTaW5nbGVMaW1pdCAvIDIpO1xuICAgIGNvbnN0IHJvd0hlaWdodCA9ICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5sZWZ0VGFibGVXcmFwcGVyIHRhYmxlIHRib2R5IHRkXCIpLm91dGVySGVpZ2h0KCk7XG4gICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLmxlZnRUYWJsZVdyYXBwZXJcIikuYW5pbWF0ZSh7XG4gICAgICAgIHNjcm9sbFRvcDogcm93SGVpZ2h0ICpcbiAgICAgICAgICAgIE1hdGgubWluKGN1cnJlbnRSYW5rWzE1XS5yYW5rLCBsZWFkZXJib2FyZFNpbmdsZUxpbWl0IC8gMikgLVxuICAgICAgICAgICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLmxlZnRUYWJsZVdyYXBwZXJcIikub3V0ZXJIZWlnaHQoKSAvXG4gICAgICAgICAgICAgICAgMi4yNSxcbiAgICB9LCAwLCAoKSA9PiB7XG4gICAgICAgIGxlZnRTY3JvbGxFbmFibGVkID0gdHJ1ZTtcbiAgICB9KTtcbn0pKTtcbiQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5yaWdodFRhYmxlSnVtcFRvVG9wXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgcmlnaHRTY3JvbGxFbmFibGVkID0gZmFsc2U7XG4gICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLnJpZ2h0VGFibGVXcmFwcGVyXCIpLnNjcm9sbFRvcCgwKTtcbiAgICB5aWVsZCByZXF1ZXN0TmV3KDYwLCAwKTtcbiAgICByaWdodFNjcm9sbEVuYWJsZWQgPSB0cnVlO1xufSkpO1xuJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLnJpZ2h0VGFibGVKdW1wVG9NZVwiKS5vbihcImNsaWNrXCIsICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIGlmIChjdXJyZW50UmFua1s2MF0ucmFuayA9PT0gdW5kZWZpbmVkKVxuICAgICAgICByZXR1cm47XG4gICAgbGVmdFNjcm9sbEVuYWJsZWQgPSBmYWxzZTtcbiAgICB5aWVsZCByZXF1ZXN0TmV3KDYwLCBjdXJyZW50UmFua1s2MF0ucmFuayAtIGxlYWRlcmJvYXJkU2luZ2xlTGltaXQgLyAyKTtcbiAgICBjb25zdCByb3dIZWlnaHQgPSAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAucmlnaHRUYWJsZVdyYXBwZXIgdGFibGUgdGJvZHkgdGRcIikub3V0ZXJIZWlnaHQoKTtcbiAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAucmlnaHRUYWJsZVdyYXBwZXJcIikuYW5pbWF0ZSh7XG4gICAgICAgIHNjcm9sbFRvcDogcm93SGVpZ2h0ICpcbiAgICAgICAgICAgIE1hdGgubWluKGN1cnJlbnRSYW5rWzYwXS5yYW5rLCBsZWFkZXJib2FyZFNpbmdsZUxpbWl0IC8gMikgLVxuICAgICAgICAgICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLnJpZ2h0VGFibGVXcmFwcGVyXCIpLm91dGVySGVpZ2h0KCkgL1xuICAgICAgICAgICAgICAgIDIuMjUsXG4gICAgfSwgMCwgKCkgPT4ge1xuICAgICAgICBsZWZ0U2Nyb2xsRW5hYmxlZCA9IHRydWU7XG4gICAgfSk7XG59KSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3RvcCAjbWVudSAuaWNvbi1idXR0b25cIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLmN1cnJlbnRUYXJnZXQpLmhhc0NsYXNzKFwibGVhZGVyYm9hcmRzXCIpKSB7XG4gICAgICAgIHNob3coKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImtleWRvd25cIiwgKGV2ZW50KSA9PiB7XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFc2NhcGVcIiAmJiAhJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuZnVuY3Rpb24gc2hvdygpIHtcbiAgICAkKFwiI2JhY2tncm91bmRMb2FkZXJcIikuc3RvcCh0cnVlLCB0cnVlKS5mYWRlSW4oMTI1KTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgICQoXCIjYmFja2dyb3VuZExvYWRlclwiKS5zdG9wKHRydWUsIHRydWUpLmZhZGVPdXQoMTI1KTtcbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZSA9IHZvaWQgMDtcbmNvbnN0IFBhY2VDYXJldCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9wYWNlLWNhcmV0XCIpKTtcbmNvbnN0IFRlc3RTdGF0ZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LXN0YXRlXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBMYXN0MTBBdmVyYWdlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sYXN0LTEwLWF2ZXJhZ2VcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBUZXN0V29yZHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC13b3Jkc1wiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi4vZmlyZWJhc2VcIik7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5KSA9PiB7XG4gICAgaWYgKFtcbiAgICAgICAgXCJkaWZmaWN1bHR5XCIsXG4gICAgICAgIFwiYmxpbmRNb2RlXCIsXG4gICAgICAgIFwic3RvcE9uRXJyb3JcIixcbiAgICAgICAgXCJwYWNlQ2FyZXRcIixcbiAgICAgICAgXCJtaW5XcG1cIixcbiAgICAgICAgXCJtaW5BY2NcIixcbiAgICAgICAgXCJtaW5CdXJzdFwiLFxuICAgICAgICBcImNvbmZpZGVuY2VNb2RlXCIsXG4gICAgICAgIFwibGF5b3V0XCIsXG4gICAgICAgIFwic2hvd0F2ZXJhZ2VcIixcbiAgICAgICAgXCJhbHdheXNTaG93Q1BNXCIsXG4gICAgXS5pbmNsdWRlcyhldmVudEtleSkpIHtcbiAgICAgICAgdXBkYXRlKCk7XG4gICAgfVxufSk7XG5mdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGxldCBhbmltID0gZmFsc2U7XG4gICAgICAgIGlmICgkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikudGV4dCgpID09PSBcIlwiKVxuICAgICAgICAgICAgYW5pbSA9IHRydWU7XG4gICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5lbXB0eSgpO1xuICAgICAgICBpZiAoVGVzdFN0YXRlLmlzUmVwZWF0ZWQgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9PSBcInF1b3RlXCIpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvbiByZXN0YXJ0XCIgc3R5bGU9XCJjb2xvcjp2YXIoLS1lcnJvci1jb2xvcik7XCI+PGkgY2xhc3M9XCJmYXMgZmEtc3luYy1hbHRcIj48L2k+cmVwZWF0ZWQ8L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoVGVzdFdvcmRzLmhhc1RhYikge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCI+PGkgY2xhc3M9XCJmYXMgZmEtbG9uZy1hcnJvdy1hbHQtcmlnaHRcIj48L2k+c2hpZnQgKyB0YWIgdG8gcmVzdGFydDwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChUZXN0U3RhdGUuYWN0aXZlQ2hhbGxlbmdlKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIiBjb21tYW5kcz1cImNvbW1hbmRzQ2hhbGxlbmdlc1wiPjxpIGNsYXNzPVwiZmFzIGZhLWF3YXJkXCI+PC9pPiR7VGVzdFN0YXRlLmFjdGl2ZUNoYWxsZW5nZS5kaXNwbGF5fTwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiemVuXCIpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiPjxpIGNsYXNzPVwiZmFzIGZhLXBvbGxcIj48L2k+c2hpZnQgKyBlbnRlciB0byBmaW5pc2ggemVuIDwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiIGNvbW1hbmRzPVwiY29tbWFuZHNMYW5ndWFnZXNcIj48aSBjbGFzcz1cImZhcyBmYS1nbG9iZS1hbWVyaWNhc1wiPjwvaT4ke2NvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UucmVwbGFjZSgvXy9nLCBcIiBcIil9PC9kaXY+YCk7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHkgPT09IFwiZXhwZXJ0XCIpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiIGNvbW1hbmRzPVwiY29tbWFuZHNEaWZmaWN1bHR5XCI+PGkgY2xhc3M9XCJmYXMgZmEtc3Rhci1oYWxmLWFsdFwiPjwvaT5leHBlcnQ8L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHkgPT09IFwibWFzdGVyXCIpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiIGNvbW1hbmRzPVwiY29tbWFuZHNEaWZmaWN1bHR5XCI+PGkgY2xhc3M9XCJmYXMgZmEtc3RhclwiPjwvaT5tYXN0ZXI8L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvbiBibGluZFwiPjxpIGNsYXNzPVwiZmFzIGZhLWV5ZS1zbGFzaFwiPjwvaT5ibGluZDwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmxhenlNb2RlKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIiBjb21tYW5kcz1cImNvbW1hbmRzTGF6eU1vZGVcIj48aSBjbGFzcz1cImZhcyBmYS1jb3VjaFwiPjwvaT5sYXp5PC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucGFjZUNhcmV0ICE9PSBcIm9mZlwiIHx8XG4gICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5yZXBlYXRlZFBhY2UgJiYgVGVzdFN0YXRlLmlzUGFjZVJlcGVhdCkpIHtcbiAgICAgICAgICAgIGxldCBzcGVlZCA9IFwiXCI7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHNwZWVkID0gYCAoJHtNYXRoLnJvdW5kKFBhY2VDYXJldC5zZXR0aW5ncy53cG0pfSB3cG0pYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChfYikgeyB9XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIiBjb21tYW5kcz1cImNvbW1hbmRzUGFjZUNhcmV0XCI+PGkgY2xhc3M9XCJmYXMgZmEtdGFjaG9tZXRlci1hbHRcIj48L2k+JHtjb25maWdfMS5kZWZhdWx0LnBhY2VDYXJldCA9PT0gXCJhdmVyYWdlXCJcbiAgICAgICAgICAgICAgICA/IFwiYXZlcmFnZVwiXG4gICAgICAgICAgICAgICAgOiBjb25maWdfMS5kZWZhdWx0LnBhY2VDYXJldCA9PT0gXCJwYlwiXG4gICAgICAgICAgICAgICAgICAgID8gXCJwYlwiXG4gICAgICAgICAgICAgICAgICAgIDogXCJjdXN0b21cIn0gcGFjZSR7c3BlZWR9PC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc2hvd0F2ZXJhZ2UgIT09IFwib2ZmXCIpIHtcbiAgICAgICAgICAgIGxldCBhdmdXUE0gPSBMYXN0MTBBdmVyYWdlLmdldFdQTSgpO1xuICAgICAgICAgICAgbGV0IGF2Z0FjYyA9IExhc3QxMEF2ZXJhZ2UuZ2V0QWNjKCk7XG4gICAgICAgICAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0RlY2ltYWxQbGFjZXMpIHtcbiAgICAgICAgICAgICAgICBhdmdXUE0gPSBNYXRoLnJvdW5kKGF2Z1dQTSk7XG4gICAgICAgICAgICAgICAgYXZnQWNjID0gTWF0aC5yb3VuZChhdmdBY2MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciAmJiBhdmdXUE0gPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYXZnV1BNVGV4dCA9IFtcIndwbVwiLCBcImJvdGhcIl0uaW5jbHVkZXMoY29uZmlnXzEuZGVmYXVsdC5zaG93QXZlcmFnZSlcbiAgICAgICAgICAgICAgICAgICAgPyBjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE1cbiAgICAgICAgICAgICAgICAgICAgICAgID8gYCR7TWF0aC5yb3VuZChhdmdXUE0gKiA1KX0gY3BtYFxuICAgICAgICAgICAgICAgICAgICAgICAgOiBgJHthdmdXUE19IHdwbWBcbiAgICAgICAgICAgICAgICAgICAgOiBcIlwiO1xuICAgICAgICAgICAgICAgIGNvbnN0IGF2Z0FjY1RleHQgPSBbXCJhY2NcIiwgXCJib3RoXCJdLmluY2x1ZGVzKGNvbmZpZ18xLmRlZmF1bHQuc2hvd0F2ZXJhZ2UpXG4gICAgICAgICAgICAgICAgICAgID8gYCR7YXZnQWNjfSUgYWNjYFxuICAgICAgICAgICAgICAgICAgICA6IFwiXCI7XG4gICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGAke2F2Z1dQTVRleHR9ICR7YXZnQWNjVGV4dH1gLnRyaW0oKTtcbiAgICAgICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIiBjb21tYW5kcz1cImNvbW1hbmRzU2hvd0F2ZXJhZ2VcIj48aSBjbGFzcz1cImZhcyBmYS1jaGFydC1iYXJcIj48L2k+YXZnOiAke3RleHR9PC9kaXY+YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubWluV3BtICE9PSBcIm9mZlwiKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIiBjb21tYW5kcz1cImNvbW1hbmRzTWluV3BtXCI+PGkgY2xhc3M9XCJmYXMgZmEtYm9tYlwiPjwvaT5taW4gJHtjb25maWdfMS5kZWZhdWx0Lm1pbldwbUN1c3RvbVNwZWVkfSB3cG08L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5taW5BY2MgIT09IFwib2ZmXCIpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiIGNvbW1hbmRzPVwiY29tbWFuZHNNaW5BY2NcIj48aSBjbGFzcz1cImZhcyBmYS1ib21iXCI+PC9pPm1pbiAke2NvbmZpZ18xLmRlZmF1bHQubWluQWNjQ3VzdG9tfSUgYWNjPC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubWluQnVyc3QgIT09IFwib2ZmXCIpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiIGNvbW1hbmRzPVwiY29tbWFuZHNNaW5CdXJzdFwiPjxpIGNsYXNzPVwiZmFzIGZhLWJvbWJcIj48L2k+bWluICR7Y29uZmlnXzEuZGVmYXVsdC5taW5CdXJzdEN1c3RvbVNwZWVkfSBidXJzdCAke2NvbmZpZ18xLmRlZmF1bHQubWluQnVyc3QgPT09IFwiZmxleFwiID8gXCIoZmxleClcIiA6IFwiXCJ9PC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ICE9PSBcIm5vbmVcIikge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCIgY29tbWFuZHM9XCJjb21tYW5kc0Z1bmJveFwiPjxpIGNsYXNzPVwiZmFzIGZhLWdhbWVwYWRcIj48L2k+JHtjb25maWdfMS5kZWZhdWx0LmZ1bmJveC5yZXBsYWNlKC9fL2csIFwiIFwiKX08L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5jb25maWRlbmNlTW9kZSA9PT0gXCJvblwiKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIiBjb21tYW5kcz1cImNvbW1hbmRzQ29uZmlkZW5jZU1vZGVcIj48aSBjbGFzcz1cImZhcyBmYS1iYWNrc3BhY2VcIj48L2k+Y29uZmlkZW5jZTwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmNvbmZpZGVuY2VNb2RlID09PSBcIm1heFwiKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIiBjb21tYW5kcz1cImNvbW1hbmRzQ29uZmlkZW5jZU1vZGVcIj48aSBjbGFzcz1cImZhcyBmYS1iYWNrc3BhY2VcIj48L2k+bWF4IGNvbmZpZGVuY2U8L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zdG9wT25FcnJvciAhPSBcIm9mZlwiKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIiBjb21tYW5kcz1cImNvbW1hbmRzU3RvcE9uRXJyb3JcIj48aSBjbGFzcz1cImZhcyBmYS1oYW5kLXBhcGVyXCI+PC9pPnN0b3Agb24gJHtjb25maWdfMS5kZWZhdWx0LnN0b3BPbkVycm9yfTwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmxheW91dCAhPT0gXCJkZWZhdWx0XCIpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiIGNvbW1hbmRzPVwiY29tbWFuZHNMYXlvdXRzXCI+PGkgY2xhc3M9XCJmYXMgZmEta2V5Ym9hcmRcIj48L2k+ZW11bGF0aW5nICR7Y29uZmlnXzEuZGVmYXVsdC5sYXlvdXQucmVwbGFjZSgvXy9nLCBcIiBcIil9PC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQub3Bwb3NpdGVTaGlmdE1vZGUgIT09IFwib2ZmXCIpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiIGNvbW1hbmRzPVwiY29tbWFuZHNPcHBvc2l0ZVNoaWZ0TW9kZVwiPjxpIGNsYXNzPVwiZmFzIGZhLWV4Y2hhbmdlLWFsdFwiPjwvaT5vcHBvc2l0ZSBzaGlmdCR7Y29uZmlnXzEuZGVmYXVsdC5vcHBvc2l0ZVNoaWZ0TW9kZSA9PT0gXCJrZXltYXBcIiA/IFwiIChrZXltYXApXCIgOiBcIlwifTwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgIGxldCB0YWdzU3RyaW5nID0gXCJcIjtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIChfYSA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0YWcuYWN0aXZlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhZ3NTdHJpbmcgKz0gdGFnLm5hbWUgKyBcIiwgXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAodGFnc1N0cmluZyAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiIGNvbW1hbmRzPVwiY29tbWFuZHNUYWdzXCI+PGkgY2xhc3M9XCJmYXMgZmEtdGFnXCI+PC9pPiR7dGFnc1N0cmluZy5zdWJzdHJpbmcoMCwgdGFnc1N0cmluZy5sZW5ndGggLSAyKX08L2Rpdj5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoX2MpIHsgfVxuICAgICAgICBpZiAoYW5pbSkge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpXG4gICAgICAgICAgICAgICAgLmNzcyhcInRyYW5zaXRpb25cIiwgXCJub25lXCIpXG4gICAgICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5jc3MoXCJ0cmFuc2l0aW9uXCIsIFwiLjEyNXNcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy51cGRhdGUgPSB1cGRhdGU7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmFkZFBvd2VyID0gZXhwb3J0cy5yZXNldCA9IGV4cG9ydHMuaW5pdCA9IHZvaWQgMDtcbmNvbnN0IFRoZW1lQ29sb3JzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3RoZW1lLWNvbG9yc1wiKSk7XG5jb25zdCBTbG93VGltZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9zbG93LXRpbWVyXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuLyoqXG4gKiBAdHlwZWRlZiB7eyB4OiBudW1iZXIsIHk6IG51bWJlciB9fSB2ZWMyXG4gKiBAdHlwZWRlZiB7dmVjMiAmIHsgcHJldjogdmVjMiwgdmVsOiB2ZWMyLCBhbHBoYTogbnVtYmVyLCBjb2xvcjogc3RyaW5nIH19IFBhcnRpY2xlXG4gKiBAdHlwZWRlZiB7eyBwYXJ0aWNsZXM6IFBhcnRpY2xlW10sIGNhcmV0OiBhbnksIGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQsIGNvbnRleHQyZDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELCByZW5kZXJpbmc6IGJvb2xlYW4sIGxhc3RGcmFtZTogbnVtYmVyLCBkZWx0YVRpbWU6IG51bWJlciwgcmVzZXRUaW1lT3V0OiBudW1iZXIgfX0gQ1RYXG4gKi9cbi8qKlxuICogQHR5cGUge0NUWH0gY3R4XG4gKi9cbmNvbnN0IGN0eCA9IHtcbiAgICBwYXJ0aWNsZXM6IFtdLFxuICAgIHJlbmRlcmluZzogZmFsc2UsXG59O1xuY29uc3QgZ3Jhdml0eSA9IDEwMDA7XG5jb25zdCBkcmFnID0gMC4wNTtcbmNvbnN0IHBhcnRpY2xlU2l6ZSA9IDQ7XG5jb25zdCBwYXJ0aWNsZUZhZGUgPSAwLjY7XG5jb25zdCBwYXJ0aWNsZUluaXRWZWwgPSAxNTAwO1xuY29uc3QgcGFydGljbGVCb3VuY2VNb2QgPSAwLjM7XG5jb25zdCBwYXJ0aWNsZUNyZWF0ZUNvdW50ID0gWzYsIDNdO1xuY29uc3Qgc2hha2VBbW91bnQgPSAxMDtcbmZ1bmN0aW9uIGNyZWF0ZUNhbnZhcygpIHtcbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgIGNhbnZhcy5zdHlsZS5jc3NUZXh0ID1cbiAgICAgICAgXCJwb3NpdGlvbjpmaXhlZDt0b3A6MDtsZWZ0OjA7cG9pbnRlci1ldmVudHM6bm9uZTt6LWluZGV4Ojk5OTk5OVwiO1xuICAgIGNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgY2FudmFzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgKCkgPT4ge1xuICAgICAgICBjYW52YXMuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgICBjYW52YXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICB9KTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNhbnZhcyk7XG4gICAgcmV0dXJuIGNhbnZhcztcbn1cbi8qKlxuICogQHBhcmFtIHtudW1iZXJ9IHhcbiAqIEBwYXJhbSB7bnVtYmVyfSB5XG4gKiBAcGFyYW0ge3N0cmluZ30gY29sb3JcbiAqIEByZXR1cm5zIHtQYXJ0aWNsZX1cbiAqL1xuZnVuY3Rpb24gY3JlYXRlUGFydGljbGUoeCwgeSwgY29sb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICB4LFxuICAgICAgICB5LFxuICAgICAgICBjb2xvcixcbiAgICAgICAgYWxwaGE6IDEsXG4gICAgICAgIHByZXY6IHsgeCwgeSB9LFxuICAgICAgICB2ZWw6IHtcbiAgICAgICAgICAgIHg6IHBhcnRpY2xlSW5pdFZlbCAtIE1hdGgucmFuZG9tKCkgKiBwYXJ0aWNsZUluaXRWZWwgKiAyLFxuICAgICAgICAgICAgeTogcGFydGljbGVJbml0VmVsIC0gTWF0aC5yYW5kb20oKSAqIHBhcnRpY2xlSW5pdFZlbCAqIDIsXG4gICAgICAgIH0sXG4gICAgfTtcbn1cbi8qKlxuICogQHBhcmFtIHtQYXJ0aWNsZX0gcGFydGljbGVcbiAqL1xuZnVuY3Rpb24gdXBkYXRlUGFydGljbGUocGFydGljbGUpIHtcbiAgICBpZiAoIWN0eC5jYW52YXMgfHwgIWN0eC5kZWx0YVRpbWUpXG4gICAgICAgIHJldHVybjtcbiAgICBwYXJ0aWNsZS5wcmV2LnggPSBwYXJ0aWNsZS54O1xuICAgIHBhcnRpY2xlLnByZXYueSA9IHBhcnRpY2xlLnk7XG4gICAgLy8gVXBkYXRlIHBvc1xuICAgIHBhcnRpY2xlLnggKz0gcGFydGljbGUudmVsLnggKiBjdHguZGVsdGFUaW1lO1xuICAgIHBhcnRpY2xlLnkgKz0gcGFydGljbGUudmVsLnkgKiBjdHguZGVsdGFUaW1lO1xuICAgIGlmIChwYXJ0aWNsZS54ID4gY3R4LmNhbnZhcy53aWR0aCkge1xuICAgICAgICBwYXJ0aWNsZS52ZWwueCAqPSAtcGFydGljbGVCb3VuY2VNb2Q7XG4gICAgICAgIHBhcnRpY2xlLnggPVxuICAgICAgICAgICAgY3R4LmNhbnZhcy53aWR0aCAtIChwYXJ0aWNsZS54IC0gY3R4LmNhbnZhcy53aWR0aCkgKiBwYXJ0aWNsZUJvdW5jZU1vZDtcbiAgICB9XG4gICAgZWxzZSBpZiAocGFydGljbGUueCA8IDApIHtcbiAgICAgICAgcGFydGljbGUudmVsLnggKj0gLXBhcnRpY2xlQm91bmNlTW9kO1xuICAgICAgICBwYXJ0aWNsZS54ICo9IC1wYXJ0aWNsZUJvdW5jZU1vZDtcbiAgICB9XG4gICAgaWYgKHBhcnRpY2xlLnkgPiBjdHguY2FudmFzLmhlaWdodCkge1xuICAgICAgICBwYXJ0aWNsZS52ZWwueSAqPSAtcGFydGljbGVCb3VuY2VNb2Q7XG4gICAgICAgIHBhcnRpY2xlLnkgPVxuICAgICAgICAgICAgY3R4LmNhbnZhcy5oZWlnaHQgLSAocGFydGljbGUueSAtIGN0eC5jYW52YXMuaGVpZ2h0KSAqIHBhcnRpY2xlQm91bmNlTW9kO1xuICAgIH1cbiAgICBlbHNlIGlmIChwYXJ0aWNsZS55IDwgMCkge1xuICAgICAgICBwYXJ0aWNsZS52ZWwueSAqPSAtMTtcbiAgICAgICAgcGFydGljbGUueSAqPSAtMTtcbiAgICB9XG4gICAgcGFydGljbGUudmVsLnkgKz0gZ3Jhdml0eSAqIGN0eC5kZWx0YVRpbWU7XG4gICAgcGFydGljbGUudmVsLnggKj0gMSAtIGRyYWcgKiBjdHguZGVsdGFUaW1lO1xuICAgIHBhcnRpY2xlLmFscGhhICo9IDEgLSBwYXJ0aWNsZUZhZGUgKiBjdHguZGVsdGFUaW1lO1xufVxuZnVuY3Rpb24gaW5pdCgpIHtcbiAgICBjdHguY2FyZXQgPSAkKFwiI2NhcmV0XCIpO1xuICAgIGN0eC5jYW52YXMgPSBjcmVhdGVDYW52YXMoKTtcbiAgICBjdHguY29udGV4dDJkID0gY3R4LmNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG59XG5leHBvcnRzLmluaXQgPSBpbml0O1xuZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgIGlmICghY3R4Lmxhc3RGcmFtZSB8fCAhY3R4LmNvbnRleHQyZCB8fCAhY3R4LmNhbnZhcylcbiAgICAgICAgcmV0dXJuO1xuICAgIGN0eC5yZW5kZXJpbmcgPSB0cnVlO1xuICAgIGNvbnN0IHRpbWUgPSBEYXRlLm5vdygpO1xuICAgIGN0eC5kZWx0YVRpbWUgPSAodGltZSAtIGN0eC5sYXN0RnJhbWUpIC8gMTAwMDtcbiAgICBjdHgubGFzdEZyYW1lID0gdGltZTtcbiAgICBjdHguY29udGV4dDJkLmNsZWFyUmVjdCgwLCAwLCBjdHguY2FudmFzLndpZHRoLCBjdHguY2FudmFzLmhlaWdodCk7XG4gICAgY29uc3Qga2VlcCA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY3R4LnBhcnRpY2xlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBwYXJ0aWNsZSA9IGN0eC5wYXJ0aWNsZXNbaV07XG4gICAgICAgIGlmIChwYXJ0aWNsZS5hbHBoYSA8IDAuMSlcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB1cGRhdGVQYXJ0aWNsZShwYXJ0aWNsZSk7XG4gICAgICAgIGN0eC5jb250ZXh0MmQuZ2xvYmFsQWxwaGEgPSBwYXJ0aWNsZS5hbHBoYTtcbiAgICAgICAgY3R4LmNvbnRleHQyZC5zdHJva2VTdHlsZSA9IHBhcnRpY2xlLmNvbG9yO1xuICAgICAgICBjdHguY29udGV4dDJkLmxpbmVXaWR0aCA9IHBhcnRpY2xlU2l6ZTtcbiAgICAgICAgY3R4LmNvbnRleHQyZC5iZWdpblBhdGgoKTtcbiAgICAgICAgY3R4LmNvbnRleHQyZC5tb3ZlVG8oTWF0aC5yb3VuZChwYXJ0aWNsZS5wcmV2LngpLCBNYXRoLnJvdW5kKHBhcnRpY2xlLnByZXYueSkpO1xuICAgICAgICBjdHguY29udGV4dDJkLmxpbmVUbyhNYXRoLnJvdW5kKHBhcnRpY2xlLngpLCBNYXRoLnJvdW5kKHBhcnRpY2xlLnkpKTtcbiAgICAgICAgY3R4LmNvbnRleHQyZC5zdHJva2UoKTtcbiAgICAgICAga2VlcC5wdXNoKHBhcnRpY2xlKTtcbiAgICB9XG4gICAgY3R4LnBhcnRpY2xlcyA9IGtlZXA7XG4gICAgaWYgKGN0eC5wYXJ0aWNsZXMubGVuZ3RoICYmICFTbG93VGltZXIuZ2V0KCkpIHtcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlbmRlcik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjdHguY29udGV4dDJkLmNsZWFyUmVjdCgwLCAwLCBjdHguY2FudmFzLndpZHRoLCBjdHguY2FudmFzLmhlaWdodCk7XG4gICAgICAgIGN0eC5yZW5kZXJpbmcgPSBmYWxzZTtcbiAgICB9XG59XG5mdW5jdGlvbiByZXNldChpbW1lZGlhdGUgPSBmYWxzZSkge1xuICAgIGlmICghY3R4LnJlc2V0VGltZU91dClcbiAgICAgICAgcmV0dXJuO1xuICAgIGRlbGV0ZSBjdHgucmVzZXRUaW1lT3V0O1xuICAgIGNsZWFyVGltZW91dChjdHgucmVzZXRUaW1lT3V0KTtcbiAgICBjb25zdCBib2R5ID0gJChkb2N1bWVudC5ib2R5KTtcbiAgICBib2R5LmNzcyhcInRyYW5zaXRpb25cIiwgXCJhbGwgLjI1cywgdHJhbnNmb3JtIDAuOHNcIik7XG4gICAgYm9keS5jc3MoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgwLDApYCk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGJvZHkuY3NzKFwidHJhbnNpdGlvblwiLCBcImFsbCAuMjVzLCB0cmFuc2Zvcm0gLjA1c1wiKTtcbiAgICAgICAgJChcImh0bWxcIikuY3NzKFwib3ZlcmZsb3dcIiwgXCJpbmhlcml0XCIpO1xuICAgICAgICAkKFwiaHRtbFwiKS5jc3MoXCJvdmVyZmxvdy15XCIsIFwic2Nyb2xsXCIpO1xuICAgIH0sIGltbWVkaWF0ZSA/IDAgOiAxMDAwKTtcbn1cbmV4cG9ydHMucmVzZXQgPSByZXNldDtcbmZ1bmN0aW9uIHN0YXJ0UmVuZGVyKCkge1xuICAgIGlmICghY3R4LnJlbmRlcmluZykge1xuICAgICAgICBjdHgubGFzdEZyYW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgcmVuZGVyKCk7XG4gICAgfVxufVxuZnVuY3Rpb24gcmFuZG9tQ29sb3IoKSB7XG4gICAgY29uc3QgciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI1NikudG9TdHJpbmcoMTYpO1xuICAgIGNvbnN0IGcgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyNTYpLnRvU3RyaW5nKDE2KTtcbiAgICBjb25zdCBiID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjU2KS50b1N0cmluZygxNik7XG4gICAgcmV0dXJuIGAjJHtyfSR7Z30ke2J9YDtcbn1cbi8qKlxuICogQHBhcmFtIHtib29sZWFufSBnb29kIEdvb2QgcG93ZXIgb3Igbm90P1xuICovXG5mdW5jdGlvbiBhZGRQb3dlcihnb29kID0gdHJ1ZSwgZXh0cmEgPSBmYWxzZSkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2U7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9ua2V5UG93ZXJMZXZlbCA9PT0gXCJvZmZcIiB8fCBTbG93VGltZXIuZ2V0KCkpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIC8vIFNoYWtlXG4gICAgICAgIGlmIChbXCIzXCIsIFwiNFwiXS5pbmNsdWRlcyhjb25maWdfMS5kZWZhdWx0Lm1vbmtleVBvd2VyTGV2ZWwpKSB7XG4gICAgICAgICAgICAkKFwiaHRtbFwiKS5jc3MoXCJvdmVyZmxvd1wiLCBcImhpZGRlblwiKTtcbiAgICAgICAgICAgIGNvbnN0IHNoYWtlID0gW1xuICAgICAgICAgICAgICAgIE1hdGgucm91bmQoc2hha2VBbW91bnQgLSBNYXRoLnJhbmRvbSgpICogc2hha2VBbW91bnQpLFxuICAgICAgICAgICAgICAgIE1hdGgucm91bmQoc2hha2VBbW91bnQgLSBNYXRoLnJhbmRvbSgpICogc2hha2VBbW91bnQpLFxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICQoZG9jdW1lbnQuYm9keSkuY3NzKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHtzaGFrZVswXX1weCwgJHtzaGFrZVsxXX1weClgKTtcbiAgICAgICAgICAgIGlmIChjdHgucmVzZXRUaW1lT3V0KVxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChjdHgucmVzZXRUaW1lT3V0KTtcbiAgICAgICAgICAgIGN0eC5yZXNldFRpbWVPdXQgPSBzZXRUaW1lb3V0KHJlc2V0LCAyMDAwKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBTcGFya3NcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gKF9hID0gY3R4LmNhcmV0KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Eub2Zmc2V0KCk7XG4gICAgICAgIGNvbnN0IGNvb3JkcyA9IFtcbiAgICAgICAgICAgIChfYiA9IG9mZnNldCA9PT0gbnVsbCB8fCBvZmZzZXQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9mZnNldC5sZWZ0KSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAwLFxuICAgICAgICAgICAgKChfYyA9IG9mZnNldCA9PT0gbnVsbCB8fCBvZmZzZXQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9mZnNldC50b3ApICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IDApICsgKChfZSA9IChfZCA9IGN0eC5jYXJldCkgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmhlaWdodCgpKSAhPT0gbnVsbCAmJiBfZSAhPT0gdm9pZCAwID8gX2UgOiAwKSxcbiAgICAgICAgXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IE1hdGgucm91bmQoKHBhcnRpY2xlQ3JlYXRlQ291bnRbMF0gKyBNYXRoLnJhbmRvbSgpICogcGFydGljbGVDcmVhdGVDb3VudFsxXSkgKlxuICAgICAgICAgICAgKGV4dHJhID8gMiA6IDEpKTsgaSA+IDA7IGktLSkge1xuICAgICAgICAgICAgY29uc3QgY29sb3IgPSBbXCIyXCIsIFwiNFwiXS5pbmNsdWRlcyhjb25maWdfMS5kZWZhdWx0Lm1vbmtleVBvd2VyTGV2ZWwpXG4gICAgICAgICAgICAgICAgPyByYW5kb21Db2xvcigpXG4gICAgICAgICAgICAgICAgOiBnb29kXG4gICAgICAgICAgICAgICAgICAgID8geWllbGQgVGhlbWVDb2xvcnMuZ2V0KFwiY2FyZXRcIilcbiAgICAgICAgICAgICAgICAgICAgOiB5aWVsZCBUaGVtZUNvbG9ycy5nZXQoXCJlcnJvclwiKTtcbiAgICAgICAgICAgIGN0eC5wYXJ0aWNsZXMucHVzaChjcmVhdGVQYXJ0aWNsZSguLi5jb29yZHMsIGNvbG9yKSk7XG4gICAgICAgIH1cbiAgICAgICAgc3RhcnRSZW5kZXIoKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuYWRkUG93ZXIgPSBhZGRQb3dlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmFkZEJhbm5lciA9IGV4cG9ydHMuYWRkID0gdm9pZCAwO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5sZXQgaWQgPSAwO1xuY2xhc3MgTm90aWZpY2F0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcih0eXBlLCBtZXNzYWdlLCBsZXZlbCwgZHVyYXRpb24sIGN1c3RvbVRpdGxlLCBjdXN0b21JY29uLCBjbG9zZUNhbGxiYWNrID0gKCkgPT4ge1xuICAgICAgICAvL1xuICAgIH0pIHtcbiAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICAgICAgdGhpcy5sZXZlbCA9IGxldmVsO1xuICAgICAgICBpZiAodHlwZSA9PT0gXCJiYW5uZXJcIikge1xuICAgICAgICAgICAgdGhpcy5kdXJhdGlvbiA9IGR1cmF0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKGR1cmF0aW9uID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGlmIChsZXZlbCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kdXJhdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmR1cmF0aW9uID0gMzAwMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmR1cmF0aW9uID0gZHVyYXRpb24gKiAxMDAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuY3VzdG9tVGl0bGUgPSBjdXN0b21UaXRsZTtcbiAgICAgICAgdGhpcy5jdXN0b21JY29uID0gY3VzdG9tSWNvbjtcbiAgICAgICAgdGhpcy5pZCA9IGlkKys7XG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IGNsb3NlQ2FsbGJhY2s7XG4gICAgfVxuICAgIC8vbGV2ZWxcbiAgICAvLzAgLSBub3RpY2VcbiAgICAvLzEgLSBnb29kXG4gICAgLy8tMSAtIGJhZFxuICAgIHNob3coKSB7XG4gICAgICAgIGxldCBjbHMgPSBcIm5vdGljZVwiO1xuICAgICAgICBsZXQgaWNvbiA9IGA8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1leGNsYW1hdGlvblwiPjwvaT5gO1xuICAgICAgICBsZXQgdGl0bGUgPSBcIk5vdGljZVwiO1xuICAgICAgICBpZiAodGhpcy5sZXZlbCA9PT0gMSkge1xuICAgICAgICAgICAgY2xzID0gXCJnb29kXCI7XG4gICAgICAgICAgICBpY29uID0gYDxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWNoZWNrXCI+PC9pPmA7XG4gICAgICAgICAgICB0aXRsZSA9IFwiU3VjY2Vzc1wiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMubGV2ZWwgPT09IC0xKSB7XG4gICAgICAgICAgICBjbHMgPSBcImJhZFwiO1xuICAgICAgICAgICAgaWNvbiA9IGA8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS10aW1lc1wiPjwvaT5gO1xuICAgICAgICAgICAgdGl0bGUgPSBcIkVycm9yXCI7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKHRoaXMubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY3VzdG9tVGl0bGUgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aXRsZSA9IHRoaXMuY3VzdG9tVGl0bGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gXCJiYW5uZXJcIikge1xuICAgICAgICAgICAgaWNvbiA9IGA8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1idWxsaG9yblwiPjwvaT5gO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmN1c3RvbUljb24gIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpY29uID0gYDxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLSR7dGhpcy5jdXN0b21JY29ufVwiPjwvaT5gO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnR5cGUgPT09IFwibm90aWZpY2F0aW9uXCIpIHtcbiAgICAgICAgICAgIC8vIG1vdmVDdXJyZW50VG9IaXN0b3J5KCk7XG4gICAgICAgICAgICBjb25zdCBvbGRIZWlnaHQgPSAkKFwiI25vdGlmaWNhdGlvbkNlbnRlciAuaGlzdG9yeVwiKS5oZWlnaHQoKTtcbiAgICAgICAgICAgICQoXCIjbm90aWZpY2F0aW9uQ2VudGVyIC5oaXN0b3J5XCIpLnByZXBlbmQoYFxuICAgICAgICAgIFxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJub3RpZiAke2Nsc31cIiBpZD0ke3RoaXMuaWR9PlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiaWNvblwiPiR7aWNvbn08L2Rpdj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1lc3NhZ2VcIj48ZGl2IGNsYXNzPVwidGl0bGVcIj4ke3RpdGxlfTwvZGl2PiR7dGhpcy5tZXNzYWdlfTwvZGl2PlxuICAgICAgICAgIDwvZGl2PiAgICAgXG5cbiAgICAgICAgICBgKTtcbiAgICAgICAgICAgIGNvbnN0IG5ld0hlaWdodCA9ICQoXCIjbm90aWZpY2F0aW9uQ2VudGVyIC5oaXN0b3J5XCIpLmhlaWdodCgpO1xuICAgICAgICAgICAgJChgI25vdGlmaWNhdGlvbkNlbnRlciAubm90aWZbaWQ9JyR7dGhpcy5pZH0nXWApLnJlbW92ZSgpO1xuICAgICAgICAgICAgJChcIiNub3RpZmljYXRpb25DZW50ZXIgLmhpc3RvcnlcIilcbiAgICAgICAgICAgICAgICAuY3NzKFwibWFyZ2luLXRvcFwiLCAwKVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBtYXJnaW5Ub3A6IG5ld0hlaWdodCAtIG9sZEhlaWdodCxcbiAgICAgICAgICAgIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICQoXCIjbm90aWZpY2F0aW9uQ2VudGVyIC5oaXN0b3J5XCIpLmNzcyhcIm1hcmdpbi10b3BcIiwgMCk7XG4gICAgICAgICAgICAgICAgJChcIiNub3RpZmljYXRpb25DZW50ZXIgLmhpc3RvcnlcIikucHJlcGVuZChgXG4gICAgICAgICAgXG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibm90aWYgJHtjbHN9XCIgaWQ9JHt0aGlzLmlkfT5cbiAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiaWNvblwiPiR7aWNvbn08L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWVzc2FnZVwiPjxkaXYgY2xhc3M9XCJ0aXRsZVwiPiR7dGl0bGV9PC9kaXY+JHt0aGlzLm1lc3NhZ2V9PC9kaXY+XG4gICAgICAgICAgICAgICAgICA8L2Rpdj4gICAgIFxuXG4gICAgICAgICAgICAgIGApO1xuICAgICAgICAgICAgICAgICQoYCNub3RpZmljYXRpb25DZW50ZXIgLm5vdGlmW2lkPScke3RoaXMuaWR9J11gKVxuICAgICAgICAgICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICAgICAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICQoYCNub3RpZmljYXRpb25DZW50ZXIgLm5vdGlmW2lkPScke3RoaXMuaWR9J11gKS5jc3MoXCJvcGFjaXR5XCIsIFwiXCIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICQoYCNub3RpZmljYXRpb25DZW50ZXIgLm5vdGlmW2lkPScke3RoaXMuaWR9J11gKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkKGAjbm90aWZpY2F0aW9uQ2VudGVyIC5ub3RpZltpZD0nJHt0aGlzLmlkfSddYCkuaG92ZXIoKCkgPT4ge1xuICAgICAgICAgICAgICAgICQoYCNub3RpZmljYXRpb25DZW50ZXIgLm5vdGlmW2lkPScke3RoaXMuaWR9J11gKS50b2dnbGVDbGFzcyhcImhvdmVyXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy50eXBlID09PSBcImJhbm5lclwiKSB7XG4gICAgICAgICAgICBsZXQgbGVmdHNpZGUgPSBgPGRpdiBjbGFzcz1cImljb24gbGVmdGljb25cIj4ke2ljb259PC9kaXY+YDtcbiAgICAgICAgICAgIGlmICgvXmltYWdlc1xcLy4qLy50ZXN0KHRoaXMuY3VzdG9tSWNvbikpIHtcbiAgICAgICAgICAgICAgICBsZWZ0c2lkZSA9IGA8ZGl2IGNsYXNzPVwiaW1hZ2VcIiBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6IHVybCgke3RoaXMuY3VzdG9tSWNvbn0pXCI+PC9kaXY+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQoXCIjYmFubmVyQ2VudGVyXCIpLnByZXBlbmQoYFxuICAgICAgICA8ZGl2IGNsYXNzPVwiYmFubmVyICR7Y2xzfVwiIGlkPVwiJHt0aGlzLmlkfVwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29udGFpbmVyXCI+XG4gICAgICAgICAgJHtsZWZ0c2lkZX1cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidGV4dFwiPlxuICAgICAgICAgICAgJHt0aGlzLm1lc3NhZ2V9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgJHt0aGlzLmR1cmF0aW9uID49IDBcbiAgICAgICAgICAgICAgICA/IGBcbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2xvc2VCdXR0b25cIj5cbiAgICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXRpbWVzXCI+PC9pPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIGBcbiAgICAgICAgICAgICAgICA6IGA8ZGl2IGNsYXNzPVwicmlnaHRpY29uXCI+JHtpY29ufTwvZGl2PmB9XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgICBgKTtcbiAgICAgICAgICAgIGNvbnN0IGhlaWdodCA9ICQoXCIjYmFubmVyQ2VudGVyXCIpLmhlaWdodCgpO1xuICAgICAgICAgICAgJChcIiNjZW50ZXJDb250ZW50XCIpLmNzcyhcInBhZGRpbmctdG9wXCIsIGhlaWdodCArIE1pc2MuY29udmVydFJlbVRvUGl4ZWxzKDIpICsgXCJweFwiKTtcbiAgICAgICAgICAgICQoXCIjbm90aWZpY2F0aW9uQ2VudGVyXCIpLmNzcyhcIm1hcmdpbi10b3BcIiwgaGVpZ2h0ICsgXCJweFwiKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmR1cmF0aW9uID49IDApIHtcbiAgICAgICAgICAgICAgICAkKGAjYmFubmVyQ2VudGVyIC5iYW5uZXJbaWQ9JyR7dGhpcy5pZH0nXSAuY2xvc2VCdXR0b25gKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmR1cmF0aW9uID4gMCkge1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgICAgICB9LCB0aGlzLmR1cmF0aW9uICsgMjUwKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBoaWRlKCkge1xuICAgICAgICBpZiAodGhpcy50eXBlID09PSBcIm5vdGlmaWNhdGlvblwiKSB7XG4gICAgICAgICAgICAkKGAjbm90aWZpY2F0aW9uQ2VudGVyIC5ub3RpZltpZD0nJHt0aGlzLmlkfSddYClcbiAgICAgICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgJChgI25vdGlmaWNhdGlvbkNlbnRlciAubm90aWZbaWQ9JyR7dGhpcy5pZH0nXWApLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDAsXG4gICAgICAgICAgICAgICAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICQoYCNub3RpZmljYXRpb25DZW50ZXIgLm5vdGlmW2lkPScke3RoaXMuaWR9J11gKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMudHlwZSA9PT0gXCJiYW5uZXJcIikge1xuICAgICAgICAgICAgJChgI2Jhbm5lckNlbnRlciAuYmFubmVyW2lkPScke3RoaXMuaWR9J11gKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIGNvbnN0IGhlaWdodCA9ICQoXCIjYmFubmVyQ2VudGVyXCIpLmhlaWdodCgpO1xuICAgICAgICAgICAgJChcIiNjZW50ZXJDb250ZW50XCIpLmNzcyhcInBhZGRpbmctdG9wXCIsIGhlaWdodCArIE1pc2MuY29udmVydFJlbVRvUGl4ZWxzKDIpICsgXCJweFwiKTtcbiAgICAgICAgICAgICQoXCIjbm90aWZpY2F0aW9uQ2VudGVyXCIpLmNzcyhcIm1hcmdpbi10b3BcIiwgaGVpZ2h0ICsgXCJweFwiKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGFkZChtZXNzYWdlLCBsZXZlbCA9IDAsIGR1cmF0aW9uLCBjdXN0b21UaXRsZSwgY3VzdG9tSWNvbiwgY2xvc2VDYWxsYmFjaykge1xuICAgIC8vIG5vdGlmaWNhdGlvbkhpc3RvcnkucHVzaChcbiAgICBuZXcgTm90aWZpY2F0aW9uKFwibm90aWZpY2F0aW9uXCIsIG1lc3NhZ2UsIGxldmVsLCBkdXJhdGlvbiwgY3VzdG9tVGl0bGUsIGN1c3RvbUljb24sIGNsb3NlQ2FsbGJhY2spLnNob3coKTtcbiAgICAvLyApO1xufVxuZXhwb3J0cy5hZGQgPSBhZGQ7XG5mdW5jdGlvbiBhZGRCYW5uZXIobWVzc2FnZSwgbGV2ZWwgPSAtMSwgY3VzdG9tSWNvbiA9IFwiYnVsbGhvcm5cIiwgc3RpY2t5ID0gZmFsc2UsIGNsb3NlQ2FsbGJhY2spIHtcbiAgICAvLyBub3RpZmljYXRpb25IaXN0b3J5LnB1c2goXG4gICAgbmV3IE5vdGlmaWNhdGlvbihcImJhbm5lclwiLCBtZXNzYWdlLCBsZXZlbCwgc3RpY2t5ID8gLTEgOiAwLCB1bmRlZmluZWQsIGN1c3RvbUljb24sIGNsb3NlQ2FsbGJhY2spLnNob3coKTtcbiAgICAvLyApO1xufVxuZXhwb3J0cy5hZGRCYW5uZXIgPSBhZGRCYW5uZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNob3cgPSB2b2lkIDA7XG5jb25zdCBhcGVfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vYXBlXCIpKTtcbmNvbnN0IG1pc2NfMSA9IHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IGZvcm1hdF8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJkYXRlLWZucy9mb3JtYXRcIikpO1xuZnVuY3Rpb24gY2xlYXJNZW1vcnkoKSB7XG4gICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiY29uZmlybWVkUFNBc1wiLCBKU09OLnN0cmluZ2lmeShbXSkpO1xufVxuZnVuY3Rpb24gZ2V0TWVtb3J5KCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgcmV0dXJuIChfYiA9IEpTT04ucGFyc2UoKF9hID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiY29uZmlybWVkUFNBc1wiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCJbXVwiKSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogW107XG59XG5mdW5jdGlvbiBzZXRNZW1vcnkoaWQpIHtcbiAgICBjb25zdCBsaXN0ID0gZ2V0TWVtb3J5KCk7XG4gICAgbGlzdC5wdXNoKGlkKTtcbiAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJjb25maXJtZWRQU0FzXCIsIEpTT04uc3RyaW5naWZ5KGxpc3QpKTtcbn1cbmZ1bmN0aW9uIGdldExhdGVzdCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucHNhcy5nZXQoKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2UgPT09IFwiU2VydmVyIGlzIGRvd24gZm9yIG1haW50ZW5hbmNlXCIpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkQmFubmVyKFwiU2VydmVyIGlzIGN1cnJlbnRseSB1bmRlciBtYWludGVuYW5jZS4gPGEgdGFyZ2V0PSAnX2JsYW5rJyBocmVmPSdodHRwczovL21vbmtleXR5cGUuaW5zdGF0dXMuY29tLyc+Q2xpY2sgaGVyZTwvYT4gZm9yIG1vcmUgaW5mby5cIiwgLTEsIFwiYnVsbGhvcm5cIiwgdHJ1ZSk7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBzaG93KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IGxhdGVzdCA9IHlpZWxkIGdldExhdGVzdCgpO1xuICAgICAgICBpZiAobGF0ZXN0ID09IG51bGwgfHwgbGF0ZXN0Lmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICBjbGVhck1lbW9yeSgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGxvY2FsbWVtb3J5ID0gZ2V0TWVtb3J5KCk7XG4gICAgICAgIGxhdGVzdC5mb3JFYWNoKChwc2EpID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIGlmIChsb2NhbG1lbW9yeS5pbmNsdWRlcyhwc2EuX2lkKSAmJiAoKF9hID0gcHNhLnN0aWNreSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogZmFsc2UpID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwc2EuZGF0ZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGVPYmogPSBuZXcgRGF0ZShwc2EuZGF0ZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgZGlmZiA9IHBzYS5kYXRlIC0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzdHJpbmcgPSAoMCwgbWlzY18xLnNlY29uZHNUb1N0cmluZykoZGlmZiAvIDEwMDAsIGZhbHNlLCBmYWxzZSwgXCJ0ZXh0XCIsIGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBwc2EubWVzc2FnZSA9IHBzYS5tZXNzYWdlLnJlcGxhY2UoXCJ7ZGF0ZURpZmZlcmVuY2V9XCIsIHN0cmluZyk7XG4gICAgICAgICAgICAgICAgcHNhLm1lc3NhZ2UgPSBwc2EubWVzc2FnZS5yZXBsYWNlKFwie2RhdGVOb1RpbWV9XCIsICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlT2JqLCBcImRkIE1NTSB5eXl5XCIpKTtcbiAgICAgICAgICAgICAgICBwc2EubWVzc2FnZSA9IHBzYS5tZXNzYWdlLnJlcGxhY2UoXCJ7ZGF0ZX1cIiwgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGVPYmosIFwiZGQgTU1NIHl5eXkgSEg6bW1cIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGRCYW5uZXIocHNhLm1lc3NhZ2UsIHBzYS5sZXZlbCwgXCJidWxsaG9yblwiLCBwc2Euc3RpY2t5LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgc2V0TWVtb3J5KHBzYS5faWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBBY3RpdmVQYWdlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvYWN0aXZlLXBhZ2VcIikpO1xubGV0IHZpc2libGUgPSBmYWxzZTtcbiQoXCIuc2Nyb2xsVG9Ub3BCdXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgd2luZG93LnNjcm9sbFRvKHsgdG9wOiAwLCBiZWhhdmlvcjogXCJzbW9vdGhcIiB9KTtcbn0pO1xuJCh3aW5kb3cpLnNjcm9sbCgoKSA9PiB7XG4gICAgY29uc3QgcGFnZSA9IEFjdGl2ZVBhZ2UuZ2V0KCk7XG4gICAgaWYgKHBhZ2UgPT0gXCJ0ZXN0XCIpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAocGFnZSA9PSBcImFib3V0XCIgfHwgcGFnZSA9PSBcInNldHRpbmdzXCIgfHwgcGFnZSA9PSBcImFjY291bnRcIikge1xuICAgICAgICBjb25zdCBzY3JvbGwgPSB3aW5kb3cuc2Nyb2xsWTtcbiAgICAgICAgaWYgKCF2aXNpYmxlICYmIHNjcm9sbCA+IDEwMCkge1xuICAgICAgICAgICAgJChcIi5zY3JvbGxUb1RvcEJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImludmlzaWJsZVwiKTtcbiAgICAgICAgICAgIHZpc2libGUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHZpc2libGUgJiYgc2Nyb2xsIDwgMTAwKSB7XG4gICAgICAgICAgICAkKFwiLnNjcm9sbFRvVG9wQnV0dG9uXCIpLmFkZENsYXNzKFwiaW52aXNpYmxlXCIpO1xuICAgICAgICAgICAgdmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51cGRhdGUgPSBleHBvcnRzLnJlc2V0ID0gZXhwb3J0cy5nZXRBbGwgPSBleHBvcnRzLmdldCA9IHZvaWQgMDtcbmxldCBjb2xvcnMgPSB7XG4gICAgYmc6IFwiIzMyMzQzN1wiLFxuICAgIG1haW46IFwiI2UyYjcxNFwiLFxuICAgIGNhcmV0OiBcIiNlMmI3MTRcIixcbiAgICBzdWI6IFwiIzY0NjY2OVwiLFxuICAgIHRleHQ6IFwiI2QxZDBjNVwiLFxuICAgIGVycm9yOiBcIiNjYTQ3NTRcIixcbiAgICBlcnJvckV4dHJhOiBcIiM3ZTJhMzNcIixcbiAgICBjb2xvcmZ1bEVycm9yOiBcIiNjYTQ3NTRcIixcbiAgICBjb2xvcmZ1bEVycm9yRXh0cmE6IFwiIzdlMmEzM1wiLFxufTtcbmZ1bmN0aW9uIGdldChjb2xvcikge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmICghY29sb3JzW2NvbG9yXSlcbiAgICAgICAgICAgIHVwZGF0ZSgpO1xuICAgICAgICByZXR1cm4gY29sb3JzW2NvbG9yXTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0ID0gZ2V0O1xuZnVuY3Rpb24gZ2V0QWxsKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmICghY29sb3JzLmJnKVxuICAgICAgICAgICAgdXBkYXRlKCk7XG4gICAgICAgIHJldHVybiBjb2xvcnM7XG4gICAgfSk7XG59XG5leHBvcnRzLmdldEFsbCA9IGdldEFsbDtcbmZ1bmN0aW9uIHJlc2V0KCkge1xuICAgIGNvbG9ycyA9IHtcbiAgICAgICAgYmc6IFwiXCIsXG4gICAgICAgIG1haW46IFwiXCIsXG4gICAgICAgIGNhcmV0OiBcIlwiLFxuICAgICAgICBzdWI6IFwiXCIsXG4gICAgICAgIHRleHQ6IFwiXCIsXG4gICAgICAgIGVycm9yOiBcIlwiLFxuICAgICAgICBlcnJvckV4dHJhOiBcIlwiLFxuICAgICAgICBjb2xvcmZ1bEVycm9yOiBcIlwiLFxuICAgICAgICBjb2xvcmZ1bEVycm9yRXh0cmE6IFwiXCIsXG4gICAgfTtcbn1cbmV4cG9ydHMucmVzZXQgPSByZXNldDtcbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICBjb25zdCBzdCA9IGdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuYm9keSk7XG4gICAgY29sb3JzLmJnID0gc3QuZ2V0UHJvcGVydHlWYWx1ZShcIi0tYmctY29sb3JcIikucmVwbGFjZShcIiBcIiwgXCJcIik7XG4gICAgY29sb3JzLm1haW4gPSBzdC5nZXRQcm9wZXJ0eVZhbHVlKFwiLS1tYWluLWNvbG9yXCIpLnJlcGxhY2UoXCIgXCIsIFwiXCIpO1xuICAgIGNvbG9ycy5jYXJldCA9IHN0LmdldFByb3BlcnR5VmFsdWUoXCItLWNhcmV0LWNvbG9yXCIpLnJlcGxhY2UoXCIgXCIsIFwiXCIpO1xuICAgIGNvbG9ycy5zdWIgPSBzdC5nZXRQcm9wZXJ0eVZhbHVlKFwiLS1zdWItY29sb3JcIikucmVwbGFjZShcIiBcIiwgXCJcIik7XG4gICAgY29sb3JzLnRleHQgPSBzdC5nZXRQcm9wZXJ0eVZhbHVlKFwiLS10ZXh0LWNvbG9yXCIpLnJlcGxhY2UoXCIgXCIsIFwiXCIpO1xuICAgIGNvbG9ycy5lcnJvciA9IHN0LmdldFByb3BlcnR5VmFsdWUoXCItLWVycm9yLWNvbG9yXCIpLnJlcGxhY2UoXCIgXCIsIFwiXCIpO1xuICAgIGNvbG9ycy5lcnJvckV4dHJhID0gc3RcbiAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCItLWVycm9yLWV4dHJhLWNvbG9yXCIpXG4gICAgICAgIC5yZXBsYWNlKFwiIFwiLCBcIlwiKTtcbiAgICBjb2xvcnMuY29sb3JmdWxFcnJvciA9IHN0XG4gICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwiLS1jb2xvcmZ1bC1lcnJvci1jb2xvclwiKVxuICAgICAgICAucmVwbGFjZShcIiBcIiwgXCJcIik7XG4gICAgY29sb3JzLmNvbG9yZnVsRXJyb3JFeHRyYSA9IHN0XG4gICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwiLS1jb2xvcmZ1bC1lcnJvci1leHRyYS1jb2xvclwiKVxuICAgICAgICAucmVwbGFjZShcIiBcIiwgXCJcIik7XG59XG5leHBvcnRzLnVwZGF0ZSA9IHVwZGF0ZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbm90aWZpY2F0aW9uc1wiKSk7XG4vLyBpbXBvcnQgKiBhcyBWZXJzaW9uUG9wdXAgZnJvbSBcIi4vdmVyc2lvbi1wb3B1cFwiO1xuZnVuY3Rpb24gc2V0TWVtb3J5KHYpIHtcbiAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJsYXN0U2VlblZlcnNpb25cIiwgdik7XG59XG5mdW5jdGlvbiBnZXRNZW1vcnkoKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiAoX2EgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJsYXN0U2VlblZlcnNpb25cIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiXCI7XG59XG5mdW5jdGlvbiBzaG93KHZlcnNpb24pIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCBtZW1vcnkgPSB5aWVsZCBnZXRNZW1vcnkoKTtcbiAgICAgICAgaWYgKG1lbW9yeSA9PT0gXCJcIikge1xuICAgICAgICAgICAgc2V0TWVtb3J5KHZlcnNpb24pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgPT09IFwibG9jYWxob3N0XCIgfHxcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSA9PT0gXCIxMjcuMC4wLjFcIikge1xuICAgICAgICAgICAgY2FjaGVzLmtleXMoKS50aGVuKGZ1bmN0aW9uIChuYW1lcykge1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcylcbiAgICAgICAgICAgICAgICAgICAgY2FjaGVzLmRlbGV0ZShuYW1lKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtZW1vcnkgPT09IHZlcnNpb24pXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNhY2hlcy5rZXlzKCkudGhlbihmdW5jdGlvbiAobmFtZXMpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcylcbiAgICAgICAgICAgICAgICBjYWNoZXMuZGVsZXRlKG5hbWUpO1xuICAgICAgICB9KTtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGRCYW5uZXIoYFZlcnNpb24gJHt2ZXJzaW9ufSBoYXMgYmVlbiByZWxlYXNlZC4gQ2xpY2sgdGhlIHZlcnNpb24gbnVtYmVyIGluIHRoZSBib3R0b20gcmlnaHQgdG8gdmlldyB0aGUgY2hhbmdlbG9nLmAsIDEsIFwiY29kZS1icmFuY2hcIiwgZmFsc2UpO1xuICAgICAgICBzZXRNZW1vcnkodmVyc2lvbik7XG4gICAgfSk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkFuYWx5dGljcyA9IGV4cG9ydHMuQXV0aCA9IHZvaWQgMDtcbi8vIEltcG9ydCB0aGUgZnVuY3Rpb25zIHlvdSBuZWVkIGZyb20gdGhlIFNES3MgeW91IG5lZWRcbmNvbnN0IGFwcF8xID0gcmVxdWlyZShcImZpcmViYXNlL2FwcFwiKTtcbmNvbnN0IGF1dGhfMSA9IHJlcXVpcmUoXCJmaXJlYmFzZS9hdXRoXCIpO1xuY29uc3QgZmlyZWJhc2VfY29uZmlnXzEgPSByZXF1aXJlKFwiLi9jb25zdGFudHMvZmlyZWJhc2UtY29uZmlnXCIpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtcGF0aC1leGlzdHMvZXhpc3RzXG5jb25zdCBhbmFseXRpY3NfMSA9IHJlcXVpcmUoXCJmaXJlYmFzZS9hbmFseXRpY3NcIik7XG4vLyBJbml0aWFsaXplIEZpcmViYXNlXG5sZXQgYXBwO1xudHJ5IHtcbiAgICBhcHAgPSAoMCwgYXBwXzEuaW5pdGlhbGl6ZUFwcCkoZmlyZWJhc2VfY29uZmlnXzEuZmlyZWJhc2VDb25maWcpO1xuICAgIGV4cG9ydHMuQXV0aCA9ICgwLCBhdXRoXzEuZ2V0QXV0aCkoYXBwKTtcbiAgICBleHBvcnRzLkFuYWx5dGljcyA9ICgwLCBhbmFseXRpY3NfMS5nZXRBbmFseXRpY3MpKGFwcCk7XG59XG5jYXRjaCAoZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgJChcImJvZHlcIikudGV4dChcIkZhaWxlZCB0byBpbml0aWFsaXplIEZpcmViYXNlLiBBcmUgeW91IHN1cmUgeW91IGhhdmUgdGhlIGNvcnJlY3QgY29uZmlnIGluIHRoZSBmaXJlYmFzZS1jb25maWcudHMgZmlsZT9cIik7XG59XG4iLCJcInVzZSBzdHJpY3RcIjtcbi8vIHRoaXMgZmlsZSBzaG91bGQgYmUgY29uY2F0ZW5hdGVkIGF0IHRoZSB0b3Agb2YgdGhlIGxlZ2FjeSBqcyBmaWxlc1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5yZXF1aXJlKFwiLi4vc3R5bGVzL2luZGV4LnNjc3NcIik7XG5yZXF1aXJlKFwiLi9maXJlYmFzZVwiKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2RiXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL2NvbmZpZ1wiKSk7XG5jb25zdCBUZXN0U3RhdHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC90ZXN0LXN0YXRzXCIpKTtcbmNvbnN0IFJlcGxheSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0L3JlcGxheVwiKSk7XG5jb25zdCBUZXN0VGltZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC90ZXN0LXRpbWVyXCIpKTtcbmNvbnN0IFJlc3VsdCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0L3Jlc3VsdFwiKSk7XG5jb25zdCBUZXN0SW5wdXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC90ZXN0LWlucHV0XCIpKTtcbnJlcXVpcmUoXCIuL2NvbnRyb2xsZXJzL2FjY291bnQtY29udHJvbGxlclwiKTtcbmNvbnN0IGdsYXJzZXNfbW9kZV8xID0gcmVxdWlyZShcIi4vc3RhdGVzL2dsYXJzZXMtbW9kZVwiKTtcbnJlcXVpcmUoXCIuL3Rlc3QvY2Fwcy13YXJuaW5nXCIpO1xucmVxdWlyZShcIi4vcG9wdXBzL3N1cHBvcnQtcG9wdXBcIik7XG5yZXF1aXJlKFwiLi9wb3B1cHMvY29udGFjdC1wb3B1cFwiKTtcbnJlcXVpcmUoXCIuL3BvcHVwcy92ZXJzaW9uLXBvcHVwXCIpO1xucmVxdWlyZShcIi4vcG9wdXBzL2VkaXQtcHJlc2V0LXBvcHVwXCIpO1xucmVxdWlyZShcIi4vcG9wdXBzL3NpbXBsZS1wb3B1cHNcIik7XG5yZXF1aXJlKFwiLi9jb250cm9sbGVycy9pbnB1dC1jb250cm9sbGVyXCIpO1xucmVxdWlyZShcIi4vcmVhZHlcIik7XG5yZXF1aXJlKFwiLi91aVwiKTtcbnJlcXVpcmUoXCIuL3BhZ2VzL2Fib3V0XCIpO1xucmVxdWlyZShcIi4vcG9wdXBzL3BiLXRhYmxlcy1wb3B1cFwiKTtcbnJlcXVpcmUoXCIuL2VsZW1lbnRzL3Njcm9sbC10by10b3BcIik7XG5yZXF1aXJlKFwiLi9wb3B1cHMvbW9iaWxlLXRlc3QtY29uZmlnLXBvcHVwXCIpO1xucmVxdWlyZShcIi4vcG9wdXBzL2VkaXQtdGFncy1wb3B1cFwiKTtcbmNvbnN0IEFjY291bnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vcGFnZXMvYWNjb3VudFwiKSk7XG5jb25zdCBleHRlbmRlZEdsb2JhbCA9IGdsb2JhbDtcbmV4dGVuZGVkR2xvYmFsLnNuYXBzaG90ID0gREIuZ2V0U25hcHNob3Q7XG5leHRlbmRlZEdsb2JhbC5jb25maWcgPSBjb25maWdfMS5kZWZhdWx0O1xuZXh0ZW5kZWRHbG9iYWwudG9nZ2xlRmlsdGVyRGVidWcgPSBBY2NvdW50LnRvZ2dsZUZpbHRlckRlYnVnO1xuZXh0ZW5kZWRHbG9iYWwuZ2xhcnNlc01vZGUgPSBnbGFyc2VzX21vZGVfMS5lbmFibGU7XG5leHRlbmRlZEdsb2JhbC5zdGF0cyA9IFRlc3RTdGF0cy5nZXRTdGF0cztcbmV4dGVuZGVkR2xvYmFsLnJlcGxheSA9IFJlcGxheS5nZXRSZXBsYXlFeHBvcnQ7XG5leHRlbmRlZEdsb2JhbC5lbmFibGVUaW1lckRlYnVnID0gVGVzdFRpbWVyLmVuYWJsZVRpbWVyRGVidWc7XG5leHRlbmRlZEdsb2JhbC5nZXRUaW1lclN0YXRzID0gVGVzdFRpbWVyLmdldFRpbWVyU3RhdHM7XG5leHRlbmRlZEdsb2JhbC50b2dnbGVVbnNtb290aGVkUmF3ID0gUmVzdWx0LnRvZ2dsZVVuc21vb3RoZWRSYXc7XG5leHRlbmRlZEdsb2JhbC5lbmFibGVTcGFjaW5nRGVidWcgPSBUZXN0SW5wdXQuZW5hYmxlU3BhY2luZ0RlYnVnO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmRpc3BhdGNoID0gZXhwb3J0cy5zdWJzY3JpYmUgPSB2b2lkIDA7XG5jb25zdCBzdWJzY3JpYmVycyA9IFtdO1xuZnVuY3Rpb24gc3Vic2NyaWJlKGZuKSB7XG4gICAgc3Vic2NyaWJlcnMucHVzaChmbik7XG59XG5leHBvcnRzLnN1YnNjcmliZSA9IHN1YnNjcmliZTtcbmZ1bmN0aW9uIGRpc3BhdGNoKGtleSwgbmV3VmFsdWUsIG5vc2F2ZSwgcHJldmlvdXNWYWx1ZSwgZnVsbENvbmZpZykge1xuICAgIHN1YnNjcmliZXJzLmZvckVhY2goKGZuKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmbihrZXksIG5ld1ZhbHVlLCBub3NhdmUsIHByZXZpb3VzVmFsdWUsIGZ1bGxDb25maWcpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiQ29uZmlnIGV2ZW50IHN1YnNjcmliZXIgdGhyZXcgYW4gZXJyb3JcIik7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmRpc3BhdGNoID0gZGlzcGF0Y2g7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZGlzcGF0Y2ggPSBleHBvcnRzLnN1YnNjcmliZSA9IHZvaWQgMDtcbmNvbnN0IHN1YnNjcmliZXJzID0gW107XG5mdW5jdGlvbiBzdWJzY3JpYmUoZm4pIHtcbiAgICBzdWJzY3JpYmVycy5wdXNoKGZuKTtcbn1cbmV4cG9ydHMuc3Vic2NyaWJlID0gc3Vic2NyaWJlO1xuZnVuY3Rpb24gZGlzcGF0Y2gocHJldmlvdXNQYWdlLCBuZXdQYWdlKSB7XG4gICAgc3Vic2NyaWJlcnMuZm9yRWFjaCgoZm4pID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGZuKHByZXZpb3VzUGFnZSwgbmV3UGFnZSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJQYWdlIGNoYW5nZSBldmVudCBzdWJzY3JpYmVyIHRocmV3IGFuIGVycm9yXCIpO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5kaXNwYXRjaCA9IGRpc3BhdGNoO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmRpc3BhdGNoID0gZXhwb3J0cy5zdWJzY3JpYmUgPSB2b2lkIDA7XG5jb25zdCBzdWJzY3JpYmVycyA9IFtdO1xuZnVuY3Rpb24gc3Vic2NyaWJlKGZuKSB7XG4gICAgc3Vic2NyaWJlcnMucHVzaChmbik7XG59XG5leHBvcnRzLnN1YnNjcmliZSA9IHN1YnNjcmliZTtcbmZ1bmN0aW9uIGRpc3BhdGNoKCkge1xuICAgIHN1YnNjcmliZXJzLmZvckVhY2goKGZuKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmbigpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiUmVzZXQgcmVxdWVzdGVkIGV2ZW50IHN1YnNjcmliZXIgdGhyZXcgYW4gZXJyb3JcIik7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmRpc3BhdGNoID0gZGlzcGF0Y2g7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZGlzcGF0Y2ggPSBleHBvcnRzLnN1YnNjcmliZSA9IHZvaWQgMDtcbmNvbnN0IHN1YnNjcmliZXJzID0gW107XG5mdW5jdGlvbiBzdWJzY3JpYmUoZm4pIHtcbiAgICBzdWJzY3JpYmVycy5wdXNoKGZuKTtcbn1cbmV4cG9ydHMuc3Vic2NyaWJlID0gc3Vic2NyaWJlO1xuZnVuY3Rpb24gZGlzcGF0Y2gocmVzdWx0cykge1xuICAgIHN1YnNjcmliZXJzLmZvckVhY2goKGZuKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmbihyZXN1bHRzKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlBhZ2UgY2hhbmdlIGV2ZW50IHN1YnNjcmliZXIgdGhyZXcgYW4gZXJyb3JcIik7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmRpc3BhdGNoID0gZGlzcGF0Y2g7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZGlzcGF0Y2ggPSBleHBvcnRzLnN1YnNjcmliZSA9IHZvaWQgMDtcbmNvbnN0IHN1YnNjcmliZXJzID0gW107XG5mdW5jdGlvbiBzdWJzY3JpYmUoZm4pIHtcbiAgICBzdWJzY3JpYmVycy5wdXNoKGZuKTtcbn1cbmV4cG9ydHMuc3Vic2NyaWJlID0gc3Vic2NyaWJlO1xuZnVuY3Rpb24gZGlzcGF0Y2goa2V5LCB2YWx1ZSwgdmFsdWUyKSB7XG4gICAgc3Vic2NyaWJlcnMuZm9yRWFjaCgoZm4pID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGZuKGtleSwgdmFsdWUsIHZhbHVlMik7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJUaW1lciBldmVudCBzdWJzY3JpYmVyIHRocmV3IGFuIGVycm9yXCIpO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5kaXNwYXRjaCA9IGRpc3BhdGNoO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmRpc3BhdGNoID0gZXhwb3J0cy5zdWJzY3JpYmUgPSB2b2lkIDA7XG5jb25zdCBzdWJzY3JpYmVycyA9IFtdO1xuZnVuY3Rpb24gc3Vic2NyaWJlKGZuKSB7XG4gICAgc3Vic2NyaWJlcnMucHVzaChmbik7XG59XG5leHBvcnRzLnN1YnNjcmliZSA9IHN1YnNjcmliZTtcbmZ1bmN0aW9uIGRpc3BhdGNoKHdvcmQsIHR5cGVkQ29ycmVjdGx5LCBidXJzdCwgY3VycmVudFRlc3RXb3JkKSB7XG4gICAgc3Vic2NyaWJlcnMuZm9yRWFjaCgoZm4pID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGZuKHdvcmQsIHR5cGVkQ29ycmVjdGx5LCBidXJzdCwgY3VycmVudFRlc3RXb3JkKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIldvcmQgVHlwZWQgZXZlbnQgc3Vic2NyaWJlciB0aHJldyBhbiBlcnJvclwiKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZGlzcGF0Y2ggPSBkaXNwYXRjaDtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucGFnZSA9IGV4cG9ydHMuZmlsbCA9IGV4cG9ydHMucmVzZXQgPSB2b2lkIDA7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IHBhZ2VfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9wYWdlXCIpKTtcbmZ1bmN0aW9uIHJlc2V0KCkge1xuICAgICQoXCIucGFnZUFib3V0IC5jb250cmlidXRvcnNcIikuZW1wdHkoKTtcbiAgICAkKFwiLnBhZ2VBYm91dCAuc3VwcG9ydGVyc1wiKS5lbXB0eSgpO1xufVxuZXhwb3J0cy5yZXNldCA9IHJlc2V0O1xuZnVuY3Rpb24gZmlsbCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCBzdXBwb3J0ZXJzID0geWllbGQgTWlzYy5nZXRTdXBwb3J0ZXJzTGlzdCgpO1xuICAgICAgICBjb25zdCBjb250cmlidXRvcnMgPSB5aWVsZCBNaXNjLmdldENvbnRyaWJ1dG9yc0xpc3QoKTtcbiAgICAgICAgc3VwcG9ydGVycy5mb3JFYWNoKChzdXBwb3J0ZXIpID0+IHtcbiAgICAgICAgICAgICQoXCIucGFnZUFib3V0IC5zdXBwb3J0ZXJzXCIpLmFwcGVuZChgXG4gICAgICA8ZGl2PiR7c3VwcG9ydGVyfTwvZGl2PlxuICAgIGApO1xuICAgICAgICB9KTtcbiAgICAgICAgY29udHJpYnV0b3JzLmZvckVhY2goKGNvbnRyaWJ1dG9yKSA9PiB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBYm91dCAuY29udHJpYnV0b3JzXCIpLmFwcGVuZChgXG4gICAgICA8ZGl2PiR7Y29udHJpYnV0b3J9PC9kaXY+XG4gICAgYCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZXhwb3J0cy5maWxsID0gZmlsbDtcbmV4cG9ydHMucGFnZSA9IG5ldyBwYWdlXzEuZGVmYXVsdChcImFib3V0XCIsICQoXCIucGFnZS5wYWdlQWJvdXRcIiksIFwiL2Fib3V0XCIsICgpID0+IHtcbiAgICAvL1xufSwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgcmVzZXQoKTtcbn0pLCAoKSA9PiB7XG4gICAgZmlsbCgpO1xufSwgKCkgPT4ge1xuICAgIC8vXG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucGFnZSA9IGV4cG9ydHMudXBkYXRlID0gZXhwb3J0cy5zbW9vdGhIaXN0b3J5ID0gZXhwb3J0cy5yZXNldCA9IGV4cG9ydHMudG9nZ2xlRmlsdGVyRGVidWcgPSB2b2lkIDA7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgUmVzdWx0RmlsdGVycyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vYWNjb3VudC9yZXN1bHQtZmlsdGVyc1wiKSk7XG5jb25zdCBUaGVtZUNvbG9ycyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvdGhlbWUtY29sb3JzXCIpKTtcbmNvbnN0IENoYXJ0Q29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvY2hhcnQtY29udHJvbGxlclwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBNaW5pUmVzdWx0Q2hhcnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2FjY291bnQvbWluaS1yZXN1bHQtY2hhcnRcIikpO1xuY29uc3QgQWxsVGltZVN0YXRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9hY2NvdW50L2FsbC10aW1lLXN0YXRzXCIpKTtcbmNvbnN0IFBiVGFibGVzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9hY2NvdW50L3BiLXRhYmxlc1wiKSk7XG5jb25zdCBMb2FkaW5nUGFnZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9sb2FkaW5nXCIpKTtcbmNvbnN0IEZvY3VzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2ZvY3VzXCIpKTtcbmNvbnN0IFNpZ25PdXRCdXR0b24gPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2FjY291bnQvc2lnbi1vdXQtYnV0dG9uXCIpKTtcbmNvbnN0IFRvZGF5VHJhY2tlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90b2RheS10cmFja2VyXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgcGFnZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL3BhZ2VcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBBY3RpdmVQYWdlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvYWN0aXZlLXBhZ2VcIikpO1xuY29uc3QgZm9ybWF0XzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImRhdGUtZm5zL2Zvcm1hdFwiKSk7XG5sZXQgZmlsdGVyRGVidWcgPSBmYWxzZTtcbi8vdG9nZ2xlIGZpbHRlcmRlYnVnXG5mdW5jdGlvbiB0b2dnbGVGaWx0ZXJEZWJ1ZygpIHtcbiAgICBmaWx0ZXJEZWJ1ZyA9ICFmaWx0ZXJEZWJ1ZztcbiAgICBpZiAoZmlsdGVyRGVidWcpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJmaWx0ZXJEZWJ1ZyBpcyBvblwiKTtcbiAgICB9XG59XG5leHBvcnRzLnRvZ2dsZUZpbHRlckRlYnVnID0gdG9nZ2xlRmlsdGVyRGVidWc7XG5sZXQgZmlsdGVyZWRSZXN1bHRzID0gW107XG5sZXQgdmlzaWJsZVRhYmxlTGluZXMgPSAwO1xuZnVuY3Rpb24gbG9hZE1vcmVMaW5lcyhsaW5lSW5kZXgpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGlmIChmaWx0ZXJlZFJlc3VsdHMgPT0gW10gfHwgZmlsdGVyZWRSZXN1bHRzLmxlbmd0aCA9PSAwKVxuICAgICAgICByZXR1cm47XG4gICAgbGV0IG5ld1Zpc2libGVMaW5lcztcbiAgICBpZiAobGluZUluZGV4ICYmIGxpbmVJbmRleCA+IHZpc2libGVUYWJsZUxpbmVzKSB7XG4gICAgICAgIG5ld1Zpc2libGVMaW5lcyA9IE1hdGguY2VpbChsaW5lSW5kZXggLyAxMCkgKiAxMDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG5ld1Zpc2libGVMaW5lcyA9IHZpc2libGVUYWJsZUxpbmVzICsgMTA7XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSB2aXNpYmxlVGFibGVMaW5lczsgaSA8IG5ld1Zpc2libGVMaW5lczsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGZpbHRlcmVkUmVzdWx0c1tpXTtcbiAgICAgICAgaWYgKCFyZXN1bHQpXG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgbGV0IGRpZmYgPSByZXN1bHQuZGlmZmljdWx0eTtcbiAgICAgICAgaWYgKGRpZmYgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBkaWZmID0gXCJub3JtYWxcIjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgcmF3O1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmF3ID0gY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNXG4gICAgICAgICAgICAgICAgPyAocmVzdWx0LnJhd1dwbSAqIDUpLnRvRml4ZWQoMilcbiAgICAgICAgICAgICAgICA6IHJlc3VsdC5yYXdXcG0udG9GaXhlZCgyKTtcbiAgICAgICAgICAgIGlmIChyYXcgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmF3ID0gXCItXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJhdyA9IFwiLVwiO1xuICAgICAgICB9XG4gICAgICAgIGxldCBpY29ucyA9IGA8c3BhbiBhcmlhLWxhYmVsPVwiJHsoX2EgPSByZXN1bHQubGFuZ3VhZ2UpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZXBsYWNlKFwiX1wiLCBcIiBcIil9XCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtZ2xvYmUtYW1lcmljYXNcIj48L2k+PC9zcGFuPmA7XG4gICAgICAgIGlmIChkaWZmID09PSBcIm5vcm1hbFwiKSB7XG4gICAgICAgICAgICBpY29ucyArPSBgPHNwYW4gYXJpYS1sYWJlbD1cIiR7cmVzdWx0LmRpZmZpY3VsdHl9XCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXIgZmEtZncgZmEtc3RhclwiPjwvaT48L3NwYW4+YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChkaWZmID09PSBcImV4cGVydFwiKSB7XG4gICAgICAgICAgICBpY29ucyArPSBgPHNwYW4gYXJpYS1sYWJlbD1cIiR7cmVzdWx0LmRpZmZpY3VsdHl9XCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtc3Rhci1oYWxmLWFsdFwiPjwvaT48L3NwYW4+YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChkaWZmID09PSBcIm1hc3RlclwiKSB7XG4gICAgICAgICAgICBpY29ucyArPSBgPHNwYW4gYXJpYS1sYWJlbD1cIiR7cmVzdWx0LmRpZmZpY3VsdHl9XCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtc3RhclwiPjwvaT48L3NwYW4+YDtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzdWx0LnB1bmN0dWF0aW9uKSB7XG4gICAgICAgICAgICBpY29ucyArPSBgPHNwYW4gYXJpYS1sYWJlbD1cInB1bmN0dWF0aW9uXCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCIgc3R5bGU9XCJmb250LXdlaWdodDo5MDBcIj4hPzwvc3Bhbj5gO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXN1bHQubnVtYmVycykge1xuICAgICAgICAgICAgaWNvbnMgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCJudW1iZXJzXCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCIgc3R5bGU9XCJmb250LXdlaWdodDo5MDBcIj4xNTwvc3Bhbj5gO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXN1bHQuYmxpbmRNb2RlKSB7XG4gICAgICAgICAgICBpY29ucyArPSBgPHNwYW4gYXJpYS1sYWJlbD1cImJsaW5kIG1vZGVcIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1leWUtc2xhc2hcIj48L2k+PC9zcGFuPmA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlc3VsdC5sYXp5TW9kZSkge1xuICAgICAgICAgICAgaWNvbnMgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCJsYXp5IG1vZGVcIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1jb3VjaFwiPjwvaT48L3NwYW4+YDtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzdWx0LmZ1bmJveCAhPT0gXCJub25lXCIgJiYgcmVzdWx0LmZ1bmJveCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpY29ucyArPSBgPHNwYW4gYXJpYS1sYWJlbD1cIiR7cmVzdWx0LmZ1bmJveC5yZXBsYWNlKC9fL2csIFwiIFwiKX1cIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1nYW1lcGFkXCI+PC9pPjwvc3Bhbj5gO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXN1bHQuY2hhcnREYXRhID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGljb25zICs9IGA8c3BhbiBjbGFzcz1cIm1pbmlSZXN1bHRDaGFydEJ1dHRvblwiIGFyaWEtbGFiZWw9XCJObyBjaGFydCBkYXRhIGZvdW5kXCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtY2hhcnQtbGluZVwiPjwvaT48L3NwYW4+YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZXN1bHQuY2hhcnREYXRhID09PSBcInRvb2xvbmdcIikge1xuICAgICAgICAgICAgaWNvbnMgKz0gYDxzcGFuIGNsYXNzPVwibWluaVJlc3VsdENoYXJ0QnV0dG9uXCIgYXJpYS1sYWJlbD1cIkNoYXJ0IGhpc3RvcnkgaXMgbm90IGF2YWlsYWJsZSBmb3IgbG9uZyB0ZXN0c1wiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWNoYXJ0LWxpbmVcIj48L2k+PC9zcGFuPmA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpY29ucyArPSBgPHNwYW4gY2xhc3M9XCJtaW5pUmVzdWx0Q2hhcnRCdXR0b25cIiBhcmlhLWxhYmVsPVwiVmlldyBncmFwaFwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiIGZpbHRlcmVkUmVzdWx0c0lkPVwiJHtpfVwiIHN0eWxlPVwib3BhY2l0eTogMVwiPjxpIGNsYXNzPVwiZmFzIGZhLWNoYXJ0LWxpbmVcIj48L2k+PC9zcGFuPmA7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHRhZ05hbWVzID0gXCJcIjtcbiAgICAgICAgaWYgKHJlc3VsdC50YWdzICE9PSB1bmRlZmluZWQgJiYgcmVzdWx0LnRhZ3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmVzdWx0LnRhZ3MuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIChfYSA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHNuYXB0YWcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhZyA9PT0gc25hcHRhZy5faWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ05hbWVzICs9IHNuYXB0YWcubmFtZSArIFwiLCBcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0YWdOYW1lcyA9IHRhZ05hbWVzLnN1YnN0cmluZygwLCB0YWdOYW1lcy5sZW5ndGggLSAyKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgcmVzdGFncztcbiAgICAgICAgaWYgKHJlc3VsdC50YWdzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJlc3RhZ3MgPSBcIltdXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN0YWdzID0gSlNPTi5zdHJpbmdpZnkocmVzdWx0LnRhZ3MpO1xuICAgICAgICB9XG4gICAgICAgIGxldCB0YWdJY29ucyA9IGA8c3BhbiBpZD1cInJlc3VsdEVkaXRUYWdzXCIgcmVzdWx0SWQ9XCIke3Jlc3VsdC5faWR9XCIgdGFncz0nJHtyZXN0YWdzfScgYXJpYS1sYWJlbD1cIm5vIHRhZ3NcIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIiBzdHlsZT1cIm9wYWNpdHk6IC4yNVwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXRhZ1wiPjwvaT48L3NwYW4+YDtcbiAgICAgICAgaWYgKHRhZ05hbWVzICE9PSBcIlwiKSB7XG4gICAgICAgICAgICBpZiAocmVzdWx0LnRhZ3MgIT09IHVuZGVmaW5lZCAmJiByZXN1bHQudGFncy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgdGFnSWNvbnMgPSBgPHNwYW4gaWQ9XCJyZXN1bHRFZGl0VGFnc1wiIHJlc3VsdElkPVwiJHtyZXN1bHQuX2lkfVwiIHRhZ3M9JyR7cmVzdGFnc30nIGFyaWEtbGFiZWw9XCIke3RhZ05hbWVzfVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXRhZ3NcIj48L2k+PC9zcGFuPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0YWdJY29ucyA9IGA8c3BhbiBpZD1cInJlc3VsdEVkaXRUYWdzXCIgcmVzdWx0SWQ9XCIke3Jlc3VsdC5faWR9XCIgdGFncz0nJHtyZXN0YWdzfScgYXJpYS1sYWJlbD1cIiR7dGFnTmFtZXN9XCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtdGFnXCI+PC9pPjwvc3Bhbj5gO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGxldCBjb25zaXN0ZW5jeSA9IFwiLVwiO1xuICAgICAgICBpZiAocmVzdWx0LmNvbnNpc3RlbmN5KSB7XG4gICAgICAgICAgICBjb25zaXN0ZW5jeSA9IHJlc3VsdC5jb25zaXN0ZW5jeS50b0ZpeGVkKDIpICsgXCIlXCI7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHBiID0gKF9iID0gcmVzdWx0LmlzUGIpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50b1N0cmluZygpO1xuICAgICAgICBpZiAocGIpIHtcbiAgICAgICAgICAgIHBiID0gJzxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWNyb3duXCI+PC9pPic7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBwYiA9IFwiXCI7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGNoYXJTdGF0cyA9IFwiLVwiO1xuICAgICAgICBpZiAocmVzdWx0LmNoYXJTdGF0cykge1xuICAgICAgICAgICAgY2hhclN0YXRzID0gcmVzdWx0LmNoYXJTdGF0cy5qb2luKFwiL1wiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNoYXJTdGF0cyA9IHJlc3VsdC5jb3JyZWN0Q2hhcnMgKyBcIi9cIiArIHJlc3VsdC5pbmNvcnJlY3RDaGFycyArIFwiLy0vLVwiO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShyZXN1bHQudGltZXN0YW1wKTtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuaGlzdG9yeSB0YWJsZSB0Ym9keVwiKS5hcHBlbmQoYFxuICAgIDx0ciBjbGFzcz1cInJlc3VsdFJvd1wiIGlkPVwicmVzdWx0LSR7aX1cIj5cbiAgICA8dGQ+JHtwYn08L3RkPlxuICAgIDx0ZD4keyhjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0gPyByZXN1bHQud3BtICogNSA6IHJlc3VsdC53cG0pLnRvRml4ZWQoMil9PC90ZD5cbiAgICA8dGQ+JHtyYXd9PC90ZD5cbiAgICA8dGQ+JHtyZXN1bHQuYWNjLnRvRml4ZWQoMil9JTwvdGQ+XG4gICAgPHRkPiR7Y29uc2lzdGVuY3l9PC90ZD5cbiAgICA8dGQ+JHtjaGFyU3RhdHN9PC90ZD5cbiAgICA8dGQ+JHtyZXN1bHQubW9kZX0gJHtyZXN1bHQubW9kZTJ9PC90ZD5cbiAgICA8dGQgY2xhc3M9XCJpbmZvSWNvbnNcIj4ke2ljb25zfTwvdGQ+XG4gICAgPHRkPiR7dGFnSWNvbnN9PC90ZD5cbiAgICA8dGQ+JHsoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJkZCBNTU0geXl5eVwiKX08YnI+XG4gICAgJHsoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJISDptbVwiKX1cbiAgICA8L3RkPlxuICAgIDwvdHI+YCk7XG4gICAgfVxuICAgIHZpc2libGVUYWJsZUxpbmVzID0gbmV3VmlzaWJsZUxpbmVzO1xuICAgIGlmICh2aXNpYmxlVGFibGVMaW5lcyA+PSBmaWx0ZXJlZFJlc3VsdHMubGVuZ3RoKSB7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmxvYWRNb3JlQnV0dG9uXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAubG9hZE1vcmVCdXR0b25cIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxufVxuZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgJChcIi5wYWdlQWNjb3VudCAuaGlzdG9yeSB0YWJsZSB0Ym9keVwiKS5lbXB0eSgpO1xuICAgIENoYXJ0Q29udHJvbGxlci5hY2NvdW50QWN0aXZpdHkuZGF0YS5kYXRhc2V0c1swXS5kYXRhID0gW107XG4gICAgQ2hhcnRDb250cm9sbGVyLmFjY291bnRBY3Rpdml0eS5kYXRhLmRhdGFzZXRzWzFdLmRhdGEgPSBbXTtcbiAgICBDaGFydENvbnRyb2xsZXIuYWNjb3VudEhpc3RvcnkuZGF0YS5kYXRhc2V0c1swXS5kYXRhID0gW107XG4gICAgQ2hhcnRDb250cm9sbGVyLmFjY291bnRIaXN0b3J5LmRhdGEuZGF0YXNldHNbMV0uZGF0YSA9IFtdO1xuICAgIENoYXJ0Q29udHJvbGxlci5hY2NvdW50QWN0aXZpdHkudXBkYXRlQ29sb3JzKCk7XG4gICAgQ2hhcnRDb250cm9sbGVyLmFjY291bnRIaXN0b3J5LnVwZGF0ZUNvbG9ycygpO1xufVxuZXhwb3J0cy5yZXNldCA9IHJlc2V0O1xubGV0IHRvdGFsU2Vjb25kc0ZpbHRlcmVkID0gMDtcbmxldCBjaGFydERhdGEgPSBbXTtcbmxldCBhY2NDaGFydERhdGEgPSBbXTtcbmZ1bmN0aW9uIHNtb290aEhpc3RvcnkoZmFjdG9yKSB7XG4gICAgY29uc3Qgc21vb3RoZWRXcG1EYXRhID0gTWlzYy5zbW9vdGgoY2hhcnREYXRhLm1hcCgoYSkgPT4gYS55KSwgZmFjdG9yKTtcbiAgICBjb25zdCBzbW9vdGhlZEFjY0RhdGEgPSBNaXNjLnNtb290aChhY2NDaGFydERhdGEubWFwKChhKSA9PiBhLnkpLCBmYWN0b3IpO1xuICAgIGNvbnN0IGNoYXJ0RGF0YTIgPSBjaGFydERhdGEubWFwKChhLCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IHJldCA9IE9iamVjdC5hc3NpZ24oe30sIGEpO1xuICAgICAgICByZXQueSA9IHNtb290aGVkV3BtRGF0YVtpXTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9KTtcbiAgICBjb25zdCBhY2NDaGFydERhdGEyID0gYWNjQ2hhcnREYXRhLm1hcCgoYSwgaSkgPT4ge1xuICAgICAgICBjb25zdCByZXQgPSBPYmplY3QuYXNzaWduKHt9LCBhKTtcbiAgICAgICAgcmV0LnkgPSBzbW9vdGhlZEFjY0RhdGFbaV07XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfSk7XG4gICAgQ2hhcnRDb250cm9sbGVyLmFjY291bnRIaXN0b3J5LmRhdGEuZGF0YXNldHNbMF0uZGF0YSA9IGNoYXJ0RGF0YTI7XG4gICAgQ2hhcnRDb250cm9sbGVyLmFjY291bnRIaXN0b3J5LmRhdGEuZGF0YXNldHNbMV0uZGF0YSA9IGFjY0NoYXJ0RGF0YTI7XG4gICAgaWYgKGNoYXJ0RGF0YTIubGVuZ3RoIHx8IGFjY0NoYXJ0RGF0YTIubGVuZ3RoKSB7XG4gICAgICAgIENoYXJ0Q29udHJvbGxlci5hY2NvdW50SGlzdG9yeS51cGRhdGUoKTtcbiAgICB9XG59XG5leHBvcnRzLnNtb290aEhpc3RvcnkgPSBzbW9vdGhIaXN0b3J5O1xuZnVuY3Rpb24gYXBwbHlIaXN0b3J5U21vb3RoaW5nKCkge1xuICAgIGNvbnN0IHNtb290aGluZyA9ICQoXCIucGFnZUFjY291bnQgLmNvbnRlbnQgLmJlbG93IC5zbW9vdGhpbmcgaW5wdXRcIikudmFsKCk7XG4gICAgJChcIi5wYWdlQWNjb3VudCAuY29udGVudCAuYmVsb3cgLnNtb290aGluZyAudmFsdWVcIikudGV4dChzbW9vdGhpbmcpO1xuICAgIHNtb290aEhpc3RvcnkocGFyc2VJbnQoc21vb3RoaW5nKSk7XG59XG5mdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgZnVuY3Rpb24gY29udCgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBMb2FkaW5nUGFnZS51cGRhdGVUZXh0KFwiRGlzcGxheWluZyBzdGF0cy4uLlwiKTtcbiAgICAgICAgTG9hZGluZ1BhZ2UudXBkYXRlQmFyKDEwMCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwidXBkYXRpbmcgYWNjb3VudCBwYWdlXCIpO1xuICAgICAgICBUaGVtZUNvbG9ycy51cGRhdGUoKTtcbiAgICAgICAgQ2hhcnRDb250cm9sbGVyLmFjY291bnRIaXN0b3J5LnVwZGF0ZUNvbG9ycygpO1xuICAgICAgICBDaGFydENvbnRyb2xsZXIuYWNjb3VudEFjdGl2aXR5LnVwZGF0ZUNvbG9ycygpO1xuICAgICAgICBBbGxUaW1lU3RhdHMudXBkYXRlKCk7XG4gICAgICAgIFBiVGFibGVzLnVwZGF0ZSgpO1xuICAgICAgICBjaGFydERhdGEgPSBbXTtcbiAgICAgICAgYWNjQ2hhcnREYXRhID0gW107XG4gICAgICAgIGNvbnN0IHdwbUNoYXJ0RGF0YSA9IFtdO1xuICAgICAgICB2aXNpYmxlVGFibGVMaW5lcyA9IDA7XG4gICAgICAgIGxldCB0b3BXcG0gPSAwO1xuICAgICAgICBsZXQgdG9wTW9kZSA9IFwiXCI7XG4gICAgICAgIGxldCB0ZXN0UmVzdGFydHMgPSAwO1xuICAgICAgICBsZXQgdG90YWxXcG0gPSAwO1xuICAgICAgICBsZXQgdGVzdENvdW50ID0gMDtcbiAgICAgICAgbGV0IGxhc3QxMCA9IDA7XG4gICAgICAgIGxldCB3cG1MYXN0MTB0b3RhbCA9IDA7XG4gICAgICAgIGxldCB0b3BBY2MgPSAwO1xuICAgICAgICBsZXQgdG90YWxBY2MgPSAwO1xuICAgICAgICBsZXQgdG90YWxBY2MxMCA9IDA7XG4gICAgICAgIGNvbnN0IHJhd1dwbSA9IHtcbiAgICAgICAgICAgIHRvdGFsOiAwLFxuICAgICAgICAgICAgY291bnQ6IDAsXG4gICAgICAgICAgICBsYXN0MTBUb3RhbDogMCxcbiAgICAgICAgICAgIGxhc3QxMENvdW50OiAwLFxuICAgICAgICAgICAgbWF4OiAwLFxuICAgICAgICB9O1xuICAgICAgICAvLyBsZXQgdG90YWxTZWNvbmRzID0gMDtcbiAgICAgICAgdG90YWxTZWNvbmRzRmlsdGVyZWQgPSAwO1xuICAgICAgICBsZXQgdG9wQ29ucyA9IDA7XG4gICAgICAgIGxldCB0b3RhbENvbnMgPSAwO1xuICAgICAgICBsZXQgdG90YWxDb25zMTAgPSAwO1xuICAgICAgICBsZXQgY29uc0NvdW50ID0gMDtcbiAgICAgICAgY29uc3QgYWN0aXZpdHlDaGFydERhdGEgPSB7fTtcbiAgICAgICAgZmlsdGVyZWRSZXN1bHRzID0gW107XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmhpc3RvcnkgdGFibGUgdGJvZHlcIikuZW1wdHkoKTtcbiAgICAgICAgKF9hID0gREIuZ2V0U25hcHNob3QoKS5yZXN1bHRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAvLyB0b3RhbFNlY29uZHMgKz0gdHQ7XG4gICAgICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lO1xuICAgICAgICAgICAgLy9hcHBseSBmaWx0ZXJzXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGxldCByZXNkaWZmID0gcmVzdWx0LmRpZmZpY3VsdHk7XG4gICAgICAgICAgICAgICAgaWYgKHJlc2RpZmYgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc2RpZmYgPSBcIm5vcm1hbFwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIVJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwiZGlmZmljdWx0eVwiLCByZXNkaWZmKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyRGVidWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBza2lwcGluZyByZXN1bHQgZHVlIHRvIGRpZmZpY3VsdHkgZmlsdGVyYCwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJtb2RlXCIsIHJlc3VsdC5tb2RlKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyRGVidWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBza2lwcGluZyByZXN1bHQgZHVlIHRvIG1vZGUgZmlsdGVyYCwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubW9kZSA9PSBcInRpbWVcIikge1xuICAgICAgICAgICAgICAgICAgICBsZXQgdGltZWZpbHRlciA9IFwiY3VzdG9tXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChbMTUsIDMwLCA2MCwgMTIwXS5pbmNsdWRlcyhwYXJzZUludChyZXN1bHQubW9kZTIpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGltZWZpbHRlciA9IHJlc3VsdC5tb2RlMjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoIVJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwidGltZVwiLCB0aW1lZmlsdGVyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlckRlYnVnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYHNraXBwaW5nIHJlc3VsdCBkdWUgdG8gdGltZSBmaWx0ZXJgLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlc3VsdC5tb2RlID09IFwid29yZHNcIikge1xuICAgICAgICAgICAgICAgICAgICBsZXQgd29yZGZpbHRlciA9IFwiY3VzdG9tXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChbMTAsIDI1LCA1MCwgMTAwLCAyMDBdLmluY2x1ZGVzKHBhcnNlSW50KHJlc3VsdC5tb2RlMikpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JkZmlsdGVyID0gcmVzdWx0Lm1vZGUyO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJ3b3Jkc1wiLCB3b3JkZmlsdGVyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlckRlYnVnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYHNraXBwaW5nIHJlc3VsdCBkdWUgdG8gd29yZCBmaWx0ZXJgLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQucXVvdGVMZW5ndGggIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgZmlsdGVyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnF1b3RlTGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIgPSBcInNob3J0XCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0LnF1b3RlTGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIgPSBcIm1lZGl1bVwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlc3VsdC5xdW90ZUxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyID0gXCJsb25nXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0LnF1b3RlTGVuZ3RoID09PSAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIgPSBcInRoaWNjXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlciAhPT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAhUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJxdW90ZUxlbmd0aFwiLCBmaWx0ZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyRGVidWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgc2tpcHBpbmcgcmVzdWx0IGR1ZSB0byBxdW90ZUxlbmd0aCBmaWx0ZXJgLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxldCBsYW5nRmlsdGVyID0gUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJsYW5ndWFnZVwiLCAoX2EgPSByZXN1bHQubGFuZ3VhZ2UpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiZW5nbGlzaFwiKTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lmxhbmd1YWdlID09PSBcImVuZ2xpc2hfZXhwYW5kZWRcIiAmJlxuICAgICAgICAgICAgICAgICAgICBSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcImxhbmd1YWdlXCIsIFwiZW5nbGlzaF8xa1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBsYW5nRmlsdGVyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFsYW5nRmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJEZWJ1Zykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYHNraXBwaW5nIHJlc3VsdCBkdWUgdG8gbGFuZ3VhZ2UgZmlsdGVyYCwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxldCBwdW5jZmlsdGVyID0gXCJvZmZcIjtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnB1bmN0dWF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHB1bmNmaWx0ZXIgPSBcIm9uXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJwdW5jdHVhdGlvblwiLCBwdW5jZmlsdGVyKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyRGVidWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBza2lwcGluZyByZXN1bHQgZHVlIHRvIHB1bmN0dWF0aW9uIGZpbHRlcmAsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsZXQgbnVtZmlsdGVyID0gXCJvZmZcIjtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lm51bWJlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgbnVtZmlsdGVyID0gXCJvblwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIVJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwibnVtYmVyc1wiLCBudW1maWx0ZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJEZWJ1Zykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYHNraXBwaW5nIHJlc3VsdCBkdWUgdG8gbnVtYmVycyBmaWx0ZXJgLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5mdW5ib3ggPT09IFwibm9uZVwiIHx8IHJlc3VsdC5mdW5ib3ggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIVJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwiZnVuYm94XCIsIFwibm9uZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlckRlYnVnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYHNraXBwaW5nIHJlc3VsdCBkdWUgdG8gZnVuYm94IGZpbHRlcmAsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJmdW5ib3hcIiwgcmVzdWx0LmZ1bmJveCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJEZWJ1Zykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBza2lwcGluZyByZXN1bHQgZHVlIHRvIGZ1bmJveCBmaWx0ZXJgLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxldCB0YWdIaWRlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnRhZ3MgPT09IHVuZGVmaW5lZCB8fCByZXN1bHQudGFncy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy9ubyB0YWdzLCBzaG93IHdoZW4gbm8gdGFnIGlzIGVuYWJsZWRcbiAgICAgICAgICAgICAgICAgICAgaWYgKCgoX2IgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5sZW5ndGgpIHx8IDAgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJ0YWdzXCIsIFwibm9uZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdIaWRlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YWdIaWRlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vdGFncyBleGlzdFxuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWxpZFRhZ3MgPSAoX2MgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5tYXAoKHQpID0+IHQuX2lkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbGlkVGFncyA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQudGFncy5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vY2hlY2sgaWYgaSBldmVuIG5lZWQgdG8gY2hlY2sgdGFncyBhbnltb3JlXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRhZ0hpZGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9jaGVjayBpZiB0YWcgaXMgdmFsaWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWxpZFRhZ3MgPT09IG51bGwgfHwgdmFsaWRUYWdzID09PSB2b2lkIDAgPyB2b2lkIDAgOiB2YWxpZFRhZ3MuaW5jbHVkZXModGFnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdGFnIHZhbGlkLCBjaGVjayBpZiBmaWx0ZXIgaXMgb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJ0YWdzXCIsIHRhZykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ0hpZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdGFnIG5vdCBmb3VuZCBpbiB2YWxpZCB0YWdzLCBtZWFuaW5nIHByb2JhYmx5IGRlbGV0ZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJ0YWdzXCIsIFwibm9uZVwiKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnSGlkZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRhZ0hpZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlckRlYnVnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgc2tpcHBpbmcgcmVzdWx0IGR1ZSB0byB0YWcgZmlsdGVyYCwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVTaW5jZVRlc3QgPSBNYXRoLmFicyhyZXN1bHQudGltZXN0YW1wIC0gRGF0ZS5ub3coKSkgLyAxMDAwO1xuICAgICAgICAgICAgICAgIGxldCBkYXRlaGlkZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKFJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwiZGF0ZVwiLCBcImFsbFwiKSB8fFxuICAgICAgICAgICAgICAgICAgICAoUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJkYXRlXCIsIFwibGFzdF9kYXlcIikgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTaW5jZVRlc3QgPD0gODY0MDApIHx8XG4gICAgICAgICAgICAgICAgICAgIChSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcImRhdGVcIiwgXCJsYXN0X3dlZWtcIikgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTaW5jZVRlc3QgPD0gNjA0ODAwKSB8fFxuICAgICAgICAgICAgICAgICAgICAoUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJkYXRlXCIsIFwibGFzdF9tb250aFwiKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZVNpbmNlVGVzdCA8PSAyNTkyMDAwKSB8fFxuICAgICAgICAgICAgICAgICAgICAoUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJkYXRlXCIsIFwibGFzdF8zbW9udGhzXCIpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lU2luY2VUZXN0IDw9IDc3NzYwMDApKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGVoaWRlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChkYXRlaGlkZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyRGVidWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBza2lwcGluZyByZXN1bHQgZHVlIHRvIGRhdGUgZmlsdGVyYCwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZpbHRlcmVkUmVzdWx0cy5wdXNoKHJlc3VsdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiU29tZXRoaW5nIHdlbnQgd3Jvbmcgd2hlbiBmaWx0ZXJpbmcuIFJlc2V0dGluZyBmaWx0ZXJzLlwiLCAwKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgICAgICAgUmVzdWx0RmlsdGVycy5yZXNldCgpO1xuICAgICAgICAgICAgICAgIFJlc3VsdEZpbHRlcnMudXBkYXRlQWN0aXZlKCk7XG4gICAgICAgICAgICAgICAgdXBkYXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL2ZpbHRlcnMgZG9uZVxuICAgICAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdERhdGUgPSBuZXcgRGF0ZShyZXN1bHQudGltZXN0YW1wKTtcbiAgICAgICAgICAgIHJlc3VsdERhdGUuc2V0U2Vjb25kcygwKTtcbiAgICAgICAgICAgIHJlc3VsdERhdGUuc2V0TWludXRlcygwKTtcbiAgICAgICAgICAgIHJlc3VsdERhdGUuc2V0SG91cnMoMCk7XG4gICAgICAgICAgICByZXN1bHREYXRlLnNldE1pbGxpc2Vjb25kcygwKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdFRpbWVzdGFtcCA9IHJlc3VsdERhdGUuZ2V0VGltZSgpO1xuICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGFjdGl2aXR5Q2hhcnREYXRhKS5pbmNsdWRlcyhTdHJpbmcocmVzdWx0VGltZXN0YW1wKSkpIHtcbiAgICAgICAgICAgICAgICBhY3Rpdml0eUNoYXJ0RGF0YVtyZXN1bHRUaW1lc3RhbXBdLmFtb3VudCsrO1xuICAgICAgICAgICAgICAgIGFjdGl2aXR5Q2hhcnREYXRhW3Jlc3VsdFRpbWVzdGFtcF0udGltZSArPVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQudGVzdER1cmF0aW9uICtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5pbmNvbXBsZXRlVGVzdFNlY29uZHMgLVxuICAgICAgICAgICAgICAgICAgICAgICAgKChfZCA9IHJlc3VsdC5hZmtEdXJhdGlvbikgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogMCk7XG4gICAgICAgICAgICAgICAgYWN0aXZpdHlDaGFydERhdGFbcmVzdWx0VGltZXN0YW1wXS50b3RhbFdwbSArPSByZXN1bHQud3BtO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgYWN0aXZpdHlDaGFydERhdGFbcmVzdWx0VGltZXN0YW1wXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgYW1vdW50OiAxLFxuICAgICAgICAgICAgICAgICAgICB0aW1lOiByZXN1bHQudGVzdER1cmF0aW9uICtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5pbmNvbXBsZXRlVGVzdFNlY29uZHMgLVxuICAgICAgICAgICAgICAgICAgICAgICAgKChfZSA9IHJlc3VsdC5hZmtEdXJhdGlvbikgIT09IG51bGwgJiYgX2UgIT09IHZvaWQgMCA/IF9lIDogMCksXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsV3BtOiByZXN1bHQud3BtLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgdHQgPSAwO1xuICAgICAgICAgICAgaWYgKHJlc3VsdC50ZXN0RHVyYXRpb24gPT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICAgICAgcmVzdWx0Lm1vZGUyICE9PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICAgICAgcmVzdWx0Lm1vZGUyICE9PSBcInplblwiKSB7XG4gICAgICAgICAgICAgICAgLy90ZXN0IGZpbmlzaGVkIGJlZm9yZSB0ZXN0RHVyYXRpb24gZmllbGQgd2FzIGludHJvZHVjZWQgLSBlc3RpbWF0ZVxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubW9kZSA9PSBcInRpbWVcIikge1xuICAgICAgICAgICAgICAgICAgICB0dCA9IHJlc3VsdC5tb2RlMjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0Lm1vZGUgPT0gXCJ3b3Jkc1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIHR0ID0gKHJlc3VsdC5tb2RlMiAvIHJlc3VsdC53cG0pICogNjA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdHQgPSBwYXJzZUZsb2F0KHJlc3VsdC50ZXN0RHVyYXRpb24pOyAvL2xlZ2FjeSByZXN1bHRzIGNvdWxkIGhhdmUgYSBzdHJpbmcgaGVyZVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJlc3VsdC5pbmNvbXBsZXRlVGVzdFNlY29uZHMgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdHQgKz0gcmVzdWx0LmluY29tcGxldGVUZXN0U2Vjb25kcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHJlc3VsdC5yZXN0YXJ0Q291bnQgIT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICAgICAgcmVzdWx0LnJlc3RhcnRDb3VudCA+IDApIHtcbiAgICAgICAgICAgICAgICB0dCArPSAodHQgLyA0KSAqIHJlc3VsdC5yZXN0YXJ0Q291bnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBpZiAocmVzdWx0LmluY29tcGxldGVUZXN0U2Vjb25kcyAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIC8vICAgdHQgKz0gcmVzdWx0LmluY29tcGxldGVUZXN0U2Vjb25kcztcbiAgICAgICAgICAgIC8vIH0gZWxzZSBpZiAocmVzdWx0LnJlc3RhcnRDb3VudCAhPSB1bmRlZmluZWQgJiYgcmVzdWx0LnJlc3RhcnRDb3VudCA+IDApIHtcbiAgICAgICAgICAgIC8vICAgdHQgKz0gKHR0IC8gNCkgKiByZXN1bHQucmVzdGFydENvdW50O1xuICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgdG90YWxTZWNvbmRzRmlsdGVyZWQgKz0gdHQ7XG4gICAgICAgICAgICBpZiAobGFzdDEwIDwgMTApIHtcbiAgICAgICAgICAgICAgICBsYXN0MTArKztcbiAgICAgICAgICAgICAgICB3cG1MYXN0MTB0b3RhbCArPSByZXN1bHQud3BtO1xuICAgICAgICAgICAgICAgIHRvdGFsQWNjMTAgKz0gcmVzdWx0LmFjYztcbiAgICAgICAgICAgICAgICByZXN1bHQuY29uc2lzdGVuY3kgIT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICA/ICh0b3RhbENvbnMxMCArPSByZXN1bHQuY29uc2lzdGVuY3kpXG4gICAgICAgICAgICAgICAgICAgIDogMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRlc3RDb3VudCsrO1xuICAgICAgICAgICAgaWYgKHJlc3VsdC5jb25zaXN0ZW5jeSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgY29uc0NvdW50Kys7XG4gICAgICAgICAgICAgICAgdG90YWxDb25zICs9IHJlc3VsdC5jb25zaXN0ZW5jeTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmNvbnNpc3RlbmN5ID4gdG9wQ29ucykge1xuICAgICAgICAgICAgICAgICAgICB0b3BDb25zID0gcmVzdWx0LmNvbnNpc3RlbmN5O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXN1bHQucmF3V3BtICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAocmF3V3BtLmxhc3QxMENvdW50IDwgMTApIHtcbiAgICAgICAgICAgICAgICAgICAgcmF3V3BtLmxhc3QxMENvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgIHJhd1dwbS5sYXN0MTBUb3RhbCArPSByZXN1bHQucmF3V3BtO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByYXdXcG0udG90YWwgKz0gcmVzdWx0LnJhd1dwbTtcbiAgICAgICAgICAgICAgICByYXdXcG0uY291bnQrKztcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnJhd1dwbSA+IHJhd1dwbS5tYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmF3V3BtLm1heCA9IHJlc3VsdC5yYXdXcG07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJlc3VsdC5hY2MgPiB0b3BBY2MpIHtcbiAgICAgICAgICAgICAgICB0b3BBY2MgPSByZXN1bHQuYWNjO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdG90YWxBY2MgKz0gcmVzdWx0LmFjYztcbiAgICAgICAgICAgIGlmIChyZXN1bHQucmVzdGFydENvdW50ICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRlc3RSZXN0YXJ0cyArPSByZXN1bHQucmVzdGFydENvdW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2hhcnREYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgIHg6IHJlc3VsdC50aW1lc3RhbXAsXG4gICAgICAgICAgICAgICAgeTogY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNID8gTWlzYy5yb3VuZFRvMihyZXN1bHQud3BtICogNSkgOiByZXN1bHQud3BtLFxuICAgICAgICAgICAgICAgIHdwbTogY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNXG4gICAgICAgICAgICAgICAgICAgID8gTWlzYy5yb3VuZFRvMihyZXN1bHQud3BtICogNSlcbiAgICAgICAgICAgICAgICAgICAgOiByZXN1bHQud3BtLFxuICAgICAgICAgICAgICAgIGFjYzogcmVzdWx0LmFjYyxcbiAgICAgICAgICAgICAgICBtb2RlOiByZXN1bHQubW9kZSxcbiAgICAgICAgICAgICAgICBtb2RlMjogcmVzdWx0Lm1vZGUyLFxuICAgICAgICAgICAgICAgIHB1bmN0dWF0aW9uOiByZXN1bHQucHVuY3R1YXRpb24sXG4gICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IHJlc3VsdC5sYW5ndWFnZSxcbiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IHJlc3VsdC50aW1lc3RhbXAsXG4gICAgICAgICAgICAgICAgZGlmZmljdWx0eTogcmVzdWx0LmRpZmZpY3VsdHksXG4gICAgICAgICAgICAgICAgcmF3OiBjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE1cbiAgICAgICAgICAgICAgICAgICAgPyBNaXNjLnJvdW5kVG8yKHJlc3VsdC5yYXdXcG0gKiA1KVxuICAgICAgICAgICAgICAgICAgICA6IHJlc3VsdC5yYXdXcG0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHdwbUNoYXJ0RGF0YS5wdXNoKHJlc3VsdC53cG0pO1xuICAgICAgICAgICAgYWNjQ2hhcnREYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgIHg6IHJlc3VsdC50aW1lc3RhbXAsXG4gICAgICAgICAgICAgICAgeTogMTAwIC0gcmVzdWx0LmFjYyxcbiAgICAgICAgICAgICAgICBlcnJvclJhdGU6IDEwMCAtIHJlc3VsdC5hY2MsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQud3BtID4gdG9wV3BtKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcHVuY3NjdHJpbmcgPSByZXN1bHQucHVuY3R1YXRpb24gPyBcIiw8YnI+d2l0aCBwdW5jdHVhdGlvblwiIDogXCJcIjtcbiAgICAgICAgICAgICAgICBjb25zdCBudW1ic2N0cmluZyA9IHJlc3VsdC5udW1iZXJzXG4gICAgICAgICAgICAgICAgICAgID8gXCIsPGJyPiBcIiArIChyZXN1bHQucHVuY3R1YXRpb24gPyBcIiZcIiA6IFwiXCIpICsgXCJ3aXRoIG51bWJlcnNcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiXCI7XG4gICAgICAgICAgICAgICAgdG9wV3BtID0gcmVzdWx0LndwbTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lm1vZGUgPT0gXCJjdXN0b21cIilcbiAgICAgICAgICAgICAgICAgICAgdG9wTW9kZSA9IHJlc3VsdC5tb2RlO1xuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b3BNb2RlID1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5tb2RlICsgXCIgXCIgKyByZXN1bHQubW9kZTIgKyBwdW5jc2N0cmluZyArIG51bWJzY3RyaW5nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRvdGFsV3BtICs9IHJlc3VsdC53cG07XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5ncm91cC5oaXN0b3J5IHRhYmxlIHRoZWFkIHRyIHRkOm50aC1jaGlsZCgyKVwiKS50ZXh0KFwiY3BtXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuZ3JvdXAuaGlzdG9yeSB0YWJsZSB0aGVhZCB0ciB0ZDpudGgtY2hpbGQoMilcIikudGV4dChcIndwbVwiKTtcbiAgICAgICAgfVxuICAgICAgICBsb2FkTW9yZUxpbmVzKCk7XG4gICAgICAgIC8vLy8vLy8vXG4gICAgICAgIGNvbnN0IGFjdGl2aXR5Q2hhcnREYXRhX2Ftb3VudCA9IFtdO1xuICAgICAgICBjb25zdCBhY3Rpdml0eUNoYXJ0RGF0YV90aW1lID0gW107XG4gICAgICAgIGNvbnN0IGFjdGl2aXR5Q2hhcnREYXRhX2F2Z1dwbSA9IFtdO1xuICAgICAgICAvLyBsZXQgbGFzdFRpbWVzdGFtcCA9IDA7XG4gICAgICAgIE9iamVjdC5rZXlzKGFjdGl2aXR5Q2hhcnREYXRhKS5mb3JFYWNoKChkYXRlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBkYXRlSW50ID0gcGFyc2VJbnQoZGF0ZSk7XG4gICAgICAgICAgICBhY3Rpdml0eUNoYXJ0RGF0YV9hbW91bnQucHVzaCh7XG4gICAgICAgICAgICAgICAgeDogZGF0ZUludCxcbiAgICAgICAgICAgICAgICB5OiBhY3Rpdml0eUNoYXJ0RGF0YVtkYXRlSW50XS5hbW91bnQsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGFjdGl2aXR5Q2hhcnREYXRhX3RpbWUucHVzaCh7XG4gICAgICAgICAgICAgICAgeDogZGF0ZUludCxcbiAgICAgICAgICAgICAgICB5OiBNaXNjLnJvdW5kVG8yKGFjdGl2aXR5Q2hhcnREYXRhW2RhdGVJbnRdLnRpbWUpLFxuICAgICAgICAgICAgICAgIGFtb3VudDogYWN0aXZpdHlDaGFydERhdGFbZGF0ZUludF0uYW1vdW50LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBhY3Rpdml0eUNoYXJ0RGF0YV9hdmdXcG0ucHVzaCh7XG4gICAgICAgICAgICAgICAgeDogZGF0ZUludCxcbiAgICAgICAgICAgICAgICB5OiBNaXNjLnJvdW5kVG8yKChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE1cbiAgICAgICAgICAgICAgICAgICAgPyBhY3Rpdml0eUNoYXJ0RGF0YVtkYXRlSW50XS50b3RhbFdwbSAqIDVcbiAgICAgICAgICAgICAgICAgICAgOiBhY3Rpdml0eUNoYXJ0RGF0YVtkYXRlSW50XS50b3RhbFdwbSkgL1xuICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eUNoYXJ0RGF0YVtkYXRlSW50XS5hbW91bnQpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBsYXN0VGltZXN0YW1wID0gZGF0ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGFjY291bnRBY3Rpdml0eVNjYWxlT3B0aW9ucyA9IENoYXJ0Q29udHJvbGxlci5hY2NvdW50QWN0aXZpdHkub3B0aW9ucy5zY2FsZXM7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0pIHtcbiAgICAgICAgICAgIGFjY291bnRBY3Rpdml0eVNjYWxlT3B0aW9uc1tcImF2Z1dwbVwiXS50aXRsZS50ZXh0ID0gXCJBdmVyYWdlIENwbVwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYWNjb3VudEFjdGl2aXR5U2NhbGVPcHRpb25zW1wiYXZnV3BtXCJdLnRpdGxlLnRleHQgPSBcIkF2ZXJhZ2UgV3BtXCI7XG4gICAgICAgIH1cbiAgICAgICAgQ2hhcnRDb250cm9sbGVyLmFjY291bnRBY3Rpdml0eS5kYXRhLmRhdGFzZXRzWzBdLmRhdGEgPVxuICAgICAgICAgICAgYWN0aXZpdHlDaGFydERhdGFfdGltZTtcbiAgICAgICAgQ2hhcnRDb250cm9sbGVyLmFjY291bnRBY3Rpdml0eS5kYXRhLmRhdGFzZXRzWzFdLmRhdGEgPVxuICAgICAgICAgICAgYWN0aXZpdHlDaGFydERhdGFfYXZnV3BtO1xuICAgICAgICBjb25zdCBhY2NvdW50SGlzdG9yeVNjYWxlT3B0aW9ucyA9IENoYXJ0Q29udHJvbGxlci5hY2NvdW50SGlzdG9yeS5vcHRpb25zLnNjYWxlcztcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSkge1xuICAgICAgICAgICAgYWNjb3VudEhpc3RvcnlTY2FsZU9wdGlvbnNbXCJ3cG1cIl0udGl0bGUudGV4dCA9IFwiQ2hhcmFjdGVycyBwZXIgTWludXRlXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhY2NvdW50SGlzdG9yeVNjYWxlT3B0aW9uc1tcIndwbVwiXS50aXRsZS50ZXh0ID0gXCJXb3JkcyBwZXIgTWludXRlXCI7XG4gICAgICAgIH1cbiAgICAgICAgQ2hhcnRDb250cm9sbGVyLmFjY291bnRIaXN0b3J5LmRhdGEuZGF0YXNldHNbMF0uZGF0YSA9IGNoYXJ0RGF0YTtcbiAgICAgICAgQ2hhcnRDb250cm9sbGVyLmFjY291bnRIaXN0b3J5LmRhdGEuZGF0YXNldHNbMV0uZGF0YSA9IGFjY0NoYXJ0RGF0YTtcbiAgICAgICAgY29uc3Qgd3BtcyA9IGNoYXJ0RGF0YS5tYXAoKHIpID0+IHIueSk7XG4gICAgICAgIGNvbnN0IG1pbldwbUNoYXJ0VmFsID0gTWF0aC5taW4oLi4ud3Btcyk7XG4gICAgICAgIGNvbnN0IG1heFdwbUNoYXJ0VmFsID0gTWF0aC5tYXgoLi4ud3Btcyk7XG4gICAgICAgIC8vIGxldCBhY2N1cmFjaWVzID0gYWNjQ2hhcnREYXRhLm1hcCgocikgPT4gci55KTtcbiAgICAgICAgYWNjb3VudEhpc3RvcnlTY2FsZU9wdGlvbnNbXCJ3cG1cIl0ubWF4ID1cbiAgICAgICAgICAgIE1hdGguZmxvb3IobWF4V3BtQ2hhcnRWYWwpICsgKDEwIC0gKE1hdGguZmxvb3IobWF4V3BtQ2hhcnRWYWwpICUgMTApKTtcbiAgICAgICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LnN0YXJ0R3JhcGhzQXRaZXJvKSB7XG4gICAgICAgICAgICBhY2NvdW50SGlzdG9yeVNjYWxlT3B0aW9uc1tcIndwbVwiXS5taW4gPSBNYXRoLmZsb29yKG1pbldwbUNoYXJ0VmFsKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGFjY291bnRIaXN0b3J5U2NhbGVPcHRpb25zW1wid3BtXCJdLm1pbiA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoYXJ0RGF0YSA9PSBbXSB8fCBjaGFydERhdGEubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmdyb3VwLm5vRGF0YUVycm9yXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuZ3JvdXAuY2hhcnRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5ncm91cC5kYWlseUFjdGl2aXR5Q2hhcnRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5ncm91cC5oaXN0b3J5XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAudHJpcGxlZ3JvdXAuc3RhdHNcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5ncm91cC5ub0RhdGFFcnJvclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmdyb3VwLmNoYXJ0XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuZ3JvdXAuZGFpbHlBY3Rpdml0eUNoYXJ0XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuZ3JvdXAuaGlzdG9yeVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLnRyaXBsZWdyb3VwLnN0YXRzXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLnRpbWVUb3RhbEZpbHRlcmVkIC52YWxcIikudGV4dChNaXNjLnNlY29uZHNUb1N0cmluZyhNYXRoLnJvdW5kKHRvdGFsU2Vjb25kc0ZpbHRlcmVkKSwgdHJ1ZSwgdHJ1ZSkpO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5oaWdoZXN0V3BtIC50aXRsZVwiKS50ZXh0KFwiaGlnaGVzdCBjcG1cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5oaWdoZXN0V3BtIC52YWxcIikudGV4dChNaXNjLnJvdW5kVG8yKHRvcFdwbSAqIDUpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmhpZ2hlc3RXcG0gLnRpdGxlXCIpLnRleHQoXCJoaWdoZXN0IHdwbVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmhpZ2hlc3RXcG0gLnZhbFwiKS50ZXh0KE1pc2Mucm91bmRUbzIodG9wV3BtKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSkge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZlcmFnZVdwbSAudGl0bGVcIikudGV4dChcImF2ZXJhZ2UgY3BtXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZlcmFnZVdwbSAudmFsXCIpLnRleHQoTWF0aC5yb3VuZCgodG90YWxXcG0gKiA1KSAvIHRlc3RDb3VudCkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZlcmFnZVdwbSAudGl0bGVcIikudGV4dChcImF2ZXJhZ2Ugd3BtXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZlcmFnZVdwbSAudmFsXCIpLnRleHQoTWF0aC5yb3VuZCh0b3RhbFdwbSAvIHRlc3RDb3VudCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0pIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2ZXJhZ2VXcG0xMCAudGl0bGVcIikudGV4dChcImF2ZXJhZ2UgY3BtIChsYXN0IDEwIHRlc3RzKVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2ZXJhZ2VXcG0xMCAudmFsXCIpLnRleHQoTWF0aC5yb3VuZCgod3BtTGFzdDEwdG90YWwgKiA1KSAvIGxhc3QxMCkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZlcmFnZVdwbTEwIC50aXRsZVwiKS50ZXh0KFwiYXZlcmFnZSB3cG0gKGxhc3QgMTAgdGVzdHMpXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZlcmFnZVdwbTEwIC52YWxcIikudGV4dChNYXRoLnJvdW5kKHdwbUxhc3QxMHRvdGFsIC8gbGFzdDEwKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSkge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuaGlnaGVzdFJhdyAudGl0bGVcIikudGV4dChcImhpZ2hlc3QgcmF3IGNwbVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmhpZ2hlc3RSYXcgLnZhbFwiKS50ZXh0KE1pc2Mucm91bmRUbzIocmF3V3BtLm1heCAqIDUpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmhpZ2hlc3RSYXcgLnRpdGxlXCIpLnRleHQoXCJoaWdoZXN0IHJhdyB3cG1cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5oaWdoZXN0UmF3IC52YWxcIikudGV4dChNaXNjLnJvdW5kVG8yKHJhd1dwbS5tYXgpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmVyYWdlUmF3IC50aXRsZVwiKS50ZXh0KFwiYXZlcmFnZSByYXcgY3BtXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZlcmFnZVJhdyAudmFsXCIpLnRleHQoTWF0aC5yb3VuZCgocmF3V3BtLnRvdGFsICogNSkgLyByYXdXcG0uY291bnQpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2ZXJhZ2VSYXcgLnRpdGxlXCIpLnRleHQoXCJhdmVyYWdlIHJhdyB3cG1cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmVyYWdlUmF3IC52YWxcIikudGV4dChNYXRoLnJvdW5kKHJhd1dwbS50b3RhbCAvIHJhd1dwbS5jb3VudCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0pIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2ZXJhZ2VSYXcxMCAudGl0bGVcIikudGV4dChcImF2ZXJhZ2UgcmF3IGNwbSAobGFzdCAxMCB0ZXN0cylcIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmVyYWdlUmF3MTAgLnZhbFwiKS50ZXh0KE1hdGgucm91bmQoKHJhd1dwbS5sYXN0MTBUb3RhbCAqIDUpIC8gcmF3V3BtLmxhc3QxMENvdW50KSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmVyYWdlUmF3MTAgLnRpdGxlXCIpLnRleHQoXCJhdmVyYWdlIHJhdyB3cG0gKGxhc3QgMTAgdGVzdHMpXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZlcmFnZVJhdzEwIC52YWxcIikudGV4dChNYXRoLnJvdW5kKHJhd1dwbS5sYXN0MTBUb3RhbCAvIHJhd1dwbS5sYXN0MTBDb3VudCkpO1xuICAgICAgICB9XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmhpZ2hlc3RXcG0gLm1vZGVcIikuaHRtbCh0b3BNb2RlKTtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAudGVzdHNUYWtlbiAudmFsXCIpLnRleHQodGVzdENvdW50KTtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuaGlnaGVzdEFjYyAudmFsXCIpLnRleHQodG9wQWNjICsgXCIlXCIpO1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmdBY2MgLnZhbFwiKS50ZXh0KE1hdGgucm91bmQodG90YWxBY2MgLyB0ZXN0Q291bnQpICsgXCIlXCIpO1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmdBY2MxMCAudmFsXCIpLnRleHQoTWF0aC5yb3VuZCh0b3RhbEFjYzEwIC8gbGFzdDEwKSArIFwiJVwiKTtcbiAgICAgICAgaWYgKHRvdGFsQ29ucyA9PSAwIHx8IHRvdGFsQ29ucyA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2Z0NvbnMgLnZhbFwiKS50ZXh0KFwiLVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2Z0NvbnMxMCAudmFsXCIpLnRleHQoXCItXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuaGlnaGVzdENvbnMgLnZhbFwiKS50ZXh0KHRvcENvbnMgKyBcIiVcIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmdDb25zIC52YWxcIikudGV4dChNYXRoLnJvdW5kKHRvdGFsQ29ucyAvIGNvbnNDb3VudCkgKyBcIiVcIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmdDb25zMTAgLnZhbFwiKS50ZXh0KE1hdGgucm91bmQodG90YWxDb25zMTAgLyBNYXRoLm1pbihsYXN0MTAsIGNvbnNDb3VudCkpICsgXCIlXCIpO1xuICAgICAgICB9XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLnRlc3RzU3RhcnRlZCAudmFsXCIpLnRleHQoYCR7dGVzdENvdW50ICsgdGVzdFJlc3RhcnRzfWApO1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC50ZXN0c0NvbXBsZXRlZCAudmFsXCIpLnRleHQoYCR7dGVzdENvdW50fSgke01hdGguZmxvb3IoKHRlc3RDb3VudCAvICh0ZXN0Q291bnQgKyB0ZXN0UmVzdGFydHMpKSAqIDEwMCl9JSlgKTtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAudGVzdHNDb21wbGV0ZWQgLmF2Z3Jlc1wiKS50ZXh0KGBcbiAgICAgICR7KHRlc3RSZXN0YXJ0cyAvIHRlc3RDb3VudCkudG9GaXhlZCgxKX0gcmVzdGFydHMgcGVyIGNvbXBsZXRlZCB0ZXN0XG4gICAgYCk7XG4gICAgICAgIGNvbnN0IHdwbVBvaW50cyA9IGZpbHRlcmVkUmVzdWx0cy5tYXAoKHIpID0+IHIud3BtKS5yZXZlcnNlKCk7XG4gICAgICAgIGNvbnN0IHRyZW5kID0gTWlzYy5maW5kTGluZUJ5TGVhc3RTcXVhcmVzKHdwbVBvaW50cyk7XG4gICAgICAgIGNvbnN0IHdwbUNoYW5nZSA9IHRyZW5kWzFdWzFdIC0gdHJlbmRbMF1bMV07XG4gICAgICAgIGNvbnN0IHdwbUNoYW5nZVBlckhvdXIgPSB3cG1DaGFuZ2UgKiAoMzYwMCAvIHRvdGFsU2Vjb25kc0ZpbHRlcmVkKTtcbiAgICAgICAgY29uc3QgcGx1cyA9IHdwbUNoYW5nZVBlckhvdXIgPiAwID8gXCIrXCIgOiBcIlwiO1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5ncm91cC5jaGFydCAuYmVsb3cgLnRleHRcIikudGV4dChgU3BlZWQgY2hhbmdlIHBlciBob3VyIHNwZW50IHR5cGluZzogJHtwbHVzICtcbiAgICAgICAgICAgIE1pc2Mucm91bmRUbzIoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNID8gd3BtQ2hhbmdlUGVySG91ciAqIDUgOiB3cG1DaGFuZ2VQZXJIb3VyKX0gJHtjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0gPyBcImNwbVwiIDogXCJ3cG1cIn0uYCk7XG4gICAgICAgIGFwcGx5SGlzdG9yeVNtb290aGluZygpO1xuICAgICAgICBDaGFydENvbnRyb2xsZXIuYWNjb3VudEFjdGl2aXR5LnVwZGF0ZUNvbG9ycygpO1xuICAgICAgICBMb2FkaW5nUGFnZS51cGRhdGVCYXIoMTAwLCB0cnVlKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoQWN0aXZlUGFnZS5nZXQoKSA9PSBcImFjY291bnRcIilcbiAgICAgICAgICAgICAgICBTaWduT3V0QnV0dG9uLnNob3coKTtcbiAgICAgICAgfSwgMTI1KTtcbiAgICAgICAgRm9jdXMuc2V0KGZhbHNlKTtcbiAgICAgICAgTWlzYy5zd2FwRWxlbWVudHMoJChcIi5wYWdlQWNjb3VudCAucHJlbG9hZGVyXCIpLCAkKFwiLnBhZ2VBY2NvdW50IC5jb250ZW50XCIpLCAyNTApO1xuICAgIH1cbiAgICBpZiAoREIuZ2V0U25hcHNob3QoKSA9PT0gbnVsbCkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgTWlzc2luZyBhY2NvdW50IGRhdGEuIFBsZWFzZSByZWZyZXNoLmAsIC0xKTtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAucHJlbG9hZGVyXCIpLmh0bWwoXCJNaXNzaW5nIGFjY291bnQgZGF0YS4gUGxlYXNlIHJlZnJlc2guXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChEQi5nZXRTbmFwc2hvdCgpLnJlc3VsdHMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBMb2FkaW5nUGFnZS51cGRhdGVCYXIoNDUsIHRydWUpO1xuICAgICAgICBEQi5nZXRVc2VyUmVzdWx0cygpLnRoZW4oKGQpID0+IHtcbiAgICAgICAgICAgIFRvZGF5VHJhY2tlci5hZGRBbGxGcm9tVG9kYXkoKTtcbiAgICAgICAgICAgIGlmIChkKSB7XG4gICAgICAgICAgICAgICAgUmVzdWx0RmlsdGVycy51cGRhdGVBY3RpdmUoKTtcbiAgICAgICAgICAgICAgICB1cGRhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyhcInVzaW5nIGRiIHNuYXBcIik7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb250KCk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgU29tZXRoaW5nIHdlbnQgd3Jvbmc6ICR7ZX1gLCAtMSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLnVwZGF0ZSA9IHVwZGF0ZTtcbmZ1bmN0aW9uIHNvcnRBbmRSZWZyZXNoSGlzdG9yeShrZXlTdHJpbmcsIGhlYWRlckNsYXNzLCBmb3JjZURlc2NlbmRpbmcgPSBudWxsKSB7XG4gICAgLy8gUmVtb3ZlcyBzdHlsaW5nIGZyb20gcHJldmlvdXMgc29ydGluZyByZXF1ZXN0czpcbiAgICAkKFwidGRcIikucmVtb3ZlQ2xhc3MoXCJoZWFkZXItc29ydGVkXCIpO1xuICAgICQoXCJ0ZFwiKS5jaGlsZHJlbihcImlcIikucmVtb3ZlKCk7XG4gICAgJChoZWFkZXJDbGFzcykuYWRkQ2xhc3MoXCJoZWFkZXItc29ydGVkXCIpO1xuICAgIGlmIChmaWx0ZXJlZFJlc3VsdHMubGVuZ3RoIDwgMilcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IGtleSA9IGtleVN0cmluZztcbiAgICAvLyBUaGlzIGFsbG93cyB0byByZXZlcnNlIHRoZSBzb3J0aW5nIG9yZGVyIHdoZW4gY2xpY2tpbmcgbXVsdGlwbGUgdGltZXMgb24gdGhlIHRhYmxlIGhlYWRlclxuICAgIGxldCBkZXNjZW5kaW5nID0gdHJ1ZTtcbiAgICBpZiAoZm9yY2VEZXNjZW5kaW5nICE9PSBudWxsKSB7XG4gICAgICAgIGlmIChmb3JjZURlc2NlbmRpbmcgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgJChoZWFkZXJDbGFzcykuYXBwZW5kKCc8aSBjbGFzcz1cImZhcyBmYS1zb3J0LWRvd25cIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L2k+Jyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkZXNjZW5kaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAkKGhlYWRlckNsYXNzKS5hcHBlbmQoJzxpIGNsYXNzPVwiZmFzIGZhLXNvcnQtdXBcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L2k+Jyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAocGFyc2VJbnQoZmlsdGVyZWRSZXN1bHRzWzBdW2tleV0pIDw9XG4gICAgICAgIHBhcnNlSW50KGZpbHRlcmVkUmVzdWx0c1tmaWx0ZXJlZFJlc3VsdHMubGVuZ3RoIC0gMV1ba2V5XSkpIHtcbiAgICAgICAgZGVzY2VuZGluZyA9IHRydWU7XG4gICAgICAgICQoaGVhZGVyQ2xhc3MpLmFwcGVuZCgnPGkgY2xhc3M9XCJmYXMgZmEtc29ydC1kb3duXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9pPicpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZGVzY2VuZGluZyA9IGZhbHNlO1xuICAgICAgICAkKGhlYWRlckNsYXNzKS5hcHBlbmQoJzxpIGNsYXNzPVwiZmFzIGZhLXNvcnQtdXBcIiwgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9pPicpO1xuICAgIH1cbiAgICBjb25zdCB0ZW1wID0gW107XG4gICAgY29uc3QgcGFyc2VkSW5kZXhlcyA9IFtdO1xuICAgIHdoaWxlICh0ZW1wLmxlbmd0aCA8IGZpbHRlcmVkUmVzdWx0cy5sZW5ndGgpIHtcbiAgICAgICAgbGV0IGxvd2VzdCA9IE51bWJlci5NQVhfVkFMVUU7XG4gICAgICAgIGxldCBoaWdoZXN0ID0gLTE7XG4gICAgICAgIGxldCBpZHggPSAtMTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWx0ZXJlZFJlc3VsdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIC8vZmluZCB0aGUgbG93ZXN0IHdwbSB3aXRoIGluZGV4IG5vdCBhbHJlYWR5IHBhcnNlZFxuICAgICAgICAgICAgaWYgKCFkZXNjZW5kaW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbHRlcmVkUmVzdWx0c1tpXVtrZXldIDw9IGxvd2VzdCAmJlxuICAgICAgICAgICAgICAgICAgICAhcGFyc2VkSW5kZXhlcy5pbmNsdWRlcyhpKSkge1xuICAgICAgICAgICAgICAgICAgICBsb3dlc3QgPSBmaWx0ZXJlZFJlc3VsdHNbaV1ba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgaWR4ID0gaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWRSZXN1bHRzW2ldW2tleV0gPj0gaGlnaGVzdCAmJlxuICAgICAgICAgICAgICAgICAgICAhcGFyc2VkSW5kZXhlcy5pbmNsdWRlcyhpKSkge1xuICAgICAgICAgICAgICAgICAgICBoaWdoZXN0ID0gZmlsdGVyZWRSZXN1bHRzW2ldW2tleV07XG4gICAgICAgICAgICAgICAgICAgIGlkeCA9IGk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRlbXAucHVzaChmaWx0ZXJlZFJlc3VsdHNbaWR4XSk7XG4gICAgICAgIHBhcnNlZEluZGV4ZXMucHVzaChpZHgpO1xuICAgIH1cbiAgICBmaWx0ZXJlZFJlc3VsdHMgPSB0ZW1wO1xuICAgICQoXCIucGFnZUFjY291bnQgLmhpc3RvcnkgdGFibGUgdGJvZHlcIikuZW1wdHkoKTtcbiAgICB2aXNpYmxlVGFibGVMaW5lcyA9IDA7XG4gICAgbG9hZE1vcmVMaW5lcygpO1xufVxuJChcIi5wYWdlQWNjb3VudCAudG9nZ2xlQWNjdXJhY3lPbkNoYXJ0XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRDaGFydEFjY3VyYWN5KCFjb25maWdfMS5kZWZhdWx0LmNoYXJ0QWNjdXJhY3kpO1xufSk7XG4kKFwiLnBhZ2VBY2NvdW50IC50b2dnbGVDaGFydFN0eWxlXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmNoYXJ0U3R5bGUgPT0gXCJsaW5lXCIpIHtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldENoYXJ0U3R5bGUoXCJzY2F0dGVyXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldENoYXJ0U3R5bGUoXCJsaW5lXCIpO1xuICAgIH1cbn0pO1xuJChcIi5wYWdlQWNjb3VudCAubG9hZE1vcmVCdXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgbG9hZE1vcmVMaW5lcygpO1xufSk7XG4kKFwiLnBhZ2VBY2NvdW50ICNhY2NvdW50SGlzdG9yeUNoYXJ0XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIGNvbnN0IGluZGV4ID0gQ2hhcnRDb250cm9sbGVyLmFjY291bnRIaXN0b3J5QWN0aXZlSW5kZXg7XG4gICAgbG9hZE1vcmVMaW5lcyhpbmRleCk7XG4gICAgaWYgKCF3aW5kb3cpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCB3aW5kb3dIZWlnaHQgPSAoX2EgPSAkKHdpbmRvdykuaGVpZ2h0KCkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDA7XG4gICAgY29uc3Qgb2Zmc2V0ID0gKF9jID0gKF9iID0gJChgI3Jlc3VsdC0ke2luZGV4fWApLm9mZnNldCgpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudG9wKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiAwO1xuICAgIGNvbnN0IHNjcm9sbFRvID0gb2Zmc2V0IC0gd2luZG93SGVpZ2h0IC8gMjtcbiAgICAkKFtkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIGRvY3VtZW50LmJvZHldKS5hbmltYXRlKHtcbiAgICAgICAgc2Nyb2xsVG9wOiBzY3JvbGxUbyxcbiAgICB9LCA1MDApO1xuICAgICQoXCIucmVzdWx0Um93XCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICQoYCNyZXN1bHQtJHtpbmRleH1gKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlQWNjb3VudCAubWluaVJlc3VsdENoYXJ0QnV0dG9uXCIsIChldmVudCkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBjb25zb2xlLmxvZyhcInVwZGF0aW5nXCIpO1xuICAgIGNvbnN0IGZpbHRlcmVkSWQgPSAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJmaWx0ZXJlZFJlc3VsdHNJZFwiKTtcbiAgICBpZiAoZmlsdGVyZWRJZCA9PT0gdW5kZWZpbmVkKVxuICAgICAgICByZXR1cm47XG4gICAgTWluaVJlc3VsdENoYXJ0LnVwZGF0ZURhdGEoZmlsdGVyZWRSZXN1bHRzW3BhcnNlSW50KGZpbHRlcmVkSWQpXS5jaGFydERhdGEpO1xuICAgIE1pbmlSZXN1bHRDaGFydC5zaG93KCk7XG4gICAgTWluaVJlc3VsdENoYXJ0LnVwZGF0ZVBvc2l0aW9uKGV2ZW50LnBhZ2VYIC0gKChfYSA9ICQoXCIucGFnZUFjY291bnQgLm1pbmlSZXN1bHRDaGFydFdyYXBwZXJcIikub3V0ZXJXaWR0aCgpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAwKSwgZXZlbnQucGFnZVkgKyAzMCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIuaGlzdG9yeS13cG0taGVhZGVyXCIsICgpID0+IHtcbiAgICBzb3J0QW5kUmVmcmVzaEhpc3RvcnkoXCJ3cG1cIiwgXCIuaGlzdG9yeS13cG0taGVhZGVyXCIpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLmhpc3RvcnktcmF3LWhlYWRlclwiLCAoKSA9PiB7XG4gICAgc29ydEFuZFJlZnJlc2hIaXN0b3J5KFwicmF3V3BtXCIsIFwiLmhpc3RvcnktcmF3LWhlYWRlclwiKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5oaXN0b3J5LWFjYy1oZWFkZXJcIiwgKCkgPT4ge1xuICAgIHNvcnRBbmRSZWZyZXNoSGlzdG9yeShcImFjY1wiLCBcIi5oaXN0b3J5LWFjYy1oZWFkZXJcIik7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIuaGlzdG9yeS1jb3JyZWN0LWNoYXJzLWhlYWRlclwiLCAoKSA9PiB7XG4gICAgc29ydEFuZFJlZnJlc2hIaXN0b3J5KFwiY29ycmVjdENoYXJzXCIsIFwiLmhpc3RvcnktY29ycmVjdC1jaGFycy1oZWFkZXJcIik7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIuaGlzdG9yeS1pbmNvcnJlY3QtY2hhcnMtaGVhZGVyXCIsICgpID0+IHtcbiAgICBzb3J0QW5kUmVmcmVzaEhpc3RvcnkoXCJpbmNvcnJlY3RDaGFyc1wiLCBcIi5oaXN0b3J5LWluY29ycmVjdC1jaGFycy1oZWFkZXJcIik7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIuaGlzdG9yeS1jb25zaXN0ZW5jeS1oZWFkZXJcIiwgKCkgPT4ge1xuICAgIHNvcnRBbmRSZWZyZXNoSGlzdG9yeShcImNvbnNpc3RlbmN5XCIsIFwiLmhpc3RvcnktY29uc2lzdGVuY3ktaGVhZGVyXCIpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLmhpc3RvcnktZGF0ZS1oZWFkZXJcIiwgKCkgPT4ge1xuICAgIHNvcnRBbmRSZWZyZXNoSGlzdG9yeShcInRpbWVzdGFtcFwiLCBcIi5oaXN0b3J5LWRhdGUtaGVhZGVyXCIpO1xufSk7XG4vLyBSZXNldHMgc29ydGluZyB0byBieSBkYXRlJyB3aGVuIGFwcGx5aW5nIGZpbGVycyAobm9ybWFsIG9yIGFkdmFuY2VkKVxuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5idXR0b25zQW5kVGl0bGUgLmJ1dHRvbnMgLmJ1dHRvblwiLCAoKSA9PiB7XG4gICAgLy8gV2Ugd2FudCB0byAnZm9yY2UnIGRlc2NlbmRpbmcgc29ydDpcbiAgICBzb3J0QW5kUmVmcmVzaEhpc3RvcnkoXCJ0aW1lc3RhbXBcIiwgXCIuaGlzdG9yeS1kYXRlLWhlYWRlclwiLCB0cnVlKTtcbn0pO1xuJChcIi5wYWdlQWNjb3VudCAudG9wRmlsdGVycyAuYnV0dG9uLCAucGFnZUFjY291bnQgLmZpbHRlckJ1dHRvbnMgLmJ1dHRvbiBcIikuY2xpY2soKCkgPT4ge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB1cGRhdGUoKTtcbiAgICB9LCAwKTtcbn0pO1xuJChcIi5wYWdlQWNjb3VudCAuY29udGVudCAuYmVsb3cgLnNtb290aGluZyBpbnB1dFwiKS5vbihcImlucHV0XCIsICgpID0+IHtcbiAgICBhcHBseUhpc3RvcnlTbW9vdGhpbmcoKTtcbn0pO1xuJChcIi5wYWdlQWNjb3VudCAuY29udGVudCAuZ3JvdXAuYWJvdmVIaXN0b3J5IC5leHBvcnRDU1ZcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgTWlzYy5kb3dubG9hZFJlc3VsdHNDU1YoZmlsdGVyZWRSZXN1bHRzKTtcbn0pO1xuZXhwb3J0cy5wYWdlID0gbmV3IHBhZ2VfMS5kZWZhdWx0KFwiYWNjb3VudFwiLCAkKFwiLnBhZ2UucGFnZUFjY291bnRcIiksIFwiL2FjY291bnRcIiwgKCkgPT4ge1xuICAgIFNpZ25PdXRCdXR0b24uaGlkZSgpO1xufSwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgcmVzZXQoKTtcbn0pLCAoKSA9PiB7XG4gICAgdXBkYXRlKCk7XG4gICAgLy8gU2lnbk91dEJ1dHRvbi5zaG93KCk7XG59LCAoKSA9PiB7XG4gICAgLy9cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5wYWdlID0gZXhwb3J0cy5zaG93QmFyID0gZXhwb3J0cy51cGRhdGVUZXh0ID0gZXhwb3J0cy51cGRhdGVCYXIgPSB2b2lkIDA7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IHBhZ2VfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9wYWdlXCIpKTtcbmZ1bmN0aW9uIHVwZGF0ZUJhcihwZXJjZW50YWdlLCBmYXN0KSB7XG4gICAgY29uc3Qgc3BlZWQgPSBmYXN0ID8gMTAwIDogMTAwMDtcbiAgICAkKFwiLnBhZ2VMb2FkaW5nIC5maWxsLCAucGFnZUFjY291bnQgLmZpbGxcIilcbiAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICB3aWR0aDogcGVyY2VudGFnZSArIFwiJVwiLFxuICAgIH0sIHNwZWVkKTtcbn1cbmV4cG9ydHMudXBkYXRlQmFyID0gdXBkYXRlQmFyO1xuZnVuY3Rpb24gdXBkYXRlVGV4dCh0ZXh0KSB7XG4gICAgJChcIi5wYWdlTG9hZGluZyAudGV4dCwgLnBhZ2VBY2NvdW50IC50ZXh0XCIpLnRleHQodGV4dCk7XG59XG5leHBvcnRzLnVwZGF0ZVRleHQgPSB1cGRhdGVUZXh0O1xuZnVuY3Rpb24gc2hvd0JhcigpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgTWlzYy5zd2FwRWxlbWVudHMoJChcIi5wYWdlTG9hZGluZyAuaWNvblwiKSwgJChcIi5wYWdlTG9hZGluZyAuYmFyV3JhcHBlclwiKSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBNaXNjLnN3YXBFbGVtZW50cygkKFwiLnBhZ2VBY2NvdW50IC5pY29uXCIpLCAkKFwiLnBhZ2VBY2NvdW50IC5iYXJXcmFwcGVyXCIpLCAxMjUsICgpID0+IHtcbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5leHBvcnRzLnNob3dCYXIgPSBzaG93QmFyO1xuZXhwb3J0cy5wYWdlID0gbmV3IHBhZ2VfMS5kZWZhdWx0KFwibG9hZGluZ1wiLCAkKFwiLnBhZ2UucGFnZUxvYWRpbmdcIiksIFwiL1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAvL1xufSksICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIC8vXG59KSwgKCkgPT4ge1xuICAgIC8vXG59LCAoKSA9PiB7XG4gICAgLy9cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnBhZ2UgPSB2b2lkIDA7XG5jb25zdCBwYWdlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vcGFnZVwiKSk7XG5leHBvcnRzLnBhZ2UgPSBuZXcgcGFnZV8xLmRlZmF1bHQoXCJsb2dpblwiLCAkKFwiLnBhZ2UucGFnZUxvZ2luXCIpLCBcIi9sb2dpblwiLCAoKSA9PiB7XG4gICAgLy9cbn0sICgpID0+IHtcbiAgICAvL1xufSwgKCkgPT4ge1xuICAgIC8vXG59LCAoKSA9PiB7XG4gICAgLy9cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jbGFzcyBQYWdlIHtcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBlbGVtZW50LCBwYXRobmFtZSwgYmVmb3JlSGlkZSwgYWZ0ZXJIaWRlLCBiZWZvcmVTaG93LCBhZnRlclNob3cpIHtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICAgICAgdGhpcy5wYXRobmFtZSA9IHBhdGhuYW1lO1xuICAgICAgICB0aGlzLmJlZm9yZUhpZGUgPSBiZWZvcmVIaWRlO1xuICAgICAgICB0aGlzLmFmdGVySGlkZSA9IGFmdGVySGlkZTtcbiAgICAgICAgdGhpcy5iZWZvcmVTaG93ID0gYmVmb3JlU2hvdztcbiAgICAgICAgdGhpcy5hZnRlclNob3cgPSBhZnRlclNob3c7XG4gICAgfVxufVxuZXhwb3J0cy5kZWZhdWx0ID0gUGFnZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucGFnZSA9IGV4cG9ydHMuc2V0RXZlbnREaXNhYmxlZCA9IGV4cG9ydHMudXBkYXRlID0gZXhwb3J0cy5zaG93QWNjb3VudFNlY3Rpb24gPSBleHBvcnRzLnVwZGF0ZUF1dGhTZWN0aW9ucyA9IGV4cG9ydHMudXBkYXRlRGlzY29yZFNlY3Rpb24gPSBleHBvcnRzLmhpZGVBY2NvdW50U2VjdGlvbiA9IGV4cG9ydHMuZmlsbFNldHRpbmdzUGFnZSA9IGV4cG9ydHMucmVzZXQgPSBleHBvcnRzLmdyb3VwcyA9IHZvaWQgMDtcbmNvbnN0IHNldHRpbmdzX2dyb3VwXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL3NldHRpbmdzL3NldHRpbmdzLWdyb3VwXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpLCBVcGRhdGVDb25maWcgPSBjb25maWdfMTtcbmNvbnN0IFNvdW5kID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9zb3VuZC1jb250cm9sbGVyXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IEZ1bmJveCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9mdW5ib3hcIikpO1xuY29uc3QgVGFnQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvdGFnLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgUHJlc2V0Q29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvcHJlc2V0LWNvbnRyb2xsZXJcIikpO1xuY29uc3QgVGhlbWVQaWNrZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3NldHRpbmdzL3RoZW1lLXBpY2tlclwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IEltcG9ydEV4cG9ydFNldHRpbmdzUG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BvcHVwcy9pbXBvcnQtZXhwb3J0LXNldHRpbmdzLXBvcHVwXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuY29uc3QgQWN0aXZlUGFnZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL2FjdGl2ZS1wYWdlXCIpKTtcbmNvbnN0IEFwZUtleXNQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcG9wdXBzL2FwZS1rZXlzLXBvcHVwXCIpKTtcbmNvbnN0IHBhZ2VfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9wYWdlXCIpKTtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi4vZmlyZWJhc2VcIik7XG5leHBvcnRzLmdyb3VwcyA9IHt9O1xuZnVuY3Rpb24gaW5pdEdyb3VwcygpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICB5aWVsZCBVcGRhdGVDb25maWcubG9hZFByb21pc2U7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic21vb3RoQ2FyZXRcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwic21vb3RoQ2FyZXRcIiwgVXBkYXRlQ29uZmlnLnNldFNtb290aENhcmV0LCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJkaWZmaWN1bHR5XCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImRpZmZpY3VsdHlcIiwgVXBkYXRlQ29uZmlnLnNldERpZmZpY3VsdHksIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInF1aWNrVGFiXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInF1aWNrVGFiXCIsIFVwZGF0ZUNvbmZpZy5zZXRRdWlja1RhYk1vZGUsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInNob3dMaXZlV3BtXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInNob3dMaXZlV3BtXCIsIFVwZGF0ZUNvbmZpZy5zZXRTaG93TGl2ZVdwbSwgXCJidXR0b25cIiwgKCkgPT4ge1xuICAgICAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJrZXltYXBNb2RlXCJdLnVwZGF0ZUlucHV0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInNob3dMaXZlQWNjXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInNob3dMaXZlQWNjXCIsIFVwZGF0ZUNvbmZpZy5zZXRTaG93TGl2ZUFjYywgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic2hvd0xpdmVCdXJzdFwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJzaG93TGl2ZUJ1cnN0XCIsIFVwZGF0ZUNvbmZpZy5zZXRTaG93TGl2ZUJ1cnN0LCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzaG93VGltZXJQcm9ncmVzc1wiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJzaG93VGltZXJQcm9ncmVzc1wiLCBVcGRhdGVDb25maWcuc2V0U2hvd1RpbWVyUHJvZ3Jlc3MsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInNob3dBdmVyYWdlXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInNob3dBdmVyYWdlXCIsIFVwZGF0ZUNvbmZpZy5zZXRTaG93QXZlcmFnZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wia2V5bWFwTW9kZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJrZXltYXBNb2RlXCIsIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBNb2RlLCBcImJ1dHRvblwiLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInNob3dMaXZlV3BtXCJdLnVwZGF0ZUlucHV0KCk7XG4gICAgICAgIH0sICgpID0+IHtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmtleW1hcE1vZGUgPT09IFwib2ZmXCIpIHtcbiAgICAgICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5rZXltYXBTdHlsZVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5rZXltYXBMYXlvdXRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ua2V5bWFwTGVnZW5kU3R5bGVcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5rZXltYXBTdHlsZVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5rZXltYXBMYXlvdXRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ua2V5bWFwTGVnZW5kU3R5bGVcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImtleW1hcE1hdHJpeFwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJrZXltYXBTdHlsZVwiLCBVcGRhdGVDb25maWcuc2V0S2V5bWFwU3R5bGUsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImtleW1hcExheW91dFwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJrZXltYXBMYXlvdXRcIiwgVXBkYXRlQ29uZmlnLnNldEtleW1hcExheW91dCwgXCJzZWxlY3RcIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wia2V5bWFwTGVnZW5kU3R5bGVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwia2V5bWFwTGVnZW5kU3R5bGVcIiwgVXBkYXRlQ29uZmlnLnNldEtleW1hcExlZ2VuZFN0eWxlLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzaG93S2V5VGlwc1wiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJzaG93S2V5VGlwc1wiLCBVcGRhdGVDb25maWcuc2V0S2V5VGlwcywgXCJidXR0b25cIiwgdW5kZWZpbmVkLCAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zaG93S2V5VGlwcykge1xuICAgICAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC50aXBcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAudGlwXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJmcmVlZG9tTW9kZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJmcmVlZG9tTW9kZVwiLCBVcGRhdGVDb25maWcuc2V0RnJlZWRvbU1vZGUsIFwiYnV0dG9uXCIsICgpID0+IHtcbiAgICAgICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiY29uZmlkZW5jZU1vZGVcIl0udXBkYXRlSW5wdXQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic3RyaWN0U3BhY2VcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwic3RyaWN0U3BhY2VcIiwgVXBkYXRlQ29uZmlnLnNldFN0cmljdFNwYWNlLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJvcHBvc2l0ZVNoaWZ0TW9kZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJvcHBvc2l0ZVNoaWZ0TW9kZVwiLCBVcGRhdGVDb25maWcuc2V0T3Bwb3NpdGVTaGlmdE1vZGUsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImNvbmZpZGVuY2VNb2RlXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImNvbmZpZGVuY2VNb2RlXCIsIFVwZGF0ZUNvbmZpZy5zZXRDb25maWRlbmNlTW9kZSwgXCJidXR0b25cIiwgKCkgPT4ge1xuICAgICAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJmcmVlZG9tTW9kZVwiXS51cGRhdGVJbnB1dCgpO1xuICAgICAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzdG9wT25FcnJvclwiXS51cGRhdGVJbnB1dCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJpbmRpY2F0ZVR5cG9zXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImluZGljYXRlVHlwb3NcIiwgVXBkYXRlQ29uZmlnLnNldEluZGljYXRlVHlwb3MsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImhpZGVFeHRyYUxldHRlcnNcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiaGlkZUV4dHJhTGV0dGVyc1wiLCBVcGRhdGVDb25maWcuc2V0SGlkZUV4dHJhTGV0dGVycywgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiYmxpbmRNb2RlXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImJsaW5kTW9kZVwiLCBVcGRhdGVDb25maWcuc2V0QmxpbmRNb2RlLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJxdWlja0VuZFwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJxdWlja0VuZFwiLCBVcGRhdGVDb25maWcuc2V0UXVpY2tFbmQsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInJlcGVhdFF1b3Rlc1wiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJyZXBlYXRRdW90ZXNcIiwgVXBkYXRlQ29uZmlnLnNldFJlcGVhdFF1b3RlcywgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiZW5hYmxlQWRzXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImVuYWJsZUFkc1wiLCBVcGRhdGVDb25maWcuc2V0RW5hYmxlQWRzLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJhbHdheXNTaG93V29yZHNIaXN0b3J5XCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImFsd2F5c1Nob3dXb3Jkc0hpc3RvcnlcIiwgVXBkYXRlQ29uZmlnLnNldEFsd2F5c1Nob3dXb3Jkc0hpc3RvcnksIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImJyaXRpc2hFbmdsaXNoXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImJyaXRpc2hFbmdsaXNoXCIsIFVwZGF0ZUNvbmZpZy5zZXRCcml0aXNoRW5nbGlzaCwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic2luZ2xlTGlzdENvbW1hbmRMaW5lXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInNpbmdsZUxpc3RDb21tYW5kTGluZVwiLCBVcGRhdGVDb25maWcuc2V0U2luZ2xlTGlzdENvbW1hbmRMaW5lLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJjYXBzTG9ja1dhcm5pbmdcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiY2Fwc0xvY2tXYXJuaW5nXCIsIFVwZGF0ZUNvbmZpZy5zZXRDYXBzTG9ja1dhcm5pbmcsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImZsaXBUZXN0Q29sb3JzXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImZsaXBUZXN0Q29sb3JzXCIsIFVwZGF0ZUNvbmZpZy5zZXRGbGlwVGVzdENvbG9ycywgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic3dhcEVzY0FuZFRhYlwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJzd2FwRXNjQW5kVGFiXCIsIFVwZGF0ZUNvbmZpZy5zZXRTd2FwRXNjQW5kVGFiLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzaG93T3V0T2ZGb2N1c1dhcm5pbmdcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwic2hvd091dE9mRm9jdXNXYXJuaW5nXCIsIFVwZGF0ZUNvbmZpZy5zZXRTaG93T3V0T2ZGb2N1c1dhcm5pbmcsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImNvbG9yZnVsTW9kZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJjb2xvcmZ1bE1vZGVcIiwgVXBkYXRlQ29uZmlnLnNldENvbG9yZnVsTW9kZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic3RhcnRHcmFwaHNBdFplcm9cIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwic3RhcnRHcmFwaHNBdFplcm9cIiwgVXBkYXRlQ29uZmlnLnNldFN0YXJ0R3JhcGhzQXRaZXJvLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJhdXRvU3dpdGNoVGhlbWVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiYXV0b1N3aXRjaFRoZW1lXCIsIFVwZGF0ZUNvbmZpZy5zZXRBdXRvU3dpdGNoVGhlbWUsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInJhbmRvbVRoZW1lXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInJhbmRvbVRoZW1lXCIsIFVwZGF0ZUNvbmZpZy5zZXRSYW5kb21UaGVtZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic3RvcE9uRXJyb3JcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwic3RvcE9uRXJyb3JcIiwgVXBkYXRlQ29uZmlnLnNldFN0b3BPbkVycm9yLCBcImJ1dHRvblwiLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImNvbmZpZGVuY2VNb2RlXCJdLnVwZGF0ZUlucHV0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInNvdW5kVm9sdW1lXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInNvdW5kVm9sdW1lXCIsIFVwZGF0ZUNvbmZpZy5zZXRTb3VuZFZvbHVtZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wicGxheVNvdW5kT25FcnJvclwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJwbGF5U291bmRPbkVycm9yXCIsIFVwZGF0ZUNvbmZpZy5zZXRQbGF5U291bmRPbkVycm9yLCBcImJ1dHRvblwiLCAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5wbGF5U291bmRPbkVycm9yKVxuICAgICAgICAgICAgICAgIFNvdW5kLnBsYXlFcnJvcigpO1xuICAgICAgICB9KTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJwbGF5U291bmRPbkNsaWNrXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInBsYXlTb3VuZE9uQ2xpY2tcIiwgVXBkYXRlQ29uZmlnLnNldFBsYXlTb3VuZE9uQ2xpY2ssIFwiYnV0dG9uXCIsICgpID0+IHtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnBsYXlTb3VuZE9uQ2xpY2sgIT09IFwib2ZmXCIpXG4gICAgICAgICAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInNob3dBbGxMaW5lc1wiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJzaG93QWxsTGluZXNcIiwgVXBkYXRlQ29uZmlnLnNldFNob3dBbGxMaW5lcywgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wicGFjZUNhcmV0XCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInBhY2VDYXJldFwiLCBVcGRhdGVDb25maWcuc2V0UGFjZUNhcmV0LCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJyZXBlYXRlZFBhY2VcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwicmVwZWF0ZWRQYWNlXCIsIFVwZGF0ZUNvbmZpZy5zZXRSZXBlYXRlZFBhY2UsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcIm1pbldwbVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJtaW5XcG1cIiwgVXBkYXRlQ29uZmlnLnNldE1pbldwbSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wibWluQWNjXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcIm1pbkFjY1wiLCBVcGRhdGVDb25maWcuc2V0TWluQWNjLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJtaW5CdXJzdFwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJtaW5CdXJzdFwiLCBVcGRhdGVDb25maWcuc2V0TWluQnVyc3QsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInNtb290aExpbmVTY3JvbGxcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwic21vb3RoTGluZVNjcm9sbFwiLCBVcGRhdGVDb25maWcuc2V0U21vb3RoTGluZVNjcm9sbCwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wibGF6eU1vZGVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwibGF6eU1vZGVcIiwgVXBkYXRlQ29uZmlnLnNldExhenlNb2RlLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJsYXlvdXRcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwibGF5b3V0XCIsIFVwZGF0ZUNvbmZpZy5zZXRMYXlvdXQsIFwic2VsZWN0XCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImxhbmd1YWdlXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImxhbmd1YWdlXCIsIFVwZGF0ZUNvbmZpZy5zZXRMYW5ndWFnZSwgXCJzZWxlY3RcIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiZm9udFNpemVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiZm9udFNpemVcIiwgVXBkYXRlQ29uZmlnLnNldEZvbnRTaXplLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJwYWdlV2lkdGhcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwicGFnZVdpZHRoXCIsIFVwZGF0ZUNvbmZpZy5zZXRQYWdlV2lkdGgsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImNhcmV0U3R5bGVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiY2FyZXRTdHlsZVwiLCBVcGRhdGVDb25maWcuc2V0Q2FyZXRTdHlsZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wicGFjZUNhcmV0U3R5bGVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwicGFjZUNhcmV0U3R5bGVcIiwgVXBkYXRlQ29uZmlnLnNldFBhY2VDYXJldFN0eWxlLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJ0aW1lclN0eWxlXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInRpbWVyU3R5bGVcIiwgVXBkYXRlQ29uZmlnLnNldFRpbWVyU3R5bGUsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImhpZ2hsaWdodE1vZGVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiaGlnaGxpZ2h0TW9kZVwiLCBVcGRhdGVDb25maWcuc2V0SGlnaGxpZ2h0TW9kZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1widGltZXJPcGFjaXR5XCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInRpbWVyT3BhY2l0eVwiLCBVcGRhdGVDb25maWcuc2V0VGltZXJPcGFjaXR5LCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJ0aW1lckNvbG9yXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInRpbWVyQ29sb3JcIiwgVXBkYXRlQ29uZmlnLnNldFRpbWVyQ29sb3IsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImZvbnRGYW1pbHlcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiZm9udEZhbWlseVwiLCBVcGRhdGVDb25maWcuc2V0Rm9udEZhbWlseSwgXCJidXR0b25cIiwgdW5kZWZpbmVkLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjdXN0b21CdXR0b24gPSAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5mb250RmFtaWx5IC5idXR0b25zIC5jdXN0b21cIik7XG4gICAgICAgICAgICBpZiAoJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZm9udEZhbWlseSAuYnV0dG9ucyAuYWN0aXZlXCIpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGN1c3RvbUJ1dHRvbi5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICBjdXN0b21CdXR0b24udGV4dChgQ3VzdG9tICgke2NvbmZpZ18xLmRlZmF1bHQuZm9udEZhbWlseS5yZXBsYWNlKC9fL2csIFwiIFwiKX0pYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjdXN0b21CdXR0b24udGV4dChcIkN1c3RvbVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiYWx3YXlzU2hvd0RlY2ltYWxQbGFjZXNcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiYWx3YXlzU2hvd0RlY2ltYWxQbGFjZXNcIiwgVXBkYXRlQ29uZmlnLnNldEFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJhbHdheXNTaG93Q1BNXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImFsd2F5c1Nob3dDUE1cIiwgVXBkYXRlQ29uZmlnLnNldEFsd2F5c1Nob3dDUE0sIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImN1c3RvbUJhY2tncm91bmRTaXplXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImN1c3RvbUJhY2tncm91bmRTaXplXCIsIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21CYWNrZ3JvdW5kU2l6ZSwgXCJidXR0b25cIik7XG4gICAgICAgIC8vIGdyb3Vwcy5jdXN0b21MYXlvdXRmbHVpZCA9IG5ldyBTZXR0aW5nc0dyb3VwKFxuICAgICAgICAvLyAgIFwiY3VzdG9tTGF5b3V0Zmx1aWRcIixcbiAgICAgICAgLy8gICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tTGF5b3V0Zmx1aWRcbiAgICAgICAgLy8gKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHJlc2V0KCkge1xuICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAuZmF2VGhlbWVzLmJ1dHRvbnNcIikuZW1wdHkoKTtcbiAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLmFsbFRoZW1lcy5idXR0b25zXCIpLmVtcHR5KCk7XG4gICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC5hbGxDdXN0b21UaGVtZXMuYnV0dG9uc1wiKS5lbXB0eSgpO1xuICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmxhbmd1YWdlR3JvdXBzIC5idXR0b25zXCIpLmVtcHR5KCk7XG4gICAgJChcIi5wYWdlU2V0dGluZ3Mgc2VsZWN0XCIpLmVtcHR5KCkuc2VsZWN0MihcImRlc3Ryb3lcIik7XG4gICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZnVuYm94IC5idXR0b25zXCIpLmVtcHR5KCk7XG4gICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZm9udEZhbWlseSAuYnV0dG9uc1wiKS5lbXB0eSgpO1xufVxuZXhwb3J0cy5yZXNldCA9IHJlc2V0O1xubGV0IGdyb3Vwc0luaXRpYWxpemVkID0gZmFsc2U7XG5mdW5jdGlvbiBmaWxsU2V0dGluZ3NQYWdlKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnNob3dLZXlUaXBzKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAudGlwXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnRpcFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBMYW5ndWFnZSBTZWxlY3Rpb24gQ29tYm9ib3hcbiAgICAgICAgY29uc3QgbGFuZ3VhZ2VFbCA9ICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmxhbmd1YWdlIHNlbGVjdFwiKS5lbXB0eSgpO1xuICAgICAgICBjb25zdCBsYW5ndWFnZUdyb3VwcyA9IHlpZWxkIE1pc2MuZ2V0TGFuZ3VhZ2VHcm91cHMoKTtcbiAgICAgICAgbGFuZ3VhZ2VHcm91cHMuZm9yRWFjaCgoZ3JvdXApID0+IHtcbiAgICAgICAgICAgIGxldCBsYW5nQ29tYm9Cb3ggPSBgPG9wdGdyb3VwIGxhYmVsPVwiJHtncm91cC5uYW1lfVwiPmA7XG4gICAgICAgICAgICBncm91cC5sYW5ndWFnZXMuZm9yRWFjaCgobGFuZ3VhZ2UpID0+IHtcbiAgICAgICAgICAgICAgICBsYW5nQ29tYm9Cb3ggKz0gYDxvcHRpb24gdmFsdWU9XCIke2xhbmd1YWdlfVwiPlxuICAgICAgICAke2xhbmd1YWdlLnJlcGxhY2UoL18vZywgXCIgXCIpfVxuICAgICAgPC9vcHRpb24+YDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGFuZ0NvbWJvQm94ICs9IGA8L29wdGdyb3VwPmA7XG4gICAgICAgICAgICBsYW5ndWFnZUVsLmFwcGVuZChsYW5nQ29tYm9Cb3gpO1xuICAgICAgICB9KTtcbiAgICAgICAgbGFuZ3VhZ2VFbC5zZWxlY3QyKHtcbiAgICAgICAgICAgIHdpZHRoOiBcIjEwMCVcIixcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGxheW91dEVsID0gJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubGF5b3V0IHNlbGVjdFwiKS5lbXB0eSgpO1xuICAgICAgICBsYXlvdXRFbC5hcHBlbmQoYDxvcHRpb24gdmFsdWU9J2RlZmF1bHQnPm9mZjwvb3B0aW9uPmApO1xuICAgICAgICBPYmplY3Qua2V5cyh5aWVsZCBNaXNjLmdldExheW91dHNMaXN0KCkpLmZvckVhY2goKGxheW91dCkgPT4ge1xuICAgICAgICAgICAgbGF5b3V0RWwuYXBwZW5kKGA8b3B0aW9uIHZhbHVlPScke2xheW91dH0nPiR7bGF5b3V0LnJlcGxhY2UoL18vZywgXCIgXCIpfTwvb3B0aW9uPmApO1xuICAgICAgICB9KTtcbiAgICAgICAgbGF5b3V0RWwuc2VsZWN0Mih7XG4gICAgICAgICAgICB3aWR0aDogXCIxMDAlXCIsXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBrZXltYXBFbCA9ICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmtleW1hcExheW91dCBzZWxlY3RcIikuZW1wdHkoKTtcbiAgICAgICAga2V5bWFwRWwuYXBwZW5kKGA8b3B0aW9uIHZhbHVlPSdvdmVycmlkZVN5bmMnPmVtdWxhdG9yIHN5bmM8L29wdGlvbj5gKTtcbiAgICAgICAgT2JqZWN0LmtleXMoeWllbGQgTWlzYy5nZXRMYXlvdXRzTGlzdCgpKS5mb3JFYWNoKChsYXlvdXQpID0+IHtcbiAgICAgICAgICAgIGlmIChsYXlvdXQudG9TdHJpbmcoKSAhPSBcImRlZmF1bHRcIikge1xuICAgICAgICAgICAgICAgIGtleW1hcEVsLmFwcGVuZChgPG9wdGlvbiB2YWx1ZT0nJHtsYXlvdXR9Jz4ke2xheW91dC5yZXBsYWNlKC9fL2csIFwiIFwiKX08L29wdGlvbj5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGtleW1hcEVsLnNlbGVjdDIoe1xuICAgICAgICAgICAgd2lkdGg6IFwiMTAwJVwiLFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgdGhlbWVFbDEgPSAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5hdXRvU3dpdGNoVGhlbWVJbnB1dHMgc2VsZWN0LmxpZ2h0XCIpLmVtcHR5KCk7XG4gICAgICAgIGNvbnN0IHRoZW1lRWwyID0gJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uYXV0b1N3aXRjaFRoZW1lSW5wdXRzIHNlbGVjdC5kYXJrXCIpLmVtcHR5KCk7XG4gICAgICAgIGZvciAoY29uc3QgdGhlbWUgb2YgeWllbGQgTWlzYy5nZXRUaGVtZXNMaXN0KCkpIHtcbiAgICAgICAgICAgIHRoZW1lRWwxLmFwcGVuZChgPG9wdGlvbiB2YWx1ZT0nJHt0aGVtZS5uYW1lfSc+JHt0aGVtZS5uYW1lLnJlcGxhY2UoL18vZywgXCIgXCIpfTwvb3B0aW9uPmApO1xuICAgICAgICAgICAgdGhlbWVFbDIuYXBwZW5kKGA8b3B0aW9uIHZhbHVlPScke3RoZW1lLm5hbWV9Jz4ke3RoZW1lLm5hbWUucmVwbGFjZSgvXy9nLCBcIiBcIil9PC9vcHRpb24+YCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhlbWVFbDEuc2VsZWN0Mih7XG4gICAgICAgICAgICB3aWR0aDogXCIxMDAlXCIsXG4gICAgICAgIH0pO1xuICAgICAgICB0aGVtZUVsMi5zZWxlY3QyKHtcbiAgICAgICAgICAgIHdpZHRoOiBcIjEwMCVcIixcbiAgICAgICAgfSk7XG4gICAgICAgICQoYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uYXV0b1N3aXRjaFRoZW1lSW5wdXRzIHNlbGVjdC5saWdodGApXG4gICAgICAgICAgICAudmFsKGNvbmZpZ18xLmRlZmF1bHQudGhlbWVMaWdodClcbiAgICAgICAgICAgIC50cmlnZ2VyKFwiY2hhbmdlLnNlbGVjdDJcIik7XG4gICAgICAgICQoYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uYXV0b1N3aXRjaFRoZW1lSW5wdXRzIHNlbGVjdC5kYXJrYClcbiAgICAgICAgICAgIC52YWwoY29uZmlnXzEuZGVmYXVsdC50aGVtZURhcmspXG4gICAgICAgICAgICAudHJpZ2dlcihcImNoYW5nZS5zZWxlY3QyXCIpO1xuICAgICAgICBjb25zdCBmdW5ib3hFbCA9ICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmZ1bmJveCAuYnV0dG9uc1wiKS5lbXB0eSgpO1xuICAgICAgICBmdW5ib3hFbC5hcHBlbmQoYDxkaXYgY2xhc3M9XCJmdW5ib3ggYnV0dG9uXCIgZnVuYm94PSdub25lJz5ub25lPC9kaXY+YCk7XG4gICAgICAgIE1pc2MuZ2V0RnVuYm94TGlzdCgpLnRoZW4oKGZ1bmJveE1vZGVzKSA9PiB7XG4gICAgICAgICAgICBmdW5ib3hNb2Rlcy5mb3JFYWNoKChmdW5ib3gpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZnVuYm94Lm5hbWUgPT09IFwibWlycm9yXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZnVuYm94RWwuYXBwZW5kKGA8ZGl2IGNsYXNzPVwiZnVuYm94IGJ1dHRvblwiIGZ1bmJveD0nJHtmdW5ib3gubmFtZX0nIGFyaWEtbGFiZWw9XCIke2Z1bmJveC5pbmZvfVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiIGRhdGEtYmFsbG9vbi1sZW5ndGg9XCJmaXRcIiB0eXBlPVwiJHtmdW5ib3gudHlwZX1cIiBzdHlsZT1cInRyYW5zZm9ybTpzY2FsZVgoLTEpO1wiPiR7ZnVuYm94Lm5hbWUucmVwbGFjZSgvXy9nLCBcIiBcIil9PC9kaXY+YCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmdW5ib3hFbC5hcHBlbmQoYDxkaXYgY2xhc3M9XCJmdW5ib3ggYnV0dG9uXCIgZnVuYm94PScke2Z1bmJveC5uYW1lfScgYXJpYS1sYWJlbD1cIiR7ZnVuYm94LmluZm99XCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCIgZGF0YS1iYWxsb29uLWxlbmd0aD1cImZpdFwiIHR5cGU9XCIke2Z1bmJveC50eXBlfVwiPiR7ZnVuYm94Lm5hbWUucmVwbGFjZSgvXy9nLCBcIiBcIil9PC9kaXY+YCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBsZXQgaXNDdXN0b21Gb250ID0gdHJ1ZTtcbiAgICAgICAgY29uc3QgZm9udHNFbCA9ICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmZvbnRGYW1pbHkgLmJ1dHRvbnNcIikuZW1wdHkoKTtcbiAgICAgICAgTWlzYy5nZXRGb250c0xpc3QoKS50aGVuKChmb250cykgPT4ge1xuICAgICAgICAgICAgZm9udHMuZm9yRWFjaCgoZm9udCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZvbnRGYW1pbHkgPT09IGZvbnQubmFtZSlcbiAgICAgICAgICAgICAgICAgICAgaXNDdXN0b21Gb250ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgZm9udHNFbC5hcHBlbmQoYDxkaXYgY2xhc3M9XCJidXR0b24ke2NvbmZpZ18xLmRlZmF1bHQuZm9udEZhbWlseSA9PT0gZm9udC5uYW1lID8gXCIgYWN0aXZlXCIgOiBcIlwifVwiIHN0eWxlPVwiZm9udC1mYW1pbHk6JHtmb250LmRpc3BsYXkgIT09IHVuZGVmaW5lZCA/IGZvbnQuZGlzcGxheSA6IGZvbnQubmFtZX1cIiBmb250RmFtaWx5PVwiJHtmb250Lm5hbWUucmVwbGFjZSgvIC9nLCBcIl9cIil9XCIgdGFiaW5kZXg9XCIwXCJcbiAgICAgICAgb25jbGljaz1cInRoaXMuYmx1cigpO1wiPiR7Zm9udC5kaXNwbGF5ICE9PSB1bmRlZmluZWQgPyBmb250LmRpc3BsYXkgOiBmb250Lm5hbWV9PC9kaXY+YCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGZvbnRzRWwuYXBwZW5kKGlzQ3VzdG9tRm9udFxuICAgICAgICAgICAgICAgID8gYDxkaXYgY2xhc3M9XCJidXR0b24gbm8tYXV0by1oYW5kbGUgY3VzdG9tIGFjdGl2ZVwiIG9uY2xpY2s9XCJ0aGlzLmJsdXIoKTtcIj5DdXN0b20gKCR7Y29uZmlnXzEuZGVmYXVsdC5mb250RmFtaWx5LnJlcGxhY2UoL18vZywgXCIgXCIpfSk8L2Rpdj5gXG4gICAgICAgICAgICAgICAgOiAnPGRpdiBjbGFzcz1cImJ1dHRvbiBuby1hdXRvLWhhbmRsZSBjdXN0b21cIiBvbmNsaWNrPVwidGhpcy5ibHVyKCk7XCI+Q3VzdG9tPC9kaXY+Jyk7XG4gICAgICAgIH0pO1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kU2l6ZSBpbnB1dFwiKS52YWwoY29uZmlnXzEuZGVmYXVsdC5jdXN0b21CYWNrZ3JvdW5kKTtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uY3VzdG9tTGF5b3V0Zmx1aWQgaW5wdXRcIikudmFsKGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tTGF5b3V0Zmx1aWQucmVwbGFjZSgvIy9nLCBcIiBcIikpO1xuICAgICAgICBzZXRFdmVudERpc2FibGVkKHRydWUpO1xuICAgICAgICBpZiAoIWdyb3Vwc0luaXRpYWxpemVkKSB7XG4gICAgICAgICAgICB5aWVsZCBpbml0R3JvdXBzKCk7XG4gICAgICAgICAgICBncm91cHNJbml0aWFsaXplZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhleHBvcnRzLmdyb3VwcykuZm9yRWFjaCgoZ3JvdXBLZXkpID0+IHtcbiAgICAgICAgICAgICAgICBleHBvcnRzLmdyb3Vwc1tncm91cEtleV0udXBkYXRlSW5wdXQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHNldEV2ZW50RGlzYWJsZWQoZmFsc2UpO1xuICAgICAgICB5aWVsZCBUaGVtZVBpY2tlci5yZWZyZXNoQnV0dG9ucygpO1xuICAgICAgICB5aWVsZCBVcGRhdGVDb25maWcubG9hZFByb21pc2U7XG4gICAgfSk7XG59XG5leHBvcnRzLmZpbGxTZXR0aW5nc1BhZ2UgPSBmaWxsU2V0dGluZ3NQYWdlO1xuLy8gZXhwb3J0IGxldCBzZXR0aW5nc0ZpbGxQcm9taXNlID0gZmlsbFNldHRpbmdzUGFnZSgpO1xuZnVuY3Rpb24gaGlkZUFjY291bnRTZWN0aW9uKCkge1xuICAgICQoYC5zZWN0aW9uR3JvdXBUaXRsZVtncm91cD0nYWNjb3VudCddYCkuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgJChgLnNldHRpbmdzR3JvdXAuYWNjb3VudGApLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICQoYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubmVlZHNBY2NvdW50YCkuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG59XG5leHBvcnRzLmhpZGVBY2NvdW50U2VjdGlvbiA9IGhpZGVBY2NvdW50U2VjdGlvbjtcbmZ1bmN0aW9uIHVwZGF0ZURpc2NvcmRTZWN0aW9uKCkge1xuICAgIC8vbm8gY29kZSBhbmQgbm8gZGlzY29yZFxuICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgPT0gbnVsbCkge1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5kaXNjb3JkSW50ZWdyYXRpb25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoREIuZ2V0U25hcHNob3QoKSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5kaXNjb3JkSW50ZWdyYXRpb25cIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIGlmIChEQi5nZXRTbmFwc2hvdCgpLmRpc2NvcmRJZCA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIC8vc2hvdyBidXR0b25cbiAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmRpc2NvcmRJbnRlZ3JhdGlvbiAuYnV0dG9uc1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmRpc2NvcmRJbnRlZ3JhdGlvbiAuaW5mb1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmRpc2NvcmRJbnRlZ3JhdGlvbiAuYnV0dG9uc1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmRpc2NvcmRJbnRlZ3JhdGlvbiAuaW5mb1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMudXBkYXRlRGlzY29yZFNlY3Rpb24gPSB1cGRhdGVEaXNjb3JkU2VjdGlvbjtcbmZ1bmN0aW9uIHVwZGF0ZUF1dGhTZWN0aW9ucygpIHtcbiAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5wYXNzd29yZEF1dGhTZXR0aW5ncyAuYnV0dG9uXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmdvb2dsZUF1dGhTZXR0aW5ncyAuYnV0dG9uXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIGNvbnN0IHVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgaWYgKCF1c2VyKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgcGFzc3dvcmRQcm92aWRlciA9IHVzZXIucHJvdmlkZXJEYXRhLmZpbmQoKHByb3ZpZGVyKSA9PiBwcm92aWRlci5wcm92aWRlcklkID09PSBcInBhc3N3b3JkXCIpO1xuICAgIGNvbnN0IGdvb2dsZVByb3ZpZGVyID0gdXNlci5wcm92aWRlckRhdGEuZmluZCgocHJvdmlkZXIpID0+IHByb3ZpZGVyLnByb3ZpZGVySWQgPT09IFwiZ29vZ2xlLmNvbVwiKTtcbiAgICBpZiAocGFzc3dvcmRQcm92aWRlcikge1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5wYXNzd29yZEF1dGhTZXR0aW5ncyAjZW1haWxQYXNzd29yZEF1dGhcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnBhc3N3b3JkQXV0aFNldHRpbmdzICNwYXNzUGFzc3dvcmRBdXRoXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ucGFzc3dvcmRBdXRoU2V0dGluZ3MgI2FkZFBhc3N3b3JkQXV0aFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgaWYgKGdvb2dsZVByb3ZpZGVyKSB7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmdvb2dsZUF1dGhTZXR0aW5ncyAjcmVtb3ZlR29vZ2xlQXV0aFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgaWYgKHBhc3N3b3JkUHJvdmlkZXIpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmdvb2dsZUF1dGhTZXR0aW5ncyAjcmVtb3ZlR29vZ2xlQXV0aFwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZ29vZ2xlQXV0aFNldHRpbmdzICNyZW1vdmVHb29nbGVBdXRoXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmdvb2dsZUF1dGhTZXR0aW5ncyAjYWRkR29vZ2xlQXV0aFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG59XG5leHBvcnRzLnVwZGF0ZUF1dGhTZWN0aW9ucyA9IHVwZGF0ZUF1dGhTZWN0aW9ucztcbmZ1bmN0aW9uIHNldEFjdGl2ZUZ1bmJveEJ1dHRvbigpIHtcbiAgICAkKGAucGFnZVNldHRpbmdzIC5zZWN0aW9uLmZ1bmJveCAuYnV0dG9uYCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgJChgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5mdW5ib3ggLmJ1dHRvbltmdW5ib3g9JyR7Y29uZmlnXzEuZGVmYXVsdC5mdW5ib3h9J11gKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbn1cbmZ1bmN0aW9uIHJlZnJlc2hUYWdzU2V0dGluZ3NTZWN0aW9uKCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyICE9PSBudWxsICYmIERCLmdldFNuYXBzaG90KCkgIT09IG51bGwpIHtcbiAgICAgICAgY29uc3QgdGFnc0VsID0gJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGFncyAudGFnc0xpc3RcIikuZW1wdHkoKTtcbiAgICAgICAgKF9hID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgICAgICAvLyBsZXQgdGFnUGJTdHJpbmcgPSBcIk5vIFBCIGZvdW5kXCI7XG4gICAgICAgICAgICAvLyBpZiAodGFnLnBiICE9IHVuZGVmaW5lZCAmJiB0YWcucGIgPiAwKSB7XG4gICAgICAgICAgICAvLyAgIHRhZ1BiU3RyaW5nID0gYFBCOiAke3RhZy5wYn1gO1xuICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgdGFnc0VsLmFwcGVuZChgXG5cbiAgICAgIDxkaXYgY2xhc3M9XCJidXR0b25zIHRhZ1wiIGlkPVwiJHt0YWcuX2lkfVwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYnV0dG9uIHRhZ0J1dHRvbiAke3RhZy5hY3RpdmUgPyBcImFjdGl2ZVwiIDogXCJcIn1cIiBhY3RpdmU9XCIke3RhZy5hY3RpdmV9XCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cInRpdGxlXCI+JHt0YWcubmFtZX08L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjbGVhclBiQnV0dG9uIGJ1dHRvblwiPlxuICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLWNyb3duIGZhLWZ3XCI+PC9pPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImVkaXRCdXR0b24gYnV0dG9uXCI+XG4gICAgICAgICAgPGkgY2xhc3M9XCJmYXMgZmEtcGVuIGZhLWZ3XCI+PC9pPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInJlbW92ZUJ1dHRvbiBidXR0b25cIj5cbiAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS10cmFzaCBmYS1md1wiPjwvaT5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cblxuICAgICAgYCk7XG4gICAgICAgIH0pO1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50YWdzXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGFnc1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG59XG5mdW5jdGlvbiByZWZyZXNoUHJlc2V0c1NldHRpbmdzU2VjdGlvbigpIHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciAhPT0gbnVsbCAmJiBEQi5nZXRTbmFwc2hvdCgpICE9PSBudWxsKSB7XG4gICAgICAgIGNvbnN0IHByZXNldHNFbCA9ICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnByZXNldHMgLnByZXNldHNMaXN0XCIpLmVtcHR5KCk7XG4gICAgICAgIChfYSA9IERCLmdldFNuYXBzaG90KCkucHJlc2V0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHByZXNldCkgPT4ge1xuICAgICAgICAgICAgcHJlc2V0c0VsLmFwcGVuZChgXG4gICAgICA8ZGl2IGNsYXNzPVwiYnV0dG9ucyBwcmVzZXRcIiBpZD1cIiR7cHJlc2V0Ll9pZH1cIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImJ1dHRvbiBwcmVzZXRCdXR0b25cIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidGl0bGVcIj4ke3ByZXNldC5uYW1lfTwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImVkaXRCdXR0b24gYnV0dG9uXCI+XG4gICAgICAgICAgPGkgY2xhc3M9XCJmYXMgZmEtcGVuIGZhLWZ3XCI+PC9pPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInJlbW92ZUJ1dHRvbiBidXR0b25cIj5cbiAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS10cmFzaCBmYS1md1wiPjwvaT5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICAgIFxuICAgICAgYCk7XG4gICAgICAgIH0pO1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5wcmVzZXRzXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ucHJlc2V0c1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG59XG5mdW5jdGlvbiBzaG93QWNjb3VudFNlY3Rpb24oKSB7XG4gICAgJChgLnNlY3Rpb25Hcm91cFRpdGxlW2dyb3VwPSdhY2NvdW50J11gKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAkKGAuc2V0dGluZ3NHcm91cC5hY2NvdW50YCkucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgJChgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5uZWVkc0FjY291bnRgKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICByZWZyZXNoVGFnc1NldHRpbmdzU2VjdGlvbigpO1xuICAgIHJlZnJlc2hQcmVzZXRzU2V0dGluZ3NTZWN0aW9uKCk7XG4gICAgdXBkYXRlRGlzY29yZFNlY3Rpb24oKTtcbn1cbmV4cG9ydHMuc2hvd0FjY291bnRTZWN0aW9uID0gc2hvd0FjY291bnRTZWN0aW9uO1xuZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgIE9iamVjdC5rZXlzKGV4cG9ydHMuZ3JvdXBzKS5mb3JFYWNoKChncm91cCkgPT4ge1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tncm91cF0udXBkYXRlSW5wdXQoKTtcbiAgICB9KTtcbiAgICByZWZyZXNoVGFnc1NldHRpbmdzU2VjdGlvbigpO1xuICAgIHJlZnJlc2hQcmVzZXRzU2V0dGluZ3NTZWN0aW9uKCk7XG4gICAgLy8gTGFuZ3VhZ2VQaWNrZXIuc2V0QWN0aXZlR3JvdXAoKTsgU2hpZnRlZCBmcm9tIGdyb3VwZWQgYnRucyB0byBjb21iby1ib3hcbiAgICBzZXRBY3RpdmVGdW5ib3hCdXR0b24oKTtcbiAgICBUaGVtZVBpY2tlci51cGRhdGVBY3RpdmVUYWIodHJ1ZSk7XG4gICAgVGhlbWVQaWNrZXIuc2V0Q3VzdG9tSW5wdXRzKHRydWUpO1xuICAgIHVwZGF0ZURpc2NvcmRTZWN0aW9uKCk7XG4gICAgdXBkYXRlQXV0aFNlY3Rpb25zKCk7XG4gICAgLy8gVGhlbWVQaWNrZXIudXBkYXRlQWN0aXZlQnV0dG9uKCk7XG4gICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ucGFjZUNhcmV0IGlucHV0LmN1c3RvbVBhY2VDYXJldFNwZWVkXCIpLnZhbChjb25maWdfMS5kZWZhdWx0LnBhY2VDYXJldEN1c3RvbVNwZWVkKTtcbiAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5taW5XcG0gaW5wdXQuY3VzdG9tTWluV3BtU3BlZWRcIikudmFsKGNvbmZpZ18xLmRlZmF1bHQubWluV3BtQ3VzdG9tU3BlZWQpO1xuICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLm1pbkFjYyBpbnB1dC5jdXN0b21NaW5BY2NcIikudmFsKGNvbmZpZ18xLmRlZmF1bHQubWluQWNjQ3VzdG9tKTtcbiAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5taW5CdXJzdCBpbnB1dC5jdXN0b21NaW5CdXJzdFwiKS52YWwoY29uZmlnXzEuZGVmYXVsdC5taW5CdXJzdEN1c3RvbVNwZWVkKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hdXRvU3dpdGNoVGhlbWUpIHtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uYXV0b1N3aXRjaFRoZW1lSW5wdXRzXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uYXV0b1N3aXRjaFRoZW1lSW5wdXRzXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5jdXN0b21CYWNrZ3JvdW5kICE9PSBcIlwiKSB7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbn1cbmV4cG9ydHMudXBkYXRlID0gdXBkYXRlO1xuZnVuY3Rpb24gdG9nZ2xlU2V0dGluZ3NHcm91cChncm91cE5hbWUpIHtcbiAgICAkKGAucGFnZVNldHRpbmdzIC5zZXR0aW5nc0dyb3VwLiR7Z3JvdXBOYW1lfWApXG4gICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgIC5zbGlkZVRvZ2dsZSgyNTApXG4gICAgICAgIC50b2dnbGVDbGFzcyhcInNsaWRldXBcIik7XG4gICAgaWYgKCQoYC5wYWdlU2V0dGluZ3MgLnNldHRpbmdzR3JvdXAuJHtncm91cE5hbWV9YCkuaGFzQ2xhc3MoXCJzbGlkZXVwXCIpKSB7XG4gICAgICAgICQoYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb25Hcm91cFRpdGxlW2dyb3VwPSR7Z3JvdXBOYW1lfV0gLmZhc2ApXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgZGVnOiAtOTAsXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGR1cmF0aW9uOiAyNTAsXG4gICAgICAgICAgICBzdGVwOiBmdW5jdGlvbiAobm93KSB7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IFwicm90YXRlKFwiICsgbm93ICsgXCJkZWcpXCIsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb25Hcm91cFRpdGxlW2dyb3VwPSR7Z3JvdXBOYW1lfV0gLmZhc2ApXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgZGVnOiAwLFxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBkdXJhdGlvbjogMjUwLFxuICAgICAgICAgICAgc3RlcDogZnVuY3Rpb24gKG5vdykge1xuICAgICAgICAgICAgICAgICQodGhpcykuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOiBcInJvdGF0ZShcIiArIG5vdyArIFwiZGVnKVwiLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfVxufVxuJChkb2N1bWVudCkub24oXCJmb2N1c291dFwiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ucGFjZUNhcmV0IGlucHV0LmN1c3RvbVBhY2VDYXJldFNwZWVkXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0UGFjZUNhcmV0Q3VzdG9tU3BlZWQocGFyc2VJbnQoJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ucGFjZUNhcmV0IGlucHV0LmN1c3RvbVBhY2VDYXJldFNwZWVkXCIpLnZhbCgpKSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnBhY2VDYXJldCAuYnV0dG9uLnNhdmVcIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWNlQ2FyZXRDdXN0b21TcGVlZChwYXJzZUludCgkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5wYWNlQ2FyZXQgaW5wdXQuY3VzdG9tUGFjZUNhcmV0U3BlZWRcIikudmFsKCkpKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJmb2N1c291dFwiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubWluV3BtIGlucHV0LmN1c3RvbU1pbldwbVNwZWVkXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0TWluV3BtQ3VzdG9tU3BlZWQocGFyc2VJbnQoJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubWluV3BtIGlucHV0LmN1c3RvbU1pbldwbVNwZWVkXCIpLnZhbCgpKSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLm1pbldwbSAuYnV0dG9uLnNhdmVcIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRNaW5XcG1DdXN0b21TcGVlZChwYXJzZUludCgkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5taW5XcG0gaW5wdXQuY3VzdG9tTWluV3BtU3BlZWRcIikudmFsKCkpKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJmb2N1c291dFwiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubWluQWNjIGlucHV0LmN1c3RvbU1pbkFjY1wiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnNldE1pbkFjY0N1c3RvbShwYXJzZUludCgkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5taW5BY2MgaW5wdXQuY3VzdG9tTWluQWNjXCIpLnZhbCgpKSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLm1pbkFjYyAuYnV0dG9uLnNhdmVcIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRNaW5BY2NDdXN0b20ocGFyc2VJbnQoJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubWluQWNjIGlucHV0LmN1c3RvbU1pbkFjY1wiKS52YWwoKSkpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImZvY3Vzb3V0XCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5taW5CdXJzdCBpbnB1dC5jdXN0b21NaW5CdXJzdFwiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnNldE1pbkJ1cnN0Q3VzdG9tU3BlZWQocGFyc2VJbnQoJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubWluQnVyc3QgaW5wdXQuY3VzdG9tTWluQnVyc3RcIikudmFsKCkpKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubWluQnVyc3QgLmJ1dHRvbi5zYXZlXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0TWluQnVyc3RDdXN0b21TcGVlZChwYXJzZUludCgkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5taW5CdXJzdCBpbnB1dC5jdXN0b21NaW5CdXJzdFwiKS52YWwoKSkpO1xufSk7XG4vLyBDb21tZW50ZWQgYmVjYXVzZSBzdGFydGVkIHVzaW5nIGNvbWJvLWJveCBmb3IgY2hvb3NpbmcgbGFuZ3VhZ2VzIGluc3RlYWQgb2YgZ3JvdXBlZCBidXR0b25zXG4vLyBsYW5ndWFnZXNcbi8vICQoZG9jdW1lbnQpLm9uKFxuLy8gICBcImNsaWNrXCIsXG4vLyAgIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5sYW5ndWFnZUdyb3VwcyAuYnV0dG9uXCIsXG4vLyAgIChlKSA9PiB7XG4vLyAgICAgY29uc3QgZ3JvdXAgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcImdyb3VwXCIpO1xuLy8gICAgIExhbmd1YWdlUGlja2VyLnNldEFjdGl2ZUdyb3VwKGdyb3VwLCB0cnVlKTtcbi8vICAgfVxuLy8gKTtcbi8vZnVuYm94XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5mdW5ib3ggLmJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIGNvbnN0IGZ1bmJveCA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiZnVuYm94XCIpO1xuICAgIGNvbnN0IHR5cGUgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcInR5cGVcIik7XG4gICAgRnVuYm94LnNldEZ1bmJveChmdW5ib3gsIHR5cGUpO1xuICAgIHNldEFjdGl2ZUZ1bmJveEJ1dHRvbigpO1xufSk7XG4vL3RhZ3NcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRhZ3MgLnRhZ3NMaXN0IC50YWcgLnRhZ0J1dHRvblwiLCAoZSkgPT4ge1xuICAgIGNvbnN0IHRhcmdldCA9IGUuY3VycmVudFRhcmdldDtcbiAgICBjb25zdCB0YWdpZCA9ICQodGFyZ2V0KS5wYXJlbnQoXCIudGFnXCIpLmF0dHIoXCJpZFwiKTtcbiAgICBUYWdDb250cm9sbGVyLnRvZ2dsZSh0YWdpZCk7XG4gICAgJCh0YXJnZXQpLnRvZ2dsZUNsYXNzKFwiYWN0aXZlXCIpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5wcmVzZXRzIC5wcmVzZXRzTGlzdCAucHJlc2V0IC5wcmVzZXRCdXR0b25cIiwgKGUpID0+IHtcbiAgICBjb25zdCB0YXJnZXQgPSBlLmN1cnJlbnRUYXJnZXQ7XG4gICAgY29uc3QgcHJlc2V0aWQgPSAkKHRhcmdldCkucGFyZW50KFwiLnByZXNldFwiKS5hdHRyKFwiaWRcIik7XG4gICAgY29uc29sZS5sb2coXCJBcHBseWluZyBQcmVzZXRcIik7XG4gICAgY29uZmlnRXZlbnREaXNhYmxlZCA9IHRydWU7XG4gICAgUHJlc2V0Q29udHJvbGxlci5hcHBseShwcmVzZXRpZCk7XG4gICAgY29uZmlnRXZlbnREaXNhYmxlZCA9IGZhbHNlO1xuICAgIHVwZGF0ZSgpO1xufSk7XG4kKFwiI2ltcG9ydFNldHRpbmdzQnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIEltcG9ydEV4cG9ydFNldHRpbmdzUG9wdXAuc2hvdyhcImltcG9ydFwiKTtcbn0pO1xuJChcIiNleHBvcnRTZXR0aW5nc0J1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjb25zdCBjb25maWdKU09OID0gSlNPTi5zdHJpbmdpZnkoY29uZmlnXzEuZGVmYXVsdCk7XG4gICAgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQoY29uZmlnSlNPTikudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiSlNPTiBDb3BpZWQgdG8gY2xpcGJvYXJkXCIsIDApO1xuICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgSW1wb3J0RXhwb3J0U2V0dGluZ3NQb3B1cC5zaG93KFwiZXhwb3J0XCIpO1xuICAgIH0pO1xufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbkdyb3VwVGl0bGVcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIHRvZ2dsZVNldHRpbmdzR3JvdXAoJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJncm91cFwiKSk7XG59KTtcbiQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmFwZUtleXMgI3Nob3dBcGVLZXlzUG9wdXBcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgQXBlS2V5c1BvcHVwLnNob3coKTtcbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZFNpemUgLmlucHV0QW5kQnV0dG9uIC5zYXZlXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21CYWNrZ3JvdW5kKCQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRTaXplIC5pbnB1dEFuZEJ1dHRvbiBpbnB1dFwiKS52YWwoKSk7XG59KTtcbiQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRTaXplIC5pbnB1dEFuZEJ1dHRvbiBpbnB1dFwiKS5rZXlwcmVzcygoZSkgPT4ge1xuICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21CYWNrZ3JvdW5kKCQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRTaXplIC5pbnB1dEFuZEJ1dHRvbiBpbnB1dFwiKS52YWwoKSk7XG4gICAgfVxufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5jdXN0b21MYXlvdXRmbHVpZCAuaW5wdXRBbmRCdXR0b24gLnNhdmVcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbUxheW91dGZsdWlkKCQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmN1c3RvbUxheW91dGZsdWlkIC5pbnB1dEFuZEJ1dHRvbiBpbnB1dFwiKS52YWwoKSkudGhlbigoYm9vbCkgPT4ge1xuICAgICAgICBpZiAoYm9vbCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDdXN0b20gbGF5b3V0Zmx1aWQgc2F2ZWRcIiwgMSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uY3VzdG9tTGF5b3V0Zmx1aWQgLmlucHV0QW5kQnV0dG9uIC5pbnB1dFwiKS5rZXlwcmVzcygoZSkgPT4ge1xuICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21MYXlvdXRmbHVpZCgkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5jdXN0b21MYXlvdXRmbHVpZCAuaW5wdXRBbmRCdXR0b24gaW5wdXRcIikudmFsKCkpLnRoZW4oKGJvb2wpID0+IHtcbiAgICAgICAgICAgIGlmIChib29sKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDdXN0b20gbGF5b3V0Zmx1aWQgc2F2ZWRcIiwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn0pO1xuJChcIi5xdWlja05hdiAubGlua3MgYVwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgY29uc3Qgc2V0dGluZ3NHcm91cCA9IGUudGFyZ2V0LmlubmVyVGV4dDtcbiAgICBjb25zdCBpc09wZW4gPSAkKGAucGFnZVNldHRpbmdzIC5zZXR0aW5nc0dyb3VwLiR7c2V0dGluZ3NHcm91cH1gKS5oYXNDbGFzcyhcInNsaWRldXBcIik7XG4gICAgaXNPcGVuICYmIHRvZ2dsZVNldHRpbmdzR3JvdXAoc2V0dGluZ3NHcm91cCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2hhbmdlXCIsIGAucGFnZVNldHRpbmdzIC5zZWN0aW9uLmF1dG9Td2l0Y2hUaGVtZUlucHV0cyBzZWxlY3QubGlnaHRgLCAoZSkgPT4ge1xuICAgIGNvbnN0IHRhcmdldCA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICBpZiAodGFyZ2V0Lmhhc0NsYXNzKFwiZGlzYWJsZWRcIikgfHwgdGFyZ2V0Lmhhc0NsYXNzKFwibm8tYXV0by1oYW5kbGVcIikpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBVcGRhdGVDb25maWcuc2V0VGhlbWVMaWdodCh0YXJnZXQudmFsKCkpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNoYW5nZVwiLCBgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5hdXRvU3dpdGNoVGhlbWVJbnB1dHMgc2VsZWN0LmRhcmtgLCAoZSkgPT4ge1xuICAgIGNvbnN0IHRhcmdldCA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICBpZiAodGFyZ2V0Lmhhc0NsYXNzKFwiZGlzYWJsZWRcIikgfHwgdGFyZ2V0Lmhhc0NsYXNzKFwibm8tYXV0by1oYW5kbGVcIikpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBVcGRhdGVDb25maWcuc2V0VGhlbWVEYXJrKHRhcmdldC52YWwoKSk7XG59KTtcbmxldCBjb25maWdFdmVudERpc2FibGVkID0gZmFsc2U7XG5mdW5jdGlvbiBzZXRFdmVudERpc2FibGVkKHZhbHVlKSB7XG4gICAgY29uZmlnRXZlbnREaXNhYmxlZCA9IHZhbHVlO1xufVxuZXhwb3J0cy5zZXRFdmVudERpc2FibGVkID0gc2V0RXZlbnREaXNhYmxlZDtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXkpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiZnVsbENvbmZpZ0NoYW5nZVwiKVxuICAgICAgICBzZXRFdmVudERpc2FibGVkKHRydWUpO1xuICAgIGlmIChldmVudEtleSA9PT0gXCJmdWxsQ29uZmlnQ2hhbmdlRmluaXNoZWRcIikge1xuICAgICAgICBzZXRFdmVudERpc2FibGVkKGZhbHNlKTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ0V2ZW50RGlzYWJsZWQgfHwgZXZlbnRLZXkgPT09IFwic2F2ZVRvTG9jYWxTdG9yYWdlXCIpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoQWN0aXZlUGFnZS5nZXQoKSA9PT0gXCJzZXR0aW5nc1wiICYmIGV2ZW50S2V5ICE9PSBcInRoZW1lXCIpIHtcbiAgICAgICAgdXBkYXRlKCk7XG4gICAgfVxufSk7XG5leHBvcnRzLnBhZ2UgPSBuZXcgcGFnZV8xLmRlZmF1bHQoXCJzZXR0aW5nc1wiLCAkKFwiLnBhZ2UucGFnZVNldHRpbmdzXCIpLCBcIi9zZXR0aW5nc1wiLCAoKSA9PiB7XG4gICAgLy9cbn0sICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHJlc2V0KCk7XG59KSwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgeWllbGQgZmlsbFNldHRpbmdzUGFnZSgpO1xuICAgIHVwZGF0ZSgpO1xufSksICgpID0+IHtcbiAgICAvL1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnBhZ2UgPSB2b2lkIDA7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IFRlc3RTdGF0cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LXN0YXRzXCIpKTtcbmNvbnN0IFRlc3RVSSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LXVpXCIpKTtcbmNvbnN0IE1hbnVhbFJlc3RhcnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvbWFudWFsLXJlc3RhcnQtdHJhY2tlclwiKSk7XG5jb25zdCBUZXN0Q29uZmlnID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtY29uZmlnXCIpKTtcbmNvbnN0IFRlc3RMb2dpYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LWxvZ2ljXCIpKTtcbmNvbnN0IEZ1bmJveCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9mdW5ib3hcIikpO1xuY29uc3QgcGFnZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL3BhZ2VcIikpO1xuZXhwb3J0cy5wYWdlID0gbmV3IHBhZ2VfMS5kZWZhdWx0KFwidGVzdFwiLCAkKFwiLnBhZ2UucGFnZVRlc3RcIiksIFwiL1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgIEZ1bmJveC5jbGVhcigpO1xuICAgIFRlc3RDb25maWcuaGlkZSgpO1xuICAgICQoXCIjd29yZHNJbnB1dFwiKS5mb2N1c291dCgpO1xufSksICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIC8vXG59KSwgKCkgPT4ge1xuICAgIFRlc3RDb25maWcuc2hvdygpO1xuICAgIFRlc3RTdGF0cy5yZXNldEluY29tcGxldGUoKTtcbiAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgIFRlc3RMb2dpYy5yZXN0YXJ0KHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdHJ1ZSk7XG4gICAgRnVuYm94LmFjdGl2YXRlKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94KTtcbn0sICgpID0+IHtcbiAgICBUZXN0VUkuZm9jdXNXb3JkcygpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNob3cgPSBleHBvcnRzLmhpZGUgPSB2b2lkIDA7XG5jb25zdCBhcGVfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vYXBlXCIpKTtcbmNvbnN0IExvYWRlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbG9hZGVyXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgZm9ybWF0XzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImRhdGUtZm5zL2Zvcm1hdFwiKSk7XG5sZXQgYXBlS2V5cyA9IHt9O1xuZnVuY3Rpb24gZ2V0RGF0YSgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQuYXBlS2V5cy5nZXQoKTtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVycm9yIGdldHRpbmcgYXBlIGtleXM6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBhcGVLZXlzID0gcmVzcG9uc2UuZGF0YTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHJlZnJlc2hMaXN0KCkge1xuICAgIGNvbnN0IGRhdGEgPSBhcGVLZXlzO1xuICAgIGlmICghZGF0YSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IHRhYmxlID0gJChcIiNhcGVLZXlzUG9wdXBXcmFwcGVyIHRhYmxlIHRib2R5XCIpO1xuICAgIHRhYmxlLmVtcHR5KCk7XG4gICAgY29uc3QgYXBlS2V5SWRzID0gT2JqZWN0LmtleXMoZGF0YSk7XG4gICAgaWYgKGFwZUtleUlkcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGFibGUuYXBwZW5kKFwiPHRyPjx0ZCBjb2xzcGFuPSc2JyBzdHlsZT0ndGV4dC1hbGlnbjogY2VudGVyOyc+Tm8ga2V5cyBmb3VuZDwvdGQ+PC90cj5cIik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgYXBlS2V5SWRzLmZvckVhY2goKGFwZUtleUlkKSA9PiB7XG4gICAgICAgIGNvbnN0IGtleSA9IGRhdGFbYXBlS2V5SWRdO1xuICAgICAgICB0YWJsZS5hcHBlbmQoYFxuICAgICAgPHRyIGtleUlkPVwiJHthcGVLZXlJZH1cIj5cbiAgICAgICAgPHRkPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJpY29uLWJ1dHRvblwiPlxuICAgICAgICAgICAgJHtrZXkuZW5hYmxlZFxuICAgICAgICAgICAgPyBgPGkgY2xhc3M9XCJmYXMgZmEtY2hlY2stc3F1YXJlXCI+PC9pPmBcbiAgICAgICAgICAgIDogYDxpIGNsYXNzPVwiZmFyIGZhLWZ3IGZhLXNxdWFyZVwiPjwvaT5gfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L3RkPlxuICAgICAgICA8dGQ+JHtrZXkubmFtZX08L3RkPlxuICAgICAgICA8dGQ+JHsoMCwgZm9ybWF0XzEuZGVmYXVsdCkobmV3IERhdGUoa2V5LmNyZWF0ZWRPbiksIFwiZGQgTU1NIHl5eXkgSEg6bW1cIil9PC90ZD5cbiAgICAgICAgPHRkPiR7KDAsIGZvcm1hdF8xLmRlZmF1bHQpKG5ldyBEYXRlKGtleS5tb2RpZmllZE9uKSwgXCJkZCBNTU0geXl5eSBISDptbVwiKX08L3RkPlxuICAgICAgICA8dGQ+JHtrZXkubGFzdFVzZWRPbiA9PT0gLTFcbiAgICAgICAgICAgID8gXCItXCJcbiAgICAgICAgICAgIDogKDAsIGZvcm1hdF8xLmRlZmF1bHQpKG5ldyBEYXRlKGtleS5sYXN0VXNlZE9uKSwgXCJkZCBNTU0geXl5eSBISDptbVwiKX08L3RkPlxuICAgICAgICA8dGQ+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImtleUJ1dHRvbnNcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJidXR0b24gZWRpdFwiPlxuICAgICAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1wZW5cIj48L2k+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJidXR0b24gZGVsZXRlXCI+XG4gICAgICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXRyYXNoLWFsdFwiPjwvaT5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L3RkPlxuICAgICAgPC90cj5cbiAgICBgKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgaWYgKCEkKFwiI2FwZUtleXNQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNhcGVLZXlzUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNhcGVLZXlzUG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuLy9zaG93IHRoZSBwb3B1cFxuZnVuY3Rpb24gc2hvdygpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoJChcIiNhcGVLZXlzUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICAgICB5aWVsZCBnZXREYXRhKCk7XG4gICAgICAgICAgICByZWZyZXNoTGlzdCgpO1xuICAgICAgICAgICAgJChcIiNhcGVLZXlzUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgJChcIiNhcGVLZXlzUG9wdXAgdGV4dGFyZWFcIikudHJpZ2dlcihcImZvY3VzXCIpLnNlbGVjdCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG4kKFwiI2FwZUtleXNQb3B1cFdyYXBwZXJcIikub24oXCJtb3VzZWRvd25cIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcImFwZUtleXNQb3B1cFdyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4kKFwiI2FwZUtleXNQb3B1cCAuZ2VuZXJhdGVBcGVLZXlcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgaGlkZSgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI2FwZUtleXNQb3B1cCB0YWJsZSAua2V5QnV0dG9ucyAuYnV0dG9uXCIsICgpID0+IHtcbiAgICBoaWRlKCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjYXBlS2V5c1BvcHVwIHRhYmxlIC5pY29uLWJ1dHRvblwiLCAoZSkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgY29uc3Qga2V5SWQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KFwidHJcIikuYXR0cihcImtleUlkXCIpO1xuICAgIGNvbnN0IGtleSA9IGFwZUtleXMgPT09IG51bGwgfHwgYXBlS2V5cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXBlS2V5c1trZXlJZF07XG4gICAgaWYgKCFrZXkgfHwgIWFwZUtleXMpXG4gICAgICAgIHJldHVybjtcbiAgICBMb2FkZXIuc2hvdygpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5hcGVLZXlzLnVwZGF0ZShrZXlJZCwgeyBlbmFibGVkOiAha2V5LmVuYWJsZWQgfSk7XG4gICAgTG9hZGVyLmhpZGUoKTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHVwZGF0ZSBrZXk6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgIH1cbiAgICBhcGVLZXlzW2tleUlkXS5lbmFibGVkID0gIWtleS5lbmFibGVkO1xuICAgIHJlZnJlc2hMaXN0KCk7XG4gICAgaWYgKGtleS5lbmFibGVkKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiS2V5IGFjdGl2ZVwiLCAxKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiS2V5IGluYWN0aXZlXCIsIDEpO1xuICAgIH1cbn0pKTtcbiIsIlwidXNlIHN0cmljdFwiO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiI2NvbnRhY3RQb3B1cEJ1dHRvblwiLCAoKSA9PiB7XG4gICAgJChcIiNjb250YWN0UG9wdXBXcmFwcGVyXCIpXG4gICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTI1KTtcbn0pO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiI2NvbnRhY3RQb3B1cFdyYXBwZXJcIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcImNvbnRhY3RQb3B1cFdyYXBwZXJcIikge1xuICAgICAgICAkKFwiI2NvbnRhY3RQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI2NvbnRhY3RQb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGlkZSA9IGV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmNvbnN0IFVwZGF0ZUNvbmZpZyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IE1hbnVhbFJlc3RhcnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvbWFudWFsLXJlc3RhcnQtdHJhY2tlclwiKSk7XG5jb25zdCBUZXN0TG9naWMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC1sb2dpY1wiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmZ1bmN0aW9uIHBhcnNlSW5wdXQoaW5wdXQpIHtcbiAgICBjb25zdCByZSA9IC8oKC1cXHMqKT9cXGQrKFxcLlxcZCspP1xccypbaG1zXT8pL2c7XG4gICAgY29uc3Qgc2Vjb25kcyA9IFsuLi5pbnB1dC50b0xvd2VyQ2FzZSgpLm1hdGNoQWxsKHJlKV1cbiAgICAgICAgLm1hcCgobWF0Y2gpID0+IHtcbiAgICAgICAgY29uc3QgcGFydCA9IG1hdGNoWzBdO1xuICAgICAgICBjb25zdCBkdXJhdGlvbiA9IHBhcnNlRmxvYXQocGFydC5yZXBsYWNlKC9cXHMrL2csIFwiXCIpKTtcbiAgICAgICAgaWYgKHBhcnQuaW5jbHVkZXMoXCJoXCIpKSB7XG4gICAgICAgICAgICByZXR1cm4gMzYwMCAqIGR1cmF0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHBhcnQuaW5jbHVkZXMoXCJtXCIpKSB7XG4gICAgICAgICAgICByZXR1cm4gNjAgKiBkdXJhdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBkdXJhdGlvbjtcbiAgICAgICAgfVxuICAgIH0pXG4gICAgICAgIC5yZWR1Y2UoKHRvdGFsLCBkdXIpID0+IHRvdGFsICsgZHVyLCAwKTtcbiAgICByZXR1cm4gTWF0aC5mbG9vcihzZWNvbmRzKTtcbn1cbmZ1bmN0aW9uIGZvcm1hdChkdXJhdGlvbikge1xuICAgIGNvbnN0IGhvdXJzID0gTWF0aC5mbG9vcihkdXJhdGlvbiAvIDM2MDApO1xuICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKChkdXJhdGlvbiAlIDM2MDApIC8gNjApO1xuICAgIGNvbnN0IHNlY29uZHMgPSAoZHVyYXRpb24gJSAzNjAwKSAlIDYwO1xuICAgIGNvbnN0IHRpbWUgPSBbXTtcbiAgICBpZiAoaG91cnMgPiAwKSB7XG4gICAgICAgIHRpbWUucHVzaChgJHtob3Vyc30gaG91ciR7aG91cnMgPT09IDEgPyBcIlwiIDogXCJzXCJ9YCk7XG4gICAgfVxuICAgIGlmIChtaW51dGVzID4gMCkge1xuICAgICAgICB0aW1lLnB1c2goYCR7bWludXRlc30gbWludXRlJHttaW51dGVzID09PSAxID8gXCJcIiA6IFwic1wifWApO1xuICAgIH1cbiAgICBpZiAoc2Vjb25kcyA+IDApIHtcbiAgICAgICAgdGltZS5wdXNoKGAke3NlY29uZHN9IHNlY29uZCR7c2Vjb25kcyA9PT0gMSA/IFwiXCIgOiBcInNcIn1gKTtcbiAgICB9XG4gICAgaWYgKHRpbWUubGVuZ3RoID09PSAzKSB7XG4gICAgICAgIHJldHVybiBgJHt0aW1lWzBdfSwgJHt0aW1lWzFdfSBhbmQgJHt0aW1lWzJdfWA7XG4gICAgfVxuICAgIGVsc2UgaWYgKHRpbWUubGVuZ3RoID09PSAyKSB7XG4gICAgICAgIHJldHVybiBgJHt0aW1lWzBdfSBhbmQgJHt0aW1lWzFdfWA7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gYCR7dGltZVswXX1gO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHByZXZpZXdEdXJhdGlvbigpIHtcbiAgICBjb25zdCBpbnB1dCA9ICQoXCIjY3VzdG9tVGVzdER1cmF0aW9uUG9wdXAgaW5wdXRcIikudmFsKCk7XG4gICAgY29uc3QgZHVyYXRpb24gPSBwYXJzZUlucHV0KGlucHV0KTtcbiAgICBsZXQgZm9ybWF0dGVkRHVyYXRpb24gPSBcIlwiO1xuICAgIGlmIChkdXJhdGlvbiA8IDApIHtcbiAgICAgICAgZm9ybWF0dGVkRHVyYXRpb24gPSBcIk5FR0FUSVZFIFRJTUVcIjtcbiAgICB9XG4gICAgZWxzZSBpZiAoZHVyYXRpb24gPT0gMCkge1xuICAgICAgICBmb3JtYXR0ZWREdXJhdGlvbiA9IFwiSW5maW5pdGUgdGVzdFwiO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZm9ybWF0dGVkRHVyYXRpb24gPSBcIlRvdGFsIHRpbWU6IFwiICsgZm9ybWF0KGR1cmF0aW9uKTtcbiAgICB9XG4gICAgJChcIiNjdXN0b21UZXN0RHVyYXRpb25Qb3B1cCAucHJldmlld1wiKS50ZXh0KGZvcm1hdHRlZER1cmF0aW9uKTtcbn1cbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgaWYgKCQoXCIjY3VzdG9tVGVzdER1cmF0aW9uUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjY3VzdG9tVGVzdER1cmF0aW9uUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNjdXN0b21UZXN0RHVyYXRpb25Qb3B1cCBpbnB1dFwiKS50cmlnZ2VyKFwiZm9jdXNcIikuc2VsZWN0KCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBwcmV2aWV3RHVyYXRpb24oKTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmICghJChcIiNjdXN0b21UZXN0RHVyYXRpb25Qb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNjdXN0b21UZXN0RHVyYXRpb25Qb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI2N1c3RvbVRlc3REdXJhdGlvblBvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbmZ1bmN0aW9uIGFwcGx5KCkge1xuICAgIGNvbnN0IHZhbCA9IHBhcnNlSW5wdXQoJChcIiNjdXN0b21UZXN0RHVyYXRpb25Qb3B1cCBpbnB1dFwiKS52YWwoKSk7XG4gICAgaWYgKHZhbCAhPT0gbnVsbCAmJiAhaXNOYU4odmFsKSAmJiB2YWwgPj0gMCkge1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZUNvbmZpZyh2YWwpO1xuICAgICAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICBpZiAodmFsID49IDE4MDApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiU3RheSBzYWZlIGFuZCB0YWtlIGJyZWFrcyFcIiwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodmFsID09IDApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiSW5maW5pdGUgdGltZSEgTWFrZSBzdXJlIHRvIHVzZSBCYWlsIE91dCBmcm9tIHRoZSBjb21tYW5kIGxpbmUgdG8gc2F2ZSB5b3VyIHJlc3VsdC5cIiwgMCwgNyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ3VzdG9tIHRpbWUgbXVzdCBiZSBhdCBsZWFzdCAxXCIsIDApO1xuICAgIH1cbiAgICBoaWRlKCk7XG59XG4kKFwiI2N1c3RvbVRlc3REdXJhdGlvblBvcHVwV3JhcHBlclwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJjdXN0b21UZXN0RHVyYXRpb25Qb3B1cFdyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4kKFwiI2N1c3RvbVRlc3REdXJhdGlvblBvcHVwIGlucHV0XCIpLmtleXVwKChlKSA9PiB7XG4gICAgcHJldmlld0R1cmF0aW9uKCk7XG4gICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgYXBwbHkoKTtcbiAgICB9XG59KTtcbiQoXCIjY3VzdG9tVGVzdER1cmF0aW9uUG9wdXAgLmJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBhcHBseSgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3RvcCAuY29uZmlnIC50aW1lIC50ZXh0LWJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIGNvbnN0IG1vZGUgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcInRpbWVDb25maWdcIik7XG4gICAgaWYgKG1vZGUgPT0gXCJjdXN0b21cIikge1xuICAgICAgICBzaG93KCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50KS5vbihcImtleWRvd25cIiwgKGV2ZW50KSA9PiB7XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFc2NhcGVcIiAmJlxuICAgICAgICAhJChcIiNjdXN0b21UZXN0RHVyYXRpb25Qb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaXNWaXNpYmxlID0gZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuY29uc3QgQ3VzdG9tVGV4dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9jdXN0b20tdGV4dFwiKSk7XG5jb25zdCBNYW51YWxSZXN0YXJ0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L21hbnVhbC1yZXN0YXJ0LXRyYWNrZXJcIikpO1xuY29uc3QgVGVzdExvZ2ljID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtbG9naWNcIikpO1xuY29uc3QgQ2hhbGxlbmdlQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvY2hhbGxlbmdlLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBXb3JkRmlsdGVyUG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vd29yZC1maWx0ZXItcG9wdXBcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBTYXZlZFRleHRzUG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vc2F2ZWQtdGV4dHMtcG9wdXBcIikpO1xuY29uc3Qgd3JhcHBlciA9IFwiI2N1c3RvbVRleHRQb3B1cFdyYXBwZXJcIjtcbmNvbnN0IHBvcHVwID0gXCIjY3VzdG9tVGV4dFBvcHVwXCI7XG5mdW5jdGlvbiBzaG93KCkge1xuICAgIGlmICgkKHdyYXBwZXIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIGlmICgkKGAke3BvcHVwfSAuY2hlY2tib3ggaW5wdXRgKS5wcm9wKFwiY2hlY2tlZFwiKSkge1xuICAgICAgICAgICAgJChgJHtwb3B1cH0gLmlucHV0cyAucmFuZG9tSW5wdXRGaWVsZHNgKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoYCR7cG9wdXB9IC5pbnB1dHMgLnJhbmRvbUlucHV0RmllbGRzYCkuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgJCh3cmFwcGVyKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgIGxldCBuZXd0ZXh0ID0gQ3VzdG9tVGV4dC50ZXh0LmpvaW4oQ3VzdG9tVGV4dC5kZWxpbWl0ZXIpO1xuICAgICAgICAgICAgbmV3dGV4dCA9IG5ld3RleHQucmVwbGFjZSgvXFxuIC9nLCBcIlxcblwiKTtcbiAgICAgICAgICAgICQoYCR7cG9wdXB9IHRleHRhcmVhYCkudmFsKG5ld3RleHQpO1xuICAgICAgICAgICAgJChgJHtwb3B1cH0gLndvcmRjb3VudCBpbnB1dGApLnZhbChDdXN0b21UZXh0LndvcmQgPT09IC0xID8gXCJcIiA6IEN1c3RvbVRleHQud29yZCk7XG4gICAgICAgICAgICAkKGAke3BvcHVwfSAudGltZSBpbnB1dGApLnZhbChDdXN0b21UZXh0LnRpbWUgPT09IC0xID8gXCJcIiA6IEN1c3RvbVRleHQudGltZSk7XG4gICAgICAgICAgICAkKGAke3BvcHVwfSB0ZXh0YXJlYWApLnRyaWdnZXIoXCJmb2N1c1wiKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAkKGAke3BvcHVwfSB0ZXh0YXJlYWApLnRyaWdnZXIoXCJmb2N1c1wiKTtcbiAgICB9LCAxNTApO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbiQoYCR7cG9wdXB9IC5kZWxpbWl0ZXJDaGVjayBpbnB1dGApLmNoYW5nZSgoKSA9PiB7XG4gICAgbGV0IGRlbGltaXRlcjtcbiAgICBpZiAoJChgJHtwb3B1cH0gLmRlbGltaXRlckNoZWNrIGlucHV0YCkucHJvcChcImNoZWNrZWRcIikpIHtcbiAgICAgICAgZGVsaW1pdGVyID0gXCJ8XCI7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBkZWxpbWl0ZXIgPSBcIiBcIjtcbiAgICB9XG4gICAgaWYgKCQoYCR7cG9wdXB9IHRleHRhcmVhYCkudmFsKCkgIT0gQ3VzdG9tVGV4dC50ZXh0LmpvaW4oQ3VzdG9tVGV4dC5kZWxpbWl0ZXIpKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRUZXh0ID0gJChgJHtwb3B1cH0gdGV4dGFyZWFgKS52YWwoKTtcbiAgICAgICAgY29uc3QgY3VycmVudFRleHRTcGxpdCA9IGN1cnJlbnRUZXh0LnNwbGl0KEN1c3RvbVRleHQuZGVsaW1pdGVyKTtcbiAgICAgICAgbGV0IG5ld3RleHQgPSBjdXJyZW50VGV4dFNwbGl0LmpvaW4oZGVsaW1pdGVyKTtcbiAgICAgICAgbmV3dGV4dCA9IG5ld3RleHQucmVwbGFjZSgvXFxuIC9nLCBcIlxcblwiKTtcbiAgICAgICAgJChgJHtwb3B1cH0gdGV4dGFyZWFgKS52YWwobmV3dGV4dCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBsZXQgbmV3dGV4dCA9IEN1c3RvbVRleHQudGV4dC5qb2luKGRlbGltaXRlcik7XG4gICAgICAgIG5ld3RleHQgPSBuZXd0ZXh0LnJlcGxhY2UoL1xcbiAvZywgXCJcXG5cIik7XG4gICAgICAgICQoYCR7cG9wdXB9IHRleHRhcmVhYCkudmFsKG5ld3RleHQpO1xuICAgIH1cbiAgICBDdXN0b21UZXh0LnNldERlbGltaXRlcihkZWxpbWl0ZXIpO1xufSk7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmICghJCh3cmFwcGVyKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKHdyYXBwZXIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJCh3cmFwcGVyKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbmZ1bmN0aW9uIGlzVmlzaWJsZSgpIHtcbiAgICByZXR1cm4gISQod3JhcHBlcikuaGFzQ2xhc3MoXCJoaWRkZW5cIik7XG59XG5leHBvcnRzLmlzVmlzaWJsZSA9IGlzVmlzaWJsZTtcbiQod3JhcHBlcikubW91c2Vkb3duKChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJjdXN0b21UZXh0UG9wdXBXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuJChgJHtwb3B1cH0gLmlucHV0cyAuY2hlY2tib3ggaW5wdXRgKS5jaGFuZ2UoKCkgPT4ge1xuICAgIGlmICgkKGAke3BvcHVwfSAuY2hlY2tib3ggaW5wdXRgKS5wcm9wKFwiY2hlY2tlZFwiKSkge1xuICAgICAgICAkKGAke3BvcHVwfSAuaW5wdXRzIC5yYW5kb21JbnB1dEZpZWxkc2ApLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChgJHtwb3B1cH0gLmlucHV0cyAucmFuZG9tSW5wdXRGaWVsZHNgKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG59KTtcbiQoYCR7cG9wdXB9IHRleHRhcmVhYCkub24oXCJrZXlwcmVzc1wiLCAoZSkgPT4ge1xuICAgIGlmIChlLmNvZGUgPT09IFwiRW50ZXJcIiAmJiBlLmN0cmxLZXkpIHtcbiAgICAgICAgJChgJHtwb3B1cH0gLmJ1dHRvbi5hcHBseWApLmNsaWNrKCk7XG4gICAgfVxufSk7XG4kKGAke3BvcHVwfSAucmFuZG9tSW5wdXRGaWVsZHMgLndvcmRjb3VudCBpbnB1dGApLm9uKFwia2V5cHJlc3NcIiwgKCkgPT4ge1xuICAgICQoYCR7cG9wdXB9IC5yYW5kb21JbnB1dEZpZWxkcyAudGltZSBpbnB1dGApLnZhbChcIlwiKTtcbn0pO1xuJChgJHtwb3B1cH0gLnJhbmRvbUlucHV0RmllbGRzIC50aW1lIGlucHV0YCkub24oXCJrZXlwcmVzc1wiLCAoKSA9PiB7XG4gICAgJChgJHtwb3B1cH0gLnJhbmRvbUlucHV0RmllbGRzIC53b3JkY291bnQgaW5wdXRgKS52YWwoXCJcIik7XG59KTtcbiQoYCR7cG9wdXB9IC5idXR0b25zVG9wIC5zaG93U2F2ZWRUZXh0c2ApLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIFNhdmVkVGV4dHNQb3B1cC5zaG93KCk7XG59KTtcbiQoYCR7cG9wdXB9IC5idXR0b25zVG9wIC5zYXZlQ3VzdG9tVGV4dGApLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGhpZGUoKTtcbn0pO1xuZnVuY3Rpb24gYXBwbHkoKSB7XG4gICAgbGV0IHRleHQgPSAkKGAke3BvcHVwfSB0ZXh0YXJlYWApLnZhbCgpLm5vcm1hbGl6ZSgpO1xuICAgIHRleHQgPSB0ZXh0LnRyaW0oKTtcbiAgICAvLyB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9bXFxyXS9nbSwgXCIgXCIpO1xuICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcXFxcXFxcdC9nbSwgXCJcXHRcIik7XG4gICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFxcXFxcXFxuL2dtLCBcIlxcblwiKTtcbiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXFxcdC9nbSwgXCJcXHRcIik7XG4gICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFxcXG4vZ20sIFwiXFxuXCIpO1xuICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyArL2dtLCBcIiBcIik7XG4gICAgLy8gdGV4dCA9IHRleHQucmVwbGFjZSgvKFxcclxcbikrL2csIFwiXFxyXFxuXCIpO1xuICAgIC8vIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyhcXG4pKy9nLCBcIlxcblwiKTtcbiAgICAvLyB0ZXh0ID0gdGV4dC5yZXBsYWNlKC8oXFxyKSsvZywgXCJcXHJcIik7XG4gICAgdGV4dCA9IHRleHQucmVwbGFjZSgvKCAqKFxcclxcbnxcXHJ8XFxuKSAqKS9nLCBcIlxcbiBcIik7XG4gICAgaWYgKCQoYCR7cG9wdXB9IC50eXBvZ3JhcGh5Q2hlY2sgaW5wdXRgKS5wcm9wKFwiY2hlY2tlZFwiKSkge1xuICAgICAgICB0ZXh0ID0gTWlzYy5jbGVhblR5cG9ncmFwaHlTeW1ib2xzKHRleHQpO1xuICAgIH1cbiAgICAvLyB0ZXh0ID0gTWlzYy5yZW1vdmVfbm9uX2FzY2lpKHRleHQpO1xuICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1tcXHUyMDYwXS9nLCBcIlwiKTtcbiAgICBDdXN0b21UZXh0LnNldFRleHQodGV4dC5zcGxpdChDdXN0b21UZXh0LmRlbGltaXRlcikpO1xuICAgIEN1c3RvbVRleHQuc2V0V29yZChwYXJzZUludCgkKGAke3BvcHVwfSAud29yZGNvdW50IGlucHV0YCkudmFsKCkpIHx8IC0xKTtcbiAgICBDdXN0b21UZXh0LnNldFRpbWUocGFyc2VJbnQoJChgJHtwb3B1cH0gLnRpbWUgaW5wdXRgKS52YWwoKSkgfHwgLTEpO1xuICAgIEN1c3RvbVRleHQuc2V0SXNXb3JkUmFuZG9tKCQoYCR7cG9wdXB9IC5jaGVja2JveCBpbnB1dGApLnByb3AoXCJjaGVja2VkXCIpICYmIEN1c3RvbVRleHQud29yZCA+IC0xKTtcbiAgICBDdXN0b21UZXh0LnNldElzVGltZVJhbmRvbSgkKGAke3BvcHVwfSAuY2hlY2tib3ggaW5wdXRgKS5wcm9wKFwiY2hlY2tlZFwiKSAmJiBDdXN0b21UZXh0LnRpbWUgPiAtMSk7XG4gICAgaWYgKCQoYCR7cG9wdXB9IC5jaGVja2JveCBpbnB1dGApLnByb3AoXCJjaGVja2VkXCIpICYmXG4gICAgICAgICFDdXN0b21UZXh0LmlzVGltZVJhbmRvbSAmJlxuICAgICAgICAhQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20pIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJZb3UgbmVlZCB0byBzcGVjaWZ5IHdvcmQgY291bnQgb3IgdGltZSBpbiBzZWNvbmRzIHRvIHN0YXJ0IGEgcmFuZG9tIGN1c3RvbSB0ZXN0LlwiLCAwLCA1KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoJChgJHtwb3B1cH0gLmNoZWNrYm94IGlucHV0YCkucHJvcChcImNoZWNrZWRcIikgJiZcbiAgICAgICAgQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20gJiZcbiAgICAgICAgQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20pIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJZb3UgbmVlZCB0byBwaWNrIGJldHdlZW4gd29yZCBjb3VudCBvciB0aW1lIGluIHNlY29uZHMgdG8gc3RhcnQgYSByYW5kb20gY3VzdG9tIHRlc3QuXCIsIDAsIDUpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICgoQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gJiYgQ3VzdG9tVGV4dC53b3JkID09PSAwKSB8fFxuICAgICAgICAoQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20gJiYgQ3VzdG9tVGV4dC50aW1lID09PSAwKSkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkluZmluaXRlIHdvcmRzISBNYWtlIHN1cmUgdG8gdXNlIEJhaWwgT3V0IGZyb20gdGhlIGNvbW1hbmQgbGluZSB0byBzYXZlIHlvdXIgcmVzdWx0LlwiLCAwLCA3KTtcbiAgICB9XG4gICAgQ2hhbGxlbmdlQ29udHJvbGxlci5jbGVhckFjdGl2ZSgpO1xuICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJjdXN0b21cIilcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJjdXN0b21cIik7XG4gICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICBoaWRlKCk7XG59XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIGAke3BvcHVwfSAuYnV0dG9uLmFwcGx5YCwgKCkgPT4ge1xuICAgIGFwcGx5KCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgYCR7cG9wdXB9IC53b3JkZmlsdGVyYCwgKCkgPT4ge1xuICAgIFdvcmRGaWx0ZXJQb3B1cC5zaG93KCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjdG9wIC5jb25maWcgLmN1c3RvbVRleHQgLnRleHQtYnV0dG9uXCIsICgpID0+IHtcbiAgICBzaG93KCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwia2V5ZG93blwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiICYmXG4gICAgICAgICEkKFwiI2N1c3RvbVRleHRQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG4vLyBpbXBvcnQgQ29uZmlnLCAqIGFzIFVwZGF0ZUNvbmZpZyBmcm9tIFwiLi9jb25maWdcIjtcbi8vIGltcG9ydCAqIGFzIE5vdGlmaWNhdGlvbnMgZnJvbSBcIi4vbm90aWZpY2F0aW9uc1wiO1xuLy8gaW1wb3J0ICogYXMgVGhlbWVQaWNrZXIgZnJvbSBcIi4vdGhlbWUtcGlja2VyXCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNob3cgPSB2b2lkIDA7XG5mdW5jdGlvbiBzaG93KHZhbHVlKSB7XG4gICAgaWYgKCQoXCIjY3VzdG9tVGhlbWVTaGFyZVdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgLy8gbGV0IHNhdmUgPSBbXTtcbiAgICAgICAgLy8gJC5lYWNoKFxuICAgICAgICAvLyAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmN1c3RvbVRoZW1lIFt0eXBlPSdjb2xvciddXCIpLFxuICAgICAgICAvLyAgIChpbmRleCwgZWxlbWVudCkgPT4ge1xuICAgICAgICAvLyAgICAgc2F2ZS5wdXNoKCQoZWxlbWVudCkuYXR0cihcInZhbHVlXCIpKTtcbiAgICAgICAgLy8gICB9XG4gICAgICAgIC8vICk7XG4gICAgICAgIC8vICQoXCIjY3VzdG9tVGhlbWVTaGFyZVdyYXBwZXIgaW5wdXRcIikudmFsKEpTT04uc3RyaW5naWZ5KHNhdmUpKTtcbiAgICAgICAgJChcIiNjdXN0b21UaGVtZVNoYXJlV3JhcHBlciBpbnB1dFwiKS52YWwodmFsdWUpO1xuICAgICAgICAkKFwiI2N1c3RvbVRoZW1lU2hhcmVXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNjdXN0b21UaGVtZVNoYXJlIGlucHV0XCIpLnRyaWdnZXIoXCJmb2N1c1wiKTtcbiAgICAgICAgICAgICQoXCIjY3VzdG9tVGhlbWVTaGFyZSBpbnB1dFwiKS5zZWxlY3QoKTtcbiAgICAgICAgICAgICQoXCIjY3VzdG9tVGhlbWVTaGFyZSBpbnB1dFwiKS50cmlnZ2VyKFwiZm9jdXNcIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmICghJChcIiNjdXN0b21UaGVtZVNoYXJlV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAvLyB0cnkge1xuICAgICAgICAvLyAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZUNvbG9ycyhcbiAgICAgICAgLy8gICAgIEpTT04ucGFyc2UoJChcIiNjdXN0b21UaGVtZVNoYXJlV3JhcHBlciBpbnB1dFwiKS52YWwoKSlcbiAgICAgICAgLy8gICApO1xuICAgICAgICAvLyB9IGNhdGNoIChlKSB7XG4gICAgICAgIC8vICAgTm90aWZpY2F0aW9ucy5hZGQoXG4gICAgICAgIC8vICAgICBcIlNvbWV0aGluZyB3ZW50IHdyb25nLiBSZXZlcnRpbmcgdG8gZGVmYXVsdCBjdXN0b20gY29sb3JzLlwiLFxuICAgICAgICAvLyAgICAgMCxcbiAgICAgICAgLy8gICAgIDRcbiAgICAgICAgLy8gICApO1xuICAgICAgICAvLyAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZUNvbG9ycyhDb25maWcuZGVmYXVsdENvbmZpZy5jdXN0b21UaGVtZUNvbG9ycyk7XG4gICAgICAgIC8vIH1cbiAgICAgICAgLy8gVGhlbWVQaWNrZXIuc2V0Q3VzdG9tSW5wdXRzKCk7XG4gICAgICAgICQoXCIjY3VzdG9tVGhlbWVTaGFyZVdyYXBwZXIgaW5wdXRcIikudmFsKFwiXCIpO1xuICAgICAgICAkKFwiI2N1c3RvbVRoZW1lU2hhcmVXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNjdXN0b21UaGVtZVNoYXJlV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuJChcIiNjdXN0b21UaGVtZVNoYXJlV3JhcHBlclwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJjdXN0b21UaGVtZVNoYXJlV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbiQoXCIjY3VzdG9tVGhlbWVTaGFyZSAuYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGhpZGUoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGlkZSA9IGV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmNvbnN0IFVwZGF0ZUNvbmZpZyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IE1hbnVhbFJlc3RhcnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvbWFudWFsLXJlc3RhcnQtdHJhY2tlclwiKSk7XG5jb25zdCBUZXN0TG9naWMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC1sb2dpY1wiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgaWYgKCQoXCIjY3VzdG9tV29yZEFtb3VudFBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI2N1c3RvbVdvcmRBbW91bnRQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI2N1c3RvbVdvcmRBbW91bnRQb3B1cCBpbnB1dFwiKS50cmlnZ2VyKFwiZm9jdXNcIikuc2VsZWN0KCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmICghJChcIiNjdXN0b21Xb3JkQW1vdW50UG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjY3VzdG9tV29yZEFtb3VudFBvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjY3VzdG9tV29yZEFtb3VudFBvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbmZ1bmN0aW9uIGFwcGx5KCkge1xuICAgIGNvbnN0IHZhbCA9IHBhcnNlSW50KCQoXCIjY3VzdG9tV29yZEFtb3VudFBvcHVwIGlucHV0XCIpLnZhbCgpKTtcbiAgICBpZiAodmFsICE9PSBudWxsICYmICFpc05hTih2YWwpICYmIHZhbCA+PSAwKSB7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRXb3JkQ291bnQodmFsKTtcbiAgICAgICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgaWYgKHZhbCA+IDIwMDApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiU3RheSBzYWZlIGFuZCB0YWtlIGJyZWFrcyFcIiwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodmFsID09IDApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiSW5maW5pdGUgd29yZHMhIE1ha2Ugc3VyZSB0byB1c2UgQmFpbCBPdXQgZnJvbSB0aGUgY29tbWFuZCBsaW5lIHRvIHNhdmUgeW91ciByZXN1bHQuXCIsIDAsIDcpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkN1c3RvbSB3b3JkIGFtb3VudCBtdXN0IGJlIGF0IGxlYXN0IDFcIiwgMCk7XG4gICAgfVxuICAgIGhpZGUoKTtcbn1cbiQoXCIjY3VzdG9tV29yZEFtb3VudFBvcHVwV3JhcHBlclwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJjdXN0b21Xb3JkQW1vdW50UG9wdXBXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuJChcIiNjdXN0b21Xb3JkQW1vdW50UG9wdXAgaW5wdXRcIikub24oXCJrZXlwcmVzc1wiLCAoZSkgPT4ge1xuICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIGFwcGx5KCk7XG4gICAgfVxufSk7XG4kKFwiI2N1c3RvbVdvcmRBbW91bnRQb3B1cCAuYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGFwcGx5KCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjdG9wIC5jb25maWcgLndvcmRDb3VudCAudGV4dC1idXR0b25cIiwgKGUpID0+IHtcbiAgICBjb25zdCB3cmQgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcIndvcmRDb3VudFwiKTtcbiAgICBpZiAod3JkID09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgc2hvdygpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudCkub24oXCJrZXlkb3duXCIsIChldmVudCkgPT4ge1xuICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIgJiZcbiAgICAgICAgISQoXCIjY3VzdG9tV29yZEFtb3VudFBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICBoaWRlKCk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNob3cgPSB2b2lkIDA7XG5jb25zdCBhcGVfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vYXBlXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBDb25maWcgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBMb2FkZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2xvYWRlclwiKSk7XG5jb25zdCBTZXR0aW5ncyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcGFnZXMvc2V0dGluZ3NcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5mdW5jdGlvbiBzaG93KGFjdGlvbiwgaWQsIG5hbWUpIHtcbiAgICBpZiAoYWN0aW9uID09PSBcImFkZFwiKSB7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdFwiKS5hdHRyKFwiYWN0aW9uXCIsIFwiYWRkXCIpO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgLnRpdGxlXCIpLmh0bWwoXCJDcmVhdGUgbmV3IHByZXNldFwiKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IC5idXR0b25cIikuaHRtbChgPGkgY2xhc3M9XCJmYXMgZmEtcGx1c1wiPjwvaT5gKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IGlucHV0LnRleHRcIikudmFsKFwiXCIpO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgaW5wdXQudGV4dFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IGxhYmVsXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChhY3Rpb24gPT09IFwiZWRpdFwiICYmIGlkICYmIG5hbWUpIHtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0XCIpLmF0dHIoXCJhY3Rpb25cIiwgXCJlZGl0XCIpO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXRcIikuYXR0cihcInByZXNldGlkXCIsIGlkKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IC50aXRsZVwiKS5odG1sKFwiRWRpdCBwcmVzZXRcIik7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCAuYnV0dG9uXCIpLmh0bWwoYDxpIGNsYXNzPVwiZmFzIGZhLXBlblwiPjwvaT5gKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IGlucHV0LnRleHRcIikudmFsKG5hbWUpO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgaW5wdXQudGV4dFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IGxhYmVsIGlucHV0XCIpLnByb3AoXCJjaGVja2VkXCIsIGZhbHNlKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IGxhYmVsXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChhY3Rpb24gPT09IFwicmVtb3ZlXCIgJiYgaWQpIHtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0XCIpLmF0dHIoXCJhY3Rpb25cIiwgXCJyZW1vdmVcIik7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdFwiKS5hdHRyKFwicHJlc2V0aWRcIiwgaWQpO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgLnRpdGxlXCIpLmh0bWwoXCJSZW1vdmUgcHJlc2V0IFwiICsgbmFtZSk7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCAuYnV0dG9uXCIpLmh0bWwoYDxpIGNsYXNzPVwiZmFzIGZhLWNoZWNrXCI+PC9pPmApO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgaW5wdXQudGV4dFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IGxhYmVsXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBpZiAoJChcIiNwcmVzZXRXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCBpbnB1dFwiKS50cmlnZ2VyKFwiZm9jdXNcIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmICghJChcIiNwcmVzZXRXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdFwiKS5hdHRyKFwiYWN0aW9uXCIsIFwiXCIpO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXRcIikuYXR0cihcInRhZ2lkXCIsIFwiXCIpO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGFwcGx5KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IGFjdGlvbiA9ICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdFwiKS5hdHRyKFwiYWN0aW9uXCIpO1xuICAgICAgICBjb25zdCBwcmVzZXROYW1lID0gJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IGlucHV0XCIpLnZhbCgpO1xuICAgICAgICBjb25zdCBwcmVzZXRJZCA9ICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdFwiKS5hdHRyKFwicHJlc2V0SWRcIik7XG4gICAgICAgIGNvbnN0IHVwZGF0ZUNvbmZpZyA9ICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCBsYWJlbCBpbnB1dFwiKS5wcm9wKFwiY2hlY2tlZFwiKTtcbiAgICAgICAgbGV0IGNvbmZpZ0NoYW5nZXMgPSB7fTtcbiAgICAgICAgaWYgKCh1cGRhdGVDb25maWcgJiYgYWN0aW9uID09PSBcImVkaXRcIikgfHwgYWN0aW9uID09PSBcImFkZFwiKSB7XG4gICAgICAgICAgICBjb25maWdDaGFuZ2VzID0gQ29uZmlnLmdldENvbmZpZ0NoYW5nZXMoKTtcbiAgICAgICAgICAgIGNvbnN0IHRhZ3MgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MgfHwgW107XG4gICAgICAgICAgICBjb25zdCBhY3RpdmVUYWdJZHMgPSB0YWdzXG4gICAgICAgICAgICAgICAgLmZpbHRlcigodGFnKSA9PiB0YWcuYWN0aXZlKVxuICAgICAgICAgICAgICAgIC5tYXAoKHRhZykgPT4gdGFnLl9pZCk7XG4gICAgICAgICAgICBjb25maWdDaGFuZ2VzLnRhZ3MgPSBhY3RpdmVUYWdJZHM7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc25hcHNob3RQcmVzZXRzID0gREIuZ2V0U25hcHNob3QoKS5wcmVzZXRzIHx8IFtdO1xuICAgICAgICBoaWRlKCk7XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIGlmIChhY3Rpb24gPT09IFwiYWRkXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5wcmVzZXRzLmFkZChwcmVzZXROYW1lLCBjb25maWdDaGFuZ2VzKTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGFkZCBwcmVzZXQ6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJQcmVzZXQgYWRkZWRcIiwgMSwgMik7XG4gICAgICAgICAgICAgICAgc25hcHNob3RQcmVzZXRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcmVzZXROYW1lLFxuICAgICAgICAgICAgICAgICAgICBjb25maWc6IGNvbmZpZ0NoYW5nZXMsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogcmVzcG9uc2UuZGF0YS5wcmVzZXRJZCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChhY3Rpb24gPT09IFwiZWRpdFwiKSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucHJlc2V0cy5lZGl0KHByZXNldElkLCBwcmVzZXROYW1lLCBjb25maWdDaGFuZ2VzKTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGVkaXQgcHJlc2V0OiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUHJlc2V0IHVwZGF0ZWRcIiwgMSk7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJlc2V0ID0gc25hcHNob3RQcmVzZXRzLmZpbHRlcigocHJlc2V0KSA9PiBwcmVzZXQuX2lkID09PSBwcmVzZXRJZClbMF07XG4gICAgICAgICAgICAgICAgcHJlc2V0Lm5hbWUgPSBwcmVzZXROYW1lO1xuICAgICAgICAgICAgICAgIGlmICh1cGRhdGVDb25maWcpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJlc2V0LmNvbmZpZyA9IGNvbmZpZ0NoYW5nZXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGFjdGlvbiA9PT0gXCJyZW1vdmVcIikge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnByZXNldHMuZGVsZXRlKHByZXNldElkKTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHJlbW92ZSBwcmVzZXQ6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJQcmVzZXQgcmVtb3ZlZFwiLCAxKTtcbiAgICAgICAgICAgICAgICBzbmFwc2hvdFByZXNldHMuZm9yRWFjaCgocHJlc2V0LCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAocHJlc2V0Ll9pZCA9PT0gcHJlc2V0SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNuYXBzaG90UHJlc2V0cy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgU2V0dGluZ3MudXBkYXRlKCk7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgfSk7XG59XG4kKFwiI3ByZXNldFdyYXBwZXJcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwicHJlc2V0V3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbiQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCAuYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGFwcGx5KCk7XG59KTtcbiQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCBpbnB1dFwiKS5vbihcImtleXByZXNzXCIsIChlKSA9PiB7XG4gICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgYXBwbHkoKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnByZXNldHMgLmFkZFByZXNldEJ1dHRvblwiLCAoKSA9PiB7XG4gICAgc2hvdyhcImFkZFwiKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ucHJlc2V0cyAuZWRpdEJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIGNvbnN0IHByZXNldGlkID0gJChlLmN1cnJlbnRUYXJnZXQpLnBhcmVudChcIi5wcmVzZXRcIikuYXR0cihcImlkXCIpO1xuICAgIGNvbnN0IG5hbWUgPSAkKGUuY3VycmVudFRhcmdldCkuc2libGluZ3MoXCIuYnV0dG9uXCIpLmNoaWxkcmVuKFwiLnRpdGxlXCIpLnRleHQoKTtcbiAgICBzaG93KFwiZWRpdFwiLCBwcmVzZXRpZCwgbmFtZSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnByZXNldHMgLnJlbW92ZUJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIGNvbnN0IHByZXNldGlkID0gJChlLmN1cnJlbnRUYXJnZXQpLnBhcmVudChcIi5wcmVzZXRcIikuYXR0cihcImlkXCIpO1xuICAgIGNvbnN0IG5hbWUgPSAkKGUuY3VycmVudFRhcmdldCkuc2libGluZ3MoXCIuYnV0dG9uXCIpLmNoaWxkcmVuKFwiLnRpdGxlXCIpLnRleHQoKTtcbiAgICBzaG93KFwicmVtb3ZlXCIsIHByZXNldGlkLCBuYW1lKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuY29uc3QgYXBlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2FwZVwiKSk7XG5jb25zdCBSZXN1bHRGaWx0ZXJzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9hY2NvdW50L3Jlc3VsdC1maWx0ZXJzXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IExvYWRlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbG9hZGVyXCIpKTtcbmNvbnN0IFNldHRpbmdzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wYWdlcy9zZXR0aW5nc1wiKSk7XG5jb25zdCBSZXN1bHRUYWdzUG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vcmVzdWx0LXRhZ3MtcG9wdXBcIikpO1xuZnVuY3Rpb24gc2hvdyhhY3Rpb24sIGlkLCBuYW1lKSB7XG4gICAgaWYgKGFjdGlvbiA9PT0gXCJhZGRcIikge1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdFwiKS5hdHRyKFwiYWN0aW9uXCIsIFwiYWRkXCIpO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCAudGl0bGVcIikuaHRtbChcIkFkZCBuZXcgdGFnXCIpO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCAuYnV0dG9uXCIpLmh0bWwoYDxpIGNsYXNzPVwiZmFzIGZhLXBsdXNcIj48L2k+YCk7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IGlucHV0XCIpLnZhbChcIlwiKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgaW5wdXRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGFjdGlvbiA9PT0gXCJlZGl0XCIgJiYgaWQgJiYgbmFtZSkge1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdFwiKS5hdHRyKFwiYWN0aW9uXCIsIFwiZWRpdFwiKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXRcIikuYXR0cihcInRhZ2lkXCIsIGlkKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgLnRpdGxlXCIpLmh0bWwoXCJFZGl0IHRhZyBuYW1lXCIpO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCAuYnV0dG9uXCIpLmh0bWwoYDxpIGNsYXNzPVwiZmFzIGZhLXBlblwiPjwvaT5gKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgaW5wdXRcIikudmFsKG5hbWUpO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCBpbnB1dFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoYWN0aW9uID09PSBcInJlbW92ZVwiICYmIGlkICYmIG5hbWUpIHtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXRcIikuYXR0cihcImFjdGlvblwiLCBcInJlbW92ZVwiKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXRcIikuYXR0cihcInRhZ2lkXCIsIGlkKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgLnRpdGxlXCIpLmh0bWwoXCJSZW1vdmUgdGFnIFwiICsgbmFtZSk7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IC5idXR0b25cIikuaHRtbChgPGkgY2xhc3M9XCJmYXMgZmEtY2hlY2tcIj48L2k+YCk7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IGlucHV0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChhY3Rpb24gPT09IFwiY2xlYXJQYlwiICYmIGlkICYmIG5hbWUpIHtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXRcIikuYXR0cihcImFjdGlvblwiLCBcImNsZWFyUGJcIik7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0XCIpLmF0dHIoXCJ0YWdpZFwiLCBpZCk7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IC50aXRsZVwiKS5odG1sKFwiQ2xlYXIgUEIgZm9yIHRhZyBcIiArIG5hbWUpO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCAuYnV0dG9uXCIpLmh0bWwoYDxpIGNsYXNzPVwiZmFzIGZhLWNoZWNrXCI+PC9pPmApO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCBpbnB1dFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgaWYgKCQoXCIjdGFnc1dyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IGlucHV0XCIpLnRyaWdnZXIoXCJmb2N1c1wiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgaWYgKCEkKFwiI3RhZ3NXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0XCIpLmF0dHIoXCJhY3Rpb25cIiwgXCJcIik7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0XCIpLmF0dHIoXCJ0YWdpZFwiLCBcIlwiKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjdGFnc1dyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGFwcGx5KCkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCBhY3Rpb24gPSAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdFwiKS5hdHRyKFwiYWN0aW9uXCIpO1xuICAgICAgICBjb25zdCB0YWdOYW1lID0gJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgaW5wdXRcIikudmFsKCk7XG4gICAgICAgIGNvbnN0IHRhZ0lkID0gJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXRcIikuYXR0cihcInRhZ2lkXCIpO1xuICAgICAgICBoaWRlKCk7XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIGlmIChhY3Rpb24gPT09IFwiYWRkXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5jcmVhdGVUYWcodGFnTmFtZSk7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBhZGQgdGFnOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiVGFnIGFkZGVkXCIsIDEpO1xuICAgICAgICAgICAgICAgIChfYSA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiByZXNwb25zZS5kYXRhLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogcmVzcG9uc2UuZGF0YS5faWQsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgUmVzdWx0VGFnc1BvcHVwLnVwZGF0ZUJ1dHRvbnMoKTtcbiAgICAgICAgICAgICAgICBTZXR0aW5ncy51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICBSZXN1bHRGaWx0ZXJzLnVwZGF0ZVRhZ3MoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChhY3Rpb24gPT09IFwiZWRpdFwiKSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMuZWRpdFRhZyh0YWdJZCwgdGFnTmFtZSk7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBlZGl0IHRhZzogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlRhZyB1cGRhdGVkXCIsIDEpO1xuICAgICAgICAgICAgICAgIChfYiA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGFnLl9pZCA9PT0gdGFnSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhZy5uYW1lID0gdGFnTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIFJlc3VsdFRhZ3NQb3B1cC51cGRhdGVCdXR0b25zKCk7XG4gICAgICAgICAgICAgICAgU2V0dGluZ3MudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgUmVzdWx0RmlsdGVycy51cGRhdGVUYWdzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYWN0aW9uID09PSBcInJlbW92ZVwiKSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMuZGVsZXRlVGFnKHRhZ0lkKTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHJlbW92ZSB0YWc6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJUYWcgcmVtb3ZlZFwiLCAxKTtcbiAgICAgICAgICAgICAgICAoX2MgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5mb3JFYWNoKCh0YWcsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhZy5faWQgPT09IHRhZ0lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgUmVzdWx0VGFnc1BvcHVwLnVwZGF0ZUJ1dHRvbnMoKTtcbiAgICAgICAgICAgICAgICBTZXR0aW5ncy51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICBSZXN1bHRGaWx0ZXJzLnVwZGF0ZVRhZ3MoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChhY3Rpb24gPT09IFwiY2xlYXJQYlwiKSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMuZGVsZXRlVGFnUGVyc29uYWxCZXN0KHRhZ0lkKTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGNsZWFyIHRhZyBwYjogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlRhZyBQQiBjbGVhcmVkXCIsIDEpO1xuICAgICAgICAgICAgICAgIChfZCA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGFnLl9pZCA9PT0gdGFnSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhZy5wZXJzb25hbEJlc3RzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRzOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXN0b206IHsgY3VzdG9tOiBbXSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHplbjogeyB6ZW46IFtdIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVvdGU6IHsgY3VzdG9tOiBbXSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIFJlc3VsdFRhZ3NQb3B1cC51cGRhdGVCdXR0b25zKCk7XG4gICAgICAgICAgICAgICAgU2V0dGluZ3MudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgUmVzdWx0RmlsdGVycy51cGRhdGVUYWdzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICB9KTtcbn1cbiQoXCIjdGFnc1dyYXBwZXJcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwidGFnc1dyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4kKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCAuYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGFwcGx5KCk7XG59KTtcbiQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IGlucHV0XCIpLm9uKFwia2V5cHJlc3NcIiwgKGUpID0+IHtcbiAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICBhcHBseSgpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGFncyAuYWRkVGFnQnV0dG9uXCIsICgpID0+IHtcbiAgICBzaG93KFwiYWRkXCIpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50YWdzIC50YWdzTGlzdCAudGFnIC5lZGl0QnV0dG9uXCIsIChlKSA9PiB7XG4gICAgY29uc3QgdGFnaWQgPSAkKGUuY3VycmVudFRhcmdldCkucGFyZW50KFwiLnRhZ1wiKS5hdHRyKFwiaWRcIik7XG4gICAgY29uc3QgbmFtZSA9ICQoZS5jdXJyZW50VGFyZ2V0KVxuICAgICAgICAuc2libGluZ3MoXCIudGFnQnV0dG9uXCIpXG4gICAgICAgIC5jaGlsZHJlbihcIi50aXRsZVwiKVxuICAgICAgICAudGV4dCgpO1xuICAgIHNob3coXCJlZGl0XCIsIHRhZ2lkLCBuYW1lKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGFncyAudGFnc0xpc3QgLnRhZyAuY2xlYXJQYkJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIGNvbnN0IHRhZ2lkID0gJChlLmN1cnJlbnRUYXJnZXQpLnBhcmVudChcIi50YWdcIikuYXR0cihcImlkXCIpO1xuICAgIGNvbnN0IG5hbWUgPSAkKGUuY3VycmVudFRhcmdldClcbiAgICAgICAgLnNpYmxpbmdzKFwiLnRhZ0J1dHRvblwiKVxuICAgICAgICAuY2hpbGRyZW4oXCIudGl0bGVcIilcbiAgICAgICAgLnRleHQoKTtcbiAgICBzaG93KFwiY2xlYXJQYlwiLCB0YWdpZCwgbmFtZSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRhZ3MgLnRhZ3NMaXN0IC50YWcgLnJlbW92ZUJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIGNvbnN0IHRhZ2lkID0gJChlLmN1cnJlbnRUYXJnZXQpLnBhcmVudChcIi50YWdcIikuYXR0cihcImlkXCIpO1xuICAgIGNvbnN0IG5hbWUgPSAkKGUuY3VycmVudFRhcmdldClcbiAgICAgICAgLnNpYmxpbmdzKFwiLnRhZ0J1dHRvblwiKVxuICAgICAgICAuY2hpbGRyZW4oXCIudGl0bGVcIilcbiAgICAgICAgLnRleHQoKTtcbiAgICBzaG93KFwicmVtb3ZlXCIsIHRhZ2lkLCBuYW1lKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmNvbnN0IFVwZGF0ZUNvbmZpZyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuZnVuY3Rpb24gc2hvdyhtb2RlLCBjb25maWcpIHtcbiAgICBpZiAoJChcIiNzZXR0aW5nc0ltcG9ydFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNzZXR0aW5nc0ltcG9ydFdyYXBwZXJcIikuYXR0cihcIm1vZGVcIiwgbW9kZSk7XG4gICAgICAgIGlmIChtb2RlID09PSBcImV4cG9ydFwiKSB7XG4gICAgICAgICAgICAkKFwiI3NldHRpbmdzSW1wb3J0V3JhcHBlciAuYnV0dG9uXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIiNzZXR0aW5nc0ltcG9ydFdyYXBwZXIgaW5wdXRcIikudmFsKGNvbmZpZyAhPT0gbnVsbCAmJiBjb25maWcgIT09IHZvaWQgMCA/IGNvbmZpZyA6IFwiXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG1vZGUgPT09IFwiaW1wb3J0XCIpIHtcbiAgICAgICAgICAgICQoXCIjc2V0dGluZ3NJbXBvcnRXcmFwcGVyIC5idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgJChcIiNzZXR0aW5nc0ltcG9ydFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3NldHRpbmdzSW1wb3J0V3JhcHBlciBpbnB1dFwiKS50cmlnZ2VyKFwiZm9jdXNcIik7XG4gICAgICAgICAgICAkKFwiI3NldHRpbmdzSW1wb3J0V3JhcHBlciBpbnB1dFwiKS5zZWxlY3QoKTtcbiAgICAgICAgICAgICQoXCIjc2V0dGluZ3NJbXBvcnRXcmFwcGVyIGlucHV0XCIpLnRyaWdnZXIoXCJmb2N1c1wiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgaWYgKCEkKFwiI3NldHRpbmdzSW1wb3J0V3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICBpZiAoJChcIiNzZXR0aW5nc0ltcG9ydFdyYXBwZXIgaW5wdXRcIikudmFsKCkgIT09IFwiXCIpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLmFwcGx5KEpTT04ucGFyc2UoJChcIiNzZXR0aW5nc0ltcG9ydFdyYXBwZXIgaW5wdXRcIikudmFsKCkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJBbiBlcnJvciBvY2N1cmVkIHdoaWxlIGltcG9ydGluZyBzZXR0aW5nczogXCIgKyBlLCAtMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2F2ZUZ1bGxDb25maWdUb0xvY2FsU3RvcmFnZSgpO1xuICAgICAgICB9XG4gICAgICAgICQoXCIjc2V0dGluZ3NJbXBvcnRXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMCB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjc2V0dGluZ3NJbXBvcnRXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4kKFwiI3NldHRpbmdzSW1wb3J0IC5idXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgaGlkZSgpO1xufSk7XG4kKFwiI3NldHRpbmdzSW1wb3J0V3JhcHBlclwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJzZXR0aW5nc0ltcG9ydFdyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51cGRhdGUgPSB2b2lkIDA7XG5jb25zdCBUZXN0TG9naWMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC1sb2dpY1wiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IFVwZGF0ZUNvbmZpZyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IE1hbnVhbFJlc3RhcnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvbWFudWFsLXJlc3RhcnQtdHJhY2tlclwiKSk7XG5jb25zdCBDdXN0b21Xb3JkQW1vdW50UG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY3VzdG9tLXdvcmQtYW1vdW50LXBvcHVwXCIpKTtcbmNvbnN0IEN1c3RvbVRlc3REdXJhdGlvblBvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2N1c3RvbS10ZXN0LWR1cmF0aW9uLXBvcHVwXCIpKTtcbmNvbnN0IFF1b3RlU2VhcmNoUG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vcXVvdGUtc2VhcmNoLXBvcHVwXCIpKTtcbmNvbnN0IEN1c3RvbVRleHRQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jdXN0b20tdGV4dC1wb3B1cFwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmNvbnN0IGVsID0gJChcIiNtb2JpbGVUZXN0Q29uZmlnUG9wdXBcIik7XG5mdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgZWwuZmluZChcIi5idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgZWwuZmluZChgLm1vZGVHcm91cCAuYnV0dG9uW21vZGU9JyR7Y29uZmlnXzEuZGVmYXVsdC5tb2RlfSddYCkuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgZWwuZmluZChcIi50aW1lR3JvdXBcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgZWwuZmluZChcIi53b3Jkc0dyb3VwXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIGVsLmZpbmQoXCIucXVvdGVHcm91cFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICBlbC5maW5kKFwiLmN1c3RvbUdyb3VwXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIGVsLmZpbmQoYC4ke2NvbmZpZ18xLmRlZmF1bHQubW9kZX1Hcm91cGApLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnB1bmN0dWF0aW9uKSB7XG4gICAgICAgIGVsLmZpbmQoXCIucHVuY3R1YXRpb25cIikuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBlbC5maW5kKFwiLnB1bmN0dWF0aW9uXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5udW1iZXJzKSB7XG4gICAgICAgIGVsLmZpbmQoXCIubnVtYmVyc1wiKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGVsLmZpbmQoXCIubnVtYmVyc1wiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgZWwuZmluZChgLnRpbWVHcm91cCAuYnV0dG9uW3RpbWU9JyR7Y29uZmlnXzEuZGVmYXVsdC50aW1lfSddYCkuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgIGVsLmZpbmQoXCIucHVuY3R1YXRpb25cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgZWwuZmluZChcIi5udW1iZXJzXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ3b3Jkc1wiKSB7XG4gICAgICAgIGVsLmZpbmQoYC53b3Jkc0dyb3VwIC5idXR0b25bd29yZHM9JyR7Y29uZmlnXzEuZGVmYXVsdC53b3Jkc30nXWApLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICBlbC5maW5kKFwiLnB1bmN0dWF0aW9uXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIGVsLmZpbmQoXCIubnVtYmVyc1wiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICBlbC5maW5kKGAucXVvdGVHcm91cCAuYnV0dG9uW3F1b3RlPScke2NvbmZpZ18xLmRlZmF1bHQucXVvdGVMZW5ndGh9J11gKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgZWwuZmluZChcIi5wdW5jdHVhdGlvblwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICBlbC5maW5kKFwiLm51bWJlcnNcIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInplblwiKSB7XG4gICAgICAgIGVsLmZpbmQoXCIucHVuY3R1YXRpb25cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgZWwuZmluZChcIi5udW1iZXJzXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICBlbC5maW5kKFwiLnB1bmN0dWF0aW9uXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIGVsLmZpbmQoXCIubnVtYmVyc1wiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIH1cbn1cbmV4cG9ydHMudXBkYXRlID0gdXBkYXRlO1xuZnVuY3Rpb24gc2hvd1BvcHVwKCkge1xuICAgIGlmICgkKFwiI21vYmlsZVRlc3RDb25maWdQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgdXBkYXRlKCk7XG4gICAgICAgICQoXCIjbW9iaWxlVGVzdENvbmZpZ1BvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMDApO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGhpZGVQb3B1cCgpIHtcbiAgICBpZiAoISQoXCIjbW9iaWxlVGVzdENvbmZpZ1BvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI21vYmlsZVRlc3RDb25maWdQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI21vYmlsZVRlc3RDb25maWdQb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiQoXCIjbW9iaWxlVGVzdENvbmZpZ1BvcHVwV3JhcHBlclwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJtb2JpbGVUZXN0Q29uZmlnUG9wdXBXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZVBvcHVwKCk7XG4gICAgfVxufSk7XG4kKFwiI3RvcCAubW9iaWxlQ29uZmlnXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHNob3dQb3B1cCgpO1xufSk7XG5lbC5maW5kKFwiLndvcmRzR3JvdXAgLmJ1dHRvblwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgY29uc3Qgd3JkID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJ3b3Jkc1wiKTtcbiAgICBpZiAod3JkID09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgaGlkZVBvcHVwKCk7XG4gICAgICAgIEN1c3RvbVdvcmRBbW91bnRQb3B1cC5zaG93KCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHdyZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnN0IHdyZE51bSA9IHBhcnNlSW50KHdyZCk7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRXb3JkQ291bnQod3JkTnVtKTtcbiAgICAgICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICB9XG59KTtcbmVsLmZpbmQoXCIudGltZUdyb3VwIC5idXR0b25cIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGNvbnN0IHRpbWUgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcInRpbWVcIik7XG4gICAgaWYgKHRpbWUgPT0gXCJjdXN0b21cIikge1xuICAgICAgICBoaWRlUG9wdXAoKTtcbiAgICAgICAgQ3VzdG9tVGVzdER1cmF0aW9uUG9wdXAuc2hvdygpO1xuICAgIH1cbiAgICBlbHNlIGlmICh0aW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29uc3QgdGltZU51bSA9IHBhcnNlSW50KHRpbWUpO1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZUNvbmZpZyh0aW1lTnVtKTtcbiAgICAgICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICB9XG59KTtcbmVsLmZpbmQoXCIucXVvdGVHcm91cCAuYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgbGV0IGxlbiA9ICgoX2EgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcInF1b3RlXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAwKTtcbiAgICBpZiAobGVuID09IC0yKSB7XG4gICAgICAgIC8vIFVwZGF0ZUNvbmZpZy5zZXRRdW90ZUxlbmd0aCgtMiwgZmFsc2UsIGUuc2hpZnRLZXkpO1xuICAgICAgICBoaWRlUG9wdXAoKTtcbiAgICAgICAgUXVvdGVTZWFyY2hQb3B1cC5zaG93KCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAobGVuID09IC0xKSB7XG4gICAgICAgICAgICBsZW4gPSBbMCwgMSwgMiwgM107XG4gICAgICAgIH1cbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldFF1b3RlTGVuZ3RoKGxlbiwgZmFsc2UsIGUuc2hpZnRLZXkpO1xuICAgICAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgIH1cbn0pO1xuZWwuZmluZChcIi5jdXN0b21DaGFuZ2VcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgaGlkZVBvcHVwKCk7XG4gICAgQ3VzdG9tVGV4dFBvcHVwLnNob3coKTtcbn0pO1xuZWwuZmluZChcIi5wdW5jdHVhdGlvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0UHVuY3R1YXRpb24oIWNvbmZpZ18xLmRlZmF1bHQucHVuY3R1YXRpb24pO1xuICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbn0pO1xuZWwuZmluZChcIi5udW1iZXJzXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXROdW1iZXJzKCFjb25maWdfMS5kZWZhdWx0Lm51bWJlcnMpO1xuICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbn0pO1xuZWwuZmluZChcIi5tb2RlR3JvdXAgLmJ1dHRvblwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS5jdXJyZW50VGFyZ2V0KS5oYXNDbGFzcyhcImFjdGl2ZVwiKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IG1vZGUgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcIm1vZGVcIik7XG4gICAgVXBkYXRlQ29uZmlnLnNldE1vZGUobW9kZSk7XG4gICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICBUZXN0TG9naWMucmVzdGFydCgpO1xufSk7XG4kKFwiI21vYmlsZVRlc3RDb25maWdQb3B1cCAuYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIC8vIGhpZGVQb3B1cCgpO1xuICAgIHVwZGF0ZSgpO1xufSk7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5KSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcIm1vZGVcIilcbiAgICAgICAgdXBkYXRlKCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgZm9ybWF0XzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImRhdGUtZm5zL2Zvcm1hdFwiKSk7XG5mdW5jdGlvbiB1cGRhdGUobW9kZSkge1xuICAgICQoXCIjcGJUYWJsZXNQb3B1cCB0YWJsZSB0Ym9keVwiKS5lbXB0eSgpO1xuICAgICQoJChcIiNwYlRhYmxlc1BvcHVwIHRhYmxlIHRoZWFkIHRyIHRkXCIpWzBdKS50ZXh0KG1vZGUpO1xuICAgIGNvbnN0IHNuYXBzaG90ID0gREIuZ2V0U25hcHNob3QoKTtcbiAgICBjb25zdCBhbGxtb2RlMiA9IChzbmFwc2hvdC5wZXJzb25hbEJlc3RzID09PSB1bmRlZmluZWRcbiAgICAgICAgPyB1bmRlZmluZWRcbiAgICAgICAgOiBzbmFwc2hvdC5wZXJzb25hbEJlc3RzW21vZGVdKTtcbiAgICBpZiAoYWxsbW9kZTIgPT09IHVuZGVmaW5lZClcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IGxpc3QgPSBbXTtcbiAgICBPYmplY3Qua2V5cyhhbGxtb2RlMikuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIGxldCBwYnMgPSBhbGxtb2RlMltrZXldO1xuICAgICAgICBwYnMgPSBwYnMuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgcmV0dXJuIGIud3BtIC0gYS53cG07XG4gICAgICAgICAgICAvLyBpZiAoYS5kaWZmaWN1bHR5ID09PSBiLmRpZmZpY3VsdHkpIHtcbiAgICAgICAgICAgIC8vICAgcmV0dXJuIChhLmxhbmd1YWdlIDwgYi5sYW5ndWFnZSA/IC0xIDogMSk7XG4gICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAvLyByZXR1cm4gKGEuZGlmZmljdWx0eSA8IGIuZGlmZmljdWx0eSA/IC0xIDogMSlcbiAgICAgICAgfSk7XG4gICAgICAgIHBicy5mb3JFYWNoKGZ1bmN0aW9uIChwYikge1xuICAgICAgICAgICAgcGIubW9kZTIgPSBrZXk7XG4gICAgICAgICAgICBsaXN0LnB1c2gocGIpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBsZXQgbW9kZTJtZW1vcnk7XG4gICAgbGlzdC5mb3JFYWNoKChwYikgPT4ge1xuICAgICAgICBsZXQgZGF0ZVRleHQgPSBgLTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+YDtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHBiLnRpbWVzdGFtcCk7XG4gICAgICAgIGlmIChwYi50aW1lc3RhbXApIHtcbiAgICAgICAgICAgIGRhdGVUZXh0ID1cbiAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJkZCBNTU0geXl5eVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPGJyPjxkaXYgY2xhc3M9J3N1Yic+XCIgK1xuICAgICAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJISDptbVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPC9kaXY+XCI7XG4gICAgICAgIH1cbiAgICAgICAgJChcIiNwYlRhYmxlc1BvcHVwIHRhYmxlIHRib2R5XCIpLmFwcGVuZChgXG4gICAgICA8dHI+XG4gICAgICAgIDx0ZD4ke21vZGUybWVtb3J5ID09PSBwYi5tb2RlMiA/IFwiXCIgOiBwYi5tb2RlMn08L3RkPlxuICAgICAgICA8dGQ+XG4gICAgICAgICAgJHtwYi53cG19XG4gICAgICAgICAgPGJyIC8+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiLmFjYyA/IHBiLmFjYyArIFwiJVwiIDogXCItXCJ9PC9zcGFuPlxuICAgICAgICA8L3RkPlxuICAgICAgICA8dGQ+XG4gICAgICAgICAgJHtwYi5yYXcgPyBwYi5yYXcgOiBcIi1cIn1cbiAgICAgICAgICA8YnIgLz5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cInN1YlwiPiR7cGIuY29uc2lzdGVuY3kgPyBwYi5jb25zaXN0ZW5jeSArIFwiJVwiIDogXCItXCJ9PC9zcGFuPlxuICAgICAgICA8L3RkPlxuICAgICAgICA8dGQ+JHtwYi5kaWZmaWN1bHR5fTwvdGQ+XG4gICAgICAgIDx0ZD4ke3BiLmxhbmd1YWdlID8gcGIubGFuZ3VhZ2UucmVwbGFjZSgvXy9nLCBcIiBcIikgOiBcIi1cIn08L3RkPlxuICAgICAgICA8dGQ+JHtwYi5wdW5jdHVhdGlvbiA/ICc8aSBjbGFzcz1cImZhcyBmYS1jaGVja1wiPjwvaT4nIDogXCJcIn08L3RkPlxuICAgICAgICA8dGQ+JHtwYi5sYXp5TW9kZSA/ICc8aSBjbGFzcz1cImZhcyBmYS1jaGVja1wiPjwvaT4nIDogXCJcIn08L3RkPlxuICAgICAgICA8dGQ+JHtkYXRlVGV4dH08L3RkPlxuICAgICAgPC90cj5cbiAgICBgKTtcbiAgICAgICAgbW9kZTJtZW1vcnkgPSBwYi5tb2RlMjtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHNob3cobW9kZSkge1xuICAgIGlmICgkKFwiI3BiVGFibGVzUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIHVwZGF0ZShtb2RlKTtcbiAgICAgICAgJChcIiNwYlRhYmxlc1BvcHVwIC50aXRsZVwiKS50ZXh0KGBBbGwgJHttb2RlfSBwZXJzb25hbCBiZXN0c2ApO1xuICAgICAgICAkKFwiI3BiVGFibGVzUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEwMCk7XG4gICAgfVxufVxuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICBpZiAoISQoXCIjcGJUYWJsZXNQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNwYlRhYmxlc1BvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjcGJUYWJsZXNQb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiI3BiVGFibGVzUG9wdXAgdGFibGUgdGJvZHlcIikuZW1wdHkoKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuJChcIiNwYlRhYmxlc1BvcHVwV3JhcHBlclwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJwYlRhYmxlc1BvcHVwV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbiQoXCIucGFnZUFjY291bnQgLmJ1dHRvbi5zaG93QWxsVGltZVBic1wiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBzaG93KFwidGltZVwiKTtcbn0pO1xuJChcIi5wYWdlQWNjb3VudCAuYnV0dG9uLnNob3dBbGxXb3Jkc1Bic1wiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBzaG93KFwid29yZHNcIik7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGlkZSA9IGV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmNvbnN0IGFwZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9hcGVcIikpO1xuY29uc3QgTG9hZGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sb2FkZXJcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBmb3JtYXRfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiZGF0ZS1mbnMvZm9ybWF0XCIpKTtcbmxldCBxdW90ZXMgPSBbXTtcbmZ1bmN0aW9uIHVwZGF0ZUxpc3QoKSB7XG4gICAgJChcIiNxdW90ZUFwcHJvdmVQb3B1cFdyYXBwZXIgLnF1b3Rlc1wiKS5lbXB0eSgpO1xuICAgIHF1b3Rlcy5mb3JFYWNoKChxdW90ZSwgaW5kZXgpID0+IHtcbiAgICAgICAgY29uc3QgcXVvdGVFbCA9ICQoYFxuICAgICAgPGRpdiBjbGFzcz1cInF1b3RlXCIgaWQ9XCIke2luZGV4fVwiIGRiaWQ9XCIke3F1b3RlLl9pZH1cIj5cbiAgICAgICAgPHRleHRhcmVhIGNsYXNzPVwidGV4dFwiPiR7cXVvdGUudGV4dH08L3RleHRhcmVhPlxuICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cInNvdXJjZVwiIHBsYWNlaG9sZGVyPVwiU291cmNlXCIgdmFsdWU9XCIke3F1b3RlLnNvdXJjZX1cIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImJ1dHRvbnNcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiaWNvbi1idXR0b24gZGlzYWJsZWQgdW5kb1wiIGFyaWEtbGFiZWw9XCJVbmRvIGNoYW5nZXNcIiBkYXRhLWJhbGxvb24tcG9zPVwibGVmdFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXVuZG8tYWx0XCI+PC9pPjwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJpY29uLWJ1dHRvbiByZWZ1c2VcIiBhcmlhLWxhYmVsPVwiUmVmdXNlIHF1b3RlXCIgZGF0YS1iYWxsb29uLXBvcz1cImxlZnRcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS10aW1lc1wiPjwvaT48L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiaWNvbi1idXR0b24gYXBwcm92ZVwiIGFyaWEtbGFiZWw9XCJBcHByb3ZlIHF1b3RlXCIgZGF0YS1iYWxsb29uLXBvcz1cImxlZnRcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1jaGVja1wiPjwvaT48L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiaWNvbi1idXR0b24gZWRpdCBoaWRkZW5cIiBhcmlhLWxhYmVsPVwiRWRpdCBhbmQgYXBwcm92ZSBxdW90ZVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJsZWZ0XCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtcGVuXCI+PC9pPjwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImJvdHRvbVwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJsZW5ndGggJHtxdW90ZS50ZXh0Lmxlbmd0aCA8IDYwID8gXCJyZWRcIiA6IFwiXCJ9XCI+UXVvdGUgbGVuZ3RoOiAke3F1b3RlLnRleHQubGVuZ3RofTwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJsYW5ndWFnZVwiPkxhbmd1YWdlOiAke3F1b3RlLmxhbmd1YWdlfTwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0aW1lc3RhbXBcIj5TdWJtaXR0ZWQgb246ICR7KDAsIGZvcm1hdF8xLmRlZmF1bHQpKG5ldyBEYXRlKHF1b3RlLnRpbWVzdGFtcCksIFwiZGQgTU1NIHl5eXkgSEg6bW1cIil9PC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgYCk7XG4gICAgICAgICQoXCIjcXVvdGVBcHByb3ZlUG9wdXBXcmFwcGVyIC5xdW90ZXNcIikuYXBwZW5kKHF1b3RlRWwpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gdXBkYXRlUXVvdGVMZW5ndGgoaW5kZXgpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgbGVuID0gKF9hID0gJChgI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZVtpZD0ke2luZGV4fV0gLnRleHRgKS52YWwoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aDtcbiAgICAkKGAjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlW2lkPSR7aW5kZXh9XSAubGVuZ3RoYCkudGV4dChcIlF1b3RlIGxlbmd0aDogXCIgKyBsZW4pO1xuICAgIGlmIChsZW4gPCA2MCkge1xuICAgICAgICAkKGAjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlW2lkPSR7aW5kZXh9XSAubGVuZ3RoYCkuYWRkQ2xhc3MoXCJyZWRcIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKGAjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlW2lkPSR7aW5kZXh9XSAubGVuZ3RoYCkucmVtb3ZlQ2xhc3MoXCJyZWRcIik7XG4gICAgfVxufVxuZnVuY3Rpb24gZ2V0UXVvdGVzKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5xdW90ZXMuZ2V0KCk7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGdldCBuZXcgcXVvdGVzOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBxdW90ZXMgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICB1cGRhdGVMaXN0KCk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBzaG93KG5vQW5pbSA9IGZhbHNlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCQoXCIjcXVvdGVBcHByb3ZlUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICAgICBxdW90ZXMgPSBbXTtcbiAgICAgICAgICAgIGdldFF1b3RlcygpO1xuICAgICAgICAgICAgJChcIiNxdW90ZUFwcHJvdmVQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIG5vQW5pbSA/IDAgOiAxMDApO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICBpZiAoISQoXCIjcXVvdGVBcHByb3ZlUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjcXVvdGVBcHByb3ZlUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNxdW90ZUFwcHJvdmVQb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiI3F1b3RlQXBwcm92ZVBvcHVwV3JhcHBlciAucXVvdGVzXCIpLmVtcHR5KCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG5mdW5jdGlvbiByZXNldEJ1dHRvbnModGFyZ2V0KSB7XG4gICAgJCh0YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuZmluZChcIi5pY29uLWJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIGlmICgkKHRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5maW5kKFwiLmVkaXRcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJCh0YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuZmluZChcIi51bmRvXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgfVxufVxuJChcIiNxdW90ZUFwcHJvdmVQb3B1cFdyYXBwZXJcIikub24oXCJtb3VzZWRvd25cIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcInF1b3RlQXBwcm92ZVBvcHVwV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbiQoXCIjcXVvdGVBcHByb3ZlUG9wdXBXcmFwcGVyIC5idXR0b24ucmVmcmVzaExpc3RcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgJChcIiNxdW90ZUFwcHJvdmVQb3B1cFdyYXBwZXIgLnF1b3Rlc1wiKS5lbXB0eSgpO1xuICAgIGdldFF1b3RlcygpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZSAudW5kb1wiLCAoZSkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgY29uc3QgaW5kZXggPSBwYXJzZUludCgkKGUudGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmF0dHIoXCJpZFwiKSk7XG4gICAgJChgI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZVtpZD0ke2luZGV4fV0gLnRleHRgKS52YWwocXVvdGVzW2luZGV4XS50ZXh0KTtcbiAgICAkKGAjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlW2lkPSR7aW5kZXh9XSAuc291cmNlYCkudmFsKHF1b3Rlc1tpbmRleF0uc291cmNlKTtcbiAgICAkKGAjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlW2lkPSR7aW5kZXh9XSAudW5kb2ApLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgJChgI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZVtpZD0ke2luZGV4fV0gLmFwcHJvdmVgKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAkKGAjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlW2lkPSR7aW5kZXh9XSAuZWRpdGApLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIHVwZGF0ZVF1b3RlTGVuZ3RoKGluZGV4KTtcbn0pKTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlIC5hcHByb3ZlXCIsIChlKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKCFjb25maXJtKFwiQXJlIHlvdSBzdXJlP1wiKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IGluZGV4ID0gcGFyc2VJbnQoJChlLnRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5hdHRyKFwiaWRcIikpO1xuICAgIGNvbnN0IGRiaWQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmF0dHIoXCJkYmlkXCIpO1xuICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xuICAgICQodGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmZpbmQoXCIuaWNvbi1idXR0b25cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAkKHRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5maW5kKFwidGV4dGFyZWEsIGlucHV0XCIpLnByb3AoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICBMb2FkZXIuc2hvdygpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5xdW90ZXMuYXBwcm92ZVN1Ym1pc3Npb24oZGJpZCk7XG4gICAgTG9hZGVyLmhpZGUoKTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgcmVzZXRCdXR0b25zKHRhcmdldCk7XG4gICAgICAgICQodGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmZpbmQoXCJ0ZXh0YXJlYSwgaW5wdXRcIikucHJvcChcImRpc2FibGVkXCIsIGZhbHNlKTtcbiAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGFwcHJvdmUgcXVvdGU6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgIH1cbiAgICBOb3RpZmljYXRpb25zLmFkZCgoX2EgPSBcIlF1b3RlIGFwcHJvdmVkLiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiXCIsIDEpO1xuICAgIHF1b3Rlcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIHVwZGF0ZUxpc3QoKTtcbn0pKTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlIC5yZWZ1c2VcIiwgKGUpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIGlmICghY29uZmlybShcIkFyZSB5b3Ugc3VyZT9cIikpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBpbmRleCA9IHBhcnNlSW50KCQoZS50YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuYXR0cihcImlkXCIpKTtcbiAgICBjb25zdCBkYmlkID0gJChlLnRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5hdHRyKFwiZGJpZFwiKTtcbiAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldDtcbiAgICAkKHRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5maW5kKFwiLmljb24tYnV0dG9uXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgJCh0YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuZmluZChcInRleHRhcmVhLCBpbnB1dFwiKS5wcm9wKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgTG9hZGVyLnNob3coKTtcbiAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucXVvdGVzLnJlamVjdFN1Ym1pc3Npb24oZGJpZCk7XG4gICAgTG9hZGVyLmhpZGUoKTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgcmVzZXRCdXR0b25zKHRhcmdldCk7XG4gICAgICAgICQodGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmZpbmQoXCJ0ZXh0YXJlYSwgaW5wdXRcIikucHJvcChcImRpc2FibGVkXCIsIGZhbHNlKTtcbiAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHJlZnVzZSBxdW90ZTogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgfVxuICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUXVvdGUgcmVmdXNlZC5cIiwgMSk7XG4gICAgcXVvdGVzLnNwbGljZShpbmRleCwgMSk7XG4gICAgdXBkYXRlTGlzdCgpO1xufSkpO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGUgLmVkaXRcIiwgKGUpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHZhciBfYjtcbiAgICBpZiAoIWNvbmZpcm0oXCJBcmUgeW91IHN1cmU/XCIpKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgaW5kZXggPSBwYXJzZUludCgkKGUudGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmF0dHIoXCJpZFwiKSk7XG4gICAgY29uc3QgZGJpZCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuYXR0cihcImRiaWRcIik7XG4gICAgY29uc3QgZWRpdFRleHQgPSAkKGAjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlW2lkPSR7aW5kZXh9XSAudGV4dGApLnZhbCgpO1xuICAgIGNvbnN0IGVkaXRTb3VyY2UgPSAkKGAjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlW2lkPSR7aW5kZXh9XSAuc291cmNlYCkudmFsKCk7XG4gICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgJCh0YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuZmluZChcIi5pY29uLWJ1dHRvblwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICQodGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmZpbmQoXCJ0ZXh0YXJlYSwgaW5wdXRcIikucHJvcChcImRpc2FibGVkXCIsIHRydWUpO1xuICAgIExvYWRlci5zaG93KCk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnF1b3Rlcy5hcHByb3ZlU3VibWlzc2lvbihkYmlkLCBlZGl0VGV4dCwgZWRpdFNvdXJjZSk7XG4gICAgTG9hZGVyLmhpZGUoKTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgcmVzZXRCdXR0b25zKHRhcmdldCk7XG4gICAgICAgICQodGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmZpbmQoXCJ0ZXh0YXJlYSwgaW5wdXRcIikucHJvcChcImRpc2FibGVkXCIsIGZhbHNlKTtcbiAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGFwcHJvdmUgcXVvdGU6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgIH1cbiAgICBOb3RpZmljYXRpb25zLmFkZCgoX2IgPSBcIlF1b3RlIGVkaXRlZCBhbmQgYXBwcm92ZWQuIFwiICsgcmVzcG9uc2UubWVzc2FnZSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogXCJcIiwgMSk7XG4gICAgcXVvdGVzLnNwbGljZShpbmRleCwgMSk7XG4gICAgdXBkYXRlTGlzdCgpO1xufSkpO1xuJChkb2N1bWVudCkub24oXCJpbnB1dFwiLCBcIiNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGUgLnRleHRcIiwgKGUpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIGNvbnN0IGluZGV4ID0gcGFyc2VJbnQoJChlLnRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5hdHRyKFwiaWRcIikpO1xuICAgICQoYCNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGVbaWQ9JHtpbmRleH1dIC51bmRvYCkucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAkKGAjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlW2lkPSR7aW5kZXh9XSAuYXBwcm92ZWApLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICQoYCNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGVbaWQ9JHtpbmRleH1dIC5lZGl0YCkucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgdXBkYXRlUXVvdGVMZW5ndGgoaW5kZXgpO1xufSkpO1xuJChkb2N1bWVudCkub24oXCJpbnB1dFwiLCBcIiNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGUgLnNvdXJjZVwiLCAoZSkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgY29uc3QgaW5kZXggPSBwYXJzZUludCgkKGUudGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmF0dHIoXCJpZFwiKSk7XG4gICAgJChgI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZVtpZD0ke2luZGV4fV0gLnVuZG9gKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICQoYCNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGVbaWQ9JHtpbmRleH1dIC5hcHByb3ZlYCkuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgJChgI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZVtpZD0ke2luZGV4fV0gLmVkaXRgKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbn0pKTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuY2xlYXJRdW90ZVN0YXRzID0gZXhwb3J0cy5zaG93ID0gZXhwb3J0cy5nZXRRdW90ZVN0YXRzID0gdm9pZCAwO1xuY29uc3QgYXBlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2FwZVwiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgVGVzdFdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3Qtd29yZHNcIikpO1xuY29uc3QgTG9hZGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sb2FkZXJcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5sZXQgcmF0aW5nID0gMDtcbmxldCBxdW90ZVN0YXRzID0gbnVsbDtcbmxldCBjdXJyZW50UXVvdGUgPSBudWxsO1xuZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgJChgI3F1b3RlUmF0ZVBvcHVwIC5xdW90ZSAudGV4dGApLnRleHQoXCItXCIpO1xuICAgICQoYCNxdW90ZVJhdGVQb3B1cCAucXVvdGUgLnNvdXJjZSAudmFsYCkudGV4dChcIi1cIik7XG4gICAgJChgI3F1b3RlUmF0ZVBvcHVwIC5xdW90ZSAuaWQgLnZhbGApLnRleHQoXCItXCIpO1xuICAgICQoYCNxdW90ZVJhdGVQb3B1cCAucXVvdGUgLmxlbmd0aCAudmFsYCkudGV4dChcIi1cIik7XG4gICAgJChcIiNxdW90ZVJhdGVQb3B1cCAucmF0aW5nQ291bnQgLnZhbFwiKS50ZXh0KFwiLVwiKTtcbiAgICAkKFwiI3F1b3RlUmF0ZVBvcHVwIC5yYXRpbmdBdmVyYWdlIC52YWxcIikudGV4dChcIi1cIik7XG59XG5mdW5jdGlvbiBnZXRSYXRpbmdBdmVyYWdlKHF1b3RlU3RhdHMpIHtcbiAgICBpZiAoIXF1b3RlU3RhdHMudG90YWxSYXRpbmcgfHwgIXF1b3RlU3RhdHMucmF0aW5ncykge1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgcmV0dXJuIE1hdGgucm91bmQoKHF1b3RlU3RhdHMudG90YWxSYXRpbmcgLyBxdW90ZVN0YXRzLnJhdGluZ3MpICogMTApIC8gMTA7XG59XG5mdW5jdGlvbiBnZXRRdW90ZVN0YXRzKHF1b3RlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCFxdW90ZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGN1cnJlbnRRdW90ZSA9IHF1b3RlO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucXVvdGVzLmdldFJhdGluZyhjdXJyZW50UXVvdGUpO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGdldCBxdW90ZSByYXRpbmdzOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXJlc3BvbnNlLmRhdGEpIHtcbiAgICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgfVxuICAgICAgICBxdW90ZVN0YXRzID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgaWYgKHF1b3RlU3RhdHMgJiYgIXF1b3RlU3RhdHMuYXZlcmFnZSkge1xuICAgICAgICAgICAgcXVvdGVTdGF0cy5hdmVyYWdlID0gZ2V0UmF0aW5nQXZlcmFnZShxdW90ZVN0YXRzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcXVvdGVTdGF0cztcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0UXVvdGVTdGF0cyA9IGdldFF1b3RlU3RhdHM7XG5mdW5jdGlvbiByZWZyZXNoU3RhcnMoZm9yY2UpIHtcbiAgICBjb25zdCBsaW1pdCA9IGZvcmNlID8gZm9yY2UgOiByYXRpbmc7XG4gICAgJChgI3F1b3RlUmF0ZVBvcHVwIC5zdGFyYCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gbGltaXQ7IGkrKykge1xuICAgICAgICAkKGAjcXVvdGVSYXRlUG9wdXAgLnN0YXJbcmF0aW5nPSR7aX1dYCkuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgfVxufVxuZnVuY3Rpb24gdXBkYXRlUmF0aW5nU3RhdHMoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCFxdW90ZVN0YXRzKVxuICAgICAgICAgICAgeWllbGQgZ2V0UXVvdGVTdGF0cygpO1xuICAgICAgICAkKFwiI3F1b3RlUmF0ZVBvcHVwIC5yYXRpbmdDb3VudCAudmFsXCIpLnRleHQoKF9hID0gcXVvdGVTdGF0cyA9PT0gbnVsbCB8fCBxdW90ZVN0YXRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBxdW90ZVN0YXRzLnJhdGluZ3MpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiMFwiKTtcbiAgICAgICAgJChcIiNxdW90ZVJhdGVQb3B1cCAucmF0aW5nQXZlcmFnZSAudmFsXCIpLnRleHQoKF9jID0gKF9iID0gcXVvdGVTdGF0cyA9PT0gbnVsbCB8fCBxdW90ZVN0YXRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBxdW90ZVN0YXRzLmF2ZXJhZ2UpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50b0ZpeGVkKDEpKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiBcIi1cIik7XG4gICAgfSk7XG59XG5mdW5jdGlvbiB1cGRhdGVEYXRhKCkge1xuICAgIGlmICghY3VycmVudFF1b3RlKVxuICAgICAgICByZXR1cm47XG4gICAgbGV0IGxlbmd0aERlc2M7XG4gICAgaWYgKGN1cnJlbnRRdW90ZS5ncm91cCA9PSAwKSB7XG4gICAgICAgIGxlbmd0aERlc2MgPSBcInNob3J0XCI7XG4gICAgfVxuICAgIGVsc2UgaWYgKGN1cnJlbnRRdW90ZS5ncm91cCA9PSAxKSB7XG4gICAgICAgIGxlbmd0aERlc2MgPSBcIm1lZGl1bVwiO1xuICAgIH1cbiAgICBlbHNlIGlmIChjdXJyZW50UXVvdGUuZ3JvdXAgPT0gMikge1xuICAgICAgICBsZW5ndGhEZXNjID0gXCJsb25nXCI7XG4gICAgfVxuICAgIGVsc2UgaWYgKGN1cnJlbnRRdW90ZS5ncm91cCA9PSAzKSB7XG4gICAgICAgIGxlbmd0aERlc2MgPSBcInRoaWNjXCI7XG4gICAgfVxuICAgICQoYCNxdW90ZVJhdGVQb3B1cCAucXVvdGUgLnRleHRgKS50ZXh0KGN1cnJlbnRRdW90ZS50ZXh0KTtcbiAgICAkKGAjcXVvdGVSYXRlUG9wdXAgLnF1b3RlIC5zb3VyY2UgLnZhbGApLnRleHQoY3VycmVudFF1b3RlLnNvdXJjZSk7XG4gICAgJChgI3F1b3RlUmF0ZVBvcHVwIC5xdW90ZSAuaWQgLnZhbGApLnRleHQoY3VycmVudFF1b3RlLmlkKTtcbiAgICAkKGAjcXVvdGVSYXRlUG9wdXAgLnF1b3RlIC5sZW5ndGggLnZhbGApLnRleHQobGVuZ3RoRGVzYyk7XG4gICAgdXBkYXRlUmF0aW5nU3RhdHMoKTtcbn1cbmZ1bmN0aW9uIHNob3cocXVvdGUsIHNob3VsZFJlc2V0ID0gdHJ1ZSkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgaWYgKCQoXCIjcXVvdGVSYXRlUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIGlmIChzaG91bGRSZXNldCkge1xuICAgICAgICAgICAgcmVzZXQoKTtcbiAgICAgICAgfVxuICAgICAgICBjdXJyZW50UXVvdGUgPSBxdW90ZTtcbiAgICAgICAgcmF0aW5nID0gMDtcbiAgICAgICAgY29uc3Qgc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdCgpO1xuICAgICAgICBjb25zdCBhbHJlYWR5UmF0ZWQgPSAoX2IgPSAoX2EgPSBzbmFwc2hvdCA9PT0gbnVsbCB8fCBzbmFwc2hvdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogc25hcHNob3QucXVvdGVSYXRpbmdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbY3VycmVudFF1b3RlLmxhbmd1YWdlXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iW2N1cnJlbnRRdW90ZS5pZF07XG4gICAgICAgIGlmIChhbHJlYWR5UmF0ZWQpIHtcbiAgICAgICAgICAgIHJhdGluZyA9IGFscmVhZHlSYXRlZDtcbiAgICAgICAgfVxuICAgICAgICByZWZyZXNoU3RhcnMoKTtcbiAgICAgICAgdXBkYXRlRGF0YSgpO1xuICAgICAgICAkKFwiI3F1b3RlUmF0ZVBvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMjUpO1xuICAgIH1cbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmICghJChcIiNxdW90ZVJhdGVQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNxdW90ZVJhdGVQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3F1b3RlUmF0ZVBvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZnVuY3Rpb24gY2xlYXJRdW90ZVN0YXRzKCkge1xuICAgIHF1b3RlU3RhdHMgPSBudWxsO1xufVxuZXhwb3J0cy5jbGVhclF1b3RlU3RhdHMgPSBjbGVhclF1b3RlU3RhdHM7XG5mdW5jdGlvbiBzdWJtaXQoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKHJhdGluZyA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiUGxlYXNlIHNlbGVjdCBhIHJhdGluZ1wiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWN1cnJlbnRRdW90ZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGhpZGUoKTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnF1b3Rlcy5hZGRSYXRpbmcoY3VycmVudFF1b3RlLCByYXRpbmcpO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBzdWJtaXQgcXVvdGUgcmF0aW5nOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzbmFwc2hvdCA9IERCLmdldFNuYXBzaG90KCk7XG4gICAgICAgIGNvbnN0IHF1b3RlUmF0aW5ncyA9IChfYSA9IHNuYXBzaG90LnF1b3RlUmF0aW5ncykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDoge307XG4gICAgICAgIGlmICgoX2IgPSBxdW90ZVJhdGluZ3MgPT09IG51bGwgfHwgcXVvdGVSYXRpbmdzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBxdW90ZVJhdGluZ3NbY3VycmVudFF1b3RlLmxhbmd1YWdlXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iW2N1cnJlbnRRdW90ZS5pZF0pIHtcbiAgICAgICAgICAgIGNvbnN0IG9sZFJhdGluZyA9IHF1b3RlUmF0aW5nc1tjdXJyZW50UXVvdGUubGFuZ3VhZ2VdW2N1cnJlbnRRdW90ZS5pZF07XG4gICAgICAgICAgICBjb25zdCBkaWZmID0gcmF0aW5nIC0gb2xkUmF0aW5nO1xuICAgICAgICAgICAgcXVvdGVSYXRpbmdzW2N1cnJlbnRRdW90ZS5sYW5ndWFnZV1bY3VycmVudFF1b3RlLmlkXSA9IHJhdGluZztcbiAgICAgICAgICAgIHF1b3RlU3RhdHMgPSB7XG4gICAgICAgICAgICAgICAgcmF0aW5nczogcXVvdGVTdGF0cyA9PT0gbnVsbCB8fCBxdW90ZVN0YXRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBxdW90ZVN0YXRzLnJhdGluZ3MsXG4gICAgICAgICAgICAgICAgdG90YWxSYXRpbmc6IGlzTmFOKHF1b3RlU3RhdHMgPT09IG51bGwgfHwgcXVvdGVTdGF0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcXVvdGVTdGF0cy50b3RhbFJhdGluZylcbiAgICAgICAgICAgICAgICAgICAgPyAwXG4gICAgICAgICAgICAgICAgICAgIDogKHF1b3RlU3RhdHMgPT09IG51bGwgfHwgcXVvdGVTdGF0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcXVvdGVTdGF0cy50b3RhbFJhdGluZykgKyBkaWZmLFxuICAgICAgICAgICAgICAgIHF1b3RlSWQ6IGN1cnJlbnRRdW90ZS5pZCxcbiAgICAgICAgICAgICAgICBsYW5ndWFnZTogY3VycmVudFF1b3RlLmxhbmd1YWdlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUmF0aW5nIHVwZGF0ZWRcIiwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoIXF1b3RlUmF0aW5nc1tjdXJyZW50UXVvdGUubGFuZ3VhZ2VdKSB7XG4gICAgICAgICAgICAgICAgcXVvdGVSYXRpbmdzW2N1cnJlbnRRdW90ZS5sYW5ndWFnZV0gPSB7fTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHF1b3RlUmF0aW5nc1tjdXJyZW50UXVvdGUubGFuZ3VhZ2VdW2N1cnJlbnRRdW90ZS5pZF0gPSByYXRpbmc7XG4gICAgICAgICAgICBpZiAoKHF1b3RlU3RhdHMgPT09IG51bGwgfHwgcXVvdGVTdGF0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcXVvdGVTdGF0cy5yYXRpbmdzKSAmJiBxdW90ZVN0YXRzLnRvdGFsUmF0aW5nKSB7XG4gICAgICAgICAgICAgICAgcXVvdGVTdGF0cy5yYXRpbmdzKys7XG4gICAgICAgICAgICAgICAgcXVvdGVTdGF0cy50b3RhbFJhdGluZyArPSByYXRpbmc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBxdW90ZVN0YXRzID0ge1xuICAgICAgICAgICAgICAgICAgICByYXRpbmdzOiAxLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbFJhdGluZzogcmF0aW5nLFxuICAgICAgICAgICAgICAgICAgICBxdW90ZUlkOiBjdXJyZW50UXVvdGUuaWQsXG4gICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlOiBjdXJyZW50UXVvdGUubGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUmF0aW5nIHN1Ym1pdHRlZFwiLCAxKTtcbiAgICAgICAgfVxuICAgICAgICBzbmFwc2hvdC5xdW90ZVJhdGluZ3MgPSBxdW90ZVJhdGluZ3M7XG4gICAgICAgIERCLnNldFNuYXBzaG90KHNuYXBzaG90KTtcbiAgICAgICAgcXVvdGVTdGF0cy5hdmVyYWdlID0gZ2V0UmF0aW5nQXZlcmFnZShxdW90ZVN0YXRzKTtcbiAgICAgICAgJChcIi5wYWdlVGVzdCAjcmVzdWx0ICNyYXRlUXVvdGVCdXR0b24gLnJhdGluZ1wiKS50ZXh0KChfYyA9IHF1b3RlU3RhdHMuYXZlcmFnZSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLnRvRml4ZWQoMSkpO1xuICAgICAgICAkKFwiLnBhZ2VUZXN0ICNyZXN1bHQgI3JhdGVRdW90ZUJ1dHRvbiAuaWNvblwiKS5yZW1vdmVDbGFzcyhcImZhclwiKTtcbiAgICAgICAgJChcIi5wYWdlVGVzdCAjcmVzdWx0ICNyYXRlUXVvdGVCdXR0b24gLmljb25cIikuYWRkQ2xhc3MoXCJmYXNcIik7XG4gICAgfSk7XG59XG4kKFwiI3F1b3RlUmF0ZVBvcHVwV3JhcHBlclwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJxdW90ZVJhdGVQb3B1cFdyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4kKFwiI3F1b3RlUmF0ZVBvcHVwIC5zdGFycyAuc3RhclwiKS5ob3ZlcigoZSkgPT4ge1xuICAgIGNvbnN0IHJhdGluZ0hvdmVyID0gcGFyc2VJbnQoJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJyYXRpbmdcIikpO1xuICAgIHJlZnJlc2hTdGFycyhyYXRpbmdIb3Zlcik7XG59KTtcbiQoXCIjcXVvdGVSYXRlUG9wdXAgLnN0YXJzIC5zdGFyXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBjb25zdCByYXRpbmdIb3ZlciA9IHBhcnNlSW50KCQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwicmF0aW5nXCIpKTtcbiAgICByYXRpbmcgPSByYXRpbmdIb3Zlcjtcbn0pO1xuJChcIiNxdW90ZVJhdGVQb3B1cCAuc3RhcnMgLnN0YXJcIikubW91c2VvdXQoKCkgPT4ge1xuICAgICQoYCNxdW90ZVJhdGVQb3B1cCAuc3RhcmApLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgIHJlZnJlc2hTdGFycygpO1xufSk7XG4kKFwiI3F1b3RlUmF0ZVBvcHVwIC5zdWJtaXRCdXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgc3VibWl0KCk7XG59KTtcbiQoXCIucGFnZVRlc3QgI3JhdGVRdW90ZUJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIC8vIFRPRE8gcmVtb3ZlIHRoaXMgd2hlbiBkb25lIHdpdGggVGVzdFdvcmRzXG4gICAgc2hvdyhUZXN0V29yZHMucmFuZG9tUXVvdGUpO1xufSkpO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuY29uc3QgYXBlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2FwZVwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IFRlc3RXb3JkcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LXdvcmRzXCIpKTtcbmNvbnN0IExvYWRlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbG9hZGVyXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgcXVvdGVzX2NvbnRyb2xsZXJfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvcXVvdGVzLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgQ0FQVENIQV9JRCA9IDE7XG5jb25zdCBzdGF0ZSA9IHtcbiAgICBwcmV2aW91c1BvcHVwU2hvd0NhbGxiYWNrOiB1bmRlZmluZWQsXG4gICAgcXVvdGVUb1JlcG9ydDogdW5kZWZpbmVkLFxufTtcbmNvbnN0IGRlZmF1bHRPcHRpb25zID0ge1xuICAgIHF1b3RlSWQ6IC0xLFxuICAgIHByZXZpb3VzUG9wdXBTaG93Q2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgLy9cbiAgICB9LFxuICAgIG5vQW5pbTogZmFsc2UsXG59O1xuZnVuY3Rpb24gc2hvdyhvcHRpb25zID0gZGVmYXVsdE9wdGlvbnMpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCQoXCIjcXVvdGVSZXBvcnRQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcXVvdGVJZCwgcHJldmlvdXNQb3B1cFNob3dDYWxsYmFjaywgbm9BbmltIH0gPSBvcHRpb25zO1xuICAgICAgICAgICAgc3RhdGUucHJldmlvdXNQb3B1cFNob3dDYWxsYmFjayA9IHByZXZpb3VzUG9wdXBTaG93Q2FsbGJhY2s7XG4gICAgICAgICAgICBjb25zdCB7IHF1b3RlcyB9ID0geWllbGQgcXVvdGVzX2NvbnRyb2xsZXJfMS5kZWZhdWx0LmdldFF1b3Rlcyhjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKTtcbiAgICAgICAgICAgIHN0YXRlLnF1b3RlVG9SZXBvcnQgPSBxdW90ZXMuZmluZCgocXVvdGUpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcXVvdGUuaWQgPT09IHF1b3RlSWQ7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICQoXCIjcXVvdGVSZXBvcnRQb3B1cCAucXVvdGVcIikudGV4dCgoX2EgPSBzdGF0ZS5xdW90ZVRvUmVwb3J0KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudGV4dCk7XG4gICAgICAgICAgICAkKFwiI3F1b3RlUmVwb3J0UG9wdXAgLnJlYXNvblwiKS52YWwoXCJHcmFtbWF0aWNhbCBlcnJvclwiKTtcbiAgICAgICAgICAgICQoXCIjcXVvdGVSZXBvcnRQb3B1cCAuY29tbWVudFwiKS52YWwoXCJcIik7XG4gICAgICAgICAgICAkKFwiI3F1b3RlUmVwb3J0UG9wdXAgLmNoYXJhY3RlckNvdW50XCIpLnRleHQoXCItXCIpO1xuICAgICAgICAgICAgJChcIiNxdW90ZVJlcG9ydFBvcHVwIC5yZWFzb25cIikuc2VsZWN0Mih7XG4gICAgICAgICAgICAgICAgbWluaW11bVJlc3VsdHNGb3JTZWFyY2g6IEluZmluaXR5LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkKFwiI3F1b3RlUmVwb3J0UG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCBub0FuaW0gPyAwIDogMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgJChcIiNxdW90ZVJlcG9ydFBvcHVwIHRleHRhcmVhXCIpLnRyaWdnZXIoXCJmb2N1c1wiKS5zZWxlY3QoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoISQoXCIjcXVvdGVSZXBvcnRQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgICAgIGNvbnN0IG5vQW5pbSA9IHN0YXRlLnByZXZpb3VzUG9wdXBTaG93Q2FsbGJhY2sgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICAkKFwiI3F1b3RlUmVwb3J0UG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgfSwgbm9BbmltID8gMCA6IDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGdyZWNhcHRjaGEucmVzZXQoQ0FQVENIQV9JRCk7XG4gICAgICAgICAgICAgICAgJChcIiNxdW90ZVJlcG9ydFBvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdGUucHJldmlvdXNQb3B1cFNob3dDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBzdGF0ZS5wcmV2aW91c1BvcHVwU2hvd0NhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG5mdW5jdGlvbiBzdWJtaXRSZXBvcnQoKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IGNhcHRjaGFSZXNwb25zZSA9IGdyZWNhcHRjaGEuZ2V0UmVzcG9uc2UoQ0FQVENIQV9JRCk7XG4gICAgICAgIGlmICghY2FwdGNoYVJlc3BvbnNlKSB7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJQbGVhc2UgY29tcGxldGUgdGhlIGNhcHRjaGEuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHF1b3RlSWQgPSAoX2EgPSBzdGF0ZS5xdW90ZVRvUmVwb3J0KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaWQudG9TdHJpbmcoKTtcbiAgICAgICAgY29uc3QgcXVvdGVMYW5ndWFnZSA9IGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2U7XG4gICAgICAgIGNvbnN0IHJlYXNvbiA9ICQoXCIjcXVvdGVSZXBvcnRQb3B1cCAucmVhc29uXCIpLnZhbCgpO1xuICAgICAgICBjb25zdCBjb21tZW50ID0gJChcIiNxdW90ZVJlcG9ydFBvcHVwIC5jb21tZW50XCIpLnZhbCgpO1xuICAgICAgICBjb25zdCBjYXB0Y2hhID0gY2FwdGNoYVJlc3BvbnNlO1xuICAgICAgICBpZiAoIXF1b3RlSWQpIHtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIlBsZWFzZSBzZWxlY3QgYSBxdW90ZS5cIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFyZWFzb24pIHtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIlBsZWFzZSBzZWxlY3QgYSB2YWxpZCByZXBvcnQgcmVhc29uLlwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjaGFyYWN0ZXJEaWZmZXJlbmNlID0gY29tbWVudC5sZW5ndGggLSAyNTA7XG4gICAgICAgIGlmIChjaGFyYWN0ZXJEaWZmZXJlbmNlID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKGBSZXBvcnQgY29tbWVudCBpcyAke2NoYXJhY3RlckRpZmZlcmVuY2V9IGNoYXJhY3RlcihzKSB0b28gbG9uZy5gKTtcbiAgICAgICAgfVxuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucXVvdGVzLnJlcG9ydChxdW90ZUlkLCBxdW90ZUxhbmd1YWdlLCByZWFzb24sIGNvbW1lbnQsIGNhcHRjaGEpO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byByZXBvcnQgcXVvdGU6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUmVwb3J0IHN1Ym1pdHRlZC4gVGhhbmsgeW91IVwiLCAxKTtcbiAgICAgICAgaGlkZSgpO1xuICAgIH0pO1xufVxuJChcIiNxdW90ZVJlcG9ydFBvcHVwV3JhcHBlclwiKS5vbihcIm1vdXNlZG93blwiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwicXVvdGVSZXBvcnRQb3B1cFdyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4kKFwiI3F1b3RlUmVwb3J0UG9wdXAgLmNvbW1lbnRcIikub24oXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGNvbnN0IGxlbiA9ICQoXCIjcXVvdGVSZXBvcnRQb3B1cCAuY29tbWVudFwiKS52YWwoKS5sZW5ndGg7XG4gICAgICAgICQoXCIjcXVvdGVSZXBvcnRQb3B1cCAuY2hhcmFjdGVyQ291bnRcIikudGV4dChsZW4pO1xuICAgICAgICBpZiAobGVuID4gMjUwKSB7XG4gICAgICAgICAgICAkKFwiI3F1b3RlUmVwb3J0UG9wdXAgLmNoYXJhY3RlckNvdW50XCIpLmFkZENsYXNzKFwicmVkXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIiNxdW90ZVJlcG9ydFBvcHVwIC5jaGFyYWN0ZXJDb3VudFwiKS5yZW1vdmVDbGFzcyhcInJlZFwiKTtcbiAgICAgICAgfVxuICAgIH0sIDEpO1xufSk7XG4kKFwiI3F1b3RlUmVwb3J0UG9wdXAgLnN1Ym1pdFwiKS5vbihcImNsaWNrXCIsICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHlpZWxkIHN1Ym1pdFJlcG9ydCgpO1xufSkpO1xuJChcIi5wYWdlVGVzdCAjcmVwb3J0UXVvdGVCdXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB2YXIgX2E7XG4gICAgc2hvdyh7XG4gICAgICAgIHF1b3RlSWQ6IChfYSA9IFRlc3RXb3Jkcy5yYW5kb21RdW90ZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlkLFxuICAgICAgICBub0FuaW06IGZhbHNlLFxuICAgIH0pO1xufSkpO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5hcHBseSA9IGV4cG9ydHMuaGlkZSA9IGV4cG9ydHMuc2hvdyA9IGV4cG9ydHMuc2V0U2VsZWN0ZWRJZCA9IGV4cG9ydHMuc2VsZWN0ZWRJZCA9IHZvaWQgMDtcbmNvbnN0IFRlc3RVSSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LXVpXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpLCBVcGRhdGVDb25maWcgPSBjb25maWdfMTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBNYW51YWxSZXN0YXJ0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L21hbnVhbC1yZXN0YXJ0LXRyYWNrZXJcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBRdW90ZVN1Ym1pdFBvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3F1b3RlLXN1Ym1pdC1wb3B1cFwiKSk7XG5jb25zdCBRdW90ZUFwcHJvdmVQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9xdW90ZS1hcHByb3ZlLXBvcHVwXCIpKTtcbmNvbnN0IFF1b3RlUmVwb3J0UG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vcXVvdGUtcmVwb3J0LXBvcHVwXCIpKTtcbmNvbnN0IHNlYXJjaF9zZXJ2aWNlXzEgPSByZXF1aXJlKFwiLi4vdXRpbHMvc2VhcmNoLXNlcnZpY2VcIik7XG5jb25zdCBkZWJvdW5jZV8xID0gcmVxdWlyZShcIi4uL3V0aWxzL2RlYm91bmNlXCIpO1xuY29uc3Qgc3RyaW5nc18xID0gcmVxdWlyZShcIi4uL3V0aWxzL3N0cmluZ3NcIik7XG5jb25zdCBxdW90ZXNfY29udHJvbGxlcl8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9xdW90ZXMtY29udHJvbGxlclwiKSk7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xuZXhwb3J0cy5zZWxlY3RlZElkID0gMTtcbmZ1bmN0aW9uIHNldFNlbGVjdGVkSWQodmFsKSB7XG4gICAgZXhwb3J0cy5zZWxlY3RlZElkID0gdmFsO1xufVxuZXhwb3J0cy5zZXRTZWxlY3RlZElkID0gc2V0U2VsZWN0ZWRJZDtcbmNvbnN0IHNlYXJjaFNlcnZpY2VDYWNoZSA9IHt9O1xuZnVuY3Rpb24gZ2V0U2VhcmNoU2VydmljZShsYW5ndWFnZSwgZGF0YSwgdGV4dEV4dHJhY3Rvcikge1xuICAgIGlmIChsYW5ndWFnZSBpbiBzZWFyY2hTZXJ2aWNlQ2FjaGUpIHtcbiAgICAgICAgcmV0dXJuIHNlYXJjaFNlcnZpY2VDYWNoZVtsYW5ndWFnZV07XG4gICAgfVxuICAgIGNvbnN0IG5ld1NlYXJjaFNlcnZpY2UgPSAoMCwgc2VhcmNoX3NlcnZpY2VfMS5idWlsZFNlYXJjaFNlcnZpY2UpKGRhdGEsIHRleHRFeHRyYWN0b3IpO1xuICAgIHNlYXJjaFNlcnZpY2VDYWNoZVtsYW5ndWFnZV0gPSBuZXdTZWFyY2hTZXJ2aWNlO1xuICAgIHJldHVybiBuZXdTZWFyY2hTZXJ2aWNlO1xufVxuZnVuY3Rpb24gaGlnaGxpZ2h0TWF0Y2hlcyh0ZXh0LCBtYXRjaGVkVGV4dCkge1xuICAgIGlmIChtYXRjaGVkVGV4dC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHRleHQ7XG4gICAgfVxuICAgIGNvbnN0IHdvcmRzID0gKDAsIHN0cmluZ3NfMS5zcGxpdEJ5QW5kS2VlcCkodGV4dCwgYC4sXCIvIyEkJV4mKjs6e309LV9cXGB+KCkgYC5zcGxpdChcIlwiKSk7XG4gICAgY29uc3Qgbm9ybWFsaXplZFdvcmRzID0gd29yZHMubWFwKCh3b3JkKSA9PiB7XG4gICAgICAgIGNvbnN0IHNob3VsZEhpZ2hsaWdodCA9IG1hdGNoZWRUZXh0LmZpbmQoKG1hdGNoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gd29yZC5zdGFydHNXaXRoKG1hdGNoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBzaG91bGRIaWdobGlnaHQgPyBgPHNwYW4gY2xhc3M9XCJoaWdobGlnaHRcIj4ke3dvcmR9PC9zcGFuPmAgOiB3b3JkO1xuICAgIH0pO1xuICAgIHJldHVybiBub3JtYWxpemVkV29yZHMuam9pbihcIlwiKTtcbn1cbmZ1bmN0aW9uIGFwcGx5UXVvdGVMZW5ndGhGaWx0ZXIocXVvdGVzKSB7XG4gICAgY29uc3QgcXVvdGVMZW5ndGhGaWx0ZXJWYWx1ZSA9ICQoXCIjcXVvdGVTZWFyY2hQb3B1cCAucXVvdGVMZW5ndGhGaWx0ZXJcIikudmFsKCk7XG4gICAgaWYgKHF1b3RlTGVuZ3RoRmlsdGVyVmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBxdW90ZXM7XG4gICAgfVxuICAgIGNvbnN0IHF1b3RlTGVuZ3RoRmlsdGVyID0gcXVvdGVMZW5ndGhGaWx0ZXJWYWx1ZS5tYXAoKGZpbHRlclZhbHVlKSA9PiBwYXJzZUludChmaWx0ZXJWYWx1ZSwgMTApKTtcbiAgICBjb25zdCBmaWx0ZXJlZFF1b3RlcyA9IHF1b3Rlcy5maWx0ZXIoKHF1b3RlKSA9PiBxdW90ZUxlbmd0aEZpbHRlci5pbmNsdWRlcyhxdW90ZS5ncm91cCkpO1xuICAgIHJldHVybiBmaWx0ZXJlZFF1b3Rlcztcbn1cbmZ1bmN0aW9uIGJ1aWxkUXVvdGVTZWFyY2hSZXN1bHQocXVvdGUsIG1hdGNoZWRTZWFyY2hUZXJtcykge1xuICAgIGxldCBsZW5ndGhEZXNjO1xuICAgIGlmIChxdW90ZS5sZW5ndGggPCAxMDEpIHtcbiAgICAgICAgbGVuZ3RoRGVzYyA9IFwic2hvcnRcIjtcbiAgICB9XG4gICAgZWxzZSBpZiAocXVvdGUubGVuZ3RoIDwgMzAxKSB7XG4gICAgICAgIGxlbmd0aERlc2MgPSBcIm1lZGl1bVwiO1xuICAgIH1cbiAgICBlbHNlIGlmIChxdW90ZS5sZW5ndGggPCA2MDEpIHtcbiAgICAgICAgbGVuZ3RoRGVzYyA9IFwibG9uZ1wiO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgbGVuZ3RoRGVzYyA9IFwidGhpY2NcIjtcbiAgICB9XG4gICAgY29uc3QgaXNOb3RBdXRoZWQgPSAhZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgIHJldHVybiBgXG4gIDxkaXYgY2xhc3M9XCJzZWFyY2hSZXN1bHRcIiBpZD1cIiR7cXVvdGUuaWR9XCI+XG4gICAgPGRpdiBjbGFzcz1cInRleHRcIj5cbiAgICAgICR7aGlnaGxpZ2h0TWF0Y2hlcyhxdW90ZS50ZXh0LCBtYXRjaGVkU2VhcmNoVGVybXMpfVxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJpZFwiPlxuICAgICAgPGRpdiBjbGFzcz1cInN1YlwiPmlkPC9kaXY+XG4gICAgICA8c3BhbiBjbGFzcz1cInF1b3RlLWlkXCI+XG4gICAgICAgICR7aGlnaGxpZ2h0TWF0Y2hlcyhxdW90ZS5pZC50b1N0cmluZygpLCBtYXRjaGVkU2VhcmNoVGVybXMpfVxuICAgICAgPC9zcGFuPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJsZW5ndGhcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJzdWJcIj5sZW5ndGg8L2Rpdj5cbiAgICAgICR7bGVuZ3RoRGVzY31cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwic291cmNlXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwic3ViXCI+c291cmNlPC9kaXY+XG4gICAgICAke2hpZ2hsaWdodE1hdGNoZXMocXVvdGUuc291cmNlLCBtYXRjaGVkU2VhcmNoVGVybXMpfTwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJpY29uLWJ1dHRvbiByZXBvcnQgJHtpc05vdEF1dGhlZCAmJiBcImhpZGRlblwifVwiIGFyaWEtbGFiZWw9XCJSZXBvcnQgcXVvdGVcIiBkYXRhLWJhbGxvb24tcG9zPVwibGVmdFwiPlxuICAgICAgPGkgY2xhc3M9XCJmYXMgZmEtZmxhZyByZXBvcnRcIj48L2k+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuICBgO1xufVxuZnVuY3Rpb24gdXBkYXRlUmVzdWx0cyhzZWFyY2hUZXh0KSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgeyBxdW90ZXMgfSA9IHlpZWxkIHF1b3Rlc19jb250cm9sbGVyXzEuZGVmYXVsdC5nZXRRdW90ZXMoY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSk7XG4gICAgICAgIGNvbnN0IHF1b3RlU2VhcmNoU2VydmljZSA9IGdldFNlYXJjaFNlcnZpY2UoY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSwgcXVvdGVzLCAocXVvdGUpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBgJHtxdW90ZS50ZXh0fSAke3F1b3RlLmlkfSAke3F1b3RlLnNvdXJjZX1gO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgeyByZXN1bHRzOiBtYXRjaGVzLCBtYXRjaGVkUXVlcnlUZXJtcyB9ID0gcXVvdGVTZWFyY2hTZXJ2aWNlLnF1ZXJ5KHNlYXJjaFRleHQpO1xuICAgICAgICBjb25zdCBxdW90ZXNUb1Nob3cgPSBhcHBseVF1b3RlTGVuZ3RoRmlsdGVyKHNlYXJjaFRleHQgPT09IFwiXCIgPyBxdW90ZXMgOiBtYXRjaGVzKTtcbiAgICAgICAgY29uc3QgcmVzdWx0c0xpc3QgPSAkKFwiI3F1b3RlU2VhcmNoUmVzdWx0c1wiKTtcbiAgICAgICAgcmVzdWx0c0xpc3QuZW1wdHkoKTtcbiAgICAgICAgcXVvdGVzVG9TaG93LnNsaWNlKDAsIDEwMCkuZm9yRWFjaCgocXVvdGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHF1b3RlU2VhcmNoUmVzdWx0ID0gYnVpbGRRdW90ZVNlYXJjaFJlc3VsdChxdW90ZSwgbWF0Y2hlZFF1ZXJ5VGVybXMpO1xuICAgICAgICAgICAgcmVzdWx0c0xpc3QuYXBwZW5kKHF1b3RlU2VhcmNoUmVzdWx0KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHJlc3VsdHNFeGNlZWRlZFRleHQgPSBxdW90ZXNUb1Nob3cubGVuZ3RoID4gMTAwXG4gICAgICAgICAgICA/IFwiPHNwYW4gc3R5bGU9J29wYWNpdHk6IDAuNSc+KG9ubHkgc2hvd2luZyAxMDApPC9zcGFuPlwiXG4gICAgICAgICAgICA6IFwiXCI7XG4gICAgICAgICQoXCIjZXh0cmFSZXN1bHRzXCIpLmh0bWwoYCR7cXVvdGVzVG9TaG93Lmxlbmd0aH0gcmVzdWx0cyAke3Jlc3VsdHNFeGNlZWRlZFRleHR9YCk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBzaG93KGNsZWFyVGV4dCA9IHRydWUpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCQoXCIjcXVvdGVTZWFyY2hQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgICAgIGlmIChjbGVhclRleHQpIHtcbiAgICAgICAgICAgICAgICAkKFwiI3F1b3RlU2VhcmNoUG9wdXAgaW5wdXRcIikudmFsKFwiXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcXVvdGVTZWFyY2hJbnB1dFZhbHVlID0gJChcIiNxdW90ZVNlYXJjaFBvcHVwIGlucHV0XCIpLnZhbCgpO1xuICAgICAgICAgICAgaWYgKCFmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIpIHtcbiAgICAgICAgICAgICAgICAkKFwiI3F1b3RlU2VhcmNoUG9wdXAgI2dvdG9TdWJtaXRRdW90ZUJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICQoXCIjcXVvdGVTZWFyY2hQb3B1cCAjZ290b1N1Ym1pdFF1b3RlQnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKChfYSA9IERCLmdldFNuYXBzaG90KCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5xdW90ZU1vZCkge1xuICAgICAgICAgICAgICAgICQoXCIjcXVvdGVTZWFyY2hQb3B1cCAjZ29Ub0FwcHJvdmVRdW90ZXNcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKFwiI3F1b3RlU2VhcmNoUG9wdXAgI2dvVG9BcHByb3ZlUXVvdGVzXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJChcIiNxdW90ZVNlYXJjaFBvcHVwIC5xdW90ZUxlbmd0aEZpbHRlclwiKS5zZWxlY3QyKHtcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogXCJGaWx0ZXIgYnkgbGVuZ3RoXCIsXG4gICAgICAgICAgICAgICAgbWF4aW11bVNlbGVjdGlvbkxlbmd0aDogSW5maW5pdHksXG4gICAgICAgICAgICAgICAgbXVsdGlwbGU6IHRydWUsXG4gICAgICAgICAgICAgICAgd2lkdGg6IFwiMTAwJVwiLFxuICAgICAgICAgICAgICAgIGRhdGE6IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcInNob3J0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJtZWRpdW1cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IDIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcImxvbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IDMsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcInRoaWNjXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJChcIiNxdW90ZVNlYXJjaFBvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGNsZWFyVGV4dCkge1xuICAgICAgICAgICAgICAgICAgICAkKFwiI3F1b3RlU2VhcmNoUG9wdXAgaW5wdXRcIikudHJpZ2dlcihcImZvY3VzXCIpLnNlbGVjdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB1cGRhdGVSZXN1bHRzKHF1b3RlU2VhcmNoSW5wdXRWYWx1ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUobm9BbmltID0gZmFsc2UsIGZvY3VzV29yZHMgPSB0cnVlKSB7XG4gICAgaWYgKCEkKFwiI3F1b3RlU2VhcmNoUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjcXVvdGVTZWFyY2hQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgbm9BbmltID8gMCA6IDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNxdW90ZVNlYXJjaFBvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIGlmIChmb2N1c1dvcmRzKSB7XG4gICAgICAgICAgICAgICAgVGVzdFVJLmZvY3VzV29yZHMoKTtcbiAgICAgICAgICAgICAgICAkKFwiI3F1b3RlU2VhcmNoUG9wdXAgLnF1b3RlTGVuZ3RoRmlsdGVyXCIpLnZhbChbXSk7XG4gICAgICAgICAgICAgICAgJChcIiNxdW90ZVNlYXJjaFBvcHVwIC5xdW90ZUxlbmd0aEZpbHRlclwiKS50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuZnVuY3Rpb24gYXBwbHkodmFsKSB7XG4gICAgaWYgKGlzTmFOKHZhbCkpIHtcbiAgICAgICAgdmFsID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzZWFyY2hCb3hcIikudmFsdWUpO1xuICAgIH1cbiAgICBsZXQgcmV0O1xuICAgIGlmICh2YWwgIT09IG51bGwgJiYgIWlzTmFOKHZhbCkgJiYgdmFsID49IDApIHtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldFF1b3RlTGVuZ3RoKC0yLCBmYWxzZSk7XG4gICAgICAgIGV4cG9ydHMuc2VsZWN0ZWRJZCA9IHZhbDtcbiAgICAgICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICAgICAgcmV0ID0gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUXVvdGUgSUQgbXVzdCBiZSBhdCBsZWFzdCAxXCIsIDApO1xuICAgICAgICByZXQgPSBmYWxzZTtcbiAgICB9XG4gICAgaGlkZSgpO1xuICAgIHJldHVybiByZXQ7XG59XG5leHBvcnRzLmFwcGx5ID0gYXBwbHk7XG5jb25zdCBzZWFyY2hGb3JRdW90ZXMgPSAoMCwgZGVib3VuY2VfMS5kZWJvdW5jZSkoKCkgPT4ge1xuICAgIGNvbnN0IHNlYXJjaFRleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNlYXJjaEJveFwiKVxuICAgICAgICAudmFsdWU7XG4gICAgdXBkYXRlUmVzdWx0cyhzZWFyY2hUZXh0KTtcbn0pO1xuJChcIiNxdW90ZVNlYXJjaFBvcHVwIC5zZWFyY2hCb3hcIikub24oXCJrZXl1cFwiLCAoZSkgPT4ge1xuICAgIGlmIChlLmNvZGUgPT09IFwiRXNjYXBlXCIpXG4gICAgICAgIHJldHVybjtcbiAgICBzZWFyY2hGb3JRdW90ZXMoKTtcbn0pO1xuJChcIiNxdW90ZVNlYXJjaFBvcHVwIC5xdW90ZUxlbmd0aEZpbHRlclwiKS5vbihcImNoYW5nZVwiLCBzZWFyY2hGb3JRdW90ZXMpO1xuJChcIiNxdW90ZVNlYXJjaFBvcHVwV3JhcHBlclwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJxdW90ZVNlYXJjaFBvcHVwV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjcXVvdGVTZWFyY2hQb3B1cCAjZ290b1N1Ym1pdFF1b3RlQnV0dG9uXCIsICgpID0+IHtcbiAgICBoaWRlKHRydWUpO1xuICAgIFF1b3RlU3VibWl0UG9wdXAuc2hvdyh0cnVlKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNxdW90ZVNlYXJjaFBvcHVwICNnb1RvQXBwcm92ZVF1b3Rlc1wiLCAoKSA9PiB7XG4gICAgaGlkZSh0cnVlKTtcbiAgICBRdW90ZUFwcHJvdmVQb3B1cC5zaG93KHRydWUpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3F1b3RlU2VhcmNoUG9wdXAgLnJlcG9ydFwiLCAoZSkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgY29uc3QgcXVvdGVJZCA9IGUudGFyZ2V0LmNsb3Nlc3QoXCIuc2VhcmNoUmVzdWx0XCIpLmlkO1xuICAgIGNvbnN0IHF1b3RlSWRTZWxlY3RlZEZvclJlcG9ydCA9IHBhcnNlSW50KHF1b3RlSWQpO1xuICAgIGhpZGUodHJ1ZSwgZmFsc2UpO1xuICAgIFF1b3RlUmVwb3J0UG9wdXAuc2hvdyh7XG4gICAgICAgIHF1b3RlSWQ6IHF1b3RlSWRTZWxlY3RlZEZvclJlcG9ydCxcbiAgICAgICAgbm9BbmltOiB0cnVlLFxuICAgICAgICBwcmV2aW91c1BvcHVwU2hvd0NhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgICAgICBzaG93KGZhbHNlKTtcbiAgICAgICAgfSxcbiAgICB9KTtcbn0pKTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjdG9wIC5jb25maWcgLnF1b3RlTGVuZ3RoIC50ZXh0LWJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBsZW4gPSAoX2EgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcInF1b3RlTGVuZ3RoXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAwO1xuICAgIGlmIChsZW4gPT0gLTIpIHtcbiAgICAgICAgc2hvdygpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudCkub24oXCJrZXlkb3duXCIsIChldmVudCkgPT4ge1xuICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIgJiZcbiAgICAgICAgISQoXCIjcXVvdGVTZWFyY2hQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuY29uc3QgYXBlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2FwZVwiKSk7XG5jb25zdCBMb2FkZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2xvYWRlclwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbi8vIGltcG9ydCBDb25maWcgZnJvbSBcIi4uL2NvbmZpZ1wiO1xuLy8gaW1wb3J0ICogYXMgTWlzYyBmcm9tIFwiLi4vbWlzY1wiO1xuLy8gbGV0IGRyb3Bkb3duUmVhZHkgPSBmYWxzZTtcbi8vIGFzeW5jIGZ1bmN0aW9uIGluaXREcm9wZG93bigpOiBQcm9taXNlPHZvaWQ+IHtcbi8vICAgaWYgKGRyb3Bkb3duUmVhZHkpIHJldHVybjtcbi8vICAgY29uc3QgbGFuZ3VhZ2VzID0gYXdhaXQgTWlzYy5nZXRMYW5ndWFnZUxpc3QoKTtcbi8vICAgbGFuZ3VhZ2VzLmZvckVhY2goKGxhbmd1YWdlKSA9PiB7XG4vLyAgICAgaWYgKFxuLy8gICAgICAgbGFuZ3VhZ2UgPT09IFwiZW5nbGlzaF9jb21tb25seV9taXNzcGVsbGVkXCIgfHxcbi8vICAgICAgIGxhbmd1YWdlID09PSBcImh1bmdhcmlhbl8yLjVrXCJcbi8vICAgICApXG4vLyAgICAgICByZXR1cm47XG4vLyAgICAgaWYgKCEvX1xcZCprJC9nLnRlc3QobGFuZ3VhZ2UpKSB7XG4vLyAgICAgICAkKFwiI3F1b3RlU3VibWl0UG9wdXAgI3N1Ym1pdFF1b3RlTGFuZ3VhZ2VcIikuYXBwZW5kKFxuLy8gICAgICAgICBgPG9wdGlvbiB2YWx1ZT1cIiR7bGFuZ3VhZ2V9XCI+JHtsYW5ndWFnZS5yZXBsYWNlKC9fL2csIFwiIFwiKX08L29wdGlvbj5gXG4vLyAgICAgICApO1xuLy8gICAgIH1cbi8vICAgfSk7XG4vLyAgICQoXCIjcXVvdGVTdWJtaXRQb3B1cCAjc3VibWl0UXVvdGVMYW5ndWFnZVwiKS5zZWxlY3QyKCk7XG4vLyAgIGRyb3Bkb3duUmVhZHkgPSB0cnVlO1xuLy8gfVxuZnVuY3Rpb24gc3VibWl0UXVvdGUoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgdGV4dCA9ICQoXCIjcXVvdGVTdWJtaXRQb3B1cCAjc3VibWl0UXVvdGVUZXh0XCIpLnZhbCgpO1xuICAgICAgICBjb25zdCBzb3VyY2UgPSAkKFwiI3F1b3RlU3VibWl0UG9wdXAgI3N1Ym1pdFF1b3RlU291cmNlXCIpLnZhbCgpO1xuICAgICAgICBjb25zdCBsYW5ndWFnZSA9ICQoXCIjcXVvdGVTdWJtaXRQb3B1cCAjc3VibWl0UXVvdGVMYW5ndWFnZVwiKS52YWwoKTtcbiAgICAgICAgY29uc3QgY2FwdGNoYSA9ICQoXCIjcXVvdGVTdWJtaXRQb3B1cCAjZy1yZWNhcHRjaGEtcmVzcG9uc2VcIikudmFsKCk7XG4gICAgICAgIGlmICghdGV4dCB8fCAhc291cmNlIHx8ICFsYW5ndWFnZSkge1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiUGxlYXNlIGZpbGwgaW4gYWxsIGZpZWxkc1wiLCAwKTtcbiAgICAgICAgfVxuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucXVvdGVzLnN1Ym1pdCh0ZXh0LCBzb3VyY2UsIGxhbmd1YWdlLCBjYXB0Y2hhKTtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gc3VibWl0IHF1b3RlOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlF1b3RlIHN1Ym1pdHRlZC5cIiwgMSk7XG4gICAgICAgICQoXCIjcXVvdGVTdWJtaXRQb3B1cCAjc3VibWl0UXVvdGVUZXh0XCIpLnZhbChcIlwiKTtcbiAgICAgICAgJChcIiNxdW90ZVN1Ym1pdFBvcHVwICNzdWJtaXRRdW90ZVNvdXJjZVwiKS52YWwoXCJcIik7XG4gICAgICAgICQoXCIjcXVvdGVTdWJtaXRQb3B1cCAuY2hhcmFjdGVyQ291bnRcIikucmVtb3ZlQ2xhc3MoXCJyZWRcIik7XG4gICAgICAgICQoXCIjcXVvdGVTdWJtaXRQb3B1cCAuY2hhcmFjdGVyQ291bnRcIikudGV4dChcIi1cIik7XG4gICAgICAgIGdyZWNhcHRjaGEucmVzZXQoKTtcbiAgICB9KTtcbn1cbi8vIEB0cy1pZ25vcmVcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuZnVuY3Rpb24gc2hvdyhub0FuaW0gPSBmYWxzZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUXVvdGUgc3VibWlzc2lvbiBpcyBkaXNhYmxlZCB0ZW1wb3JhcmlseSBkdWUgdG8gYSBsYXJnZSBzdWJtaXNzaW9uIHF1ZXVlLlwiLCAwLCA1KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgICAvLyBpZiAoJChcIiNxdW90ZVN1Ym1pdFBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAvLyAgIGF3YWl0IGluaXREcm9wZG93bigpO1xuICAgICAgICAvLyAgICQoXCIjcXVvdGVTdWJtaXRQb3B1cCAjc3VibWl0UXVvdGVMYW5ndWFnZVwiKS52YWwoXG4gICAgICAgIC8vICAgICBDb25maWcubGFuZ3VhZ2UucmVwbGFjZSgvX1xcZCprJC9nLCBcIlwiKVxuICAgICAgICAvLyAgICk7XG4gICAgICAgIC8vICAgJChcIiNxdW90ZVN1Ym1pdFBvcHVwICNzdWJtaXRRdW90ZUxhbmd1YWdlXCIpLnRyaWdnZXIoXCJjaGFuZ2VcIik7XG4gICAgICAgIC8vICAgJChcIiNxdW90ZVN1Ym1pdFBvcHVwIGlucHV0XCIpLnZhbChcIlwiKTtcbiAgICAgICAgLy8gICAkKFwiI3F1b3RlU3VibWl0UG9wdXBXcmFwcGVyXCIpXG4gICAgICAgIC8vICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAvLyAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgLy8gICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAvLyAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIG5vQW5pbSA/IDAgOiAxMDAsICgpID0+IHtcbiAgICAgICAgLy8gICAgICAgJChcIiNxdW90ZVN1Ym1pdFBvcHVwIHRleHRhcmVhXCIpLnRyaWdnZXIoXCJmb2N1c1wiKS5zZWxlY3QoKTtcbiAgICAgICAgLy8gICAgIH0pO1xuICAgICAgICAvLyB9XG4gICAgfSk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICBpZiAoISQoXCIjcXVvdGVTdWJtaXRQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNxdW90ZVN1Ym1pdFBvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjcXVvdGVTdWJtaXRQb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG4kKFwiI3F1b3RlU3VibWl0UG9wdXBXcmFwcGVyXCIpLm9uKFwibW91c2Vkb3duXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJxdW90ZVN1Ym1pdFBvcHVwV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjcXVvdGVTdWJtaXRQb3B1cCAjc3VibWl0UXVvdGVCdXR0b25cIiwgKCkgPT4ge1xuICAgIHN1Ym1pdFF1b3RlKCk7XG59KTtcbiQoXCIjcXVvdGVTdWJtaXRQb3B1cCB0ZXh0YXJlYVwiKS5vbihcImlucHV0XCIsICgpID0+IHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCBsZW4gPSAoX2EgPSAkKFwiI3F1b3RlU3VibWl0UG9wdXAgdGV4dGFyZWFcIikudmFsKCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGg7XG4gICAgICAgICQoXCIjcXVvdGVTdWJtaXRQb3B1cCAuY2hhcmFjdGVyQ291bnRcIikudGV4dChsZW4pO1xuICAgICAgICBpZiAobGVuIDwgNjApIHtcbiAgICAgICAgICAgICQoXCIjcXVvdGVTdWJtaXRQb3B1cCAuY2hhcmFjdGVyQ291bnRcIikuYWRkQ2xhc3MoXCJyZWRcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiI3F1b3RlU3VibWl0UG9wdXAgLmNoYXJhY3RlckNvdW50XCIpLnJlbW92ZUNsYXNzKFwicmVkXCIpO1xuICAgICAgICB9XG4gICAgfSwgMSk7XG59KTtcbiQoXCIjcXVvdGVTdWJtaXRQb3B1cCBpbnB1dFwiKS5vbihcImtleWRvd25cIiwgKGUpID0+IHtcbiAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICBzdWJtaXRRdW90ZSgpO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51cGRhdGVCdXR0b25zID0gdm9pZCAwO1xuY29uc3QgYXBlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2FwZVwiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgTG9hZGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sb2FkZXJcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5mdW5jdGlvbiBzaG93KCkge1xuICAgIGlmICgkKFwiI3Jlc3VsdEVkaXRUYWdzUGFuZWxXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjcmVzdWx0RWRpdFRhZ3NQYW5lbFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTI1KTtcbiAgICB9XG59XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmICghJChcIiNyZXN1bHRFZGl0VGFnc1BhbmVsV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI3Jlc3VsdEVkaXRUYWdzUGFuZWxXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNyZXN1bHRFZGl0VGFnc1BhbmVsV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZnVuY3Rpb24gdXBkYXRlQnV0dG9ucygpIHtcbiAgICB2YXIgX2E7XG4gICAgJChcIiNyZXN1bHRFZGl0VGFnc1BhbmVsIC5idXR0b25zXCIpLmVtcHR5KCk7XG4gICAgKF9hID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgICQoXCIjcmVzdWx0RWRpdFRhZ3NQYW5lbCAuYnV0dG9uc1wiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJidXR0b24gdGFnXCIgdGFnaWQ9XCIke3RhZy5faWR9XCI+JHt0YWcubmFtZX08L2Rpdj5gKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMudXBkYXRlQnV0dG9ucyA9IHVwZGF0ZUJ1dHRvbnM7XG5mdW5jdGlvbiB1cGRhdGVBY3RpdmVCdXR0b25zKGFjdGl2ZSkge1xuICAgIGlmIChhY3RpdmUgPT09IFtdKVxuICAgICAgICByZXR1cm47XG4gICAgJC5lYWNoKCQoXCIjcmVzdWx0RWRpdFRhZ3NQYW5lbCAuYnV0dG9ucyAuYnV0dG9uXCIpLCAoXywgb2JqKSA9PiB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgdGFnaWQgPSAoX2EgPSAkKG9iaikuYXR0cihcInRhZ2lkXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIlwiO1xuICAgICAgICBpZiAoYWN0aXZlLmluY2x1ZGVzKHRhZ2lkKSkge1xuICAgICAgICAgICAgJChvYmopLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChvYmopLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VBY2NvdW50IC5ncm91cC5oaXN0b3J5ICNyZXN1bHRFZGl0VGFnc1wiLCAoZikgPT4ge1xuICAgIHZhciBfYTtcbiAgICBpZiAoKChfYSA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgfHwgMCA+IDApIHtcbiAgICAgICAgY29uc3QgcmVzdWx0aWQgPSAkKGYudGFyZ2V0KS5wYXJlbnRzKFwic3BhblwiKS5hdHRyKFwicmVzdWx0aWRcIik7XG4gICAgICAgIGNvbnN0IHRhZ3MgPSAkKGYudGFyZ2V0KS5wYXJlbnRzKFwic3BhblwiKS5hdHRyKFwidGFnc1wiKTtcbiAgICAgICAgJChcIiNyZXN1bHRFZGl0VGFnc1BhbmVsXCIpLmF0dHIoXCJyZXN1bHRpZFwiLCByZXN1bHRpZCk7XG4gICAgICAgICQoXCIjcmVzdWx0RWRpdFRhZ3NQYW5lbFwiKS5hdHRyKFwidGFnc1wiLCB0YWdzKTtcbiAgICAgICAgdXBkYXRlQWN0aXZlQnV0dG9ucyhKU09OLnBhcnNlKHRhZ3MpKTtcbiAgICAgICAgc2hvdygpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNyZXN1bHRFZGl0VGFnc1BhbmVsV3JhcHBlciAuYnV0dG9uLnRhZ1wiLCAoZikgPT4ge1xuICAgICQoZi50YXJnZXQpLnRvZ2dsZUNsYXNzKFwiYWN0aXZlXCIpO1xufSk7XG4kKFwiI3Jlc3VsdEVkaXRUYWdzUGFuZWxXcmFwcGVyXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcInJlc3VsdEVkaXRUYWdzUGFuZWxXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuJChcIiNyZXN1bHRFZGl0VGFnc1BhbmVsIC5jb25maXJtQnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHJlc3VsdElkID0gJChcIiNyZXN1bHRFZGl0VGFnc1BhbmVsXCIpLmF0dHIoXCJyZXN1bHRpZFwiKTtcbiAgICAvLyBsZXQgb2xkdGFncyA9IEpTT04ucGFyc2UoJChcIiNyZXN1bHRFZGl0VGFnc1BhbmVsXCIpLmF0dHIoXCJ0YWdzXCIpKTtcbiAgICBjb25zdCBuZXdUYWdzID0gW107XG4gICAgJC5lYWNoKCQoXCIjcmVzdWx0RWRpdFRhZ3NQYW5lbCAuYnV0dG9ucyAuYnV0dG9uXCIpLCAoXywgb2JqKSA9PiB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgdGFnaWQgPSAoX2EgPSAkKG9iaikuYXR0cihcInRhZ2lkXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIlwiO1xuICAgICAgICBpZiAoJChvYmopLmhhc0NsYXNzKFwiYWN0aXZlXCIpKSB7XG4gICAgICAgICAgICBuZXdUYWdzLnB1c2godGFnaWQpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgTG9hZGVyLnNob3coKTtcbiAgICBoaWRlKCk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnJlc3VsdHMudXBkYXRlVGFncyhyZXN1bHRJZCwgbmV3VGFncyk7XG4gICAgTG9hZGVyLmhpZGUoKTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHVwZGF0ZSByZXN1bHQgdGFnczogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgfVxuICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiVGFncyB1cGRhdGVkLlwiLCAxLCAyKTtcbiAgICAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpLnJlc3VsdHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKChyZXN1bHQpID0+IHtcbiAgICAgICAgaWYgKHJlc3VsdC5faWQgPT09IHJlc3VsdElkKSB7XG4gICAgICAgICAgICByZXN1bHQudGFncyA9IG5ld1RhZ3M7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBsZXQgdGFnTmFtZXMgPSBcIlwiO1xuICAgIGlmIChuZXdUYWdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgbmV3VGFncy5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIChfYSA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHNuYXB0YWcpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGFnID09PSBzbmFwdGFnLl9pZCkge1xuICAgICAgICAgICAgICAgICAgICB0YWdOYW1lcyArPSBzbmFwdGFnLm5hbWUgKyBcIiwgXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0YWdOYW1lcyA9IHRhZ05hbWVzLnN1YnN0cmluZygwLCB0YWdOYW1lcy5sZW5ndGggLSAyKTtcbiAgICB9XG4gICAgbGV0IHJlc3RhZ3M7XG4gICAgaWYgKG5ld1RhZ3MgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXN0YWdzID0gXCJbXVwiO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmVzdGFncyA9IEpTT04uc3RyaW5naWZ5KG5ld1RhZ3MpO1xuICAgIH1cbiAgICAkKGAucGFnZUFjY291bnQgI3Jlc3VsdEVkaXRUYWdzW3Jlc3VsdGlkPScke3Jlc3VsdElkfSddYCkuYXR0cihcInRhZ3NcIiwgcmVzdGFncyk7XG4gICAgaWYgKG5ld1RhZ3MubGVuZ3RoID4gMCkge1xuICAgICAgICAkKGAucGFnZUFjY291bnQgI3Jlc3VsdEVkaXRUYWdzW3Jlc3VsdGlkPScke3Jlc3VsdElkfSddYCkuY3NzKFwib3BhY2l0eVwiLCAxKTtcbiAgICAgICAgJChgLnBhZ2VBY2NvdW50ICNyZXN1bHRFZGl0VGFnc1tyZXN1bHRpZD0nJHtyZXN1bHRJZH0nXWApLmF0dHIoXCJhcmlhLWxhYmVsXCIsIHRhZ05hbWVzKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoYC5wYWdlQWNjb3VudCAjcmVzdWx0RWRpdFRhZ3NbcmVzdWx0aWQ9JyR7cmVzdWx0SWR9J11gKS5jc3MoXCJvcGFjaXR5XCIsIDAuMjUpO1xuICAgICAgICAkKGAucGFnZUFjY291bnQgI3Jlc3VsdEVkaXRUYWdzW3Jlc3VsdGlkPScke3Jlc3VsdElkfSddYCkuYXR0cihcImFyaWEtbGFiZWxcIiwgXCJubyB0YWdzXCIpO1xuICAgIH1cbn0pKTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmNvbnN0IEN1c3RvbVRleHQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvY3VzdG9tLXRleHRcIikpO1xuZnVuY3Rpb24gc2hvdygpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCBuYW1lcyA9IEN1c3RvbVRleHQuZ2V0Q3VzdG9tVGV4dE5hbWVzKCk7XG4gICAgICAgIGNvbnN0IGxpc3RFbCA9ICQoYCNzYXZlZFRleHRzUG9wdXAgLmxpc3RgKS5lbXB0eSgpO1xuICAgICAgICBsZXQgbGlzdCA9IFwiXCI7XG4gICAgICAgIGlmIChuYW1lcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGxpc3QgKz0gXCI8ZGl2Pk5vIHNhdmVkIGN1c3RvbSB0ZXh0cyBmb3VuZDwvZGl2PlwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZm9yIChjb25zdCBuYW1lIG9mIG5hbWVzKSB7XG4gICAgICAgICAgICAgICAgbGlzdCArPSBgPGRpdiBjbGFzcz1cInNhdmVkVGV4dFwiPlxuICAgICAgPGRpdiBjbGFzcz1cImJ1dHRvbiBuYW1lXCI+JHtuYW1lfTwvZGl2PlxuICAgICAgPGRpdiBjbGFzcz1cImJ1dHRvbiBkZWxldGVcIj5cbiAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXRyYXNoXCI+PC9pPlxuICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5gO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGxpc3RFbC5odG1sKGxpc3QpO1xuICAgICAgICAkKFwiI3NhdmVkVGV4dHNQb3B1cFdyYXBwZXJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjY3VzdG9tVGV4dFBvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKGZ1bGwgPSBmYWxzZSkge1xuICAgICQoXCIjc2F2ZWRUZXh0c1BvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICBpZiAoIWZ1bGwpXG4gICAgICAgICQoXCIjY3VzdG9tVGV4dFBvcHVwV3JhcHBlclwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbn1cbmZ1bmN0aW9uIGFwcGx5U2F2ZWQobmFtZSkge1xuICAgIGNvbnN0IHRleHQgPSBDdXN0b21UZXh0LmdldEN1c3RvbVRleHQobmFtZSk7XG4gICAgJChgI2N1c3RvbVRleHRQb3B1cFdyYXBwZXIgdGV4dGFyZWFgKS52YWwodGV4dC5qb2luKEN1c3RvbVRleHQuZGVsaW1pdGVyKSk7XG59XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIGAjc2F2ZWRUZXh0c1BvcHVwV3JhcHBlciAubGlzdCAuc2F2ZWRUZXh0IC5idXR0b24ubmFtZWAsIChlKSA9PiB7XG4gICAgY29uc3QgbmFtZSA9ICQoZS50YXJnZXQpLnRleHQoKTtcbiAgICBhcHBseVNhdmVkKG5hbWUpO1xuICAgIGhpZGUoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBgI3NhdmVkVGV4dHNQb3B1cFdyYXBwZXIgLmxpc3QgLnNhdmVkVGV4dCAuYnV0dG9uLmRlbGV0ZWAsICgpID0+IHtcbiAgICBoaWRlKHRydWUpO1xufSk7XG4kKFwiI3NhdmVkVGV4dHNQb3B1cFdyYXBwZXJcIikubW91c2Vkb3duKChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJzYXZlZFRleHRzUG9wdXBXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5saXN0ID0gdm9pZCAwO1xuY29uc3QgYXBlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2FwZVwiKSk7XG5jb25zdCBBY2NvdW50Q29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvYWNjb3VudC1jb250cm9sbGVyXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBVcGRhdGVDb25maWcgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBMb2FkZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2xvYWRlclwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IFNldHRpbmdzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wYWdlcy9zZXR0aW5nc1wiKSk7XG5jb25zdCBBcGVLZXlzUG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BvcHVwcy9hcGUta2V5cy1wb3B1cFwiKSk7XG5jb25zdCBUaGVtZVBpY2tlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc2V0dGluZ3MvdGhlbWUtcGlja2VyXCIpKTtcbmNvbnN0IEN1c3RvbVRleHQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvY3VzdG9tLXRleHRcIikpO1xuY29uc3QgQ3VzdG9tVGV4dFBvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wb3B1cHMvY3VzdG9tLXRleHQtcG9wdXBcIikpO1xuY29uc3QgU2F2ZWRUZXh0c1BvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3NhdmVkLXRleHRzLXBvcHVwXCIpKTtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi4vZmlyZWJhc2VcIik7XG5jb25zdCBhdXRoXzEgPSByZXF1aXJlKFwiZmlyZWJhc2UvYXV0aFwiKTtcbmxldCBhY3RpdmVQb3B1cCA9IG51bGw7XG5leHBvcnRzLmxpc3QgPSB7fTtcbmNsYXNzIFNpbXBsZVBvcHVwIHtcbiAgICBjb25zdHJ1Y3RvcihpZCwgdHlwZSwgdGl0bGUsIGlucHV0cyA9IFtdLCB0ZXh0ID0gXCJcIiwgYnV0dG9uVGV4dCA9IFwiQ29uZmlybVwiLCBleGVjRm4sIGJlZm9yZUluaXRGbiwgYmVmb3JlU2hvd0ZuKSB7XG4gICAgICAgIHRoaXMucGFyYW1ldGVycyA9IFtdO1xuICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgIHRoaXMuZXhlY0ZuID0gKHRoaXNQb3B1cCwgLi4udmFscykgPT4gZXhlY0ZuKHRoaXNQb3B1cCwgLi4udmFscyk7XG4gICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgdGhpcy5pbnB1dHMgPSBpbnB1dHM7XG4gICAgICAgIHRoaXMudGV4dCA9IHRleHQ7XG4gICAgICAgIHRoaXMud3JhcHBlciA9ICQoXCIjc2ltcGxlUG9wdXBXcmFwcGVyXCIpO1xuICAgICAgICB0aGlzLmVsZW1lbnQgPSAkKFwiI3NpbXBsZVBvcHVwXCIpO1xuICAgICAgICB0aGlzLmJ1dHRvblRleHQgPSBidXR0b25UZXh0O1xuICAgICAgICB0aGlzLmJlZm9yZUluaXRGbiA9ICh0aGlzUG9wdXApID0+IGJlZm9yZUluaXRGbih0aGlzUG9wdXApO1xuICAgICAgICB0aGlzLmJlZm9yZVNob3dGbiA9ICh0aGlzUG9wdXApID0+IGJlZm9yZVNob3dGbih0aGlzUG9wdXApO1xuICAgICAgICB0aGlzLmNhbkNsb3NlID0gdHJ1ZTtcbiAgICB9XG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5odG1sKGBcbiAgICA8ZGl2IGNsYXNzPVwidGl0bGVcIj48L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwiaW5wdXRzXCI+PC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cInRleHRcIj48L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwiYnV0dG9uXCI+PC9kaXY+YCk7XG4gICAgfVxuICAgIGluaXQoKSB7XG4gICAgICAgIGNvbnN0IGVsID0gdGhpcy5lbGVtZW50O1xuICAgICAgICBlbC5maW5kKFwiaW5wdXRcIikudmFsKFwiXCIpO1xuICAgICAgICAvLyBpZiAoZWwuYXR0cihcInBvcHVwSWRcIikgIT09IHRoaXMuaWQpIHtcbiAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICBlbC5hdHRyKFwicG9wdXBJZFwiLCB0aGlzLmlkKTtcbiAgICAgICAgZWwuZmluZChcIi50aXRsZVwiKS50ZXh0KHRoaXMudGl0bGUpO1xuICAgICAgICBlbC5maW5kKFwiLnRleHRcIikudGV4dCh0aGlzLnRleHQpO1xuICAgICAgICB0aGlzLmluaXRJbnB1dHMoKTtcbiAgICAgICAgaWYgKHRoaXMuYnV0dG9uVGV4dCA9PT0gXCJcIikge1xuICAgICAgICAgICAgZWwuZmluZChcIi5idXR0b25cIikucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBlbC5maW5kKFwiLmJ1dHRvblwiKS50ZXh0KHRoaXMuYnV0dG9uVGV4dCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudGV4dCA9PT0gXCJcIikge1xuICAgICAgICAgICAgZWwuZmluZChcIi50ZXh0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZWwuZmluZChcIi50ZXh0XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIC8vIH1cbiAgICB9XG4gICAgaW5pdElucHV0cygpIHtcbiAgICAgICAgY29uc3QgZWwgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgIGlmICh0aGlzLmlucHV0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy50eXBlID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZWwuZmluZChcIi5pbnB1dHNcIikuYXBwZW5kKGBcbiAgICAgICAgICAgIDxpbnB1dFxuICAgICAgICAgICAgICB0eXBlPVwibnVtYmVyXCJcbiAgICAgICAgICAgICAgbWluPVwiMVwiXG4gICAgICAgICAgICAgIHZhbHVlPVwiJHtpbnB1dC5pbml0VmFsfVwiXG4gICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiJHtpbnB1dC5wbGFjZWhvbGRlcn1cIlxuICAgICAgICAgICAgICBjbGFzcz1cIiR7aW5wdXQuaGlkZGVuID8gXCJoaWRkZW5cIiA6IFwiXCJ9XCJcbiAgICAgICAgICAgICAgJHtpbnB1dC5oaWRkZW4gPyBcIlwiIDogXCJyZXF1aXJlZFwifVxuICAgICAgICAgICAgICBhdXRvY29tcGxldGU9XCJvZmZcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgIGApO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy50eXBlID09PSBcInRleHRcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dC50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQudHlwZSA9PT0gXCJ0ZXh0YXJlYVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuZmluZChcIi5pbnB1dHNcIikuYXBwZW5kKGBcbiAgICAgICAgICAgICAgICA8dGV4dGFyZWFcbiAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiJHtpbnB1dC5wbGFjZWhvbGRlcn1cIlxuICAgICAgICAgICAgICAgICAgY2xhc3M9XCIke2lucHV0LmhpZGRlbiA/IFwiaGlkZGVuXCIgOiBcIlwifVwiXG4gICAgICAgICAgICAgICAgICAke2lucHV0LmhpZGRlbiA/IFwiXCIgOiBcInJlcXVpcmVkXCJ9XG4gICAgICAgICAgICAgICAgICAke2lucHV0LmRpc2FibGVkID8gXCJkaXNhYmxlZFwiIDogXCJcIn1cbiAgICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZT1cIm9mZlwiXG4gICAgICAgICAgICAgICAgPiR7aW5wdXQuaW5pdFZhbH08L3RleHRhcmVhPlxuICAgICAgICAgICAgICBgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlucHV0LnR5cGUgPT09IFwiY2hlY2tib3hcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLmZpbmQoXCIuaW5wdXRzXCIpLmFwcGVuZChgXG4gICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPVwiY2hlY2tib3hcIj5cbiAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIj5cbiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjdXN0b21UZXh0Q2hlY2tib3hcIj48L2Rpdj5cbiAgICAgICAgICAgICAgICAgICR7aW5wdXQubGFiZWx9XG4gICAgICAgICAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgICAgICAgYCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5maW5kKFwiLmlucHV0c1wiKS5hcHBlbmQoYFxuICAgICAgICAgICAgICA8aW5wdXRcbiAgICAgICAgICAgICAgdHlwZT1cIiR7aW5wdXQudHlwZX1cIlxuICAgICAgICAgICAgICB2YWx1ZT1cIiR7aW5wdXQuaW5pdFZhbH1cIlxuICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cIiR7aW5wdXQucGxhY2Vob2xkZXJ9XCJcbiAgICAgICAgICAgICAgY2xhc3M9XCIke2lucHV0LmhpZGRlbiA/IFwiaGlkZGVuXCIgOiBcIlwifVwiXG4gICAgICAgICAgICAgICR7aW5wdXQuaGlkZGVuID8gXCJcIiA6IFwicmVxdWlyZWRcIn1cbiAgICAgICAgICAgICAgJHtpbnB1dC5kaXNhYmxlZCA/IFwiZGlzYWJsZWRcIiA6IFwiXCJ9XG4gICAgICAgICAgICAgIGF1dG9jb21wbGV0ZT1cIm9mZlwiXG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgYCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbC5maW5kKFwiLmlucHV0c1wiKS5hcHBlbmQoYFxuICAgICAgICAgICAgICA8aW5wdXRcbiAgICAgICAgICAgICAgICB0eXBlPVwidGV4dFwiXG4gICAgICAgICAgICAgICAgdmFsdWU9XCIke2lucHV0LmluaXRWYWx9XCJcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cIiR7aW5wdXQucGxhY2Vob2xkZXJ9XCJcbiAgICAgICAgICAgICAgICBjbGFzcz1cIiR7aW5wdXQuaGlkZGVuID8gXCJoaWRkZW5cIiA6IFwiXCJ9XCJcbiAgICAgICAgICAgICAgICAke2lucHV0LmhpZGRlbiA/IFwiXCIgOiBcInJlcXVpcmVkXCJ9XG4gICAgICAgICAgICAgICAgJHtpbnB1dC5kaXNhYmxlZCA/IFwiZGlzYWJsZWRcIiA6IFwiXCJ9XG4gICAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlPVwib2ZmXCJcbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgYCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsLmZpbmQoXCIuaW5wdXRzXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZWwuZmluZChcIi5pbnB1dHNcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZXhlYygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmNhbkNsb3NlKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCB2YWxzID0gW107XG4gICAgICAgICQuZWFjaCgkKFwiI3NpbXBsZVBvcHVwIGlucHV0XCIpLCAoXywgZWwpID0+IHtcbiAgICAgICAgICAgIGlmICgkKGVsKS5pcyhcIjpjaGVja2JveFwiKSkge1xuICAgICAgICAgICAgICAgIHZhbHMucHVzaCgkKGVsKS5pcyhcIjpjaGVja2VkXCIpID8gXCJ0cnVlXCIgOiBcImZhbHNlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFscy5wdXNoKCQoZWwpLnZhbCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZXhlY0ZuKHRoaXMsIC4uLnZhbHMpO1xuICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICB9XG4gICAgc2hvdyhwYXJhbWV0ZXJzID0gW10pIHtcbiAgICAgICAgYWN0aXZlUG9wdXAgPSB0aGlzO1xuICAgICAgICB0aGlzLnBhcmFtZXRlcnMgPSBwYXJhbWV0ZXJzO1xuICAgICAgICB0aGlzLmJlZm9yZUluaXRGbih0aGlzKTtcbiAgICAgICAgdGhpcy5pbml0KCk7XG4gICAgICAgIHRoaXMuYmVmb3JlU2hvd0ZuKHRoaXMpO1xuICAgICAgICB0aGlzLndyYXBwZXJcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICAgICAkKCQoXCIjc2ltcGxlUG9wdXBcIikuZmluZChcImlucHV0XCIpWzBdKS50cmlnZ2VyKFwiZm9jdXNcIik7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoaWRlKCkge1xuICAgICAgICBpZiAoIXRoaXMuY2FuQ2xvc2UpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGFjdGl2ZVBvcHVwID0gbnVsbDtcbiAgICAgICAgdGhpcy53cmFwcGVyXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAwIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy53cmFwcGVyLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmIChhY3RpdmVQb3B1cClcbiAgICAgICAgcmV0dXJuIGFjdGl2ZVBvcHVwLmhpZGUoKTtcbiAgICAkKFwiI3NpbXBsZVBvcHVwV3JhcHBlclwiKVxuICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAwIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAkKFwiI3NpbXBsZVBvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG4kKFwiI3NpbXBsZVBvcHVwV3JhcHBlclwiKS5tb3VzZWRvd24oKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcInNpbXBsZVBvcHVwV3JhcHBlclwiKSB7XG4gICAgICAgIGlmIChhY3RpdmVQb3B1cClcbiAgICAgICAgICAgIHJldHVybiBhY3RpdmVQb3B1cC5oaWRlKCk7XG4gICAgICAgICQoXCIjc2ltcGxlUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAwIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNzaW1wbGVQb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNzaW1wbGVQb3B1cFdyYXBwZXIgLmJ1dHRvblwiLCAoKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IGlkID0gKF9hID0gJChcIiNzaW1wbGVQb3B1cFwiKS5hdHRyKFwicG9wdXBJZFwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCJcIjtcbiAgICBleHBvcnRzLmxpc3RbaWRdLmV4ZWMoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJrZXl1cFwiLCBcIiNzaW1wbGVQb3B1cFdyYXBwZXIgaW5wdXRcIiwgKGUpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zdCBpZCA9IChfYSA9ICQoXCIjc2ltcGxlUG9wdXBcIikuYXR0cihcInBvcHVwSWRcIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiXCI7XG4gICAgICAgIGV4cG9ydHMubGlzdFtpZF0uZXhlYygpO1xuICAgIH1cbn0pO1xuZXhwb3J0cy5saXN0W1widXBkYXRlRW1haWxcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJ1cGRhdGVFbWFpbFwiLCBcInRleHRcIiwgXCJVcGRhdGUgRW1haWxcIiwgW1xuICAgIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiUGFzc3dvcmRcIixcbiAgICAgICAgdHlwZTogXCJwYXNzd29yZFwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG4gICAge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJOZXcgZW1haWxcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuICAgIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiQ29uZmlybSBuZXcgZW1haWxcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuXSwgXCJcIiwgXCJVcGRhdGVcIiwgKF90aGlzUG9wdXAsIHBhc3N3b3JkLCBlbWFpbCwgZW1haWxDb25maXJtKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB1c2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgICAgICBpZiAodXNlciA9PT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKGVtYWlsICE9PSBlbWFpbENvbmZpcm0pIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRW1haWxzIGRvbid0IG1hdGNoXCIsIDApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh1c2VyLnByb3ZpZGVyRGF0YVswXS5wcm92aWRlcklkID09PSBcInBhc3N3b3JkXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNyZWRlbnRpYWwgPSBhdXRoXzEuRW1haWxBdXRoUHJvdmlkZXIuY3JlZGVudGlhbCh1c2VyLmVtYWlsLCBwYXNzd29yZCk7XG4gICAgICAgICAgICB5aWVsZCAoMCwgYXV0aF8xLnJlYXV0aGVudGljYXRlV2l0aENyZWRlbnRpYWwpKHVzZXIsIGNyZWRlbnRpYWwpO1xuICAgICAgICB9XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy51cGRhdGVFbWFpbChlbWFpbCwgdXNlci5lbWFpbCk7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHVwZGF0ZSBlbWFpbDogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJFbWFpbCB1cGRhdGVkXCIsIDEpO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgfSwgMTAwMCk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnN0IHR5cGVkRXJyb3IgPSBlO1xuICAgICAgICBpZiAodHlwZWRFcnJvci5jb2RlID09PSBcImF1dGgvd3JvbmctcGFzc3dvcmRcIikge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJJbmNvcnJlY3QgcGFzc3dvcmRcIiwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJTb21ldGhpbmcgd2VudCB3cm9uZzogXCIgKyBlLCAtMSk7XG4gICAgICAgIH1cbiAgICB9XG59KSwgKHRoaXNQb3B1cCkgPT4ge1xuICAgIGNvbnN0IHVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgaWYgKHVzZXIgPT09IG51bGwpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoIXVzZXIucHJvdmlkZXJEYXRhLmZpbmQoKHApID0+IChwID09PSBudWxsIHx8IHAgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHAucHJvdmlkZXJJZCkgPT09IFwicGFzc3dvcmRcIikpIHtcbiAgICAgICAgdGhpc1BvcHVwLmlucHV0cyA9IFtdO1xuICAgICAgICB0aGlzUG9wdXAuYnV0dG9uVGV4dCA9IFwiXCI7XG4gICAgICAgIHRoaXNQb3B1cC50ZXh0ID0gXCJQYXNzd29yZCBhdXRoZW50aWNhdGlvbiBpcyBub3QgZW5hYmxlZFwiO1xuICAgIH1cbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0pO1xuZXhwb3J0cy5saXN0W1widXBkYXRlTmFtZVwiXSA9IG5ldyBTaW1wbGVQb3B1cChcInVwZGF0ZU5hbWVcIiwgXCJ0ZXh0XCIsIFwiVXBkYXRlIE5hbWVcIiwgW1xuICAgIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiUGFzc3dvcmRcIixcbiAgICAgICAgdHlwZTogXCJwYXNzd29yZFwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG4gICAge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJOZXcgbmFtZVwiLFxuICAgICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuXSwgXCJcIiwgXCJVcGRhdGVcIiwgKF90aGlzUG9wdXAsIHBhc3MsIG5ld05hbWUpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgICAgIGlmICh1c2VyID09PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAodXNlci5wcm92aWRlckRhdGFbMF0ucHJvdmlkZXJJZCA9PT0gXCJwYXNzd29yZFwiKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVkZW50aWFsID0gYXV0aF8xLkVtYWlsQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwodXNlci5lbWFpbCwgcGFzcyk7XG4gICAgICAgICAgICB5aWVsZCAoMCwgYXV0aF8xLnJlYXV0aGVudGljYXRlV2l0aENyZWRlbnRpYWwpKHVzZXIsIGNyZWRlbnRpYWwpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHVzZXIucHJvdmlkZXJEYXRhWzBdLnByb3ZpZGVySWQgPT09IFwiZ29vZ2xlLmNvbVwiKSB7XG4gICAgICAgICAgICB5aWVsZCAoMCwgYXV0aF8xLnJlYXV0aGVudGljYXRlV2l0aFBvcHVwKSh1c2VyLCBBY2NvdW50Q29udHJvbGxlci5nbWFpbFByb3ZpZGVyKTtcbiAgICAgICAgfVxuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICBjb25zdCBjaGVja05hbWVSZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMuZ2V0TmFtZUF2YWlsYWJpbGl0eShuZXdOYW1lKTtcbiAgICAgICAgaWYgKGNoZWNrTmFtZVJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGNoZWNrIG5hbWU6IFwiICsgY2hlY2tOYW1lUmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHVwZGF0ZU5hbWVSZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMudXBkYXRlTmFtZShuZXdOYW1lKTtcbiAgICAgICAgaWYgKHVwZGF0ZU5hbWVSZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byB1cGRhdGUgbmFtZTogXCIgKyB1cGRhdGVOYW1lUmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiTmFtZSB1cGRhdGVkXCIsIDEpO1xuICAgICAgICBEQi5nZXRTbmFwc2hvdCgpLm5hbWUgPSBuZXdOYW1lO1xuICAgICAgICAkKFwiI21lbnUgLmljb24tYnV0dG9uLmFjY291bnQgLnRleHRcIikudGV4dChuZXdOYW1lKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc3QgdHlwZWRFcnJvciA9IGU7XG4gICAgICAgIGlmICh0eXBlZEVycm9yLmNvZGUgPT09IFwiYXV0aC93cm9uZy1wYXNzd29yZFwiKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkluY29ycmVjdCBwYXNzd29yZFwiLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlNvbWV0aGluZyB3ZW50IHdyb25nOiBcIiArIGUsIC0xKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBMb2FkZXIuaGlkZSgpO1xufSksICh0aGlzUG9wdXApID0+IHtcbiAgICBjb25zdCB1c2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgIGlmICh1c2VyID09PSBudWxsKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKHVzZXIucHJvdmlkZXJEYXRhWzBdLnByb3ZpZGVySWQgPT09IFwiZ29vZ2xlLmNvbVwiKSB7XG4gICAgICAgIHRoaXNQb3B1cC5pbnB1dHNbMF0uaGlkZGVuID0gdHJ1ZTtcbiAgICAgICAgdGhpc1BvcHVwLmJ1dHRvblRleHQgPSBcIlJlYXV0aGVudGljYXRlIHRvIHVwZGF0ZVwiO1xuICAgIH1cbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0pO1xuZXhwb3J0cy5saXN0W1widXBkYXRlUGFzc3dvcmRcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJ1cGRhdGVQYXNzd29yZFwiLCBcInRleHRcIiwgXCJVcGRhdGUgUGFzc3dvcmRcIiwgW1xuICAgIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiUGFzc3dvcmRcIixcbiAgICAgICAgdHlwZTogXCJwYXNzd29yZFwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG4gICAge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJOZXcgcGFzc3dvcmRcIixcbiAgICAgICAgdHlwZTogXCJwYXNzd29yZFwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG4gICAge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJDb25maXJtIG5ldyBwYXNzd29yZFwiLFxuICAgICAgICB0eXBlOiBcInBhc3N3b3JkXCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbl0sIFwiXCIsIFwiVXBkYXRlXCIsIChfdGhpc1BvcHVwLCBwcmV2aW91c1Bhc3MsIG5ld1Bhc3MsIG5ld1Bhc3NDb25maXJtKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB1c2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgICAgICBpZiAodXNlciA9PT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgY3JlZGVudGlhbCA9IGF1dGhfMS5FbWFpbEF1dGhQcm92aWRlci5jcmVkZW50aWFsKHVzZXIuZW1haWwsIHByZXZpb3VzUGFzcyk7XG4gICAgICAgIGlmIChuZXdQYXNzICE9PSBuZXdQYXNzQ29uZmlybSkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJOZXcgcGFzc3dvcmRzIGRvbid0IG1hdGNoXCIsIDApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIHlpZWxkICgwLCBhdXRoXzEucmVhdXRoZW50aWNhdGVXaXRoQ3JlZGVudGlhbCkodXNlciwgY3JlZGVudGlhbCk7XG4gICAgICAgIHlpZWxkICgwLCBhdXRoXzEudXBkYXRlUGFzc3dvcmQpKHVzZXIsIG5ld1Bhc3MpO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlBhc3N3b3JkIHVwZGF0ZWRcIiwgMSk7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICB9LCAxMDAwKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc3QgdHlwZWRFcnJvciA9IGU7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIGlmICh0eXBlZEVycm9yLmNvZGUgPT09IFwiYXV0aC93cm9uZy1wYXNzd29yZFwiKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkluY29ycmVjdCBwYXNzd29yZFwiLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlNvbWV0aGluZyB3ZW50IHdyb25nOiBcIiArIGUsIC0xKTtcbiAgICAgICAgfVxuICAgIH1cbn0pLCAodGhpc1BvcHVwKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICBpZiAodXNlciA9PT0gbnVsbClcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmICghdXNlci5wcm92aWRlckRhdGEuZmluZCgocCkgPT4gKHAgPT09IG51bGwgfHwgcCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcC5wcm92aWRlcklkKSA9PT0gXCJwYXNzd29yZFwiKSkge1xuICAgICAgICB0aGlzUG9wdXAuaW5wdXRzID0gW107XG4gICAgICAgIHRoaXNQb3B1cC5idXR0b25UZXh0ID0gXCJcIjtcbiAgICAgICAgdGhpc1BvcHVwLnRleHQgPSBcIlBhc3N3b3JkIGF1dGhlbnRpY2F0aW9uIGlzIG5vdCBlbmFibGVkXCI7XG4gICAgfVxufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSk7XG5leHBvcnRzLmxpc3RbXCJhZGRQYXNzd29yZEF1dGhcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJhZGRQYXNzd29yZEF1dGhcIiwgXCJ0ZXh0XCIsIFwiQWRkIFBhc3N3b3JkIEF1dGhlbnRpY2F0aW9uXCIsIFtcbiAgICB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcImVtYWlsXCIsXG4gICAgICAgIHR5cGU6IFwiZW1haWxcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuICAgIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiY29uZmlybSBlbWFpbFwiLFxuICAgICAgICB0eXBlOiBcImVtYWlsXCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIm5ldyBwYXNzd29yZFwiLFxuICAgICAgICB0eXBlOiBcInBhc3N3b3JkXCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcImNvbmZpcm0gbmV3IHBhc3N3b3JkXCIsXG4gICAgICAgIHR5cGU6IFwicGFzc3dvcmRcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuXSwgXCJcIiwgXCJBZGRcIiwgKF90aGlzUG9wdXAsIGVtYWlsLCBlbWFpbENvbmZpcm0sIHBhc3MsIHBhc3NDb25maXJtKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBpZiAoZW1haWwgIT09IGVtYWlsQ29uZmlybSkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVtYWlscyBkb24ndCBtYXRjaFwiLCAwKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAocGFzcyAhPT0gcGFzc0NvbmZpcm0pIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJQYXNzd29yZHMgZG9uJ3QgbWF0Y2hcIiwgMCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgeWllbGQgQWNjb3VudENvbnRyb2xsZXIuYWRkUGFzc3dvcmRBdXRoKGVtYWlsLCBwYXNzKTtcbn0pLCAoKSA9PiB7XG4gICAgLy9cbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0pO1xuZXhwb3J0cy5saXN0W1wiZGVsZXRlQWNjb3VudFwiXSA9IG5ldyBTaW1wbGVQb3B1cChcImRlbGV0ZUFjY291bnRcIiwgXCJ0ZXh0XCIsIFwiRGVsZXRlIEFjY291bnRcIiwgW1xuICAgIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiUGFzc3dvcmRcIixcbiAgICAgICAgdHlwZTogXCJwYXNzd29yZFwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG5dLCBcIlRoaXMgaXMgdGhlIGxhc3QgdGltZSB5b3UgY2FuIGNoYW5nZSB5b3VyIG1pbmQuIEFmdGVyIHByZXNzaW5nIHRoZSBidXR0b24gZXZlcnl0aGluZyBpcyBnb25lLlwiLCBcIkRlbGV0ZVwiLCAoX3RoaXNQb3B1cCwgcGFzc3dvcmQpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHZhciBfYTtcbiAgICAvL1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgICAgIGlmICh1c2VyID09PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAodXNlci5wcm92aWRlckRhdGFbMF0ucHJvdmlkZXJJZCA9PT0gXCJwYXNzd29yZFwiKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVkZW50aWFsID0gYXV0aF8xLkVtYWlsQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwodXNlci5lbWFpbCwgcGFzc3dvcmQpO1xuICAgICAgICAgICAgeWllbGQgKDAsIGF1dGhfMS5yZWF1dGhlbnRpY2F0ZVdpdGhDcmVkZW50aWFsKSh1c2VyLCBjcmVkZW50aWFsKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh1c2VyLnByb3ZpZGVyRGF0YVswXS5wcm92aWRlcklkID09PSBcImdvb2dsZS5jb21cIikge1xuICAgICAgICAgICAgeWllbGQgKDAsIGF1dGhfMS5yZWF1dGhlbnRpY2F0ZVdpdGhQb3B1cCkodXNlciwgQWNjb3VudENvbnRyb2xsZXIuZ21haWxQcm92aWRlcik7XG4gICAgICAgIH1cbiAgICAgICAgTG9hZGVyLnNob3coKTtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJEZWxldGluZyBzdGF0cy4uLlwiLCAwKTtcbiAgICAgICAgY29uc3QgdXNlcnNSZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMuZGVsZXRlKCk7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIGlmICh1c2Vyc1Jlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gZGVsZXRlIHVzZXIgc3RhdHM6IFwiICsgdXNlcnNSZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgTG9hZGVyLnNob3coKTtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJEZWxldGluZyByZXN1bHRzLi4uXCIsIDApO1xuICAgICAgICBjb25zdCByZXN1bHRzUmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnJlc3VsdHMuZGVsZXRlQWxsKCk7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIGlmIChyZXN1bHRzUmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBkZWxldGUgdXNlciByZXN1bHRzOiBcIiArIHJlc3VsdHNSZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJEZWxldGluZyBsb2dpbiBpbmZvcm1hdGlvbi4uLlwiLCAwKTtcbiAgICAgICAgeWllbGQgKChfYSA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmRlbGV0ZSgpKTtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJHb29kYnllXCIsIDEsIDUpO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICB9LCAzMDAwKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc3QgdHlwZWRFcnJvciA9IGU7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIGlmICh0eXBlZEVycm9yLmNvZGUgPT09IFwiYXV0aC93cm9uZy1wYXNzd29yZFwiKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkluY29ycmVjdCBwYXNzd29yZFwiLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlNvbWV0aGluZyB3ZW50IHdyb25nOiBcIiArIGUsIC0xKTtcbiAgICAgICAgfVxuICAgIH1cbn0pLCAodGhpc1BvcHVwKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICBpZiAodXNlciA9PT0gbnVsbClcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmICh1c2VyLnByb3ZpZGVyRGF0YVswXS5wcm92aWRlcklkID09PSBcImdvb2dsZS5jb21cIikge1xuICAgICAgICB0aGlzUG9wdXAuaW5wdXRzID0gW107XG4gICAgICAgIHRoaXNQb3B1cC5idXR0b25UZXh0ID0gXCJSZWF1dGhlbnRpY2F0ZSB0byBkZWxldGVcIjtcbiAgICB9XG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59KTtcbmV4cG9ydHMubGlzdFtcImNsZWFyVGFnUGJcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJjbGVhclRhZ1BiXCIsIFwidGV4dFwiLCBcIkNsZWFyIFRhZyBQQlwiLCBbXSwgYEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBjbGVhciB0aGlzIHRhZ3MgUEI/YCwgXCJDbGVhclwiLCAodGhpc1BvcHVwKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB2YXIgX2I7XG4gICAgY29uc3QgdGFnSWQgPSB0aGlzUG9wdXAucGFyYW1ldGVyc1swXTtcbiAgICBMb2FkZXIuc2hvdygpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5kZWxldGVUYWdQZXJzb25hbEJlc3QodGFnSWQpO1xuICAgIExvYWRlci5oaWRlKCk7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBkZWxldGUgdGFnJ3MgUEI6IFwiICsgcmVzcG9uc2UubWVzc2FnZSk7XG4gICAgfVxuICAgIGlmIChyZXNwb25zZS5kYXRhLnJlc3VsdENvZGUgPT09IDEpIHtcbiAgICAgICAgY29uc3QgdGFnID0gKF9iID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZmlsdGVyKCh0KSA9PiB0Ll9pZCA9PT0gdGFnSWQpWzBdO1xuICAgICAgICBpZiAodGFnID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRhZy5wZXJzb25hbEJlc3RzID0ge1xuICAgICAgICAgICAgdGltZToge30sXG4gICAgICAgICAgICB3b3Jkczoge30sXG4gICAgICAgICAgICB6ZW46IHsgemVuOiBbXSB9LFxuICAgICAgICAgICAgcXVvdGU6IHsgY3VzdG9tOiBbXSB9LFxuICAgICAgICAgICAgY3VzdG9tOiB7IGN1c3RvbTogW10gfSxcbiAgICAgICAgfTtcbiAgICAgICAgJChgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50YWdzIC50YWdzTGlzdCAudGFnW2lkPVwiJHt0YWdJZH1cIl0gLmNsZWFyUGJCdXR0b25gKS5hdHRyKFwiYXJpYS1sYWJlbFwiLCBcIk5vIFBCIGZvdW5kXCIpO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlRhZyBQQiBjbGVhcmVkLlwiLCAwKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiU29tZXRoaW5nIHdlbnQgd3Jvbmc6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgIH1cbn0pLCAodGhpc1BvcHVwKSA9PiB7XG4gICAgdGhpc1BvcHVwLnRleHQgPSBgQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGNsZWFyIFBCIGZvciB0YWcgJHt0aGlzUG9wdXAucGFyYW1ldGVyc1sxXX0/YDtcbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0pO1xuZXhwb3J0cy5saXN0W1wiYXBwbHlDdXN0b21Gb250XCJdID0gbmV3IFNpbXBsZVBvcHVwKFwiYXBwbHlDdXN0b21Gb250XCIsIFwidGV4dFwiLCBcIkN1c3RvbSBmb250XCIsIFt7IHBsYWNlaG9sZGVyOiBcIkZvbnQgbmFtZVwiLCBpbml0VmFsOiBcIlwiIH1dLCBcIk1ha2Ugc3VyZSB5b3UgaGF2ZSB0aGUgZm9udCBpbnN0YWxsZWQgb24geW91ciBjb21wdXRlciBiZWZvcmUgYXBwbHlpbmcuXCIsIFwiQXBwbHlcIiwgKF90aGlzUG9wdXAsIGZvbnROYW1lKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGlmIChmb250TmFtZSA9PT0gXCJcIilcbiAgICAgICAgcmV0dXJuO1xuICAgIChfYSA9IFNldHRpbmdzLmdyb3Vwc1tcImZvbnRGYW1pbHlcIl0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRWYWx1ZShmb250TmFtZS5yZXBsYWNlKC9cXHMvZywgXCJfXCIpKTtcbn0sICgpID0+IHtcbiAgICAvL1xufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSk7XG5leHBvcnRzLmxpc3RbXCJyZXNldFBlcnNvbmFsQmVzdHNcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJyZXNldFBlcnNvbmFsQmVzdHNcIiwgXCJ0ZXh0XCIsIFwiUmVzZXQgUGVyc29uYWwgQmVzdHNcIiwgW1xuICAgIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiUGFzc3dvcmRcIixcbiAgICAgICAgdHlwZTogXCJwYXNzd29yZFwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG5dLCBcIlwiLCBcIlJlc2V0XCIsIChfdGhpc1BvcHVwLCBwYXNzd29yZCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICAgICAgaWYgKHVzZXIgPT09IG51bGwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmICh1c2VyLnByb3ZpZGVyRGF0YVswXS5wcm92aWRlcklkID09PSBcInBhc3N3b3JkXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNyZWRlbnRpYWwgPSBhdXRoXzEuRW1haWxBdXRoUHJvdmlkZXIuY3JlZGVudGlhbCh1c2VyLmVtYWlsLCBwYXNzd29yZCk7XG4gICAgICAgICAgICB5aWVsZCAoMCwgYXV0aF8xLnJlYXV0aGVudGljYXRlV2l0aENyZWRlbnRpYWwpKHVzZXIsIGNyZWRlbnRpYWwpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHVzZXIucHJvdmlkZXJEYXRhWzBdLnByb3ZpZGVySWQgPT09IFwiZ29vZ2xlLmNvbVwiKSB7XG4gICAgICAgICAgICB5aWVsZCAoMCwgYXV0aF8xLnJlYXV0aGVudGljYXRlV2l0aFBvcHVwKSh1c2VyLCBBY2NvdW50Q29udHJvbGxlci5nbWFpbFByb3ZpZGVyKTtcbiAgICAgICAgfVxuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMuZGVsZXRlUGVyc29uYWxCZXN0cygpO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byByZXNldCBwZXJzb25hbCBiZXN0czogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJQZXJzb25hbCBiZXN0cyBoYXZlIGJlZW4gcmVzZXRcIiwgMSk7XG4gICAgICAgIERCLmdldFNuYXBzaG90KCkucGVyc29uYWxCZXN0cyA9IHtcbiAgICAgICAgICAgIHRpbWU6IHt9LFxuICAgICAgICAgICAgd29yZHM6IHt9LFxuICAgICAgICAgICAgemVuOiB7IHplbjogW10gfSxcbiAgICAgICAgICAgIHF1b3RlOiB7IGN1c3RvbTogW10gfSxcbiAgICAgICAgICAgIGN1c3RvbTogeyBjdXN0b206IFtdIH0sXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGUsIC0xKTtcbiAgICB9XG59KSwgKHRoaXNQb3B1cCkgPT4ge1xuICAgIGNvbnN0IHVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgaWYgKHVzZXIgPT09IG51bGwpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAodXNlci5wcm92aWRlckRhdGFbMF0ucHJvdmlkZXJJZCA9PT0gXCJnb29nbGUuY29tXCIpIHtcbiAgICAgICAgdGhpc1BvcHVwLmlucHV0cyA9IFtdO1xuICAgICAgICB0aGlzUG9wdXAuYnV0dG9uVGV4dCA9IFwiUmVhdXRoZW50aWNhdGUgdG8gcmVzZXRcIjtcbiAgICB9XG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59KTtcbmV4cG9ydHMubGlzdFtcInJlc2V0U2V0dGluZ3NcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJyZXNldFNldHRpbmdzXCIsIFwidGV4dFwiLCBcIlJlc2V0IFNldHRpbmdzXCIsIFtdLCBcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byByZXNldCBhbGwgeW91ciBzZXR0aW5ncz9cIiwgXCJSZXNldFwiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnJlc2V0KCk7XG4gICAgLy8gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgLy8gICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAvLyB9LCAxMDAwKTtcbn0sICgpID0+IHtcbiAgICAvL1xufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSk7XG5leHBvcnRzLmxpc3RbXCJ1bmxpbmtEaXNjb3JkXCJdID0gbmV3IFNpbXBsZVBvcHVwKFwidW5saW5rRGlzY29yZFwiLCBcInRleHRcIiwgXCJVbmxpbmsgRGlzY29yZFwiLCBbXSwgXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gdW5saW5rIHlvdXIgRGlzY29yZCBhY2NvdW50P1wiLCBcIlVubGlua1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBMb2FkZXIuc2hvdygpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy51bmxpbmtEaXNjb3JkKCk7XG4gICAgTG9hZGVyLmhpZGUoKTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHVubGluayBEaXNjb3JkOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICB9XG4gICAgTm90aWZpY2F0aW9ucy5hZGQoXCJBY2NvdW50cyB1bmxpbmtlZFwiLCAxKTtcbiAgICBEQi5nZXRTbmFwc2hvdCgpLmRpc2NvcmRJZCA9IHVuZGVmaW5lZDtcbiAgICBTZXR0aW5ncy51cGRhdGVEaXNjb3JkU2VjdGlvbigpO1xufSksICgpID0+IHtcbiAgICAvL1xufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSk7XG5leHBvcnRzLmxpc3RbXCJnZW5lcmF0ZUFwZUtleVwiXSA9IG5ldyBTaW1wbGVQb3B1cChcImdlbmVyYXRlQXBlS2V5XCIsIFwidGV4dFwiLCBcIkdlbmVyYXRlIG5ldyBrZXlcIiwgW1xuICAgIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiTmFtZVwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG5dLCBcIlwiLCBcIkdlbmVyYXRlXCIsIChfdGhpc1BvcHVwLCBuYW1lKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBMb2FkZXIuc2hvdygpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5hcGVLZXlzLmdlbmVyYXRlKG5hbWUsIGZhbHNlKTtcbiAgICBMb2FkZXIuaGlkZSgpO1xuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gZ2VuZXJhdGUga2V5OiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICBleHBvcnRzLmxpc3RbXCJ2aWV3QXBlS2V5XCJdLnNob3coW2RhdGEuYXBlS2V5XSk7XG4gICAgfVxufSksICgpID0+IHtcbiAgICAvL1xufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSk7XG5leHBvcnRzLmxpc3RbXCJ2aWV3QXBlS2V5XCJdID0gbmV3IFNpbXBsZVBvcHVwKFwidmlld0FwZUtleVwiLCBcInRleHRcIiwgXCJBcGUgS2V5XCIsIFtcbiAgICB7XG4gICAgICAgIHR5cGU6IFwidGV4dGFyZWFcIixcbiAgICAgICAgZGlzYWJsZWQ6IHRydWUsXG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIktleVwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG5dLCBcIlRoaXMgaXMgeW91ciBuZXcgQXBlIEtleS4gUGxlYXNlIGtlZXAgaXQgc2FmZS4gWW91IHdpbGwgb25seSBzZWUgaXQgb25jZSFcIiwgXCJDbG9zZVwiLCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIEFwZUtleXNQb3B1cC5zaG93KCk7XG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIF90aGlzUG9wdXAuaW5wdXRzWzBdLmluaXRWYWwgPSBfdGhpc1BvcHVwLnBhcmFtZXRlcnNbMF07XG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIF90aGlzUG9wdXAuY2FuQ2xvc2UgPSBmYWxzZTtcbiAgICAkKFwiI3NpbXBsZVBvcHVwIHRleHRhcmVhXCIpLmNzcyhcImhlaWdodFwiLCBcIjExMHB4XCIpO1xuICAgICQoXCIjc2ltcGxlUG9wdXAgLmJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgX3RoaXNQb3B1cC5jYW5DbG9zZSA9IHRydWU7XG4gICAgICAgICQoXCIjc2ltcGxlUG9wdXAgLmJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9LCAzMDAwKTtcbn0pO1xuZXhwb3J0cy5saXN0W1wiZGVsZXRlQXBlS2V5XCJdID0gbmV3IFNpbXBsZVBvcHVwKFwiZGVsZXRlQXBlS2V5XCIsIFwidGV4dFwiLCBcIkRlbGV0ZSBBcGUgS2V5XCIsIFtdLCBcIkFyZSB5b3Ugc3VyZT9cIiwgXCJEZWxldGVcIiwgKF90aGlzUG9wdXApID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIExvYWRlci5zaG93KCk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LmFwZUtleXMuZGVsZXRlKF90aGlzUG9wdXAucGFyYW1ldGVyc1swXSk7XG4gICAgTG9hZGVyLmhpZGUoKTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGRlbGV0ZSBrZXk6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgIH1cbiAgICBOb3RpZmljYXRpb25zLmFkZChcIktleSBkZWxldGVkXCIsIDEpO1xuICAgIEFwZUtleXNQb3B1cC5zaG93KCk7XG59KSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSk7XG5leHBvcnRzLmxpc3RbXCJlZGl0QXBlS2V5XCJdID0gbmV3IFNpbXBsZVBvcHVwKFwiZWRpdEFwZUtleVwiLCBcInRleHRcIiwgXCJFZGl0IEFwZSBLZXlcIiwgW1xuICAgIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiTmFtZVwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG5dLCBcIlwiLCBcIkVkaXRcIiwgKF90aGlzUG9wdXAsIGlucHV0KSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBMb2FkZXIuc2hvdygpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5hcGVLZXlzLnVwZGF0ZShfdGhpc1BvcHVwLnBhcmFtZXRlcnNbMF0sIHtcbiAgICAgICAgbmFtZTogaW5wdXQsXG4gICAgfSk7XG4gICAgTG9hZGVyLmhpZGUoKTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHVwZGF0ZSBrZXk6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgIH1cbiAgICBOb3RpZmljYXRpb25zLmFkZChcIktleSB1cGRhdGVkXCIsIDEpO1xuICAgIEFwZUtleXNQb3B1cC5zaG93KCk7XG59KSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSk7XG5leHBvcnRzLmxpc3RbXCJzYXZlQ3VzdG9tVGV4dFwiXSA9IG5ldyBTaW1wbGVQb3B1cChcInNhdmVDdXN0b21UZXh0XCIsIFwidGV4dFwiLCBcIlNhdmUgY3VzdG9tIHRleHRcIiwgW1xuICAgIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiTmFtZVwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG5dLCBcIlwiLCBcIlNhdmVcIiwgKF90aGlzUG9wdXAsIGlucHV0KSA9PiB7XG4gICAgY29uc3QgdGV4dCA9ICQoYCNjdXN0b21UZXh0UG9wdXAgdGV4dGFyZWFgKS52YWwoKS5ub3JtYWxpemUoKTtcbiAgICBDdXN0b21UZXh0LnNldEN1c3RvbVRleHQoaW5wdXQsIHRleHQpO1xuICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ3VzdG9tIHRleHQgc2F2ZWRcIiwgMSk7XG4gICAgQ3VzdG9tVGV4dFBvcHVwLnNob3coKTtcbn0sICgpID0+IHtcbiAgICAvL1xufSwgKCkgPT4ge1xuICAgIC8vXG59KTtcbmV4cG9ydHMubGlzdFtcImRlbGV0ZUN1c3RvbVRleHRcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJkZWxldGVDdXN0b21UZXh0XCIsIFwidGV4dFwiLCBcIkRlbGV0ZSBjdXN0b20gdGV4dFwiLCBbXSwgXCJBcmUgeW91IHN1cmU/XCIsIFwiRGVsZXRlXCIsIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgQ3VzdG9tVGV4dC5kZWxldGVDdXN0b21UZXh0KF90aGlzUG9wdXAucGFyYW1ldGVyc1swXSk7XG4gICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDdXN0b20gdGV4dCBkZWxldGVkXCIsIDEpO1xuICAgIFNhdmVkVGV4dHNQb3B1cC5zaG93KCk7XG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIF90aGlzUG9wdXAudGV4dCA9IGBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIGN1c3RvbSB0ZXh0ICR7X3RoaXNQb3B1cC5wYXJhbWV0ZXJzWzBdfT9gO1xufSwgKCkgPT4ge1xuICAgIC8vXG59KTtcbmV4cG9ydHMubGlzdFtcInVwZGF0ZUN1c3RvbVRoZW1lXCJdID0gbmV3IFNpbXBsZVBvcHVwKFwidXBkYXRlQ3VzdG9tVGhlbWVcIiwgXCJ0ZXh0XCIsIFwiVXBkYXRlIEN1c3RvbSBUaGVtZVwiLCBbXG4gICAge1xuICAgICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiTmFtZVwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG4gICAge1xuICAgICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICAgIGluaXRWYWw6IFwiZmFsc2VcIixcbiAgICAgICAgbGFiZWw6IFwiVXBkYXRlIGN1c3RvbSB0aGVtZSB0byBjdXJyZW50IGNvbG9yc1wiLFxuICAgIH0sXG5dLCBcIlwiLCBcIlVwZGF0ZVwiLCAoX3RoaXNQb3B1cCwgbmFtZSwgdXBkYXRlQ29sb3JzKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBjb25zdCBzbmFwc2hvdCA9IERCLmdldFNuYXBzaG90KCk7XG4gICAgY29uc3QgY3VzdG9tVGhlbWUgPSBzbmFwc2hvdC5jdXN0b21UaGVtZXMuZmluZCgodCkgPT4gdC5faWQgPT09IF90aGlzUG9wdXAucGFyYW1ldGVyc1swXSk7XG4gICAgaWYgKGN1c3RvbVRoZW1lID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDdXN0b20gdGhlbWUgZG9lcyBub3QgZXhpc3QhXCIsIC0xKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgbmV3Q29sb3JzID0gW107XG4gICAgaWYgKHVwZGF0ZUNvbG9ycyA9PT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgJC5lYWNoKCQoXCIucGFnZVNldHRpbmdzIC5jdXN0b21UaGVtZSAuY3VzdG9tVGhlbWVFZGl0IFt0eXBlPSdjb2xvciddXCIpLCAoX2luZGV4LCBlbGVtZW50KSA9PiB7XG4gICAgICAgICAgICBuZXdDb2xvcnMucHVzaCgkKGVsZW1lbnQpLmF0dHIoXCJ2YWx1ZVwiKSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgbmV3Q29sb3JzID0gY3VzdG9tVGhlbWUuY29sb3JzO1xuICAgIH1cbiAgICBjb25zdCBuZXdUaGVtZSA9IHtcbiAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgY29sb3JzOiBuZXdDb2xvcnMsXG4gICAgfTtcbiAgICBMb2FkZXIuc2hvdygpO1xuICAgIHlpZWxkIERCLmVkaXRDdXN0b21UaGVtZShjdXN0b21UaGVtZS5faWQsIG5ld1RoZW1lKTtcbiAgICBMb2FkZXIuaGlkZSgpO1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZUNvbG9ycyhuZXdDb2xvcnMpO1xuICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ3VzdG9tIHRoZW1lIHVwZGF0ZWRcIiwgMSk7XG4gICAgVGhlbWVQaWNrZXIucmVmcmVzaEJ1dHRvbnMoKTtcbn0pLCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIGNvbnN0IHNuYXBzaG90ID0gREIuZ2V0U25hcHNob3QoKTtcbiAgICBjb25zdCBjdXN0b21UaGVtZSA9IHNuYXBzaG90LmN1c3RvbVRoZW1lcy5maW5kKCh0KSA9PiB0Ll9pZCA9PT0gX3RoaXNQb3B1cC5wYXJhbWV0ZXJzWzBdKTtcbiAgICBpZiAoIWN1c3RvbVRoZW1lKVxuICAgICAgICByZXR1cm47XG4gICAgX3RoaXNQb3B1cC5pbnB1dHNbMF0uaW5pdFZhbCA9IGN1c3RvbVRoZW1lLm5hbWU7XG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59KTtcbmV4cG9ydHMubGlzdFtcImRlbGV0ZUN1c3RvbVRoZW1lXCJdID0gbmV3IFNpbXBsZVBvcHVwKFwiZGVsZXRlQ3VzdG9tVGhlbWVcIiwgXCJ0ZXh0XCIsIFwiRGVsZXRlIEN1c3RvbSBUaGVtZVwiLCBbXSwgXCJBcmUgeW91IHN1cmU/XCIsIFwiRGVsZXRlXCIsIChfdGhpc1BvcHVwKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBMb2FkZXIuc2hvdygpO1xuICAgIHlpZWxkIERCLmRlbGV0ZUN1c3RvbVRoZW1lKF90aGlzUG9wdXAucGFyYW1ldGVyc1swXSk7XG4gICAgTG9hZGVyLmhpZGUoKTtcbiAgICBOb3RpZmljYXRpb25zLmFkZChcIkN1c3RvbSB0aGVtZSBkZWxldGVkXCIsIDEpO1xuICAgIFRoZW1lUGlja2VyLnJlZnJlc2hCdXR0b25zKCk7XG59KSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5kaXNjb3JkSW50ZWdyYXRpb24gI3VubGlua0Rpc2NvcmRCdXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgZXhwb3J0cy5saXN0W1widW5saW5rRGlzY29yZFwiXS5zaG93KCk7XG59KTtcbiQoXCIjcmVzZXRTZXR0aW5nc0J1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBleHBvcnRzLmxpc3RbXCJyZXNldFNldHRpbmdzXCJdLnNob3coKTtcbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgI3Jlc2V0UGVyc29uYWxCZXN0c0J1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBleHBvcnRzLmxpc3RbXCJyZXNldFBlcnNvbmFsQmVzdHNcIl0uc2hvdygpO1xufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAjdXBkYXRlQWNjb3VudE5hbWVcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgZXhwb3J0cy5saXN0W1widXBkYXRlTmFtZVwiXS5zaG93KCk7XG59KTtcbiQoXCIucGFnZVNldHRpbmdzICNhZGRQYXNzd29yZEF1dGhcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgZXhwb3J0cy5saXN0W1wiYWRkUGFzc3dvcmRBdXRoXCJdLnNob3coKTtcbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgI2VtYWlsUGFzc3dvcmRBdXRoXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGV4cG9ydHMubGlzdFtcInVwZGF0ZUVtYWlsXCJdLnNob3coKTtcbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgI3Bhc3NQYXNzd29yZEF1dGhcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgZXhwb3J0cy5saXN0W1widXBkYXRlUGFzc3dvcmRcIl0uc2hvdygpO1xufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAjZGVsZXRlQWNjb3VudFwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBleHBvcnRzLmxpc3RbXCJkZWxldGVBY2NvdW50XCJdLnNob3coKTtcbn0pO1xuJChcIiNhcGVLZXlzUG9wdXAgLmdlbmVyYXRlQXBlS2V5XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGV4cG9ydHMubGlzdFtcImdlbmVyYXRlQXBlS2V5XCJdLnNob3coKTtcbn0pO1xuJChgI2N1c3RvbVRleHRQb3B1cCAuYnV0dG9uc1RvcCAuc2F2ZUN1c3RvbVRleHRgKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBleHBvcnRzLmxpc3RbXCJzYXZlQ3VzdG9tVGV4dFwiXS5zaG93KCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAuY3VzdG9tVGhlbWUgLmRlbEJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIGNvbnN0ICRwYXJlbnRFbGVtZW50ID0gJChlLmN1cnJlbnRUYXJnZXQpLnBhcmVudChcIi5jdXN0b21UaGVtZS5idXR0b25cIik7XG4gICAgY29uc3QgY3VzdG9tVGhlbWVJZCA9ICRwYXJlbnRFbGVtZW50LmF0dHIoXCJjdXN0b21UaGVtZUlkXCIpO1xuICAgIGV4cG9ydHMubGlzdFtcImRlbGV0ZUN1c3RvbVRoZW1lXCJdLnNob3coW2N1c3RvbVRoZW1lSWRdKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC5jdXN0b21UaGVtZSAuZWRpdEJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIGNvbnN0ICRwYXJlbnRFbGVtZW50ID0gJChlLmN1cnJlbnRUYXJnZXQpLnBhcmVudChcIi5jdXN0b21UaGVtZS5idXR0b25cIik7XG4gICAgY29uc3QgY3VzdG9tVGhlbWVJZCA9ICRwYXJlbnRFbGVtZW50LmF0dHIoXCJjdXN0b21UaGVtZUlkXCIpO1xuICAgIGV4cG9ydHMubGlzdFtcInVwZGF0ZUN1c3RvbVRoZW1lXCJdLnNob3coW2N1c3RvbVRoZW1lSWRdKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBgI3NhdmVkVGV4dHNQb3B1cFdyYXBwZXIgLmxpc3QgLnNhdmVkVGV4dCAuYnV0dG9uLmRlbGV0ZWAsIChlKSA9PiB7XG4gICAgY29uc3QgbmFtZSA9ICQoZS50YXJnZXQpLnNpYmxpbmdzKFwiLmJ1dHRvbi5uYW1lXCIpLnRleHQoKTtcbiAgICBleHBvcnRzLmxpc3RbXCJkZWxldGVDdXN0b21UZXh0XCJdLnNob3coW25hbWVdKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNhcGVLZXlzUG9wdXAgdGFibGUgdGJvZHkgdHIgLmJ1dHRvbi5kZWxldGVcIiwgKGUpID0+IHtcbiAgICBjb25zdCBrZXlJZCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoXCJ0clwiKS5hdHRyKFwia2V5SWRcIik7XG4gICAgZXhwb3J0cy5saXN0W1wiZGVsZXRlQXBlS2V5XCJdLnNob3coW2tleUlkXSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjYXBlS2V5c1BvcHVwIHRhYmxlIHRib2R5IHRyIC5idXR0b24uZWRpdFwiLCAoZSkgPT4ge1xuICAgIGNvbnN0IGtleUlkID0gJChlLnRhcmdldCkuY2xvc2VzdChcInRyXCIpLmF0dHIoXCJrZXlJZFwiKTtcbiAgICBleHBvcnRzLmxpc3RbXCJlZGl0QXBlS2V5XCJdLnNob3coW2tleUlkXSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmZvbnRGYW1pbHkgLmJ1dHRvbi5jdXN0b21cIiwgKCkgPT4ge1xuICAgIGV4cG9ydHMubGlzdFtcImFwcGx5Q3VzdG9tRm9udFwiXS5zaG93KFtdKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJrZXlkb3duXCIsIChldmVudCkgPT4ge1xuICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIgJiYgISQoXCIjc2ltcGxlUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBDb21tYW5kbGluZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvY29tbWFuZGxpbmVcIikpO1xuY29uc3QgQ29tbWFuZGxpbmVMaXN0cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvY29tbWFuZGxpbmUtbGlzdHNcIikpO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiI3N1cHBvcnRNZUJ1dHRvblwiLCAoKSA9PiB7XG4gICAgJChcIiNzdXBwb3J0TWVXcmFwcGVyXCIpXG4gICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTI1KTtcbn0pO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiI3N1cHBvcnRNZVdyYXBwZXJcIiwgKCkgPT4ge1xuICAgICQoXCIjc3VwcG9ydE1lV3JhcHBlclwiKVxuICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICQoXCIjc3VwcG9ydE1lV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbn0pO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiI3N1cHBvcnRNZVdyYXBwZXIgLmJ1dHRvbi5hZHNcIiwgKCkgPT4ge1xuICAgIENvbW1hbmRsaW5lTGlzdHMucHVzaEN1cnJlbnQoQ29tbWFuZGxpbmVMaXN0cy5jb21tYW5kc0VuYWJsZUFkcyk7XG4gICAgQ29tbWFuZGxpbmUuc2hvdygpO1xuICAgICQoXCIjc3VwcG9ydE1lV3JhcHBlclwiKVxuICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICQoXCIjc3VwcG9ydE1lV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbn0pO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiI3N1cHBvcnRNZVdyYXBwZXIgYS5idXR0b25cIiwgKCkgPT4ge1xuICAgICQoXCIjc3VwcG9ydE1lV3JhcHBlclwiKVxuICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICQoXCIjc3VwcG9ydE1lV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNob3cgPSB2b2lkIDA7XG5mdW5jdGlvbiBzaG93KCkge1xuICAgICQoXCIjdmVyc2lvbkhpc3RvcnlXcmFwcGVyXCIpXG4gICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTI1KTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIudmVyc2lvblwiLCAoZSkgPT4ge1xuICAgIGlmIChlLnNoaWZ0S2V5KVxuICAgICAgICByZXR1cm47XG4gICAgc2hvdygpO1xufSk7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIjdmVyc2lvbkhpc3RvcnlXcmFwcGVyXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJ2ZXJzaW9uSGlzdG9yeVdyYXBwZXJcIikge1xuICAgICAgICAkKFwiI3ZlcnNpb25IaXN0b3J5V3JhcHBlclwiKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMCB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjdmVyc2lvbkhpc3RvcnlXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgQ3VzdG9tVGV4dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9jdXN0b20tdGV4dFwiKSk7XG5sZXQgaW5pdGlhbGlzZWQgPSBmYWxzZTtcbmZ1bmN0aW9uIGluaXQoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCFpbml0aWFsaXNlZCkge1xuICAgICAgICAgICAgJChcIiN3b3JkRmlsdGVyUG9wdXAgLmxhbmd1YWdlSW5wdXRcIikuZW1wdHkoKTtcbiAgICAgICAgICAgIGNvbnN0IExhbmd1YWdlTGlzdCA9IHlpZWxkIE1pc2MuZ2V0TGFuZ3VhZ2VMaXN0KCk7XG4gICAgICAgICAgICBMYW5ndWFnZUxpc3QuZm9yRWFjaCgobGFuZ3VhZ2UpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgcHJldHR5TGFuZyA9IGxhbmd1YWdlO1xuICAgICAgICAgICAgICAgIHByZXR0eUxhbmcgPSBwcmV0dHlMYW5nLnJlcGxhY2UoXCJfXCIsIFwiIFwiKTtcbiAgICAgICAgICAgICAgICAkKFwiI3dvcmRGaWx0ZXJQb3B1cCAubGFuZ3VhZ2VJbnB1dFwiKS5hcHBlbmQoYFxuICAgICAgICA8b3B0aW9uIHZhbHVlPSR7bGFuZ3VhZ2V9PiR7cHJldHR5TGFuZ308L29wdGlvbj5cbiAgICAgIGApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpbml0aWFsaXNlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgeWllbGQgaW5pdCgpO1xuICAgICAgICAkKFwiI3dvcmRGaWx0ZXJQb3B1cFdyYXBwZXJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjY3VzdG9tVGV4dFBvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiN3b3JkRmlsdGVyUG9wdXAgLmxhbmd1YWdlSW5wdXRcIikuc2VsZWN0Mih7XG4gICAgICAgICAgICB3aWR0aDogXCIxMDAlXCIsXG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgJChcIiN3b3JkRmlsdGVyUG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICQoXCIjY3VzdG9tVGV4dFBvcHVwV3JhcHBlclwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbn1cbmZ1bmN0aW9uIGZpbHRlcihsYW5ndWFnZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGxldCBmaWx0ZXJpbiA9ICQoXCIjd29yZEZpbHRlclBvcHVwIC53b3JkSW5jbHVkZUlucHV0XCIpLnZhbCgpO1xuICAgICAgICBmaWx0ZXJpbiA9IE1pc2MuZXNjYXBlUmVnRXhwKGZpbHRlcmluID09PSBudWxsIHx8IGZpbHRlcmluID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaWx0ZXJpbi50cmltKCkpO1xuICAgICAgICBmaWx0ZXJpbiA9IGZpbHRlcmluLnJlcGxhY2UoL1xccysvZ2ksIFwifFwiKTtcbiAgICAgICAgY29uc3QgcmVnaW5jbCA9IG5ldyBSZWdFeHAoZmlsdGVyaW4sIFwiaVwiKTtcbiAgICAgICAgbGV0IGZpbHRlcm91dCA9ICQoXCIjd29yZEZpbHRlclBvcHVwIC53b3JkRXhjbHVkZUlucHV0XCIpLnZhbCgpO1xuICAgICAgICBmaWx0ZXJvdXQgPSBNaXNjLmVzY2FwZVJlZ0V4cChmaWx0ZXJvdXQudHJpbSgpKTtcbiAgICAgICAgZmlsdGVyb3V0ID0gZmlsdGVyb3V0LnJlcGxhY2UoL1xccysvZ2ksIFwifFwiKTtcbiAgICAgICAgY29uc3QgcmVnZXhjbCA9IG5ldyBSZWdFeHAoZmlsdGVyb3V0LCBcImlcIik7XG4gICAgICAgIGNvbnN0IGZpbHRlcmVkV29yZHMgPSBbXTtcbiAgICAgICAgY29uc3QgbGFuZ3VhZ2VXb3JkTGlzdCA9IHlpZWxkIE1pc2MuZ2V0TGFuZ3VhZ2UobGFuZ3VhZ2UpO1xuICAgICAgICBjb25zdCBtYXhMZW5ndGhJbnB1dCA9ICQoXCIjd29yZEZpbHRlclBvcHVwIC53b3JkTWF4SW5wdXRcIikudmFsKCk7XG4gICAgICAgIGNvbnN0IG1pbkxlbmd0aElucHV0ID0gJChcIiN3b3JkRmlsdGVyUG9wdXAgLndvcmRNaW5JbnB1dFwiKS52YWwoKTtcbiAgICAgICAgbGV0IG1heExlbmd0aDtcbiAgICAgICAgbGV0IG1pbkxlbmd0aDtcbiAgICAgICAgaWYgKG1heExlbmd0aElucHV0ID09IFwiXCIpIHtcbiAgICAgICAgICAgIG1heExlbmd0aCA9IDk5OTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1heExlbmd0aCA9IHBhcnNlSW50KG1heExlbmd0aElucHV0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWluTGVuZ3RoSW5wdXQgPT0gXCJcIikge1xuICAgICAgICAgICAgbWluTGVuZ3RoID0gMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1pbkxlbmd0aCA9IHBhcnNlSW50KG1pbkxlbmd0aElucHV0KTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxhbmd1YWdlV29yZExpc3Qud29yZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHdvcmQgPSBsYW5ndWFnZVdvcmRMaXN0LndvcmRzW2ldO1xuICAgICAgICAgICAgY29uc3QgdGVzdDEgPSByZWdpbmNsLnRlc3Qod29yZCk7XG4gICAgICAgICAgICBjb25zdCB0ZXN0MiA9IHJlZ2V4Y2wudGVzdCh3b3JkKTtcbiAgICAgICAgICAgIGlmICgoKHRlc3QxICYmICF0ZXN0MikgfHwgKHRlc3QxICYmIGZpbHRlcm91dCA9PSBcIlwiKSkgJiZcbiAgICAgICAgICAgICAgICB3b3JkLmxlbmd0aCA8PSBtYXhMZW5ndGggJiZcbiAgICAgICAgICAgICAgICB3b3JkLmxlbmd0aCA+PSBtaW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJlZFdvcmRzLnB1c2god29yZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZpbHRlcmVkV29yZHM7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBhcHBseShzZXQpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCBsYW5ndWFnZSA9ICQoXCIjd29yZEZpbHRlclBvcHVwIC5sYW5ndWFnZUlucHV0XCIpLnZhbCgpO1xuICAgICAgICBjb25zdCBmaWx0ZXJlZFdvcmRzID0geWllbGQgZmlsdGVyKGxhbmd1YWdlKTtcbiAgICAgICAgY29uc3QgY3VzdG9tVGV4dCA9IGZpbHRlcmVkV29yZHMuam9pbihDdXN0b21UZXh0LmRlbGltaXRlcik7XG4gICAgICAgICQoXCIjY3VzdG9tVGV4dFBvcHVwIHRleHRhcmVhXCIpLnZhbCgoXywgdmFsKSA9PiAoc2V0ID8gXCJcIiA6IHZhbCArIFwiIFwiKSArIGN1c3RvbVRleHQpO1xuICAgICAgICBoaWRlKCk7XG4gICAgfSk7XG59XG4kKFwiI3dvcmRGaWx0ZXJQb3B1cFdyYXBwZXJcIikubW91c2Vkb3duKChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJ3b3JkRmlsdGVyUG9wdXBXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuJChcIiN3b3JkRmlsdGVyUG9wdXAgLmxhbmd1YWdlSW5wdXRcIikub25lKFwic2VsZWN0MjpvcGVuXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAkKFwiaW5wdXQuc2VsZWN0Mi1zZWFyY2hfX2ZpZWxkXCIpLnByb3AoXCJwbGFjZWhvbGRlclwiLCBcInNlYXJjaFwiKTtcbn0pO1xuJChcIiN3b3JkRmlsdGVyUG9wdXBXcmFwcGVyIC5idXR0b25cIikubW91c2Vkb3duKChlKSA9PiB7XG4gICAgJChcIiN3b3JkRmlsdGVyUG9wdXBXcmFwcGVyIC5sb2FkaW5nSW5kaWNhdG9yXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICQoXCIjd29yZEZpbHRlclBvcHVwV3JhcHBlciAuYnV0dG9uXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBhcHBseSgkKGUudGFyZ2V0KS5pcyhcIiNzZXRcIikpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgJChcIiN3b3JkRmlsdGVyUG9wdXBXcmFwcGVyIC5sb2FkaW5nSW5kaWNhdG9yXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIiN3b3JkRmlsdGVyUG9wdXBXcmFwcGVyIC5idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH0sIDEpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgTWFudWFsUmVzdGFydCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0L21hbnVhbC1yZXN0YXJ0LXRyYWNrZXJcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3V0aWxzL21pc2NcIikpO1xuY29uc3QgVmVyaWZpY2F0aW9uQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jb250cm9sbGVycy92ZXJpZmljYXRpb24tY29udHJvbGxlclwiKSk7XG5jb25zdCBSb3V0ZUNvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY29udHJvbGxlcnMvcm91dGUtY29udHJvbGxlclwiKSk7XG5jb25zdCBQYWdlQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jb250cm9sbGVycy9wYWdlLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgTW9ua2V5UG93ZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vZWxlbWVudHMvbW9ua2V5LXBvd2VyXCIpKTtcbmNvbnN0IE5ld1ZlcnNpb25Ob3RpZmljYXRpb24gPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vZWxlbWVudHMvdmVyc2lvbi1jaGVja1wiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgRm9jdXMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC9mb2N1c1wiKSk7XG5NYW51YWxSZXN0YXJ0LnNldCgpO1xuVXBkYXRlQ29uZmlnLmxvYWRGcm9tTG9jYWxTdG9yYWdlKCk7XG5pZiAod2luZG93LmxvY2F0aW9uLmhvc3RuYW1lID09PSBcImxvY2FsaG9zdFwiKSB7XG4gICAgJChcIiNib3R0b20gLnZlcnNpb24gLnRleHRcIikudGV4dChcImxvY2FsaG9zdFwiKTtcbiAgICAkKFwiI2JvdHRvbSAudmVyc2lvblwiKS5jc3MoXCJvcGFjaXR5XCIsIDEpO1xufVxuZWxzZSB7XG4gICAgTWlzYy5nZXRSZWxlYXNlc0Zyb21HaXRIdWIoKS50aGVuKCh2KSA9PiB7XG4gICAgICAgIE5ld1ZlcnNpb25Ob3RpZmljYXRpb24uc2hvdyh2WzBdLm5hbWUpO1xuICAgIH0pO1xufVxuRm9jdXMuc2V0KHRydWUsIHRydWUpO1xuUm91dGVDb250cm9sbGVyLmhhbmRsZUluaXRpYWxQYWdlQ2xhc3Nlcyh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUpO1xuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuICAgIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09IFwiL1wiKSB7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWdcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgICQoXCJib2R5XCIpLmNzcyhcInRyYW5zaXRpb25cIiwgXCJhbGwgLjI1cywgdHJhbnNmb3JtIC4wNXNcIik7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucXVpY2tUYWIpIHtcbiAgICAgICAgJChcIiNyZXN0YXJ0VGVzdEJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgaWYgKCF3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJtZXJjaGJhbm5lcmNsb3NlZFwiKSkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZEJhbm5lcihgQ2hlY2tvdXQgb3VyIG1lcmNoYW5kaXNlLCBhdmFpbGFibGUgYXQgPGEgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj1cImh0dHBzOi8vbW9ua2V5dHlwZS5zdG9yZS9cIj5tb25rZXl0eXBlLnN0b3JlPC9hPmAsIDEsIFwiaW1hZ2VzL21lcmNoZHJvcHdlYnNpdGUyLnBuZ1wiLCBmYWxzZSwgKCkgPT4ge1xuICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwibWVyY2hiYW5uZXJjbG9zZWRcIiwgXCJ0cnVlXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgJChcIiNjZW50ZXJDb250ZW50XCIpXG4gICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIFwiMFwiKVxuICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDI1MCwgKCkgPT4ge1xuICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09PSBcIi92ZXJpZnlcIikge1xuICAgICAgICAgICAgY29uc3QgZnJhZ21lbnQgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5oYXNoLnNsaWNlKDEpKTtcbiAgICAgICAgICAgIGlmIChmcmFnbWVudC5oYXMoXCJhY2Nlc3NfdG9rZW5cIikpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IGZyYWdtZW50LmdldChcImFjY2Vzc190b2tlblwiKTtcbiAgICAgICAgICAgICAgICBjb25zdCB0b2tlblR5cGUgPSBmcmFnbWVudC5nZXQoXCJ0b2tlbl90eXBlXCIpO1xuICAgICAgICAgICAgICAgIFZlcmlmaWNhdGlvbkNvbnRyb2xsZXIuc2V0KHtcbiAgICAgICAgICAgICAgICAgICAgYWNjZXNzVG9rZW46IGFjY2Vzc1Rva2VuLFxuICAgICAgICAgICAgICAgICAgICB0b2tlblR5cGU6IHRva2VuVHlwZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZShcIi9cIiwgXCJcIiwgXCIvXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcGFnZSA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5yZXBsYWNlKFwiL1wiLCBcIlwiKTtcbiAgICAgICAgICAgIFBhZ2VDb250cm9sbGVyLmNoYW5nZShwYWdlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09IFwiL2FjY291bnRcIikge1xuICAgICAgICAgICAgLy8gaGlzdG9yeS5yZXBsYWNlU3RhdGUoXCIvXCIsIG51bGwsIFwiL1wiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICgvY2hhbGxlbmdlXy4rL2cudGVzdCh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUpKSB7XG4gICAgICAgICAgICAvL2RvIG5vdGhpbmdcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgIT09IFwiL1wiKSB7XG4gICAgICAgICAgICAvLyBsZXQgcGFnZSA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5yZXBsYWNlKFwiL1wiLCBcIlwiKTtcbiAgICAgICAgICAgIC8vIFBhZ2VDb250cm9sbGVyLmNoYW5nZShwYWdlKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIC8vIFNldHRpbmdzLnNldHRpbmdzRmlsbFByb21pc2UudGhlbihTZXR0aW5ncy51cGRhdGUpO1xuICAgIE1vbmtleVBvd2VyLmluaXQoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNsYXNzIFNldHRpbmdzR3JvdXAge1xuICAgIGNvbnN0cnVjdG9yKGNvbmZpZ05hbWUsIGNvbmZpZ0Z1bmN0aW9uLCBtb2RlLCBzZXRDYWxsYmFjaywgdXBkYXRlQ2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5jb25maWdOYW1lID0gY29uZmlnTmFtZTtcbiAgICAgICAgdGhpcy5jb25maWdWYWx1ZSA9IGNvbmZpZ18xLmRlZmF1bHRbY29uZmlnTmFtZV07XG4gICAgICAgIHRoaXMubW9kZSA9IG1vZGU7XG4gICAgICAgIHRoaXMuY29uZmlnRnVuY3Rpb24gPSBjb25maWdGdW5jdGlvbjtcbiAgICAgICAgdGhpcy5zZXRDYWxsYmFjayA9IHNldENhbGxiYWNrO1xuICAgICAgICB0aGlzLnVwZGF0ZUNhbGxiYWNrID0gdXBkYXRlQ2FsbGJhY2s7XG4gICAgICAgIHRoaXMudXBkYXRlSW5wdXQoKTtcbiAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gXCJzZWxlY3RcIikge1xuICAgICAgICAgICAgJChkb2N1bWVudCkub24oXCJjaGFuZ2VcIiwgYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uJHt0aGlzLmNvbmZpZ05hbWV9IHNlbGVjdGAsIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuaGFzQ2xhc3MoXCJkaXNhYmxlZFwiKSB8fFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXQuaGFzQ2xhc3MoXCJuby1hdXRvLWhhbmRsZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuc2V0VmFsdWUodGFyZ2V0LnZhbCgpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMubW9kZSA9PT0gXCJidXR0b25cIikge1xuICAgICAgICAgICAgJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi4ke3RoaXMuY29uZmlnTmFtZX0gLmJ1dHRvbmAsIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuaGFzQ2xhc3MoXCJkaXNhYmxlZFwiKSB8fFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXQuaGFzQ2xhc3MoXCJuby1hdXRvLWhhbmRsZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IHRhcmdldC5hdHRyKGNvbmZpZ05hbWUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHRhcmdldC5hdHRyKFwicGFyYW1zXCIpO1xuICAgICAgICAgICAgICAgIGlmICghdmFsdWUgJiYgIXBhcmFtcylcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gXCJ0cnVlXCIpXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IFwiZmFsc2VcIilcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlKHZhbHVlLCBwYXJhbXMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0VmFsdWUodmFsdWUsIHBhcmFtcykge1xuICAgICAgICBpZiAocGFyYW1zID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY29uZmlnRnVuY3Rpb24odmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jb25maWdGdW5jdGlvbih2YWx1ZSwgLi4ucGFyYW1zKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnVwZGF0ZUlucHV0KCk7XG4gICAgICAgIGlmICh0aGlzLnNldENhbGxiYWNrKVxuICAgICAgICAgICAgdGhpcy5zZXRDYWxsYmFjaygpO1xuICAgIH1cbiAgICB1cGRhdGVJbnB1dCgpIHtcbiAgICAgICAgdGhpcy5jb25maWdWYWx1ZSA9IGNvbmZpZ18xLmRlZmF1bHRbdGhpcy5jb25maWdOYW1lXTtcbiAgICAgICAgJChgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi4ke3RoaXMuY29uZmlnTmFtZX0gLmJ1dHRvbmApLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICBpZiAodGhpcy5tb2RlID09PSBcInNlbGVjdFwiKSB7XG4gICAgICAgICAgICAkKGAucGFnZVNldHRpbmdzIC5zZWN0aW9uLiR7dGhpcy5jb25maWdOYW1lfSBzZWxlY3RgKVxuICAgICAgICAgICAgICAgIC52YWwodGhpcy5jb25maWdWYWx1ZSlcbiAgICAgICAgICAgICAgICAudHJpZ2dlcihcImNoYW5nZS5zZWxlY3QyXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMubW9kZSA9PT0gXCJidXR0b25cIikge1xuICAgICAgICAgICAgJChgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi4ke3RoaXMuY29uZmlnTmFtZX0gLmJ1dHRvblske3RoaXMuY29uZmlnTmFtZX09JyR7dGhpcy5jb25maWdWYWx1ZX0nXWApLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnVwZGF0ZUNhbGxiYWNrKVxuICAgICAgICAgICAgdGhpcy51cGRhdGVDYWxsYmFjaygpO1xuICAgIH1cbn1cbmV4cG9ydHMuZGVmYXVsdCA9IFNldHRpbmdzR3JvdXA7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZUFjdGl2ZVRhYiA9IGV4cG9ydHMuc2F2ZUN1c3RvbVRoZW1lQ29sb3JzID0gZXhwb3J0cy5zZXRDdXN0b21JbnB1dHMgPSBleHBvcnRzLnJlZnJlc2hCdXR0b25zID0gZXhwb3J0cy51cGRhdGVBY3RpdmVCdXR0b24gPSB2b2lkIDA7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBUaGVtZUNvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL3RoZW1lLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IFRoZW1lQ29sb3JzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy90aGVtZS1jb2xvcnNcIikpO1xuY29uc3QgQ2hhcnRDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9jaGFydC1jb250cm9sbGVyXCIpKTtcbmNvbnN0IEN1c3RvbVRoZW1lUG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BvcHVwcy9jdXN0b20tdGhlbWUtcG9wdXBcIikpO1xuY29uc3QgTG9hZGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sb2FkZXJcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuLi9maXJlYmFzZVwiKTtcbmZ1bmN0aW9uIHVwZGF0ZUFjdGl2ZUJ1dHRvbigpIHtcbiAgICBsZXQgYWN0aXZlVGhlbWVOYW1lID0gY29uZmlnXzEuZGVmYXVsdC50aGVtZTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5yYW5kb21UaGVtZSAhPT0gXCJvZmZcIiAmJlxuICAgICAgICBjb25maWdfMS5kZWZhdWx0LnJhbmRvbVRoZW1lICE9PSBcImN1c3RvbVwiICYmXG4gICAgICAgIFRoZW1lQ29udHJvbGxlci5yYW5kb21UaGVtZSAhPT0gbnVsbCkge1xuICAgICAgICBhY3RpdmVUaGVtZU5hbWUgPSBUaGVtZUNvbnRyb2xsZXIucmFuZG9tVGhlbWU7XG4gICAgfVxuICAgICQoYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC50aGVtZWApLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICQoYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC50aGVtZVt0aGVtZT0ke2FjdGl2ZVRoZW1lTmFtZX1dYCkuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG59XG5leHBvcnRzLnVwZGF0ZUFjdGl2ZUJ1dHRvbiA9IHVwZGF0ZUFjdGl2ZUJ1dHRvbjtcbmZ1bmN0aW9uIHVwZGF0ZUNvbG9ycyhjb2xvclBpY2tlciwgY29sb3IsIG9ubHlTdHlsZSA9IGZhbHNlLCBub1RoZW1lVXBkYXRlID0gZmFsc2UpIHtcbiAgICBpZiAob25seVN0eWxlKSB7XG4gICAgICAgIGNvbnN0IGNvbG9ySUQgPSBjb2xvclBpY2tlci5maW5kKFwiaW5wdXRbdHlwZT1jb2xvcl1cIikuYXR0cihcImlkXCIpO1xuICAgICAgICBpZiAoY29sb3JJRCA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkNvdWxkIG5vdCBmaW5kIGNvbG9yIElEIVwiKTtcbiAgICAgICAgaWYgKCFub1RoZW1lVXBkYXRlICYmIGNvbG9ySUQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KGNvbG9ySUQsIGNvbG9yKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwaWNrZXJCdXR0b24gPSBjb2xvclBpY2tlci5maW5kKFwibGFiZWxcIik7XG4gICAgICAgIHBpY2tlckJ1dHRvbi52YWwoY29sb3IpO1xuICAgICAgICBwaWNrZXJCdXR0b24uYXR0cihcInZhbHVlXCIsIGNvbG9yKTtcbiAgICAgICAgaWYgKHBpY2tlckJ1dHRvbi5hdHRyKFwiZm9yXCIpICE9PSBcIi0tYmctY29sb3JcIikge1xuICAgICAgICAgICAgcGlja2VyQnV0dG9uLmNzcyhcImJhY2tncm91bmQtY29sb3JcIiwgY29sb3IpO1xuICAgICAgICB9XG4gICAgICAgIGNvbG9yUGlja2VyLmZpbmQoXCJpbnB1dFt0eXBlPXRleHRdXCIpLnZhbChjb2xvcik7XG4gICAgICAgIGNvbG9yUGlja2VyLmZpbmQoXCJpbnB1dFt0eXBlPWNvbG9yXVwiKS5hdHRyKFwidmFsdWVcIiwgY29sb3IpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGNvbG9yUkVHRVggPSBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIHJ1bGU6IC9cXGJbMC05XXsxLDN9LFxccz9bMC05XXsxLDN9LFxccz9bMC05XXsxLDN9XFxzKlxcYi8sXG4gICAgICAgICAgICBzdGFydDogXCJyZ2IoXCIsXG4gICAgICAgICAgICBlbmQ6IFwiKVwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBydWxlOiAvXFxiW0EtWiwgYS16LCAwLTldezZ9XFxiLyxcbiAgICAgICAgICAgIHN0YXJ0OiBcIiNcIixcbiAgICAgICAgICAgIGVuZDogXCJcIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgcnVsZTogL1xcYlswLTldezEsM30sXFxzP1swLTldezEsM30lLFxccz9bMC05XXsxLDN9JT9cXHMqXFxiLyxcbiAgICAgICAgICAgIHN0YXJ0OiBcImhzbChcIixcbiAgICAgICAgICAgIGVuZDogXCIpXCIsXG4gICAgICAgIH0sXG4gICAgXTtcbiAgICBjb2xvciA9IGNvbG9yLnJlcGxhY2UoXCLCsFwiLCBcIlwiKTtcbiAgICBmb3IgKGNvbnN0IHJlZ2V4IG9mIGNvbG9yUkVHRVgpIHtcbiAgICAgICAgaWYgKGNvbG9yLm1hdGNoKHJlZ2V4LnJ1bGUpKSB7XG4gICAgICAgICAgICBjb2xvciA9IHJlZ2V4LnN0YXJ0ICsgY29sb3IgKyByZWdleC5lbmQ7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICAkKFwiLmNvbG9yQ29udmVydGVyXCIpLmNzcyhcImNvbG9yXCIsIGNvbG9yKTtcbiAgICBjb25zdCBoZXhDb2xvciA9IE1pc2MuY29udmVydFJHQnRvSEVYKCQoXCIuY29sb3JDb252ZXJ0ZXJcIikuY3NzKFwiY29sb3JcIikpO1xuICAgIGlmIChoZXhDb2xvciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29sb3IgPSBoZXhDb2xvcjtcbiAgICBjb25zdCBjb2xvcklEID0gY29sb3JQaWNrZXIuZmluZChcImlucHV0W3R5cGU9Y29sb3JdXCIpLmF0dHIoXCJpZFwiKTtcbiAgICBpZiAoY29sb3JJRCA9PT0gdW5kZWZpbmVkKVxuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ291bGQgbm90IGZpbmQgY29sb3IgSUQhXCIpO1xuICAgIGlmICghbm9UaGVtZVVwZGF0ZSAmJiBjb2xvcklEICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KGNvbG9ySUQsIGNvbG9yKTtcbiAgICB9XG4gICAgY29uc3QgcGlja2VyQnV0dG9uID0gY29sb3JQaWNrZXIuZmluZChcImxhYmVsXCIpO1xuICAgIHBpY2tlckJ1dHRvbi52YWwoY29sb3IpO1xuICAgIHBpY2tlckJ1dHRvbi5hdHRyKFwidmFsdWVcIiwgY29sb3IpO1xuICAgIGlmIChwaWNrZXJCdXR0b24uYXR0cihcImZvclwiKSAhPT0gXCItLWJnLWNvbG9yXCIpIHtcbiAgICAgICAgcGlja2VyQnV0dG9uLmNzcyhcImJhY2tncm91bmQtY29sb3JcIiwgY29sb3IpO1xuICAgIH1cbiAgICBjb2xvclBpY2tlci5maW5kKFwiaW5wdXRbdHlwZT10ZXh0XVwiKS52YWwoY29sb3IpO1xuICAgIGNvbG9yUGlja2VyLmZpbmQoXCJpbnB1dFt0eXBlPWNvbG9yXVwiKS5hdHRyKFwidmFsdWVcIiwgY29sb3IpO1xufVxuZnVuY3Rpb24gcmVmcmVzaEJ1dHRvbnMoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tVGhlbWUpIHtcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBjdXN0b20gdGhlbWUgYnV0dG9uc1xuICAgICAgICAgICAgY29uc3QgY3VzdG9tVGhlbWVzRWwgPSAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLmFsbEN1c3RvbVRoZW1lcy5idXR0b25zXCIpLmVtcHR5KCk7XG4gICAgICAgICAgICBjb25zdCBhZGRCdXR0b24gPSAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLmFkZEN1c3RvbVRoZW1lQnV0dG9uXCIpO1xuICAgICAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAuY3VzdG9tVGhlbWVFZGl0IC5zYXZlQ3VzdG9tVGhlbWVCdXR0b25cIikudGV4dChcInNhdmVcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC5jdXN0b21UaGVtZUVkaXQgLnNhdmVDdXN0b21UaGVtZUJ1dHRvblwiKS50ZXh0KFwic2F2ZSBhcyBuZXdcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhZGRCdXR0b24ucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICBjb25zdCBjdXN0b21UaGVtZXMgPSBEQi5nZXRTbmFwc2hvdCgpLmN1c3RvbVRoZW1lcztcbiAgICAgICAgICAgIGN1c3RvbVRoZW1lcy5mb3JFYWNoKChjdXN0b21UaGVtZSkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIGNvbnN0IGFjdGl2ZVRoZW1lID1cbiAgICAgICAgICAgICAgICAvLyAgIENvbmZpZy5jdXN0b21UaGVtZUlkID09PSBjdXN0b21UaGVtZS5faWQgPyBcImFjdGl2ZVwiIDogXCJcIjtcbiAgICAgICAgICAgICAgICBjb25zdCBiZ0NvbG9yID0gY3VzdG9tVGhlbWUuY29sb3JzWzBdO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1haW5Db2xvciA9IGN1c3RvbVRoZW1lLmNvbG9yc1sxXTtcbiAgICAgICAgICAgICAgICBjdXN0b21UaGVtZXNFbC5hcHBlbmQoYDxkaXYgY2xhc3M9XCJjdXN0b21UaGVtZSBidXR0b25cIiBjdXN0b21UaGVtZUlkPScke2N1c3RvbVRoZW1lLl9pZH0nIFxuICAgICAgICBzdHlsZT1cImNvbG9yOiR7bWFpbkNvbG9yfTtiYWNrZ3JvdW5kOiR7YmdDb2xvcn1cIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImVkaXRCdXR0b25cIj48aSBjbGFzcz1cImZhcyBmYS1wZW5cIj48L2k+PC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJ0ZXh0XCI+JHtjdXN0b21UaGVtZS5uYW1lLnJlcGxhY2UoL18vZywgXCIgXCIpfTwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiZGVsQnV0dG9uXCI+PGkgY2xhc3M9XCJmYXMgZmEtdHJhc2ggZmEtZndcIj48L2k+PC9kaXY+XG4gICAgICAgIDwvZGl2PmApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlbWUgYnV0dG9uc1xuICAgICAgICAgICAgY29uc3QgZmF2VGhlbWVzRWwgPSAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLmZhdlRoZW1lcy5idXR0b25zXCIpLmVtcHR5KCk7XG4gICAgICAgICAgICBjb25zdCB0aGVtZXNFbCA9ICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAuYWxsVGhlbWVzLmJ1dHRvbnNcIikuZW1wdHkoKTtcbiAgICAgICAgICAgIGxldCBhY3RpdmVUaGVtZU5hbWUgPSBjb25maWdfMS5kZWZhdWx0LnRoZW1lO1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucmFuZG9tVGhlbWUgIT09IFwib2ZmXCIgJiZcbiAgICAgICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0LnJhbmRvbVRoZW1lICE9PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICAgICAgVGhlbWVDb250cm9sbGVyLnJhbmRvbVRoZW1lICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgYWN0aXZlVGhlbWVOYW1lID0gVGhlbWVDb250cm9sbGVyLnJhbmRvbVRoZW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgdGhlbWVzID0geWllbGQgTWlzYy5nZXRTb3J0ZWRUaGVtZXNMaXN0KCk7XG4gICAgICAgICAgICAvL2ZpcnN0IHNob3cgZmF2b3VyaXRlc1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZmF2VGhlbWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBmYXZUaGVtZXNFbC5jc3MoeyBwYWRkaW5nQm90dG9tOiBcIjFyZW1cIiB9KTtcbiAgICAgICAgICAgICAgICB0aGVtZXMuZm9yRWFjaCgodGhlbWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZmF2VGhlbWVzLmluY2x1ZGVzKHRoZW1lLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmVUaGVtZSA9IGFjdGl2ZVRoZW1lTmFtZSA9PT0gdGhlbWUubmFtZSA/IFwiYWN0aXZlXCIgOiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmF2VGhlbWVzRWwuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGhlbWUgYnV0dG9uICR7YWN0aXZlVGhlbWV9XCIgdGhlbWU9JyR7dGhlbWUubmFtZX0nIFxuICAgICAgICAgICAgc3R5bGU9XCJjb2xvcjoke3RoZW1lLm1haW5Db2xvcn07YmFja2dyb3VuZDoke3RoZW1lLmJnQ29sb3J9XCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYWN0aXZlSW5kaWNhdG9yXCI+PGkgY2xhc3M9XCJmYXMgZmEtY2lyY2xlXCI+PC9pPjwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRleHRcIj4ke3RoZW1lLm5hbWUucmVwbGFjZSgvXy9nLCBcIiBcIil9PC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZmF2QnV0dG9uIGFjdGl2ZVwiPjxpIGNsYXNzPVwiZmFzIGZhLXN0YXJcIj48L2k+PC9kaXY+PC9kaXY+YCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGZhdlRoZW1lc0VsLmNzcyh7IHBhZGRpbmdCb3R0b206IFwiMFwiIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy90aGVuIHRoZSByZXN0XG4gICAgICAgICAgICB0aGVtZXMuZm9yRWFjaCgodGhlbWUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mYXZUaGVtZXMuaW5jbHVkZXModGhlbWUubmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmVUaGVtZSA9IGFjdGl2ZVRoZW1lTmFtZSA9PT0gdGhlbWUubmFtZSA/IFwiYWN0aXZlXCIgOiBcIlwiO1xuICAgICAgICAgICAgICAgIHRoZW1lc0VsLmFwcGVuZChgPGRpdiBjbGFzcz1cInRoZW1lIGJ1dHRvbiAke2FjdGl2ZVRoZW1lfVwiIHRoZW1lPScke3RoZW1lLm5hbWV9JyBzdHlsZT1cImNvbG9yOiR7dGhlbWUubWFpbkNvbG9yfTtiYWNrZ3JvdW5kOiR7dGhlbWUuYmdDb2xvcn1cIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImFjdGl2ZUluZGljYXRvclwiPjxpIGNsYXNzPVwiZmFzIGZhLWNpcmNsZVwiPjwvaT48L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInRleHRcIj4ke3RoZW1lLm5hbWUucmVwbGFjZSgvXy9nLCBcIiBcIil9PC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJmYXZCdXR0b25cIj48aSBjbGFzcz1cImZhciBmYS1zdGFyXCI+PC9pPjwvZGl2PjwvZGl2PmApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdXBkYXRlQWN0aXZlQnV0dG9uKCk7XG4gICAgfSk7XG59XG5leHBvcnRzLnJlZnJlc2hCdXR0b25zID0gcmVmcmVzaEJ1dHRvbnM7XG5mdW5jdGlvbiBzZXRDdXN0b21JbnB1dHMobm9UaGVtZVVwZGF0ZSA9IGZhbHNlKSB7XG4gICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC50YWJDb250YWluZXIgLmN1c3RvbVRoZW1lIC5jb2xvclBpY2tlclwiKS5lYWNoKChfaW5kZXgsIGVsZW1lbnQpID0+IHtcbiAgICAgICAgY29uc3QgY3VycmVudENvbG9yID0gY29uZmlnXzEuZGVmYXVsdC5jdXN0b21UaGVtZUNvbG9yc1tUaGVtZUNvbnRyb2xsZXIuY29sb3JWYXJzLmluZGV4T2YoJChlbGVtZW50KS5maW5kKFwiaW5wdXRbdHlwZT1jb2xvcl1cIikuYXR0cihcImlkXCIpKV07XG4gICAgICAgIHVwZGF0ZUNvbG9ycygkKGVsZW1lbnQpLCBjdXJyZW50Q29sb3IsIGZhbHNlLCBub1RoZW1lVXBkYXRlKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc2V0Q3VzdG9tSW5wdXRzID0gc2V0Q3VzdG9tSW5wdXRzO1xuZnVuY3Rpb24gdG9nZ2xlRmF2b3VyaXRlKHRoZW1lTmFtZSkge1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZhdlRoZW1lcy5pbmNsdWRlcyh0aGVtZU5hbWUpKSB7XG4gICAgICAgIC8vIGFscmVhZHkgZmF2b3VyaXRlLCByZW1vdmVcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZhdlRoZW1lcyhjb25maWdfMS5kZWZhdWx0LmZhdlRoZW1lcy5maWx0ZXIoKHQpID0+IHQgIT09IHRoZW1lTmFtZSkpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gYWRkIHRvIGZhdm91cml0ZXNcbiAgICAgICAgY29uc3QgbmV3TGlzdCA9IGNvbmZpZ18xLmRlZmF1bHQuZmF2VGhlbWVzO1xuICAgICAgICBuZXdMaXN0LnB1c2godGhlbWVOYW1lKTtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZhdlRoZW1lcyhuZXdMaXN0KTtcbiAgICB9XG4gICAgVXBkYXRlQ29uZmlnLnNhdmVGdWxsQ29uZmlnVG9Mb2NhbFN0b3JhZ2UoKTtcbn1cbmZ1bmN0aW9uIHNhdmVDdXN0b21UaGVtZUNvbG9ycygpIHtcbiAgICBjb25zdCBuZXdDb2xvcnMgPSBbXTtcbiAgICAkLmVhY2goJChcIi5wYWdlU2V0dGluZ3MgLmN1c3RvbVRoZW1lIC5jdXN0b21UaGVtZUVkaXQgW3R5cGU9J2NvbG9yJ11cIiksIChfaW5kZXgsIGVsZW1lbnQpID0+IHtcbiAgICAgICAgbmV3Q29sb3JzLnB1c2goJChlbGVtZW50KS5hdHRyKFwidmFsdWVcIikpO1xuICAgIH0pO1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZUNvbG9ycyhuZXdDb2xvcnMpO1xuICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ3VzdG9tIHRoZW1lIHNhdmVkXCIsIDEpO1xufVxuZXhwb3J0cy5zYXZlQ3VzdG9tVGhlbWVDb2xvcnMgPSBzYXZlQ3VzdG9tVGhlbWVDb2xvcnM7XG5mdW5jdGlvbiB1cGRhdGVBY3RpdmVUYWIoZm9yY2VkID0gZmFsc2UpIHtcbiAgICAvLyBTZXQgZm9yY2UgdG8gdHJ1ZSBvbmx5IHdoZW4gc29tZSBjaGFuZ2UgZm9yIHRoZSBhY3RpdmUgdGFiIGhhcyB0YWtlbiBwbGFjZVxuICAgIC8vIFByZXZlbnQgdGhlbWUgYnV0dG9ucyBmcm9tIGJlaW5nIGFkZGVkIHR3aWNlIGJ5IGRvaW5nIGFuIHVwZGF0ZSBvbmx5IHdoZW4gdGhlIHN0YXRlIGhhcyBjaGFuZ2VkXG4gICAgY29uc3QgJHByZXNldFRhYkJ1dHRvbiA9ICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAudGFicyAuYnV0dG9uW3RhYj0ncHJlc2V0J11cIik7XG4gICAgY29uc3QgJGN1c3RvbVRhYkJ1dHRvbiA9ICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAudGFicyAuYnV0dG9uW3RhYj0nY3VzdG9tJ11cIik7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tVGhlbWUpIHtcbiAgICAgICAgJHByZXNldFRhYkJ1dHRvbi5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgaWYgKCEkY3VzdG9tVGFiQnV0dG9uLmhhc0NsYXNzKFwiYWN0aXZlXCIpIHx8IGZvcmNlZCkge1xuICAgICAgICAgICAgJGN1c3RvbVRhYkJ1dHRvbi5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgIHJlZnJlc2hCdXR0b25zKCk7XG4gICAgICAgIH1cbiAgICAgICAgTWlzYy5zd2FwRWxlbWVudHMoJCgnLnBhZ2VTZXR0aW5ncyBbdGFiQ29udGVudD1cInByZXNldFwiXScpLCAkKCcucGFnZVNldHRpbmdzIFt0YWJDb250ZW50PVwiY3VzdG9tXCJdJyksIDI1MCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkY3VzdG9tVGFiQnV0dG9uLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICBpZiAoISRwcmVzZXRUYWJCdXR0b24uaGFzQ2xhc3MoXCJhY3RpdmVcIikgfHwgZm9yY2VkKSB7XG4gICAgICAgICAgICAkcHJlc2V0VGFiQnV0dG9uLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgcmVmcmVzaEJ1dHRvbnMoKTtcbiAgICAgICAgfVxuICAgICAgICBNaXNjLnN3YXBFbGVtZW50cygkKCcucGFnZVNldHRpbmdzIFt0YWJDb250ZW50PVwiY3VzdG9tXCJdJyksICQoJy5wYWdlU2V0dGluZ3MgW3RhYkNvbnRlbnQ9XCJwcmVzZXRcIl0nKSwgMjUwKTtcbiAgICB9XG59XG5leHBvcnRzLnVwZGF0ZUFjdGl2ZVRhYiA9IHVwZGF0ZUFjdGl2ZVRhYjtcbi8vIEFkZCBldmVudHMgdG8gdGhlIERPTVxuLy8gSGFuZGxlIGNsaWNrIG9uIHRoZW1lOiBwcmVzZXQgb3IgY3VzdG9tIHRhYlxuJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC50YWJzIC5idXR0b25cIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAudGFicyAuYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgIGNvbnN0ICR0YXJnZXQgPSAkKGUuY3VycmVudFRhcmdldCk7XG4gICAgJHRhcmdldC5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAvLyBzZXRDdXN0b21JbnB1dHMoKTtcbiAgICBpZiAoJHRhcmdldC5hdHRyKFwidGFiXCIpID09IFwicHJlc2V0XCIpIHtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lKGZhbHNlKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZSh0cnVlKTtcbiAgICB9XG59KTtcbi8vIEhhbmRsZSBjbGljayBvbiBjdXN0b20gdGhlbWUgYnV0dG9uXG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLmN1c3RvbVRoZW1lLmJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICAvLyBEbyBub3QgYXBwbHkgaWYgdXNlciB3YW50ZWQgdG8gZGVsZXRlIGl0XG4gICAgaWYgKCQoZS50YXJnZXQpLmhhc0NsYXNzKFwiZGVsQnV0dG9uXCIpKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKCQoZS50YXJnZXQpLmhhc0NsYXNzKFwiZWRpdEJ1dHRvblwiKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IGN1c3RvbVRoZW1lSWQgPSAoX2EgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcImN1c3RvbVRoZW1lSWRcIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiXCI7XG4gICAgVGhlbWVDb250cm9sbGVyLnNldChjdXN0b21UaGVtZUlkLCB0cnVlKTtcbn0pO1xuLy8gSGFuZGxlIGNsaWNrIG9uIGZhdm9yaXRlIHByZXNldCB0aGVtZSBidXR0b25cbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAudGhlbWUgLmZhdkJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIGNvbnN0IHRoZW1lID0gJChlLmN1cnJlbnRUYXJnZXQpLnBhcmVudHMoXCIudGhlbWUuYnV0dG9uXCIpLmF0dHIoXCJ0aGVtZVwiKTtcbiAgICBpZiAodGhlbWUgIT09IHVuZGVmaW5lZClcbiAgICAgICAgdG9nZ2xlRmF2b3VyaXRlKHRoZW1lKTtcbiAgICBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkNvdWxkIG5vdCBmaW5kIHRoZSB0aGVtZSBhdHRyaWJ1dGUgYXR0YWNoZWQgdG8gdGhlIGJ1dHRvbiBjbGlja2VkIVwiKTtcbiAgICB9XG59KTtcbi8vIEhhbmRsZSBjbGljayBvbiBwcmVzZXQgdGhlbWUgYnV0dG9uXG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLnRoZW1lLmJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIGNvbnN0IHRoZW1lID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJ0aGVtZVwiKTtcbiAgICBpZiAoISQoZS50YXJnZXQpLmhhc0NsYXNzKFwiZmF2QnV0dG9uXCIpICYmIHRoZW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRoZW1lKHRoZW1lKTtcbiAgICAgICAgdXBkYXRlQWN0aXZlQnV0dG9uKCk7XG4gICAgfVxufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLnRhYkNvbnRhaW5lciAuY3VzdG9tVGhlbWUgaW5wdXRbdHlwZT1jb2xvcl1cIikub24oXCJpbnB1dFwiLCAoZSkgPT4ge1xuICAgIGNvbnN0ICRjb2xvclZhciA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiaWRcIik7XG4gICAgY29uc3QgJHBpY2tlZENvbG9yID0gJChlLmN1cnJlbnRUYXJnZXQpLnZhbCgpO1xuICAgIHVwZGF0ZUNvbG9ycygkKFwiLmNvbG9yUGlja2VyICNcIiArICRjb2xvclZhcikucGFyZW50KCksICRwaWNrZWRDb2xvciwgdHJ1ZSk7XG59KTtcbiQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAudGFiQ29udGFpbmVyIC5jdXN0b21UaGVtZSBpbnB1dFt0eXBlPWNvbG9yXVwiKS5vbihcImNoYW5nZVwiLCAoZSkgPT4ge1xuICAgIGNvbnN0ICRjb2xvclZhciA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiaWRcIik7XG4gICAgY29uc3QgJHBpY2tlZENvbG9yID0gJChlLmN1cnJlbnRUYXJnZXQpLnZhbCgpO1xuICAgIHVwZGF0ZUNvbG9ycygkKFwiLmNvbG9yUGlja2VyICNcIiArICRjb2xvclZhcikucGFyZW50KCksICRwaWNrZWRDb2xvcik7XG59KTtcbiQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAudGFiQ29udGFpbmVyIC5jdXN0b21UaGVtZSBpbnB1dFt0eXBlPXRleHRdXCIpXG4gICAgLm9uKFwiYmx1clwiLCAoZSkgPT4ge1xuICAgIGlmIChlLnRhcmdldC5pZCA9PT0gXCJuYW1lXCIpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCAkY29sb3JWYXIgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcImlkXCIpO1xuICAgIGNvbnN0ICRwaWNrZWRDb2xvciA9ICQoZS5jdXJyZW50VGFyZ2V0KS52YWwoKTtcbiAgICB1cGRhdGVDb2xvcnMoJChcIi5jb2xvclBpY2tlciAjXCIgKyAkY29sb3JWYXIpLnBhcmVudCgpLCAkcGlja2VkQ29sb3IpO1xufSlcbiAgICAub24oXCJrZXlwcmVzc1wiLCBmdW5jdGlvbiAoZSkge1xuICAgIGlmIChlLnRhcmdldC5pZCA9PT0gXCJuYW1lXCIpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoZS5jb2RlID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgJCh0aGlzKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgY29uc3QgJGNvbG9yVmFyID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJpZFwiKTtcbiAgICAgICAgY29uc3QgJHBpY2tlZENvbG9yID0gJChlLmN1cnJlbnRUYXJnZXQpLnZhbCgpO1xuICAgICAgICB1cGRhdGVDb2xvcnMoJChcIi5jb2xvclBpY2tlciAjXCIgKyAkY29sb3JWYXIpLnBhcmVudCgpLCAkcGlja2VkQ29sb3IpO1xuICAgICAgICAkKHRoaXMpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKTtcbiAgICB9XG59KTtcbiQoXCIucGFnZVNldHRpbmdzICNsb2FkQ3VzdG9tQ29sb3JzRnJvbVByZXNldFwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICAvLyBwcmV2aWV3VGhlbWUoQ29uZmlnLnRoZW1lKTtcbiAgICAkKFwiI2N1cnJlbnRUaGVtZVwiKS5hdHRyKFwiaHJlZlwiLCBgdGhlbWVzLyR7Y29uZmlnXzEuZGVmYXVsdC50aGVtZX0uY3NzYCk7XG4gICAgVGhlbWVDb250cm9sbGVyLmNvbG9yVmFycy5mb3JFYWNoKChlKSA9PiB7XG4gICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eShlLCBcIlwiKTtcbiAgICB9KTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBDaGFydENvbnRyb2xsZXIudXBkYXRlQWxsQ2hhcnRDb2xvcnMoKTtcbiAgICAgICAgY29uc3QgdGhlbWVDb2xvcnMgPSB5aWVsZCBUaGVtZUNvbG9ycy5nZXRBbGwoKTtcbiAgICAgICAgVGhlbWVDb250cm9sbGVyLmNvbG9yVmFycy5mb3JFYWNoKChjb2xvck5hbWUpID0+IHtcbiAgICAgICAgICAgIGxldCBjb2xvcjtcbiAgICAgICAgICAgIGlmIChjb2xvck5hbWUgPT09IFwiLS1iZy1jb2xvclwiKSB7XG4gICAgICAgICAgICAgICAgY29sb3IgPSB0aGVtZUNvbG9ycy5iZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNvbG9yTmFtZSA9PT0gXCItLW1haW4tY29sb3JcIikge1xuICAgICAgICAgICAgICAgIGNvbG9yID0gdGhlbWVDb2xvcnMubWFpbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNvbG9yTmFtZSA9PT0gXCItLXN1Yi1jb2xvclwiKSB7XG4gICAgICAgICAgICAgICAgY29sb3IgPSB0aGVtZUNvbG9ycy5zdWI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjb2xvck5hbWUgPT09IFwiLS1jYXJldC1jb2xvclwiKSB7XG4gICAgICAgICAgICAgICAgY29sb3IgPSB0aGVtZUNvbG9ycy5jYXJldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNvbG9yTmFtZSA9PT0gXCItLXRleHQtY29sb3JcIikge1xuICAgICAgICAgICAgICAgIGNvbG9yID0gdGhlbWVDb2xvcnMudGV4dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNvbG9yTmFtZSA9PT0gXCItLWVycm9yLWNvbG9yXCIpIHtcbiAgICAgICAgICAgICAgICBjb2xvciA9IHRoZW1lQ29sb3JzLmVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29sb3JOYW1lID09PSBcIi0tZXJyb3ItZXh0cmEtY29sb3JcIikge1xuICAgICAgICAgICAgICAgIGNvbG9yID0gdGhlbWVDb2xvcnMuZXJyb3JFeHRyYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNvbG9yTmFtZSA9PT0gXCItLWNvbG9yZnVsLWVycm9yLWNvbG9yXCIpIHtcbiAgICAgICAgICAgICAgICBjb2xvciA9IHRoZW1lQ29sb3JzLmNvbG9yZnVsRXJyb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjb2xvck5hbWUgPT09IFwiLS1jb2xvcmZ1bC1lcnJvci1leHRyYS1jb2xvclwiKSB7XG4gICAgICAgICAgICAgICAgY29sb3IgPSB0aGVtZUNvbG9ycy5jb2xvcmZ1bEVycm9yRXh0cmE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB1cGRhdGVDb2xvcnMoJChcIi5jb2xvclBpY2tlciAjXCIgKyBjb2xvck5hbWUpLnBhcmVudCgpLCBjb2xvcik7XG4gICAgICAgIH0pO1xuICAgIH0pLCAyNTApO1xufSk7XG4vLyBIYW5kbGVzIGNsaWNrIG9uIHNoYXJlIGN1c3RvbSB0aGVtZSBidXR0b25cbiQoXCIjc2hhcmVDdXN0b21UaGVtZUJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjb25zdCBzaGFyZSA9IFtdO1xuICAgICQuZWFjaCgkKFwiLnBhZ2VTZXR0aW5ncyAuY3VzdG9tVGhlbWUgLmN1c3RvbVRoZW1lRWRpdCBbdHlwZT0nY29sb3InXVwiKSwgKF8sIGVsZW1lbnQpID0+IHtcbiAgICAgICAgc2hhcmUucHVzaCgkKGVsZW1lbnQpLmF0dHIoXCJ2YWx1ZVwiKSk7XG4gICAgfSk7XG4gICAgY29uc3QgdXJsID0gXCJodHRwczovL21vbmtleXR5cGUuY29tP2N1c3RvbVRoZW1lPVwiICsgYnRvYShKU09OLnN0cmluZ2lmeShzaGFyZSkpO1xuICAgIG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KHVybCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiVVJMIENvcGllZCB0byBjbGlwYm9hcmRcIiwgMCk7XG4gICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICBDdXN0b21UaGVtZVBvcHVwLnNob3codXJsKTtcbiAgICB9KTtcbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgLnNhdmVDdXN0b21UaGVtZUJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHNhdmVDdXN0b21UaGVtZUNvbG9ycygpO1xuICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIpIHtcbiAgICAgICAgY29uc3QgbmV3Q3VzdG9tVGhlbWUgPSB7XG4gICAgICAgICAgICBuYW1lOiBcImN1c3RvbVwiLFxuICAgICAgICAgICAgY29sb3JzOiBjb25maWdfMS5kZWZhdWx0LmN1c3RvbVRoZW1lQ29sb3JzLFxuICAgICAgICB9O1xuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIERCLmFkZEN1c3RvbVRoZW1lKG5ld0N1c3RvbVRoZW1lKTtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICB1cGRhdGVBY3RpdmVUYWIodHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHVwZGF0ZUFjdGl2ZVRhYih0cnVlKTtcbiAgICB9XG59KSk7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5KSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImN1c3RvbVRoZW1lSWRcIilcbiAgICAgICAgcmVmcmVzaEJ1dHRvbnMoKTtcbiAgICAvLyBpZiAoZXZlbnRLZXkgPT09IFwiY3VzdG9tVGhlbWVcIikgdXBkYXRlQWN0aXZlVGFiKCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zZXQgPSBleHBvcnRzLmdldCA9IHZvaWQgMDtcbmxldCBhY3RpdmVQYWdlID0gXCJsb2FkaW5nXCI7XG5mdW5jdGlvbiBnZXQoKSB7XG4gICAgcmV0dXJuIGFjdGl2ZVBhZ2U7XG59XG5leHBvcnRzLmdldCA9IGdldDtcbmZ1bmN0aW9uIHNldChhY3RpdmUpIHtcbiAgICBhY3RpdmVQYWdlID0gYWN0aXZlO1xufVxuZXhwb3J0cy5zZXQgPSBzZXQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZW5hYmxlID0gZXhwb3J0cy5nZXQgPSB2b2lkIDA7XG5sZXQgZ2xhcnNlc01vZGUgPSBmYWxzZTtcbmZ1bmN0aW9uIGdldCgpIHtcbiAgICByZXR1cm4gZ2xhcnNlc01vZGU7XG59XG5leHBvcnRzLmdldCA9IGdldDtcbmZ1bmN0aW9uIGVuYWJsZSgpIHtcbiAgICBnbGFyc2VzTW9kZSA9IHRydWU7XG4gICAgY29uc29sZS5sb2coXCJHbGFyc2VzIE1vZGUgT24gLSB0ZXN0IHJlc3VsdCB3aWxsIGJlIGhpZGRlbi4gWW91IGNhbiBjaGVjayB0aGUgc3RhdHMgaW4gdGhlIGNvbnNvbGUgKGhlcmUpXCIpO1xuICAgIGNvbnNvbGUubG9nKFwiVG8gZGlzYWJsZSBHbGFyc2VzIE1vZGUgcmVmcmVzaCB0aGUgcGFnZS5cIik7XG59XG5leHBvcnRzLmVuYWJsZSA9IGVuYWJsZTtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5nZXQgPSBleHBvcnRzLnNldCA9IHZvaWQgMDtcbmxldCB0cmFuc2l0aW9uID0gdHJ1ZTtcbmZ1bmN0aW9uIHNldCh2YWwpIHtcbiAgICB0cmFuc2l0aW9uID0gdmFsO1xufVxuZXhwb3J0cy5zZXQgPSBzZXQ7XG5mdW5jdGlvbiBnZXQoKSB7XG4gICAgcmV0dXJuIHRyYW5zaXRpb247XG59XG5leHBvcnRzLmdldCA9IGdldDtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5nZXQgPSBleHBvcnRzLmNsZWFyID0gZXhwb3J0cy5zZXQgPSB2b2lkIDA7XG5sZXQgc2xvd1RpbWVyID0gZmFsc2U7XG5mdW5jdGlvbiBzZXQoKSB7XG4gICAgaWYgKHNsb3dUaW1lcilcbiAgICAgICAgcmV0dXJuO1xuICAgIHNsb3dUaW1lciA9IHRydWU7XG4gICAgY29uc29sZS5lcnJvcihcIlNsb3cgdGltZXIsIGRpc2FibGluZyBhbmltYXRpb25zXCIpO1xuICAgIC8vIE5vdGlmaWNhdGlvbnMuYWRkKFwiU2xvdyB0aW1lciBkZXRlY3RlZFwiLCAtMSwgNSk7XG59XG5leHBvcnRzLnNldCA9IHNldDtcbmZ1bmN0aW9uIGNsZWFyKCkge1xuICAgIHNsb3dUaW1lciA9IGZhbHNlO1xufVxuZXhwb3J0cy5jbGVhciA9IGNsZWFyO1xuZnVuY3Rpb24gZ2V0KCkge1xuICAgIHJldHVybiBzbG93VGltZXI7XG59XG5leHBvcnRzLmdldCA9IGdldDtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zZXQgPSBleHBvcnRzLmdldCA9IHZvaWQgMDtcbmxldCB0ZXN0QWN0aXZlID0gZmFsc2U7XG5mdW5jdGlvbiBnZXQoKSB7XG4gICAgcmV0dXJuIHRlc3RBY3RpdmU7XG59XG5leHBvcnRzLmdldCA9IGdldDtcbmZ1bmN0aW9uIHNldChhY3RpdmUpIHtcbiAgICB0ZXN0QWN0aXZlID0gYWN0aXZlO1xufVxuZXhwb3J0cy5zZXQgPSBzZXQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaW5jcmVtZW50ID0gZXhwb3J0cy5zZXQgPSBleHBvcnRzLmdldCA9IHZvaWQgMDtcbmxldCB0aW1lID0gMDtcbmZ1bmN0aW9uIGdldCgpIHtcbiAgICByZXR1cm4gdGltZTtcbn1cbmV4cG9ydHMuZ2V0ID0gZ2V0O1xuZnVuY3Rpb24gc2V0KGFjdGl2ZSkge1xuICAgIHRpbWUgPSBhY3RpdmU7XG59XG5leHBvcnRzLnNldCA9IHNldDtcbmZ1bmN0aW9uIGluY3JlbWVudCgpIHtcbiAgICB0aW1lKys7XG59XG5leHBvcnRzLmluY3JlbWVudCA9IGluY3JlbWVudDtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnJlcGxhY2UgPSBleHBvcnRzLmdldExpc3QgPSB2b2lkIDA7XG5jb25zdCBtaXNjXzEgPSByZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKTtcbmxldCBsaXN0ID0gW107XG5mdW5jdGlvbiBnZXRMaXN0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChsaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuICQuZ2V0SlNPTihcImxhbmd1YWdlcy9icml0aXNoZW5nbGlzaC5qc29uXCIsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgbGlzdCA9IGRhdGE7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxpc3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBsaXN0O1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmdldExpc3QgPSBnZXRMaXN0O1xuZnVuY3Rpb24gcmVwbGFjZSh3b3JkKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgbGlzdCA9IHlpZWxkIGdldExpc3QoKTtcbiAgICAgICAgY29uc3QgcmVwbGFjZW1lbnQgPSBsaXN0LmZpbmQoKGEpID0+IHdvcmQubWF0Y2goUmVnRXhwKGBeKFtcXFxcV10qJHthWzBdfVtcXFxcV10qKSRgLCBcImdpXCIpKSk7XG4gICAgICAgIHJldHVybiByZXBsYWNlbWVudFxuICAgICAgICAgICAgPyB3b3JkLnJlcGxhY2UoUmVnRXhwKGBeKD86KFtcXFxcV10qKSgke3JlcGxhY2VtZW50WzBdfSkoW1xcXFxXXSopKSRgLCBcImdpXCIpLCAoXywgJDEsICQyLCAkMykgPT4gJDEgK1xuICAgICAgICAgICAgICAgICgkMi5jaGFyQXQoMCkgPT09ICQyLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpXG4gICAgICAgICAgICAgICAgICAgID8gJDIgPT09ICQyLnRvVXBwZXJDYXNlKClcbiAgICAgICAgICAgICAgICAgICAgICAgID8gcmVwbGFjZW1lbnRbMV0udG9VcHBlckNhc2UoKVxuICAgICAgICAgICAgICAgICAgICAgICAgOiAoMCwgbWlzY18xLmNhcGl0YWxpemVGaXJzdExldHRlck9mRWFjaFdvcmQpKHJlcGxhY2VtZW50WzFdKVxuICAgICAgICAgICAgICAgICAgICA6IHJlcGxhY2VtZW50WzFdKSArXG4gICAgICAgICAgICAgICAgJDMpXG4gICAgICAgICAgICA6IHdvcmQ7XG4gICAgfSk7XG59XG5leHBvcnRzLnJlcGxhY2UgPSByZXBsYWNlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmNhcHNTdGF0ZSA9IHZvaWQgMDtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuZXhwb3J0cy5jYXBzU3RhdGUgPSBmYWxzZTtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgaWYgKCQoXCIjY2Fwc1dhcm5pbmdcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNjYXBzV2FybmluZ1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG59XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmICghJChcIiNjYXBzV2FybmluZ1wiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI2NhcHNXYXJuaW5nXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbn1cbiQoZG9jdW1lbnQpLmtleWRvd24oZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBpZiAoKChfYSA9IGV2ZW50ID09PSBudWxsIHx8IGV2ZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBldmVudC5vcmlnaW5hbEV2ZW50KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZ2V0TW9kaWZpZXJTdGF0ZSkgJiZcbiAgICAgICAgKChfYiA9IGV2ZW50ID09PSBudWxsIHx8IGV2ZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBldmVudC5vcmlnaW5hbEV2ZW50KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZ2V0TW9kaWZpZXJTdGF0ZShcIkNhcHNMb2NrXCIpKSkge1xuICAgICAgICBleHBvcnRzLmNhcHNTdGF0ZSA9IHRydWU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBleHBvcnRzLmNhcHNTdGF0ZSA9IGZhbHNlO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5jYXBzTG9ja1dhcm5pbmcgJiYgZXhwb3J0cy5jYXBzU3RhdGUpIHtcbiAgICAgICAgICAgIHNob3coKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGhpZGUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoX2MpIHsgfVxufSk7XG4kKGRvY3VtZW50KS5rZXl1cChmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGlmICgoKF9hID0gZXZlbnQgPT09IG51bGwgfHwgZXZlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV2ZW50Lm9yaWdpbmFsRXZlbnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZXRNb2RpZmllclN0YXRlKSAmJlxuICAgICAgICAoKF9iID0gZXZlbnQgPT09IG51bGwgfHwgZXZlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV2ZW50Lm9yaWdpbmFsRXZlbnQpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5nZXRNb2RpZmllclN0YXRlKFwiQ2Fwc0xvY2tcIikpKSB7XG4gICAgICAgIC8vZmlsdGh5IGZpeCBidXQgb3B0aW9uYWwgY2hhaW5pbmcgcmVmdWVzIHRvIHdvcmtcbiAgICAgICAgZXhwb3J0cy5jYXBzU3RhdGUgPSB0cnVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZXhwb3J0cy5jYXBzU3RhdGUgPSBmYWxzZTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuY2Fwc0xvY2tXYXJuaW5nICYmIGV4cG9ydHMuY2Fwc1N0YXRlKSB7XG4gICAgICAgICAgICBzaG93KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBoaWRlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKF9jKSB7IH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zaG93ID0gZXhwb3J0cy51cGRhdGVQb3NpdGlvbiA9IGV4cG9ydHMuaGlkZSA9IGV4cG9ydHMuc3RhcnRBbmltYXRpb24gPSBleHBvcnRzLnN0b3BBbmltYXRpb24gPSBleHBvcnRzLmNhcmV0QW5pbWF0aW5nID0gdm9pZCAwO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IFRlc3RJbnB1dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LWlucHV0XCIpKTtcbmNvbnN0IFNsb3dUaW1lciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3Nsb3ctdGltZXJcIikpO1xuY29uc3QgVGVzdEFjdGl2ZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3Rlc3QtYWN0aXZlXCIpKTtcbmV4cG9ydHMuY2FyZXRBbmltYXRpbmcgPSB0cnVlO1xuZnVuY3Rpb24gc3RvcEFuaW1hdGlvbigpIHtcbiAgICBpZiAoZXhwb3J0cy5jYXJldEFuaW1hdGluZyA9PT0gdHJ1ZSkge1xuICAgICAgICAkKFwiI2NhcmV0XCIpLmNzcyhcImFuaW1hdGlvbi1uYW1lXCIsIFwibm9uZVwiKTtcbiAgICAgICAgJChcIiNjYXJldFwiKS5jc3MoXCJvcGFjaXR5XCIsIFwiMVwiKTtcbiAgICAgICAgZXhwb3J0cy5jYXJldEFuaW1hdGluZyA9IGZhbHNlO1xuICAgIH1cbn1cbmV4cG9ydHMuc3RvcEFuaW1hdGlvbiA9IHN0b3BBbmltYXRpb247XG5mdW5jdGlvbiBzdGFydEFuaW1hdGlvbigpIHtcbiAgICBpZiAoZXhwb3J0cy5jYXJldEFuaW1hdGluZyA9PT0gZmFsc2UpIHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc21vb3RoQ2FyZXQgJiYgIVNsb3dUaW1lci5nZXQoKSkge1xuICAgICAgICAgICAgJChcIiNjYXJldFwiKS5jc3MoXCJhbmltYXRpb24tbmFtZVwiLCBcImNhcmV0Rmxhc2hTbW9vdGhcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiI2NhcmV0XCIpLmNzcyhcImFuaW1hdGlvbi1uYW1lXCIsIFwiY2FyZXRGbGFzaEhhcmRcIik7XG4gICAgICAgIH1cbiAgICAgICAgZXhwb3J0cy5jYXJldEFuaW1hdGluZyA9IHRydWU7XG4gICAgfVxufVxuZXhwb3J0cy5zdGFydEFuaW1hdGlvbiA9IHN0YXJ0QW5pbWF0aW9uO1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAkKFwiI2NhcmV0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbmZ1bmN0aW9uIHVwZGF0ZVBvc2l0aW9uKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCQoXCIjd29yZHNXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAvLyBpZiAoJChcIiNjYXJldFwiKS5oYXNDbGFzcyhcIm9mZlwiKSkge1xuICAgICAgICAvLyAgIHJldHVybjtcbiAgICAgICAgLy8gfVxuICAgICAgICBjb25zdCBjYXJldCA9ICQoXCIjY2FyZXRcIik7XG4gICAgICAgIGxldCBpbnB1dExlbiA9IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aDtcbiAgICAgICAgaW5wdXRMZW4gPSBNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzLnRlc3QoVGVzdElucHV0LmlucHV0LmN1cnJlbnQpXG4gICAgICAgICAgICA/IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50LnNlYXJjaChNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzKSArIDFcbiAgICAgICAgICAgIDogaW5wdXRMZW47XG4gICAgICAgIGxldCBjdXJyZW50TGV0dGVySW5kZXggPSBpbnB1dExlbiAtIDE7XG4gICAgICAgIGlmIChjdXJyZW50TGV0dGVySW5kZXggPT0gLTEpIHtcbiAgICAgICAgICAgIGN1cnJlbnRMZXR0ZXJJbmRleCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgLy9pbnNlcnQgdGVtcG9yYXJ5IGNoYXJhY3RlciBzbyB0aGUgY2FyZXQgd2lsbCB3b3JrIGluIHplbiBtb2RlXG4gICAgICAgIGNvbnN0IGFjdGl2ZVdvcmRFbXB0eSA9ICQoXCIjd29yZHMgLmFjdGl2ZVwiKS5jaGlsZHJlbigpLmxlbmd0aCA9PSAwO1xuICAgICAgICBpZiAoYWN0aXZlV29yZEVtcHR5KSB7XG4gICAgICAgICAgICAkKFwiI3dvcmRzIC5hY3RpdmVcIikuYXBwZW5kKCc8bGV0dGVyIHN0eWxlPVwib3BhY2l0eTogMDtcIj5fPC9sZXR0ZXI+Jyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY3VycmVudFdvcmROb2RlTGlzdCA9IChfYSA9IGRvY3VtZW50ID09PSBudWxsIHx8IGRvY3VtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3dvcmRzIC5hY3RpdmVcIikpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5xdWVyeVNlbGVjdG9yQWxsKFwibGV0dGVyXCIpO1xuICAgICAgICBpZiAoIWN1cnJlbnRXb3JkTm9kZUxpc3QpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGxldCBjdXJyZW50TGV0dGVyID0gY3VycmVudFdvcmROb2RlTGlzdFtjdXJyZW50TGV0dGVySW5kZXhdO1xuICAgICAgICBpZiAoaW5wdXRMZW4gPiBjdXJyZW50V29yZE5vZGVMaXN0Lmxlbmd0aCkge1xuICAgICAgICAgICAgY3VycmVudExldHRlciA9IGN1cnJlbnRXb3JkTm9kZUxpc3RbY3VycmVudFdvcmROb2RlTGlzdC5sZW5ndGggLSAxXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9IFwiemVuXCIgJiYgJChjdXJyZW50TGV0dGVyKS5sZW5ndGggPT0gMClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgY3VycmVudExhbmd1YWdlID0geWllbGQgTWlzYy5nZXRDdXJyZW50TGFuZ3VhZ2UoY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSk7XG4gICAgICAgIGNvbnN0IGlzTGFuZ3VhZ2VMZWZ0VG9SaWdodCA9IGN1cnJlbnRMYW5ndWFnZS5sZWZ0VG9SaWdodDtcbiAgICAgICAgY29uc3QgY3VycmVudExldHRlclBvc0xlZnQgPSBpc0xhbmd1YWdlTGVmdFRvUmlnaHRcbiAgICAgICAgICAgID8gY3VycmVudExldHRlci5vZmZzZXRMZWZ0XG4gICAgICAgICAgICA6IGN1cnJlbnRMZXR0ZXIub2Zmc2V0TGVmdCArICgoX2IgPSAkKGN1cnJlbnRMZXR0ZXIpLndpZHRoKCkpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IDApO1xuICAgICAgICBjb25zdCBjdXJyZW50TGV0dGVyUG9zVG9wID0gY3VycmVudExldHRlci5vZmZzZXRUb3A7XG4gICAgICAgIGNvbnN0IGxldHRlckhlaWdodCA9ICQoY3VycmVudExldHRlcikuaGVpZ2h0KCk7XG4gICAgICAgIGxldCBuZXdUb3AgPSAwO1xuICAgICAgICBsZXQgbmV3TGVmdCA9IDA7XG4gICAgICAgIG5ld1RvcCA9IGN1cnJlbnRMZXR0ZXJQb3NUb3AgLSBNYXRoLnJvdW5kKGxldHRlckhlaWdodCAvIDUpO1xuICAgICAgICBpZiAoaW5wdXRMZW4gPT0gMCkge1xuICAgICAgICAgICAgbmV3TGVmdCA9IGlzTGFuZ3VhZ2VMZWZ0VG9SaWdodFxuICAgICAgICAgICAgICAgID8gY3VycmVudExldHRlclBvc0xlZnQgLSBjYXJldC53aWR0aCgpIC8gMlxuICAgICAgICAgICAgICAgIDogY3VycmVudExldHRlclBvc0xlZnQgKyBjYXJldC53aWR0aCgpIC8gMjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG5ld0xlZnQgPSBpc0xhbmd1YWdlTGVmdFRvUmlnaHRcbiAgICAgICAgICAgICAgICA/IGN1cnJlbnRMZXR0ZXJQb3NMZWZ0ICtcbiAgICAgICAgICAgICAgICAgICAgJChjdXJyZW50TGV0dGVyKS53aWR0aCgpIC1cbiAgICAgICAgICAgICAgICAgICAgY2FyZXQud2lkdGgoKSAvIDJcbiAgICAgICAgICAgICAgICA6IGN1cnJlbnRMZXR0ZXJQb3NMZWZ0IC1cbiAgICAgICAgICAgICAgICAgICAgJChjdXJyZW50TGV0dGVyKS53aWR0aCgpICtcbiAgICAgICAgICAgICAgICAgICAgY2FyZXQud2lkdGgoKSAvIDI7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHNtb290aGxpbmVzY3JvbGwgPSAkKFwiI3dvcmRzIC5zbW9vdGhTY3JvbGxlclwiKS5oZWlnaHQoKTtcbiAgICAgICAgaWYgKHNtb290aGxpbmVzY3JvbGwgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgIHNtb290aGxpbmVzY3JvbGwgPSAwO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zbW9vdGhDYXJldCkge1xuICAgICAgICAgICAgY2FyZXQuc3RvcCh0cnVlLCBmYWxzZSkuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgdG9wOiBuZXdUb3AgLSBzbW9vdGhsaW5lc2Nyb2xsLFxuICAgICAgICAgICAgICAgIGxlZnQ6IG5ld0xlZnQsXG4gICAgICAgICAgICB9LCBTbG93VGltZXIuZ2V0KCkgPyAwIDogMTAwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNhcmV0LnN0b3AodHJ1ZSwgdHJ1ZSkuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgdG9wOiBuZXdUb3AgLSBzbW9vdGhsaW5lc2Nyb2xsLFxuICAgICAgICAgICAgICAgIGxlZnQ6IG5ld0xlZnQsXG4gICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zaG93QWxsTGluZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IGJyb3dzZXJIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgICAgICAgICBjb25zdCBtaWRkbGVQb3MgPSBicm93c2VySGVpZ2h0IC8gMiAtICQoXCIjY2FyZXRcIikub3V0ZXJIZWlnaHQoKSAvIDI7XG4gICAgICAgICAgICBjb25zdCBjb250ZW50SGVpZ2h0ID0gZG9jdW1lbnQuYm9keS5zY3JvbGxIZWlnaHQ7XG4gICAgICAgICAgICBpZiAobmV3VG9wID49IG1pZGRsZVBvcyAmJlxuICAgICAgICAgICAgICAgIGNvbnRlbnRIZWlnaHQgPiBicm93c2VySGVpZ2h0ICYmXG4gICAgICAgICAgICAgICAgVGVzdEFjdGl2ZS5nZXQoKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld3Njcm9sbHRvcCA9IG5ld1RvcCAtIG1pZGRsZVBvcyAvIDI7XG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJy0tLS0tLS0tLScpO1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKG5ld1RvcCk7XG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cobWlkZGxlUG9zKTtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhicm93c2VySGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhjb250ZW50SGVpZ2h0KTtcbiAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oe1xuICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwLFxuICAgICAgICAgICAgICAgICAgICB0b3A6IG5ld3Njcm9sbHRvcCxcbiAgICAgICAgICAgICAgICAgICAgYmVoYXZpb3I6IFwic21vb3RoXCIsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFjdGl2ZVdvcmRFbXB0eSkge1xuICAgICAgICAgICAgJChcIiN3b3JkcyAuYWN0aXZlXCIpLmNoaWxkcmVuKCkucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMudXBkYXRlUG9zaXRpb24gPSB1cGRhdGVQb3NpdGlvbjtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgaWYgKCQoXCIjcmVzdWx0XCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIHVwZGF0ZVBvc2l0aW9uKCk7XG4gICAgICAgICQoXCIjY2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIHN0YXJ0QW5pbWF0aW9uKCk7XG4gICAgfVxufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5nZXRDdXN0b21UZXh0TmFtZXMgPSBleHBvcnRzLmRlbGV0ZUN1c3RvbVRleHQgPSBleHBvcnRzLnNldEN1c3RvbVRleHQgPSBleHBvcnRzLmdldEN1c3RvbVRleHQgPSBleHBvcnRzLnNldERlbGltaXRlciA9IGV4cG9ydHMuc2V0V29yZCA9IGV4cG9ydHMuc2V0VGltZSA9IGV4cG9ydHMuc2V0SXNUaW1lUmFuZG9tID0gZXhwb3J0cy5zZXRJc1dvcmRSYW5kb20gPSBleHBvcnRzLnNldFRleHQgPSBleHBvcnRzLmRlbGltaXRlciA9IGV4cG9ydHMudGltZSA9IGV4cG9ydHMud29yZCA9IGV4cG9ydHMuaXNUaW1lUmFuZG9tID0gZXhwb3J0cy5pc1dvcmRSYW5kb20gPSBleHBvcnRzLnRleHQgPSB2b2lkIDA7XG5leHBvcnRzLnRleHQgPSBbXG4gICAgXCJUaGVcIixcbiAgICBcInF1aWNrXCIsXG4gICAgXCJicm93blwiLFxuICAgIFwiZm94XCIsXG4gICAgXCJqdW1wc1wiLFxuICAgIFwib3ZlclwiLFxuICAgIFwidGhlXCIsXG4gICAgXCJsYXp5XCIsXG4gICAgXCJkb2dcIixcbl07XG5leHBvcnRzLmlzV29yZFJhbmRvbSA9IGZhbHNlO1xuZXhwb3J0cy5pc1RpbWVSYW5kb20gPSBmYWxzZTtcbmV4cG9ydHMuZGVsaW1pdGVyID0gXCIgXCI7XG5mdW5jdGlvbiBzZXRUZXh0KHR4dCkge1xuICAgIGV4cG9ydHMudGV4dCA9IHR4dDtcbn1cbmV4cG9ydHMuc2V0VGV4dCA9IHNldFRleHQ7XG5mdW5jdGlvbiBzZXRJc1dvcmRSYW5kb20odmFsKSB7XG4gICAgZXhwb3J0cy5pc1dvcmRSYW5kb20gPSB2YWw7XG59XG5leHBvcnRzLnNldElzV29yZFJhbmRvbSA9IHNldElzV29yZFJhbmRvbTtcbmZ1bmN0aW9uIHNldElzVGltZVJhbmRvbSh2YWwpIHtcbiAgICBleHBvcnRzLmlzVGltZVJhbmRvbSA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0SXNUaW1lUmFuZG9tID0gc2V0SXNUaW1lUmFuZG9tO1xuZnVuY3Rpb24gc2V0VGltZSh2YWwpIHtcbiAgICBleHBvcnRzLnRpbWUgPSB2YWw7XG59XG5leHBvcnRzLnNldFRpbWUgPSBzZXRUaW1lO1xuZnVuY3Rpb24gc2V0V29yZCh2YWwpIHtcbiAgICBleHBvcnRzLndvcmQgPSB2YWw7XG59XG5leHBvcnRzLnNldFdvcmQgPSBzZXRXb3JkO1xuZnVuY3Rpb24gc2V0RGVsaW1pdGVyKHZhbCkge1xuICAgIGV4cG9ydHMuZGVsaW1pdGVyID0gdmFsO1xufVxuZXhwb3J0cy5zZXREZWxpbWl0ZXIgPSBzZXREZWxpbWl0ZXI7XG5mdW5jdGlvbiBnZXRDdXN0b21UZXh0KG5hbWUpIHtcbiAgICBjb25zdCBjdXN0b21UZXh0ID0gZ2V0Q3VzdG9tVGV4dE9iamVjdCgpO1xuICAgIHJldHVybiBjdXN0b21UZXh0W25hbWVdLnNwbGl0KC8gKy8pO1xufVxuZXhwb3J0cy5nZXRDdXN0b21UZXh0ID0gZ2V0Q3VzdG9tVGV4dDtcbmZ1bmN0aW9uIHNldEN1c3RvbVRleHQobmFtZSwgdGV4dCkge1xuICAgIGNvbnN0IGN1c3RvbVRleHQgPSBnZXRDdXN0b21UZXh0T2JqZWN0KCk7XG4gICAgaWYgKHR5cGVvZiB0ZXh0ID09PSBcInN0cmluZ1wiKVxuICAgICAgICBjdXN0b21UZXh0W25hbWVdID0gdGV4dDtcbiAgICBlbHNlXG4gICAgICAgIGN1c3RvbVRleHRbbmFtZV0gPSB0ZXh0LmpvaW4oXCIgXCIpO1xuICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImN1c3RvbVRleHRcIiwgSlNPTi5zdHJpbmdpZnkoY3VzdG9tVGV4dCkpO1xufVxuZXhwb3J0cy5zZXRDdXN0b21UZXh0ID0gc2V0Q3VzdG9tVGV4dDtcbmZ1bmN0aW9uIGRlbGV0ZUN1c3RvbVRleHQobmFtZSkge1xuICAgIGNvbnN0IGN1c3RvbVRleHQgPSBnZXRDdXN0b21UZXh0T2JqZWN0KCk7XG4gICAgaWYgKGN1c3RvbVRleHRbbmFtZV0pXG4gICAgICAgIGRlbGV0ZSBjdXN0b21UZXh0W25hbWVdO1xuICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImN1c3RvbVRleHRcIiwgSlNPTi5zdHJpbmdpZnkoY3VzdG9tVGV4dCkpO1xufVxuZXhwb3J0cy5kZWxldGVDdXN0b21UZXh0ID0gZGVsZXRlQ3VzdG9tVGV4dDtcbmZ1bmN0aW9uIGdldEN1c3RvbVRleHRPYmplY3QoKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiBKU09OLnBhcnNlKChfYSA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImN1c3RvbVRleHRcIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwie31cIik7XG59XG5mdW5jdGlvbiBnZXRDdXN0b21UZXh0TmFtZXMoKSB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKGdldEN1c3RvbVRleHRPYmplY3QoKSk7XG59XG5leHBvcnRzLmdldEN1c3RvbVRleHROYW1lcyA9IGdldEN1c3RvbVRleHROYW1lcztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNldCA9IHZvaWQgMDtcbmNvbnN0IENhcmV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2NhcmV0XCIpKTtcbmNvbnN0IEFjdGl2ZVBhZ2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9hY3RpdmUtcGFnZVwiKSk7XG5jb25zdCB1bmZvY3VzUHggPSAzO1xubGV0IHN0YXRlID0gZmFsc2U7XG5mdW5jdGlvbiBzZXQoZm9jLCB3aXRoQ3Vyc29yID0gZmFsc2UpIHtcbiAgICBpZiAoZm9jICYmICFzdGF0ZSkge1xuICAgICAgICBzdGF0ZSA9IHRydWU7XG4gICAgICAgIENhcmV0LnN0b3BBbmltYXRpb24oKTtcbiAgICAgICAgJChcIiN0b3BcIikuYWRkQ2xhc3MoXCJmb2N1c1wiKTtcbiAgICAgICAgJChcIiNib3R0b21cIikuYWRkQ2xhc3MoXCJmb2N1c1wiKTtcbiAgICAgICAgaWYgKCF3aXRoQ3Vyc29yKVxuICAgICAgICAgICAgJChcImJvZHlcIikuY3NzKFwiY3Vyc29yXCIsIFwibm9uZVwiKTtcbiAgICAgICAgJChcIiNtaWRkbGVcIikuYWRkQ2xhc3MoXCJmb2N1c1wiKTtcbiAgICAgICAgJChcIiNiYW5uZXJDZW50ZXJcIikuYWRkQ2xhc3MoXCJmb2N1c1wiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoIWZvYyAmJiBzdGF0ZSkge1xuICAgICAgICBzdGF0ZSA9IGZhbHNlO1xuICAgICAgICBDYXJldC5zdGFydEFuaW1hdGlvbigpO1xuICAgICAgICAkKFwiI3RvcFwiKS5yZW1vdmVDbGFzcyhcImZvY3VzXCIpO1xuICAgICAgICAkKFwiI2JvdHRvbVwiKS5yZW1vdmVDbGFzcyhcImZvY3VzXCIpO1xuICAgICAgICAkKFwiYm9keVwiKS5jc3MoXCJjdXJzb3JcIiwgXCJkZWZhdWx0XCIpO1xuICAgICAgICAkKFwiI21pZGRsZVwiKS5yZW1vdmVDbGFzcyhcImZvY3VzXCIpO1xuICAgICAgICAkKFwiI2Jhbm5lckNlbnRlclwiKS5yZW1vdmVDbGFzcyhcImZvY3VzXCIpO1xuICAgIH1cbn1cbmV4cG9ydHMuc2V0ID0gc2V0O1xuJChkb2N1bWVudCkubW91c2Vtb3ZlKGZ1bmN0aW9uIChldmVudCkge1xuICAgIGlmICghc3RhdGUpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoQWN0aXZlUGFnZS5nZXQoKSA9PSBcImxvYWRpbmdcIilcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09IFwiYWNjb3VudFwiICYmIHN0YXRlID09IHRydWUpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoJChcIiN0b3BcIikuaGFzQ2xhc3MoXCJmb2N1c1wiKSAmJlxuICAgICAgICBldmVudC5vcmlnaW5hbEV2ZW50ICYmXG4gICAgICAgIC8vIFRvIGF2b2lkIG1vdXNlL2Rlc2sgdmlicmF0aW9uIGZyb20gY3JlYXRpbmcgYSBmbGFzaHkgZWZmZWN0LCB3ZSdsbCB1bmZvY3VzIEAgPjVweCBpbnN0ZWFkIG9mID4wcHhcbiAgICAgICAgKGV2ZW50Lm9yaWdpbmFsRXZlbnQubW92ZW1lbnRYID4gdW5mb2N1c1B4IHx8XG4gICAgICAgICAgICBldmVudC5vcmlnaW5hbEV2ZW50Lm1vdmVtZW50WSA+IHVuZm9jdXNQeCkpIHtcbiAgICAgICAgc2V0KGZhbHNlKTtcbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucmVtZW1iZXJTZXR0aW5ncyA9IGV4cG9ydHMuYWN0aXZhdGUgPSBleHBvcnRzLmNsZWFyID0gZXhwb3J0cy5zZXRGdW5ib3ggPSBleHBvcnRzLnRvZ2dsZVNjcmlwdCA9IGV4cG9ydHMucmVzZXQgPSBleHBvcnRzLnN0YXJ0TWVtb3J5VGltZXIgPSBleHBvcnRzLnJlc2V0TWVtb3J5VGltZXIgPSB2b2lkIDA7XG5jb25zdCBUZXN0V29yZHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC13b3Jkc1wiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgTWFudWFsUmVzdGFydCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9tYW51YWwtcmVzdGFydC10cmFja2VyXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpLCBVcGRhdGVDb25maWcgPSBjb25maWdfMTtcbmNvbnN0IFRUUyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90dHNcIikpO1xuY29uc3QgTW9kZXNOb3RpY2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL21vZGVzLW5vdGljZVwiKSk7XG5sZXQgbW9kZVNhdmVkID0gbnVsbDtcbmxldCBtZW1vcnlUaW1lciA9IG51bGw7XG5sZXQgbWVtb3J5SW50ZXJ2YWwgPSBudWxsO1xubGV0IHNldHRpbmdzTWVtb3J5ID0ge307XG5mdW5jdGlvbiByZW1lbWJlclNldHRpbmcoc2V0dGluZ05hbWUsIHZhbHVlLCBzZXRGdW5jdGlvbikge1xuICAgIHZhciBfYTtcbiAgICAoX2EgPSBzZXR0aW5nc01lbW9yeVtzZXR0aW5nTmFtZV0pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IChzZXR0aW5nc01lbW9yeVtzZXR0aW5nTmFtZV0gPSB7XG4gICAgICAgIHZhbHVlLFxuICAgICAgICBzZXRGdW5jdGlvbixcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGxvYWRNZW1vcnkoKSB7XG4gICAgTm90aWZpY2F0aW9ucy5hZGQoXCJSZXZlcnRpbmcgZnVuYm94IHNldHRpbmdzXCIsIDApO1xuICAgIE9iamVjdC5rZXlzKHNldHRpbmdzTWVtb3J5KS5mb3JFYWNoKChzZXR0aW5nKSA9PiB7XG4gICAgICAgIHNldHRpbmdzTWVtb3J5W3NldHRpbmddLnNldEZ1bmN0aW9uKHNldHRpbmdzTWVtb3J5W3NldHRpbmddLnZhbHVlLCB0cnVlKTtcbiAgICB9KTtcbiAgICBzZXR0aW5nc01lbW9yeSA9IHt9O1xufVxuZnVuY3Rpb24gc2hvd01lbW9yeVRpbWVyKCkge1xuICAgICQoXCIjdHlwaW5nVGVzdCAjbWVtb3J5VGltZXJcIikuc3RvcCh0cnVlLCB0cnVlKS5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogMSxcbiAgICB9LCAxMjUpO1xufVxuZnVuY3Rpb24gaGlkZU1lbW9yeVRpbWVyKCkge1xuICAgICQoXCIjdHlwaW5nVGVzdCAjbWVtb3J5VGltZXJcIikuc3RvcCh0cnVlLCB0cnVlKS5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogMCxcbiAgICB9LCAxMjUpO1xufVxuZnVuY3Rpb24gcmVzZXRNZW1vcnlUaW1lcigpIHtcbiAgICBpZiAobWVtb3J5SW50ZXJ2YWwgIT09IG51bGwpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChtZW1vcnlJbnRlcnZhbCk7XG4gICAgICAgIG1lbW9yeUludGVydmFsID0gbnVsbDtcbiAgICB9XG4gICAgbWVtb3J5VGltZXIgPSBudWxsO1xuICAgIGhpZGVNZW1vcnlUaW1lcigpO1xufVxuZXhwb3J0cy5yZXNldE1lbW9yeVRpbWVyID0gcmVzZXRNZW1vcnlUaW1lcjtcbmZ1bmN0aW9uIHVwZGF0ZU1lbW9yeVRpbWVyKHNlYykge1xuICAgICQoXCIjdHlwaW5nVGVzdCAjbWVtb3J5VGltZXJcIikudGV4dChgVGltZXIgbGVmdCB0byBtZW1vcmlzZSBhbGwgd29yZHM6ICR7c2VjfXNgKTtcbn1cbmZ1bmN0aW9uIHN0YXJ0TWVtb3J5VGltZXIoKSB7XG4gICAgcmVzZXRNZW1vcnlUaW1lcigpO1xuICAgIG1lbW9yeVRpbWVyID0gTWF0aC5yb3VuZChNYXRoLnBvdyhUZXN0V29yZHMud29yZHMubGVuZ3RoLCAxLjIpKTtcbiAgICB1cGRhdGVNZW1vcnlUaW1lcihtZW1vcnlUaW1lcik7XG4gICAgc2hvd01lbW9yeVRpbWVyKCk7XG4gICAgbWVtb3J5SW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgIGlmIChtZW1vcnlUaW1lciA9PT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbWVtb3J5VGltZXIgLT0gMTtcbiAgICAgICAgbWVtb3J5VGltZXIgPT0gMCA/IGhpZGVNZW1vcnlUaW1lcigpIDogdXBkYXRlTWVtb3J5VGltZXIobWVtb3J5VGltZXIpO1xuICAgICAgICBpZiAobWVtb3J5VGltZXIgPD0gMCkge1xuICAgICAgICAgICAgcmVzZXRNZW1vcnlUaW1lcigpO1xuICAgICAgICAgICAgJChcIiN3b3Jkc1dyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICB9LCAxMDAwKTtcbn1cbmV4cG9ydHMuc3RhcnRNZW1vcnlUaW1lciA9IHN0YXJ0TWVtb3J5VGltZXI7XG5mdW5jdGlvbiByZXNldCgpIHtcbiAgICByZXNldE1lbW9yeVRpbWVyKCk7XG59XG5leHBvcnRzLnJlc2V0ID0gcmVzZXQ7XG5mdW5jdGlvbiB0b2dnbGVTY3JpcHQoLi4ucGFyYW1zKSB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcInR0c1wiKSB7XG4gICAgICAgIFRUUy5zcGVhayhwYXJhbXNbMF0pO1xuICAgIH1cbn1cbmV4cG9ydHMudG9nZ2xlU2NyaXB0ID0gdG9nZ2xlU2NyaXB0O1xuZnVuY3Rpb24gc2V0RnVuYm94KGZ1bmJveCwgbW9kZSkge1xuICAgIG1vZGVTYXZlZCA9IG1vZGU7XG4gICAgVXBkYXRlQ29uZmlnLnNldEZ1bmJveChmdW5ib3gsIGZhbHNlKTtcbiAgICBpZiAoZnVuYm94ID09PSBcIm5vbmVcIilcbiAgICAgICAgbG9hZE1lbW9yeSgpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRGdW5ib3ggPSBzZXRGdW5ib3g7XG5mdW5jdGlvbiBjbGVhcigpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAkKFwiI2Z1bkJveFRoZW1lXCIpLmF0dHIoXCJocmVmXCIsIGBgKTtcbiAgICAgICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcIm5vc3BhY2VcIik7XG4gICAgICAgICQoXCIjd29yZHNcIikucmVtb3ZlQ2xhc3MoXCJhcnJvd3NcIik7XG4gICAgICAgIHJlc2V0KCk7XG4gICAgICAgICQoXCIjd29yZHNXcmFwcGVyXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgICAgICBNb2Rlc05vdGljZS51cGRhdGUoKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG59XG5leHBvcnRzLmNsZWFyID0gY2xlYXI7XG5mdW5jdGlvbiBhY3RpdmF0ZShmdW5ib3gpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBsZXQgbW9kZSA9IG1vZGVTYXZlZDtcbiAgICAgICAgaWYgKGZ1bmJveCA9PT0gdW5kZWZpbmVkIHx8IGZ1bmJveCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgZnVuYm94ID0gY29uZmlnXzEuZGVmYXVsdC5mdW5ib3g7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZnVuYm94SW5mbyA9IHlpZWxkIE1pc2MuZ2V0RnVuYm94KGZ1bmJveCk7XG4gICAgICAgICQoXCIjZnVuQm94VGhlbWVcIikuYXR0cihcImhyZWZcIiwgYGApO1xuICAgICAgICAkKFwiI3dvcmRzXCIpLnJlbW92ZUNsYXNzKFwibm9zcGFjZVwiKTtcbiAgICAgICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcImFycm93c1wiKTtcbiAgICAgICAgaWYgKCh5aWVsZCBNaXNjLmdldEN1cnJlbnRMYW5ndWFnZShjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKSkubGlnYXR1cmVzKSB7XG4gICAgICAgICAgICBpZiAoZnVuYm94ID09IFwiY2hvb19jaG9vXCIgfHwgZnVuYm94ID09IFwiZWFydGhxdWFrZVwiKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDdXJyZW50IGxhbmd1YWdlIGRvZXMgbm90IHN1cHBvcnQgdGhpcyBmdW5ib3ggbW9kZVwiLCAwKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RnVuYm94KFwibm9uZVwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB5aWVsZCBjbGVhcigpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZnVuYm94ICE9PSBcIm5vbmVcIiAmJiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInplblwiIHx8IGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInF1b3RlXCIpKSB7XG4gICAgICAgICAgICBpZiAoKGZ1bmJveEluZm8gPT09IG51bGwgfHwgZnVuYm94SW5mbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZnVuYm94SW5mby5hZmZlY3RzV29yZEdlbmVyYXRpb24pID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoYCR7TWlzYy5jYXBpdGFsaXplRmlyc3RMZXR0ZXJPZkVhY2hXb3JkKGNvbmZpZ18xLmRlZmF1bHQubW9kZSl9IG1vZGUgZG9lcyBub3Qgc3VwcG9ydCB0aGUgJHtmdW5ib3h9IGZ1bmJveGAsIDApO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGdW5ib3goXCJub25lXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIHlpZWxkIGNsZWFyKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIGlmIChmdW5ib3ggPT09IFwibm9uZVwiKSB7XG4gICAgICAgIHJlc2V0KCk7XG4gICAgICAgICQoXCIjd29yZHNXcmFwcGVyXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyB9XG4gICAgICAgIGlmIChmdW5ib3ggPT09IFwibm9uZVwiICYmIG1vZGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbW9kZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoKGZ1bmJveCAhPT0gXCJub25lXCIgJiYgbW9kZSA9PT0gdW5kZWZpbmVkKSB8fFxuICAgICAgICAgICAgKGZ1bmJveCAhPT0gXCJub25lXCIgJiYgbW9kZSA9PT0gbnVsbCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGxpc3QgPSB5aWVsZCBNaXNjLmdldEZ1bmJveExpc3QoKTtcbiAgICAgICAgICAgIG1vZGUgPSBsaXN0LmZpbHRlcigoZikgPT4gZi5uYW1lID09PSBmdW5ib3gpWzBdLnR5cGU7XG4gICAgICAgIH1cbiAgICAgICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICAgICAgaWYgKG1vZGUgPT09IFwic3R5bGVcIikge1xuICAgICAgICAgICAgaWYgKGZ1bmJveCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAkKFwiI2Z1bkJveFRoZW1lXCIpLmF0dHIoXCJocmVmXCIsIGBmdW5ib3gvJHtmdW5ib3h9LmNzc2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZ1bmJveCA9PT0gXCJzaW1vbl9zYXlzXCIpIHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTW9kZShcIm5leHRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZnVuYm94ID09PSBcInJlYWRfYWhlYWRcIiB8fFxuICAgICAgICAgICAgICAgIGZ1bmJveCA9PT0gXCJyZWFkX2FoZWFkX2Vhc3lcIiB8fFxuICAgICAgICAgICAgICAgIGZ1bmJveCA9PT0gXCJyZWFkX2FoZWFkX2hhcmRcIikge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRIaWdobGlnaHRNb2RlKFwibGV0dGVyXCIsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG1vZGUgPT09IFwic2NyaXB0XCIpIHtcbiAgICAgICAgICAgIGlmIChmdW5ib3ggPT09IFwidHRzXCIpIHtcbiAgICAgICAgICAgICAgICAkKFwiI2Z1bkJveFRoZW1lXCIpLmF0dHIoXCJocmVmXCIsIGBmdW5ib3gvc2ltb25fc2F5cy5jc3NgKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTW9kZShcIm9mZlwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0SGlnaGxpZ2h0TW9kZShcImxldHRlclwiLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZ1bmJveCA9PT0gXCJsYXlvdXRmbHVpZFwiKSB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldExheW91dChjb25maWdfMS5kZWZhdWx0LmN1c3RvbUxheW91dGZsdWlkXG4gICAgICAgICAgICAgICAgICAgID8gY29uZmlnXzEuZGVmYXVsdC5jdXN0b21MYXlvdXRmbHVpZC5zcGxpdChcIiNcIilbMF1cbiAgICAgICAgICAgICAgICAgICAgOiBcInF3ZXJ0eVwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTGF5b3V0KGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tTGF5b3V0Zmx1aWRcbiAgICAgICAgICAgICAgICAgICAgPyBjb25maWdfMS5kZWZhdWx0LmN1c3RvbUxheW91dGZsdWlkLnNwbGl0KFwiI1wiKVswXVxuICAgICAgICAgICAgICAgICAgICA6IFwicXdlcnR5XCIsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZnVuYm94ID09PSBcIm1lbW9yeVwiKSB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ3b3Jkc1wiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2hvd0FsbExpbmVzKHRydWUsIHRydWUpO1xuICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmtleW1hcE1vZGUgPT09IFwibmV4dFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBNb2RlKFwicmVhY3RcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZnVuYm94ID09PSBcIm5vc3BhY2VcIikge1xuICAgICAgICAgICAgICAgICQoXCIjd29yZHNcIikuYWRkQ2xhc3MoXCJub3NwYWNlXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRIaWdobGlnaHRNb2RlKFwibGV0dGVyXCIsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZnVuYm94ID09PSBcImFycm93c1wiKSB7XG4gICAgICAgICAgICAgICAgJChcIiN3b3Jkc1wiKS5hZGRDbGFzcyhcImFycm93c1wiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0SGlnaGxpZ2h0TW9kZShcImxldHRlclwiLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBNb2Rlc05vdGljZS51cGRhdGUoKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG59XG5leHBvcnRzLmFjdGl2YXRlID0gYWN0aXZhdGU7XG5mdW5jdGlvbiByZW1lbWJlclNldHRpbmdzKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IGZ1bmJveCA9IGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94O1xuICAgICAgICBsZXQgbW9kZSA9IG1vZGVTYXZlZDtcbiAgICAgICAgaWYgKGZ1bmJveCA9PT0gXCJub25lXCIgJiYgbW9kZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBtb2RlID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICgoZnVuYm94ICE9PSBcIm5vbmVcIiAmJiBtb2RlID09PSB1bmRlZmluZWQpIHx8XG4gICAgICAgICAgICAoZnVuYm94ICE9PSBcIm5vbmVcIiAmJiBtb2RlID09PSBudWxsKSkge1xuICAgICAgICAgICAgY29uc3QgbGlzdCA9IHlpZWxkIE1pc2MuZ2V0RnVuYm94TGlzdCgpO1xuICAgICAgICAgICAgbW9kZSA9IGxpc3QuZmlsdGVyKChmKSA9PiBmLm5hbWUgPT09IGZ1bmJveClbMF0udHlwZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobW9kZSA9PT0gXCJzdHlsZVwiKSB7XG4gICAgICAgICAgICBpZiAoZnVuYm94ID09PSBcInNpbW9uX3NheXNcIikge1xuICAgICAgICAgICAgICAgIHJlbWVtYmVyU2V0dGluZyhcImtleW1hcE1vZGVcIiwgY29uZmlnXzEuZGVmYXVsdC5rZXltYXBNb2RlLCBVcGRhdGVDb25maWcuc2V0S2V5bWFwTW9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZnVuYm94ID09PSBcInJlYWRfYWhlYWRcIiB8fFxuICAgICAgICAgICAgICAgIGZ1bmJveCA9PT0gXCJyZWFkX2FoZWFkX2Vhc3lcIiB8fFxuICAgICAgICAgICAgICAgIGZ1bmJveCA9PT0gXCJyZWFkX2FoZWFkX2hhcmRcIikge1xuICAgICAgICAgICAgICAgIHJlbWVtYmVyU2V0dGluZyhcImhpZ2hsaWdodE1vZGVcIiwgY29uZmlnXzEuZGVmYXVsdC5oaWdobGlnaHRNb2RlLCBVcGRhdGVDb25maWcuc2V0SGlnaGxpZ2h0TW9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobW9kZSA9PT0gXCJzY3JpcHRcIikge1xuICAgICAgICAgICAgaWYgKGZ1bmJveCA9PT0gXCJ0dHNcIikge1xuICAgICAgICAgICAgICAgIHJlbWVtYmVyU2V0dGluZyhcImtleW1hcE1vZGVcIiwgY29uZmlnXzEuZGVmYXVsdC5rZXltYXBNb2RlLCBVcGRhdGVDb25maWcuc2V0S2V5bWFwTW9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmdW5ib3ggPT09IFwibGF5b3V0Zmx1aWRcIikge1xuICAgICAgICAgICAgICAgIHJlbWVtYmVyU2V0dGluZyhcImtleW1hcE1vZGVcIiwgY29uZmlnXzEuZGVmYXVsdC5rZXltYXBNb2RlLCBVcGRhdGVDb25maWcuc2V0S2V5bWFwTW9kZSk7XG4gICAgICAgICAgICAgICAgcmVtZW1iZXJTZXR0aW5nKFwibGF5b3V0XCIsIGNvbmZpZ18xLmRlZmF1bHQubGF5b3V0LCBVcGRhdGVDb25maWcuc2V0TGF5b3V0KTtcbiAgICAgICAgICAgICAgICByZW1lbWJlclNldHRpbmcoXCJrZXltYXBMYXlvdXRcIiwgY29uZmlnXzEuZGVmYXVsdC5rZXltYXBMYXlvdXQsIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBMYXlvdXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZnVuYm94ID09PSBcIm1lbW9yeVwiKSB7XG4gICAgICAgICAgICAgICAgcmVtZW1iZXJTZXR0aW5nKFwibW9kZVwiLCBjb25maWdfMS5kZWZhdWx0Lm1vZGUsIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKTtcbiAgICAgICAgICAgICAgICByZW1lbWJlclNldHRpbmcoXCJzaG93QWxsTGluZXNcIiwgY29uZmlnXzEuZGVmYXVsdC5zaG93QWxsTGluZXMsIFVwZGF0ZUNvbmZpZy5zZXRTaG93QWxsTGluZXMpO1xuICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmtleW1hcE1vZGUgPT09IFwibmV4dFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlbWVtYmVyU2V0dGluZyhcImtleW1hcE1vZGVcIiwgY29uZmlnXzEuZGVmYXVsdC5rZXltYXBNb2RlLCBVcGRhdGVDb25maWcuc2V0S2V5bWFwTW9kZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZnVuYm94ID09PSBcIm5vc3BhY2VcIikge1xuICAgICAgICAgICAgICAgIHJlbWVtYmVyU2V0dGluZyhcImhpZ2hsaWdodE1vZGVcIiwgY29uZmlnXzEuZGVmYXVsdC5oaWdobGlnaHRNb2RlLCBVcGRhdGVDb25maWcuc2V0SGlnaGxpZ2h0TW9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmdW5ib3ggPT09IFwiYXJyb3dzXCIpIHtcbiAgICAgICAgICAgICAgICByZW1lbWJlclNldHRpbmcoXCJoaWdobGlnaHRNb2RlXCIsIGNvbmZpZ18xLmRlZmF1bHQuaGlnaGxpZ2h0TW9kZSwgVXBkYXRlQ29uZmlnLnNldEhpZ2hsaWdodE1vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZnVuYm94ID09PSBcIjU4MDA4XCIpIHtcbiAgICAgICAgICAgICAgICByZW1lbWJlclNldHRpbmcoXCJudW1iZXJzXCIsIGNvbmZpZ18xLmRlZmF1bHQubnVtYmVycywgVXBkYXRlQ29uZmlnLnNldE51bWJlcnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLnJlbWVtYmVyU2V0dGluZ3MgPSByZW1lbWJlclNldHRpbmdzO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5nZXRDaGFyRnJvbUV2ZW50ID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IGNhcHNfd2FybmluZ18xID0gcmVxdWlyZShcIi4vY2Fwcy13YXJuaW5nXCIpO1xuZnVuY3Rpb24gZ2V0Q2hhckZyb21FdmVudChldmVudCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIGVtdWxhdGVkTGF5b3V0U2hvdWxkU2hpZnRLZXkoZXZlbnQsIG5ld0tleVByZXZpZXcpIHtcbiAgICAgICAgICAgIGlmIChjYXBzX3dhcm5pbmdfMS5jYXBzU3RhdGUpXG4gICAgICAgICAgICAgICAgcmV0dXJuIE1pc2MuaXNBU0NJSUxldHRlcihuZXdLZXlQcmV2aWV3KSAhPT0gZXZlbnQuc2hpZnRLZXk7XG4gICAgICAgICAgICByZXR1cm4gZXZlbnQuc2hpZnRLZXk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGF5b3V0ID0geWllbGQgTWlzYy5nZXRMYXlvdXQoY29uZmlnXzEuZGVmYXVsdC5sYXlvdXQpO1xuICAgICAgICBsZXQga2V5RXZlbnRDb2RlcyA9IFtdO1xuICAgICAgICBpZiAobGF5b3V0LnR5cGUgPT09IFwiYW5zaVwiKSB7XG4gICAgICAgICAgICBrZXlFdmVudENvZGVzID0gW1xuICAgICAgICAgICAgICAgIFwiQmFja3F1b3RlXCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDFcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0MlwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQzXCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDRcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0NVwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ2XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDdcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0OFwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ5XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDBcIixcbiAgICAgICAgICAgICAgICBcIk1pbnVzXCIsXG4gICAgICAgICAgICAgICAgXCJFcXVhbFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5UVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5V1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5RVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5UlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5VFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5WVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5VVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5SVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5T1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5UFwiLFxuICAgICAgICAgICAgICAgIFwiQnJhY2tldExlZnRcIixcbiAgICAgICAgICAgICAgICBcIkJyYWNrZXRSaWdodFwiLFxuICAgICAgICAgICAgICAgIFwiQmFja3NsYXNoXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlBXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlTXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlEXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlGXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlHXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlIXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlKXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlLXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlMXCIsXG4gICAgICAgICAgICAgICAgXCJTZW1pY29sb25cIixcbiAgICAgICAgICAgICAgICBcIlF1b3RlXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlaXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlYXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlDXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlWXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlCXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlOXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlNXCIsXG4gICAgICAgICAgICAgICAgXCJDb21tYVwiLFxuICAgICAgICAgICAgICAgIFwiUGVyaW9kXCIsXG4gICAgICAgICAgICAgICAgXCJTbGFzaFwiLFxuICAgICAgICAgICAgICAgIFwiU3BhY2VcIixcbiAgICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobGF5b3V0LnR5cGUgPT09IFwiaXNvXCIpIHtcbiAgICAgICAgICAgIGtleUV2ZW50Q29kZXMgPSBbXG4gICAgICAgICAgICAgICAgXCJCYWNrcXVvdGVcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0MVwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQyXCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDNcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0NFwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ1XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDZcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0N1wiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ4XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDlcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0MFwiLFxuICAgICAgICAgICAgICAgIFwiTWludXNcIixcbiAgICAgICAgICAgICAgICBcIkVxdWFsXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlRXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlXXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlFXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlSXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlUXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlZXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlVXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlJXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlPXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlQXCIsXG4gICAgICAgICAgICAgICAgXCJCcmFja2V0TGVmdFwiLFxuICAgICAgICAgICAgICAgIFwiQnJhY2tldFJpZ2h0XCIsXG4gICAgICAgICAgICAgICAgXCJLZXlBXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlTXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlEXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlGXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlHXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlIXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlKXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlLXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlMXCIsXG4gICAgICAgICAgICAgICAgXCJTZW1pY29sb25cIixcbiAgICAgICAgICAgICAgICBcIlF1b3RlXCIsXG4gICAgICAgICAgICAgICAgXCJJbnRsQmFja3NsYXNoXCIsXG4gICAgICAgICAgICAgICAgXCJCYWNrcXVvdGVcIixcbiAgICAgICAgICAgICAgICBcIktleVpcIixcbiAgICAgICAgICAgICAgICBcIktleVhcIixcbiAgICAgICAgICAgICAgICBcIktleUNcIixcbiAgICAgICAgICAgICAgICBcIktleVZcIixcbiAgICAgICAgICAgICAgICBcIktleUJcIixcbiAgICAgICAgICAgICAgICBcIktleU5cIixcbiAgICAgICAgICAgICAgICBcIktleU1cIixcbiAgICAgICAgICAgICAgICBcIkNvbW1hXCIsXG4gICAgICAgICAgICAgICAgXCJQZXJpb2RcIixcbiAgICAgICAgICAgICAgICBcIlNsYXNoXCIsXG4gICAgICAgICAgICAgICAgXCJTcGFjZVwiLFxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChsYXlvdXQudHlwZSA9PT0gXCJtYXRyaXhcIikge1xuICAgICAgICAgICAga2V5RXZlbnRDb2RlcyA9IFtcbiAgICAgICAgICAgICAgICBcIkJhY2txdW90ZVwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQxXCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDJcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0M1wiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ0XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDVcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0NlwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ3XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDhcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0OVwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQwXCIsXG4gICAgICAgICAgICAgICAgXCJNaW51c1wiLFxuICAgICAgICAgICAgICAgIFwiRXF1YWxcIixcbiAgICAgICAgICAgICAgICBcIktleVFcIixcbiAgICAgICAgICAgICAgICBcIktleVdcIixcbiAgICAgICAgICAgICAgICBcIktleUVcIixcbiAgICAgICAgICAgICAgICBcIktleVJcIixcbiAgICAgICAgICAgICAgICBcIktleVRcIixcbiAgICAgICAgICAgICAgICBcIktleVlcIixcbiAgICAgICAgICAgICAgICBcIktleVVcIixcbiAgICAgICAgICAgICAgICBcIktleUlcIixcbiAgICAgICAgICAgICAgICBcIktleU9cIixcbiAgICAgICAgICAgICAgICBcIktleVBcIixcbiAgICAgICAgICAgICAgICBcIkJyYWNrZXRMZWZ0XCIsXG4gICAgICAgICAgICAgICAgXCJCcmFja2V0UmlnaHRcIixcbiAgICAgICAgICAgICAgICBcIkJhY2tzbGFzaFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5QVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5U1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5RFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5RlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5R1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5SFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5SlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5S1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5TFwiLFxuICAgICAgICAgICAgICAgIFwiU2VtaWNvbG9uXCIsXG4gICAgICAgICAgICAgICAgXCJRdW90ZVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5WlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5WFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5Q1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5VlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5QlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5TlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5TVwiLFxuICAgICAgICAgICAgICAgIFwiQ29tbWFcIixcbiAgICAgICAgICAgICAgICBcIlBlcmlvZFwiLFxuICAgICAgICAgICAgICAgIFwiU2xhc2hcIixcbiAgICAgICAgICAgICAgICBcIlNwYWNlXCIsXG4gICAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGxheW91dEtleXMgPSBsYXlvdXQua2V5cztcbiAgICAgICAgY29uc3QgbGF5b3V0TWFwID0gbGF5b3V0S2V5c1tcInJvdzFcIl1cbiAgICAgICAgICAgIC5jb25jYXQobGF5b3V0S2V5c1tcInJvdzJcIl0pXG4gICAgICAgICAgICAuY29uY2F0KGxheW91dEtleXNbXCJyb3czXCJdKVxuICAgICAgICAgICAgLmNvbmNhdChsYXlvdXRLZXlzW1wicm93NFwiXSlcbiAgICAgICAgICAgIC5jb25jYXQobGF5b3V0S2V5c1tcInJvdzVcIl0pO1xuICAgICAgICBsZXQgbWFwSW5kZXggPSBudWxsO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleUV2ZW50Q29kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChldmVudC5jb2RlID09IGtleUV2ZW50Q29kZXNbaV0pIHtcbiAgICAgICAgICAgICAgICBtYXBJbmRleCA9IGk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFtYXBJbmRleCkge1xuICAgICAgICAgICAgaWYgKGV2ZW50LmNvZGUuaW5jbHVkZXMoXCJOdW1wYWRcIikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnQua2V5O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmV3S2V5UHJldmlldyA9IGxheW91dE1hcFttYXBJbmRleF1bMF07XG4gICAgICAgIGNvbnN0IHNoaWZ0ID0gZW11bGF0ZWRMYXlvdXRTaG91bGRTaGlmdEtleShldmVudCwgbmV3S2V5UHJldmlldykgPyAxIDogMDtcbiAgICAgICAgY29uc3QgY2hhciA9IGxheW91dE1hcFttYXBJbmRleF1bc2hpZnRdO1xuICAgICAgICBpZiAoY2hhcikge1xuICAgICAgICAgICAgcmV0dXJuIGNoYXI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZXZlbnQua2V5O1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmdldENoYXJGcm9tRXZlbnQgPSBnZXRDaGFyRnJvbUV2ZW50O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnJlcGxhY2VBY2NlbnRzID0gdm9pZCAwO1xuY29uc3QgYWNjZW50cyA9IFtcbiAgICBbXCLDocOgw6LDpMOlw6PEhcSFzIHEgcSFzITEg1wiLCBcImFcIl0sXG4gICAgW1wiw6nDqMOqw6vhur3EmcSZzIHEk8SZzITEl8SbXCIsIFwiZVwiXSxcbiAgICBbXCLDrcOsw67Dr8SpxK/Er8yBxKvEr8yEXCIsIFwiaVwiXSxcbiAgICBbXCLDs8Oyw7TDtsO4w7XDs8WNx6vHq8yBx63FkVwiLCBcIm9cIl0sXG4gICAgW1wiw7rDucO7w7zFrcWpw7rFq8WvxbFcIiwgXCJ1XCJdLFxuICAgIFtcIsWExYhcIiwgXCJuXCJdLFxuICAgIFtcIsOnxInEjcSHXCIsIFwiY1wiXSxcbiAgICBbXCLFmVwiLCBcInJcIl0sXG4gICAgW1wixI9cIiwgXCJkXCJdLFxuICAgIFtcIsWlyJtcIiwgXCJ0XCJdLFxuICAgIFtcIsOmXCIsIFwiYWVcIl0sXG4gICAgW1wixZNcIiwgXCJvZVwiXSxcbiAgICBbXCLhuoVcIiwgXCJ3XCJdLFxuICAgIFtcIsSdxJ9nzINcIiwgXCJnXCJdLFxuICAgIFtcIsSlXCIsIFwiaFwiXSxcbiAgICBbXCLEtVwiLCBcImpcIl0sXG4gICAgW1wixYRcIiwgXCJuXCJdLFxuICAgIFtcIsWdxZvFociZXCIsIFwic1wiXSxcbiAgICBbXCLFvMW6xb5cIiwgXCJ6XCJdLFxuICAgIFtcIsO/4bu5w73Dv8W3XCIsIFwieVwiXSxcbiAgICBbXCLFgsS+XCIsIFwibFwiXSxcbiAgICBbXCLYo9il2KJcIiwgXCLYp1wiXSxcbiAgICBbXCLZjlwiLCBcIlwiXSxcbiAgICBbXCLZj1wiLCBcIlwiXSxcbiAgICBbXCLZkFwiLCBcIlwiXSxcbiAgICBbXCLZklwiLCBcIlwiXSxcbiAgICBbXCLZi1wiLCBcIlwiXSxcbiAgICBbXCLZjFwiLCBcIlwiXSxcbiAgICBbXCLZjVwiLCBcIlwiXSxcbiAgICBbXCLZkVwiLCBcIlwiXSxcbl07XG5mdW5jdGlvbiByZXBsYWNlQWNjZW50cyh3b3JkLCBhY2NlbnRzT3ZlcnJpZGUpIHtcbiAgICBsZXQgbmV3V29yZCA9IHdvcmQ7XG4gICAgaWYgKCFhY2NlbnRzICYmICFhY2NlbnRzT3ZlcnJpZGUpXG4gICAgICAgIHJldHVybiBuZXdXb3JkO1xuICAgIGxldCByZWdleDtcbiAgICBjb25zdCBsaXN0ID0gYWNjZW50c092ZXJyaWRlIHx8IGFjY2VudHM7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHJlZ2V4ID0gbmV3IFJlZ0V4cChgWyR7bGlzdFtpXVswXX1dYCwgXCJnaVwiKTtcbiAgICAgICAgbmV3V29yZCA9IG5ld1dvcmQucmVwbGFjZShyZWdleCwgbGlzdFtpXVsxXSk7XG4gICAgfVxuICAgIHJldHVybiBuZXdXb3JkO1xufVxuZXhwb3J0cy5yZXBsYWNlQWNjZW50cyA9IHJlcGxhY2VBY2NlbnRzO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGlkZSA9IGV4cG9ydHMuc2hvdyA9IGV4cG9ydHMudXBkYXRlID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBUZXN0QWN0aXZlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvdGVzdC1hY3RpdmVcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5mdW5jdGlvbiB1cGRhdGUoYWNjKSB7XG4gICAgbGV0IG51bWJlciA9IE1hdGguZmxvb3IoYWNjKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUpIHtcbiAgICAgICAgbnVtYmVyID0gMTAwO1xuICAgIH1cbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLmFjY1wiKS5pbm5lckhUTUwgPVxuICAgICAgICBudW1iZXIgKyBcIiVcIjtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xpdmVBY2NcIikuaW5uZXJIVE1MID0gbnVtYmVyICsgXCIlXCI7XG59XG5leHBvcnRzLnVwZGF0ZSA9IHVwZGF0ZTtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LnNob3dMaXZlQWNjKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKCFUZXN0QWN0aXZlLmdldCgpKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQudGltZXJTdHlsZSA9PT0gXCJtaW5pXCIpIHtcbiAgICAgICAgLy8gJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC53cG1cIikuY3NzKFwib3BhY2l0eVwiLCBDb25maWcudGltZXJPcGFjaXR5KTtcbiAgICAgICAgaWYgKCEkKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLmFjY1wiKS5oYXNDbGFzcyhcImhpZGRlblwiKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC5hY2NcIilcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IGNvbmZpZ18xLmRlZmF1bHQudGltZXJPcGFjaXR5LFxuICAgICAgICB9LCAxMjUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gJChcIiNsaXZlV3BtXCIpLmNzcyhcIm9wYWNpdHlcIiwgQ29uZmlnLnRpbWVyT3BhY2l0eSk7XG4gICAgICAgIGlmICghJChcIiNsaXZlQWNjXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAkKFwiI2xpdmVBY2NcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIikuY3NzKFwib3BhY2l0eVwiLCAwKS5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IGNvbmZpZ18xLmRlZmF1bHQudGltZXJPcGFjaXR5LFxuICAgICAgICB9LCAxMjUpO1xuICAgIH1cbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgIC8vICQoXCIjbGl2ZVdwbVwiKS5jc3MoXCJvcGFjaXR5XCIsIDApO1xuICAgIC8vICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAud3BtXCIpLmNzcyhcIm9wYWNpdHlcIiwgMCk7XG4gICAgJChcIiNsaXZlQWNjXCIpLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiBjb25maWdfMS5kZWZhdWx0LnRpbWVyT3BhY2l0eSxcbiAgICB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgJChcIiNsaXZlQWNjXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xuICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAuYWNjXCIpLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiBjb25maWdfMS5kZWZhdWx0LnRpbWVyT3BhY2l0eSxcbiAgICB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC5hY2NcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfSk7XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSwgZXZlbnRWYWx1ZSkgPT4ge1xuICAgIGlmIChldmVudEtleSA9PT0gXCJzaG93TGl2ZUFjY1wiKVxuICAgICAgICBldmVudFZhbHVlID8gc2hvdygpIDogaGlkZSgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmhpZGUgPSBleHBvcnRzLnNob3cgPSBleHBvcnRzLnVwZGF0ZSA9IHZvaWQgMDtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgVGVzdEFjdGl2ZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3Rlc3QtYWN0aXZlXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuZnVuY3Rpb24gdXBkYXRlKGJ1cnN0KSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LnNob3dMaXZlQnVyc3QpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGxldCBudW1iZXIgPSBidXJzdDtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlKSB7XG4gICAgICAgICAgICBudW1iZXIgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAuYnVyc3RcIikuaW5uZXJIVE1MID1cbiAgICAgICAgICAgIG51bWJlci50b1N0cmluZygpO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xpdmVCdXJzdFwiKS5pbm5lckhUTUwgPVxuICAgICAgICAgICAgbnVtYmVyLnRvU3RyaW5nKCk7XG4gICAgfSk7XG59XG5leHBvcnRzLnVwZGF0ZSA9IHVwZGF0ZTtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LnNob3dMaXZlQnVyc3QpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoIVRlc3RBY3RpdmUuZ2V0KCkpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC50aW1lclN0eWxlID09PSBcIm1pbmlcIikge1xuICAgICAgICBpZiAoISQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAuYnVyc3RcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAuYnVyc3RcIilcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IGNvbmZpZ18xLmRlZmF1bHQudGltZXJPcGFjaXR5LFxuICAgICAgICB9LCAxMjUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKCEkKFwiI2xpdmVCdXJzdFwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgJChcIiNsaXZlQnVyc3RcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIikuY3NzKFwib3BhY2l0eVwiLCAwKS5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IGNvbmZpZ18xLmRlZmF1bHQudGltZXJPcGFjaXR5LFxuICAgICAgICB9LCAxMjUpO1xuICAgIH1cbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgICQoXCIjbGl2ZUJ1cnN0XCIpLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiBjb25maWdfMS5kZWZhdWx0LnRpbWVyT3BhY2l0eSxcbiAgICB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgJChcIiNsaXZlQnVyc3RcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfSk7XG4gICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC5idXJzdFwiKS5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogY29uZmlnXzEuZGVmYXVsdC50aW1lck9wYWNpdHksXG4gICAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAuYnVyc3RcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfSk7XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSwgZXZlbnRWYWx1ZSkgPT4ge1xuICAgIGlmIChldmVudEtleSA9PT0gXCJzaG93TGl2ZUJ1cnN0XCIpXG4gICAgICAgIGV2ZW50VmFsdWUgPyBzaG93KCkgOiBoaWRlKCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmhpZGUgPSBleHBvcnRzLnNob3cgPSBleHBvcnRzLnVwZGF0ZSA9IHZvaWQgMDtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgVGVzdEFjdGl2ZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3Rlc3QtYWN0aXZlXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuY29uc3QgbGl2ZVdwbUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xpdmVXcG1cIik7XG5jb25zdCBtaW5pTGl2ZVdwbUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLndwbVwiKTtcbmZ1bmN0aW9uIHVwZGF0ZSh3cG0sIHJhdykge1xuICAgIC8vIGlmICghVGVzdEFjdGl2ZS5nZXQoKSB8fCAhQ29uZmlnLnNob3dMaXZlV3BtKSB7XG4gICAgLy8gICBoaWRlTGl2ZVdwbSgpO1xuICAgIC8vIH0gZWxzZSB7XG4gICAgLy8gICBzaG93TGl2ZVdwbSgpO1xuICAgIC8vIH1cbiAgICBsZXQgbnVtYmVyID0gd3BtO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSkge1xuICAgICAgICBudW1iZXIgPSByYXc7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0pIHtcbiAgICAgICAgbnVtYmVyID0gTWF0aC5yb3VuZChudW1iZXIgKiA1KTtcbiAgICB9XG4gICAgbWluaUxpdmVXcG1FbGVtZW50LmlubmVySFRNTCA9IG51bWJlci50b1N0cmluZygpO1xuICAgIGxpdmVXcG1FbGVtZW50LmlubmVySFRNTCA9IG51bWJlci50b1N0cmluZygpO1xufVxuZXhwb3J0cy51cGRhdGUgPSB1cGRhdGU7XG5mdW5jdGlvbiBzaG93KCkge1xuICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5zaG93TGl2ZVdwbSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmICghVGVzdEFjdGl2ZS5nZXQoKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnRpbWVyU3R5bGUgPT09IFwibWluaVwiKSB7XG4gICAgICAgIC8vICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAud3BtXCIpLmNzcyhcIm9wYWNpdHlcIiwgQ29uZmlnLnRpbWVyT3BhY2l0eSk7XG4gICAgICAgIGlmICghJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC53cG1cIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAud3BtXCIpXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiBjb25maWdfMS5kZWZhdWx0LnRpbWVyT3BhY2l0eSxcbiAgICAgICAgfSwgMTI1KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vICQoXCIjbGl2ZVdwbVwiKS5jc3MoXCJvcGFjaXR5XCIsIENvbmZpZy50aW1lck9wYWNpdHkpO1xuICAgICAgICBpZiAoISQoXCIjbGl2ZVdwbVwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgJChcIiNsaXZlV3BtXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpLmNzcyhcIm9wYWNpdHlcIiwgMCkuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiBjb25maWdfMS5kZWZhdWx0LnRpbWVyT3BhY2l0eSxcbiAgICAgICAgfSwgMTI1KTtcbiAgICB9XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAkKFwiI2xpdmVXcG1cIikuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IGNvbmZpZ18xLmRlZmF1bHQudGltZXJPcGFjaXR5LFxuICAgIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAkKFwiI2xpdmVXcG1cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfSk7XG4gICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC53cG1cIikuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IGNvbmZpZ18xLmRlZmF1bHQudGltZXJPcGFjaXR5LFxuICAgIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLndwbVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5LCBldmVudFZhbHVlKSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcInNob3dMaXZlV3BtXCIpXG4gICAgICAgIGV2ZW50VmFsdWUgPyBzaG93KCkgOiBoaWRlKCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5nZXQgPSBleHBvcnRzLnJlc2V0ID0gZXhwb3J0cy5zZXQgPSB2b2lkIDA7XG5sZXQgc3RhdGUgPSBmYWxzZTtcbmZ1bmN0aW9uIHNldCgpIHtcbiAgICBzdGF0ZSA9IHRydWU7XG59XG5leHBvcnRzLnNldCA9IHNldDtcbmZ1bmN0aW9uIHJlc2V0KCkge1xuICAgIHN0YXRlID0gZmFsc2U7XG59XG5leHBvcnRzLnJlc2V0ID0gcmVzZXQ7XG5mdW5jdGlvbiBnZXQoKSB7XG4gICAgcmV0dXJuIHN0YXRlO1xufVxuZXhwb3J0cy5nZXQgPSBnZXQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5zaG93ID0gZXhwb3J0cy5zdG9wID0gZXhwb3J0cy50eXBlID0gZXhwb3J0cy51cGRhdGVGYXN0T3BhY2l0eSA9IHZvaWQgMDtcbmNvbnN0IG1pc2NfMSA9IHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmNvbnN0IFRlc3RBY3RpdmUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy90ZXN0LWFjdGl2ZVwiKSk7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5KSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcIm1vbmtleVwiICYmIFRlc3RBY3RpdmUuZ2V0KCkpIHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9ua2V5KSB7XG4gICAgICAgICAgICAkKFwiI21vbmtleVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIjbW9ua2V5XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5sZXQgbGVmdCA9IGZhbHNlO1xubGV0IHJpZ2h0ID0gZmFsc2U7XG4vLyAwIGhhbmQgdXBcbi8vIDEgaGFuZCBkb3duXG4vLyAwMCBib3RoIGhhbmRzIHVwXG4vLyAwMSByaWdodCBoYW5kIGRvd25cbi8vIDEwIGxlZnQgaGFuZCBkb3duXG4vLyAxMSBib3RoIGhhbmRzIGRvd25cbmNvbnN0IGVsZW1lbnRzID0ge1xuICAgIFwiMDBcIjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtb25rZXkgLnVwXCIpLFxuICAgIFwiMDFcIjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtb25rZXkgLnJpZ2h0XCIpLFxuICAgIFwiMTBcIjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtb25rZXkgLmxlZnRcIiksXG4gICAgXCIxMVwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21vbmtleSAuYm90aFwiKSxcbn07XG5jb25zdCBlbGVtZW50c0Zhc3QgPSB7XG4gICAgXCIwMFwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21vbmtleSAuZmFzdCAudXBcIiksXG4gICAgXCIwMVwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21vbmtleSAuZmFzdCAucmlnaHRcIiksXG4gICAgXCIxMFwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21vbmtleSAuZmFzdCAubGVmdFwiKSxcbiAgICBcIjExXCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbW9ua2V5IC5mYXN0IC5ib3RoXCIpLFxufTtcbmxldCBsYXN0ID0gXCJyaWdodFwiO1xuZnVuY3Rpb24gdG9CaXQoYikge1xuICAgIHJldHVybiBiID8gXCIxXCIgOiBcIjBcIjtcbn1cbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQubW9ua2V5KVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKCEoKF9hID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtb25rZXlcIikpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jbGFzc0xpc3QuY29udGFpbnMoXCJoaWRkZW5cIikpKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKGVsZW1lbnRzKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIChfYSA9IGVsZW1lbnRzW2tleV0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmtleXMoZWxlbWVudHNGYXN0KS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIChfYSA9IGVsZW1lbnRzRmFzdFtrZXldKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGlkID0gYCR7dG9CaXQobGVmdCl9JHt0b0JpdChyaWdodCl9YDtcbiAgICAgICAgKF9iID0gZWxlbWVudHNbaWRdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgICAgICAgKF9jID0gZWxlbWVudHNGYXN0W2lkXSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG4gICAgfVxufVxuZnVuY3Rpb24gdXBkYXRlRmFzdE9wYWNpdHkobnVtKSB7XG4gICAgaWYgKCFjb25maWdfMS5kZWZhdWx0Lm1vbmtleSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IG9wYWNpdHkgPSAoMCwgbWlzY18xLm1hcFJhbmdlKShudW0sIDEzMCwgMTgwLCAwLCAxKTtcbiAgICAkKFwiI21vbmtleSAuZmFzdFwiKS5hbmltYXRlKHsgb3BhY2l0eTogb3BhY2l0eSB9LCAxMDAwKTtcbiAgICBsZXQgYW5pbUR1cmF0aW9uID0gKDAsIG1pc2NfMS5tYXBSYW5nZSkobnVtLCAxMzAsIDE4MCwgMC4yNSwgMC4wMSk7XG4gICAgaWYgKGFuaW1EdXJhdGlvbiA9PSAwLjI1KVxuICAgICAgICBhbmltRHVyYXRpb24gPSAwO1xuICAgICQoXCIjbW9ua2V5XCIpLmNzcyh7IGFuaW1hdGlvbkR1cmF0aW9uOiBhbmltRHVyYXRpb24gKyBcInNcIiB9KTtcbn1cbmV4cG9ydHMudXBkYXRlRmFzdE9wYWNpdHkgPSB1cGRhdGVGYXN0T3BhY2l0eTtcbmZ1bmN0aW9uIHR5cGUoKSB7XG4gICAgaWYgKCFjb25maWdfMS5kZWZhdWx0Lm1vbmtleSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmICghbGVmdCAmJiBsYXN0ID09IFwicmlnaHRcIikge1xuICAgICAgICBsZWZ0ID0gdHJ1ZTtcbiAgICAgICAgbGFzdCA9IFwibGVmdFwiO1xuICAgIH1cbiAgICBlbHNlIGlmICghcmlnaHQpIHtcbiAgICAgICAgcmlnaHQgPSB0cnVlO1xuICAgICAgICBsYXN0ID0gXCJyaWdodFwiO1xuICAgIH1cbiAgICB1cGRhdGUoKTtcbn1cbmV4cG9ydHMudHlwZSA9IHR5cGU7XG5mdW5jdGlvbiBzdG9wKCkge1xuICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5tb25rZXkpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAobGVmdCkge1xuICAgICAgICBsZWZ0ID0gZmFsc2U7XG4gICAgfVxuICAgIGVsc2UgaWYgKHJpZ2h0KSB7XG4gICAgICAgIHJpZ2h0ID0gZmFsc2U7XG4gICAgfVxuICAgIHVwZGF0ZSgpO1xufVxuZXhwb3J0cy5zdG9wID0gc3RvcDtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgaWYgKCFjb25maWdfMS5kZWZhdWx0Lm1vbmtleSlcbiAgICAgICAgcmV0dXJuO1xuICAgICQoXCIjbW9ua2V5XCIpXG4gICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTI1KTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgICQoXCIjbW9ua2V5XCIpXG4gICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgJChcIiNtb25rZXlcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfSk7XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2hvdyA9IGV4cG9ydHMuaGlkZSA9IHZvaWQgMDtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3Qgb3V0T2ZGb2N1c1RpbWVvdXRzID0gW107XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgICQoXCIjd29yZHNcIikuY3NzKFwidHJhbnNpdGlvblwiLCBcIm5vbmVcIikucmVtb3ZlQ2xhc3MoXCJibHVycmVkXCIpO1xuICAgICQoXCIub3V0T2ZGb2N1c1dhcm5pbmdcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgTWlzYy5jbGVhclRpbWVvdXRzKG91dE9mRm9jdXNUaW1lb3V0cyk7XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuZnVuY3Rpb24gc2hvdygpIHtcbiAgICBvdXRPZkZvY3VzVGltZW91dHMucHVzaChzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgJChcIiN3b3Jkc1wiKS5jc3MoXCJ0cmFuc2l0aW9uXCIsIFwiMC4yNXNcIikuYWRkQ2xhc3MoXCJibHVycmVkXCIpO1xuICAgICAgICAkKFwiLm91dE9mRm9jdXNXYXJuaW5nXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0sIDEwMDApKTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnN0YXJ0ID0gZXhwb3J0cy5oYW5kbGVTcGFjZSA9IGV4cG9ydHMucmVzZXQgPSBleHBvcnRzLnVwZGF0ZSA9IGV4cG9ydHMuaW5pdCA9IGV4cG9ydHMuc2V0dGluZ3MgPSB2b2lkIDA7XG5jb25zdCBUZXN0U3RhdHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC1zdGF0c1wiKSk7XG5jb25zdCBUZXN0V29yZHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC13b3Jkc1wiKSk7XG5jb25zdCBUZXN0VUkgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC11aVwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBTbG93VGltZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9zbG93LXRpbWVyXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgVGVzdEFjdGl2ZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3Rlc3QtYWN0aXZlXCIpKTtcbmNvbnN0IFRlc3RTdGF0ZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXN0YXRlXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuZXhwb3J0cy5zZXR0aW5ncyA9IG51bGw7XG5mdW5jdGlvbiByZXNldENhcmV0UG9zaXRpb24oKSB7XG4gICAgdmFyIF9hO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnBhY2VDYXJldCA9PT0gXCJvZmZcIiAmJiAhVGVzdFN0YXRlLmlzUGFjZVJlcGVhdClcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmICghJChcIiNwYWNlQ2FyZXRcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNwYWNlQ2FyZXRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiemVuXCIpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBjYXJldCA9ICQoXCIjcGFjZUNhcmV0XCIpO1xuICAgIGNvbnN0IGZpcnN0TGV0dGVyID0gKChfYSA9IGRvY3VtZW50ID09PSBudWxsIHx8IGRvY3VtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3dvcmRzIC53b3JkXCIpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucXVlcnlTZWxlY3RvcihcImxldHRlclwiKSk7XG4gICAgY29uc3QgZmlyc3RMZXR0ZXJIZWlnaHQgPSAkKGZpcnN0TGV0dGVyKS5oZWlnaHQoKTtcbiAgICBpZiAoZmlyc3RMZXR0ZXIgPT09IHVuZGVmaW5lZCB8fCBmaXJzdExldHRlckhlaWdodCA9PT0gdW5kZWZpbmVkKVxuICAgICAgICByZXR1cm47XG4gICAgY2FyZXQuc3RvcCh0cnVlLCB0cnVlKS5hbmltYXRlKHtcbiAgICAgICAgdG9wOiBmaXJzdExldHRlci5vZmZzZXRUb3AgLSBmaXJzdExldHRlckhlaWdodCAvIDQsXG4gICAgICAgIGxlZnQ6IGZpcnN0TGV0dGVyLm9mZnNldExlZnQsXG4gICAgfSwgMCwgXCJsaW5lYXJcIik7XG59XG5mdW5jdGlvbiBpbml0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICQoXCIjcGFjZUNhcmV0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICBjb25zdCBtb2RlMiA9IE1pc2MuZ2V0TW9kZTIoY29uZmlnXzEuZGVmYXVsdCwgVGVzdFdvcmRzLnJhbmRvbVF1b3RlKTtcbiAgICAgICAgbGV0IHdwbTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucGFjZUNhcmV0ID09PSBcInBiXCIpIHtcbiAgICAgICAgICAgIHdwbSA9IHlpZWxkIERCLmdldExvY2FsUEIoY29uZmlnXzEuZGVmYXVsdC5tb2RlLCBtb2RlMiwgY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbiwgY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSwgY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5LCBjb25maWdfMS5kZWZhdWx0LmxhenlNb2RlLCBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5wYWNlQ2FyZXQgPT09IFwiYXZlcmFnZVwiKSB7XG4gICAgICAgICAgICBbd3BtXSA9IHlpZWxkIERCLmdldFVzZXJBdmVyYWdlMTAoY29uZmlnXzEuZGVmYXVsdC5tb2RlLCBtb2RlMiwgY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbiwgY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSwgY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5LCBjb25maWdfMS5kZWZhdWx0LmxhenlNb2RlKTtcbiAgICAgICAgICAgIHdwbSA9IE1hdGgucm91bmQod3BtKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LnBhY2VDYXJldCA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICAgICAgd3BtID0gY29uZmlnXzEuZGVmYXVsdC5wYWNlQ2FyZXRDdXN0b21TcGVlZDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChUZXN0U3RhdGUuaXNQYWNlUmVwZWF0ID09IHRydWUpIHtcbiAgICAgICAgICAgIHdwbSA9IFRlc3RTdGF0cy5sYXN0VGVzdFdwbTtcbiAgICAgICAgfVxuICAgICAgICBpZiAod3BtID09PSB1bmRlZmluZWQgfHwgd3BtIDwgMSB8fCBOdW1iZXIuaXNOYU4od3BtKSkge1xuICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncyA9IG51bGw7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhcmFjdGVycyA9IHdwbSAqIDU7XG4gICAgICAgIGNvbnN0IGNwcyA9IGNoYXJhY3RlcnMgLyA2MDsgLy9jaGFyYWN0ZXJzIHBlciBzdGVwXG4gICAgICAgIGNvbnN0IHNwYyA9IDYwIC8gY2hhcmFjdGVyczsgLy9zZWNvbmRzIHBlciBjaGFyYWN0ZXJcbiAgICAgICAgZXhwb3J0cy5zZXR0aW5ncyA9IHtcbiAgICAgICAgICAgIHdwbTogd3BtLFxuICAgICAgICAgICAgY3BzOiBjcHMsXG4gICAgICAgICAgICBzcGM6IHNwYyxcbiAgICAgICAgICAgIGNvcnJlY3Rpb246IDAsXG4gICAgICAgICAgICBjdXJyZW50V29yZEluZGV4OiAwLFxuICAgICAgICAgICAgY3VycmVudExldHRlckluZGV4OiAtMSxcbiAgICAgICAgICAgIHdvcmRzU3RhdHVzOiB7fSxcbiAgICAgICAgICAgIHRpbWVvdXQ6IG51bGwsXG4gICAgICAgIH07XG4gICAgICAgIHJlc2V0Q2FyZXRQb3NpdGlvbigpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5pbml0ID0gaW5pdDtcbmZ1bmN0aW9uIHVwZGF0ZShleHBlY3RlZFN0ZXBFbmQpIHtcbiAgICBpZiAoZXhwb3J0cy5zZXR0aW5ncyA9PT0gbnVsbCB8fCAhVGVzdEFjdGl2ZS5nZXQoKSB8fCBUZXN0VUkucmVzdWx0VmlzaWJsZSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIGlmICgkKFwiI3BhY2VDYXJldFwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgIC8vICAgJChcIiNwYWNlQ2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgLy8gfVxuICAgIHRyeSB7XG4gICAgICAgIGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudExldHRlckluZGV4Kys7XG4gICAgICAgIGlmIChleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRMZXR0ZXJJbmRleCA+PVxuICAgICAgICAgICAgVGVzdFdvcmRzLndvcmRzLmdldChleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRXb3JkSW5kZXgpLmxlbmd0aCkge1xuICAgICAgICAgICAgLy9nbyB0byB0aGUgbmV4dCB3b3JkXG4gICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRMZXR0ZXJJbmRleCA9IC0xO1xuICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50V29yZEluZGV4Kys7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSkge1xuICAgICAgICAgICAgaWYgKGV4cG9ydHMuc2V0dGluZ3MuY29ycmVjdGlvbiA8IDApIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAoZXhwb3J0cy5zZXR0aW5ncy5jb3JyZWN0aW9uIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRMZXR0ZXJJbmRleC0tO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50TGV0dGVySW5kZXggPD0gLTIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZ28gdG8gdGhlIHByZXZpb3VzIHdvcmRcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudExldHRlckluZGV4ID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXN0V29yZHMud29yZHMuZ2V0KGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudFdvcmRJbmRleCAtIDEpLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRXb3JkSW5kZXgtLTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzLmNvcnJlY3Rpb24rKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChleHBvcnRzLnNldHRpbmdzLmNvcnJlY3Rpb24gPiAwKSB7XG4gICAgICAgICAgICAgICAgd2hpbGUgKGV4cG9ydHMuc2V0dGluZ3MuY29ycmVjdGlvbiA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50TGV0dGVySW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudExldHRlckluZGV4ID49XG4gICAgICAgICAgICAgICAgICAgICAgICBUZXN0V29yZHMud29yZHMuZ2V0KGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudFdvcmRJbmRleCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2dvIHRvIHRoZSBuZXh0IHdvcmRcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudExldHRlckluZGV4ID0gLTE7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRXb3JkSW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzLmNvcnJlY3Rpb24tLTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgLy9vdXQgb2Ygd29yZHNcbiAgICAgICAgZXhwb3J0cy5zZXR0aW5ncyA9IG51bGw7XG4gICAgICAgICQoXCIjcGFjZUNhcmV0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNhcmV0ID0gJChcIiNwYWNlQ2FyZXRcIik7XG4gICAgICAgIGxldCBjdXJyZW50TGV0dGVyO1xuICAgICAgICBsZXQgbmV3VG9wO1xuICAgICAgICBsZXQgbmV3TGVmdDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0luZGV4ID0gZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50V29yZEluZGV4IC1cbiAgICAgICAgICAgICAgICAoVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleCAtIFRlc3RVSS5jdXJyZW50V29yZEVsZW1lbnRJbmRleCk7XG4gICAgICAgICAgICBjb25zdCB3b3JkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIiN3b3JkcyAud29yZFwiKVtuZXdJbmRleF07XG4gICAgICAgICAgICBpZiAoZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50TGV0dGVySW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudExldHRlciA9IHdvcmQucXVlcnlTZWxlY3RvckFsbChcImxldHRlclwiKVswXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRMZXR0ZXIgPSAod29yZC5xdWVyeVNlbGVjdG9yQWxsKFwibGV0dGVyXCIpW2V4cG9ydHMuc2V0dGluZ3MuY3VycmVudExldHRlckluZGV4XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50TGV0dGVySGVpZ2h0ID0gJChjdXJyZW50TGV0dGVyKS5oZWlnaHQoKSwgY3VycmVudExldHRlcldpZHRoID0gJChjdXJyZW50TGV0dGVyKS53aWR0aCgpLCBjYXJldFdpZHRoID0gY2FyZXQud2lkdGgoKTtcbiAgICAgICAgICAgIGlmIChjdXJyZW50TGV0dGVySGVpZ2h0ID09PSB1bmRlZmluZWQgfHxcbiAgICAgICAgICAgICAgICBjdXJyZW50TGV0dGVyV2lkdGggPT09IHVuZGVmaW5lZCB8fFxuICAgICAgICAgICAgICAgIGNhcmV0V2lkdGggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRocm93IGBgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmV3VG9wID0gY3VycmVudExldHRlci5vZmZzZXRUb3AgLSBjdXJyZW50TGV0dGVySGVpZ2h0IC8gNTtcbiAgICAgICAgICAgIG5ld0xlZnQ7XG4gICAgICAgICAgICBpZiAoZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50TGV0dGVySW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgbmV3TGVmdCA9IGN1cnJlbnRMZXR0ZXIub2Zmc2V0TGVmdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG5ld0xlZnQgPVxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGV0dGVyLm9mZnNldExlZnQgKyBjdXJyZW50TGV0dGVyV2lkdGggLSBjYXJldFdpZHRoIC8gMjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhcmV0LnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjYXJldC5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkdXJhdGlvbiA9IGV4cGVjdGVkU3RlcEVuZCAtIHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgICBpZiAobmV3VG9wICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGxldCBzbW9vdGhsaW5lc2Nyb2xsID0gJChcIiN3b3JkcyAuc21vb3RoU2Nyb2xsZXJcIikuaGVpZ2h0KCk7XG4gICAgICAgICAgICBpZiAoc21vb3RobGluZXNjcm9sbCA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgIHNtb290aGxpbmVzY3JvbGwgPSAwO1xuICAgICAgICAgICAgJChcIiNwYWNlQ2FyZXRcIikuY3NzKHtcbiAgICAgICAgICAgICAgICB0b3A6IG5ld1RvcCAtIHNtb290aGxpbmVzY3JvbGwsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnNtb290aENhcmV0KSB7XG4gICAgICAgICAgICAgICAgY2FyZXQuc3RvcCh0cnVlLCB0cnVlKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogbmV3TGVmdCxcbiAgICAgICAgICAgICAgICB9LCBTbG93VGltZXIuZ2V0KCkgPyAwIDogZHVyYXRpb24sIFwibGluZWFyXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY2FyZXQuc3RvcCh0cnVlLCB0cnVlKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogbmV3TGVmdCxcbiAgICAgICAgICAgICAgICB9LCAwLCBcImxpbmVhclwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBleHBvcnRzLnNldHRpbmdzLnRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlKGV4cGVjdGVkU3RlcEVuZCArICgoX2EgPSBleHBvcnRzLnNldHRpbmdzID09PSBudWxsIHx8IGV4cG9ydHMuc2V0dGluZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV4cG9ydHMuc2V0dGluZ3Muc3BjKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAwKSAqIDEwMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZHVyYXRpb24pO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAkKFwiI3BhY2VDYXJldFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG59XG5leHBvcnRzLnVwZGF0ZSA9IHVwZGF0ZTtcbmZ1bmN0aW9uIHJlc2V0KCkge1xuICAgIGlmIChleHBvcnRzLnNldHRpbmdzICE9PSBudWxsICYmIGV4cG9ydHMuc2V0dGluZ3MudGltZW91dCAhPT0gbnVsbCkge1xuICAgICAgICBjbGVhclRpbWVvdXQoZXhwb3J0cy5zZXR0aW5ncy50aW1lb3V0KTtcbiAgICB9XG4gICAgZXhwb3J0cy5zZXR0aW5ncyA9IG51bGw7XG59XG5leHBvcnRzLnJlc2V0ID0gcmVzZXQ7XG5mdW5jdGlvbiBoYW5kbGVTcGFjZShjb3JyZWN0LCBjdXJyZW50V29yZCkge1xuICAgIGlmIChjb3JyZWN0KSB7XG4gICAgICAgIGlmIChleHBvcnRzLnNldHRpbmdzICE9PSBudWxsICYmXG4gICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzLndvcmRzU3RhdHVzW1Rlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXhdID09PSB0cnVlICYmXG4gICAgICAgICAgICAhY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUpIHtcbiAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3Mud29yZHNTdGF0dXNbVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleF0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzLmNvcnJlY3Rpb24gLT0gY3VycmVudFdvcmQubGVuZ3RoICsgMTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGV4cG9ydHMuc2V0dGluZ3MgIT09IG51bGwgJiZcbiAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3Mud29yZHNTdGF0dXNbVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleF0gPT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgICAgIWNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlKSB7XG4gICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzLndvcmRzU3RhdHVzW1Rlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXhdID0gdHJ1ZTtcbiAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3MuY29ycmVjdGlvbiArPSBjdXJyZW50V29yZC5sZW5ndGggKyAxO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5oYW5kbGVTcGFjZSA9IGhhbmRsZVNwYWNlO1xuZnVuY3Rpb24gc3RhcnQoKSB7XG4gICAgdmFyIF9hO1xuICAgIHVwZGF0ZShwZXJmb3JtYW5jZS5ub3coKSArICgoX2EgPSBleHBvcnRzLnNldHRpbmdzID09PSBudWxsIHx8IGV4cG9ydHMuc2V0dGluZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV4cG9ydHMuc2V0dGluZ3Muc3BjKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAwKSAqIDEwMDApO1xufVxuZXhwb3J0cy5zdGFydCA9IHN0YXJ0O1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSkgPT4ge1xuICAgIGlmIChldmVudEtleSA9PT0gXCJwYWNlQ2FyZXRcIilcbiAgICAgICAgaW5pdCgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2hvdyA9IGV4cG9ydHMuaGlkZSA9IHZvaWQgMDtcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLmNyb3duXCIpLmNzcyhcIm9wYWNpdHlcIiwgMCkuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuZnVuY3Rpb24gc2hvdygpIHtcbiAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAuY3Jvd25cIilcbiAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIFwiMFwiKVxuICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IDEsXG4gICAgfSwgMjUwLCBcImVhc2VPdXRDdWJpY1wiKTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5nZXRQb2VtID0gZXhwb3J0cy5Qb2VtID0gdm9pZCAwO1xuY29uc3QgYXhpb3NfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiYXhpb3NcIikpO1xuY29uc3QgYmFubmVkQ2hhcnMgPSBbXCLigJRcIiwgXCJfXCIsIFwiIFwiXTtcbmNvbnN0IG1heFdvcmRzID0gMTAwO1xuY29uc3QgYXBpVVJMID0gXCJodHRwczovL3BvZXRyeWRiLm9yZy9yYW5kb21cIjtcbmNsYXNzIFBvZW0ge1xuICAgIGNvbnN0cnVjdG9yKHRpdGxlLCBhdXRob3IsIHdvcmRzKSB7XG4gICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgdGhpcy5hdXRob3IgPSBhdXRob3I7XG4gICAgICAgIHRoaXMud29yZHMgPSB3b3JkcztcbiAgICAgICAgdGhpcy5jbGVhblVwVGV4dCgpO1xuICAgIH1cbiAgICBjbGVhblVwVGV4dCgpIHtcbiAgICAgICAgbGV0IGNvdW50ID0gMDtcbiAgICAgICAgY29uc3Qgc2NydWJiZWRXb3JkcyA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMud29yZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBzY3J1YmJlZCA9IFwiXCI7XG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMud29yZHNbaV0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoIWJhbm5lZENoYXJzLmluY2x1ZGVzKHRoaXMud29yZHNbaV1bal0pKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjcnViYmVkICs9IHRoaXMud29yZHNbaV1bal07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNjcnViYmVkID09IFwiXCIpXG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICBzY3J1YmJlZFdvcmRzLnB1c2goc2NydWJiZWQpO1xuICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgICAgIGlmIChjb3VudCA9PSBtYXhXb3JkcylcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLndvcmRzID0gc2NydWJiZWRXb3JkcztcbiAgICB9XG59XG5leHBvcnRzLlBvZW0gPSBQb2VtO1xuZnVuY3Rpb24gZ2V0UG9lbSgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIkdldHRpbmcgcG9lbVwiKTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBheGlvc18xLmRlZmF1bHQuZ2V0KGFwaVVSTCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBwb2VtT2JqID0gcmVzcG9uc2UuZGF0YVswXTtcbiAgICAgICAgICAgIGNvbnN0IHdvcmRzID0gW107XG4gICAgICAgICAgICBwb2VtT2JqLmxpbmVzLmZvckVhY2goKGxpbmUpID0+IHtcbiAgICAgICAgICAgICAgICBsaW5lLnNwbGl0KC8gKy8pLmZvckVhY2goKHdvcmQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgd29yZHMucHVzaCh3b3JkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQb2VtKHBvZW1PYmoudGl0bGUsIHBvZW1PYmouYXV0aG9yLCB3b3Jkcyk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0UG9lbSA9IGdldFBvZW07XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5oaWRlUG9wdXAgPSBleHBvcnRzLnNob3dQb3B1cCA9IGV4cG9ydHMucmVzZXRCZWZvcmUgPSBleHBvcnRzLmluaXQgPSBleHBvcnRzLmJlZm9yZSA9IHZvaWQgMDtcbmNvbnN0IFRlc3RXb3JkcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXdvcmRzXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgQ3VzdG9tVGV4dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jdXN0b20tdGV4dFwiKSk7XG5jb25zdCBUZXN0SW5wdXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC1pbnB1dFwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmV4cG9ydHMuYmVmb3JlID0ge1xuICAgIG1vZGU6IG51bGwsXG4gICAgcHVuY3R1YXRpb246IG51bGwsXG4gICAgbnVtYmVyczogbnVsbCxcbn07XG5mdW5jdGlvbiBpbml0KG1pc3NlZCwgc2xvdykge1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiemVuXCIpXG4gICAgICAgIHJldHVybjtcbiAgICBsZXQgbGltaXQ7XG4gICAgaWYgKChtaXNzZWQgJiYgIXNsb3cpIHx8ICghbWlzc2VkICYmIHNsb3cpKSB7XG4gICAgICAgIGxpbWl0ID0gMjA7XG4gICAgfVxuICAgIGVsc2UgaWYgKG1pc3NlZCAmJiBzbG93KSB7XG4gICAgICAgIGxpbWl0ID0gMTA7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBsaW1pdCA9IDEwO1xuICAgIH1cbiAgICBsZXQgc29ydGFibGVNaXNzZWRXb3JkcyA9IFtdO1xuICAgIGlmIChtaXNzZWQpIHtcbiAgICAgICAgT2JqZWN0LmtleXMoVGVzdElucHV0Lm1pc3NlZFdvcmRzKS5mb3JFYWNoKChtaXNzZWRXb3JkKSA9PiB7XG4gICAgICAgICAgICBzb3J0YWJsZU1pc3NlZFdvcmRzLnB1c2goW21pc3NlZFdvcmQsIFRlc3RJbnB1dC5taXNzZWRXb3Jkc1ttaXNzZWRXb3JkXV0pO1xuICAgICAgICB9KTtcbiAgICAgICAgc29ydGFibGVNaXNzZWRXb3Jkcy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYlsxXSAtIGFbMV07XG4gICAgICAgIH0pO1xuICAgICAgICBzb3J0YWJsZU1pc3NlZFdvcmRzID0gc29ydGFibGVNaXNzZWRXb3Jkcy5zbGljZSgwLCBsaW1pdCk7XG4gICAgfVxuICAgIGlmIChtaXNzZWQgJiYgIXNsb3cgJiYgc29ydGFibGVNaXNzZWRXb3Jkcy5sZW5ndGggPT0gMCkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIllvdSBoYXZlbid0IG1pc3NlZCBhbnkgd29yZHNcIiwgMCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IHNvcnRhYmxlU2xvd1dvcmRzID0gW107XG4gICAgaWYgKHNsb3cpIHtcbiAgICAgICAgc29ydGFibGVTbG93V29yZHMgPSBUZXN0V29yZHMud29yZHMuZ2V0KCkubWFwKChlLCBpKSA9PiBbXG4gICAgICAgICAgICBlLFxuICAgICAgICAgICAgVGVzdElucHV0LmJ1cnN0SGlzdG9yeVtpXSxcbiAgICAgICAgXSk7XG4gICAgICAgIHNvcnRhYmxlU2xvd1dvcmRzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBhWzFdIC0gYlsxXTtcbiAgICAgICAgfSk7XG4gICAgICAgIHNvcnRhYmxlU2xvd1dvcmRzID0gc29ydGFibGVTbG93V29yZHMuc2xpY2UoMCwgTWF0aC5taW4obGltaXQsIE1hdGgucm91bmQoVGVzdFdvcmRzLndvcmRzLmxlbmd0aCAqIDAuMikpKTtcbiAgICB9XG4gICAgLy8gY29uc29sZS5sb2coc29ydGFibGVNaXNzZWRXb3Jkcyk7XG4gICAgLy8gY29uc29sZS5sb2coc29ydGFibGVTbG93V29yZHMpO1xuICAgIGlmIChzb3J0YWJsZU1pc3NlZFdvcmRzLmxlbmd0aCA9PSAwICYmIHNvcnRhYmxlU2xvd1dvcmRzLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ291bGQgbm90IHN0YXJ0IGEgbmV3IGN1c3RvbSB0ZXN0XCIsIDApO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG5ld0N1c3RvbVRleHQgPSBbXTtcbiAgICBzb3J0YWJsZU1pc3NlZFdvcmRzLmZvckVhY2goKG1pc3NlZCkgPT4ge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1pc3NlZFsxXTsgaSsrKSB7XG4gICAgICAgICAgICBuZXdDdXN0b21UZXh0LnB1c2gobWlzc2VkWzBdKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHNvcnRhYmxlU2xvd1dvcmRzLmZvckVhY2goKHNsb3csIGluZGV4KSA9PiB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc29ydGFibGVTbG93V29yZHMubGVuZ3RoIC0gaW5kZXg7IGkrKykge1xuICAgICAgICAgICAgbmV3Q3VzdG9tVGV4dC5wdXNoKHNsb3dbMF0pO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgLy8gY29uc29sZS5sb2cobmV3Q3VzdG9tVGV4dCk7XG4gICAgY29uc3QgbW9kZSA9IGV4cG9ydHMuYmVmb3JlLm1vZGUgPT09IG51bGwgPyBjb25maWdfMS5kZWZhdWx0Lm1vZGUgOiBleHBvcnRzLmJlZm9yZS5tb2RlO1xuICAgIGNvbnN0IHB1bmN0dWF0aW9uID0gZXhwb3J0cy5iZWZvcmUucHVuY3R1YXRpb24gPT09IG51bGwgPyBjb25maWdfMS5kZWZhdWx0LnB1bmN0dWF0aW9uIDogZXhwb3J0cy5iZWZvcmUucHVuY3R1YXRpb247XG4gICAgY29uc3QgbnVtYmVycyA9IGV4cG9ydHMuYmVmb3JlLm51bWJlcnMgPT09IG51bGwgPyBjb25maWdfMS5kZWZhdWx0Lm51bWJlcnMgOiBleHBvcnRzLmJlZm9yZS5udW1iZXJzO1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwiY3VzdG9tXCIpO1xuICAgIEN1c3RvbVRleHQuc2V0VGV4dChuZXdDdXN0b21UZXh0KTtcbiAgICBDdXN0b21UZXh0LnNldElzV29yZFJhbmRvbSh0cnVlKTtcbiAgICBDdXN0b21UZXh0LnNldFdvcmQoKHNvcnRhYmxlU2xvd1dvcmRzLmxlbmd0aCArIHNvcnRhYmxlTWlzc2VkV29yZHMubGVuZ3RoKSAqIDUpO1xuICAgIEN1c3RvbVRleHQuc2V0VGltZSgtMSk7XG4gICAgZXhwb3J0cy5iZWZvcmUubW9kZSA9IG1vZGU7XG4gICAgZXhwb3J0cy5iZWZvcmUucHVuY3R1YXRpb24gPSBwdW5jdHVhdGlvbjtcbiAgICBleHBvcnRzLmJlZm9yZS5udW1iZXJzID0gbnVtYmVycztcbn1cbmV4cG9ydHMuaW5pdCA9IGluaXQ7XG5mdW5jdGlvbiByZXNldEJlZm9yZSgpIHtcbiAgICBleHBvcnRzLmJlZm9yZS5tb2RlID0gbnVsbDtcbiAgICBleHBvcnRzLmJlZm9yZS5wdW5jdHVhdGlvbiA9IG51bGw7XG4gICAgZXhwb3J0cy5iZWZvcmUubnVtYmVycyA9IG51bGw7XG59XG5leHBvcnRzLnJlc2V0QmVmb3JlID0gcmVzZXRCZWZvcmU7XG5mdW5jdGlvbiBzaG93UG9wdXAoZm9jdXMgPSBmYWxzZSkge1xuICAgIGlmICgkKFwiI3ByYWN0aXNlV29yZHNQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ6ZW5cIikge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJQcmFjdGljZSB3b3JkcyBpcyB1bnN1cHBvcnRlZCBpbiB6ZW4gbW9kZVwiLCAwKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAkKFwiI3ByYWN0aXNlV29yZHNQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoZm9jdXMpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImZvY3VzaW5nXCIpO1xuICAgICAgICAgICAgICAgICQoXCIjcHJhY3Rpc2VXb3Jkc1BvcHVwIC5taXNzZWRcIikudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLnNob3dQb3B1cCA9IHNob3dQb3B1cDtcbmZ1bmN0aW9uIGhpZGVQb3B1cCgpIHtcbiAgICBpZiAoISQoXCIjcHJhY3Rpc2VXb3Jkc1BvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI3ByYWN0aXNlV29yZHNQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3ByYWN0aXNlV29yZHNQb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuaGlkZVBvcHVwID0gaGlkZVBvcHVwO1xuJChcIiNwcmFjdGlzZVdvcmRzUG9wdXBXcmFwcGVyXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcInByYWN0aXNlV29yZHNQb3B1cFdyYXBwZXJcIikge1xuICAgICAgICBoaWRlUG9wdXAoKTtcbiAgICB9XG59KTtcbiQoXCIjcHJhY3Rpc2VXb3Jkc1BvcHVwIC5idXR0b25cIikub24oXCJrZXlwcmVzc1wiLCAoZSkgPT4ge1xuICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICQoZS5jdXJyZW50VGFyZ2V0KS5jbGljaygpO1xuICAgIH1cbn0pO1xuJChcIiNwcmFjdGlzZVdvcmRzUG9wdXAgLmJ1dHRvbi5ib3RoXCIpLm9uKFwiZm9jdXNvdXRcIiwgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgJChcIiNwcmFjdGlzZVdvcmRzUG9wdXAgLm1pc3NlZFwiKS50cmlnZ2VyKFwiZm9jdXNcIik7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwia2V5ZG93blwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiICYmXG4gICAgICAgICEkKFwiI3ByYWN0aXNlV29yZHNQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgaGlkZVBvcHVwKCk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50KS5vbihcImtleXByZXNzXCIsIFwiI3ByYWN0aXNlV29yZHNCdXR0b25cIiwgKGV2ZW50KSA9PiB7XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIHNob3dQb3B1cCh0cnVlKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQuYm9keSkub24oXCJjbGlja1wiLCBcIiNwcmFjdGlzZVdvcmRzQnV0dG9uXCIsICgpID0+IHtcbiAgICBzaG93UG9wdXAoKTtcbn0pO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSkgPT4ge1xuICAgIGlmIChldmVudEtleSA9PT0gXCJtb2RlXCIpXG4gICAgICAgIHJlc2V0QmVmb3JlKCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG52YXIgX2E7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmdldFJlcGxheUV4cG9ydCA9IGV4cG9ydHMucmVwbGF5R2V0V29yZHNMaXN0ID0gZXhwb3J0cy5hZGRSZXBsYXlFdmVudCA9IGV4cG9ydHMuc3RvcFJlcGxheVJlY29yZGluZyA9IGV4cG9ydHMuc3RhcnRSZXBsYXlSZWNvcmRpbmcgPSBleHBvcnRzLnBhdXNlUmVwbGF5ID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBTb3VuZCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvc291bmQtY29udHJvbGxlclwiKSk7XG5sZXQgd29yZHNMaXN0ID0gW107XG5sZXQgcmVwbGF5RGF0YSA9IFtdO1xubGV0IHJlcGxheVN0YXJ0VGltZSA9IDA7XG5sZXQgcmVwbGF5UmVjb3JkaW5nID0gdHJ1ZTtcbmxldCB3b3JkUG9zID0gMDtcbmxldCBjdXJQb3MgPSAwO1xubGV0IHRhcmdldFdvcmRQb3MgPSAwO1xubGV0IHRhcmdldEN1clBvcyA9IDA7XG5sZXQgdGltZW91dExpc3QgPSBbXTtcbmxldCBzdG9wd2F0Y2hMaXN0ID0gW107XG5jb25zdCB0b2dnbGVCdXR0b24gPSAoX2EgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBsYXlwYXVzZVJlcGxheUJ1dHRvblwiKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNoaWxkcmVuWzBdO1xuZnVuY3Rpb24gcmVwbGF5R2V0V29yZHNMaXN0KHdvcmRzTGlzdEZyb21TY3JpcHQpIHtcbiAgICB3b3Jkc0xpc3QgPSB3b3Jkc0xpc3RGcm9tU2NyaXB0O1xufVxuZXhwb3J0cy5yZXBsYXlHZXRXb3Jkc0xpc3QgPSByZXBsYXlHZXRXb3Jkc0xpc3Q7XG5mdW5jdGlvbiBpbml0aWFsaXplUmVwbGF5UHJvbXB0KCkge1xuICAgIGNvbnN0IHJlcGxheVdvcmRzRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVwbGF5V29yZHNcIik7XG4gICAgaWYgKHJlcGxheVdvcmRzRWxlbWVudCA9PT0gbnVsbClcbiAgICAgICAgcmV0dXJuO1xuICAgIHJlcGxheVdvcmRzRWxlbWVudC5pbm5lckhUTUwgPSBcIlwiO1xuICAgIGxldCB3b3JkQ291bnQgPSAwO1xuICAgIHJlcGxheURhdGEuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAvL3RyaW0gd29yZHNMaXN0IGZvciB0aW1lZCB0ZXN0c1xuICAgICAgICBpZiAoaXRlbS5hY3Rpb24gPT09IFwiYmFja1dvcmRcIikge1xuICAgICAgICAgICAgd29yZENvdW50LS07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaXRlbS5hY3Rpb24gPT09IFwic3VibWl0Q29ycmVjdFdvcmRcIiB8fFxuICAgICAgICAgICAgaXRlbS5hY3Rpb24gPT09IFwic3VibWl0RXJyb3JXb3JkXCIpIHtcbiAgICAgICAgICAgIHdvcmRDb3VudCsrO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgd29yZHNMaXN0LmZvckVhY2goKGl0ZW0sIGkpID0+IHtcbiAgICAgICAgaWYgKGkgPiB3b3JkQ291bnQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IHggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICB4LmNsYXNzTmFtZSA9IFwid29yZFwiO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaXRlbS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgbGV0dGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxldHRlclwiKTtcbiAgICAgICAgICAgIGxldHRlci5pbm5lckhUTUwgPSBpdGVtW2ldO1xuICAgICAgICAgICAgeC5hcHBlbmRDaGlsZChsZXR0ZXIpO1xuICAgICAgICB9XG4gICAgICAgIHJlcGxheVdvcmRzRWxlbWVudC5hcHBlbmRDaGlsZCh4KTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHBhdXNlUmVwbGF5KCkge1xuICAgIHZhciBfYTtcbiAgICB0aW1lb3V0TGlzdC5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgIGNsZWFyVGltZW91dChpdGVtKTtcbiAgICB9KTtcbiAgICB0aW1lb3V0TGlzdCA9IFtdO1xuICAgIHN0b3B3YXRjaExpc3QuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBjbGVhclRpbWVvdXQoaXRlbSk7XG4gICAgfSk7XG4gICAgc3RvcHdhdGNoTGlzdCA9IFtdO1xuICAgIHRhcmdldEN1clBvcyA9IGN1clBvcztcbiAgICB0YXJnZXRXb3JkUG9zID0gd29yZFBvcztcbiAgICBpZiAodG9nZ2xlQnV0dG9uID09PSB1bmRlZmluZWQpXG4gICAgICAgIHJldHVybjtcbiAgICB0b2dnbGVCdXR0b24uY2xhc3NOYW1lID0gXCJmYXMgZmEtcGxheVwiO1xuICAgIChfYSA9IHRvZ2dsZUJ1dHRvbi5wYXJlbnROb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCBcIlJlc3VtZSByZXBsYXlcIik7XG59XG5leHBvcnRzLnBhdXNlUmVwbGF5ID0gcGF1c2VSZXBsYXk7XG5mdW5jdGlvbiBwbGF5U291bmQoZXJyb3IgPSBmYWxzZSkge1xuICAgIGlmIChlcnJvcikge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5wbGF5U291bmRPbkVycm9yKSB7XG4gICAgICAgICAgICBTb3VuZC5wbGF5RXJyb3IoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICB9XG59XG5mdW5jdGlvbiBoYW5kbGVEaXNwbGF5TG9naWMoaXRlbSwgbm9zb3VuZCA9IGZhbHNlKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgbGV0IGFjdGl2ZVdvcmQgPSAoX2EgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlcGxheVdvcmRzXCIpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2hpbGRyZW5bd29yZFBvc107XG4gICAgaWYgKGFjdGl2ZVdvcmQgPT09IHVuZGVmaW5lZClcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChpdGVtLmFjdGlvbiA9PT0gXCJjb3JyZWN0TGV0dGVyXCIpIHtcbiAgICAgICAgaWYgKCFub3NvdW5kKVxuICAgICAgICAgICAgcGxheVNvdW5kKCk7XG4gICAgICAgIGFjdGl2ZVdvcmQuY2hpbGRyZW5bY3VyUG9zXS5jbGFzc0xpc3QuYWRkKFwiY29ycmVjdFwiKTtcbiAgICAgICAgY3VyUG9zKys7XG4gICAgfVxuICAgIGVsc2UgaWYgKGl0ZW0uYWN0aW9uID09PSBcImluY29ycmVjdExldHRlclwiKSB7XG4gICAgICAgIGlmICghbm9zb3VuZClcbiAgICAgICAgICAgIHBsYXlTb3VuZCh0cnVlKTtcbiAgICAgICAgbGV0IG15RWxlbWVudDtcbiAgICAgICAgaWYgKGN1clBvcyA+PSBhY3RpdmVXb3JkLmNoaWxkcmVuLmxlbmd0aCkge1xuICAgICAgICAgICAgLy9pZiBsZXR0ZXIgaXMgYW4gZXh0cmFcbiAgICAgICAgICAgIG15RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsZXR0ZXJcIik7XG4gICAgICAgICAgICBteUVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImV4dHJhXCIpO1xuICAgICAgICAgICAgbXlFbGVtZW50LmlubmVySFRNTCA9IChfYyA9IChfYiA9IGl0ZW0udmFsdWUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50b1N0cmluZygpKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiBcIlwiO1xuICAgICAgICAgICAgYWN0aXZlV29yZC5hcHBlbmRDaGlsZChteUVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIG15RWxlbWVudCA9IGFjdGl2ZVdvcmQuY2hpbGRyZW5bY3VyUG9zXTtcbiAgICAgICAgbXlFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJpbmNvcnJlY3RcIik7XG4gICAgICAgIGN1clBvcysrO1xuICAgIH1cbiAgICBlbHNlIGlmIChpdGVtLmFjdGlvbiA9PT0gXCJzZXRMZXR0ZXJJbmRleFwiICYmXG4gICAgICAgIHR5cGVvZiBpdGVtLnZhbHVlID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgIGlmICghbm9zb3VuZClcbiAgICAgICAgICAgIHBsYXlTb3VuZCgpO1xuICAgICAgICBjdXJQb3MgPSBpdGVtLnZhbHVlO1xuICAgICAgICAvLyByZW1vdmUgYWxsIGxldHRlcnMgZnJvbSBjdXJzb3IgdG8gZW5kIG9mIHdvcmRcbiAgICAgICAgZm9yIChjb25zdCBteUVsZW1lbnQgb2YgWy4uLmFjdGl2ZVdvcmQuY2hpbGRyZW5dLnNsaWNlKGN1clBvcykpIHtcbiAgICAgICAgICAgIGlmIChteUVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiZXh0cmFcIikpIHtcbiAgICAgICAgICAgICAgICBteUVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBteUVsZW1lbnQuY2xhc3NOYW1lID0gXCJcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChpdGVtLmFjdGlvbiA9PT0gXCJzdWJtaXRDb3JyZWN0V29yZFwiKSB7XG4gICAgICAgIGlmICghbm9zb3VuZClcbiAgICAgICAgICAgIHBsYXlTb3VuZCgpO1xuICAgICAgICB3b3JkUG9zKys7XG4gICAgICAgIGN1clBvcyA9IDA7XG4gICAgfVxuICAgIGVsc2UgaWYgKGl0ZW0uYWN0aW9uID09PSBcInN1Ym1pdEVycm9yV29yZFwiKSB7XG4gICAgICAgIGlmICghbm9zb3VuZClcbiAgICAgICAgICAgIHBsYXlTb3VuZCh0cnVlKTtcbiAgICAgICAgYWN0aXZlV29yZC5jbGFzc0xpc3QuYWRkKFwiZXJyb3JcIik7XG4gICAgICAgIHdvcmRQb3MrKztcbiAgICAgICAgY3VyUG9zID0gMDtcbiAgICB9XG4gICAgZWxzZSBpZiAoaXRlbS5hY3Rpb24gPT09IFwiYmFja1dvcmRcIikge1xuICAgICAgICBpZiAoIW5vc291bmQpXG4gICAgICAgICAgICBwbGF5U291bmQoKTtcbiAgICAgICAgd29yZFBvcy0tO1xuICAgICAgICBjb25zdCByZXBsYXlXb3JkcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVwbGF5V29yZHNcIik7XG4gICAgICAgIGlmIChyZXBsYXlXb3JkcyAhPT0gbnVsbClcbiAgICAgICAgICAgIGFjdGl2ZVdvcmQgPSByZXBsYXlXb3Jkcy5jaGlsZHJlblt3b3JkUG9zXTtcbiAgICAgICAgY3VyUG9zID0gYWN0aXZlV29yZC5jaGlsZHJlbi5sZW5ndGg7XG4gICAgICAgIHdoaWxlIChhY3RpdmVXb3JkLmNoaWxkcmVuW2N1clBvcyAtIDFdLmNsYXNzTmFtZSA9PT0gXCJcIilcbiAgICAgICAgICAgIGN1clBvcy0tO1xuICAgICAgICBhY3RpdmVXb3JkLmNsYXNzTGlzdC5yZW1vdmUoXCJlcnJvclwiKTtcbiAgICB9XG59XG5mdW5jdGlvbiBsb2FkT2xkUmVwbGF5KCkge1xuICAgIGxldCBzdGFydGluZ0luZGV4ID0gMDtcbiAgICBjdXJQb3MgPSAwO1xuICAgIHdvcmRQb3MgPSAwO1xuICAgIHJlcGxheURhdGEuZm9yRWFjaCgoaXRlbSwgaSkgPT4ge1xuICAgICAgICBpZiAod29yZFBvcyA8IHRhcmdldFdvcmRQb3MgfHxcbiAgICAgICAgICAgICh3b3JkUG9zID09PSB0YXJnZXRXb3JkUG9zICYmIGN1clBvcyA8IHRhcmdldEN1clBvcykpIHtcbiAgICAgICAgICAgIC8vcXVpY2tseSBkaXNwbGF5IGV2ZXJ5dGhpbmcgdXAgdG8gdGhlIHRhcmdldFxuICAgICAgICAgICAgaGFuZGxlRGlzcGxheUxvZ2ljKGl0ZW0sIHRydWUpO1xuICAgICAgICAgICAgc3RhcnRpbmdJbmRleCA9IGkgKyAxO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgY29uc3QgdGltZSA9IE1hdGguZmxvb3IocmVwbGF5RGF0YVtzdGFydGluZ0luZGV4XS50aW1lIC8gMTAwMCk7XG4gICAgJChcIiNyZXBsYXlTdG9wd2F0Y2hcIikudGV4dCh0aW1lICsgXCJzXCIpO1xuICAgIHJldHVybiBzdGFydGluZ0luZGV4O1xufVxuZnVuY3Rpb24gdG9nZ2xlUmVwbGF5RGlzcGxheSgpIHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKCQoXCIjcmVzdWx0UmVwbGF5XCIpLnN0b3AodHJ1ZSwgdHJ1ZSkuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgaW5pdGlhbGl6ZVJlcGxheVByb21wdCgpO1xuICAgICAgICBsb2FkT2xkUmVwbGF5KCk7XG4gICAgICAgIC8vc2hvd1xuICAgICAgICBpZiAoISQoXCIjd2F0Y2hSZXBsYXlCdXR0b25cIikuaGFzQ2xhc3MoXCJsb2FkZWRcIikpIHtcbiAgICAgICAgICAgICQoXCIjd29yZHNcIikuaHRtbChgPGRpdiBjbGFzcz1cInByZWxvYWRlclwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXNwaW4gZmEtY2lyY2xlLW5vdGNoXCI+PC9pPjwvZGl2PmApO1xuICAgICAgICAgICAgJChcIiNyZXN1bHRSZXBsYXlcIilcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgICAgICAuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIilcbiAgICAgICAgICAgICAgICAuc2xpZGVEb3duKDI1MCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdFJlcGxheVwiKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgICAgIC5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKVxuICAgICAgICAgICAgICAgIC5zbGlkZURvd24oMjUwKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy9oaWRlXG4gICAgICAgIGlmICgoKF9hID0gdG9nZ2xlQnV0dG9uID09PSBudWxsIHx8IHRvZ2dsZUJ1dHRvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogdG9nZ2xlQnV0dG9uLnBhcmVudE5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIpKSAhPVxuICAgICAgICAgICAgXCJTdGFydCByZXBsYXlcIikge1xuICAgICAgICAgICAgcGF1c2VSZXBsYXkoKTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiI3Jlc3VsdFJlcGxheVwiKS5zbGlkZVVwKDI1MCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNyZXN1bHRSZXBsYXlcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHN0YXJ0UmVwbGF5UmVjb3JkaW5nKCkge1xuICAgIGlmICghJChcIiNyZXN1bHRSZXBsYXlcIikuc3RvcCh0cnVlLCB0cnVlKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAvL2hpZGUgcmVwbGF5IGRpc3BsYXkgaWYgdXNlciBsZWZ0IGl0IG9wZW5cbiAgICAgICAgdG9nZ2xlUmVwbGF5RGlzcGxheSgpO1xuICAgIH1cbiAgICAkKFwiI3JlcGxheVN0b3B3YXRjaFwiKS50ZXh0KDAgKyBcInNcIik7XG4gICAgcmVwbGF5RGF0YSA9IFtdO1xuICAgIHJlcGxheVN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIHJlcGxheVJlY29yZGluZyA9IHRydWU7XG4gICAgdGFyZ2V0Q3VyUG9zID0gMDtcbiAgICB0YXJnZXRXb3JkUG9zID0gMDtcbn1cbmV4cG9ydHMuc3RhcnRSZXBsYXlSZWNvcmRpbmcgPSBzdGFydFJlcGxheVJlY29yZGluZztcbmZ1bmN0aW9uIHN0b3BSZXBsYXlSZWNvcmRpbmcoKSB7XG4gICAgcmVwbGF5UmVjb3JkaW5nID0gZmFsc2U7XG59XG5leHBvcnRzLnN0b3BSZXBsYXlSZWNvcmRpbmcgPSBzdG9wUmVwbGF5UmVjb3JkaW5nO1xuZnVuY3Rpb24gYWRkUmVwbGF5RXZlbnQoYWN0aW9uLCB2YWx1ZSkge1xuICAgIGlmICghcmVwbGF5UmVjb3JkaW5nKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdGltZURlbHRhID0gcGVyZm9ybWFuY2Uubm93KCkgLSByZXBsYXlTdGFydFRpbWU7XG4gICAgcmVwbGF5RGF0YS5wdXNoKHsgYWN0aW9uOiBhY3Rpb24sIHZhbHVlOiB2YWx1ZSwgdGltZTogdGltZURlbHRhIH0pO1xufVxuZXhwb3J0cy5hZGRSZXBsYXlFdmVudCA9IGFkZFJlcGxheUV2ZW50O1xuZnVuY3Rpb24gcGxheVJlcGxheSgpIHtcbiAgICB2YXIgX2E7XG4gICAgY3VyUG9zID0gMDtcbiAgICB3b3JkUG9zID0gMDtcbiAgICBpZiAodG9nZ2xlQnV0dG9uID09PSB1bmRlZmluZWQpXG4gICAgICAgIHJldHVybjtcbiAgICB0b2dnbGVCdXR0b24uY2xhc3NOYW1lID0gXCJmYXMgZmEtcGF1c2VcIjtcbiAgICAoX2EgPSB0b2dnbGVCdXR0b24ucGFyZW50Tm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgXCJQYXVzZSByZXBsYXlcIik7XG4gICAgaW5pdGlhbGl6ZVJlcGxheVByb21wdCgpO1xuICAgIGNvbnN0IHN0YXJ0aW5nSW5kZXggPSBsb2FkT2xkUmVwbGF5KCk7XG4gICAgY29uc3QgbGFzdFRpbWUgPSByZXBsYXlEYXRhW3N0YXJ0aW5nSW5kZXhdLnRpbWU7XG4gICAgbGV0IHN3VGltZSA9IE1hdGgucm91bmQobGFzdFRpbWUgLyAxMDAwKTsgLy9zdGFydGluZyB0aW1lXG4gICAgY29uc3Qgc3dFbmRUaW1lID0gTWF0aC5yb3VuZChyZXBsYXlEYXRhW3JlcGxheURhdGEubGVuZ3RoIC0gMV0udGltZSAvIDEwMDApO1xuICAgIHdoaWxlIChzd1RpbWUgPD0gc3dFbmRUaW1lKSB7XG4gICAgICAgIGNvbnN0IHRpbWUgPSBzd1RpbWU7XG4gICAgICAgIHN0b3B3YXRjaExpc3QucHVzaChzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICQoXCIjcmVwbGF5U3RvcHdhdGNoXCIpLnRleHQodGltZSArIFwic1wiKTtcbiAgICAgICAgfSwgdGltZSAqIDEwMDAgLSBsYXN0VGltZSkpO1xuICAgICAgICBzd1RpbWUrKztcbiAgICB9XG4gICAgcmVwbGF5RGF0YS5mb3JFYWNoKChpdGVtLCBpKSA9PiB7XG4gICAgICAgIGlmIChpIDwgc3RhcnRpbmdJbmRleClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGltZW91dExpc3QucHVzaChzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGhhbmRsZURpc3BsYXlMb2dpYyhpdGVtKTtcbiAgICAgICAgfSwgaXRlbS50aW1lIC0gbGFzdFRpbWUpKTtcbiAgICB9KTtcbiAgICB0aW1lb3V0TGlzdC5wdXNoKHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAvL2FmdGVyIHRoZSByZXBsYXkgaGFzIGZpbmlzaGVkLCB0aGlzIHdpbGwgcnVuXG4gICAgICAgIHRhcmdldEN1clBvcyA9IDA7XG4gICAgICAgIHRhcmdldFdvcmRQb3MgPSAwO1xuICAgICAgICB0b2dnbGVCdXR0b24uY2xhc3NOYW1lID0gXCJmYXMgZmEtcGxheVwiO1xuICAgICAgICB0b2dnbGVCdXR0b24ucGFyZW50Tm9kZS5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIFwiU3RhcnQgcmVwbGF5XCIpO1xuICAgIH0sIHJlcGxheURhdGFbcmVwbGF5RGF0YS5sZW5ndGggLSAxXS50aW1lIC0gbGFzdFRpbWUpKTtcbn1cbmZ1bmN0aW9uIGdldFJlcGxheUV4cG9ydCgpIHtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICByZXBsYXlEYXRhOiByZXBsYXlEYXRhLFxuICAgICAgICB3b3Jkc0xpc3Q6IHdvcmRzTGlzdCxcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0UmVwbGF5RXhwb3J0ID0gZ2V0UmVwbGF5RXhwb3J0O1xuJChcIi5wYWdlVGVzdCAjcGxheXBhdXNlUmVwbGF5QnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGlmICgodG9nZ2xlQnV0dG9uID09PSBudWxsIHx8IHRvZ2dsZUJ1dHRvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogdG9nZ2xlQnV0dG9uLmNsYXNzTmFtZSkgPT09IFwiZmFzIGZhLXBsYXlcIikge1xuICAgICAgICBwbGF5UmVwbGF5KCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKCh0b2dnbGVCdXR0b24gPT09IG51bGwgfHwgdG9nZ2xlQnV0dG9uID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0b2dnbGVCdXR0b24uY2xhc3NOYW1lKSA9PT0gXCJmYXMgZmEtcGF1c2VcIikge1xuICAgICAgICBwYXVzZVJlcGxheSgpO1xuICAgIH1cbn0pO1xuJChcIiNyZXBsYXlXb3Jkc1wiKS5vbihcImNsaWNrXCIsIFwibGV0dGVyXCIsIChldmVudCkgPT4ge1xuICAgIHZhciBfYTtcbiAgICAvL2FsbG93cyB1c2VyIHRvIGNsaWNrIG9uIHRoZSBwbGFjZSB0aGV5IHdhbnQgdG8gc3RhcnQgdGhlaXIgcmVwbGF5IGF0XG4gICAgcGF1c2VSZXBsYXkoKTtcbiAgICBjb25zdCByZXBsYXlXb3JkcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcmVwbGF5V29yZHNcIik7XG4gICAgY29uc3Qgd29yZHMgPSBbLi4uKChfYSA9IHJlcGxheVdvcmRzID09PSBudWxsIHx8IHJlcGxheVdvcmRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXBsYXlXb3Jkcy5jaGlsZHJlbikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogW10pXTtcbiAgICB0YXJnZXRXb3JkUG9zID0gd29yZHMuaW5kZXhPZihldmVudC50YXJnZXQucGFyZW50Tm9kZSk7XG4gICAgY29uc3QgbGV0dGVycyA9IFsuLi53b3Jkc1t0YXJnZXRXb3JkUG9zXS5jaGlsZHJlbl07XG4gICAgdGFyZ2V0Q3VyUG9zID0gbGV0dGVycy5pbmRleE9mKGV2ZW50LnRhcmdldCk7XG4gICAgaW5pdGlhbGl6ZVJlcGxheVByb21wdCgpO1xuICAgIGxvYWRPbGRSZXBsYXkoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJrZXlwcmVzc1wiLCBcIiN3YXRjaFJlcGxheUJ1dHRvblwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgdG9nZ2xlUmVwbGF5RGlzcGxheSgpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiI3dhdGNoUmVwbGF5QnV0dG9uXCIsICgpID0+IHtcbiAgICB0b2dnbGVSZXBsYXlEaXNwbGF5KCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudXBkYXRlID0gZXhwb3J0cy51cGRhdGVSYXRlUXVvdGUgPSBleHBvcnRzLnVwZGF0ZUNyb3duID0gZXhwb3J0cy5oaWRlQ3Jvd24gPSBleHBvcnRzLnNob3dDcm93biA9IGV4cG9ydHMudXBkYXRlVG9kYXlUcmFja2VyID0gZXhwb3J0cy51cGRhdGVHcmFwaFBCTGluZSA9IGV4cG9ydHMudG9nZ2xlVW5zbW9vdGhlZFJhdyA9IHZvaWQgMDtcbmNvbnN0IFRlc3RVSSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXVpXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBUZXN0U3RhdHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC1zdGF0c1wiKSk7XG5jb25zdCBLZXltYXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2tleW1hcFwiKSk7XG5jb25zdCBDaGFydENvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL2NoYXJ0LWNvbnRyb2xsZXJcIikpO1xuY29uc3QgVGhlbWVDb2xvcnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL3RoZW1lLWNvbG9yc1wiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgVG9kYXlUcmFja2VyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3RvZGF5LXRyYWNrZXJcIikpO1xuY29uc3QgUGJDcm93biA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9wYi1jcm93blwiKSk7XG5jb25zdCBRdW90ZVJhdGVQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcG9wdXBzL3F1b3RlLXJhdGUtcG9wdXBcIikpO1xuY29uc3QgR2xhcnNlc01vZGUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9nbGFyc2VzLW1vZGVcIikpO1xuY29uc3QgVGVzdElucHV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QtaW5wdXRcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBSZXN1bHRzU2hvd25FdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvcmVzdWx0cy1zaG93bi1ldmVudFwiKSk7XG5jb25zdCBjaGFydF9qc18xID0gcmVxdWlyZShcImNoYXJ0LmpzXCIpO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuLi9maXJlYmFzZVwiKTtcbmxldCByZXN1bHQ7XG5sZXQgbWF4Q2hhcnRWYWw7XG5sZXQgdXNlVW5zbW9vdGhlZFJhdyA9IGZhbHNlO1xuZnVuY3Rpb24gdG9nZ2xlVW5zbW9vdGhlZFJhdygpIHtcbiAgICB1c2VVbnNtb290aGVkUmF3ID0gIXVzZVVuc21vb3RoZWRSYXc7XG4gICAgTm90aWZpY2F0aW9ucy5hZGQodXNlVW5zbW9vdGhlZFJhdyA/IFwib25cIiA6IFwib2ZmXCIsIDEpO1xufVxuZXhwb3J0cy50b2dnbGVVbnNtb290aGVkUmF3ID0gdG9nZ2xlVW5zbW9vdGhlZFJhdztcbmxldCByZXN1bHRBbm5vdGF0aW9uID0gW107XG5sZXQgcmVzdWx0U2NhbGVPcHRpb25zID0gQ2hhcnRDb250cm9sbGVyLnJlc3VsdC5vcHRpb25zLnNjYWxlcztcbmZ1bmN0aW9uIHVwZGF0ZUdyYXBoKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgbGFiZWxzID0gW107XG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IFRlc3RJbnB1dC53cG1IaXN0b3J5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoVGVzdFN0YXRzLmxhc3RTZWNvbmROb3RSb3VuZCAmJiBpID09PSBUZXN0SW5wdXQud3BtSGlzdG9yeS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBsYWJlbHMucHVzaChNaXNjLnJvdW5kVG8yKHJlc3VsdC50ZXN0RHVyYXRpb24pLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbGFiZWxzLnB1c2goaS50b1N0cmluZygpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBDaGFydENvbnRyb2xsZXIucmVzdWx0LmRhdGEubGFiZWxzID0gbGFiZWxzO1xuICAgICAgICByZXN1bHRTY2FsZU9wdGlvbnNbXCJ3cG1cIl0udGl0bGUudGV4dCA9IGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTVxuICAgICAgICAgICAgPyBcIkNoYXJhY3RlciBwZXIgTWludXRlXCJcbiAgICAgICAgICAgIDogXCJXb3JkcyBwZXIgTWludXRlXCI7XG4gICAgICAgIGNvbnN0IGNoYXJ0RGF0YTEgPSBjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE1cbiAgICAgICAgICAgID8gVGVzdElucHV0LndwbUhpc3RvcnkubWFwKChhKSA9PiBhICogNSlcbiAgICAgICAgICAgIDogVGVzdElucHV0LndwbUhpc3Rvcnk7XG4gICAgICAgIGxldCBjaGFydERhdGEyO1xuICAgICAgICBpZiAocmVzdWx0LmNoYXJ0RGF0YSA9PT0gXCJ0b29sb25nXCIpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmICh1c2VVbnNtb290aGVkUmF3KSB7XG4gICAgICAgICAgICBjaGFydERhdGEyID1cbiAgICAgICAgICAgICAgICAoX2IgPSAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNXG4gICAgICAgICAgICAgICAgICAgID8gKF9hID0gcmVzdWx0LmNoYXJ0RGF0YS51bnNtb290aGVkUmF3KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWFwKChhKSA9PiBhICogNSlcbiAgICAgICAgICAgICAgICAgICAgOiByZXN1bHQuY2hhcnREYXRhLnVuc21vb3RoZWRSYXcpKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBbXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNoYXJ0RGF0YTIgPSBjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE1cbiAgICAgICAgICAgICAgICA/IHJlc3VsdC5jaGFydERhdGEucmF3Lm1hcCgoYSkgPT4gYSAqIDUpXG4gICAgICAgICAgICAgICAgOiByZXN1bHQuY2hhcnREYXRhLnJhdztcbiAgICAgICAgfVxuICAgICAgICBDaGFydENvbnRyb2xsZXIucmVzdWx0LmRhdGEuZGF0YXNldHNbMF0uZGF0YSA9IGNoYXJ0RGF0YTE7XG4gICAgICAgIENoYXJ0Q29udHJvbGxlci5yZXN1bHQuZGF0YS5kYXRhc2V0c1sxXS5kYXRhID0gY2hhcnREYXRhMjtcbiAgICAgICAgQ2hhcnRDb250cm9sbGVyLnJlc3VsdC5kYXRhLmRhdGFzZXRzWzBdLmxhYmVsID0gY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNXG4gICAgICAgICAgICA/IFwiY3BtXCJcbiAgICAgICAgICAgIDogXCJ3cG1cIjtcbiAgICAgICAgbWF4Q2hhcnRWYWwgPSBNYXRoLm1heCguLi5bTWF0aC5tYXgoLi4uY2hhcnREYXRhMiksIE1hdGgubWF4KC4uLmNoYXJ0RGF0YTEpXSk7XG4gICAgICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5zdGFydEdyYXBoc0F0WmVybykge1xuICAgICAgICAgICAgY29uc3QgbWluQ2hhcnRWYWwgPSBNYXRoLm1pbiguLi5bTWF0aC5taW4oLi4uY2hhcnREYXRhMiksIE1hdGgubWluKC4uLmNoYXJ0RGF0YTEpXSk7XG4gICAgICAgICAgICByZXN1bHRTY2FsZU9wdGlvbnNbXCJ3cG1cIl0ubWluID0gbWluQ2hhcnRWYWw7XG4gICAgICAgICAgICByZXN1bHRTY2FsZU9wdGlvbnNbXCJyYXdcIl0ubWluID0gbWluQ2hhcnRWYWw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHRTY2FsZU9wdGlvbnNbXCJ3cG1cIl0ubWluID0gMDtcbiAgICAgICAgICAgIHJlc3VsdFNjYWxlT3B0aW9uc1tcInJhd1wiXS5taW4gPSAwO1xuICAgICAgICB9XG4gICAgICAgIENoYXJ0Q29udHJvbGxlci5yZXN1bHQuZGF0YS5kYXRhc2V0c1syXS5kYXRhID0gcmVzdWx0LmNoYXJ0RGF0YS5lcnI7XG4gICAgICAgIGNvbnN0IGZjID0geWllbGQgVGhlbWVDb2xvcnMuZ2V0KFwic3ViXCIpO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggIT09IFwibm9uZVwiKSB7XG4gICAgICAgICAgICBsZXQgY29udGVudCA9IGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94O1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcImxheW91dGZsdWlkXCIpIHtcbiAgICAgICAgICAgICAgICBjb250ZW50ICs9IFwiIFwiICsgY29uZmlnXzEuZGVmYXVsdC5jdXN0b21MYXlvdXRmbHVpZC5yZXBsYWNlKC8jL2csIFwiIFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc3VsdEFubm90YXRpb24ucHVzaCh7XG4gICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpZDogXCJmdW5ib3gtbGFiZWxcIixcbiAgICAgICAgICAgICAgICB0eXBlOiBcImxpbmVcIixcbiAgICAgICAgICAgICAgICBzY2FsZUlEOiBcIndwbVwiLFxuICAgICAgICAgICAgICAgIHZhbHVlOiByZXN1bHRTY2FsZU9wdGlvbnNbXCJ3cG1cIl0ubWluLFxuICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiBcInRyYW5zcGFyZW50XCIsXG4gICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDEsXG4gICAgICAgICAgICAgICAgYm9yZGVyRGFzaDogWzIsIDJdLFxuICAgICAgICAgICAgICAgIGxhYmVsOiB7XG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogXCJ0cmFuc3BhcmVudFwiLFxuICAgICAgICAgICAgICAgICAgICBmb250OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmYW1pbHk6IGNvbmZpZ18xLmRlZmF1bHQuZm9udEZhbWlseS5yZXBsYWNlKC9fL2csIFwiIFwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IDExLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU6IFwibm9ybWFsXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB3ZWlnaHQ6IGNoYXJ0X2pzXzEuQ2hhcnQuZGVmYXVsdHMuZm9udC53ZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiBjaGFydF9qc18xLkNoYXJ0LmRlZmF1bHRzLmZvbnQubGluZUhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IGZjLFxuICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAzLFxuICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6IDMsXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBcInN0YXJ0XCIsXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGAke2NvbnRlbnR9YCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0U2NhbGVPcHRpb25zW1wid3BtXCJdLm1heCA9IG1heENoYXJ0VmFsO1xuICAgICAgICByZXN1bHRTY2FsZU9wdGlvbnNbXCJyYXdcIl0ubWF4ID0gbWF4Q2hhcnRWYWw7XG4gICAgICAgIHJlc3VsdFNjYWxlT3B0aW9uc1tcImVycm9yXCJdLm1heCA9IE1hdGgubWF4KC4uLnJlc3VsdC5jaGFydERhdGEuZXJyKSArIDE7XG4gICAgfSk7XG59XG5mdW5jdGlvbiB1cGRhdGVHcmFwaFBCTGluZSgpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCB0aGVtZWNvbG9ycyA9IHlpZWxkIFRoZW1lQ29sb3JzLmdldEFsbCgpO1xuICAgICAgICBjb25zdCBscGIgPSB5aWVsZCBEQi5nZXRMb2NhbFBCKHJlc3VsdC5tb2RlLCByZXN1bHQubW9kZTIsIChfYSA9IHJlc3VsdC5wdW5jdHVhdGlvbikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogZmFsc2UsIHJlc3VsdC5sYW5ndWFnZSwgcmVzdWx0LmRpZmZpY3VsdHksIChfYiA9IHJlc3VsdC5sYXp5TW9kZSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogZmFsc2UsIChfYyA9IHJlc3VsdC5mdW5ib3gpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IFwibm9uZVwiKTtcbiAgICAgICAgaWYgKGxwYiA9PSAwKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBjaGFydGxwYiA9IE1pc2Mucm91bmRUbzIoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNID8gbHBiICogNSA6IGxwYikudG9GaXhlZCgyKTtcbiAgICAgICAgcmVzdWx0QW5ub3RhdGlvbi5wdXNoKHtcbiAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICB0eXBlOiBcImxpbmVcIixcbiAgICAgICAgICAgIGlkOiBcImxwYlwiLFxuICAgICAgICAgICAgc2NhbGVJRDogXCJ3cG1cIixcbiAgICAgICAgICAgIHZhbHVlOiBjaGFydGxwYixcbiAgICAgICAgICAgIGJvcmRlckNvbG9yOiB0aGVtZWNvbG9yc1tcInN1YlwiXSxcbiAgICAgICAgICAgIGJvcmRlcldpZHRoOiAxLFxuICAgICAgICAgICAgYm9yZGVyRGFzaDogWzIsIDJdLFxuICAgICAgICAgICAgbGFiZWw6IHtcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHRoZW1lY29sb3JzW1wic3ViXCJdLFxuICAgICAgICAgICAgICAgIGZvbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgZmFtaWx5OiBjb25maWdfMS5kZWZhdWx0LmZvbnRGYW1pbHkucmVwbGFjZSgvXy9nLCBcIiBcIiksXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IDExLFxuICAgICAgICAgICAgICAgICAgICBzdHlsZTogXCJub3JtYWxcIixcbiAgICAgICAgICAgICAgICAgICAgd2VpZ2h0OiBjaGFydF9qc18xLkNoYXJ0LmRlZmF1bHRzLmZvbnQud2VpZ2h0LFxuICAgICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiBjaGFydF9qc18xLkNoYXJ0LmRlZmF1bHRzLmZvbnQubGluZUhlaWdodCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbG9yOiB0aGVtZWNvbG9yc1tcImJnXCJdLFxuICAgICAgICAgICAgICAgIHBhZGRpbmc6IDMsXG4gICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAzLFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgY29udGVudDogYFBCOiAke2NoYXJ0bHBifWAsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKG1heENoYXJ0VmFsID49IHBhcnNlRmxvYXQoY2hhcnRscGIpIC0gMjAgJiZcbiAgICAgICAgICAgIG1heENoYXJ0VmFsIDw9IHBhcnNlRmxvYXQoY2hhcnRscGIpICsgMjApIHtcbiAgICAgICAgICAgIG1heENoYXJ0VmFsID0gcGFyc2VGbG9hdChjaGFydGxwYikgKyAxNTtcbiAgICAgICAgfVxuICAgICAgICByZXN1bHRTY2FsZU9wdGlvbnNbXCJ3cG1cIl0ubWF4ID0gTWF0aC5yb3VuZChtYXhDaGFydFZhbCArIDUpO1xuICAgICAgICByZXN1bHRTY2FsZU9wdGlvbnNbXCJyYXdcIl0ubWF4ID0gTWF0aC5yb3VuZChtYXhDaGFydFZhbCArIDUpO1xuICAgIH0pO1xufVxuZXhwb3J0cy51cGRhdGVHcmFwaFBCTGluZSA9IHVwZGF0ZUdyYXBoUEJMaW5lO1xuZnVuY3Rpb24gdXBkYXRlV3BtQW5kQWNjKCkge1xuICAgIGxldCBpbmYgPSBmYWxzZTtcbiAgICBpZiAocmVzdWx0LndwbSA+PSAxMDAwKSB7XG4gICAgICAgIGluZiA9IHRydWU7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzKSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0gPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC50b3AgLnRleHRcIikudGV4dChcIndwbVwiKTtcbiAgICAgICAgICAgIGlmIChpbmYpIHtcbiAgICAgICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAuYm90dG9tXCIpLnRleHQoXCJJbmZpbml0ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC5ib3R0b21cIikudGV4dChNaXNjLnJvdW5kVG8yKHJlc3VsdC53cG0pLnRvRml4ZWQoMikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5yYXcgLmJvdHRvbVwiKS50ZXh0KE1pc2Mucm91bmRUbzIocmVzdWx0LnJhd1dwbSkudG9GaXhlZCgyKSk7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAuYm90dG9tXCIpLmF0dHIoXCJhcmlhLWxhYmVsXCIsIE1pc2Mucm91bmRUbzIocmVzdWx0LndwbSAqIDUpLnRvRml4ZWQoMikgKyBcIiBjcG1cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAudG9wIC50ZXh0XCIpLnRleHQoXCJjcG1cIik7XG4gICAgICAgICAgICBpZiAoaW5mKSB7XG4gICAgICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLmJvdHRvbVwiKS50ZXh0KFwiSW5maW5pdGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAuYm90dG9tXCIpLnRleHQoTWlzYy5yb3VuZFRvMihyZXN1bHQud3BtICogNSkudG9GaXhlZCgyKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnJhdyAuYm90dG9tXCIpLnRleHQoTWlzYy5yb3VuZFRvMihyZXN1bHQucmF3V3BtICogNSkudG9GaXhlZCgyKSk7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAuYm90dG9tXCIpLmF0dHIoXCJhcmlhLWxhYmVsXCIsIE1pc2Mucm91bmRUbzIocmVzdWx0LndwbSkudG9GaXhlZCgyKSArIFwiIHdwbVwiKTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLmFjYyAuYm90dG9tXCIpLnRleHQocmVzdWx0LmFjYyA9PSAxMDAgPyBcIjEwMCVcIiA6IE1pc2Mucm91bmRUbzIocmVzdWx0LmFjYykudG9GaXhlZCgyKSArIFwiJVwiKTtcbiAgICAgICAgbGV0IHRpbWUgPSBNaXNjLnJvdW5kVG8yKHJlc3VsdC50ZXN0RHVyYXRpb24pLnRvRml4ZWQoMikgKyBcInNcIjtcbiAgICAgICAgaWYgKHJlc3VsdC50ZXN0RHVyYXRpb24gPiA2MSkge1xuICAgICAgICAgICAgdGltZSA9IE1pc2Muc2Vjb25kc1RvU3RyaW5nKE1pc2Mucm91bmRUbzIocmVzdWx0LnRlc3REdXJhdGlvbikpO1xuICAgICAgICB9XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAudGltZSAuYm90dG9tIC50ZXh0XCIpLnRleHQodGltZSk7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAucmF3IC5ib3R0b21cIikucmVtb3ZlQXR0cihcImFyaWEtbGFiZWxcIik7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAuYWNjIC5ib3R0b21cIikucmVtb3ZlQXR0cihcImFyaWEtbGFiZWxcIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvL25vdCBzaG93aW5nIGRlY2ltYWwgcGxhY2VzXG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0gPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC50b3AgLnRleHRcIikudGV4dChcIndwbVwiKTtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC5ib3R0b21cIikuYXR0cihcImFyaWEtbGFiZWxcIiwgcmVzdWx0LndwbSArIGAgKCR7TWlzYy5yb3VuZFRvMihyZXN1bHQud3BtICogNSl9IGNwbSlgKTtcbiAgICAgICAgICAgIGlmIChpbmYpIHtcbiAgICAgICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAuYm90dG9tXCIpLnRleHQoXCJJbmZpbml0ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC5ib3R0b21cIikudGV4dChNYXRoLnJvdW5kKHJlc3VsdC53cG0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAucmF3IC5ib3R0b21cIikudGV4dChNYXRoLnJvdW5kKHJlc3VsdC5yYXdXcG0pKTtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAucmF3IC5ib3R0b21cIikuYXR0cihcImFyaWEtbGFiZWxcIiwgcmVzdWx0LnJhd1dwbSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAudG9wIC50ZXh0XCIpLnRleHQoXCJjcG1cIik7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAuYm90dG9tXCIpLmF0dHIoXCJhcmlhLWxhYmVsXCIsIE1pc2Mucm91bmRUbzIocmVzdWx0LndwbSAqIDUpICsgYCAoJHtNaXNjLnJvdW5kVG8yKHJlc3VsdC53cG0pfSB3cG0pYCk7XG4gICAgICAgICAgICBpZiAoaW5mKSB7XG4gICAgICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLmJvdHRvbVwiKS50ZXh0KFwiSW5maW5pdGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAuYm90dG9tXCIpLnRleHQoTWF0aC5yb3VuZChyZXN1bHQud3BtICogNSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5yYXcgLmJvdHRvbVwiKS50ZXh0KE1hdGgucm91bmQocmVzdWx0LnJhd1dwbSAqIDUpKTtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAucmF3IC5ib3R0b21cIikuYXR0cihcImFyaWEtbGFiZWxcIiwgcmVzdWx0LnJhd1dwbSAqIDUpO1xuICAgICAgICB9XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAuYWNjIC5ib3R0b21cIikudGV4dChNYXRoLmZsb29yKHJlc3VsdC5hY2MpICsgXCIlXCIpO1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLmFjYyAuYm90dG9tXCIpLmF0dHIoXCJhcmlhLWxhYmVsXCIsIHJlc3VsdC5hY2MgKyBcIiVcIik7XG4gICAgfVxufVxuZnVuY3Rpb24gdXBkYXRlQ29uc2lzdGVuY3koKSB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0RlY2ltYWxQbGFjZXMpIHtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5jb25zaXN0ZW5jeSAuYm90dG9tXCIpLnRleHQoTWlzYy5yb3VuZFRvMihyZXN1bHQuY29uc2lzdGVuY3kpLnRvRml4ZWQoMikgKyBcIiVcIik7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAuY29uc2lzdGVuY3kgLmJvdHRvbVwiKS5hdHRyKFwiYXJpYS1sYWJlbFwiLCBgJHtyZXN1bHQua2V5Q29uc2lzdGVuY3kudG9GaXhlZCgyKX0lIGtleWApO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5jb25zaXN0ZW5jeSAuYm90dG9tXCIpLnRleHQoTWF0aC5yb3VuZChyZXN1bHQuY29uc2lzdGVuY3kpICsgXCIlXCIpO1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLmNvbnNpc3RlbmN5IC5ib3R0b21cIikuYXR0cihcImFyaWEtbGFiZWxcIiwgYCR7cmVzdWx0LmNvbnNpc3RlbmN5fSUgKCR7cmVzdWx0LmtleUNvbnNpc3RlbmN5fSUga2V5KWApO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHVwZGF0ZVRpbWUoKSB7XG4gICAgY29uc3QgYWZrU2Vjb25kc1BlcmNlbnQgPSBNaXNjLnJvdW5kVG8yKChyZXN1bHQuYWZrRHVyYXRpb24gLyByZXN1bHQudGVzdER1cmF0aW9uKSAqIDEwMCk7XG4gICAgJChcIiNyZXN1bHQgLnN0YXRzIC50aW1lIC5ib3R0b20gLmFma1wiKS50ZXh0KFwiXCIpO1xuICAgIGlmIChhZmtTZWNvbmRzUGVyY2VudCA+IDApIHtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC50aW1lIC5ib3R0b20gLmFma1wiKS50ZXh0KGFma1NlY29uZHNQZXJjZW50ICsgXCIlIGFma1wiKTtcbiAgICB9XG4gICAgJChcIiNyZXN1bHQgLnN0YXRzIC50aW1lIC5ib3R0b21cIikuYXR0cihcImFyaWEtbGFiZWxcIiwgYCR7cmVzdWx0LmFma0R1cmF0aW9ufXMgYWZrICR7YWZrU2Vjb25kc1BlcmNlbnR9JWApO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzKSB7XG4gICAgICAgIGxldCB0aW1lID0gTWlzYy5yb3VuZFRvMihyZXN1bHQudGVzdER1cmF0aW9uKS50b0ZpeGVkKDIpICsgXCJzXCI7XG4gICAgICAgIGlmIChyZXN1bHQudGVzdER1cmF0aW9uID4gNjEpIHtcbiAgICAgICAgICAgIHRpbWUgPSBNaXNjLnNlY29uZHNUb1N0cmluZyhNaXNjLnJvdW5kVG8yKHJlc3VsdC50ZXN0RHVyYXRpb24pKTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnRpbWUgLmJvdHRvbSAudGV4dFwiKS50ZXh0KHRpbWUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgbGV0IHRpbWUgPSBNYXRoLnJvdW5kKHJlc3VsdC50ZXN0RHVyYXRpb24pICsgXCJzXCI7XG4gICAgICAgIGlmIChyZXN1bHQudGVzdER1cmF0aW9uID4gNjEpIHtcbiAgICAgICAgICAgIHRpbWUgPSBNaXNjLnNlY29uZHNUb1N0cmluZyhNYXRoLnJvdW5kKHJlc3VsdC50ZXN0RHVyYXRpb24pKTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnRpbWUgLmJvdHRvbSAudGV4dFwiKS50ZXh0KHRpbWUpO1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnRpbWUgLmJvdHRvbVwiKS5hdHRyKFwiYXJpYS1sYWJlbFwiLCBgJHtNaXNjLnJvdW5kVG8yKHJlc3VsdC50ZXN0RHVyYXRpb24pfXMgKCR7cmVzdWx0LmFma0R1cmF0aW9ufXMgYWZrICR7YWZrU2Vjb25kc1BlcmNlbnR9JSlgKTtcbiAgICB9XG59XG5mdW5jdGlvbiB1cGRhdGVUb2RheVRyYWNrZXIoKSB7XG4gICAgJChcIiNyZXN1bHQgLnN0YXRzIC50aW1lIC5ib3R0b20gLnRpbWVUb2RheVwiKS50ZXh0KFRvZGF5VHJhY2tlci5nZXRTdHJpbmcoKSk7XG59XG5leHBvcnRzLnVwZGF0ZVRvZGF5VHJhY2tlciA9IHVwZGF0ZVRvZGF5VHJhY2tlcjtcbmZ1bmN0aW9uIHVwZGF0ZUtleSgpIHtcbiAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLmtleSAuYm90dG9tXCIpLnRleHQocmVzdWx0LmNoYXJTdGF0c1swXSArXG4gICAgICAgIFwiL1wiICtcbiAgICAgICAgcmVzdWx0LmNoYXJTdGF0c1sxXSArXG4gICAgICAgIFwiL1wiICtcbiAgICAgICAgcmVzdWx0LmNoYXJTdGF0c1syXSArXG4gICAgICAgIFwiL1wiICtcbiAgICAgICAgcmVzdWx0LmNoYXJTdGF0c1szXSk7XG59XG5mdW5jdGlvbiBzaG93Q3Jvd24oKSB7XG4gICAgUGJDcm93bi5zaG93KCk7XG59XG5leHBvcnRzLnNob3dDcm93biA9IHNob3dDcm93bjtcbmZ1bmN0aW9uIGhpZGVDcm93bigpIHtcbiAgICBQYkNyb3duLmhpZGUoKTtcbiAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAuY3Jvd25cIikuYXR0cihcImFyaWEtbGFiZWxcIiwgXCJcIik7XG59XG5leHBvcnRzLmhpZGVDcm93biA9IGhpZGVDcm93bjtcbmZ1bmN0aW9uIHVwZGF0ZUNyb3duKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGxldCBwYkRpZmYgPSAwO1xuICAgICAgICBjb25zdCBscGIgPSB5aWVsZCBEQi5nZXRMb2NhbFBCKGNvbmZpZ18xLmRlZmF1bHQubW9kZSwgcmVzdWx0Lm1vZGUyLCBjb25maWdfMS5kZWZhdWx0LnB1bmN0dWF0aW9uLCBjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlLCBjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHksIGNvbmZpZ18xLmRlZmF1bHQubGF6eU1vZGUsIGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94KTtcbiAgICAgICAgcGJEaWZmID0gTWF0aC5hYnMocmVzdWx0LndwbSAtIGxwYik7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC5jcm93blwiKS5hdHRyKFwiYXJpYS1sYWJlbFwiLCBcIitcIiArIE1pc2Mucm91bmRUbzIocGJEaWZmKSk7XG4gICAgfSk7XG59XG5leHBvcnRzLnVwZGF0ZUNyb3duID0gdXBkYXRlQ3Jvd247XG5mdW5jdGlvbiB1cGRhdGVUYWdzKGRvbnRTYXZlKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IGFjdGl2ZVRhZ3MgPSBbXTtcbiAgICB0cnkge1xuICAgICAgICAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgIGlmICh0YWcuYWN0aXZlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgYWN0aXZlVGFncy5wdXNoKHRhZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjYXRjaCAoZSkgeyB9XG4gICAgJChcIiNyZXN1bHQgLnN0YXRzIC50YWdzXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIGlmIChhY3RpdmVUYWdzLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAudGFnc1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAudGFnc1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgJChcIiNyZXN1bHQgLnN0YXRzIC50YWdzIC5ib3R0b21cIikudGV4dChcIlwiKTtcbiAgICBsZXQgYW5ub3RhdGlvblNpZGUgPSBcInN0YXJ0XCI7XG4gICAgbGV0IGxhYmVsQWRqdXN0ID0gMTU7XG4gICAgYWN0aXZlVGFncy5mb3JFYWNoKCh0YWcpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgdHBiID0geWllbGQgREIuZ2V0TG9jYWxUYWdQQih0YWcuX2lkLCBjb25maWdfMS5kZWZhdWx0Lm1vZGUsIHJlc3VsdC5tb2RlMiwgY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbiwgY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSwgY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5LCBjb25maWdfMS5kZWZhdWx0LmxhenlNb2RlKTtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC50YWdzIC5ib3R0b21cIikuYXBwZW5kKGBcbiAgICAgIDxkaXYgdGFnaWQ9XCIke3RhZy5faWR9XCIgYXJpYS1sYWJlbD1cIlBCOiAke3RwYn1cIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj4ke3RhZy5uYW1lfTxpIGNsYXNzPVwiZmFzIGZhLWNyb3duIGhpZGRlblwiPjwvaT48L2Rpdj5cbiAgICBgKTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPSBcInF1b3RlXCIgJiYgIWRvbnRTYXZlKSB7XG4gICAgICAgICAgICBpZiAodHBiIDwgcmVzdWx0LndwbSkge1xuICAgICAgICAgICAgICAgIC8vbmV3IHBiIGZvciB0aGF0IHRhZ1xuICAgICAgICAgICAgICAgIERCLnNhdmVMb2NhbFRhZ1BCKHRhZy5faWQsIGNvbmZpZ18xLmRlZmF1bHQubW9kZSwgcmVzdWx0Lm1vZGUyLCBjb25maWdfMS5kZWZhdWx0LnB1bmN0dWF0aW9uLCBjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlLCBjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHksIGNvbmZpZ18xLmRlZmF1bHQubGF6eU1vZGUsIHJlc3VsdC53cG0sIHJlc3VsdC5hY2MsIHJlc3VsdC5yYXdXcG0sIHJlc3VsdC5jb25zaXN0ZW5jeSk7XG4gICAgICAgICAgICAgICAgJChgI3Jlc3VsdCAuc3RhdHMgLnRhZ3MgLmJvdHRvbSBkaXZbdGFnaWQ9XCIke3RhZy5faWR9XCJdIC5mYXNgKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAkKGAjcmVzdWx0IC5zdGF0cyAudGFncyAuYm90dG9tIGRpdlt0YWdpZD1cIiR7dGFnLl9pZH1cIl1gKS5hdHRyKFwiYXJpYS1sYWJlbFwiLCBcIitcIiArIE1pc2Mucm91bmRUbzIocmVzdWx0LndwbSAtIHRwYikpO1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwibmV3IHBiIGZvciB0YWcgXCIgKyB0YWcubmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0aGVtZWNvbG9ycyA9IHlpZWxkIFRoZW1lQ29sb3JzLmdldEFsbCgpO1xuICAgICAgICAgICAgICAgIHJlc3VsdEFubm90YXRpb24ucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwibGluZVwiLFxuICAgICAgICAgICAgICAgICAgICBpZDogXCJ0cGJcIixcbiAgICAgICAgICAgICAgICAgICAgc2NhbGVJRDogXCJ3cG1cIixcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSA/IHRwYiAqIDUgOiB0cGIsXG4gICAgICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiB0aGVtZWNvbG9yc1tcInN1YlwiXSxcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDEsXG4gICAgICAgICAgICAgICAgICAgIGJvcmRlckRhc2g6IFsyLCAyXSxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogdGhlbWVjb2xvcnNbXCJzdWJcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgICBmb250OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFtaWx5OiBjb25maWdfMS5kZWZhdWx0LmZvbnRGYW1pbHkucmVwbGFjZSgvXy9nLCBcIiBcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogMTEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU6IFwibm9ybWFsXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2VpZ2h0OiBjaGFydF9qc18xLkNoYXJ0LmRlZmF1bHRzLmZvbnQud2VpZ2h0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6IGNoYXJ0X2pzXzEuQ2hhcnQuZGVmYXVsdHMuZm9udC5saW5lSGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiB0aGVtZWNvbG9yc1tcImJnXCJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogMyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBhbm5vdGF0aW9uU2lkZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHhBZGp1c3Q6IGxhYmVsQWRqdXN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGAke3RhZy5uYW1lfSBQQjogJHtNaXNjLnJvdW5kVG8yKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSA/IHRwYiAqIDUgOiB0cGIpLnRvRml4ZWQoMil9YCxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoYW5ub3RhdGlvblNpZGUgPT09IFwic3RhcnRcIikge1xuICAgICAgICAgICAgICAgICAgICBhbm5vdGF0aW9uU2lkZSA9IFwiZW5kXCI7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsQWRqdXN0ID0gLTE1O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYW5ub3RhdGlvblNpZGUgPSBcInN0YXJ0XCI7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsQWRqdXN0ID0gMTU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSkpO1xufVxuZnVuY3Rpb24gdXBkYXRlVGVzdFR5cGUocmFuZG9tUXVvdGUpIHtcbiAgICBsZXQgdGVzdFR5cGUgPSBcIlwiO1xuICAgIHRlc3RUeXBlICs9IGNvbmZpZ18xLmRlZmF1bHQubW9kZTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInRpbWVcIikge1xuICAgICAgICB0ZXN0VHlwZSArPSBcIiBcIiArIGNvbmZpZ18xLmRlZmF1bHQudGltZTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIpIHtcbiAgICAgICAgdGVzdFR5cGUgKz0gXCIgXCIgKyBjb25maWdfMS5kZWZhdWx0LndvcmRzO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICBpZiAocmFuZG9tUXVvdGUuZ3JvdXAgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGVzdFR5cGUgKz0gXCIgXCIgKyBbXCJzaG9ydFwiLCBcIm1lZGl1bVwiLCBcImxvbmdcIiwgXCJ0aGljY1wiXVtyYW5kb21RdW90ZS5ncm91cF07XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPSBcImN1c3RvbVwiICYmXG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ICE9PSBcImdpYmJlcmlzaFwiICYmXG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ICE9PSBcImFzY2lpXCIgJiZcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggIT09IFwiNTgwMDhcIikge1xuICAgICAgICB0ZXN0VHlwZSArPSBcIjxicj5cIiArIHJlc3VsdC5sYW5ndWFnZS5yZXBsYWNlKC9fL2csIFwiIFwiKTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucHVuY3R1YXRpb24pIHtcbiAgICAgICAgdGVzdFR5cGUgKz0gXCI8YnI+cHVuY3R1YXRpb25cIjtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubnVtYmVycykge1xuICAgICAgICB0ZXN0VHlwZSArPSBcIjxicj5udW1iZXJzXCI7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSkge1xuICAgICAgICB0ZXN0VHlwZSArPSBcIjxicj5ibGluZFwiO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5sYXp5TW9kZSkge1xuICAgICAgICB0ZXN0VHlwZSArPSBcIjxicj5sYXp5XCI7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCAhPT0gXCJub25lXCIpIHtcbiAgICAgICAgdGVzdFR5cGUgKz0gXCI8YnI+XCIgKyBjb25maWdfMS5kZWZhdWx0LmZ1bmJveC5yZXBsYWNlKC9fL2csIFwiIFwiKTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSA9PSBcImV4cGVydFwiKSB7XG4gICAgICAgIHRlc3RUeXBlICs9IFwiPGJyPmV4cGVydFwiO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHkgPT0gXCJtYXN0ZXJcIikge1xuICAgICAgICB0ZXN0VHlwZSArPSBcIjxicj5tYXN0ZXJcIjtcbiAgICB9XG4gICAgJChcIiNyZXN1bHQgLnN0YXRzIC50ZXN0VHlwZSAuYm90dG9tXCIpLmh0bWwodGVzdFR5cGUpO1xufVxuZnVuY3Rpb24gdXBkYXRlT3RoZXIoZGlmZmljdWx0eUZhaWxlZCwgZmFpbFJlYXNvbiwgYWZrRGV0ZWN0ZWQsIGlzUmVwZWF0ZWQsIHRvb1Nob3J0KSB7XG4gICAgbGV0IG90aGVyVGV4dCA9IFwiXCI7XG4gICAgaWYgKGRpZmZpY3VsdHlGYWlsZWQpIHtcbiAgICAgICAgb3RoZXJUZXh0ICs9IGA8YnI+ZmFpbGVkICgke2ZhaWxSZWFzb259KWA7XG4gICAgfVxuICAgIGlmIChhZmtEZXRlY3RlZCkge1xuICAgICAgICBvdGhlclRleHQgKz0gXCI8YnI+YWZrIGRldGVjdGVkXCI7XG4gICAgfVxuICAgIGlmIChUZXN0U3RhdHMuaW52YWxpZCkge1xuICAgICAgICBvdGhlclRleHQgKz0gXCI8YnI+aW52YWxpZFwiO1xuICAgICAgICBsZXQgZXh0cmEgPSBcIlwiO1xuICAgICAgICBpZiAocmVzdWx0LndwbSA8IDAgfHwgcmVzdWx0LndwbSA+IDM1MCkge1xuICAgICAgICAgICAgZXh0cmEgKz0gXCJ3cG1cIjtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzdWx0LmFjYyA8IDc1IHx8IHJlc3VsdC5hY2MgPiAxMDApIHtcbiAgICAgICAgICAgIGlmIChleHRyYS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgZXh0cmEgKz0gXCIsIFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZXh0cmEgKz0gXCJhY2N1cmFjeVwiO1xuICAgICAgICB9XG4gICAgICAgIGlmIChleHRyYS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBvdGhlclRleHQgKz0gYCAoJHtleHRyYX0pYDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoaXNSZXBlYXRlZCkge1xuICAgICAgICBvdGhlclRleHQgKz0gXCI8YnI+cmVwZWF0ZWRcIjtcbiAgICB9XG4gICAgaWYgKHJlc3VsdC5iYWlsZWRPdXQpIHtcbiAgICAgICAgb3RoZXJUZXh0ICs9IFwiPGJyPmJhaWxlZCBvdXRcIjtcbiAgICB9XG4gICAgaWYgKHRvb1Nob3J0KSB7XG4gICAgICAgIG90aGVyVGV4dCArPSBcIjxicj50b28gc2hvcnRcIjtcbiAgICB9XG4gICAgaWYgKG90aGVyVGV4dCA9PSBcIlwiKSB7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAuaW5mb1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAuaW5mb1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgb3RoZXJUZXh0ID0gb3RoZXJUZXh0LnN1YnN0cmluZyg0KTtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5pbmZvIC5ib3R0b21cIikuaHRtbChvdGhlclRleHQpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHVwZGF0ZVJhdGVRdW90ZShyYW5kb21RdW90ZSkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgIGNvbnN0IHVzZXJxciA9IChfYiA9IChfYSA9IERCLmdldFNuYXBzaG90KCkucXVvdGVSYXRpbmdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbcmFuZG9tUXVvdGUubGFuZ3VhZ2VdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2JbcmFuZG9tUXVvdGUuaWRdO1xuICAgICAgICBpZiAodXNlcnFyKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICNyZXN1bHQgI3JhdGVRdW90ZUJ1dHRvbiAuaWNvblwiKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImZhclwiKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcImZhc1wiKTtcbiAgICAgICAgfVxuICAgICAgICBRdW90ZVJhdGVQb3B1cC5nZXRRdW90ZVN0YXRzKHJhbmRvbVF1b3RlKS50aGVuKChxdW90ZVN0YXRzKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjcmVzdWx0ICNyYXRlUXVvdGVCdXR0b24gLnJhdGluZ1wiKS50ZXh0KChfYiA9IChfYSA9IHF1b3RlU3RhdHMgPT09IG51bGwgfHwgcXVvdGVTdGF0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcXVvdGVTdGF0cy5hdmVyYWdlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudG9GaXhlZCgxKSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogXCJcIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICNyZXN1bHQgI3JhdGVRdW90ZUJ1dHRvblwiKVxuICAgICAgICAgICAgICAgIC5jc3MoeyBvcGFjaXR5OiAwIH0pXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAgICAgLmNzcyh7IG9wYWNpdHk6IDEgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMudXBkYXRlUmF0ZVF1b3RlID0gdXBkYXRlUmF0ZVF1b3RlO1xuZnVuY3Rpb24gdXBkYXRlUXVvdGVTb3VyY2UocmFuZG9tUXVvdGUpIHtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInF1b3RlXCIpIHtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5zb3VyY2VcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAuc291cmNlIC5ib3R0b21cIikuaHRtbChyYW5kb21RdW90ZS5zb3VyY2UpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5zb3VyY2VcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxufVxuZnVuY3Rpb24gdXBkYXRlKHJlcywgZGlmZmljdWx0eUZhaWxlZCwgZmFpbFJlYXNvbiwgYWZrRGV0ZWN0ZWQsIGlzUmVwZWF0ZWQsIHRvb1Nob3J0LCByYW5kb21RdW90ZSwgZG9udFNhdmUpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICByZXN1bHRTY2FsZU9wdGlvbnMgPSBDaGFydENvbnRyb2xsZXIucmVzdWx0Lm9wdGlvbnMuc2NhbGVzO1xuICAgICAgICByZXN1bHRBbm5vdGF0aW9uID0gW107XG4gICAgICAgIHJlc3VsdCA9IHJlcztcbiAgICAgICAgJChcIiNyZXN1bHQgI3Jlc3VsdFdvcmRzSGlzdG9yeVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiNyZXRyeVNhdmluZ1Jlc3VsdEJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIi5wYWdlVGVzdCAjcmVzdWx0ICNyYXRlUXVvdGVCdXR0b24gLmljb25cIilcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImZhc1wiKVxuICAgICAgICAgICAgLmFkZENsYXNzKFwiZmFyXCIpO1xuICAgICAgICAkKFwiLnBhZ2VUZXN0ICNyZXN1bHQgI3JhdGVRdW90ZUJ1dHRvbiAucmF0aW5nXCIpLnRleHQoXCJcIik7XG4gICAgICAgICQoXCIucGFnZVRlc3QgI3Jlc3VsdCAjcmF0ZVF1b3RlQnV0dG9uXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI3Rlc3RNb2Rlc05vdGljZVwiKS5jc3MoXCJvcGFjaXR5XCIsIDApO1xuICAgICAgICAkKFwiI3dvcmRzXCIpLnJlbW92ZUNsYXNzKFwiYmx1cnJlZFwiKTtcbiAgICAgICAgJChcIiN3b3Jkc0lucHV0XCIpLmJsdXIoKTtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC50aW1lIC5ib3R0b20gLmFma1wiKS50ZXh0KFwiXCIpO1xuICAgICAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyICE9IG51bGwpIHtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5sb2dpblRpcFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5sb2dpblRpcFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVXcG1BbmRBY2MoKTtcbiAgICAgICAgdXBkYXRlQ29uc2lzdGVuY3koKTtcbiAgICAgICAgdXBkYXRlVGltZSgpO1xuICAgICAgICB1cGRhdGVLZXkoKTtcbiAgICAgICAgdXBkYXRlVGVzdFR5cGUocmFuZG9tUXVvdGUpO1xuICAgICAgICB1cGRhdGVRdW90ZVNvdXJjZShyYW5kb21RdW90ZSk7XG4gICAgICAgIHlpZWxkIHVwZGF0ZUdyYXBoKCk7XG4gICAgICAgIHlpZWxkIHVwZGF0ZUdyYXBoUEJMaW5lKCk7XG4gICAgICAgIHVwZGF0ZVRhZ3MoZG9udFNhdmUpO1xuICAgICAgICB1cGRhdGVPdGhlcihkaWZmaWN1bHR5RmFpbGVkLCBmYWlsUmVhc29uLCBhZmtEZXRlY3RlZCwgaXNSZXBlYXRlZCwgdG9vU2hvcnQpO1xuICAgICAgICBDaGFydENvbnRyb2xsZXIucmVzdWx0Lm9wdGlvbnNcbiAgICAgICAgICAgIC5wbHVnaW5zLmFubm90YXRpb24uYW5ub3RhdGlvbnMgPVxuICAgICAgICAgICAgcmVzdWx0QW5ub3RhdGlvbjtcbiAgICAgICAgQ2hhcnRDb250cm9sbGVyLnJlc3VsdC51cGRhdGVDb2xvcnMoKTtcbiAgICAgICAgQ2hhcnRDb250cm9sbGVyLnJlc3VsdC5yZXNpemUoKTtcbiAgICAgICAgaWYgKCQoXCIjcmVzdWx0IC5zdGF0cyAudGFnc1wiKS5oYXNDbGFzcyhcImhpZGRlblwiKSAmJlxuICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5pbmZvXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLmluZm9BbmRUYWdzXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5pbmZvQW5kVGFnc1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoR2xhcnNlc01vZGUuZ2V0KCkpIHtcbiAgICAgICAgICAgICQoXCIjbWlkZGxlICNyZXN1bHQgLm5vU3RyZXNzTWVzc2FnZVwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICQoXCIjbWlkZGxlICNyZXN1bHRcIikucHJlcGVuZChgXG5cbiAgICAgIDxkaXYgY2xhc3M9J25vU3RyZXNzTWVzc2FnZScgc3R5bGU9XCJcbiAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgICAgICBncmlkLWNvbHVtbjogMS8zO1xuICAgICAgICBmb250LXNpemU6IDJyZW07XG4gICAgICAgIHBhZGRpbmctYm90dG9tOiAycmVtO1xuICAgICAgXCI+XG4gICAgICA8aSBjbGFzcz1cImZhcyBmYS1jaGVja1wiPjwvaT5cbiAgICAgIDwvZGl2PlxuXG4gICAgYCk7XG4gICAgICAgICAgICAkKFwiI21pZGRsZSAjcmVzdWx0IC5zdGF0c1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIjbWlkZGxlICNyZXN1bHQgLmNoYXJ0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIiNtaWRkbGUgI3Jlc3VsdCAjcmVzdWx0V29yZHNIaXN0b3J5XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIiNtaWRkbGUgI3Jlc3VsdCAjcmVzdWx0UmVwbGF5XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIiNtaWRkbGUgI3Jlc3VsdCAubG9naW5UaXBcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiI21pZGRsZSAjcmVzdWx0ICNzaG93V29yZEhpc3RvcnlCdXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiI21pZGRsZSAjcmVzdWx0ICN3YXRjaFJlcGxheUJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIjbWlkZGxlICNyZXN1bHQgI3NhdmVTY3JlZW5zaG90QnV0dG9uXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYFRlc3QgQ29tcGxldGVkOiAke3Jlc3VsdC53cG19IHdwbSAke3Jlc3VsdC5hY2N9JSBhY2MgJHtyZXN1bHQucmF3V3BtfSByYXcgJHtyZXN1bHQuY29uc2lzdGVuY3l9JSBjb25zaXN0ZW5jeWApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIiNtaWRkbGUgI3Jlc3VsdCAuc3RhdHNcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiI21pZGRsZSAjcmVzdWx0IC5jaGFydFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIC8vICQoXCIjbWlkZGxlICNyZXN1bHQgI3Jlc3VsdFdvcmRzSGlzdG9yeVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICQoXCIjbWlkZGxlICNyZXN1bHQgLmxvZ2luVGlwXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJChcIiNtaWRkbGUgI3Jlc3VsdCAjc2hvd1dvcmRIaXN0b3J5QnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIiNtaWRkbGUgI3Jlc3VsdCAjd2F0Y2hSZXBsYXlCdXR0b25cIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiI21pZGRsZSAjcmVzdWx0ICNzYXZlU2NyZWVuc2hvdEJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAod2luZG93LnNjcm9sbFkgPiAwKSB7XG4gICAgICAgICAgICAkKFtkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIGRvY3VtZW50LmJvZHldKVxuICAgICAgICAgICAgICAgIC5zdG9wKClcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7IHNjcm9sbFRvcDogMCB9LCAyNTApO1xuICAgICAgICB9XG4gICAgICAgIE1pc2Muc3dhcEVsZW1lbnRzKCQoXCIjdHlwaW5nVGVzdFwiKSwgJChcIiNyZXN1bHRcIiksIDI1MCwgKCkgPT4ge1xuICAgICAgICAgICAgVGVzdFVJLnNldFJlc3VsdENhbGN1bGF0aW5nKGZhbHNlKTtcbiAgICAgICAgICAgICQoXCIjd29yZHNcIikuZW1wdHkoKTtcbiAgICAgICAgICAgIENoYXJ0Q29udHJvbGxlci5yZXN1bHQucmVzaXplKCk7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93V29yZHNIaXN0b3J5ICYmIGNvbmZpZ18xLmRlZmF1bHQuYnVyc3RIZWF0bWFwKSB7XG4gICAgICAgICAgICAgICAgVGVzdFVJLmFwcGx5QnVyc3RIZWF0bWFwKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdFwiKS50cmlnZ2VyKFwiZm9jdXNcIik7XG4gICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oeyB0b3A6IDAgfSk7XG4gICAgICAgICAgICAkKFwiI3Rlc3RNb2Rlc05vdGljZVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNyZXN1bHRFeHRyYUJ1dHRvbnNcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIikuY3NzKFwib3BhY2l0eVwiLCAwKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgfSwgMTI1KTtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dXb3Jkc0hpc3RvcnkgJiYgIUdsYXJzZXNNb2RlLmdldCgpKSB7XG4gICAgICAgICAgICAgICAgVGVzdFVJLnRvZ2dsZVJlc3VsdFdvcmRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBLZXltYXAuaGlkZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgUmVzdWx0c1Nob3duRXZlbnQuZGlzcGF0Y2goe1xuICAgICAgICAgICAgcmVzLFxuICAgICAgICAgICAgZGlmZmljdWx0eUZhaWxlZCxcbiAgICAgICAgICAgIGZhaWxSZWFzb24sXG4gICAgICAgICAgICBhZmtEZXRlY3RlZCxcbiAgICAgICAgICAgIGlzUmVwZWF0ZWQsXG4gICAgICAgICAgICB0b29TaG9ydCxcbiAgICAgICAgICAgIHJhbmRvbVF1b3RlLFxuICAgICAgICAgICAgZG9udFNhdmUsXG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZXhwb3J0cy51cGRhdGUgPSB1cGRhdGU7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmlzVXNpbmdPcHBvc2l0ZVNoaWZ0ID0gZXhwb3J0cy5yZXNldCA9IGV4cG9ydHMucmlnaHRTdGF0ZSA9IGV4cG9ydHMubGVmdFN0YXRlID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IGNhcHNfd2FybmluZ18xID0gcmVxdWlyZShcIi4vY2Fwcy13YXJuaW5nXCIpO1xuZXhwb3J0cy5sZWZ0U3RhdGUgPSBmYWxzZTtcbmV4cG9ydHMucmlnaHRTdGF0ZSA9IGZhbHNlO1xubGV0IGNhc2VTdGF0ZSA9IGZhbHNlO1xuY29uc3Qga2V5bWFwU3RyaW5ncyA9IHtcbiAgICBsZWZ0OiBudWxsLFxuICAgIHJpZ2h0OiBudWxsLFxuICAgIGtleW1hcDogbnVsbCxcbn07XG5mdW5jdGlvbiBkeW5hbWljS2V5bWFwTGVnZW5kU3R5bGUodXBwZXJjYXNlKSB7XG4gICAgY29uc3Qga2V5bWFwS2V5cyA9IFtcbiAgICAgICAgLi4uZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImtleW1hcC1rZXlcIiksXG4gICAgXTtcbiAgICBjb25zdCBsYXlvdXRLZXlzID0ga2V5bWFwS2V5cy5tYXAoKGVsKSA9PiBlbC5kYXRhc2V0W1wia2V5XCJdKTtcbiAgICBjb25zdCBrZXlzID0ga2V5bWFwS2V5cy5tYXAoKGVsKSA9PiBlbC5jaGlsZE5vZGVzWzFdKTtcbiAgICBpZiAoY2Fwc193YXJuaW5nXzEuY2Fwc1N0YXRlKVxuICAgICAgICB1cHBlcmNhc2UgPSAhdXBwZXJjYXNlO1xuICAgIGlmIChsYXlvdXRLZXlzLmZpbHRlcigodikgPT4gdiA9PT0gdW5kZWZpbmVkKS5sZW5ndGggPiAyKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKCh1cHBlcmNhc2UgJiYgY2FzZVN0YXRlKSB8fCAoIXVwcGVyY2FzZSAmJiAhY2FzZVN0YXRlKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGNhc2VTdGF0ZSA9IHVwcGVyY2FzZTtcbiAgICBjb25zdCBpbmRleCA9IGNhc2VTdGF0ZSA/IDEgOiAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGF5b3V0S2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBsYXlvdXRLZXkgPSBsYXlvdXRLZXlzW2ldLCBrZXkgPSBrZXlzW2ldO1xuICAgICAgICBpZiAoa2V5ID09PSB1bmRlZmluZWQgfHwgbGF5b3V0S2V5ID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAga2V5LnRleHRDb250ZW50ID0gbGF5b3V0S2V5W2luZGV4XTtcbiAgICB9XG59XG5mdW5jdGlvbiBidWlsZEtleW1hcFN0cmluZ3MoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKGtleW1hcFN0cmluZ3Mua2V5bWFwID09PSBjb25maWdfMS5kZWZhdWx0LmtleW1hcExheW91dClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgbGF5b3V0ID0geWllbGQgTWlzYy5nZXRMYXlvdXQoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBMYXlvdXQpO1xuICAgICAgICBpZiAobGF5b3V0ID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGxheW91dEtleXMgPSBsYXlvdXQua2V5cztcbiAgICAgICAgY29uc3QgbGF5b3V0S2V5c0VudHJpZXMgPSBPYmplY3QuZW50cmllcyhsYXlvdXRLZXlzKTtcbiAgICAgICAga2V5bWFwU3RyaW5ncy5rZXltYXAgPSBjb25maWdfMS5kZWZhdWx0LmtleW1hcExheW91dDtcbiAgICAgICAgaWYgKCFsYXlvdXQpIHtcbiAgICAgICAgICAgIGtleW1hcFN0cmluZ3MubGVmdCA9IG51bGw7XG4gICAgICAgICAgICBrZXltYXBTdHJpbmdzLnJpZ2h0ID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGtleW1hcFN0cmluZ3MubGVmdCA9IGxheW91dEtleXNFbnRyaWVzXG4gICAgICAgICAgICAgICAgLm1hcCgoW3Jvd05hbWUsIHJvd10pID0+IHJvd1xuICAgICAgICAgICAgICAgIC8vIGluY2x1ZGVzIFwiNlwiIGFuZCBcInlcIiAoYnV0dG9ucyBvbiBxd2VydHkpIGludG8gdGhlIGxlZnQgaGFuZFxuICAgICAgICAgICAgICAgIC5zbGljZSgwLCBbXCJyb3cxXCIsIFwicm93MlwiXS5pbmNsdWRlcyhyb3dOYW1lKVxuICAgICAgICAgICAgICAgID8gcm93TmFtZSA9PT0gXCJyb3cxXCJcbiAgICAgICAgICAgICAgICAgICAgPyA3XG4gICAgICAgICAgICAgICAgICAgIDogNlxuICAgICAgICAgICAgICAgIDogNSlcbiAgICAgICAgICAgICAgICAubWFwKChrZXkpID0+IGtleS5zcGxpdChcIlwiKSkpXG4gICAgICAgICAgICAgICAgLmZsYXQoMik7XG4gICAgICAgICAgICBrZXltYXBTdHJpbmdzLnJpZ2h0ID0gbGF5b3V0S2V5c0VudHJpZXNcbiAgICAgICAgICAgICAgICAubWFwKChbcm93TmFtZSwgcm93XSkgPT4gcm93XG4gICAgICAgICAgICAgICAgLy8gaW5jbHVkZXMgXCJiXCIgKGJ1dHRvbnMgb24gcXdlcnR5KSBpbnRvIHRoZSByaWdodCBoYW5kXG4gICAgICAgICAgICAgICAgLnNsaWNlKFtcInJvdzFcIiwgXCJyb3c0XCJdLmluY2x1ZGVzKHJvd05hbWUpXG4gICAgICAgICAgICAgICAgPyByb3dOYW1lID09PSBcInJvdzFcIlxuICAgICAgICAgICAgICAgICAgICA/IDZcbiAgICAgICAgICAgICAgICAgICAgOiA0XG4gICAgICAgICAgICAgICAgOiA1KVxuICAgICAgICAgICAgICAgIC5tYXAoKGtleSkgPT4ga2V5LnNwbGl0KFwiXCIpKSlcbiAgICAgICAgICAgICAgICAuZmxhdCgyKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuJChkb2N1bWVudCkub24oXCJrZXlkb3duXCIsIChlKSA9PiB7XG4gICAgaWYgKGUuY29kZSA9PT0gXCJTaGlmdExlZnRcIikge1xuICAgICAgICBleHBvcnRzLmxlZnRTdGF0ZSA9IHRydWU7XG4gICAgICAgIGV4cG9ydHMucmlnaHRTdGF0ZSA9IGZhbHNlO1xuICAgIH1cbiAgICBlbHNlIGlmIChlLmNvZGUgPT09IFwiU2hpZnRSaWdodFwiKSB7XG4gICAgICAgIGV4cG9ydHMubGVmdFN0YXRlID0gZmFsc2U7XG4gICAgICAgIGV4cG9ydHMucmlnaHRTdGF0ZSA9IHRydWU7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmtleW1hcExlZ2VuZFN0eWxlID09PSBcImR5bmFtaWNcIikge1xuICAgICAgICBkeW5hbWljS2V5bWFwTGVnZW5kU3R5bGUoZXhwb3J0cy5sZWZ0U3RhdGUgfHwgZXhwb3J0cy5yaWdodFN0YXRlKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQpLmtleXVwKChlKSA9PiB7XG4gICAgaWYgKGUuY29kZSA9PT0gXCJTaGlmdExlZnRcIiB8fCBlLmNvZGUgPT09IFwiU2hpZnRSaWdodFwiKSB7XG4gICAgICAgIGV4cG9ydHMubGVmdFN0YXRlID0gZmFsc2U7XG4gICAgICAgIGV4cG9ydHMucmlnaHRTdGF0ZSA9IGZhbHNlO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBMZWdlbmRTdHlsZSA9PT0gXCJkeW5hbWljXCIpIHtcbiAgICAgICAgZHluYW1pY0tleW1hcExlZ2VuZFN0eWxlKGV4cG9ydHMubGVmdFN0YXRlIHx8IGV4cG9ydHMucmlnaHRTdGF0ZSk7XG4gICAgfVxufSk7XG5mdW5jdGlvbiByZXNldCgpIHtcbiAgICBleHBvcnRzLmxlZnRTdGF0ZSA9IGZhbHNlO1xuICAgIGV4cG9ydHMucmlnaHRTdGF0ZSA9IGZhbHNlO1xufVxuZXhwb3J0cy5yZXNldCA9IHJlc2V0O1xuY29uc3QgbGVmdFNpZGVLZXlzID0gW1xuICAgIFwiS2V5UVwiLFxuICAgIFwiS2V5V1wiLFxuICAgIFwiS2V5RVwiLFxuICAgIFwiS2V5UlwiLFxuICAgIFwiS2V5VFwiLFxuICAgIFwiS2V5QVwiLFxuICAgIFwiS2V5U1wiLFxuICAgIFwiS2V5RFwiLFxuICAgIFwiS2V5RlwiLFxuICAgIFwiS2V5R1wiLFxuICAgIFwiS2V5WlwiLFxuICAgIFwiS2V5WFwiLFxuICAgIFwiS2V5Q1wiLFxuICAgIFwiS2V5VlwiLFxuICAgIFwiQmFja3F1b3RlXCIsXG4gICAgXCJEaWdpdDFcIixcbiAgICBcIkRpZ2l0MlwiLFxuICAgIFwiRGlnaXQzXCIsXG4gICAgXCJEaWdpdDRcIixcbiAgICBcIkRpZ2l0NVwiLFxuXTtcbmNvbnN0IHJpZ2h0U2lkZUtleXMgPSBbXG4gICAgXCJLZXlVXCIsXG4gICAgXCJLZXlJXCIsXG4gICAgXCJLZXlPXCIsXG4gICAgXCJLZXlQXCIsXG4gICAgXCJLZXlIXCIsXG4gICAgXCJLZXlKXCIsXG4gICAgXCJLZXlLXCIsXG4gICAgXCJLZXlMXCIsXG4gICAgXCJLZXlOXCIsXG4gICAgXCJLZXlNXCIsXG4gICAgXCJEaWdpdDdcIixcbiAgICBcIkRpZ2l0OFwiLFxuICAgIFwiRGlnaXQ5XCIsXG4gICAgXCJEaWdpdDBcIixcbiAgICBcIkJhY2tzbGFzaFwiLFxuICAgIFwiQnJhY2tldExlZnRcIixcbiAgICBcIkJyYWNrZXRSaWdodFwiLFxuICAgIFwiU2VtaWNvbG9uXCIsXG4gICAgXCJRdW90ZVwiLFxuICAgIFwiQ29tbWFcIixcbiAgICBcIlBlcmlvZFwiLFxuICAgIFwiU2xhc2hcIixcbl07XG5mdW5jdGlvbiBpc1VzaW5nT3Bwb3NpdGVTaGlmdChldmVudCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmICghZXhwb3J0cy5sZWZ0U3RhdGUgJiYgIWV4cG9ydHMucmlnaHRTdGF0ZSlcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5vcHBvc2l0ZVNoaWZ0TW9kZSA9PT0gXCJvblwiKSB7XG4gICAgICAgICAgICBpZiAoIXJpZ2h0U2lkZUtleXMuaW5jbHVkZXMoZXZlbnQuY29kZSkgJiZcbiAgICAgICAgICAgICAgICAhbGVmdFNpZGVLZXlzLmluY2x1ZGVzKGV2ZW50LmNvZGUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoKGV4cG9ydHMubGVmdFN0YXRlICYmIHJpZ2h0U2lkZUtleXMuaW5jbHVkZXMoZXZlbnQuY29kZSkpIHx8XG4gICAgICAgICAgICAgICAgKGV4cG9ydHMucmlnaHRTdGF0ZSAmJiBsZWZ0U2lkZUtleXMuaW5jbHVkZXMoZXZlbnQuY29kZSkpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5vcHBvc2l0ZVNoaWZ0TW9kZSA9PT0gXCJrZXltYXBcIikge1xuICAgICAgICAgICAgeWllbGQgYnVpbGRLZXltYXBTdHJpbmdzKCk7XG4gICAgICAgICAgICBpZiAoIWtleW1hcFN0cmluZ3MubGVmdCB8fCAha2V5bWFwU3RyaW5ncy5yaWdodClcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIGlmICgoZXhwb3J0cy5sZWZ0U3RhdGUgJiYga2V5bWFwU3RyaW5ncy5yaWdodC5pbmNsdWRlcyhldmVudC5rZXkpKSB8fFxuICAgICAgICAgICAgICAgIChleHBvcnRzLnJpZ2h0U3RhdGUgJiYga2V5bWFwU3RyaW5ncy5sZWZ0LmluY2x1ZGVzKGV2ZW50LmtleSkpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG59XG5leHBvcnRzLmlzVXNpbmdPcHBvc2l0ZVNoaWZ0ID0gaXNVc2luZ09wcG9zaXRlU2hpZnQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5nZXRUYmRNb2RlID0gdm9pZCAwO1xuY29uc3Qgd29yZHNldF8xID0gcmVxdWlyZShcIi4vd29yZHNldFwiKTtcbmNvbnN0IFRlc3RJbnB1dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LWlucHV0XCIpKTtcbmNvbnN0IFBhZ2VDaGFuZ2VFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvcGFnZS1jaGFuZ2UtZXZlbnRcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBtaXNjXzEgPSByZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgUmVzdWx0c1Nob3duRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL3Jlc3VsdHMtc2hvd24tZXZlbnRcIikpO1xuY29uc3QgV29yZFR5cGVkRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL3dvcmQtdHlwZWQtZXZlbnRcIikpO1xuY29uc3QgUmVzZXRSZXF1ZXN0ZWRFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvcmVzZXQtcmVxdWVzdGVkLWV2ZW50XCIpKTtcbmNvbnN0IGRlYm91bmNlXzEgPSByZXF1aXJlKFwiLi4vdXRpbHMvZGVib3VuY2VcIik7XG5jbGFzcyBUYmRDb25maWcge1xuICAgIGluaXQoKSB7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwic29ydGVyU2VsZWN0Q2hhbmdlZFwiLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXQoXCJzb3J0ZXJcIiwgZGF0YVtcInZhbHVlXCJdKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwiY29uZmlnVXBkYXRlUmVxdWVzdGVkXCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKGRhdGFbXCJjb25maWdTZXR0aW5nXCJdKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcInRhcmdldFNwZWVkXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvY2Vzc1RhcmdldFNwZWVkVXBkYXRlUmVxdWVzdCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZ3JvdXBTaXplXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvY2Vzc0dyb3VwU2l6ZVVwZGF0ZVJlcXVlc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImFuaW1hdGlvbnNcIjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzQW5pbWF0aW9uVG9nZ2xlUmVxdWVzdCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwidW5iZWF0ZW5Xb3JkUGVyY2VudGFnZVwiOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NVbmJlYXRlbldvcmRQZXJjZW50YWdlUmVxdWVzdCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldChrZXksIGRlZmF1bHRWYWx1ZSA9IFwiXCIpIHtcbiAgICAgICAgY29uc3QgY29uZmlnRGF0YSA9IFRiZERhdGEuZ2V0QWxsKCkuY29uZmlnO1xuICAgICAgICByZXR1cm4gY29uZmlnRGF0YVtrZXldIHx8IGRlZmF1bHRWYWx1ZTtcbiAgICB9XG4gICAgc2V0KGtleSwgdmFsdWUpIHtcbiAgICAgICAgY29uc3Qgb3JpZ2luYWwgPSB0aGlzLmdldChrZXkpO1xuICAgICAgICBpZiAob3JpZ2luYWwgPT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkYXRhID0gVGJkRGF0YS5nZXRBbGwoKTtcbiAgICAgICAgZGF0YS5jb25maWdba2V5XSA9IHZhbHVlO1xuICAgICAgICBUYmREYXRhLnVwZGF0ZURhdGEoZGF0YSk7XG4gICAgICAgIFRiZEV2ZW50cy5kaXNwYXRjaEV2ZW50KGAke2tleX0tY2hhbmdlZGAsIHtcbiAgICAgICAgICAgIG9yaWdpbmFsOiBvcmlnaW5hbCxcbiAgICAgICAgICAgIG5ld1ZhbHVlOiB2YWx1ZSxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGJ1bXBUYXJnZXRTcGVlZCgpIHtcbiAgICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuZ2V0VGFyZ2V0U3BlZWQoKTtcbiAgICAgICAgdGhpcy5zZXQoXCJ0YXJnZXRTcGVlZFwiLCAoY3VycmVudCArIDUpLnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgICBnZXRTb3J0ZXJOYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXQoXCJzb3J0ZXJcIiwgXCJhbHBoYWJldGljYWwtYXNjXCIpO1xuICAgIH1cbiAgICBnZXRTb3J0ZXIoKSB7XG4gICAgICAgIHJldHVybiBUYmRTb3J0aW5nLmdldFNvcnRlcih0aGlzLmdldFNvcnRlck5hbWUoKSk7XG4gICAgfVxuICAgIGdldFRhcmdldFNwZWVkKCkge1xuICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5nZXQoXCJ0YXJnZXRTcGVlZFwiLCBcIjc1XCIpKTtcbiAgICB9XG4gICAgZ2V0R3JvdXBTaXplKCkge1xuICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5nZXQoXCJncm91cFNpemVcIiwgXCIzMFwiKSk7XG4gICAgfVxuICAgIGdldFVuYmVhdGVuV29yZFBlcmNlbnRhZ2UoKSB7XG4gICAgICAgIHJldHVybiBwYXJzZUludCh0aGlzLmdldChcInVuYmVhdGVuV29yZFBlcmNlbnRhZ2VcIiwgXCI2MFwiKSk7XG4gICAgfVxuICAgIHByb2Nlc3NUYXJnZXRTcGVlZFVwZGF0ZVJlcXVlc3QoKSB7XG4gICAgICAgIGNvbnN0IG5ld1NwZWVkID0gcGFyc2VJbnQocHJvbXB0KFwiTmV3IHRhcmdldCBzcGVlZFwiLCB0aGlzLmdldFRhcmdldFNwZWVkKCkudG9TdHJpbmcoKSkgfHwgXCJcIik7XG4gICAgICAgIGlmIChuZXdTcGVlZCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuc2V0KFwidGFyZ2V0U3BlZWRcIiwgbmV3U3BlZWQudG9TdHJpbmcoKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJvY2Vzc0FuaW1hdGlvblRvZ2dsZVJlcXVlc3QoKSB7XG4gICAgICAgIGNvbnN0IGVuYWJsZWQgPSBjb25maXJtKFwiQ29uZmlybSB0byBlbmFibGUsIGNhbmNlbCB0byBkaXNhYmxlLlwiKTtcbiAgICAgICAgaWYgKGVuYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0KFwiYW5pbWF0aW9uc0VuYWJsZWRcIiwgXCIxXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXQoXCJhbmltYXRpb25zRW5hYmxlZFwiLCBcIjBcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXJlQW5pbWF0aW9uc0VuYWJsZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldChcImFuaW1hdGlvbnNFbmFibGVkXCIsIFwiMVwiKSA9PSBcIjFcIjtcbiAgICB9XG4gICAgcHJvY2Vzc0dyb3VwU2l6ZVVwZGF0ZVJlcXVlc3QoKSB7XG4gICAgICAgIGNvbnN0IG5ld1NpemUgPSBwYXJzZUludChwcm9tcHQoXCJOZXcgZ3JvdXAgc2l6ZVwiLCB0aGlzLmdldEdyb3VwU2l6ZSgpLnRvU3RyaW5nKCkpIHx8IFwiXCIpO1xuICAgICAgICBpZiAobmV3U2l6ZSA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuc2V0KFwiZ3JvdXBTaXplXCIsIG5ld1NpemUudG9TdHJpbmcoKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJvY2Vzc1VuYmVhdGVuV29yZFBlcmNlbnRhZ2VSZXF1ZXN0KCkge1xuICAgICAgICBjb25zdCBuZXdQZXJjZW50YWdlID0gcGFyc2VJbnQocHJvbXB0KGBUaGUgb2RkcyAoc3RpbGwgcmFuZG9tKSB0aGF0IGEgdGVzdCB3b3JkIHdpbGwgYmUgb25lIHRoYXQgaGFzbid0IGJlZW4gdHlwZWQgZmFzdGVyIHRoYW4gdGhlIGN1cnJlbnQgZ3JvdXAgdGhyZXNob2xkLiBcbiAgICAgICAgXG4gICAgICAgIE11c3QgYmUgYmV0d2VlbiAxMC05MGAsIHRoaXMuZ2V0VW5iZWF0ZW5Xb3JkUGVyY2VudGFnZSgpLnRvU3RyaW5nKCkpIHx8IFwiXCIpO1xuICAgICAgICBpZiAoaXNOYU4obmV3UGVyY2VudGFnZSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmV3UGVyY2VudGFnZSA8IDEwIHx8IG5ld1BlcmNlbnRhZ2UgPiA5MCkge1xuICAgICAgICAgICAgYWxlcnQoYCR7bmV3UGVyY2VudGFnZX0gaXNuJ3QgYSB2YWxpZCBjaG9pY2UuYCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXQoXCJ1bmJlYXRlbldvcmRQZXJjZW50YWdlXCIsIG5ld1BlcmNlbnRhZ2UudG9TdHJpbmcoKSk7XG4gICAgfVxufVxuY2xhc3MgVGJkU29ydGluZyB7XG4gICAgc3RhdGljIGdldFNvcnRlcihuYW1lKSB7XG4gICAgICAgIHN3aXRjaCAobmFtZSkge1xuICAgICAgICAgICAgY2FzZSBcImFscGhhYmV0aWNhbC1hc2NcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gVGJkU29ydGluZy5hbHBoYWJldGljYWxBc2NlbmRpbmdTb3J0ZXI7XG4gICAgICAgICAgICBjYXNlIFwiYWxwaGFiZXRpY2FsLWRlc2NcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gVGJkU29ydGluZy5hbHBoYWJldGljYWxEZXNjZW5kaW5nU29ydGVyO1xuICAgICAgICAgICAgY2FzZSBcInNwZWVkLWFzY1wiOlxuICAgICAgICAgICAgICAgIHJldHVybiBUYmRTb3J0aW5nLnNwZWVkQXNjZW5kaW5nU29ydGVyO1xuICAgICAgICAgICAgY2FzZSBcInNwZWVkLWRlc2NcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gVGJkU29ydGluZy5zcGVlZERlc2NlbmRpbmdTb3J0ZXI7XG4gICAgICAgICAgICBjYXNlIFwidHlwZWRDb3VudFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBUYmRTb3J0aW5nLnR5cGVkQ291bnRTb3J0ZXI7XG4gICAgICAgICAgICBjYXNlIFwibWlzc2VkQ291bnRcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gVGJkU29ydGluZy5taXNzZWRDb3VudFNvcnRlcjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gVGJkU29ydGluZy5hbHBoYWJldGljYWxBc2NlbmRpbmdTb3J0ZXI7XG4gICAgfVxuICAgIHN0YXRpYyByYW5kb21Tb3J0ZXIoKSB7XG4gICAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpIDwgMC41ID8gLTEgOiAxO1xuICAgIH1cbiAgICBzdGF0aWMgYWxwaGFiZXRpY2FsRGVzY2VuZGluZ1NvcnRlcih3b3JkLCB3b3JkMikge1xuICAgICAgICByZXR1cm4gd29yZC50b0xvd2VyQ2FzZSgpIDwgd29yZDIudG9Mb3dlckNhc2UoKSA/IDEgOiAtMTtcbiAgICB9XG4gICAgc3RhdGljIGFscGhhYmV0aWNhbEFzY2VuZGluZ1NvcnRlcih3b3JkLCB3b3JkMikge1xuICAgICAgICByZXR1cm4gd29yZC50b0xvd2VyQ2FzZSgpIDwgd29yZDIudG9Mb3dlckNhc2UoKSA/IC0xIDogMTtcbiAgICB9XG4gICAgc3RhdGljIHNwZWVkQXNjZW5kaW5nU29ydGVyKHdvcmQsIHdvcmQyKSB7XG4gICAgICAgIGNvbnN0IHNwZWVkMSA9IFRiZERhdGEuZ2V0TWVkaWFuU3BlZWRGb3JXb3JkKHdvcmQpO1xuICAgICAgICBjb25zdCBzcGVlZDIgPSBUYmREYXRhLmdldE1lZGlhblNwZWVkRm9yV29yZCh3b3JkMik7XG4gICAgICAgIHJldHVybiBzcGVlZDEgLSBzcGVlZDI7XG4gICAgfVxuICAgIHN0YXRpYyBzcGVlZERlc2NlbmRpbmdTb3J0ZXIod29yZCwgd29yZDIpIHtcbiAgICAgICAgY29uc3Qgc3BlZWQxID0gVGJkRGF0YS5nZXRNZWRpYW5TcGVlZEZvcldvcmQod29yZCk7XG4gICAgICAgIGNvbnN0IHNwZWVkMiA9IFRiZERhdGEuZ2V0TWVkaWFuU3BlZWRGb3JXb3JkKHdvcmQyKTtcbiAgICAgICAgcmV0dXJuIHNwZWVkMiAtIHNwZWVkMTtcbiAgICB9XG4gICAgc3RhdGljIHR5cGVkQ291bnRTb3J0ZXIod29yZCwgd29yZDIpIHtcbiAgICAgICAgY29uc3QgdHlwZWQxID0gVGJkRGF0YS5nZXRTcGVlZHNGb3JXb3JkKHdvcmQpLmxlbmd0aDtcbiAgICAgICAgY29uc3QgdHlwZWQyID0gVGJkRGF0YS5nZXRTcGVlZHNGb3JXb3JkKHdvcmQyKS5sZW5ndGg7XG4gICAgICAgIHJldHVybiB0eXBlZDIgLSB0eXBlZDE7XG4gICAgfVxuICAgIHN0YXRpYyBtaXNzZWRDb3VudFNvcnRlcih3b3JkLCB3b3JkMikge1xuICAgICAgICByZXR1cm4gKFRiZERhdGEuZ2V0TWlzdHlwZWRDb3VudEZvcldvcmQod29yZDIpIC1cbiAgICAgICAgICAgIFRiZERhdGEuZ2V0TWlzdHlwZWRDb3VudEZvcldvcmQod29yZCkpO1xuICAgIH1cbn1cbmNsYXNzIFRiZE1vZGUge1xuICAgIGNvbnN0cnVjdG9yKGNvbmZpZykge1xuICAgICAgICB0aGlzLnByZXZpb3VzV29yZCA9IFwiXCI7XG4gICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgICAgICB0aGlzLm1vbmtleVR5cGVXb3Jkc2V0ID0gbmV3IHdvcmRzZXRfMS5Xb3Jkc2V0KFtdKTtcbiAgICAgICAgdGhpcy5jdXJyZW50R3JvdXAgPSBuZXcgVGJkR3JvdXAodGhpcy5tb25rZXlUeXBlV29yZHNldCk7XG4gICAgICAgIHRoaXMuZ3JvdXBzID0gbmV3IFRiZEdyb3VwcygpO1xuICAgIH1cbiAgICBpbml0KCkge1xuICAgICAgICBXb3JkVHlwZWRFdmVudC5zdWJzY3JpYmUodGhpcy5oYW5kbGVXb3JkVHlwZWQuYmluZCh0aGlzKSk7XG4gICAgICAgIFJlc3VsdHNTaG93bkV2ZW50LnN1YnNjcmliZSh0aGlzLmhhbmRsZVJlc3VsdHNTaG93bkV2ZW50LmJpbmQodGhpcykpO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcInJlc2V0QnV0dG9uQ2xpY2tlZFwiLCB0aGlzLnJlc2V0Q3VycmVudFdvcmRzLmJpbmQodGhpcykpO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcIndvcmRDbGlja2VkXCIsIHRoaXMucmVzZXRXb3JkLmJpbmQodGhpcykpO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcInRhcmdldFNwZWVkLWNoYW5nZWRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZWdlbmVyYXRlR3JvdXBzRnJvbVdvcmRzZXQodGhpcy5tb25rZXlUeXBlV29yZHNldCk7XG4gICAgICAgIH0pO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcImdyb3VwU2l6ZS1jaGFuZ2VkXCIsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVnZW5lcmF0ZUdyb3Vwc0Zyb21Xb3Jkc2V0KHRoaXMubW9ua2V5VHlwZVdvcmRzZXQpO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJ3b3Jkc1Jlc2V0XCIsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVnZW5lcmF0ZUdyb3Vwc0Zyb21Xb3Jkc2V0KHRoaXMubW9ua2V5VHlwZVdvcmRzZXQpO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJuZXh0R3JvdXBcIiwgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEdyb3VwID0gZGF0YVtcImdyb3VwXCJdO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJncm91cHNSZWdlbmVyYXRlZFwiLCAoKSA9PiB7XG4gICAgICAgICAgICBSZXNldFJlcXVlc3RlZEV2ZW50LmRpc3BhdGNoKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcImFjdGlvbkJ1dHRvbkNsaWNrZWRcIiwgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIHN3aXRjaCAoZGF0YVtcImFjdGlvblZhbHVlXCJdKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcInJlc2V0Q3VycmVudFdvcmRzXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzZXRDdXJyZW50V29yZHNSZXF1ZXN0KCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJyZXNldEFsbFdvcmRzXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzZXRBbGxXb3Jkc1JlcXVlc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImNvcHlBbGxEYXRhXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlQ29weURhdGFSZXF1ZXN0KCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJpbXBvcnREYXRhXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlSW1wb3J0RGF0YVJlcXVlc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoYW5kbGVXb3JkVHlwZWQoX3dvcmQsIGlzQ29ycmVjdCwgYnVyc3QsIGN1cnJlbnRXb3JkRWxlbWVudCkge1xuICAgICAgICBpZiAoIWlzQ29ycmVjdCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHdvcmRFbGVtZW50ID0gY3VycmVudFdvcmRFbGVtZW50WzBdO1xuICAgICAgICBjb25zdCB0eXBlZEFib3ZlVGFyZ2V0ID0gYnVyc3QgPiB0aGlzLmdldENvbmZpZygpLmdldFRhcmdldFNwZWVkKCk7XG4gICAgICAgIGlmICh0eXBlZEFib3ZlVGFyZ2V0KSB7XG4gICAgICAgICAgICBUYmRFdmVudHMuZGlzcGF0Y2hFdmVudChcIndvcmRUeXBlZENvcnJlY3RseVwiLCB7IHdvcmRFbGVtZW50IH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJ3b3JkTWlzc2VkXCIsIHsgd29yZEVsZW1lbnQgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlUmVzZXRDdXJyZW50V29yZHNSZXF1ZXN0KCkge1xuICAgICAgICBpZiAoY29uZmlybShcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byByZXNldCBkYXRhIGZvciB0aGUgY3VycmVudCB3b3Jkc2V0PyBUaGlzIGluY2x1ZGVzIGFsbFwiICtcbiAgICAgICAgICAgIFwiIHdvcmRzIGluIHRoZSBsYW5ndWFnZSBvciBjdXN0b20gd29yZCBzZXQgeW91IGFyZSB1c2luZywgbm90IGp1c3QgdGhlIGN1cnJlbnQgZ3JvdXAhXCIpKSB7XG4gICAgICAgICAgICBUYmREYXRhLnJlc2V0RGF0YUZvcldvcmRzKHRoaXMubW9ua2V5VHlwZVdvcmRzZXQud29yZHMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZUNvcHlEYXRhUmVxdWVzdCgpIHtcbiAgICAgICAgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQoSlNPTi5zdHJpbmdpZnkoVGJkRGF0YS5nZXRBbGwoKSkpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgYWxlcnQoXCJKU09OIGNvcGllZCB0byB5b3VyIGNsaXBib2FyZFwiKTtcbiAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgYWxlcnQoXCJUaGVyZSB3YXMgYSBwcm9ibGVtIGNvcHlpbmcgdGhlIGRhdGEgdG8geW91ciBjbGlwYm9hcmRcIik7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoYW5kbGVJbXBvcnREYXRhUmVxdWVzdCgpIHtcbiAgICAgICAgY29uc3QgZXhwb3J0SnNvbiA9IHByb21wdChcIkVudGVyIHRoZSBKU09OIHlvdSBnb3QgZnJvbSBhbiBleHBvcnQgaGVyZVwiKSB8fCBcIlwiO1xuICAgICAgICBpZiAoZXhwb3J0SnNvbiA9PSBcIlwiKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShleHBvcnRKc29uKTtcbiAgICAgICAgaWYgKFwid29yZHNcIiBpbiBwYXJzZWQgJiYgXCJjb25maWdcIiBpbiBwYXJzZWQpIHtcbiAgICAgICAgICAgIFRiZERhdGEudXBkYXRlRGF0YShwYXJzZWQsIHRydWUpO1xuICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhbGVydChcIlRoZXJlIHdhcyBzb21ldGhpbmcgd3Jvbmcgd2l0aCB5b3VyIEpTT04sIHNvcnJ5IVwiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRDb25maWcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbmZpZztcbiAgICB9XG4gICAgZ2V0V29yZChvcmlnaW5hbFdvcmRzZXQpIHtcbiAgICAgICAgdGhpcy5oYW5kbGVXb3Jkc2V0Rm9yTmV4dFdvcmQob3JpZ2luYWxXb3Jkc2V0KTtcbiAgICAgICAgY29uc3QgZ3JvdXAgPSB0aGlzLmdldEN1cnJlbnRHcm91cCgpO1xuICAgICAgICBjb25zdCByYW5kb20gPSBNYXRoLnJhbmRvbSgpICogMTAwO1xuICAgICAgICBjb25zdCB1bmJlYXRlbldvcmRzZXQgPSBncm91cC5nZXRVbmJlYXRlbldvcmRzZXQoKTtcbiAgICAgICAgY29uc3QgaXNUaGVyZU1vcmVUaGFuT25lV29yZCA9IGdyb3VwLmdldFdvcmRzZXQoKS5sZW5ndGggPiAxO1xuICAgICAgICBsZXQgbmV4dFdvcmQ7XG4gICAgICAgIGlmICh1bmJlYXRlbldvcmRzZXQubGVuZ3RoID4gMCAmJlxuICAgICAgICAgICAgcmFuZG9tIDw9IHRoaXMuZ2V0Q29uZmlnKCkuZ2V0VW5iZWF0ZW5Xb3JkUGVyY2VudGFnZSgpKSB7XG4gICAgICAgICAgICBuZXh0V29yZCA9IHVuYmVhdGVuV29yZHNldC5yYW5kb21Xb3JkKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBuZXh0V29yZCA9IGdyb3VwLmdldFdvcmRzZXQoKS5yYW5kb21Xb3JkKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucHJldmlvdXNXb3JkID09IG5leHRXb3JkICYmIGlzVGhlcmVNb3JlVGhhbk9uZVdvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFdvcmQob3JpZ2luYWxXb3Jkc2V0KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnByZXZpb3VzV29yZCA9IG5leHRXb3JkO1xuICAgICAgICByZXR1cm4gbmV4dFdvcmQ7XG4gICAgfVxuICAgIGdldEN1cnJlbnRHcm91cCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEdyb3VwO1xuICAgIH1cbiAgICBnZXRGaXJzdEluY29tcGxldGVHcm91cCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ3JvdXBzLmdldEZpcnN0SW5jb21wbGV0ZUdyb3VwKHRoaXMuY29uZmlnLmdldFRhcmdldFNwZWVkKCkpO1xuICAgIH1cbiAgICByZWNhbGN1bGF0ZUN1cnJlbnRHcm91cCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZ2V0Q3VycmVudEdyb3VwKCkuZ2V0VW5iZWF0ZW5Xb3Jkc2V0KCkubGVuZ3RoID4gMCAmJlxuICAgICAgICAgICAgdGhpcy5nZXRDdXJyZW50R3JvdXAoKS5nZXRUaHJlc2hvbGQoKSA8PSB0aGlzLmdldENvbmZpZygpLmdldFRhcmdldFNwZWVkKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5ncm91cHMuZ2V0R3JvdXBzKCkuaW5kZXhPZih0aGlzLmdldEN1cnJlbnRHcm91cCgpKTtcbiAgICAgICAgICAgIFRiZEV2ZW50cy5kaXNwYXRjaEV2ZW50KFwibmV4dEdyb3VwXCIsIHtcbiAgICAgICAgICAgICAgICBncm91cDogdGhpcy5nZXRDdXJyZW50R3JvdXAoKSxcbiAgICAgICAgICAgICAgICBncm91cE51bWJlcjogaW5kZXggKyAxLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IG5leHQgPSB0aGlzLmdldEZpcnN0SW5jb21wbGV0ZUdyb3VwKCk7XG4gICAgICAgIHdoaWxlIChuZXh0ID09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0Q29uZmlnKCkuYnVtcFRhcmdldFNwZWVkKCk7IC8vIHNpZGUgZWZmZWN0cywgcmVnZW5lcmF0ZXMgYWxsIGdyb3Vwc1xuICAgICAgICAgICAgbmV4dCA9IHRoaXMuZ2V0Rmlyc3RJbmNvbXBsZXRlR3JvdXAoKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuZ3JvdXBzLmdldEdyb3VwcygpLmluZGV4T2YodGhpcy5jdXJyZW50R3JvdXApO1xuICAgICAgICBUYmRFdmVudHMuZGlzcGF0Y2hFdmVudChcIm5leHRHcm91cFwiLCB7XG4gICAgICAgICAgICBncm91cDogbmV4dCxcbiAgICAgICAgICAgIGdyb3VwTnVtYmVyOiBpbmRleCArIDEsXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXRNb25rZXlUeXBlV29yZHNldCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubW9ua2V5VHlwZVdvcmRzZXQ7XG4gICAgfVxuICAgIGhhbmRsZVdvcmRzZXRGb3JOZXh0V29yZCh3b3Jkc2V0KSB7XG4gICAgICAgIGlmICh0aGlzLm1vbmtleVR5cGVXb3Jkc2V0Lmxlbmd0aCAhPSB3b3Jkc2V0Lmxlbmd0aCAmJlxuICAgICAgICAgICAgd29yZHNldC53b3Jkcy5qb2luKFwiJFwiKSAhPSB0aGlzLm1vbmtleVR5cGVXb3Jkc2V0LndvcmRzLmpvaW4oXCIkXCIpKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZU5ld1dvcmRzZXQod29yZHNldCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlTmV3V29yZHNldCh3b3Jkc2V0KSB7XG4gICAgICAgIHRoaXMubW9ua2V5VHlwZVdvcmRzZXQgPSB3b3Jkc2V0O1xuICAgICAgICB0aGlzLnJlZ2VuZXJhdGVHcm91cHNGcm9tV29yZHNldCh3b3Jkc2V0KTtcbiAgICB9XG4gICAgcmVnZW5lcmF0ZUdyb3Vwc0Zyb21Xb3Jkc2V0KHdvcmRzZXQpIHtcbiAgICAgICAgY29uc3Qgbm90QWJvdmVUYXJnZXRTcGVlZCA9IHdvcmRzZXQud29yZHMuZmlsdGVyKCh3b3JkKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gIVRiZERhdGEuaGFzV29yZEJlZW5UeXBlZEZhc3RlclRoYW4od29yZCwgdGhpcy5jb25maWcuZ2V0VGFyZ2V0U3BlZWQoKSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCB1bmlxdWVCZWxvd1RhcmdldCA9IG5ldyBTZXQobm90QWJvdmVUYXJnZXRTcGVlZCk7XG4gICAgICAgIGlmICh1bmlxdWVCZWxvd1RhcmdldC5zaXplID09IDApIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0Q29uZmlnKCkuYnVtcFRhcmdldFNwZWVkKCk7XG4gICAgICAgICAgICAvLyBCdW1waW5nIHRoZSB0YXJnZXQgdHJpZ2dlcnMgYSByZWdlbmVyYXRpb24gb2YgZ3JvdXBzIGFuZCBpbmZpbml0ZSBsb29wcyBhcmUgbm8gZnVuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ncm91cHMucmVnZW5lcmF0ZUdyb3VwcyhBcnJheS5mcm9tKHVuaXF1ZUJlbG93VGFyZ2V0KSwgdGhpcy5jb25maWcuZ2V0R3JvdXBTaXplKCkpO1xuICAgIH1cbiAgICBoYW5kbGVSZXN1bHRzU2hvd25FdmVudChyZXN1bHRzKSB7XG4gICAgICAgIGlmICghcmVzdWx0cy5kaWZmaWN1bHR5RmFpbGVkKSB7XG4gICAgICAgICAgICB0aGlzLnNhdmVCdXJzdHNGcm9tTGF0ZXN0UmVzdWx0cygpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2F2ZU1pc3Nlc0Zyb21MYXRlc3RSZXN1bHQoKTtcbiAgICAgICAgdGhpcy5yZWNhbGN1bGF0ZUN1cnJlbnRHcm91cCgpO1xuICAgICAgICB0aGlzLmdldEN1cnJlbnRHcm91cCgpLmluY3JlYXNlVGhyZXNob2xkVW50aWxTb21lV29yZHNBcmVVbmJlYXRlbigpO1xuICAgICAgICBUYmRFdmVudHMuZGlzcGF0Y2hFdmVudChcInJlc3VsdHNQcm9jZXNzZWRcIiwge1xuICAgICAgICAgICAgY3VycmVudEdyb3VwOiB0aGlzLmdldEN1cnJlbnRHcm91cCgpLFxuICAgICAgICAgICAgbW9ua2V5VHlwZVdvcmRzZXQ6IHRoaXMubW9ua2V5VHlwZVdvcmRzZXQsXG4gICAgICAgICAgICB0YXJnZXRTcGVlZDogdGhpcy5jb25maWcuZ2V0VGFyZ2V0U3BlZWQoKSxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHNhdmVCdXJzdHNGcm9tTGF0ZXN0UmVzdWx0cygpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0V29yZHMgPSBUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeTtcbiAgICAgICAgY29uc3QgcmVzdWx0QnVyc3RzID0gVGVzdElucHV0LmJ1cnN0SGlzdG9yeTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXN1bHRXb3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3Qgd29yZCA9IHJlc3VsdFdvcmRzW2ldO1xuICAgICAgICAgICAgY29uc3QgYnVyc3QgPSByZXN1bHRCdXJzdHNbaV07XG4gICAgICAgICAgICBUYmREYXRhLmFkZEJ1cnN0KHdvcmQsIGJ1cnN0KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXNldEN1cnJlbnRXb3JkcygpIHtcbiAgICAgICAgaWYgKCFjb25maXJtKFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHJlc2V0IHRoZSBzdGF0cyBmb3IgdGhlIGN1cnJlbnQgd29yZHM/XCIpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgVGJkRGF0YS5yZXNldERhdGFGb3JXb3Jkcyh0aGlzLm1vbmtleVR5cGVXb3Jkc2V0LndvcmRzKTtcbiAgICB9XG4gICAgcmVzZXRXb3JkKGRhdGEpIHtcbiAgICAgICAgY29uc3Qgd29yZCA9IGRhdGFbXCJ3b3JkXCJdO1xuICAgICAgICBpZiAoIWNvbmZpcm0oYFJlc2V0IGFsbCBkYXRhIGZvciAke3dvcmR9P2ApKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgVGJkRGF0YS5yZXNldERhdGFGb3JXb3JkKHdvcmQpO1xuICAgIH1cbiAgICBzYXZlTWlzc2VzRnJvbUxhdGVzdFJlc3VsdCgpIHtcbiAgICAgICAgT2JqZWN0LmtleXMoVGVzdElucHV0Lm1pc3NlZFdvcmRzKS5mb3JFYWNoKCh3b3JkKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtaXNzZWRDb3VudCA9IFRlc3RJbnB1dC5taXNzZWRXb3Jkc1t3b3JkXTtcbiAgICAgICAgICAgIFRiZERhdGEuYWRkVG9NaXNzZWRDb3VudCh3b3JkLCBtaXNzZWRDb3VudCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoYW5kbGVSZXNldEFsbFdvcmRzUmVxdWVzdCgpIHtcbiAgICAgICAgbGV0IGNvbmZpcm1hdGlvbldvcmQgPSBcImRlbGV0ZVwiO1xuICAgICAgICBsZXQgc2xvd2VzdFNwZWVkID0gMTAwMDtcbiAgICAgICAgY29uc3QgYWxsRGF0YSA9IFRiZERhdGEuZ2V0QWxsKCk7XG4gICAgICAgIE9iamVjdC5rZXlzKGFsbERhdGEud29yZHMpXG4gICAgICAgICAgICAuZmlsdGVyKCh3b3JkKSA9PiBUYmREYXRhLmdldE1lZGlhblNwZWVkRm9yV29yZCh3b3JkKSA+IDApXG4gICAgICAgICAgICAuZm9yRWFjaCgod29yZCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbWVkaWFuID0gVGJkRGF0YS5nZXRNZWRpYW5TcGVlZEZvcldvcmQod29yZCk7XG4gICAgICAgICAgICBpZiAobWVkaWFuID4gMCAmJlxuICAgICAgICAgICAgICAgIG1lZGlhbiA8IHNsb3dlc3RTcGVlZCAmJlxuICAgICAgICAgICAgICAgIHdvcmQubGVuZ3RoID49IGNvbmZpcm1hdGlvbldvcmQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY29uZmlybWF0aW9uV29yZCA9IHdvcmQ7XG4gICAgICAgICAgICAgICAgc2xvd2VzdFNwZWVkID0gbWVkaWFuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgY29uZmlybWF0aW9uU3RyaW5nID0gYCR7Y29uZmlybWF0aW9uV29yZH0gJHtjb25maXJtYXRpb25Xb3JkfSAke2NvbmZpcm1hdGlvbldvcmR9YDtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBwcm9tcHQoYFRoaXMgd2lsbCBkZWxldGUgQUxMIHlvdXIgd29yZCBkYXRhLiBUbyBjb25maXJtLCB0eXBlOiAke2NvbmZpcm1hdGlvblN0cmluZ31gKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzcG9uc2UgPT0gY29uZmlybWF0aW9uU3RyaW5nKSB7XG4gICAgICAgICAgICBhbGxEYXRhLndvcmRzID0ge307XG4gICAgICAgICAgICBUYmREYXRhLnVwZGF0ZURhdGEoYWxsRGF0YSwgdHJ1ZSk7XG4gICAgICAgICAgICBhbGVydChcIk9rISBZb3VyIGRhdGEgaGFzIGJlZW4gZGVsZXRlZCBhbmQgeW91J3JlIHN0YXJ0aW5nIG92ZXIgZnJvbSBzY3JhdGNoLlwiKTtcbiAgICAgICAgICAgIC8vIExhenksIEkga25vd1xuICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhbGVydChgR29vZCBlZmZvcnQsIGJ1dCB5b3UgdHlwZWQgXG4gICAgICAgIFxuICAgICAgICAnJHtyZXNwb25zZX0nIFxuICAgICAgICBcbiAgICAgICAgaW5zdGVhZCBvZiBcbiAgICAgICAgXG4gICAgICAgICcke2NvbmZpcm1hdGlvblN0cmluZ30nIFxuICAgICAgICBcbiAgICAgICAgTm8gcmVzZXQgZm9yIHlvdSFgKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmNsYXNzIFRiZFVJIHtcbiAgICBjb25zdHJ1Y3Rvcih0YmRNb2RlKSB7XG4gICAgICAgIHRoaXMuJGdyb3VwVGhyZXNob2xkID0gJChcIiN0YmRNb2RlR3JvdXBUaHJlc2hvbGRcIik7XG4gICAgICAgIHRoaXMuJHRiZE1vZGVHcm91cENvdW50ID0gJChcIiN0YmRNb2RlR3JvdXBDb3VudFwiKTtcbiAgICAgICAgdGhpcy4kd29yZEluZm8gPSAkKFwiI3RiZE1vZGVXb3JkSW5mb1wiKTtcbiAgICAgICAgdGhpcy4kd29yZHNEaXYgPSAkKFwiI3RiZG1vZGVJbmZvIC53b3Jkc0NvbnRhaW5lciAud29yZHNcIik7XG4gICAgICAgIHRoaXMuJHByb2dyZXNzTWV0ZXJUb3RhbCA9ICQoXCIjdGJkbW9kZUluZm8gLnByb2dyZXNzTWV0ZXJUb3RhbFwiKTtcbiAgICAgICAgdGhpcy4kdGFyZ2V0VGhyZXNob2xkID0gJChcIiN0YmRNb2RlVGFyZ2V0VGhyZXNob2xkXCIpO1xuICAgICAgICB0aGlzLiRwcm9ncmVzc01ldGVyR3JvdXAgPSAkKFwiI3RiZG1vZGVJbmZvIC5wcm9ncmVzc01ldGVyR3JvdXBcIik7XG4gICAgICAgIHRoaXMuJHRiZE1vZGVJbmZvID0gJChcIiN0YmRtb2RlSW5mb1wiKTtcbiAgICAgICAgdGhpcy4kdGJkTW9kZUhlbHBCdXR0b24gPSAkKFwiLnRiZE1vZGVIZWxwQnV0dG9uXCIpO1xuICAgICAgICB0aGlzLiR0YmRNb2RlSGVscCA9ICQoXCIjdGJkSGVscFwiKTtcbiAgICAgICAgdGhpcy4kdGJkQmVhdGVuRXhhbXBsZSA9ICQoXCIudGJkQmVhdGVuRXhhbXBsZVwiKTtcbiAgICAgICAgdGhpcy4kdGJkTG9zdEV4YW1wbGUgPSAkKFwiLnRiZExvc3RFeGFtcGxlXCIpO1xuICAgICAgICB0aGlzLiR0YmRNb2RlQWN0aW9uc1NlbGVjdCA9ICQoXCIjdGJkTW9kZUFjdGlvbnNTZWxlY3RcIik7XG4gICAgICAgIHRoaXMuJHRiZE1vZGVBY3Rpb25zQnV0dG9uID0gJChcIiN0YmRNb2RlQWN0aW9uQnV0dG9uXCIpO1xuICAgICAgICB0aGlzLiR0YmRNb2RlQ29uZmlnU2V0dGluZ3NTZWxlY3QgPSAkKFwiI3RiZE1vZGVDb25maWdTZXR0aW5nc1wiKTtcbiAgICAgICAgdGhpcy4kdGJkTW9kZUNvbmZpZ1NldHRpbmdzVXBkYXRlQnV0dG9uID0gJChcIiN0YmRNb2RlVXBkYXRlQ29uZmlnU2V0dGluZ3NVcGRhdGVCdXR0b25cIik7XG4gICAgICAgIHRoaXMuJHNvcnRlclNlbGVjdCA9ICQoXCIjdGJkTW9kZVNvcnRlclNlbGVjdFwiKTtcbiAgICAgICAgdGhpcy5jdXJyZW50bHlBbmltYXRpbmcgPSBbXTtcbiAgICAgICAgdGhpcy4kdGJkTW9kZUdyb3VwTnVtYmVyID0gJChcIiN0YmRNb2RlQ3VycmVudEdyb3VwTnVtYmVyXCIpO1xuICAgICAgICB0aGlzLnRiZE1vZGUgPSB0YmRNb2RlO1xuICAgICAgICBjb25zdCB3b3Jkc0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidGJkTW9kZVdvcmRzQ29udGFpbmVyXCIpO1xuICAgICAgICBpZiAoISh3b3Jkc0NvbnRhaW5lciBpbnN0YW5jZW9mIEhUTUxEaXZFbGVtZW50KSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ291bGQgbm90IGxvY2F0ZSBUQkQgd29yZHMgY29udGFpbmVyXCIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud29yZHNDb250YWluZXIgPSB3b3Jkc0NvbnRhaW5lcjtcbiAgICAgICAgdGhpcy4kd29yZEluZm8uaGlkZSgpO1xuICAgICAgICB0aGlzLiR0YmRNb2RlSW5mby5oaWRlKCk7XG4gICAgfVxuICAgIGluaXQoKSB7XG4gICAgICAgIHRoaXMuJHRiZE1vZGVJbmZvLnNob3coMzAwKTtcbiAgICAgICAgUGFnZUNoYW5nZUV2ZW50LnN1YnNjcmliZSh0aGlzLnBhZ2VDaGFuZ2VIYW5kbGVyLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLndvcmRzQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgdGhpcy51cGRhdGVXb3JkSW5mby5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy53b3Jkc0NvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5oYW5kbGVXb3JkQ2xpY2tlZC5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy53b3Jkc0NvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kd29yZEluZm8uaGlkZSgwKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwid29yZFR5cGVkQ29ycmVjdGx5XCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmFuaW1hdGUoZGF0YVtcIndvcmRFbGVtZW50XCJdLCBcInRiZEJlYXRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwid29yZE1pc3NlZFwiLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5hbmltYXRlKGRhdGFbXCJ3b3JkRWxlbWVudFwiXSwgXCJ0YmRMb3N0XCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJncm91cFRocmVzaG9sZENoYW5nZWRcIiwgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIHRoaXMuJGdyb3VwVGhyZXNob2xkLnRleHQoZGF0YVtcInRocmVzaG9sZFwiXSk7XG4gICAgICAgIH0pO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcInJlc3VsdHNQcm9jZXNzZWRcIiwgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGdyb3VwID0gZGF0YVtcImN1cnJlbnRHcm91cFwiXTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlVWlXb3Jkcyhncm91cC5nZXRXb3Jkc2V0KCkud29yZHMpO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJyZXN1bHRzUHJvY2Vzc2VkXCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVRvdGFsUHJvZ3Jlc3NNZXRlcihkYXRhW1wibW9ua2V5VHlwZVdvcmRzZXRcIl0sIGRhdGFbXCJ0YXJnZXRTcGVlZFwiXSk7XG4gICAgICAgIH0pO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcInJlc3VsdHNQcm9jZXNzZWRcIiwgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlR3JvdXBQcm9ncmVzc01ldGVyKGRhdGFbXCJjdXJyZW50R3JvdXBcIl0sIGRhdGFbXCJ0YXJnZXRTcGVlZFwiXSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLiRzb3J0ZXJTZWxlY3Qub24oXCJjaGFuZ2VcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBpZiAoIShldmVudC50YXJnZXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBUYmRFdmVudHMuZGlzcGF0Y2hFdmVudChcInNvcnRlclNlbGVjdENoYW5nZWRcIiwge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBldmVudC50YXJnZXQudmFsdWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwic29ydGVyLWNoYW5nZWRcIiwgdGhpcy5oYW5kbGVTb3J0ZXJDaGFuZ2UuYmluZCh0aGlzKSk7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwibmV4dEdyb3VwXCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBncm91cCA9IGRhdGFbXCJncm91cFwiXTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlVWlXb3Jkcyhncm91cC5nZXRXb3Jkc2V0KCkud29yZHMpO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJuZXh0R3JvdXBcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVHcm91cFByb2dyZXNzTWV0ZXIodGhpcy50YmRNb2RlLmdldEN1cnJlbnRHcm91cCgpLCB0aGlzLnRiZE1vZGUuZ2V0Q29uZmlnKCkuZ2V0VGFyZ2V0U3BlZWQoKSk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVRvdGFsUHJvZ3Jlc3NNZXRlcih0aGlzLnRiZE1vZGUuZ2V0TW9ua2V5VHlwZVdvcmRzZXQoKSwgdGhpcy50YmRNb2RlLmdldENvbmZpZygpLmdldFRhcmdldFNwZWVkKCkpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gQ2FuJ3QgdXNlIHRhcmdldFNwZWVkLWNoYW5nZWQgYmVjYXVzZSBvZiBzdHVwaWQgcmVjdXJzaXZlIHdheSBvZlxuICAgICAgICAvLyBhdXRvIGJ1bXBpbmcgdGhyZXNob2xkIHRvIGVuc3VyZSB0aGVyZSBhcmUgYWx3YXlzIGdyb3Vwc1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcIm5leHRHcm91cFwiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLiR0YXJnZXRUaHJlc2hvbGQudGV4dCh0aGlzLnRiZE1vZGUuZ2V0Q29uZmlnKCkuZ2V0VGFyZ2V0U3BlZWQoKS50b1N0cmluZygpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuJHRiZE1vZGVIZWxwQnV0dG9uLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy4kdGJkTW9kZUhlbHAudG9nZ2xlKDI1MCk7XG4gICAgICAgICAgICB0aGlzLiR3b3Jkc0Rpdi50b2dnbGUoMjUwKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuJHRiZEJlYXRlbkV4YW1wbGUub24oXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0ZShldmVudC50YXJnZXQsIFwidGJkQmVhdGVuXCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy4kdGJkTG9zdEV4YW1wbGUub24oXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0ZShldmVudC50YXJnZXQsIFwidGJkTG9zdFwiKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuJHRhcmdldFRocmVzaG9sZC50ZXh0KHRoaXMudGJkTW9kZS5nZXRDb25maWcoKS5nZXRUYXJnZXRTcGVlZCgpKTtcbiAgICAgICAgdGhpcy4kZ3JvdXBUaHJlc2hvbGQudGV4dCh0aGlzLnRiZE1vZGUuZ2V0Q3VycmVudEdyb3VwKCkuZ2V0VGhyZXNob2xkKCkpO1xuICAgICAgICB0aGlzLiR0YmRNb2RlQ29uZmlnU2V0dGluZ3NVcGRhdGVCdXR0b24ub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3RWYWx1ZSA9IHRoaXMuJHRiZE1vZGVDb25maWdTZXR0aW5nc1NlbGVjdC52YWwoKTtcbiAgICAgICAgICAgIGlmIChzZWxlY3RWYWx1ZSA9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoXCJTZWxlY3QgYW4gb3B0aW9uIGZyb20gdGhlIGRyb3Bkb3duIGZpcnN0XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJjb25maWdVcGRhdGVSZXF1ZXN0ZWRcIiwge1xuICAgICAgICAgICAgICAgICAgICBjb25maWdTZXR0aW5nOiBzZWxlY3RWYWx1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuJHRiZE1vZGVBY3Rpb25zQnV0dG9uLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0VmFsdWUgPSB0aGlzLiR0YmRNb2RlQWN0aW9uc1NlbGVjdC52YWwoKTtcbiAgICAgICAgICAgIGlmIChzZWxlY3RWYWx1ZSA9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoXCJTZWxlY3QgYW4gb3B0aW9uIGZyb20gdGhlIGRyb3Bkb3duIGZpcnN0XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJhY3Rpb25CdXR0b25DbGlja2VkXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uVmFsdWU6IHNlbGVjdFZhbHVlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJ3b3JkU2F2ZWRcIiwgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHdvcmQgPSBkYXRhW1wid29yZFwiXSB8fCBcIlwiO1xuICAgICAgICAgICAgaWYgKHdvcmQgPT0gXCJcIikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLmdldFdvcmRFbGVtZW50KHdvcmQpO1xuICAgICAgICAgICAgaWYgKCFlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy51cGRhdGVXb3JkKHdvcmQpO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJncm91cHNSZWdlbmVyYXRlZFwiLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgdGhpcy4kdGJkTW9kZUdyb3VwQ291bnQudGV4dChkYXRhW1wiZ3JvdXBzXCJdLmxlbmd0aCk7XG4gICAgICAgIH0pO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcIm5leHRHcm91cFwiLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgdGhpcy4kdGJkTW9kZUdyb3VwTnVtYmVyLnRleHQoZGF0YVtcImdyb3VwTnVtYmVyXCJdKTtcbiAgICAgICAgICAgIHRoaXMuJGdyb3VwVGhyZXNob2xkLnRleHQoZGF0YVtcImdyb3VwXCJdLmdldFRocmVzaG9sZCgpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuJHNvcnRlclNlbGVjdFxuICAgICAgICAgICAgLmZpbmQoYG9wdGlvblt2YWx1ZT1cIiR7dGhpcy50YmRNb2RlLmdldENvbmZpZygpLmdldFNvcnRlck5hbWUoKX1cIl1gKVxuICAgICAgICAgICAgLmF0dHIoXCJzZWxlY3RlZFwiLCBcIlwiKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGVsZW1lbnRcbiAgICAgKiBAcGFyYW0gYW5pbWF0aW9uIC0gYm90aCB0aGUga2V5ZnJhbWUgYW5pbWF0aW9uIGFuZCBjbGFzcyB3aXRoIHRoYXQgYW5pbWF0aW9uLiBGb3Igc2ltcGxpY2l0eVxuICAgICAqIHRoZXkgbXVzdCBiZSB0aGUgc2FtZS5cbiAgICAgKi9cbiAgICBhbmltYXRlKGVsZW1lbnQsIGFuaW1hdGlvbikge1xuICAgICAgICBpZiAoIXRoaXMudGJkTW9kZS5nZXRDb25maWcoKS5hcmVBbmltYXRpb25zRW5hYmxlZCgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY3VycmVudGx5QW5pbWF0aW5nLmluY2x1ZGVzKGVsZW1lbnQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2FsbGJhY2sgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGlmIChldmVudC5hbmltYXRpb25OYW1lICE9PSBhbmltYXRpb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuY3VycmVudGx5QW5pbWF0aW5nLmZpbmRJbmRleCgoYW5pbWF0aW5nRWxlbWVudCkgPT4gYW5pbWF0aW5nRWxlbWVudCA9PSBlbGVtZW50KTtcbiAgICAgICAgICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuY3VycmVudGx5QW5pbWF0aW5nW2luZGV4XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShhbmltYXRpb24pO1xuICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwiYW5pbWF0aW9uZW5kXCIsIGNhbGxiYWNrKTtcbiAgICAgICAgfTtcbiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiYW5pbWF0aW9uZW5kXCIsIGNhbGxiYWNrKTtcbiAgICAgICAgdGhpcy5jdXJyZW50bHlBbmltYXRpbmcucHVzaChlbGVtZW50KTtcbiAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKGFuaW1hdGlvbik7XG4gICAgfVxuICAgIGhhbmRsZVdvcmRDbGlja2VkKGV2ZW50KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICBpZiAoISh0YXJnZXQgaW5zdGFuY2VvZiBIVE1MRGl2RWxlbWVudCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJ0YmRXb3JkXCIpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgd29yZCA9ICgoX2EgPSB0YXJnZXQucGFyZW50RWxlbWVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmRhdGFzZXRbXCJ3b3JkXCJdKSB8fCBcIlwiO1xuICAgICAgICBpZiAod29yZCA9PSBcIlwiKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJ3b3JkQ2xpY2tlZFwiLCB7IHdvcmQ6IHdvcmQgfSk7XG4gICAgfVxuICAgIGhhbmRsZVNvcnRlckNoYW5nZShkYXRhKSB7XG4gICAgICAgIGNvbnN0IHNvcnRlciA9IFRiZFNvcnRpbmcuZ2V0U29ydGVyKGRhdGFbXCJuZXdWYWx1ZVwiXSB8fCBcIlwiKTtcbiAgICAgICAgdGhpcy5zb3J0V29yZHMoc29ydGVyKTtcbiAgICB9XG4gICAgc2VsZWN0U29ydGVyT3B0aW9uKHNvcnRlck5hbWUpIHtcbiAgICAgICAgWy4uLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIjdGJkTW9kZVNvcnRlclNlbGVjdCBvcHRpb25cIildLmZvckVhY2goKG9wdGlvbikgPT4ge1xuICAgICAgICAgICAgaWYgKCEob3B0aW9uIGluc3RhbmNlb2YgSFRNTE9wdGlvbkVsZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9wdGlvbltcInZhbHVlXCJdID09IHNvcnRlck5hbWUpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25bXCJzZWxlY3RlZFwiXSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICB1cGRhdGVUb3RhbFByb2dyZXNzTWV0ZXIobW9ua2V5VHlwZVdvcmRzZXQsIHRhcmdldFNwZWVkKSB7XG4gICAgICAgIGNvbnN0IGFsbFdvcmRzID0gbW9ua2V5VHlwZVdvcmRzZXQud29yZHM7XG4gICAgICAgIGNvbnN0IGNvdW50ID0gYWxsV29yZHMubGVuZ3RoO1xuICAgICAgICBjb25zdCBiZWF0ZW5BdFRhcmdldENvdW50ID0gYWxsV29yZHMuZmlsdGVyKCh3b3JkKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gVGJkRGF0YS5oYXNXb3JkQmVlblR5cGVkRmFzdGVyVGhhbih3b3JkLCB0YXJnZXRTcGVlZCk7XG4gICAgICAgIH0pLmxlbmd0aDtcbiAgICAgICAgY29uc3QgcGVyY2VudCA9IChiZWF0ZW5BdFRhcmdldENvdW50IC8gY291bnQpICogMTAwIHx8IDA7XG4gICAgICAgIHRoaXMuJHByb2dyZXNzTWV0ZXJUb3RhbC5jc3MoXCJ3aWR0aFwiLCBgJHtwZXJjZW50fSVgKTtcbiAgICAgICAgdGhpcy4kcHJvZ3Jlc3NNZXRlclRvdGFsLmF0dHIoXCJ0aXRsZVwiLCBgJHtiZWF0ZW5BdFRhcmdldENvdW50fSB3b3JkcyBvZiAke2NvdW50fSB0b3RhbCBoYXZlIGJlZW4gdHlwZWQgZmFzdGVyIHRoYW4gdGhlIHRhcmdldCBvZiAke3RhcmdldFNwZWVkfWApO1xuICAgIH1cbiAgICB1cGRhdGVHcm91cFByb2dyZXNzTWV0ZXIoY3VycmVudEdyb3VwLCB0YXJnZXRTcGVlZCkge1xuICAgICAgICBjb25zdCBncm91cFdvcmRzZXQgPSBjdXJyZW50R3JvdXAuZ2V0V29yZHNldCgpO1xuICAgICAgICBjb25zdCBiZWF0ZW5BdFRhcmdldENvdW50ID0gZ3JvdXBXb3Jkc2V0LndvcmRzLmZpbHRlcigod29yZCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIFRiZERhdGEuaGFzV29yZEJlZW5UeXBlZEZhc3RlclRoYW4od29yZCwgdGFyZ2V0U3BlZWQpO1xuICAgICAgICB9KS5sZW5ndGg7XG4gICAgICAgIGNvbnN0IHBlcmNlbnQgPSAoYmVhdGVuQXRUYXJnZXRDb3VudCAvIGdyb3VwV29yZHNldC5sZW5ndGgpICogMTAwIHx8IDA7XG4gICAgICAgIHRoaXMuJHByb2dyZXNzTWV0ZXJHcm91cC5jc3MoXCJ3aWR0aFwiLCBgJHtwZXJjZW50fSVgKTtcbiAgICAgICAgdGhpcy4kcHJvZ3Jlc3NNZXRlckdyb3VwLmF0dHIoXCJ0aXRsZVwiLCBgJHtiZWF0ZW5BdFRhcmdldENvdW50fSB3b3JkcyBvZiAke2dyb3VwV29yZHNldC5sZW5ndGh9IGluIHRoZSBjdXJyZW50IGdyb3VwIGhhdmUgYmVlbiB0eXBlZCBmYXN0ZXIgdGhhbiB0aGUgdGFyZ2V0IG9mICR7dGFyZ2V0U3BlZWR9YCk7XG4gICAgfVxuICAgIHBhZ2VDaGFuZ2VIYW5kbGVyKF9wcmV2aW91c1BhZ2UsIG5leHRQYWdlKSB7XG4gICAgICAgIGNvbnN0IHBhZ2VzVG9TaG93SW5mbyA9IFtcInRlc3RcIl07XG4gICAgICAgIGlmIChwYWdlc1RvU2hvd0luZm8uaW5jbHVkZXMobmV4dFBhZ2UubmFtZSkpIHtcbiAgICAgICAgICAgIHRoaXMuJHRiZE1vZGVJbmZvLnNob3coKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuJHRiZE1vZGVJbmZvLmhpZGUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB1cGRhdGVVaVdvcmRzKHdvcmRzVG9TaG93KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgLy8gUmVtb3ZlIHdvcmRzIHdlIGRvbid0IHdhbnQgdG8gc2hvd1xuICAgICAgICB0aGlzLiR3b3Jkc0Rpdi5oaWRlKCk7XG4gICAgICAgIChfYSA9IFsuLi5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLndvcmRzIC50YmRXb3JkQ29udGFpbmVyXCIpXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHdvcmRFbGVtZW50KSA9PiB7XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBjb25zdCB3b3JkID0gd29yZEVsZW1lbnQuZGF0YXNldFtcIndvcmRcIl07XG4gICAgICAgICAgICBpZiAoIXdvcmRzVG9TaG93LmluY2x1ZGVzKHdvcmQpKSB7XG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgIHdvcmRFbGVtZW50LnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQod29yZEVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgd29yZHNUb1Nob3cuZm9yRWFjaCgod29yZCkgPT4ge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVXb3JkKHdvcmQpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zb3J0V29yZHModGhpcy50YmRNb2RlLmdldENvbmZpZygpLmdldFNvcnRlcigpKTtcbiAgICAgICAgdGhpcy4kd29yZHNEaXYuc2hvdygpO1xuICAgIH1cbiAgICB1cGRhdGVXb3JkKHdvcmQpIHtcbiAgICAgICAgY29uc3Qgd29yZEVsZW1lbnQgPSB0aGlzLmdldE9yQ3JlYXRlV29yZEVsZW1lbnQod29yZCk7XG4gICAgICAgIGNvbnN0IHRhcmdldFNwZWVkID0gdGhpcy50YmRNb2RlLmdldENvbmZpZygpLmdldFRhcmdldFNwZWVkKCk7XG4gICAgICAgIGNvbnN0IGdyb3VwU3BlZWQgPSB0aGlzLnRiZE1vZGUuZ2V0Q3VycmVudEdyb3VwKCkuZ2V0VGhyZXNob2xkKCk7XG4gICAgICAgIC8vIFRpbWVvdXQgZW5zdXJlcyB0cmFuc2l0aW9ucyB3b3JrXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgd29yZEVsZW1lbnQuZGF0YXNldFtcImJlYXRlbkF0VGFyZ2V0XCJdID1cbiAgICAgICAgICAgICAgICBUYmREYXRhLmhhc1dvcmRCZWVuVHlwZWRGYXN0ZXJUaGFuKHdvcmQsIHRhcmdldFNwZWVkKSA/IFwiMVwiIDogXCIwXCI7XG4gICAgICAgICAgICB3b3JkRWxlbWVudC5kYXRhc2V0W1wiYmVhdGVuQXRHcm91cFwiXSA9IFRiZERhdGEuaGFzV29yZEJlZW5UeXBlZEZhc3RlclRoYW4od29yZCwgZ3JvdXBTcGVlZClcbiAgICAgICAgICAgICAgICA/IFwiMVwiXG4gICAgICAgICAgICAgICAgOiBcIjBcIjtcbiAgICAgICAgICAgIHdvcmRFbGVtZW50LmRhdGFzZXRbXCJ0eXBlZFwiXSA9XG4gICAgICAgICAgICAgICAgVGJkRGF0YS5nZXRTcGVlZHNGb3JXb3JkKHdvcmQpLmxlbmd0aCA9PSAwID8gXCIwXCIgOiBcIjFcIjtcbiAgICAgICAgICAgIHdvcmRFbGVtZW50LmRhdGFzZXRbXCJtaXNzZWRNb3JlXCJdID1cbiAgICAgICAgICAgICAgICBUYmREYXRhLmdldE1pc3R5cGVkQ291bnRGb3JXb3JkKHdvcmQpID5cbiAgICAgICAgICAgICAgICAgICAgVGJkRGF0YS5nZXRTcGVlZHNGb3JXb3JkKHdvcmQpLmxlbmd0aFxuICAgICAgICAgICAgICAgICAgICA/IFwiMVwiXG4gICAgICAgICAgICAgICAgICAgIDogXCIwXCI7XG4gICAgICAgICAgICBjb25zdCBwZXJjZW50Q29tcGxldGUgPSBUYmREYXRhLmdldE1lZGlhblNwZWVkRm9yV29yZCh3b3JkKSAvIHRhcmdldFNwZWVkO1xuICAgICAgICAgICAgY29uc3QgbW9kaWZpZXIgPSBNYXRoLm1pbihwZXJjZW50Q29tcGxldGUsIDEpO1xuICAgICAgICAgICAgY29uc3QgYmFzZVNjYWxlID0gMC43NTtcbiAgICAgICAgICAgIGNvbnN0IGFkZGl0aW9uYWwgPSAoMSAtIGJhc2VTY2FsZSkgKiBtb2RpZmllcjtcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIChfYSA9IHdvcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJkaXZcIikuc3R5bGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50cmFuc2Zvcm0gPSBgc2NhbGUoJHtiYXNlU2NhbGUgKyBhZGRpdGlvbmFsfSlgO1xuICAgICAgICB9LCAwKTtcbiAgICB9XG4gICAgc29ydFdvcmRzKHNvcnRlcikge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHdvcmRzID0gKF9hID0gWy4uLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudGJkV29yZENvbnRhaW5lclwiKV0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tYXAoKHdvcmRDb250YWluZXJFbGVtZW50KSA9PiB7XG4gICAgICAgICAgICBpZiAoISh3b3JkQ29udGFpbmVyRWxlbWVudCBpbnN0YW5jZW9mIEhUTUxEaXZFbGVtZW50KSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlJVSCBST0hcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gd29yZENvbnRhaW5lckVsZW1lbnQuZGF0YXNldFtcIndvcmRcIl0gfHwgXCJcIjtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHNvcnRlZCA9IHdvcmRzLnNvcnQoc29ydGVyKTtcbiAgICAgICAgc29ydGVkLmZvckVhY2goKHdvcmQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLmdldE9yQ3JlYXRlV29yZEVsZW1lbnQod29yZCk7XG4gICAgICAgICAgICB0aGlzLiR3b3Jkc0Rpdi5hcHBlbmQoZWxlbWVudCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXRXb3JkRWxlbWVudCh3b3JkKSB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gYC50YmRXb3JkQ29udGFpbmVyW2RhdGEtd29yZD1cIiR7d29yZH1cIl1gO1xuICAgICAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihxdWVyeSk7XG4gICAgfVxuICAgIGdldE9yQ3JlYXRlV29yZEVsZW1lbnQod29yZCkge1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5nZXRXb3JkRWxlbWVudCh3b3JkKTtcbiAgICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5ld0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIG5ld0Rpdi5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz1cInRiZFdvcmRcIj4ke3dvcmR9PC9kaXY+YDtcbiAgICAgICAgbmV3RGl2LmRhdGFzZXRbXCJ3b3JkXCJdID0gd29yZDtcbiAgICAgICAgbmV3RGl2LmNsYXNzTGlzdC5hZGQoXCJ0YmRXb3JkQ29udGFpbmVyXCIpO1xuICAgICAgICB0aGlzLiR3b3Jkc0Rpdi5hcHBlbmQobmV3RGl2KTtcbiAgICAgICAgcmV0dXJuIG5ld0RpdjtcbiAgICB9XG4gICAgdXBkYXRlV29yZEluZm8oZXZlbnQpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICAgIGlmICghKHRhcmdldCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInRiZFdvcmRcIikpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB3b3JkID0gKF9hID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5kYXRhc2V0W1wid29yZFwiXTtcbiAgICAgICAgaWYgKHdvcmQgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgd29yZERhdGEgPSBUYmREYXRhLmdldERhdGFGb3JXb3JkKHdvcmQpO1xuICAgICAgICBsZXQgd29yZEluZm9IdG1sID0gYFxuICAgICAgICA8aDM+XCIke3dvcmR9XCI8L2gzPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiaGVhZGluZ1wiPkNvdW50czwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwic3RhdENvbnRhaW5lclwiPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwibGFiZWxcIj5Db3JyZWN0OiA8L3NwYW4+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJzdGF0IGdvb2RcIj4ke3dvcmREYXRhLnNwZWVkcy5sZW5ndGh9PC9zcGFuLj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzdGF0Q29udGFpbmVyXCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJsYWJlbFwiPk1pc3NlZDogPC9zcGFuPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwic3RhdCBiYWRcIj4ke1RiZERhdGEuZ2V0TWlzdHlwZWRDb3VudEZvcldvcmQod29yZCl9PC9zcGFuPlxuICAgICAgICA8L2Rpdj5gO1xuICAgICAgICBpZiAod29yZERhdGEuc3BlZWRzLmxlbmd0aCkge1xuICAgICAgICAgICAgd29yZEluZm9IdG1sICs9IGBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJoZWFkaW5nXCI+U3BlZWRzPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzdGF0Q29udGFpbmVyXCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJsYWJlbFwiPldvcnN0OiA8L3NwYW4+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJzdGF0IGJhZFwiPiR7VGJkRGF0YS5nZXRTbG93ZXN0U3BlZWRGb3JXb3JkKHdvcmQpfTwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzdGF0Q29udGFpbmVyXCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJsYWJlbFwiPk1lYW46IDwvc3Bhbj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cInN0YXRcIj4ke1RiZERhdGEuZ2V0TWVhblNwZWVkRm9yV29yZCh3b3JkKX08L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwic3RhdENvbnRhaW5lclwiPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwibGFiZWxcIj5NZWRpYW46IDwvc3Bhbj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cInN0YXRcIj4ke1RiZERhdGEuZ2V0TWVkaWFuU3BlZWRGb3JXb3JkKHdvcmQpfTwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzdGF0Q29udGFpbmVyXCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJsYWJlbFwiPkJlc3Q6IDwvc3Bhbj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cInN0YXQgZ29vZFwiPiR7VGJkRGF0YS5nZXRGYXN0ZXN0U3BlZWRGb3JXb3JkKHdvcmQpfTwvc3Bhbj5cbiAgICAgICAgPC9kaXY+YDtcbiAgICAgICAgfVxuICAgICAgICB3b3JkSW5mb0h0bWwgKz0gYDxkaXYgY2xhc3M9XCJoZWxwVGV4dFwiPmNsaWNrIHRvIHJlc2V0IHdvcmQgZGF0YTwvZGl2PmA7XG4gICAgICAgIHRoaXMuJHdvcmRJbmZvLmh0bWwod29yZEluZm9IdG1sKTtcbiAgICAgICAgdGhpcy5nZXRPckNyZWF0ZVdvcmRFbGVtZW50KHdvcmQpLmFwcGVuZCh0aGlzLiR3b3JkSW5mb1swXSk7XG4gICAgICAgIHRoaXMuJHdvcmRJbmZvLnNob3coMjAwKTtcbiAgICB9XG59XG5jbGFzcyBUYmRFdmVudHMge1xuICAgIHN0YXRpYyBkaXNwYXRjaEV2ZW50KG5hbWUsIGRhdGEgPSB7fSkge1xuICAgICAgICBjb25zdCBzdWJzY3JpYmVycyA9IHRoaXMuc3Vic2NyaWJlcnNbbmFtZV0gfHwgW107XG4gICAgICAgIHN1YnNjcmliZXJzLmZvckVhY2goKHN1YnNjcmliZXIpID0+IHtcbiAgICAgICAgICAgIHN1YnNjcmliZXIoZGF0YSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzdGF0aWMgYWRkU3Vic2NyaWJlcihuYW1lLCBjYWxsYmFjaykge1xuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoVGJkRXZlbnRzLnN1YnNjcmliZXJzW25hbWVdKSkge1xuICAgICAgICAgICAgVGJkRXZlbnRzLnN1YnNjcmliZXJzW25hbWVdID0gW107XG4gICAgICAgIH1cbiAgICAgICAgVGJkRXZlbnRzLnN1YnNjcmliZXJzW25hbWVdLnB1c2goY2FsbGJhY2spO1xuICAgIH1cbn1cblRiZEV2ZW50cy5zdWJzY3JpYmVycyA9IHt9O1xuVGJkRXZlbnRzLmRlYm91bmNlZERpc3BhdGNoID0gKDAsIGRlYm91bmNlXzEuZGVib3VuY2UpKFRiZEV2ZW50cy5kaXNwYXRjaEV2ZW50LCA1MCk7XG5jbGFzcyBUYmREYXRhIHtcbiAgICBzdGF0aWMgZ2V0QWxsKCkge1xuICAgICAgICBpZiAoVGJkRGF0YS5kYXRhKSB7XG4gICAgICAgICAgICByZXR1cm4gVGJkRGF0YS5kYXRhO1xuICAgICAgICB9XG4gICAgICAgIFRiZERhdGEuZGF0YSA9IFRiZERhdGEuZ2V0RnJvbUxvY2FsU3RvcmFnZSgpO1xuICAgICAgICByZXR1cm4gVGJkRGF0YS5kYXRhO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0RnJvbUxvY2FsU3RvcmFnZSgpIHtcbiAgICAgICAgY29uc3QgZGVmYXVsdFZhbHVlID0geyB3b3Jkczoge30sIGNvbmZpZzoge30gfTtcbiAgICAgICAgY29uc3Qgc3RvcmVkRGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFRiZERhdGEubG9jYWxTdG9yYWdlS2V5KTtcbiAgICAgICAgaWYgKHN0b3JlZERhdGEgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBUcnkgcGFyc2luZyBsb2NhbCBzdG9yYWdlXG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2Uoc3RvcmVkRGF0YSk7XG4gICAgICAgIGlmICh0eXBlb2YgcGFyc2VkID09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJzZWQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgICB9XG4gICAgc3RhdGljIHVwZGF0ZURhdGEoZGF0YSwgaW1tZWRpYXRlbHkgPSBmYWxzZSkge1xuICAgICAgICBUYmREYXRhLmRhdGEgPSBkYXRhO1xuICAgICAgICBpZiAoaW1tZWRpYXRlbHkpIHtcbiAgICAgICAgICAgIFRiZERhdGEudXBkYXRlTG9jYWxTdG9yYWdlKGRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgVGJkRGF0YS5kZWJvdW5jZWRVcGRhdGVMb2NhbFN0b3JhZ2UoZGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3RhdGljIGdldERhdGFGb3JXb3JkKHdvcmQpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IFRiZERhdGEuZ2V0QWxsKCk7XG4gICAgICAgIGlmICghZGF0YS53b3Jkc1t3b3JkXSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3BlZWRzOiBbXSwgbWlzc2VkQ291bnQ6IDAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YS53b3Jkc1t3b3JkXTtcbiAgICB9XG4gICAgc3RhdGljIHJlc2V0RGF0YUZvcldvcmQod29yZCkge1xuICAgICAgICBUYmREYXRhLnNhdmVXb3JkRGF0YSh3b3JkLCB7IHNwZWVkczogW10sIG1pc3NlZENvdW50OiAwIH0pO1xuICAgICAgICBUYmRFdmVudHMuZGlzcGF0Y2hFdmVudChcIndvcmRSZXNldFwiLCB7IHdvcmQ6IHdvcmQgfSk7XG4gICAgfVxuICAgIHN0YXRpYyByZXNldERhdGFGb3JXb3Jkcyh3b3Jkcykge1xuICAgICAgICB3b3Jkcy5mb3JFYWNoKCh3b3JkKSA9PiBUYmREYXRhLnJlc2V0RGF0YUZvcldvcmQod29yZCkpO1xuICAgICAgICBUYmRFdmVudHMuZGlzcGF0Y2hFdmVudChcIndvcmRzUmVzZXRcIiwgeyB3b3Jkczogd29yZHMgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBoYXNXb3JkQmVlblR5cGVkRmFzdGVyVGhhbih3b3JkLCB0aHJlc2hvbGQpIHtcbiAgICAgICAgcmV0dXJuIFRiZERhdGEuZ2V0TWVkaWFuU3BlZWRGb3JXb3JkKHdvcmQpID4gdGhyZXNob2xkO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0U3BlZWRzRm9yV29yZCh3b3JkKSB7XG4gICAgICAgIHJldHVybiBUYmREYXRhLmdldERhdGFGb3JXb3JkKHdvcmQpLnNwZWVkcyB8fCBbXTtcbiAgICB9XG4gICAgc3RhdGljIGdldFNsb3dlc3RTcGVlZEZvcldvcmQod29yZCkge1xuICAgICAgICBjb25zdCBzcGVlZHMgPSBUYmREYXRhLmdldFNwZWVkc0ZvcldvcmQod29yZCk7XG4gICAgICAgIGlmIChzcGVlZHMubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBNYXRoLm1pbiguLi5zcGVlZHMpO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0RmFzdGVzdFNwZWVkRm9yV29yZCh3b3JkKSB7XG4gICAgICAgIGNvbnN0IHNwZWVkcyA9IFRiZERhdGEuZ2V0U3BlZWRzRm9yV29yZCh3b3JkKTtcbiAgICAgICAgaWYgKHNwZWVkcy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KC4uLnNwZWVkcyk7XG4gICAgfVxuICAgIHN0YXRpYyBnZXRNaXN0eXBlZENvdW50Rm9yV29yZCh3b3JkKSB7XG4gICAgICAgIHJldHVybiBUYmREYXRhLmdldERhdGFGb3JXb3JkKHdvcmQpLm1pc3NlZENvdW50O1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0TWVkaWFuU3BlZWRGb3JXb3JkKHdvcmQpIHtcbiAgICAgICAgY29uc3Qgd29yZFNwZWVkcyA9IFRiZERhdGEuZ2V0U3BlZWRzRm9yV29yZCh3b3JkKTtcbiAgICAgICAgaWYgKHdvcmRTcGVlZHMubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICgwLCBtaXNjXzEubWVkaWFuKSh3b3JkU3BlZWRzKTtcbiAgICB9XG4gICAgc3RhdGljIGdldE1lYW5TcGVlZEZvcldvcmQod29yZCkge1xuICAgICAgICBjb25zdCBzcGVlZHMgPSBUYmREYXRhLmdldFNwZWVkc0ZvcldvcmQod29yZCk7XG4gICAgICAgIGlmIChzcGVlZHMubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBNYXRoLnJvdW5kKCgwLCBtaXNjXzEubWVhbikoc3BlZWRzKSk7XG4gICAgfVxuICAgIHN0YXRpYyBzYXZlV29yZERhdGEod29yZCwgd29yZERhdGEpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IFRiZERhdGEuZ2V0QWxsKCk7XG4gICAgICAgIGRhdGEud29yZHNbd29yZF0gPSB3b3JkRGF0YTtcbiAgICAgICAgVGJkRGF0YS51cGRhdGVEYXRhKGRhdGEpO1xuICAgICAgICBUYmRFdmVudHMuZGlzcGF0Y2hFdmVudChcIndvcmRTYXZlZFwiLCB7IHdvcmQ6IHdvcmQsIGRhdGE6IHdvcmREYXRhIH0pO1xuICAgIH1cbiAgICBzdGF0aWMgYWRkQnVyc3Qod29yZCwgc3BlZWQpIHtcbiAgICAgICAgaWYgKHdvcmQgPT0gXCJcIikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHdvcmREYXRhID0gVGJkRGF0YS5nZXREYXRhRm9yV29yZCh3b3JkKTtcbiAgICAgICAgd29yZERhdGEuc3BlZWRzLnB1c2goc3BlZWQpO1xuICAgICAgICBUYmREYXRhLnNhdmVXb3JkRGF0YSh3b3JkLCB3b3JkRGF0YSk7XG4gICAgfVxuICAgIHN0YXRpYyBhZGRUb01pc3NlZENvdW50KHdvcmQsIG1pc3NlZENvdW50KSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBUYmREYXRhLmdldERhdGFGb3JXb3JkKHdvcmQpO1xuICAgICAgICBkYXRhLm1pc3NlZENvdW50ICs9IG1pc3NlZENvdW50O1xuICAgICAgICBUYmREYXRhLnNhdmVXb3JkRGF0YSh3b3JkLCBkYXRhKTtcbiAgICB9XG4gICAgc3RhdGljIHVwZGF0ZUxvY2FsU3RvcmFnZShkYXRhKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFRiZERhdGEubG9jYWxTdG9yYWdlS2V5LCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgfVxufVxuVGJkRGF0YS5sb2NhbFN0b3JhZ2VLZXkgPSBcInRiZE1vZGVEYXRhXCI7XG5UYmREYXRhLmRlYm91bmNlZFVwZGF0ZUxvY2FsU3RvcmFnZSA9ICgwLCBkZWJvdW5jZV8xLmRlYm91bmNlKShUYmREYXRhLnVwZGF0ZUxvY2FsU3RvcmFnZSwgMTAwMCk7XG5jbGFzcyBUYmRHcm91cHMge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmdyb3VwcyA9IFtdO1xuICAgIH1cbiAgICBzZXRHcm91cHMoZ3JvdXBzKSB7XG4gICAgICAgIHRoaXMuZ3JvdXBzID0gZ3JvdXBzO1xuICAgIH1cbiAgICBnZXRHcm91cHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyb3VwcztcbiAgICB9XG4gICAgZ2V0Rmlyc3RJbmNvbXBsZXRlR3JvdXAodGFyZ2V0U3BlZWQpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmdyb3Vwcy5maW5kKChncm91cCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGdyb3VwXG4gICAgICAgICAgICAgICAgLmdldFdvcmRzZXQoKVxuICAgICAgICAgICAgICAgIC53b3Jkcy5zb21lKCh3b3JkKSA9PiAhVGJkRGF0YS5oYXNXb3JkQmVlblR5cGVkRmFzdGVyVGhhbih3b3JkLCB0YXJnZXRTcGVlZCkpO1xuICAgICAgICB9KSB8fCBudWxsKTtcbiAgICB9XG4gICAgcmVnZW5lcmF0ZUdyb3Vwcyh3b3JkcywgZGVzaXJlZEdyb3VwU2l6ZSkge1xuICAgICAgICB0aGlzLmdyb3VwcyA9IFtdO1xuICAgICAgICBpZiAod29yZHMubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByYW5kb21seVNvcnRlZCA9IHdvcmRzLnNvcnQoVGJkU29ydGluZy5yYW5kb21Tb3J0ZXIpO1xuICAgICAgICAvLyBUaGlzIGlzIGFuIGVmZm9ydCB0byBlbnN1cmUgdGhlcmUgYXJlIG5vIHRpbnkgZ3JvdXAgc2l6ZXMsIGxpa2UgaWYgdGhlcmUgYXJlIDIwMFxuICAgICAgICAvLyB3b3JkcyBhbmQgYSBncm91cCBzaXplIG9mIDE4LiBDcmVhdGluZyBncm91cHMgb2Ygc2l6ZSAxOCB3b3VsZCBtZWFuIGdldHRpbmcgMTEgZ3JvdXBzXG4gICAgICAgIC8vIG9mIDE4IGFuZCAxIGdyb3VwIG9mIDIuIFRoaXMgbWV0aG9kIGVuZHMgdXAgY3JlYXRpbmcgOCBncm91cHMgb2YgMTcgKDEzNikgKyA0IGdyb3VwcyBvZlxuICAgICAgICAvLyAxNiAoNjQpLiBJJ20gc3VyZSB0aGVyZSBpcyBhIGJldHRlciB3YXkgdG8gY2FsY3VsYXRlIGl0IGJ1dCB0aGlzIHNlZW1zIHRvIHdvcmsgYW5kIEknbVxuICAgICAgICAvLyBsYXp5IHdoZW4gaXQgY29tZXMgdG8gbWF0aC5cbiAgICAgICAgY29uc3QgdG90YWwgPSB3b3Jkcy5sZW5ndGg7XG4gICAgICAgIGNvbnN0IGFjdHVhbEdyb3VwQ291bnQgPSBNYXRoLmNlaWwodG90YWwgLyBkZXNpcmVkR3JvdXBTaXplKTtcbiAgICAgICAgY29uc3QgbWF4R3JvdXBTaXplID0gTWF0aC5jZWlsKHRvdGFsIC8gYWN0dWFsR3JvdXBDb3VudCk7XG4gICAgICAgIGNvbnN0IHJlZHVjZWRHcm91cFNpemUgPSBtYXhHcm91cFNpemUgLSAxO1xuICAgICAgICBjb25zdCBzaXplc1RvQ3JlYXRlID0gW107XG4gICAgICAgIGxldCByZW1haW5pbmdXb3JkcyA9IHRvdGFsO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFjdHVhbEdyb3VwQ291bnQ7IGkrKykge1xuICAgICAgICAgICAgaWYgKHJlbWFpbmluZ1dvcmRzICUgbWF4R3JvdXBTaXplID09IDApIHtcbiAgICAgICAgICAgICAgICBzaXplc1RvQ3JlYXRlLnB1c2gobWF4R3JvdXBTaXplKTtcbiAgICAgICAgICAgICAgICByZW1haW5pbmdXb3JkcyAtPSBtYXhHcm91cFNpemU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzaXplc1RvQ3JlYXRlLnB1c2gocmVkdWNlZEdyb3VwU2l6ZSk7XG4gICAgICAgICAgICAgICAgcmVtYWluaW5nV29yZHMgLT0gcmVkdWNlZEdyb3VwU2l6ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBsZXQgc3RhcnQgPSAwO1xuICAgICAgICBzaXplc1RvQ3JlYXRlLmZvckVhY2goKHNpemUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHdvcmRzID0gcmFuZG9tbHlTb3J0ZWQuc2xpY2Uoc3RhcnQsIHN0YXJ0ICsgc2l6ZSk7XG4gICAgICAgICAgICBjb25zdCB3b3Jkc2V0ID0gbmV3IHdvcmRzZXRfMS5Xb3Jkc2V0KHdvcmRzKTtcbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzLnB1c2gobmV3IFRiZEdyb3VwKHdvcmRzZXQpKTtcbiAgICAgICAgICAgIHN0YXJ0ID0gc3RhcnQgKyBzaXplO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJncm91cHNSZWdlbmVyYXRlZFwiLCB7IGdyb3VwczogdGhpcy5ncm91cHMgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5kaXNwYXRjaEV2ZW50KFwibmV4dEdyb3VwXCIsIHtcbiAgICAgICAgICAgIGdyb3VwOiB0aGlzLmdldEdyb3VwcygpWzBdLFxuICAgICAgICAgICAgZ3JvdXBOdW1iZXI6IDEsXG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmNsYXNzIFRiZEdyb3VwIHtcbiAgICBjb25zdHJ1Y3Rvcih3b3Jkc2V0KSB7XG4gICAgICAgIHRoaXMudGhyZXNob2xkID0gMTtcbiAgICAgICAgdGhpcy53b3Jkc2V0ID0gd29yZHNldDtcbiAgICB9XG4gICAgZ2V0V29yZHNldCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud29yZHNldDtcbiAgICB9XG4gICAgZ2V0VGhyZXNob2xkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50aHJlc2hvbGQ7XG4gICAgfVxuICAgIGJ1bXBUaHJlc2hvbGQoKSB7XG4gICAgICAgIHRoaXMudGhyZXNob2xkICs9IDE7XG4gICAgICAgIFRiZEV2ZW50cy5kaXNwYXRjaEV2ZW50KFwiZ3JvdXBUaHJlc2hvbGRDaGFuZ2VkXCIsIHtcbiAgICAgICAgICAgIHRocmVzaG9sZDogdGhpcy50aHJlc2hvbGQsXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXRVbmJlYXRlbldvcmRzZXQoKSB7XG4gICAgICAgIGNvbnN0IHVuYmVhdGVuV29yZHMgPSB0aGlzLndvcmRzZXQud29yZHMuZmlsdGVyKCh3b3JkKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gIVRiZERhdGEuaGFzV29yZEJlZW5UeXBlZEZhc3RlclRoYW4od29yZCwgdGhpcy5nZXRUaHJlc2hvbGQoKSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbmV3IHdvcmRzZXRfMS5Xb3Jkc2V0KHVuYmVhdGVuV29yZHMpO1xuICAgIH1cbiAgICBpbmNyZWFzZVRocmVzaG9sZFVudGlsU29tZVdvcmRzQXJlVW5iZWF0ZW4oKSB7XG4gICAgICAgIGlmICh0aGlzLndvcmRzZXQubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB3aGlsZSAodGhpcy5nZXRVbmJlYXRlbldvcmRzZXQoKS5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5idW1wVGhyZXNob2xkKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5Db25maWdFdmVudC5zdWJzY3JpYmUoaGFuZGxlRnVuYm94Q2hhbmdlKTtcbmZ1bmN0aW9uIGlzVGJkTW9kZSgpIHtcbiAgICByZXR1cm4gY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT0gXCJ0YmRtb2RlXCI7XG59XG5mdW5jdGlvbiBoYW5kbGVGdW5ib3hDaGFuZ2Uoa2V5LCBfbmV3VmFsdWUsIF9ub3NhdmUsIF9wcmV2aW91c1ZhbHVlLCBfZnVsbENvbmZpZykge1xuICAgIGlmIChrZXkgIT0gXCJmdW5ib3hcIikge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChpc1RiZE1vZGUoKSAmJiAhZ2V0VGJkTW9kZSgpKSB7XG4gICAgICAgIGNvbnN0IHRiZENvbmZpZyA9IG5ldyBUYmRDb25maWcoKTtcbiAgICAgICAgdGJkQ29uZmlnLmluaXQoKTtcbiAgICAgICAgdGJkTW9kZSA9IG5ldyBUYmRNb2RlKHRiZENvbmZpZyk7XG4gICAgICAgIHRiZE1vZGUuaW5pdCgpO1xuICAgICAgICBjb25zdCB1aSA9IG5ldyBUYmRVSSh0YmRNb2RlKTtcbiAgICAgICAgdWkuaW5pdCgpO1xuICAgIH1cbiAgICBlbHNlIGlmICghaXNUYmRNb2RlKCkgJiYgZ2V0VGJkTW9kZSgpKSB7XG4gICAgICAgIC8vIFRoaXMgd2FzIHRoZSBlYXNpZXN0IHdheSBJIGNvdWxkIHRoaW5rIG9mIHRvIGVuc3VyZSB0aGVyZSdzIG5vdGhpbmcgbGVmdCBvdmVyXG4gICAgICAgIC8vIGFmdGVyIHN3aXRjaGluZyBmcm9tIFRCRCBNb2RlIHRvIHNvbWV0aGluZyBlbHNlLlxuICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgICB9XG59XG5sZXQgdGJkTW9kZTtcbmZ1bmN0aW9uIGdldFRiZE1vZGUoKSB7XG4gICAgcmV0dXJuIHRiZE1vZGU7XG59XG5leHBvcnRzLmdldFRiZE1vZGUgPSBnZXRUYmRNb2RlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudXBkYXRlID0gZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbi8vIGV4cG9ydCBmdW5jdGlvbiBzaG93KCkge1xuLy8gICAkKFwiI3RvcCAuY29uZmlnXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpLmNzcyhcIm9wYWNpdHlcIiwgMSk7XG4vLyB9XG4vLyBleHBvcnQgZnVuY3Rpb24gaGlkZSgpIHtcbi8vICAgJChcIiN0b3AgLmNvbmZpZ1wiKS5jc3MoXCJvcGFjaXR5XCIsIDApLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuLy8gfVxuZnVuY3Rpb24gc2hvdygpIHtcbiAgICAkKFwiI3RvcCAuY29uZmlnXCIpXG4gICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IDEsXG4gICAgfSwgMTI1KTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgICQoXCIjdG9wIC5jb25maWdcIilcbiAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiAwLFxuICAgIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAkKFwiI3RvcCAuY29uZmlnXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbmZ1bmN0aW9uIHVwZGF0ZShwcmV2aW91cywgY3VycmVudCkge1xuICAgIGlmIChwcmV2aW91cyA9PT0gY3VycmVudClcbiAgICAgICAgcmV0dXJuO1xuICAgICQoXCIjdG9wIC5jb25maWcgLm1vZGUgLnRleHQtYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICQoXCIjdG9wIC5jb25maWcgLm1vZGUgLnRleHQtYnV0dG9uW21vZGU9J1wiICsgY3VycmVudCArIFwiJ11cIikuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgaWYgKGN1cnJlbnQgPT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAud29yZENvdW50XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC50aW1lXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5jdXN0b21UZXh0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI3RvcCAuY29uZmlnIC5wdW5jdHVhdGlvbk1vZGVcIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgJChcIiN0b3AgLmNvbmZpZyAubnVtYmVyc01vZGVcIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAucHVuY0FuZE51bVwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5wdW5jdHVhdGlvbk1vZGVcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLm51bWJlcnNNb2RlXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5xdW90ZUxlbmd0aFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY3VycmVudCA9PSBcIndvcmRzXCIpIHtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAud29yZENvdW50XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC50aW1lXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5jdXN0b21UZXh0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI3RvcCAuY29uZmlnIC5wdW5jdHVhdGlvbk1vZGVcIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgJChcIiN0b3AgLmNvbmZpZyAubnVtYmVyc01vZGVcIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAucHVuY0FuZE51bVwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5wdW5jdHVhdGlvbk1vZGVcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLm51bWJlcnNNb2RlXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5xdW90ZUxlbmd0aFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY3VycmVudCA9PSBcImN1c3RvbVwiKSB7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLndvcmRDb3VudFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAudGltZVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAuY3VzdG9tVGV4dFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiN0b3AgLmNvbmZpZyAucHVuY3R1YXRpb25Nb2RlXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICQoXCIjdG9wIC5jb25maWcgLm51bWJlcnNNb2RlXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLnB1bmNBbmROdW1cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAucHVuY3R1YXRpb25Nb2RlXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5udW1iZXJzTW9kZVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAucXVvdGVMZW5ndGhcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGN1cnJlbnQgPT0gXCJxdW90ZVwiKSB7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLndvcmRDb3VudFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAudGltZVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAuY3VzdG9tVGV4dFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiN0b3AgLmNvbmZpZyAucHVuY3R1YXRpb25Nb2RlXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICQoXCIjdG9wIC5jb25maWcgLm51bWJlcnNNb2RlXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLnB1bmNBbmROdW1cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAucHVuY3R1YXRpb25Nb2RlXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5udW1iZXJzTW9kZVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiNyZXN1bHQgLnN0YXRzIC5zb3VyY2VcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLnF1b3RlTGVuZ3RoXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjdXJyZW50ID09IFwiemVuXCIpIHtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAud29yZENvdW50XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC50aW1lXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5jdXN0b21UZXh0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5wdW5jdHVhdGlvbk1vZGVcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLm51bWJlcnNNb2RlXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5xdW90ZUxlbmd0aFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgY29uc3Qgc3VibWVudSA9IHtcbiAgICAgICAgdGltZTogXCJ0aW1lXCIsXG4gICAgICAgIHdvcmRzOiBcIndvcmRDb3VudFwiLFxuICAgICAgICBjdXN0b206IFwiY3VzdG9tVGV4dFwiLFxuICAgICAgICBxdW90ZTogXCJxdW90ZUxlbmd0aFwiLFxuICAgICAgICB6ZW46IFwiXCIsXG4gICAgfTtcbiAgICBjb25zdCBhbmltVGltZSA9IDI1MDtcbiAgICBpZiAoY3VycmVudCA9PSBcInplblwiKSB7XG4gICAgICAgICQoYCN0b3AgLmNvbmZpZyAuJHtzdWJtZW51W3ByZXZpb3VzXX1gKS5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIGFuaW1UaW1lIC8gMiwgKCkgPT4ge1xuICAgICAgICAgICAgJChgI3RvcCAuY29uZmlnIC4ke3N1Ym1lbnVbcHJldmlvdXNdfWApLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgJChgI3RvcCAuY29uZmlnIC5wdW5jQW5kTnVtYCkuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCBhbmltVGltZSAvIDIsICgpID0+IHtcbiAgICAgICAgICAgICQoYCN0b3AgLmNvbmZpZyAucHVuY0FuZE51bWApLmFkZENsYXNzKFwiaW52aXNpYmxlXCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAocHJldmlvdXMgPT0gXCJ6ZW5cIikge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICQoYCN0b3AgLmNvbmZpZyAuJHtzdWJtZW51W2N1cnJlbnRdfWApLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChgI3RvcCAuY29uZmlnIC4ke3N1Ym1lbnVbY3VycmVudF19YClcbiAgICAgICAgICAgICAgICAuY3NzKHsgb3BhY2l0eTogMCB9KVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgfSwgYW5pbVRpbWUgLyAyKTtcbiAgICAgICAgICAgICQoYCN0b3AgLmNvbmZpZyAucHVuY0FuZE51bWApLnJlbW92ZUNsYXNzKFwiaW52aXNpYmxlXCIpO1xuICAgICAgICAgICAgJChgI3RvcCAuY29uZmlnIC5wdW5jQW5kTnVtYClcbiAgICAgICAgICAgICAgICAuY3NzKHsgb3BhY2l0eTogMCB9KVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgfSwgYW5pbVRpbWUgLyAyKTtcbiAgICAgICAgfSwgYW5pbVRpbWUgLyAyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBNaXNjLnN3YXBFbGVtZW50cygkKFwiI3RvcCAuY29uZmlnIC5cIiArIHN1Ym1lbnVbcHJldmlvdXNdKSwgJChcIiN0b3AgLmNvbmZpZyAuXCIgKyBzdWJtZW51W2N1cnJlbnRdKSwgYW5pbVRpbWUpO1xufVxuZXhwb3J0cy51cGRhdGUgPSB1cGRhdGU7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5LCBldmVudFZhbHVlLCBfbm9zYXZlLCBldmVudFByZXZpb3VzVmFsdWUpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwibW9kZVwiKSB7XG4gICAgICAgIHVwZGF0ZShldmVudFByZXZpb3VzVmFsdWUsIGV2ZW50VmFsdWUpO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucmVzdGFydCA9IGV4cG9ydHMucHVzaEJ1cnN0VG9IaXN0b3J5ID0gZXhwb3J0cy5wdXNoVG9SYXdIaXN0b3J5ID0gZXhwb3J0cy5wdXNoVG9XcG1IaXN0b3J5ID0gZXhwb3J0cy5wdXNoTWlzc2VkV29yZCA9IGV4cG9ydHMucmVzZXRLZXlwcmVzc1RpbWluZ3MgPSBleHBvcnRzLnJlY29yZEtleXByZXNzU3BhY2luZyA9IGV4cG9ydHMuc2V0S2V5cHJlc3NEdXJhdGlvbiA9IGV4cG9ydHMucHVzaEtleXByZXNzRHVyYXRpb24gPSBleHBvcnRzLnNldEtleXByZXNzVGltaW5nc1Rvb0xvbmcgPSBleHBvcnRzLmluY3JlbWVudEFjY3VyYWN5ID0gZXhwb3J0cy5wdXNoS2V5cHJlc3Nlc1RvSGlzdG9yeSA9IGV4cG9ydHMuc2V0QnVyc3RTdGFydCA9IGV4cG9ydHMucHVzaEtleXByZXNzV29yZCA9IGV4cG9ydHMuaW5jcmVtZW50S2V5cHJlc3NFcnJvcnMgPSBleHBvcnRzLnNldEtleXByZXNzTm90QWZrID0gZXhwb3J0cy5pbmNyZW1lbnRLZXlwcmVzc0NvdW50ID0gZXhwb3J0cy51cGRhdGVMYXN0S2V5cHJlc3MgPSBleHBvcnRzLmVuYWJsZVNwYWNpbmdEZWJ1ZyA9IGV4cG9ydHMuc3BhY2luZ0RlYnVnID0gZXhwb3J0cy5zZXRCYWlsb3V0ID0gZXhwb3J0cy5iYWlsb3V0ID0gZXhwb3J0cy5idXJzdEhpc3RvcnkgPSBleHBvcnRzLnJhd0hpc3RvcnkgPSBleHBvcnRzLndwbUhpc3RvcnkgPSBleHBvcnRzLmtleXByZXNzVGltaW5ncyA9IGV4cG9ydHMuYWNjdXJhY3kgPSBleHBvcnRzLm1pc3NlZFdvcmRzID0gZXhwb3J0cy5jdXJyZW50QnVyc3RTdGFydCA9IGV4cG9ydHMubGFzdEtleXByZXNzID0gZXhwb3J0cy5jdXJyZW50S2V5cHJlc3MgPSBleHBvcnRzLmtleXByZXNzUGVyU2Vjb25kID0gZXhwb3J0cy5jb3JyZWN0ZWQgPSBleHBvcnRzLmlucHV0ID0gdm9pZCAwO1xuY29uc3QgVGVzdFdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtd29yZHNcIikpO1xuY29uc3QgbWlzY18xID0gcmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIik7XG5jbGFzcyBJbnB1dCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuY3VycmVudCA9IFwiXCI7XG4gICAgICAgIHRoaXMuaGlzdG9yeSA9IFtdO1xuICAgICAgICB0aGlzLmhpc3RvcnlMZW5ndGggPSAwO1xuICAgICAgICB0aGlzLmxlbmd0aCA9IDA7XG4gICAgfVxuICAgIHJlc2V0KCkge1xuICAgICAgICB0aGlzLmN1cnJlbnQgPSBcIlwiO1xuICAgICAgICB0aGlzLmhpc3RvcnkgPSBbXTtcbiAgICAgICAgdGhpcy5sZW5ndGggPSAwO1xuICAgIH1cbiAgICByZXNldEhpc3RvcnkoKSB7XG4gICAgICAgIHRoaXMuaGlzdG9yeSA9IFtdO1xuICAgICAgICB0aGlzLmxlbmd0aCA9IDA7XG4gICAgfVxuICAgIHNldEN1cnJlbnQodmFsKSB7XG4gICAgICAgIHRoaXMuY3VycmVudCA9IHZhbDtcbiAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLmN1cnJlbnQubGVuZ3RoO1xuICAgIH1cbiAgICBhcHBlbmRDdXJyZW50KHZhbCkge1xuICAgICAgICB0aGlzLmN1cnJlbnQgKz0gdmFsO1xuICAgICAgICB0aGlzLmxlbmd0aCA9IHRoaXMuY3VycmVudC5sZW5ndGg7XG4gICAgfVxuICAgIHJlc2V0Q3VycmVudCgpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50ID0gXCJcIjtcbiAgICB9XG4gICAgZ2V0Q3VycmVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudDtcbiAgICB9XG4gICAgcHVzaEhpc3RvcnkoKSB7XG4gICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKHRoaXMuY3VycmVudCk7XG4gICAgICAgIHRoaXMuaGlzdG9yeUxlbmd0aCA9IHRoaXMuaGlzdG9yeS5sZW5ndGg7XG4gICAgICAgIHRoaXMucmVzZXRDdXJyZW50KCk7XG4gICAgfVxuICAgIHBvcEhpc3RvcnkoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgcmV0ID0gKF9hID0gdGhpcy5oaXN0b3J5LnBvcCgpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIlwiO1xuICAgICAgICB0aGlzLmhpc3RvcnlMZW5ndGggPSB0aGlzLmhpc3RvcnkubGVuZ3RoO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH1cbiAgICBnZXRIaXN0b3J5KGkpIHtcbiAgICAgICAgaWYgKGkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGlzdG9yeTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmhpc3RvcnlbaV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0SGlzdG9yeUxhc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhpc3RvcnlbdGhpcy5oaXN0b3J5Lmxlbmd0aCAtIDFdO1xuICAgIH1cbn1cbmNsYXNzIENvcnJlY3RlZCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuY3VycmVudCA9IFwiXCI7XG4gICAgICAgIHRoaXMuaGlzdG9yeSA9IFtdO1xuICAgIH1cbiAgICBzZXRDdXJyZW50KHZhbCkge1xuICAgICAgICB0aGlzLmN1cnJlbnQgPSB2YWw7XG4gICAgfVxuICAgIGFwcGVuZEN1cnJlbnQodmFsKSB7XG4gICAgICAgIHRoaXMuY3VycmVudCArPSB2YWw7XG4gICAgfVxuICAgIHJlc2V0Q3VycmVudCgpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50ID0gXCJcIjtcbiAgICB9XG4gICAgcmVzZXRIaXN0b3J5KCkge1xuICAgICAgICB0aGlzLmhpc3RvcnkgPSBbXTtcbiAgICB9XG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMucmVzZXRDdXJyZW50KCk7XG4gICAgICAgIHRoaXMucmVzZXRIaXN0b3J5KCk7XG4gICAgfVxuICAgIGdldEhpc3RvcnkoaSkge1xuICAgICAgICByZXR1cm4gdGhpcy5oaXN0b3J5W2ldO1xuICAgIH1cbiAgICBwb3BIaXN0b3J5KCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHJldHVybiAoX2EgPSB0aGlzLmhpc3RvcnkucG9wKCkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiXCI7XG4gICAgfVxuICAgIHB1c2hIaXN0b3J5KCkge1xuICAgICAgICB0aGlzLmhpc3RvcnkucHVzaCh0aGlzLmN1cnJlbnQpO1xuICAgICAgICB0aGlzLmN1cnJlbnQgPSBcIlwiO1xuICAgIH1cbn1cbmV4cG9ydHMuaW5wdXQgPSBuZXcgSW5wdXQoKTtcbmV4cG9ydHMuY29ycmVjdGVkID0gbmV3IENvcnJlY3RlZCgpO1xuZXhwb3J0cy5rZXlwcmVzc1BlclNlY29uZCA9IFtdO1xuZXhwb3J0cy5jdXJyZW50S2V5cHJlc3MgPSB7XG4gICAgY291bnQ6IDAsXG4gICAgZXJyb3JzOiAwLFxuICAgIHdvcmRzOiBbXSxcbiAgICBhZms6IHRydWUsXG59O1xuZXhwb3J0cy5jdXJyZW50QnVyc3RTdGFydCA9IDA7XG5leHBvcnRzLm1pc3NlZFdvcmRzID0ge307XG5leHBvcnRzLmFjY3VyYWN5ID0ge1xuICAgIGNvcnJlY3Q6IDAsXG4gICAgaW5jb3JyZWN0OiAwLFxufTtcbmV4cG9ydHMua2V5cHJlc3NUaW1pbmdzID0ge1xuICAgIHNwYWNpbmc6IHtcbiAgICAgICAgY3VycmVudDogLTEsXG4gICAgICAgIGFycmF5OiBbXSxcbiAgICB9LFxuICAgIGR1cmF0aW9uOiB7XG4gICAgICAgIGN1cnJlbnQ6IC0xLFxuICAgICAgICBhcnJheTogW10sXG4gICAgfSxcbn07XG5leHBvcnRzLndwbUhpc3RvcnkgPSBbXTtcbmV4cG9ydHMucmF3SGlzdG9yeSA9IFtdO1xuZXhwb3J0cy5idXJzdEhpc3RvcnkgPSBbXTtcbmV4cG9ydHMuYmFpbG91dCA9IGZhbHNlO1xuZnVuY3Rpb24gc2V0QmFpbG91dCh0Zikge1xuICAgIGV4cG9ydHMuYmFpbG91dCA9IHRmO1xufVxuZXhwb3J0cy5zZXRCYWlsb3V0ID0gc2V0QmFpbG91dDtcbmV4cG9ydHMuc3BhY2luZ0RlYnVnID0gZmFsc2U7XG5mdW5jdGlvbiBlbmFibGVTcGFjaW5nRGVidWcoKSB7XG4gICAgZXhwb3J0cy5zcGFjaW5nRGVidWcgPSB0cnVlO1xuICAgIGNvbnNvbGUuY2xlYXIoKTtcbn1cbmV4cG9ydHMuZW5hYmxlU3BhY2luZ0RlYnVnID0gZW5hYmxlU3BhY2luZ0RlYnVnO1xuZnVuY3Rpb24gdXBkYXRlTGFzdEtleXByZXNzKCkge1xuICAgIGV4cG9ydHMubGFzdEtleXByZXNzID0gcGVyZm9ybWFuY2Uubm93KCk7XG59XG5leHBvcnRzLnVwZGF0ZUxhc3RLZXlwcmVzcyA9IHVwZGF0ZUxhc3RLZXlwcmVzcztcbmZ1bmN0aW9uIGluY3JlbWVudEtleXByZXNzQ291bnQoKSB7XG4gICAgZXhwb3J0cy5jdXJyZW50S2V5cHJlc3MuY291bnQrKztcbn1cbmV4cG9ydHMuaW5jcmVtZW50S2V5cHJlc3NDb3VudCA9IGluY3JlbWVudEtleXByZXNzQ291bnQ7XG5mdW5jdGlvbiBzZXRLZXlwcmVzc05vdEFmaygpIHtcbiAgICBleHBvcnRzLmN1cnJlbnRLZXlwcmVzcy5hZmsgPSBmYWxzZTtcbn1cbmV4cG9ydHMuc2V0S2V5cHJlc3NOb3RBZmsgPSBzZXRLZXlwcmVzc05vdEFmaztcbmZ1bmN0aW9uIGluY3JlbWVudEtleXByZXNzRXJyb3JzKCkge1xuICAgIGV4cG9ydHMuY3VycmVudEtleXByZXNzLmVycm9ycysrO1xufVxuZXhwb3J0cy5pbmNyZW1lbnRLZXlwcmVzc0Vycm9ycyA9IGluY3JlbWVudEtleXByZXNzRXJyb3JzO1xuZnVuY3Rpb24gcHVzaEtleXByZXNzV29yZCh3b3JkSW5kZXgpIHtcbiAgICBleHBvcnRzLmN1cnJlbnRLZXlwcmVzcy53b3Jkcy5wdXNoKHdvcmRJbmRleCk7XG59XG5leHBvcnRzLnB1c2hLZXlwcmVzc1dvcmQgPSBwdXNoS2V5cHJlc3NXb3JkO1xuZnVuY3Rpb24gc2V0QnVyc3RTdGFydCh0aW1lKSB7XG4gICAgZXhwb3J0cy5jdXJyZW50QnVyc3RTdGFydCA9IHRpbWU7XG59XG5leHBvcnRzLnNldEJ1cnN0U3RhcnQgPSBzZXRCdXJzdFN0YXJ0O1xuZnVuY3Rpb24gcHVzaEtleXByZXNzZXNUb0hpc3RvcnkoKSB7XG4gICAgZXhwb3J0cy5rZXlwcmVzc1BlclNlY29uZC5wdXNoKGV4cG9ydHMuY3VycmVudEtleXByZXNzKTtcbiAgICBleHBvcnRzLmN1cnJlbnRLZXlwcmVzcyA9IHtcbiAgICAgICAgY291bnQ6IDAsXG4gICAgICAgIGVycm9yczogMCxcbiAgICAgICAgd29yZHM6IFtdLFxuICAgICAgICBhZms6IHRydWUsXG4gICAgfTtcbn1cbmV4cG9ydHMucHVzaEtleXByZXNzZXNUb0hpc3RvcnkgPSBwdXNoS2V5cHJlc3Nlc1RvSGlzdG9yeTtcbmZ1bmN0aW9uIGluY3JlbWVudEFjY3VyYWN5KGNvcnJlY3RpbmNvcnJlY3QpIHtcbiAgICBpZiAoY29ycmVjdGluY29ycmVjdCkge1xuICAgICAgICBleHBvcnRzLmFjY3VyYWN5LmNvcnJlY3QrKztcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGV4cG9ydHMuYWNjdXJhY3kuaW5jb3JyZWN0Kys7XG4gICAgfVxufVxuZXhwb3J0cy5pbmNyZW1lbnRBY2N1cmFjeSA9IGluY3JlbWVudEFjY3VyYWN5O1xuZnVuY3Rpb24gc2V0S2V5cHJlc3NUaW1pbmdzVG9vTG9uZygpIHtcbiAgICBleHBvcnRzLmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmFycmF5ID0gXCJ0b29sb25nXCI7XG4gICAgZXhwb3J0cy5rZXlwcmVzc1RpbWluZ3MuZHVyYXRpb24uYXJyYXkgPSBcInRvb2xvbmdcIjtcbn1cbmV4cG9ydHMuc2V0S2V5cHJlc3NUaW1pbmdzVG9vTG9uZyA9IHNldEtleXByZXNzVGltaW5nc1Rvb0xvbmc7XG5mdW5jdGlvbiBwdXNoS2V5cHJlc3NEdXJhdGlvbih2YWwpIHtcbiAgICBleHBvcnRzLmtleXByZXNzVGltaW5ncy5kdXJhdGlvbi5hcnJheS5wdXNoKCgwLCBtaXNjXzEucm91bmRUbzIpKHZhbCkpO1xufVxuZXhwb3J0cy5wdXNoS2V5cHJlc3NEdXJhdGlvbiA9IHB1c2hLZXlwcmVzc0R1cmF0aW9uO1xuZnVuY3Rpb24gc2V0S2V5cHJlc3NEdXJhdGlvbih2YWwpIHtcbiAgICBleHBvcnRzLmtleXByZXNzVGltaW5ncy5kdXJhdGlvbi5jdXJyZW50ID0gKDAsIG1pc2NfMS5yb3VuZFRvMikodmFsKTtcbn1cbmV4cG9ydHMuc2V0S2V5cHJlc3NEdXJhdGlvbiA9IHNldEtleXByZXNzRHVyYXRpb247XG5mdW5jdGlvbiBwdXNoS2V5cHJlc3NTcGFjaW5nKHZhbCkge1xuICAgIGV4cG9ydHMua2V5cHJlc3NUaW1pbmdzLnNwYWNpbmcuYXJyYXkucHVzaCgoMCwgbWlzY18xLnJvdW5kVG8yKSh2YWwpKTtcbn1cbmZ1bmN0aW9uIHNldEtleXByZXNzU3BhY2luZyh2YWwpIHtcbiAgICBleHBvcnRzLmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmN1cnJlbnQgPSAoMCwgbWlzY18xLnJvdW5kVG8yKSh2YWwpO1xufVxuZnVuY3Rpb24gcmVjb3JkS2V5cHJlc3NTcGFjaW5nKCkge1xuICAgIGNvbnN0IG5vdyA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIGNvbnN0IGRpZmYgPSBNYXRoLmFicyhleHBvcnRzLmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmN1cnJlbnQgLSBub3cpO1xuICAgIGlmIChleHBvcnRzLmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmN1cnJlbnQgIT09IC0xKSB7XG4gICAgICAgIHB1c2hLZXlwcmVzc1NwYWNpbmcoZGlmZik7XG4gICAgICAgIGlmIChleHBvcnRzLnNwYWNpbmdEZWJ1Zykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJzcGFjaW5nIGRlYnVnXCIsIFwicHVzaFwiLCBkaWZmLCBcImxlbmd0aFwiLCBleHBvcnRzLmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmFycmF5Lmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0S2V5cHJlc3NTcGFjaW5nKG5vdyk7XG4gICAgaWYgKGV4cG9ydHMuc3BhY2luZ0RlYnVnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwic3BhY2luZyBkZWJ1Z1wiLCBcInNldFwiLCBub3csIFwibGVuZ3RoXCIsIGV4cG9ydHMua2V5cHJlc3NUaW1pbmdzLnNwYWNpbmcuYXJyYXkubGVuZ3RoKTtcbiAgICB9XG4gICAgaWYgKGV4cG9ydHMuc3BhY2luZ0RlYnVnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwic3BhY2luZyBkZWJ1Z1wiLCBcInJlY29yZGVkXCIsIFwibGVuZ3RoXCIsIGV4cG9ydHMua2V5cHJlc3NUaW1pbmdzLnNwYWNpbmcuYXJyYXkubGVuZ3RoKTtcbiAgICB9XG59XG5leHBvcnRzLnJlY29yZEtleXByZXNzU3BhY2luZyA9IHJlY29yZEtleXByZXNzU3BhY2luZztcbmZ1bmN0aW9uIHJlc2V0S2V5cHJlc3NUaW1pbmdzKCkge1xuICAgIGV4cG9ydHMua2V5cHJlc3NUaW1pbmdzID0ge1xuICAgICAgICBzcGFjaW5nOiB7XG4gICAgICAgICAgICBjdXJyZW50OiBwZXJmb3JtYW5jZS5ub3coKSxcbiAgICAgICAgICAgIGFycmF5OiBbXSxcbiAgICAgICAgfSxcbiAgICAgICAgZHVyYXRpb246IHtcbiAgICAgICAgICAgIGN1cnJlbnQ6IHBlcmZvcm1hbmNlLm5vdygpLFxuICAgICAgICAgICAgYXJyYXk6IFtdLFxuICAgICAgICB9LFxuICAgIH07XG4gICAgaWYgKGV4cG9ydHMuc3BhY2luZ0RlYnVnKVxuICAgICAgICBjb25zb2xlLmNsZWFyKCk7XG59XG5leHBvcnRzLnJlc2V0S2V5cHJlc3NUaW1pbmdzID0gcmVzZXRLZXlwcmVzc1RpbWluZ3M7XG5mdW5jdGlvbiBwdXNoTWlzc2VkV29yZCh3b3JkKSB7XG4gICAgaWYgKCFPYmplY3Qua2V5cyhleHBvcnRzLm1pc3NlZFdvcmRzKS5pbmNsdWRlcyh3b3JkKSkge1xuICAgICAgICBleHBvcnRzLm1pc3NlZFdvcmRzW3dvcmRdID0gMTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGV4cG9ydHMubWlzc2VkV29yZHNbd29yZF0rKztcbiAgICB9XG59XG5leHBvcnRzLnB1c2hNaXNzZWRXb3JkID0gcHVzaE1pc3NlZFdvcmQ7XG5mdW5jdGlvbiBwdXNoVG9XcG1IaXN0b3J5KHdwbSkge1xuICAgIGV4cG9ydHMud3BtSGlzdG9yeS5wdXNoKHdwbSk7XG59XG5leHBvcnRzLnB1c2hUb1dwbUhpc3RvcnkgPSBwdXNoVG9XcG1IaXN0b3J5O1xuZnVuY3Rpb24gcHVzaFRvUmF3SGlzdG9yeShyYXcpIHtcbiAgICBleHBvcnRzLnJhd0hpc3RvcnkucHVzaChyYXcpO1xufVxuZXhwb3J0cy5wdXNoVG9SYXdIaXN0b3J5ID0gcHVzaFRvUmF3SGlzdG9yeTtcbmZ1bmN0aW9uIHB1c2hCdXJzdFRvSGlzdG9yeShzcGVlZCkge1xuICAgIGlmIChleHBvcnRzLmJ1cnN0SGlzdG9yeVtUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGV4cG9ydHMuYnVyc3RIaXN0b3J5LnB1c2goc3BlZWQpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy9yZXBlYXRlZCB3b3JkIC0gb3ZlcnJpZGVcbiAgICAgICAgZXhwb3J0cy5idXJzdEhpc3RvcnlbVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleF0gPSBzcGVlZDtcbiAgICB9XG59XG5leHBvcnRzLnB1c2hCdXJzdFRvSGlzdG9yeSA9IHB1c2hCdXJzdFRvSGlzdG9yeTtcbmZ1bmN0aW9uIHJlc3RhcnQoKSB7XG4gICAgZXhwb3J0cy53cG1IaXN0b3J5ID0gW107XG4gICAgZXhwb3J0cy5yYXdIaXN0b3J5ID0gW107XG4gICAgZXhwb3J0cy5idXJzdEhpc3RvcnkgPSBbXTtcbiAgICBleHBvcnRzLmtleXByZXNzUGVyU2Vjb25kID0gW107XG4gICAgZXhwb3J0cy5jdXJyZW50S2V5cHJlc3MgPSB7XG4gICAgICAgIGNvdW50OiAwLFxuICAgICAgICBlcnJvcnM6IDAsXG4gICAgICAgIHdvcmRzOiBbXSxcbiAgICAgICAgYWZrOiB0cnVlLFxuICAgIH07XG4gICAgZXhwb3J0cy5jdXJyZW50QnVyc3RTdGFydCA9IDA7XG4gICAgZXhwb3J0cy5taXNzZWRXb3JkcyA9IHt9O1xuICAgIGV4cG9ydHMuYWNjdXJhY3kgPSB7XG4gICAgICAgIGNvcnJlY3Q6IDAsXG4gICAgICAgIGluY29ycmVjdDogMCxcbiAgICB9O1xuICAgIGV4cG9ydHMua2V5cHJlc3NUaW1pbmdzID0ge1xuICAgICAgICBzcGFjaW5nOiB7XG4gICAgICAgICAgICBjdXJyZW50OiAtMSxcbiAgICAgICAgICAgIGFycmF5OiBbXSxcbiAgICAgICAgfSxcbiAgICAgICAgZHVyYXRpb246IHtcbiAgICAgICAgICAgIGN1cnJlbnQ6IC0xLFxuICAgICAgICAgICAgYXJyYXk6IFtdLFxuICAgICAgICB9LFxuICAgIH07XG59XG5leHBvcnRzLnJlc3RhcnQgPSByZXN0YXJ0O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5mYWlsID0gZXhwb3J0cy5maW5pc2ggPSBleHBvcnRzLnJldHJ5U2F2aW5nUmVzdWx0ID0gZXhwb3J0cy5hZGRXb3JkID0gZXhwb3J0cy5pbml0ID0gZXhwb3J0cy5yZXN0YXJ0ID0gZXhwb3J0cy5zdGFydFRlc3QgPSBleHBvcnRzLnB1bmN0dWF0ZVdvcmQgPSBleHBvcnRzLnNldE5vdFNpZ25lZEluVWlkID0gZXhwb3J0cy5jbGVhck5vdFNpZ25lZEluUmVzdWx0ID0gZXhwb3J0cy5ub3RTaWduZWRJbkxhc3RSZXN1bHQgPSB2b2lkIDA7XG5jb25zdCBhcGVfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vYXBlXCIpKTtcbmNvbnN0IFRlc3RVSSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXVpXCIpKTtcbmNvbnN0IE1hbnVhbFJlc3RhcnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbWFudWFsLXJlc3RhcnQtdHJhY2tlclwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IHF1b3Rlc19jb250cm9sbGVyXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL3F1b3Rlcy1jb250cm9sbGVyXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgQ3VzdG9tVGV4dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jdXN0b20tdGV4dFwiKSk7XG5jb25zdCBUZXN0U3RhdHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC1zdGF0c1wiKSk7XG5jb25zdCBQcmFjdGlzZVdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3ByYWN0aXNlLXdvcmRzXCIpKTtcbmNvbnN0IFNoaWZ0VHJhY2tlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9zaGlmdC10cmFja2VyXCIpKTtcbmNvbnN0IEZvY3VzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2ZvY3VzXCIpKTtcbmNvbnN0IEZ1bmJveCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9mdW5ib3hcIikpO1xuY29uc3QgS2V5bWFwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9rZXltYXBcIikpO1xuY29uc3QgVGhlbWVDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy90aGVtZS1jb250cm9sbGVyXCIpKTtcbmNvbnN0IFBhY2VDYXJldCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9wYWNlLWNhcmV0XCIpKTtcbmNvbnN0IENhcmV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2NhcmV0XCIpKTtcbmNvbnN0IExpdmVXcG0gPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbGl2ZS13cG1cIikpO1xuY29uc3QgTGl2ZUFjYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9saXZlLWFjY1wiKSk7XG5jb25zdCBMaXZlQnVyc3QgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbGl2ZS1idXJzdFwiKSk7XG5jb25zdCBUaW1lclByb2dyZXNzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3RpbWVyLXByb2dyZXNzXCIpKTtcbmNvbnN0IFF1b3RlU2VhcmNoUG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BvcHVwcy9xdW90ZS1zZWFyY2gtcG9wdXBcIikpO1xuY29uc3QgUXVvdGVTdWJtaXRQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcG9wdXBzL3F1b3RlLXN1Ym1pdC1wb3B1cFwiKSk7XG5jb25zdCBQYkNyb3duID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3BiLWNyb3duXCIpKTtcbmNvbnN0IFRlc3RUaW1lciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXRpbWVyXCIpKTtcbmNvbnN0IE91dE9mRm9jdXMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vb3V0LW9mLWZvY3VzXCIpKTtcbmNvbnN0IEFjY291bnRCdXR0b24gPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2FjY291bnQtYnV0dG9uXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBSZXBsYXkgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vcmVwbGF5XCIpKTtcbmNvbnN0IFBvZXRyeSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9wb2V0cnlcIikpO1xuY29uc3QgV2lraXBlZGlhID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3dpa2lwZWRpYVwiKSk7XG5jb25zdCBUb2RheVRyYWNrZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdG9kYXktdHJhY2tlclwiKSk7XG5jb25zdCBXZWFrU3BvdCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi93ZWFrLXNwb3RcIikpO1xuY29uc3QgV29yZHNldCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi93b3Jkc2V0XCIpKTtcbmNvbnN0IENoYWxsZW5nZUNvbnRvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvY2hhbGxlbmdlLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgUXVvdGVSYXRlUG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BvcHVwcy9xdW90ZS1yYXRlLXBvcHVwXCIpKTtcbmNvbnN0IEJyaXRpc2hFbmdsaXNoID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2JyaXRpc2gtZW5nbGlzaFwiKSk7XG5jb25zdCBMYXp5TW9kZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9sYXp5LW1vZGVcIikpO1xuY29uc3QgUmVzdWx0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Jlc3VsdFwiKSk7XG5jb25zdCBNb25rZXlQb3dlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbW9ua2V5LXBvd2VyXCIpKTtcbmNvbnN0IEFjdGl2ZVBhZ2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9hY3RpdmUtcGFnZVwiKSk7XG5jb25zdCBUZXN0QWN0aXZlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvdGVzdC1hY3RpdmVcIikpO1xuY29uc3QgVGVzdElucHV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QtaW5wdXRcIikpO1xuY29uc3QgVGVzdFdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtd29yZHNcIikpO1xuY29uc3QgVGVzdFN0YXRlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtc3RhdGVcIikpO1xuY29uc3QgTW9kZXNOb3RpY2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL21vZGVzLW5vdGljZVwiKSk7XG5jb25zdCBQYWdlVHJhbnNpdGlvbiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3BhZ2UtdHJhbnNpdGlvblwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmNvbnN0IFRpbWVyRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL3RpbWVyLWV2ZW50XCIpKTtcbmNvbnN0IFJlc2V0UmVxdWVzdGVkRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL3Jlc2V0LXJlcXVlc3RlZC1ldmVudFwiKSk7XG5jb25zdCBMYXN0MTBBdmVyYWdlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sYXN0LTEwLWF2ZXJhZ2VcIikpO1xuY29uc3QgTW9ua2V5ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL21vbmtleVwiKSk7XG5jb25zdCB0YmRfbW9kZV8xID0gcmVxdWlyZShcIi4vdGJkLW1vZGVcIik7XG5jb25zdCBvYmplY3RfaGFzaF8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJvYmplY3QtaGFzaFwiKSk7XG5jb25zdCBBbmFseXRpY3NDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9hbmFseXRpY3MtY29udHJvbGxlclwiKSk7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xubGV0IGZhaWxSZWFzb24gPSBcIlwiO1xuZXhwb3J0cy5ub3RTaWduZWRJbkxhc3RSZXN1bHQgPSBudWxsO1xuZnVuY3Rpb24gY2xlYXJOb3RTaWduZWRJblJlc3VsdCgpIHtcbiAgICBleHBvcnRzLm5vdFNpZ25lZEluTGFzdFJlc3VsdCA9IG51bGw7XG59XG5leHBvcnRzLmNsZWFyTm90U2lnbmVkSW5SZXN1bHQgPSBjbGVhck5vdFNpZ25lZEluUmVzdWx0O1xuZnVuY3Rpb24gc2V0Tm90U2lnbmVkSW5VaWQodWlkKSB7XG4gICAgaWYgKGV4cG9ydHMubm90U2lnbmVkSW5MYXN0UmVzdWx0ID09PSBudWxsKVxuICAgICAgICByZXR1cm47XG4gICAgZXhwb3J0cy5ub3RTaWduZWRJbkxhc3RSZXN1bHQudWlkID0gdWlkO1xuICAgIGRlbGV0ZSBleHBvcnRzLm5vdFNpZ25lZEluTGFzdFJlc3VsdC5oYXNoO1xuICAgIGV4cG9ydHMubm90U2lnbmVkSW5MYXN0UmVzdWx0Lmhhc2ggPSAoMCwgb2JqZWN0X2hhc2hfMS5kZWZhdWx0KShleHBvcnRzLm5vdFNpZ25lZEluTGFzdFJlc3VsdCk7XG59XG5leHBvcnRzLnNldE5vdFNpZ25lZEluVWlkID0gc2V0Tm90U2lnbmVkSW5VaWQ7XG5sZXQgc3BhbmlzaFNlbnRlbmNlVHJhY2tlciA9IFwiXCI7XG5mdW5jdGlvbiBwdW5jdHVhdGVXb3JkKHByZXZpb3VzV29yZCwgY3VycmVudFdvcmQsIGluZGV4LCBtYXhpbmRleCkge1xuICAgIGxldCB3b3JkID0gY3VycmVudFdvcmQ7XG4gICAgY29uc3QgY3VycmVudExhbmd1YWdlID0gY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZS5zcGxpdChcIl9cIilbMF07XG4gICAgY29uc3QgbGFzdENoYXIgPSBNaXNjLmdldExhc3RDaGFyKHByZXZpb3VzV29yZCk7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcIjU4MDA4XCIpIHtcbiAgICAgICAgaWYgKGN1cnJlbnRXb3JkLmxlbmd0aCA+IDMpIHtcbiAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC43NSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNwZWNpYWwgPSBbXCIvXCIsIFwiKlwiLCBcIi1cIiwgXCIrXCJdW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDQpXTtcbiAgICAgICAgICAgICAgICB3b3JkID0gTWlzYy5zZXRDaGFyQXQod29yZCwgTWF0aC5mbG9vcih3b3JkLmxlbmd0aCAvIDIpLCBzcGVjaWFsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKChpbmRleCA9PSAwIHx8IGxhc3RDaGFyID09IFwiLlwiIHx8IGxhc3RDaGFyID09IFwiP1wiIHx8IGxhc3RDaGFyID09IFwiIVwiKSAmJlxuICAgICAgICAgICAgY3VycmVudExhbmd1YWdlICE9IFwiY29kZVwiKSB7XG4gICAgICAgICAgICAvL2Fsd2F5cyBjYXBpdGFsaXNlIHRoZSBmaXJzdCB3b3JkIG9yIGlmIHRoZXJlIHdhcyBhIGRvdCB1bmxlc3MgdXNpbmcgYSBjb2RlIGFscGhhYmV0XG4gICAgICAgICAgICB3b3JkID0gTWlzYy5jYXBpdGFsaXplRmlyc3RMZXR0ZXJPZkVhY2hXb3JkKHdvcmQpO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcInNwYW5pc2hcIiB8fCBjdXJyZW50TGFuZ3VhZ2UgPT0gXCJjYXRhbGFuXCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByYW5kID0gTWF0aC5yYW5kb20oKTtcbiAgICAgICAgICAgICAgICBpZiAocmFuZCA+IDAuOSkge1xuICAgICAgICAgICAgICAgICAgICB3b3JkID0gXCLCv1wiICsgd29yZDtcbiAgICAgICAgICAgICAgICAgICAgc3BhbmlzaFNlbnRlbmNlVHJhY2tlciA9IFwiP1wiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyYW5kID4gMC44KSB7XG4gICAgICAgICAgICAgICAgICAgIHdvcmQgPSBcIsKhXCIgKyB3b3JkO1xuICAgICAgICAgICAgICAgICAgICBzcGFuaXNoU2VudGVuY2VUcmFja2VyID0gXCIhXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKChNYXRoLnJhbmRvbSgpIDwgMC4xICYmXG4gICAgICAgICAgICBsYXN0Q2hhciAhPSBcIi5cIiAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCIsXCIgJiZcbiAgICAgICAgICAgIGluZGV4ICE9IG1heGluZGV4IC0gMikgfHxcbiAgICAgICAgICAgIGluZGV4ID09IG1heGluZGV4IC0gMSkge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcInNwYW5pc2hcIiB8fCBjdXJyZW50TGFuZ3VhZ2UgPT0gXCJjYXRhbGFuXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3BhbmlzaFNlbnRlbmNlVHJhY2tlciA9PSBcIj9cIiB8fCBzcGFuaXNoU2VudGVuY2VUcmFja2VyID09IFwiIVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHdvcmQgKz0gc3BhbmlzaFNlbnRlbmNlVHJhY2tlcjtcbiAgICAgICAgICAgICAgICAgICAgc3BhbmlzaFNlbnRlbmNlVHJhY2tlciA9IFwiXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmFuZCA9IE1hdGgucmFuZG9tKCk7XG4gICAgICAgICAgICAgICAgaWYgKHJhbmQgPD0gMC44KSB7XG4gICAgICAgICAgICAgICAgICAgIHdvcmQgKz0gXCIuXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJhbmQgPiAwLjggJiYgcmFuZCA8IDAuOSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudExhbmd1YWdlID09IFwiZnJlbmNoXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmQgPSBcIj9cIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50TGFuZ3VhZ2UgPT0gXCJhcmFiaWNcIiB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExhbmd1YWdlID09IFwicGVyc2lhblwiIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGFuZ3VhZ2UgPT0gXCJ1cmR1XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmQgKz0gXCLYn1wiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcImdyZWVrXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmQgKz0gXCI7XCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JkICs9IFwiP1wiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudExhbmd1YWdlID09IFwiZnJlbmNoXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmQgPSBcIiFcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmQgKz0gXCIhXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoTWF0aC5yYW5kb20oKSA8IDAuMDEgJiZcbiAgICAgICAgICAgIGxhc3RDaGFyICE9IFwiLFwiICYmXG4gICAgICAgICAgICBsYXN0Q2hhciAhPSBcIi5cIiAmJlxuICAgICAgICAgICAgY3VycmVudExhbmd1YWdlICE9PSBcInJ1c3NpYW5cIikge1xuICAgICAgICAgICAgd29yZCA9IGBcIiR7d29yZH1cImA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoTWF0aC5yYW5kb20oKSA8IDAuMDExICYmXG4gICAgICAgICAgICBsYXN0Q2hhciAhPSBcIixcIiAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCIuXCIgJiZcbiAgICAgICAgICAgIGN1cnJlbnRMYW5ndWFnZSAhPT0gXCJydXNzaWFuXCIgJiZcbiAgICAgICAgICAgIGN1cnJlbnRMYW5ndWFnZSAhPT0gXCJ1a3JhaW5pYW5cIikge1xuICAgICAgICAgICAgd29yZCA9IGAnJHt3b3JkfSdgO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjAxMiAmJiBsYXN0Q2hhciAhPSBcIixcIiAmJiBsYXN0Q2hhciAhPSBcIi5cIikge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcImNvZGVcIikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBNYXRoLnJhbmRvbSgpO1xuICAgICAgICAgICAgICAgIGlmIChyIDwgMC4yNSkge1xuICAgICAgICAgICAgICAgICAgICB3b3JkID0gYCgke3dvcmR9KWA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHIgPCAwLjUpIHtcbiAgICAgICAgICAgICAgICAgICAgd29yZCA9IGB7JHt3b3JkfX1gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyIDwgMC43NSkge1xuICAgICAgICAgICAgICAgICAgICB3b3JkID0gYFske3dvcmR9XWA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB3b3JkID0gYDwke3dvcmR9PmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgd29yZCA9IGAoJHt3b3JkfSlgO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjAxMyAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCIsXCIgJiZcbiAgICAgICAgICAgIGxhc3RDaGFyICE9IFwiLlwiICYmXG4gICAgICAgICAgICBsYXN0Q2hhciAhPSBcIjtcIiAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCLYm1wiICYmXG4gICAgICAgICAgICBsYXN0Q2hhciAhPSBcIjpcIikge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcImZyZW5jaFwiKSB7XG4gICAgICAgICAgICAgICAgd29yZCA9IFwiOlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudExhbmd1YWdlID09IFwiZ3JlZWtcIikge1xuICAgICAgICAgICAgICAgIHdvcmQgPSBcIsK3XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB3b3JkICs9IFwiOlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjAxNCAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCIsXCIgJiZcbiAgICAgICAgICAgIGxhc3RDaGFyICE9IFwiLlwiICYmXG4gICAgICAgICAgICBwcmV2aW91c1dvcmQgIT0gXCItXCIpIHtcbiAgICAgICAgICAgIHdvcmQgPSBcIi1cIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChNYXRoLnJhbmRvbSgpIDwgMC4wMTUgJiZcbiAgICAgICAgICAgIGxhc3RDaGFyICE9IFwiLFwiICYmXG4gICAgICAgICAgICBsYXN0Q2hhciAhPSBcIi5cIiAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCI7XCIgJiZcbiAgICAgICAgICAgIGxhc3RDaGFyICE9IFwi2JtcIiAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCI6XCIpIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50TGFuZ3VhZ2UgPT0gXCJmcmVuY2hcIikge1xuICAgICAgICAgICAgICAgIHdvcmQgPSBcIjtcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcImdyZWVrXCIpIHtcbiAgICAgICAgICAgICAgICB3b3JkID0gXCLCt1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudExhbmd1YWdlID09IFwiYXJhYmljXCIpIHtcbiAgICAgICAgICAgICAgICB3b3JkICs9IFwi2JtcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHdvcmQgKz0gXCI7XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoTWF0aC5yYW5kb20oKSA8IDAuMiAmJiBsYXN0Q2hhciAhPSBcIixcIikge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcImFyYWJpY1wiIHx8XG4gICAgICAgICAgICAgICAgY3VycmVudExhbmd1YWdlID09IFwidXJkdVwiIHx8XG4gICAgICAgICAgICAgICAgY3VycmVudExhbmd1YWdlID09IFwicGVyc2lhblwiKSB7XG4gICAgICAgICAgICAgICAgd29yZCArPSBcItiMXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB3b3JkICs9IFwiLFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjI1ICYmIGN1cnJlbnRMYW5ndWFnZSA9PSBcImNvZGVcIikge1xuICAgICAgICAgICAgY29uc3Qgc3BlY2lhbHMgPSBbXCJ7XCIsIFwifVwiLCBcIltcIiwgXCJdXCIsIFwiKFwiLCBcIilcIiwgXCI7XCIsIFwiPVwiLCBcIitcIiwgXCIlXCIsIFwiL1wiXTtcbiAgICAgICAgICAgIHdvcmQgPSBNaXNjLnJhbmRvbUVsZW1lbnRGcm9tQXJyYXkoc3BlY2lhbHMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB3b3JkO1xufVxuZXhwb3J0cy5wdW5jdHVhdGVXb3JkID0gcHVuY3R1YXRlV29yZDtcbmZ1bmN0aW9uIHN0YXJ0VGVzdCgpIHtcbiAgICBpZiAoUGFnZVRyYW5zaXRpb24uZ2V0KCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoIVVwZGF0ZUNvbmZpZy5kYkNvbmZpZ0xvYWRlZCkge1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0Q2hhbmdlZEJlZm9yZURiKHRydWUpO1xuICAgIH1cbiAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyICE9PSBudWxsKSB7XG4gICAgICAgIEFuYWx5dGljc0NvbnRyb2xsZXIubG9nKFwidGVzdFN0YXJ0ZWRcIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBBbmFseXRpY3NDb250cm9sbGVyLmxvZyhcInRlc3RTdGFydGVkTm9Mb2dpblwiKTtcbiAgICB9XG4gICAgVGVzdEFjdGl2ZS5zZXQodHJ1ZSk7XG4gICAgUmVwbGF5LnN0YXJ0UmVwbGF5UmVjb3JkaW5nKCk7XG4gICAgUmVwbGF5LnJlcGxheUdldFdvcmRzTGlzdChUZXN0V29yZHMud29yZHMubGlzdCk7XG4gICAgVGVzdElucHV0LnJlc2V0S2V5cHJlc3NUaW1pbmdzKCk7XG4gICAgVGltZXJQcm9ncmVzcy5yZXN0YXJ0KCk7XG4gICAgVGltZXJQcm9ncmVzcy5zaG93KCk7XG4gICAgJChcIiNsaXZlV3BtXCIpLnRleHQoXCIwXCIpO1xuICAgIExpdmVXcG0uc2hvdygpO1xuICAgIExpdmVBY2Muc2hvdygpO1xuICAgIExpdmVCdXJzdC5zaG93KCk7XG4gICAgVGltZXJQcm9ncmVzcy51cGRhdGUoKTtcbiAgICBUZXN0VGltZXIuY2xlYXIoKTtcbiAgICBNb25rZXkuc2hvdygpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJtZW1vcnlcIikge1xuICAgICAgICBGdW5ib3gucmVzZXRNZW1vcnlUaW1lcigpO1xuICAgICAgICAkKFwiI3dvcmRzV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucGFjZUNhcmV0ICE9PSBcIm9mZlwiIHx8XG4gICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5yZXBlYXRlZFBhY2UgJiYgVGVzdFN0YXRlLmlzUGFjZVJlcGVhdCkpIHtcbiAgICAgICAgICAgIFBhY2VDYXJldC5zdGFydCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlKSB7IH1cbiAgICAvL3VzZSBhIHJlY3Vyc2l2ZSBzZWxmLWFkanVzdGluZyB0aW1lciB0byBhdm9pZCB0aW1lIGRyaWZ0XG4gICAgVGVzdFN0YXRzLnNldFN0YXJ0KHBlcmZvcm1hbmNlLm5vdygpKTtcbiAgICBUZXN0VGltZXIuc3RhcnQoKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc3RhcnRUZXN0ID0gc3RhcnRUZXN0O1xuZnVuY3Rpb24gcmVzdGFydCh3aXRoU2FtZVdvcmRzZXQgPSBmYWxzZSwgXywgLy8gdGhpcyBpcyBub3NhdmUgYW5kIHNob3VsZCBiZSByZW5hbWVkIHRvIG5vc2F2ZSB3aGVuIG5lZWRlZFxuZXZlbnQsIHByYWN0aXNlTWlzc2VkID0gZmFsc2UsIG5vQW5pbSA9IGZhbHNlKSB7XG4gICAgaWYgKFRlc3RVSS50ZXN0UmVzdGFydGluZyB8fCBUZXN0VUkucmVzdWx0Q2FsY3VsYXRpbmcpIHtcbiAgICAgICAgZXZlbnQgPT09IG51bGwgfHwgZXZlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT0gXCJ0ZXN0XCIgJiYgIVRlc3RVSS5yZXN1bHRWaXNpYmxlKSB7XG4gICAgICAgIGlmICghTWFudWFsUmVzdGFydC5nZXQoKSkge1xuICAgICAgICAgICAgaWYgKFRlc3RXb3Jkcy5oYXNUYWIpIHtcbiAgICAgICAgICAgICAgICBpZiAoIShldmVudCA9PT0gbnVsbCB8fCBldmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXZlbnQuc2hpZnRLZXkpKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9PSBcInplblwiKVxuICAgICAgICAgICAgICAgIGV2ZW50ID09PSBudWxsIHx8IGV2ZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgaWYgKCFNaXNjLmNhblF1aWNrUmVzdGFydChjb25maWdfMS5kZWZhdWx0Lm1vZGUsIGNvbmZpZ18xLmRlZmF1bHQud29yZHMsIGNvbmZpZ18xLmRlZmF1bHQudGltZSwgQ3VzdG9tVGV4dCkpIHtcbiAgICAgICAgICAgICAgICBsZXQgbWVzc2FnZSA9IFwiVXNlIHlvdXIgbW91c2UgdG8gY29uZmlybS5cIjtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5xdWlja1RhYikge1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gXCJQcmVzcyBzaGlmdCArIHRhYiBvciB1c2UgeW91ciBtb3VzZSB0byBjb25maXJtLlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlF1aWNrIHJlc3RhcnQgZGlzYWJsZWQuIFwiICsgbWVzc2FnZSwgMCwgMyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gfWVsc2V7XG4gICAgICAgICAgICAvLyAgIHJldHVybjtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoVGVzdEFjdGl2ZS5nZXQoKSkge1xuICAgICAgICBUZXN0SW5wdXQucHVzaEtleXByZXNzZXNUb0hpc3RvcnkoKTtcbiAgICAgICAgY29uc3QgdGVzdFNlY29uZHMgPSBUZXN0U3RhdHMuY2FsY3VsYXRlVGVzdFNlY29uZHMocGVyZm9ybWFuY2Uubm93KCkpO1xuICAgICAgICBjb25zdCBhZmtzZWNvbmRzID0gVGVzdFN0YXRzLmNhbGN1bGF0ZUFma1NlY29uZHModGVzdFNlY29uZHMpO1xuICAgICAgICAvLyBpbmNvbXBsZXRlVGVzdFNlY29uZHMgKz0gO1xuICAgICAgICBsZXQgdHQgPSB0ZXN0U2Vjb25kcyAtIGFma3NlY29uZHM7XG4gICAgICAgIGlmICh0dCA8IDApXG4gICAgICAgICAgICB0dCA9IDA7XG4gICAgICAgIGNvbnNvbGUubG9nKGBpbmNyZWFzaW5nIGluY29tcGxldGUgdGltZSBieSAke3R0fXMgKCR7dGVzdFNlY29uZHN9cyAtICR7YWZrc2Vjb25kc31zIGFmaylgKTtcbiAgICAgICAgVGVzdFN0YXRzLmluY3JlbWVudEluY29tcGxldGVTZWNvbmRzKHR0KTtcbiAgICAgICAgVGVzdFN0YXRzLmluY3JlbWVudFJlc3RhcnRDb3VudCgpO1xuICAgICAgICBpZiAodHQgPiA2MDApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGBZb3VyIHRpbWUgdHlwaW5nIGp1c3QgaW5jcmVhc2VkIGJ5ICR7TWlzYy5yb3VuZFRvMih0dCAvIDYwKX0gbWludXRlcy4gSWYgeW91IHRoaW5rIHRoaXMgaXMgaW5jb3JyZWN0IHBsZWFzZSBjb250YWN0IE1pb2RlYyBhbmQgZG9udCByZWZyZXNoIHRoZSB3ZWJzaXRlLmAsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICAvLyByZXN0YXJ0Q291bnQrKztcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiKSB7XG4gICAgICAgICQoXCIjd29yZHNcIikuZW1wdHkoKTtcbiAgICB9XG4gICAgaWYgKFByYWN0aXNlV29yZHMuYmVmb3JlLm1vZGUgIT09IG51bGwgJiZcbiAgICAgICAgIXdpdGhTYW1lV29yZHNldCAmJlxuICAgICAgICAhcHJhY3Rpc2VNaXNzZWQpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJSZXZlcnRpbmcgdG8gcHJldmlvdXMgc2V0dGluZ3MuXCIsIDApO1xuICAgICAgICBpZiAoUHJhY3Rpc2VXb3Jkcy5iZWZvcmUucHVuY3R1YXRpb24gIT09IG51bGwpIHtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQdW5jdHVhdGlvbihQcmFjdGlzZVdvcmRzLmJlZm9yZS5wdW5jdHVhdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFByYWN0aXNlV29yZHMuYmVmb3JlLm51bWJlcnMgIT09IG51bGwpIHtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXROdW1iZXJzKFByYWN0aXNlV29yZHMuYmVmb3JlLm51bWJlcnMpO1xuICAgICAgICB9XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFByYWN0aXNlV29yZHMuYmVmb3JlLm1vZGUpO1xuICAgICAgICBQcmFjdGlzZVdvcmRzLnJlc2V0QmVmb3JlKCk7XG4gICAgfVxuICAgIGxldCByZXBlYXRXaXRoUGFjZSA9IGZhbHNlO1xuICAgIGlmIChUZXN0VUkucmVzdWx0VmlzaWJsZSAmJiBjb25maWdfMS5kZWZhdWx0LnJlcGVhdGVkUGFjZSAmJiB3aXRoU2FtZVdvcmRzZXQpIHtcbiAgICAgICAgcmVwZWF0V2l0aFBhY2UgPSB0cnVlO1xuICAgIH1cbiAgICBNYW51YWxSZXN0YXJ0LnJlc2V0KCk7XG4gICAgVGVzdFRpbWVyLmNsZWFyKCk7XG4gICAgVGVzdFN0YXRzLnJlc3RhcnQoKTtcbiAgICBUZXN0SW5wdXQucmVzdGFydCgpO1xuICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQucmVzZXQoKTtcbiAgICBTaGlmdFRyYWNrZXIucmVzZXQoKTtcbiAgICBDYXJldC5oaWRlKCk7XG4gICAgVGVzdEFjdGl2ZS5zZXQoZmFsc2UpO1xuICAgIFJlcGxheS5zdG9wUmVwbGF5UmVjb3JkaW5nKCk7XG4gICAgTGl2ZVdwbS5oaWRlKCk7XG4gICAgTGl2ZUFjYy5oaWRlKCk7XG4gICAgTGl2ZUJ1cnN0LmhpZGUoKTtcbiAgICBUaW1lclByb2dyZXNzLmhpZGUoKTtcbiAgICBSZXBsYXkucGF1c2VSZXBsYXkoKTtcbiAgICBUZXN0SW5wdXQuc2V0QmFpbG91dChmYWxzZSk7XG4gICAgUGFjZUNhcmV0LnJlc2V0KCk7XG4gICAgTW9ua2V5LmhpZGUoKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zaG93QXZlcmFnZSlcbiAgICAgICAgTGFzdDEwQXZlcmFnZS51cGRhdGUoKTtcbiAgICAkKFwiI3Nob3dXb3JkSGlzdG9yeUJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImxvYWRlZFwiKTtcbiAgICAkKFwiI3Jlc3RhcnRUZXN0QnV0dG9uXCIpLmJsdXIoKTtcbiAgICBGdW5ib3gucmVzZXRNZW1vcnlUaW1lcigpO1xuICAgIFF1b3RlUmF0ZVBvcHVwLmNsZWFyUXVvdGVTdGF0cygpO1xuICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09IFwidGVzdFwiICYmIHdpbmRvdy5zY3JvbGxZID4gMCkge1xuICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oeyB0b3A6IDAsIGJlaGF2aW9yOiBcInNtb290aFwiIH0pO1xuICAgIH1cbiAgICAkKFwiI3dvcmRzSW5wdXRcIikudmFsKFwiIFwiKTtcbiAgICBUZXN0VUkucmVzZXQoKTtcbiAgICAkKFwiI3RpbWVyTnVtYmVyXCIpLmNzcyhcIm9wYWNpdHlcIiwgMCk7XG4gICAgbGV0IGVsID0gbnVsbDtcbiAgICBpZiAoVGVzdFVJLnJlc3VsdFZpc2libGUpIHtcbiAgICAgICAgLy9yZXN1bHRzIGFyZSBiZWluZyBkaXNwbGF5ZWRcbiAgICAgICAgZWwgPSAkKFwiI3Jlc3VsdFwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vd29yZHMgYXJlIGJlaW5nIGRpc3BsYXllZFxuICAgICAgICBlbCA9ICQoXCIjdHlwaW5nVGVzdFwiKTtcbiAgICB9XG4gICAgaWYgKFRlc3RVSS5yZXN1bHRWaXNpYmxlKSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnJhbmRvbVRoZW1lICE9PSBcIm9mZlwiICYmXG4gICAgICAgICAgICAhUGFnZVRyYW5zaXRpb24uZ2V0KClcbiAgICAgICAgLy8gJiYgQ29uZmlnLmN1c3RvbVRoZW1lSWQgPT09IFwiXCJcbiAgICAgICAgKSB7XG4gICAgICAgICAgICBUaGVtZUNvbnRyb2xsZXIucmFuZG9taXplVGhlbWUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBUZXN0VUkuc2V0UmVzdWx0VmlzaWJsZShmYWxzZSk7XG4gICAgUGFnZVRyYW5zaXRpb24uc2V0KHRydWUpO1xuICAgIFRlc3RVSS5zZXRUZXN0UmVzdGFydGluZyh0cnVlKTtcbiAgICBlbC5zdG9wKHRydWUsIHRydWUpLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiAwLFxuICAgIH0sIG5vQW5pbSA/IDAgOiAxMjUsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT0gXCJ0ZXN0XCIpXG4gICAgICAgICAgICBGb2N1cy5zZXQoZmFsc2UpO1xuICAgICAgICBUZXN0VUkuZm9jdXNXb3JkcygpO1xuICAgICAgICAkKFwiI21vbmtleSAuZmFzdFwiKS5zdG9wKHRydWUsIHRydWUpLmNzcyhcIm9wYWNpdHlcIiwgMCk7XG4gICAgICAgICQoXCIjbW9ua2V5XCIpLnN0b3AodHJ1ZSwgdHJ1ZSkuY3NzKHsgYW5pbWF0aW9uRHVyYXRpb246IFwiMHNcIiB9KTtcbiAgICAgICAgJChcIiN0eXBpbmdUZXN0XCIpLmNzcyhcIm9wYWNpdHlcIiwgMCkucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjd29yZHNJbnB1dFwiKS52YWwoXCIgXCIpO1xuICAgICAgICBsZXQgc2hvdWxkUXVvdGVSZXBlYXQgPSBmYWxzZTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiICYmXG4gICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0LnJlcGVhdFF1b3RlcyA9PT0gXCJ0eXBpbmdcIiAmJlxuICAgICAgICAgICAgZmFpbFJlYXNvbiAhPT0gXCJcIikge1xuICAgICAgICAgICAgc2hvdWxkUXVvdGVSZXBlYXQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHlpZWxkIEZ1bmJveC5yZW1lbWJlclNldHRpbmdzKCk7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFB1bmN0dWF0aW9uKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXROdW1iZXJzKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCI1ODAwOFwiKSB7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TnVtYmVycyhmYWxzZSwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwic3BlY2lhbHNcIikge1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFB1bmN0dWF0aW9uKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXROdW1iZXJzKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhc2NpaVwiKSB7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UHVuY3R1YXRpb24oZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE51bWJlcnMoZmFsc2UsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh3aXRoU2FtZVdvcmRzZXQgJiZcbiAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJwbHVzX29uZVwiIHx8IGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcInBsdXNfdHdvXCIpKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlNvcnJ5LCB0aGlzIGZ1bmJveCB3b24ndCB3b3JrIHdpdGggcmVwZWF0ZWQgdGVzdHMuXCIsIDAsIDQpO1xuICAgICAgICAgICAgd2l0aFNhbWVXb3Jkc2V0ID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF3aXRoU2FtZVdvcmRzZXQgJiYgIXNob3VsZFF1b3RlUmVwZWF0KSB7XG4gICAgICAgICAgICBUZXN0U3RhdGUuc2V0UmVwZWF0ZWQoZmFsc2UpO1xuICAgICAgICAgICAgVGVzdFN0YXRlLnNldFBhY2VSZXBlYXQocmVwZWF0V2l0aFBhY2UpO1xuICAgICAgICAgICAgVGVzdFdvcmRzLnNldEhhc1RhYihmYWxzZSk7XG4gICAgICAgICAgICB5aWVsZCBpbml0KCk7XG4gICAgICAgICAgICB5aWVsZCBQYWNlQ2FyZXQuaW5pdCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgVGVzdFN0YXRlLnNldFJlcGVhdGVkKHRydWUpO1xuICAgICAgICAgICAgVGVzdFN0YXRlLnNldFBhY2VSZXBlYXQocmVwZWF0V2l0aFBhY2UpO1xuICAgICAgICAgICAgVGVzdEFjdGl2ZS5zZXQoZmFsc2UpO1xuICAgICAgICAgICAgUmVwbGF5LnN0b3BSZXBsYXlSZWNvcmRpbmcoKTtcbiAgICAgICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5yZXNldEN1cnJlbnRJbmRleCgpO1xuICAgICAgICAgICAgVGVzdElucHV0LmlucHV0LnJlc2V0KCk7XG4gICAgICAgICAgICBUZXN0VUkuc2hvd1dvcmRzKCk7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBNb2RlID09PSBcIm5leHRcIiAmJiBjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT09IFwiemVuXCIpIHtcbiAgICAgICAgICAgICAgICBLZXltYXAuaGlnaGxpZ2h0S2V5KFRlc3RXb3Jkcy53b3Jkc1xuICAgICAgICAgICAgICAgICAgICAuZ2V0Q3VycmVudCgpXG4gICAgICAgICAgICAgICAgICAgIC5zdWJzdHJpbmcoVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoLCBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGggKyAxKVxuICAgICAgICAgICAgICAgICAgICAudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgICAgICAudG9VcHBlckNhc2UoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBGdW5ib3gudG9nZ2xlU2NyaXB0KFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KCkpO1xuICAgICAgICAgICAgeWllbGQgUGFjZUNhcmV0LmluaXQoKTtcbiAgICAgICAgfVxuICAgICAgICBmYWlsUmVhc29uID0gXCJcIjtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgICAgICBUZXN0U3RhdGUuc2V0UmVwZWF0ZWQoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmtleW1hcE1vZGUgIT09IFwib2ZmXCIpIHtcbiAgICAgICAgICAgIEtleW1hcC5zaG93KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBLZXltYXAuaGlkZSgpO1xuICAgICAgICB9XG4gICAgICAgIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLndwbVwiKSkuaW5uZXJIVE1MID0gXCIwXCI7XG4gICAgICAgIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLmFjY1wiKSkuaW5uZXJIVE1MID0gXCIxMDAlXCI7XG4gICAgICAgIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLmJ1cnN0XCIpKS5pbm5lckhUTUwgPSBcIjBcIjtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNsaXZlV3BtXCIpLmlubmVySFRNTCA9IFwiMFwiO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xpdmVBY2NcIikuaW5uZXJIVE1MID0gXCIxMDAlXCI7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbGl2ZUJ1cnN0XCIpLmlubmVySFRNTCA9IFwiMFwiO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwibWVtb3J5XCIpIHtcbiAgICAgICAgICAgIEZ1bmJveC5zdGFydE1lbW9yeVRpbWVyKCk7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBNb2RlID09PSBcIm5leHRcIikge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBNb2RlKFwicmVhY3RcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbW9kZTIgPSBNaXNjLmdldE1vZGUyKGNvbmZpZ18xLmRlZmF1bHQsIFRlc3RXb3Jkcy5yYW5kb21RdW90ZSk7XG4gICAgICAgIGxldCBmYnRleHQgPSBcIlwiO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggIT09IFwibm9uZVwiKSB7XG4gICAgICAgICAgICBmYnRleHQgPSBcIiBcIiArIGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94O1xuICAgICAgICB9XG4gICAgICAgICQoXCIucGFnZVRlc3QgI3ByZW1pZFRlc3RNb2RlXCIpLnRleHQoYCR7Y29uZmlnXzEuZGVmYXVsdC5tb2RlfSAke21vZGUyfSAke2NvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UucmVwbGFjZSgvXy9nLCBcIiBcIil9JHtmYnRleHR9YCk7XG4gICAgICAgICQoXCIucGFnZVRlc3QgI3ByZW1pZFNlY29uZHNMZWZ0XCIpLnRleHQoY29uZmlnXzEuZGVmYXVsdC50aW1lKTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcImxheW91dGZsdWlkXCIpIHtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRMYXlvdXQoY29uZmlnXzEuZGVmYXVsdC5jdXN0b21MYXlvdXRmbHVpZFxuICAgICAgICAgICAgICAgID8gY29uZmlnXzEuZGVmYXVsdC5jdXN0b21MYXlvdXRmbHVpZC5zcGxpdChcIiNcIilbMF1cbiAgICAgICAgICAgICAgICA6IFwicXdlcnR5XCIsIHRydWUpO1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcExheW91dChjb25maWdfMS5kZWZhdWx0LmN1c3RvbUxheW91dGZsdWlkXG4gICAgICAgICAgICAgICAgPyBjb25maWdfMS5kZWZhdWx0LmN1c3RvbUxheW91dGZsdWlkLnNwbGl0KFwiI1wiKVswXVxuICAgICAgICAgICAgICAgIDogXCJxd2VydHlcIiwgdHJ1ZSk7XG4gICAgICAgICAgICBLZXltYXAuaGlnaGxpZ2h0S2V5KFRlc3RXb3Jkcy53b3Jkc1xuICAgICAgICAgICAgICAgIC5nZXRDdXJyZW50KClcbiAgICAgICAgICAgICAgICAuc3Vic3RyaW5nKFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCwgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoICsgMSlcbiAgICAgICAgICAgICAgICAudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgIC50b1VwcGVyQ2FzZSgpKTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiI3Jlc3VsdFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiN0ZXN0TW9kZXNOb3RpY2VcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIikuY3NzKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgIH0pO1xuICAgICAgICAvLyByZXNldFBhY2VDYXJldCgpO1xuICAgICAgICBNb2Rlc05vdGljZS51cGRhdGUoKTtcbiAgICAgICAgJChcIiN0eXBpbmdUZXN0XCIpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgfSwgbm9BbmltID8gMCA6IDEyNSwgKCkgPT4ge1xuICAgICAgICAgICAgVGVzdFVJLnNldFRlc3RSZXN0YXJ0aW5nKGZhbHNlKTtcbiAgICAgICAgICAgIC8vIHJlc2V0UGFjZUNhcmV0KCk7XG4gICAgICAgICAgICBQYkNyb3duLmhpZGUoKTtcbiAgICAgICAgICAgIFRlc3RUaW1lci5jbGVhcigpO1xuICAgICAgICAgICAgaWYgKCQoXCIjY29tbWFuZExpbmVXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICAgICAgICAgVGVzdFVJLmZvY3VzV29yZHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIENoYXJ0Q29udHJvbGxlci5yZXN1bHQudXBkYXRlKCk7XG4gICAgICAgICAgICBQYWdlVHJhbnNpdGlvbi5zZXQoZmFsc2UpO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coVGVzdFN0YXRzLmluY29tcGxldGVTZWNvbmRzKTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFRlc3RTdGF0cy5yZXN0YXJ0Q291bnQpO1xuICAgICAgICB9KTtcbiAgICB9KSk7XG59XG5leHBvcnRzLnJlc3RhcnQgPSByZXN0YXJ0O1xuZnVuY3Rpb24gYXBwbHlGdW5ib3hlc1RvV29yZCh3b3JkLCB3b3Jkc2V0KSB7XG4gICAgdmFyIF9hO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJyQW5Eb01jQXNFXCIpIHtcbiAgICAgICAgbGV0IHJhbmRvbWNhc2V3b3JkID0gXCJcIjtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoaSAlIDIgIT0gMCkge1xuICAgICAgICAgICAgICAgIHJhbmRvbWNhc2V3b3JkICs9IHdvcmRbaV0udG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJhbmRvbWNhc2V3b3JkICs9IHdvcmRbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgd29yZCA9IHJhbmRvbWNhc2V3b3JkO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJjYXBpdGFsc1wiKSB7XG4gICAgICAgIHdvcmQgPSBNaXNjLmNhcGl0YWxpemVGaXJzdExldHRlck9mRWFjaFdvcmQod29yZCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcImdpYmJlcmlzaFwiKSB7XG4gICAgICAgIHdvcmQgPSBNaXNjLmdldEdpYmJlcmlzaCgpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICB3b3JkID0gTWlzYy5nZXRBcnJvd3MoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwiNTgwMDhcIikge1xuICAgICAgICB3b3JkID0gTWlzYy5nZXROdW1iZXJzKDcpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJzcGVjaWFsc1wiKSB7XG4gICAgICAgIHdvcmQgPSBNaXNjLmdldFNwZWNpYWxzKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcImFzY2lpXCIpIHtcbiAgICAgICAgd29yZCA9IE1pc2MuZ2V0QVNDSUkoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAod29yZHNldCAhPT0gdW5kZWZpbmVkICYmIGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcIndlYWtzcG90XCIpIHtcbiAgICAgICAgd29yZCA9IFdlYWtTcG90LmdldFdvcmQod29yZHNldCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHdvcmRzZXQgIT09IHVuZGVmaW5lZCAmJiBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJ0YmRtb2RlXCIpIHtcbiAgICAgICAgd29yZCA9ICgoX2EgPSAoMCwgdGJkX21vZGVfMS5nZXRUYmRNb2RlKSgpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZ2V0V29yZCh3b3Jkc2V0KSkgfHwgd29yZDtcbiAgICB9XG4gICAgcmV0dXJuIHdvcmQ7XG59XG5mdW5jdGlvbiBhcHBseUJyaXRpc2hFbmdsaXNoVG9Xb3JkKHdvcmQpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5icml0aXNoRW5nbGlzaCAmJiAvZW5nbGlzaC8udGVzdChjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKSkge1xuICAgICAgICAgICAgd29yZCA9IHlpZWxkIEJyaXRpc2hFbmdsaXNoLnJlcGxhY2Uod29yZCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHdvcmQ7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBhcHBseUxhenlNb2RlVG9Xb3JkKHdvcmQsIGxhbmd1YWdlKSB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubGF6eU1vZGUgPT09IHRydWUgJiYgIWxhbmd1YWdlLm5vTGF6eU1vZGUpIHtcbiAgICAgICAgd29yZCA9IExhenlNb2RlLnJlcGxhY2VBY2NlbnRzKHdvcmQsIGxhbmd1YWdlLmFjY2VudHMpO1xuICAgIH1cbiAgICByZXR1cm4gd29yZDtcbn1cbmZ1bmN0aW9uIGdldE5leHRXb3JkKHdvcmRzZXQsIGxhbmd1YWdlLCB3b3Jkc0JvdW5kKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBsZXQgcmFuZG9tV29yZCA9IHdvcmRzZXQucmFuZG9tV29yZCgpO1xuICAgICAgICBjb25zdCBwcmV2aW91c1dvcmQgPSBUZXN0V29yZHMud29yZHMuZ2V0KFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGggLSAxLCB0cnVlKTtcbiAgICAgICAgY29uc3QgcHJldmlvdXNXb3JkMiA9IFRlc3RXb3Jkcy53b3Jkcy5nZXQoVGVzdFdvcmRzLndvcmRzLmxlbmd0aCAtIDIsIHRydWUpO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInF1b3RlXCIpIHtcbiAgICAgICAgICAgIHJhbmRvbVdvcmQgPVxuICAgICAgICAgICAgICAgIChfYiA9IChfYSA9IFRlc3RXb3Jkcy5yYW5kb21RdW90ZS50ZXh0U3BsaXQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVtUZXN0V29yZHMud29yZHMubGVuZ3RoXSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogXCJcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgIUN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmXG4gICAgICAgICAgICAhQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20pIHtcbiAgICAgICAgICAgIHJhbmRvbVdvcmQgPSBDdXN0b21UZXh0LnRleHRbVGVzdFdvcmRzLndvcmRzLmxlbmd0aF07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgIChDdXN0b21UZXh0LmlzV29yZFJhbmRvbSB8fCBDdXN0b21UZXh0LmlzVGltZVJhbmRvbSkgJiZcbiAgICAgICAgICAgICh3b3Jkc2V0Lmxlbmd0aCA8IDQgfHwgUHJhY3Rpc2VXb3Jkcy5iZWZvcmUubW9kZSAhPT0gbnVsbCkpIHtcbiAgICAgICAgICAgIHJhbmRvbVdvcmQgPSB3b3Jkc2V0LnJhbmRvbVdvcmQoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGxldCByZWdlbmFyYXRpb25Db3VudCA9IDA7IC8vaW5maW5pdGUgbG9vcCBlbWVyZ2VuY3kgc3RvcCBidXR0b25cbiAgICAgICAgICAgIHdoaWxlIChyZWdlbmFyYXRpb25Db3VudCA8IDEwMCAmJlxuICAgICAgICAgICAgICAgIChwcmV2aW91c1dvcmQgPT0gcmFuZG9tV29yZCB8fFxuICAgICAgICAgICAgICAgICAgICBwcmV2aW91c1dvcmQyID09IHJhbmRvbVdvcmQgfHxcbiAgICAgICAgICAgICAgICAgICAgKCFjb25maWdfMS5kZWZhdWx0LnB1bmN0dWF0aW9uICYmIHJhbmRvbVdvcmQgPT0gXCJJXCIpKSkge1xuICAgICAgICAgICAgICAgIHJlZ2VuYXJhdGlvbkNvdW50Kys7XG4gICAgICAgICAgICAgICAgcmFuZG9tV29yZCA9IHdvcmRzZXQucmFuZG9tV29yZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChyYW5kb21Xb3JkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJhbmRvbVdvcmQgPSB3b3Jkc2V0LnJhbmRvbVdvcmQoKTtcbiAgICAgICAgfVxuICAgICAgICByYW5kb21Xb3JkID0gcmFuZG9tV29yZC5yZXBsYWNlKC8gKy9nbSwgXCIgXCIpO1xuICAgICAgICByYW5kb21Xb3JkID0gcmFuZG9tV29yZC5yZXBsYWNlKC9eIHwgJC9nbSwgXCJcIik7XG4gICAgICAgIHJhbmRvbVdvcmQgPSBhcHBseUxhenlNb2RlVG9Xb3JkKHJhbmRvbVdvcmQsIGxhbmd1YWdlKTtcbiAgICAgICAgcmFuZG9tV29yZCA9IHlpZWxkIGFwcGx5QnJpdGlzaEVuZ2xpc2hUb1dvcmQocmFuZG9tV29yZCk7XG4gICAgICAgIHJhbmRvbVdvcmQgPSBhcHBseUZ1bmJveGVzVG9Xb3JkKHJhbmRvbVdvcmQsIHdvcmRzZXQpO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbikge1xuICAgICAgICAgICAgcmFuZG9tV29yZCA9IHB1bmN0dWF0ZVdvcmQoVGVzdFdvcmRzLndvcmRzLmdldChUZXN0V29yZHMud29yZHMubGVuZ3RoIC0gMSksIHJhbmRvbVdvcmQsIFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGgsIHdvcmRzQm91bmQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm51bWJlcnMpIHtcbiAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC4xKSB7XG4gICAgICAgICAgICAgICAgcmFuZG9tV29yZCA9IE1pc2MuZ2V0TnVtYmVycyg0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmFuZG9tV29yZDtcbiAgICB9KTtcbn1cbmxldCByZW1lbWJlckxhenlNb2RlO1xuZnVuY3Rpb24gaW5pdCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBUZXN0QWN0aXZlLnNldChmYWxzZSk7XG4gICAgICAgIE1vbmtleVBvd2VyLnJlc2V0KCk7XG4gICAgICAgIFJlcGxheS5zdG9wUmVwbGF5UmVjb3JkaW5nKCk7XG4gICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5yZXNldCgpO1xuICAgICAgICBUZXN0VUkuc2V0Q3VycmVudFdvcmRFbGVtZW50SW5kZXgoMCk7XG4gICAgICAgIC8vIGFjY3VyYWN5ID0ge1xuICAgICAgICAvLyAgIGNvcnJlY3Q6IDAsXG4gICAgICAgIC8vICAgaW5jb3JyZWN0OiAwLFxuICAgICAgICAvLyB9O1xuICAgICAgICBUZXN0SW5wdXQuaW5wdXQucmVzZXRIaXN0b3J5KCk7XG4gICAgICAgIFRlc3RJbnB1dC5pbnB1dC5yZXNldEN1cnJlbnQoKTtcbiAgICAgICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT0gXCJ0ZXN0XCIpIHtcbiAgICAgICAgICAgIHlpZWxkIEZ1bmJveC5hY3RpdmF0ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBsYW5ndWFnZSA9IHlpZWxkIE1pc2MuZ2V0TGFuZ3VhZ2UoY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSk7XG4gICAgICAgIGlmIChsYW5ndWFnZSAmJiBsYW5ndWFnZS5uYW1lICE9PSBjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKSB7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TGFuZ3VhZ2UoXCJlbmdsaXNoXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghbGFuZ3VhZ2UpIHtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRMYW5ndWFnZShcImVuZ2xpc2hcIik7XG4gICAgICAgICAgICBsYW5ndWFnZSA9IHlpZWxkIE1pc2MuZ2V0TGFuZ3VhZ2UoY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubGF6eU1vZGUgPT09IHRydWUgJiYgbGFuZ3VhZ2Uubm9MYXp5TW9kZSkge1xuICAgICAgICAgICAgcmVtZW1iZXJMYXp5TW9kZSA9IHRydWU7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlRoaXMgbGFuZ3VhZ2UgZG9lcyBub3Qgc3VwcG9ydCBsYXp5IG1vZGUuXCIsIDApO1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldExhenlNb2RlKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZW1lbWJlckxhenlNb2RlID09PSB0cnVlICYmICFsYW5ndWFnZS5ub0xhenlNb2RlKSB7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TGF6eU1vZGUodHJ1ZSwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubGF6eU1vZGUgPT09IGZhbHNlICYmICFsYW5ndWFnZS5ub0xhenlNb2RlKSB7XG4gICAgICAgICAgICByZW1lbWJlckxhenlNb2RlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHdvcmRzQm91bmQgPSAxMDA7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnNob3dBbGxMaW5lcykge1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgICAgICAgICAgd29yZHNCb3VuZCA9IDEwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICAgICAgICAgIGlmIChDdXN0b21UZXh0LmlzV29yZFJhbmRvbSkge1xuICAgICAgICAgICAgICAgICAgICB3b3Jkc0JvdW5kID0gQ3VzdG9tVGV4dC53b3JkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChDdXN0b21UZXh0LmlzVGltZVJhbmRvbSkge1xuICAgICAgICAgICAgICAgICAgICB3b3Jkc0JvdW5kID0gMTAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgd29yZHNCb3VuZCA9IEN1c3RvbVRleHQudGV4dC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9IFwidGltZVwiKSB7XG4gICAgICAgICAgICAgICAgd29yZHNCb3VuZCA9IGNvbmZpZ18xLmRlZmF1bHQud29yZHM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIgJiYgY29uZmlnXzEuZGVmYXVsdC53b3JkcyA8IHdvcmRzQm91bmQpIHtcbiAgICAgICAgICAgICAgICB3b3Jkc0JvdW5kID0gY29uZmlnXzEuZGVmYXVsdC53b3JkcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmXG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC53b3JkIDwgd29yZHNCb3VuZCkge1xuICAgICAgICAgICAgICAgIHdvcmRzQm91bmQgPSBDdXN0b21UZXh0LndvcmQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiY3VzdG9tXCIgJiYgQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20pIHtcbiAgICAgICAgICAgICAgICB3b3Jkc0JvdW5kID0gMTAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICAgICAgIUN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmXG4gICAgICAgICAgICAgICAgIUN1c3RvbVRleHQuaXNUaW1lUmFuZG9tICYmXG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC50ZXh0Lmxlbmd0aCA8IHdvcmRzQm91bmQpIHtcbiAgICAgICAgICAgICAgICB3b3Jkc0JvdW5kID0gQ3VzdG9tVGV4dC50ZXh0Lmxlbmd0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gJiZcbiAgICAgICAgICAgIEN1c3RvbVRleHQud29yZCA9PSAwKSB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQuaXNUaW1lUmFuZG9tICYmXG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC50aW1lID09IDApKSB7XG4gICAgICAgICAgICB3b3Jkc0JvdW5kID0gMTAwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIiAmJiBjb25maWdfMS5kZWZhdWx0LndvcmRzID09PSAwKSB7XG4gICAgICAgICAgICB3b3Jkc0JvdW5kID0gMTAwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJwbHVzX29uZVwiKSB7XG4gICAgICAgICAgICB3b3Jkc0JvdW5kID0gMjtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIiAmJiBjb25maWdfMS5kZWZhdWx0LndvcmRzIDwgd29yZHNCb3VuZCkge1xuICAgICAgICAgICAgICAgIHdvcmRzQm91bmQgPSBjb25maWdfMS5kZWZhdWx0LndvcmRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJwbHVzX3R3b1wiKSB7XG4gICAgICAgICAgICB3b3Jkc0JvdW5kID0gMztcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIiAmJiBjb25maWdfMS5kZWZhdWx0LndvcmRzIDwgd29yZHNCb3VuZCkge1xuICAgICAgICAgICAgICAgIHdvcmRzQm91bmQgPSBjb25maWdfMS5kZWZhdWx0LndvcmRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ0aW1lXCIgfHxcbiAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcIndvcmRzXCIgfHxcbiAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcImN1c3RvbVwiKSB7XG4gICAgICAgICAgICBsZXQgd29yZExpc3QgPSBsYW5ndWFnZS53b3JkcztcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJjdXN0b21cIikge1xuICAgICAgICAgICAgICAgIHdvcmRMaXN0ID0gQ3VzdG9tVGV4dC50ZXh0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgd29yZHNldCA9IFdvcmRzZXQud2l0aFdvcmRzKHdvcmRMaXN0LCBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCk7XG4gICAgICAgICAgICBpZiAoKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09IFwid2lraXBlZGlhXCIgfHwgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT0gXCJwb2V0cnlcIikgJiZcbiAgICAgICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT0gXCJjdXN0b21cIikge1xuICAgICAgICAgICAgICAgIGxldCB3b3JkQ291bnQgPSAwO1xuICAgICAgICAgICAgICAgIC8vIElmIG1vZGUgaXMgd29yZHMsIGdldCBhcyBtYW55IHNlY3Rpb25zIGFzIHlvdSBuZWVkIHVudGlsIHRoZSB3b3JkQ291bnQgaXMgZnVsbGZpbGxlZFxuICAgICAgICAgICAgICAgIHdoaWxlICgoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwid29yZHNcIiAmJiBjb25maWdfMS5kZWZhdWx0LndvcmRzID49IHdvcmRDb3VudCkgfHxcbiAgICAgICAgICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ0aW1lXCIgJiYgd29yZENvdW50IDwgMTAwKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWN0aW9uID0gY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT0gXCJ3aWtpcGVkaWFcIlxuICAgICAgICAgICAgICAgICAgICAgICAgPyB5aWVsZCBXaWtpcGVkaWEuZ2V0U2VjdGlvbihjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKVxuICAgICAgICAgICAgICAgICAgICAgICAgOiB5aWVsZCBQb2V0cnkuZ2V0UG9lbSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VjdGlvbiA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgd29yZCBvZiBzZWN0aW9uLndvcmRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAod29yZENvdW50ID49IGNvbmZpZ18xLmRlZmF1bHQud29yZHMgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwid29yZHNcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgd29yZENvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICBUZXN0V29yZHMud29yZHMucHVzaCh3b3JkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd29yZHNCb3VuZDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhbmRvbVdvcmQgPSB5aWVsZCBnZXROZXh0V29yZCh3b3Jkc2V0LCBsYW5ndWFnZSwgd29yZHNCb3VuZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICgvXFx0L2cudGVzdChyYW5kb21Xb3JkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgVGVzdFdvcmRzLnNldEhhc1RhYih0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoLyArLy50ZXN0KHJhbmRvbVdvcmQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByYW5kb21MaXN0ID0gcmFuZG9tV29yZC5zcGxpdChcIiBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgaWQgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGlkIDwgcmFuZG9tTGlzdC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXN0V29yZHMud29yZHMucHVzaChyYW5kb21MaXN0W2lkXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoVGVzdFdvcmRzLndvcmRzLmxlbmd0aCA9PSB3b3Jkc0JvdW5kICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEN1c3RvbVRleHQuaXNXb3JkUmFuZG9tKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICFDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICFDdXN0b21UZXh0LmlzVGltZVJhbmRvbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpID0gVGVzdFdvcmRzLndvcmRzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBUZXN0V29yZHMud29yZHMucHVzaChyYW5kb21Xb3JkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICAgICAgY29uc3QgcXVvdGVzQ29sbGVjdGlvbiA9IHlpZWxkIHF1b3Rlc19jb250cm9sbGVyXzEuZGVmYXVsdC5nZXRRdW90ZXMoY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSwgY29uZmlnXzEuZGVmYXVsdC5xdW90ZUxlbmd0aCk7XG4gICAgICAgICAgICBpZiAocXVvdGVzQ29sbGVjdGlvbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBUZXN0VUkuc2V0VGVzdFJlc3RhcnRpbmcoZmFsc2UpO1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGBObyAke2NvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UucmVwbGFjZSgvX1xcZCprJC9nLCBcIlwiKX0gcXVvdGVzIGZvdW5kYCwgMCk7XG4gICAgICAgICAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcikge1xuICAgICAgICAgICAgICAgICAgICBRdW90ZVN1Ym1pdFBvcHVwLnNob3coZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcIndvcmRzXCIpO1xuICAgICAgICAgICAgICAgIHJlc3RhcnQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgcnEgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5xdW90ZUxlbmd0aC5pbmNsdWRlcygtMikgJiYgY29uZmlnXzEuZGVmYXVsdC5xdW90ZUxlbmd0aC5sZW5ndGggPT0gMSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFF1b3RlID0gcXVvdGVzX2NvbnRyb2xsZXJfMS5kZWZhdWx0LmdldFF1b3RlQnlJZChRdW90ZVNlYXJjaFBvcHVwLnNlbGVjdGVkSWQpO1xuICAgICAgICAgICAgICAgIGlmICh0YXJnZXRRdW90ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJxID0gcXVvdGVzQ29sbGVjdGlvbi5ncm91cHNbMF1bMF07XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUXVvdGUgSWQgRG9lcyBOb3QgRXhpc3RcIiwgMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBycSA9IHRhcmdldFF1b3RlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJhbmRvbVF1b3RlID0gcXVvdGVzX2NvbnRyb2xsZXJfMS5kZWZhdWx0LmdldFJhbmRvbVF1b3RlKCk7XG4gICAgICAgICAgICAgICAgaWYgKHJhbmRvbVF1b3RlID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiTm8gcXVvdGVzIGZvdW5kIGZvciBzZWxlY3RlZCBxdW90ZSBsZW5ndGhcIiwgMCk7XG4gICAgICAgICAgICAgICAgICAgIFRlc3RVSS5zZXRUZXN0UmVzdGFydGluZyhmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcnEgPSByYW5kb21RdW90ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChycSA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIHJxLnRleHQgPSBycS50ZXh0LnJlcGxhY2UoLyArL2dtLCBcIiBcIik7XG4gICAgICAgICAgICBycS50ZXh0ID0gcnEudGV4dC5yZXBsYWNlKC9cXFxcXFxcXHQvZ20sIFwiXFx0XCIpO1xuICAgICAgICAgICAgcnEudGV4dCA9IHJxLnRleHQucmVwbGFjZSgvXFxcXFxcXFxuL2dtLCBcIlxcblwiKTtcbiAgICAgICAgICAgIHJxLnRleHQgPSBycS50ZXh0LnJlcGxhY2UoL1xcXFx0L2dtLCBcIlxcdFwiKTtcbiAgICAgICAgICAgIHJxLnRleHQgPSBycS50ZXh0LnJlcGxhY2UoL1xcXFxuL2dtLCBcIlxcblwiKTtcbiAgICAgICAgICAgIHJxLnRleHQgPSBycS50ZXh0LnJlcGxhY2UoLyggKihcXHJcXG58XFxyfFxcbikgKikvZywgXCJcXG4gXCIpO1xuICAgICAgICAgICAgcnEudGV4dCA9IHJxLnRleHQucmVwbGFjZSgv4oCmL2csIFwiLi4uXCIpO1xuICAgICAgICAgICAgcnEudGV4dCA9IHJxLnRleHQudHJpbSgpO1xuICAgICAgICAgICAgcnEudGV4dFNwbGl0ID0gcnEudGV4dC5zcGxpdChcIiBcIik7XG4gICAgICAgICAgICBycS5sYW5ndWFnZSA9IGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UucmVwbGFjZSgvX1xcZCprJC9nLCBcIlwiKTtcbiAgICAgICAgICAgIFRlc3RXb3Jkcy5zZXRSYW5kb21RdW90ZShycSk7XG4gICAgICAgICAgICBjb25zdCB3ID0gVGVzdFdvcmRzLnJhbmRvbVF1b3RlLnRleHRTcGxpdDtcbiAgICAgICAgICAgIGlmICh3ID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc2hvd0FsbExpbmVzKSB7XG4gICAgICAgICAgICAgICAgd29yZHNCb3VuZCA9IHcubGVuZ3RoO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgd29yZHNCb3VuZCA9IE1hdGgubWluKHdvcmRzQm91bmQsIHcubGVuZ3RoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd29yZHNCb3VuZDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKC9cXHQvZy50ZXN0KHdbaV0pKSB7XG4gICAgICAgICAgICAgICAgICAgIFRlc3RXb3Jkcy5zZXRIYXNUYWIodHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHdbaV0gPSBhcHBseUxhenlNb2RlVG9Xb3JkKHdbaV0sIGxhbmd1YWdlKTtcbiAgICAgICAgICAgICAgICB3W2ldID0geWllbGQgYXBwbHlCcml0aXNoRW5nbGlzaFRvV29yZCh3W2ldKTtcbiAgICAgICAgICAgICAgICB3W2ldID0gYXBwbHlGdW5ib3hlc1RvV29yZCh3W2ldKTtcbiAgICAgICAgICAgICAgICBUZXN0V29yZHMud29yZHMucHVzaCh3W2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvL2hhbmRsZSByaWdodC10by1sZWZ0IGxhbmd1YWdlc1xuICAgICAgICBpZiAobGFuZ3VhZ2UubGVmdFRvUmlnaHQpIHtcbiAgICAgICAgICAgIFRlc3RVSS5hcnJhbmdlQ2hhcmFjdGVyc0xlZnRUb1JpZ2h0KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBUZXN0VUkuYXJyYW5nZUNoYXJhY3RlcnNSaWdodFRvTGVmdCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsYW5ndWFnZS5saWdhdHVyZXMpIHtcbiAgICAgICAgICAgICQoXCIjd29yZHNcIikuYWRkQ2xhc3MoXCJ3aXRoTGlnYXR1cmVzXCIpO1xuICAgICAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLndvcmRzXCIpLmFkZENsYXNzKFwid2l0aExpZ2F0dXJlc1wiKTtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0UmVwbGF5IC53b3Jkc1wiKS5hZGRDbGFzcyhcIndpdGhMaWdhdHVyZXNcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiI3dvcmRzXCIpLnJlbW92ZUNsYXNzKFwid2l0aExpZ2F0dXJlc1wiKTtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0V29yZHNIaXN0b3J5IC53b3Jkc1wiKS5yZW1vdmVDbGFzcyhcIndpdGhMaWdhdHVyZXNcIik7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdFJlcGxheSAud29yZHNcIikucmVtb3ZlQ2xhc3MoXCJ3aXRoTGlnYXR1cmVzXCIpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGlmIChDb25maWcubW9kZSA9PSBcInplblwiKSB7XG4gICAgICAgIC8vICAgLy8gQ3JlYXRpbmcgYW4gZW1wdHkgYWN0aXZlIHdvcmQgZWxlbWVudCBmb3IgemVuIG1vZGVcbiAgICAgICAgLy8gICAkKFwiI3dvcmRzXCIpLmFwcGVuZCgnPGRpdiBjbGFzcz1cIndvcmQgYWN0aXZlXCI+PC9kaXY+Jyk7XG4gICAgICAgIC8vICAgJChcIiN3b3Jkc1wiKS5jc3MoXCJoZWlnaHRcIiwgXCJhdXRvXCIpO1xuICAgICAgICAvLyAgICQoXCIjd29yZHNXcmFwcGVyXCIpLmNzcyhcImhlaWdodFwiLCBcImF1dG9cIik7XG4gICAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAgIFRlc3RVSS5zaG93V29yZHMoKTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTW9kZSA9PT0gXCJuZXh0XCIgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9PSBcInplblwiKSB7XG4gICAgICAgICAgICBLZXltYXAuaGlnaGxpZ2h0S2V5KFRlc3RXb3Jkcy53b3Jkc1xuICAgICAgICAgICAgICAgIC5nZXRDdXJyZW50KClcbiAgICAgICAgICAgICAgICAuc3Vic3RyaW5nKFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCwgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoICsgMSlcbiAgICAgICAgICAgICAgICAudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgIC50b1VwcGVyQ2FzZSgpKTtcbiAgICAgICAgfVxuICAgICAgICBGdW5ib3gudG9nZ2xlU2NyaXB0KFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KCkpO1xuICAgICAgICAvLyB9XG4gICAgfSk7XG59XG5leHBvcnRzLmluaXQgPSBpbml0O1xuZnVuY3Rpb24gYWRkV29yZCgpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGxldCBib3VuZCA9IDEwMDtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcInBsdXNfb25lXCIpXG4gICAgICAgICAgICBib3VuZCA9IDE7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJwbHVzX3R3b1wiKVxuICAgICAgICAgICAgYm91bmQgPSAyO1xuICAgICAgICBpZiAoVGVzdFdvcmRzLndvcmRzLmxlbmd0aCAtIFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aCA+IGJvdW5kIHx8XG4gICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIgJiZcbiAgICAgICAgICAgICAgICBUZXN0V29yZHMud29yZHMubGVuZ3RoID49IGNvbmZpZ18xLmRlZmF1bHQud29yZHMgJiZcbiAgICAgICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0LndvcmRzID4gMCkgfHxcbiAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgICAgICBDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGggPj0gQ3VzdG9tVGV4dC53b3JkICYmXG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC53b3JkICE9IDApIHx8XG4gICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICAgICAgIUN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmXG4gICAgICAgICAgICAgICAgIUN1c3RvbVRleHQuaXNUaW1lUmFuZG9tICYmXG4gICAgICAgICAgICAgICAgVGVzdFdvcmRzLndvcmRzLmxlbmd0aCA+PSBDdXN0b21UZXh0LnRleHQubGVuZ3RoKSB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiICYmXG4gICAgICAgICAgICAgICAgVGVzdFdvcmRzLndvcmRzLmxlbmd0aCA+PSAoKF9iID0gKF9hID0gVGVzdFdvcmRzLnJhbmRvbVF1b3RlLnRleHRTcGxpdCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogMCkpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcIndpa2lwZWRpYVwiIHx8IGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09IFwicG9ldHJ5XCIpIHtcbiAgICAgICAgICAgIGlmIChUZXN0V29yZHMud29yZHMubGVuZ3RoIC0gVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleCA8IDIwKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VjdGlvbiA9IGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09IFwid2lraXBlZGlhXCJcbiAgICAgICAgICAgICAgICAgICAgPyB5aWVsZCBXaWtpcGVkaWEuZ2V0U2VjdGlvbihjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKVxuICAgICAgICAgICAgICAgICAgICA6IHlpZWxkIFBvZXRyeS5nZXRQb2VtKCk7XG4gICAgICAgICAgICAgICAgaWYgKHNlY3Rpb24gPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGxldCB3b3JkQ291bnQgPSAwO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgd29yZCBvZiBzZWN0aW9uLndvcmRzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh3b3JkQ291bnQgPj0gY29uZmlnXzEuZGVmYXVsdC53b3JkcyAmJiBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ3b3Jkc1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB3b3JkQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgVGVzdFdvcmRzLndvcmRzLnB1c2god29yZCk7XG4gICAgICAgICAgICAgICAgICAgIFRlc3RVSS5hZGRXb3JkKHdvcmQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBsYW5ndWFnZSA9IGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJjdXN0b21cIlxuICAgICAgICAgICAgPyB5aWVsZCBNaXNjLmdldEN1cnJlbnRMYW5ndWFnZShjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKVxuICAgICAgICAgICAgOiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sICh5aWVsZCBNaXNjLmdldEN1cnJlbnRMYW5ndWFnZShjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKSkpLCB7IHdvcmRzOiBDdXN0b21UZXh0LnRleHQgfSk7XG4gICAgICAgIGNvbnN0IHdvcmRzZXQgPSBXb3Jkc2V0LndpdGhXb3JkcyhsYW5ndWFnZS53b3JkcywgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3gpO1xuICAgICAgICBjb25zdCByYW5kb21Xb3JkID0geWllbGQgZ2V0TmV4dFdvcmQod29yZHNldCwgbGFuZ3VhZ2UsIGJvdW5kKTtcbiAgICAgICAgY29uc3Qgc3BsaXQgPSByYW5kb21Xb3JkLnNwbGl0KFwiIFwiKTtcbiAgICAgICAgaWYgKHNwbGl0Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIHNwbGl0LmZvckVhY2goKHdvcmQpID0+IHtcbiAgICAgICAgICAgICAgICBUZXN0V29yZHMud29yZHMucHVzaCh3b3JkKTtcbiAgICAgICAgICAgICAgICBUZXN0VUkuYWRkV29yZCh3b3JkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgVGVzdFdvcmRzLndvcmRzLnB1c2gocmFuZG9tV29yZCk7XG4gICAgICAgICAgICBUZXN0VUkuYWRkV29yZChyYW5kb21Xb3JkKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5hZGRXb3JkID0gYWRkV29yZDtcbmNvbnN0IHJldHJ5U2F2aW5nID0ge1xuICAgIGNvbXBsZXRlZEV2ZW50OiBudWxsLFxuICAgIGNhblJldHJ5OiBmYWxzZSxcbn07XG5mdW5jdGlvbiByZXRyeVNhdmluZ1Jlc3VsdCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCB7IGNvbXBsZXRlZEV2ZW50IH0gPSByZXRyeVNhdmluZztcbiAgICAgICAgaWYgKGNvbXBsZXRlZEV2ZW50ID09PSBudWxsKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkNvdWxkIG5vdCByZXRyeSBzYXZpbmcgdGhlIHJlc3VsdCBhcyB0aGUgcmVzdWx0IG5vIGxvbmdlciBleGlzdHMuXCIsIDAsIC0xKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXJldHJ5U2F2aW5nLmNhblJldHJ5KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmV0cnlTYXZpbmcuY2FuUmV0cnkgPSBmYWxzZTtcbiAgICAgICAgJChcIiNyZXRyeVNhdmluZ1Jlc3VsdEJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgQWNjb3VudEJ1dHRvbi5sb2FkaW5nKHRydWUpO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlJldHJ5aW5nIHRvIHNhdmUuLi5cIik7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5yZXN1bHRzLnNhdmUoY29tcGxldGVkRXZlbnQpO1xuICAgICAgICBBY2NvdW50QnV0dG9uLmxvYWRpbmcoZmFsc2UpO1xuICAgICAgICBSZXN1bHQuaGlkZUNyb3duKCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgcmV0cnlTYXZpbmcuY2FuUmV0cnkgPSB0cnVlO1xuICAgICAgICAgICAgJChcIiNyZXRyeVNhdmluZ1Jlc3VsdEJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIlJlc3VsdCBub3Qgc2F2ZWQuIFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50Ll9pZCA9IHJlc3BvbnNlLmRhdGEuaW5zZXJ0ZWRJZDtcbiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuaXNQYikge1xuICAgICAgICAgICAgY29tcGxldGVkRXZlbnQuaXNQYiA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgREIuc2F2ZUxvY2FsUmVzdWx0KGNvbXBsZXRlZEV2ZW50KTtcbiAgICAgICAgREIudXBkYXRlTG9jYWxTdGF0cyh7XG4gICAgICAgICAgICB0aW1lOiBjb21wbGV0ZWRFdmVudC50ZXN0RHVyYXRpb24gK1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50LmluY29tcGxldGVUZXN0U2Vjb25kcyAtXG4gICAgICAgICAgICAgICAgY29tcGxldGVkRXZlbnQuYWZrRHVyYXRpb24sXG4gICAgICAgICAgICBzdGFydGVkOiBUZXN0U3RhdHMucmVzdGFydENvdW50ICsgMSxcbiAgICAgICAgfSk7XG4gICAgICAgIEFuYWx5dGljc0NvbnRyb2xsZXIubG9nKFwidGVzdENvbXBsZXRlZFwiKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuaXNQYikge1xuICAgICAgICAgICAgLy9uZXcgcGJcbiAgICAgICAgICAgIFJlc3VsdC5zaG93Q3Jvd24oKTtcbiAgICAgICAgICAgIFJlc3VsdC51cGRhdGVDcm93bigpO1xuICAgICAgICAgICAgREIuc2F2ZUxvY2FsUEIoY29uZmlnXzEuZGVmYXVsdC5tb2RlLCBjb21wbGV0ZWRFdmVudC5tb2RlMiwgY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbiwgY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSwgY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5LCBjb25maWdfMS5kZWZhdWx0LmxhenlNb2RlLCBjb21wbGV0ZWRFdmVudC53cG0sIGNvbXBsZXRlZEV2ZW50LmFjYywgY29tcGxldGVkRXZlbnQucmF3V3BtLCBjb21wbGV0ZWRFdmVudC5jb25zaXN0ZW5jeSk7XG4gICAgICAgIH1cbiAgICAgICAgJChcIiNyZXRyeVNhdmluZ1Jlc3VsdEJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJSZXN1bHQgc2F2ZWRcIiwgMSk7XG4gICAgfSk7XG59XG5leHBvcnRzLnJldHJ5U2F2aW5nUmVzdWx0ID0gcmV0cnlTYXZpbmdSZXN1bHQ7XG5mdW5jdGlvbiBidWlsZENvbXBsZXRlZEV2ZW50KGRpZmZpY3VsdHlGYWlsZWQpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAvL2J1aWxkIGNvbXBsZXRlZCBldmVudCBvYmplY3RcbiAgICBjb25zdCBjb21wbGV0ZWRFdmVudCA9IHtcbiAgICAgICAgd3BtOiB1bmRlZmluZWQsXG4gICAgICAgIHJhd1dwbTogdW5kZWZpbmVkLFxuICAgICAgICBjaGFyU3RhdHM6IHVuZGVmaW5lZCxcbiAgICAgICAgYWNjOiB1bmRlZmluZWQsXG4gICAgICAgIG1vZGU6IGNvbmZpZ18xLmRlZmF1bHQubW9kZSxcbiAgICAgICAgbW9kZTI6IHVuZGVmaW5lZCxcbiAgICAgICAgcXVvdGVMZW5ndGg6IC0xLFxuICAgICAgICBwdW5jdHVhdGlvbjogY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbixcbiAgICAgICAgbnVtYmVyczogY29uZmlnXzEuZGVmYXVsdC5udW1iZXJzLFxuICAgICAgICBsYXp5TW9kZTogY29uZmlnXzEuZGVmYXVsdC5sYXp5TW9kZSxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICBsYW5ndWFnZTogY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSxcbiAgICAgICAgcmVzdGFydENvdW50OiBUZXN0U3RhdHMucmVzdGFydENvdW50LFxuICAgICAgICBpbmNvbXBsZXRlVGVzdFNlY29uZHM6IFRlc3RTdGF0cy5pbmNvbXBsZXRlU2Vjb25kcyA8IDBcbiAgICAgICAgICAgID8gMFxuICAgICAgICAgICAgOiBNaXNjLnJvdW5kVG8yKFRlc3RTdGF0cy5pbmNvbXBsZXRlU2Vjb25kcyksXG4gICAgICAgIGRpZmZpY3VsdHk6IGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSxcbiAgICAgICAgYmxpbmRNb2RlOiBjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSxcbiAgICAgICAgdGFnczogdW5kZWZpbmVkLFxuICAgICAgICBrZXlTcGFjaW5nOiBUZXN0SW5wdXQua2V5cHJlc3NUaW1pbmdzLnNwYWNpbmcuYXJyYXksXG4gICAgICAgIGtleUR1cmF0aW9uOiBUZXN0SW5wdXQua2V5cHJlc3NUaW1pbmdzLmR1cmF0aW9uLmFycmF5LFxuICAgICAgICBjb25zaXN0ZW5jeTogdW5kZWZpbmVkLFxuICAgICAgICBrZXlDb25zaXN0ZW5jeTogdW5kZWZpbmVkLFxuICAgICAgICBmdW5ib3g6IGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94LFxuICAgICAgICBiYWlsZWRPdXQ6IFRlc3RJbnB1dC5iYWlsb3V0LFxuICAgICAgICBjaGFydERhdGE6IHtcbiAgICAgICAgICAgIHdwbTogVGVzdElucHV0LndwbUhpc3RvcnksXG4gICAgICAgICAgICByYXc6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGVycjogdW5kZWZpbmVkLFxuICAgICAgICB9LFxuICAgICAgICBjdXN0b21UZXh0OiB1bmRlZmluZWQsXG4gICAgICAgIHRlc3REdXJhdGlvbjogdW5kZWZpbmVkLFxuICAgICAgICBhZmtEdXJhdGlvbjogdW5kZWZpbmVkLFxuICAgIH07XG4gICAgLy8gc3RhdHNcbiAgICBjb25zdCBzdGF0cyA9IFRlc3RTdGF0cy5jYWxjdWxhdGVTdGF0cygpO1xuICAgIGlmIChzdGF0cy50aW1lICUgMSAhPSAwICYmIGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgVGVzdFN0YXRzLnNldExhc3RTZWNvbmROb3RSb3VuZCgpO1xuICAgIH1cbiAgICBUZXN0U3RhdHMuc2V0TGFzdFRlc3RXcG0oc3RhdHMud3BtKTtcbiAgICBjb21wbGV0ZWRFdmVudC53cG0gPSBzdGF0cy53cG07XG4gICAgY29tcGxldGVkRXZlbnQucmF3V3BtID0gc3RhdHMud3BtUmF3O1xuICAgIGNvbXBsZXRlZEV2ZW50LmNoYXJTdGF0cyA9IFtcbiAgICAgICAgc3RhdHMuY29ycmVjdENoYXJzICsgc3RhdHMuY29ycmVjdFNwYWNlcyxcbiAgICAgICAgc3RhdHMuaW5jb3JyZWN0Q2hhcnMsXG4gICAgICAgIHN0YXRzLmV4dHJhQ2hhcnMsXG4gICAgICAgIHN0YXRzLm1pc3NlZENoYXJzLFxuICAgIF07XG4gICAgY29tcGxldGVkRXZlbnQuYWNjID0gc3RhdHMuYWNjO1xuICAgIC8vIGlmIHRoZSBsYXN0IHNlY29uZCB3YXMgbm90IHJvdW5kZWQsIGFkZCBhbm90aGVyIGRhdGEgcG9pbnQgdG8gdGhlIGhpc3RvcnlcbiAgICBpZiAoVGVzdFN0YXRzLmxhc3RTZWNvbmROb3RSb3VuZCAmJiAhZGlmZmljdWx0eUZhaWxlZCkge1xuICAgICAgICBjb25zdCB3cG1BbmRSYXcgPSBUZXN0U3RhdHMuY2FsY3VsYXRlV3BtQW5kUmF3KCk7XG4gICAgICAgIFRlc3RJbnB1dC5wdXNoVG9XcG1IaXN0b3J5KHdwbUFuZFJhdy53cG0pO1xuICAgICAgICBUZXN0SW5wdXQucHVzaFRvUmF3SGlzdG9yeSh3cG1BbmRSYXcucmF3KTtcbiAgICAgICAgVGVzdElucHV0LnB1c2hLZXlwcmVzc2VzVG9IaXN0b3J5KCk7XG4gICAgfVxuICAgIC8vY29uc2lzdGVuY3lcbiAgICBjb25zdCByYXdQZXJTZWNvbmQgPSBUZXN0SW5wdXQua2V5cHJlc3NQZXJTZWNvbmQubWFwKChmKSA9PiBNYXRoLnJvdW5kKChmLmNvdW50IC8gNSkgKiA2MCkpO1xuICAgIGNvbnN0IHN0ZGRldiA9IE1pc2Muc3RkRGV2KHJhd1BlclNlY29uZCk7XG4gICAgY29uc3QgYXZnID0gTWlzYy5tZWFuKHJhd1BlclNlY29uZCk7XG4gICAgbGV0IGNvbnNpc3RlbmN5ID0gTWlzYy5yb3VuZFRvMihNaXNjLmtvZ2FzYShzdGRkZXYgLyBhdmcpKTtcbiAgICBsZXQga2V5Q29uc2lzdGVuY3lBcnJheSA9IFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3Muc3BhY2luZy5hcnJheSA9PT0gXCJ0b29sb25nXCJcbiAgICAgICAgPyBbXVxuICAgICAgICA6IFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3Muc3BhY2luZy5hcnJheS5zbGljZSgpO1xuICAgIGlmIChrZXlDb25zaXN0ZW5jeUFycmF5Lmxlbmd0aCA+IDApIHtcbiAgICAgICAga2V5Q29uc2lzdGVuY3lBcnJheSA9IGtleUNvbnNpc3RlbmN5QXJyYXkuc2xpY2UoMCwga2V5Q29uc2lzdGVuY3lBcnJheS5sZW5ndGggLSAxKTtcbiAgICB9XG4gICAgbGV0IGtleUNvbnNpc3RlbmN5ID0gTWlzYy5yb3VuZFRvMihNaXNjLmtvZ2FzYShNaXNjLnN0ZERldihrZXlDb25zaXN0ZW5jeUFycmF5KSAvIE1pc2MubWVhbihrZXlDb25zaXN0ZW5jeUFycmF5KSkpO1xuICAgIGlmICghY29uc2lzdGVuY3kgfHwgaXNOYU4oY29uc2lzdGVuY3kpKSB7XG4gICAgICAgIGNvbnNpc3RlbmN5ID0gMDtcbiAgICB9XG4gICAgaWYgKCFrZXlDb25zaXN0ZW5jeSB8fCBpc05hTihrZXlDb25zaXN0ZW5jeSkpIHtcbiAgICAgICAga2V5Q29uc2lzdGVuY3kgPSAwO1xuICAgIH1cbiAgICBjb21wbGV0ZWRFdmVudC5rZXlDb25zaXN0ZW5jeSA9IGtleUNvbnNpc3RlbmN5O1xuICAgIGNvbXBsZXRlZEV2ZW50LmNvbnNpc3RlbmN5ID0gY29uc2lzdGVuY3k7XG4gICAgY29uc3Qgc21vb3RoZWRyYXcgPSBNaXNjLnNtb290aChyYXdQZXJTZWNvbmQsIDEpO1xuICAgIGNvbXBsZXRlZEV2ZW50LmNoYXJ0RGF0YS5yYXcgPSBzbW9vdGhlZHJhdztcbiAgICBjb21wbGV0ZWRFdmVudC5jaGFydERhdGEudW5zbW9vdGhlZFJhdyA9IHJhd1BlclNlY29uZDtcbiAgICAvL3Ntb290aGVkIGNvbnNpc3RlbmN5XG4gICAgY29uc3Qgc3RkZGV2MiA9IE1pc2Muc3RkRGV2KHNtb290aGVkcmF3KTtcbiAgICBjb25zdCBhdmcyID0gTWlzYy5tZWFuKHNtb290aGVkcmF3KTtcbiAgICBjb25zdCBzbW9vdGhDb25zaXN0ZW5jeSA9IE1pc2Mucm91bmRUbzIoTWlzYy5rb2dhc2Eoc3RkZGV2MiAvIGF2ZzIpKTtcbiAgICBjb21wbGV0ZWRFdmVudC5zbW9vdGhDb25zaXN0ZW5jeSA9IHNtb290aENvbnNpc3RlbmN5O1xuICAgIC8vd3BtIGNvbnNpc3RlbmN5XG4gICAgY29uc3Qgc3RkZGV2MyA9IE1pc2Muc3RkRGV2KChfYSA9IGNvbXBsZXRlZEV2ZW50LmNoYXJ0RGF0YS53cG0pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFtdKTtcbiAgICBjb25zdCBhdmczID0gTWlzYy5tZWFuKChfYiA9IGNvbXBsZXRlZEV2ZW50LmNoYXJ0RGF0YS53cG0pICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IFtdKTtcbiAgICBjb25zdCB3cG1Db25zaXN0ZW5jeSA9IE1pc2Mucm91bmRUbzIoTWlzYy5rb2dhc2Eoc3RkZGV2MyAvIGF2ZzMpKTtcbiAgICBjb21wbGV0ZWRFdmVudC53cG1Db25zaXN0ZW5jeSA9IHdwbUNvbnNpc3RlbmN5O1xuICAgIGNvbXBsZXRlZEV2ZW50LnRlc3REdXJhdGlvbiA9IHBhcnNlRmxvYXQoc3RhdHMudGltZS50b1N0cmluZygpKTtcbiAgICBjb21wbGV0ZWRFdmVudC5hZmtEdXJhdGlvbiA9IFRlc3RTdGF0cy5jYWxjdWxhdGVBZmtTZWNvbmRzKGNvbXBsZXRlZEV2ZW50LnRlc3REdXJhdGlvbik7XG4gICAgY29tcGxldGVkRXZlbnQuY2hhcnREYXRhLmVyciA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgVGVzdElucHV0LmtleXByZXNzUGVyU2Vjb25kLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50LmNoYXJ0RGF0YS5lcnIucHVzaChUZXN0SW5wdXQua2V5cHJlc3NQZXJTZWNvbmRbaV0uZXJyb3JzKTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50LnF1b3RlTGVuZ3RoID0gVGVzdFdvcmRzLnJhbmRvbVF1b3RlLmdyb3VwO1xuICAgICAgICBjb21wbGV0ZWRFdmVudC5sYW5nID0gY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZS5yZXBsYWNlKC9fXFxkKmskL2csIFwiXCIpO1xuICAgIH1cbiAgICAvLyBAdHMtaWdub3JlIFRPRE8gZml4IHRoaXNcbiAgICBjb21wbGV0ZWRFdmVudC5tb2RlMiA9IE1pc2MuZ2V0TW9kZTIoY29uZmlnXzEuZGVmYXVsdCwgVGVzdFdvcmRzLnJhbmRvbVF1b3RlKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiKSB7XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50LmN1c3RvbVRleHQgPSB7fTtcbiAgICAgICAgY29tcGxldGVkRXZlbnQuY3VzdG9tVGV4dC50ZXh0TGVuID0gQ3VzdG9tVGV4dC50ZXh0Lmxlbmd0aDtcbiAgICAgICAgY29tcGxldGVkRXZlbnQuY3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gPSBDdXN0b21UZXh0LmlzV29yZFJhbmRvbTtcbiAgICAgICAgY29tcGxldGVkRXZlbnQuY3VzdG9tVGV4dC5pc1RpbWVSYW5kb20gPSBDdXN0b21UZXh0LmlzVGltZVJhbmRvbTtcbiAgICAgICAgY29tcGxldGVkRXZlbnQuY3VzdG9tVGV4dC53b3JkID0gQ3VzdG9tVGV4dC53b3JkO1xuICAgICAgICBjb21wbGV0ZWRFdmVudC5jdXN0b21UZXh0LnRpbWUgPSBDdXN0b21UZXh0LnRpbWU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBkZWxldGUgY29tcGxldGVkRXZlbnQuY3VzdG9tVGV4dDtcbiAgICB9XG4gICAgLy90YWdzXG4gICAgY29uc3QgYWN0aXZlVGFnc0lkcyA9IFtdO1xuICAgIHRyeSB7XG4gICAgICAgIChfYyA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgaWYgKHRhZy5hY3RpdmUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBhY3RpdmVUYWdzSWRzLnB1c2godGFnLl9pZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjYXRjaCAoZSkgeyB9XG4gICAgY29tcGxldGVkRXZlbnQudGFncyA9IGFjdGl2ZVRhZ3NJZHM7XG4gICAgaWYgKGNvbXBsZXRlZEV2ZW50Lm1vZGUgIT0gXCJjdXN0b21cIilcbiAgICAgICAgZGVsZXRlIGNvbXBsZXRlZEV2ZW50LmN1c3RvbVRleHQ7XG4gICAgcmV0dXJuIGNvbXBsZXRlZEV2ZW50O1xufVxuZnVuY3Rpb24gZmluaXNoKGRpZmZpY3VsdHlGYWlsZWQgPSBmYWxzZSkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoIVRlc3RBY3RpdmUuZ2V0KCkpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIiAmJiBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGggIT0gMCkge1xuICAgICAgICAgICAgVGVzdElucHV0LmlucHV0LnB1c2hIaXN0b3J5KCk7XG4gICAgICAgICAgICBUZXN0SW5wdXQuY29ycmVjdGVkLnB1c2hIaXN0b3J5KCk7XG4gICAgICAgICAgICBSZXBsYXkucmVwbGF5R2V0V29yZHNMaXN0KFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5KTtcbiAgICAgICAgfVxuICAgICAgICBUZXN0SW5wdXQucmVjb3JkS2V5cHJlc3NTcGFjaW5nKCk7IC8vdGhpcyBpcyBuZWVkZWQgaW4gY2FzZSB0aGVyZSBpcyBhZmsgdGltZSBhdCB0aGUgZW5kIC0gdG8gbWFrZSBzdXJlIHRlc3QgZHVyYXRpb24gbWFrZXMgc2Vuc2VcbiAgICAgICAgVGVzdFVJLnNldFJlc3VsdENhbGN1bGF0aW5nKHRydWUpO1xuICAgICAgICBUZXN0VUkuc2V0UmVzdWx0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgVGVzdFN0YXRzLnNldEVuZChwZXJmb3JtYW5jZS5ub3coKSk7XG4gICAgICAgIFRlc3RBY3RpdmUuc2V0KGZhbHNlKTtcbiAgICAgICAgUmVwbGF5LnN0b3BSZXBsYXlSZWNvcmRpbmcoKTtcbiAgICAgICAgRm9jdXMuc2V0KGZhbHNlKTtcbiAgICAgICAgQ2FyZXQuaGlkZSgpO1xuICAgICAgICBMaXZlV3BtLmhpZGUoKTtcbiAgICAgICAgUGJDcm93bi5oaWRlKCk7XG4gICAgICAgIExpdmVBY2MuaGlkZSgpO1xuICAgICAgICBMaXZlQnVyc3QuaGlkZSgpO1xuICAgICAgICBUaW1lclByb2dyZXNzLmhpZGUoKTtcbiAgICAgICAgT3V0T2ZGb2N1cy5oaWRlKCk7XG4gICAgICAgIFRlc3RUaW1lci5jbGVhcigpO1xuICAgICAgICBGdW5ib3guY2xlYXIoKTtcbiAgICAgICAgTW9ua2V5LmhpZGUoKTtcbiAgICAgICAgLy9uZWVkIG9uZSBtb3JlIGNhbGN1bGF0aW9uIGZvciB0aGUgbGFzdCB3b3JkIGlmIHRlc3QgYXV0byBlbmRlZFxuICAgICAgICBpZiAoVGVzdElucHV0LmJ1cnN0SGlzdG9yeS5sZW5ndGggIT09IFRlc3RJbnB1dC5pbnB1dC5nZXRIaXN0b3J5KCkubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBidXJzdCA9IFRlc3RTdGF0cy5jYWxjdWxhdGVCdXJzdCgpO1xuICAgICAgICAgICAgVGVzdElucHV0LnB1c2hCdXJzdFRvSGlzdG9yeShidXJzdCk7XG4gICAgICAgIH1cbiAgICAgICAgLy9yZW1vdmUgYWZrIGZyb20gemVuXG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIiB8fCBUZXN0SW5wdXQuYmFpbG91dCkge1xuICAgICAgICAgICAgVGVzdFN0YXRzLnJlbW92ZUFma0RhdGEoKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb21wbGV0ZWRFdmVudCA9IGJ1aWxkQ29tcGxldGVkRXZlbnQoZGlmZmljdWx0eUZhaWxlZCk7XG4gICAgICAgIC8vdG9kbyBjaGVjayBpZiBhbnkgZmllbGRzIGFyZSB1bmRlZmluZWRcbiAgICAgICAgLy8vLy8vLy8vIGNvbXBsZXRlZCBldmVudCByZWFkeVxuICAgICAgICAvL2FmayBjaGVja1xuICAgICAgICBjb25zdCBrcHMgPSBUZXN0SW5wdXQua2V5cHJlc3NQZXJTZWNvbmQuc2xpY2UoLTUpO1xuICAgICAgICBsZXQgYWZrRGV0ZWN0ZWQgPSBrcHMuZXZlcnkoKHNlY29uZCkgPT4gc2Vjb25kLmFmayk7XG4gICAgICAgIGlmIChUZXN0SW5wdXQuYmFpbG91dClcbiAgICAgICAgICAgIGFma0RldGVjdGVkID0gZmFsc2U7XG4gICAgICAgIGxldCB0b29TaG9ydCA9IGZhbHNlO1xuICAgICAgICBsZXQgZG9udFNhdmUgPSBmYWxzZTtcbiAgICAgICAgLy9mYWlsIGNoZWNrc1xuICAgICAgICBpZiAoZGlmZmljdWx0eUZhaWxlZCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoYFRlc3QgZmFpbGVkIC0gJHtmYWlsUmVhc29ufWAsIDAsIDEpO1xuICAgICAgICAgICAgZG9udFNhdmUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGFma0RldGVjdGVkKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlRlc3QgaW52YWxpZCAtIEFGSyBkZXRlY3RlZFwiLCAwKTtcbiAgICAgICAgICAgIGRvbnRTYXZlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChUZXN0U3RhdGUuaXNSZXBlYXRlZCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJUZXN0IGludmFsaWQgLSByZXBlYXRlZFwiLCAwKTtcbiAgICAgICAgICAgIGRvbnRTYXZlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICgoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInRpbWVcIiAmJlxuICAgICAgICAgICAgY29tcGxldGVkRXZlbnQubW9kZTIgPCAxNSAmJlxuICAgICAgICAgICAgY29tcGxldGVkRXZlbnQubW9kZTIgPiAwKSB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ0aW1lXCIgJiZcbiAgICAgICAgICAgICAgICBjb21wbGV0ZWRFdmVudC5tb2RlMiA9PSAwICYmXG4gICAgICAgICAgICAgICAgY29tcGxldGVkRXZlbnQudGVzdER1cmF0aW9uIDwgMTUpIHx8XG4gICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIgJiZcbiAgICAgICAgICAgICAgICBjb21wbGV0ZWRFdmVudC5tb2RlMiA8IDEwICYmXG4gICAgICAgICAgICAgICAgY29tcGxldGVkRXZlbnQubW9kZTIgPiAwKSB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ3b3Jkc1wiICYmXG4gICAgICAgICAgICAgICAgY29tcGxldGVkRXZlbnQubW9kZTIgPT0gMCAmJlxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50LnRlc3REdXJhdGlvbiA8IDE1KSB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgICAgICFDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgICAgICFDdXN0b21UZXh0LmlzVGltZVJhbmRvbSAmJlxuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQudGV4dC5sZW5ndGggPCAxMCkgfHxcbiAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgICAgICBDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgICAgICFDdXN0b21UZXh0LmlzVGltZVJhbmRvbSAmJlxuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQud29yZCA8IDEwKSB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgICAgICFDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQuaXNUaW1lUmFuZG9tICYmXG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC50aW1lIDwgMTUpIHx8XG4gICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInplblwiICYmIGNvbXBsZXRlZEV2ZW50LnRlc3REdXJhdGlvbiA8IDE1KSkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJUZXN0IGludmFsaWQgLSB0b28gc2hvcnRcIiwgMCk7XG4gICAgICAgICAgICB0b29TaG9ydCA9IHRydWU7XG4gICAgICAgICAgICBkb250U2F2ZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29tcGxldGVkRXZlbnQud3BtIDwgMCB8fCBjb21wbGV0ZWRFdmVudC53cG0gPiAzNTApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiVGVzdCBpbnZhbGlkIC0gd3BtXCIsIDApO1xuICAgICAgICAgICAgVGVzdFN0YXRzLnNldEludmFsaWQoKTtcbiAgICAgICAgICAgIGRvbnRTYXZlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb21wbGV0ZWRFdmVudC5hY2MgPCA3NSB8fCBjb21wbGV0ZWRFdmVudC5hY2MgPiAxMDApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiVGVzdCBpbnZhbGlkIC0gYWNjdXJhY3lcIiwgMCk7XG4gICAgICAgICAgICBUZXN0U3RhdHMuc2V0SW52YWxpZCgpO1xuICAgICAgICAgICAgZG9udFNhdmUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIHRlc3QgaXMgdmFsaWRcbiAgICAgICAgaWYgKCFkb250U2F2ZSkge1xuICAgICAgICAgICAgVG9kYXlUcmFja2VyLmFkZFNlY29uZHMoY29tcGxldGVkRXZlbnQudGVzdER1cmF0aW9uICtcbiAgICAgICAgICAgICAgICAoVGVzdFN0YXRzLmluY29tcGxldGVTZWNvbmRzIDwgMFxuICAgICAgICAgICAgICAgICAgICA/IDBcbiAgICAgICAgICAgICAgICAgICAgOiBNaXNjLnJvdW5kVG8yKFRlc3RTdGF0cy5pbmNvbXBsZXRlU2Vjb25kcykpIC1cbiAgICAgICAgICAgICAgICBjb21wbGV0ZWRFdmVudC5hZmtEdXJhdGlvbik7XG4gICAgICAgICAgICBSZXN1bHQudXBkYXRlVG9kYXlUcmFja2VyKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciA9PSBudWxsKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICNyZXN1bHQgI3JhdGVRdW90ZUJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Jlc3VsdCAjcmVwb3J0UXVvdGVCdXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICBBbmFseXRpY3NDb250cm9sbGVyLmxvZyhcInRlc3RDb21wbGV0ZWROb0xvZ2luXCIpO1xuICAgICAgICAgICAgaWYgKCFkb250U2F2ZSlcbiAgICAgICAgICAgICAgICBleHBvcnRzLm5vdFNpZ25lZEluTGFzdFJlc3VsdCA9IGNvbXBsZXRlZEV2ZW50O1xuICAgICAgICAgICAgZG9udFNhdmUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjcmVzdWx0ICNyZXBvcnRRdW90ZUJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICB5aWVsZCBSZXN1bHQudXBkYXRlKGNvbXBsZXRlZEV2ZW50LCBkaWZmaWN1bHR5RmFpbGVkLCBmYWlsUmVhc29uLCBhZmtEZXRlY3RlZCwgVGVzdFN0YXRlLmlzUmVwZWF0ZWQsIHRvb1Nob3J0LCBUZXN0V29yZHMucmFuZG9tUXVvdGUsIGRvbnRTYXZlKTtcbiAgICAgICAgaWYgKGNvbXBsZXRlZEV2ZW50LmNoYXJ0RGF0YSAhPT0gXCJ0b29sb25nXCIpIHtcbiAgICAgICAgICAgIGRlbGV0ZSBjb21wbGV0ZWRFdmVudC5jaGFydERhdGEudW5zbW9vdGhlZFJhdztcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29tcGxldGVkRXZlbnQudGVzdER1cmF0aW9uID4gMTIyKSB7XG4gICAgICAgICAgICBjb21wbGV0ZWRFdmVudC5jaGFydERhdGEgPSBcInRvb2xvbmdcIjtcbiAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50LmtleVNwYWNpbmcgPSBcInRvb2xvbmdcIjtcbiAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50LmtleUR1cmF0aW9uID0gXCJ0b29sb25nXCI7XG4gICAgICAgICAgICBUZXN0SW5wdXQuc2V0S2V5cHJlc3NUaW1pbmdzVG9vTG9uZygpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkb250U2F2ZSkge1xuICAgICAgICAgICAgQW5hbHl0aWNzQ29udHJvbGxlci5sb2coXCJ0ZXN0Q29tcGxldGVkSW52YWxpZFwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyB1c2VyIGlzIGxvZ2dlZCBpblxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ID09IFwibm9ybWFsXCIgfHxcbiAgICAgICAgICAgICgoY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ID09IFwibWFzdGVyXCIgfHwgY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ID09IFwiZXhwZXJ0XCIpICYmXG4gICAgICAgICAgICAgICAgIWRpZmZpY3VsdHlGYWlsZWQpKSB7XG4gICAgICAgICAgICBUZXN0U3RhdHMucmVzZXRJbmNvbXBsZXRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgY29tcGxldGVkRXZlbnQudWlkID0gKF9hID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudWlkO1xuICAgICAgICBSZXN1bHQudXBkYXRlUmF0ZVF1b3RlKFRlc3RXb3Jkcy5yYW5kb21RdW90ZSk7XG4gICAgICAgIEFjY291bnRCdXR0b24ubG9hZGluZyh0cnVlKTtcbiAgICAgICAgY29tcGxldGVkRXZlbnQuY2hhbGxlbmdlID0gQ2hhbGxlbmdlQ29udG9sbGVyLnZlcmlmeShjb21wbGV0ZWRFdmVudCk7XG4gICAgICAgIGlmIChjb21wbGV0ZWRFdmVudC5jaGFsbGVuZ2UgPT09IG51bGwpXG4gICAgICAgICAgICBjb21wbGV0ZWRFdmVudCA9PT0gbnVsbCB8fCBjb21wbGV0ZWRFdmVudCA9PT0gdm9pZCAwID8gdHJ1ZSA6IGRlbGV0ZSBjb21wbGV0ZWRFdmVudC5jaGFsbGVuZ2U7XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50Lmhhc2ggPSAoMCwgb2JqZWN0X2hhc2hfMS5kZWZhdWx0KShjb21wbGV0ZWRFdmVudCk7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5yZXN1bHRzLnNhdmUoY29tcGxldGVkRXZlbnQpO1xuICAgICAgICBBY2NvdW50QnV0dG9uLmxvYWRpbmcoZmFsc2UpO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3Igc2F2aW5nIHJlc3VsdFwiLCBjb21wbGV0ZWRFdmVudCk7XG4gICAgICAgICAgICAkKFwiI3JldHJ5U2F2aW5nUmVzdWx0QnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2UgPT09IFwiSW5jb3JyZWN0IHJlc3VsdCBoYXNoXCIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhjb21wbGV0ZWRFdmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXRyeVNhdmluZy5jb21wbGV0ZWRFdmVudCA9IGNvbXBsZXRlZEV2ZW50O1xuICAgICAgICAgICAgcmV0cnlTYXZpbmcuY2FuUmV0cnkgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHNhdmUgcmVzdWx0OiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBSZXN1bHQuaGlkZUNyb3duKCk7XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50Ll9pZCA9IHJlc3BvbnNlLmRhdGEuaW5zZXJ0ZWRJZDtcbiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuaXNQYikge1xuICAgICAgICAgICAgY29tcGxldGVkRXZlbnQuaXNQYiA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgREIuc2F2ZUxvY2FsUmVzdWx0KGNvbXBsZXRlZEV2ZW50KTtcbiAgICAgICAgREIudXBkYXRlTG9jYWxTdGF0cyh7XG4gICAgICAgICAgICB0aW1lOiBjb21wbGV0ZWRFdmVudC50ZXN0RHVyYXRpb24gK1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50LmluY29tcGxldGVUZXN0U2Vjb25kcyAtXG4gICAgICAgICAgICAgICAgY29tcGxldGVkRXZlbnQuYWZrRHVyYXRpb24sXG4gICAgICAgICAgICBzdGFydGVkOiBUZXN0U3RhdHMucmVzdGFydENvdW50ICsgMSxcbiAgICAgICAgfSk7XG4gICAgICAgIEFuYWx5dGljc0NvbnRyb2xsZXIubG9nKFwidGVzdENvbXBsZXRlZFwiKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuaXNQYikge1xuICAgICAgICAgICAgLy9uZXcgcGJcbiAgICAgICAgICAgIFJlc3VsdC5zaG93Q3Jvd24oKTtcbiAgICAgICAgICAgIFJlc3VsdC51cGRhdGVDcm93bigpO1xuICAgICAgICAgICAgREIuc2F2ZUxvY2FsUEIoY29uZmlnXzEuZGVmYXVsdC5tb2RlLCBjb21wbGV0ZWRFdmVudC5tb2RlMiwgY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbiwgY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSwgY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5LCBjb25maWdfMS5kZWZhdWx0LmxhenlNb2RlLCBjb21wbGV0ZWRFdmVudC53cG0sIGNvbXBsZXRlZEV2ZW50LmFjYywgY29tcGxldGVkRXZlbnQucmF3V3BtLCBjb21wbGV0ZWRFdmVudC5jb25zaXN0ZW5jeSk7XG4gICAgICAgIH1cbiAgICAgICAgJChcIiNyZXRyeVNhdmluZ1Jlc3VsdEJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZmluaXNoID0gZmluaXNoO1xuZnVuY3Rpb24gZmFpbChyZWFzb24pIHtcbiAgICBmYWlsUmVhc29uID0gcmVhc29uO1xuICAgIC8vIGlucHV0LnB1c2hIaXN0b3J5KCk7XG4gICAgLy8gY29ycmVjdGVkLnB1c2hIaXN0b3J5KCk7XG4gICAgVGVzdElucHV0LnB1c2hLZXlwcmVzc2VzVG9IaXN0b3J5KCk7XG4gICAgZmluaXNoKHRydWUpO1xuICAgIGNvbnN0IHRlc3RTZWNvbmRzID0gVGVzdFN0YXRzLmNhbGN1bGF0ZVRlc3RTZWNvbmRzKHBlcmZvcm1hbmNlLm5vdygpKTtcbiAgICBjb25zdCBhZmtzZWNvbmRzID0gVGVzdFN0YXRzLmNhbGN1bGF0ZUFma1NlY29uZHModGVzdFNlY29uZHMpO1xuICAgIGxldCB0dCA9IHRlc3RTZWNvbmRzIC0gYWZrc2Vjb25kcztcbiAgICBpZiAodHQgPCAwKVxuICAgICAgICB0dCA9IDA7XG4gICAgVGVzdFN0YXRzLmluY3JlbWVudEluY29tcGxldGVTZWNvbmRzKHR0KTtcbiAgICBUZXN0U3RhdHMuaW5jcmVtZW50UmVzdGFydENvdW50KCk7XG59XG5leHBvcnRzLmZhaWwgPSBmYWlsO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0ZXN0TW9kZXNOb3RpY2UgLnRleHQtYnV0dG9uLnJlc3RhcnRcIiwgKCkgPT4ge1xuICAgIHJlc3RhcnQoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJrZXlwcmVzc1wiLCBcIiNyZXN0YXJ0VGVzdEJ1dHRvblwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgTWFudWFsUmVzdGFydC5yZXNldCgpO1xuICAgICAgICBpZiAoVGVzdEFjdGl2ZS5nZXQoKSAmJlxuICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5yZXBlYXRRdW90ZXMgPT09IFwidHlwaW5nXCIgJiZcbiAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgICAgICByZXN0YXJ0KHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdGFydCgpO1xuICAgICAgICB9XG4gICAgfVxufSk7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIjcmVzdGFydFRlc3RCdXR0b25cIiwgKCkgPT4ge1xuICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgaWYgKFRlc3RVSS5yZXN1bHRDYWxjdWxhdGluZylcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChUZXN0QWN0aXZlLmdldCgpICYmXG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQucmVwZWF0UXVvdGVzID09PSBcInR5cGluZ1wiICYmXG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgIHJlc3RhcnQodHJ1ZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXN0YXJ0KCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIjcmV0cnlTYXZpbmdSZXN1bHRCdXR0b25cIiwgcmV0cnlTYXZpbmdSZXN1bHQpO1xuJChkb2N1bWVudCkub24oXCJrZXlwcmVzc1wiLCBcIiNuZXh0VGVzdEJ1dHRvblwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgcmVzdGFydCgpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiI25leHRUZXN0QnV0dG9uXCIsICgpID0+IHtcbiAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgIHJlc3RhcnQoKTtcbn0pO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiI3Jlc3RhcnRUZXN0QnV0dG9uV2l0aFNhbWVXb3Jkc2V0XCIsICgpID0+IHtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJSZXBlYXQgdGVzdCBkaXNhYmxlZCBpbiB6ZW4gbW9kZVwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgIHJlc3RhcnQodHJ1ZSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwia2V5cHJlc3NcIiwgXCIjcmVzdGFydFRlc3RCdXR0b25XaXRoU2FtZVdvcmRzZXRcIiwgKGV2ZW50KSA9PiB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUmVwZWF0IHRlc3QgZGlzYWJsZWQgaW4gemVuIG1vZGVcIik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIHJlc3RhcnQodHJ1ZSk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3RvcCAuY29uZmlnIC53b3JkQ291bnQgLnRleHQtYnV0dG9uXCIsIChlKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHdyZCA9IChfYSA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwid29yZENvdW50XCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIjE1XCI7XG4gICAgaWYgKHdyZCAhPSBcImN1c3RvbVwiKSB7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRXb3JkQ291bnQocGFyc2VJbnQod3JkKSk7XG4gICAgICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgICAgIHJlc3RhcnQoKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjdG9wIC5jb25maWcgLnRpbWUgLnRleHQtYnV0dG9uXCIsIChlKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IG1vZGUgPSAoX2EgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcInRpbWVDb25maWdcIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiMTBcIjtcbiAgICBpZiAobW9kZSAhPSBcImN1c3RvbVwiKSB7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lQ29uZmlnKHBhcnNlSW50KG1vZGUpKTtcbiAgICAgICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICAgICAgcmVzdGFydCgpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0b3AgLmNvbmZpZyAucXVvdGVMZW5ndGggLnRleHQtYnV0dG9uXCIsIChlKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGxldCBsZW4gPSBwYXJzZUludCgoX2EgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcInF1b3RlTGVuZ3RoXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIjFcIik7XG4gICAgaWYgKGxlbiAhPSAtMikge1xuICAgICAgICBpZiAobGVuID09IC0xKSB7XG4gICAgICAgICAgICBsZW4gPSBbMCwgMSwgMiwgM107XG4gICAgICAgIH1cbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldFF1b3RlTGVuZ3RoKGxlbiwgZmFsc2UsIGUuc2hpZnRLZXkpO1xuICAgICAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgICAgICByZXN0YXJ0KCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3RvcCAuY29uZmlnIC5wdW5jdHVhdGlvbk1vZGUgLnRleHQtYnV0dG9uXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0UHVuY3R1YXRpb24oIWNvbmZpZ18xLmRlZmF1bHQucHVuY3R1YXRpb24pO1xuICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgcmVzdGFydCgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3RvcCAuY29uZmlnIC5udW1iZXJzTW9kZSAudGV4dC1idXR0b25cIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXROdW1iZXJzKCFjb25maWdfMS5kZWZhdWx0Lm51bWJlcnMpO1xuICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgcmVzdGFydCgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3RvcCAuY29uZmlnIC5tb2RlIC50ZXh0LWJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBpZiAoJChlLmN1cnJlbnRUYXJnZXQpLmhhc0NsYXNzKFwiYWN0aXZlXCIpKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgbW9kZSA9ICgoX2EgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcIm1vZGVcIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwidGltZVwiKTtcbiAgICBpZiAobW9kZSA9PT0gdW5kZWZpbmVkKVxuICAgICAgICByZXR1cm47XG4gICAgVXBkYXRlQ29uZmlnLnNldE1vZGUobW9kZSk7XG4gICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICByZXN0YXJ0KCk7XG59KTtcbiQoXCIjcHJhY3Rpc2VXb3Jkc1BvcHVwIC5idXR0b24ubWlzc2VkXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIFByYWN0aXNlV29yZHMuaGlkZVBvcHVwKCk7XG4gICAgUHJhY3Rpc2VXb3Jkcy5pbml0KHRydWUsIGZhbHNlKTtcbiAgICByZXN0YXJ0KGZhbHNlLCBmYWxzZSwgdW5kZWZpbmVkLCB0cnVlKTtcbn0pO1xuJChcIiNwcmFjdGlzZVdvcmRzUG9wdXAgLmJ1dHRvbi5zbG93XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIFByYWN0aXNlV29yZHMuaGlkZVBvcHVwKCk7XG4gICAgUHJhY3Rpc2VXb3Jkcy5pbml0KGZhbHNlLCB0cnVlKTtcbiAgICByZXN0YXJ0KGZhbHNlLCBmYWxzZSwgdW5kZWZpbmVkLCB0cnVlKTtcbn0pO1xuJChcIiNwcmFjdGlzZVdvcmRzUG9wdXAgLmJ1dHRvbi5ib3RoXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIFByYWN0aXNlV29yZHMuaGlkZVBvcHVwKCk7XG4gICAgUHJhY3Rpc2VXb3Jkcy5pbml0KHRydWUsIHRydWUpO1xuICAgIHJlc3RhcnQoZmFsc2UsIGZhbHNlLCB1bmRlZmluZWQsIHRydWUpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3F1b3RlU2VhcmNoUG9wdXAgI3F1b3RlU2VhcmNoUmVzdWx0cyAuc2VhcmNoUmVzdWx0XCIsIChlKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJyZXBvcnRcIikpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBzaWQgPSBwYXJzZUludCgoX2EgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcImlkXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIlwiKTtcbiAgICBRdW90ZVNlYXJjaFBvcHVwLnNldFNlbGVjdGVkSWQoc2lkKTtcbiAgICBpZiAoUXVvdGVTZWFyY2hQb3B1cC5hcHBseShzaWQpID09PSB0cnVlKVxuICAgICAgICByZXN0YXJ0KCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjdG9wICNtZW51ICNzdGFydFRlc3RCdXR0b24sICN0b3AgLmxvZ29cIiwgKCkgPT4ge1xuICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09PSBcInRlc3RcIilcbiAgICAgICAgcmVzdGFydCgpO1xufSk7XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5LCBldmVudFZhbHVlLCBub3NhdmUpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiZGlmZmljdWx0eVwiICYmICFub3NhdmUpXG4gICAgICAgIHJlc3RhcnQoZmFsc2UsIG5vc2F2ZSk7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcInNob3dBbGxMaW5lc1wiICYmICFub3NhdmUpXG4gICAgICAgIHJlc3RhcnQoKTtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwia2V5bWFwTW9kZVwiICYmICFub3NhdmUpXG4gICAgICAgIHJlc3RhcnQoZmFsc2UsIG5vc2F2ZSk7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImxhenlNb2RlXCIgJiYgZXZlbnRWYWx1ZSA9PT0gZmFsc2UgJiYgIW5vc2F2ZSkge1xuICAgICAgICByZW1lbWJlckxhenlNb2RlID0gZmFsc2U7XG4gICAgfVxufSk7XG5UaW1lckV2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXksIGV2ZW50VmFsdWUpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiZmFpbFwiICYmIGV2ZW50VmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICAgICAgZmFpbChldmVudFZhbHVlKTtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiZmluaXNoXCIpXG4gICAgICAgIGZpbmlzaCgpO1xufSk7XG5SZXNldFJlcXVlc3RlZEV2ZW50LnN1YnNjcmliZSgoKSA9PiB7XG4gICAgcmVzdGFydCgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2V0QWN0aXZlQ2hhbGxlbmdlID0gZXhwb3J0cy5zZXRQYWNlUmVwZWF0ID0gZXhwb3J0cy5zZXRSZXBlYXRlZCA9IGV4cG9ydHMuYWN0aXZlQ2hhbGxlbmdlID0gZXhwb3J0cy5pc1BhY2VSZXBlYXQgPSBleHBvcnRzLmlzUmVwZWF0ZWQgPSB2b2lkIDA7XG5leHBvcnRzLmlzUmVwZWF0ZWQgPSBmYWxzZTtcbmV4cG9ydHMuaXNQYWNlUmVwZWF0ID0gZmFsc2U7XG5leHBvcnRzLmFjdGl2ZUNoYWxsZW5nZSA9IG51bGw7XG5mdW5jdGlvbiBzZXRSZXBlYXRlZCh0Zikge1xuICAgIGV4cG9ydHMuaXNSZXBlYXRlZCA9IHRmO1xufVxuZXhwb3J0cy5zZXRSZXBlYXRlZCA9IHNldFJlcGVhdGVkO1xuZnVuY3Rpb24gc2V0UGFjZVJlcGVhdCh0Zikge1xuICAgIGV4cG9ydHMuaXNQYWNlUmVwZWF0ID0gdGY7XG59XG5leHBvcnRzLnNldFBhY2VSZXBlYXQgPSBzZXRQYWNlUmVwZWF0O1xuZnVuY3Rpb24gc2V0QWN0aXZlQ2hhbGxlbmdlKHZhbCkge1xuICAgIGV4cG9ydHMuYWN0aXZlQ2hhbGxlbmdlID0gdmFsO1xufVxuZXhwb3J0cy5zZXRBY3RpdmVDaGFsbGVuZ2UgPSBzZXRBY3RpdmVDaGFsbGVuZ2U7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5jYWxjdWxhdGVTdGF0cyA9IGV4cG9ydHMucmVtb3ZlQWZrRGF0YSA9IGV4cG9ydHMuY2FsY3VsYXRlQWNjdXJhY3kgPSBleHBvcnRzLmNhbGN1bGF0ZUJ1cnN0ID0gZXhwb3J0cy5zZXRMYXN0U2Vjb25kTm90Um91bmQgPSBleHBvcnRzLmNhbGN1bGF0ZUFma1NlY29uZHMgPSBleHBvcnRzLnNldFN0YXJ0ID0gZXhwb3J0cy5zZXRFbmQgPSBleHBvcnRzLmNhbGN1bGF0ZVdwbUFuZFJhdyA9IGV4cG9ydHMuY2FsY3VsYXRlVGVzdFNlY29uZHMgPSBleHBvcnRzLnNldEludmFsaWQgPSBleHBvcnRzLnJlc2V0SW5jb21wbGV0ZSA9IGV4cG9ydHMuaW5jcmVtZW50SW5jb21wbGV0ZVNlY29uZHMgPSBleHBvcnRzLmluY3JlbWVudFJlc3RhcnRDb3VudCA9IGV4cG9ydHMuaW5jb21wbGV0ZVNlY29uZHMgPSBleHBvcnRzLnJlc3RhcnRDb3VudCA9IGV4cG9ydHMucmVzdGFydCA9IGV4cG9ydHMuZ2V0U3RhdHMgPSBleHBvcnRzLnNldExhc3RUZXN0V3BtID0gZXhwb3J0cy5sYXN0VGVzdFdwbSA9IGV4cG9ydHMubGFzdFNlY29uZE5vdFJvdW5kID0gZXhwb3J0cy5lbmQyID0gZXhwb3J0cy5zdGFydDIgPSBleHBvcnRzLmVuZCA9IGV4cG9ydHMuc3RhcnQgPSBleHBvcnRzLmludmFsaWQgPSB2b2lkIDA7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgVGVzdElucHV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QtaW5wdXRcIikpO1xuY29uc3QgVGVzdFdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtd29yZHNcIikpO1xuZXhwb3J0cy5pbnZhbGlkID0gZmFsc2U7XG5leHBvcnRzLmxhc3RTZWNvbmROb3RSb3VuZCA9IGZhbHNlO1xuZXhwb3J0cy5sYXN0VGVzdFdwbSA9IDA7XG5mdW5jdGlvbiBzZXRMYXN0VGVzdFdwbSh3cG0pIHtcbiAgICBleHBvcnRzLmxhc3RUZXN0V3BtID0gd3BtO1xufVxuZXhwb3J0cy5zZXRMYXN0VGVzdFdwbSA9IHNldExhc3RUZXN0V3BtO1xuZnVuY3Rpb24gZ2V0U3RhdHMoKSB7XG4gICAgY29uc3QgcmV0ID0ge1xuICAgICAgICBzdGFydDogZXhwb3J0cy5zdGFydCxcbiAgICAgICAgZW5kOiBleHBvcnRzLmVuZCxcbiAgICAgICAgd3BtSGlzdG9yeTogVGVzdElucHV0LndwbUhpc3RvcnksXG4gICAgICAgIHJhd0hpc3Rvcnk6IFRlc3RJbnB1dC53cG1IaXN0b3J5LFxuICAgICAgICBidXJzdEhpc3Rvcnk6IFRlc3RJbnB1dC5idXJzdEhpc3RvcnksXG4gICAgICAgIGtleXByZXNzUGVyU2Vjb25kOiBUZXN0SW5wdXQua2V5cHJlc3NQZXJTZWNvbmQsXG4gICAgICAgIGN1cnJlbnRLZXlwcmVzczogVGVzdElucHV0LmN1cnJlbnRLZXlwcmVzcyxcbiAgICAgICAgbGFzdEtleXByZXNzOiBUZXN0SW5wdXQubGFzdEtleXByZXNzLFxuICAgICAgICBjdXJyZW50QnVyc3RTdGFydDogVGVzdElucHV0LmN1cnJlbnRCdXJzdFN0YXJ0LFxuICAgICAgICBsYXN0U2Vjb25kTm90Um91bmQ6IGV4cG9ydHMubGFzdFNlY29uZE5vdFJvdW5kLFxuICAgICAgICBtaXNzZWRXb3JkczogVGVzdElucHV0Lm1pc3NlZFdvcmRzLFxuICAgICAgICBhY2N1cmFjeTogVGVzdElucHV0LmFjY3VyYWN5LFxuICAgICAgICBrZXlwcmVzc1RpbWluZ3M6IFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3MsXG4gICAgfTtcbiAgICB0cnkge1xuICAgICAgICByZXQua2V5U3BhY2luZ1N0YXRzID0ge1xuICAgICAgICAgICAgYXZlcmFnZTogVGVzdElucHV0LmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmFycmF5LnJlZHVjZSgocHJldmlvdXMsIGN1cnJlbnQpID0+IChjdXJyZW50ICs9IHByZXZpb3VzKSkgLyBUZXN0SW5wdXQua2V5cHJlc3NUaW1pbmdzLnNwYWNpbmcuYXJyYXkubGVuZ3RoLFxuICAgICAgICAgICAgc2Q6IE1pc2Muc3RkRGV2KFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3Muc3BhY2luZy5hcnJheSksXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIC8vXG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIHJldC5rZXlEdXJhdGlvblN0YXRzID0ge1xuICAgICAgICAgICAgYXZlcmFnZTogVGVzdElucHV0LmtleXByZXNzVGltaW5ncy5kdXJhdGlvbi5hcnJheS5yZWR1Y2UoKHByZXZpb3VzLCBjdXJyZW50KSA9PiAoY3VycmVudCArPSBwcmV2aW91cykpIC8gVGVzdElucHV0LmtleXByZXNzVGltaW5ncy5kdXJhdGlvbi5hcnJheS5sZW5ndGgsXG4gICAgICAgICAgICBzZDogTWlzYy5zdGREZXYoVGVzdElucHV0LmtleXByZXNzVGltaW5ncy5kdXJhdGlvbi5hcnJheSksXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIC8vXG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59XG5leHBvcnRzLmdldFN0YXRzID0gZ2V0U3RhdHM7XG5mdW5jdGlvbiByZXN0YXJ0KCkge1xuICAgIGV4cG9ydHMuc3RhcnQgPSAwO1xuICAgIGV4cG9ydHMuZW5kID0gMDtcbiAgICBleHBvcnRzLmludmFsaWQgPSBmYWxzZTtcbiAgICBleHBvcnRzLmxhc3RTZWNvbmROb3RSb3VuZCA9IGZhbHNlO1xufVxuZXhwb3J0cy5yZXN0YXJ0ID0gcmVzdGFydDtcbmV4cG9ydHMucmVzdGFydENvdW50ID0gMDtcbmV4cG9ydHMuaW5jb21wbGV0ZVNlY29uZHMgPSAwO1xuZnVuY3Rpb24gaW5jcmVtZW50UmVzdGFydENvdW50KCkge1xuICAgIGV4cG9ydHMucmVzdGFydENvdW50Kys7XG59XG5leHBvcnRzLmluY3JlbWVudFJlc3RhcnRDb3VudCA9IGluY3JlbWVudFJlc3RhcnRDb3VudDtcbmZ1bmN0aW9uIGluY3JlbWVudEluY29tcGxldGVTZWNvbmRzKHZhbCkge1xuICAgIGV4cG9ydHMuaW5jb21wbGV0ZVNlY29uZHMgKz0gdmFsO1xufVxuZXhwb3J0cy5pbmNyZW1lbnRJbmNvbXBsZXRlU2Vjb25kcyA9IGluY3JlbWVudEluY29tcGxldGVTZWNvbmRzO1xuZnVuY3Rpb24gcmVzZXRJbmNvbXBsZXRlKCkge1xuICAgIGV4cG9ydHMucmVzdGFydENvdW50ID0gMDtcbiAgICBleHBvcnRzLmluY29tcGxldGVTZWNvbmRzID0gMDtcbn1cbmV4cG9ydHMucmVzZXRJbmNvbXBsZXRlID0gcmVzZXRJbmNvbXBsZXRlO1xuZnVuY3Rpb24gc2V0SW52YWxpZCgpIHtcbiAgICBleHBvcnRzLmludmFsaWQgPSB0cnVlO1xufVxuZXhwb3J0cy5zZXRJbnZhbGlkID0gc2V0SW52YWxpZDtcbmZ1bmN0aW9uIGNhbGN1bGF0ZVRlc3RTZWNvbmRzKG5vdykge1xuICAgIGlmIChub3cgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb25zdCBlbmRBZmtTZWNvbmRzID0gKGV4cG9ydHMuZW5kIC0gVGVzdElucHV0Lmxhc3RLZXlwcmVzcykgLyAxMDAwO1xuICAgICAgICBpZiAoKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiIHx8IFRlc3RJbnB1dC5iYWlsb3V0KSAmJiBlbmRBZmtTZWNvbmRzIDwgNykge1xuICAgICAgICAgICAgcmV0dXJuIChUZXN0SW5wdXQubGFzdEtleXByZXNzIC0gZXhwb3J0cy5zdGFydCkgLyAxMDAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIChleHBvcnRzLmVuZCAtIGV4cG9ydHMuc3RhcnQpIC8gMTAwMDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIChub3cgLSBleHBvcnRzLnN0YXJ0KSAvIDEwMDA7XG4gICAgfVxufVxuZXhwb3J0cy5jYWxjdWxhdGVUZXN0U2Vjb25kcyA9IGNhbGN1bGF0ZVRlc3RTZWNvbmRzO1xuZnVuY3Rpb24gY2FsY3VsYXRlV3BtQW5kUmF3KCkge1xuICAgIGxldCBjaGFycyA9IDA7XG4gICAgbGV0IGNvcnJlY3RXb3JkQ2hhcnMgPSAwO1xuICAgIGxldCBzcGFjZXMgPSAwO1xuICAgIC8vY2hlY2sgaW5wdXQgaGlzdG9yeVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgVGVzdElucHV0LmlucHV0Lmhpc3RvcnkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3Qgd29yZCA9IGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiXG4gICAgICAgICAgICA/IFRlc3RJbnB1dC5pbnB1dC5nZXRIaXN0b3J5KGkpXG4gICAgICAgICAgICA6IFRlc3RXb3Jkcy53b3Jkcy5nZXQoaSk7XG4gICAgICAgIGlmIChUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKSA9PSB3b3JkKSB7XG4gICAgICAgICAgICAvL3RoZSB3b3JkIGlzIGNvcnJlY3RcbiAgICAgICAgICAgIC8vKzEgZm9yIHNwYWNlXG4gICAgICAgICAgICBjb3JyZWN0V29yZENoYXJzICs9IHdvcmQubGVuZ3RoO1xuICAgICAgICAgICAgaWYgKGkgPCBUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGggLSAxICYmXG4gICAgICAgICAgICAgICAgTWlzYy5nZXRMYXN0Q2hhcihUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKSkgIT09IFwiXFxuXCIpIHtcbiAgICAgICAgICAgICAgICBzcGFjZXMrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjaGFycyArPSBUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKS5sZW5ndGg7XG4gICAgfVxuICAgIGlmIChUZXN0SW5wdXQuaW5wdXQuY3VycmVudCAhPT0gXCJcIikge1xuICAgICAgICBjb25zdCB3b3JkID0gY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCJcbiAgICAgICAgICAgID8gVGVzdElucHV0LmlucHV0LmN1cnJlbnRcbiAgICAgICAgICAgIDogVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKTtcbiAgICAgICAgLy9jaGVjayB3aGF0cyBjdXJyZW50bHkgdHlwZWRcbiAgICAgICAgY29uc3QgdG9BZGQgPSB7XG4gICAgICAgICAgICBjb3JyZWN0OiAwLFxuICAgICAgICAgICAgaW5jb3JyZWN0OiAwLFxuICAgICAgICAgICAgbWlzc2VkOiAwLFxuICAgICAgICB9O1xuICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IHdvcmQubGVuZ3RoOyBjKyspIHtcbiAgICAgICAgICAgIGlmIChjIDwgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgLy9vbiBjaGFyIHRoYXQgc3RpbGwgaGFzIGEgd29yZCBsaXN0IHBhaXJcbiAgICAgICAgICAgICAgICBpZiAoVGVzdElucHV0LmlucHV0LmN1cnJlbnRbY10gPT0gd29yZFtjXSkge1xuICAgICAgICAgICAgICAgICAgICB0b0FkZC5jb3JyZWN0Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b0FkZC5pbmNvcnJlY3QrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL29uIGNoYXIgdGhhdCBpcyBleHRyYVxuICAgICAgICAgICAgICAgIHRvQWRkLm1pc3NlZCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNoYXJzICs9IHRvQWRkLmNvcnJlY3Q7XG4gICAgICAgIGNoYXJzICs9IHRvQWRkLmluY29ycmVjdDtcbiAgICAgICAgY2hhcnMgKz0gdG9BZGQubWlzc2VkO1xuICAgICAgICBpZiAodG9BZGQuaW5jb3JyZWN0ID09IDApIHtcbiAgICAgICAgICAgIC8vd29yZCBpcyBjb3JyZWN0IHNvIGZhciwgYWRkIGNoYXJzXG4gICAgICAgICAgICBjb3JyZWN0V29yZENoYXJzICs9IHRvQWRkLmNvcnJlY3Q7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcIm5vc3BhY2VcIiB8fCBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICBzcGFjZXMgPSAwO1xuICAgIH1cbiAgICBjaGFycyArPSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGg7XG4gICAgY29uc3QgdGVzdFNlY29uZHMgPSBjYWxjdWxhdGVUZXN0U2Vjb25kcyhwZXJmb3JtYW5jZS5ub3coKSk7XG4gICAgY29uc3Qgd3BtID0gTWF0aC5yb3VuZCgoKGNvcnJlY3RXb3JkQ2hhcnMgKyBzcGFjZXMpICogKDYwIC8gdGVzdFNlY29uZHMpKSAvIDUpO1xuICAgIGNvbnN0IHJhdyA9IE1hdGgucm91bmQoKChjaGFycyArIHNwYWNlcykgKiAoNjAgLyB0ZXN0U2Vjb25kcykpIC8gNSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgd3BtOiB3cG0sXG4gICAgICAgIHJhdzogcmF3LFxuICAgIH07XG59XG5leHBvcnRzLmNhbGN1bGF0ZVdwbUFuZFJhdyA9IGNhbGN1bGF0ZVdwbUFuZFJhdztcbmZ1bmN0aW9uIHNldEVuZChlKSB7XG4gICAgZXhwb3J0cy5lbmQgPSBlO1xuICAgIGV4cG9ydHMuZW5kMiA9IERhdGUubm93KCk7XG59XG5leHBvcnRzLnNldEVuZCA9IHNldEVuZDtcbmZ1bmN0aW9uIHNldFN0YXJ0KHMpIHtcbiAgICBleHBvcnRzLnN0YXJ0ID0gcztcbiAgICBleHBvcnRzLnN0YXJ0MiA9IERhdGUubm93KCk7XG59XG5leHBvcnRzLnNldFN0YXJ0ID0gc2V0U3RhcnQ7XG5mdW5jdGlvbiBjYWxjdWxhdGVBZmtTZWNvbmRzKHRlc3RTZWNvbmRzKSB7XG4gICAgbGV0IGV4dHJhQWZrID0gMDtcbiAgICBpZiAodGVzdFNlY29uZHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInRpbWVcIikge1xuICAgICAgICAgICAgZXh0cmFBZmsgPSBNYXRoLnJvdW5kKHRlc3RTZWNvbmRzKSAtIFRlc3RJbnB1dC5rZXlwcmVzc1BlclNlY29uZC5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBleHRyYUFmayA9IE1hdGguY2VpbCh0ZXN0U2Vjb25kcykgLSBUZXN0SW5wdXQua2V5cHJlc3NQZXJTZWNvbmQubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGlmIChleHRyYUFmayA8IDApXG4gICAgICAgICAgICBleHRyYUFmayA9IDA7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiLS0gZXh0cmEgYWZrIGRlYnVnXCIpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcInNob3VsZCBiZSBcIiArIE1hdGguY2VpbCh0ZXN0U2Vjb25kcykpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhrZXlwcmVzc1BlclNlY29uZC5sZW5ndGgpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcbiAgICAgICAgLy8gICBgZ29ubmEgYWRkIGV4dHJhICR7ZXh0cmFBZmt9IHNlY29uZHMgb2YgYWZrIGJlY2F1c2Ugb2Ygbm8ga2V5cHJlc3MgZGF0YWBcbiAgICAgICAgLy8gKTtcbiAgICB9XG4gICAgY29uc3QgcmV0ID0gVGVzdElucHV0LmtleXByZXNzUGVyU2Vjb25kLmZpbHRlcigoeCkgPT4geC5hZmspLmxlbmd0aDtcbiAgICByZXR1cm4gcmV0ICsgZXh0cmFBZms7XG59XG5leHBvcnRzLmNhbGN1bGF0ZUFma1NlY29uZHMgPSBjYWxjdWxhdGVBZmtTZWNvbmRzO1xuZnVuY3Rpb24gc2V0TGFzdFNlY29uZE5vdFJvdW5kKCkge1xuICAgIGV4cG9ydHMubGFzdFNlY29uZE5vdFJvdW5kID0gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0TGFzdFNlY29uZE5vdFJvdW5kID0gc2V0TGFzdFNlY29uZE5vdFJvdW5kO1xuZnVuY3Rpb24gY2FsY3VsYXRlQnVyc3QoKSB7XG4gICAgY29uc3QgdGltZVRvV3JpdGUgPSAocGVyZm9ybWFuY2Uubm93KCkgLSBUZXN0SW5wdXQuY3VycmVudEJ1cnN0U3RhcnQpIC8gMTAwMDtcbiAgICBsZXQgd29yZExlbmd0aDtcbiAgICB3b3JkTGVuZ3RoID0gVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoO1xuICAgIGlmICh3b3JkTGVuZ3RoID09IDApIHtcbiAgICAgICAgd29yZExlbmd0aCA9IFRlc3RJbnB1dC5pbnB1dC5nZXRIaXN0b3J5TGFzdCgpLmxlbmd0aDtcbiAgICB9XG4gICAgY29uc3Qgc3BlZWQgPSBNaXNjLnJvdW5kVG8yKCh3b3JkTGVuZ3RoICogKDYwIC8gdGltZVRvV3JpdGUpKSAvIDUpO1xuICAgIHJldHVybiBNYXRoLnJvdW5kKHNwZWVkKTtcbn1cbmV4cG9ydHMuY2FsY3VsYXRlQnVyc3QgPSBjYWxjdWxhdGVCdXJzdDtcbmZ1bmN0aW9uIGNhbGN1bGF0ZUFjY3VyYWN5KCkge1xuICAgIGNvbnN0IGFjYyA9IChUZXN0SW5wdXQuYWNjdXJhY3kuY29ycmVjdCAvXG4gICAgICAgIChUZXN0SW5wdXQuYWNjdXJhY3kuY29ycmVjdCArIFRlc3RJbnB1dC5hY2N1cmFjeS5pbmNvcnJlY3QpKSAqXG4gICAgICAgIDEwMDtcbiAgICByZXR1cm4gaXNOYU4oYWNjKSA/IDEwMCA6IGFjYztcbn1cbmV4cG9ydHMuY2FsY3VsYXRlQWNjdXJhY3kgPSBjYWxjdWxhdGVBY2N1cmFjeTtcbmZ1bmN0aW9uIHJlbW92ZUFma0RhdGEoKSB7XG4gICAgY29uc3QgdGVzdFNlY29uZHMgPSBjYWxjdWxhdGVUZXN0U2Vjb25kcygpO1xuICAgIFRlc3RJbnB1dC5rZXlwcmVzc1BlclNlY29uZC5zcGxpY2UodGVzdFNlY29uZHMpO1xuICAgIFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3MuZHVyYXRpb24uYXJyYXkuc3BsaWNlKHRlc3RTZWNvbmRzKTtcbiAgICBUZXN0SW5wdXQua2V5cHJlc3NUaW1pbmdzLnNwYWNpbmcuYXJyYXkuc3BsaWNlKHRlc3RTZWNvbmRzKTtcbiAgICBUZXN0SW5wdXQud3BtSGlzdG9yeS5zcGxpY2UodGVzdFNlY29uZHMpO1xufVxuZXhwb3J0cy5yZW1vdmVBZmtEYXRhID0gcmVtb3ZlQWZrRGF0YTtcbmZ1bmN0aW9uIGNvdW50Q2hhcnMoKSB7XG4gICAgbGV0IGNvcnJlY3RXb3JkQ2hhcnMgPSAwO1xuICAgIGxldCBjb3JyZWN0Q2hhcnMgPSAwO1xuICAgIGxldCBpbmNvcnJlY3RDaGFycyA9IDA7XG4gICAgbGV0IGV4dHJhQ2hhcnMgPSAwO1xuICAgIGxldCBtaXNzZWRDaGFycyA9IDA7XG4gICAgbGV0IHNwYWNlcyA9IDA7XG4gICAgbGV0IGNvcnJlY3RzcGFjZXMgPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgVGVzdElucHV0LmlucHV0Lmhpc3RvcnkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3Qgd29yZCA9IGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiXG4gICAgICAgICAgICA/IFRlc3RJbnB1dC5pbnB1dC5nZXRIaXN0b3J5KGkpXG4gICAgICAgICAgICA6IFRlc3RXb3Jkcy53b3Jkcy5nZXQoaSk7XG4gICAgICAgIGlmIChUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKSA9PT0gXCJcIikge1xuICAgICAgICAgICAgLy9sYXN0IHdvcmQgdGhhdCB3YXMgbm90IHN0YXJ0ZWRcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKSA9PSB3b3JkKSB7XG4gICAgICAgICAgICAvL3RoZSB3b3JkIGlzIGNvcnJlY3RcbiAgICAgICAgICAgIGNvcnJlY3RXb3JkQ2hhcnMgKz0gd29yZC5sZW5ndGg7XG4gICAgICAgICAgICBjb3JyZWN0Q2hhcnMgKz0gd29yZC5sZW5ndGg7XG4gICAgICAgICAgICBpZiAoaSA8IFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aCAtIDEgJiZcbiAgICAgICAgICAgICAgICBNaXNjLmdldExhc3RDaGFyKFRlc3RJbnB1dC5pbnB1dC5nZXRIaXN0b3J5KGkpKSAhPT0gXCJcXG5cIikge1xuICAgICAgICAgICAgICAgIGNvcnJlY3RzcGFjZXMrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKS5sZW5ndGggPj0gd29yZC5sZW5ndGgpIHtcbiAgICAgICAgICAgIC8vdG9vIG1hbnkgY2hhcnNcbiAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgVGVzdElucHV0LmlucHV0LmdldEhpc3RvcnkoaSkubGVuZ3RoOyBjKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoYyA8IHdvcmQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vb24gY2hhciB0aGF0IHN0aWxsIGhhcyBhIHdvcmQgbGlzdCBwYWlyXG4gICAgICAgICAgICAgICAgICAgIGlmIChUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKVtjXSA9PSB3b3JkW2NdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0Q2hhcnMrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluY29ycmVjdENoYXJzKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vb24gY2hhciB0aGF0IGlzIGV4dHJhXG4gICAgICAgICAgICAgICAgICAgIGV4dHJhQ2hhcnMrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvL25vdCBlbm91Z2ggY2hhcnNcbiAgICAgICAgICAgIGNvbnN0IHRvQWRkID0ge1xuICAgICAgICAgICAgICAgIGNvcnJlY3Q6IDAsXG4gICAgICAgICAgICAgICAgaW5jb3JyZWN0OiAwLFxuICAgICAgICAgICAgICAgIG1pc3NlZDogMCxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IHdvcmQubGVuZ3RoOyBjKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoYyA8IFRlc3RJbnB1dC5pbnB1dC5nZXRIaXN0b3J5KGkpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAvL29uIGNoYXIgdGhhdCBzdGlsbCBoYXMgYSB3b3JkIGxpc3QgcGFpclxuICAgICAgICAgICAgICAgICAgICBpZiAoVGVzdElucHV0LmlucHV0LmdldEhpc3RvcnkoaSlbY10gPT0gd29yZFtjXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9BZGQuY29ycmVjdCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9BZGQuaW5jb3JyZWN0Kys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vb24gY2hhciB0aGF0IGlzIGV4dHJhXG4gICAgICAgICAgICAgICAgICAgIHRvQWRkLm1pc3NlZCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvcnJlY3RDaGFycyArPSB0b0FkZC5jb3JyZWN0O1xuICAgICAgICAgICAgaW5jb3JyZWN0Q2hhcnMgKz0gdG9BZGQuaW5jb3JyZWN0O1xuICAgICAgICAgICAgaWYgKGkgPT09IFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aCAtIDEgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwidGltZVwiKSB7XG4gICAgICAgICAgICAgICAgLy9sYXN0IHdvcmQgLSBjaGVjayBpZiBpdCB3YXMgYWxsIGNvcnJlY3QgLSBhZGQgdG8gY29ycmVjdCB3b3JkIGNoYXJzXG4gICAgICAgICAgICAgICAgaWYgKHRvQWRkLmluY29ycmVjdCA9PT0gMClcbiAgICAgICAgICAgICAgICAgICAgY29ycmVjdFdvcmRDaGFycyArPSB0b0FkZC5jb3JyZWN0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbWlzc2VkQ2hhcnMgKz0gdG9BZGQubWlzc2VkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChpIDwgVGVzdElucHV0LmlucHV0Lmhpc3RvcnkubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgc3BhY2VzKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcIm5vc3BhY2VcIiB8fCBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICBzcGFjZXMgPSAwO1xuICAgICAgICBjb3JyZWN0c3BhY2VzID0gMDtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc3BhY2VzOiBzcGFjZXMsXG4gICAgICAgIGNvcnJlY3RXb3JkQ2hhcnM6IGNvcnJlY3RXb3JkQ2hhcnMsXG4gICAgICAgIGFsbENvcnJlY3RDaGFyczogY29ycmVjdENoYXJzLFxuICAgICAgICBpbmNvcnJlY3RDaGFyczogY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIgPyBUZXN0SW5wdXQuYWNjdXJhY3kuaW5jb3JyZWN0IDogaW5jb3JyZWN0Q2hhcnMsXG4gICAgICAgIGV4dHJhQ2hhcnM6IGV4dHJhQ2hhcnMsXG4gICAgICAgIG1pc3NlZENoYXJzOiBtaXNzZWRDaGFycyxcbiAgICAgICAgY29ycmVjdFNwYWNlczogY29ycmVjdHNwYWNlcyxcbiAgICB9O1xufVxuZnVuY3Rpb24gY2FsY3VsYXRlU3RhdHMoKSB7XG4gICAgbGV0IHRlc3RTZWNvbmRzID0gY2FsY3VsYXRlVGVzdFNlY29uZHMoKTtcbiAgICAvLyBjb25zb2xlLmxvZygoZW5kMiAtIHN0YXJ0MikgLyAxMDAwKTtcbiAgICAvLyBjb25zb2xlLmxvZyh0ZXN0U2Vjb25kcyk7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPSBcImN1c3RvbVwiKSB7XG4gICAgICAgIHRlc3RTZWNvbmRzID0gTWlzYy5yb3VuZFRvMih0ZXN0U2Vjb25kcyk7XG4gICAgfVxuICAgIGNvbnN0IGNoYXJzID0gY291bnRDaGFycygpO1xuICAgIGNvbnN0IHdwbSA9IE1pc2Mucm91bmRUbzIoKChjaGFycy5jb3JyZWN0V29yZENoYXJzICsgY2hhcnMuY29ycmVjdFNwYWNlcykgKiAoNjAgLyB0ZXN0U2Vjb25kcykpIC8gNSk7XG4gICAgY29uc3Qgd3BtcmF3ID0gTWlzYy5yb3VuZFRvMigoKGNoYXJzLmFsbENvcnJlY3RDaGFycyArXG4gICAgICAgIGNoYXJzLnNwYWNlcyArXG4gICAgICAgIGNoYXJzLmluY29ycmVjdENoYXJzICtcbiAgICAgICAgY2hhcnMuZXh0cmFDaGFycykgKlxuICAgICAgICAoNjAgLyB0ZXN0U2Vjb25kcykpIC9cbiAgICAgICAgNSk7XG4gICAgY29uc3QgYWNjID0gTWlzYy5yb3VuZFRvMihjYWxjdWxhdGVBY2N1cmFjeSgpKTtcbiAgICByZXR1cm4ge1xuICAgICAgICB3cG06IGlzTmFOKHdwbSkgPyAwIDogd3BtLFxuICAgICAgICB3cG1SYXc6IGlzTmFOKHdwbXJhdykgPyAwIDogd3BtcmF3LFxuICAgICAgICBhY2M6IGFjYyxcbiAgICAgICAgY29ycmVjdENoYXJzOiBjaGFycy5jb3JyZWN0V29yZENoYXJzLFxuICAgICAgICBpbmNvcnJlY3RDaGFyczogY2hhcnMuaW5jb3JyZWN0Q2hhcnMsXG4gICAgICAgIG1pc3NlZENoYXJzOiBjaGFycy5taXNzZWRDaGFycyxcbiAgICAgICAgZXh0cmFDaGFyczogY2hhcnMuZXh0cmFDaGFycyxcbiAgICAgICAgYWxsQ2hhcnM6IGNoYXJzLmFsbENvcnJlY3RDaGFycyArXG4gICAgICAgICAgICBjaGFycy5zcGFjZXMgK1xuICAgICAgICAgICAgY2hhcnMuaW5jb3JyZWN0Q2hhcnMgK1xuICAgICAgICAgICAgY2hhcnMuZXh0cmFDaGFycyxcbiAgICAgICAgdGltZTogTWlzYy5yb3VuZFRvMih0ZXN0U2Vjb25kcyksXG4gICAgICAgIHNwYWNlczogY2hhcnMuc3BhY2VzLFxuICAgICAgICBjb3JyZWN0U3BhY2VzOiBjaGFycy5jb3JyZWN0U3BhY2VzLFxuICAgIH07XG59XG5leHBvcnRzLmNhbGN1bGF0ZVN0YXRzID0gY2FsY3VsYXRlU3RhdHM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbi8vbW9zdCBvZiB0aGUgY29kZSBpcyB0aGFua3MgdG9cbi8vaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjk5NzE4OTgvaG93LXRvLWNyZWF0ZS1hbi1hY2N1cmF0ZS10aW1lci1pbi1qYXZhc2NyaXB0XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zdGFydCA9IGV4cG9ydHMuZ2V0VGltZXJTdGF0cyA9IGV4cG9ydHMuY2xlYXIgPSBleHBvcnRzLmVuYWJsZVRpbWVyRGVidWcgPSB2b2lkIDA7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBDdXN0b21UZXh0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2N1c3RvbS10ZXh0XCIpKTtcbmNvbnN0IFRpbWVyUHJvZ3Jlc3MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGltZXItcHJvZ3Jlc3NcIikpO1xuY29uc3QgTGl2ZVdwbSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9saXZlLXdwbVwiKSk7XG5jb25zdCBUZXN0U3RhdHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC1zdGF0c1wiKSk7XG5jb25zdCBUZXN0SW5wdXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC1pbnB1dFwiKSk7XG5jb25zdCBUZXN0V29yZHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC13b3Jkc1wiKSk7XG5jb25zdCBNb25rZXkgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbW9ua2V5XCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBDYXJldCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jYXJldFwiKSk7XG5jb25zdCBTbG93VGltZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9zbG93LXRpbWVyXCIpKTtcbmNvbnN0IFRlc3RBY3RpdmUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy90ZXN0LWFjdGl2ZVwiKSk7XG5jb25zdCBUaW1lID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvdGltZVwiKSk7XG5jb25zdCBUaW1lckV2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy90aW1lci1ldmVudFwiKSk7XG5sZXQgc2xvd1RpbWVyQ291bnQgPSAwO1xubGV0IHRpbWVyID0gbnVsbDtcbmNvbnN0IGludGVydmFsID0gMTAwMDtcbmxldCBleHBlY3RlZCA9IDA7XG5sZXQgdGltZXJEZWJ1ZyA9IGZhbHNlO1xuZnVuY3Rpb24gZW5hYmxlVGltZXJEZWJ1ZygpIHtcbiAgICB0aW1lckRlYnVnID0gdHJ1ZTtcbn1cbmV4cG9ydHMuZW5hYmxlVGltZXJEZWJ1ZyA9IGVuYWJsZVRpbWVyRGVidWc7XG5mdW5jdGlvbiBjbGVhcigpIHtcbiAgICBUaW1lLnNldCgwKTtcbiAgICBpZiAodGltZXIgIT09IG51bGwpXG4gICAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG59XG5leHBvcnRzLmNsZWFyID0gY2xlYXI7XG5mdW5jdGlvbiBwcmVtaWQoKSB7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZShcInByZW1pZFwiKTtcbiAgICBjb25zdCBwcmVtaWRTZWNvbmRzTGVmdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJlbWlkU2Vjb25kc0xlZnRcIik7XG4gICAgaWYgKHByZW1pZFNlY29uZHNMZWZ0ICE9PSBudWxsKSB7XG4gICAgICAgIHByZW1pZFNlY29uZHNMZWZ0LmlubmVySFRNTCA9IChjb25maWdfMS5kZWZhdWx0LnRpbWUgLSBUaW1lLmdldCgpKS50b1N0cmluZygpO1xuICAgIH1cbiAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgY29uc29sZS50aW1lRW5kKFwicHJlbWlkXCIpO1xufVxuZnVuY3Rpb24gdXBkYXRlVGltZXIoKSB7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZShcInRpbWVyIHByb2dyZXNzIHVwZGF0ZVwiKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInRpbWVcIiB8fFxuICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiICYmIEN1c3RvbVRleHQuaXNUaW1lUmFuZG9tKSkge1xuICAgICAgICBUaW1lclByb2dyZXNzLnVwZGF0ZSgpO1xuICAgIH1cbiAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgY29uc29sZS50aW1lRW5kKFwidGltZXIgcHJvZ3Jlc3MgdXBkYXRlXCIpO1xufVxuZnVuY3Rpb24gY2FsY3VsYXRlV3BtUmF3KCkge1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWUoXCJjYWxjdWxhdGUgd3BtIGFuZCByYXdcIik7XG4gICAgY29uc3Qgd3BtQW5kUmF3ID0gVGVzdFN0YXRzLmNhbGN1bGF0ZVdwbUFuZFJhdygpO1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWVFbmQoXCJjYWxjdWxhdGUgd3BtIGFuZCByYXdcIik7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZShcInVwZGF0ZSBsaXZlIHdwbVwiKTtcbiAgICBMaXZlV3BtLnVwZGF0ZSh3cG1BbmRSYXcud3BtLCB3cG1BbmRSYXcucmF3KTtcbiAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgY29uc29sZS50aW1lRW5kKFwidXBkYXRlIGxpdmUgd3BtXCIpO1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWUoXCJwdXNoIHRvIGhpc3RvcnlcIik7XG4gICAgVGVzdElucHV0LnB1c2hUb1dwbUhpc3Rvcnkod3BtQW5kUmF3LndwbSk7XG4gICAgVGVzdElucHV0LnB1c2hUb1Jhd0hpc3Rvcnkod3BtQW5kUmF3LnJhdyk7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZUVuZChcInB1c2ggdG8gaGlzdG9yeVwiKTtcbiAgICByZXR1cm4gd3BtQW5kUmF3O1xufVxuZnVuY3Rpb24gbW9ua2V5KHdwbUFuZFJhdykge1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWUoXCJ1cGRhdGUgbW9ua2V5XCIpO1xuICAgIGNvbnN0IG51bSA9IGNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlID8gd3BtQW5kUmF3LnJhdyA6IHdwbUFuZFJhdy53cG07XG4gICAgTW9ua2V5LnVwZGF0ZUZhc3RPcGFjaXR5KG51bSk7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZUVuZChcInVwZGF0ZSBtb25rZXlcIik7XG59XG5mdW5jdGlvbiBjYWxjdWxhdGVBY2MoKSB7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZShcImNhbGN1bGF0ZSBhY2NcIik7XG4gICAgY29uc3QgYWNjID0gTWlzYy5yb3VuZFRvMihUZXN0U3RhdHMuY2FsY3VsYXRlQWNjdXJhY3koKSk7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZUVuZChcImNhbGN1bGF0ZSBhY2NcIik7XG4gICAgcmV0dXJuIGFjYztcbn1cbmZ1bmN0aW9uIGxheW91dGZsdWlkKCkge1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWUoXCJsYXlvdXRmbHVpZFwiKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwibGF5b3V0Zmx1aWRcIiAmJiBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwidGltZVwiKSB7XG4gICAgICAgIGNvbnN0IGxheW91dHMgPSBjb25maWdfMS5kZWZhdWx0LmN1c3RvbUxheW91dGZsdWlkXG4gICAgICAgICAgICA/IGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tTGF5b3V0Zmx1aWQuc3BsaXQoXCIjXCIpXG4gICAgICAgICAgICA6IFtcInF3ZXJ0eVwiLCBcImR2b3Jha1wiLCBcImNvbGVtYWtcIl07XG4gICAgICAgIGNvbnN0IHN3aXRjaFRpbWUgPSBjb25maWdfMS5kZWZhdWx0LnRpbWUgLyBsYXlvdXRzLmxlbmd0aDtcbiAgICAgICAgY29uc3QgdGltZSA9IFRpbWUuZ2V0KCk7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gTWF0aC5mbG9vcih0aW1lIC8gc3dpdGNoVGltZSk7XG4gICAgICAgIGNvbnN0IGxheW91dCA9IGxheW91dHNbaW5kZXhdO1xuICAgICAgICBjb25zdCBmbG9vcmVkU3dpdGNoVGltZXMgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBsYXlvdXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBmbG9vcmVkU3dpdGNoVGltZXMucHVzaChNYXRoLmZsb29yKHN3aXRjaFRpbWUgKiBpKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZsb29yZWRTd2l0Y2hUaW1lcy5pbmNsdWRlcyh0aW1lICsgMykpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiM1wiLCAwLCAxKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChmbG9vcmVkU3dpdGNoVGltZXMuaW5jbHVkZXModGltZSArIDIpKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIjJcIiwgMCwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZmxvb3JlZFN3aXRjaFRpbWVzLmluY2x1ZGVzKHRpbWUgKyAxKSkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCIxXCIsIDAsIDEpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmxheW91dCAhPT0gbGF5b3V0ICYmIGxheW91dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgLS0tICEhISAke2xheW91dH0gISEhIC0tLWAsIDApO1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldExheW91dChsYXlvdXQsIHRydWUpO1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcExheW91dChsYXlvdXQsIHRydWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWVFbmQoXCJsYXlvdXRmbHVpZFwiKTtcbn1cbmZ1bmN0aW9uIGNoZWNrSWZGYWlsZWQod3BtQW5kUmF3LCBhY2MpIHtcbiAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgY29uc29sZS50aW1lKFwiZmFpbCBjb25kaXRpb25zXCIpO1xuICAgIFRlc3RJbnB1dC5wdXNoS2V5cHJlc3Nlc1RvSGlzdG9yeSgpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1pbldwbSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICB3cG1BbmRSYXcud3BtIDwgY29uZmlnXzEuZGVmYXVsdC5taW5XcG1DdXN0b21TcGVlZCAmJlxuICAgICAgICBUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4ID4gMykge1xuICAgICAgICBpZiAodGltZXIgIT09IG51bGwpXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgICBTbG93VGltZXIuY2xlYXIoKTtcbiAgICAgICAgc2xvd1RpbWVyQ291bnQgPSAwO1xuICAgICAgICBUaW1lckV2ZW50LmRpc3BhdGNoKFwiZmFpbFwiLCBcIm1pbiB3cG1cIik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubWluQWNjID09PSBcImN1c3RvbVwiICYmXG4gICAgICAgIGFjYyA8IGNvbmZpZ18xLmRlZmF1bHQubWluQWNjQ3VzdG9tICYmXG4gICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXggPiAzKSB7XG4gICAgICAgIGlmICh0aW1lciAhPT0gbnVsbClcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgICAgIFNsb3dUaW1lci5jbGVhcigpO1xuICAgICAgICBzbG93VGltZXJDb3VudCA9IDA7XG4gICAgICAgIFRpbWVyRXZlbnQuZGlzcGF0Y2goXCJmYWlsXCIsIFwibWluIGFjY3VyYWN5XCIpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWVFbmQoXCJmYWlsIGNvbmRpdGlvbnNcIik7XG59XG5mdW5jdGlvbiBjaGVja0lmVGltZUlzVXAoKSB7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZShcInRpbWVzIHVwIGNoZWNrXCIpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ0aW1lXCIgfHxcbiAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJiBDdXN0b21UZXh0LmlzVGltZVJhbmRvbSkpIHtcbiAgICAgICAgaWYgKChUaW1lLmdldCgpID49IGNvbmZpZ18xLmRlZmF1bHQudGltZSAmJlxuICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC50aW1lICE9PSAwICYmXG4gICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwidGltZVwiKSB8fFxuICAgICAgICAgICAgKFRpbWUuZ2V0KCkgPj0gQ3VzdG9tVGV4dC50aW1lICYmXG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC50aW1lICE9PSAwICYmXG4gICAgICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiKSkge1xuICAgICAgICAgICAgLy90aW1lcyB1cFxuICAgICAgICAgICAgaWYgKHRpbWVyICE9PSBudWxsKVxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgICAgICAgICBDYXJldC5oaWRlKCk7XG4gICAgICAgICAgICBUZXN0SW5wdXQuaW5wdXQucHVzaEhpc3RvcnkoKTtcbiAgICAgICAgICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQucHVzaEhpc3RvcnkoKTtcbiAgICAgICAgICAgIFNsb3dUaW1lci5jbGVhcigpO1xuICAgICAgICAgICAgc2xvd1RpbWVyQ291bnQgPSAwO1xuICAgICAgICAgICAgVGltZXJFdmVudC5kaXNwYXRjaChcImZpbmlzaFwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgY29uc29sZS50aW1lRW5kKFwidGltZXMgdXAgY2hlY2tcIik7XG59XG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmxldCB0aW1lclN0YXRzID0gW107XG5mdW5jdGlvbiBnZXRUaW1lclN0YXRzKCkge1xuICAgIHJldHVybiB0aW1lclN0YXRzO1xufVxuZXhwb3J0cy5nZXRUaW1lclN0YXRzID0gZ2V0VGltZXJTdGF0cztcbmZ1bmN0aW9uIHRpbWVyU3RlcCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgICAgIGNvbnNvbGUudGltZShcInRpbWVyIHN0ZXAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cIik7XG4gICAgICAgIFRpbWUuaW5jcmVtZW50KCk7XG4gICAgICAgIHByZW1pZCgpO1xuICAgICAgICB1cGRhdGVUaW1lcigpO1xuICAgICAgICBjb25zdCB3cG1BbmRSYXcgPSBjYWxjdWxhdGVXcG1SYXcoKTtcbiAgICAgICAgY29uc3QgYWNjID0gY2FsY3VsYXRlQWNjKCk7XG4gICAgICAgIG1vbmtleSh3cG1BbmRSYXcpO1xuICAgICAgICBsYXlvdXRmbHVpZCgpO1xuICAgICAgICBjaGVja0lmRmFpbGVkKHdwbUFuZFJhdywgYWNjKTtcbiAgICAgICAgY2hlY2tJZlRpbWVJc1VwKCk7XG4gICAgICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICAgICAgY29uc29sZS50aW1lRW5kKFwidGltZXIgc3RlcCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVwiKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHN0YXJ0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIFNsb3dUaW1lci5jbGVhcigpO1xuICAgICAgICBzbG93VGltZXJDb3VudCA9IDA7XG4gICAgICAgIHRpbWVyU3RhdHMgPSBbXTtcbiAgICAgICAgZXhwZWN0ZWQgPSBUZXN0U3RhdHMuc3RhcnQgKyBpbnRlcnZhbDtcbiAgICAgICAgKGZ1bmN0aW9uIGxvb3AoKSB7XG4gICAgICAgICAgICBjb25zdCBkZWxheSA9IGV4cGVjdGVkIC0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgICAgICB0aW1lclN0YXRzLnB1c2goe1xuICAgICAgICAgICAgICAgIGRhdGVOb3c6IERhdGUubm93KCksXG4gICAgICAgICAgICAgICAgbm93OiBwZXJmb3JtYW5jZS5ub3coKSxcbiAgICAgICAgICAgICAgICBleHBlY3RlZDogZXhwZWN0ZWQsXG4gICAgICAgICAgICAgICAgbmV4dERlbGF5OiBkZWxheSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwidGltZVwiICYmIGNvbmZpZ18xLmRlZmF1bHQudGltZSA8IDEzMCAmJiBjb25maWdfMS5kZWZhdWx0LnRpbWUgPiAwKSB8fFxuICAgICAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIiAmJiBjb25maWdfMS5kZWZhdWx0LndvcmRzIDwgMjUwICYmIGNvbmZpZ18xLmRlZmF1bHQud29yZHMgPiAwKSkge1xuICAgICAgICAgICAgICAgIGlmIChkZWxheSA8IGludGVydmFsIC8gMikge1xuICAgICAgICAgICAgICAgICAgICAvL3Nsb3cgdGltZXJcbiAgICAgICAgICAgICAgICAgICAgU2xvd1RpbWVyLnNldCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZGVsYXkgPCBpbnRlcnZhbCAvIDEwKSB7XG4gICAgICAgICAgICAgICAgICAgIHNsb3dUaW1lckNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzbG93VGltZXJDb3VudCA+IDUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2xvdyB0aW1lclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluY2x1ZGVzKFwiRWRnXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoJ1RoaXMgYmFkIHBlcmZvcm1hbmNlIGNvdWxkIGJlIGNhdXNlZCBieSBcImVmZmljaWVuY3kgbW9kZVwiIG9uIE1pY3Jvc29mdCBFZGdlLicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJTdG9wcGluZyB0aGUgdGVzdCBkdWUgdG8gYmFkIHBlcmZvcm1hbmNlLiBUaGlzIHdvdWxkIGNhdXNlIHRlc3QgY2FsY3VsYXRpb25zIHRvIGJlIGluY29ycmVjdC4gSWYgdGhpcyBoYXBwZW5zIGEgbG90LCBwbGVhc2UgcmVwb3J0IHRoaXMuXCIsIC0xKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFRpbWVyRXZlbnQuZGlzcGF0Y2goXCJmYWlsXCIsIFwic2xvdyB0aW1lclwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLy8gdGltZSsrO1xuICAgICAgICAgICAgICAgIGlmICghVGVzdEFjdGl2ZS5nZXQoKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGltZXIgIT09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgICAgICAgICAgICAgICBTbG93VGltZXIuY2xlYXIoKTtcbiAgICAgICAgICAgICAgICAgICAgc2xvd1RpbWVyQ291bnQgPSAwO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRpbWVyU3RlcCgpO1xuICAgICAgICAgICAgICAgIGV4cGVjdGVkICs9IGludGVydmFsO1xuICAgICAgICAgICAgICAgIGxvb3AoKTtcbiAgICAgICAgICAgIH0sIGRlbGF5KTtcbiAgICAgICAgfSkoKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc3RhcnQgPSBzdGFydDtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGlnaGxpZ2h0QmFkV29yZCA9IGV4cG9ydHMuYXBwbHlCdXJzdEhlYXRtYXAgPSBleHBvcnRzLnRvZ2dsZVJlc3VsdFdvcmRzID0gZXhwb3J0cy5hcnJhbmdlQ2hhcmFjdGVyc0xlZnRUb1JpZ2h0ID0gZXhwb3J0cy5hcnJhbmdlQ2hhcmFjdGVyc1JpZ2h0VG9MZWZ0ID0gZXhwb3J0cy5saW5lSnVtcCA9IGV4cG9ydHMudXBkYXRlV29yZEVsZW1lbnQgPSBleHBvcnRzLnNjcmVlbnNob3QgPSBleHBvcnRzLmNvbG9yZnVsID0gZXhwb3J0cy5mbGlwQ29sb3JzID0gZXhwb3J0cy5hZGRXb3JkID0gZXhwb3J0cy5zaG93V29yZHMgPSBleHBvcnRzLnVwZGF0ZUFjdGl2ZUVsZW1lbnQgPSBleHBvcnRzLmZvY3VzV29yZHMgPSBleHBvcnRzLnJlc2V0ID0gZXhwb3J0cy5zZXRSZXN1bHRDYWxjdWxhdGluZyA9IGV4cG9ydHMuc2V0VGVzdFJlc3RhcnRpbmcgPSBleHBvcnRzLnNldEFjdGl2ZVdvcmRUb3AgPSBleHBvcnRzLnNldEN1cnJlbnRXb3JkRWxlbWVudEluZGV4ID0gZXhwb3J0cy5zZXRSZXN1bHRWaXNpYmxlID0gZXhwb3J0cy5yZXN1bHRDYWxjdWxhdGluZyA9IGV4cG9ydHMuY3VycmVudFRlc3RMaW5lID0gZXhwb3J0cy5saW5lVHJhbnNpdGlvbiA9IGV4cG9ydHMudGVzdFJlc3RhcnRpbmdQcm9taXNlID0gZXhwb3J0cy50ZXN0UmVzdGFydGluZyA9IGV4cG9ydHMuYWN0aXZlV29yZFRvcCA9IGV4cG9ydHMucmVzdWx0VmlzaWJsZSA9IGV4cG9ydHMuY3VycmVudFdvcmRFbGVtZW50SW5kZXggPSB2b2lkIDA7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IFRoZW1lQ29sb3JzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy90aGVtZS1jb2xvcnNcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IFRlc3RXb3JkcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXdvcmRzXCIpKTtcbmNvbnN0IFRlc3RJbnB1dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LWlucHV0XCIpKTtcbmNvbnN0IEN1c3RvbVRleHQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY3VzdG9tLXRleHRcIikpO1xuY29uc3QgQ2FyZXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY2FyZXRcIikpO1xuY29uc3QgT3V0T2ZGb2N1cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9vdXQtb2YtZm9jdXNcIikpO1xuY29uc3QgUmVwbGF5ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3JlcGxheVwiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IFNsb3dUaW1lciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3Nsb3ctdGltZXJcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBmb3JtYXRfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiZGF0ZS1mbnMvZm9ybWF0XCIpKTtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi4vZmlyZWJhc2VcIik7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5LCBldmVudFZhbHVlKSA9PiB7XG4gICAgaWYgKGV2ZW50VmFsdWUgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgZXZlbnRWYWx1ZSAhPT0gXCJib29sZWFuXCIpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiZmxpcFRlc3RDb2xvcnNcIilcbiAgICAgICAgZmxpcENvbG9ycyhldmVudFZhbHVlKTtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiY29sb3JmdWxNb2RlXCIpXG4gICAgICAgIGNvbG9yZnVsKGV2ZW50VmFsdWUpO1xuICAgIGlmIChldmVudEtleSA9PT0gXCJoaWdobGlnaHRNb2RlXCIpXG4gICAgICAgIHVwZGF0ZVdvcmRFbGVtZW50KGV2ZW50VmFsdWUpO1xuICAgIGlmIChldmVudEtleSA9PT0gXCJidXJzdEhlYXRtYXBcIilcbiAgICAgICAgYXBwbHlCdXJzdEhlYXRtYXAoKTtcbn0pO1xuZXhwb3J0cy5jdXJyZW50V29yZEVsZW1lbnRJbmRleCA9IDA7XG5leHBvcnRzLnJlc3VsdFZpc2libGUgPSBmYWxzZTtcbmV4cG9ydHMuYWN0aXZlV29yZFRvcCA9IDA7XG5leHBvcnRzLnRlc3RSZXN0YXJ0aW5nID0gZmFsc2U7XG5leHBvcnRzLmxpbmVUcmFuc2l0aW9uID0gZmFsc2U7XG5leHBvcnRzLmN1cnJlbnRUZXN0TGluZSA9IDA7XG5leHBvcnRzLnJlc3VsdENhbGN1bGF0aW5nID0gZmFsc2U7XG5mdW5jdGlvbiBzZXRSZXN1bHRWaXNpYmxlKHZhbCkge1xuICAgIGV4cG9ydHMucmVzdWx0VmlzaWJsZSA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0UmVzdWx0VmlzaWJsZSA9IHNldFJlc3VsdFZpc2libGU7XG5mdW5jdGlvbiBzZXRDdXJyZW50V29yZEVsZW1lbnRJbmRleCh2YWwpIHtcbiAgICBleHBvcnRzLmN1cnJlbnRXb3JkRWxlbWVudEluZGV4ID0gdmFsO1xufVxuZXhwb3J0cy5zZXRDdXJyZW50V29yZEVsZW1lbnRJbmRleCA9IHNldEN1cnJlbnRXb3JkRWxlbWVudEluZGV4O1xuZnVuY3Rpb24gc2V0QWN0aXZlV29yZFRvcCh2YWwpIHtcbiAgICBleHBvcnRzLmFjdGl2ZVdvcmRUb3AgPSB2YWw7XG59XG5leHBvcnRzLnNldEFjdGl2ZVdvcmRUb3AgPSBzZXRBY3RpdmVXb3JkVG9wO1xubGV0IHJlc3RhcnRpbmdSZXNvbHZlO1xuZnVuY3Rpb24gc2V0VGVzdFJlc3RhcnRpbmcodmFsKSB7XG4gICAgZXhwb3J0cy50ZXN0UmVzdGFydGluZyA9IHZhbDtcbiAgICBpZiAodmFsID09PSB0cnVlKSB7XG4gICAgICAgIGV4cG9ydHMudGVzdFJlc3RhcnRpbmdQcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgIHJlc3RhcnRpbmdSZXNvbHZlID0gcmVzb2x2ZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAocmVzdGFydGluZ1Jlc29sdmUpXG4gICAgICAgICAgICByZXN0YXJ0aW5nUmVzb2x2ZSgpO1xuICAgICAgICByZXN0YXJ0aW5nUmVzb2x2ZSA9IG51bGw7XG4gICAgfVxufVxuZXhwb3J0cy5zZXRUZXN0UmVzdGFydGluZyA9IHNldFRlc3RSZXN0YXJ0aW5nO1xuZnVuY3Rpb24gc2V0UmVzdWx0Q2FsY3VsYXRpbmcodmFsKSB7XG4gICAgZXhwb3J0cy5yZXN1bHRDYWxjdWxhdGluZyA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0UmVzdWx0Q2FsY3VsYXRpbmcgPSBzZXRSZXN1bHRDYWxjdWxhdGluZztcbmZ1bmN0aW9uIHJlc2V0KCkge1xuICAgIGV4cG9ydHMuY3VycmVudFRlc3RMaW5lID0gMDtcbiAgICBleHBvcnRzLmN1cnJlbnRXb3JkRWxlbWVudEluZGV4ID0gMDtcbn1cbmV4cG9ydHMucmVzZXQgPSByZXNldDtcbmZ1bmN0aW9uIGZvY3VzV29yZHMoKSB7XG4gICAgaWYgKCEkKFwiI3dvcmRzV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI3dvcmRzSW5wdXRcIikudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgIH1cbn1cbmV4cG9ydHMuZm9jdXNXb3JkcyA9IGZvY3VzV29yZHM7XG5mdW5jdGlvbiB1cGRhdGVBY3RpdmVFbGVtZW50KGJhY2tzcGFjZSkge1xuICAgIGNvbnN0IGFjdGl2ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjd29yZHMgLmFjdGl2ZVwiKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIgJiYgYmFja3NwYWNlKSB7XG4gICAgICAgIGFjdGl2ZSA9PT0gbnVsbCB8fCBhY3RpdmUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFjdGl2ZS5yZW1vdmUoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoYWN0aXZlICE9PSBudWxsKSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmhpZ2hsaWdodE1vZGUgPT0gXCJ3b3JkXCIpIHtcbiAgICAgICAgICAgIGFjdGl2ZS5xdWVyeVNlbGVjdG9yQWxsKFwibGV0dGVyXCIpLmZvckVhY2goKGUpID0+IHtcbiAgICAgICAgICAgICAgICBlLmNsYXNzTGlzdC5yZW1vdmUoXCJjb3JyZWN0XCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgYWN0aXZlLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIik7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVdvcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiI3dvcmRzIC53b3JkXCIpW2V4cG9ydHMuY3VycmVudFdvcmRFbGVtZW50SW5kZXhdO1xuICAgICAgICBhY3RpdmVXb3JkLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG4gICAgICAgIGFjdGl2ZVdvcmQuY2xhc3NMaXN0LnJlbW92ZShcImVycm9yXCIpO1xuICAgICAgICBleHBvcnRzLmFjdGl2ZVdvcmRUb3AgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3dvcmRzIC5hY3RpdmVcIilcbiAgICAgICAgICAgIC5vZmZzZXRUb3A7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmhpZ2hsaWdodE1vZGUgPT0gXCJ3b3JkXCIpIHtcbiAgICAgICAgICAgIGFjdGl2ZVdvcmQucXVlcnlTZWxlY3RvckFsbChcImxldHRlclwiKS5mb3JFYWNoKChlKSA9PiB7XG4gICAgICAgICAgICAgICAgZS5jbGFzc0xpc3QuYWRkKFwiY29ycmVjdFwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlKSB7IH1cbn1cbmV4cG9ydHMudXBkYXRlQWN0aXZlRWxlbWVudCA9IHVwZGF0ZUFjdGl2ZUVsZW1lbnQ7XG5mdW5jdGlvbiBnZXRXb3JkSFRNTCh3b3JkKSB7XG4gICAgbGV0IG5ld2xpbmVhZnRlciA9IGZhbHNlO1xuICAgIGxldCByZXR2YWwgPSBgPGRpdiBjbGFzcz0nd29yZCc+YDtcbiAgICBmb3IgKGxldCBjID0gMDsgYyA8IHdvcmQubGVuZ3RoOyBjKyspIHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcImFycm93c1wiKSB7XG4gICAgICAgICAgICBpZiAod29yZC5jaGFyQXQoYykgPT09IFwi4oaRXCIpIHtcbiAgICAgICAgICAgICAgICByZXR2YWwgKz0gYDxsZXR0ZXI+PGkgY2xhc3M9XCJmYXMgZmEtYXJyb3ctdXBcIj48L2k+PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh3b3JkLmNoYXJBdChjKSA9PT0gXCLihpNcIikge1xuICAgICAgICAgICAgICAgIHJldHZhbCArPSBgPGxldHRlcj48aSBjbGFzcz1cImZhcyBmYS1hcnJvdy1kb3duXCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAod29yZC5jaGFyQXQoYykgPT09IFwi4oaQXCIpIHtcbiAgICAgICAgICAgICAgICByZXR2YWwgKz0gYDxsZXR0ZXI+PGkgY2xhc3M9XCJmYXMgZmEtYXJyb3ctbGVmdFwiPjwvaT48L2xldHRlcj5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHdvcmQuY2hhckF0KGMpID09PSBcIuKGklwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dmFsICs9IGA8bGV0dGVyPjxpIGNsYXNzPVwiZmFzIGZhLWFycm93LXJpZ2h0XCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAod29yZC5jaGFyQXQoYykgPT09IFwiXFx0XCIpIHtcbiAgICAgICAgICAgIHJldHZhbCArPSBgPGxldHRlciBjbGFzcz0ndGFiQ2hhcic+PGkgY2xhc3M9XCJmYXMgZmEtbG9uZy1hcnJvdy1hbHQtcmlnaHRcIj48L2k+PC9sZXR0ZXI+YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh3b3JkLmNoYXJBdChjKSA9PT0gXCJcXG5cIikge1xuICAgICAgICAgICAgbmV3bGluZWFmdGVyID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHZhbCArPSBgPGxldHRlciBjbGFzcz0nbmxDaGFyJz48aSBjbGFzcz1cImZhcyBmYS1hbmdsZS1kb3duXCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR2YWwgKz0gXCI8bGV0dGVyPlwiICsgd29yZC5jaGFyQXQoYykgKyBcIjwvbGV0dGVyPlwiO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHZhbCArPSBcIjwvZGl2PlwiO1xuICAgIGlmIChuZXdsaW5lYWZ0ZXIpXG4gICAgICAgIHJldHZhbCArPSBcIjxkaXYgY2xhc3M9J25ld2xpbmUnPjwvZGl2PlwiO1xuICAgIHJldHVybiByZXR2YWw7XG59XG5mdW5jdGlvbiBzaG93V29yZHMoKSB7XG4gICAgJChcIiN3b3Jkc1wiKS5lbXB0eSgpO1xuICAgIGxldCB3b3Jkc0hUTUwgPSBcIlwiO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT09IFwiemVuXCIpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBUZXN0V29yZHMud29yZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHdvcmRzSFRNTCArPSBnZXRXb3JkSFRNTChUZXN0V29yZHMud29yZHMuZ2V0KGkpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgd29yZHNIVE1MID1cbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwid29yZFwiPndvcmQgaGVpZ2h0PC9kaXY+PGRpdiBjbGFzcz1cIndvcmQgYWN0aXZlXCI+PC9kaXY+JztcbiAgICB9XG4gICAgJChcIiN3b3Jkc1wiKS5odG1sKHdvcmRzSFRNTCk7XG4gICAgJChcIiN3b3Jkc1dyYXBwZXJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgY29uc3Qgd29yZEhlaWdodCA9ICgkKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIud29yZFwiKSkub3V0ZXJIZWlnaHQodHJ1ZSkpO1xuICAgIGNvbnN0IHdvcmRzSGVpZ2h0ID0gKCQoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN3b3Jkc1wiKSkub3V0ZXJIZWlnaHQodHJ1ZSkpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnNob3dBbGxMaW5lcyAmJlxuICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT0gXCJ0aW1lXCIgJiZcbiAgICAgICAgIShDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJiBDdXN0b21UZXh0LndvcmQgPT0gMCkgJiZcbiAgICAgICAgIUN1c3RvbVRleHQuaXNUaW1lUmFuZG9tKSB7XG4gICAgICAgICQoXCIjd29yZHNcIikuY3NzKFwiaGVpZ2h0XCIsIFwiYXV0b1wiKTtcbiAgICAgICAgJChcIiN3b3Jkc1dyYXBwZXJcIikuY3NzKFwiaGVpZ2h0XCIsIFwiYXV0b1wiKTtcbiAgICAgICAgbGV0IG5oID0gd29yZEhlaWdodCAqIDM7XG4gICAgICAgIGlmIChuaCA+IHdvcmRzSGVpZ2h0KSB7XG4gICAgICAgICAgICBuaCA9IHdvcmRzSGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgICQoXCIub3V0T2ZGb2N1c1dhcm5pbmdcIikuY3NzKFwibGluZS1oZWlnaHRcIiwgbmggKyBcInB4XCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiN3b3Jkc1wiKVxuICAgICAgICAgICAgLmNzcyhcImhlaWdodFwiLCB3b3JkSGVpZ2h0ICogNCArIFwicHhcIilcbiAgICAgICAgICAgIC5jc3MoXCJvdmVyZmxvd1wiLCBcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiN3b3Jkc1dyYXBwZXJcIilcbiAgICAgICAgICAgIC5jc3MoXCJoZWlnaHRcIiwgd29yZEhlaWdodCAqIDMgKyBcInB4XCIpXG4gICAgICAgICAgICAuY3NzKFwib3ZlcmZsb3dcIiwgXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIub3V0T2ZGb2N1c1dhcm5pbmdcIikuY3NzKFwibGluZS1oZWlnaHRcIiwgd29yZEhlaWdodCAqIDMgKyBcInB4XCIpO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInplblwiKSB7XG4gICAgICAgICQoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi53b3JkXCIpKS5yZW1vdmUoKTtcbiAgICB9XG4gICAgdXBkYXRlQWN0aXZlRWxlbWVudCgpO1xuICAgIENhcmV0LnVwZGF0ZVBvc2l0aW9uKCk7XG59XG5leHBvcnRzLnNob3dXb3JkcyA9IHNob3dXb3JkcztcbmZ1bmN0aW9uIGFkZFdvcmQod29yZCkge1xuICAgICQoXCIjd29yZHNcIikuYXBwZW5kKGdldFdvcmRIVE1MKHdvcmQpKTtcbn1cbmV4cG9ydHMuYWRkV29yZCA9IGFkZFdvcmQ7XG5mdW5jdGlvbiBmbGlwQ29sb3JzKHRmKSB7XG4gICAgaWYgKHRmKSB7XG4gICAgICAgICQoXCIjd29yZHNcIikuYWRkQ2xhc3MoXCJmbGlwcGVkXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcImZsaXBwZWRcIik7XG4gICAgfVxufVxuZXhwb3J0cy5mbGlwQ29sb3JzID0gZmxpcENvbG9ycztcbmZ1bmN0aW9uIGNvbG9yZnVsKHRjKSB7XG4gICAgaWYgKHRjKSB7XG4gICAgICAgICQoXCIjd29yZHNcIikuYWRkQ2xhc3MoXCJjb2xvcmZ1bE1vZGVcIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiI3dvcmRzXCIpLnJlbW92ZUNsYXNzKFwiY29sb3JmdWxNb2RlXCIpO1xuICAgIH1cbn1cbmV4cG9ydHMuY29sb3JmdWwgPSBjb2xvcmZ1bDtcbmZ1bmN0aW9uIHNjcmVlbnNob3QoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgbGV0IHJldmVhbFJlcGxheSA9IGZhbHNlO1xuICAgICAgICBmdW5jdGlvbiByZXZlcnRTY3JlZW5zaG90KCkge1xuICAgICAgICAgICAgJChcIiNub3RpZmljYXRpb25DZW50ZXJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiI2NvbW1hbmRMaW5lTW9iaWxlQnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAuc3NXYXRlcm1hcmtcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0IC5zc1dhdGVybWFya1wiKS50ZXh0KFwibW9ua2V5dHlwZS5jb21cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0IC5idXR0b25zXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgaWYgKHJldmVhbFJlcGxheSlcbiAgICAgICAgICAgICAgICAkKFwiI3Jlc3VsdFJlcGxheVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICQoXCIucGFnZVRlc3QgLmxvZ2luVGlwXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghJChcIiNyZXN1bHRSZXBsYXlcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgICAgIHJldmVhbFJlcGxheSA9IHRydWU7XG4gICAgICAgICAgICBSZXBsYXkucGF1c2VSZXBsYXkoKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkYXRlTm93ID0gbmV3IERhdGUoRGF0ZS5ub3coKSk7XG4gICAgICAgICQoXCIjcmVzdWx0UmVwbGF5XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiLnBhZ2VUZXN0IC5zc1dhdGVybWFya1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIi5wYWdlVGVzdCAuc3NXYXRlcm1hcmtcIikudGV4dCgoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZU5vdywgXCJkZCBNTU0geXl5eSBISDptbVwiKSArIFwiIHwgbW9ua2V5dHlwZS5jb20gXCIpO1xuICAgICAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyICE9IG51bGwpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgLnNzV2F0ZXJtYXJrXCIpLnRleHQoREIuZ2V0U25hcHNob3QoKS5uYW1lICtcbiAgICAgICAgICAgICAgICBcIiB8IFwiICtcbiAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZU5vdywgXCJkZCBNTU0geXl5eSBISDptbVwiKSArXG4gICAgICAgICAgICAgICAgXCIgfCBtb25rZXl0eXBlLmNvbSAgXCIpO1xuICAgICAgICB9XG4gICAgICAgICQoXCIucGFnZVRlc3QgLmJ1dHRvbnNcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIGNvbnN0IHNyYyA9ICQoXCIjbWlkZGxlXCIpO1xuICAgICAgICBjb25zdCBzb3VyY2VYID0gc3JjLnBvc2l0aW9uKCkubGVmdDsgLypYIHBvc2l0aW9uIGZyb20gZGl2I3RhcmdldCovXG4gICAgICAgIGNvbnN0IHNvdXJjZVkgPSBzcmMucG9zaXRpb24oKS50b3A7IC8qWSBwb3NpdGlvbiBmcm9tIGRpdiN0YXJnZXQqL1xuICAgICAgICBjb25zdCBzb3VyY2VXaWR0aCA9IChzcmMub3V0ZXJXaWR0aCh0cnVlKSk7IC8qY2xpZW50V2lkdGgvb2Zmc2V0V2lkdGggZnJvbSBkaXYjdGFyZ2V0Ki9cbiAgICAgICAgY29uc3Qgc291cmNlSGVpZ2h0ID0gKHNyYy5vdXRlckhlaWdodCh0cnVlKSk7IC8qY2xpZW50SGVpZ2h0L29mZnNldEhlaWdodCBmcm9tIGRpdiN0YXJnZXQqL1xuICAgICAgICAkKFwiI25vdGlmaWNhdGlvbkNlbnRlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiNjb21tYW5kTGluZU1vYmlsZUJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIi5wYWdlVGVzdCAubG9naW5UaXBcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBwYWRkaW5nWCA9IDUwO1xuICAgICAgICAgICAgY29uc3QgcGFkZGluZ1kgPSAyNTtcbiAgICAgICAgICAgIGh0bWwyY2FudmFzKGRvY3VtZW50LmJvZHksIHtcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHlpZWxkIFRoZW1lQ29sb3JzLmdldChcImJnXCIpLFxuICAgICAgICAgICAgICAgIHdpZHRoOiBzb3VyY2VXaWR0aCArIHBhZGRpbmdYICogMixcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHNvdXJjZUhlaWdodCArIHBhZGRpbmdZICogMixcbiAgICAgICAgICAgICAgICB4OiBzb3VyY2VYIC0gcGFkZGluZ1gsXG4gICAgICAgICAgICAgICAgeTogc291cmNlWSAtIHBhZGRpbmdZLFxuICAgICAgICAgICAgfSkudGhlbigoY2FudmFzKSA9PiB7XG4gICAgICAgICAgICAgICAgY2FudmFzLnRvQmxvYigoYmxvYikgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2IgPT09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwiZmlyZWZveFwiKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbihVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXZlcnRTY3JlZW5zaG90KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC53cml0ZShbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBDbGlwYm9hcmRJdGVtKE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwgYmxvYi50eXBlLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYmxvYixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ29waWVkIHRvIGNsaXBib2FyZFwiLCAxLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2ZXJ0U2NyZWVuc2hvdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVycm9yIHNhdmluZyBpbWFnZSB0byBjbGlwYm9hcmQ6IFwiICsgZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXZlcnRTY3JlZW5zaG90KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVycm9yIGNyZWF0aW5nIGltYWdlOiBcIiArIGUubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgcmV2ZXJ0U2NyZWVuc2hvdCgpO1xuICAgICAgICB9XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgcmV2ZXJ0U2NyZWVuc2hvdCgpO1xuICAgICAgICB9LCAzMDAwKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc2NyZWVuc2hvdCA9IHNjcmVlbnNob3Q7XG5mdW5jdGlvbiB1cGRhdGVXb3JkRWxlbWVudChzaG93RXJyb3IgPSAhY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUpIHtcbiAgICBjb25zdCBpbnB1dCA9IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50O1xuICAgIGNvbnN0IHdvcmRBdEluZGV4ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN3b3JkcyAud29yZC5hY3RpdmVcIik7XG4gICAgY29uc3QgY3VycmVudFdvcmQgPSBUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpO1xuICAgIGlmICghY3VycmVudFdvcmQgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9PSBcInplblwiKVxuICAgICAgICByZXR1cm47XG4gICAgbGV0IHJldCA9IFwiXCI7XG4gICAgbGV0IG5ld2xpbmVhZnRlciA9IGZhbHNlO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiemVuXCIpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50W2ldID09PSBcIlxcdFwiKSB7XG4gICAgICAgICAgICAgICAgcmV0ICs9IGA8bGV0dGVyIGNsYXNzPSd0YWJDaGFyIGNvcnJlY3QnIHN0eWxlPVwib3BhY2l0eTogMFwiPjxpIGNsYXNzPVwiZmFzIGZhLWxvbmctYXJyb3ctYWx0LXJpZ2h0XCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChUZXN0SW5wdXQuaW5wdXQuY3VycmVudFtpXSA9PT0gXCJcXG5cIikge1xuICAgICAgICAgICAgICAgIG5ld2xpbmVhZnRlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmV0ICs9IGA8bGV0dGVyIGNsYXNzPSdubENoYXIgY29ycmVjdCcgc3R5bGU9XCJvcGFjaXR5OiAwXCI+PGkgY2xhc3M9XCJmYXMgZmEtYW5nbGUtZG93blwiPjwvaT48L2xldHRlcj5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0ICs9IGA8bGV0dGVyIGNsYXNzPVwiY29ycmVjdFwiPiR7VGVzdElucHV0LmlucHV0LmN1cnJlbnRbaV19PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgbGV0IGNvcnJlY3RTb0ZhciA9IGZhbHNlO1xuICAgICAgICAvLyBzbGljZSBlYXJsaWVyIGlmIGlucHV0IGhhcyB0cmFpbGluZyBjb21wb3NlIGNoYXJhY3RlcnNcbiAgICAgICAgY29uc3QgaW5wdXRXaXRob3V0Q29tcG9zZUxlbmd0aCA9IE1pc2MudHJhaWxpbmdDb21wb3NlQ2hhcnMudGVzdChpbnB1dClcbiAgICAgICAgICAgID8gaW5wdXQuc2VhcmNoKE1pc2MudHJhaWxpbmdDb21wb3NlQ2hhcnMpXG4gICAgICAgICAgICA6IGlucHV0Lmxlbmd0aDtcbiAgICAgICAgaWYgKGlucHV0LnNlYXJjaChNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzKSA8IGN1cnJlbnRXb3JkLmxlbmd0aCAmJlxuICAgICAgICAgICAgY3VycmVudFdvcmQuc2xpY2UoMCwgaW5wdXRXaXRob3V0Q29tcG9zZUxlbmd0aCkgPT09XG4gICAgICAgICAgICAgICAgaW5wdXQuc2xpY2UoMCwgaW5wdXRXaXRob3V0Q29tcG9zZUxlbmd0aCkpIHtcbiAgICAgICAgICAgIGNvcnJlY3RTb0ZhciA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHdvcmRIaWdobGlnaHRDbGFzc1N0cmluZyA9IGNvcnJlY3RTb0ZhciA/IFwiY29ycmVjdFwiIDogXCJpbmNvcnJlY3RcIjtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlKSB7XG4gICAgICAgICAgICB3b3JkSGlnaGxpZ2h0Q2xhc3NTdHJpbmcgPSBcImNvcnJlY3RcIjtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlucHV0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBjaGFyQ29ycmVjdCA9IGN1cnJlbnRXb3JkW2ldID09IGlucHV0W2ldO1xuICAgICAgICAgICAgbGV0IGNvcnJlY3RDbGFzcyA9IFwiY29ycmVjdFwiO1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuaGlnaGxpZ2h0TW9kZSA9PSBcIm9mZlwiKSB7XG4gICAgICAgICAgICAgICAgY29ycmVjdENsYXNzID0gXCJcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBjdXJyZW50TGV0dGVyID0gY3VycmVudFdvcmRbaV07XG4gICAgICAgICAgICBsZXQgdGFiQ2hhciA9IFwiXCI7XG4gICAgICAgICAgICBsZXQgbmxDaGFyID0gXCJcIjtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50TGV0dGVyID09PSBcIuKGkVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMZXR0ZXIgPSBgPGkgY2xhc3M9XCJmYXMgZmEtYXJyb3ctdXBcIj48L2k+YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRMZXR0ZXIgPT09IFwi4oaTXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudExldHRlciA9IGA8aSBjbGFzcz1cImZhcyBmYS1hcnJvdy1kb3duXCI+PC9pPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50TGV0dGVyID09PSBcIuKGkFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMZXR0ZXIgPSBgPGkgY2xhc3M9XCJmYXMgZmEtYXJyb3ctbGVmdFwiPjwvaT5gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudExldHRlciA9PT0gXCLihpJcIikge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGV0dGVyID0gYDxpIGNsYXNzPVwiZmFzIGZhLWFycm93LXJpZ2h0XCI+PC9pPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudExldHRlciA9PT0gXCJcXHRcIikge1xuICAgICAgICAgICAgICAgIHRhYkNoYXIgPSBcInRhYkNoYXJcIjtcbiAgICAgICAgICAgICAgICBjdXJyZW50TGV0dGVyID0gYDxpIGNsYXNzPVwiZmFzIGZhLWxvbmctYXJyb3ctYWx0LXJpZ2h0XCI+PC9pPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50TGV0dGVyID09PSBcIlxcblwiKSB7XG4gICAgICAgICAgICAgICAgbmxDaGFyID0gXCJubENoYXJcIjtcbiAgICAgICAgICAgICAgICBjdXJyZW50TGV0dGVyID0gYDxpIGNsYXNzPVwiZmFzIGZhLWFuZ2xlLWRvd25cIj48L2k+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzLnRlc3QoaW5wdXQpICYmXG4gICAgICAgICAgICAgICAgaSA+IGlucHV0LnNlYXJjaChNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzKSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNoYXJDb3JyZWN0KSB7XG4gICAgICAgICAgICAgICAgcmV0ICs9IGA8bGV0dGVyIGNsYXNzPVwiJHtjb25maWdfMS5kZWZhdWx0LmhpZ2hsaWdodE1vZGUgPT0gXCJ3b3JkXCJcbiAgICAgICAgICAgICAgICAgICAgPyB3b3JkSGlnaGxpZ2h0Q2xhc3NTdHJpbmdcbiAgICAgICAgICAgICAgICAgICAgOiBjb3JyZWN0Q2xhc3N9ICR7dGFiQ2hhcn0ke25sQ2hhcn1cIj4ke2N1cnJlbnRMZXR0ZXJ9PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRMZXR0ZXIgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgICAgICAgIE1pc2MudHJhaWxpbmdDb21wb3NlQ2hhcnMudGVzdChpbnB1dCkgJiZcbiAgICAgICAgICAgICAgICBpID09PSBpbnB1dC5zZWFyY2goTWlzYy50cmFpbGluZ0NvbXBvc2VDaGFycykpIHtcbiAgICAgICAgICAgICAgICByZXQgKz0gYDxsZXR0ZXIgY2xhc3M9XCIke2NvbmZpZ18xLmRlZmF1bHQuaGlnaGxpZ2h0TW9kZSA9PSBcIndvcmRcIiA/IHdvcmRIaWdobGlnaHRDbGFzc1N0cmluZyA6IFwiXCJ9IGRlYWRcIj4ke2N1cnJlbnRMZXR0ZXJ9PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFzaG93RXJyb3IpIHtcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudExldHRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldCArPSBgPGxldHRlciBjbGFzcz1cIiR7Y29uZmlnXzEuZGVmYXVsdC5oaWdobGlnaHRNb2RlID09IFwid29yZFwiXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHdvcmRIaWdobGlnaHRDbGFzc1N0cmluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgOiBjb3JyZWN0Q2xhc3N9ICR7dGFiQ2hhcn0ke25sQ2hhcn1cIj4ke2N1cnJlbnRMZXR0ZXJ9PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50TGV0dGVyID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuaGlkZUV4dHJhTGV0dGVycykge1xuICAgICAgICAgICAgICAgICAgICBsZXQgbGV0dGVyID0gaW5wdXRbaV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChsZXR0ZXIgPT0gXCIgXCIgfHwgbGV0dGVyID09IFwiXFx0XCIgfHwgbGV0dGVyID09IFwiXFxuXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldHRlciA9IFwiX1wiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldCArPSBgPGxldHRlciBjbGFzcz1cIiR7Y29uZmlnXzEuZGVmYXVsdC5oaWdobGlnaHRNb2RlID09IFwid29yZFwiXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHdvcmRIaWdobGlnaHRDbGFzc1N0cmluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgOiBcImluY29ycmVjdFwifSBleHRyYSAke3RhYkNoYXJ9JHtubENoYXJ9XCI+JHtsZXR0ZXJ9PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXQgKz1cbiAgICAgICAgICAgICAgICAgICAgYDxsZXR0ZXIgY2xhc3M9XCIke2NvbmZpZ18xLmRlZmF1bHQuaGlnaGxpZ2h0TW9kZSA9PSBcIndvcmRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgPyB3b3JkSGlnaGxpZ2h0Q2xhc3NTdHJpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgIDogXCJpbmNvcnJlY3RcIn0gJHt0YWJDaGFyfSR7bmxDaGFyfVwiPmAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQuaW5kaWNhdGVUeXBvcyA9PT0gXCJyZXBsYWNlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IGlucHV0W2ldID09IFwiIFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gXCJfXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBpbnB1dFtpXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogY3VycmVudExldHRlcikgK1xuICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQuaW5kaWNhdGVUeXBvcyA9PT0gXCJiZWxvd1wiID8gYDxoaW50PiR7aW5wdXRbaV19PC9oaW50PmAgOiBcIlwiKSArXG4gICAgICAgICAgICAgICAgICAgICAgICBcIjwvbGV0dGVyPlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlucHV0V2l0aFNpbmdsZUNvbXBvc2VMZW5ndGggPSBNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzLnRlc3QoaW5wdXQpXG4gICAgICAgICAgICA/IGlucHV0LnNlYXJjaChNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzKSArIDFcbiAgICAgICAgICAgIDogaW5wdXQubGVuZ3RoO1xuICAgICAgICBpZiAoaW5wdXRXaXRoU2luZ2xlQ29tcG9zZUxlbmd0aCA8IGN1cnJlbnRXb3JkLmxlbmd0aCkge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IGlucHV0V2l0aFNpbmdsZUNvbXBvc2VMZW5ndGg7IGkgPCBjdXJyZW50V29yZC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFdvcmRbaV0gPT09IFwi4oaRXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldCArPSBgPGxldHRlcj48aSBjbGFzcz1cImZhcyBmYS1hcnJvdy11cFwiPjwvaT48L2xldHRlcj5gO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50V29yZFtpXSA9PT0gXCLihpNcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0ICs9IGA8bGV0dGVyPjxpIGNsYXNzPVwiZmFzIGZhLWFycm93LWRvd25cIj48L2k+PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFdvcmRbaV0gPT09IFwi4oaQXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldCArPSBgPGxldHRlcj48aSBjbGFzcz1cImZhcyBmYS1hcnJvdy1sZWZ0XCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRXb3JkW2ldID09PSBcIuKGklwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXQgKz0gYDxsZXR0ZXI+PGkgY2xhc3M9XCJmYXMgZmEtYXJyb3ctcmlnaHRcIj48L2k+PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50V29yZFtpXSA9PT0gXCJcXHRcIikge1xuICAgICAgICAgICAgICAgICAgICByZXQgKz0gYDxsZXR0ZXIgY2xhc3M9J3RhYkNoYXInPjxpIGNsYXNzPVwiZmFzIGZhLWxvbmctYXJyb3ctYWx0LXJpZ2h0XCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRXb3JkW2ldID09PSBcIlxcblwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldCArPSBgPGxldHRlciBjbGFzcz0nbmxDaGFyJz48aSBjbGFzcz1cImZhcyBmYS1hbmdsZS1kb3duXCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXQgKz1cbiAgICAgICAgICAgICAgICAgICAgICAgIGA8bGV0dGVyIGNsYXNzPVwiJHtjb25maWdfMS5kZWZhdWx0LmhpZ2hsaWdodE1vZGUgPT0gXCJ3b3JkXCIgPyB3b3JkSGlnaGxpZ2h0Q2xhc3NTdHJpbmcgOiBcIlwifVwiPmAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRXb3JkW2ldICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIjwvbGV0dGVyPlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5oaWdobGlnaHRNb2RlID09PSBcImxldHRlclwiICYmIGNvbmZpZ18xLmRlZmF1bHQuaGlkZUV4dHJhTGV0dGVycykge1xuICAgICAgICAgICAgaWYgKGlucHV0Lmxlbmd0aCA+IGN1cnJlbnRXb3JkLmxlbmd0aCAmJiAhY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUpIHtcbiAgICAgICAgICAgICAgICAkKHdvcmRBdEluZGV4KS5hZGRDbGFzcyhcImVycm9yXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaW5wdXQubGVuZ3RoID09IGN1cnJlbnRXb3JkLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICQod29yZEF0SW5kZXgpLnJlbW92ZUNsYXNzKFwiZXJyb3JcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgd29yZEF0SW5kZXguaW5uZXJIVE1MID0gcmV0O1xuICAgIGlmIChuZXdsaW5lYWZ0ZXIpXG4gICAgICAgICQoXCIjd29yZHNcIikuYXBwZW5kKFwiPGRpdiBjbGFzcz0nbmV3bGluZSc+PC9kaXY+XCIpO1xufVxuZXhwb3J0cy51cGRhdGVXb3JkRWxlbWVudCA9IHVwZGF0ZVdvcmRFbGVtZW50O1xuZnVuY3Rpb24gbGluZUp1bXAoY3VycmVudFRvcCkge1xuICAgIHZhciBfYTtcbiAgICAvL2xhc3Qgd29yZCBvZiB0aGUgbGluZVxuICAgIGlmIChleHBvcnRzLmN1cnJlbnRUZXN0TGluZSA+IDApIHtcbiAgICAgICAgY29uc3QgaGlkZUJvdW5kID0gY3VycmVudFRvcDtcbiAgICAgICAgY29uc3QgdG9IaWRlID0gW107XG4gICAgICAgIGNvbnN0IHdvcmRFbGVtZW50cyA9ICQoXCIjd29yZHMgLndvcmRcIik7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXhwb3J0cy5jdXJyZW50V29yZEVsZW1lbnRJbmRleDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoJCh3b3JkRWxlbWVudHNbaV0pLmhhc0NsYXNzKFwiaGlkZGVuXCIpKVxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgY29uc3QgZm9yV29yZFRvcCA9IE1hdGguZmxvb3Iod29yZEVsZW1lbnRzW2ldLm9mZnNldFRvcCk7XG4gICAgICAgICAgICBpZiAoZm9yV29yZFRvcCA8IGhpZGVCb3VuZCAtIDEwKSB7XG4gICAgICAgICAgICAgICAgdG9IaWRlLnB1c2goJCgkKFwiI3dvcmRzIC53b3JkXCIpW2ldKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgd29yZEhlaWdodCA9ICgkKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIud29yZFwiKSkub3V0ZXJIZWlnaHQodHJ1ZSkpO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zbW9vdGhMaW5lU2Nyb2xsICYmIHRvSGlkZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBleHBvcnRzLmxpbmVUcmFuc2l0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgICQoXCIjd29yZHNcIikucHJlcGVuZChgPGRpdiBjbGFzcz1cInNtb290aFNjcm9sbGVyXCIgc3R5bGU9XCJwb3NpdGlvbjogZml4ZWQ7aGVpZ2h0OiR7d29yZEhlaWdodH1weDt3aWR0aDoxMDAlXCI+PC9kaXY+YCk7XG4gICAgICAgICAgICAkKFwiI3dvcmRzIC5zbW9vdGhTY3JvbGxlclwiKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDAsXG4gICAgICAgICAgICB9LCBTbG93VGltZXIuZ2V0KCkgPyAwIDogMTI1LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgJChcIiN3b3JkcyAuc21vb3RoU2Nyb2xsZXJcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICQoXCIjcGFjZUNhcmV0XCIpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIHRvcDogKChfYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcGFjZUNhcmV0XCIpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Eub2Zmc2V0VG9wKSAtXG4gICAgICAgICAgICAgICAgICAgIHdvcmRIZWlnaHQsXG4gICAgICAgICAgICB9LCBTbG93VGltZXIuZ2V0KCkgPyAwIDogMTI1KTtcbiAgICAgICAgICAgICQoXCIjd29yZHNcIikuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgbWFyZ2luVG9wOiBgLSR7d29yZEhlaWdodH1weGAsXG4gICAgICAgICAgICB9LCBTbG93VGltZXIuZ2V0KCkgPyAwIDogMTI1LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZXhwb3J0cy5hY3RpdmVXb3JkVG9wID0gKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjd29yZHMgLmFjdGl2ZVwiKSkub2Zmc2V0VG9wO1xuICAgICAgICAgICAgICAgIGV4cG9ydHMuY3VycmVudFdvcmRFbGVtZW50SW5kZXggLT0gdG9IaWRlLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBleHBvcnRzLmxpbmVUcmFuc2l0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdG9IaWRlLmZvckVhY2goKGVsKSA9PiBlbC5yZW1vdmUoKSk7XG4gICAgICAgICAgICAgICAgJChcIiN3b3Jkc1wiKS5jc3MoXCJtYXJnaW5Ub3BcIiwgXCIwXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0b0hpZGUuZm9yRWFjaCgoZWwpID0+IGVsLnJlbW92ZSgpKTtcbiAgICAgICAgICAgIGV4cG9ydHMuY3VycmVudFdvcmRFbGVtZW50SW5kZXggLT0gdG9IaWRlLmxlbmd0aDtcbiAgICAgICAgICAgICQoXCIjcGFjZUNhcmV0XCIpLmNzcyh7XG4gICAgICAgICAgICAgICAgdG9wOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BhY2VDYXJldFwiKS5vZmZzZXRUb3AgLVxuICAgICAgICAgICAgICAgICAgICB3b3JkSGVpZ2h0LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZXhwb3J0cy5jdXJyZW50VGVzdExpbmUrKztcbn1cbmV4cG9ydHMubGluZUp1bXAgPSBsaW5lSnVtcDtcbmZ1bmN0aW9uIGFycmFuZ2VDaGFyYWN0ZXJzUmlnaHRUb0xlZnQoKSB7XG4gICAgJChcIiN3b3Jkc1wiKS5hZGRDbGFzcyhcInJpZ2h0VG9MZWZ0VGVzdFwiKTtcbiAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeSAud29yZHNcIikuYWRkQ2xhc3MoXCJyaWdodFRvTGVmdFRlc3RcIik7XG4gICAgJChcIiNyZXN1bHRSZXBsYXkgLndvcmRzXCIpLmFkZENsYXNzKFwicmlnaHRUb0xlZnRUZXN0XCIpO1xufVxuZXhwb3J0cy5hcnJhbmdlQ2hhcmFjdGVyc1JpZ2h0VG9MZWZ0ID0gYXJyYW5nZUNoYXJhY3RlcnNSaWdodFRvTGVmdDtcbmZ1bmN0aW9uIGFycmFuZ2VDaGFyYWN0ZXJzTGVmdFRvUmlnaHQoKSB7XG4gICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcInJpZ2h0VG9MZWZ0VGVzdFwiKTtcbiAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeSAud29yZHNcIikucmVtb3ZlQ2xhc3MoXCJyaWdodFRvTGVmdFRlc3RcIik7XG4gICAgJChcIiNyZXN1bHRSZXBsYXkgLndvcmRzXCIpLnJlbW92ZUNsYXNzKFwicmlnaHRUb0xlZnRUZXN0XCIpO1xufVxuZXhwb3J0cy5hcnJhbmdlQ2hhcmFjdGVyc0xlZnRUb1JpZ2h0ID0gYXJyYW5nZUNoYXJhY3RlcnNMZWZ0VG9SaWdodDtcbmZ1bmN0aW9uIGxvYWRXb3Jkc0hpc3RvcnkoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLndvcmRzXCIpLmVtcHR5KCk7XG4gICAgICAgIGxldCB3b3Jkc0hUTUwgPSBcIlwiO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aCArIDI7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKTtcbiAgICAgICAgICAgIGNvbnN0IHdvcmQgPSBUZXN0V29yZHMud29yZHMuZ2V0KGkpO1xuICAgICAgICAgICAgbGV0IHdvcmRFbCA9IFwiXCI7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGlmIChpbnB1dCA9PT0gXCJcIilcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZW1wdHkgaW5wdXQgd29yZFwiKTtcbiAgICAgICAgICAgICAgICBpZiAoVGVzdElucHV0LmNvcnJlY3RlZC5nZXRIaXN0b3J5KGkpICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgICAgICAgICAgVGVzdElucHV0LmNvcnJlY3RlZC5nZXRIaXN0b3J5KGkpICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHdvcmRFbCA9IGA8ZGl2IGNsYXNzPSd3b3JkJyBidXJzdD1cIiR7VGVzdElucHV0LmJ1cnN0SGlzdG9yeVtpXX1cIiBpbnB1dD1cIiR7VGVzdElucHV0LmNvcnJlY3RlZFxuICAgICAgICAgICAgICAgICAgICAgICAgLmdldEhpc3RvcnkoaSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cIi9nLCBcIiZxdW90O1wiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyAvZywgXCJfXCIpfVwiPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB3b3JkRWwgPSBgPGRpdiBjbGFzcz0nd29yZCcgYnVyc3Q9XCIke1Rlc3RJbnB1dC5idXJzdEhpc3RvcnlbaV19XCIgaW5wdXQ9XCIke2lucHV0LnJlcGxhY2UoL1wiL2csIFwiJnF1b3Q7XCIpLnJlcGxhY2UoLyAvZywgXCJfXCIpfVwiPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpID09PSBUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vbGFzdCB3b3JkXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmRzdGF0cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Q6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmNvcnJlY3Q6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtaXNzZWQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxlbmd0aCA9IGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiID8gaW5wdXQubGVuZ3RoIDogd29yZC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgbGVuZ3RoOyBjKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjIDwgaW5wdXQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9vbiBjaGFyIHRoYXQgc3RpbGwgaGFzIGEgd29yZCBsaXN0IHBhaXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIgfHwgaW5wdXRbY10gPT0gd29yZFtjXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3Jkc3RhdHMuY29ycmVjdCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29yZHN0YXRzLmluY29ycmVjdCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vb24gY2hhciB0aGF0IGlzIGV4dHJhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd29yZHN0YXRzLm1pc3NlZCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh3b3Jkc3RhdHMuaW5jb3JyZWN0ICE9PSAwIHx8IGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT0gXCJ6ZW5cIiAmJiBpbnB1dCAhPT0gd29yZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRFbCA9IGA8ZGl2IGNsYXNzPSd3b3JkIGVycm9yJyBidXJzdD1cIiR7VGVzdElucHV0LmJ1cnN0SGlzdG9yeVtpXX1cIiBpbnB1dD1cIiR7aW5wdXQucmVwbGFjZSgvXCIvZywgXCImcXVvdDtcIikucmVwbGFjZSgvIC9nLCBcIl9cIil9XCI+YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPSBcInplblwiICYmIGlucHV0ICE9PSB3b3JkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JkRWwgPSBgPGRpdiBjbGFzcz0nd29yZCBlcnJvcicgYnVyc3Q9XCIke1Rlc3RJbnB1dC5idXJzdEhpc3RvcnlbaV19XCIgaW5wdXQ9XCIke2lucHV0LnJlcGxhY2UoL1wiL2csIFwiJnF1b3Q7XCIpLnJlcGxhY2UoLyAvZywgXCJfXCIpfVwiPmA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IGxvb3A7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiIHx8IGlucHV0Lmxlbmd0aCA+IHdvcmQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vaW5wdXQgaXMgbG9uZ2VyIC0gZXh0cmEgY2hhcmFjdGVycyBwb3NzaWJsZSAobG9vcCBvdmVyIGlucHV0KVxuICAgICAgICAgICAgICAgICAgICBsb29wID0gaW5wdXQubGVuZ3RoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy9pbnB1dCBpcyBzaG9ydGVyIG9yIGVxdWFsIChsb29wIG92ZXIgd29yZCBsaXN0KVxuICAgICAgICAgICAgICAgICAgICBsb29wID0gd29yZC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgbG9vcDsgYysrKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBjb3JyZWN0ZWRDaGFyO1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdGVkQ2hhciA9IFRlc3RJbnB1dC5jb3JyZWN0ZWQuZ2V0SGlzdG9yeShpKVtjXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdGVkQ2hhciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsZXQgZXh0cmFDb3JyZWN0ZWQgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYyArIDEgPT09IGxvb3AgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQuZ2V0SGlzdG9yeShpKSAhPT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBUZXN0SW5wdXQuY29ycmVjdGVkLmdldEhpc3RvcnkoaSkubGVuZ3RoID4gaW5wdXQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHRyYUNvcnJlY3RlZCA9IFwiZXh0cmFDb3JyZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIgfHwgd29yZFtjXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIgfHwgaW5wdXRbY10gPT09IHdvcmRbY10pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29ycmVjdGVkQ2hhciA9PT0gaW5wdXRbY10gfHwgY29ycmVjdGVkQ2hhciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRFbCArPSBgPGxldHRlciBjbGFzcz1cImNvcnJlY3QgJHtleHRyYUNvcnJlY3RlZH1cIj4ke2lucHV0W2NdfTwvbGV0dGVyPmA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JkRWwgKz1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA8bGV0dGVyIGNsYXNzPVwiY29ycmVjdGVkICR7ZXh0cmFDb3JyZWN0ZWR9XCI+YCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRbY10gK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiPC9sZXR0ZXI+XCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0W2NdID09PSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JkRWwgKz1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA8bGV0dGVyIGNsYXNzPSdjb3JyZWN0ICR7ZXh0cmFDb3JyZWN0ZWR9Jz5gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JkW2NdICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIjwvbGV0dGVyPlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpbnB1dFtjXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRFbCArPSBcIjxsZXR0ZXI+XCIgKyB3b3JkW2NdICsgXCI8L2xldHRlcj5cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRFbCArPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYDxsZXR0ZXIgY2xhc3M9XCJpbmNvcnJlY3QgJHtleHRyYUNvcnJlY3RlZH1cIj5gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JkW2NdICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIjwvbGV0dGVyPlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRFbCArPSAnPGxldHRlciBjbGFzcz1cImluY29ycmVjdCBleHRyYVwiPicgKyBpbnB1dFtjXSArIFwiPC9sZXR0ZXI+XCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgd29yZEVsICs9IFwiPC9kaXY+XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHdvcmRFbCA9IFwiPGRpdiBjbGFzcz0nd29yZCc+XCI7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgd29yZC5sZW5ndGg7IGMrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgd29yZEVsICs9IFwiPGxldHRlcj5cIiArIHdvcmRbY10gKyBcIjwvbGV0dGVyPlwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHdvcmRFbCArPSBcIjwvZGl2PlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoX2EpIHsgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd29yZHNIVE1MICs9IHdvcmRFbDtcbiAgICAgICAgfVxuICAgICAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeSAud29yZHNcIikuaHRtbCh3b3Jkc0hUTUwpO1xuICAgICAgICAkKFwiI3Nob3dXb3JkSGlzdG9yeUJ1dHRvblwiKS5hZGRDbGFzcyhcImxvYWRlZFwiKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG59XG5mdW5jdGlvbiB0b2dnbGVSZXN1bHRXb3JkcygpIHtcbiAgICBpZiAoZXhwb3J0cy5yZXN1bHRWaXNpYmxlKSB7XG4gICAgICAgIGlmICgkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeVwiKS5zdG9wKHRydWUsIHRydWUpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICAgICAvL3Nob3dcbiAgICAgICAgICAgIGlmICghJChcIiNzaG93V29yZEhpc3RvcnlCdXR0b25cIikuaGFzQ2xhc3MoXCJsb2FkZWRcIikpIHtcbiAgICAgICAgICAgICAgICAkKFwiI3dvcmRzXCIpLmh0bWwoYDxkaXYgY2xhc3M9XCJwcmVsb2FkZXJcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1zcGluIGZhLWNpcmNsZS1ub3RjaFwiPjwvaT48L2Rpdj5gKTtcbiAgICAgICAgICAgICAgICBsb2FkV29yZHNIaXN0b3J5KCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmJ1cnN0SGVhdG1hcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwbHlCdXJzdEhlYXRtYXAoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeVwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zbGlkZURvd24oMjUwLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5idXJzdEhlYXRtYXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBseUJ1cnN0SGVhdG1hcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmJ1cnN0SGVhdG1hcCkge1xuICAgICAgICAgICAgICAgICAgICBhcHBseUJ1cnN0SGVhdG1hcCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeVwiKVxuICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgICAgICAgICAgLmNzcyhcImRpc3BsYXlcIiwgXCJub25lXCIpXG4gICAgICAgICAgICAgICAgICAgIC5zbGlkZURvd24oMjUwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vaGlkZVxuICAgICAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnlcIikuc2xpZGVVcCgyNTAsICgpID0+IHtcbiAgICAgICAgICAgICAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy50b2dnbGVSZXN1bHRXb3JkcyA9IHRvZ2dsZVJlc3VsdFdvcmRzO1xuZnVuY3Rpb24gYXBwbHlCdXJzdEhlYXRtYXAoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5idXJzdEhlYXRtYXApIHtcbiAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLmhlYXRtYXBMZWdlbmRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIGxldCBidXJzdGxpc3QgPSBbLi4uVGVzdElucHV0LmJ1cnN0SGlzdG9yeV07XG4gICAgICAgIGJ1cnN0bGlzdCA9IGJ1cnN0bGlzdC5maWx0ZXIoKHgpID0+IHggIT09IEluZmluaXR5KTtcbiAgICAgICAgYnVyc3RsaXN0ID0gYnVyc3RsaXN0LmZpbHRlcigoeCkgPT4geCA8IDM1MCk7XG4gICAgICAgIGlmICgoKF9hID0gVGVzdElucHV0LmlucHV0LmdldEhpc3RvcnkoVGVzdElucHV0LmlucHV0LmdldEhpc3RvcnkoKS5sZW5ndGggLSAxKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgIT09ICgoX2IgPSBUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGVuZ3RoKSkge1xuICAgICAgICAgICAgYnVyc3RsaXN0ID0gYnVyc3RsaXN0LnNwbGljZSgwLCBidXJzdGxpc3QubGVuZ3RoIC0gMSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbWVkaWFuID0gTWlzYy5tZWRpYW4oYnVyc3RsaXN0KTtcbiAgICAgICAgY29uc3QgYWRhdG0gPSBbXTtcbiAgICAgICAgYnVyc3RsaXN0LmZvckVhY2goKGJ1cnN0KSA9PiB7XG4gICAgICAgICAgICBhZGF0bS5wdXNoKE1hdGguYWJzKG1lZGlhbiAtIGJ1cnN0KSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBzdGVwID0gTWlzYy5tZWFuKGFkYXRtKTtcbiAgICAgICAgY29uc3Qgc3RlcHMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsOiAwLFxuICAgICAgICAgICAgICAgIGNsYXNzOiBcImhlYXRtYXAtMFwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWw6IG1lZGlhbiAtIHN0ZXAgKiAxLjUsXG4gICAgICAgICAgICAgICAgY2xhc3M6IFwiaGVhdG1hcC0xXCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhbDogbWVkaWFuIC0gc3RlcCAqIDAuNSxcbiAgICAgICAgICAgICAgICBjbGFzczogXCJoZWF0bWFwLTJcIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsOiBtZWRpYW4gKyBzdGVwICogMC41LFxuICAgICAgICAgICAgICAgIGNsYXNzOiBcImhlYXRtYXAtM1wiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWw6IG1lZGlhbiArIHN0ZXAgKiAxLjUsXG4gICAgICAgICAgICAgICAgY2xhc3M6IFwiaGVhdG1hcC00XCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICBdO1xuICAgICAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeSAud29yZHMgLndvcmRcIikuZWFjaCgoXywgd29yZCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgd29yZEJ1cnN0VmFsID0gcGFyc2VJbnQoJCh3b3JkKS5hdHRyKFwiYnVyc3RcIikpO1xuICAgICAgICAgICAgbGV0IGNscyA9IFwiXCI7XG4gICAgICAgICAgICBzdGVwcy5mb3JFYWNoKChzdGVwKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHdvcmRCdXJzdFZhbCA+IHN0ZXAudmFsKVxuICAgICAgICAgICAgICAgICAgICBjbHMgPSBzdGVwLmNsYXNzO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkKHdvcmQpLmFkZENsYXNzKGNscyk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLmhlYXRtYXBMZWdlbmRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjcmVzdWx0V29yZHNIaXN0b3J5IC53b3JkcyAud29yZFwiKS5yZW1vdmVDbGFzcyhcImhlYXRtYXAtMFwiKTtcbiAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLndvcmRzIC53b3JkXCIpLnJlbW92ZUNsYXNzKFwiaGVhdG1hcC0xXCIpO1xuICAgICAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeSAud29yZHMgLndvcmRcIikucmVtb3ZlQ2xhc3MoXCJoZWF0bWFwLTJcIik7XG4gICAgICAgICQoXCIjcmVzdWx0V29yZHNIaXN0b3J5IC53b3JkcyAud29yZFwiKS5yZW1vdmVDbGFzcyhcImhlYXRtYXAtM1wiKTtcbiAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLndvcmRzIC53b3JkXCIpLnJlbW92ZUNsYXNzKFwiaGVhdG1hcC00XCIpO1xuICAgIH1cbn1cbmV4cG9ydHMuYXBwbHlCdXJzdEhlYXRtYXAgPSBhcHBseUJ1cnN0SGVhdG1hcDtcbmZ1bmN0aW9uIGhpZ2hsaWdodEJhZFdvcmQoaW5kZXgsIHNob3dFcnJvcikge1xuICAgIGlmICghc2hvd0Vycm9yKVxuICAgICAgICByZXR1cm47XG4gICAgJCgkKFwiI3dvcmRzIC53b3JkXCIpW2luZGV4XSkuYWRkQ2xhc3MoXCJlcnJvclwiKTtcbn1cbmV4cG9ydHMuaGlnaGxpZ2h0QmFkV29yZCA9IGhpZ2hsaWdodEJhZFdvcmQ7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIjc2F2ZVNjcmVlbnNob3RCdXR0b25cIiwgKCkgPT4ge1xuICAgIHNjcmVlbnNob3QoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0ZXN0TW9kZXNOb3RpY2UgLnRleHQtYnV0dG9uLmJsaW5kXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0QmxpbmRNb2RlKCFjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSk7XG59KTtcbiQoXCIucGFnZVRlc3QgI2NvcHlXb3Jkc0xpc3RCdXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB0cnkge1xuICAgICAgICBsZXQgd29yZHM7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIikge1xuICAgICAgICAgICAgd29yZHMgPSBUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5qb2luKFwiIFwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHdvcmRzID0gVGVzdFdvcmRzLndvcmRzLmdldCgpXG4gICAgICAgICAgICAgICAgLnNsaWNlKDAsIFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aClcbiAgICAgICAgICAgICAgICAuam9pbihcIiBcIik7XG4gICAgICAgIH1cbiAgICAgICAgeWllbGQgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQod29yZHMpO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkNvcGllZCB0byBjbGlwYm9hcmRcIiwgMCwgMik7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ291bGQgbm90IGNvcHkgdG8gY2xpcGJvYXJkOiBcIiArIGUsIC0xKTtcbiAgICB9XG59KSk7XG4kKFwiLnBhZ2VUZXN0ICN0b2dnbGVCdXJzdEhlYXRtYXBcIikub24oXCJjbGlja1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBVcGRhdGVDb25maWcuc2V0QnVyc3RIZWF0bWFwKCFjb25maWdfMS5kZWZhdWx0LmJ1cnN0SGVhdG1hcCk7XG59KSk7XG4kKGRvY3VtZW50KS5vbihcIm1vdXNlbGVhdmVcIiwgXCIjcmVzdWx0V29yZHNIaXN0b3J5IC53b3JkcyAud29yZFwiLCAoKSA9PiB7XG4gICAgJChcIi53b3JkSW5wdXRBZnRlclwiKS5yZW1vdmUoKTtcbn0pO1xuJChcIiN3cG1DaGFydFwiKS5vbihcIm1vdXNlbGVhdmVcIiwgKCkgPT4ge1xuICAgICQoXCIud29yZElucHV0QWZ0ZXJcIikucmVtb3ZlKCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwibW91c2VlbnRlclwiLCBcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLndvcmRzIC53b3JkXCIsIChlKSA9PiB7XG4gICAgaWYgKGV4cG9ydHMucmVzdWx0VmlzaWJsZSkge1xuICAgICAgICBjb25zdCBpbnB1dCA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiaW5wdXRcIik7XG4gICAgICAgIGNvbnN0IGJ1cnN0ID0gcGFyc2VJbnQoJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJidXJzdFwiKSk7XG4gICAgICAgIGlmIChpbnB1dCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICQoZS5jdXJyZW50VGFyZ2V0KS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ3b3JkSW5wdXRBZnRlclwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0ZXh0XCI+XG4gICAgICAgICAgJHtpbnB1dFxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXHQvZywgXCJfXCIpXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcbi9nLCBcIl9cIilcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgvPC9nLCBcIiZsdFwiKVxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8+L2csIFwiJmd0XCIpfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJzcGVlZFwiPlxuICAgICAgICAgICR7TWF0aC5yb3VuZChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0gPyBidXJzdCAqIDUgOiBidXJzdCl9JHtjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0gPyBcImNwbVwiIDogXCJ3cG1cIn1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuJChcIiN3b3Jkc0lucHV0XCIpLm9uKFwiZm9jdXNcIiwgKCkgPT4ge1xuICAgIGlmICghZXhwb3J0cy5yZXN1bHRWaXNpYmxlICYmIGNvbmZpZ18xLmRlZmF1bHQuc2hvd091dE9mRm9jdXNXYXJuaW5nKSB7XG4gICAgICAgIE91dE9mRm9jdXMuaGlkZSgpO1xuICAgIH1cbiAgICBDYXJldC5zaG93KCk7XG59KTtcbiQoXCIjd29yZHNJbnB1dFwiKS5vbihcImZvY3Vzb3V0XCIsICgpID0+IHtcbiAgICBpZiAoIWV4cG9ydHMucmVzdWx0VmlzaWJsZSAmJiBjb25maWdfMS5kZWZhdWx0LnNob3dPdXRPZkZvY3VzV2FybmluZykge1xuICAgICAgICBPdXRPZkZvY3VzLnNob3coKTtcbiAgICB9XG4gICAgQ2FyZXQuaGlkZSgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImtleXByZXNzXCIsIFwiI3Nob3dXb3JkSGlzdG9yeUJ1dHRvblwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgdG9nZ2xlUmVzdWx0V29yZHMoKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQuYm9keSkub24oXCJjbGlja1wiLCBcIiNzaG93V29yZEhpc3RvcnlCdXR0b25cIiwgKCkgPT4ge1xuICAgIHRvZ2dsZVJlc3VsdFdvcmRzKCk7XG59KTtcbiQoXCIjd29yZHNXcmFwcGVyXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGZvY3VzV29yZHMoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNldEhhc1RhYiA9IGV4cG9ydHMuc2V0UmFuZG9tUXVvdGUgPSBleHBvcnRzLnJhbmRvbVF1b3RlID0gZXhwb3J0cy5oYXNUYWIgPSBleHBvcnRzLndvcmRzID0gdm9pZCAwO1xuY2xhc3MgV29yZHMge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmxpc3QgPSBbXTtcbiAgICAgICAgdGhpcy5sZW5ndGggPSAwO1xuICAgICAgICB0aGlzLmN1cnJlbnRJbmRleCA9IDA7XG4gICAgfVxuICAgIGdldChpLCByYXcgPSBmYWxzZSkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBpZiAoaSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5saXN0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKHJhdykge1xuICAgICAgICAgICAgICAgIHJldHVybiAoX2IgPSAoX2EgPSB0aGlzLmxpc3RbaV0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZXBsYWNlKC9bLj8hXCI6XFwtLF0vZywgXCJcIikpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGlzdFtpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRDdXJyZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5saXN0W3RoaXMuY3VycmVudEluZGV4XTtcbiAgICB9XG4gICAgZ2V0TGFzdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdFt0aGlzLmxpc3QubGVuZ3RoIC0gMV07XG4gICAgfVxuICAgIHB1c2god29yZCkge1xuICAgICAgICB0aGlzLmxpc3QucHVzaCh3b3JkKTtcbiAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLmxpc3QubGVuZ3RoO1xuICAgIH1cbiAgICByZXNldCgpIHtcbiAgICAgICAgdGhpcy5saXN0ID0gW107XG4gICAgICAgIHRoaXMuY3VycmVudEluZGV4ID0gMDtcbiAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLmxpc3QubGVuZ3RoO1xuICAgIH1cbiAgICByZXNldEN1cnJlbnRJbmRleCgpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50SW5kZXggPSAwO1xuICAgIH1cbiAgICBkZWNyZWFzZUN1cnJlbnRJbmRleCgpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50SW5kZXgtLTtcbiAgICB9XG4gICAgaW5jcmVhc2VDdXJyZW50SW5kZXgoKSB7XG4gICAgICAgIHRoaXMuY3VycmVudEluZGV4Kys7XG4gICAgfVxuICAgIGNsZWFuKCkge1xuICAgICAgICBmb3IgKGNvbnN0IHMgb2YgdGhpcy5saXN0KSB7XG4gICAgICAgICAgICBpZiAoLyArLy50ZXN0KHMpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaWQgPSB0aGlzLmxpc3QuaW5kZXhPZihzKTtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wTGlzdCA9IHMuc3BsaXQoXCIgXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMubGlzdC5zcGxpY2UoaWQsIDEpO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGVtcExpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5saXN0LnNwbGljZShpZCArIGksIDAsIHRlbXBMaXN0W2ldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLndvcmRzID0gbmV3IFdvcmRzKCk7XG5leHBvcnRzLmhhc1RhYiA9IGZhbHNlO1xuZXhwb3J0cy5yYW5kb21RdW90ZSA9IG51bGw7XG5mdW5jdGlvbiBzZXRSYW5kb21RdW90ZShycSkge1xuICAgIGV4cG9ydHMucmFuZG9tUXVvdGUgPSBycTtcbn1cbmV4cG9ydHMuc2V0UmFuZG9tUXVvdGUgPSBzZXRSYW5kb21RdW90ZTtcbmZ1bmN0aW9uIHNldEhhc1RhYih0Zikge1xuICAgIGV4cG9ydHMuaGFzVGFiID0gdGY7XG59XG5leHBvcnRzLnNldEhhc1RhYiA9IHNldEhhc1RhYjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZVN0eWxlID0gZXhwb3J0cy51cGRhdGUgPSBleHBvcnRzLnJlc3RhcnQgPSBleHBvcnRzLmhpZGUgPSBleHBvcnRzLnNob3cgPSB2b2lkIDA7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IEN1c3RvbVRleHQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY3VzdG9tLXRleHRcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBUZXN0V29yZHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC13b3Jkc1wiKSk7XG5jb25zdCBUZXN0SW5wdXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC1pbnB1dFwiKSk7XG5jb25zdCBUaW1lID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvdGltZVwiKSk7XG5jb25zdCBTbG93VGltZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9zbG93LXRpbWVyXCIpKTtcbmNvbnN0IFRlc3RBY3RpdmUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy90ZXN0LWFjdGl2ZVwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgY29uc3Qgb3AgPSBjb25maWdfMS5kZWZhdWx0LnNob3dUaW1lclByb2dyZXNzID8gY29uZmlnXzEuZGVmYXVsdC50aW1lck9wYWNpdHkgOiAwO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT0gXCJ6ZW5cIiAmJiBjb25maWdfMS5kZWZhdWx0LnRpbWVyU3R5bGUgPT09IFwiYmFyXCIpIHtcbiAgICAgICAgJChcIiN0aW1lcldyYXBwZXJcIikuc3RvcCh0cnVlLCB0cnVlKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKS5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IG9wLFxuICAgICAgICB9LCAxMjUpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LnRpbWVyU3R5bGUgPT09IFwidGV4dFwiKSB7XG4gICAgICAgICQoXCIjdGltZXJOdW1iZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiBvcCxcbiAgICAgICAgfSwgMTI1KTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIgfHwgY29uZmlnXzEuZGVmYXVsdC50aW1lclN0eWxlID09PSBcIm1pbmlcIikge1xuICAgICAgICBpZiAob3AgPiAwKSB7XG4gICAgICAgICAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLnRpbWVcIilcbiAgICAgICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiBvcCxcbiAgICAgICAgICAgIH0sIDEyNSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAkKFwiI3RpbWVyV3JhcHBlclwiKS5zdG9wKHRydWUsIHRydWUpLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiAwLFxuICAgIH0sIDEyNSk7XG4gICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC50aW1lXCIpXG4gICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogMCxcbiAgICB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC50aW1lXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xuICAgICQoXCIjdGltZXJOdW1iZXJcIikuc3RvcCh0cnVlLCB0cnVlKS5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogMCxcbiAgICB9LCAxMjUpO1xufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbmZ1bmN0aW9uIHJlc3RhcnQoKSB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQudGltZXJTdHlsZSA9PT0gXCJiYXJcIikge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInRpbWVcIikge1xuICAgICAgICAgICAgJChcIiN0aW1lclwiKS5zdG9wKHRydWUsIHRydWUpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIHdpZHRoOiBcIjEwMHZ3XCIsXG4gICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIiB8fCBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgICAgICQoXCIjdGltZXJcIikuc3RvcCh0cnVlLCB0cnVlKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICB3aWR0aDogXCIwdndcIixcbiAgICAgICAgICAgIH0sIDApO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5yZXN0YXJ0ID0gcmVzdGFydDtcbmNvbnN0IHRpbWVyTnVtYmVyRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjdGltZXJOdW1iZXJcIik7XG5jb25zdCBtaW5pVGltZXJOdW1iZXJFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC50aW1lXCIpO1xuZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIGNvbnN0IHRpbWUgPSBUaW1lLmdldCgpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwidGltZVwiIHx8XG4gICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgJiYgQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20pKSB7XG4gICAgICAgIGxldCBtYXh0aW1lID0gY29uZmlnXzEuZGVmYXVsdC50aW1lO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiICYmIEN1c3RvbVRleHQuaXNUaW1lUmFuZG9tKSB7XG4gICAgICAgICAgICBtYXh0aW1lID0gQ3VzdG9tVGV4dC50aW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnRpbWVyU3R5bGUgPT09IFwiYmFyXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHBlcmNlbnQgPSAxMDAgLSAoKHRpbWUgKyAxKSAvIG1heHRpbWUpICogMTAwO1xuICAgICAgICAgICAgJChcIiN0aW1lclwiKVxuICAgICAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIHdpZHRoOiBwZXJjZW50ICsgXCJ2d1wiLFxuICAgICAgICAgICAgfSwgU2xvd1RpbWVyLmdldCgpID8gMCA6IDEwMDAsIFwibGluZWFyXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQudGltZXJTdHlsZSA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgICAgIGxldCBkaXNwbGF5VGltZSA9IE1pc2Muc2Vjb25kc1RvU3RyaW5nKG1heHRpbWUgLSB0aW1lKTtcbiAgICAgICAgICAgIGlmIChtYXh0aW1lID09PSAwKSB7XG4gICAgICAgICAgICAgICAgZGlzcGxheVRpbWUgPSBNaXNjLnNlY29uZHNUb1N0cmluZyh0aW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aW1lck51bWJlckVsZW1lbnQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aW1lck51bWJlckVsZW1lbnQuaW5uZXJIVE1MID0gXCI8ZGl2PlwiICsgZGlzcGxheVRpbWUgKyBcIjwvZGl2PlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQudGltZXJTdHlsZSA9PT0gXCJtaW5pXCIpIHtcbiAgICAgICAgICAgIGxldCBkaXNwbGF5VGltZSA9IE1pc2Muc2Vjb25kc1RvU3RyaW5nKG1heHRpbWUgLSB0aW1lKTtcbiAgICAgICAgICAgIGlmIChtYXh0aW1lID09PSAwKSB7XG4gICAgICAgICAgICAgICAgZGlzcGxheVRpbWUgPSBNaXNjLnNlY29uZHNUb1N0cmluZyh0aW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChtaW5pVGltZXJOdW1iZXJFbGVtZW50ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgbWluaVRpbWVyTnVtYmVyRWxlbWVudC5pbm5lckhUTUwgPSBkaXNwbGF5VGltZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIiB8fFxuICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgfHxcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInF1b3RlXCIpIHtcbiAgICAgICAgbGV0IG91dG9mID0gVGVzdFdvcmRzLndvcmRzLmxlbmd0aDtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ3b3Jkc1wiKSB7XG4gICAgICAgICAgICBvdXRvZiA9IGNvbmZpZ18xLmRlZmF1bHQud29yZHM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICAgICAgaWYgKEN1c3RvbVRleHQuaXNXb3JkUmFuZG9tKSB7XG4gICAgICAgICAgICAgICAgb3V0b2YgPSBDdXN0b21UZXh0LndvcmQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBvdXRvZiA9IEN1c3RvbVRleHQudGV4dC5sZW5ndGg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgICAgICBvdXRvZiA9IChfYyA9IChfYiA9IChfYSA9IFRlc3RXb3Jkcy5yYW5kb21RdW90ZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRleHRTcGxpdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmxlbmd0aCkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC50aW1lclN0eWxlID09PSBcImJhclwiKSB7XG4gICAgICAgICAgICBjb25zdCBwZXJjZW50ID0gTWF0aC5mbG9vcigoKFRlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXggKyAxKSAvIG91dG9mKSAqIDEwMCk7XG4gICAgICAgICAgICAkKFwiI3RpbWVyXCIpXG4gICAgICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgd2lkdGg6IHBlcmNlbnQgKyBcInZ3XCIsXG4gICAgICAgICAgICB9LCBTbG93VGltZXIuZ2V0KCkgPyAwIDogMjUwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LnRpbWVyU3R5bGUgPT09IFwidGV4dFwiKSB7XG4gICAgICAgICAgICBpZiAob3V0b2YgPT09IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodGltZXJOdW1iZXJFbGVtZW50ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVyTnVtYmVyRWxlbWVudC5pbm5lckhUTUwgPVxuICAgICAgICAgICAgICAgICAgICAgICAgXCI8ZGl2PlwiICsgYCR7VGVzdElucHV0LmlucHV0Lmhpc3RvcnkubGVuZ3RofWAgKyBcIjwvZGl2PlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aW1lck51bWJlckVsZW1lbnQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGltZXJOdW1iZXJFbGVtZW50LmlubmVySFRNTCA9XG4gICAgICAgICAgICAgICAgICAgICAgICBcIjxkaXY+XCIgKyBgJHtUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGh9LyR7b3V0b2Z9YCArIFwiPC9kaXY+XCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQudGltZXJTdHlsZSA9PT0gXCJtaW5pXCIpIHtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LndvcmRzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKG1pbmlUaW1lck51bWJlckVsZW1lbnQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgbWluaVRpbWVyTnVtYmVyRWxlbWVudC5pbm5lckhUTUwgPSBgJHtUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGh9YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAobWluaVRpbWVyTnVtYmVyRWxlbWVudCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBtaW5pVGltZXJOdW1iZXJFbGVtZW50LmlubmVySFRNTCA9IGAke1Rlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aH0vJHtvdXRvZn1gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIikge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC50aW1lclN0eWxlID09PSBcInRleHRcIikge1xuICAgICAgICAgICAgaWYgKHRpbWVyTnVtYmVyRWxlbWVudCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRpbWVyTnVtYmVyRWxlbWVudC5pbm5lckhUTUwgPVxuICAgICAgICAgICAgICAgICAgICBcIjxkaXY+XCIgKyBgJHtUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGh9YCArIFwiPC9kaXY+XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAobWluaVRpbWVyTnVtYmVyRWxlbWVudCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIG1pbmlUaW1lck51bWJlckVsZW1lbnQuaW5uZXJIVE1MID0gYCR7VGVzdElucHV0LmlucHV0Lmhpc3RvcnkubGVuZ3RofWA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLnVwZGF0ZSA9IHVwZGF0ZTtcbmZ1bmN0aW9uIHVwZGF0ZVN0eWxlKCkge1xuICAgIGlmICghVGVzdEFjdGl2ZS5nZXQoKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGhpZGUoKTtcbiAgICB1cGRhdGUoKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgc2hvdygpO1xuICAgIH0sIDEyNSk7XG59XG5leHBvcnRzLnVwZGF0ZVN0eWxlID0gdXBkYXRlU3R5bGU7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5LCBldmVudFZhbHVlKSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcInNob3dUaW1lclByb2dyZXNzXCIpIHtcbiAgICAgICAgaWYgKGV2ZW50VmFsdWUgPT09IHRydWUgJiYgVGVzdEFjdGl2ZS5nZXQoKSkge1xuICAgICAgICAgICAgc2hvdygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaGlkZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChldmVudEtleSA9PT0gXCJ0aW1lclN0eWxlXCIpXG4gICAgICAgIHVwZGF0ZVN0eWxlKCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmFkZEFsbEZyb21Ub2RheSA9IGV4cG9ydHMuZ2V0U3RyaW5nID0gZXhwb3J0cy5hZGRTZWNvbmRzID0gdm9pZCAwO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xubGV0IHNlY29uZHMgPSAwO1xubGV0IGFkZGVkQWxsVG9kYXkgPSBmYWxzZTtcbmxldCBkYXlUb2RheTtcbmZ1bmN0aW9uIGFkZFNlY29uZHMocykge1xuICAgIGlmIChhZGRlZEFsbFRvZGF5KSB7XG4gICAgICAgIGNvbnN0IG5vd0RhdGUgPSBuZXcgRGF0ZSgpLmdldERhdGUoKTtcbiAgICAgICAgaWYgKG5vd0RhdGUgPiBkYXlUb2RheSkge1xuICAgICAgICAgICAgc2Vjb25kcyA9IHM7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2Vjb25kcyArPSBzO1xufVxuZXhwb3J0cy5hZGRTZWNvbmRzID0gYWRkU2Vjb25kcztcbmZ1bmN0aW9uIGdldFN0cmluZygpIHtcbiAgICBjb25zdCBzZWNTdHJpbmcgPSBNaXNjLnNlY29uZHNUb1N0cmluZyhNYXRoLnJvdW5kKHNlY29uZHMpLCB0cnVlLCB0cnVlKTtcbiAgICByZXR1cm4gc2VjU3RyaW5nICsgKGFkZGVkQWxsVG9kYXkgPT09IHRydWUgPyBcIiB0b2RheVwiIDogXCIgc2Vzc2lvblwiKTtcbn1cbmV4cG9ydHMuZ2V0U3RyaW5nID0gZ2V0U3RyaW5nO1xuZnVuY3Rpb24gYWRkQWxsRnJvbVRvZGF5KCkge1xuICAgIGNvbnN0IHRvZGF5RGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgdG9kYXlEYXRlLnNldFNlY29uZHMoMCk7XG4gICAgdG9kYXlEYXRlLnNldE1pbnV0ZXMoMCk7XG4gICAgdG9kYXlEYXRlLnNldEhvdXJzKDApO1xuICAgIHRvZGF5RGF0ZS5zZXRNaWxsaXNlY29uZHMoMCk7XG4gICAgZGF5VG9kYXkgPSB0b2RheURhdGUuZ2V0RGF0ZSgpO1xuICAgIGNvbnN0IHRvZGF5RGF0ZU1TID0gdG9kYXlEYXRlLmdldFRpbWUoKTtcbiAgICBzZWNvbmRzID0gMDtcbiAgICBjb25zdCByZXN1bHRzID0gREIuZ2V0U25hcHNob3QoKS5yZXN1bHRzO1xuICAgIHJlc3VsdHMgPT09IG51bGwgfHwgcmVzdWx0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzdWx0cy5mb3JFYWNoKChyZXN1bHQpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0RGF0ZSA9IG5ldyBEYXRlKHJlc3VsdC50aW1lc3RhbXApO1xuICAgICAgICByZXN1bHREYXRlLnNldFNlY29uZHMoMCk7XG4gICAgICAgIHJlc3VsdERhdGUuc2V0TWludXRlcygwKTtcbiAgICAgICAgcmVzdWx0RGF0ZS5zZXRIb3VycygwKTtcbiAgICAgICAgcmVzdWx0RGF0ZS5zZXRNaWxsaXNlY29uZHMoMCk7XG4gICAgICAgIGNvbnN0IHJlc3VsdERhdGVNUyA9IHJlc3VsdERhdGUuZ2V0VGltZSgpO1xuICAgICAgICBpZiAocmVzdWx0RGF0ZU1TID49IHRvZGF5RGF0ZU1TKSB7XG4gICAgICAgICAgICBzZWNvbmRzICs9XG4gICAgICAgICAgICAgICAgcmVzdWx0LnRlc3REdXJhdGlvbiArIHJlc3VsdC5pbmNvbXBsZXRlVGVzdFNlY29uZHMgLSByZXN1bHQuYWZrRHVyYXRpb247XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBhZGRlZEFsbFRvZGF5ID0gdHJ1ZTtcbn1cbmV4cG9ydHMuYWRkQWxsRnJvbVRvZGF5ID0gYWRkQWxsRnJvbVRvZGF5O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zcGVhayA9IGV4cG9ydHMuY2xlYXIgPSBleHBvcnRzLmluaXQgPSBleHBvcnRzLnNldExhbmd1YWdlID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xubGV0IHZvaWNlO1xuZnVuY3Rpb24gc2V0TGFuZ3VhZ2UobGFuZyA9IGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoIXZvaWNlKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBsYW5ndWFnZSA9IHlpZWxkIE1pc2MuZ2V0TGFuZ3VhZ2UobGFuZyk7XG4gICAgICAgIGNvbnN0IGJjcCA9IGxhbmd1YWdlLmJjcDQ3ID8gbGFuZ3VhZ2UuYmNwNDcgOiBcImVuLVVTXCI7XG4gICAgICAgIHZvaWNlLmxhbmcgPSBiY3A7XG4gICAgfSk7XG59XG5leHBvcnRzLnNldExhbmd1YWdlID0gc2V0TGFuZ3VhZ2U7XG5mdW5jdGlvbiBpbml0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHZvaWNlID0gbmV3IFNwZWVjaFN5bnRoZXNpc1V0dGVyYW5jZSgpO1xuICAgICAgICBzZXRMYW5ndWFnZSgpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5pbml0ID0gaW5pdDtcbmZ1bmN0aW9uIGNsZWFyKCkge1xuICAgIHZvaWNlID0gdW5kZWZpbmVkO1xufVxuZXhwb3J0cy5jbGVhciA9IGNsZWFyO1xuZnVuY3Rpb24gc3BlYWsodGV4dCkge1xuICAgIHdpbmRvdy5zcGVlY2hTeW50aGVzaXMuY2FuY2VsKCk7XG4gICAgaWYgKHZvaWNlID09PSB1bmRlZmluZWQpXG4gICAgICAgIGluaXQoKTtcbiAgICBpZiAodm9pY2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB2b2ljZS50ZXh0ID0gdGV4dDtcbiAgICAgICAgd2luZG93LnNwZWVjaFN5bnRoZXNpcy5zcGVhayh2b2ljZSk7XG4gICAgfVxufVxuZXhwb3J0cy5zcGVhayA9IHNwZWFrO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSwgZXZlbnRWYWx1ZSkgPT4ge1xuICAgIGlmIChldmVudEtleSA9PT0gXCJmdW5ib3hcIikge1xuICAgICAgICBpZiAoZXZlbnRWYWx1ZSA9PT0gXCJub25lXCIpIHtcbiAgICAgICAgICAgIGNsZWFyKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZXZlbnRWYWx1ZSA9PT0gXCJ0dHNcIikge1xuICAgICAgICAgICAgaW5pdCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChldmVudEtleSA9PT0gXCJsYW5ndWFnZVwiICYmIGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcInR0c1wiKVxuICAgICAgICBzZXRMYW5ndWFnZSgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5nZXRXb3JkID0gZXhwb3J0cy51cGRhdGVTY29yZSA9IHZvaWQgMDtcbmNvbnN0IFRlc3RJbnB1dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LWlucHV0XCIpKTtcbi8vIENoYW5nZXMgaG93IHF1aWNrbHkgaXQgJ2xlYXJucycgc2NvcmVzIC0gdmVyeSByb3VnaGx5IHRoZSBzY29yZSBmb3IgYSBjaGFyXG4vLyBpcyBiYXNlZCBvbiBsYXN0IHBlckNoYXJDb3VudCBvY2N1cnJlbmNlcy4gTWFrZSBpdCBzbWFsbGVyIHRvIGFkanVzdCBmYXN0ZXIuXG5jb25zdCBwZXJDaGFyQ291bnQgPSA1MDtcbi8vIENob29zZSB0aGUgaGlnaGVzdCBzY29yaW5nIHdvcmQgZnJvbSB0aGlzIG1hbnkgcmFuZG9tIHdvcmRzLiBIaWdoZXIgdmFsdWVzXG4vLyB3aWxsIGNob29zZSB3b3JkcyB3aXRoIG1vcmUgd2VhayBsZXR0ZXJzIG9uIGF2ZXJhZ2UuXG5jb25zdCB3b3JkU2FtcGxlcyA9IDIwO1xuLy8gU2NvcmUgcGVuYXRseSAoaW4gbWlsbGlzZWNvbmRzKSBmb3IgZ2V0dGluZyBhIGxldHRlciB3cm9uZy5cbmNvbnN0IGluY29ycmVjdFBlbmFsdHkgPSA1MDAwO1xuY29uc3Qgc2NvcmVzID0ge307XG5jbGFzcyBTY29yZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuYXZlcmFnZSA9IDAuMDtcbiAgICAgICAgdGhpcy5jb3VudCA9IDA7XG4gICAgfVxuICAgIHVwZGF0ZShzY29yZSkge1xuICAgICAgICBpZiAodGhpcy5jb3VudCA8IHBlckNoYXJDb3VudCkge1xuICAgICAgICAgICAgdGhpcy5jb3VudCsrO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFkanVzdFJhdGUgPSAxLjAgLyB0aGlzLmNvdW50O1xuICAgICAgICAvLyBLZWVwIGFuIGV4cG9uZW50aWFsIG1vdmluZyBhdmVyYWdlIG9mIHRoZSBzY29yZSBvdmVyIHRpbWUuXG4gICAgICAgIHRoaXMuYXZlcmFnZSA9IHNjb3JlICogYWRqdXN0UmF0ZSArIHRoaXMuYXZlcmFnZSAqICgxIC0gYWRqdXN0UmF0ZSk7XG4gICAgfVxufVxuZnVuY3Rpb24gdXBkYXRlU2NvcmUoY2hhciwgaXNDb3JyZWN0KSB7XG4gICAgY29uc3QgdGltaW5ncyA9IFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3Muc3BhY2luZy5hcnJheTtcbiAgICBpZiAodGltaW5ncy5sZW5ndGggPT09IDAgfHwgdHlwZW9mIHRpbWluZ3MgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgc2NvcmUgPSB0aW1pbmdzW3RpbWluZ3MubGVuZ3RoIC0gMV07XG4gICAgaWYgKCFpc0NvcnJlY3QpIHtcbiAgICAgICAgc2NvcmUgKz0gaW5jb3JyZWN0UGVuYWx0eTtcbiAgICB9XG4gICAgaWYgKCEoY2hhciBpbiBzY29yZXMpKSB7XG4gICAgICAgIHNjb3Jlc1tjaGFyXSA9IG5ldyBTY29yZSgpO1xuICAgIH1cbiAgICBzY29yZXNbY2hhcl0udXBkYXRlKHNjb3JlKTtcbn1cbmV4cG9ydHMudXBkYXRlU2NvcmUgPSB1cGRhdGVTY29yZTtcbmZ1bmN0aW9uIHNjb3JlKHdvcmQpIHtcbiAgICBsZXQgdG90YWwgPSAwLjA7XG4gICAgbGV0IG51bUNoYXJzID0gMDtcbiAgICBmb3IgKGNvbnN0IGMgb2Ygd29yZCkge1xuICAgICAgICBpZiAoYyBpbiBzY29yZXMpIHtcbiAgICAgICAgICAgIHRvdGFsICs9IHNjb3Jlc1tjXS5hdmVyYWdlO1xuICAgICAgICAgICAgbnVtQ2hhcnMrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVtQ2hhcnMgPT0gMCA/IDAuMCA6IHRvdGFsIC8gbnVtQ2hhcnM7XG59XG5mdW5jdGlvbiBnZXRXb3JkKHdvcmRzZXQpIHtcbiAgICBsZXQgaGlnaFNjb3JlO1xuICAgIGxldCByYW5kb21Xb3JkID0gXCJcIjtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmRTYW1wbGVzOyBpKyspIHtcbiAgICAgICAgY29uc3QgbmV3V29yZCA9IHdvcmRzZXQucmFuZG9tV29yZCgpO1xuICAgICAgICBjb25zdCBuZXdTY29yZSA9IHNjb3JlKG5ld1dvcmQpO1xuICAgICAgICBpZiAoaSA9PSAwIHx8IGhpZ2hTY29yZSA9PT0gdW5kZWZpbmVkIHx8IG5ld1Njb3JlID4gaGlnaFNjb3JlKSB7XG4gICAgICAgICAgICByYW5kb21Xb3JkID0gbmV3V29yZDtcbiAgICAgICAgICAgIGhpZ2hTY29yZSA9IG5ld1Njb3JlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByYW5kb21Xb3JkO1xufVxuZXhwb3J0cy5nZXRXb3JkID0gZ2V0V29yZDtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZ2V0U2VjdGlvbiA9IGV4cG9ydHMuZ2V0VExEID0gZXhwb3J0cy5TZWN0aW9uID0gdm9pZCAwO1xuY29uc3QgTG9hZGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sb2FkZXJcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jbGFzcyBTZWN0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcih0aXRsZSwgYXV0aG9yLCB3b3Jkcykge1xuICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgICAgIHRoaXMuYXV0aG9yID0gYXV0aG9yO1xuICAgICAgICB0aGlzLndvcmRzID0gd29yZHM7XG4gICAgfVxufVxuZXhwb3J0cy5TZWN0aW9uID0gU2VjdGlvbjtcbmZ1bmN0aW9uIGdldFRMRChsYW5ndWFnZUdyb3VwKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgLy8gbGFuZ3VhZ2UgZ3JvdXAgdG8gdGxkXG4gICAgICAgIHN3aXRjaCAobGFuZ3VhZ2VHcm91cC5uYW1lKSB7XG4gICAgICAgICAgICBjYXNlIFwiZW5nbGlzaFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImVuXCI7XG4gICAgICAgICAgICBjYXNlIFwic3BhbmlzaFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImVzXCI7XG4gICAgICAgICAgICBjYXNlIFwiZnJlbmNoXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiZnJcIjtcbiAgICAgICAgICAgIGNhc2UgXCJnZXJtYW5cIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJkZVwiO1xuICAgICAgICAgICAgY2FzZSBcInBvcnR1Z3Vlc2VcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJwdFwiO1xuICAgICAgICAgICAgY2FzZSBcIml0YWxpYW5cIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJpdFwiO1xuICAgICAgICAgICAgY2FzZSBcImR1dGNoXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwibmxcIjtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRUTEQgPSBnZXRUTEQ7XG5mdW5jdGlvbiBnZXRTZWN0aW9uKGxhbmd1YWdlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJHZXR0aW5nIHNlY3Rpb25cIik7XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIC8vIGdldCBUTEQgZm9yIHdpa2lwZWRpYSBhY2NvcmRpbmcgdG8gbGFuZ3VhZ2UgZ3JvdXBcbiAgICAgICAgbGV0IHVybFRMRCA9IFwiZW5cIjtcbiAgICAgICAgY29uc3QgY3VycmVudExhbmd1YWdlR3JvdXAgPSB5aWVsZCBNaXNjLmZpbmRDdXJyZW50R3JvdXAobGFuZ3VhZ2UpO1xuICAgICAgICBpZiAoY3VycmVudExhbmd1YWdlR3JvdXAgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdXJsVExEID0geWllbGQgZ2V0VExEKGN1cnJlbnRMYW5ndWFnZUdyb3VwKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByYW5kb21Qb3N0VVJMID0gYGh0dHBzOi8vJHt1cmxUTER9Lndpa2lwZWRpYS5vcmcvYXBpL3Jlc3RfdjEvcGFnZS9yYW5kb20vc3VtbWFyeWA7XG4gICAgICAgIGNvbnN0IHNlY3Rpb25PYmogPSB7IHRpdGxlOiBcIlwiLCBhdXRob3I6IFwiXCIgfTtcbiAgICAgICAgY29uc3QgcmFuZG9tUG9zdFJlcSA9IHlpZWxkIGZldGNoKHJhbmRvbVBvc3RVUkwpO1xuICAgICAgICBsZXQgcGFnZWlkID0gMDtcbiAgICAgICAgaWYgKHJhbmRvbVBvc3RSZXEuc3RhdHVzID09IDIwMCkge1xuICAgICAgICAgICAgY29uc3QgcG9zdE9iaiA9IHlpZWxkIHJhbmRvbVBvc3RSZXEuanNvbigpO1xuICAgICAgICAgICAgc2VjdGlvbk9iai50aXRsZSA9IHBvc3RPYmoudGl0bGU7XG4gICAgICAgICAgICBzZWN0aW9uT2JqLmF1dGhvciA9IHBvc3RPYmouYXV0aG9yO1xuICAgICAgICAgICAgcGFnZWlkID0gcG9zdE9iai5wYWdlaWQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4ge1xuICAgICAgICAgICAgaWYgKHJhbmRvbVBvc3RSZXEuc3RhdHVzICE9IDIwMCkge1xuICAgICAgICAgICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgcmVqKHJhbmRvbVBvc3RSZXEuc3RhdHVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHNlY3Rpb25VUkwgPSBgaHR0cHM6Ly8ke3VybFRMRH0ud2lraXBlZGlhLm9yZy93L2FwaS5waHA/YWN0aW9uPXF1ZXJ5JmZvcm1hdD1qc29uJnBhZ2VpZHM9JHtwYWdlaWR9JnByb3A9ZXh0cmFjdHMmZXhpbnRybz10cnVlJm9yaWdpbj0qYDtcbiAgICAgICAgICAgIGNvbnN0IHNlY3Rpb25SZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgIHNlY3Rpb25SZXEub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChzZWN0aW9uUmVxLnJlYWR5U3RhdGUgPT0gNCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VjdGlvblJlcS5zdGF0dXMgPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2VjdGlvblRleHQgPSBKU09OLnBhcnNlKHNlY3Rpb25SZXEucmVzcG9uc2VUZXh0KS5xdWVyeVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wYWdlc1twYWdlaWQudG9TdHJpbmcoKV0uZXh0cmFjdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmRzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgZG91YmxlIHdoaXRlc3BhY2VzIGFuZCBmaW5hbGx5IHRyYWlsaW5nIHdoaXRlc3BhY2VzLlxuICAgICAgICAgICAgICAgICAgICAgICAgc2VjdGlvblRleHQgPSBzZWN0aW9uVGV4dC5yZXBsYWNlKC88XFwvcD48cD4rL2csIFwiIFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlY3Rpb25UZXh0ID0gJChcIjxkaXYvPlwiKS5odG1sKHNlY3Rpb25UZXh0KS50ZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVGV4dCA9IHNlY3Rpb25UZXh0LnJlcGxhY2UoL1xccysvZywgXCIgXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VjdGlvblRleHQgPSBzZWN0aW9uVGV4dC50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAvLyBBZGQgc3BhY2VzXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzZWN0aW9uVGV4dCA9IHNlY3Rpb25UZXh0LnJlcGxhY2UoL1thLXpBLVowLTldezMsfVxcLlthLXpBLVpdL2csICh4KSA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICB4LnJlcGxhY2UoL1xcLi8sIFwiLiBcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVGV4dC5zcGxpdChcIiBcIikuZm9yRWFjaCgod29yZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRzLnB1c2god29yZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlY3Rpb24gPSBuZXcgU2VjdGlvbihzZWN0aW9uT2JqLnRpdGxlLCBzZWN0aW9uT2JqLmF1dGhvciwgd29yZHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyhzZWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWooc2VjdGlvblJlcS5zdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHNlY3Rpb25SZXEub3BlbihcIkdFVFwiLCBzZWN0aW9uVVJMKTtcbiAgICAgICAgICAgIHNlY3Rpb25SZXEuc2VuZCgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0U2VjdGlvbiA9IGdldFNlY3Rpb247XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMud2l0aFdvcmRzID0gZXhwb3J0cy5Xb3Jkc2V0ID0gdm9pZCAwO1xuY29uc3QgbWlzY18xID0gcmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIik7XG5sZXQgY3VycmVudFdvcmRzZXQgPSBudWxsO1xubGV0IGN1cnJlbnRXb3JkR2VuZXJhdG9yID0gbnVsbDtcbmNsYXNzIFdvcmRzZXQge1xuICAgIGNvbnN0cnVjdG9yKHdvcmRzKSB7XG4gICAgICAgIHRoaXMud29yZHMgPSB3b3JkcztcbiAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLndvcmRzLmxlbmd0aDtcbiAgICB9XG4gICAgcmFuZG9tV29yZCgpIHtcbiAgICAgICAgcmV0dXJuICgwLCBtaXNjXzEucmFuZG9tRWxlbWVudEZyb21BcnJheSkodGhpcy53b3Jkcyk7XG4gICAgfVxufVxuZXhwb3J0cy5Xb3Jkc2V0ID0gV29yZHNldDtcbmNvbnN0IHByZWZpeFNpemUgPSAyO1xuY2xhc3MgQ2hhckRpc3RyaWJ1dGlvbiB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuY2hhcnMgPSB7fTtcbiAgICAgICAgdGhpcy5jb3VudCA9IDA7XG4gICAgfVxuICAgIGFkZENoYXIoY2hhcikge1xuICAgICAgICB0aGlzLmNvdW50Kys7XG4gICAgICAgIGlmIChjaGFyIGluIHRoaXMuY2hhcnMpIHtcbiAgICAgICAgICAgIHRoaXMuY2hhcnNbY2hhcl0rKztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY2hhcnNbY2hhcl0gPSAxO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJhbmRvbUNoYXIoKSB7XG4gICAgICAgIGNvbnN0IHJhbmRvbUluZGV4ID0gKDAsIG1pc2NfMS5yYW5kb21JbnRGcm9tUmFuZ2UpKDAsIHRoaXMuY291bnQgLSAxKTtcbiAgICAgICAgbGV0IHJ1bm5pbmdDb3VudCA9IDA7XG4gICAgICAgIGZvciAoY29uc3QgW2NoYXIsIGNoYXJDb3VudF0gb2YgT2JqZWN0LmVudHJpZXModGhpcy5jaGFycykpIHtcbiAgICAgICAgICAgIHJ1bm5pbmdDb3VudCArPSBjaGFyQ291bnQ7XG4gICAgICAgICAgICBpZiAocnVubmluZ0NvdW50ID4gcmFuZG9tSW5kZXgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2hhcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcy5jaGFycylbMF07XG4gICAgfVxufVxuY2xhc3MgV29yZEdlbmVyYXRvciBleHRlbmRzIFdvcmRzZXQge1xuICAgIGNvbnN0cnVjdG9yKHdvcmRzKSB7XG4gICAgICAgIHN1cGVyKHdvcmRzKTtcbiAgICAgICAgdGhpcy5uZ3JhbXMgPSB7fTtcbiAgICAgICAgLy8gQ2FuIGdlbmVyYXRlIGFuIHVuYm91bmRlZCBudW1iZXIgb2Ygd29yZHMgaW4gdGhlb3J5LlxuICAgICAgICB0aGlzLmxlbmd0aCA9IEluZmluaXR5O1xuICAgICAgICBmb3IgKGxldCB3b3JkIG9mIHdvcmRzKSB7XG4gICAgICAgICAgICAvLyBNYXJrIHRoZSBlbmQgb2YgZWFjaCB3b3JkIHdpdGggYSBzcGFjZS5cbiAgICAgICAgICAgIHdvcmQgKz0gXCIgXCI7XG4gICAgICAgICAgICBsZXQgcHJlZml4ID0gXCJcIjtcbiAgICAgICAgICAgIGZvciAoY29uc3QgYyBvZiB3b3JkKSB7XG4gICAgICAgICAgICAgICAgLy8gQWRkIGBjYCB0byB0aGUgZGlzdHJpYnV0aW9uIG9mIGNoYXJzIHRoYXQgY2FuIGNvbWUgYWZ0ZXIgYHByZWZpeGAuXG4gICAgICAgICAgICAgICAgaWYgKCEocHJlZml4IGluIHRoaXMubmdyYW1zKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm5ncmFtc1twcmVmaXhdID0gbmV3IENoYXJEaXN0cmlidXRpb24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5uZ3JhbXNbcHJlZml4XS5hZGRDaGFyKGMpO1xuICAgICAgICAgICAgICAgIHByZWZpeCA9IChwcmVmaXggKyBjKS5zdWJzdHIoLXByZWZpeFNpemUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJhbmRvbVdvcmQoKSB7XG4gICAgICAgIGxldCB3b3JkID0gXCJcIjtcbiAgICAgICAgZm9yICg7Oykge1xuICAgICAgICAgICAgY29uc3QgcHJlZml4ID0gd29yZC5zdWJzdHIoLXByZWZpeFNpemUpO1xuICAgICAgICAgICAgY29uc3QgY2hhckRpc3RyaWJ1dGlvbiA9IHRoaXMubmdyYW1zW3ByZWZpeF07XG4gICAgICAgICAgICBpZiAoIWNoYXJEaXN0cmlidXRpb24pIHtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIHNob3VsZG4ndCBoYXBwZW4gaWYgdGhpcy5uZ3JhbXMgaXMgY29tcGxldGUuIElmIGl0IGRvZXNcbiAgICAgICAgICAgICAgICAvLyBzb21laG93LCBzdGFydCBnZW5lcmF0aW5nIGEgbmV3IHdvcmQuXG4gICAgICAgICAgICAgICAgd29yZCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBQaWNrIGEgcmFuZG9tIGNoYXIgZnJvbSB0aGUgZGlzdHJpYnV0aW9uIHRoYXQgY29tZXMgYWZ0ZXIgYHByZWZpeGAuXG4gICAgICAgICAgICBjb25zdCBuZXh0Q2hhciA9IGNoYXJEaXN0cmlidXRpb24ucmFuZG9tQ2hhcigpO1xuICAgICAgICAgICAgaWYgKG5leHRDaGFyID09IFwiIFwiKSB7XG4gICAgICAgICAgICAgICAgLy8gQSBzcGFjZSBtYXJrcyB0aGUgZW5kIG9mIHRoZSB3b3JkLCBzbyBzdG9wIGdlbmVyYXRpbmcgYW5kIHJldHVybi5cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHdvcmQgKz0gbmV4dENoYXI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHdvcmQ7XG4gICAgfVxufVxuZnVuY3Rpb24gd2l0aFdvcmRzKHdvcmRzLCBmdW5ib3gpIHtcbiAgICBpZiAoZnVuYm94ID09IFwicHNldWRvbGFuZ1wiKSB7XG4gICAgICAgIGlmIChjdXJyZW50V29yZEdlbmVyYXRvciA9PSBudWxsIHx8IHdvcmRzICE9PSBjdXJyZW50V29yZEdlbmVyYXRvci53b3Jkcykge1xuICAgICAgICAgICAgY3VycmVudFdvcmRHZW5lcmF0b3IgPSBuZXcgV29yZEdlbmVyYXRvcih3b3Jkcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGN1cnJlbnRXb3JkR2VuZXJhdG9yO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGN1cnJlbnRXb3Jkc2V0ID09IG51bGwgfHwgd29yZHMgIT09IGN1cnJlbnRXb3Jkc2V0LndvcmRzKSB7XG4gICAgICAgICAgICBjdXJyZW50V29yZHNldCA9IG5ldyBXb3Jkc2V0KHdvcmRzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY3VycmVudFdvcmRzZXQ7XG4gICAgfVxufVxuZXhwb3J0cy53aXRoV29yZHMgPSB3aXRoV29yZHM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51cGRhdGVLZXl0aXBzID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vY29uZmlnXCIpKTtcbmNvbnN0IENhcmV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QvY2FyZXRcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IEN1c3RvbVRleHQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC9jdXN0b20tdGV4dFwiKSk7XG5jb25zdCBUZXN0QWN0aXZlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3N0YXRlcy90ZXN0LWFjdGl2ZVwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuZnVuY3Rpb24gdXBkYXRlS2V5dGlwcygpIHtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zd2FwRXNjQW5kVGFiKSB7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC50aXBcIikuaHRtbChgXG4gICAgdGlwOiBZb3UgY2FuIGFsc28gY2hhbmdlIGFsbCB0aGVzZSBzZXR0aW5ncyBxdWlja2x5IHVzaW5nIHRoZVxuICAgIGNvbW1hbmQgbGluZSAoXG4gICAgPGtleT50YWI8L2tleT5cbiAgICApYCk7XG4gICAgICAgICQoXCIjYm90dG9tIC5rZXlUaXBzXCIpLmh0bWwoYFxuICAgIDxrZXk+ZXNjPC9rZXk+IC0gcmVzdGFydCB0ZXN0PGJyPlxuICAgICAgPGtleT50YWI8L2tleT4gLSBjb21tYW5kIGxpbmVgKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC50aXBcIikuaHRtbChgXG4gICAgdGlwOiBZb3UgY2FuIGFsc28gY2hhbmdlIGFsbCB0aGVzZSBzZXR0aW5ncyBxdWlja2x5IHVzaW5nIHRoZVxuICAgIGNvbW1hbmQgbGluZSAoXG4gICAgPGtleT5lc2M8L2tleT5cbiAgICApYCk7XG4gICAgICAgICQoXCIjYm90dG9tIC5rZXlUaXBzXCIpLmh0bWwoYFxuICAgIDxrZXk+dGFiPC9rZXk+IC0gcmVzdGFydCB0ZXN0PGJyPlxuICAgICAgPGtleT5lc2M8L2tleT4gb3IgPGtleT5jdHJsL2NtZDwva2V5Pis8a2V5PnNoaWZ0PC9rZXk+KzxrZXk+cDwva2V5PiAtIGNvbW1hbmQgbGluZWApO1xuICAgIH1cbn1cbmV4cG9ydHMudXBkYXRlS2V5dGlwcyA9IHVwZGF0ZUtleXRpcHM7XG5pZiAod2luZG93LmxvY2F0aW9uLmhvc3RuYW1lID09PSBcImxvY2FsaG9zdFwiKSB7XG4gICAgd2luZG93Lm9uZXJyb3IgPSBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoZXJyb3IudG9TdHJpbmcoKSwgLTEpO1xuICAgIH07XG4gICAgJChcIiN0b3AgLmxvZ28gLnRvcFwiKS50ZXh0KFwibG9jYWxob3N0XCIpO1xuICAgICQoXCJoZWFkIHRpdGxlXCIpLnRleHQoJChcImhlYWQgdGl0bGVcIikudGV4dCgpICsgXCIgKGxvY2FsaG9zdClcIik7XG4gICAgJChcImJvZHlcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwiZGV2SW5kaWNhdG9yIHRsXCI+bG9jYWw8L2Rpdj48ZGl2IGNsYXNzPVwiZGV2SW5kaWNhdG9yIGJyXCI+bG9jYWw8L2Rpdj5gKTtcbiAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuZGlzY29yZEludGVncmF0aW9uIC5idXR0b25zIGFcIikuYXR0cihcImhyZWZcIiwgXCJodHRwczovL2Rpc2NvcmQuY29tL2FwaS9vYXV0aDIvYXV0aG9yaXplP2NsaWVudF9pZD03OTgyNzIzMzUwMzU0OTg1NTcmcmVkaXJlY3RfdXJpPWh0dHAlM0ElMkYlMkZsb2NhbGhvc3QlM0E1MDAwJTJGdmVyaWZ5JnJlc3BvbnNlX3R5cGU9dG9rZW4mc2NvcGU9aWRlbnRpZnlcIik7XG59XG4vL3N0b3Agc3BhY2Ugc2Nyb2xsaW5nXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoZS5jb2RlID09PSBcIlNwYWNlXCIgJiYgZS50YXJnZXQgPT09IGRvY3VtZW50LmJvZHkpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbn0pO1xud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJiZWZvcmV1bmxvYWRcIiwgKGV2ZW50KSA9PiB7XG4gICAgLy8gQ2FuY2VsIHRoZSBldmVudCBhcyBzdGF0ZWQgYnkgdGhlIHN0YW5kYXJkLlxuICAgIGlmICgoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIgJiYgY29uZmlnXzEuZGVmYXVsdC53b3JkcyA8IDEwMDApIHx8XG4gICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwidGltZVwiICYmIGNvbmZpZ18xLmRlZmF1bHQudGltZSA8IDM2MDApIHx8XG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiIHx8XG4gICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgIEN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmXG4gICAgICAgICAgICBDdXN0b21UZXh0LndvcmQgPCAxMDAwKSB8fFxuICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICBDdXN0b21UZXh0LmlzVGltZVJhbmRvbSAmJlxuICAgICAgICAgICAgQ3VzdG9tVGV4dC50aW1lIDwgMTAwMCkgfHxcbiAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgIUN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmXG4gICAgICAgICAgICBDdXN0b21UZXh0LnRleHQubGVuZ3RoIDwgMTAwMCkpIHtcbiAgICAgICAgLy9pZ25vcmVcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChUZXN0QWN0aXZlLmdldCgpKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgLy8gQ2hyb21lIHJlcXVpcmVzIHJldHVyblZhbHVlIHRvIGJlIHNldC5cbiAgICAgICAgICAgIGV2ZW50LnJldHVyblZhbHVlID0gXCJcIjtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuJCh3aW5kb3cpLm9uKFwicmVzaXplXCIsICgpID0+IHtcbiAgICBjb25zb2xlLmxvZyhcIlVwZGF0aW5nIGNhcmV0IHBvc2l0aW9uXCIpO1xuICAgIENhcmV0LnVwZGF0ZVBvc2l0aW9uKCk7XG59KTtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXkpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwic3dhcEVzY0FuZFRhYlwiKVxuICAgICAgICB1cGRhdGVLZXl0aXBzKCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5kZWJvdW5jZSA9IHZvaWQgMDtcbmZ1bmN0aW9uIGRlYm91bmNlKGZuLCBtcyA9IDI1MCkge1xuICAgIGxldCB0aW1lb3V0SWQ7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICguLi5hcmdzKSB7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpO1xuICAgICAgICB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IGZuLmFwcGx5KHRoaXMsIGFyZ3MpLCBtcyk7XG4gICAgfTtcbn1cbmV4cG9ydHMuZGVib3VuY2UgPSBkZWJvdW5jZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucmVnZXhJbmRleE9mID0gZXhwb3J0cy5zZXRDaGFyQXQgPSBleHBvcnRzLmNsZWFyVGltZW91dHMgPSBleHBvcnRzLmNhblF1aWNrUmVzdGFydCA9IGV4cG9ydHMubWFwUmFuZ2UgPSBleHBvcnRzLmlzVXNlcm5hbWVWYWxpZCA9IGV4cG9ydHMuY2xlYW5UeXBvZ3JhcGh5U3ltYm9scyA9IGV4cG9ydHMuZXNjYXBlUmVnRXhwID0gZXhwb3J0cy5yZW1vdmVfbm9uX2FzY2lpID0gZXhwb3J0cy5nZXRXb3JkcyA9IGV4cG9ydHMudG9nZ2xlRnVsbHNjcmVlbiA9IGV4cG9ydHMub2JqZWN0VG9RdWVyeVN0cmluZyA9IGV4cG9ydHMuZmluZEdldFBhcmFtZXRlciA9IGV4cG9ydHMuZ2V0UG9zaXRpb25TdHJpbmcgPSBleHBvcnRzLmdldEFycm93cyA9IGV4cG9ydHMuZ2V0QVNDSUkgPSBleHBvcnRzLmdldFNwZWNpYWxzID0gZXhwb3J0cy5nZXROdW1iZXJzID0gZXhwb3J0cy5zZWNvbmRzVG9TdHJpbmcgPSBleHBvcnRzLmdldEdpYmJlcmlzaCA9IGV4cG9ydHMuZmluZExpbmVCeUxlYXN0U3F1YXJlcyA9IGV4cG9ydHMucm91bmRUbzIgPSBleHBvcnRzLndob3JmID0gZXhwb3J0cy5rb2dhc2EgPSBleHBvcnRzLmlzQVNDSUlMZXR0ZXIgPSBleHBvcnRzLmNhcGl0YWxpemVGaXJzdExldHRlck9mRWFjaFdvcmQgPSBleHBvcnRzLmdldExhc3RDaGFyID0gZXhwb3J0cy5nZXRSZWxlYXNlc0Zyb21HaXRIdWIgPSBleHBvcnRzLm1lZGlhbiA9IGV4cG9ydHMubWVhbiA9IGV4cG9ydHMuc3RkRGV2ID0gZXhwb3J0cy5zbW9vdGggPSBleHBvcnRzLmdldENoYWxsZW5nZUxpc3QgPSBleHBvcnRzLmZpbmRDdXJyZW50R3JvdXAgPSBleHBvcnRzLmdldEN1cnJlbnRMYW5ndWFnZSA9IGV4cG9ydHMuZ2V0TGFuZ3VhZ2UgPSBleHBvcnRzLmdldExhbmd1YWdlR3JvdXBzID0gZXhwb3J0cy5nZXRMYW5ndWFnZUxpc3QgPSBleHBvcnRzLmdldENvbnRyaWJ1dG9yc0xpc3QgPSBleHBvcnRzLmdldFN1cHBvcnRlcnNMaXN0ID0gZXhwb3J0cy5nZXRGb250c0xpc3QgPSBleHBvcnRzLmdldExheW91dCA9IGV4cG9ydHMuZ2V0TGF5b3V0c0xpc3QgPSBleHBvcnRzLmdldEZ1bmJveCA9IGV4cG9ydHMuZ2V0RnVuYm94TGlzdCA9IGV4cG9ydHMuZ2V0U29ydGVkVGhlbWVzTGlzdCA9IGV4cG9ydHMuZ2V0VGhlbWVzTGlzdCA9IGV4cG9ydHMuaXNDb2xvckRhcmsgPSBleHBvcnRzLmlzQ29sb3JMaWdodCA9IGV4cG9ydHMuZ2V0dWlkID0gdm9pZCAwO1xuZXhwb3J0cy5jcmVhdGVFcnJvck1lc3NhZ2UgPSBleHBvcnRzLnJhbmRvbUVsZW1lbnRGcm9tT2JqZWN0ID0gZXhwb3J0cy5yYW5kb21FbGVtZW50RnJvbUFycmF5ID0gZXhwb3J0cy5zaHVmZmxlID0gZXhwb3J0cy5yYW5kb21JbnRGcm9tUmFuZ2UgPSBleHBvcnRzLmRvd25sb2FkUmVzdWx0c0NTViA9IGV4cG9ydHMuZ2V0TW9kZTIgPSBleHBvcnRzLnN3YXBFbGVtZW50cyA9IGV4cG9ydHMuY29udmVydFJlbVRvUGl4ZWxzID0gZXhwb3J0cy50cmFpbGluZ0NvbXBvc2VDaGFycyA9IGV4cG9ydHMuY29udmVydFJHQnRvSEVYID0gdm9pZCAwO1xuY29uc3QgTG9hZGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sb2FkZXJcIikpO1xuY29uc3QgZm9ybWF0XzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImRhdGUtZm5zL2Zvcm1hdFwiKSk7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xuZnVuY3Rpb24gZ2V0dWlkKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zb2xlLmVycm9yKFwiT25seSBzaGFyZSB0aGlzIHVpZCB3aXRoIE1pb2RlYyBhbmQgbm9ib2R5IGVsc2UhXCIpO1xuICAgIGNvbnNvbGUubG9nKChfYSA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnVpZCk7XG4gICAgY29uc29sZS5lcnJvcihcIk9ubHkgc2hhcmUgdGhpcyB1aWQgd2l0aCBNaW9kZWMgYW5kIG5vYm9keSBlbHNlIVwiKTtcbn1cbmV4cG9ydHMuZ2V0dWlkID0gZ2V0dWlkO1xuZnVuY3Rpb24gaGV4VG9IU0woaGV4KSB7XG4gICAgLy8gQ29udmVydCBoZXggdG8gUkdCIGZpcnN0XG4gICAgbGV0IHI7XG4gICAgbGV0IGc7XG4gICAgbGV0IGI7XG4gICAgaWYgKGhleC5sZW5ndGggPT0gNCkge1xuICAgICAgICByID0gKFwiMHhcIiArIGhleFsxXSArIGhleFsxXSk7XG4gICAgICAgIGcgPSAoXCIweFwiICsgaGV4WzJdICsgaGV4WzJdKTtcbiAgICAgICAgYiA9IChcIjB4XCIgKyBoZXhbM10gKyBoZXhbM10pO1xuICAgIH1cbiAgICBlbHNlIGlmIChoZXgubGVuZ3RoID09IDcpIHtcbiAgICAgICAgciA9IChcIjB4XCIgKyBoZXhbMV0gKyBoZXhbMl0pO1xuICAgICAgICBnID0gKFwiMHhcIiArIGhleFszXSArIGhleFs0XSk7XG4gICAgICAgIGIgPSAoXCIweFwiICsgaGV4WzVdICsgaGV4WzZdKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHIgPSAweDAwO1xuICAgICAgICBnID0gMHgwMDtcbiAgICAgICAgYiA9IDB4MDA7XG4gICAgfVxuICAgIC8vIFRoZW4gdG8gSFNMXG4gICAgciAvPSAyNTU7XG4gICAgZyAvPSAyNTU7XG4gICAgYiAvPSAyNTU7XG4gICAgY29uc3QgY21pbiA9IE1hdGgubWluKHIsIGcsIGIpO1xuICAgIGNvbnN0IGNtYXggPSBNYXRoLm1heChyLCBnLCBiKTtcbiAgICBjb25zdCBkZWx0YSA9IGNtYXggLSBjbWluO1xuICAgIGxldCBoID0gMDtcbiAgICBsZXQgcyA9IDA7XG4gICAgbGV0IGwgPSAwO1xuICAgIGlmIChkZWx0YSA9PSAwKVxuICAgICAgICBoID0gMDtcbiAgICBlbHNlIGlmIChjbWF4ID09IHIpXG4gICAgICAgIGggPSAoKGcgLSBiKSAvIGRlbHRhKSAlIDY7XG4gICAgZWxzZSBpZiAoY21heCA9PSBnKVxuICAgICAgICBoID0gKGIgLSByKSAvIGRlbHRhICsgMjtcbiAgICBlbHNlXG4gICAgICAgIGggPSAociAtIGcpIC8gZGVsdGEgKyA0O1xuICAgIGggPSBNYXRoLnJvdW5kKGggKiA2MCk7XG4gICAgaWYgKGggPCAwKVxuICAgICAgICBoICs9IDM2MDtcbiAgICBsID0gKGNtYXggKyBjbWluKSAvIDI7XG4gICAgcyA9IGRlbHRhID09IDAgPyAwIDogZGVsdGEgLyAoMSAtIE1hdGguYWJzKDIgKiBsIC0gMSkpO1xuICAgIHMgPSArKHMgKiAxMDApLnRvRml4ZWQoMSk7XG4gICAgbCA9ICsobCAqIDEwMCkudG9GaXhlZCgxKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBodWU6IGgsXG4gICAgICAgIHNhdDogcyxcbiAgICAgICAgbGd0OiBsLFxuICAgICAgICBzdHJpbmc6IFwiaHNsKFwiICsgaCArIFwiLFwiICsgcyArIFwiJSxcIiArIGwgKyBcIiUpXCIsXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGlzQ29sb3JMaWdodChoZXgpIHtcbiAgICBjb25zdCBoc2wgPSBoZXhUb0hTTChoZXgpO1xuICAgIHJldHVybiBoc2wubGd0ID49IDUwO1xufVxuZXhwb3J0cy5pc0NvbG9yTGlnaHQgPSBpc0NvbG9yTGlnaHQ7XG5mdW5jdGlvbiBpc0NvbG9yRGFyayhoZXgpIHtcbiAgICBjb25zdCBoc2wgPSBoZXhUb0hTTChoZXgpO1xuICAgIHJldHVybiBoc2wubGd0IDwgNTA7XG59XG5leHBvcnRzLmlzQ29sb3JEYXJrID0gaXNDb2xvckRhcms7XG5sZXQgdGhlbWVzTGlzdCA9IFtdO1xuZnVuY3Rpb24gZ2V0VGhlbWVzTGlzdCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAodGhlbWVzTGlzdC5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuICQuZ2V0SlNPTihcInRoZW1lcy9fbGlzdC5qc29uXCIsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbGlzdCA9IGRhdGEuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lQSA9IGEubmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lQiA9IGIubmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobmFtZUEgPCBuYW1lQilcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWVBID4gbmFtZUIpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhlbWVzTGlzdCA9IGxpc3Q7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoZW1lc0xpc3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGVtZXNMaXN0O1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmdldFRoZW1lc0xpc3QgPSBnZXRUaGVtZXNMaXN0O1xubGV0IHNvcnRlZFRoZW1lc0xpc3QgPSBbXTtcbmZ1bmN0aW9uIGdldFNvcnRlZFRoZW1lc0xpc3QoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKHNvcnRlZFRoZW1lc0xpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBpZiAodGhlbWVzTGlzdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB5aWVsZCBnZXRUaGVtZXNMaXN0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgc29ydGVkID0gWy4uLnRoZW1lc0xpc3RdO1xuICAgICAgICAgICAgc29ydGVkID0gc29ydGVkLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBiMSA9IGhleFRvSFNMKGEuYmdDb2xvcik7XG4gICAgICAgICAgICAgICAgY29uc3QgYjIgPSBoZXhUb0hTTChiLmJnQ29sb3IpO1xuICAgICAgICAgICAgICAgIHJldHVybiBiMi5sZ3QgLSBiMS5sZ3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNvcnRlZFRoZW1lc0xpc3QgPSBzb3J0ZWQ7XG4gICAgICAgICAgICByZXR1cm4gc29ydGVkVGhlbWVzTGlzdDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBzb3J0ZWRUaGVtZXNMaXN0O1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmdldFNvcnRlZFRoZW1lc0xpc3QgPSBnZXRTb3J0ZWRUaGVtZXNMaXN0O1xubGV0IGZ1bmJveExpc3QgPSBbXTtcbmZ1bmN0aW9uIGdldEZ1bmJveExpc3QoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKGZ1bmJveExpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5nZXRKU09OKFwiZnVuYm94L19saXN0Lmpzb25cIiwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBmdW5ib3hMaXN0ID0gZGF0YS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWVBID0gYS5uYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWVCID0gYi5uYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuYW1lQSA8IG5hbWVCKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgICAgICBpZiAobmFtZUEgPiBuYW1lQilcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuYm94TGlzdDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmJveExpc3Q7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0RnVuYm94TGlzdCA9IGdldEZ1bmJveExpc3Q7XG5mdW5jdGlvbiBnZXRGdW5ib3goZnVuYm94KSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgbGlzdCA9IHlpZWxkIGdldEZ1bmJveExpc3QoKTtcbiAgICAgICAgcmV0dXJuIGxpc3QuZmluZChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQubmFtZSA9PSBmdW5ib3g7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRGdW5ib3ggPSBnZXRGdW5ib3g7XG5sZXQgbGF5b3V0c0xpc3QgPSB7fTtcbmZ1bmN0aW9uIGdldExheW91dHNMaXN0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhsYXlvdXRzTGlzdCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5nZXRKU09OKFwibGF5b3V0cy9fbGlzdC5qc29uXCIsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgbGF5b3V0c0xpc3QgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHJldHVybiBsYXlvdXRzTGlzdDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGxheW91dHNMaXN0O1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmdldExheW91dHNMaXN0ID0gZ2V0TGF5b3V0c0xpc3Q7XG5mdW5jdGlvbiBnZXRMYXlvdXQobGF5b3V0TmFtZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhsYXlvdXRzTGlzdCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB5aWVsZCBnZXRMYXlvdXRzTGlzdCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsYXlvdXRzTGlzdFtsYXlvdXROYW1lXTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0TGF5b3V0ID0gZ2V0TGF5b3V0O1xubGV0IGZvbnRzTGlzdCA9IFtdO1xuZnVuY3Rpb24gZ2V0Rm9udHNMaXN0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChmb250c0xpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5nZXRKU09OKFwiZm9udHMvX2xpc3QuanNvblwiLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGZvbnRzTGlzdCA9IGRhdGEuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lQSA9IGEubmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lQiA9IGIubmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobmFtZUEgPCBuYW1lQilcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWVBID4gbmFtZUIpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZvbnRzTGlzdDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZvbnRzTGlzdDtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRGb250c0xpc3QgPSBnZXRGb250c0xpc3Q7XG5sZXQgc3VwcG9ydGVyc0xpc3QgPSBbXTtcbmZ1bmN0aW9uIGdldFN1cHBvcnRlcnNMaXN0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChzdXBwb3J0ZXJzTGlzdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiAkLmdldEpTT04oXCJhYm91dC9zdXBwb3J0ZXJzLmpzb25cIiwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBzdXBwb3J0ZXJzTGlzdCA9IGRhdGE7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRlcnNMaXN0O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc3VwcG9ydGVyc0xpc3Q7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0U3VwcG9ydGVyc0xpc3QgPSBnZXRTdXBwb3J0ZXJzTGlzdDtcbmxldCBjb250cmlidXRvcnNMaXN0ID0gW107XG5mdW5jdGlvbiBnZXRDb250cmlidXRvcnNMaXN0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChjb250cmlidXRvcnNMaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuICQuZ2V0SlNPTihcImFib3V0L2NvbnRyaWJ1dG9ycy5qc29uXCIsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgY29udHJpYnV0b3JzTGlzdCA9IGRhdGE7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRyaWJ1dG9yc0xpc3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBjb250cmlidXRvcnNMaXN0O1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmdldENvbnRyaWJ1dG9yc0xpc3QgPSBnZXRDb250cmlidXRvcnNMaXN0O1xubGV0IGxhbmd1YWdlTGlzdCA9IFtdO1xuZnVuY3Rpb24gZ2V0TGFuZ3VhZ2VMaXN0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChsYW5ndWFnZUxpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5nZXRKU09OKFwibGFuZ3VhZ2VzL19saXN0Lmpzb25cIiwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBsYW5ndWFnZUxpc3QgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHJldHVybiBsYW5ndWFnZUxpc3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBsYW5ndWFnZUxpc3Q7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0TGFuZ3VhZ2VMaXN0ID0gZ2V0TGFuZ3VhZ2VMaXN0O1xubGV0IGxhbmd1YWdlR3JvdXBMaXN0ID0gW107XG5mdW5jdGlvbiBnZXRMYW5ndWFnZUdyb3VwcygpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAobGFuZ3VhZ2VHcm91cExpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5nZXRKU09OKFwibGFuZ3VhZ2VzL19ncm91cHMuanNvblwiLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGxhbmd1YWdlR3JvdXBMaXN0ID0gZGF0YTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbGFuZ3VhZ2VHcm91cExpc3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBsYW5ndWFnZUdyb3VwTGlzdDtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRMYW5ndWFnZUdyb3VwcyA9IGdldExhbmd1YWdlR3JvdXBzO1xubGV0IGN1cnJlbnRMYW5ndWFnZTtcbmZ1bmN0aW9uIGdldExhbmd1YWdlKGxhbmcpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSB1bmRlZmluZWQgfHwgY3VycmVudExhbmd1YWdlLm5hbWUgIT09IGxhbmcpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImdldHRpbmcgbGFuZ3VhZ2UganNvblwiKTtcbiAgICAgICAgICAgICAgICB5aWVsZCAkLmdldEpTT04oYGxhbmd1YWdlcy8ke2xhbmd9Lmpzb25gLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGFuZ3VhZ2UgPSBkYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRMYW5ndWFnZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgZXJyb3IgZ2V0dGluZyBsYW5ndWFnZWApO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgICAgIHlpZWxkICQuZ2V0SlNPTihgbGFuZ3VhZ2VzL2VuZ2xpc2guanNvbmAsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudExhbmd1YWdlID0gZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRMYW5ndWFnZTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRMYW5ndWFnZSA9IGdldExhbmd1YWdlO1xuZnVuY3Rpb24gZ2V0Q3VycmVudExhbmd1YWdlKGxhbmd1YWdlTmFtZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHJldHVybiB5aWVsZCBnZXRMYW5ndWFnZShsYW5ndWFnZU5hbWUpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRDdXJyZW50TGFuZ3VhZ2UgPSBnZXRDdXJyZW50TGFuZ3VhZ2U7XG5mdW5jdGlvbiBmaW5kQ3VycmVudEdyb3VwKGxhbmd1YWdlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgbGV0IHJldGdyb3VwO1xuICAgICAgICBjb25zdCBncm91cHMgPSB5aWVsZCBnZXRMYW5ndWFnZUdyb3VwcygpO1xuICAgICAgICBncm91cHMuZm9yRWFjaCgoZ3JvdXApID0+IHtcbiAgICAgICAgICAgIGlmIChyZXRncm91cCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGdyb3VwLmxhbmd1YWdlcy5pbmNsdWRlcyhsYW5ndWFnZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0Z3JvdXAgPSBncm91cDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmV0Z3JvdXA7XG4gICAgfSk7XG59XG5leHBvcnRzLmZpbmRDdXJyZW50R3JvdXAgPSBmaW5kQ3VycmVudEdyb3VwO1xubGV0IGNoYWxsZW5nZUxpc3QgPSBbXTtcbmZ1bmN0aW9uIGdldENoYWxsZW5nZUxpc3QoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKGNoYWxsZW5nZUxpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5nZXRKU09OKFwiY2hhbGxlbmdlcy9fbGlzdC5qc29uXCIsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgY2hhbGxlbmdlTGlzdCA9IGRhdGE7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNoYWxsZW5nZUxpc3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBjaGFsbGVuZ2VMaXN0O1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmdldENoYWxsZW5nZUxpc3QgPSBnZXRDaGFsbGVuZ2VMaXN0O1xuZnVuY3Rpb24gc21vb3RoKGFyciwgd2luZG93U2l6ZSwgZ2V0dGVyID0gKHZhbHVlKSA9PiB2YWx1ZSkge1xuICAgIGNvbnN0IGdldCA9IGdldHRlcjtcbiAgICBjb25zdCByZXN1bHQgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBjb25zdCBsZWZ0T2ZmZXNldCA9IGkgLSB3aW5kb3dTaXplO1xuICAgICAgICBjb25zdCBmcm9tID0gbGVmdE9mZmVzZXQgPj0gMCA/IGxlZnRPZmZlc2V0IDogMDtcbiAgICAgICAgY29uc3QgdG8gPSBpICsgd2luZG93U2l6ZSArIDE7XG4gICAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICAgIGxldCBzdW0gPSAwO1xuICAgICAgICBmb3IgKGxldCBqID0gZnJvbTsgaiA8IHRvICYmIGogPCBhcnIubGVuZ3RoOyBqICs9IDEpIHtcbiAgICAgICAgICAgIHN1bSArPSBnZXQoYXJyW2pdKTtcbiAgICAgICAgICAgIGNvdW50ICs9IDE7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0W2ldID0gc3VtIC8gY291bnQ7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5leHBvcnRzLnNtb290aCA9IHNtb290aDtcbmZ1bmN0aW9uIHN0ZERldihhcnJheSkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG4gPSBhcnJheS5sZW5ndGg7XG4gICAgICAgIGNvbnN0IG1lYW4gPSBhcnJheS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiKSAvIG47XG4gICAgICAgIHJldHVybiBNYXRoLnNxcnQoYXJyYXkubWFwKCh4KSA9PiBNYXRoLnBvdyh4IC0gbWVhbiwgMikpLnJlZHVjZSgoYSwgYikgPT4gYSArIGIpIC8gbik7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbn1cbmV4cG9ydHMuc3RkRGV2ID0gc3RkRGV2O1xuZnVuY3Rpb24gbWVhbihhcnJheSkge1xuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiAoYXJyYXkucmVkdWNlKChwcmV2aW91cywgY3VycmVudCkgPT4gKGN1cnJlbnQgKz0gcHJldmlvdXMpKSAvIGFycmF5Lmxlbmd0aCk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbn1cbmV4cG9ydHMubWVhbiA9IG1lYW47XG4vL2h0dHBzOi8vd3d3LnczcmVzb3VyY2UuY29tL2phdmFzY3JpcHQtZXhlcmNpc2VzL2Z1bmRhbWVudGFsL2phdmFzY3JpcHQtZnVuZGFtZW50YWwtZXhlcmNpc2UtODgucGhwXG5mdW5jdGlvbiBtZWRpYW4oYXJyKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbWlkID0gTWF0aC5mbG9vcihhcnIubGVuZ3RoIC8gMiksIG51bXMgPSBbLi4uYXJyXS5zb3J0KChhLCBiKSA9PiBhIC0gYik7XG4gICAgICAgIHJldHVybiBhcnIubGVuZ3RoICUgMiAhPT0gMCA/IG51bXNbbWlkXSA6IChudW1zW21pZCAtIDFdICsgbnVtc1ttaWRdKSAvIDI7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbn1cbmV4cG9ydHMubWVkaWFuID0gbWVkaWFuO1xuZnVuY3Rpb24gZ2V0UmVsZWFzZXNGcm9tR2l0SHViKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHJldHVybiAkLmdldEpTT04oXCJodHRwczovL2FwaS5naXRodWIuY29tL3JlcG9zL01pb2RlYy9tb25rZXl0eXBlL3JlbGVhc2VzXCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICAkKFwiI2JvdHRvbSAudmVyc2lvbiAudGV4dFwiKS50ZXh0KGRhdGFbMF0ubmFtZSk7XG4gICAgICAgICAgICAkKFwiI2JvdHRvbSAudmVyc2lvblwiKS5jc3MoXCJvcGFjaXR5XCIsIDEpO1xuICAgICAgICAgICAgJChcIiN2ZXJzaW9uSGlzdG9yeSAucmVsZWFzZXNcIikuZW1wdHkoKTtcbiAgICAgICAgICAgIGRhdGEuZm9yRWFjaCgocmVsZWFzZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghcmVsZWFzZS5kcmFmdCAmJiAhcmVsZWFzZS5wcmVyZWxlYXNlKSB7XG4gICAgICAgICAgICAgICAgICAgICQoXCIjdmVyc2lvbkhpc3RvcnkgLnJlbGVhc2VzXCIpLmFwcGVuZChgXG4gICAgICAgICAgPGRpdiBjbGFzcz1cInJlbGVhc2VcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0aXRsZVwiPiR7cmVsZWFzZS5uYW1lfTwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImRhdGVcIj4keygwLCBmb3JtYXRfMS5kZWZhdWx0KShuZXcgRGF0ZShyZWxlYXNlLnB1Ymxpc2hlZF9hdCksIFwiZGQgTU1NIHl5eXlcIil9PC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYm9keVwiPiR7cmVsZWFzZS5ib2R5LnJlcGxhY2UoL1xcclxcbi9nLCBcIjxicj5cIil9PC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIGApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0UmVsZWFzZXNGcm9tR2l0SHViID0gZ2V0UmVsZWFzZXNGcm9tR2l0SHViO1xuLy8gZnVuY3Rpb24gZ2V0UGF0cmVvbk5hbWVzKCkge1xuLy8gICBsZXQgbmFtZXNlbCA9ICQoXCIucGFnZUFib3V0IC5zZWN0aW9uIC5zdXBwb3J0ZXJzXCIpO1xuLy8gICBmaXJlYmFzZVxuLy8gICAgIC5mdW5jdGlvbnMoKVxuLy8gICAgIC5odHRwc0NhbGxhYmxlKFwiZ2V0UGF0cmVvbnNcIikoKVxuLy8gICAgIC50aGVuKChkYXRhKSA9PiB7XG4vLyAgICAgICBsZXQgbmFtZXMgPSBkYXRhLmRhdGE7XG4vLyAgICAgICBuYW1lcy5mb3JFYWNoKChuYW1lKSA9PiB7XG4vLyAgICAgICAgIG5hbWVzZWwuYXBwZW5kKGA8ZGl2PiR7bmFtZX08L2Rpdj5gKTtcbi8vICAgICAgIH0pO1xuLy8gICAgIH0pO1xuLy8gfVxuZnVuY3Rpb24gZ2V0TGFzdENoYXIod29yZCkge1xuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiB3b3JkLmNoYXJBdCh3b3JkLmxlbmd0aCAtIDEpO1xuICAgIH1cbiAgICBjYXRjaCAoX2EpIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxufVxuZXhwb3J0cy5nZXRMYXN0Q2hhciA9IGdldExhc3RDaGFyO1xuZnVuY3Rpb24gY2FwaXRhbGl6ZUZpcnN0TGV0dGVyT2ZFYWNoV29yZChzdHIpIHtcbiAgICByZXR1cm4gc3RyXG4gICAgICAgIC5zcGxpdCgvICsvKVxuICAgICAgICAubWFwKChzKSA9PiBzLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcy5zbGljZSgxKSlcbiAgICAgICAgLmpvaW4oXCIgXCIpO1xufVxuZXhwb3J0cy5jYXBpdGFsaXplRmlyc3RMZXR0ZXJPZkVhY2hXb3JkID0gY2FwaXRhbGl6ZUZpcnN0TGV0dGVyT2ZFYWNoV29yZDtcbmZ1bmN0aW9uIGlzQVNDSUlMZXR0ZXIoYykge1xuICAgIHJldHVybiBjLmxlbmd0aCA9PT0gMSAmJiAvW2Etel0vaS50ZXN0KGMpO1xufVxuZXhwb3J0cy5pc0FTQ0lJTGV0dGVyID0gaXNBU0NJSUxldHRlcjtcbmZ1bmN0aW9uIGtvZ2FzYShjb3YpIHtcbiAgICByZXR1cm4gKDEwMCAqICgxIC0gTWF0aC50YW5oKGNvdiArIE1hdGgucG93KGNvdiwgMykgLyAzICsgTWF0aC5wb3coY292LCA1KSAvIDUpKSk7XG59XG5leHBvcnRzLmtvZ2FzYSA9IGtvZ2FzYTtcbmZ1bmN0aW9uIHdob3JmKHNwZWVkLCB3b3JkbGVuKSB7XG4gICAgcmV0dXJuIE1hdGgubWluKHNwZWVkLCBNYXRoLmZsb29yKHNwZWVkICogTWF0aC5wb3coMS4wMywgLTIgKiAod29yZGxlbiAtIDMpKSkpO1xufVxuZXhwb3J0cy53aG9yZiA9IHdob3JmO1xuZnVuY3Rpb24gcm91bmRUbzIobnVtKSB7XG4gICAgcmV0dXJuIE1hdGgucm91bmQoKG51bSArIE51bWJlci5FUFNJTE9OKSAqIDEwMCkgLyAxMDA7XG59XG5leHBvcnRzLnJvdW5kVG8yID0gcm91bmRUbzI7XG5mdW5jdGlvbiBmaW5kTGluZUJ5TGVhc3RTcXVhcmVzKHZhbHVlc195KSB7XG4gICAgbGV0IHN1bV94ID0gMDtcbiAgICBsZXQgc3VtX3kgPSAwO1xuICAgIGxldCBzdW1feHkgPSAwO1xuICAgIGxldCBzdW1feHggPSAwO1xuICAgIGxldCBjb3VudCA9IDA7XG4gICAgLypcbiAgICAgKiBXZSdsbCB1c2UgdGhvc2UgbGV0aWFibGVzIGZvciBmYXN0ZXIgcmVhZC93cml0ZSBhY2Nlc3MuXG4gICAgICovXG4gICAgbGV0IHggPSAwO1xuICAgIGxldCB5ID0gMDtcbiAgICBjb25zdCB2YWx1ZXNfbGVuZ3RoID0gdmFsdWVzX3kubGVuZ3RoO1xuICAgIC8qXG4gICAgICogTm90aGluZyB0byBkby5cbiAgICAgKi9cbiAgICBpZiAodmFsdWVzX2xlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gW1tdLCBbXV07XG4gICAgfVxuICAgIC8qXG4gICAgICogQ2FsY3VsYXRlIHRoZSBzdW0gZm9yIGVhY2ggb2YgdGhlIHBhcnRzIG5lY2Vzc2FyeS5cbiAgICAgKi9cbiAgICBmb3IgKGxldCB2ID0gMDsgdiA8IHZhbHVlc19sZW5ndGg7IHYrKykge1xuICAgICAgICB4ID0gdiArIDE7XG4gICAgICAgIHkgPSB2YWx1ZXNfeVt2XTtcbiAgICAgICAgc3VtX3ggKz0geDtcbiAgICAgICAgc3VtX3kgKz0geTtcbiAgICAgICAgc3VtX3h4ICs9IHggKiB4O1xuICAgICAgICBzdW1feHkgKz0geCAqIHk7XG4gICAgICAgIGNvdW50Kys7XG4gICAgfVxuICAgIC8qXG4gICAgICogQ2FsY3VsYXRlIG0gYW5kIGIgZm9yIHRoZSBmb3JtdWxhcjpcbiAgICAgKiB5ID0geCAqIG0gKyBiXG4gICAgICovXG4gICAgY29uc3QgbSA9IChjb3VudCAqIHN1bV94eSAtIHN1bV94ICogc3VtX3kpIC8gKGNvdW50ICogc3VtX3h4IC0gc3VtX3ggKiBzdW1feCk7XG4gICAgY29uc3QgYiA9IHN1bV95IC8gY291bnQgLSAobSAqIHN1bV94KSAvIGNvdW50O1xuICAgIGNvbnN0IHJldHVybnBvaW50MSA9IFsxLCAxICogbSArIGJdO1xuICAgIGNvbnN0IHJldHVybnBvaW50MiA9IFt2YWx1ZXNfbGVuZ3RoLCB2YWx1ZXNfbGVuZ3RoICogbSArIGJdO1xuICAgIHJldHVybiBbcmV0dXJucG9pbnQxLCByZXR1cm5wb2ludDJdO1xufVxuZXhwb3J0cy5maW5kTGluZUJ5TGVhc3RTcXVhcmVzID0gZmluZExpbmVCeUxlYXN0U3F1YXJlcztcbmZ1bmN0aW9uIGdldEdpYmJlcmlzaCgpIHtcbiAgICBjb25zdCByYW5kTGVuID0gcmFuZG9tSW50RnJvbVJhbmdlKDEsIDcpO1xuICAgIGxldCByZXQgPSBcIlwiO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmFuZExlbjsgaSsrKSB7XG4gICAgICAgIHJldCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDk3ICsgcmFuZG9tSW50RnJvbVJhbmdlKDAsIDI1KSk7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59XG5leHBvcnRzLmdldEdpYmJlcmlzaCA9IGdldEdpYmJlcmlzaDtcbmZ1bmN0aW9uIHNlY29uZHNUb1N0cmluZyhzZWMsIGFsd2F5c1Nob3dNaW51dGVzID0gZmFsc2UsIGFsd2F5c1Nob3dIb3VycyA9IGZhbHNlLCBkZWxpbWl0ZXIgPSBcIjpcIiwgc2hvd1NlY29uZHMgPSB0cnVlLCBzaG93RGF5cyA9IGZhbHNlKSB7XG4gICAgc2VjID0gTWF0aC5hYnMoc2VjKTtcbiAgICBsZXQgZGF5cyA9IDA7XG4gICAgbGV0IGhvdXJzO1xuICAgIGlmIChzaG93RGF5cykge1xuICAgICAgICBkYXlzID0gTWF0aC5mbG9vcihzZWMgLyA4NjQwMCk7XG4gICAgICAgIGhvdXJzID0gTWF0aC5mbG9vcigoc2VjICUgODY0MDApIC8gMzYwMCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBob3VycyA9IE1hdGguZmxvb3Ioc2VjIC8gMzYwMCk7XG4gICAgfVxuICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKChzZWMgJSAzNjAwKSAvIDYwKTtcbiAgICBjb25zdCBzZWNvbmRzID0gcm91bmRUbzIoKHNlYyAlIDM2MDApICUgNjApO1xuICAgIGxldCBkYXlzU3RyaW5nO1xuICAgIGxldCBob3Vyc1N0cmluZztcbiAgICBsZXQgbWludXRlc1N0cmluZztcbiAgICBsZXQgc2Vjb25kc1N0cmluZztcbiAgICBpZiAoc2hvd0RheXMpIHtcbiAgICAgICAgZGF5cyA8IDEwICYmIGRlbGltaXRlciAhPT0gXCJ0ZXh0XCJcbiAgICAgICAgICAgID8gKGRheXNTdHJpbmcgPSBcIjBcIiArIGRheXMpXG4gICAgICAgICAgICA6IChkYXlzU3RyaW5nID0gZGF5cyk7XG4gICAgfVxuICAgIGhvdXJzIDwgMTAgJiYgZGVsaW1pdGVyICE9PSBcInRleHRcIlxuICAgICAgICA/IChob3Vyc1N0cmluZyA9IFwiMFwiICsgaG91cnMpXG4gICAgICAgIDogKGhvdXJzU3RyaW5nID0gaG91cnMpO1xuICAgIG1pbnV0ZXMgPCAxMCAmJiBkZWxpbWl0ZXIgIT09IFwidGV4dFwiXG4gICAgICAgID8gKG1pbnV0ZXNTdHJpbmcgPSBcIjBcIiArIG1pbnV0ZXMpXG4gICAgICAgIDogKG1pbnV0ZXNTdHJpbmcgPSBtaW51dGVzKTtcbiAgICBzZWNvbmRzIDwgMTAgJiZcbiAgICAgICAgKG1pbnV0ZXMgPiAwIHx8IGhvdXJzID4gMCB8fCBhbHdheXNTaG93TWludXRlcykgJiZcbiAgICAgICAgZGVsaW1pdGVyICE9PSBcInRleHRcIlxuICAgICAgICA/IChzZWNvbmRzU3RyaW5nID0gXCIwXCIgKyBzZWNvbmRzKVxuICAgICAgICA6IChzZWNvbmRzU3RyaW5nID0gc2Vjb25kcyk7XG4gICAgbGV0IHJldCA9IFwiXCI7XG4gICAgaWYgKGRheXMgPiAwICYmIHNob3dEYXlzKSB7XG4gICAgICAgIHJldCArPSBkYXlzU3RyaW5nO1xuICAgICAgICBpZiAoZGVsaW1pdGVyID09PSBcInRleHRcIikge1xuICAgICAgICAgICAgaWYgKGRheXMgPT0gMSkge1xuICAgICAgICAgICAgICAgIHJldCArPSBcIiBkYXkgXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXQgKz0gXCIgZGF5cyBcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldCArPSBkZWxpbWl0ZXI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGhvdXJzID4gMCB8fCBhbHdheXNTaG93SG91cnMpIHtcbiAgICAgICAgcmV0ICs9IGhvdXJzU3RyaW5nO1xuICAgICAgICBpZiAoZGVsaW1pdGVyID09PSBcInRleHRcIikge1xuICAgICAgICAgICAgaWYgKGhvdXJzID09IDEpIHtcbiAgICAgICAgICAgICAgICByZXQgKz0gXCIgaG91ciBcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldCArPSBcIiBob3VycyBcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldCArPSBkZWxpbWl0ZXI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKG1pbnV0ZXMgPiAwIHx8IGhvdXJzID4gMCB8fCBhbHdheXNTaG93TWludXRlcykge1xuICAgICAgICByZXQgKz0gbWludXRlc1N0cmluZztcbiAgICAgICAgaWYgKGRlbGltaXRlciA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgICAgIGlmIChtaW51dGVzID09IDEpIHtcbiAgICAgICAgICAgICAgICByZXQgKz0gXCIgbWludXRlIFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0ICs9IFwiIG1pbnV0ZXMgXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoc2hvd1NlY29uZHMpIHtcbiAgICAgICAgICAgIHJldCArPSBkZWxpbWl0ZXI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHNob3dTZWNvbmRzKSB7XG4gICAgICAgIHJldCArPSBzZWNvbmRzU3RyaW5nO1xuICAgICAgICBpZiAoZGVsaW1pdGVyID09PSBcInRleHRcIikge1xuICAgICAgICAgICAgaWYgKHNlY29uZHMgPT0gMSkge1xuICAgICAgICAgICAgICAgIHJldCArPSBcIiBzZWNvbmRcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldCArPSBcIiBzZWNvbmRzXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGhvdXJzID09PSAwICYmIG1pbnV0ZXMgPT09IDAgJiYgIXNob3dTZWNvbmRzICYmIGRlbGltaXRlciA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgcmV0ID0gXCJsZXNzIHRoYW4gMSBtaW51dGVcIjtcbiAgICB9XG4gICAgcmV0dXJuIHJldC50cmltKCk7XG59XG5leHBvcnRzLnNlY29uZHNUb1N0cmluZyA9IHNlY29uZHNUb1N0cmluZztcbmZ1bmN0aW9uIGdldE51bWJlcnMobGVuKSB7XG4gICAgY29uc3QgcmFuZExlbiA9IHJhbmRvbUludEZyb21SYW5nZSgxLCBsZW4pO1xuICAgIGxldCByZXQgPSBcIlwiO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmFuZExlbjsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHJhbmRvbU51bSA9IHJhbmRvbUludEZyb21SYW5nZSgwLCA5KTtcbiAgICAgICAgcmV0ICs9IHJhbmRvbU51bS50b1N0cmluZygpO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufVxuZXhwb3J0cy5nZXROdW1iZXJzID0gZ2V0TnVtYmVycztcbmZ1bmN0aW9uIGdldFNwZWNpYWxzKCkge1xuICAgIGNvbnN0IHJhbmRMZW4gPSByYW5kb21JbnRGcm9tUmFuZ2UoMSwgNyk7XG4gICAgbGV0IHJldCA9IFwiXCI7XG4gICAgY29uc3Qgc3BlY2lhbHMgPSBbXG4gICAgICAgIFwiIVwiLFxuICAgICAgICBcIkBcIixcbiAgICAgICAgXCIjXCIsXG4gICAgICAgIFwiJFwiLFxuICAgICAgICBcIiVcIixcbiAgICAgICAgXCJeXCIsXG4gICAgICAgIFwiJlwiLFxuICAgICAgICBcIipcIixcbiAgICAgICAgXCIoXCIsXG4gICAgICAgIFwiKVwiLFxuICAgICAgICBcIi1cIixcbiAgICAgICAgXCJfXCIsXG4gICAgICAgIFwiPVwiLFxuICAgICAgICBcIitcIixcbiAgICAgICAgXCJ7XCIsXG4gICAgICAgIFwifVwiLFxuICAgICAgICBcIltcIixcbiAgICAgICAgXCJdXCIsXG4gICAgICAgIFwiJ1wiLFxuICAgICAgICAnXCInLFxuICAgICAgICBcIi9cIixcbiAgICAgICAgXCJcXFxcXCIsXG4gICAgICAgIFwifFwiLFxuICAgIF07XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCByYW5kTGVuOyBpKyspIHtcbiAgICAgICAgcmV0ICs9IHJhbmRvbUVsZW1lbnRGcm9tQXJyYXkoc3BlY2lhbHMpO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufVxuZXhwb3J0cy5nZXRTcGVjaWFscyA9IGdldFNwZWNpYWxzO1xuZnVuY3Rpb24gZ2V0QVNDSUkoKSB7XG4gICAgY29uc3QgcmFuZExlbiA9IHJhbmRvbUludEZyb21SYW5nZSgxLCAxMCk7XG4gICAgbGV0IHJldCA9IFwiXCI7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCByYW5kTGVuOyBpKyspIHtcbiAgICAgICAgbGV0IHJhbiA9IDMzICsgcmFuZG9tSW50RnJvbVJhbmdlKDAsIDkzKTtcbiAgICAgICAgd2hpbGUgKHJhbiA9PSA5NiB8fCByYW4gPT0gOTQpXG4gICAgICAgICAgICByYW4gPSAzMyArIHJhbmRvbUludEZyb21SYW5nZSgwLCA5Myk7IC8vdG9kbyByZW1vdmUgd2hlbiBpbnB1dCByZXdyaXRlIGlzIGZpeGVkXG4gICAgICAgIHJldCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHJhbik7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59XG5leHBvcnRzLmdldEFTQ0lJID0gZ2V0QVNDSUk7XG5mdW5jdGlvbiBnZXRBcnJvd3MoKSB7XG4gICAgY29uc3QgYXJyb3dBcnJheSA9IFtcIuKGkFwiLCBcIuKGkVwiLCBcIuKGklwiLCBcIuKGk1wiXTtcbiAgICBsZXQgYXJyb3dXb3JkID0gXCJcIjtcbiAgICBsZXQgbGFzdGNoYXI7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHtcbiAgICAgICAgbGV0IHJhbmRvbSA9IHJhbmRvbUVsZW1lbnRGcm9tQXJyYXkoYXJyb3dBcnJheSk7XG4gICAgICAgIHdoaWxlIChyYW5kb20gPT09IGxhc3RjaGFyKSB7XG4gICAgICAgICAgICByYW5kb20gPSByYW5kb21FbGVtZW50RnJvbUFycmF5KGFycm93QXJyYXkpO1xuICAgICAgICB9XG4gICAgICAgIGxhc3RjaGFyID0gcmFuZG9tO1xuICAgICAgICBhcnJvd1dvcmQgKz0gcmFuZG9tO1xuICAgIH1cbiAgICByZXR1cm4gYXJyb3dXb3JkO1xufVxuZXhwb3J0cy5nZXRBcnJvd3MgPSBnZXRBcnJvd3M7XG5mdW5jdGlvbiBnZXRQb3NpdGlvblN0cmluZyhudW1iZXIpIHtcbiAgICBsZXQgbnVtZW5kID0gXCJ0aFwiO1xuICAgIGNvbnN0IHQgPSBudW1iZXIgJSAxMDtcbiAgICBjb25zdCBoID0gbnVtYmVyICUgMTAwO1xuICAgIGlmICh0ID09IDEgJiYgaCAhPSAxMSkge1xuICAgICAgICBudW1lbmQgPSBcInN0XCI7XG4gICAgfVxuICAgIGlmICh0ID09IDIgJiYgaCAhPSAxMikge1xuICAgICAgICBudW1lbmQgPSBcIm5kXCI7XG4gICAgfVxuICAgIGlmICh0ID09IDMgJiYgaCAhPSAxMykge1xuICAgICAgICBudW1lbmQgPSBcInJkXCI7XG4gICAgfVxuICAgIHJldHVybiBudW1iZXIgKyBudW1lbmQ7XG59XG5leHBvcnRzLmdldFBvc2l0aW9uU3RyaW5nID0gZ2V0UG9zaXRpb25TdHJpbmc7XG5mdW5jdGlvbiBmaW5kR2V0UGFyYW1ldGVyKHBhcmFtZXRlck5hbWUpIHtcbiAgICBsZXQgcmVzdWx0ID0gbnVsbDtcbiAgICBsZXQgdG1wID0gW107XG4gICAgbG9jYXRpb24uc2VhcmNoXG4gICAgICAgIC5zdWJzdHIoMSlcbiAgICAgICAgLnNwbGl0KFwiJlwiKVxuICAgICAgICAuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICB0bXAgPSBpdGVtLnNwbGl0KFwiPVwiKTtcbiAgICAgICAgaWYgKHRtcFswXSA9PT0gcGFyYW1ldGVyTmFtZSlcbiAgICAgICAgICAgIHJlc3VsdCA9IGRlY29kZVVSSUNvbXBvbmVudCh0bXBbMV0pO1xuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHQ7XG59XG5leHBvcnRzLmZpbmRHZXRQYXJhbWV0ZXIgPSBmaW5kR2V0UGFyYW1ldGVyO1xuZnVuY3Rpb24gb2JqZWN0VG9RdWVyeVN0cmluZyhvYmopIHtcbiAgICBjb25zdCBzdHIgPSBbXTtcbiAgICBmb3IgKGNvbnN0IHAgaW4gb2JqKSB7XG4gICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwKSkge1xuICAgICAgICAgICAgLy8gQXJyYXlzIGdldCBlbmNvZGVkIGFzIGEgY29tbWEoJTJDKS1zZXBhcmF0ZWQgbGlzdFxuICAgICAgICAgICAgc3RyLnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KHApICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQob2JqW3BdKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHN0ci5qb2luKFwiJlwiKTtcbn1cbmV4cG9ydHMub2JqZWN0VG9RdWVyeVN0cmluZyA9IG9iamVjdFRvUXVlcnlTdHJpbmc7XG5mdW5jdGlvbiB0b2dnbGVGdWxsc2NyZWVuKCkge1xuICAgIGNvbnN0IGVsZW0gPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gICAgaWYgKCFkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCAmJlxuICAgICAgICAhZG9jdW1lbnQubW96RnVsbFNjcmVlbkVsZW1lbnQgJiZcbiAgICAgICAgIWRvY3VtZW50LndlYmtpdEZ1bGxzY3JlZW5FbGVtZW50ICYmXG4gICAgICAgICFkb2N1bWVudC5tc0Z1bGxzY3JlZW5FbGVtZW50KSB7XG4gICAgICAgIGlmIChlbGVtLnJlcXVlc3RGdWxsc2NyZWVuKSB7XG4gICAgICAgICAgICBlbGVtLnJlcXVlc3RGdWxsc2NyZWVuKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZWxlbS5tc1JlcXVlc3RGdWxsc2NyZWVuKSB7XG4gICAgICAgICAgICBlbGVtLm1zUmVxdWVzdEZ1bGxzY3JlZW4oKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChlbGVtLm1velJlcXVlc3RGdWxsU2NyZWVuKSB7XG4gICAgICAgICAgICBlbGVtLm1velJlcXVlc3RGdWxsU2NyZWVuKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZWxlbS53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbikge1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgZWxlbS53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbihFbGVtZW50LkFMTE9XX0tFWUJPQVJEX0lOUFVUKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5leGl0RnVsbHNjcmVlbigpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGRvY3VtZW50Lm1zRXhpdEZ1bGxzY3JlZW4pIHtcbiAgICAgICAgICAgIGRvY3VtZW50Lm1zRXhpdEZ1bGxzY3JlZW4oKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChkb2N1bWVudC5tb3pDYW5jZWxGdWxsU2NyZWVuKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5tb3pDYW5jZWxGdWxsU2NyZWVuKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZG9jdW1lbnQud2Via2l0RXhpdEZ1bGxzY3JlZW4pIHtcbiAgICAgICAgICAgIGRvY3VtZW50LndlYmtpdEV4aXRGdWxsc2NyZWVuKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLnRvZ2dsZUZ1bGxzY3JlZW4gPSB0b2dnbGVGdWxsc2NyZWVuO1xuZnVuY3Rpb24gZ2V0V29yZHMoKSB7XG4gICAgY29uc3Qgd29yZHMgPSBbLi4uZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIiN3b3JkcyAud29yZFwiKV1cbiAgICAgICAgLm1hcCgod29yZCkgPT4ge1xuICAgICAgICByZXR1cm4gWy4uLndvcmQucXVlcnlTZWxlY3RvckFsbChcImxldHRlclwiKV1cbiAgICAgICAgICAgIC5tYXAoKGxldHRlcikgPT4gbGV0dGVyLnRleHRDb250ZW50KVxuICAgICAgICAgICAgLmpvaW4oXCJcIik7XG4gICAgfSlcbiAgICAgICAgLmpvaW4oXCIgXCIpO1xuICAgIHJldHVybiB3b3Jkcztcbn1cbmV4cG9ydHMuZ2V0V29yZHMgPSBnZXRXb3Jkcztcbi8vY3JlZGl0OiBodHRwczovL3d3dy53M3Jlc291cmNlLmNvbS9qYXZhc2NyaXB0LWV4ZXJjaXNlcy9qYXZhc2NyaXB0LXN0cmluZy1leGVyY2lzZS0zMi5waHBcbmZ1bmN0aW9uIHJlbW92ZV9ub25fYXNjaWkoc3RyKSB7XG4gICAgaWYgKHN0ciA9PT0gbnVsbCB8fCBzdHIgPT09IFwiXCIpXG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgIGVsc2VcbiAgICAgICAgc3RyID0gc3RyLnRvU3RyaW5nKCk7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bXlxceDIwLVxceDdFXS9nLCBcIlwiKTtcbn1cbmV4cG9ydHMucmVtb3ZlX25vbl9hc2NpaSA9IHJlbW92ZV9ub25fYXNjaWk7XG5mdW5jdGlvbiBlc2NhcGVSZWdFeHAoc3RyKSB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bLiorP14ke30oKXxbXFxdXFxcXF0vZywgXCJcXFxcJCZcIik7XG59XG5leHBvcnRzLmVzY2FwZVJlZ0V4cCA9IGVzY2FwZVJlZ0V4cDtcbmZ1bmN0aW9uIGNsZWFuVHlwb2dyYXBoeVN5bWJvbHModGV4dFRvQ2xlYW4pIHtcbiAgICBjb25zdCBzcGVjaWFscyA9IHtcbiAgICAgICAgXCLigJxcIjogJ1wiJyxcbiAgICAgICAgXCLigJ1cIjogJ1wiJyxcbiAgICAgICAgXCLigJlcIjogXCInXCIsXG4gICAgICAgIFwi4oCYXCI6IFwiJ1wiLFxuICAgICAgICBcIixcIjogXCIsXCIsXG4gICAgICAgIFwi4oCUXCI6IFwiLVwiLFxuICAgICAgICBcIuKAplwiOiBcIi4uLlwiLFxuICAgICAgICBcIsKrXCI6IFwiPDxcIixcbiAgICAgICAgXCLCu1wiOiBcIj4+XCIsXG4gICAgICAgIFwi4oCTXCI6IFwiLVwiLFxuICAgICAgICBcIuKAh1wiOiBcIiBcIixcbiAgICAgICAgXCLigK9cIjogXCIgXCIsXG4gICAgICAgIFwiwqBcIjogXCIgXCIsXG4gICAgfTtcbiAgICByZXR1cm4gdGV4dFRvQ2xlYW4ucmVwbGFjZSgvW+KAnOKAneKAmeKAmOKAlCzigKbCq8K74oCTXFx1MjAwN1xcdTIwMkZcXHUwMEEwXS9nLCAoY2hhcikgPT4gc3BlY2lhbHNbY2hhcl0gfHwgXCJcIik7XG59XG5leHBvcnRzLmNsZWFuVHlwb2dyYXBoeVN5bWJvbHMgPSBjbGVhblR5cG9ncmFwaHlTeW1ib2xzO1xuZnVuY3Rpb24gaXNVc2VybmFtZVZhbGlkKG5hbWUpIHtcbiAgICBpZiAobmFtZSA9PT0gbnVsbCB8fCBuYW1lID09PSB1bmRlZmluZWQgfHwgbmFtZSA9PT0gXCJcIilcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmICgvbWlvZGVjLy50ZXN0KG5hbWUudG9Mb3dlckNhc2UoKSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAoL2JpdGx5Ly50ZXN0KG5hbWUudG9Mb3dlckNhc2UoKSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAobmFtZS5sZW5ndGggPiAxNClcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmICgvXlxcLi4qLy50ZXN0KG5hbWUudG9Mb3dlckNhc2UoKSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gL15bMC05YS16QS1aXy4tXSskLy50ZXN0KG5hbWUpO1xufVxuZXhwb3J0cy5pc1VzZXJuYW1lVmFsaWQgPSBpc1VzZXJuYW1lVmFsaWQ7XG5mdW5jdGlvbiBtYXBSYW5nZSh4LCBpbl9taW4sIGluX21heCwgb3V0X21pbiwgb3V0X21heCkge1xuICAgIGxldCBudW0gPSAoKHggLSBpbl9taW4pICogKG91dF9tYXggLSBvdXRfbWluKSkgLyAoaW5fbWF4IC0gaW5fbWluKSArIG91dF9taW47XG4gICAgaWYgKG91dF9taW4gPiBvdXRfbWF4KSB7XG4gICAgICAgIGlmIChudW0gPiBvdXRfbWluKSB7XG4gICAgICAgICAgICBudW0gPSBvdXRfbWluO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG51bSA8IG91dF9tYXgpIHtcbiAgICAgICAgICAgIG51bSA9IG91dF9tYXg7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChudW0gPCBvdXRfbWluKSB7XG4gICAgICAgICAgICBudW0gPSBvdXRfbWluO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG51bSA+IG91dF9tYXgpIHtcbiAgICAgICAgICAgIG51bSA9IG91dF9tYXg7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bTtcbn1cbmV4cG9ydHMubWFwUmFuZ2UgPSBtYXBSYW5nZTtcbmZ1bmN0aW9uIGNhblF1aWNrUmVzdGFydChtb2RlLCB3b3JkcywgdGltZSwgQ3VzdG9tVGV4dCkge1xuICAgIGlmICgobW9kZSA9PT0gXCJ3b3Jkc1wiICYmIHdvcmRzIDwgMTAwMCkgfHxcbiAgICAgICAgKG1vZGUgPT09IFwidGltZVwiICYmIHRpbWUgPCAzNjAwKSB8fFxuICAgICAgICBtb2RlID09PSBcInF1b3RlXCIgfHxcbiAgICAgICAgKG1vZGUgPT09IFwiY3VzdG9tXCIgJiYgQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gJiYgQ3VzdG9tVGV4dC53b3JkIDwgMTAwMCkgfHxcbiAgICAgICAgKG1vZGUgPT09IFwiY3VzdG9tXCIgJiYgQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20gJiYgQ3VzdG9tVGV4dC50aW1lIDwgMzYwMCkgfHxcbiAgICAgICAgKG1vZGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgICFDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgQ3VzdG9tVGV4dC50ZXh0Lmxlbmd0aCA8IDEwMDApKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cbmV4cG9ydHMuY2FuUXVpY2tSZXN0YXJ0ID0gY2FuUXVpY2tSZXN0YXJ0O1xuZnVuY3Rpb24gY2xlYXJUaW1lb3V0cyh0aW1lb3V0cykge1xuICAgIHRpbWVvdXRzLmZvckVhY2goKHRvKSA9PiB7XG4gICAgICAgIGlmICh0eXBlb2YgdG8gPT09IFwibnVtYmVyXCIpXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodG8pO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodG8pO1xuICAgIH0pO1xufVxuZXhwb3J0cy5jbGVhclRpbWVvdXRzID0gY2xlYXJUaW1lb3V0cztcbi8vaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTQzMTA5NC9ob3ctZG8taS1yZXBsYWNlLWEtY2hhcmFjdGVyLWF0LWEtcGFydGljdWxhci1pbmRleC1pbi1qYXZhc2NyaXB0XG5mdW5jdGlvbiBzZXRDaGFyQXQoc3RyLCBpbmRleCwgY2hyKSB7XG4gICAgaWYgKGluZGV4ID4gc3RyLmxlbmd0aCAtIDEpXG4gICAgICAgIHJldHVybiBzdHI7XG4gICAgcmV0dXJuIHN0ci5zdWJzdHJpbmcoMCwgaW5kZXgpICsgY2hyICsgc3RyLnN1YnN0cmluZyhpbmRleCArIDEpO1xufVxuZXhwb3J0cy5zZXRDaGFyQXQgPSBzZXRDaGFyQXQ7XG4vL2h0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzI3Mzc4OS9pcy10aGVyZS1hLXZlcnNpb24tb2YtamF2YXNjcmlwdHMtc3RyaW5nLWluZGV4b2YtdGhhdC1hbGxvd3MtZm9yLXJlZ3VsYXItZXhwclxuZnVuY3Rpb24gcmVnZXhJbmRleE9mKHN0cmluZywgcmVnZXgsIHN0YXJ0cG9zKSB7XG4gICAgY29uc3QgaW5kZXhPZiA9IHN0cmluZy5zdWJzdHJpbmcoc3RhcnRwb3MgfHwgMCkuc2VhcmNoKHJlZ2V4KTtcbiAgICByZXR1cm4gaW5kZXhPZiA+PSAwID8gaW5kZXhPZiArIChzdGFydHBvcyB8fCAwKSA6IGluZGV4T2Y7XG59XG5leHBvcnRzLnJlZ2V4SW5kZXhPZiA9IHJlZ2V4SW5kZXhPZjtcbmZ1bmN0aW9uIGNvbnZlcnRSR0J0b0hFWChyZ2IpIHtcbiAgICBjb25zdCBtYXRjaCA9IHJnYi5tYXRjaCgvXnJnYlxcKChcXGQrKSwgXFxzKihcXGQrKSwgXFxzKihcXGQrKVxcKSQvKTtcbiAgICBpZiAobWF0Y2ggPT09IG51bGwpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAobWF0Y2gubGVuZ3RoIDwgMylcbiAgICAgICAgcmV0dXJuO1xuICAgIGZ1bmN0aW9uIGhleENvZGUoaSkge1xuICAgICAgICAvLyBUYWtlIHRoZSBsYXN0IDIgY2hhcmFjdGVycyBhbmQgY29udmVydFxuICAgICAgICAvLyB0aGVtIHRvIEhleGFkZWNpbWFsLlxuICAgICAgICByZXR1cm4gKFwiMFwiICsgcGFyc2VJbnQoaSkudG9TdHJpbmcoMTYpKS5zbGljZSgtMik7XG4gICAgfVxuICAgIHJldHVybiBcIiNcIiArIGhleENvZGUobWF0Y2hbMV0pICsgaGV4Q29kZShtYXRjaFsyXSkgKyBoZXhDb2RlKG1hdGNoWzNdKTtcbn1cbmV4cG9ydHMuY29udmVydFJHQnRvSEVYID0gY29udmVydFJHQnRvSEVYO1xuU3RyaW5nLnByb3RvdHlwZS5sYXN0SW5kZXhPZlJlZ2V4ID0gZnVuY3Rpb24gKHJlZ2V4KSB7XG4gICAgY29uc3QgbWF0Y2ggPSB0aGlzLm1hdGNoKHJlZ2V4KTtcbiAgICByZXR1cm4gbWF0Y2ggPyB0aGlzLmxhc3RJbmRleE9mKG1hdGNoW21hdGNoLmxlbmd0aCAtIDFdKSA6IC0xO1xufTtcbmV4cG9ydHMudHJhaWxpbmdDb21wb3NlQ2hhcnMgPSAvW1xcdTAyQjAtXFx1MDJGRmDCtF7CqH5dKyR84o6ELiokLztcbi8vaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzY1MzIzMDcvcmVtLXB4LWluLWphdmFzY3JpcHRcbmZ1bmN0aW9uIGNvbnZlcnRSZW1Ub1BpeGVscyhyZW0pIHtcbiAgICByZXR1cm4gcmVtICogcGFyc2VGbG9hdChnZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuZm9udFNpemUpO1xufVxuZXhwb3J0cy5jb252ZXJ0UmVtVG9QaXhlbHMgPSBjb252ZXJ0UmVtVG9QaXhlbHM7XG5mdW5jdGlvbiBzd2FwRWxlbWVudHMoZWwxLCBlbDIsIHRvdGFsRHVyYXRpb24sIGNhbGxiYWNrID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybjtcbn0sIG1pZGRsZUNhbGxiYWNrID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybjtcbn0pIHtcbiAgICBpZiAoKGVsMS5oYXNDbGFzcyhcImhpZGRlblwiKSAmJiAhZWwyLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB8fFxuICAgICAgICAoIWVsMS5oYXNDbGFzcyhcImhpZGRlblwiKSAmJiBlbDIuaGFzQ2xhc3MoXCJoaWRkZW5cIikpKSB7XG4gICAgICAgIC8vb25lIG9mIHRoZW0gaXMgaGlkZGVuIGFuZCB0aGUgb3RoZXIgaXMgdmlzaWJsZVxuICAgICAgICBpZiAoZWwxLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgICQoZWwxKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgdG90YWxEdXJhdGlvbiAvIDIsICgpID0+IHtcbiAgICAgICAgICAgIG1pZGRsZUNhbGxiYWNrKCk7XG4gICAgICAgICAgICAkKGVsMSkuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKGVsMilcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgfSwgdG90YWxEdXJhdGlvbiAvIDIsICgpID0+IHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIGlmIChlbDEuaGFzQ2xhc3MoXCJoaWRkZW5cIikgJiYgZWwyLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIC8vYm90aCBhcmUgaGlkZGVuLCBvbmx5IGZhZGUgaW4gdGhlIHNlY29uZFxuICAgICAgICAkKGVsMilcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgIH0sIHRvdGFsRHVyYXRpb24sICgpID0+IHtcbiAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICB9XG4gICAgcmV0dXJuO1xufVxuZXhwb3J0cy5zd2FwRWxlbWVudHMgPSBzd2FwRWxlbWVudHM7XG5mdW5jdGlvbiBnZXRNb2RlMihjb25maWcsIHJhbmRvbVF1b3RlKSB7XG4gICAgY29uc3QgbW9kZSA9IGNvbmZpZy5tb2RlO1xuICAgIGlmIChtb2RlID09PSBcInRpbWVcIikge1xuICAgICAgICByZXR1cm4gY29uZmlnLnRpbWUudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAobW9kZSA9PT0gXCJ3b3Jkc1wiKSB7XG4gICAgICAgIHJldHVybiBjb25maWcud29yZHMudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAobW9kZSA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICByZXR1cm4gXCJjdXN0b21cIjtcbiAgICB9XG4gICAgZWxzZSBpZiAobW9kZSA9PT0gXCJ6ZW5cIikge1xuICAgICAgICByZXR1cm4gXCJ6ZW5cIjtcbiAgICB9XG4gICAgZWxzZSBpZiAobW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgIHJldHVybiByYW5kb21RdW90ZS5pZC50b1N0cmluZygpO1xuICAgIH1cbiAgICByZXR1cm4gXCJcIjtcbn1cbmV4cG9ydHMuZ2V0TW9kZTIgPSBnZXRNb2RlMjtcbmZ1bmN0aW9uIGRvd25sb2FkUmVzdWx0c0NTVihhcnJheSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIGNvbnN0IGNzdlN0cmluZyA9IFtcbiAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICBcIl9pZFwiLFxuICAgICAgICAgICAgICAgIFwiaXNQYlwiLFxuICAgICAgICAgICAgICAgIFwid3BtXCIsXG4gICAgICAgICAgICAgICAgXCJhY2NcIixcbiAgICAgICAgICAgICAgICBcInJhd1dwbVwiLFxuICAgICAgICAgICAgICAgIFwiY29uc2lzdGVuY3lcIixcbiAgICAgICAgICAgICAgICBcImNoYXJTdGF0c1wiLFxuICAgICAgICAgICAgICAgIFwibW9kZVwiLFxuICAgICAgICAgICAgICAgIFwibW9kZTJcIixcbiAgICAgICAgICAgICAgICBcInF1b3RlTGVuZ3RoXCIsXG4gICAgICAgICAgICAgICAgXCJyZXN0YXJ0Q291bnRcIixcbiAgICAgICAgICAgICAgICBcInRlc3REdXJhdGlvblwiLFxuICAgICAgICAgICAgICAgIFwiYWZrRHVyYXRpb25cIixcbiAgICAgICAgICAgICAgICBcImluY29tcGxldGVUZXN0U2Vjb25kc1wiLFxuICAgICAgICAgICAgICAgIFwicHVuY3R1YXRpb25cIixcbiAgICAgICAgICAgICAgICBcIm51bWJlcnNcIixcbiAgICAgICAgICAgICAgICBcImxhbmd1YWdlXCIsXG4gICAgICAgICAgICAgICAgXCJmdW5ib3hcIixcbiAgICAgICAgICAgICAgICBcImRpZmZpY3VsdHlcIixcbiAgICAgICAgICAgICAgICBcImxhenlNb2RlXCIsXG4gICAgICAgICAgICAgICAgXCJibGluZE1vZGVcIixcbiAgICAgICAgICAgICAgICBcImJhaWxlZE91dFwiLFxuICAgICAgICAgICAgICAgIFwidGFnc1wiLFxuICAgICAgICAgICAgICAgIFwidGltZXN0YW1wXCIsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgLi4uYXJyYXkubWFwKChpdGVtKSA9PiBbXG4gICAgICAgICAgICAgICAgaXRlbS5faWQsXG4gICAgICAgICAgICAgICAgaXRlbS5pc1BiLFxuICAgICAgICAgICAgICAgIGl0ZW0ud3BtLFxuICAgICAgICAgICAgICAgIGl0ZW0uYWNjLFxuICAgICAgICAgICAgICAgIGl0ZW0ucmF3V3BtLFxuICAgICAgICAgICAgICAgIGl0ZW0uY29uc2lzdGVuY3ksXG4gICAgICAgICAgICAgICAgaXRlbS5jaGFyU3RhdHMuam9pbihcIixcIiksXG4gICAgICAgICAgICAgICAgaXRlbS5tb2RlLFxuICAgICAgICAgICAgICAgIGl0ZW0ubW9kZTIsXG4gICAgICAgICAgICAgICAgaXRlbS5xdW90ZUxlbmd0aCxcbiAgICAgICAgICAgICAgICBpdGVtLnJlc3RhcnRDb3VudCxcbiAgICAgICAgICAgICAgICBpdGVtLnRlc3REdXJhdGlvbixcbiAgICAgICAgICAgICAgICBpdGVtLmFma0R1cmF0aW9uLFxuICAgICAgICAgICAgICAgIGl0ZW0uaW5jb21wbGV0ZVRlc3RTZWNvbmRzLFxuICAgICAgICAgICAgICAgIGl0ZW0ucHVuY3R1YXRpb24sXG4gICAgICAgICAgICAgICAgaXRlbS5udW1iZXJzLFxuICAgICAgICAgICAgICAgIGl0ZW0ubGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgaXRlbS5mdW5ib3gsXG4gICAgICAgICAgICAgICAgaXRlbS5kaWZmaWN1bHR5LFxuICAgICAgICAgICAgICAgIGl0ZW0ubGF6eU1vZGUsXG4gICAgICAgICAgICAgICAgaXRlbS5ibGluZE1vZGUsXG4gICAgICAgICAgICAgICAgaXRlbS5iYWlsZWRPdXQsXG4gICAgICAgICAgICAgICAgaXRlbS50YWdzLmpvaW4oXCIsXCIpLFxuICAgICAgICAgICAgICAgIGl0ZW0udGltZXN0YW1wLFxuICAgICAgICAgICAgXSksXG4gICAgICAgIF1cbiAgICAgICAgICAgIC5tYXAoKGUpID0+IGUuam9pbihcInxcIikpXG4gICAgICAgICAgICAuam9pbihcIlxcblwiKTtcbiAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtjc3ZTdHJpbmddLCB7IHR5cGU6IFwidGV4dC9jc3ZcIiB9KTtcbiAgICAgICAgY29uc3QgaHJlZiA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XG4gICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKFwiaHJlZlwiLCBocmVmKTtcbiAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoXCJkb3dubG9hZFwiLCBcInJlc3VsdHMuY3N2XCIpO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOyAvLyBSZXF1aXJlZCBmb3IgRkZcbiAgICAgICAgbGluay5jbGljaygpO1xuICAgICAgICBsaW5rLnJlbW92ZSgpO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5kb3dubG9hZFJlc3VsdHNDU1YgPSBkb3dubG9hZFJlc3VsdHNDU1Y7XG4vKipcbiAqIEdldHMgYW4gaW50ZWdlciBiZXR3ZWVuIG1pbiBhbmQgbWF4LCBib3RoIGFyZSBpbmNsdXNpdmUuXG4gKiBAcGFyYW0gbWluXG4gKiBAcGFyYW0gbWF4XG4gKiBAcmV0dXJucyBSYW5kb20gaW50ZWdlciBiZXR3ZW4gbWluIGFuZCBtYXguXG4gKi9cbmZ1bmN0aW9uIHJhbmRvbUludEZyb21SYW5nZShtaW4sIG1heCkge1xuICAgIGNvbnN0IG1pbk5vcm0gPSBNYXRoLmNlaWwobWluKTtcbiAgICBjb25zdCBtYXhOb3JtID0gTWF0aC5mbG9vcihtYXgpO1xuICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4Tm9ybSAtIG1pbk5vcm0gKyAxKSArIG1pbk5vcm0pO1xufVxuZXhwb3J0cy5yYW5kb21JbnRGcm9tUmFuZ2UgPSByYW5kb21JbnRGcm9tUmFuZ2U7XG4vKipcbiAqIFNodWZmbGUgYW4gYXJyYXkgb2YgZWxlbWVudHMgdXNpbmcgdGhlIEZpc2hlcuKAk1lhdGVzIGFsZ29yaXRobS5cbiAqIFRoaXMgZnVuY3Rpb24gbXV0YXRlcyB0aGUgaW5wdXQgYXJyYXkuXG4gKiBAcGFyYW0gZWxlbWVudHNcbiAqL1xuZnVuY3Rpb24gc2h1ZmZsZShlbGVtZW50cykge1xuICAgIGZvciAobGV0IGkgPSBlbGVtZW50cy5sZW5ndGggLSAxOyBpID4gMDsgLS1pKSB7XG4gICAgICAgIGNvbnN0IGogPSByYW5kb21JbnRGcm9tUmFuZ2UoMCwgaSk7XG4gICAgICAgIGNvbnN0IHRlbXAgPSBlbGVtZW50c1tqXTtcbiAgICAgICAgZWxlbWVudHNbal0gPSBlbGVtZW50c1tpXTtcbiAgICAgICAgZWxlbWVudHNbaV0gPSB0ZW1wO1xuICAgIH1cbn1cbmV4cG9ydHMuc2h1ZmZsZSA9IHNodWZmbGU7XG5mdW5jdGlvbiByYW5kb21FbGVtZW50RnJvbUFycmF5KGFycmF5KSB7XG4gICAgcmV0dXJuIGFycmF5W3JhbmRvbUludEZyb21SYW5nZSgwLCBhcnJheS5sZW5ndGggLSAxKV07XG59XG5leHBvcnRzLnJhbmRvbUVsZW1lbnRGcm9tQXJyYXkgPSByYW5kb21FbGVtZW50RnJvbUFycmF5O1xuZnVuY3Rpb24gcmFuZG9tRWxlbWVudEZyb21PYmplY3Qob2JqZWN0KSB7XG4gICAgcmV0dXJuIHJhbmRvbUVsZW1lbnRGcm9tQXJyYXkoT2JqZWN0LnZhbHVlcyhvYmplY3QpKTtcbn1cbmV4cG9ydHMucmFuZG9tRWxlbWVudEZyb21PYmplY3QgPSByYW5kb21FbGVtZW50RnJvbU9iamVjdDtcbmZ1bmN0aW9uIGNyZWF0ZUVycm9yTWVzc2FnZShlcnJvciwgbWVzc2FnZSkge1xuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKVxuICAgICAgICByZXR1cm4gYCR7bWVzc2FnZX06ICR7ZXJyb3IubWVzc2FnZX1gO1xuICAgIHJldHVybiBgJHttZXNzYWdlfWA7XG59XG5leHBvcnRzLmNyZWF0ZUVycm9yTWVzc2FnZSA9IGNyZWF0ZUVycm9yTWVzc2FnZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5idWlsZFNlYXJjaFNlcnZpY2UgPSB2b2lkIDA7XG5jb25zdCBzdGVtbWVyXzEgPSByZXF1aXJlKFwic3RlbW1lclwiKTtcbmNvbnN0IGRhbWVyYXVfbGV2ZW5zaHRlaW5fMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiZGFtZXJhdS1sZXZlbnNodGVpblwiKSk7XG5jb25zdCBERUZBVUxUX09QVElPTlMgPSB7XG4gICAgZnV6enlNYXRjaFNlbnNpdGl2aXR5OiAwLjIsXG4gICAgc2NvcmVGb3JTaW1pbGFyTWF0Y2g6IDAuNSxcbiAgICBzY29yZUZvckV4YWN0TWF0Y2g6IDEsIC8vIFdoZW4gcmFua2luZyByZXN1bHRzLCB0aGUgc2NvcmUgYSBtYXRjaCBnZXRzIGZvciBoYXZpbmcgYW4gZXhhY3QgbWF0Y2ggd2l0aCBhIHRva2VuIGluIHRoZSBzZWFyY2ggcXVlcnkuXG59O1xuZnVuY3Rpb24gaW52ZXJzZURvY3VtZW50RnJlcXVlbmN5KG51bWJlck9mRG9jdW1lbnRzLCBudW1iZXJPZkRvY3VtZW50c1dpdGhUZXJtKSB7XG4gICAgaWYgKG51bWJlck9mRG9jdW1lbnRzV2l0aFRlcm0gPT09IDApIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIHJldHVybiBNYXRoLmxvZzEwKG51bWJlck9mRG9jdW1lbnRzIC8gbnVtYmVyT2ZEb2N1bWVudHNXaXRoVGVybSk7XG59XG5mdW5jdGlvbiB0b2tlbml6ZSh0ZXh0KSB7XG4gICAgcmV0dXJuIHRleHQubWF0Y2goL1teXFxcXFxcXVsuLFwiLyMhPyQlXiYqOzp7fT1cXC1fYH4oKVxcc10rL2cpIHx8IFtdO1xufVxuY29uc3QgYnVpbGRTZWFyY2hTZXJ2aWNlID0gKGRvY3VtZW50cywgZ2V0U2VhcmNoYWJsZVRleHQsIG9wdGlvbnMgPSBERUZBVUxUX09QVElPTlMpID0+IHtcbiAgICBjb25zdCByZXZlcnNlSW5kZXggPSB7fTtcbiAgICBjb25zdCBub3JtYWxpemVkVG9rZW5Ub09yaWdpbmFsID0ge307XG4gICAgZG9jdW1lbnRzLmZvckVhY2goKGRvY3VtZW50LCBkb2N1bWVudEluZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IHJhd1Rva2VucyA9IHRva2VuaXplKGdldFNlYXJjaGFibGVUZXh0KGRvY3VtZW50KSk7XG4gICAgICAgIGNvbnN0IGludGVybmFsRG9jdW1lbnQgPSB7XG4gICAgICAgICAgICBpZDogZG9jdW1lbnRJbmRleCxcbiAgICAgICAgfTtcbiAgICAgICAgcmF3VG9rZW5zLmZvckVhY2goKHRva2VuKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzdGVtbWVkVG9rZW4gPSAoMCwgc3RlbW1lcl8xLnN0ZW1tZXIpKHRva2VuKTtcbiAgICAgICAgICAgIGlmICghKHN0ZW1tZWRUb2tlbiBpbiBub3JtYWxpemVkVG9rZW5Ub09yaWdpbmFsKSkge1xuICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWRUb2tlblRvT3JpZ2luYWxbc3RlbW1lZFRva2VuXSA9IG5ldyBTZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5vcm1hbGl6ZWRUb2tlblRvT3JpZ2luYWxbc3RlbW1lZFRva2VuXS5hZGQodG9rZW4pO1xuICAgICAgICAgICAgaWYgKCEoc3RlbW1lZFRva2VuIGluIHJldmVyc2VJbmRleCkpIHtcbiAgICAgICAgICAgICAgICByZXZlcnNlSW5kZXhbc3RlbW1lZFRva2VuXSA9IG5ldyBTZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldmVyc2VJbmRleFtzdGVtbWVkVG9rZW5dLmFkZChpbnRlcm5hbERvY3VtZW50KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgY29uc3QgdG9rZW5TZXQgPSBPYmplY3Qua2V5cyhyZXZlcnNlSW5kZXgpO1xuICAgIGNvbnN0IHF1ZXJ5ID0gKHNlYXJjaFF1ZXJ5KSA9PiB7XG4gICAgICAgIGNvbnN0IHNlYXJjaFJlc3VsdCA9IHtcbiAgICAgICAgICAgIHJlc3VsdHM6IFtdLFxuICAgICAgICAgICAgbWF0Y2hlZFF1ZXJ5VGVybXM6IFtdLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBub3JtYWxpemVkU2VhcmNoUXVlcnkgPSBuZXcgU2V0KHRva2VuaXplKHNlYXJjaFF1ZXJ5KS5tYXAoKHRva2VuKSA9PiAoMCwgc3RlbW1lcl8xLnN0ZW1tZXIpKHRva2VuKSkpO1xuICAgICAgICBpZiAobm9ybWFsaXplZFNlYXJjaFF1ZXJ5LnNpemUgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBzZWFyY2hSZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IG5ldyBNYXAoKTtcbiAgICAgICAgY29uc3QgbWF0Y2hlZFRva2VucyA9IG5ldyBTZXQoKTtcbiAgICAgICAgbm9ybWFsaXplZFNlYXJjaFF1ZXJ5LmZvckVhY2goKHNlYXJjaFRva2VuKSA9PiB7XG4gICAgICAgICAgICB0b2tlblNldC5mb3JFYWNoKCh0b2tlbikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgc2ltaWxhcml0eSB9ID0gKDAsIGRhbWVyYXVfbGV2ZW5zaHRlaW5fMS5kZWZhdWx0KShzZWFyY2hUb2tlbiwgdG9rZW4pO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoZXNTZWFyY2hUb2tlbiA9IHRva2VuID09PSBzZWFyY2hUb2tlbjtcbiAgICAgICAgICAgICAgICBjb25zdCBpc1NpbWlsYXIgPSBzaW1pbGFyaXR5ID49IDEgLSBvcHRpb25zLmZ1enp5TWF0Y2hTZW5zaXRpdml0eTtcbiAgICAgICAgICAgICAgICBpZiAobWF0Y2hlc1NlYXJjaFRva2VuIHx8IGlzU2ltaWxhcikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkb2N1bWVudE1hdGNoZXMgPSByZXZlcnNlSW5kZXhbdG9rZW5dO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpZGYgPSBpbnZlcnNlRG9jdW1lbnRGcmVxdWVuY3koZG9jdW1lbnRzLmxlbmd0aCwgZG9jdW1lbnRNYXRjaGVzLnNpemUpO1xuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudE1hdGNoZXMuZm9yRWFjaCgoZG9jdW1lbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTY29yZSA9IChfYSA9IHJlc3VsdHMuZ2V0KGRvY3VtZW50LmlkKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNjb3JlRm9yRXhhY3RNYXRjaCA9IG1hdGNoZXNTZWFyY2hUb2tlblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gb3B0aW9ucy5zY29yZUZvckV4YWN0TWF0Y2hcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzY29yZUZvclNpbWlsYXJpdHkgPSBpc1NpbWlsYXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IG9wdGlvbnMuc2NvcmVGb3JTaW1pbGFyTWF0Y2hcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzY29yZSA9IHNjb3JlRm9yRXhhY3RNYXRjaCArIHNjb3JlRm9yU2ltaWxhcml0eTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNjb3JlRm9yVG9rZW4gPSBzY29yZSAqIGlkZjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuc2V0KGRvY3VtZW50LmlkLCBjdXJyZW50U2NvcmUgKyBzY29yZUZvclRva2VuKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWRUb2tlblRvT3JpZ2luYWxbdG9rZW5dLmZvckVhY2goKG9yaWdpbmFsVG9rZW4pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZWRUb2tlbnMuYWRkKG9yaWdpbmFsVG9rZW4pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IG9yZGVyZWRSZXN1bHRzID0gWy4uLnJlc3VsdHNdXG4gICAgICAgICAgICAuc29ydCgobWF0Y2gxLCBtYXRjaDIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBtYXRjaDJbMV0gLSBtYXRjaDFbMV07XG4gICAgICAgIH0pXG4gICAgICAgICAgICAubWFwKChtYXRjaCkgPT4gZG9jdW1lbnRzW21hdGNoWzBdXSk7XG4gICAgICAgIHNlYXJjaFJlc3VsdC5yZXN1bHRzID0gb3JkZXJlZFJlc3VsdHM7XG4gICAgICAgIHNlYXJjaFJlc3VsdC5tYXRjaGVkUXVlcnlUZXJtcyA9IFsuLi5tYXRjaGVkVG9rZW5zXTtcbiAgICAgICAgcmV0dXJuIHNlYXJjaFJlc3VsdDtcbiAgICB9O1xuICAgIHJldHVybiB7XG4gICAgICAgIHF1ZXJ5LFxuICAgIH07XG59O1xuZXhwb3J0cy5idWlsZFNlYXJjaFNlcnZpY2UgPSBidWlsZFNlYXJjaFNlcnZpY2U7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc3BsaXRCeUFuZEtlZXAgPSB2b2lkIDA7XG4vKipcbiAqXG4gKiBAcGFyYW0gdGV4dCBTdHJpbmcgdG8gc3BsaXRcbiAqIEBwYXJhbSBkZWxpbWl0ZXJzIFNpbmdsZSBjaGFyYWN0ZXIgZGVsaW1pdGVycy5cbiAqL1xuZnVuY3Rpb24gc3BsaXRCeUFuZEtlZXAodGV4dCwgZGVsaW1pdGVycykge1xuICAgIGNvbnN0IHNwbGl0U3RyaW5nID0gW107XG4gICAgbGV0IGN1cnJlbnRUb2tlbiA9IFtdO1xuICAgIGNvbnN0IGRlbGltaXRlclNldCA9IG5ldyBTZXQoZGVsaW1pdGVycyk7XG4gICAgZm9yIChjb25zdCBjaGFyIG9mIHRleHQpIHtcbiAgICAgICAgaWYgKGRlbGltaXRlclNldC5oYXMoY2hhcikpIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50VG9rZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHNwbGl0U3RyaW5nLnB1c2goY3VycmVudFRva2VuLmpvaW4oXCJcIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3BsaXRTdHJpbmcucHVzaChjaGFyKTtcbiAgICAgICAgICAgIGN1cnJlbnRUb2tlbiA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY3VycmVudFRva2VuLnB1c2goY2hhcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGN1cnJlbnRUb2tlbi5sZW5ndGggPiAwKSB7XG4gICAgICAgIHNwbGl0U3RyaW5nLnB1c2goY3VycmVudFRva2VuLmpvaW4oXCJcIikpO1xuICAgIH1cbiAgICByZXR1cm4gc3BsaXRTdHJpbmc7XG59XG5leHBvcnRzLnNwbGl0QnlBbmRLZWVwID0gc3BsaXRCeUFuZEtlZXA7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5sb2FkQ3VzdG9tVGhlbWVGcm9tVXJsID0gdm9pZCAwO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9taXNjXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpLCBVcGRhdGVDb25maWcgPSBjb25maWdfMTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuZnVuY3Rpb24gbG9hZEN1c3RvbVRoZW1lRnJvbVVybCgpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgZ2V0VmFsdWUgPSBNaXNjLmZpbmRHZXRQYXJhbWV0ZXIoXCJjdXN0b21UaGVtZVwiKTtcbiAgICBpZiAoZ2V0VmFsdWUgPT09IG51bGwpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCB1cmxFbmNvZGVkID0gZ2V0VmFsdWUuc3BsaXQoXCIsXCIpO1xuICAgIGxldCBiYXNlNjRkZWNvZGVkID0gbnVsbDtcbiAgICB0cnkge1xuICAgICAgICBiYXNlNjRkZWNvZGVkID0gSlNPTi5wYXJzZSgoX2EgPSBhdG9iKGdldFZhbHVlKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCJcIik7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIC8vXG4gICAgfVxuICAgIGxldCBjb2xvckFycmF5ID0gW107XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodXJsRW5jb2RlZCkgJiYgdXJsRW5jb2RlZC5sZW5ndGggPT09IDkpIHtcbiAgICAgICAgY29sb3JBcnJheSA9IHVybEVuY29kZWQ7XG4gICAgfVxuICAgIGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoYmFzZTY0ZGVjb2RlZCkgJiYgYmFzZTY0ZGVjb2RlZC5sZW5ndGggPT09IDkpIHtcbiAgICAgICAgY29sb3JBcnJheSA9IGJhc2U2NGRlY29kZWQ7XG4gICAgfVxuICAgIGlmIChjb2xvckFycmF5Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJJbnZhbGlkIGN1c3RvbSB0aGVtZSBcIiwgMCk7XG4gICAgfVxuICAgIGNvbnN0IG9sZEN1c3RvbVRoZW1lID0gY29uZmlnXzEuZGVmYXVsdC5jdXN0b21UaGVtZTtcbiAgICBjb25zdCBvbGRDdXN0b21UaGVtZUNvbG9ycyA9IGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tVGhlbWVDb2xvcnM7XG4gICAgdHJ5IHtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lQ29sb3JzKGNvbG9yQXJyYXkpO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkN1c3RvbSB0aGVtZSBhcHBsaWVkXCIsIDEpO1xuICAgICAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tVGhlbWUpXG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWUodHJ1ZSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiU29tZXRoaW5nIHdlbnQgd3JvbmcuIFJldmVydGluZyB0byBwcmV2aW91cyBzdGF0ZS5cIiwgMCk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZShvbGRDdXN0b21UaGVtZSk7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZUNvbG9ycyhvbGRDdXN0b21UaGVtZUNvbG9ycyk7XG4gICAgfVxufVxuZXhwb3J0cy5sb2FkQ3VzdG9tVGhlbWVGcm9tVXJsID0gbG9hZEN1c3RvbVRoZW1lRnJvbVVybDtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5DTElFTlRfVkVSU0lPTiA9IHZvaWQgMDtcbmV4cG9ydHMuQ0xJRU5UX1ZFUlNJT04gPSBcIkRFVkVMT1BNRU5ULUNMSUVOVFwiO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiLnZlcnNpb25cIiwgKGUpID0+IHtcbiAgICBpZiAoZS5zaGlmdEtleSkge1xuICAgICAgICBhbGVydChleHBvcnRzLkNMSUVOVF9WRVJTSU9OKTtcbiAgICB9XG59KTtcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4vLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gX193ZWJwYWNrX21vZHVsZXNfXztcblxuIiwidmFyIGRlZmVycmVkID0gW107XG5fX3dlYnBhY2tfcmVxdWlyZV9fLk8gPSAocmVzdWx0LCBjaHVua0lkcywgZm4sIHByaW9yaXR5KSA9PiB7XG5cdGlmKGNodW5rSWRzKSB7XG5cdFx0cHJpb3JpdHkgPSBwcmlvcml0eSB8fCAwO1xuXHRcdGZvcih2YXIgaSA9IGRlZmVycmVkLmxlbmd0aDsgaSA+IDAgJiYgZGVmZXJyZWRbaSAtIDFdWzJdID4gcHJpb3JpdHk7IGktLSkgZGVmZXJyZWRbaV0gPSBkZWZlcnJlZFtpIC0gMV07XG5cdFx0ZGVmZXJyZWRbaV0gPSBbY2h1bmtJZHMsIGZuLCBwcmlvcml0eV07XG5cdFx0cmV0dXJuO1xuXHR9XG5cdHZhciBub3RGdWxmaWxsZWQgPSBJbmZpbml0eTtcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCBkZWZlcnJlZC5sZW5ndGg7IGkrKykge1xuXHRcdHZhciBbY2h1bmtJZHMsIGZuLCBwcmlvcml0eV0gPSBkZWZlcnJlZFtpXTtcblx0XHR2YXIgZnVsZmlsbGVkID0gdHJ1ZTtcblx0XHRmb3IgKHZhciBqID0gMDsgaiA8IGNodW5rSWRzLmxlbmd0aDsgaisrKSB7XG5cdFx0XHRpZiAoKHByaW9yaXR5ICYgMSA9PT0gMCB8fCBub3RGdWxmaWxsZWQgPj0gcHJpb3JpdHkpICYmIE9iamVjdC5rZXlzKF9fd2VicGFja19yZXF1aXJlX18uTykuZXZlcnkoKGtleSkgPT4gKF9fd2VicGFja19yZXF1aXJlX18uT1trZXldKGNodW5rSWRzW2pdKSkpKSB7XG5cdFx0XHRcdGNodW5rSWRzLnNwbGljZShqLS0sIDEpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZnVsZmlsbGVkID0gZmFsc2U7XG5cdFx0XHRcdGlmKHByaW9yaXR5IDwgbm90RnVsZmlsbGVkKSBub3RGdWxmaWxsZWQgPSBwcmlvcml0eTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYoZnVsZmlsbGVkKSB7XG5cdFx0XHRkZWZlcnJlZC5zcGxpY2UoaS0tLCAxKVxuXHRcdFx0dmFyIHIgPSBmbigpO1xuXHRcdFx0aWYgKHIgIT09IHVuZGVmaW5lZCkgcmVzdWx0ID0gcjtcblx0XHR9XG5cdH1cblx0cmV0dXJuIHJlc3VsdDtcbn07IiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5nID0gKGZ1bmN0aW9uKCkge1xuXHRpZiAodHlwZW9mIGdsb2JhbFRoaXMgPT09ICdvYmplY3QnKSByZXR1cm4gZ2xvYmFsVGhpcztcblx0dHJ5IHtcblx0XHRyZXR1cm4gdGhpcyB8fCBuZXcgRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcblx0fSBjYXRjaCAoZSkge1xuXHRcdGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JykgcmV0dXJuIHdpbmRvdztcblx0fVxufSkoKTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiLy8gbm8gYmFzZVVSSVxuXG4vLyBvYmplY3QgdG8gc3RvcmUgbG9hZGVkIGFuZCBsb2FkaW5nIGNodW5rc1xuLy8gdW5kZWZpbmVkID0gY2h1bmsgbm90IGxvYWRlZCwgbnVsbCA9IGNodW5rIHByZWxvYWRlZC9wcmVmZXRjaGVkXG4vLyBbcmVzb2x2ZSwgcmVqZWN0LCBQcm9taXNlXSA9IGNodW5rIGxvYWRpbmcsIDAgPSBjaHVuayBsb2FkZWRcbnZhciBpbnN0YWxsZWRDaHVua3MgPSB7XG5cdFwibW9ua2V5dHlwZVwiOiAwXG59O1xuXG4vLyBubyBjaHVuayBvbiBkZW1hbmQgbG9hZGluZ1xuXG4vLyBubyBwcmVmZXRjaGluZ1xuXG4vLyBubyBwcmVsb2FkZWRcblxuLy8gbm8gSE1SXG5cbi8vIG5vIEhNUiBtYW5pZmVzdFxuXG5fX3dlYnBhY2tfcmVxdWlyZV9fLk8uaiA9IChjaHVua0lkKSA9PiAoaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID09PSAwKTtcblxuLy8gaW5zdGFsbCBhIEpTT05QIGNhbGxiYWNrIGZvciBjaHVuayBsb2FkaW5nXG52YXIgd2VicGFja0pzb25wQ2FsbGJhY2sgPSAocGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24sIGRhdGEpID0+IHtcblx0dmFyIFtjaHVua0lkcywgbW9yZU1vZHVsZXMsIHJ1bnRpbWVdID0gZGF0YTtcblx0Ly8gYWRkIFwibW9yZU1vZHVsZXNcIiB0byB0aGUgbW9kdWxlcyBvYmplY3QsXG5cdC8vIHRoZW4gZmxhZyBhbGwgXCJjaHVua0lkc1wiIGFzIGxvYWRlZCBhbmQgZmlyZSBjYWxsYmFja1xuXHR2YXIgbW9kdWxlSWQsIGNodW5rSWQsIGkgPSAwO1xuXHRpZihjaHVua0lkcy5zb21lKChpZCkgPT4gKGluc3RhbGxlZENodW5rc1tpZF0gIT09IDApKSkge1xuXHRcdGZvcihtb2R1bGVJZCBpbiBtb3JlTW9kdWxlcykge1xuXHRcdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKG1vcmVNb2R1bGVzLCBtb2R1bGVJZCkpIHtcblx0XHRcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tW21vZHVsZUlkXSA9IG1vcmVNb2R1bGVzW21vZHVsZUlkXTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYocnVudGltZSkgdmFyIHJlc3VsdCA9IHJ1bnRpbWUoX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cdH1cblx0aWYocGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24pIHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uKGRhdGEpO1xuXHRmb3IoO2kgPCBjaHVua0lkcy5sZW5ndGg7IGkrKykge1xuXHRcdGNodW5rSWQgPSBjaHVua0lkc1tpXTtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oaW5zdGFsbGVkQ2h1bmtzLCBjaHVua0lkKSAmJiBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0pIHtcblx0XHRcdGluc3RhbGxlZENodW5rc1tjaHVua0lkXVswXSgpO1xuXHRcdH1cblx0XHRpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPSAwO1xuXHR9XG5cdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fLk8ocmVzdWx0KTtcbn1cblxudmFyIGNodW5rTG9hZGluZ0dsb2JhbCA9IHNlbGZbXCJ3ZWJwYWNrQ2h1bmttb25rZXl0eXBlX2Zyb250ZW5kXCJdID0gc2VsZltcIndlYnBhY2tDaHVua21vbmtleXR5cGVfZnJvbnRlbmRcIl0gfHwgW107XG5jaHVua0xvYWRpbmdHbG9iYWwuZm9yRWFjaCh3ZWJwYWNrSnNvbnBDYWxsYmFjay5iaW5kKG51bGwsIDApKTtcbmNodW5rTG9hZGluZ0dsb2JhbC5wdXNoID0gd2VicGFja0pzb25wQ2FsbGJhY2suYmluZChudWxsLCBjaHVua0xvYWRpbmdHbG9iYWwucHVzaC5iaW5kKGNodW5rTG9hZGluZ0dsb2JhbCkpOyIsIiIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgZGVwZW5kcyBvbiBvdGhlciBsb2FkZWQgY2h1bmtzIGFuZCBleGVjdXRpb24gbmVlZCB0byBiZSBkZWxheWVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18uTyh1bmRlZmluZWQsIFtcInZlbmRvclwiXSwgKCkgPT4gKF9fd2VicGFja19yZXF1aXJlX18oXCIuL3NyYy9zY3JpcHRzL2luZGV4LnRzXCIpKSlcbl9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fLk8oX193ZWJwYWNrX2V4cG9ydHNfXyk7XG4iLCIiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=
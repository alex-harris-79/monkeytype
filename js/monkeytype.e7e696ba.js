/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/styles/index.scss":
/*!*******************************!*\
  !*** ./src/styles/index.scss ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/scripts/account/all-time-stats.ts":
/*!***********************************************!*\
  !*** ./src/scripts/account/all-time-stats.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = exports.clear = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
function clear() {
    $(".pageAccount .globalTimeTyping .val").text(`-`);
    $(".pageAccount .globalTestsStarted .val").text(`-`);
    $(".pageAccount .globalTestsCompleted .val").text(`-`);
}
exports.clear = clear;
function update() {
    var _a, _b;
    const snapshot = DB.getSnapshot();
    if (snapshot.globalStats !== undefined) {
        // let th = Math.floor(DB.getSnapshot().globalStats.time / 3600);
        // let tm = Math.floor((DB.getSnapshot().globalStats.time % 3600) / 60);
        // let ts = Math.floor((DB.getSnapshot().globalStats.time % 3600) % 60);
        const seconds = (_b = (_a = snapshot === null || snapshot === void 0 ? void 0 : snapshot.globalStats) === null || _a === void 0 ? void 0 : _a.time) !== null && _b !== void 0 ? _b : 0;
        let string = "";
        if (seconds === 0) {
            string = "-";
        }
        else {
            string = Misc.secondsToString(Math.round(seconds), true, true);
        }
        $(".pageAccount .globalTimeTyping .val").text(string);
    }
    if (snapshot.globalStats !== undefined) {
        $(".pageAccount .globalTestsStarted .val").text(snapshot.globalStats.started);
    }
    if (snapshot.globalStats !== undefined) {
        $(".pageAccount .globalTestsCompleted .val").text(snapshot.globalStats.completed);
    }
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/account/mini-result-chart.ts":
/*!**************************************************!*\
  !*** ./src/scripts/account/mini-result-chart.ts ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateData = exports.show = exports.updatePosition = void 0;
const ChartController = __importStar(__webpack_require__(/*! ../controllers/chart-controller */ "./src/scripts/controllers/chart-controller.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const miniResultScaleOptions = ChartController.result.options.scales;
function updatePosition(x, y) {
    $(".pageAccount .miniResultChartWrapper").css({ top: y, left: x });
}
exports.updatePosition = updatePosition;
function show() {
    $(".pageAccount .miniResultChartWrapper").stop(true, true).fadeIn(125);
    $(".pageAccount .miniResultChartBg").stop(true, true).fadeIn(125);
}
exports.show = show;
function hide() {
    $(".pageAccount .miniResultChartWrapper").stop(true, true).fadeOut(125);
    $(".pageAccount .miniResultChartBg").stop(true, true).fadeOut(125);
}
function updateData(data) {
    // let data = filteredResults[filteredId].chartData;
    const labels = [];
    for (let i = 1; i <= data.wpm.length; i++) {
        labels.push(i.toString());
    }
    ChartController.miniResult.data.labels = labels;
    ChartController.miniResult.data.datasets[0].data = data.wpm;
    ChartController.miniResult.data.datasets[1].data = data.raw;
    ChartController.miniResult.data.datasets[2].data = data.err;
    const maxChartVal = Math.max(...[Math.max(...data.wpm), Math.max(...data.raw)]);
    const minChartVal = Math.min(...[Math.min(...data.wpm), Math.min(...data.raw)]);
    miniResultScaleOptions["wpm"].max = Math.round(maxChartVal);
    miniResultScaleOptions["raw"].max = Math.round(maxChartVal);
    if (!config_1.default.startGraphsAtZero) {
        miniResultScaleOptions["wpm"].min = Math.round(minChartVal);
        miniResultScaleOptions["raw"].min = Math.round(minChartVal);
    }
    else {
        miniResultScaleOptions["wpm"].min = 0;
        miniResultScaleOptions["raw"].min = 0;
    }
    ChartController.miniResult.updateColors();
}
exports.updateData = updateData;
$(document).on("click", ".pageAccount .miniResultChartBg", () => {
    hide();
});


/***/ }),

/***/ "./src/scripts/account/pb-tables.ts":
/*!******************************************!*\
  !*** ./src/scripts/account/pb-tables.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
function update() {
    $(".pageAccount .timePbTable tbody").html(`
  <tr>
    <td>15</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>30</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>60</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>120</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  `);
    $(".pageAccount .wordsPbTable tbody").html(`
  <tr>
    <td>10</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>25</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>50</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>100</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  `);
    if (config_1.default.alwaysShowCPM) {
        $(".pageAccount .timePbTable thead tr td:nth-child(2), .pageAccount .wordsPbTable thead tr td:nth-child(2)").html('cpm<br><span class="sub">accuracy</span>');
    }
    else {
        $(".pageAccount .timePbTable thead tr td:nth-child(2), .pageAccount .wordsPbTable thead tr td:nth-child(2)").html('wpm<br><span class="sub">accuracy</span>');
    }
    const pb = DB.getSnapshot().personalBests;
    if (pb === undefined)
        return;
    let pbData;
    let text;
    let dateText = `-<br><span class="sub">-</span>`;
    const multiplier = config_1.default.alwaysShowCPM ? 5 : 1;
    text = "";
    try {
        pbData = pb.time[15].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>15</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>15</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.time[30].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
    <td>30</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>30</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.time[60].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>60</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>60</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.time[120].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>120</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>120</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    $(".pageAccount .timePbTable tbody").html(text);
    text = "";
    try {
        pbData = pb.words[10].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>10</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>10</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.words[25].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>25</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>25</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.words[50].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>50</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>50</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.words[100].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>100</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>100</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    $(".pageAccount .wordsPbTable tbody").html(text);
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/account/result-filters.ts":
/*!***********************************************!*\
  !*** ./src/scripts/account/result-filters.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateTags = exports.toggle = exports.updateActive = exports.reset = exports.loadTags = exports.getFilter = exports.getGroup = exports.getFilters = exports.load = exports.filters = exports.defaultResultFilters = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
exports.defaultResultFilters = {
    difficulty: {
        normal: true,
        expert: true,
        master: true,
    },
    mode: {
        words: true,
        time: true,
        quote: true,
        zen: true,
        custom: true,
    },
    words: {
        10: true,
        25: true,
        50: true,
        100: true,
        custom: true,
    },
    time: {
        15: true,
        30: true,
        60: true,
        120: true,
        custom: true,
    },
    quoteLength: {
        short: true,
        medium: true,
        long: true,
        thicc: true,
    },
    punctuation: {
        on: true,
        off: true,
    },
    numbers: {
        on: true,
        off: true,
    },
    date: {
        last_day: false,
        last_week: false,
        last_month: false,
        last_3months: false,
        all: true,
    },
    tags: {
        none: true,
    },
    language: {},
    funbox: {
        none: true,
    },
};
exports.filters = exports.defaultResultFilters;
function save() {
    window.localStorage.setItem("resultFilters", JSON.stringify(exports.filters));
}
function load() {
    console.log("loading filters");
    try {
        const newResultFilters = window.localStorage.getItem("resultFilters");
        if (newResultFilters != undefined &&
            newResultFilters !== "" &&
            Object.keys(JSON.parse(newResultFilters)).length >=
                Object.keys(exports.defaultResultFilters).length) {
            exports.filters = JSON.parse(newResultFilters);
            // save();
        }
        else {
            exports.filters = exports.defaultResultFilters;
            // save();
        }
        const newTags = { none: false };
        Object.keys(exports.defaultResultFilters.tags).forEach((tag) => {
            if (exports.filters.tags[tag] !== undefined) {
                newTags[tag] = exports.filters.tags[tag];
            }
            else {
                newTags[tag] = true;
            }
        });
        exports.filters.tags = newTags;
        save();
    }
    catch (_a) {
        console.log("error in loading result filters");
        exports.filters = exports.defaultResultFilters;
        save();
    }
}
exports.load = load;
function getFilters() {
    return exports.filters;
}
exports.getFilters = getFilters;
function getGroup(group) {
    return exports.filters[group];
}
exports.getGroup = getGroup;
// export function setFilter(group, filter, value) {
//   filters[group][filter] = value;
// }
function getFilter(group, filter) {
    return exports.filters[group][filter];
}
exports.getFilter = getFilter;
// export function toggleFilter(group, filter) {
//   filters[group][filter] = !filters[group][filter];
// }
function loadTags(tags) {
    console.log("loading tags");
    tags.forEach((tag) => {
        exports.defaultResultFilters.tags[tag._id] = true;
    });
}
exports.loadTags = loadTags;
function reset() {
    exports.filters = exports.defaultResultFilters;
    save();
}
exports.reset = reset;
function updateActive() {
    var _a, _b, _c, _d;
    const aboveChartDisplay = {};
    Object.keys(getFilters()).forEach((group) => {
        aboveChartDisplay[group] = {
            all: true,
            array: [],
        };
        Object.keys(getGroup(group)).forEach((filter) => {
            var _a;
            const groupAboveChartDisplay = aboveChartDisplay[group];
            if (groupAboveChartDisplay === undefined)
                return;
            if (getFilter(group, filter)) {
                (_a = groupAboveChartDisplay["array"]) === null || _a === void 0 ? void 0 : _a.push(filter);
            }
            else {
                if (groupAboveChartDisplay["all"] !== undefined) {
                    groupAboveChartDisplay["all"] = false;
                }
            }
            let buttonEl;
            if (group === "date") {
                buttonEl = $(`.pageAccount .group.topFilters .filterGroup[group="${group}"] .button[filter="${filter}"]`);
            }
            else {
                buttonEl = $(`.pageAccount .group.filterButtons .filterGroup[group="${group}"] .button[filter="${filter}"]`);
            }
            if (getFilter(group, filter)) {
                buttonEl.addClass("active");
            }
            else {
                buttonEl.removeClass("active");
            }
        });
    });
    function addText(group) {
        var _a, _b, _c, _d, _e;
        let ret = "";
        ret += "<div class='group'>";
        if (group == "difficulty") {
            ret += `<span aria-label="Difficulty" data-balloon-pos="up"><i class="fas fa-fw fa-star"></i>`;
        }
        else if (group == "mode") {
            ret += `<span aria-label="Mode" data-balloon-pos="up"><i class="fas fa-fw fa-bars"></i>`;
        }
        else if (group == "punctuation") {
            ret += `<span aria-label="Punctuation" data-balloon-pos="up"><span class="punc" style="font-weight: 900;
      width: 1.25rem;
      text-align: center;
      display: inline-block;
      letter-spacing: -.1rem;">!?</span>`;
        }
        else if (group == "numbers") {
            ret += `<span aria-label="Numbers" data-balloon-pos="up"><span class="numbers" style="font-weight: 900;
        width: 1.25rem;
        text-align: center;
        margin-right: .1rem;
        display: inline-block;
        letter-spacing: -.1rem;">15</span>`;
        }
        else if (group == "words") {
            ret += `<span aria-label="Words" data-balloon-pos="up"><i class="fas fa-fw fa-font"></i>`;
        }
        else if (group == "time") {
            ret += `<span aria-label="Time" data-balloon-pos="up"><i class="fas fa-fw fa-clock"></i>`;
        }
        else if (group == "date") {
            ret += `<span aria-label="Date" data-balloon-pos="up"><i class="fas fa-fw fa-calendar"></i>`;
        }
        else if (group == "tags") {
            ret += `<span aria-label="Tags" data-balloon-pos="up"><i class="fas fa-fw fa-tags"></i>`;
        }
        else if (group == "language") {
            ret += `<span aria-label="Language" data-balloon-pos="up"><i class="fas fa-fw fa-globe-americas"></i>`;
        }
        else if (group == "funbox") {
            ret += `<span aria-label="Funbox" data-balloon-pos="up"><i class="fas fa-fw fa-gamepad"></i>`;
        }
        if ((_a = aboveChartDisplay[group]) === null || _a === void 0 ? void 0 : _a.all) {
            ret += "all";
        }
        else {
            if (group === "tags") {
                ret += (_c = (_b = aboveChartDisplay.tags) === null || _b === void 0 ? void 0 : _b.array) === null || _c === void 0 ? void 0 : _c.map((id) => {
                    var _a, _b;
                    if (id == "none")
                        return id;
                    const snapshot = DB.getSnapshot();
                    const name = (_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.filter((t) => t._id == id)[0];
                    if (name !== undefined) {
                        return (_b = snapshot.tags) === null || _b === void 0 ? void 0 : _b.filter((t) => t._id == id)[0].name;
                    }
                    return name;
                }).join(", ");
            }
            else {
                ret += (_e = (_d = aboveChartDisplay[group]) === null || _d === void 0 ? void 0 : _d.array) === null || _e === void 0 ? void 0 : _e.join(", ").replace(/_/g, " ");
            }
        }
        ret += "</span></div>";
        return ret;
    }
    let chartString = "";
    //date
    chartString += addText("date");
    chartString += `<div class="spacer"></div>`;
    //mode
    chartString += addText("mode");
    chartString += `<div class="spacer"></div>`;
    //time
    if ((_b = (_a = aboveChartDisplay.mode) === null || _a === void 0 ? void 0 : _a.array) === null || _b === void 0 ? void 0 : _b.includes("time")) {
        chartString += addText("time");
        chartString += `<div class="spacer"></div>`;
    }
    //words
    if ((_d = (_c = aboveChartDisplay.mode) === null || _c === void 0 ? void 0 : _c.array) === null || _d === void 0 ? void 0 : _d.includes("words")) {
        chartString += addText("words");
        chartString += `<div class="spacer"></div>`;
    }
    //diff
    chartString += addText("difficulty");
    chartString += `<div class="spacer"></div>`;
    //punc
    chartString += addText("punctuation");
    chartString += `<div class="spacer"></div>`;
    //numbers
    chartString += addText("numbers");
    chartString += `<div class="spacer"></div>`;
    //language
    chartString += addText("language");
    chartString += `<div class="spacer"></div>`;
    //funbox
    chartString += addText("funbox");
    chartString += `<div class="spacer"></div>`;
    //tags
    chartString += addText("tags");
    setTimeout(() => {
        $(".pageAccount .group.chart .above").html(chartString);
    }, 0);
}
exports.updateActive = updateActive;
function toggle(group, filter) {
    try {
        if (group === "date") {
            Object.keys(getGroup("date")).forEach((date) => {
                exports.filters["date"][date] = false;
            });
        }
        exports.filters[group][filter] = !exports.filters[group][filter];
        save();
    }
    catch (e) {
        Notifications.add("Something went wrong toggling filter. Reverting to defaults.", 0);
        console.log("toggling filter error");
        console.error(e);
        reset();
        updateActive();
    }
}
exports.toggle = toggle;
function updateTags() {
    var _a, _b;
    $(".pageAccount .content .filterButtons .buttonsAndTitle.tags .buttons").empty();
    const snapshot = DB.getSnapshot();
    if (((_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.length) || 0 > 0) {
        $(".pageAccount .content .filterButtons .buttonsAndTitle.tags").removeClass("hidden");
        $(".pageAccount .content .filterButtons .buttonsAndTitle.tags .buttons").append(`<div class="button" filter="none">no tag</div>`);
        (_b = snapshot.tags) === null || _b === void 0 ? void 0 : _b.forEach((tag) => {
            $(".pageAccount .content .filterButtons .buttonsAndTitle.tags .buttons").append(`<div class="button" filter="${tag._id}">${tag.name}</div>`);
        });
    }
    else {
        $(".pageAccount .content .filterButtons .buttonsAndTitle.tags").addClass("hidden");
    }
}
exports.updateTags = updateTags;
$(".pageAccount .filterButtons .buttonsAndTitle .buttons, .pageAccount .group.topFilters .buttonsAndTitle.testDate .buttons").on("click", ".button", (e) => {
    const group = $(e.target)
        .parents(".buttons")
        .attr("group");
    const filter = $(e.target).attr("filter");
    if ($(e.target).hasClass("allFilters")) {
        Object.keys(getFilters()).forEach((group) => {
            Object.keys(getGroup(group)).forEach((filter) => {
                if (group === "date") {
                    // TODO figure out why "filter" is never
                    // @ts-ignore
                    exports.filters[group][filter] = false;
                }
                else if (exports.filters[group] !== undefined) {
                    // @ts-ignore
                    exports.filters[group][filter] = true;
                }
            });
        });
        exports.filters.date.all = true;
    }
    else if ($(e.target).hasClass("noFilters")) {
        Object.keys(getFilters()).forEach((group) => {
            if (group !== "date") {
                Object.keys(getGroup(group)).forEach((filter) => {
                    // TODO figure out why "filter" is never
                    // @ts-ignore
                    exports.filters[group][filter] = false;
                });
            }
        });
    }
    else if ($(e.target).hasClass("button")) {
        if (e.shiftKey) {
            Object.keys(getGroup(group)).forEach((filter) => {
                // TODO figure out why "filter" is never
                // @ts-ignore
                exports.filters[group][filter] = false;
            });
            // TODO figure out why "filter" is never
            // @ts-ignore
            exports.filters[group][filter] = true;
        }
        else {
            toggle(group, filter);
            // filters[group][filter] = !filters[group][filter];
        }
    }
    updateActive();
    save();
});
$(".pageAccount .topFilters .button.allFilters").on("click", () => {
    Object.keys(getFilters()).forEach((group) => {
        Object.keys(getGroup(group)).forEach((filter) => {
            if (group === "date") {
                // TODO figure out why "filter" is never
                // @ts-ignore
                exports.filters[group][filter] = false;
            }
            else {
                // TODO figure out why "filter" is never
                // @ts-ignore
                exports.filters[group][filter] = true;
            }
        });
    });
    exports.filters.date.all = true;
    updateActive();
    save();
});
$(".pageAccount .topFilters .button.currentConfigFilter").on("click", () => {
    var _a;
    Object.keys(getFilters()).forEach((group) => {
        Object.keys(getGroup(group)).forEach((filter) => {
            // TODO figure out why "filter" is never
            // @ts-ignore
            exports.filters[group][filter] = false;
        });
    });
    exports.filters["difficulty"][config_1.default.difficulty] = true;
    exports.filters["mode"][config_1.default.mode] = true;
    if (config_1.default.mode === "time") {
        if ([15, 30, 60, 120].includes(config_1.default.time)) {
            const configTime = config_1.default.time;
            exports.filters["time"][configTime] = true;
        }
        else {
            exports.filters.time.custom = true;
        }
    }
    else if (config_1.default.mode === "words") {
        if ([10, 25, 50, 100, 200].includes(config_1.default.words)) {
            const configWords = config_1.default.words;
            exports.filters["words"][configWords] = true;
        }
        else {
            exports.filters.words.custom = true;
        }
    }
    else if (config_1.default.mode === "quote") {
        const filterName = [
            "short",
            "medium",
            "long",
            "thicc",
        ];
        filterName.forEach((ql, index) => {
            if (config_1.default.quoteLength.includes(index)) {
                exports.filters["quoteLength"][ql] = true;
            }
            else {
                exports.filters["quoteLength"][ql] = false;
            }
        });
    }
    if (config_1.default.punctuation) {
        exports.filters.punctuation.on = true;
    }
    else {
        exports.filters.punctuation.off = true;
    }
    if (config_1.default.numbers) {
        exports.filters.numbers.on = true;
    }
    else {
        exports.filters.numbers.off = true;
    }
    if (config_1.default.mode === "quote" && /english.*/.test(config_1.default.language)) {
        exports.filters.language.english = true;
    }
    else {
        exports.filters["language"][config_1.default.language] = true;
    }
    if (config_1.default.funbox === "none") {
        exports.filters.funbox.none = true;
    }
    else {
        exports.filters.funbox[config_1.default.funbox] = true;
    }
    exports.filters.tags.none = true;
    (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
        if (tag.active === true) {
            exports.filters.tags.none = false;
            exports.filters["tags"][tag._id] = true;
        }
    });
    exports.filters.date.all = true;
    updateActive();
    save();
});
$(".pageAccount .topFilters .button.toggleAdvancedFilters").on("click", () => {
    $(".pageAccount .filterButtons").slideToggle(250);
    $(".pageAccount .topFilters .button.toggleAdvancedFilters").toggleClass("active");
});
Misc.getLanguageList().then((languages) => {
    languages.forEach((language) => {
        $(".pageAccount .content .filterButtons .buttonsAndTitle.languages .buttons").append(`<div class="button" filter="${language}">${language.replace("_", " ")}</div>`);
    });
});
$(".pageAccount .content .filterButtons .buttonsAndTitle.funbox .buttons").append(`<div class="button" filter="none">none</div>`);
Misc.getFunboxList().then((funboxModes) => {
    funboxModes.forEach((funbox) => {
        $(".pageAccount .content .filterButtons .buttonsAndTitle.funbox .buttons").append(`<div class="button" filter="${funbox.name}">${funbox.name.replace(/_/g, " ")}</div>`);
    });
});


/***/ }),

/***/ "./src/scripts/account/sign-out-button.ts":
/*!************************************************!*\
  !*** ./src/scripts/account/sign-out-button.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
function show() {
    // $(".signOut").removeClass("hidden").css("opacity", 1);
    $(".signOut")
        .stop(true, true)
        .removeClass("hidden")
        .css({
        opacity: 0,
        transition: "0s",
    })
        .animate({
        opacity: 1,
    }, 125, () => {
        $(".signOut").css({ transition: "0.25s" });
    });
}
exports.show = show;
function hide() {
    $(".signOut")
        .stop(true, true)
        .css({
        opacity: 1,
        transition: "0s",
    })
        .animate({
        opacity: 0,
    }, 125, () => {
        $(".signOut").css({ transition: "0.25s" });
        $(".signOut").addClass("hidden");
    });
    // $(".signOut").css("opacity", 0).addClass("hidden");
}
exports.hide = hide;
// $("#liveWpm").removeClass("hidden").css("opacity", 0).animate(
//   {
//     opacity: Config.timerOpacity,
//   },
//   125
// );


/***/ }),

/***/ "./src/scripts/ape/endpoints/ape-keys.ts":
/*!***********************************************!*\
  !*** ./src/scripts/ape/endpoints/ape-keys.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/ape-keys";
function getApeKeysEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function generate(name, enabled) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = { name, enabled };
            return yield apeClient.post(BASE_PATH, { payload });
        });
    }
    function update(apeKeyId, updates) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = Object.assign({}, updates);
            return yield apeClient.patch(`${BASE_PATH}/${apeKeyId}`, { payload });
        });
    }
    function _delete(apeKeyId) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(`${BASE_PATH}/${apeKeyId}`);
        });
    }
    return {
        get,
        generate,
        update,
        delete: _delete,
    };
}
exports["default"] = getApeKeysEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/configs.ts":
/*!**********************************************!*\
  !*** ./src/scripts/ape/endpoints/configs.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/configs";
function getConfigsEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function save(config) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.patch(BASE_PATH, { payload: { config } });
        });
    }
    return {
        get,
        save,
    };
}
exports["default"] = getConfigsEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/index.ts":
/*!********************************************!*\
  !*** ./src/scripts/ape/endpoints/index.ts ***!
  \********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const configs_1 = __importDefault(__webpack_require__(/*! ./configs */ "./src/scripts/ape/endpoints/configs.ts"));
const leaderboards_1 = __importDefault(__webpack_require__(/*! ./leaderboards */ "./src/scripts/ape/endpoints/leaderboards.ts"));
const presets_1 = __importDefault(__webpack_require__(/*! ./presets */ "./src/scripts/ape/endpoints/presets.ts"));
const psas_1 = __importDefault(__webpack_require__(/*! ./psas */ "./src/scripts/ape/endpoints/psas.ts"));
const quotes_1 = __importDefault(__webpack_require__(/*! ./quotes */ "./src/scripts/ape/endpoints/quotes.ts"));
const results_1 = __importDefault(__webpack_require__(/*! ./results */ "./src/scripts/ape/endpoints/results.ts"));
const users_1 = __importDefault(__webpack_require__(/*! ./users */ "./src/scripts/ape/endpoints/users.ts"));
const ape_keys_1 = __importDefault(__webpack_require__(/*! ./ape-keys */ "./src/scripts/ape/endpoints/ape-keys.ts"));
exports["default"] = {
    getConfigsEndpoints: configs_1.default,
    getLeaderboardsEndpoints: leaderboards_1.default,
    getPresetsEndpoints: presets_1.default,
    getPsasEndpoints: psas_1.default,
    getQuotesEndpoints: quotes_1.default,
    getResultsEndpoints: results_1.default,
    getUsersEndpoints: users_1.default,
    getApeKeysEndpoints: ape_keys_1.default,
};


/***/ }),

/***/ "./src/scripts/ape/endpoints/leaderboards.ts":
/*!***************************************************!*\
  !*** ./src/scripts/ape/endpoints/leaderboards.ts ***!
  \***************************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/leaderboards";
function getLeaderboardsEndpoints(apeClient) {
    function get(language, mode, mode2, skip = 0, limit = 50) {
        return __awaiter(this, void 0, void 0, function* () {
            const searchQuery = {
                language,
                mode,
                mode2,
                skip,
                limit: Math.max(Math.min(limit, 50), 0),
            };
            return yield apeClient.get(BASE_PATH, { searchQuery });
        });
    }
    function getRank(language, mode, mode2) {
        return __awaiter(this, void 0, void 0, function* () {
            const searchQuery = {
                language,
                mode,
                mode2,
            };
            return yield apeClient.get(`${BASE_PATH}/rank`, { searchQuery });
        });
    }
    return { get, getRank };
}
exports["default"] = getLeaderboardsEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/presets.ts":
/*!**********************************************!*\
  !*** ./src/scripts/ape/endpoints/presets.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/presets";
function getPresetsEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function add(presetName, configChanges) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                name: presetName,
                config: configChanges,
            };
            return yield apeClient.post(BASE_PATH, { payload });
        });
    }
    function edit(presetId, presetName, configChanges) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                _id: presetId,
                name: presetName,
                config: configChanges,
            };
            return yield apeClient.patch(BASE_PATH, { payload });
        });
    }
    function _delete(presetId) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(`${BASE_PATH}/${presetId}`);
        });
    }
    return { get, add, edit, delete: _delete };
}
exports["default"] = getPresetsEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/psas.ts":
/*!*******************************************!*\
  !*** ./src/scripts/ape/endpoints/psas.ts ***!
  \*******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const version_1 = __webpack_require__(/*! ../../version */ "./src/scripts/version.ts");
const BASE_PATH = "/psas";
function getPsasEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH, {
                headers: {
                    "Client-Version": version_1.CLIENT_VERSION,
                },
            });
        });
    }
    return { get };
}
exports["default"] = getPsasEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/quotes.ts":
/*!*********************************************!*\
  !*** ./src/scripts/ape/endpoints/quotes.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/quotes";
function getQuotesEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function submit(text, source, language, captcha) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                text,
                source,
                language,
                captcha,
            };
            return yield apeClient.post(BASE_PATH, { payload });
        });
    }
    function approveSubmission(quoteSubmissionId, editText, editSource) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                quoteId: quoteSubmissionId,
                editText,
                editSource,
            };
            return yield apeClient.post(`${BASE_PATH}/approve`, { payload });
        });
    }
    function rejectSubmission(quoteSubmissionId) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.post(`${BASE_PATH}/reject`, {
                payload: { quoteId: quoteSubmissionId },
            });
        });
    }
    function getRating(quote) {
        return __awaiter(this, void 0, void 0, function* () {
            const searchQuery = {
                quoteId: quote.id,
                language: quote.language,
            };
            return yield apeClient.get(`${BASE_PATH}/rating`, { searchQuery });
        });
    }
    function addRating(quote, rating) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                quoteId: quote.id,
                rating,
                language: quote.language,
            };
            return yield apeClient.post(`${BASE_PATH}/rating`, { payload });
        });
    }
    function report(quoteId, quoteLanguage, reason, comment, captcha) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                quoteId,
                quoteLanguage,
                reason,
                comment,
                captcha,
            };
            return yield apeClient.post(`${BASE_PATH}/report`, { payload });
        });
    }
    return {
        get,
        submit,
        approveSubmission,
        rejectSubmission,
        getRating,
        addRating,
        report,
    };
}
exports["default"] = getQuotesEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/results.ts":
/*!**********************************************!*\
  !*** ./src/scripts/ape/endpoints/results.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const version_1 = __webpack_require__(/*! ../../version */ "./src/scripts/version.ts");
const BASE_PATH = "/results";
function getResultsEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function save(result) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.post(BASE_PATH, {
                payload: { result },
                headers: { "Client-Version": version_1.CLIENT_VERSION },
            });
        });
    }
    function updateTags(resultId, tagIds) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.patch(`${BASE_PATH}/tags`, {
                payload: { resultId, tagIds },
            });
        });
    }
    function deleteAll() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(BASE_PATH);
        });
    }
    return { get, save, updateTags, deleteAll };
}
exports["default"] = getResultsEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/users.ts":
/*!********************************************!*\
  !*** ./src/scripts/ape/endpoints/users.ts ***!
  \********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/users";
function getUsersEndpoints(apeClient) {
    function getData() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function create(name, email, uid) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                email,
                name,
                uid,
            };
            return yield apeClient.post(`${BASE_PATH}/signup`, { payload });
        });
    }
    function getNameAvailability(name) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(`${BASE_PATH}/checkName/${name}`);
        });
    }
    function _delete() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(BASE_PATH);
        });
    }
    function updateName(name) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.patch(`${BASE_PATH}/name`, { payload: { name } });
        });
    }
    function updateLeaderboardMemory(mode, mode2, language, rank) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                mode,
                mode2,
                language,
                rank,
            };
            return yield apeClient.patch(`${BASE_PATH}/leaderboardMemory`, { payload });
        });
    }
    function updateEmail(newEmail, previousEmail) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                newEmail,
                previousEmail,
            };
            return yield apeClient.patch(`${BASE_PATH}/email`, { payload });
        });
    }
    function deletePersonalBests() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(`${BASE_PATH}/personalBests`);
        });
    }
    function getTags() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(`${BASE_PATH}/tags`);
        });
    }
    function createTag(tagName) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.post(`${BASE_PATH}/tags`, { payload: { tagName } });
        });
    }
    function editTag(tagId, newName) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                tagId,
                newName,
            };
            return yield apeClient.patch(`${BASE_PATH}/tags`, { payload });
        });
    }
    function deleteTag(tagId) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(`${BASE_PATH}/tags/${tagId}`);
        });
    }
    function deleteTagPersonalBest(tagId) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(`${BASE_PATH}/tags/${tagId}/personalBest`);
        });
    }
    function getCustomThemes() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(`${BASE_PATH}/customThemes`);
        });
    }
    function editCustomTheme(themeId, newTheme) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                themeId: themeId,
                theme: {
                    name: newTheme.name,
                    colors: newTheme.colors,
                },
            };
            return yield apeClient.patch(`${BASE_PATH}/customThemes`, { payload });
        });
    }
    function deleteCustomTheme(themeId) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                themeId: themeId,
            };
            return yield apeClient.delete(`${BASE_PATH}/customThemes`, { payload });
        });
    }
    function addCustomTheme(newTheme) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = { name: newTheme.name, colors: newTheme.colors };
            return yield apeClient.post(`${BASE_PATH}/customThemes`, { payload });
        });
    }
    function linkDiscord(data) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.post(`${BASE_PATH}/discord/link`, {
                payload: { data },
            });
        });
    }
    function unlinkDiscord() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.post(`${BASE_PATH}/discord/unlink`);
        });
    }
    return {
        getData,
        create,
        getNameAvailability,
        delete: _delete,
        updateName,
        updateLeaderboardMemory,
        updateEmail,
        deletePersonalBests,
        getTags,
        createTag,
        editTag,
        deleteTag,
        deleteTagPersonalBest,
        linkDiscord,
        unlinkDiscord,
        getCustomThemes,
        addCustomTheme,
        editCustomTheme,
        deleteCustomTheme,
    };
}
exports["default"] = getUsersEndpoints;


/***/ }),

/***/ "./src/scripts/ape/index.ts":
/*!**********************************!*\
  !*** ./src/scripts/ape/index.ts ***!
  \**********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const axios_1 = __importDefault(__webpack_require__(/*! axios */ "./node_modules/axios/index.js"));
const endpoints_1 = __importDefault(__webpack_require__(/*! ./endpoints */ "./src/scripts/ape/endpoints/index.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const auth_1 = __webpack_require__(/*! firebase/auth */ "./node_modules/firebase/auth/dist/index.esm.js");
const DEV_SERVER_HOST = "http://localhost:5005";
const PROD_SERVER_HOST = "https://api.monkeytype.com";
const API_PATH = "";
const BASE_URL = window.location.hostname === "localhost" ? DEV_SERVER_HOST : PROD_SERVER_HOST;
const API_URL = `${BASE_URL}${API_PATH}`;
// Adapts the ape client's view of request options to the underlying HTTP client.
function adaptRequestOptions(options) {
    return __awaiter(this, void 0, void 0, function* () {
        const currentUser = firebase_1.Auth.currentUser;
        const idToken = currentUser && (yield (0, auth_1.getIdToken)(currentUser));
        return {
            params: options.searchQuery,
            data: options.payload,
            headers: Object.assign(Object.assign(Object.assign({}, options.headers), { Accept: "application/json", "Content-Type": "application/json" }), (idToken && { Authorization: `Bearer ${idToken}` })),
        };
    });
}
// Wrap the underlying HTTP client's method with our own.
function apeifyClientMethod(clientMethod, methodType) {
    return (endpoint, options = {}) => __awaiter(this, void 0, void 0, function* () {
        var _a, _b, _c;
        let errorMessage = "";
        try {
            const requestOptions = yield adaptRequestOptions(options);
            let response;
            if (methodType === "get" || methodType === "delete") {
                response = yield clientMethod(endpoint, requestOptions);
            }
            else {
                response = yield clientMethod(endpoint, requestOptions.data, requestOptions);
            }
            const { message, data } = response.data;
            return {
                status: response.status,
                message,
                data,
            };
        }
        catch (error) {
            console.error(error);
            const typedError = error;
            errorMessage = typedError.message;
            if (axios_1.default.isAxiosError(typedError)) {
                return Object.assign({ status: (_b = (_a = typedError.response) === null || _a === void 0 ? void 0 : _a.status) !== null && _b !== void 0 ? _b : 500, message: typedError.message }, (_c = typedError.response) === null || _c === void 0 ? void 0 : _c.data);
            }
        }
        return {
            status: 500,
            message: errorMessage,
        };
    });
}
const axiosClient = axios_1.default.create({
    baseURL: API_URL,
    timeout: 10000,
});
const apeClient = {
    get: apeifyClientMethod(axiosClient.get, "get"),
    post: apeifyClientMethod(axiosClient.post, "post"),
    put: apeifyClientMethod(axiosClient.put, "put"),
    patch: apeifyClientMethod(axiosClient.patch, "patch"),
    delete: apeifyClientMethod(axiosClient.delete, "delete"),
};
// API Endpoints
const Ape = {
    users: endpoints_1.default.getUsersEndpoints(apeClient),
    configs: endpoints_1.default.getConfigsEndpoints(apeClient),
    results: endpoints_1.default.getResultsEndpoints(apeClient),
    psas: endpoints_1.default.getPsasEndpoints(apeClient),
    quotes: endpoints_1.default.getQuotesEndpoints(apeClient),
    leaderboards: endpoints_1.default.getLeaderboardsEndpoints(apeClient),
    presets: endpoints_1.default.getPresetsEndpoints(apeClient),
    apeKeys: endpoints_1.default.getApeKeysEndpoints(apeClient),
};
exports["default"] = Ape;


/***/ }),

/***/ "./src/scripts/config-validation.ts":
/*!******************************************!*\
  !*** ./src/scripts/config-validation.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.isConfigValueValidAsync = exports.isConfigValueValid = exports.isConfigKeyValid = void 0;
const Misc = __importStar(__webpack_require__(/*! ./utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./elements/notifications */ "./src/scripts/elements/notifications.ts"));
function isConfigKeyValid(name) {
    if (name === null || name === undefined || name === "")
        return false;
    if (name.length > 30)
        return false;
    return /^[0-9a-zA-Z_.\-#+]+$/.test(name);
}
exports.isConfigKeyValid = isConfigKeyValid;
function invalid(key, val, customMessage) {
    if (customMessage === undefined) {
        Notifications.add(`Invalid value for ${key} (${val}). Please try to change this setting again.`, -1);
    }
    else {
        Notifications.add(`Invalid value for ${key} (${val}). ${customMessage}`, -1);
    }
    console.error(`Invalid value key ${key} value ${val} type ${typeof val}`);
}
function isArray(val) {
    return val instanceof Array;
}
function isConfigValueValid(key, val, possibleTypes) {
    let isValid = false;
    // might be used in the future
    // eslint-disable-next-line
    let customMessage = undefined;
    for (const possibleType of possibleTypes) {
        switch (possibleType) {
            case "boolean":
                if (typeof val === "boolean")
                    isValid = true;
                break;
            case "null":
                if (val === null)
                    isValid = true;
                break;
            case "number":
                if (typeof val === "number")
                    isValid = true;
                break;
            case "numberArray":
                if (isArray(val) && val.every((v) => typeof v === "number")) {
                    isValid = true;
                }
                break;
            case "string":
                if (typeof val === "string")
                    isValid = true;
                break;
            case "stringArray":
                if (isArray(val) && val.every((v) => typeof v === "string")) {
                    isValid = true;
                }
                break;
            case "undefined":
                if (typeof val === "undefined" || val === undefined)
                    isValid = true;
                break;
            default:
                if (isArray(possibleType)) {
                    if (possibleType.includes(val))
                        isValid = true;
                }
                break;
        }
    }
    if (!isValid)
        invalid(key, val, customMessage);
    return isValid;
}
exports.isConfigValueValid = isConfigValueValid;
function isConfigValueValidAsync(key, val, possibleTypes) {
    return __awaiter(this, void 0, void 0, function* () {
        let isValid = false;
        let customMessage = undefined;
        for (const possibleType of possibleTypes) {
            switch (possibleType) {
                case "layoutfluid": {
                    if (typeof val !== "string")
                        break;
                    const layoutNames = val.split(/[# ]+/);
                    if (layoutNames.length < 2 || layoutNames.length > 5)
                        break;
                    // convert the layout names to layouts
                    const layouts = yield Promise.all(layoutNames.map((layoutName) => Misc.getLayout(layoutName)));
                    // check if all layouts exist
                    if (!layouts.every((layout) => layout !== undefined)) {
                        const invalidLayoutNames = layoutNames.map((layoutName, index) => [
                            layoutName,
                            layouts[index],
                        ]);
                        const invalidLayouts = invalidLayoutNames
                            .filter(([_, layout]) => layout === undefined)
                            .map(([layoutName]) => layoutName);
                        customMessage = `The following inputted layouts do not exist: ${invalidLayouts.join(", ")}`;
                        break;
                    }
                    isValid = true;
                    break;
                }
            }
        }
        if (!isValid)
            invalid(key, val, customMessage);
        return isValid;
    });
}
exports.isConfigValueValidAsync = isConfigValueValidAsync;


/***/ }),

/***/ "./src/scripts/config.ts":
/*!*******************************!*\
  !*** ./src/scripts/config.ts ***!
  \*******************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.setShowLiveAcc = exports.setShowLiveWpm = exports.setShowTimerProgress = exports.setPaceCaretStyle = exports.setCaretStyle = exports.setPageWidth = exports.setOppositeShiftMode = exports.setStrictSpace = exports.setColorfulMode = exports.setFlipTestColors = exports.setRepeatQuotes = exports.setEnableAds = exports.setQuickEnd = exports.setShowAllLines = exports.setCapsLockWarning = exports.setSingleListCommandLine = exports.setAlwaysShowWordsHistory = exports.setMinBurstCustomSpeed = exports.setMinBurst = exports.setMinAccCustom = exports.setMinAcc = exports.setMinWpmCustomSpeed = exports.setMinWpm = exports.setRepeatedPace = exports.setPaceCaretCustomSpeed = exports.setPaceCaret = exports.setSwapEscAndTab = exports.setShowOutOfFocusWarning = exports.setAlwaysShowCPM = exports.setAlwaysShowDecimalPlaces = exports.setStopOnError = exports.setChartStyle = exports.setChartAccuracy = exports.setBlindMode = exports.setFunbox = exports.setFavThemes = exports.setDifficulty = exports.setSoundVolume = exports.setPlaySoundOnClick = exports.setPlaySoundOnError = exports.setMode = exports.setPunctuation = exports.setNumbers = exports.saveFullConfigToLocalStorage = exports.setChangedBeforeDb = exports.setDbConfigLoaded = exports.setLocalStorageConfig = exports.changedBeforeDb = exports.dbConfigLoaded = exports.localStorageConfig = void 0;
exports.loadPromise = exports.setConfig = exports.getConfigChanges = exports.loadFromLocalStorage = exports.reset = exports.apply = exports.setBurstHeatmap = exports.setMonkeyPowerLevel = exports.setCustomBackgroundFilter = exports.setCustomBackgroundSize = exports.setCustomLayoutfluid = exports.setCustomBackground = exports.setFontSize = exports.setLayout = exports.setKeymapLayout = exports.setKeymapStyle = exports.setKeymapLegendStyle = exports.setKeymapMode = exports.setMonkey = exports.setLanguage = exports.setCustomThemeColors = exports.setLazyMode = exports.setBritishEnglish = exports.setRandomTheme = exports.setThemeDark = exports.setThemeLight = exports.setTheme = exports.setCustomTheme = exports.setAutoSwitchTheme = exports.setIndicateTypos = exports.setConfidenceMode = exports.setFreedomMode = exports.setFontFamily = exports.previewFontFamily = exports.setQuickTabMode = exports.setSmoothLineScroll = exports.setStartGraphsAtZero = exports.setSmoothCaret = exports.setWordCount = exports.setQuoteLength = exports.setTimeConfig = exports.setKeyTips = exports.setTimerOpacity = exports.setTimerColor = exports.setTimerStyle = exports.setHideExtraLetters = exports.setHighlightMode = exports.setShowAverage = exports.setShowLiveBurst = void 0;
const DB = __importStar(__webpack_require__(/*! ./db */ "./src/scripts/db.ts"));
const OutOfFocus = __importStar(__webpack_require__(/*! ./test/out-of-focus */ "./src/scripts/test/out-of-focus.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./elements/notifications */ "./src/scripts/elements/notifications.ts"));
const config_validation_1 = __webpack_require__(/*! ./config-validation */ "./src/scripts/config-validation.ts");
const ConfigEvent = __importStar(__webpack_require__(/*! ./observables/config-event */ "./src/scripts/observables/config-event.ts"));
const default_config_1 = __importDefault(__webpack_require__(/*! ./constants/default-config */ "./src/scripts/constants/default-config.ts"));
const firebase_1 = __webpack_require__(/*! ./firebase */ "./src/scripts/firebase.ts");
const AnalyticsController = __importStar(__webpack_require__(/*! ./controllers/analytics-controller */ "./src/scripts/controllers/analytics-controller.ts"));
exports.dbConfigLoaded = false;
exports.changedBeforeDb = false;
function setLocalStorageConfig(val) {
    exports.localStorageConfig = val;
}
exports.setLocalStorageConfig = setLocalStorageConfig;
function setDbConfigLoaded(val) {
    exports.dbConfigLoaded = val;
}
exports.setDbConfigLoaded = setDbConfigLoaded;
function setChangedBeforeDb(val) {
    exports.changedBeforeDb = val;
}
exports.setChangedBeforeDb = setChangedBeforeDb;
let loadDone;
let config = Object.assign({}, default_config_1.default);
function saveToLocalStorage(key, nosave = false, noDbCheck = false) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!exports.dbConfigLoaded && !noDbCheck && !nosave) {
            setChangedBeforeDb(true);
        }
        if (nosave)
            return;
        const localToSave = config;
        delete localToSave.resultFilters;
        const localToSaveStringified = JSON.stringify(localToSave);
        window.localStorage.setItem("config", localToSaveStringified);
        if (!noDbCheck) {
            // await DB.saveConfig(dbToSave);
            yield saveToDatabase(key);
        }
        ConfigEvent.dispatch("saveToLocalStorage", localToSaveStringified);
    });
}
let configToSend = {};
let saveTimeout = null;
function saveToDatabase(key) {
    return __awaiter(this, void 0, void 0, function* () {
        configToSend[key] = config[key];
        if (saveTimeout === null) {
            saveTimeout = setTimeout(() => __awaiter(this, void 0, void 0, function* () {
                delete configToSend.resultFilters;
                if (Object.keys(configToSend).length > 0)
                    DB.saveConfig(configToSend);
                configToSend = {};
                clearTimeout(saveTimeout);
                saveTimeout = null;
            }), window.location.hostname === "localhost" ? 0 : 1000);
        }
    });
}
function saveFullConfigToLocalStorage(noDbCheck = false) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!exports.dbConfigLoaded && !noDbCheck) {
            setChangedBeforeDb(true);
        }
        const save = config;
        delete save.resultFilters;
        const stringified = JSON.stringify(save);
        window.localStorage.setItem("config", stringified);
        if (!noDbCheck)
            yield DB.saveConfig(save);
        ConfigEvent.dispatch("saveToLocalStorage", stringified);
    });
}
exports.saveFullConfigToLocalStorage = saveFullConfigToLocalStorage;
//numbers
function setNumbers(numb, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("numbers", numb, ["boolean"]))
        return false;
    if (config.mode === "quote") {
        numb = false;
    }
    config.numbers = numb;
    if (!config.numbers) {
        $("#top .config .numbersMode .text-button").removeClass("active");
    }
    else {
        $("#top .config .numbersMode .text-button").addClass("active");
    }
    saveToLocalStorage("numbers", nosave);
    ConfigEvent.dispatch("numbers", config.numbers);
    return true;
}
exports.setNumbers = setNumbers;
//punctuation
function setPunctuation(punc, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("punctuation", punc, ["boolean"]))
        return false;
    if (config.mode === "quote") {
        punc = false;
    }
    config.punctuation = punc;
    if (!config.punctuation) {
        $("#top .config .punctuationMode .text-button").removeClass("active");
    }
    else {
        $("#top .config .punctuationMode .text-button").addClass("active");
    }
    saveToLocalStorage("punctuation", nosave);
    ConfigEvent.dispatch("punctuation", config.punctuation);
    return true;
}
exports.setPunctuation = setPunctuation;
function setMode(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("mode", mode, [
        ["time", "words", "quote", "zen", "custom"],
    ])) {
        return false;
    }
    if (mode !== "words" && config.funbox === "memory") {
        Notifications.add("Memory funbox can only be used with words mode.", 0);
        return false;
    }
    const previous = config.mode;
    config.mode = mode;
    if (config.mode == "custom") {
        setPunctuation(false, true);
        setNumbers(false, true);
    }
    else if (config.mode == "quote") {
        setPunctuation(false, true);
        setNumbers(false, true);
    }
    else if (config.mode == "zen") {
        if (config.paceCaret != "off") {
            Notifications.add(`Pace caret will not work with zen mode.`, 0);
        }
    }
    saveToLocalStorage("mode", nosave);
    ConfigEvent.dispatch("mode", config.mode, nosave, previous);
    return true;
}
exports.setMode = setMode;
function setPlaySoundOnError(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("play sound on error", val, ["boolean"])) {
        return false;
    }
    config.playSoundOnError = val;
    saveToLocalStorage("playSoundOnError", nosave);
    ConfigEvent.dispatch("playSoundOnError", config.playSoundOnError);
    return true;
}
exports.setPlaySoundOnError = setPlaySoundOnError;
function setPlaySoundOnClick(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("play sound on click", val, [
        ["off", "1", "2", "3", "4", "5", "6", "7"],
    ])) {
        return false;
    }
    config.playSoundOnClick = val;
    saveToLocalStorage("playSoundOnClick", nosave);
    ConfigEvent.dispatch("playSoundOnClick", config.playSoundOnClick);
    return true;
}
exports.setPlaySoundOnClick = setPlaySoundOnClick;
function setSoundVolume(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("sound volume", val, [["0.1", "0.5", "1.0"]])) {
        return false;
    }
    config.soundVolume = val;
    saveToLocalStorage("soundVolume", nosave);
    ConfigEvent.dispatch("soundVolume", config.soundVolume);
    return true;
}
exports.setSoundVolume = setSoundVolume;
//difficulty
function setDifficulty(diff, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("difficulty", diff, [["normal", "expert", "master"]])) {
        return false;
    }
    config.difficulty = diff;
    saveToLocalStorage("difficulty", nosave);
    ConfigEvent.dispatch("difficulty", config.difficulty, nosave);
    return true;
}
exports.setDifficulty = setDifficulty;
//set fav themes
function setFavThemes(themes, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("favorite themes", themes, ["stringArray"])) {
        return false;
    }
    config.favThemes = themes;
    saveToLocalStorage("favThemes", nosave);
    ConfigEvent.dispatch("favThemes", config.favThemes);
    return true;
}
exports.setFavThemes = setFavThemes;
function setFunbox(funbox, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("funbox", funbox, ["string"]))
        return false;
    const val = funbox ? funbox : "none";
    config.funbox = val;
    saveToLocalStorage("funbox", nosave);
    ConfigEvent.dispatch("funbox", config.funbox);
    return true;
}
exports.setFunbox = setFunbox;
function setBlindMode(blind, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("blind mode", blind, ["boolean"]))
        return false;
    config.blindMode = blind;
    saveToLocalStorage("blindMode", nosave);
    ConfigEvent.dispatch("blindMode", config.blindMode, nosave);
    return true;
}
exports.setBlindMode = setBlindMode;
function setChartAccuracy(chartAccuracy, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("chart accuracy", chartAccuracy, ["boolean"])) {
        return false;
    }
    config.chartAccuracy = chartAccuracy;
    saveToLocalStorage("chartAccuracy", nosave);
    ConfigEvent.dispatch("chartAccuracy", config.chartAccuracy);
    return true;
}
exports.setChartAccuracy = setChartAccuracy;
function setChartStyle(chartStyle, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("chart style", chartStyle, [["line", "scatter"]])) {
        return false;
    }
    config.chartStyle = chartStyle;
    saveToLocalStorage("chartStyle", nosave);
    ConfigEvent.dispatch("chartStyle", config.chartStyle);
    return true;
}
exports.setChartStyle = setChartStyle;
function setStopOnError(soe, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("stop on error", soe, [["off", "word", "letter"]])) {
        return false;
    }
    config.stopOnError = soe;
    if (config.stopOnError !== "off") {
        config.confidenceMode = "off";
    }
    saveToLocalStorage("stopOnError", nosave);
    ConfigEvent.dispatch("stopOnError", config.stopOnError, nosave);
    return true;
}
exports.setStopOnError = setStopOnError;
function setAlwaysShowDecimalPlaces(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("always show decimal places", val, ["boolean"])) {
        return false;
    }
    config.alwaysShowDecimalPlaces = val;
    saveToLocalStorage("alwaysShowDecimalPlaces", nosave);
    ConfigEvent.dispatch("alwaysShowDecimalPlaces", config.alwaysShowDecimalPlaces);
    return true;
}
exports.setAlwaysShowDecimalPlaces = setAlwaysShowDecimalPlaces;
function setAlwaysShowCPM(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("always show CPM", val, ["boolean"]))
        return false;
    config.alwaysShowCPM = val;
    saveToLocalStorage("alwaysShowCPM", nosave);
    ConfigEvent.dispatch("alwaysShowCPM", config.alwaysShowCPM);
    return true;
}
exports.setAlwaysShowCPM = setAlwaysShowCPM;
function setShowOutOfFocusWarning(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show out of focus warning", val, ["boolean"])) {
        return false;
    }
    config.showOutOfFocusWarning = val;
    if (!config.showOutOfFocusWarning) {
        OutOfFocus.hide();
    }
    saveToLocalStorage("showOutOfFocusWarning", nosave);
    ConfigEvent.dispatch("showOutOfFocusWarning", config.showOutOfFocusWarning);
    return true;
}
exports.setShowOutOfFocusWarning = setShowOutOfFocusWarning;
function setSwapEscAndTab(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("swap esc and tab", val, ["boolean"]))
        return false;
    config.swapEscAndTab = val;
    saveToLocalStorage("swapEscAndTab", nosave);
    ConfigEvent.dispatch("swapEscAndTab", config.swapEscAndTab);
    return true;
}
exports.setSwapEscAndTab = setSwapEscAndTab;
//pace caret
function setPaceCaret(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("pace caret", val, [["custom", "off", "average", "pb"]])) {
        return false;
    }
    if (document.readyState === "complete") {
        if (val == "pb" && firebase_1.Auth.currentUser === null) {
            Notifications.add("PB pace caret is unavailable without an account", 0);
            return false;
        }
    }
    // if (config.mode === "zen" && val != "off") {
    //   Notifications.add(`Can't use pace caret with zen mode.`, 0);
    //   val = "off";
    // }
    config.paceCaret = val;
    saveToLocalStorage("paceCaret", nosave);
    ConfigEvent.dispatch("paceCaret", config.paceCaret, nosave);
    return true;
}
exports.setPaceCaret = setPaceCaret;
function setPaceCaretCustomSpeed(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("pace caret custom speed", val, ["number"])) {
        return false;
    }
    config.paceCaretCustomSpeed = val;
    saveToLocalStorage("paceCaretCustomSpeed", nosave);
    ConfigEvent.dispatch("paceCaretCustomSpeed", config.paceCaretCustomSpeed);
    return true;
}
exports.setPaceCaretCustomSpeed = setPaceCaretCustomSpeed;
function setRepeatedPace(pace, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("repeated pace", pace, ["boolean"]))
        return false;
    config.repeatedPace = pace;
    saveToLocalStorage("repeatedPace", nosave);
    ConfigEvent.dispatch("repeatedPace", config.repeatedPace);
    return true;
}
exports.setRepeatedPace = setRepeatedPace;
//min wpm
function setMinWpm(minwpm, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min WPM", minwpm, [["off", "custom"]]))
        return false;
    config.minWpm = minwpm;
    saveToLocalStorage("minWpm", nosave);
    ConfigEvent.dispatch("minWpm", config.minWpm, nosave);
    return true;
}
exports.setMinWpm = setMinWpm;
function setMinWpmCustomSpeed(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min WPM custom speed", val, ["number"])) {
        return false;
    }
    config.minWpmCustomSpeed = val;
    saveToLocalStorage("minWpmCustomSpeed", nosave);
    ConfigEvent.dispatch("minWpmCustomSpeed", config.minWpmCustomSpeed);
    return true;
}
exports.setMinWpmCustomSpeed = setMinWpmCustomSpeed;
//min acc
function setMinAcc(min, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min acc", min, [["off", "custom"]]))
        return false;
    config.minAcc = min;
    saveToLocalStorage("minAcc", nosave);
    ConfigEvent.dispatch("minAcc", config.minAcc, nosave);
    return true;
}
exports.setMinAcc = setMinAcc;
function setMinAccCustom(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min acc custom", val, ["number"]))
        return false;
    config.minAccCustom = val;
    saveToLocalStorage("minAccCustom", nosave);
    ConfigEvent.dispatch("minAccCustom", config.minAccCustom);
    return true;
}
exports.setMinAccCustom = setMinAccCustom;
//min burst
function setMinBurst(min, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min burst", min, [["off", "fixed", "flex"]])) {
        return false;
    }
    config.minBurst = min;
    saveToLocalStorage("minBurst", nosave);
    ConfigEvent.dispatch("minBurst", config.minBurst, nosave);
    return true;
}
exports.setMinBurst = setMinBurst;
function setMinBurstCustomSpeed(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min burst custom speed", val, ["number"])) {
        return false;
    }
    config.minBurstCustomSpeed = val;
    saveToLocalStorage("minBurstCustomSpeed", nosave);
    ConfigEvent.dispatch("minBurstCustomSpeed", config.minBurstCustomSpeed);
    return true;
}
exports.setMinBurstCustomSpeed = setMinBurstCustomSpeed;
//always show words history
function setAlwaysShowWordsHistory(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("always show words history", val, ["boolean"])) {
        return false;
    }
    config.alwaysShowWordsHistory = val;
    saveToLocalStorage("alwaysShowWordsHistory", nosave);
    ConfigEvent.dispatch("alwaysShowWordsHistory", config.alwaysShowWordsHistory);
    return true;
}
exports.setAlwaysShowWordsHistory = setAlwaysShowWordsHistory;
//single list command line
function setSingleListCommandLine(option, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("single list command line", option, [["manual", "on"]])) {
        return false;
    }
    config.singleListCommandLine = option;
    saveToLocalStorage("singleListCommandLine", nosave);
    ConfigEvent.dispatch("singleListCommandLine", config.singleListCommandLine);
    return true;
}
exports.setSingleListCommandLine = setSingleListCommandLine;
//caps lock warning
function setCapsLockWarning(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("caps lock warning", val, ["boolean"]))
        return false;
    config.capsLockWarning = val;
    saveToLocalStorage("capsLockWarning", nosave);
    ConfigEvent.dispatch("capsLockWarning", config.capsLockWarning);
    return true;
}
exports.setCapsLockWarning = setCapsLockWarning;
function setShowAllLines(sal, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show all lines", sal, ["boolean"]))
        return false;
    config.showAllLines = sal;
    saveToLocalStorage("showAllLines", nosave);
    ConfigEvent.dispatch("showAllLines", config.showAllLines, nosave);
    return true;
}
exports.setShowAllLines = setShowAllLines;
function setQuickEnd(qe, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("quick end", qe, ["boolean"]))
        return false;
    config.quickEnd = qe;
    saveToLocalStorage("quickEnd", nosave);
    ConfigEvent.dispatch("quickEnd", config.quickEnd);
    return true;
}
exports.setQuickEnd = setQuickEnd;
function setEnableAds(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("enable ads", val, [["on", "off", "max"]])) {
        return false;
    }
    config.enableAds = val;
    if (!nosave) {
        saveToLocalStorage("enableAds", nosave);
        setTimeout(() => {
            location.reload();
        }, 3000);
        Notifications.add("Ad settings changed. Refreshing...", 0);
    }
    return true;
}
exports.setEnableAds = setEnableAds;
function setRepeatQuotes(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("repeat quotes", val, [["off", "typing"]])) {
        return false;
    }
    config.repeatQuotes = val;
    saveToLocalStorage("repeatQuotes", nosave);
    ConfigEvent.dispatch("repeatQuotes", config.repeatQuotes);
    return true;
}
exports.setRepeatQuotes = setRepeatQuotes;
//flip colors
function setFlipTestColors(flip, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("flip test colors", flip, ["boolean"]))
        return false;
    config.flipTestColors = flip;
    saveToLocalStorage("flipTestColors", nosave);
    ConfigEvent.dispatch("flipTestColors", config.flipTestColors);
    return true;
}
exports.setFlipTestColors = setFlipTestColors;
//extra color
function setColorfulMode(extra, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("colorful mode", extra, ["boolean"]))
        return false;
    config.colorfulMode = extra;
    saveToLocalStorage("colorfulMode", nosave);
    ConfigEvent.dispatch("colorfulMode", config.colorfulMode);
    return true;
}
exports.setColorfulMode = setColorfulMode;
//strict space
function setStrictSpace(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("strict space", val, ["boolean"]))
        return false;
    config.strictSpace = val;
    saveToLocalStorage("strictSpace", nosave);
    ConfigEvent.dispatch("strictSpace", config.strictSpace);
    return true;
}
exports.setStrictSpace = setStrictSpace;
//opposite shift space
function setOppositeShiftMode(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("opposite shift mode", val, [["off", "on", "keymap"]])) {
        return false;
    }
    config.oppositeShiftMode = val;
    saveToLocalStorage("oppositeShiftMode", nosave);
    ConfigEvent.dispatch("oppositeShiftMode", config.oppositeShiftMode);
    return true;
}
exports.setOppositeShiftMode = setOppositeShiftMode;
function setPageWidth(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("page width", val, [
        ["max", "100", "125", "150", "200"],
    ])) {
        return false;
    }
    config.pageWidth = val;
    $("#centerContent").removeClass("wide125");
    $("#centerContent").removeClass("wide150");
    $("#centerContent").removeClass("wide200");
    $("#centerContent").removeClass("widemax");
    if (val !== "100") {
        $("#centerContent").addClass("wide" + val);
    }
    saveToLocalStorage("pageWidth", nosave);
    ConfigEvent.dispatch("pageWidth", config.pageWidth);
    return true;
}
exports.setPageWidth = setPageWidth;
function setCaretStyle(caretStyle, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("caret style", caretStyle, [
        ["off", "default", "block", "outline", "underline", "carrot", "banana"],
    ])) {
        return false;
    }
    config.caretStyle = caretStyle;
    $("#caret").removeClass("off");
    $("#caret").removeClass("default");
    $("#caret").removeClass("underline");
    $("#caret").removeClass("outline");
    $("#caret").removeClass("block");
    $("#caret").removeClass("carrot");
    $("#caret").removeClass("banana");
    if (caretStyle == "off") {
        $("#caret").addClass("off");
    }
    else if (caretStyle == "default") {
        $("#caret").addClass("default");
    }
    else if (caretStyle == "block") {
        $("#caret").addClass("block");
    }
    else if (caretStyle == "outline") {
        $("#caret").addClass("outline");
    }
    else if (caretStyle == "underline") {
        $("#caret").addClass("underline");
    }
    else if (caretStyle == "carrot") {
        $("#caret").addClass("carrot");
    }
    else if (caretStyle == "banana") {
        $("#caret").addClass("banana");
    }
    saveToLocalStorage("caretStyle", nosave);
    ConfigEvent.dispatch("caretStyle", config.caretStyle);
    return true;
}
exports.setCaretStyle = setCaretStyle;
function setPaceCaretStyle(caretStyle, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("pace caret style", caretStyle, [
        ["off", "default", "block", "outline", "underline", "carrot", "banana"],
    ])) {
        return false;
    }
    config.paceCaretStyle = caretStyle;
    $("#paceCaret").removeClass("off");
    $("#paceCaret").removeClass("default");
    $("#paceCaret").removeClass("underline");
    $("#paceCaret").removeClass("outline");
    $("#paceCaret").removeClass("block");
    $("#paceCaret").removeClass("carrot");
    $("#paceCaret").removeClass("banana");
    if (caretStyle == "default") {
        $("#paceCaret").addClass("default");
    }
    else if (caretStyle == "block") {
        $("#paceCaret").addClass("block");
    }
    else if (caretStyle == "outline") {
        $("#paceCaret").addClass("outline");
    }
    else if (caretStyle == "underline") {
        $("#paceCaret").addClass("underline");
    }
    else if (caretStyle == "carrot") {
        $("#paceCaret").addClass("carrot");
    }
    else if (caretStyle == "banana") {
        $("#paceCaret").addClass("banana");
    }
    saveToLocalStorage("paceCaretStyle", nosave);
    ConfigEvent.dispatch("paceCaretStyle", config.paceCaretStyle);
    return true;
}
exports.setPaceCaretStyle = setPaceCaretStyle;
function setShowTimerProgress(timer, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show timer progress", timer, ["boolean"])) {
        return false;
    }
    config.showTimerProgress = timer;
    saveToLocalStorage("showTimerProgress", nosave);
    ConfigEvent.dispatch("showTimerProgress", config.showTimerProgress);
    return true;
}
exports.setShowTimerProgress = setShowTimerProgress;
function setShowLiveWpm(live, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show live WPM", live, ["boolean"]))
        return false;
    config.showLiveWpm = live;
    saveToLocalStorage("showLiveWpm", nosave);
    ConfigEvent.dispatch("showLiveWpm", config.showLiveWpm);
    return true;
}
exports.setShowLiveWpm = setShowLiveWpm;
function setShowLiveAcc(live, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show live acc", live, ["boolean"]))
        return false;
    config.showLiveAcc = live;
    saveToLocalStorage("showLiveAcc", nosave);
    ConfigEvent.dispatch("showLiveAcc", config.showLiveAcc);
    return true;
}
exports.setShowLiveAcc = setShowLiveAcc;
function setShowLiveBurst(live, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show live burst", live, ["boolean"]))
        return false;
    config.showLiveBurst = live;
    saveToLocalStorage("showLiveBurst", nosave);
    ConfigEvent.dispatch("showLiveBurst", config.showLiveBurst);
    return true;
}
exports.setShowLiveBurst = setShowLiveBurst;
function setShowAverage(value, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show average", value, [["off", "wpm", "acc", "both"]])) {
        return false;
    }
    config.showAverage = value;
    saveToLocalStorage("showAverage", nosave);
    ConfigEvent.dispatch("showAverage", config.showAverage, nosave);
    return true;
}
exports.setShowAverage = setShowAverage;
function setHighlightMode(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("highlight mode", mode, [["off", "letter", "word"]])) {
        return false;
    }
    if (mode === "word" &&
        (config.funbox === "nospace" ||
            config.funbox === "read_ahead" ||
            config.funbox === "read_ahead_easy" ||
            config.funbox === "read_ahead_hard" ||
            config.funbox === "tts" ||
            config.funbox === "arrows")) {
        Notifications.add("Can't use word highlight with this funbox", 0);
        return false;
    }
    config.highlightMode = mode;
    saveToLocalStorage("highlightMode", nosave);
    ConfigEvent.dispatch("highlightMode", config.highlightMode);
    return true;
}
exports.setHighlightMode = setHighlightMode;
function setHideExtraLetters(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("hide extra letters", val, ["boolean"]))
        return false;
    config.hideExtraLetters = val;
    saveToLocalStorage("hideExtraLetters", nosave);
    ConfigEvent.dispatch("hideExtraLetters", config.hideExtraLetters);
    return true;
}
exports.setHideExtraLetters = setHideExtraLetters;
function setTimerStyle(style, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("timer style", style, [["bar", "text", "mini"]])) {
        return false;
    }
    config.timerStyle = style;
    saveToLocalStorage("timerStyle", nosave);
    ConfigEvent.dispatch("timerStyle", config.timerStyle);
    return true;
}
exports.setTimerStyle = setTimerStyle;
function setTimerColor(color, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("timer color", color, [
        ["black", "sub", "text", "main"],
    ])) {
        return false;
    }
    config.timerColor = color;
    $("#timer").removeClass("timerSub");
    $("#timer").removeClass("timerText");
    $("#timer").removeClass("timerMain");
    $("#timerNumber").removeClass("timerSub");
    $("#timerNumber").removeClass("timerText");
    $("#timerNumber").removeClass("timerMain");
    $("#largeLiveWpmAndAcc").removeClass("timerSub");
    $("#largeLiveWpmAndAcc").removeClass("timerText");
    $("#largeLiveWpmAndAcc").removeClass("timerMain");
    $("#miniTimerAndLiveWpm").removeClass("timerSub");
    $("#miniTimerAndLiveWpm").removeClass("timerText");
    $("#miniTimerAndLiveWpm").removeClass("timerMain");
    if (color === "main") {
        $("#timer").addClass("timerMain");
        $("#timerNumber").addClass("timerMain");
        $("#largeLiveWpmAndAcc").addClass("timerMain");
        $("#miniTimerAndLiveWpm").addClass("timerMain");
    }
    else if (color === "sub") {
        $("#timer").addClass("timerSub");
        $("#timerNumber").addClass("timerSub");
        $("#largeLiveWpmAndAcc").addClass("timerSub");
        $("#miniTimerAndLiveWpm").addClass("timerSub");
    }
    else if (color === "text") {
        $("#timer").addClass("timerText");
        $("#timerNumber").addClass("timerText");
        $("#largeLiveWpmAndAcc").addClass("timerText");
        $("#miniTimerAndLiveWpm").addClass("timerText");
    }
    saveToLocalStorage("timerColor", nosave);
    ConfigEvent.dispatch("timerColor", config.timerColor);
    return true;
}
exports.setTimerColor = setTimerColor;
function setTimerOpacity(opacity, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("timer opacity", opacity, [
        ["0.25", "0.5", "0.75", "1"],
    ])) {
        return false;
    }
    config.timerOpacity = opacity;
    saveToLocalStorage("timerOpacity", nosave);
    ConfigEvent.dispatch("timerOpacity", config.timerOpacity);
    return true;
}
exports.setTimerOpacity = setTimerOpacity;
//key tips
function setKeyTips(keyTips, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("key tips", keyTips, ["boolean"]))
        return false;
    config.showKeyTips = keyTips;
    if (config.showKeyTips) {
        $("#bottom .keyTips").removeClass("hidden");
    }
    else {
        $("#bottom .keyTips").addClass("hidden");
    }
    saveToLocalStorage("showKeyTips", nosave);
    ConfigEvent.dispatch("showKeyTips", config.showKeyTips);
    return true;
}
exports.setKeyTips = setKeyTips;
//mode
function setTimeConfig(time, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("time", time, ["number"]))
        return false;
    const newTime = isNaN(time) || time < 0 ? default_config_1.default.time : time;
    $("#top .config .time .text-button").removeClass("active");
    const timeCustom = ![15, 30, 60, 120].includes(newTime) ? "custom" : newTime;
    config.time = newTime;
    $("#top .config .time .text-button[timeConfig='" + timeCustom + "']").addClass("active");
    saveToLocalStorage("time", nosave);
    ConfigEvent.dispatch("time", config.time);
    return true;
}
exports.setTimeConfig = setTimeConfig;
//quote length
function setQuoteLength(len, nosave, multipleMode) {
    if (!(0, config_validation_1.isConfigValueValid)("quote length", len, [
        [-2, -1, 0, 1, 2, 3],
        "numberArray",
    ])) {
        return false;
    }
    if (Array.isArray(len)) {
        //config load
        if (len.length === 1 && len[0] === -1)
            len = [1];
        config.quoteLength = len;
    }
    else {
        if (!Array.isArray(config.quoteLength))
            config.quoteLength = [];
        if (len === null || isNaN(len) || len < -2 || len > 3) {
            len = 1;
        }
        len = parseInt(len.toString());
        if (multipleMode) {
            if (!config.quoteLength.includes(len)) {
                config.quoteLength.push(len);
            }
            else {
                if (config.quoteLength.length > 1) {
                    config.quoteLength = config.quoteLength.filter((ql) => ql !== len);
                }
            }
        }
        else {
            config.quoteLength = [len];
        }
    }
    // if (!nosave) setMode("quote", nosave);
    $("#top .config .quoteLength .text-button").removeClass("active");
    config.quoteLength.forEach((ql) => {
        $("#top .config .quoteLength .text-button[quoteLength='" + ql + "']").addClass("active");
    });
    saveToLocalStorage("quoteLength", nosave);
    ConfigEvent.dispatch("quoteLength", config.quoteLength);
    return true;
}
exports.setQuoteLength = setQuoteLength;
function setWordCount(wordCount, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("words", wordCount, ["number"]))
        return false;
    const newWordCount = wordCount < 0 || wordCount > 100000 ? default_config_1.default.words : wordCount;
    $("#top .config .wordCount .text-button").removeClass("active");
    const wordCustom = ![10, 25, 50, 100, 200].includes(newWordCount)
        ? "custom"
        : newWordCount;
    config.words = newWordCount;
    $("#top .config .wordCount .text-button[wordCount='" + wordCustom + "']").addClass("active");
    saveToLocalStorage("words", nosave);
    ConfigEvent.dispatch("words", config.words);
    return true;
}
exports.setWordCount = setWordCount;
//caret
function setSmoothCaret(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("smooth caret", mode, ["boolean"]))
        return false;
    config.smoothCaret = mode;
    if (mode) {
        $("#caret").css("animation-name", "caretFlashSmooth");
    }
    else {
        $("#caret").css("animation-name", "caretFlashHard");
    }
    saveToLocalStorage("smoothCaret", nosave);
    ConfigEvent.dispatch("smoothCaret", config.smoothCaret);
    return true;
}
exports.setSmoothCaret = setSmoothCaret;
function setStartGraphsAtZero(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("start graphs at zero", mode, ["boolean"])) {
        return false;
    }
    config.startGraphsAtZero = mode;
    saveToLocalStorage("startGraphsAtZero", nosave);
    ConfigEvent.dispatch("startGraphsAtZero", config.startGraphsAtZero);
    return true;
}
exports.setStartGraphsAtZero = setStartGraphsAtZero;
//linescroll
function setSmoothLineScroll(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("smooth line scroll", mode, ["boolean"])) {
        return false;
    }
    config.smoothLineScroll = mode;
    saveToLocalStorage("smoothLineScroll", nosave);
    ConfigEvent.dispatch("smoothLineScroll", config.smoothLineScroll);
    return true;
}
exports.setSmoothLineScroll = setSmoothLineScroll;
//quick tab
function setQuickTabMode(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("quick tab mode", mode, ["boolean"]))
        return false;
    config.quickTab = mode;
    if (!config.quickTab) {
        $("#restartTestButton").removeClass("hidden");
        $("#restartTestButton").css("opacity", 1);
        $("#bottom .keyTips")
            .html(`<key>tab</key> and <key>enter</key> / <key>space</key> - restart test<br>
      <key>ctrl/cmd</key>+<key>shift</key>+<key>p</key> or <key>esc</key> - command line`);
    }
    else {
        $("#restartTestButton").addClass("hidden");
        $("#bottom .keyTips").html(`<key>tab</key> - restart test<br>
    <key>ctrl/cmd</key>+<key>shift</key>+<key>p</key> or <key>esc</key> - command line`);
    }
    saveToLocalStorage("quickTab", nosave);
    ConfigEvent.dispatch("quickTab", config.quickTab);
    return true;
}
exports.setQuickTabMode = setQuickTabMode;
function previewFontFamily(font) {
    if (!(0, config_validation_1.isConfigValueValid)("preview font family", font, ["string"])) {
        return false;
    }
    document.documentElement.style.setProperty("--font", '"' + font.replace(/_/g, " ") + '", "Roboto Mono"');
    return true;
}
exports.previewFontFamily = previewFontFamily;
//font family
function setFontFamily(font, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("font family", font, ["string"]))
        return false;
    if (font === "") {
        font = "roboto_mono";
        Notifications.add("Empty input received, reverted to the default font.", 0, 3, "Custom font");
    }
    if (!(0, config_validation_1.isConfigKeyValid)(font)) {
        Notifications.add(`Invalid font name value: "${font}".`, -1, 3, "Custom font");
        return false;
    }
    config.fontFamily = font;
    document.documentElement.style.setProperty("--font", `"${font.replace(/_/g, " ")}", "Roboto Mono"`);
    saveToLocalStorage("fontFamily", nosave);
    ConfigEvent.dispatch("fontFamily", config.fontFamily);
    return true;
}
exports.setFontFamily = setFontFamily;
//freedom
function setFreedomMode(freedom, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("freedom mode", freedom, ["boolean"]))
        return false;
    if (freedom == null) {
        freedom = false;
    }
    config.freedomMode = freedom;
    if (config.freedomMode && config.confidenceMode !== "off") {
        config.confidenceMode = "off";
    }
    saveToLocalStorage("freedomMode", nosave);
    ConfigEvent.dispatch("freedomMode", config.freedomMode);
    return true;
}
exports.setFreedomMode = setFreedomMode;
function setConfidenceMode(cm, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("confidence mode", cm, [["off", "on", "max"]])) {
        return false;
    }
    config.confidenceMode = cm;
    if (config.confidenceMode !== "off") {
        config.freedomMode = false;
        config.stopOnError = "off";
    }
    saveToLocalStorage("confidenceMode", nosave);
    ConfigEvent.dispatch("confidenceMode", config.confidenceMode, nosave);
    return true;
}
exports.setConfidenceMode = setConfidenceMode;
function setIndicateTypos(value, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("indicate typos", value, [["off", "below", "replace"]])) {
        return false;
    }
    config.indicateTypos = value;
    saveToLocalStorage("indicateTypos", nosave);
    ConfigEvent.dispatch("indicateTypos", config.indicateTypos);
    return true;
}
exports.setIndicateTypos = setIndicateTypos;
function setAutoSwitchTheme(boolean, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("auto switch theme", boolean, ["boolean"])) {
        return false;
    }
    boolean = boolean !== null && boolean !== void 0 ? boolean : default_config_1.default.autoSwitchTheme;
    config.autoSwitchTheme = boolean;
    saveToLocalStorage("autoSwitchTheme", nosave);
    ConfigEvent.dispatch("autoSwitchTheme", config.autoSwitchTheme);
    return true;
}
exports.setAutoSwitchTheme = setAutoSwitchTheme;
function setCustomTheme(boolean, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("custom theme", boolean, ["boolean"]))
        return false;
    config.customTheme = boolean;
    saveToLocalStorage("customTheme", nosave);
    ConfigEvent.dispatch("customTheme", config.customTheme);
    return true;
}
exports.setCustomTheme = setCustomTheme;
function setTheme(name, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("theme", name, ["string"]))
        return false;
    config.theme = name;
    setCustomTheme(false);
    saveToLocalStorage("theme", nosave);
    ConfigEvent.dispatch("theme", config.theme);
    return true;
}
exports.setTheme = setTheme;
function setThemeLight(name, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("theme light", name, ["string"]))
        return false;
    config.themeLight = name;
    saveToLocalStorage("themeLight", nosave);
    ConfigEvent.dispatch("themeLight", config.themeLight, nosave);
    return true;
}
exports.setThemeLight = setThemeLight;
function setThemeDark(name, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("theme dark", name, ["string"]))
        return false;
    config.themeDark = name;
    saveToLocalStorage("themeDark", nosave);
    ConfigEvent.dispatch("themeDark", config.themeDark, nosave);
    return true;
}
exports.setThemeDark = setThemeDark;
function setThemes(theme, customState, customThemeColors, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("themes", theme, ["string"]))
        return false;
    config.customThemeColors = customThemeColors;
    config.theme = theme;
    config.customTheme = customState;
    saveToLocalStorage("theme", nosave);
    ConfigEvent.dispatch("setThemes", customState);
    return true;
}
function setRandomTheme(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("random theme", val, [
        ["off", "on", "fav", "light", "dark", "custom"],
    ])) {
        return false;
    }
    if (val === "custom") {
        if (firebase_1.Auth.currentUser === null) {
            config.randomTheme = val;
            return false;
        }
        if (!DB.getSnapshot())
            return true;
        if (DB.getSnapshot().customThemes.length === 0) {
            Notifications.add("You need to create a custom theme first", 0);
            config.randomTheme = "off";
            return false;
        }
    }
    config.randomTheme = val;
    saveToLocalStorage("randomTheme", nosave);
    ConfigEvent.dispatch("randomTheme", config.randomTheme);
    return true;
}
exports.setRandomTheme = setRandomTheme;
function setBritishEnglish(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("british english", val, ["boolean"]))
        return false;
    if (!val) {
        val = false;
    }
    config.britishEnglish = val;
    saveToLocalStorage("britishEnglish", nosave);
    ConfigEvent.dispatch("britishEnglish", config.britishEnglish);
    return true;
}
exports.setBritishEnglish = setBritishEnglish;
function setLazyMode(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("lazy mode", val, ["boolean"]))
        return false;
    if (!val) {
        val = false;
    }
    config.lazyMode = val;
    saveToLocalStorage("lazyMode", nosave);
    ConfigEvent.dispatch("lazyMode", config.lazyMode, nosave);
    return true;
}
exports.setLazyMode = setLazyMode;
function setCustomThemeColors(colors, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("custom theme colors", colors, ["stringArray"])) {
        return false;
    }
    if (colors !== undefined) {
        config.customThemeColors = colors;
        // ThemeController.set("custom");
        // applyCustomThemeColors();
    }
    saveToLocalStorage("customThemeColors", nosave);
    ConfigEvent.dispatch("customThemeColors", config.customThemeColors, nosave);
    return true;
}
exports.setCustomThemeColors = setCustomThemeColors;
function setLanguage(language, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("language", language, ["string"]))
        return false;
    config.language = language;
    AnalyticsController.log("changedLanguage", { language });
    saveToLocalStorage("language", nosave);
    ConfigEvent.dispatch("language", config.language);
    return true;
}
exports.setLanguage = setLanguage;
function setMonkey(monkey, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("monkey", monkey, ["boolean"]))
        return false;
    config.monkey = monkey;
    saveToLocalStorage("monkey", nosave);
    ConfigEvent.dispatch("monkey", config.monkey);
    return true;
}
exports.setMonkey = setMonkey;
function setKeymapMode(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("keymap mode", mode, [
        ["off", "static", "react", "next"],
    ])) {
        return false;
    }
    $(".active-key").removeClass("active-key");
    $(".keymap-key").attr("style", "");
    config.keymapMode = mode;
    saveToLocalStorage("keymapMode", nosave);
    ConfigEvent.dispatch("keymapMode", config.keymapMode, nosave);
    return true;
}
exports.setKeymapMode = setKeymapMode;
function setKeymapLegendStyle(style, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("keymap legend style", style, [
        ["lowercase", "uppercase", "blank", "dynamic"],
    ])) {
        return false;
    }
    // Remove existing styles
    const keymapLegendStyles = ["lowercase", "uppercase", "blank", "dynamic"];
    keymapLegendStyles.forEach((name) => {
        $(".keymapLegendStyle").removeClass(name);
    });
    style = style || "lowercase";
    // Mutate the keymap in the DOM, if it exists.
    // 1. Remove everything
    $(".keymap-key > .letter").css("display", "");
    $(".keymap-key > .letter").css("text-transform", "");
    // 2. Append special styles onto the DOM elements
    if (style === "uppercase") {
        $(".keymap-key > .letter").css("text-transform", "capitalize");
    }
    if (style === "blank") {
        $(".keymap-key > .letter").css("display", "none");
    }
    // Update and save to cookie for persistence
    $(".keymapLegendStyle").addClass(style);
    config.keymapLegendStyle = style;
    saveToLocalStorage("keymapLegendStyle", nosave);
    ConfigEvent.dispatch("keymapLegendStyle", config.keymapLegendStyle);
    return true;
}
exports.setKeymapLegendStyle = setKeymapLegendStyle;
function setKeymapStyle(style, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("keymap style", style, [
        ["staggered", "alice", "matrix", "split", "split_matrix"],
    ])) {
        return false;
    }
    style = style || "staggered";
    config.keymapStyle = style;
    saveToLocalStorage("keymapStyle", nosave);
    ConfigEvent.dispatch("keymapStyle", config.keymapStyle);
    return true;
}
exports.setKeymapStyle = setKeymapStyle;
function setKeymapLayout(layout, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("keymap layout", layout, ["string"]))
        return false;
    config.keymapLayout = layout;
    saveToLocalStorage("keymapLayout", nosave);
    ConfigEvent.dispatch("keymapLayout", config.keymapLayout);
    return true;
}
exports.setKeymapLayout = setKeymapLayout;
function setLayout(layout, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("layout", layout, ["string"]))
        return false;
    config.layout = layout;
    saveToLocalStorage("layout", nosave);
    ConfigEvent.dispatch("layout", config.layout, nosave);
    return true;
}
exports.setLayout = setLayout;
// export function setSavedLayout(layout: string, nosave?: boolean): boolean {
//   if (layout == null || layout == undefined) {
//     layout = "qwerty";
//   }
//   config.savedLayout = layout;
//   setLayout(layout, nosave);
//   return true;
// }
function setFontSize(fontSize, nosave) {
    fontSize = fontSize.toString(); //todo remove after around a week
    if (!(0, config_validation_1.isConfigValueValid)("font size", fontSize, [
        ["1", "125", "15", "2", "3", "4"],
    ])) {
        return false;
    }
    config.fontSize = fontSize;
    $("#words").removeClass("size125");
    $("#caret, #paceCaret").removeClass("size125");
    $("#words").removeClass("size15");
    $("#caret, #paceCaret").removeClass("size15");
    $("#words").removeClass("size2");
    $("#caret, #paceCaret").removeClass("size2");
    $("#words").removeClass("size3");
    $("#caret, #paceCaret").removeClass("size3");
    $("#words").removeClass("size35");
    $("#caret, #paceCaret").removeClass("size35");
    $("#words").removeClass("size4");
    $("#caret, #paceCaret").removeClass("size4");
    $("#miniTimerAndLiveWpm").removeClass("size125");
    $("#miniTimerAndLiveWpm").removeClass("size15");
    $("#miniTimerAndLiveWpm").removeClass("size2");
    $("#miniTimerAndLiveWpm").removeClass("size3");
    $("#miniTimerAndLiveWpm").removeClass("size35");
    $("#miniTimerAndLiveWpm").removeClass("size4");
    if (fontSize == "125") {
        $("#words").addClass("size125");
        $("#caret, #paceCaret").addClass("size125");
        $("#miniTimerAndLiveWpm").addClass("size125");
    }
    else if (fontSize == "15") {
        $("#words").addClass("size15");
        $("#caret, #paceCaret").addClass("size15");
        $("#miniTimerAndLiveWpm").addClass("size15");
    }
    else if (fontSize == "2") {
        $("#words").addClass("size2");
        $("#caret, #paceCaret").addClass("size2");
        $("#miniTimerAndLiveWpm").addClass("size2");
    }
    else if (fontSize == "3") {
        $("#words").addClass("size3");
        $("#caret, #paceCaret").addClass("size3");
        $("#miniTimerAndLiveWpm").addClass("size3");
    }
    else if (fontSize == "4") {
        $("#words").addClass("size4");
        $("#caret, #paceCaret").addClass("size4");
        $("#miniTimerAndLiveWpm").addClass("size4");
    }
    saveToLocalStorage("fontSize", nosave);
    ConfigEvent.dispatch("fontSize", config.fontSize);
    return true;
}
exports.setFontSize = setFontSize;
function setCustomBackground(value, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("custom background", value, ["string"]))
        return false;
    value = value.trim();
    if ((/(https|http):\/\/(www\.|).+\..+\/.+(\.png|\.gif|\.jpeg|\.jpg)/gi.test(value) &&
        !/[<>]/.test(value)) ||
        value == "") {
        config.customBackground = value;
        saveToLocalStorage("customBackground", nosave);
        ConfigEvent.dispatch("customBackground", config.customBackground);
    }
    else {
        Notifications.add("Invalid custom background URL", 0);
    }
    return true;
}
exports.setCustomBackground = setCustomBackground;
function setCustomLayoutfluid(value, nosave) {
    return __awaiter(this, void 0, void 0, function* () {
        const trimmed = value.trim();
        if (!(yield (0, config_validation_1.isConfigValueValidAsync)("layoutfluid", trimmed, ["layoutfluid"]))) {
            return false;
        }
        const customLayoutfluid = trimmed.replace(/ /g, "#");
        config.customLayoutfluid = customLayoutfluid;
        $(".pageSettings .section.customLayoutfluid input").val(customLayoutfluid.replace(/#/g, " "));
        saveToLocalStorage("customLayoutfluid", nosave);
        ConfigEvent.dispatch("customLayoutFluid", config.customLayoutfluid);
        return true;
    });
}
exports.setCustomLayoutfluid = setCustomLayoutfluid;
function setCustomBackgroundSize(value, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("custom background size", value, [
        ["max", "cover", "contain"],
    ])) {
        return false;
    }
    if (value != "cover" && value != "contain" && value != "max") {
        value = "cover";
    }
    config.customBackgroundSize = value;
    saveToLocalStorage("customBackgroundSize", nosave);
    ConfigEvent.dispatch("customBackgroundSize", config.customBackgroundSize);
    return true;
}
exports.setCustomBackgroundSize = setCustomBackgroundSize;
function setCustomBackgroundFilter(array, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("custom background filter", array, ["numberArray"])) {
        return false;
    }
    config.customBackgroundFilter = array;
    saveToLocalStorage("customBackgroundFilter", nosave);
    ConfigEvent.dispatch("customBackgroundFilter", config.customBackgroundFilter);
    return true;
}
exports.setCustomBackgroundFilter = setCustomBackgroundFilter;
function setMonkeyPowerLevel(level, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("monkey power level", level, [
        ["off", "1", "2", "3", "4"],
    ])) {
        return false;
    }
    if (!["off", "1", "2", "3", "4"].includes(level))
        level = "off";
    config.monkeyPowerLevel = level;
    saveToLocalStorage("monkeyPowerLevel", nosave);
    ConfigEvent.dispatch("monkeyPowerLevel", config.monkeyPowerLevel);
    return true;
}
exports.setMonkeyPowerLevel = setMonkeyPowerLevel;
function setBurstHeatmap(value, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("burst heatmap", value, ["boolean"]))
        return false;
    if (!value) {
        value = false;
    }
    config.burstHeatmap = value;
    saveToLocalStorage("burstHeatmap", nosave);
    ConfigEvent.dispatch("burstHeatmap", config.burstHeatmap);
    return true;
}
exports.setBurstHeatmap = setBurstHeatmap;
function apply(configToApply) {
    if (!configToApply)
        return;
    const configObj = configToApply;
    Object.keys(default_config_1.default).forEach((configKey) => {
        if (configObj[configKey] === undefined) {
            const newValue = default_config_1.default[configKey];
            configObj[configKey] = newValue;
        }
    });
    if (configObj !== undefined && configObj !== null) {
        setThemeLight(configObj.themeLight, true);
        setThemeDark(configObj.themeDark, true);
        setAutoSwitchTheme(configObj.autoSwitchTheme, true);
        setThemes(configObj.theme, configObj.customTheme, configObj.customThemeColors, true);
        setCustomLayoutfluid(configObj.customLayoutfluid, true);
        setCustomBackground(configObj.customBackground, true);
        setCustomBackgroundSize(configObj.customBackgroundSize, true);
        setCustomBackgroundFilter(configObj.customBackgroundFilter, true);
        setQuickTabMode(configObj.quickTab, true);
        setKeyTips(configObj.showKeyTips, true);
        setTimeConfig(configObj.time, true);
        setQuoteLength(configObj.quoteLength, true);
        setWordCount(configObj.words, true);
        setLanguage(configObj.language, true);
        setLayout(configObj.layout, true);
        setFontSize(configObj.fontSize, true);
        setFreedomMode(configObj.freedomMode, true);
        setCaretStyle(configObj.caretStyle, true);
        setPaceCaretStyle(configObj.paceCaretStyle, true);
        setDifficulty(configObj.difficulty, true);
        setBlindMode(configObj.blindMode, true);
        setQuickEnd(configObj.quickEnd, true);
        setFlipTestColors(configObj.flipTestColors, true);
        setColorfulMode(configObj.colorfulMode, true);
        setConfidenceMode(configObj.confidenceMode, true);
        setIndicateTypos(configObj.indicateTypos, true);
        setTimerStyle(configObj.timerStyle, true);
        setTimerColor(configObj.timerColor, true);
        setTimerOpacity(configObj.timerOpacity, true);
        setKeymapMode(configObj.keymapMode, true);
        setKeymapStyle(configObj.keymapStyle, true);
        setKeymapLegendStyle(configObj.keymapLegendStyle, true);
        setKeymapLayout(configObj.keymapLayout, true);
        setFontFamily(configObj.fontFamily, true);
        setSmoothCaret(configObj.smoothCaret, true);
        setSmoothLineScroll(configObj.smoothLineScroll, true);
        setShowLiveWpm(configObj.showLiveWpm, true);
        setShowLiveAcc(configObj.showLiveAcc, true);
        setShowLiveBurst(configObj.showLiveBurst, true);
        setShowTimerProgress(configObj.showTimerProgress, true);
        setAlwaysShowDecimalPlaces(configObj.alwaysShowDecimalPlaces, true);
        setAlwaysShowWordsHistory(configObj.alwaysShowWordsHistory, true);
        setSingleListCommandLine(configObj.singleListCommandLine, true);
        setCapsLockWarning(configObj.capsLockWarning, true);
        setPlaySoundOnError(configObj.playSoundOnError, true);
        setPlaySoundOnClick(configObj.playSoundOnClick, true);
        setSoundVolume(configObj.soundVolume, true);
        setStopOnError(configObj.stopOnError, true);
        setFavThemes(configObj.favThemes, true);
        setFunbox(configObj.funbox, true);
        setRandomTheme(configObj.randomTheme, true);
        setShowAllLines(configObj.showAllLines, true);
        setSwapEscAndTab(configObj.swapEscAndTab, true);
        setShowOutOfFocusWarning(configObj.showOutOfFocusWarning, true);
        setPaceCaret(configObj.paceCaret, true);
        setPaceCaretCustomSpeed(configObj.paceCaretCustomSpeed, true);
        setRepeatedPace(configObj.repeatedPace, true);
        setPageWidth(configObj.pageWidth, true);
        setChartAccuracy(configObj.chartAccuracy, true);
        setChartStyle(configObj.chartStyle, true);
        setMinBurst(configObj.minBurst, true);
        setMinBurstCustomSpeed(configObj.minBurstCustomSpeed, true);
        setMinWpm(configObj.minWpm, true);
        setMinWpmCustomSpeed(configObj.minWpmCustomSpeed, true);
        setMinAcc(configObj.minAcc, true);
        setMinAccCustom(configObj.minAccCustom, true);
        setNumbers(configObj.numbers, true);
        setPunctuation(configObj.punctuation, true);
        setHighlightMode(configObj.highlightMode, true);
        setAlwaysShowCPM(configObj.alwaysShowCPM, true);
        setHideExtraLetters(configObj.hideExtraLetters, true);
        setStartGraphsAtZero(configObj.startGraphsAtZero, true);
        setStrictSpace(configObj.strictSpace, true);
        setOppositeShiftMode(configObj.oppositeShiftMode, true);
        setMode(configObj.mode, true);
        setMonkey(configObj.monkey, true);
        setRepeatQuotes(configObj.repeatQuotes, true);
        setMonkeyPowerLevel(configObj.monkeyPowerLevel, true);
        setBurstHeatmap(configObj.burstHeatmap, true);
        setBritishEnglish(configObj.britishEnglish, true);
        setLazyMode(configObj.lazyMode, true);
        setShowAverage(configObj.showAverage, true);
        try {
            setEnableAds(configObj.enableAds, true);
            if (config.enableAds === "max" || config.enableAds === "on") {
                $("head").append(`
          <script
          src="https://hb.vntsm.com/v3/live/ad-manager.min.js"
          type="text/javascript"
          data-site-id="60b78af12119122b8958910f"
          data-mode="scan"
          id="adScript"
          async
          ></script>
        `);
                if (config.enableAds === "max") {
                    //
                    $("#ad_rich_media").removeClass("hidden");
                    $("#ad_rich_media").html(`<div class="vm-placement" data-id="60bf737ee04cb761c88aafb1" style="display:none"></div>`);
                }
                else {
                    $("#ad_rich_media").remove();
                }
                //<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>
                $("#ad_footer").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_footer").removeClass("hidden");
                // $("#ad_footer2").html(`<div class="vm-placement" data-id="60bf73e9e04cb761c88aafb7"></div>`);
                // $("#ad_footer2").removeClass("hidden");
                $("#ad_about1").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_about1").removeClass("hidden");
                $("#ad_about2").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_about2").removeClass("hidden");
                $("#ad_settings0").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_settings0").removeClass("hidden");
                $("#ad_settings1").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_settings1").removeClass("hidden");
                $("#ad_settings2").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_settings2").removeClass("hidden");
                $("#ad_settings3").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_settings3").removeClass("hidden");
                $("#ad_account").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_account").removeClass("hidden");
                $(".footerads").removeClass("hidden");
            }
            else {
                $("#adScript").remove();
                $(".footerads").remove();
                $("#ad_left").remove();
                $("#ad_right").remove();
                $("#ad_footer").remove();
                $("#ad_footer2").remove();
                $("#ad_footer3").remove();
                $("#ad_settings0").remove();
                $("#ad_settings1").remove();
                $("#ad_settings2").remove();
                $("#ad_settings3").remove();
                $("#ad_account").remove();
                $("#ad_about1").remove();
                $("#ad_about2").remove();
            }
        }
        catch (e) {
            Notifications.add("Error initialising ads: " + e.message);
            console.log("error initialising ads " + e.message);
            $(".footerads").remove();
            $("#ad_left").remove();
            $("#ad_right").remove();
            $("#ad_footer").remove();
            $("#ad_footer2").remove();
            $("#ad_footer3").remove();
            $("#ad_settings0").remove();
            $("#ad_settings1").remove();
            $("#ad_settings2").remove();
            $("#ad_settings3").remove();
            $("#ad_account").remove();
            $("#ad_about1").remove();
            $("#ad_about2").remove();
        }
        ConfigEvent.dispatch("configApplied", undefined, undefined, undefined, config);
    }
}
exports.apply = apply;
function reset() {
    ConfigEvent.dispatch("fullConfigChange");
    apply(default_config_1.default);
    saveFullConfigToLocalStorage();
}
exports.reset = reset;
function loadFromLocalStorage() {
    console.log("loading localStorage config");
    const newConfigString = window.localStorage.getItem("config");
    let newConfig;
    if (newConfigString !== undefined &&
        newConfigString !== null &&
        newConfigString !== "") {
        try {
            newConfig = JSON.parse(newConfigString);
        }
        catch (e) {
            newConfig = {};
        }
        apply(newConfig);
        console.log("applying localStorage config");
        exports.localStorageConfig = newConfig;
        saveFullConfigToLocalStorage(true);
        console.log("saving localStorage config");
    }
    // TestLogic.restart(false, true);
    loadDone();
}
exports.loadFromLocalStorage = loadFromLocalStorage;
function getConfigChanges() {
    const configChanges = {};
    Object.keys(config)
        .filter((key) => {
        return config[key] != default_config_1.default[key];
    })
        .forEach((key) => {
        configChanges[key] = config[key];
    });
    return configChanges;
}
exports.getConfigChanges = getConfigChanges;
function setConfig(newConfig) {
    config = newConfig;
}
exports.setConfig = setConfig;
exports.loadPromise = new Promise((v) => {
    loadDone = v;
});
exports["default"] = config;


/***/ }),

/***/ "./src/scripts/constants/default-config.ts":
/*!*************************************************!*\
  !*** ./src/scripts/constants/default-config.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports["default"] = {
    theme: "serika_dark",
    themeLight: "serika",
    themeDark: "serika_dark",
    autoSwitchTheme: false,
    customTheme: false,
    customThemeColors: [
        "#323437",
        "#e2b714",
        "#e2b714",
        "#646669",
        "#d1d0c5",
        "#ca4754",
        "#7e2a33",
        "#ca4754",
        "#7e2a33",
    ],
    favThemes: [],
    showKeyTips: true,
    showLiveWpm: false,
    showTimerProgress: true,
    smoothCaret: true,
    quickTab: false,
    punctuation: false,
    numbers: false,
    words: 50,
    time: 30,
    mode: "time",
    quoteLength: [1],
    language: "english",
    fontSize: "15",
    freedomMode: false,
    resultFilters: null,
    difficulty: "normal",
    blindMode: false,
    quickEnd: false,
    caretStyle: "default",
    paceCaretStyle: "default",
    flipTestColors: false,
    layout: "default",
    funbox: "none",
    confidenceMode: "off",
    indicateTypos: "off",
    timerStyle: "mini",
    colorfulMode: false,
    randomTheme: "off",
    timerColor: "main",
    timerOpacity: "1",
    stopOnError: "off",
    showAllLines: false,
    keymapMode: "off",
    keymapStyle: "staggered",
    keymapLegendStyle: "lowercase",
    keymapLayout: "overrideSync",
    fontFamily: "Roboto_Mono",
    smoothLineScroll: false,
    alwaysShowDecimalPlaces: false,
    alwaysShowWordsHistory: false,
    singleListCommandLine: "manual",
    capsLockWarning: true,
    playSoundOnError: false,
    playSoundOnClick: "off",
    soundVolume: "0.5",
    startGraphsAtZero: true,
    swapEscAndTab: false,
    showOutOfFocusWarning: true,
    paceCaret: "off",
    paceCaretCustomSpeed: 100,
    repeatedPace: true,
    pageWidth: "100",
    chartAccuracy: true,
    chartStyle: "line",
    minWpm: "off",
    minWpmCustomSpeed: 100,
    highlightMode: "letter",
    alwaysShowCPM: false,
    enableAds: "off",
    hideExtraLetters: false,
    strictSpace: false,
    minAcc: "off",
    minAccCustom: 90,
    showLiveAcc: false,
    showLiveBurst: false,
    monkey: false,
    repeatQuotes: "off",
    oppositeShiftMode: "off",
    customBackground: "",
    customBackgroundSize: "cover",
    customBackgroundFilter: [0, 1, 1, 1, 1],
    customLayoutfluid: "qwerty#dvorak#colemak",
    monkeyPowerLevel: "off",
    minBurst: "off",
    minBurstCustomSpeed: 100,
    burstHeatmap: false,
    britishEnglish: false,
    lazyMode: false,
    showAverage: "off",
};


/***/ }),

/***/ "./src/scripts/constants/default-snapshot.ts":
/*!***************************************************!*\
  !*** ./src/scripts/constants/default-snapshot.ts ***!
  \***************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.defaultSnap = void 0;
exports.defaultSnap = {
    results: undefined,
    personalBests: {
        time: {},
        words: {},
        zen: { zen: [] },
        quote: { custom: [] },
        custom: { custom: [] },
    },
    name: "",
    customThemes: [],
    presets: [],
    tags: [],
    favouriteThemes: [],
    banned: undefined,
    verified: undefined,
    emailVerified: undefined,
    lbMemory: { time: { 15: { english: 0 }, 60: { english: 0 } } },
    globalStats: {
        time: 0,
        started: 0,
        completed: 0,
    },
    quoteRatings: undefined,
    quoteMod: false,
};


/***/ }),

/***/ "./src/scripts/constants/firebase-config.ts":
/*!**************************************************!*\
  !*** ./src/scripts/constants/firebase-config.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, exports) => {


// To find your config, go to https://console.firebase.google.com/ and select your project
// Go to (top left) Settings > Project Settings > General
// scroll down to Your apps > Web Apps (if it doesnt exist, create one) > SDK setup and configuration > select npm
// your config should be visible there
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.firebaseConfig = void 0;
exports.firebaseConfig = {
    apiKey: "AIzaSyC8ZGlCnaYJYsz5bsMtmJGbu8QqtCVpM4g",
    authDomain: "monkeytype-d440a.firebaseapp.com",
    projectId: "monkeytype-d440a",
    storageBucket: "monkeytype-d440a.appspot.com",
    messagingSenderId: "409798745430",
    appId: "1:409798745430:web:6843557b36a25156370af7"
};


/***/ }),

/***/ "./src/scripts/controllers/account-controller.ts":
/*!*******************************************************!*\
  !*** ./src/scripts/controllers/account-controller.ts ***!
  \*******************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.signOut = exports.addPasswordAuth = exports.removeGoogleAuth = exports.addGoogleAuth = exports.signInWithGoogle = exports.signIn = exports.getDataAndInit = exports.sendVerificationEmail = exports.gmailProvider = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const AccountButton = __importStar(__webpack_require__(/*! ../elements/account-button */ "./src/scripts/elements/account-button.ts"));
const Account = __importStar(__webpack_require__(/*! ../pages/account */ "./src/scripts/pages/account.ts"));
const VerificationController = __importStar(__webpack_require__(/*! ./verification-controller */ "./src/scripts/controllers/verification-controller.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const AllTimeStats = __importStar(__webpack_require__(/*! ../account/all-time-stats */ "./src/scripts/account/all-time-stats.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const PageController = __importStar(__webpack_require__(/*! ./page-controller */ "./src/scripts/controllers/page-controller.ts"));
const PSA = __importStar(__webpack_require__(/*! ../elements/psa */ "./src/scripts/elements/psa.ts"));
const Focus = __importStar(__webpack_require__(/*! ../test/focus */ "./src/scripts/test/focus.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const PageTransition = __importStar(__webpack_require__(/*! ../states/page-transition */ "./src/scripts/states/page-transition.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const LoadingPage = __importStar(__webpack_require__(/*! ../pages/loading */ "./src/scripts/pages/loading.ts"));
const ResultFilters = __importStar(__webpack_require__(/*! ../account/result-filters */ "./src/scripts/account/result-filters.ts"));
const PaceCaret = __importStar(__webpack_require__(/*! ../test/pace-caret */ "./src/scripts/test/pace-caret.ts"));
const CommandlineLists = __importStar(__webpack_require__(/*! ../elements/commandline-lists */ "./src/scripts/elements/commandline-lists.ts"));
const TagController = __importStar(__webpack_require__(/*! ./tag-controller */ "./src/scripts/controllers/tag-controller.ts"));
const ResultTagsPopup = __importStar(__webpack_require__(/*! ../popups/result-tags-popup */ "./src/scripts/popups/result-tags-popup.ts"));
const URLHandler = __importStar(__webpack_require__(/*! ../utils/url-handler */ "./src/scripts/utils/url-handler.ts"));
const auth_1 = __webpack_require__(/*! firebase/auth */ "./node_modules/firebase/auth/dist/index.esm.js");
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const differenceInDays_1 = __importDefault(__webpack_require__(/*! date-fns/differenceInDays */ "./node_modules/date-fns/esm/differenceInDays/index.js"));
const default_snapshot_1 = __webpack_require__(/*! ../constants/default-snapshot */ "./src/scripts/constants/default-snapshot.ts");
exports.gmailProvider = new auth_1.GoogleAuthProvider();
function sendVerificationEmail() {
    Loader.show();
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    (0, auth_1.sendEmailVerification)(user)
        .then(() => {
        Loader.hide();
        Notifications.add("Email sent to " + user.email, 4000);
    })
        .catch((e) => {
        Loader.hide();
        Notifications.add("Error: " + e.message, 3000);
        console.error(e.message);
    });
}
exports.sendVerificationEmail = sendVerificationEmail;
function getDataAndInit() {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        try {
            console.log("getting account data");
            if (ActivePage.get() === "loading") {
                LoadingPage.updateBar(90);
            }
            else {
                LoadingPage.updateBar(45);
            }
            LoadingPage.updateText("Downloading user data...");
            yield LoadingPage.showBar();
            yield DB.initSnapshot();
        }
        catch (error) {
            const e = error;
            AccountButton.loading(false);
            if (e.responseCode === 429) {
                Notifications.add("Doing so will save you bandwidth, make the next test be ready faster and will not sign you out (which could mean your new personal best would not save to your account).", 0, 0);
                Notifications.add("You will run into this error if you refresh the website to restart the test. It is NOT recommended to do that. Instead, use tab + enter or just tab (with quick tab mode enabled) to restart the test.", 0, 0);
            }
            const msg = e.message || e;
            Notifications.add("Failed to get user data: " + msg, -1);
            $("#top #menu .account").css("opacity", 1);
            if (ActivePage.get() === "loading")
                PageController.change("");
            return false;
        }
        if (ActivePage.get() == "loading") {
            LoadingPage.updateBar(100);
        }
        else {
            LoadingPage.updateBar(45);
        }
        LoadingPage.updateText("Applying settings...");
        const snapshot = DB.getSnapshot();
        $("#menu .icon-button.account .text").text(snapshot.name);
        ResultFilters.loadTags(snapshot.tags);
        Promise.all([Misc.getLanguageList(), Misc.getFunboxList()]).then((values) => {
            const [languages, funboxes] = values;
            languages.forEach((language) => {
                ResultFilters.defaultResultFilters.language[language] = true;
            });
            funboxes.forEach((funbox) => {
                ResultFilters.defaultResultFilters.funbox[funbox.name] = true;
            });
            // filters = defaultResultFilters;
            ResultFilters.load();
        });
        if (!snapshot.name) {
            //verify username
            //invalid, get new
            let nameGood = false;
            let name = "";
            while (!nameGood) {
                name =
                    (_a = prompt("Please provide a new username (cannot be longer than 16 characters, can only contain letters, numbers, underscores, dots and dashes):")) !== null && _a !== void 0 ? _a : "";
                if (!name) {
                    return false;
                }
                const response = yield ape_1.default.users.updateName(name);
                if (response.status !== 200) {
                    Notifications.add("Failed to update name: " + response.message, -1);
                    return false;
                }
                nameGood = true;
                Notifications.add("Name updated", 1);
                snapshot.name = name;
                DB.setSnapshot(snapshot);
                $("#menu .icon-button.account .text").text(name);
            }
        }
        if (!UpdateConfig.changedBeforeDb) {
            //config didnt change before db loaded
            if (UpdateConfig.localStorageConfig === null && snapshot.config) {
                console.log("no local config, applying db");
                AccountButton.loading(false);
                UpdateConfig.apply(snapshot.config);
                Settings.update();
                UpdateConfig.saveFullConfigToLocalStorage(true);
                TestLogic.restart(false, true);
            }
            else if (snapshot.config !== undefined) {
                //loading db config, keep for now
                let configsDifferent = false;
                Object.keys(config_1.default).forEach((ke) => {
                    var _a, _b;
                    const key = ke;
                    if (configsDifferent)
                        return;
                    try {
                        if (key !== "resultFilters") {
                            if (Array.isArray(config_1.default[key])) {
                                config_1.default[key].forEach((arrval, index) => {
                                    var _a;
                                    const arrayValue = ((_a = snapshot === null || snapshot === void 0 ? void 0 : snapshot.config) === null || _a === void 0 ? void 0 : _a[key])[index];
                                    if (arrval != arrayValue) {
                                        configsDifferent = true;
                                        console.log(`.config is different: ${arrval} != ${arrayValue}`);
                                    }
                                });
                            }
                            else {
                                if (config_1.default[key] != ((_a = snapshot === null || snapshot === void 0 ? void 0 : snapshot.config) === null || _a === void 0 ? void 0 : _a[key])) {
                                    configsDifferent = true;
                                    console.log(`..config is different ${key}: ${config_1.default[key]} != ${(_b = snapshot === null || snapshot === void 0 ? void 0 : snapshot.config) === null || _b === void 0 ? void 0 : _b[key]}`);
                                }
                            }
                        }
                    }
                    catch (e) {
                        console.log(e);
                        configsDifferent = true;
                        console.log(`...config is different`);
                    }
                });
                if (configsDifferent) {
                    console.log("configs are different, applying config from db");
                    AccountButton.loading(false);
                    UpdateConfig.apply(snapshot.config);
                    Settings.update();
                    UpdateConfig.saveFullConfigToLocalStorage(true);
                    if (ActivePage.get() == "test") {
                        TestLogic.restart(false, true);
                    }
                    DB.saveConfig(config_1.default);
                }
            }
            UpdateConfig.setDbConfigLoaded(true);
        }
        else {
            console.log("config changed before db");
            AccountButton.loading(false);
        }
        if (config_1.default.paceCaret === "pb" || config_1.default.paceCaret === "average") {
            if (!TestActive.get()) {
                PaceCaret.init();
            }
        }
        AccountButton.loading(false);
        ResultFilters.updateTags();
        CommandlineLists.updateTagCommands();
        TagController.loadActiveFromLocalStorage();
        ResultTagsPopup.updateButtons();
        Settings.showAccountSection();
        PageTransition.set(false);
        console.log("account loading finished");
        return true;
    });
}
exports.getDataAndInit = getDataAndInit;
function loadUser(user) {
    return __awaiter(this, void 0, void 0, function* () {
        // User is signed in.
        $(".pageAccount .content p.accountVerificatinNotice").remove();
        if (user.emailVerified === false) {
            $(".pageAccount .content").prepend(`<p class="accountVerificatinNotice" style="text-align:center">Your account is not verified. <a class="sendVerificationEmail">Send the verification email again</a>.`);
        }
        PageTransition.set(false);
        AccountButton.update();
        AccountButton.loading(true);
        if ((yield getDataAndInit()) === false) {
            signOut();
        }
        // var displayName = user.displayName;
        // var email = user.email;
        // var emailVerified = user.emailVerified;
        // var photoURL = user.photoURL;
        // var isAnonymous = user.isAnonymous;
        // var uid = user.uid;
        // var providerData = user.providerData;
        $(".pageLogin .preloader").addClass("hidden");
        // showFavouriteThemesAtTheTop();
        let text = "Account created on " + user.metadata.creationTime;
        const creationDate = new Date(user.metadata.creationTime);
        const diffDays = (0, differenceInDays_1.default)(new Date(), creationDate);
        text += ` (${diffDays} day${diffDays != 1 ? "s" : ""} ago)`;
        $(".pageAccount .group.createdDate").text(text);
        if (VerificationController.data !== null) {
            VerificationController.verify(user.uid);
        }
    });
}
const authListener = firebase_1.Auth.onAuthStateChanged(function (user) {
    return __awaiter(this, void 0, void 0, function* () {
        // await UpdateConfig.loadPromise;
        console.log(`auth state changed, user ${user ? true : false}`);
        if (user) {
            yield loadUser(user);
        }
        else {
            if (window.location.pathname == "/account") {
                window.history.replaceState("", "", "/login");
            }
            PageTransition.set(false);
        }
        if (user) {
            if (window.location.pathname == "/login") {
                PageController.change("account");
            }
            else if (window.location.pathname != "/account") {
                PageController.change();
                setTimeout(() => {
                    Focus.set(false);
                }, 125 / 2);
            }
            else {
                Account.update();
                // SignOutButton.show();
            }
        }
        else {
            PageController.change();
            setTimeout(() => {
                Focus.set(false);
            }, 125 / 2);
        }
        URLHandler.loadCustomThemeFromUrl();
        if (/challenge_.+/g.test(window.location.pathname)) {
            Notifications.add("Challenge links temporarily disabled. Please use the command line to load the challenge manually", 0, 7);
            return;
            // Notifications.add("Loading challenge", 0);
            // let challengeName = window.location.pathname.split("_")[1];
            // setTimeout(() => {
            //   ChallengeController.setup(challengeName);
            // }, 1000);
        }
        PSA.show();
    });
});
function signIn() {
    UpdateConfig.setChangedBeforeDb(false);
    authListener();
    $(".pageLogin .preloader").removeClass("hidden");
    $(".pageLogin .button").addClass("disabled");
    const email = $(".pageLogin .login input")[0].value;
    const password = $(".pageLogin .login input")[1].value;
    const persistence = $(".pageLogin .login #rememberMe input").prop("checked")
        ? auth_1.browserLocalPersistence
        : auth_1.browserSessionPersistence;
    (0, auth_1.setPersistence)(firebase_1.Auth, persistence).then(function () {
        return (0, auth_1.signInWithEmailAndPassword)(firebase_1.Auth, email, password)
            .then((e) => __awaiter(this, void 0, void 0, function* () {
            yield loadUser(e.user);
            PageController.change("account");
            if (TestLogic.notSignedInLastResult !== null) {
                TestLogic.setNotSignedInUid(e.user.uid);
                const response = yield ape_1.default.results.save(TestLogic.notSignedInLastResult);
                if (response.status !== 200) {
                    return Notifications.add("Failed to save last result: " + response.message, -1);
                }
                TestLogic.clearNotSignedInResult();
                Notifications.add("Last test result saved", 1);
            }
            //TODO: redirect user to relevant page
        }))
            .catch(function (error) {
            let message = error.message;
            if (error.code === "auth/wrong-password") {
                message = "Incorrect password.";
            }
            else if (error.code === "auth/user-not-found") {
                message = "User not found.";
            }
            Notifications.add(message, -1);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
        });
    });
}
exports.signIn = signIn;
function signInWithGoogle() {
    var _a, _b;
    return __awaiter(this, void 0, void 0, function* () {
        UpdateConfig.setChangedBeforeDb(false);
        $(".pageLogin .preloader").removeClass("hidden");
        $(".pageLogin .button").addClass("disabled");
        authListener();
        let signedInUser;
        try {
            const persistence = $(".pageLogin .login #rememberMe input").prop("checked")
                ? auth_1.browserLocalPersistence
                : auth_1.browserSessionPersistence;
            yield (0, auth_1.setPersistence)(firebase_1.Auth, persistence);
            signedInUser = yield (0, auth_1.signInWithPopup)(firebase_1.Auth, exports.gmailProvider);
            if ((_a = (0, auth_1.getAdditionalUserInfo)(signedInUser)) === null || _a === void 0 ? void 0 : _a.isNewUser) {
                //ask for username
                let nameGood = false;
                let name = "";
                while (!nameGood) {
                    name =
                        prompt("Please provide a new username (cannot be longer than 16 characters, can only contain letters, numbers, underscores, dots and dashes):") || "";
                    if (!name) {
                        signOut();
                        $(".pageLogin .preloader").addClass("hidden");
                        return;
                    }
                    const response = yield ape_1.default.users.getNameAvailability(name);
                    if (response.status !== 200) {
                        return Notifications.add("Failed to check name: " + response.message, -1);
                    }
                    nameGood = true;
                }
                //create database object for the new user
                // try {
                const response = yield ape_1.default.users.create(name);
                if (response.status !== 200) {
                    throw response;
                }
                // } catch (e) {
                //   let msg = e?.response?.data?.message ?? e.message;
                //   Notifications.add("Failed to create account: " + msg, -1);
                //   return;
                // }
                if (response.status === 200) {
                    yield (0, auth_1.updateProfile)(signedInUser.user, { displayName: name });
                    yield (0, auth_1.sendEmailVerification)(signedInUser.user);
                    AllTimeStats.clear();
                    Notifications.add("Account created", 1, 3);
                    $("#menu .icon-button.account .text").text(name);
                    $(".pageLogin .button").removeClass("disabled");
                    $(".pageLogin .preloader").addClass("hidden");
                    yield loadUser(signedInUser.user);
                    PageController.change("account");
                    if (TestLogic.notSignedInLastResult !== null) {
                        TestLogic.setNotSignedInUid(signedInUser.user.uid);
                        const resultsSaveResponse = yield ape_1.default.results.save(TestLogic.notSignedInLastResult);
                        if (resultsSaveResponse.status === 200) {
                            const result = TestLogic.notSignedInLastResult;
                            DB.saveLocalResult(result);
                            DB.updateLocalStats({
                                time: result.testDuration +
                                    result.incompleteTestSeconds -
                                    result.afkDuration,
                                started: 1,
                            });
                        }
                    }
                }
            }
            else {
                yield loadUser(signedInUser.user);
                PageController.change("account");
            }
        }
        catch (e) {
            console.log(e);
            const message = Misc.createErrorMessage(e, "Failed to sign in with Google");
            Notifications.add(message, -1);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
            if (signedInUser && ((_b = (0, auth_1.getAdditionalUserInfo)(signedInUser)) === null || _b === void 0 ? void 0 : _b.isNewUser)) {
                yield ape_1.default.users.delete();
                yield signedInUser.user.delete();
            }
            signOut();
            return;
        }
    });
}
exports.signInWithGoogle = signInWithGoogle;
function addGoogleAuth() {
    return __awaiter(this, void 0, void 0, function* () {
        Loader.show();
        if (firebase_1.Auth.currentUser === null)
            return;
        (0, auth_1.linkWithPopup)(firebase_1.Auth.currentUser, exports.gmailProvider)
            .then(function () {
            Loader.hide();
            Notifications.add("Google authentication added", 1);
            Settings.updateAuthSections();
        })
            .catch(function (error) {
            Loader.hide();
            Notifications.add("Failed to add Google authenication: " + error.message, -1);
        });
    });
}
exports.addGoogleAuth = addGoogleAuth;
function removeGoogleAuth() {
    return __awaiter(this, void 0, void 0, function* () {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (user.providerData.find((provider) => provider.providerId === "password")) {
            Loader.show();
            try {
                yield (0, auth_1.reauthenticateWithPopup)(user, exports.gmailProvider);
            }
            catch (e) {
                Loader.hide();
                const message = Misc.createErrorMessage(e, "Failed to reauthenticate");
                return Notifications.add(message, -1);
            }
            (0, auth_1.unlink)(user, "google.com")
                .then(() => {
                Notifications.add("Google authentication removed", 1);
                Loader.hide();
                Settings.updateAuthSections();
            })
                .catch((error) => {
                Loader.hide();
                Notifications.add("Failed to remove Google authentication: " + error.message, -1);
            });
        }
        else {
            Notifications.add("Password authentication needs to be enabled to remove Google authentication", -1);
        }
    });
}
exports.removeGoogleAuth = removeGoogleAuth;
function addPasswordAuth(email, password) {
    return __awaiter(this, void 0, void 0, function* () {
        Loader.show();
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (user.providerData.find((provider) => provider.providerId === "google.com")) {
            try {
                yield (0, auth_1.reauthenticateWithPopup)(user, exports.gmailProvider);
            }
            catch (e) {
                Loader.hide();
                const message = Misc.createErrorMessage(e, "Failed to reauthenticate");
                return Notifications.add(message, -1);
            }
        }
        const credential = auth_1.EmailAuthProvider.credential(email, password);
        (0, auth_1.linkWithCredential)(user, credential)
            .then(function () {
            Loader.hide();
            Notifications.add("Password authenication added", 1);
            Settings.updateAuthSections();
        })
            .catch(function (error) {
            Loader.hide();
            Notifications.add("Failed to add password authenication: " + error.message, -1);
        });
    });
}
exports.addPasswordAuth = addPasswordAuth;
function signOut() {
    firebase_1.Auth.signOut()
        .then(function () {
        Notifications.add("Signed out", 0, 2);
        AllTimeStats.clear();
        Settings.hideAccountSection();
        AccountButton.update();
        PageController.change("login");
        DB.setSnapshot(default_snapshot_1.defaultSnap);
        $(".pageLogin .button").removeClass("disabled");
    })
        .catch(function (error) {
        Notifications.add(error.message, -1);
    });
}
exports.signOut = signOut;
function signUp() {
    return __awaiter(this, void 0, void 0, function* () {
        $(".pageLogin .button").addClass("disabled");
        $(".pageLogin .preloader").removeClass("hidden");
        const nname = $(".pageLogin .register input")[0].value;
        const email = $(".pageLogin .register input")[1].value;
        const emailVerify = $(".pageLogin .register input")[2]
            .value;
        const password = $(".pageLogin .register input")[3]
            .value;
        const passwordVerify = $(".pageLogin .register input")[4].value;
        if (email !== emailVerify) {
            Notifications.add("Emails do not match", 0, 3);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
            return;
        }
        if (password !== passwordVerify) {
            Notifications.add("Passwords do not match", 0, 3);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
            return;
        }
        const response = yield ape_1.default.users.getNameAvailability(nname);
        if (response.status !== 200) {
            Notifications.add(response.message, -1);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
            return;
        }
        authListener();
        let createdAuthUser;
        try {
            createdAuthUser = yield (0, auth_1.createUserWithEmailAndPassword)(firebase_1.Auth, email, password);
            const signInResponse = yield ape_1.default.users.create(nname, email, createdAuthUser.user.uid);
            if (signInResponse.status !== 200) {
                throw signInResponse;
            }
            yield (0, auth_1.updateProfile)(createdAuthUser.user, { displayName: nname });
            yield (0, auth_1.sendEmailVerification)(createdAuthUser.user);
            AllTimeStats.clear();
            $("#menu .icon-button.account .text").text(nname);
            $(".pageLogin .button").removeClass("disabled");
            $(".pageLogin .preloader").addClass("hidden");
            yield loadUser(createdAuthUser.user);
            if (TestLogic.notSignedInLastResult !== null) {
                TestLogic.setNotSignedInUid(createdAuthUser.user.uid);
                const response = yield ape_1.default.results.save(TestLogic.notSignedInLastResult);
                if (response.status === 200) {
                    const result = TestLogic.notSignedInLastResult;
                    DB.saveLocalResult(result);
                    DB.updateLocalStats({
                        time: result.testDuration +
                            result.incompleteTestSeconds -
                            result.afkDuration,
                        started: 1,
                    });
                }
            }
            PageController.change("account");
            Notifications.add("Account created", 1, 3);
        }
        catch (e) {
            //make sure to do clean up here
            if (createdAuthUser) {
                yield ape_1.default.users.delete();
                yield createdAuthUser.user.delete();
            }
            console.log(e);
            const message = Misc.createErrorMessage(e, "Failed to create account");
            Notifications.add(message, -1);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
            signOut();
            return;
        }
    });
}
$(".pageLogin #forgotPasswordButton").on("click", () => {
    const emailField = $(".pageLogin .login input")[0].value || "";
    const email = prompt("Email address", emailField);
    if (email) {
        (0, auth_1.sendPasswordResetEmail)(firebase_1.Auth, email)
            .then(function () {
            // Email sent.
            Notifications.add("Email sent", 1, 2);
        })
            .catch(function (error) {
            // An error happened.
            Notifications.add(error.message, -1);
        });
    }
});
$(".pageLogin .login input").keyup((e) => {
    if (e.key === "Enter") {
        UpdateConfig.setChangedBeforeDb(false);
        signIn();
    }
});
$(".pageLogin .login .button.signIn").on("click", () => {
    UpdateConfig.setChangedBeforeDb(false);
    signIn();
});
$(".pageLogin .login .button.signInWithGoogle").on("click", () => {
    UpdateConfig.setChangedBeforeDb(false);
    signInWithGoogle();
});
// $(".pageLogin .login .button.signInWithGitHub").on("click",(e) => {
// UpdateConfig.setChangedBeforeDb(false);
// signInWithGitHub();
// });
$(".signOut").on("click", () => {
    signOut();
});
$(".pageLogin .register input").keyup((e) => {
    if ($(".pageLogin .register .button").hasClass("disabled"))
        return;
    if (e.key === "Enter") {
        signUp();
    }
});
$(".pageLogin .register .button").on("click", () => {
    if ($(".pageLogin .register .button").hasClass("disabled"))
        return;
    signUp();
});
$(".pageSettings #addGoogleAuth").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    addGoogleAuth();
}));
$(".pageSettings #removeGoogleAuth").on("click", () => {
    removeGoogleAuth();
});
$(document).on("click", ".pageAccount .sendVerificationEmail", () => {
    sendVerificationEmail();
});


/***/ }),

/***/ "./src/scripts/controllers/analytics-controller.ts":
/*!*********************************************************!*\
  !*** ./src/scripts/controllers/analytics-controller.ts ***!
  \*********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.log = void 0;
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const analytics_1 = __webpack_require__(/*! firebase/analytics */ "./node_modules/firebase/analytics/dist/index.esm.js");
function log(eventName, params) {
    return __awaiter(this, void 0, void 0, function* () {
        try {
            (0, analytics_1.logEvent)(firebase_1.Analytics, eventName, params);
        }
        catch (e) {
            console.log("Analytics unavailable");
        }
    });
}
exports.log = log;


/***/ }),

/***/ "./src/scripts/controllers/challenge-controller.ts":
/*!*********************************************************!*\
  !*** ./src/scripts/controllers/challenge-controller.ts ***!
  \*********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.setup = exports.verify = exports.clearActive = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
const Funbox = __importStar(__webpack_require__(/*! ../test/funbox */ "./src/scripts/test/funbox.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const TestState = __importStar(__webpack_require__(/*! ../test/test-state */ "./src/scripts/test/test-state.ts"));
let challengeLoading = false;
function clearActive() {
    if (TestState.activeChallenge &&
        !challengeLoading &&
        !TestUI.testRestarting) {
        Notifications.add("Challenge cleared", 0);
        TestState.setActiveChallenge(null);
    }
}
exports.clearActive = clearActive;
function verify(result) {
    try {
        if (TestState.activeChallenge) {
            const afk = (result.afkDuration / result.testDuration) * 100;
            if (afk > 10) {
                Notifications.add(`Challenge failed: AFK time is greater than 10%`, 0);
                return null;
            }
            if (!TestState.activeChallenge.requirements) {
                Notifications.add(`${TestState.activeChallenge.display} challenge passed!`, 1);
                return TestState.activeChallenge.name;
            }
            else {
                let requirementsMet = true;
                const failReasons = [];
                for (const requirementType in TestState.activeChallenge.requirements) {
                    if (requirementsMet == false)
                        return null;
                    const requirementValue = TestState.activeChallenge.requirements[requirementType];
                    if (requirementType == "wpm") {
                        const wpmMode = Object.keys(requirementValue)[0];
                        if (wpmMode == "exact") {
                            if (Math.round(result.wpm) != requirementValue["exact"]) {
                                requirementsMet = false;
                                failReasons.push(`WPM not ${requirementValue["exact"]}`);
                            }
                        }
                        else if (wpmMode == "min") {
                            if (result.wpm < requirementValue["min"]) {
                                requirementsMet = false;
                                failReasons.push(`WPM below ${requirementValue["min"]}`);
                            }
                        }
                    }
                    else if (requirementType == "acc") {
                        const accMode = Object.keys(requirementValue)[0];
                        if (accMode == "exact") {
                            if (result.acc != requirementValue["exact"]) {
                                requirementsMet = false;
                                failReasons.push(`Accuracy not ${requirementValue["exact"]}`);
                            }
                        }
                        else if (accMode == "min") {
                            if (result.acc < requirementValue["min"]) {
                                requirementsMet = false;
                                failReasons.push(`Accuracy below ${requirementValue["min"]}`);
                            }
                        }
                    }
                    else if (requirementType == "afk") {
                        const afkMode = Object.keys(requirementValue)[0];
                        if (afkMode == "max") {
                            if (Math.round(afk) > requirementValue["max"]) {
                                requirementsMet = false;
                                failReasons.push(`AFK percentage above ${requirementValue["max"]}`);
                            }
                        }
                    }
                    else if (requirementType == "time") {
                        const timeMode = Object.keys(requirementValue)[0];
                        if (timeMode == "min") {
                            if (Math.round(result.testDuration) < requirementValue["min"]) {
                                requirementsMet = false;
                                failReasons.push(`Test time below ${requirementValue["min"]}`);
                            }
                        }
                    }
                    else if (requirementType == "funbox") {
                        const funboxMode = requirementValue["exact"];
                        if (funboxMode != result.funbox) {
                            requirementsMet = false;
                            failReasons.push(`${funboxMode} funbox not active`);
                        }
                    }
                    else if (requirementType == "raw") {
                        const rawMode = Object.keys(requirementValue)[0];
                        if (rawMode == "exact") {
                            if (Math.round(result.rawWpm) != requirementValue["exact"]) {
                                requirementsMet = false;
                                failReasons.push(`Raw WPM not ${requirementValue["exact"]}`);
                            }
                        }
                    }
                    else if (requirementType == "con") {
                        const conMode = Object.keys(requirementValue)[0];
                        if (conMode == "exact") {
                            if (Math.round(result.consistency) != requirementValue["exact"]) {
                                requirementsMet = false;
                                failReasons.push(`Consistency not ${requirementValue["exact"]}`);
                            }
                        }
                    }
                    else if (requirementType == "config") {
                        for (const configKey in requirementValue) {
                            const configValue = requirementValue[configKey];
                            if (config_1.default[configKey] != configValue) {
                                requirementsMet = false;
                                failReasons.push(`${configKey} not set to ${configValue}`);
                            }
                        }
                    }
                }
                if (requirementsMet) {
                    if (TestState.activeChallenge.autoRole) {
                        Notifications.add("You will receive a role shortly. Please don't post a screenshot in challenge submissions.", 1, 5);
                    }
                    Notifications.add(`${TestState.activeChallenge.display} challenge passed!`, 1);
                    return TestState.activeChallenge.name;
                }
                else {
                    Notifications.add(`${TestState.activeChallenge.display} challenge failed: ${failReasons.join(", ")}`, 0);
                    return null;
                }
            }
        }
        else {
            return null;
        }
    }
    catch (e) {
        console.error(e);
        Notifications.add(`Something went wrong when verifying challenge: ${e.message}`, 0);
        return null;
    }
}
exports.verify = verify;
function setup(challengeName) {
    return __awaiter(this, void 0, void 0, function* () {
        challengeLoading = true;
        UpdateConfig.setFunbox("none");
        const list = yield Misc.getChallengeList();
        const challenge = list.filter((c) => c.name === challengeName)[0];
        let notitext;
        try {
            if (challenge === undefined) {
                Notifications.add("Challenge not found", 0);
                ManualRestart.set();
                setTimeout(() => {
                    $("#top .config").removeClass("hidden");
                    $(".page.pageTest").removeClass("hidden");
                }, 250);
                return false;
            }
            if (challenge.type === "customTime") {
                UpdateConfig.setTimeConfig(challenge.parameters[0], true);
                UpdateConfig.setMode("time", true);
                UpdateConfig.setDifficulty("normal", true);
                if (challenge.name === "englishMaster") {
                    UpdateConfig.setLanguage("english_10k", true);
                    UpdateConfig.setNumbers(true, true);
                    UpdateConfig.setPunctuation(true, true);
                }
            }
            else if (challenge.type === "customWords") {
                UpdateConfig.setWordCount(challenge.parameters[0], true);
                UpdateConfig.setMode("words", true);
                UpdateConfig.setDifficulty("normal", true);
            }
            else if (challenge.type === "customText") {
                CustomText.setText(challenge.parameters[0].split(" "));
                CustomText.setIsTimeRandom(false);
                CustomText.setIsWordRandom(challenge.parameters[1]);
                CustomText.setWord(challenge.parameters[2]);
                CustomText.setTime(-1);
                UpdateConfig.setMode("custom", true);
                UpdateConfig.setDifficulty("normal", true);
            }
            else if (challenge.type === "script") {
                const response = yield fetch("/challenges/" + challenge.parameters[0]);
                const scriptdata = yield response.text();
                let text = scriptdata.trim();
                text = text.replace(/[\n\r\t ]/gm, " ");
                text = text.replace(/ +/gm, " ");
                CustomText.setText(text.split(" "));
                CustomText.setIsWordRandom(false);
                UpdateConfig.setMode("custom", true);
                UpdateConfig.setDifficulty("normal", true);
                if (challenge.parameters[1] != null) {
                    UpdateConfig.setTheme(challenge.parameters[1]);
                }
                if (challenge.parameters[2] != null) {
                    Funbox.activate(challenge.parameters[2]);
                }
            }
            else if (challenge.type === "accuracy") {
                UpdateConfig.setTimeConfig(0, true);
                UpdateConfig.setMode("time", true);
                UpdateConfig.setDifficulty("master", true);
            }
            else if (challenge.type === "funbox") {
                UpdateConfig.setFunbox(challenge.parameters[0], true);
                UpdateConfig.setDifficulty("normal", true);
                if (challenge.parameters[1] === "words") {
                    UpdateConfig.setWordCount(challenge.parameters[2], true);
                }
                else if (challenge.parameters[1] === "time") {
                    UpdateConfig.setTimeConfig(challenge.parameters[2], true);
                }
                UpdateConfig.setMode(challenge.parameters[1], true);
                if (challenge.parameters[3] !== undefined) {
                    UpdateConfig.setDifficulty(challenge.parameters[3], true);
                }
            }
            else if (challenge.type === "special") {
                if (challenge.name === "semimak") {
                    // so can you make a link that sets up 120s, 10k, punct, stop on word, and semimak as the layout?
                    UpdateConfig.setMode("time", true);
                    UpdateConfig.setTimeConfig(120, true);
                    UpdateConfig.setLanguage("english_10k", true);
                    UpdateConfig.setPunctuation(true, true);
                    UpdateConfig.setStopOnError("word", true);
                    UpdateConfig.setLayout("semimak", true);
                    UpdateConfig.setKeymapLayout("overrideSync", true);
                    UpdateConfig.setKeymapMode("static", true);
                }
            }
            ManualRestart.set();
            notitext = challenge.message;
            $("#top .config").removeClass("hidden");
            $(".page.pageTest").removeClass("hidden");
            if (notitext === undefined) {
                Notifications.add(`Challenge '${challenge.display}' loaded.`, 0);
            }
            else {
                Notifications.add("Challenge loaded. " + notitext, 0);
            }
            TestState.setActiveChallenge(challenge);
            challengeLoading = false;
            return true;
        }
        catch (e) {
            Notifications.add("Something went wrong: " + e, -1);
            return false;
        }
    });
}
exports.setup = setup;
ConfigEvent.subscribe((eventKey) => {
    if ([
        "difficulty",
        "numbers",
        "punctuation",
        "mode",
        "funbox",
        "paceCaret",
        "showAllLines",
        "showLiveWpm",
        "highlightMode",
        "time",
        "words",
        "keymapMode",
        "keymapLayout",
        "layout",
    ].includes(eventKey)) {
        clearActive();
    }
});


/***/ }),

/***/ "./src/scripts/controllers/chart-controller.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/controllers/chart-controller.ts ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateAllChartColors = exports.setDefaultFontFamily = exports.updateColors = exports.miniResult = exports.accountActivity = exports.accountHistory = exports.accountHistoryActiveIndex = exports.result = void 0;
const chart_js_1 = __webpack_require__(/*! chart.js */ "./node_modules/chart.js/dist/chart.esm.js");
const chartjs_plugin_trendline_1 = __importDefault(__webpack_require__(/*! chartjs-plugin-trendline */ "./node_modules/chartjs-plugin-trendline/src/chartjs-plugin-trendline.js"));
const chartjs_plugin_annotation_1 = __importDefault(__webpack_require__(/*! chartjs-plugin-annotation */ "./node_modules/chartjs-plugin-annotation/dist/chartjs-plugin-annotation.esm.js"));
chart_js_1.Chart.register(chart_js_1.BarController, chart_js_1.BarElement, chart_js_1.CategoryScale, chart_js_1.Filler, chart_js_1.LinearScale, chart_js_1.LineController, chart_js_1.LineElement, chart_js_1.PointElement, chart_js_1.ScatterController, chart_js_1.TimeScale, chart_js_1.TimeSeriesScale, chart_js_1.Tooltip, chartjs_plugin_trendline_1.default, chartjs_plugin_annotation_1.default);
chart_js_1.Chart.defaults.animation.duration = 0;
chart_js_1.Chart.defaults.elements.line.tension = 0.3;
chart_js_1.Chart.defaults.elements.line.fill = "origin";
const TestInput = __importStar(__webpack_require__(/*! ../test/test-input */ "./src/scripts/test/test-input.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
__webpack_require__(/*! chartjs-adapter-date-fns */ "./node_modules/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.esm.js");
class ChartWithUpdateColors extends chart_js_1.Chart {
    constructor(item, config) {
        super(item, config);
    }
    updateColors() {
        updateColors(this);
    }
}
exports.result = new ChartWithUpdateColors($("#wpmChart"), {
    type: "line",
    data: {
        labels: [],
        datasets: [
            {
                label: "wpm",
                data: [],
                borderColor: "rgba(125, 125, 125, 1)",
                borderWidth: 2,
                yAxisID: "wpm",
                order: 2,
                pointRadius: 2,
            },
            {
                label: "raw",
                data: [],
                borderColor: "rgba(125, 125, 125, 1)",
                borderWidth: 2,
                yAxisID: "raw",
                order: 3,
                pointRadius: 2,
            },
            {
                label: "errors",
                data: [],
                borderColor: "rgba(255, 125, 125, 1)",
                pointBackgroundColor: "rgba(255, 125, 125, 1)",
                borderWidth: 2,
                order: 1,
                yAxisID: "error",
                type: "scatter",
                pointStyle: "crossRot",
                pointRadius: function (context) {
                    const index = context.dataIndex;
                    const value = context.dataset.data[index];
                    return (value !== null && value !== void 0 ? value : 0) <= 0 ? 0 : 3;
                },
                pointHoverRadius: function (context) {
                    const index = context.dataIndex;
                    const value = context.dataset.data[index];
                    return (value !== null && value !== void 0 ? value : 0) <= 0 ? 0 : 5;
                },
            },
        ],
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            x: {
                axis: "x",
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                display: true,
                title: {
                    display: false,
                    text: "Seconds",
                },
            },
            wpm: {
                axis: "y",
                display: true,
                title: {
                    display: true,
                    text: "Words per Minute",
                },
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: true,
                },
            },
            raw: {
                axis: "y",
                display: false,
                title: {
                    display: true,
                    text: "Raw Words per Minute",
                },
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: false,
                },
            },
            error: {
                axis: "y",
                display: true,
                position: "right",
                title: {
                    display: true,
                    text: "Errors",
                },
                beginAtZero: true,
                ticks: {
                    precision: 0,
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: false,
                },
            },
        },
        plugins: {
            annotation: {
                annotations: [],
            },
            tooltip: {
                animation: { duration: 250 },
                mode: "index",
                intersect: false,
                callbacks: {
                    afterLabel: function (ti) {
                        try {
                            $(".wordInputAfter").remove();
                            const wordsToHighlight = TestInput.keypressPerSecond[parseInt(ti.label) - 1].words;
                            const unique = [...new Set(wordsToHighlight)];
                            unique.forEach((wordIndex) => {
                                const wordEl = $($("#resultWordsHistory .words .word")[wordIndex]);
                                const input = wordEl.attr("input");
                                if (input != undefined) {
                                    wordEl.append(`<div class="wordInputAfter">${input
                                        .replace(/\t/g, "_")
                                        .replace(/\n/g, "_")
                                        .replace(/</g, "&lt")
                                        .replace(/>/g, "&gt")}</div>`);
                                }
                            });
                        }
                        catch (_a) { }
                        return "";
                    },
                },
            },
        },
    },
});
exports.accountHistory = new ChartWithUpdateColors($(".pageAccount #accountHistoryChart"), {
    type: "line",
    data: {
        labels: [],
        datasets: [
            {
                yAxisID: "wpm",
                label: "wpm",
                fill: false,
                data: [],
                borderColor: "#f44336",
                borderWidth: 2,
                trendlineLinear: {
                    style: "rgba(255,105,180, .8)",
                    lineStyle: "dotted",
                    width: 4,
                },
            },
            {
                yAxisID: "acc",
                label: "acc",
                fill: false,
                data: [],
                borderColor: "#cccccc",
                borderWidth: 2,
            },
        ],
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        hover: {
            mode: "nearest",
            intersect: false,
        },
        scales: {
            x: {
                axis: "x",
                type: "timeseries",
                bounds: "ticks",
                display: false,
                offset: true,
                title: {
                    display: false,
                    text: "Date",
                },
            },
            wpm: {
                axis: "y",
                beginAtZero: true,
                min: 0,
                ticks: {
                    stepSize: 10,
                },
                display: true,
                title: {
                    display: true,
                    text: "Words per Minute",
                },
            },
            acc: {
                axis: "y",
                beginAtZero: true,
                max: 100,
                display: true,
                position: "right",
                title: {
                    display: true,
                    text: "Error rate (100 - accuracy)",
                },
                grid: {
                    display: false,
                },
            },
        },
        plugins: {
            annotation: {
                annotations: [],
            },
            tooltip: {
                animation: { duration: 250 },
                // Disable the on-canvas tooltip
                enabled: true,
                intersect: false,
                external: function (ctx) {
                    if (!ctx)
                        return;
                    ctx.tooltip.options.displayColors = false;
                },
                callbacks: {
                    title: function () {
                        return "";
                    },
                    beforeLabel: function (tooltipItem) {
                        if (tooltipItem.datasetIndex !== 0) {
                            const resultData = tooltipItem.dataset.data[tooltipItem.dataIndex];
                            return `error rate: ${Misc.roundTo2(resultData.errorRate)}%\nacc: ${Misc.roundTo2(100 - resultData.errorRate)}%`;
                        }
                        const resultData = tooltipItem.dataset.data[tooltipItem.dataIndex];
                        let label = `${config_1.default.alwaysShowCPM ? "cpm" : "wpm"}: ${resultData.wpm}` +
                            "\n" +
                            `raw: ${resultData.raw}` +
                            "\n" +
                            `acc: ${resultData.acc}` +
                            "\n\n" +
                            `mode: ${resultData.mode} `;
                        if (resultData.mode == "time") {
                            label += resultData.mode2;
                        }
                        else if (resultData.mode == "words") {
                            label += resultData.mode2;
                        }
                        let diff = resultData.difficulty;
                        if (diff == undefined) {
                            diff = "normal";
                        }
                        label += "\n" + `difficulty: ${diff}`;
                        label +=
                            "\n" +
                                `punctuation: ${resultData.punctuation}` +
                                "\n" +
                                `language: ${resultData.language}` +
                                "\n\n" +
                                `date: ${(0, format_1.default)(new Date(resultData.timestamp), "dd MMM yyyy HH:mm")}`;
                        return label;
                    },
                    label: function () {
                        return "";
                    },
                    afterLabel: function (tooltip) {
                        exports.accountHistoryActiveIndex = tooltip.dataIndex;
                        return "";
                    },
                },
            },
        },
    },
});
exports.accountActivity = new ChartWithUpdateColors($(".pageAccount #accountActivityChart"), {
    type: "bar",
    data: {
        labels: [],
        datasets: [
            {
                yAxisID: "count",
                label: "Seconds",
                data: [],
                trendlineLinear: {
                    style: "rgba(255,105,180, .8)",
                    lineStyle: "dotted",
                    width: 2,
                },
                order: 3,
            },
            {
                yAxisID: "avgWpm",
                label: "Average Wpm",
                data: [],
                type: "line",
                order: 2,
                tension: 0,
                fill: false,
            },
        ],
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        hover: {
            mode: "nearest",
            intersect: false,
        },
        scales: {
            x: {
                axis: "x",
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                type: "time",
                time: {
                    unit: "day",
                    displayFormats: {
                        day: "d MMM",
                    },
                },
                bounds: "ticks",
                display: true,
                title: {
                    display: false,
                    text: "Date",
                },
                offset: true,
            },
            count: {
                axis: "y",
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                    stepSize: 10,
                },
                display: true,
                title: {
                    display: true,
                    text: "Time Typing",
                },
            },
            avgWpm: {
                axis: "y",
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                    stepSize: 10,
                },
                display: true,
                position: "right",
                title: {
                    display: true,
                    text: "Average Wpm",
                },
                grid: {
                    display: false,
                },
            },
        },
        plugins: {
            annotation: {
                annotations: [],
            },
            tooltip: {
                animation: { duration: 250 },
                callbacks: {
                    title: function (tooltipItem) {
                        const resultData = tooltipItem[0].dataset.data[tooltipItem[0].dataIndex];
                        return (0, format_1.default)(new Date(resultData.x), "dd MMM yyyy");
                    },
                    beforeLabel: function (tooltipItem) {
                        const resultData = tooltipItem.dataset.data[tooltipItem.dataIndex];
                        switch (tooltipItem.datasetIndex) {
                            case 0:
                                return `Time Typing: ${Misc.secondsToString(Math.round(resultData.y), true, true)}\nTests Completed: ${resultData.amount}`;
                            case 1:
                                return `Average ${config_1.default.alwaysShowCPM ? "Cpm" : "Wpm"}: ${Misc.roundTo2(resultData.y)}`;
                            default:
                                return "";
                        }
                    },
                    label: function () {
                        return "";
                    },
                },
            },
        },
    },
});
exports.miniResult = new ChartWithUpdateColors($(".pageAccount #miniResultChart"), {
    type: "line",
    data: {
        labels: [],
        datasets: [
            {
                label: "wpm",
                data: [],
                borderColor: "rgba(125, 125, 125, 1)",
                borderWidth: 2,
                yAxisID: "wpm",
                order: 2,
                pointRadius: 2,
            },
            {
                label: "raw",
                data: [],
                borderColor: "rgba(125, 125, 125, 1)",
                borderWidth: 2,
                yAxisID: "raw",
                order: 3,
                pointRadius: 2,
            },
            {
                label: "errors",
                data: [],
                borderColor: "rgba(255, 125, 125, 1)",
                pointBackgroundColor: "rgba(255, 125, 125, 1)",
                borderWidth: 2,
                order: 1,
                yAxisID: "error",
                type: "scatter",
                pointStyle: "crossRot",
                pointRadius: function (context) {
                    const index = context.dataIndex;
                    const value = context.dataset.data[index];
                    return (value !== null && value !== void 0 ? value : 0) <= 0 ? 0 : 3;
                },
                pointHoverRadius: function (context) {
                    const index = context.dataIndex;
                    const value = context.dataset.data[index];
                    return (value !== null && value !== void 0 ? value : 0) <= 0 ? 0 : 5;
                },
            },
        ],
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            x: {
                axis: "x",
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                display: true,
                title: {
                    display: false,
                    text: "Seconds",
                },
            },
            wpm: {
                axis: "y",
                display: true,
                title: {
                    display: true,
                    text: "Words per Minute",
                },
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: true,
                },
            },
            raw: {
                axis: "y",
                display: false,
                title: {
                    display: true,
                    text: "Raw Words per Minute",
                },
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: false,
                },
            },
            error: {
                display: true,
                position: "right",
                title: {
                    display: true,
                    text: "Errors",
                },
                beginAtZero: true,
                ticks: {
                    precision: 0,
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: false,
                },
            },
        },
        plugins: {
            annotation: {
                annotations: [],
            },
            tooltip: {
                animation: { duration: 250 },
                mode: "index",
                intersect: false,
            },
        },
    },
});
function updateAccuracy() {
    exports.accountHistory.data.datasets[1].hidden = !config_1.default.chartAccuracy;
    exports.accountHistory.options.scales.acc.display =
        config_1.default.chartAccuracy;
    exports.accountHistory.update();
}
function updateStyle() {
    if (config_1.default.chartStyle == "scatter") {
        exports.accountHistory.data.datasets[0].showLine = false;
        exports.accountHistory.data.datasets[1].showLine = false;
    }
    else {
        exports.accountHistory.data.datasets[0].showLine = true;
        exports.accountHistory.data.datasets[1].showLine = true;
    }
    exports.accountHistory.updateColors();
}
function updateColors(chart) {
    return __awaiter(this, void 0, void 0, function* () {
        const bgcolor = yield ThemeColors.get("bg");
        const subcolor = yield ThemeColors.get("sub");
        const maincolor = yield ThemeColors.get("main");
        const errorcolor = yield ThemeColors.get("error");
        if (chart.data.datasets.every((dataset) => dataset.data.length === 0)) {
            return;
        }
        chart.data.datasets[0].borderColor = maincolor;
        chart.data.datasets[1].borderColor = subcolor;
        if (chart.data.datasets[2]) {
            chart.data.datasets[2].borderColor = errorcolor;
        }
        if (chart.data.datasets[0].type === undefined) {
            if (chart.config.type === "line") {
                chart.data.datasets[0].pointBackgroundColor = maincolor;
            }
            else if (chart.config.type === "bar") {
                chart.data.datasets[0].backgroundColor = maincolor;
            }
        }
        else if (chart.data.datasets[0].type === "bar") {
            chart.data.datasets[0].backgroundColor = maincolor;
        }
        else if (chart.data.datasets[0].type === "line") {
            chart.data.datasets[0].pointBackgroundColor = maincolor;
        }
        if (chart.data.datasets[1].type === undefined) {
            if (chart.config.type === "line") {
                chart.data.datasets[1].pointBackgroundColor = subcolor;
            }
            else if (chart.config.type === "bar") {
                chart.data.datasets[1].backgroundColor = subcolor;
            }
        }
        else if (chart.data.datasets[1].type === "bar") {
            chart.data.datasets[1].backgroundColor = subcolor;
        }
        else if (chart.data.datasets[1].type === "line") {
            chart.data.datasets[1].pointBackgroundColor = subcolor;
        }
        const chartScaleOptions = chart.options;
        Object.keys(chartScaleOptions.scales).forEach((scaleID) => {
            const axis = chartScaleOptions.scales[scaleID];
            axis.ticks.color = subcolor;
            axis.title.color = subcolor;
        });
        try {
            chart.data.datasets[0]
                .trendlineLinear.style = subcolor;
            chart.data.datasets[1]
                .trendlineLinear.style = subcolor;
        }
        catch (_a) { }
        chart.options.plugins.annotation
            .annotations.forEach((annotation) => {
            if (annotation.id !== "funbox-label") {
                annotation.borderColor = subcolor;
            }
            annotation.label.backgroundColor = subcolor;
            annotation.label.color = bgcolor;
        });
        chart.update("none");
    });
}
exports.updateColors = updateColors;
function setDefaultFontFamily(font) {
    chart_js_1.Chart.defaults.font.family = font.replace(/_/g, " ");
}
exports.setDefaultFontFamily = setDefaultFontFamily;
function updateAllChartColors() {
    ThemeColors.update();
    exports.accountHistory.updateColors();
    exports.result.updateColors();
    exports.accountActivity.updateColors();
    exports.miniResult.updateColors();
}
exports.updateAllChartColors = updateAllChartColors;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "chartAccuracy")
        updateAccuracy();
    if (eventKey === "chartStyle")
        updateStyle();
    if (eventKey === "fontFamily")
        setDefaultFontFamily(eventValue);
});


/***/ }),

/***/ "./src/scripts/controllers/input-controller.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/controllers/input-controller.ts ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const TestStats = __importStar(__webpack_require__(/*! ../test/test-stats */ "./src/scripts/test/test-stats.ts"));
const Monkey = __importStar(__webpack_require__(/*! ../test/monkey */ "./src/scripts/test/monkey.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Keymap = __importStar(__webpack_require__(/*! ../elements/keymap */ "./src/scripts/elements/keymap.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const LiveAcc = __importStar(__webpack_require__(/*! ../test/live-acc */ "./src/scripts/test/live-acc.ts"));
const LiveBurst = __importStar(__webpack_require__(/*! ../test/live-burst */ "./src/scripts/test/live-burst.ts"));
const Funbox = __importStar(__webpack_require__(/*! ../test/funbox */ "./src/scripts/test/funbox.ts"));
const Sound = __importStar(__webpack_require__(/*! ./sound-controller */ "./src/scripts/controllers/sound-controller.ts"));
const Caret = __importStar(__webpack_require__(/*! ../test/caret */ "./src/scripts/test/caret.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
const PageController = __importStar(__webpack_require__(/*! ./page-controller */ "./src/scripts/controllers/page-controller.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const LayoutEmulator = __importStar(__webpack_require__(/*! ../test/layout-emulator */ "./src/scripts/test/layout-emulator.ts"));
const PaceCaret = __importStar(__webpack_require__(/*! ../test/pace-caret */ "./src/scripts/test/pace-caret.ts"));
const TimerProgress = __importStar(__webpack_require__(/*! ../test/timer-progress */ "./src/scripts/test/timer-progress.ts"));
const Focus = __importStar(__webpack_require__(/*! ../test/focus */ "./src/scripts/test/focus.ts"));
const ShiftTracker = __importStar(__webpack_require__(/*! ../test/shift-tracker */ "./src/scripts/test/shift-tracker.ts"));
const Replay = __importStar(__webpack_require__(/*! ../test/replay */ "./src/scripts/test/replay.ts"));
const MonkeyPower = __importStar(__webpack_require__(/*! ../elements/monkey-power */ "./src/scripts/elements/monkey-power.ts"));
const WeakSpot = __importStar(__webpack_require__(/*! ../test/weak-spot */ "./src/scripts/test/weak-spot.ts"));
const Leaderboards = __importStar(__webpack_require__(/*! ../elements/leaderboards */ "./src/scripts/elements/leaderboards.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const TestInput = __importStar(__webpack_require__(/*! ../test/test-input */ "./src/scripts/test/test-input.ts"));
const TestWords = __importStar(__webpack_require__(/*! ../test/test-words */ "./src/scripts/test/test-words.ts"));
const WordTypedEvent = __importStar(__webpack_require__(/*! ../observables/word-typed-event */ "./src/scripts/observables/word-typed-event.ts"));
let dontInsertSpace = false;
let correctShiftUsed = true;
const wordsInput = document.getElementById("wordsInput");
function setWordsInput(value) {
    // Only change #wordsInput if it's not already the wanted value
    // Avoids Safari triggering unneeded events, causing issues with
    // dead keys.
    // console.log("settings words input to " + value);
    if (value !== wordsInput.value) {
        wordsInput.value = value;
    }
}
function updateUI() {
    const acc = Misc.roundTo2(TestStats.calculateAccuracy());
    if (!isNaN(acc))
        LiveAcc.update(acc);
    if (config_1.default.keymapMode === "next" && config_1.default.mode !== "zen") {
        Keymap.highlightKey(TestWords.words
            .getCurrent()
            .charAt(TestInput.input.current.length)
            .toString()
            .toUpperCase());
    }
}
function backspaceToPrevious() {
    if (!TestActive.get())
        return;
    if (TestInput.input.history.length == 0 ||
        TestUI.currentWordElementIndex == 0) {
        return;
    }
    if ((TestInput.input.history[TestWords.words.currentIndex - 1] ==
        TestWords.words.get(TestWords.words.currentIndex - 1) &&
        !config_1.default.freedomMode) ||
        $($(".word")[TestWords.words.currentIndex - 1]).hasClass("hidden")) {
        return;
    }
    if (config_1.default.confidenceMode === "on" || config_1.default.confidenceMode === "max") {
        return;
    }
    TestInput.input.current = TestInput.input.popHistory();
    TestInput.corrected.popHistory();
    if (config_1.default.funbox === "nospace" || config_1.default.funbox === "arrows") {
        TestInput.input.current = TestInput.input.current.slice(0, -1);
    }
    TestWords.words.decreaseCurrentIndex();
    TestUI.setCurrentWordElementIndex(TestUI.currentWordElementIndex - 1);
    TestUI.updateActiveElement(true);
    Funbox.toggleScript(TestWords.words.getCurrent());
    TestUI.updateWordElement();
    Caret.updatePosition();
    Replay.addReplayEvent("backWord");
}
function handleSpace() {
    var _a;
    if (!TestActive.get())
        return;
    if (TestInput.input.current === "")
        return;
    if (config_1.default.mode == "zen") {
        $("#words .word.active").removeClass("active");
        $("#words").append("<div class='word active'></div>");
    }
    const currentWord = TestWords.words.getCurrent();
    if (config_1.default.funbox === "layoutfluid" && config_1.default.mode !== "time") {
        // here I need to check if Config.customLayoutFluid exists because of my scuffed solution of returning whenever value is undefined in the setCustomLayoutfluid function
        const layouts = config_1.default.customLayoutfluid
            ? config_1.default.customLayoutfluid.split("#")
            : ["qwerty", "dvorak", "colemak"];
        let index = 0;
        const outof = TestWords.words.length;
        index = Math.floor((TestInput.input.history.length + 1) / (outof / layouts.length));
        if (config_1.default.layout !== layouts[index] && layouts[index] !== undefined) {
            Notifications.add(`--- !!! ${layouts[index]} !!! ---`, 0);
        }
        UpdateConfig.setLayout(layouts[index]);
        UpdateConfig.setKeymapLayout(layouts[index]);
        Keymap.highlightKey(TestWords.words
            .getCurrent()
            .charAt(TestInput.input.current.length)
            .toString()
            .toUpperCase());
        (_a = Settings.groups["layout"]) === null || _a === void 0 ? void 0 : _a.updateInput();
    }
    dontInsertSpace = true;
    const burst = TestStats.calculateBurst();
    LiveBurst.update(Math.round(burst));
    TestInput.pushBurstToHistory(burst);
    //correct word or in zen mode
    const isWordCorrect = currentWord == TestInput.input.current || config_1.default.mode == "zen";
    // This will probably break if letter mode is on or something
    const $currentTestWord = $(`#words .word.active`);
    WordTypedEvent.dispatch(currentWord, isWordCorrect, burst, $currentTestWord);
    MonkeyPower.addPower(isWordCorrect, true);
    TestInput.incrementAccuracy(isWordCorrect);
    if (isWordCorrect) {
        PaceCaret.handleSpace(true, currentWord);
        TestInput.input.pushHistory();
        TestWords.words.increaseCurrentIndex();
        TestUI.setCurrentWordElementIndex(TestUI.currentWordElementIndex + 1);
        TestUI.updateActiveElement();
        Funbox.toggleScript(TestWords.words.getCurrent());
        Caret.updatePosition();
        TestInput.incrementKeypressCount();
        TestInput.pushKeypressWord(TestWords.words.currentIndex);
        if (config_1.default.funbox !== "nospace" && config_1.default.funbox !== "arrows") {
            Sound.playClick();
        }
        Replay.addReplayEvent("submitCorrectWord");
    }
    else {
        if (config_1.default.funbox !== "nospace" && config_1.default.funbox !== "arrows") {
            if (!config_1.default.playSoundOnError || config_1.default.blindMode) {
                Sound.playClick();
            }
            else {
                Sound.playError();
            }
        }
        TestInput.pushMissedWord(TestWords.words.getCurrent());
        TestInput.incrementKeypressErrors();
        const cil = TestInput.input.current.length;
        if (cil <= TestWords.words.getCurrent().length) {
            if (cil >= TestInput.corrected.current.length) {
                TestInput.corrected.current += "_";
            }
            else {
                TestInput.corrected.current =
                    TestInput.corrected.current.substring(0, cil) +
                        "_" +
                        TestInput.corrected.current.substring(cil + 1);
            }
        }
        if (config_1.default.stopOnError != "off") {
            if (config_1.default.difficulty == "expert" || config_1.default.difficulty == "master") {
                //failed due to diff when pressing space
                TestLogic.fail("difficulty");
                return;
            }
            if (config_1.default.stopOnError == "word") {
                dontInsertSpace = false;
                Replay.addReplayEvent("incorrectLetter", "_");
                TestUI.updateWordElement(true);
                Caret.updatePosition();
            }
            return;
        }
        PaceCaret.handleSpace(false, currentWord);
        if (config_1.default.blindMode && config_1.default.highlightMode !== "off") {
            $("#words .word.active letter").addClass("correct");
        }
        TestInput.input.pushHistory();
        TestUI.highlightBadWord(TestUI.currentWordElementIndex, !config_1.default.blindMode);
        TestWords.words.increaseCurrentIndex();
        TestUI.setCurrentWordElementIndex(TestUI.currentWordElementIndex + 1);
        TestUI.updateActiveElement();
        Funbox.toggleScript(TestWords.words.getCurrent());
        Caret.updatePosition();
        TestInput.incrementKeypressCount();
        TestInput.pushKeypressWord(TestWords.words.currentIndex);
        TestInput.updateLastKeypress();
        if (config_1.default.difficulty == "expert" || config_1.default.difficulty == "master") {
            TestLogic.fail("difficulty");
            return;
        }
        else if (TestWords.words.currentIndex == TestWords.words.length) {
            //submitted last word that is incorrect
            TestLogic.finish();
            return;
        }
        Replay.addReplayEvent("submitErrorWord");
    }
    let wordLength;
    if (config_1.default.mode === "zen") {
        wordLength = TestInput.input.current.length;
    }
    else {
        wordLength = TestWords.words.getCurrent().length;
    }
    const flex = Misc.whorf(config_1.default.minBurstCustomSpeed, wordLength);
    if ((config_1.default.minBurst === "fixed" && burst < config_1.default.minBurstCustomSpeed) ||
        (config_1.default.minBurst === "flex" && burst < flex)) {
        TestLogic.fail("min burst");
        return;
    }
    TestInput.corrected.pushHistory();
    if (!config_1.default.showAllLines ||
        config_1.default.mode == "time" ||
        (CustomText.isWordRandom && CustomText.word == 0) ||
        CustomText.isTimeRandom) {
        const currentTop = Math.floor(document.querySelectorAll("#words .word")[TestUI.currentWordElementIndex - 1].offsetTop);
        let nextTop;
        try {
            nextTop = Math.floor(document.querySelectorAll("#words .word")[TestUI.currentWordElementIndex].offsetTop);
        }
        catch (e) {
            nextTop = 0;
        }
        if (nextTop > currentTop && !TestUI.lineTransition) {
            TestUI.lineJump(currentTop);
        }
    } //end of line wrap
    if (config_1.default.keymapMode === "react") {
        Keymap.flashKey(" ", true);
    }
    if (config_1.default.mode === "words" ||
        config_1.default.mode === "custom" ||
        config_1.default.mode === "quote" ||
        config_1.default.mode === "zen") {
        TimerProgress.update();
    }
    if (config_1.default.mode == "time" ||
        config_1.default.mode == "words" ||
        config_1.default.mode == "custom" ||
        config_1.default.mode == "quote") {
        TestLogic.addWord();
    }
}
function isCharCorrect(char, charIndex) {
    if (!correctShiftUsed)
        return false;
    if (config_1.default.mode == "zen") {
        return true;
    }
    const originalChar = TestWords.words.getCurrent()[charIndex];
    if (originalChar == char) {
        return true;
    }
    if (config_1.default.language.split("_")[0] == "russian") {
        if ((char === "" || char === "e") && originalChar == "") {
            return true;
        }
        if (char === "" && (originalChar == "" || originalChar === "e")) {
            return true;
        }
    }
    if (config_1.default.funbox === "arrows") {
        if ((char === "w" || char === "ArrowUp") && originalChar == "") {
            return true;
        }
        if ((char === "s" || char === "ArrowDown") && originalChar == "") {
            return true;
        }
        if ((char === "a" || char === "ArrowLeft") && originalChar == "") {
            return true;
        }
        if ((char === "d" || char === "ArrowRight") && originalChar == "") {
            return true;
        }
    }
    if ((char === `` || char === "" || char === "'") &&
        (originalChar == `` || originalChar === "" || originalChar === "'")) {
        return true;
    }
    if ((char === `"` || char === "" || char == "" || char === "") &&
        (originalChar == `"` ||
            originalChar === "" ||
            originalChar === "" ||
            originalChar === "")) {
        return true;
    }
    if ((char === "" || char === "" || char == "-") &&
        (originalChar == "-" || originalChar === "" || originalChar === "")) {
        return true;
    }
    return false;
}
function handleChar(char, charIndex) {
    var _a, _b, _c, _d;
    if (TestUI.resultCalculating || TestUI.resultVisible) {
        return;
    }
    if (char === "") {
        for (let i = 0; i < 3; i++) {
            handleChar(".", charIndex + i);
        }
        return;
    }
    if (char === "\n" && config_1.default.funbox === "58008") {
        char = " ";
    }
    if (char !== "\n" && char !== "\t" && /\s/.test(char)) {
        if (config_1.default.funbox === "nospace" || config_1.default.funbox === "arrows")
            return;
        handleSpace();
        //insert space for expert and master or strict space,
        //or for stop on error set to word,
        //otherwise dont do anything
        if (config_1.default.difficulty !== "normal" ||
            (config_1.default.strictSpace && config_1.default.mode !== "zen") ||
            config_1.default.stopOnError === "word") {
            if (dontInsertSpace) {
                dontInsertSpace = false;
                return;
            }
        }
        else {
            return;
        }
    }
    if (config_1.default.mode !== "zen" &&
        TestWords.words.getCurrent()[charIndex] !== "\n" &&
        char === "\n") {
        return;
    }
    //start the test
    if (!TestActive.get() && !TestLogic.startTest()) {
        return;
    }
    Focus.set(true);
    Caret.stopAnimation();
    const thisCharCorrect = isCharCorrect(char, charIndex);
    if (thisCharCorrect && config_1.default.mode !== "zen") {
        char = TestWords.words.getCurrent().charAt(charIndex);
    }
    if (!thisCharCorrect && char === "\n") {
        if (TestInput.input.current === "")
            return;
        char = " ";
    }
    if (TestInput.input.current === "") {
        TestInput.setBurstStart(performance.now());
    }
    const resultingWord = TestInput.input.current.substring(0, charIndex) +
        char +
        TestInput.input.current.substring(charIndex + 1);
    if (!thisCharCorrect && Misc.trailingComposeChars.test(resultingWord)) {
        TestInput.input.current = resultingWord;
        TestUI.updateWordElement();
        Caret.updatePosition();
        return;
    }
    MonkeyPower.addPower(thisCharCorrect);
    TestInput.incrementAccuracy(thisCharCorrect);
    if (!thisCharCorrect) {
        TestInput.incrementKeypressErrors();
        TestInput.pushMissedWord(TestWords.words.getCurrent());
    }
    WeakSpot.updateScore(config_1.default.mode === "zen" ? char : TestWords.words.getCurrent()[charIndex], thisCharCorrect);
    if (thisCharCorrect) {
        Sound.playClick();
    }
    else {
        if (!config_1.default.playSoundOnError || config_1.default.blindMode) {
            Sound.playClick();
        }
        else {
            Sound.playError();
        }
    }
    if (!correctShiftUsed && config_1.default.difficulty != "master")
        return;
    //update current corrected version. if its empty then add the current char. if its not then replace the last character with the currently pressed one / add it
    if (TestInput.corrected.current === "") {
        TestInput.corrected.current += resultingWord;
    }
    else {
        if (charIndex >= TestInput.corrected.current.length) {
            TestInput.corrected.current += char;
        }
        else if (!thisCharCorrect) {
            TestInput.corrected.current =
                TestInput.corrected.current.substring(0, charIndex) +
                    char +
                    TestInput.corrected.current.substring(charIndex + 1);
        }
    }
    TestInput.incrementKeypressCount();
    TestInput.updateLastKeypress();
    TestInput.pushKeypressWord(TestWords.words.currentIndex);
    if (config_1.default.difficulty !== "master" &&
        config_1.default.stopOnError == "letter" &&
        !thisCharCorrect) {
        return;
    }
    Replay.addReplayEvent(thisCharCorrect ? "correctLetter" : "incorrectLetter", char);
    //update the active word top, but only once
    if (TestInput.input.current.length === 1 &&
        TestWords.words.currentIndex === 0) {
        TestUI.setActiveWordTop((_a = document.querySelector("#words .active")) === null || _a === void 0 ? void 0 : _a.offsetTop);
    }
    //max length of the input is 20 unless in zen mode then its 30
    if ((config_1.default.mode === "zen" && charIndex < 30) ||
        (config_1.default.mode !== "zen" &&
            charIndex < TestWords.words.getCurrent().length + 20)) {
        TestInput.input.current = resultingWord;
    }
    if (!thisCharCorrect && config_1.default.difficulty == "master") {
        TestInput.input.pushHistory();
        TestInput.corrected.pushHistory();
        TestLogic.fail("difficulty");
        return;
    }
    //keymap
    if (config_1.default.keymapMode === "react") {
        Keymap.flashKey(char, thisCharCorrect);
    }
    if (config_1.default.mode != "zen") {
        //not applicable to zen mode
        //auto stop the test if the last word is correct
        const currentWord = TestWords.words.getCurrent();
        const lastindex = TestWords.words.currentIndex;
        if ((currentWord == TestInput.input.current ||
            (config_1.default.quickEnd &&
                currentWord.length == TestInput.input.current.length &&
                config_1.default.stopOnError == "off")) &&
            lastindex == TestWords.words.length - 1) {
            TestInput.input.pushHistory();
            TestInput.corrected.pushHistory();
            TestLogic.finish();
            return;
        }
    }
    const activeWordTopBeforeJump = (_b = document.querySelector("#words .word.active")) === null || _b === void 0 ? void 0 : _b.offsetTop;
    TestUI.updateWordElement();
    if (!config_1.default.hideExtraLetters) {
        const newActiveTop = (_c = document.querySelector("#words .word.active")) === null || _c === void 0 ? void 0 : _c.offsetTop;
        //stop the word jump by slicing off the last character, update word again
        if (activeWordTopBeforeJump < newActiveTop &&
            !TestUI.lineTransition &&
            TestInput.input.current.length > 1) {
            if (config_1.default.mode == "zen") {
                const currentTop = Math.floor((_d = document.querySelectorAll("#words .word")[TestUI.currentWordElementIndex - 1]) === null || _d === void 0 ? void 0 : _d.offsetTop);
                if (!config_1.default.showAllLines)
                    TestUI.lineJump(currentTop);
            }
            else {
                TestInput.input.current = TestInput.input.current.slice(0, -1);
                TestUI.updateWordElement();
            }
        }
    }
    //simulate space press in nospace funbox
    if (((config_1.default.funbox === "nospace" || config_1.default.funbox === "arrows") &&
        TestInput.input.current.length === TestWords.words.getCurrent().length) ||
        (char === "\n" && thisCharCorrect)) {
        handleSpace();
    }
    if (char !== "\n") {
        Caret.updatePosition();
    }
}
function handleTab(event, popupVisible) {
    //todo refactor this mess
    if (TestUI.resultCalculating) {
        event.preventDefault();
    }
    if (ActivePage.get() !== "test" && popupVisible) {
        // event.preventDefault();
        return;
    }
    if ($("#customTextPopup .textarea").is(":focus")) {
        event.preventDefault();
        const area = $("#customTextPopup .textarea")[0];
        const start = area.selectionStart;
        const end = area.selectionEnd;
        // set textarea value to: text before caret + tab + text after caret
        area.value =
            area.value.substring(0, start) + "\t" + area.value.substring(end);
        // put caret at right position again
        area.selectionStart = area.selectionEnd = start + 1;
        return;
    }
    else if (!TestUI.resultCalculating &&
        $("#commandLineWrapper").hasClass("hidden") &&
        $("#simplePopupWrapper").hasClass("hidden") &&
        $("#quoteSubmitPopupWrapper").hasClass("hidden") &&
        ActivePage.get() != "login") {
        if (ActivePage.get() == "test") {
            if (config_1.default.quickTab) {
                if (!$("#leaderboardsWrapper").hasClass("hidden")) {
                    Leaderboards.hide();
                }
                if (popupVisible) {
                    event.preventDefault();
                    return;
                }
                if (TestUI.resultVisible ||
                    !((config_1.default.mode == "zen" && !event.shiftKey) ||
                        (TestWords.hasTab && !event.shiftKey))) {
                    if (event.shiftKey) {
                        ManualRestart.set();
                    }
                    else {
                        ManualRestart.reset();
                    }
                    event.preventDefault();
                    if (TestActive.get() &&
                        config_1.default.repeatQuotes === "typing" &&
                        config_1.default.mode === "quote") {
                        TestLogic.restart(true, false, event);
                    }
                    else {
                        TestLogic.restart(false, false, event);
                    }
                }
                else {
                    event.preventDefault();
                    handleChar("\t", TestInput.input.current.length);
                    setWordsInput(" " + TestInput.input.current);
                }
            }
            else if (!TestUI.resultVisible) {
                if ((TestWords.hasTab && event.shiftKey) ||
                    (!TestWords.hasTab && config_1.default.mode !== "zen") ||
                    (config_1.default.mode === "zen" && event.shiftKey)) {
                    event.preventDefault();
                    $("#restartTestButton").trigger("focus");
                }
                else {
                    event.preventDefault();
                    handleChar("\t", TestInput.input.current.length);
                    setWordsInput(" " + TestInput.input.current);
                }
            }
        }
        else if (config_1.default.quickTab) {
            event.preventDefault();
            PageController.change("test");
        }
    }
}
$(document).keydown((event) => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    if (ActivePage.get() == "loading")
        return event.preventDefault();
    //autofocus
    const wordsFocused = $("#wordsInput").is(":focus");
    const pageTestActive = ActivePage.get() === "test";
    const commandLineVisible = !$("#commandLineWrapper").hasClass("hidden");
    const leaderboardsVisible = !$("#leaderboardsWrapper").hasClass("hidden");
    const popups = document.querySelectorAll(".popupWrapper");
    let popupVisible = false;
    for (const popup of popups) {
        if (!popup.classList.contains("hidden") === true) {
            popupVisible = true;
            break;
        }
    }
    const allowTyping = pageTestActive &&
        !commandLineVisible &&
        !leaderboardsVisible &&
        !popupVisible &&
        !TestUI.resultVisible &&
        (wordsFocused || event.key !== "Enter");
    if (allowTyping && !wordsFocused && event.key !== "Enter") {
        TestUI.focusWords();
        if (config_1.default.showOutOfFocusWarning) {
            event.preventDefault();
        }
    }
    //tab
    if ((event.key == "Tab" && !config_1.default.swapEscAndTab) ||
        (event.key == "Escape" && config_1.default.swapEscAndTab)) {
        handleTab(event, popupVisible);
    }
    if (!allowTyping)
        return;
    if (!((_a = event.originalEvent) === null || _a === void 0 ? void 0 : _a.isTrusted) || TestUI.testRestarting) {
        event.preventDefault();
        return;
    }
    if (TestInput.spacingDebug) {
        console.log("spacing debug", "keypress", event.key, "length", TestInput.keypressTimings.spacing.array.length);
    }
    TestInput.recordKeypressSpacing();
    TestInput.setKeypressDuration(performance.now());
    TestInput.setKeypressNotAfk();
    //blocking firefox from going back in history with backspace
    if (event.key === "Backspace") {
        Sound.playClick();
        const t = /INPUT|SELECT|TEXTAREA/i;
        if (!t.test(event.target.tagName)
        // if this breaks in the future, call mio and tell him to stop being lazy
        // (event.target as unknown as KeyboardEvent).disabled ||
        // (event.target as unknown as Element).readOnly
        ) {
            event.preventDefault();
        }
        if (config_1.default.confidenceMode === "max") {
            event.preventDefault();
            return;
        }
    }
    if (config_1.default.funbox !== "arrows" && /Arrow/i.test(event.key)) {
        event.preventDefault();
        return;
    }
    Monkey.type();
    if (event.key === "Backspace" && TestInput.input.current.length === 0) {
        backspaceToPrevious();
        if (TestInput.input.current) {
            setWordsInput(" " + TestInput.input.current + " ");
        }
    }
    if (event.key === "Enter") {
        if (event.shiftKey && config_1.default.mode == "zen") {
            TestLogic.finish();
        }
        else if (event.shiftKey &&
            ((config_1.default.mode == "time" && config_1.default.time === 0) ||
                (config_1.default.mode == "words" && config_1.default.words === 0))) {
            TestInput.setBailout(true);
            TestLogic.finish();
        }
        else {
            handleChar("\n", TestInput.input.current.length);
            setWordsInput(" " + TestInput.input.current);
        }
    }
    //show dead keys
    if (event.key === "Dead" &&
        !Misc.trailingComposeChars.test(TestInput.input.current)) {
        Sound.playClick();
        const word = document.querySelector("#words .word.active");
        const len = TestInput.input.current.length; // have to do this because prettier wraps the line and causes an error
        word === null || word === void 0 ? void 0 : word.querySelectorAll("letter")[len].classList.toggle("dead");
    }
    if (config_1.default.oppositeShiftMode !== "off") {
        correctShiftUsed =
            (yield ShiftTracker.isUsingOppositeShift(event)) !== false;
    }
    if (config_1.default.funbox === "arrows") {
        let char = event.key;
        if (["ArrowLeft", "ArrowUp", "ArrowRight", "ArrowDown"].includes(char)) {
            if (char === "ArrowLeft")
                char = "a";
            if (char === "ArrowRight")
                char = "d";
            if (char === "ArrowDown")
                char = "s";
            if (char === "ArrowUp")
                char = "w";
            event.preventDefault();
            handleChar(char, TestInput.input.current.length);
            updateUI();
            setWordsInput(" " + TestInput.input.current);
        }
    }
    else if (config_1.default.layout !== "default" &&
        !(event.ctrlKey ||
            (event.altKey && window.navigator.platform.search("Linux") > -1))) {
        const char = yield LayoutEmulator.getCharFromEvent(event);
        if (char !== null) {
            event.preventDefault();
            handleChar(char, TestInput.input.current.length);
            updateUI();
            setWordsInput(" " + TestInput.input.current);
        }
    }
}));
$("#wordsInput").keyup((event) => {
    var _a;
    if (!((_a = event.originalEvent) === null || _a === void 0 ? void 0 : _a.isTrusted) || TestUI.testRestarting) {
        event.preventDefault();
        return;
    }
    if (TestUI.resultVisible)
        return;
    const now = performance.now();
    if (TestInput.keypressTimings.duration.current !== -1) {
        const diff = Math.abs(TestInput.keypressTimings.duration.current - now);
        TestInput.pushKeypressDuration(diff);
    }
    TestInput.setKeypressDuration(now);
    Monkey.stop();
});
$("#wordsInput").on("beforeinput", (event) => {
    var _a;
    if (!((_a = event.originalEvent) === null || _a === void 0 ? void 0 : _a.isTrusted))
        return;
    if (event.target.value === "") {
        event.target.value = " ";
    }
});
$("#wordsInput").on("input", (event) => {
    var _a;
    if (!((_a = event.originalEvent) === null || _a === void 0 ? void 0 : _a.isTrusted) || TestUI.testRestarting) {
        event.target.value = " ";
        return;
    }
    TestInput.setKeypressNotAfk();
    const realInputValue = event.target.value.normalize();
    const inputValue = realInputValue.slice(1);
    // input will be modified even with the preventDefault() in
    // beforeinput/keydown if it's part of a compose sequence. this undoes
    // the effects of that and takes the input out of compose mode.
    if (config_1.default.layout !== "default" &&
        inputValue.length >= TestInput.input.current.length) {
        setWordsInput(" " + TestInput.input.current);
        return;
    }
    if (realInputValue.length === 0 && TestInput.input.current.length === 0) {
        // fallback for when no Backspace keydown event (mobile)
        backspaceToPrevious();
    }
    else if (inputValue.length < TestInput.input.current.length) {
        TestInput.input.current = inputValue;
        TestUI.updateWordElement();
        Caret.updatePosition();
        if (!Misc.trailingComposeChars.test(TestInput.input.current)) {
            Replay.addReplayEvent("setLetterIndex", TestInput.input.current.length);
        }
    }
    else if (inputValue !== TestInput.input.current) {
        let diffStart = 0;
        while (inputValue[diffStart] === TestInput.input.current[diffStart]) {
            diffStart++;
        }
        for (let i = diffStart; i < inputValue.length; i++) {
            handleChar(inputValue[i], i);
        }
    }
    setWordsInput(" " + TestInput.input.current);
    updateUI();
    // force caret at end of input
    // doing it on next cycle because Chromium on Android won't let me edit
    // the selection inside the input event
    setTimeout(() => {
        var _a;
        if (event.target.selectionStart !==
            event.target.value.length &&
            (!Misc.trailingComposeChars.test(event.target.value) ||
                ((_a = event.target.selectionStart) !== null && _a !== void 0 ? _a : 0) <
                    event.target.value.search(Misc.trailingComposeChars))) {
            event.target.selectionStart = event.target.selectionEnd = event.target.value.length;
        }
    }, 0);
});
$("#wordsInput").on("focus", (event) => {
    event.target.selectionStart = event.target.selectionEnd = event.target.value.length;
});
$("#wordsInput").on("copy paste", (event) => {
    event.preventDefault();
});


/***/ }),

/***/ "./src/scripts/controllers/page-controller.ts":
/*!****************************************************!*\
  !*** ./src/scripts/controllers/page-controller.ts ***!
  \****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.change = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const Account = __importStar(__webpack_require__(/*! ../pages/account */ "./src/scripts/pages/account.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const PageTest = __importStar(__webpack_require__(/*! ../pages/test */ "./src/scripts/pages/test.ts"));
const PageAbout = __importStar(__webpack_require__(/*! ../pages/about */ "./src/scripts/pages/about.ts"));
const PageChangeEvent = __importStar(__webpack_require__(/*! ../observables/page-change-event */ "./src/scripts/observables/page-change-event.ts"));
const PageLogin = __importStar(__webpack_require__(/*! ../pages/login */ "./src/scripts/pages/login.ts"));
const PageLoading = __importStar(__webpack_require__(/*! ../pages/loading */ "./src/scripts/pages/loading.ts"));
const PageTransition = __importStar(__webpack_require__(/*! ../states/page-transition */ "./src/scripts/states/page-transition.ts"));
function change(page) {
    if (PageTransition.get()) {
        console.log(`change page ${page} stopped`);
        return;
    }
    console.log(`change page ${page}`);
    if (page === "")
        page = "test";
    if (page == undefined) {
        //use window loacation
        const pages = {
            "/": "test",
            "/login": "login",
            "/settings": "settings",
            "/about": "about",
            "/account": "account",
        };
        let path = pages[window.location.pathname];
        if (!path) {
            path = "test";
        }
        page = path;
    }
    if (ActivePage.get() === page) {
        console.log(`page ${page} already active`);
        return;
    }
    const pages = {
        loading: PageLoading.page,
        test: PageTest.page,
        settings: Settings.page,
        about: PageAbout.page,
        account: Account.page,
        login: PageLogin.page,
    };
    const previousPage = pages[ActivePage.get()];
    const nextPage = pages[page];
    previousPage === null || previousPage === void 0 ? void 0 : previousPage.beforeHide();
    PageTransition.set(true);
    ActivePage.set(undefined);
    $(".page").removeClass("active");
    Misc.swapElements(previousPage.element, nextPage.element, 250, () => {
        PageTransition.set(false);
        ActivePage.set(nextPage.name);
        previousPage === null || previousPage === void 0 ? void 0 : previousPage.afterHide();
        nextPage.element.addClass("active");
        history.pushState(nextPage.pathname, "", nextPage.pathname);
        nextPage === null || nextPage === void 0 ? void 0 : nextPage.afterShow();
    }, () => __awaiter(this, void 0, void 0, function* () {
        yield (nextPage === null || nextPage === void 0 ? void 0 : nextPage.beforeShow());
    }));
    PageChangeEvent.dispatch(previousPage, nextPage);
}
exports.change = change;
$(document).on("click", "#top .logo", () => {
    change("test");
});
$(document).on("click", "#top #menu .icon-button", (e) => {
    if (!$(e.currentTarget).hasClass("leaderboards")) {
        const href = $(e.currentTarget).attr("href");
        ManualRestart.set();
        change(href.replace("/", ""));
    }
    return false;
});
$(".pageTest .loginTip .link").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    change("login");
}));


/***/ }),

/***/ "./src/scripts/controllers/preset-controller.ts":
/*!******************************************************!*\
  !*** ./src/scripts/controllers/preset-controller.ts ***!
  \******************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.apply = void 0;
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const TagController = __importStar(__webpack_require__(/*! ./tag-controller */ "./src/scripts/controllers/tag-controller.ts"));
function apply(_id) {
    var _a;
    // console.log(DB.getSnapshot().presets);
    const snapshot = DB.getSnapshot();
    (_a = snapshot.presets) === null || _a === void 0 ? void 0 : _a.forEach((preset) => {
        if (preset._id == _id) {
            UpdateConfig.apply(preset.config);
            TagController.clear(true);
            if (preset.config.tags) {
                preset.config.tags.forEach((tagid) => {
                    TagController.set(tagid, true, false);
                });
            }
            TestLogic.restart();
            Notifications.add("Preset applied", 1, 2);
            UpdateConfig.saveFullConfigToLocalStorage();
        }
    });
}
exports.apply = apply;


/***/ }),

/***/ "./src/scripts/controllers/quotes-controller.ts":
/*!******************************************************!*\
  !*** ./src/scripts/controllers/quotes-controller.ts ***!
  \******************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
const config_event_1 = __webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts");
const defaultQuoteCollection = {
    quotes: [],
    length: 0,
    language: null,
    groups: [],
};
class QuotesController {
    constructor() {
        this.quoteCollection = defaultQuoteCollection;
        this.quoteQueue = [];
        this.queueIndex = 0;
    }
    getQuotes(language, quoteLengths) {
        return __awaiter(this, void 0, void 0, function* () {
            const normalizedLanguage = language.replace(/_\d*k$/g, "");
            if (this.quoteCollection.language !== normalizedLanguage) {
                try {
                    const data = yield $.getJSON(`quotes/${normalizedLanguage}.json`);
                    if (data.quotes === undefined || data.quotes.length === 0) {
                        return defaultQuoteCollection;
                    }
                    this.quoteCollection = {
                        quotes: [],
                        length: data.quotes.length,
                        groups: [],
                        language: data.language,
                    };
                    // Transform JSON Quote schema to MonkeyTypes Quote schema
                    data.quotes.forEach((quote) => {
                        const monkeyTypeQuote = {
                            text: quote.text,
                            source: quote.source,
                            length: quote.length,
                            id: quote.id,
                            language: data.language,
                            group: 0,
                        };
                        this.quoteCollection.quotes.push(monkeyTypeQuote);
                    });
                    data.groups.forEach((quoteGroup, groupIndex) => {
                        const lower = quoteGroup[0];
                        const upper = quoteGroup[1];
                        this.quoteCollection.groups[groupIndex] =
                            this.quoteCollection.quotes.filter((quote) => {
                                if (quote.length >= lower && quote.length <= upper) {
                                    quote.group = groupIndex;
                                    return true;
                                }
                                return false;
                            });
                    });
                    if (quoteLengths !== undefined) {
                        this.updateQuoteQueue(quoteLengths);
                    }
                }
                catch (_a) {
                    return defaultQuoteCollection;
                }
            }
            return this.quoteCollection;
        });
    }
    getQuoteById(id) {
        const targetQuote = this.quoteCollection.quotes.find((quote) => {
            return quote.id === id;
        });
        return targetQuote;
    }
    updateQuoteQueue(quoteGroups) {
        this.quoteQueue = [];
        quoteGroups.forEach((group) => {
            var _a;
            if (group < 0) {
                return;
            }
            (_a = this.quoteCollection.groups[group]) === null || _a === void 0 ? void 0 : _a.forEach((quote) => {
                this.quoteQueue.push(quote);
            });
        });
        (0, misc_1.shuffle)(this.quoteQueue);
        this.queueIndex = 0;
    }
    getRandomQuote() {
        if (this.quoteQueue.length === 0) {
            return null;
        }
        if (this.queueIndex >= this.quoteQueue.length) {
            this.queueIndex = 0;
            (0, misc_1.shuffle)(this.quoteQueue);
        }
        const randomQuote = this.quoteQueue[this.queueIndex];
        this.queueIndex += 1;
        return randomQuote;
    }
    getCurrentQuote() {
        if (this.quoteQueue.length === 0) {
            return null;
        }
        return this.quoteQueue[this.queueIndex];
    }
}
const quoteController = new QuotesController();
(0, config_event_1.subscribe)((key, newValue) => {
    if (key === "quoteLength") {
        quoteController.updateQuoteQueue(newValue);
    }
});
exports["default"] = quoteController;


/***/ }),

/***/ "./src/scripts/controllers/route-controller.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/controllers/route-controller.ts ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.handleInitialPageClasses = void 0;
// import * as Funbox from "../test/funbox";
const PageController = __importStar(__webpack_require__(/*! ./page-controller */ "./src/scripts/controllers/page-controller.ts"));
// import Config from "../config";
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const mappedRoutes = {
    "/": "pageLoading",
    "/login": "pageLoading",
    "/settings": "pageLoading",
    "/about": "pageLoading",
    "/account": "pageAccount",
    "/verify": "pageLoading",
};
function handleInitialPageClasses(pathname) {
    if (!mappedRoutes[pathname]) {
        pathname = "/";
    }
    const el = $(".page." + mappedRoutes[pathname]);
    $(el).removeClass("hidden");
    $(el).addClass("active");
    let pageName = "loading";
    if (pathname === "/account")
        pageName = "account";
    ActivePage.set(pageName);
}
exports.handleInitialPageClasses = handleInitialPageClasses;
// honestly im not sure what this does
// (function (history): void {
//   const pushState = history.pushState;
//   history.pushState = function (state): void {
//     if (Config.funbox === "memory" && state !== "/") {
//       Funbox.resetMemoryTimer();
//     }
//     // @ts-ignore
//     return pushState.apply(history, arguments);
//   };
// })(window.history);
$(window).on("popstate", (e) => {
    const state = e.originalEvent.state;
    if (state == "" || state == "/") {
        // show test
        PageController.change("test");
    }
    else if (state == "about") {
        // show about
        PageController.change("about");
    }
    else if (state == "account" || state == "login") {
        if (firebase_1.Auth.currentUser) {
            PageController.change("account");
        }
        else {
            PageController.change("login");
        }
    }
});


/***/ }),

/***/ "./src/scripts/controllers/sound-controller.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/controllers/sound-controller.ts ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.setVolume = exports.playError = exports.playClick = exports.previewClick = exports.init = exports.initErrorSound = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const howler_1 = __importStar(__webpack_require__(/*! howler */ "./node_modules/howler/dist/howler.js"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
let errorSound = null;
let clickSounds = null;
function initErrorSound() {
    if (errorSound !== null)
        return;
    errorSound = new howler_1.Howl({ src: ["../sound/error.wav"] });
}
exports.initErrorSound = initErrorSound;
function init() {
    if (clickSounds !== null)
        return;
    clickSounds = {
        1: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click1/click1_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click1/click1_1.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click1/click1_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click1/click1_2.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click1/click1_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click1/click1_3.wav" }),
                ],
                counter: 0,
            },
        ],
        2: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click2/click2_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click2/click2_1.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click2/click2_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click2/click2_2.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click2/click2_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click2/click2_3.wav" }),
                ],
                counter: 0,
            },
        ],
        3: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click3/click3_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click3/click3_1.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click3/click3_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click3/click3_2.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click3/click3_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click3/click3_3.wav" }),
                ],
                counter: 0,
            },
        ],
        4: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_11.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_22.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_33.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_4.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_44.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_5.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_55.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_6.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_66.wav" }),
                ],
                counter: 0,
            },
        ],
        5: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_11.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_22.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_33.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_4.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_44.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_5.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_55.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_6.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_66.wav" }),
                ],
                counter: 0,
            },
        ],
        6: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click6/click6_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click6/click6_11.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click6/click6_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click6/click6_22.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click6/click6_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click6/click6_33.wav" }),
                ],
                counter: 0,
            },
        ],
        7: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click7/click7_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click7/click7_11.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click7/click7_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click7/click7_22.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click7/click7_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click7/click7_33.wav" }),
                ],
                counter: 0,
            },
        ],
    };
}
exports.init = init;
function previewClick(val) {
    if (clickSounds === null)
        init();
    clickSounds[val][0].sounds[0].seek(0);
    clickSounds[val][0].sounds[0].play();
}
exports.previewClick = previewClick;
function playClick() {
    if (config_1.default.playSoundOnClick === "off")
        return;
    if (clickSounds === null)
        init();
    const randomSound = (0, misc_1.randomElementFromArray)(clickSounds[config_1.default.playSoundOnClick]);
    randomSound.counter++;
    if (randomSound.counter === 2)
        randomSound.counter = 0;
    randomSound.sounds[randomSound.counter].seek(0);
    randomSound.sounds[randomSound.counter].play();
}
exports.playClick = playClick;
function playError() {
    if (!config_1.default.playSoundOnError)
        return;
    if (errorSound === null)
        initErrorSound();
    errorSound.seek(0);
    errorSound.play();
}
exports.playError = playError;
function setVolume(val) {
    // not sure why it complains but it works
    // @ts-ignore
    howler_1.default.Howler.volume(val);
}
exports.setVolume = setVolume;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "playSoundOnClick" && eventValue !== "off")
        init();
    if (eventKey === "soundVolume")
        setVolume(eventValue);
});


/***/ }),

/***/ "./src/scripts/controllers/tag-controller.ts":
/*!***************************************************!*\
  !*** ./src/scripts/controllers/tag-controller.ts ***!
  \***************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.loadActiveFromLocalStorage = exports.toggle = exports.set = exports.clear = exports.saveActiveToLocalStorage = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const ModesNotice = __importStar(__webpack_require__(/*! ../elements/modes-notice */ "./src/scripts/elements/modes-notice.ts"));
function saveActiveToLocalStorage() {
    var _a;
    const tags = [];
    try {
        (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
            if (tag.active === true) {
                tags.push(tag._id);
            }
        });
        window.localStorage.setItem("activeTags", JSON.stringify(tags));
    }
    catch (e) { }
}
exports.saveActiveToLocalStorage = saveActiveToLocalStorage;
function clear(nosave = false) {
    var _a;
    const snapshot = DB.getSnapshot();
    snapshot.tags = (_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.map((tag) => {
        tag.active = false;
        return tag;
    });
    DB.setSnapshot(snapshot);
    ModesNotice.update();
    if (!nosave)
        saveActiveToLocalStorage();
}
exports.clear = clear;
function set(tagid, state, nosave = false) {
    var _a;
    const snapshot = DB.getSnapshot();
    snapshot.tags = (_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.map((tag) => {
        if (tag._id === tagid) {
            tag.active = state;
        }
        return tag;
    });
    DB.setSnapshot(snapshot);
    ModesNotice.update();
    if (!nosave)
        saveActiveToLocalStorage();
}
exports.set = set;
function toggle(tagid, nosave = false) {
    var _a;
    (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
        if (tag._id === tagid) {
            if (tag.active === undefined) {
                tag.active = true;
            }
            else {
                tag.active = !tag.active;
            }
        }
    });
    ModesNotice.update();
    if (!nosave)
        saveActiveToLocalStorage();
}
exports.toggle = toggle;
function loadActiveFromLocalStorage() {
    var _a;
    let newTags = window.localStorage.getItem("activeTags");
    if (newTags != undefined && newTags !== "") {
        try {
            newTags = (_a = JSON.parse(newTags)) !== null && _a !== void 0 ? _a : [];
        }
        catch (e) {
            newTags = [];
        }
        newTags.forEach((ntag) => {
            toggle(ntag, true);
        });
        saveActiveToLocalStorage();
    }
}
exports.loadActiveFromLocalStorage = loadActiveFromLocalStorage;


/***/ }),

/***/ "./src/scripts/controllers/theme-controller.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/controllers/theme-controller.ts ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.applyCustomBackground = exports.applyCustomBackgroundSize = exports.clearRandom = exports.randomizeTheme = exports.clearPreview = exports.set = exports.preview = exports.colorVars = exports.randomTheme = void 0;
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const ChartController = __importStar(__webpack_require__(/*! ./chart-controller */ "./src/scripts/controllers/chart-controller.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const BackgroundFilter = __importStar(__webpack_require__(/*! ../elements/custom-background-filter */ "./src/scripts/elements/custom-background-filter.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const AnalyticsController = __importStar(__webpack_require__(/*! ../controllers/analytics-controller */ "./src/scripts/controllers/analytics-controller.ts"));
let isPreviewingTheme = false;
exports.randomTheme = null;
exports.colorVars = [
    "--bg-color",
    "--main-color",
    "--caret-color",
    "--sub-color",
    "--text-color",
    "--error-color",
    "--error-extra-color",
    "--colorful-error-color",
    "--colorful-error-extra-color",
];
function updateFavicon(size, curveSize) {
    return __awaiter(this, void 0, void 0, function* () {
        setTimeout(() => __awaiter(this, void 0, void 0, function* () {
            let maincolor, bgcolor;
            bgcolor = yield ThemeColors.get("bg");
            maincolor = yield ThemeColors.get("main");
            if (window.location.hostname === "localhost") {
                const swap = maincolor;
                maincolor = bgcolor;
                bgcolor = swap;
            }
            if (bgcolor == maincolor) {
                bgcolor = "#111";
                maincolor = "#eee";
            }
            const canvas = document.createElement("canvas");
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext("2d");
            ctx.beginPath();
            ctx.moveTo(0, curveSize);
            //top left
            ctx.quadraticCurveTo(0, 0, curveSize, 0);
            ctx.lineTo(size - curveSize, 0);
            //top right
            ctx.quadraticCurveTo(size, 0, size, curveSize);
            ctx.lineTo(size, size - curveSize);
            ctx.quadraticCurveTo(size, size, size - curveSize, size);
            ctx.lineTo(curveSize, size);
            ctx.quadraticCurveTo(0, size, 0, size - curveSize);
            ctx.fillStyle = bgcolor;
            ctx.fill();
            ctx.font = "900 " + (size / 2) * 1.2 + "px Lexend Deca";
            ctx.textAlign = "center";
            ctx.fillStyle = maincolor;
            ctx.fillText("mt", size / 2 + 1, (size / 3) * 2.1);
            // $("body").prepend(canvas);
            $("#favicon").attr("href", canvas.toDataURL("image/png"));
        }), 125);
    });
}
function clearCustomTheme() {
    exports.colorVars.forEach((e) => {
        document.documentElement.style.setProperty(e, "");
    });
}
const loadStyle = function (name) {
    return __awaiter(this, void 0, void 0, function* () {
        return new Promise((resolve) => {
            const link = document.createElement("link");
            link.type = "text/css";
            link.rel = "stylesheet";
            link.id = "currentTheme";
            link.onload = () => {
                resolve();
            };
            if (name === "custom") {
                link.href = `themes/serika_dark.css`;
            }
            else {
                link.href = `themes/${name}.css`;
            }
            const headScript = document.querySelector("#currentTheme");
            headScript.replaceWith(link);
        });
    });
};
// export function changeCustomTheme(themeId: string, nosave = false): void {
//   const customThemes = DB.getSnapshot().customThemes;
//   const colors = customThemes.find((e) => e._id === themeId)
//     ?.colors as string[];
//   UpdateConfig.setCustomThemeColors(colors, nosave);
// }
function apply(themeName, isCustom, isPreview = false) {
    clearCustomTheme();
    let name = "serika_dark";
    if (!isCustom) {
        name = themeName;
    }
    else {
        name = "custom";
    }
    ThemeColors.reset();
    $(".keymap-key").attr("style", "");
    // $("#currentTheme").attr("href", `themes/${name}.css`);
    loadStyle(name).then(() => {
        var _a, _b;
        ThemeColors.update();
        if (isCustom) {
            let colorValues = config_1.default.customThemeColors;
            const snapshot = DB.getSnapshot();
            if (isCustom && !isPreview && snapshot) {
                const customColors = (_b = (_a = snapshot.customThemes.find((e) => e._id === themeName)) === null || _a === void 0 ? void 0 : _a.colors) !== null && _b !== void 0 ? _b : [];
                if (customColors.length > 0) {
                    UpdateConfig.setCustomThemeColors(customColors);
                }
            }
            if (themeName !== "custom" && snapshot) {
                const customThemes = snapshot.customThemes;
                const customThemeById = customThemes.find((e) => e._id === themeName);
                colorValues = customThemeById === null || customThemeById === void 0 ? void 0 : customThemeById.colors;
            }
            exports.colorVars.forEach((e, index) => {
                document.documentElement.style.setProperty(e, colorValues[index]);
            });
        }
        AnalyticsController.log("changedTheme", { theme: themeName });
        if (!isPreview) {
            ThemeColors.getAll().then((colors) => {
                $(".keymap-key").attr("style", "");
                ChartController.updateAllChartColors();
                updateFavicon(128, 32);
                $("#metaThemeColor").attr("content", colors.bg);
            });
        }
        $(".current-theme .text").text(isCustom ? "custom" : themeName.replace(/_/g, " "));
    });
}
function preview(themeIdentifier, isCustom, randomTheme = false) {
    isPreviewingTheme = true;
    apply(themeIdentifier, isCustom, !randomTheme);
}
exports.preview = preview;
function set(themeIdentifier, isCustom) {
    apply(themeIdentifier, isCustom);
}
exports.set = set;
function clearPreview() {
    if (isPreviewingTheme) {
        isPreviewingTheme = false;
        exports.randomTheme = null;
        if (config_1.default.customTheme) {
            apply("custom", true);
        }
        else {
            apply(config_1.default.theme, false);
        }
    }
}
exports.clearPreview = clearPreview;
function randomizeTheme() {
    let randomList;
    Misc.getThemesList().then((themes) => {
        var _a, _b;
        if (config_1.default.randomTheme === "fav" && config_1.default.favThemes.length > 0) {
            randomList = config_1.default.favThemes;
        }
        else if (config_1.default.randomTheme === "light") {
            randomList = themes
                .filter((t) => Misc.isColorLight(t.bgColor))
                .map((t) => t.name);
        }
        else if (config_1.default.randomTheme === "dark") {
            randomList = themes
                .filter((t) => Misc.isColorDark(t.bgColor))
                .map((t) => t.name);
        }
        else if (config_1.default.randomTheme === "on") {
            randomList = themes.map((t) => {
                return t.name;
            });
        }
        else {
            randomList = DB.getSnapshot().customThemes.map((ct) => ct._id);
        }
        const previousTheme = exports.randomTheme;
        exports.randomTheme = Misc.randomElementFromArray(randomList);
        // if (Config.randomTheme === "custom") {
        // changeCustomTheme(randomTheme, true);
        // } else {
        preview(exports.randomTheme, config_1.default.randomTheme === "custom");
        // }
        if (previousTheme != exports.randomTheme) {
            let name = exports.randomTheme.replace(/_/g, " ");
            if (config_1.default.randomTheme === "custom") {
                name = ((_b = (_a = DB.getSnapshot().customThemes.find((ct) => ct._id === exports.randomTheme)) === null || _a === void 0 ? void 0 : _a.name) !== null && _b !== void 0 ? _b : "custom").replace(/_/g, " ");
            }
            Notifications.add(name, 0);
        }
    });
}
exports.randomizeTheme = randomizeTheme;
function clearRandom() {
    if (exports.randomTheme === null)
        return;
    exports.randomTheme = null;
    if (config_1.default.customTheme) {
        apply("custom", true);
    }
    else {
        apply(config_1.default.theme, false);
    }
}
exports.clearRandom = clearRandom;
function applyCustomBackgroundSize() {
    if (config_1.default.customBackgroundSize == "max") {
        $(".customBackground img").css({
            // width: "calc(100%)",
            // height: "calc(100%)",
            objectFit: "",
        });
    }
    else {
        $(".customBackground img").css({
            objectFit: config_1.default.customBackgroundSize,
        });
    }
}
exports.applyCustomBackgroundSize = applyCustomBackgroundSize;
function applyCustomBackground() {
    // $(".customBackground").css({
    //   backgroundImage: `url(${Config.customBackground})`,
    //   backgroundAttachment: "fixed",
    // });
    if (config_1.default.customBackground === "") {
        $("#words").removeClass("noErrorBorder");
        $("#resultWordsHistory").removeClass("noErrorBorder");
        $(".customBackground img").remove();
    }
    else {
        $("#words").addClass("noErrorBorder");
        $("#resultWordsHistory").addClass("noErrorBorder");
        $(".customBackground").html(`<img src="${config_1.default.customBackground}" />`);
        BackgroundFilter.apply();
        applyCustomBackgroundSize();
    }
}
exports.applyCustomBackground = applyCustomBackground;
(_b = (_a = window
    .matchMedia) === null || _a === void 0 ? void 0 : _a.call(window, "(prefers-color-scheme: dark)")) === null || _b === void 0 ? void 0 : _b.addEventListener("change", (event) => {
    if (!config_1.default.autoSwitchTheme || config_1.default.customTheme)
        return;
    if (event.matches) {
        set(config_1.default.themeDark, false);
    }
    else {
        set(config_1.default.themeLight, false);
    }
});
ConfigEvent.subscribe((eventKey, eventValue, nosave) => {
    if (eventKey === "customTheme") {
        eventValue ? set("custom", true) : set(config_1.default.theme, false);
    }
    if (eventKey === "customThemeColors") {
        nosave ? preview("custom", true) : set("custom", true);
    }
    if (eventKey === "theme") {
        clearPreview();
        set(eventValue, false);
    }
    if (eventKey === "setThemes") {
        clearPreview();
        if (eventValue) {
            set("custom", true);
        }
        else {
            if (config_1.default.autoSwitchTheme) {
                if (window.matchMedia &&
                    window.matchMedia("(prefers-color-scheme: dark)").matches) {
                    set(config_1.default.themeDark, false);
                }
                else {
                    set(config_1.default.themeLight, false);
                }
            }
            else {
                set(config_1.default.theme, false);
            }
        }
    }
    if (eventKey === "randomTheme" && eventValue === "off")
        clearRandom();
    if (eventKey === "customBackground")
        applyCustomBackground();
    if (eventKey === "customBackgroundSize")
        applyCustomBackgroundSize();
    if (eventKey === "autoSwitchTheme") {
        if (eventValue) {
            if (window.matchMedia &&
                window.matchMedia("(prefers-color-scheme: dark)").matches) {
                set(config_1.default.themeDark, false);
            }
            else {
                set(config_1.default.themeLight, false);
            }
        }
        else {
            set(config_1.default.theme, false);
        }
    }
    if (eventKey === "themeLight" &&
        config_1.default.autoSwitchTheme &&
        !(window.matchMedia &&
            window.matchMedia("(prefers-color-scheme: dark)").matches) &&
        !nosave) {
        set(config_1.default.themeLight, false);
    }
    if (eventKey === "themeDark" &&
        config_1.default.autoSwitchTheme &&
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches &&
        !nosave) {
        set(config_1.default.themeDark, false);
    }
});


/***/ }),

/***/ "./src/scripts/controllers/verification-controller.ts":
/*!************************************************************!*\
  !*** ./src/scripts/controllers/verification-controller.ts ***!
  \************************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.verify = exports.set = exports.data = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
exports.data = null;
function set(val) {
    exports.data = val;
}
exports.set = set;
function verify(uid) {
    return __awaiter(this, void 0, void 0, function* () {
        if (exports.data === null)
            return;
        Notifications.add("Linking Discord account", 0, 3);
        Loader.show();
        exports.data.uid = uid;
        const response = yield ape_1.default.users.linkDiscord(exports.data);
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to link Discord: " + response.message, -1);
        }
        Notifications.add("Accounts linked", 1);
        const snapshot = DB.getSnapshot();
        snapshot.discordId = response.data.did;
        DB.setSnapshot(snapshot);
        Settings.updateDiscordSection();
    });
}
exports.verify = verify;


/***/ }),

/***/ "./src/scripts/db.ts":
/*!***************************!*\
  !*** ./src/scripts/db.ts ***!
  \***************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateLocalStats = exports.saveLocalResult = exports.saveConfig = exports.updateLbMemory = exports.saveLocalTagPB = exports.getLocalTagPB = exports.saveLocalPB = exports.getLocalPB = exports.getUserAverage10 = exports.getUserHighestWpm = exports.deleteCustomTheme = exports.editCustomTheme = exports.addCustomTheme = exports.getCustomThemeById = exports.getUserResults = exports.initSnapshot = exports.setSnapshot = exports.getSnapshot = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ./ape */ "./src/scripts/ape/index.ts"));
const AccountButton = __importStar(__webpack_require__(/*! ./elements/account-button */ "./src/scripts/elements/account-button.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./elements/notifications */ "./src/scripts/elements/notifications.ts"));
const LoadingPage = __importStar(__webpack_require__(/*! ./pages/loading */ "./src/scripts/pages/loading.ts"));
const default_config_1 = __importDefault(__webpack_require__(/*! ./constants/default-config */ "./src/scripts/constants/default-config.ts"));
const firebase_1 = __webpack_require__(/*! ./firebase */ "./src/scripts/firebase.ts");
const default_snapshot_1 = __webpack_require__(/*! ./constants/default-snapshot */ "./src/scripts/constants/default-snapshot.ts");
let dbSnapshot;
function getSnapshot() {
    return dbSnapshot;
}
exports.getSnapshot = getSnapshot;
function setSnapshot(newSnapshot) {
    try {
        delete newSnapshot.banned;
    }
    catch (_a) { }
    try {
        delete newSnapshot.verified;
    }
    catch (_b) { }
    dbSnapshot = newSnapshot;
}
exports.setSnapshot = setSnapshot;
function initSnapshot() {
    var _a, _b, _c, _d, _e;
    return __awaiter(this, void 0, void 0, function* () {
        //send api request with token that returns tags, presets, and data needed for snap
        const snap = default_snapshot_1.defaultSnap;
        try {
            if (firebase_1.Auth.currentUser == null)
                return false;
            // if (ActivePage.get() == "loading") {
            //   LoadingPage.updateBar(22.5);
            // } else {
            //   LoadingPage.updateBar(16);
            // }
            // LoadingPage.updateText("Downloading user...");
            const [userResponse, configResponse, tagsResponse, presetsResponse] = yield Promise.all([
                ape_1.default.users.getData(),
                ape_1.default.configs.get(),
                ape_1.default.users.getTags(),
                ape_1.default.presets.get(),
            ]);
            if (userResponse.status !== 200) {
                throw {
                    message: `${userResponse.message} (user)`,
                    responseCode: userResponse.status,
                };
            }
            if (configResponse.status !== 200) {
                throw {
                    message: `${configResponse.message} (config)`,
                    responseCode: configResponse.status,
                };
            }
            if (tagsResponse.status !== 200) {
                throw {
                    message: `${tagsResponse.message} (tags)`,
                    responseCode: tagsResponse.status,
                };
            }
            if (presetsResponse.status !== 200) {
                throw {
                    message: `${presetsResponse.message} (presets)`,
                    responseCode: presetsResponse.status,
                };
            }
            const [userData, configData, tagsData, presetsData] = [
                userResponse,
                configResponse,
                tagsResponse,
                presetsResponse,
            ].map((response) => response.data);
            snap.name = userData.name;
            snap.personalBests = userData.personalBests;
            snap.banned = userData.banned;
            snap.verified = userData.verified;
            snap.discordId = userData.discordId;
            snap.globalStats = {
                time: userData.timeTyping,
                started: userData.startedTests,
                completed: userData.completedTests,
            };
            if (userData.quoteMod === true)
                snap.quoteMod = true;
            snap.quoteRatings = userData.quoteRatings;
            snap.favouriteThemes =
                userData.favouriteThemes === undefined ? [] : userData.favouriteThemes;
            if (((_a = userData.lbMemory) === null || _a === void 0 ? void 0 : _a.time15) || ((_b = userData.lbMemory) === null || _b === void 0 ? void 0 : _b.time60)) {
                //old memory format
                snap.lbMemory = {};
            }
            else if (userData.lbMemory) {
                snap.lbMemory = userData.lbMemory;
            }
            // if (ActivePage.get() == "loading") {
            //   LoadingPage.updateBar(45);
            // } else {
            //   LoadingPage.updateBar(32);
            // }
            // LoadingPage.updateText("Downloading config...");
            if (configData) {
                const newConfig = Object.assign({}, default_config_1.default);
                for (const key in configData.config) {
                    const value = configData.config[key];
                    newConfig[key] = value;
                }
                snap.config = newConfig;
            }
            // if (ActivePage.get() == "loading") {
            //   LoadingPage.updateBar(67.5);
            // } else {
            //   LoadingPage.updateBar(48);
            // }
            // LoadingPage.updateText("Downloading tags...");
            snap.customThemes = (_c = userData.customThemes) !== null && _c !== void 0 ? _c : [];
            snap.tags = tagsData;
            snap.tags = (_d = snap.tags) === null || _d === void 0 ? void 0 : _d.sort((a, b) => {
                if (a.name > b.name) {
                    return 1;
                }
                else if (a.name < b.name) {
                    return -1;
                }
                else {
                    return 0;
                }
            });
            // if (ActivePage.get() == "loading") {
            //   LoadingPage.updateBar(90);
            // } else {
            //   LoadingPage.updateBar(64);
            // }
            // LoadingPage.updateText("Downloading presets...");
            snap.presets = presetsData;
            snap.presets = (_e = snap.presets) === null || _e === void 0 ? void 0 : _e.sort((a, b) => {
                if (a.name > b.name) {
                    return 1;
                }
                else if (a.name < b.name) {
                    return -1;
                }
                else {
                    return 0;
                }
            });
            dbSnapshot = snap;
            return dbSnapshot;
        }
        catch (e) {
            dbSnapshot = default_snapshot_1.defaultSnap;
            throw e;
        }
    });
}
exports.initSnapshot = initSnapshot;
function getUserResults() {
    return __awaiter(this, void 0, void 0, function* () {
        const user = firebase_1.Auth.currentUser;
        if (user == null)
            return false;
        if (dbSnapshot === null)
            return false;
        if (dbSnapshot.results !== undefined) {
            return true;
        }
        else {
            LoadingPage.updateText("Downloading results...");
            LoadingPage.updateBar(90);
            const response = yield ape_1.default.results.get();
            if (response.status !== 200) {
                Notifications.add("Error getting results: " + response.message, -1);
                return false;
            }
            const results = response.data;
            results.forEach((result) => {
                if (result.bailedOut === undefined)
                    result.bailedOut = false;
                if (result.blindMode === undefined)
                    result.blindMode = false;
                if (result.lazyMode === undefined)
                    result.lazyMode = false;
                if (result.difficulty === undefined)
                    result.difficulty = "normal";
                if (result.funbox === undefined)
                    result.funbox = "none";
                if (result.language === undefined || result.language === null) {
                    result.language = "english";
                }
                if (result.numbers === undefined)
                    result.numbers = false;
                if (result.punctuation === undefined)
                    result.punctuation = false;
            });
            dbSnapshot.results = results === null || results === void 0 ? void 0 : results.sort((a, b) => b.timestamp - a.timestamp);
            return true;
        }
    });
}
exports.getUserResults = getUserResults;
function getCustomThemeById(themeID) {
    return dbSnapshot.customThemes.find((t) => t._id === themeID);
}
exports.getCustomThemeById = getCustomThemeById;
function addCustomTheme(theme) {
    return __awaiter(this, void 0, void 0, function* () {
        if (dbSnapshot === null)
            return false;
        if (dbSnapshot.customThemes.length >= 10) {
            Notifications.add("Too many custom themes!", 0);
            return false;
        }
        const response = yield ape_1.default.users.addCustomTheme(theme);
        if (response.status !== 200) {
            Notifications.add("Error adding custom theme: " + response.message, -1);
            return false;
        }
        const newCustomTheme = Object.assign(Object.assign({}, theme), { _id: response.data.theme._id });
        dbSnapshot.customThemes.push(newCustomTheme);
        return true;
    });
}
exports.addCustomTheme = addCustomTheme;
function editCustomTheme(themeId, newTheme) {
    return __awaiter(this, void 0, void 0, function* () {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return false;
        if (dbSnapshot === null)
            return false;
        const customTheme = dbSnapshot.customThemes.find((t) => t._id === themeId);
        if (!customTheme) {
            Notifications.add("Editing failed: Custom theme with id: " + themeId + " does not exist", -1);
            return false;
        }
        const response = yield ape_1.default.users.editCustomTheme(themeId, newTheme);
        if (response.status !== 200) {
            Notifications.add("Error editing custom theme: " + response.message, -1);
            return false;
        }
        const newCustomTheme = Object.assign(Object.assign({}, newTheme), { _id: themeId });
        dbSnapshot.customThemes[dbSnapshot.customThemes.indexOf(customTheme)] =
            newCustomTheme;
        return true;
    });
}
exports.editCustomTheme = editCustomTheme;
function deleteCustomTheme(themeId) {
    return __awaiter(this, void 0, void 0, function* () {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return false;
        if (dbSnapshot === null)
            return false;
        const customTheme = dbSnapshot.customThemes.find((t) => t._id === themeId);
        if (!customTheme)
            return false;
        const response = yield ape_1.default.users.deleteCustomTheme(themeId);
        if (response.status !== 200) {
            Notifications.add("Error deleting custom theme: " + response.message, -1);
            return false;
        }
        dbSnapshot.customThemes = dbSnapshot.customThemes.filter((t) => t._id !== themeId);
        return true;
    });
}
exports.deleteCustomTheme = deleteCustomTheme;
function getUserHighestWpm(mode, mode2, punctuation, language, difficulty, lazyMode) {
    return __awaiter(this, void 0, void 0, function* () {
        function cont() {
            var _a;
            let topWpm = 0;
            (_a = dbSnapshot.results) === null || _a === void 0 ? void 0 : _a.forEach((result) => {
                if (result.mode == mode &&
                    result.mode2 == mode2 &&
                    result.punctuation == punctuation &&
                    result.language == language &&
                    result.difficulty == difficulty &&
                    (result.lazyMode === lazyMode ||
                        (result.lazyMode === undefined && lazyMode === false))) {
                    if (result.wpm > topWpm) {
                        topWpm = result.wpm;
                    }
                }
            });
            return topWpm;
        }
        const retval = dbSnapshot === null || dbSnapshot.results === undefined ? 0 : cont();
        return retval;
    });
}
exports.getUserHighestWpm = getUserHighestWpm;
function getUserAverage10(mode, mode2, punctuation, language, difficulty, lazyMode) {
    return __awaiter(this, void 0, void 0, function* () {
        const snapshot = getSnapshot();
        if (!snapshot)
            return [0, 0];
        function cont() {
            var _a;
            const activeTagIds = [];
            (_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
                if (tag.active === true) {
                    activeTagIds.push(tag._id);
                }
            });
            let wpmSum = 0;
            let accSum = 0;
            let last10Wpm = 0;
            let last10Acc = 0;
            let count = 0;
            let last10Count = 0;
            if (snapshot.results !== undefined) {
                for (const result of snapshot.results) {
                    if (result.mode === mode &&
                        result.punctuation === punctuation &&
                        result.language === language &&
                        result.difficulty === difficulty &&
                        (result.lazyMode === lazyMode ||
                            (result.lazyMode === undefined && lazyMode === false)) &&
                        (activeTagIds.length === 0 ||
                            activeTagIds.some((tagId) => result.tags.includes(tagId)))) {
                        // Continue if the mode2 doesn't match and it's not a quote
                        if (result.mode2 !== mode2 && mode !== "quote") {
                            continue;
                        }
                        // Grab the most recent results from the current mode
                        if (last10Count < 10) {
                            last10Wpm += result.wpm;
                            last10Acc += result.acc;
                            last10Count++;
                        }
                        // Check if the mode2 matches and if it does, add it to the sum, for quotes, this is the quote id
                        if (result.mode2 === mode2) {
                            wpmSum += result.wpm;
                            accSum += result.acc;
                            count++;
                            if (count >= 10)
                                break;
                        }
                    }
                }
            }
            // Return the last 10 average wpm & acc for quote
            // if the current quote id has never been completed before by the user
            if (count === 0 && mode === "quote") {
                return [last10Wpm / last10Count, last10Acc / last10Count];
            }
            return [wpmSum / count, accSum / count];
        }
        const retval = snapshot === null || (yield getUserResults()) === null ? [0, 0] : cont();
        return retval;
    });
}
exports.getUserAverage10 = getUserAverage10;
function getLocalPB(mode, mode2, punctuation, language, difficulty, lazyMode, funbox) {
    return __awaiter(this, void 0, void 0, function* () {
        if (funbox !== "none" && funbox !== "plus_one" && funbox !== "plus_two") {
            return 0;
        }
        function cont() {
            let ret = 0;
            try {
                if (!dbSnapshot.personalBests)
                    return ret;
                dbSnapshot.personalBests[mode][mode2].forEach((pb) => {
                    if (pb.punctuation == punctuation &&
                        pb.difficulty == difficulty &&
                        pb.language == language &&
                        (pb.lazyMode === lazyMode ||
                            (pb.lazyMode === undefined && lazyMode === false))) {
                        ret = pb.wpm;
                    }
                });
                return ret;
            }
            catch (e) {
                return ret;
            }
        }
        const retval = dbSnapshot === null ? 0 : cont();
        return retval;
    });
}
exports.getLocalPB = getLocalPB;
function saveLocalPB(mode, mode2, punctuation, language, difficulty, lazyMode, wpm, acc, raw, consistency) {
    return __awaiter(this, void 0, void 0, function* () {
        if (mode == "quote")
            return;
        function cont() {
            let found = false;
            if (dbSnapshot.personalBests === undefined) {
                dbSnapshot.personalBests = {
                    time: {},
                    words: {},
                    zen: { zen: [] },
                    quote: { custom: [] },
                    custom: { custom: [] },
                };
            }
            if (dbSnapshot.personalBests[mode] === undefined) {
                if (mode === "zen") {
                    dbSnapshot.personalBests["zen"] = { zen: [] };
                }
                else {
                    dbSnapshot.personalBests[mode] = {
                        custom: [],
                    };
                }
            }
            if (dbSnapshot.personalBests[mode][mode2] === undefined) {
                dbSnapshot.personalBests[mode][mode2] =
                    [];
            }
            dbSnapshot.personalBests[mode][mode2].forEach((pb) => {
                if (pb.punctuation == punctuation &&
                    pb.difficulty == difficulty &&
                    pb.language == language &&
                    (pb.lazyMode === lazyMode ||
                        (pb.lazyMode === undefined && lazyMode === false))) {
                    found = true;
                    pb.wpm = wpm;
                    pb.acc = acc;
                    pb.raw = raw;
                    pb.timestamp = Date.now();
                    pb.consistency = consistency;
                    pb.lazyMode = lazyMode;
                }
            });
            if (!found) {
                //nothing found
                dbSnapshot.personalBests[mode][mode2].push({
                    language: language,
                    difficulty: difficulty,
                    lazyMode: lazyMode,
                    punctuation: punctuation,
                    wpm: wpm,
                    acc: acc,
                    raw: raw,
                    timestamp: Date.now(),
                    consistency: consistency,
                });
            }
        }
        if (dbSnapshot != null) {
            cont();
        }
    });
}
exports.saveLocalPB = saveLocalPB;
function getLocalTagPB(tagId, mode, mode2, punctuation, language, difficulty, lazyMode) {
    return __awaiter(this, void 0, void 0, function* () {
        function cont() {
            var _a, _b;
            let ret = 0;
            const filteredtag = ((_a = getSnapshot().tags) !== null && _a !== void 0 ? _a : []).filter((t) => t._id === tagId)[0];
            if (filteredtag === undefined)
                return ret;
            if (filteredtag.personalBests === undefined) {
                filteredtag.personalBests = {
                    time: {},
                    words: {},
                    zen: { zen: [] },
                    quote: { custom: [] },
                    custom: { custom: [] },
                };
            }
            try {
                const personalBests = ((_b = filteredtag.personalBests[mode][mode2]) !== null && _b !== void 0 ? _b : []);
                personalBests.forEach((pb) => {
                    if (pb.punctuation == punctuation &&
                        pb.difficulty == difficulty &&
                        pb.language == language &&
                        (pb.lazyMode === lazyMode ||
                            (pb.lazyMode === undefined && lazyMode === false))) {
                        ret = pb.wpm;
                    }
                });
            }
            catch (e) {
                console.log(e);
            }
            return ret;
        }
        const retval = dbSnapshot === null ? 0 : cont();
        return retval;
    });
}
exports.getLocalTagPB = getLocalTagPB;
function saveLocalTagPB(tagId, mode, mode2, punctuation, language, difficulty, lazyMode, wpm, acc, raw, consistency) {
    return __awaiter(this, void 0, void 0, function* () {
        if (mode == "quote")
            return;
        function cont() {
            var _a;
            const filteredtag = (_a = dbSnapshot.tags) === null || _a === void 0 ? void 0 : _a.filter((t) => t._id === tagId)[0];
            if (!filteredtag.personalBests) {
                filteredtag.personalBests = {
                    time: {},
                    words: {},
                    zen: { zen: [] },
                    quote: { custom: [] },
                    custom: { custom: [] },
                };
            }
            try {
                let found = false;
                if (filteredtag.personalBests[mode][mode2] === undefined) {
                    filteredtag.personalBests[mode][mode2] =
                        [];
                }
                filteredtag.personalBests[mode][mode2].forEach((pb) => {
                    if (pb.punctuation == punctuation &&
                        pb.difficulty == difficulty &&
                        pb.language == language &&
                        (pb.lazyMode === lazyMode ||
                            (pb.lazyMode === undefined && lazyMode === false))) {
                        found = true;
                        pb.wpm = wpm;
                        pb.acc = acc;
                        pb.raw = raw;
                        pb.timestamp = Date.now();
                        pb.consistency = consistency;
                        pb.lazyMode = lazyMode;
                    }
                });
                if (!found) {
                    //nothing found
                    filteredtag.personalBests[mode][mode2].push({
                        language: language,
                        difficulty: difficulty,
                        lazyMode: lazyMode,
                        punctuation: punctuation,
                        wpm: wpm,
                        acc: acc,
                        raw: raw,
                        timestamp: Date.now(),
                        consistency: consistency,
                    });
                }
            }
            catch (e) {
                //that mode or mode2 is not found
                filteredtag.personalBests = {
                    time: {},
                    words: {},
                    zen: { zen: [] },
                    quote: { custom: [] },
                    custom: { custom: [] },
                };
                if (mode === "zen") {
                    filteredtag.personalBests["zen"] = { zen: [] };
                }
                else {
                    filteredtag.personalBests[mode] = {
                        custom: [],
                    };
                }
                filteredtag.personalBests[mode][mode2] = [
                    {
                        language: language,
                        difficulty: difficulty,
                        lazyMode: lazyMode,
                        punctuation: punctuation,
                        wpm: wpm,
                        acc: acc,
                        raw: raw,
                        timestamp: Date.now(),
                        consistency: consistency,
                    },
                ];
            }
        }
        if (dbSnapshot != null) {
            cont();
        }
        return;
    });
}
exports.saveLocalTagPB = saveLocalTagPB;
function updateLbMemory(mode, mode2, language, rank, api = false) {
    return __awaiter(this, void 0, void 0, function* () {
        //could dbSnapshot just be used here instead of getSnapshot()
        if (mode === "time") {
            const timeMode = mode, timeMode2 = mode2;
            const snapshot = getSnapshot();
            if (snapshot.lbMemory === undefined) {
                snapshot.lbMemory = { time: { 15: { english: 0 }, 60: { english: 0 } } };
            }
            if (snapshot.lbMemory[timeMode] === undefined) {
                snapshot.lbMemory[timeMode] = {
                    15: { english: 0 },
                    60: { english: 0 },
                };
            }
            if (snapshot.lbMemory[timeMode][timeMode2] === undefined) {
                snapshot.lbMemory[timeMode][timeMode2] = {};
            }
            const current = snapshot.lbMemory[timeMode][timeMode2][language];
            snapshot.lbMemory[timeMode][timeMode2][language] = rank;
            if (api && current != rank) {
                yield ape_1.default.users.updateLeaderboardMemory(mode, mode2, language, rank);
            }
            setSnapshot(snapshot);
        }
    });
}
exports.updateLbMemory = updateLbMemory;
function saveConfig(config) {
    return __awaiter(this, void 0, void 0, function* () {
        if (firebase_1.Auth.currentUser !== null) {
            AccountButton.loading(true);
            const response = yield ape_1.default.configs.save(config);
            if (response.status !== 200) {
                Notifications.add("Failed to save config: " + response.message, -1);
            }
            AccountButton.loading(false);
        }
    });
}
exports.saveConfig = saveConfig;
function saveLocalResult(result) {
    const snapshot = getSnapshot();
    if (snapshot !== null && snapshot.results !== undefined) {
        snapshot.results.unshift(result);
        setSnapshot(snapshot);
    }
}
exports.saveLocalResult = saveLocalResult;
function updateLocalStats(stats) {
    const snapshot = getSnapshot();
    if (snapshot.globalStats === undefined) {
        snapshot.globalStats = {};
    }
    if (snapshot !== null && snapshot.globalStats !== undefined) {
        if (snapshot.globalStats.time == undefined) {
            snapshot.globalStats.time = stats.time;
        }
        else {
            snapshot.globalStats.time += stats.time;
        }
        if (snapshot.globalStats.started == undefined) {
            snapshot.globalStats.started = stats.started;
        }
        else {
            snapshot.globalStats.started += stats.started;
        }
        if (snapshot.globalStats.completed == undefined) {
            snapshot.globalStats.completed = 1;
        }
        else {
            snapshot.globalStats.completed += 1;
        }
    }
    setSnapshot(snapshot);
}
exports.updateLocalStats = updateLocalStats;
// export async function DB.getLocalTagPB(tagId) {
//   function cont() {
//     let ret = 0;
//     try {
//       ret = dbSnapshot.tags.filter((t) => t.id === tagId)[0].pb;
//       if (ret == undefined) {
//         ret = 0;
//       }
//       return ret;
//     } catch (e) {
//       return ret;
//     }
//   }
//   const retval = dbSnapshot !== null ? cont() : undefined;
//   return retval;
// }
// export async functio(tagId, wpm) {
//   function cont() {
//     dbSnapshot.tags.forEach((tag) => {
//       if (tag._id === tagId) {
//         tag.pb = wpm;
//       }
//     });
//   }
//   if (dbSnapshot != null) {
//     cont();
//   }
// }


/***/ }),

/***/ "./src/scripts/elements/account-button.ts":
/*!************************************************!*\
  !*** ./src/scripts/elements/account-button.ts ***!
  \************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = exports.loading = void 0;
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
function loading(truefalse) {
    if (truefalse) {
        $("#top #menu .account .icon").html('<i class="fas fa-fw fa-spin fa-circle-notch"></i>');
        $("#top #menu .account").css("opacity", 1).css("pointer-events", "none");
    }
    else {
        $("#top #menu .account .icon").html('<i class="fas fa-fw fa-user"></i>');
        $("#top #menu .account").css("opacity", 1).css("pointer-events", "auto");
    }
}
exports.loading = loading;
function update() {
    if (firebase_1.Auth.currentUser != null) {
        Misc.swapElements($("#menu .icon-button.login"), $("#menu .icon-button.account"), 250);
    }
    else {
        Misc.swapElements($("#menu .icon-button.account"), $("#menu .icon-button.login"), 250);
    }
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/elements/commandline-lists.ts":
/*!***************************************************!*\
  !*** ./src/scripts/elements/commandline-lists.ts ***!
  \***************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getList = exports.pushCurrent = exports.setCurrent = exports.defaultCommands = exports.updateThemeCommands = exports.commandsChallenges = exports.themeCommands = exports.updateCustomThemeListCommands = exports.customThemeListCommands = exports.customThemeCommands = exports.commandsEnableAds = exports.updatePresetCommands = exports.updateTagCommands = exports.commandsKeymapLayouts = exports.current = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./notifications */ "./src/scripts/elements/notifications.ts"));
const Sound = __importStar(__webpack_require__(/*! ../controllers/sound-controller */ "./src/scripts/controllers/sound-controller.ts"));
const ThemeController = __importStar(__webpack_require__(/*! ../controllers/theme-controller */ "./src/scripts/controllers/theme-controller.ts"));
const CustomTextPopup = __importStar(__webpack_require__(/*! ../popups/custom-text-popup */ "./src/scripts/popups/custom-text-popup.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const PractiseWords = __importStar(__webpack_require__(/*! ../test/practise-words */ "./src/scripts/test/practise-words.ts"));
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const Funbox = __importStar(__webpack_require__(/*! ../test/funbox */ "./src/scripts/test/funbox.ts"));
const TagController = __importStar(__webpack_require__(/*! ../controllers/tag-controller */ "./src/scripts/controllers/tag-controller.ts"));
const PresetController = __importStar(__webpack_require__(/*! ../controllers/preset-controller */ "./src/scripts/controllers/preset-controller.ts"));
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const ChallengeController = __importStar(__webpack_require__(/*! ../controllers/challenge-controller */ "./src/scripts/controllers/challenge-controller.ts"));
const PaceCaret = __importStar(__webpack_require__(/*! ../test/pace-caret */ "./src/scripts/test/pace-caret.ts"));
const TestInput = __importStar(__webpack_require__(/*! ../test/test-input */ "./src/scripts/test/test-input.ts"));
const ModesNotice = __importStar(__webpack_require__(/*! ../elements/modes-notice */ "./src/scripts/elements/modes-notice.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
exports.current = [];
function canBailOut() {
    return ((config_1.default.mode === "custom" &&
        CustomText.isWordRandom &&
        (CustomText.word >= 5000 || CustomText.word == 0)) ||
        (config_1.default.mode === "custom" &&
            !CustomText.isWordRandom &&
            !CustomText.isTimeRandom &&
            CustomText.text.length >= 5000) ||
        (config_1.default.mode === "custom" &&
            CustomText.isTimeRandom &&
            (CustomText.time >= 3600 || CustomText.time == 0)) ||
        (config_1.default.mode === "words" && config_1.default.words >= 5000) ||
        config_1.default.words === 0 ||
        (config_1.default.mode === "time" && (config_1.default.time >= 3600 || config_1.default.time === 0)) ||
        config_1.default.mode == "zen");
}
const commandsLayouts = {
    title: "Layout emulator...",
    configKey: "layout",
    list: [
        {
            id: "couldnotload",
            display: "Could not load the layouts list :(",
        },
    ],
};
Misc.getLayoutsList().then((layouts) => {
    commandsLayouts.list = [];
    commandsLayouts.list.push({
        id: "changeLayoutDefault",
        display: "off",
        configValue: "default",
        exec: () => {
            UpdateConfig.setLayout("default");
            TestLogic.restart();
        },
    });
    Object.keys(layouts).forEach((layout) => {
        commandsLayouts.list.push({
            id: "changeLayout" + Misc.capitalizeFirstLetterOfEachWord(layout),
            display: layout === "default" ? "off" : layout.replace(/_/g, " "),
            configValue: layout,
            exec: () => {
                // UpdateConfig.setSavedLayout(layout);
                UpdateConfig.setLayout(layout);
                TestLogic.restart();
            },
        });
    });
});
exports.commandsKeymapLayouts = {
    title: "Change keymap layout...",
    configKey: "keymapLayout",
    list: [
        {
            id: "couldnotload",
            display: "Could not load the layouts list :(",
        },
    ],
};
Misc.getLayoutsList().then((layouts) => {
    exports.commandsKeymapLayouts.list = [];
    exports.commandsKeymapLayouts.list.push({
        id: "changeKeymapLayoutOverrideSync",
        display: "emulator sync",
        configValue: "overrideSync",
        exec: () => {
            UpdateConfig.setKeymapLayout("overrideSync");
            TestLogic.restart();
        },
    });
    Object.keys(layouts).forEach((layout) => {
        if (layout.toString() != "default") {
            exports.commandsKeymapLayouts.list.push({
                id: "changeKeymapLayout" + Misc.capitalizeFirstLetterOfEachWord(layout),
                display: layout.replace(/_/g, " "),
                configValue: layout,
                exec: () => {
                    UpdateConfig.setKeymapLayout(layout);
                    TestLogic.restart();
                },
            });
        }
    });
});
const commandsLanguages = {
    title: "Language...",
    configKey: "language",
    list: [
        {
            id: "couldnotload",
            display: "Could not load the languages list :(",
        },
    ],
};
commandsLanguages.list = [];
Misc.getLanguageList().then((languages) => {
    languages.forEach((language) => {
        commandsLanguages.list.push({
            id: "changeLanguage" + Misc.capitalizeFirstLetterOfEachWord(language),
            display: language.replace(/_/g, " "),
            configValue: language,
            exec: () => {
                UpdateConfig.setLanguage(language);
                TestLogic.restart();
            },
        });
    });
});
const commandsFunbox = {
    title: "Funbox...",
    configKey: "funbox",
    list: [
        {
            id: "changeFunboxNone",
            display: "none",
            configValue: "none",
            alias: "off",
            exec: () => {
                if (Funbox.setFunbox("none", null)) {
                    TestLogic.restart();
                }
            },
        },
    ],
};
Misc.getFunboxList().then((funboxes) => {
    funboxes.forEach((funbox) => {
        commandsFunbox.list.push({
            id: "changeFunbox" + funbox.name,
            display: funbox.name.replace(/_/g, " "),
            configValue: funbox.name,
            exec: () => {
                if (Funbox.setFunbox(funbox.name, funbox.type)) {
                    TestLogic.restart();
                }
            },
        });
    });
});
const commandsFonts = {
    title: "Font family...",
    configKey: "fontFamily",
    list: [],
};
Misc.getFontsList().then((fonts) => {
    fonts.forEach((font) => {
        commandsFonts.list.push({
            id: "changeFont" + font.name.replace(/ /g, "_"),
            display: font.display !== undefined ? font.display : font.name,
            configValue: font.name,
            hover: () => {
                UpdateConfig.previewFontFamily(font.name);
            },
            exec: () => {
                UpdateConfig.setFontFamily(font.name.replace(/ /g, "_"));
            },
        });
    });
    commandsFonts.list.push({
        id: "setFontFamilyCustom",
        display: "custom...",
        input: true,
        hover: () => {
            UpdateConfig.previewFontFamily(config_1.default.fontFamily);
        },
        exec: (name) => {
            if (!name)
                return;
            UpdateConfig.setFontFamily(name.replace(/\s/g, "_"));
            // Settings.groups.fontFamily.updateInput();
        },
    });
});
const commandsTags = {
    title: "Change tags...",
    list: [],
};
function updateTagCommands() {
    var _a, _b, _c, _d;
    if ((_c = (_b = (_a = DB.getSnapshot()) === null || _a === void 0 ? void 0 : _a.tags) === null || _b === void 0 ? void 0 : _b.length) !== null && _c !== void 0 ? _c : 0 > 0) {
        commandsTags.list = [];
        commandsTags.list.push({
            id: "clearTags",
            display: `Clear tags`,
            icon: "fa-times",
            exec: () => {
                var _a;
                const snapshot = DB.getSnapshot();
                snapshot.tags = (_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.map((tag) => {
                    tag.active = false;
                    return tag;
                });
                DB.setSnapshot(snapshot);
                ModesNotice.update();
                TagController.saveActiveToLocalStorage();
            },
        });
        (_d = DB.getSnapshot().tags) === null || _d === void 0 ? void 0 : _d.forEach((tag) => {
            let dis = tag.name;
            if (tag.active === true) {
                dis = '<i class="fas fa-fw fa-check"></i>' + dis;
            }
            else {
                dis = '<i class="fas fa-fw"></i>' + dis;
            }
            commandsTags.list.push({
                id: "toggleTag" + tag._id,
                noIcon: true,
                display: dis,
                sticky: true,
                exec: () => {
                    TagController.toggle(tag._id);
                    ModesNotice.update();
                    if (config_1.default.paceCaret === "average") {
                        PaceCaret.init();
                        ModesNotice.update();
                    }
                    let txt = tag.name;
                    if (tag.active === true) {
                        txt = '<i class="fas fa-fw fa-check"></i>' + txt;
                    }
                    else {
                        txt = '<i class="fas fa-fw"></i>' + txt;
                    }
                    if ($("#commandLine").hasClass("allCommands")) {
                        $(`#commandLine .suggestions .entry[command='toggleTag${tag._id}']`).html(`<div class="icon"><i class="fas fa-fw fa-tag"></i></div><div>Tags  > ` +
                            txt);
                    }
                    else {
                        $(`#commandLine .suggestions .entry[command='toggleTag${tag._id}']`).html(txt);
                    }
                },
            });
        });
        // defaultCommands.list[4].visible = true;
    }
}
exports.updateTagCommands = updateTagCommands;
const commandsPresets = {
    title: "Presets...",
    list: [],
};
function updatePresetCommands() {
    const snapshot = DB.getSnapshot();
    if (!snapshot || !snapshot.presets || snapshot.presets.length === 0)
        return;
    commandsPresets.list = [];
    snapshot.presets.forEach((preset) => {
        const dis = preset.name;
        commandsPresets.list.push({
            id: "applyPreset" + preset._id,
            display: dis,
            exec: () => {
                Settings.setEventDisabled(true);
                PresetController.apply(preset._id);
                Settings.setEventDisabled(false);
                Settings.update();
                ModesNotice.update();
            },
        });
    });
}
exports.updatePresetCommands = updatePresetCommands;
const commandsRepeatQuotes = {
    title: "Repeat quotes...",
    configKey: "repeatQuotes",
    list: [
        {
            id: "setRepeatQuotesOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setRepeatQuotes("off");
            },
        },
        {
            id: "setRepeatQuotesTyping",
            display: "typing",
            configValue: "typing",
            exec: () => {
                UpdateConfig.setRepeatQuotes("typing");
            },
        },
    ],
};
const commandsLiveWpm = {
    title: "Live WPM...",
    configKey: "showLiveWpm",
    list: [
        {
            id: "setLiveWpmOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowLiveWpm(false);
            },
        },
        {
            id: "setLiveWpmOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowLiveWpm(true);
            },
        },
    ],
};
const commandsShowAverage = {
    title: "Show average...",
    configKey: "showAverage",
    list: [
        {
            id: "setShowAverageOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setShowAverage("off");
            },
        },
        {
            id: "setShowAverageSpeed",
            display: "wpm",
            configValue: "wpm",
            exec: () => {
                UpdateConfig.setShowAverage("wpm");
            },
        },
        {
            id: "setShowAverageAcc",
            display: "accuracy",
            configValue: "acc",
            exec: () => {
                UpdateConfig.setShowAverage("acc");
            },
        },
        {
            id: "setShowAverageBoth",
            display: "both",
            configValue: "both",
            exec: () => {
                UpdateConfig.setShowAverage("both");
            },
        },
    ],
};
const commandsLiveAcc = {
    title: "Live accuracy...",
    configKey: "showLiveAcc",
    list: [
        {
            id: "setLiveAccOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowLiveAcc(false);
            },
        },
        {
            id: "setLiveAccOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowLiveAcc(true);
            },
        },
    ],
};
const commandsLiveBurst = {
    title: "Live burst...",
    configKey: "showLiveBurst",
    list: [
        {
            id: "setLiveBurstOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowLiveBurst(false);
            },
        },
        {
            id: "setLiveBurstOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowLiveBurst(true);
            },
        },
    ],
};
const commandsShowTimer = {
    title: "Timer/progress...",
    configKey: "showTimerProgress",
    list: [
        {
            id: "setTimerProgressOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowTimerProgress(false);
            },
        },
        {
            id: "setTimerProgressOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowTimerProgress(true);
            },
        },
    ],
};
const commandsKeyTips = {
    title: "Key tips...",
    configKey: "showKeyTips",
    list: [
        {
            id: "setKeyTipsOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setKeyTips(false);
            },
        },
        {
            id: "setKeyTipsOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setKeyTips(true);
            },
        },
    ],
};
const commandsFreedomMode = {
    title: "Freedom mode...",
    configKey: "freedomMode",
    list: [
        {
            id: "setfreedomModeOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setFreedomMode(false);
            },
        },
        {
            id: "setfreedomModeOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setFreedomMode(true);
            },
        },
    ],
};
const commandsStrictSpace = {
    title: "Strict space...",
    configKey: "strictSpace",
    list: [
        {
            id: "setStrictSpaceOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setStrictSpace(false);
            },
        },
        {
            id: "setStrictSpaceOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setStrictSpace(true);
            },
        },
    ],
};
const commandsBlindMode = {
    title: "Blind mode...",
    configKey: "blindMode",
    list: [
        {
            id: "setBlindModeOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setBlindMode(false);
            },
        },
        {
            id: "setBlindModeOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setBlindMode(true);
            },
        },
    ],
};
const commandsShowWordsHistory = {
    title: "Always show words history...",
    configKey: "alwaysShowWordsHistory",
    list: [
        {
            id: "setAlwaysShowWordsHistoryOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setAlwaysShowWordsHistory(false);
            },
        },
        {
            id: "setAlwaysShowWordsHistoryOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setAlwaysShowWordsHistory(true);
            },
        },
    ],
};
const commandsIndicateTypos = {
    title: "Indicate typos...",
    configKey: "indicateTypos",
    list: [
        {
            id: "setIndicateTyposOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setIndicateTypos("off");
            },
        },
        {
            id: "setIndicateTyposBelow",
            display: "below",
            configValue: "below",
            exec: () => {
                UpdateConfig.setIndicateTypos("below");
            },
        },
        {
            id: "setIndicateTyposReplace",
            display: "replace",
            configValue: "replace",
            exec: () => {
                UpdateConfig.setIndicateTypos("replace");
            },
        },
    ],
};
const commandsHideExtraLetters = {
    title: "Hide extra letters...",
    configKey: "hideExtraLetters",
    list: [
        {
            id: "setHideExtraLettersOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setHideExtraLetters(false);
            },
        },
        {
            id: "setHideExtraLettersOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setHideExtraLetters(true);
            },
        },
    ],
};
const commandsQuickEnd = {
    title: "Quick end...",
    configKey: "quickEnd",
    list: [
        {
            id: "setQuickEndOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setQuickEnd(false);
            },
        },
        {
            id: "setQuickEndOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setQuickEnd(true);
            },
        },
    ],
};
const commandsOppositeShiftMode = {
    title: "Change opposite shift mode...",
    configKey: "oppositeShiftMode",
    list: [
        {
            id: "setOppositeShiftModeOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setOppositeShiftMode("off");
                ModesNotice.update();
            },
        },
        {
            id: "setOppositeShiftModeOn",
            display: "on",
            configValue: "on",
            exec: () => {
                UpdateConfig.setOppositeShiftMode("on");
                ModesNotice.update();
            },
        },
        {
            id: "setOppositeShiftModeKeymap",
            display: "keymap",
            configValue: "keymap",
            exec: () => {
                UpdateConfig.setOppositeShiftMode("keymap");
                ModesNotice.update();
            },
        },
    ],
};
const commandsSoundOnError = {
    title: "Sound on error...",
    configKey: "playSoundOnError",
    list: [
        {
            id: "setPlaySoundOnErrorOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setPlaySoundOnError(false);
            },
        },
        {
            id: "setPlaySoundOnErrorOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setPlaySoundOnError(true);
                Sound.playError();
            },
        },
    ],
};
const commandsSoundVolume = {
    title: "Sound volume...",
    configKey: "soundVolume",
    list: [
        {
            id: "setSoundVolume0.1",
            display: "quiet",
            configValue: "0.1",
            exec: () => {
                UpdateConfig.setSoundVolume("0.1");
                Sound.playClick();
            },
        },
        {
            id: "setSoundVolume0.5",
            display: "medium",
            configValue: "0.5",
            exec: () => {
                UpdateConfig.setSoundVolume("0.5");
                Sound.playClick();
            },
        },
        {
            id: "setSoundVolume1.0",
            display: "loud",
            configValue: "1.0",
            exec: () => {
                UpdateConfig.setSoundVolume("1.0");
                Sound.playClick();
            },
        },
    ],
};
const commandsFlipTestColors = {
    title: "Flip test colors...",
    configKey: "flipTestColors",
    list: [
        {
            id: "setFlipTestColorsOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setFlipTestColors(false);
            },
        },
        {
            id: "setFlipTestColorsOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setFlipTestColors(true);
            },
        },
    ],
};
const commandsSmoothLineScroll = {
    title: "Smooth line scroll...",
    configKey: "smoothLineScroll",
    list: [
        {
            id: "setSmoothLineScrollOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setSmoothLineScroll(false);
            },
        },
        {
            id: "setSmoothLineScrollOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setSmoothLineScroll(true);
            },
        },
    ],
};
const commandsAlwaysShowDecimal = {
    title: "Always show decimal places...",
    configKey: "alwaysShowDecimalPlaces",
    list: [
        {
            id: "setAlwaysShowDecimalPlacesOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setAlwaysShowDecimalPlaces(false);
            },
        },
        {
            id: "setAlwaysShowDecimalPlacesOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setAlwaysShowDecimalPlaces(true);
            },
        },
    ],
};
const commandsAlwaysShowCPM = {
    title: "Always show CPM...",
    configKey: "alwaysShowCPM",
    list: [
        {
            id: "setAlwaysShowCPMOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setAlwaysShowCPM(false);
            },
        },
        {
            id: "setAlwaysShowCPMOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setAlwaysShowCPM(true);
            },
        },
    ],
};
const commandsStartGraphsAtZero = {
    title: "Start graphs at zero...",
    configKey: "startGraphsAtZero",
    list: [
        {
            id: "setStartGraphsAtZeroOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setStartGraphsAtZero(false);
            },
        },
        {
            id: "setStartGraphsAtZeroOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setStartGraphsAtZero(true);
            },
        },
    ],
};
const commandsLazyMode = {
    title: "Lazy mode...",
    configKey: "lazyMode",
    list: [
        {
            id: "setLazyModeOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setLazyMode(false);
                TestLogic.restart();
            },
        },
        {
            id: "setLazyModeOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setLazyMode(true);
                TestLogic.restart();
            },
        },
    ],
};
const commandsSwapEscAndTab = {
    title: "Swap esc and tab...",
    configKey: "swapEscAndTab",
    list: [
        {
            id: "setSwapEscAndTabOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setSwapEscAndTab(false);
            },
        },
        {
            id: "setSwapEscAndTabOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setSwapEscAndTab(true);
            },
        },
    ],
};
const commandsShowAllLines = {
    title: "Show all lines...",
    configKey: "showAllLines",
    list: [
        {
            id: "setShowAllLinesOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowAllLines(false);
            },
        },
        {
            id: "setShowAllLinesOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowAllLines(true);
            },
        },
    ],
};
const commandsColorfulMode = {
    title: "Colorful mode...",
    configKey: "colorfulMode",
    list: [
        {
            id: "setColorfulModeOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setColorfulMode(false);
            },
        },
        {
            id: "setColorfulModeOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setColorfulMode(true);
            },
        },
    ],
};
const commandsOutOfFocusWarning = {
    title: "Colorful mode...",
    configKey: "showOutOfFocusWarning",
    list: [
        {
            id: "setShowOutOfFocusWarningOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowOutOfFocusWarning(false);
            },
        },
        {
            id: "setShowOutOfFocusWarningOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowOutOfFocusWarning(true);
            },
        },
    ],
};
const commandsKeymapMode = {
    title: "Keymap mode...",
    configKey: "keymapMode",
    list: [
        {
            id: "setKeymapModeOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setKeymapMode("off");
            },
        },
        {
            id: "setKeymapModeStatic",
            display: "static",
            configValue: "static",
            exec: () => {
                UpdateConfig.setKeymapMode("static");
            },
        },
        {
            id: "setKeymapModeNext",
            display: "next",
            configValue: "next",
            exec: () => {
                UpdateConfig.setKeymapMode("next");
            },
        },
        {
            id: "setKeymapModeReact",
            display: "react",
            alias: "flash",
            configValue: "react",
            exec: () => {
                UpdateConfig.setKeymapMode("react");
            },
        },
    ],
};
const commandsSoundOnClick = {
    title: "Sound on click...",
    configKey: "playSoundOnClick",
    list: [
        {
            id: "setSoundOnClickOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("off");
            },
        },
        {
            id: "setSoundOnClick1",
            display: "click",
            configValue: "1",
            hover: () => {
                Sound.previewClick("1");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("1");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick2",
            display: "beep",
            configValue: "2",
            hover: () => {
                Sound.previewClick("2");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("2");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick3",
            display: "pop",
            configValue: "3",
            hover: () => {
                Sound.previewClick("3");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("3");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick4",
            display: "nk creams",
            configValue: "4",
            hover: () => {
                Sound.previewClick("4");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("4");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick5",
            display: "typewriter",
            configValue: "5",
            hover: () => {
                Sound.previewClick("5");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("5");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick6",
            display: "osu",
            configValue: "6",
            hover: () => {
                Sound.previewClick("6");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("6");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick7",
            display: "hitmarker",
            configValue: "7",
            hover: () => {
                Sound.previewClick("7");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("7");
                Sound.playClick();
            },
        },
    ],
};
const commandsRandomTheme = {
    title: "Random theme...",
    configKey: "randomTheme",
    list: [
        {
            id: "setRandomOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setRandomTheme("off");
            },
        },
        {
            id: "setRandomOn",
            display: "on",
            configValue: "on",
            exec: () => {
                UpdateConfig.setRandomTheme("on");
            },
        },
        {
            id: "setRandomFav",
            display: "fav",
            configValue: "fav",
            exec: () => {
                UpdateConfig.setRandomTheme("fav");
            },
        },
        {
            id: "setRandomLight",
            display: "light",
            configValue: "light",
            exec: () => {
                UpdateConfig.setRandomTheme("light");
            },
        },
        {
            id: "setRandomDark",
            display: "dark",
            configValue: "dark",
            exec: () => {
                UpdateConfig.setRandomTheme("dark");
            },
        },
        {
            id: "setRandomCustom",
            display: "custom",
            configValue: "custom",
            exec: () => {
                if (firebase_1.Auth.currentUser === null) {
                    Notifications.add("Multiple custom themes are available to logged in users only", 0);
                    return;
                }
                UpdateConfig.setRandomTheme("custom");
            },
        },
    ],
};
const commandsDifficulty = {
    title: "Difficulty...",
    configKey: "difficulty",
    list: [
        {
            id: "setDifficultyNormal",
            display: "normal",
            configValue: "normal",
            exec: () => {
                UpdateConfig.setDifficulty("normal");
            },
        },
        {
            id: "setDifficultyExpert",
            display: "expert",
            configValue: "expert",
            exec: () => {
                UpdateConfig.setDifficulty("expert");
            },
        },
        {
            id: "setDifficultyMaster",
            display: "master",
            configValue: "master",
            exec: () => {
                UpdateConfig.setDifficulty("master");
            },
        },
    ],
};
exports.commandsEnableAds = {
    title: "Set enable ads...",
    configKey: "enableAds",
    list: [
        {
            id: "setEnableAdsOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setEnableAds("off");
            },
        },
        {
            id: "setEnableAdsOn",
            display: "on",
            configValue: "on",
            exec: () => {
                UpdateConfig.setEnableAds("on");
            },
        },
        {
            id: "setEnableMax",
            display: "sellout",
            configValue: "max",
            exec: () => {
                UpdateConfig.setEnableAds("max");
            },
        },
    ],
};
exports.customThemeCommands = {
    title: "Custom theme",
    configKey: "customTheme",
    list: [
        {
            id: "setCustomThemeOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setCustomTheme(false);
            },
        },
        {
            id: "setCustomThemeOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setCustomTheme(true);
            },
        },
    ],
};
exports.customThemeListCommands = {
    title: "Custom themes list...",
    // configKey: "customThemeId",
    list: [],
};
function updateCustomThemeListCommands() {
    if (firebase_1.Auth.currentUser === null) {
        return;
    }
    exports.customThemeListCommands.list = [];
    const snapshot = DB.getSnapshot();
    if (!snapshot)
        return;
    if (DB.getSnapshot().customThemes.length < 0) {
        Notifications.add("You need to create a custom theme first", 0);
        return;
    }
    DB.getSnapshot().customThemes.forEach((theme) => {
        exports.customThemeListCommands.list.push({
            id: "setCustomThemeId" + theme._id,
            display: theme.name,
            configValue: theme._id,
            hover: () => {
                ThemeController.preview(theme._id, true);
            },
            exec: () => {
                // UpdateConfig.setCustomThemeId(theme._id);
                UpdateConfig.setCustomTheme(true);
                ThemeController.set(theme._id, true);
            },
        });
    });
    return;
}
exports.updateCustomThemeListCommands = updateCustomThemeListCommands;
const commandsCaretStyle = {
    title: "Change caret style...",
    configKey: "caretStyle",
    list: [
        {
            id: "setCaretStyleOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setCaretStyle("off");
            },
        },
        {
            id: "setCaretStyleDefault",
            display: "line",
            configValue: "default",
            exec: () => {
                UpdateConfig.setCaretStyle("default");
            },
        },
        {
            id: "setCaretStyleBlock",
            display: "block",
            configValue: "block",
            exec: () => {
                UpdateConfig.setCaretStyle("block");
            },
        },
        {
            id: "setCaretStyleOutline",
            display: "outline-block",
            configValue: "outline",
            exec: () => {
                UpdateConfig.setCaretStyle("outline");
            },
        },
        {
            id: "setCaretStyleUnderline",
            display: "underline",
            configValue: "underline",
            exec: () => {
                UpdateConfig.setCaretStyle("underline");
            },
        },
        {
            id: "setCaretStyleCarrot",
            display: "carrot",
            configValue: "carrot",
            visible: false,
            exec: () => {
                UpdateConfig.setCaretStyle("carrot");
            },
        },
        {
            id: "setCaretStyleBanana",
            display: "banana",
            configValue: "banana",
            visible: false,
            exec: () => {
                UpdateConfig.setCaretStyle("banana");
            },
        },
    ],
};
const commandsPaceCaretStyle = {
    title: "Change pace caret style...",
    configKey: "paceCaretStyle",
    list: [
        {
            id: "setPaceCaretStyleDefault",
            display: "line",
            configValue: "default",
            exec: () => {
                UpdateConfig.setPaceCaretStyle("default");
            },
        },
        {
            id: "setPaceCaretStyleBlock",
            display: "block",
            configValue: "block",
            exec: () => {
                UpdateConfig.setPaceCaretStyle("block");
            },
        },
        {
            id: "setPaceCaretStyleOutline",
            display: "outline-block",
            configValue: "outline",
            exec: () => {
                UpdateConfig.setPaceCaretStyle("outline");
            },
        },
        {
            id: "setPaceCaretStyleUnderline",
            display: "underline",
            configValue: "underline",
            exec: () => {
                UpdateConfig.setPaceCaretStyle("underline");
            },
        },
        {
            id: "setPaceCaretStyleCarrot",
            display: "carrot",
            configValue: "carrot",
            visible: false,
            exec: () => {
                UpdateConfig.setPaceCaretStyle("carrot");
            },
        },
        {
            id: "setPaceCaretStyleBanana",
            display: "banana",
            configValue: "banana",
            visible: false,
            exec: () => {
                UpdateConfig.setPaceCaretStyle("banana");
            },
        },
    ],
};
const commandsRepeatedPace = {
    title: "Repeated pace...",
    configKey: "repeatedPace",
    list: [
        {
            id: "setRepeatedPaceOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setRepeatedPace(false);
            },
        },
        {
            id: "setRepeatedPaceOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setRepeatedPace(true);
            },
        },
    ],
};
const commandsPaceCaret = {
    title: "Pace caret mode...",
    configKey: "paceCaret",
    list: [
        {
            id: "setPaceCaretOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setPaceCaret("off");
                TestLogic.restart();
            },
        },
        {
            id: "setPaceCaretPb",
            display: "pb",
            configValue: "pb",
            exec: () => {
                UpdateConfig.setPaceCaret("pb");
                TestLogic.restart();
            },
        },
        {
            id: "setPaceCaretAverage",
            display: "average",
            configValue: "average",
            exec: () => {
                UpdateConfig.setPaceCaret("average");
                TestLogic.restart();
            },
        },
        {
            id: "setPaceCaretCustom",
            display: "custom...",
            configValue: "custom",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setPaceCaretCustomSpeed(parseInt(input));
                UpdateConfig.setPaceCaret("custom");
                TestLogic.restart();
            },
        },
    ],
};
const commandsMinWpm = {
    title: "Change min wpm mode...",
    configKey: "minWpm",
    list: [
        {
            id: "setMinWpmOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setMinWpm("off");
            },
        },
        {
            id: "setMinWpmCustom",
            display: "custom...",
            configValue: "custom",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMinWpmCustomSpeed(parseInt(input));
                UpdateConfig.setMinWpm("custom");
            },
        },
    ],
};
const commandsMinAcc = {
    title: "Change min accuracy mode...",
    configKey: "minAcc",
    list: [
        {
            id: "setMinAccOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setMinAcc("off");
            },
        },
        {
            id: "setMinAccCustom",
            display: "custom...",
            configValue: "custom",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMinAccCustom(parseInt(input));
                UpdateConfig.setMinAcc("custom");
            },
        },
    ],
};
const commandsMinBurst = {
    title: "Change min burst mode...",
    configKey: "minBurst",
    list: [
        {
            id: "setMinBurstOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setMinBurst("off");
            },
        },
        {
            id: "setMinBurstFixed",
            display: "fixed...",
            configValue: "fixed",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMinBurst("fixed");
                UpdateConfig.setMinBurstCustomSpeed(parseInt(input));
            },
        },
        {
            id: "setMinBurstFlex",
            display: "flex...",
            configValue: "flex",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMinBurst("flex");
                UpdateConfig.setMinBurstCustomSpeed(parseInt(input));
            },
        },
    ],
};
const commandsKeymapStyle = {
    title: "Keymap style...",
    configKey: "keymapStyle",
    list: [
        {
            id: "setKeymapStyleStaggered",
            display: "staggered",
            configValue: "staggered",
            exec: () => {
                UpdateConfig.setKeymapStyle("staggered");
            },
        },
        {
            id: "setKeymapStyleAlice",
            display: "alice",
            configValue: "alice",
            exec: () => {
                UpdateConfig.setKeymapStyle("alice");
            },
        },
        {
            id: "setKeymapStyleMatrix",
            display: "matrix",
            configValue: "matrix",
            exec: () => {
                UpdateConfig.setKeymapStyle("matrix");
            },
        },
        {
            id: "setKeymapStyleSplit",
            display: "split",
            configValue: "split",
            exec: () => {
                UpdateConfig.setKeymapStyle("split");
            },
        },
        {
            id: "setKeymapStyleSplitMatrix",
            display: "split matrix",
            configValue: "split_matrix",
            exec: () => {
                UpdateConfig.setKeymapStyle("split_matrix");
            },
        },
    ],
};
const commandsKeymapLegendStyle = {
    title: "Keymap legend style...",
    configKey: "keymapLegendStyle",
    list: [
        {
            id: "setKeymapLegendStyleLowercase",
            display: "lowercase",
            configValue: "lowercase",
            exec: () => {
                UpdateConfig.setKeymapLegendStyle("lowercase");
            },
        },
        {
            id: "setKeymapLegendStyleUppercase",
            display: "uppercase",
            configValue: "uppercase",
            exec: () => {
                UpdateConfig.setKeymapLegendStyle("uppercase");
            },
        },
        {
            id: "setKeymapLegendStyleBlank",
            display: "blank",
            configValue: "blank",
            exec: () => {
                UpdateConfig.setKeymapLegendStyle("blank");
            },
        },
        {
            id: "setKeymapLegendStyleDynamic",
            display: "dynamic",
            configValue: "dynamic",
            exec: () => {
                UpdateConfig.setKeymapLegendStyle("dynamic");
            },
        },
    ],
};
const commandsBritishEnglish = {
    title: "British english...",
    configKey: "britishEnglish",
    list: [
        {
            id: "setBritishEnglishOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setBritishEnglish(false);
                TestLogic.restart();
            },
        },
        {
            id: "setBritishEnglishOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setBritishEnglish(true);
                TestLogic.restart();
            },
        },
    ],
};
const commandsHighlightMode = {
    title: "Highlight mode...",
    configKey: "highlightMode",
    list: [
        {
            id: "setHighlightModeOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setHighlightMode("off");
            },
        },
        {
            id: "setHighlightModeLetter",
            display: "letter",
            configValue: "letter",
            exec: () => {
                UpdateConfig.setHighlightMode("letter");
            },
        },
        {
            id: "setHighlightModeWord",
            display: "word",
            configValue: "word",
            exec: () => {
                UpdateConfig.setHighlightMode("word");
            },
        },
    ],
};
const commandsTimerStyle = {
    title: "Timer/progress style...",
    configKey: "timerStyle",
    list: [
        {
            id: "setTimerStyleBar",
            display: "bar",
            configValue: "bar",
            exec: () => {
                UpdateConfig.setTimerStyle("bar");
            },
        },
        {
            id: "setTimerStyleText",
            display: "text",
            configValue: "text",
            exec: () => {
                UpdateConfig.setTimerStyle("text");
            },
        },
        {
            id: "setTimerStyleMini",
            display: "mini",
            configValue: "mini",
            exec: () => {
                UpdateConfig.setTimerStyle("mini");
            },
        },
    ],
};
const commandsTimerColor = {
    title: "Timer/progress color...",
    configKey: "timerColor",
    list: [
        {
            id: "setTimerColorBlack",
            display: "black",
            configValue: "black",
            exec: () => {
                UpdateConfig.setTimerColor("black");
            },
        },
        {
            id: "setTimerColorSub",
            display: "sub",
            configValue: "sub",
            exec: () => {
                UpdateConfig.setTimerColor("sub");
            },
        },
        {
            id: "setTimerColorText",
            display: "text",
            configValue: "text",
            exec: () => {
                UpdateConfig.setTimerColor("text");
            },
        },
        {
            id: "setTimerColorMain",
            display: "main",
            configValue: "main",
            exec: () => {
                UpdateConfig.setTimerColor("main");
            },
        },
    ],
};
const commandsSingleListCommandLine = {
    title: "Single list command line...",
    configKey: "singleListCommandLine",
    list: [
        {
            id: "singleListCommandLineManual",
            display: "manual",
            configValue: "manual",
            exec: () => {
                UpdateConfig.setSingleListCommandLine("manual");
            },
        },
        {
            id: "singleListCommandLineOn",
            display: "on",
            configValue: "on",
            exec: () => {
                UpdateConfig.setSingleListCommandLine("on");
            },
        },
    ],
};
const commandsCapsLockWarning = {
    title: "Caps lock warning...",
    configKey: "capsLockWarning",
    list: [
        {
            id: "capsLockWarningOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setCapsLockWarning(true);
            },
        },
        {
            id: "capsLockWarningOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setCapsLockWarning(false);
            },
        },
    ],
};
const commandsTimerOpacity = {
    title: "Timer/progress opacity...",
    configKey: "timerOpacity",
    list: [
        {
            id: "setTimerOpacity.25",
            display: ".25",
            configValue: 0.25,
            exec: () => {
                UpdateConfig.setTimerOpacity("0.25");
            },
        },
        {
            id: "setTimerOpacity.5",
            display: ".5",
            configValue: 0.5,
            exec: () => {
                UpdateConfig.setTimerOpacity("0.5");
            },
        },
        {
            id: "setTimerOpacity.75",
            display: ".75",
            configValue: 0.75,
            exec: () => {
                UpdateConfig.setTimerOpacity("0.75");
            },
        },
        {
            id: "setTimerOpacity1",
            display: "1",
            configValue: 1,
            exec: () => {
                UpdateConfig.setTimerOpacity("1");
            },
        },
    ],
};
const commandsWordCount = {
    title: "Change word count...",
    configKey: "words",
    list: [
        {
            id: "changeWordCount10",
            display: "10",
            configValue: 10,
            exec: () => {
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(10);
                TestLogic.restart();
            },
        },
        {
            id: "changeWordCount25",
            display: "25",
            configValue: 25,
            exec: () => {
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(25);
                TestLogic.restart();
            },
        },
        {
            id: "changeWordCount50",
            display: "50",
            configValue: 50,
            exec: () => {
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(50);
                TestLogic.restart();
            },
        },
        {
            id: "changeWordCount100",
            display: "100",
            configValue: 100,
            exec: () => {
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(100);
                TestLogic.restart();
            },
        },
        {
            id: "changeWordCount200",
            display: "200",
            configValue: 200,
            exec: () => {
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(200);
                TestLogic.restart();
            },
        },
        {
            id: "changeWordCountCustom",
            display: "custom...",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(parseInt(input));
                TestLogic.restart();
            },
        },
    ],
};
const commandsQuoteLengthConfig = {
    title: "Change quote length...",
    configKey: "quoteLength",
    list: [
        {
            id: "changeQuoteLengthAll",
            display: "all",
            configValue: [0, 1, 2, 3],
            exec: () => {
                UpdateConfig.setMode("quote");
                UpdateConfig.setQuoteLength([0, 1, 2, 3]);
                TestLogic.restart();
            },
        },
        {
            id: "changeQuoteLengthShort",
            display: "short",
            configValue: 0,
            configValueMode: "include",
            exec: () => {
                UpdateConfig.setMode("quote");
                UpdateConfig.setQuoteLength(0);
                TestLogic.restart();
            },
        },
        {
            id: "changeQuoteLengthMedium",
            display: "medium",
            configValue: 1,
            configValueMode: "include",
            exec: () => {
                UpdateConfig.setMode("quote");
                UpdateConfig.setQuoteLength(1);
                TestLogic.restart();
            },
        },
        {
            id: "changeQuoteLengthLong",
            display: "long",
            configValue: 2,
            configValueMode: "include",
            exec: () => {
                UpdateConfig.setMode("quote");
                UpdateConfig.setQuoteLength(2);
                TestLogic.restart();
            },
        },
        {
            id: "changeQuoteLengthThicc",
            display: "thicc",
            configValue: 3,
            configValueMode: "include",
            exec: () => {
                UpdateConfig.setMode("quote");
                UpdateConfig.setQuoteLength(3);
                TestLogic.restart();
            },
        },
    ],
};
const commandsPunctuation = {
    title: "Change punctuation...",
    configKey: "punctuation",
    list: [
        {
            id: "changePunctuationOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setPunctuation(true);
                TestLogic.restart();
            },
        },
        {
            id: "changePunctuationOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setPunctuation(false);
                TestLogic.restart();
            },
        },
    ],
};
const commandsNumbers = {
    title: "Numbers...",
    configKey: "numbers",
    list: [
        {
            id: "changeNumbersOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setNumbers(true);
                TestLogic.restart();
            },
        },
        {
            id: "changeNumbersOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setNumbers(false);
                TestLogic.restart();
            },
        },
    ],
};
const commandsSmoothCaret = {
    title: "Smooth caret...",
    configKey: "smoothCaret",
    list: [
        {
            id: "changeSmoothCaretOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setSmoothCaret(true);
            },
        },
        {
            id: "changeSmoothCaretOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setSmoothCaret(false);
            },
        },
    ],
};
const commandsQuickTab = {
    title: "Quick tab...",
    configKey: "quickTab",
    list: [
        {
            id: "changeQuickTabOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setQuickTabMode(true);
            },
        },
        {
            id: "changeQuickTabOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setQuickTabMode(false);
            },
        },
    ],
};
const commandsMode = {
    title: "Change mode...",
    configKey: "mode",
    list: [
        {
            id: "changeModeTime",
            display: "time",
            configValue: "time",
            exec: () => {
                UpdateConfig.setMode("time");
                TestLogic.restart();
            },
        },
        {
            id: "changeModeWords",
            display: "words",
            configValue: "words",
            exec: () => {
                UpdateConfig.setMode("words");
                TestLogic.restart();
            },
        },
        {
            id: "changeModeQuote",
            display: "quote",
            configValue: "quote",
            exec: () => {
                UpdateConfig.setMode("quote");
                TestLogic.restart();
            },
        },
        {
            id: "changeModeCustom",
            display: "custom",
            configValue: "custom",
            exec: () => {
                UpdateConfig.setMode("custom");
                TestLogic.restart();
            },
        },
        {
            id: "changeModeZen",
            display: "zen",
            configValue: "zen",
            exec: () => {
                UpdateConfig.setMode("zen");
                ManualRestart.set();
                TestLogic.restart();
            },
        },
    ],
};
const commandsTimeConfig = {
    title: "Change time config...",
    configKey: "time",
    list: [
        {
            id: "changeTimeConfig15",
            display: "15",
            configValue: 15,
            exec: () => {
                UpdateConfig.setMode("time");
                UpdateConfig.setTimeConfig(15);
                TestLogic.restart();
            },
        },
        {
            id: "changeTimeConfig30",
            display: "30",
            configValue: 30,
            exec: () => {
                UpdateConfig.setMode("time");
                UpdateConfig.setTimeConfig(30);
                TestLogic.restart();
            },
        },
        {
            id: "changeTimeConfig60",
            display: "60",
            configValue: 60,
            exec: () => {
                UpdateConfig.setMode("time");
                UpdateConfig.setTimeConfig(60);
                TestLogic.restart();
            },
        },
        {
            id: "changeTimeConfig120",
            display: "120",
            configValue: 120,
            exec: () => {
                UpdateConfig.setMode("time");
                UpdateConfig.setTimeConfig(120);
                TestLogic.restart();
            },
        },
        {
            id: "changeTimeConfigCustom",
            display: "custom...",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMode("time");
                UpdateConfig.setTimeConfig(parseInt(input));
                TestLogic.restart();
            },
        },
    ],
};
const commandsConfidenceMode = {
    title: "Confidence mode...",
    configKey: "confidenceMode",
    list: [
        {
            id: "changeConfidenceModeOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setConfidenceMode("off");
            },
        },
        {
            id: "changeConfidenceModeOn",
            display: "on",
            configValue: "on",
            exec: () => {
                UpdateConfig.setConfidenceMode("on");
            },
        },
        {
            id: "changeConfidenceModeMax",
            display: "max",
            configValue: "max",
            exec: () => {
                UpdateConfig.setConfidenceMode("max");
            },
        },
    ],
};
const commandsStopOnError = {
    title: "Stop on error...",
    configKey: "stopOnError",
    list: [
        {
            id: "changeStopOnErrorOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setStopOnError("off");
            },
        },
        {
            id: "changeStopOnErrorLetter",
            display: "letter",
            configValue: "letter",
            exec: () => {
                UpdateConfig.setStopOnError("letter");
            },
        },
        {
            id: "changeStopOnErrorWord",
            display: "word",
            configValue: "word",
            exec: () => {
                UpdateConfig.setStopOnError("word");
            },
        },
    ],
};
const commandsFontSize = {
    title: "Font size...",
    configKey: "fontSize",
    list: [
        {
            id: "changeFontSize1",
            display: "1x",
            configValue: 1,
            exec: () => {
                UpdateConfig.setFontSize("1");
                TestLogic.restart();
            },
        },
        {
            id: "changeFontSize125",
            display: "1.25x",
            configValue: 125,
            exec: () => {
                UpdateConfig.setFontSize("125");
                TestLogic.restart();
            },
        },
        {
            id: "changeFontSize15",
            display: "1.5x",
            configValue: 15,
            exec: () => {
                UpdateConfig.setFontSize("15");
                TestLogic.restart();
            },
        },
        {
            id: "changeFontSize2",
            display: "2x",
            configValue: 2,
            exec: () => {
                UpdateConfig.setFontSize("2");
                TestLogic.restart();
            },
        },
        {
            id: "changeFontSize3",
            display: "3x",
            configValue: 3,
            exec: () => {
                UpdateConfig.setFontSize("3");
                TestLogic.restart();
            },
        },
        {
            id: "changeFontSize4",
            display: "4x",
            configValue: 4,
            exec: () => {
                UpdateConfig.setFontSize("4");
                TestLogic.restart();
            },
        },
    ],
};
const commandsPageWidth = {
    title: "Page width...",
    configKey: "pageWidth",
    list: [
        {
            id: "setPageWidth100",
            display: "100",
            configValue: "100",
            exec: () => {
                UpdateConfig.setPageWidth("100");
            },
        },
        {
            id: "setPageWidth125",
            display: "125",
            configValue: "125",
            exec: () => {
                UpdateConfig.setPageWidth("125");
            },
        },
        {
            id: "setPageWidth150",
            display: "150",
            configValue: "150",
            exec: () => {
                UpdateConfig.setPageWidth("150");
            },
        },
        {
            id: "setPageWidth200",
            display: "200",
            configValue: "200",
            exec: () => {
                UpdateConfig.setPageWidth("200");
            },
        },
        {
            id: "setPageWidthMax",
            display: "max",
            configValue: "max",
            exec: () => {
                UpdateConfig.setPageWidth("max");
            },
        },
    ],
};
const commandsPractiseWords = {
    title: "Practice words...",
    list: [
        {
            id: "practiseWordsMissed",
            display: "missed",
            noIcon: true,
            exec: () => {
                PractiseWords.init(true, false);
                TestLogic.restart(false, false, undefined, true);
            },
        },
        {
            id: "practiseWordsSlow",
            display: "slow",
            noIcon: true,
            exec: () => {
                PractiseWords.init(false, true);
                TestLogic.restart(false, false, undefined, true);
            },
        },
        {
            id: "practiseWordsBoth",
            display: "both",
            noIcon: true,
            exec: () => {
                PractiseWords.init(true, true);
                TestLogic.restart(false, false, undefined, true);
            },
        },
    ],
};
exports.themeCommands = {
    title: "Theme...",
    configKey: "theme",
    list: [],
};
Misc.getThemesList().then((themes) => {
    themes.forEach((theme) => {
        exports.themeCommands.list.push({
            id: "changeTheme" + Misc.capitalizeFirstLetterOfEachWord(theme.name),
            display: theme.name.replace(/_/g, " "),
            configValue: theme.name,
            hover: () => {
                // previewTheme(theme.name);
                ThemeController.preview(theme.name, false);
            },
            exec: () => {
                UpdateConfig.setTheme(theme.name);
            },
        });
    });
});
exports.commandsChallenges = {
    title: "Load challenge...",
    list: [],
};
Misc.getChallengeList().then((challenges) => {
    challenges.forEach((challenge) => {
        exports.commandsChallenges.list.push({
            id: "loadChallenge" + Misc.capitalizeFirstLetterOfEachWord(challenge.name),
            noIcon: true,
            display: challenge.display,
            exec: () => {
                ChallengeController.setup(challenge.name);
                TestLogic.restart(false, true);
            },
        });
    });
});
// export function showFavouriteThemesAtTheTop() {
function updateThemeCommands() {
    if (config_1.default.favThemes.length > 0) {
        exports.themeCommands.list = [];
        config_1.default.favThemes.forEach((theme) => {
            exports.themeCommands.list.push({
                id: "changeTheme" + Misc.capitalizeFirstLetterOfEachWord(theme),
                display: theme.replace(/_/g, " "),
                hover: () => {
                    // previewTheme(theme);
                    ThemeController.preview(theme, false);
                },
                exec: () => {
                    UpdateConfig.setTheme(theme);
                },
            });
        });
        Misc.getThemesList().then((themes) => {
            themes.forEach((theme) => {
                if (config_1.default.favThemes.includes(theme.name))
                    return;
                exports.themeCommands.list.push({
                    id: "changeTheme" + Misc.capitalizeFirstLetterOfEachWord(theme.name),
                    display: theme.name.replace(/_/g, " "),
                    hover: () => {
                        // previewTheme(theme.name);
                        ThemeController.preview(theme.name, false);
                    },
                    exec: () => {
                        UpdateConfig.setTheme(theme.name);
                    },
                });
            });
        });
    }
}
exports.updateThemeCommands = updateThemeCommands;
const commandsCopyWordsToClipboard = {
    title: "Are you sure...",
    list: [
        {
            id: "copyNo",
            display: "Nevermind",
        },
        {
            id: "copyYes",
            display: "Yes, I am sure",
            exec: () => {
                const words = Misc.getWords();
                navigator.clipboard.writeText(words).then(() => {
                    Notifications.add("Copied to clipboard", 1);
                }, () => {
                    Notifications.add("Failed to copy!", -1);
                });
            },
        },
    ],
};
const commandsMonkeyPowerLevel = {
    title: "Power mode...",
    configKey: "monkeyPowerLevel",
    list: [
        {
            id: "monkeyPowerLevelOff",
            display: "off",
            configValue: "off",
            exec: () => UpdateConfig.setMonkeyPowerLevel("off"),
        },
        {
            id: "monkeyPowerLevel1",
            display: "mellow",
            configValue: "1",
            exec: () => UpdateConfig.setMonkeyPowerLevel("1"),
        },
        {
            id: "monkeyPowerLevel2",
            display: "high",
            configValue: "2",
            exec: () => UpdateConfig.setMonkeyPowerLevel("2"),
        },
        {
            id: "monkeyPowerLevel3",
            display: "ultra",
            configValue: "3",
            exec: () => UpdateConfig.setMonkeyPowerLevel("3"),
        },
        {
            id: "monkeyPowerLevel4",
            display: "over 9000",
            configValue: "4",
            exec: () => UpdateConfig.setMonkeyPowerLevel("4"),
        },
    ],
};
exports.defaultCommands = {
    title: "",
    list: [
        {
            id: "changePunctuation",
            display: "Punctuation...",
            icon: "!?",
            subgroup: commandsPunctuation,
        },
        {
            id: "changeMode",
            display: "Mode...",
            icon: "fa-bars",
            subgroup: commandsMode,
        },
        {
            id: "changeTimeConfig",
            display: "Time...",
            icon: "fa-clock",
            subgroup: commandsTimeConfig,
        },
        {
            id: "changeWordCount",
            display: "Words...",
            alias: "words",
            icon: "fa-font",
            subgroup: commandsWordCount,
        },
        {
            id: "changeQuoteLength",
            display: "Quote length...",
            icon: "fa-quote-right",
            alias: "quotes",
            subgroup: commandsQuoteLengthConfig,
        },
        {
            visible: false,
            id: "changeTags",
            display: "Tags...",
            icon: "fa-tag",
            subgroup: commandsTags,
            beforeSubgroup: () => {
                updateTagCommands();
            },
            // exec: (): void => {
            //   updateTagCommands();
            //   current.push();
            //   Commandline.show();
            // },
        },
        {
            visible: false,
            id: "applyPreset",
            display: "Presets...",
            icon: "fa-sliders-h",
            subgroup: commandsPresets,
            beforeSubgroup: () => {
                updatePresetCommands();
            },
            // exec: (): void => {
            //   updatePresetCommands();
            //   current.push(commandsPresets);
            //   Commandline.show();
            // },
        },
        {
            id: "changeConfidenceMode",
            display: "Confidence mode...",
            icon: "fa-backspace",
            subgroup: commandsConfidenceMode,
        },
        {
            id: "changeStopOnError",
            display: "Stop on error...",
            icon: "fa-hand-paper",
            subgroup: commandsStopOnError,
        },
        {
            id: "changeNumbers",
            display: "Numbers...",
            icon: "15",
            subgroup: commandsNumbers,
        },
        {
            id: "changeSmoothCaret",
            display: "Smooth caret...",
            icon: "fa-i-cursor",
            subgroup: commandsSmoothCaret,
        },
        {
            id: "changeQuickTab",
            display: "Quick tab...",
            icon: "fa-redo-alt",
            subgroup: commandsQuickTab,
        },
        {
            id: "changeRepeatQuotes",
            display: "Repeat quotes...",
            icon: "fa-sync-alt",
            subgroup: commandsRepeatQuotes,
        },
        {
            id: "changeLiveWpm",
            display: "Live WPM...",
            icon: "fa-tachometer-alt",
            subgroup: commandsLiveWpm,
        },
        {
            id: "changeLiveAcc",
            display: "Live accuracy...",
            icon: "fa-percentage",
            subgroup: commandsLiveAcc,
        },
        {
            id: "changeLiveBurst",
            display: "Live burst...",
            icon: "fa-fire-alt",
            subgroup: commandsLiveBurst,
        },
        {
            id: "changeShowTimer",
            display: "Timer/progress...",
            icon: "fa-clock",
            subgroup: commandsShowTimer,
        },
        {
            id: "changeKeyTips",
            display: "Key tips...",
            icon: "fa-question",
            subgroup: commandsKeyTips,
        },
        {
            id: "changeFreedomMode",
            display: "Freedom mode...",
            subgroup: commandsFreedomMode,
        },
        {
            id: "changeStrictSpace",
            display: "Strict space...",
            icon: "fa-minus",
            subgroup: commandsStrictSpace,
        },
        {
            id: "changeBlindMode",
            display: "Blind mode...",
            icon: "fa-eye-slash",
            subgroup: commandsBlindMode,
        },
        {
            id: "changeShowWordsHistory",
            display: "Always show words history...",
            icon: "fa-align-left",
            subgroup: commandsShowWordsHistory,
        },
        {
            id: "changeIndicateTypos",
            display: "Indicate typos...",
            icon: "fa-exclamation",
            subgroup: commandsIndicateTypos,
        },
        {
            id: "changeHideExtraLetters",
            display: "Hide extra letters...",
            icon: "fa-eye-slash",
            subgroup: commandsHideExtraLetters,
        },
        {
            id: "changeQuickEnd",
            display: "Quick end...",
            icon: "fa-step-forward",
            subgroup: commandsQuickEnd,
        },
        {
            id: "singleListCommandLine",
            display: "Single list command line...",
            icon: "fa-list",
            subgroup: commandsSingleListCommandLine,
        },
        {
            id: "capsLockWarning",
            display: "Caps lock warning...",
            icon: "fa-exclamation-triangle",
            subgroup: commandsCapsLockWarning,
        },
        {
            id: "changeMinWpm",
            display: "Minimum wpm...",
            alias: "minimum",
            icon: "fa-bomb",
            subgroup: commandsMinWpm,
        },
        {
            id: "changeMinAcc",
            display: "Minimum accuracy...",
            alias: "minimum",
            icon: "fa-bomb",
            subgroup: commandsMinAcc,
        },
        {
            id: "changeMinBurst",
            display: "Minimum burst...",
            alias: "minimum",
            icon: "fa-bomb",
            subgroup: commandsMinBurst,
        },
        {
            id: "changeOppositeShiftMode",
            display: "Change opposite shift mode...",
            icon: "fa-exchange-alt",
            subgroup: commandsOppositeShiftMode,
        },
        {
            id: "changeSoundOnClick",
            display: "Sound on click...",
            icon: "fa-volume-up",
            subgroup: commandsSoundOnClick,
        },
        {
            id: "changeSoundOnError",
            display: "Sound on error...",
            icon: "fa-volume-mute",
            subgroup: commandsSoundOnError,
        },
        {
            id: "changeSoundVolume",
            display: "Sound volume...",
            icon: "fa-volume-down",
            subgroup: commandsSoundVolume,
        },
        {
            id: "changeFlipTestColors",
            display: "Flip test colors...",
            icon: "fa-adjust",
            subgroup: commandsFlipTestColors,
        },
        {
            id: "changeSmoothLineScroll",
            display: "Smooth line scroll...",
            icon: "fa-align-left",
            subgroup: commandsSmoothLineScroll,
        },
        {
            id: "changeAlwaysShowDecimal",
            display: "Always show decimal places...",
            icon: "00",
            subgroup: commandsAlwaysShowDecimal,
        },
        {
            id: "changeAlwaysShowCPM",
            display: "Always show CPM...",
            icon: "fa-tachometer-alt",
            subgroup: commandsAlwaysShowCPM,
        },
        {
            id: "changeStartGraphsAtZero",
            display: "Start graphs at zero...",
            icon: "fa-chart-line",
            subgroup: commandsStartGraphsAtZero,
        },
        {
            id: "changeSwapEscAndTab",
            display: "Swap esc and tab...",
            icon: "fa-exchange-alt",
            subgroup: commandsSwapEscAndTab,
        },
        {
            id: "changeLazyMode",
            display: "Lazy mode...",
            icon: "fa-couch",
            subgroup: commandsLazyMode,
        },
        {
            id: "changeShowAllLines",
            display: "Show all lines...",
            icon: "fa-align-left",
            subgroup: commandsShowAllLines,
        },
        {
            id: "changeColorfulMode",
            display: "Colorful mode...",
            icon: "fa-fill-drip",
            subgroup: commandsColorfulMode,
        },
        {
            id: "changeOutOfFocusWarning",
            display: "Out of focus warning...",
            icon: "fa-exclamation",
            subgroup: commandsOutOfFocusWarning,
        },
        {
            id: "setEnableAds",
            display: "Enable ads...",
            icon: "fa-ad",
            subgroup: exports.commandsEnableAds,
        },
        {
            id: "changeTheme",
            display: "Theme...",
            icon: "fa-palette",
            subgroup: exports.themeCommands,
        },
        {
            id: "setCustomTheme",
            display: "Custom theme...",
            icon: "fa-palette",
            subgroup: exports.customThemeCommands,
        },
        {
            id: "setCustomThemeId",
            display: "Custom themes...",
            icon: "fa-palette",
            subgroup: exports.customThemeListCommands,
            beforeSubgroup: () => updateCustomThemeListCommands(),
            available: () => {
                return firebase_1.Auth.currentUser !== null;
            },
        },
        {
            id: "changeRandomTheme",
            display: "Random theme...",
            icon: "fa-random",
            subgroup: commandsRandomTheme,
        },
        {
            id: "randomizeTheme",
            display: "Next random theme",
            icon: "fa-random",
            exec: () => ThemeController.randomizeTheme(),
        },
        {
            id: "changeDifficulty",
            display: "Difficulty...",
            icon: "fa-star",
            subgroup: commandsDifficulty,
        },
        {
            id: "changeCaretStyle",
            display: "Caret style...",
            icon: "fa-i-cursor",
            subgroup: commandsCaretStyle,
        },
        {
            id: "changePaceCaret",
            display: "Pace caret mode...",
            icon: "fa-i-cursor",
            subgroup: commandsPaceCaret,
        },
        {
            id: "changePaceCaretStyle",
            display: "Pace caret style...",
            icon: "fa-i-cursor",
            subgroup: commandsPaceCaretStyle,
        },
        {
            id: "changeRepeatedPace",
            display: "Repeated pace...",
            icon: "fa-i-cursor",
            subgroup: commandsRepeatedPace,
        },
        {
            id: "changeTimerStyle",
            display: "Timer/progress style...",
            icon: "fa-clock",
            subgroup: commandsTimerStyle,
        },
        {
            id: "changeTimerColor",
            display: "Timer/progress color...",
            icon: "fa-clock",
            subgroup: commandsTimerColor,
        },
        {
            id: "changeTimerOpacity",
            display: "Timer/progress opacity...",
            icon: "fa-clock",
            subgroup: commandsTimerOpacity,
        },
        {
            id: "changeHighlightMode",
            display: "Highlight mode...",
            icon: "fa-highlighter",
            subgroup: commandsHighlightMode,
        },
        {
            id: "changeShowAverage",
            display: "Show average...",
            icon: "fa-chart-bar",
            subgroup: commandsShowAverage,
        },
        {
            id: "changeCustomBackground",
            display: "Custom background...",
            icon: "fa-image",
            defaultValue: "",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setCustomBackground(input);
            },
        },
        {
            id: "changeLanguage",
            display: "Language...",
            icon: "fa-language",
            subgroup: commandsLanguages,
        },
        {
            id: "changeBritishEnglish",
            display: "British english...",
            icon: "fa-language",
            subgroup: commandsBritishEnglish,
        },
        {
            id: "changeFunbox",
            display: "Funbox...",
            alias: "fun box",
            icon: "fa-gamepad",
            subgroup: commandsFunbox,
        },
        {
            id: "changeLayout",
            display: "Layout emulator...",
            icon: "fa-keyboard",
            subgroup: commandsLayouts,
        },
        {
            id: "toggleKeymap",
            display: "Keymap mode...",
            icon: "fa-keyboard",
            alias: "keyboard",
            subgroup: commandsKeymapMode,
        },
        {
            id: "changeKeymapStyle",
            display: "Keymap style...",
            alias: "keyboard",
            icon: "fa-keyboard",
            subgroup: commandsKeymapStyle,
        },
        {
            id: "changeKeymapLegendStyle",
            display: "Keymap legend style...",
            alias: "keyboard",
            icon: "fa-keyboard",
            subgroup: commandsKeymapLegendStyle,
        },
        {
            id: "changeKeymapLayout",
            display: "Keymap layout...",
            alias: "keyboard",
            icon: "fa-keyboard",
            subgroup: exports.commandsKeymapLayouts,
        },
        {
            id: "changeCustomLayoutfluid",
            display: "Custom layoutfluid...",
            defaultValue: "qwerty dvorak colemak",
            input: true,
            icon: "fa-tint",
            exec: (input) => {
                if (input === undefined)
                    return;
                UpdateConfig.setCustomLayoutfluid(input);
                if (config_1.default.funbox === "layoutfluid")
                    TestLogic.restart();
                // UpdateConfig.setLayout(
                //   Config.customLayoutfluid
                //     ? Config.customLayoutfluid.split("_")[0]
                //     : "qwerty"
                // );
                // UpdateConfig.setKeymapLayout(
                //   Config.customLayoutfluid
                //     ? Config.customLayoutfluid.split("_")[0]
                //     : "qwerty"
                // );
            },
        },
        {
            id: "changeFontSize",
            display: "Font size...",
            icon: "fa-font",
            subgroup: commandsFontSize,
        },
        {
            id: "changeFontFamily",
            display: "Font family...",
            icon: "fa-font",
            subgroup: commandsFonts,
        },
        {
            id: "changePageWidth",
            display: "Page width...",
            icon: "fa-arrows-alt-h",
            subgroup: commandsPageWidth,
        },
        {
            id: "viewTypingPage",
            display: "View Typing Page",
            alias: "start begin type test",
            icon: "fa-keyboard",
            exec: () => {
                $("#top #menu .icon-button.view-start").trigger("click");
            },
        },
        {
            id: "viewLeaderboards",
            display: "View Leaderboards Page",
            icon: "fa-crown",
            exec: () => {
                $("#top #menu .icon-button.view-leaderboards").trigger("click");
            },
        },
        {
            id: "viewAbout",
            display: "View About Page",
            icon: "fa-info",
            exec: () => {
                $("#top #menu .icon-button.view-about").trigger("click");
            },
        },
        {
            id: "viewSettings",
            display: "View Settings Page",
            icon: "fa-cog",
            exec: () => {
                $("#top #menu .icon-button.view-settings").trigger("click");
            },
        },
        {
            id: "viewQuoteSearchPopup",
            display: "Search for quotes",
            icon: "fa-search",
            exec: () => {
                UpdateConfig.setMode("quote");
                $("#quote-search-button").trigger("click");
            },
            shouldFocusTestUI: false,
        },
        {
            id: "viewAccount",
            display: "View Account Page",
            icon: "fa-user",
            alias: "stats",
            exec: () => {
                $("#top #menu .icon-button.view-account").hasClass("hidden")
                    ? $("#top #menu .icon-button.view-login").trigger("click")
                    : $("#top #menu .icon-button.view-account").trigger("click");
            },
        },
        {
            id: "toggleFullscreen",
            display: "Toggle Fullscreen",
            icon: "fa-expand",
            exec: () => {
                Misc.toggleFullscreen();
            },
        },
        {
            id: "bailOut",
            display: "Bail out...",
            icon: "fa-running",
            subgroup: {
                title: "Are you sure...",
                list: [
                    {
                        id: "bailOutNo",
                        display: "Nevermind",
                        available: () => {
                            return canBailOut();
                        },
                    },
                    {
                        id: "bailOutForSure",
                        display: "Yes, I am sure",
                        exec: () => {
                            TestInput.setBailout(true);
                            TestLogic.finish();
                        },
                        available: () => {
                            return canBailOut();
                        },
                    },
                ],
            },
            visible: false,
            available: () => {
                return canBailOut();
            },
        },
        {
            id: "loadChallenge",
            display: "Load challenge...",
            icon: "fa-award",
            subgroup: exports.commandsChallenges,
        },
        {
            id: "joinDiscord",
            display: "Join the Discord server",
            icon: "fa-users",
            exec: () => {
                window.open("https://discord.gg/monkeytype");
            },
        },
        {
            id: "repeatTest",
            display: "Repeat test",
            icon: "fa-sync-alt",
            exec: () => {
                TestLogic.restart(true);
            },
            available: () => {
                return TestUI.resultVisible;
            },
        },
        {
            id: "practiseWords",
            display: "Practice words...",
            icon: "fa-exclamation-triangle",
            subgroup: commandsPractiseWords,
            available: () => {
                return TestUI.resultVisible;
            },
        },
        {
            id: "toggleWordHistory",
            display: "Toggle word history",
            icon: "fa-align-left",
            exec: () => {
                TestUI.toggleResultWords();
            },
            available: () => {
                return TestUI.resultVisible;
            },
        },
        {
            id: "saveScreenshot",
            display: "Save screenshot",
            icon: "fa-image",
            alias: "ss picture",
            exec: () => {
                setTimeout(() => {
                    TestUI.screenshot();
                }, 500);
            },
            available: () => {
                return TestUI.resultVisible;
            },
        },
        {
            id: "changeCustomModeText",
            display: "Change custom text",
            icon: "fa-align-left",
            exec: () => {
                CustomTextPopup.show();
            },
        },
        {
            id: "toggleMonkey",
            display: "Toggle Monkey",
            icon: "fa-egg",
            visible: false,
            exec: () => {
                UpdateConfig.setMonkey(!config_1.default.monkey);
            },
        },
        {
            id: "copyWordsToClipboard",
            display: "Copy words to clipboard",
            icon: "fa-copy",
            subgroup: true,
            exec: () => {
                exports.current.push(commandsCopyWordsToClipboard);
            },
        },
        {
            id: "importSettingsJSON",
            display: "Import settings JSON",
            icon: "fa-cog",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                try {
                    UpdateConfig.apply(JSON.parse(input));
                    UpdateConfig.saveFullConfigToLocalStorage();
                    Settings.update();
                    Notifications.add("Done", 1);
                }
                catch (e) {
                    Notifications.add("An error occured while importing settings: " + e, -1);
                }
            },
        },
        {
            id: "exportSettingsJSON",
            display: "Export settings JSON",
            icon: "fa-cog",
            input: true,
            defaultValue: "",
        },
        {
            id: "monkeyPower",
            display: "Power mode...",
            alias: "powermode",
            icon: "fa-egg",
            visible: false,
            subgroup: commandsMonkeyPowerLevel,
        },
        {
            id: "clearSwCache",
            display: "Clear SW cache",
            icon: "fa-cog",
            exec: () => __awaiter(void 0, void 0, void 0, function* () {
                const clist = yield caches.keys();
                for (const name of clist) {
                    yield caches.delete(name);
                }
                window.location.reload();
            }),
        },
        {
            id: "getSwCache",
            display: "Get SW cache",
            icon: "fa-cog",
            exec: () => __awaiter(void 0, void 0, void 0, function* () {
                alert(yield caches.keys());
            }),
        },
    ],
};
exports.current = [exports.defaultCommands];
function setCurrent(val) {
    exports.current = val;
}
exports.setCurrent = setCurrent;
function pushCurrent(val) {
    exports.current.push(val);
}
exports.pushCurrent = pushCurrent;
const listsObject = {
    commandsChallenges: exports.commandsChallenges,
    commandsLanguages,
    commandsDifficulty,
    commandsLazyMode,
    commandsPaceCaret,
    commandsShowAverage,
    commandsMinWpm,
    commandsMinAcc,
    commandsMinBurst,
    commandsFunbox,
    commandsConfidenceMode,
    commandsStopOnError,
    commandsLayouts,
    commandsOppositeShiftMode,
    commandsTags,
};
function getList(list) {
    return listsObject[list];
}
exports.getList = getList;
ConfigEvent.subscribe((eventKey, eventValue) => {
    var _a;
    if (eventKey === "saveToLocalStorage") {
        exports.defaultCommands.list.filter((command) => command.id == "exportSettingsJSON")[0].defaultValue = eventValue;
    }
    if (eventKey === "customBackground") {
        exports.defaultCommands.list.filter((command) => command.id == "changeCustomBackground")[0].defaultValue = eventValue;
    }
    if (eventKey === "customLayoutFluid") {
        exports.defaultCommands.list.filter((command) => command.id == "changeCustomLayoutfluid")[0].defaultValue = (_a = eventValue) === null || _a === void 0 ? void 0 : _a.replace(/#/g, " ");
    }
});


/***/ }),

/***/ "./src/scripts/elements/commandline.ts":
/*!*********************************************!*\
  !*** ./src/scripts/elements/commandline.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.isSingleListCommandLineActive = void 0;
const ThemeController = __importStar(__webpack_require__(/*! ../controllers/theme-controller */ "./src/scripts/controllers/theme-controller.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Focus = __importStar(__webpack_require__(/*! ../test/focus */ "./src/scripts/test/focus.ts"));
const CommandlineLists = __importStar(__webpack_require__(/*! ./commandline-lists */ "./src/scripts/elements/commandline-lists.ts"));
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const AnalyticsController = __importStar(__webpack_require__(/*! ../controllers/analytics-controller */ "./src/scripts/controllers/analytics-controller.ts"));
const PageTransition = __importStar(__webpack_require__(/*! ../states/page-transition */ "./src/scripts/states/page-transition.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
let commandLineMouseMode = false;
function showInput(command, placeholder, defaultValue = "") {
    $("#commandLineWrapper").removeClass("hidden");
    $("#commandLine").addClass("hidden");
    $("#commandInput").removeClass("hidden");
    $("#commandInput input").attr("placeholder", placeholder);
    $("#commandInput input").val(defaultValue);
    $("#commandInput input").trigger("focus");
    $("#commandInput input").attr("command", "");
    $("#commandInput input").attr("command", command);
    if (defaultValue != "") {
        $("#commandInput input").select();
    }
}
function isSingleListCommandLineActive() {
    return $("#commandLine").hasClass("allCommands");
}
exports.isSingleListCommandLineActive = isSingleListCommandLineActive;
function showFound() {
    $("#commandLine .suggestions").empty();
    let commandsHTML = "";
    const list = CommandlineLists.current[CommandlineLists.current.length - 1];
    $.each(list.list, (_index, obj) => {
        var _a;
        if (obj.found && (obj.available !== undefined ? obj.available() : true)) {
            let icon = (_a = obj.icon) !== null && _a !== void 0 ? _a : "fa-chevron-right";
            const faIcon = /^fa-/g.test(icon);
            if (!faIcon) {
                icon = `<div class="textIcon">${icon}</div>`;
            }
            else {
                icon = `<i class="fas fa-fw ${icon}"></i>`;
            }
            if (list.configKey) {
                if ((obj.configValueMode &&
                    obj.configValueMode === "include" &&
                    // todo figure this out without using any
                    config_1.default[list.configKey].includes(obj.configValue)) ||
                    config_1.default[list.configKey] === obj.configValue) {
                    icon = `<i class="fas fa-fw fa-check"></i>`;
                }
                else {
                    icon = `<i class="fas fa-fw"></i>`;
                }
            }
            let iconHTML = `<div class="icon">${icon}</div>`;
            if (obj.noIcon && !isSingleListCommandLineActive()) {
                iconHTML = "";
            }
            commandsHTML += `<div class="entry" command="${obj.id}">${iconHTML}<div>${obj.display}</div></div>`;
        }
    });
    $("#commandLine .suggestions").html(commandsHTML);
    if ($("#commandLine .suggestions .entry").length == 0) {
        $("#commandLine .separator").css({ height: 0, margin: 0 });
    }
    else {
        $("#commandLine .separator").css({
            height: "1px",
            "margin-bottom": ".5rem",
        });
    }
    const entries = $("#commandLine .suggestions .entry");
    if (entries.length > 0) {
        $(entries[0]).addClass("activeKeyboard");
        try {
            $.each(list.list, (_index, obj) => {
                if (obj.found) {
                    if ((!/theme/gi.test(obj.id) || obj.id === "toggleCustomTheme") &&
                        !ThemeController.randomTheme) {
                        ThemeController.clearPreview();
                    }
                    if (!/font/gi.test(obj.id)) {
                        UpdateConfig.previewFontFamily(config_1.default.fontFamily);
                    }
                    if (obj.hover)
                        obj.hover();
                    return false;
                }
                else {
                    return true;
                }
            });
        }
        catch (e) { }
    }
    $("#commandLine .listTitle").remove();
}
function updateSuggested() {
    const inputVal = $("#commandLine input").val()
        .toLowerCase()
        .split(" ")
        .filter((s, i) => s || i == 0); //remove empty entries after first
    const list = CommandlineLists.current[CommandlineLists.current.length - 1];
    if (inputVal[0] === "" &&
        config_1.default.singleListCommandLine === "on" &&
        CommandlineLists.current.length === 1) {
        $.each(list.list, (_index, obj) => {
            obj.found = false;
        });
        showFound();
        return;
    }
    //ignore the preceeding ">"s in the command line input
    if (inputVal[0] && inputVal[0][0] == ">") {
        inputVal[0] = inputVal[0].replace(/^>+/, "");
    }
    if (inputVal[0] == "" && inputVal.length == 1) {
        $.each(list.list, (_index, obj) => {
            if (obj.visible !== false)
                obj.found = true;
        });
    }
    else {
        $.each(list.list, (_index, obj) => {
            let foundcount = 0;
            $.each(inputVal, (_index2, obj2) => {
                if (obj2 == "")
                    return;
                const escaped = obj2.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&");
                const re = new RegExp("\\b" + escaped, "g");
                const res = obj.display.toLowerCase().match(re);
                const res2 = obj.alias !== undefined ? obj.alias.toLowerCase().match(re) : null;
                if ((res != null && res.length > 0) ||
                    (res2 != null && res2.length > 0)) {
                    foundcount++;
                }
                else {
                    foundcount--;
                }
            });
            if (foundcount > inputVal.length - 1) {
                obj.found = true;
            }
            else {
                obj.found = false;
            }
        });
    }
    showFound();
}
let show = () => {
    if (!$(".page.pageLoading").hasClass("hidden"))
        return;
    Focus.set(false);
    $("#commandLine").removeClass("hidden");
    $("#commandInput").addClass("hidden");
    if ($("#commandLineWrapper").hasClass("hidden")) {
        $("#commandLineWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({
            opacity: 1,
        }, 100);
    }
    $("#commandLine input").val("");
    CommandlineLists.updateThemeCommands();
    updateSuggested();
    $("#commandLine input").trigger("focus");
};
exports.show = show;
function hide(shouldFocusTestUI = true) {
    UpdateConfig.previewFontFamily(config_1.default.fontFamily);
    // applyCustomThemeColors();
    if (!ThemeController.randomTheme) {
        ThemeController.clearPreview();
    }
    $("#commandLineWrapper")
        .stop(true, true)
        .css("opacity", 1)
        .animate({
        opacity: 0,
    }, 100, () => {
        $("#commandLineWrapper").addClass("hidden");
        $("#commandLine").removeClass("allCommands");
        if (shouldFocusTestUI) {
            TestUI.focusWords();
        }
    });
    if (shouldFocusTestUI) {
        TestUI.focusWords();
    }
}
function trigger(command) {
    let subgroup = false;
    let input = false;
    let shouldFocusTestUI = true;
    const list = CommandlineLists.current[CommandlineLists.current.length - 1];
    let sticky = false;
    $.each(list.list, (_index, obj) => {
        var _a;
        if (obj.id == command) {
            if (obj.shouldFocusTestUI !== undefined) {
                shouldFocusTestUI = obj.shouldFocusTestUI;
            }
            if (obj.input) {
                input = true;
                const escaped = (_a = obj.display.split("</i>")[1]) !== null && _a !== void 0 ? _a : obj.display;
                showInput(obj.id, escaped, obj.defaultValue);
            }
            else if (obj.subgroup) {
                subgroup = true;
                if (obj.beforeSubgroup) {
                    obj.beforeSubgroup();
                }
                CommandlineLists.current.push(obj.subgroup);
                (0, exports.show)();
            }
            else {
                if (obj.exec)
                    obj.exec();
                if (obj.sticky === true) {
                    sticky = true;
                }
            }
        }
    });
    if (!subgroup && !input && !sticky) {
        AnalyticsController.log("usedCommandLine", { command });
        hide(shouldFocusTestUI);
    }
}
//todo rewrite this mess
function addChildCommands(unifiedCommands, commandItem, parentCommandDisplay = "", parentCommand) {
    var _a, _b;
    let commandItemDisplay = commandItem.display.replace(/\s?\.\.\.$/g, "");
    let icon = `<i class="fas fa-fw"></i>`;
    if (commandItem.configValue !== undefined &&
        config_1.default[parentCommand === null || parentCommand === void 0 ? void 0 : parentCommand.configKey] ===
            commandItem.configValue) {
        icon = `<i class="fas fa-fw fa-check"></i>`;
    }
    if (commandItem.noIcon) {
        icon = "";
    }
    if (parentCommandDisplay) {
        commandItemDisplay =
            parentCommandDisplay + " > " + icon + commandItemDisplay;
    }
    if (commandItem.subgroup) {
        const command = commandItem;
        if (command.beforeSubgroup)
            command.beforeSubgroup();
        try {
            (_b = ((_a = commandItem) === null || _a === void 0 ? void 0 : _a.subgroup).list) === null || _b === void 0 ? void 0 : _b.forEach((cmd) => {
                commandItem.configKey = commandItem
                    .subgroup.configKey;
                addChildCommands(unifiedCommands, cmd, commandItemDisplay, commandItem);
            });
            // commandItem.exec();
            // const currentCommandsIndex = CommandlineLists.current.length - 1;
            // CommandlineLists.current[currentCommandsIndex].list.forEach((cmd) => {
            //   if (cmd.alias === undefined) cmd.alias = commandItem.alias;
            //   addChildCommands(unifiedCommands, cmd, commandItemDisplay);
            // });
            // CommandlineLists.current.pop();
        }
        catch (e) { }
    }
    else {
        const tempCommandItem = Object.assign({}, commandItem);
        if (parentCommand) {
            tempCommandItem.icon = parentCommand.icon;
        }
        if (parentCommandDisplay)
            tempCommandItem.display = commandItemDisplay;
        unifiedCommands.push(tempCommandItem);
    }
}
function generateSingleListOfCommands() {
    const allCommands = [];
    const oldShowCommandLine = exports.show;
    exports.show = () => {
        //
    };
    CommandlineLists.defaultCommands.list.forEach((c) => addChildCommands(allCommands, c));
    exports.show = oldShowCommandLine;
    return {
        title: "All Commands",
        list: allCommands,
    };
}
function useSingleListCommandLine(sshow = true) {
    const allCommands = generateSingleListOfCommands();
    // if (Config.singleListCommandLine == "manual") {
    // CommandlineLists.pushCurrent(allCommands);
    // } else if (Config.singleListCommandLine == "on") {
    CommandlineLists.setCurrent([allCommands]);
    // }
    if (config_1.default.singleListCommandLine != "manual") {
        $("#commandLine").addClass("allCommands");
    }
    if (sshow)
        (0, exports.show)();
}
function restoreOldCommandLine(sshow = true) {
    if (isSingleListCommandLineActive()) {
        $("#commandLine").removeClass("allCommands");
        CommandlineLists.setCurrent(CommandlineLists.current.filter((l) => l.title != "All Commands"));
        if (CommandlineLists.current.length < 1) {
            CommandlineLists.setCurrent([CommandlineLists.defaultCommands]);
        }
    }
    if (sshow)
        (0, exports.show)();
}
$("#commandLine input").keyup((e) => {
    commandLineMouseMode = false;
    $("#commandLineWrapper #commandLine .suggestions .entry").removeClass("activeMouse");
    if (e.key === "ArrowUp" ||
        e.key === "ArrowDown" ||
        e.key === "Enter" ||
        e.key === "Tab" ||
        e.code == "AltLeft" ||
        (e.key.length > 1 && e.key !== "Backspace" && e.key !== "Delete")) {
        return;
    }
    updateSuggested();
});
$(document).ready(() => {
    $(document).on("keydown", (event) => {
        if (PageTransition.get())
            return event.preventDefault();
        // opens command line if escape, ctrl/cmd + shift + p, or tab is pressed if the setting swapEscAndTab is enabled
        if (event.key === "Escape" ||
            (event.key &&
                event.key.toLowerCase() === "p" &&
                (event.metaKey || event.ctrlKey) &&
                event.shiftKey) ||
            (event.key === "Tab" && config_1.default.swapEscAndTab)) {
            event.preventDefault();
            const popups = document.querySelectorAll(".popupWrapper");
            let popupVisible = false;
            for (const popup of popups) {
                if (!popup.classList.contains("hidden") === true) {
                    popupVisible = true;
                    break;
                }
            }
            if (popupVisible)
                return;
            if (!$("#commandLineWrapper").hasClass("hidden")) {
                if (CommandlineLists.current.length > 1) {
                    CommandlineLists.current.pop();
                    $("#commandLine").removeClass("allCommands");
                    (0, exports.show)();
                }
                else {
                    hide();
                }
                UpdateConfig.setFontFamily(config_1.default.fontFamily, true);
            }
            else if (event.key === "Tab" || !config_1.default.swapEscAndTab) {
                if (config_1.default.singleListCommandLine == "on") {
                    useSingleListCommandLine(false);
                }
                else {
                    CommandlineLists.setCurrent([CommandlineLists.defaultCommands]);
                }
                (0, exports.show)();
            }
        }
    });
});
$("#commandInput input").on("keydown", (e) => {
    if (e.key === "Enter") {
        //enter
        e.preventDefault();
        const command = $("#commandInput input").attr("command");
        const value = $("#commandInput input").val();
        const list = CommandlineLists.current[CommandlineLists.current.length - 1];
        $.each(list.list, (_index, obj) => {
            if (obj.id == command) {
                if (obj.exec)
                    obj.exec(value);
                if (obj.subgroup !== null && obj.subgroup !== undefined) {
                    //TODO: what is this for?
                    // subgroup = obj.subgroup;
                }
            }
        });
        AnalyticsController.log("usedCommandLine", { command: command !== null && command !== void 0 ? command : "" });
        hide();
    }
    return;
});
$(document).on("mousemove", () => {
    if (!commandLineMouseMode)
        commandLineMouseMode = true;
});
$(document).on("mouseenter", "#commandLineWrapper #commandLine .suggestions .entry", (e) => {
    if (!commandLineMouseMode)
        return;
    $(e.target).addClass("activeMouse");
});
$(document).on("mouseleave", "#commandLineWrapper #commandLine .suggestions .entry", (e) => {
    if (!commandLineMouseMode)
        return;
    $(e.target).removeClass("activeMouse");
});
$("#commandLineWrapper #commandLine .suggestions").on("mouseover", (e) => {
    if (!commandLineMouseMode)
        return;
    // console.log("clearing keyboard active");
    $("#commandLineWrapper #commandLine .suggestions .entry").removeClass("activeKeyboard");
    const hoverId = $(e.target).attr("command");
    try {
        const list = CommandlineLists.current[CommandlineLists.current.length - 1];
        $.each(list.list, (_index, obj) => {
            if (obj.id == hoverId) {
                if ((!/theme/gi.test(obj.id) || obj.id === "toggleCustomTheme") &&
                    !ThemeController.randomTheme) {
                    ThemeController.clearPreview();
                }
                if (!/font/gi.test(obj.id)) {
                    UpdateConfig.previewFontFamily(config_1.default.fontFamily);
                }
                if (obj.hover)
                    obj.hover();
            }
        });
    }
    catch (e) { }
});
$(document).on("click", "#commandLineWrapper #commandLine .suggestions .entry", (e) => {
    $(".suggestions .entry").removeClass("activeKeyboard");
    trigger($(e.currentTarget).attr("command"));
});
$("#commandLineWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "commandLineWrapper") {
        hide();
        UpdateConfig.setFontFamily(config_1.default.fontFamily, true);
        // if (Config.customTheme === true) {
        //   applyCustomThemeColors();
        // } else {
        //   setTheme(Config.theme, true);
        // }
    }
});
//might come back to it later
// function shiftCommand(){
//   let activeEntries = $("#commandLineWrapper #commandLine .suggestions .entry.activeKeyboard, #commandLineWrapper #commandLine .suggestions .entry.activeMouse");
//   activeEntries.each((_index, activeEntry) => {
//     let commandId = activeEntry.getAttribute('command');
//     let foundCommand = null;
//     CommandlineLists.defaultCommands.list.forEach(command => {
//       if(foundCommand === null && command.id === commandId){
//         foundCommand = command;
//       }
//     })
//     if(foundCommand.shift){
//       $(activeEntry).find('div').text(foundCommand.shift.display);
//     }
//   })
// }
// let shiftedCommands = false;
// $(document).on("keydown", (e) => {
//   if (e.key === "Shift") {
//     if(shiftedCommands === false){
//       shiftedCommands = true;
//       shiftCommand();
//     }
//   }
// });
// $(document).keyup((e) => {
//   if (e.key === "Shift") {
//     shiftedCommands = false;
//   }
// });
$(document).on("keydown", (e) => {
    var _a, _b;
    // if (isPreviewingTheme) {
    // console.log("applying theme");
    // applyCustomThemeColors();
    // previewTheme(Config.theme, false);
    // }
    if (!$("#commandLineWrapper").hasClass("hidden")) {
        $("#commandLine input").trigger("focus");
        if (e.key == ">" && config_1.default.singleListCommandLine == "manual") {
            if (!isSingleListCommandLineActive()) {
                useSingleListCommandLine(false);
                return;
            }
            else if ($("#commandLine input").val() == ">") {
                //so that it will ignore succeeding ">" when input is already ">"
                e.preventDefault();
                return;
            }
        }
        if (e.key === "Backspace" || e.key === "Delete") {
            setTimeout(() => {
                const inputVal = $("#commandLine input").val();
                if (config_1.default.singleListCommandLine == "manual" &&
                    isSingleListCommandLineActive() &&
                    inputVal[0] !== ">") {
                    restoreOldCommandLine(false);
                }
            }, 1);
        }
        if (e.key === "Enter") {
            //enter
            e.preventDefault();
            const command = $(".suggestions .entry.activeKeyboard").attr("command");
            trigger(command);
            return;
        }
        if (e.key === "ArrowUp" || e.key === "ArrowDown" || e.key === "Tab") {
            e.preventDefault();
            $("#commandLineWrapper #commandLine .suggestions .entry").unbind("mouseenter mouseleave");
            const entries = $(".suggestions .entry");
            let activenum = -1;
            let hoverId;
            $.each(entries, (index, obj) => {
                if ($(obj).hasClass("activeKeyboard"))
                    activenum = index;
            });
            if (e.key === "ArrowUp" || (e.key === "Tab" && e.shiftKey)) {
                entries.removeClass("activeKeyboard");
                if (activenum == 0) {
                    $(entries[entries.length - 1]).addClass("activeKeyboard");
                    hoverId = $(entries[entries.length - 1]).attr("command");
                }
                else {
                    $(entries[--activenum]).addClass("activeKeyboard");
                    hoverId = $(entries[activenum]).attr("command");
                }
            }
            if (e.key === "ArrowDown" || (e.key === "Tab" && !e.shiftKey)) {
                entries.removeClass("activeKeyboard");
                if (activenum + 1 == entries.length) {
                    $(entries[0]).addClass("activeKeyboard");
                    hoverId = $(entries[0]).attr("command");
                }
                else {
                    $(entries[++activenum]).addClass("activeKeyboard");
                    hoverId = $(entries[activenum]).attr("command");
                }
            }
            try {
                const scroll = Math.abs(((_a = $(".suggestions").offset()) === null || _a === void 0 ? void 0 : _a.top) -
                    ((_b = $(".entry.activeKeyboard").offset()) === null || _b === void 0 ? void 0 : _b.top) -
                    $(".suggestions").scrollTop()) -
                    $(".suggestions").outerHeight() / 2 +
                    $($(".entry")[0]).outerHeight();
                $(".suggestions").scrollTop(scroll);
            }
            catch (e) {
                if (e instanceof Error) {
                    console.log("could not scroll suggestions: " + e.message);
                }
            }
            // console.log(`scrolling to ${scroll}`);
            try {
                const list = CommandlineLists.current[CommandlineLists.current.length - 1];
                $.each(list.list, (_index, obj) => {
                    if (obj.id == hoverId) {
                        if ((!/theme/gi.test(obj.id) || obj.id === "toggleCustomTheme") &&
                            !ThemeController.randomTheme) {
                            ThemeController.clearPreview();
                        }
                        if (!/font/gi.test(obj.id)) {
                            UpdateConfig.previewFontFamily(config_1.default.fontFamily);
                        }
                        if (obj.hover)
                            obj.hover();
                    }
                });
            }
            catch (e) { }
            return false;
        }
    }
    return;
});
$(document).on("click", "#commandLineMobileButton", () => {
    if (config_1.default.singleListCommandLine == "on") {
        useSingleListCommandLine(false);
    }
    else {
        CommandlineLists.setCurrent([CommandlineLists.defaultCommands]);
    }
    (0, exports.show)();
});
$(document).on("click", "#keymap .r5 .key-space", () => {
    CommandlineLists.setCurrent([CommandlineLists.commandsKeymapLayouts]);
    (0, exports.show)();
});
$(document).on("click", "#testModesNotice .text-button", (event) => {
    const commands = CommandlineLists.getList($(event.currentTarget).attr("commands"));
    if (commands !== undefined) {
        if ($(event.currentTarget).attr("commands") === "commandsTags") {
            CommandlineLists.updateTagCommands();
        }
        CommandlineLists.pushCurrent(commands);
        (0, exports.show)();
    }
});
$(document).on("click", "#bottom .leftright .right .current-theme", (e) => {
    if (e.shiftKey) {
        if (!config_1.default.customTheme) {
            if (firebase_1.Auth.currentUser !== null) {
                if (DB.getSnapshot().customThemes.length < 1) {
                    Notifications.add("No custom themes!", 0);
                    UpdateConfig.setCustomTheme(false);
                    // UpdateConfig.setCustomThemeId("");
                    return;
                }
                // if (!DB.getCustomThemeById(Config.customThemeId)) {
                //   // Turn on the first custom theme
                //   const firstCustomThemeId = DB.getSnapshot().customThemes[0]._id;
                //   UpdateConfig.setCustomThemeId(firstCustomThemeId);
                // }
            }
            UpdateConfig.setCustomTheme(true);
        }
        else
            UpdateConfig.setCustomTheme(false);
    }
    else {
        if (config_1.default.customTheme)
            CommandlineLists.updateCustomThemeListCommands();
        CommandlineLists.pushCurrent(config_1.default.customTheme
            ? CommandlineLists.customThemeListCommands
            : CommandlineLists.themeCommands);
        (0, exports.show)();
    }
});
$(document.body).on("click", ".pageAbout .aboutEnableAds", () => {
    CommandlineLists.pushCurrent(CommandlineLists.commandsEnableAds);
    (0, exports.show)();
});
$(".supportButtons .button.ads").on("click", () => {
    CommandlineLists.pushCurrent(CommandlineLists.commandsEnableAds);
    (0, exports.show)();
});


/***/ }),

/***/ "./src/scripts/elements/custom-background-filter.ts":
/*!**********************************************************!*\
  !*** ./src/scripts/elements/custom-background-filter.ts ***!
  \**********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.loadConfig = exports.apply = exports.getCSS = void 0;
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./notifications */ "./src/scripts/elements/notifications.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const filters = {
    blur: {
        value: 0,
        default: 0,
    },
    brightness: {
        value: 1,
        default: 1,
    },
    saturate: {
        value: 1,
        default: 1,
    },
    opacity: {
        value: 1,
        default: 1,
    },
};
function getCSS() {
    let ret = "";
    Object.keys(filters).forEach((filterKey) => {
        const key = filterKey;
        if (filters[key].value != filters[key].default) {
            ret += `${filterKey}(${filters[key].value}${filterKey == "blur" ? "rem" : ""}) `;
        }
    });
    return ret;
}
exports.getCSS = getCSS;
function apply() {
    const filterCSS = getCSS();
    const css = {
        filter: filterCSS,
        width: `calc(100% + ${filters.blur.value * 4}rem)`,
        height: `calc(100% + ${filters.blur.value * 4}rem)`,
        left: `-${filters.blur.value * 2}rem`,
        top: `-${filters.blur.value * 2}rem`,
        position: "absolute",
    };
    $(".customBackground img").css(css);
}
exports.apply = apply;
function syncSliders() {
    $(".section.customBackgroundFilter .blur input").val(filters["blur"].value);
    $(".section.customBackgroundFilter .brightness input").val(filters["brightness"].value);
    $(".section.customBackgroundFilter .saturate input").val(filters["saturate"].value);
    $(".section.customBackgroundFilter .opacity input").val(filters["opacity"].value);
}
function updateNumbers() {
    $(".section.customBackgroundFilter .blur .value").html(filters.blur.value.toFixed(1));
    $(".section.customBackgroundFilter .brightness .value").html(filters.brightness.value.toFixed(1));
    $(".section.customBackgroundFilter .saturate .value").html(filters.saturate.value.toFixed(1));
    $(".section.customBackgroundFilter .opacity .value").html(filters.opacity.value.toFixed(1));
}
function loadConfig(config) {
    filters.blur.value = config[0];
    filters.brightness.value = config[1];
    filters.saturate.value = config[2];
    filters.opacity.value = config[3];
    updateNumbers();
    syncSliders();
}
exports.loadConfig = loadConfig;
$(".section.customBackgroundFilter .blur input").on("input", () => {
    filters["blur"].value = parseFloat($(".section.customBackgroundFilter .blur input").val());
    updateNumbers();
    apply();
});
$(".section.customBackgroundFilter .brightness input").on("input", () => {
    filters["brightness"].value = parseFloat($(".section.customBackgroundFilter .brightness input").val());
    updateNumbers();
    apply();
});
$(".section.customBackgroundFilter .saturate input").on("input", () => {
    filters["saturate"].value = parseFloat($(".section.customBackgroundFilter .saturate input").val());
    updateNumbers();
    apply();
});
$(".section.customBackgroundFilter .opacity input").on("input", () => {
    filters["opacity"].value = parseFloat($(".section.customBackgroundFilter .opacity input").val());
    updateNumbers();
    apply();
});
$(".section.customBackgroundFilter  .save.button").on("click", () => {
    const arr = Object.keys(filters).map((filterKey) => filters[filterKey].value);
    UpdateConfig.setCustomBackgroundFilter(arr, false);
    Notifications.add("Custom background filters saved", 1);
});
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "customBackgroundFilter") {
        loadConfig(eventValue.map((ev) => parseFloat(ev)));
        apply();
    }
});


/***/ }),

/***/ "./src/scripts/elements/keymap.ts":
/*!****************************************!*\
  !*** ./src/scripts/elements/keymap.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.refresh = exports.show = exports.hide = exports.flashKey = exports.highlightKey = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ./theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
function highlightKey(currentKey) {
    if (config_1.default.mode === "zen")
        return;
    if (currentKey === "")
        currentKey = " ";
    try {
        if ($(".active-key") != undefined) {
            $(".active-key").removeClass("active-key");
        }
        let highlightKey;
        if (currentKey == " ") {
            highlightKey = "#keymap .key-space, #keymap .key-split-space";
        }
        else if (currentKey == '"') {
            highlightKey = `#keymap .keymap-key[data-key*='${currentKey}']`;
        }
        else {
            highlightKey = `#keymap .keymap-key[data-key*="${currentKey}"]`;
        }
        console.log("highlighting", highlightKey);
        $(highlightKey).addClass("active-key");
    }
    catch (e) {
        if (e instanceof Error) {
            console.log("could not update highlighted keymap key: " + e.message);
        }
    }
}
exports.highlightKey = highlightKey;
function flashKey(key, correct) {
    return __awaiter(this, void 0, void 0, function* () {
        if (key == undefined)
            return;
        if (key == " ") {
            key = "#keymap .key-space, #keymap .key-split-space";
        }
        else if (key == '"') {
            key = `#keymap .keymap-key[data-key*='${key}']`;
        }
        else {
            key = `#keymap .keymap-key[data-key*="${key}"]`;
        }
        const themecolors = yield ThemeColors.getAll();
        try {
            if (correct || config_1.default.blindMode) {
                $(key)
                    .stop(true, true)
                    .css({
                    color: themecolors.bg,
                    backgroundColor: themecolors.main,
                    borderColor: themecolors.main,
                })
                    .animate({
                    color: themecolors.sub,
                    backgroundColor: "transparent",
                    borderColor: themecolors.sub,
                }, SlowTimer.get() ? 0 : 500, "easeOutExpo");
            }
            else {
                $(key)
                    .stop(true, true)
                    .css({
                    color: themecolors.bg,
                    backgroundColor: themecolors.error,
                    borderColor: themecolors.error,
                })
                    .animate({
                    color: themecolors.sub,
                    backgroundColor: "transparent",
                    borderColor: themecolors.sub,
                }, SlowTimer.get() ? 0 : 500, "easeOutExpo");
            }
        }
        catch (e) { }
    });
}
exports.flashKey = flashKey;
function hide() {
    $("#keymap").addClass("hidden");
}
exports.hide = hide;
function show() {
    $("#keymap").removeClass("hidden");
}
exports.show = show;
function refresh(layoutName = config_1.default.layout) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!layoutName)
            return;
        try {
            const layouts = yield Misc.getLayoutsList();
            let lts = layouts[layoutName]; //layout to show
            let layoutString = layoutName;
            if (config_1.default.keymapLayout === "overrideSync") {
                if (config_1.default.layout === "default") {
                    lts = layouts["qwerty"];
                    layoutString = "default";
                }
                else {
                    lts = layouts[config_1.default.layout];
                    layoutString = config_1.default.layout;
                }
            }
            else {
                lts = layouts[config_1.default.keymapLayout];
                layoutString = config_1.default.keymapLayout;
            }
            const showTopRow = lts.keymapShowTopRow;
            const isMatrix = config_1.default.keymapStyle === "matrix" || config_1.default.keymapStyle === "split_matrix";
            let keymapElement = "";
            Object.keys(lts.keys).forEach((row, index) => {
                const rowKeys = lts.keys[row];
                let rowElement = "";
                if (row === "row1" && !showTopRow) {
                    return;
                }
                if ((row === "row2" || row === "row3" || row === "row4") && !isMatrix) {
                    rowElement += "<div></div>";
                }
                if (row === "row4" && lts.type !== "iso" && !isMatrix) {
                    rowElement += "<div></div>";
                }
                if (row === "row5") {
                    let layoutDisplay = layoutString.replace(/_/g, " ");
                    if (config_1.default.keymapLegendStyle === "blank") {
                        layoutDisplay = "";
                    }
                    rowElement += "<div></div>";
                    rowElement += `<div class="keymap-key key-space">
          <div class="letter">${layoutDisplay}</div>
        </div>`;
                    rowElement += `<div class="keymap-split-spacer"></div>`;
                    rowElement += `<div class="keymap-key key-split-space">
          <div class="letter"></div>
        </div>`;
                }
                else {
                    for (let i = 0; i < rowKeys.length; i++) {
                        if (row === "row2" && i === 12)
                            continue;
                        if ((config_1.default.keymapStyle === "matrix" ||
                            config_1.default.keymapStyle === "split_matrix") &&
                            i >= 10) {
                            continue;
                        }
                        const key = rowKeys[i];
                        const bump = row === "row3" && (i === 3 || i === 6) ? true : false;
                        let keyDisplay = key[0];
                        if (config_1.default.keymapLegendStyle === "blank") {
                            keyDisplay = "";
                        }
                        else if (config_1.default.keymapLegendStyle === "uppercase") {
                            keyDisplay = keyDisplay.toUpperCase();
                        }
                        const keyElement = `<div class="keymap-key" data-key="${key.replace('"', "&quot;")}">
              <span class="letter">${keyDisplay}</span>
              ${bump ? "<div class='bump'></div>" : ""}
          </div>`;
                        let splitSpacer = "";
                        if (config_1.default.keymapStyle === "split" ||
                            config_1.default.keymapStyle === "split_matrix" ||
                            config_1.default.keymapStyle === "alice") {
                            if (row === "row4" &&
                                (config_1.default.keymapStyle === "split" ||
                                    config_1.default.keymapStyle === "alice") &&
                                lts.type === "iso") {
                                if (i === 6) {
                                    splitSpacer += `<div class="keymap-split-spacer"></div>`;
                                }
                            }
                            else {
                                if (i === 5) {
                                    splitSpacer += `<div class="keymap-split-spacer"></div>`;
                                }
                            }
                        }
                        if (config_1.default.keymapStyle === "alice" && row === "row4") {
                            if ((lts.type === "iso" && i === 6) ||
                                (lts.type !== "iso" && i === 5)) {
                                splitSpacer += `<div class="extra-key"><span class="letter"></span></div>`;
                            }
                        }
                        rowElement += splitSpacer + keyElement;
                    }
                }
                keymapElement += `<div class="row r${index + 1}">${rowElement}</div>`;
            });
            $("#keymap").html(keymapElement);
            $("#keymap").removeClass("staggered");
            $("#keymap").removeClass("matrix");
            $("#keymap").removeClass("split");
            $("#keymap").removeClass("split_matrix");
            $("#keymap").removeClass("alice");
            $("#keymap").addClass(config_1.default.keymapStyle);
        }
        catch (e) {
            if (e instanceof Error) {
                console.log("something went wrong when changing layout, resettings: " + e.message);
                // UpdateConfig.setKeymapLayout("qwerty", true);
            }
        }
    });
}
exports.refresh = refresh;
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "layout" && config_1.default.keymapLayout === "overrideSync") {
        refresh(config_1.default.keymapLayout);
    }
    if (eventKey === "keymapLayout" || eventKey === "keymapStyle")
        refresh();
});


/***/ }),

/***/ "./src/scripts/elements/last-10-average.ts":
/*!*************************************************!*\
  !*** ./src/scripts/elements/last-10-average.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getAcc = exports.getWPM = exports.update = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestWords = __importStar(__webpack_require__(/*! ../test/test-words */ "./src/scripts/test/test-words.ts"));
let averageWPM = 0;
let averageAcc = 0;
function update() {
    return __awaiter(this, void 0, void 0, function* () {
        const mode2 = Misc.getMode2(config_1.default, TestWords.randomQuote);
        const [wpm, acc] = (yield DB.getUserAverage10(config_1.default.mode, mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode))
            .map(Misc.roundTo2)
            .map((num) => (config_1.default.alwaysShowDecimalPlaces ? Math.round(num) : num));
        averageWPM = wpm;
        averageAcc = acc;
    });
}
exports.update = update;
function getWPM() {
    return averageWPM;
}
exports.getWPM = getWPM;
function getAcc() {
    return averageAcc;
}
exports.getAcc = getAcc;


/***/ }),

/***/ "./src/scripts/elements/leaderboards.ts":
/*!**********************************************!*\
  !*** ./src/scripts/elements/leaderboards.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.hide = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./notifications */ "./src/scripts/elements/notifications.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const currentLeaderboard = "time_15";
let currentData = {
    15: [],
    60: [],
};
let currentRank = {
    15: {},
    60: {},
};
const requesting = {
    15: false,
    60: false,
};
const leaderboardSingleLimit = 50;
let updateTimer;
function clearTable(lb) {
    if (lb === 15) {
        $("#leaderboardsWrapper table.left tbody").empty();
        $("#leaderboardsWrapper table.left tfoot").empty();
    }
    else if (lb === 60) {
        $("#leaderboardsWrapper table.right tbody").empty();
        $("#leaderboardsWrapper table.right tfoot").empty();
    }
}
function reset() {
    currentData = {
        15: [],
        60: [],
    };
    currentRank = {
        15: {},
        60: {},
    };
}
function stopTimer() {
    clearInterval(updateTimer);
    updateTimer = undefined;
    $("#leaderboards .subTitle").text("Next update in: --:--");
}
function updateTimerElement() {
    const date = new Date();
    const minutesToNextUpdate = 14 - (date.getMinutes() % 15);
    const secondsToNextUpdate = 60 - date.getSeconds();
    const totalSeconds = minutesToNextUpdate * 60 + secondsToNextUpdate;
    $("#leaderboards .subTitle").text("Next update in: " + Misc.secondsToString(totalSeconds, true));
}
function startTimer() {
    updateTimerElement();
    updateTimer = setInterval(() => {
        updateTimerElement();
    }, 1000);
}
function showLoader(lb) {
    if (lb === 15) {
        $(`#leaderboardsWrapper .leftTableLoader`).removeClass("hidden");
    }
    else if (lb === 60) {
        $(`#leaderboardsWrapper .rightTableLoader`).removeClass("hidden");
    }
}
function hideLoader(lb) {
    if (lb === 15) {
        $(`#leaderboardsWrapper .leftTableLoader`).addClass("hidden");
    }
    else if (lb === 60) {
        $(`#leaderboardsWrapper .rightTableLoader`).addClass("hidden");
    }
}
function updateFooter(lb) {
    let side;
    if (lb === 15) {
        side = "left";
    }
    else {
        side = "right";
    }
    $(`#leaderboardsWrapper table.${side} tfoot`).html(`
    <tr>
      <td><br><br></td>
      <td colspan="4" style="text-align:center;">Not qualified</>
      <td><br><br></td>
    </tr>
    `);
    let toppercent;
    if (currentRank[lb]) {
        let num = Misc.roundTo2((currentRank[lb]["rank"] / currentRank[lb].count) * 100);
        if (num == 0) {
            num = 0.01;
        }
        toppercent = `Top ${num}%`;
    }
    if (currentRank[lb]) {
        const entry = currentRank[lb];
        const date = new Date(entry.timestamp);
        $(`#leaderboardsWrapper table.${side} tfoot`).html(`
    <tr>
    <td>${entry.rank}</td>
    <td><span class="top">You</span><br><span class="sub">${toppercent}</span></td>
    <td class="alignRight">${(config_1.default.alwaysShowCPM
            ? entry.wpm * 5
            : entry.wpm).toFixed(2)}<br><div class="sub">${entry.acc.toFixed(2)}%</div></td>
    <td class="alignRight">${(config_1.default.alwaysShowCPM
            ? entry.raw * 5
            : entry.raw).toFixed(2)}<br><div class="sub">${!entry.consistency || entry.consistency === "-"
            ? "-"
            : entry.consistency.toFixed(2) + "%"}</div></td>
    <td class="alignRight">time<br><div class="sub">${lb}</div></td>
    <td class="alignRight">${(0, format_1.default)(date, "dd MMM yyyy")}<br>
    <div class='sub'>${(0, format_1.default)(date, "HH:mm")}</div></td>
  </tr>
  `);
    }
}
function checkLbMemory(lb) {
    var _a, _b, _c, _d, _e;
    let side;
    if (lb === 15) {
        side = "left";
    }
    else {
        side = "right";
    }
    const memory = (_e = (_d = (_c = (_b = (_a = DB.getSnapshot()) === null || _a === void 0 ? void 0 : _a.lbMemory) === null || _b === void 0 ? void 0 : _b.time) === null || _c === void 0 ? void 0 : _c[lb]) === null || _d === void 0 ? void 0 : _d["english"]) !== null && _e !== void 0 ? _e : 0;
    if (currentRank[lb]) {
        const difference = memory - currentRank[lb].rank;
        if (difference > 0) {
            DB.updateLbMemory("time", lb, "english", currentRank[lb].rank, true);
            if (memory !== 0) {
                $(`#leaderboardsWrapper table.${side} tfoot tr td .top`).append(` (<i class="fas fa-fw fa-angle-up"></i>${Math.abs(difference)} since you last checked)`);
            }
        }
        else if (difference < 0) {
            DB.updateLbMemory("time", lb, "english", currentRank[lb].rank, true);
            if (memory !== 0) {
                $(`#leaderboardsWrapper table.${side} tfoot tr td .top`).append(` (<i class="fas fa-fw fa-angle-down"></i>${Math.abs(difference)} since you last checked)`);
            }
        }
        else {
            if (memory !== 0) {
                $(`#leaderboardsWrapper table.${side} tfoot tr td .top`).append(` ( = since you last checked)`);
            }
        }
    }
}
function fillTable(lb, prepend) {
    var _a;
    if (!currentData[lb]) {
        return;
    }
    let side;
    if (lb === 15) {
        side = "left";
    }
    else {
        side = "right";
    }
    const loggedInUserName = (_a = DB.getSnapshot()) === null || _a === void 0 ? void 0 : _a.name;
    let a = currentData[lb].length - leaderboardSingleLimit;
    let b = currentData[lb].length;
    if (a < 0)
        a = 0;
    if (prepend) {
        a = 0;
        b = prepend;
    }
    let html = "";
    for (let i = a; i < b; i++) {
        const entry = currentData[lb][i];
        if (!entry) {
            break;
        }
        if (entry.hidden)
            return;
        let meClassString = "";
        if (entry.name == loggedInUserName) {
            meClassString = ' class="me"';
        }
        const date = new Date(entry.timestamp);
        html += `
    <tr ${meClassString}>
    <td>${entry.rank === 1 ? '<i class="fas fa-fw fa-crown"></i>' : entry.rank}</td>
    <td>${entry.name}</td>
    <td class="alignRight">${(config_1.default.alwaysShowCPM
            ? entry.wpm * 5
            : entry.wpm).toFixed(2)}<br><div class="sub">${entry.acc.toFixed(2)}%</div></td>
    <td class="alignRight">${(config_1.default.alwaysShowCPM
            ? entry.raw * 5
            : entry.raw).toFixed(2)}<br><div class="sub">${!entry.consistency || entry.consistency === "-"
            ? "-"
            : entry.consistency.toFixed(2) + "%"}</div></td>
    <td class="alignRight">time<br><div class="sub">${lb}</div></td>
    <td class="alignRight">${(0, format_1.default)(date, "dd MMM yyyy")}<br>
    <div class='sub'>${(0, format_1.default)(date, "HH:mm")}</div></td>
  </tr>
  `;
    }
    if (!prepend) {
        $(`#leaderboardsWrapper table.${side} tbody`).append(html);
    }
    else {
        $(`#leaderboardsWrapper table.${side} tbody`).prepend(html);
    }
}
function hide() {
    $("#leaderboardsWrapper")
        .stop(true, true)
        .css("opacity", 1)
        .animate({
        opacity: 0,
    }, 100, () => {
        clearTable(15);
        clearTable(60);
        reset();
        stopTimer();
        $("#leaderboardsWrapper").addClass("hidden");
    });
}
exports.hide = hide;
function update() {
    return __awaiter(this, void 0, void 0, function* () {
        $("#leaderboardsWrapper .buttons .button").removeClass("active");
        $(`#leaderboardsWrapper .buttons .button[board=${currentLeaderboard}]`).addClass("active");
        showLoader(15);
        showLoader(60);
        const leaderboardRequests = [
            ape_1.default.leaderboards.get("english", "time", "15", 0),
            ape_1.default.leaderboards.get("english", "time", "60", 0),
        ];
        if (firebase_1.Auth.currentUser) {
            leaderboardRequests.push(ape_1.default.leaderboards.getRank("english", "time", "15"), ape_1.default.leaderboards.getRank("english", "time", "60"));
        }
        const responses = yield Promise.all(leaderboardRequests);
        const failedResponse = responses.find((response) => response.status !== 200);
        if (failedResponse) {
            return Notifications.add("Failed to load leaderboards: " + failedResponse.message, -1);
        }
        const [lb15Data, lb60Data, lb15Rank, lb60Rank] = responses.map((response) => response.data);
        currentData[15] = lb15Data;
        currentData[60] = lb60Data;
        currentRank[15] = lb15Rank;
        currentRank[60] = lb60Rank;
        const leaderboardKeys = [15, 60];
        leaderboardKeys.forEach((leaderboardTime) => {
            hideLoader(leaderboardTime);
            clearTable(leaderboardTime);
            updateFooter(leaderboardTime);
            checkLbMemory(leaderboardTime);
            fillTable(leaderboardTime);
        });
        $("#leaderboardsWrapper .leftTableWrapper").removeClass("invisible");
        $("#leaderboardsWrapper .rightTableWrapper").removeClass("invisible");
    });
}
function requestMore(lb, prepend = false) {
    return __awaiter(this, void 0, void 0, function* () {
        if (prepend && currentData[lb][0].rank === 1)
            return;
        if (requesting[lb])
            return;
        requesting[lb] = true;
        showLoader(lb);
        let skipVal = currentData[lb][currentData[lb].length - 1].rank;
        if (prepend) {
            skipVal = currentData[lb][0].rank - leaderboardSingleLimit;
        }
        let limitVal;
        if (skipVal < 0) {
            limitVal = Math.abs(skipVal) - 1;
            skipVal = 0;
        }
        const response = yield ape_1.default.leaderboards.get("english", "time", lb, skipVal, limitVal);
        const data = response.data;
        if (response.status !== 200 || data.length === 0) {
            hideLoader(lb);
            return;
        }
        if (prepend) {
            currentData[lb].unshift(...data);
        }
        else {
            currentData[lb].push(...data);
        }
        if (prepend && !limitVal) {
            limitVal = leaderboardSingleLimit - 1;
        }
        fillTable(lb, limitVal);
        hideLoader(lb);
        requesting[lb] = false;
    });
}
function requestNew(lb, skip) {
    return __awaiter(this, void 0, void 0, function* () {
        showLoader(lb);
        const response = yield ape_1.default.leaderboards.get("english", "time", lb, skip);
        const data = response.data;
        clearTable(lb);
        currentData[lb] = [];
        if (response.status !== 200 || data.length === 0) {
            hideLoader(lb);
            return;
        }
        currentData[lb] = data;
        fillTable(lb);
        hideLoader(lb);
    });
}
function show() {
    if ($("#leaderboardsWrapper").hasClass("hidden")) {
        if (firebase_1.Auth.currentUser) {
            $("#leaderboardsWrapper #leaderboards .rightTableJumpToMe").removeClass("disabled");
            $("#leaderboardsWrapper #leaderboards .leftTableJumpToMe").removeClass("disabled");
        }
        else {
            $("#leaderboardsWrapper #leaderboards .rightTableJumpToMe").addClass("disabled");
            $("#leaderboardsWrapper #leaderboards .leftTableJumpToMe").addClass("disabled");
        }
        if (config_1.default.alwaysShowCPM) {
            $("#leaderboards table thead tr td:nth-child(3)").html('cpm<br><div class="sub">accuracy</div>');
        }
        else {
            $("#leaderboards table thead tr td:nth-child(3)").html('wpm<br><div class="sub">accuracy</div>');
        }
        $("#leaderboardsWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({
            opacity: 1,
        }, 125, () => {
            update();
            startTimer();
        });
    }
}
exports.show = show;
$("#leaderboardsWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "leaderboardsWrapper") {
        hide();
    }
});
// $("#leaderboardsWrapper .buttons .button").on("click",(e) => {
//   currentLeaderboard = $(e.target).attr("board");
//   update();
// });
let leftScrollEnabled = true;
$("#leaderboardsWrapper #leaderboards .leftTableWrapper").scroll((e) => {
    if (!leftScrollEnabled)
        return;
    const elem = $(e.currentTarget);
    if (Math.round(elem.scrollTop()) <= 50) {
        requestMore(15, true);
    }
});
$("#leaderboardsWrapper #leaderboards .leftTableWrapper").scroll((e) => {
    if (!leftScrollEnabled)
        return;
    const elem = $(e.currentTarget);
    if (Math.round(elem[0].scrollHeight - elem.scrollTop()) <=
        Math.round(elem.outerHeight()) + 50) {
        requestMore(15);
    }
});
let rightScrollEnabled = true;
$("#leaderboardsWrapper #leaderboards .rightTableWrapper").scroll((e) => {
    if (!rightScrollEnabled)
        return;
    const elem = $(e.currentTarget);
    if (Math.round(elem.scrollTop()) <= 50) {
        requestMore(60, true);
    }
});
$("#leaderboardsWrapper #leaderboards .rightTableWrapper").scroll((e) => {
    const elem = $(e.currentTarget);
    if (Math.round(elem[0].scrollHeight - elem.scrollTop()) <=
        Math.round(elem.outerHeight() + 50)) {
        requestMore(60);
    }
});
$("#leaderboardsWrapper #leaderboards .leftTableJumpToTop").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    leftScrollEnabled = false;
    $("#leaderboardsWrapper #leaderboards .leftTableWrapper").scrollTop(0);
    yield requestNew(15, 0);
    leftScrollEnabled = true;
}));
$("#leaderboardsWrapper #leaderboards .leftTableJumpToMe").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    if (currentRank[15].rank === undefined)
        return;
    leftScrollEnabled = false;
    yield requestNew(15, currentRank[15].rank - leaderboardSingleLimit / 2);
    const rowHeight = $("#leaderboardsWrapper #leaderboards .leftTableWrapper table tbody td").outerHeight();
    $("#leaderboardsWrapper #leaderboards .leftTableWrapper").animate({
        scrollTop: rowHeight *
            Math.min(currentRank[15].rank, leaderboardSingleLimit / 2) -
            $("#leaderboardsWrapper #leaderboards .leftTableWrapper").outerHeight() /
                2.25,
    }, 0, () => {
        leftScrollEnabled = true;
    });
}));
$("#leaderboardsWrapper #leaderboards .rightTableJumpToTop").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    rightScrollEnabled = false;
    $("#leaderboardsWrapper #leaderboards .rightTableWrapper").scrollTop(0);
    yield requestNew(60, 0);
    rightScrollEnabled = true;
}));
$("#leaderboardsWrapper #leaderboards .rightTableJumpToMe").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    if (currentRank[60].rank === undefined)
        return;
    leftScrollEnabled = false;
    yield requestNew(60, currentRank[60].rank - leaderboardSingleLimit / 2);
    const rowHeight = $("#leaderboardsWrapper #leaderboards .rightTableWrapper table tbody td").outerHeight();
    $("#leaderboardsWrapper #leaderboards .rightTableWrapper").animate({
        scrollTop: rowHeight *
            Math.min(currentRank[60].rank, leaderboardSingleLimit / 2) -
            $("#leaderboardsWrapper #leaderboards .rightTableWrapper").outerHeight() /
                2.25,
    }, 0, () => {
        leftScrollEnabled = true;
    });
}));
$(document).on("click", "#top #menu .icon-button", (e) => {
    if ($(e.currentTarget).hasClass("leaderboards")) {
        show();
    }
    return false;
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" && !$("#leaderboardsWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/elements/loader.ts":
/*!****************************************!*\
  !*** ./src/scripts/elements/loader.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
function show() {
    $("#backgroundLoader").stop(true, true).fadeIn(125);
}
exports.show = show;
function hide() {
    $("#backgroundLoader").stop(true, true).fadeOut(125);
}
exports.hide = hide;


/***/ }),

/***/ "./src/scripts/elements/modes-notice.ts":
/*!**********************************************!*\
  !*** ./src/scripts/elements/modes-notice.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = void 0;
const PaceCaret = __importStar(__webpack_require__(/*! ../test/pace-caret */ "./src/scripts/test/pace-caret.ts"));
const TestState = __importStar(__webpack_require__(/*! ../test/test-state */ "./src/scripts/test/test-state.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Last10Average = __importStar(__webpack_require__(/*! ../elements/last-10-average */ "./src/scripts/elements/last-10-average.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestWords = __importStar(__webpack_require__(/*! ../test/test-words */ "./src/scripts/test/test-words.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
ConfigEvent.subscribe((eventKey) => {
    if ([
        "difficulty",
        "blindMode",
        "stopOnError",
        "paceCaret",
        "minWpm",
        "minAcc",
        "minBurst",
        "confidenceMode",
        "layout",
        "showAverage",
        "alwaysShowCPM",
    ].includes(eventKey)) {
        update();
    }
});
function update() {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        let anim = false;
        if ($(".pageTest #testModesNotice").text() === "")
            anim = true;
        $(".pageTest #testModesNotice").empty();
        if (TestState.isRepeated && config_1.default.mode !== "quote") {
            $(".pageTest #testModesNotice").append(`<div class="text-button restart" style="color:var(--error-color);"><i class="fas fa-sync-alt"></i>repeated</div>`);
        }
        if (TestWords.hasTab) {
            $(".pageTest #testModesNotice").append(`<div class="text-button"><i class="fas fa-long-arrow-alt-right"></i>shift + tab to restart</div>`);
        }
        if (TestState.activeChallenge) {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsChallenges"><i class="fas fa-award"></i>${TestState.activeChallenge.display}</div>`);
        }
        if (config_1.default.mode === "zen") {
            $(".pageTest #testModesNotice").append(`<div class="text-button"><i class="fas fa-poll"></i>shift + enter to finish zen </div>`);
        }
        $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsLanguages"><i class="fas fa-globe-americas"></i>${config_1.default.language.replace(/_/g, " ")}</div>`);
        if (config_1.default.difficulty === "expert") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsDifficulty"><i class="fas fa-star-half-alt"></i>expert</div>`);
        }
        else if (config_1.default.difficulty === "master") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsDifficulty"><i class="fas fa-star"></i>master</div>`);
        }
        if (config_1.default.blindMode) {
            $(".pageTest #testModesNotice").append(`<div class="text-button blind"><i class="fas fa-eye-slash"></i>blind</div>`);
        }
        if (config_1.default.lazyMode) {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsLazyMode"><i class="fas fa-couch"></i>lazy</div>`);
        }
        if (config_1.default.paceCaret !== "off" ||
            (config_1.default.repeatedPace && TestState.isPaceRepeat)) {
            let speed = "";
            try {
                speed = ` (${Math.round(PaceCaret.settings.wpm)} wpm)`;
            }
            catch (_b) { }
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsPaceCaret"><i class="fas fa-tachometer-alt"></i>${config_1.default.paceCaret === "average"
                ? "average"
                : config_1.default.paceCaret === "pb"
                    ? "pb"
                    : "custom"} pace${speed}</div>`);
        }
        if (config_1.default.showAverage !== "off") {
            let avgWPM = Last10Average.getWPM();
            let avgAcc = Last10Average.getAcc();
            if (!config_1.default.alwaysShowDecimalPlaces) {
                avgWPM = Math.round(avgWPM);
                avgAcc = Math.round(avgAcc);
            }
            if (firebase_1.Auth.currentUser && avgWPM > 0) {
                const avgWPMText = ["wpm", "both"].includes(config_1.default.showAverage)
                    ? config_1.default.alwaysShowCPM
                        ? `${Math.round(avgWPM * 5)} cpm`
                        : `${avgWPM} wpm`
                    : "";
                const avgAccText = ["acc", "both"].includes(config_1.default.showAverage)
                    ? `${avgAcc}% acc`
                    : "";
                const text = `${avgWPMText} ${avgAccText}`.trim();
                $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsShowAverage"><i class="fas fa-chart-bar"></i>avg: ${text}</div>`);
            }
        }
        if (config_1.default.minWpm !== "off") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsMinWpm"><i class="fas fa-bomb"></i>min ${config_1.default.minWpmCustomSpeed} wpm</div>`);
        }
        if (config_1.default.minAcc !== "off") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsMinAcc"><i class="fas fa-bomb"></i>min ${config_1.default.minAccCustom}% acc</div>`);
        }
        if (config_1.default.minBurst !== "off") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsMinBurst"><i class="fas fa-bomb"></i>min ${config_1.default.minBurstCustomSpeed} burst ${config_1.default.minBurst === "flex" ? "(flex)" : ""}</div>`);
        }
        if (config_1.default.funbox !== "none") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsFunbox"><i class="fas fa-gamepad"></i>${config_1.default.funbox.replace(/_/g, " ")}</div>`);
        }
        if (config_1.default.confidenceMode === "on") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsConfidenceMode"><i class="fas fa-backspace"></i>confidence</div>`);
        }
        if (config_1.default.confidenceMode === "max") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsConfidenceMode"><i class="fas fa-backspace"></i>max confidence</div>`);
        }
        if (config_1.default.stopOnError != "off") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsStopOnError"><i class="fas fa-hand-paper"></i>stop on ${config_1.default.stopOnError}</div>`);
        }
        if (config_1.default.layout !== "default") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsLayouts"><i class="fas fa-keyboard"></i>emulating ${config_1.default.layout.replace(/_/g, " ")}</div>`);
        }
        if (config_1.default.oppositeShiftMode !== "off") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsOppositeShiftMode"><i class="fas fa-exchange-alt"></i>opposite shift${config_1.default.oppositeShiftMode === "keymap" ? " (keymap)" : ""}</div>`);
        }
        let tagsString = "";
        try {
            (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
                if (tag.active === true) {
                    tagsString += tag.name + ", ";
                }
            });
            if (tagsString !== "") {
                $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsTags"><i class="fas fa-tag"></i>${tagsString.substring(0, tagsString.length - 2)}</div>`);
            }
        }
        catch (_c) { }
        if (anim) {
            $(".pageTest #testModesNotice")
                .css("transition", "none")
                .css("opacity", 0)
                .animate({
                opacity: 1,
            }, 125, () => {
                $(".pageTest #testModesNotice").css("transition", ".125s");
            });
        }
    });
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/elements/monkey-power.ts":
/*!**********************************************!*\
  !*** ./src/scripts/elements/monkey-power.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.addPower = exports.reset = exports.init = void 0;
const ThemeColors = __importStar(__webpack_require__(/*! ./theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
/**
 * @typedef {{ x: number, y: number }} vec2
 * @typedef {vec2 & { prev: vec2, vel: vec2, alpha: number, color: string }} Particle
 * @typedef {{ particles: Particle[], caret: any, canvas: HTMLCanvasElement, context2d: CanvasRenderingContext2D, rendering: boolean, lastFrame: number, deltaTime: number, resetTimeOut: number }} CTX
 */
/**
 * @type {CTX} ctx
 */
const ctx = {
    particles: [],
    rendering: false,
};
const gravity = 1000;
const drag = 0.05;
const particleSize = 4;
const particleFade = 0.6;
const particleInitVel = 1500;
const particleBounceMod = 0.3;
const particleCreateCount = [6, 3];
const shakeAmount = 10;
function createCanvas() {
    const canvas = document.createElement("canvas");
    canvas.style.cssText =
        "position:fixed;top:0;left:0;pointer-events:none;z-index:999999";
    canvas.height = window.innerHeight;
    canvas.width = window.innerWidth;
    window.addEventListener("resize", () => {
        canvas.height = window.innerHeight;
        canvas.width = window.innerWidth;
    });
    document.body.appendChild(canvas);
    return canvas;
}
/**
 * @param {number} x
 * @param {number} y
 * @param {string} color
 * @returns {Particle}
 */
function createParticle(x, y, color) {
    return {
        x,
        y,
        color,
        alpha: 1,
        prev: { x, y },
        vel: {
            x: particleInitVel - Math.random() * particleInitVel * 2,
            y: particleInitVel - Math.random() * particleInitVel * 2,
        },
    };
}
/**
 * @param {Particle} particle
 */
function updateParticle(particle) {
    if (!ctx.canvas || !ctx.deltaTime)
        return;
    particle.prev.x = particle.x;
    particle.prev.y = particle.y;
    // Update pos
    particle.x += particle.vel.x * ctx.deltaTime;
    particle.y += particle.vel.y * ctx.deltaTime;
    if (particle.x > ctx.canvas.width) {
        particle.vel.x *= -particleBounceMod;
        particle.x =
            ctx.canvas.width - (particle.x - ctx.canvas.width) * particleBounceMod;
    }
    else if (particle.x < 0) {
        particle.vel.x *= -particleBounceMod;
        particle.x *= -particleBounceMod;
    }
    if (particle.y > ctx.canvas.height) {
        particle.vel.y *= -particleBounceMod;
        particle.y =
            ctx.canvas.height - (particle.y - ctx.canvas.height) * particleBounceMod;
    }
    else if (particle.y < 0) {
        particle.vel.y *= -1;
        particle.y *= -1;
    }
    particle.vel.y += gravity * ctx.deltaTime;
    particle.vel.x *= 1 - drag * ctx.deltaTime;
    particle.alpha *= 1 - particleFade * ctx.deltaTime;
}
function init() {
    ctx.caret = $("#caret");
    ctx.canvas = createCanvas();
    ctx.context2d = ctx.canvas.getContext("2d");
}
exports.init = init;
function render() {
    if (!ctx.lastFrame || !ctx.context2d || !ctx.canvas)
        return;
    ctx.rendering = true;
    const time = Date.now();
    ctx.deltaTime = (time - ctx.lastFrame) / 1000;
    ctx.lastFrame = time;
    ctx.context2d.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
    const keep = [];
    for (let i = 0; i < ctx.particles.length; i++) {
        const particle = ctx.particles[i];
        if (particle.alpha < 0.1)
            continue;
        updateParticle(particle);
        ctx.context2d.globalAlpha = particle.alpha;
        ctx.context2d.strokeStyle = particle.color;
        ctx.context2d.lineWidth = particleSize;
        ctx.context2d.beginPath();
        ctx.context2d.moveTo(Math.round(particle.prev.x), Math.round(particle.prev.y));
        ctx.context2d.lineTo(Math.round(particle.x), Math.round(particle.y));
        ctx.context2d.stroke();
        keep.push(particle);
    }
    ctx.particles = keep;
    if (ctx.particles.length && !SlowTimer.get()) {
        requestAnimationFrame(render);
    }
    else {
        ctx.context2d.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
        ctx.rendering = false;
    }
}
function reset(immediate = false) {
    if (!ctx.resetTimeOut)
        return;
    delete ctx.resetTimeOut;
    clearTimeout(ctx.resetTimeOut);
    const body = $(document.body);
    body.css("transition", "all .25s, transform 0.8s");
    body.css("transform", `translate(0,0)`);
    setTimeout(() => {
        body.css("transition", "all .25s, transform .05s");
        $("html").css("overflow", "inherit");
        $("html").css("overflow-y", "scroll");
    }, immediate ? 0 : 1000);
}
exports.reset = reset;
function startRender() {
    if (!ctx.rendering) {
        ctx.lastFrame = Date.now();
        render();
    }
}
function randomColor() {
    const r = Math.floor(Math.random() * 256).toString(16);
    const g = Math.floor(Math.random() * 256).toString(16);
    const b = Math.floor(Math.random() * 256).toString(16);
    return `#${r}${g}${b}`;
}
/**
 * @param {boolean} good Good power or not?
 */
function addPower(good = true, extra = false) {
    var _a, _b, _c, _d, _e;
    return __awaiter(this, void 0, void 0, function* () {
        if (config_1.default.monkeyPowerLevel === "off" || SlowTimer.get())
            return;
        // Shake
        if (["3", "4"].includes(config_1.default.monkeyPowerLevel)) {
            $("html").css("overflow", "hidden");
            const shake = [
                Math.round(shakeAmount - Math.random() * shakeAmount),
                Math.round(shakeAmount - Math.random() * shakeAmount),
            ];
            $(document.body).css("transform", `translate(${shake[0]}px, ${shake[1]}px)`);
            if (ctx.resetTimeOut)
                clearTimeout(ctx.resetTimeOut);
            ctx.resetTimeOut = setTimeout(reset, 2000);
        }
        // Sparks
        const offset = (_a = ctx.caret) === null || _a === void 0 ? void 0 : _a.offset();
        const coords = [
            (_b = offset === null || offset === void 0 ? void 0 : offset.left) !== null && _b !== void 0 ? _b : 0,
            ((_c = offset === null || offset === void 0 ? void 0 : offset.top) !== null && _c !== void 0 ? _c : 0) + ((_e = (_d = ctx.caret) === null || _d === void 0 ? void 0 : _d.height()) !== null && _e !== void 0 ? _e : 0),
        ];
        for (let i = Math.round((particleCreateCount[0] + Math.random() * particleCreateCount[1]) *
            (extra ? 2 : 1)); i > 0; i--) {
            const color = ["2", "4"].includes(config_1.default.monkeyPowerLevel)
                ? randomColor()
                : good
                    ? yield ThemeColors.get("caret")
                    : yield ThemeColors.get("error");
            ctx.particles.push(createParticle(...coords, color));
        }
        startRender();
    });
}
exports.addPower = addPower;


/***/ }),

/***/ "./src/scripts/elements/notifications.ts":
/*!***********************************************!*\
  !*** ./src/scripts/elements/notifications.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.addBanner = exports.add = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
let id = 0;
class Notification {
    constructor(type, message, level, duration, customTitle, customIcon, closeCallback = () => {
        //
    }) {
        this.type = type;
        this.message = message;
        this.level = level;
        if (type === "banner") {
            this.duration = duration;
        }
        else {
            if (duration == undefined) {
                if (level === -1) {
                    this.duration = 0;
                }
                else {
                    this.duration = 3000;
                }
            }
            else {
                this.duration = duration * 1000;
            }
        }
        this.customTitle = customTitle;
        this.customIcon = customIcon;
        this.id = id++;
        this.closeCallback = closeCallback;
    }
    //level
    //0 - notice
    //1 - good
    //-1 - bad
    show() {
        let cls = "notice";
        let icon = `<i class="fas fa-fw fa-exclamation"></i>`;
        let title = "Notice";
        if (this.level === 1) {
            cls = "good";
            icon = `<i class="fas fa-fw fa-check"></i>`;
            title = "Success";
        }
        else if (this.level === -1) {
            cls = "bad";
            icon = `<i class="fas fa-fw fa-times"></i>`;
            title = "Error";
            console.error(this.message);
        }
        if (this.customTitle != undefined) {
            title = this.customTitle;
        }
        if (this.type === "banner") {
            icon = `<i class="fas fa-fw fa-bullhorn"></i>`;
        }
        if (this.customIcon != undefined) {
            icon = `<i class="fas fa-fw fa-${this.customIcon}"></i>`;
        }
        if (this.type === "notification") {
            // moveCurrentToHistory();
            const oldHeight = $("#notificationCenter .history").height();
            $("#notificationCenter .history").prepend(`
          
          <div class="notif ${cls}" id=${this.id}>
              <div class="icon">${icon}</div>
              <div class="message"><div class="title">${title}</div>${this.message}</div>
          </div>     

          `);
            const newHeight = $("#notificationCenter .history").height();
            $(`#notificationCenter .notif[id='${this.id}']`).remove();
            $("#notificationCenter .history")
                .css("margin-top", 0)
                .animate({
                marginTop: newHeight - oldHeight,
            }, 125, () => {
                $("#notificationCenter .history").css("margin-top", 0);
                $("#notificationCenter .history").prepend(`
          
                  <div class="notif ${cls}" id=${this.id}>
                      <div class="icon">${icon}</div>
                      <div class="message"><div class="title">${title}</div>${this.message}</div>
                  </div>     

              `);
                $(`#notificationCenter .notif[id='${this.id}']`)
                    .css("opacity", 0)
                    .animate({
                    opacity: 1,
                }, 125, () => {
                    $(`#notificationCenter .notif[id='${this.id}']`).css("opacity", "");
                });
                $(`#notificationCenter .notif[id='${this.id}']`).on("click", () => {
                    this.hide();
                    this.closeCallback();
                });
            });
            $(`#notificationCenter .notif[id='${this.id}']`).hover(() => {
                $(`#notificationCenter .notif[id='${this.id}']`).toggleClass("hover");
            });
        }
        else if (this.type === "banner") {
            let leftside = `<div class="icon lefticon">${icon}</div>`;
            if (/^images\/.*/.test(this.customIcon)) {
                leftside = `<div class="image" style="background-image: url(${this.customIcon})"></div>`;
            }
            $("#bannerCenter").prepend(`
        <div class="banner ${cls}" id="${this.id}">
        <div class="container">
          ${leftside}
          <div class="text">
            ${this.message}
          </div>
          ${this.duration >= 0
                ? `
          <div class="closeButton">
            <i class="fas fa-fw fa-times"></i>
          </div>
          `
                : `<div class="righticon">${icon}</div>`}
        </div>
      </div>
      `);
            const height = $("#bannerCenter").height();
            $("#centerContent").css("padding-top", height + Misc.convertRemToPixels(2) + "px");
            $("#notificationCenter").css("margin-top", height + "px");
            if (this.duration >= 0) {
                $(`#bannerCenter .banner[id='${this.id}'] .closeButton`).on("click", () => {
                    this.hide();
                    this.closeCallback();
                });
            }
        }
        if (this.duration > 0) {
            setTimeout(() => {
                this.hide();
            }, this.duration + 250);
        }
    }
    hide() {
        if (this.type === "notification") {
            $(`#notificationCenter .notif[id='${this.id}']`)
                .css("opacity", 1)
                .animate({
                opacity: 0,
            }, 125, () => {
                $(`#notificationCenter .notif[id='${this.id}']`).animate({
                    height: 0,
                }, 125, () => {
                    $(`#notificationCenter .notif[id='${this.id}']`).remove();
                });
            });
        }
        else if (this.type === "banner") {
            $(`#bannerCenter .banner[id='${this.id}']`).remove();
            const height = $("#bannerCenter").height();
            $("#centerContent").css("padding-top", height + Misc.convertRemToPixels(2) + "px");
            $("#notificationCenter").css("margin-top", height + "px");
        }
    }
}
function add(message, level = 0, duration, customTitle, customIcon, closeCallback) {
    // notificationHistory.push(
    new Notification("notification", message, level, duration, customTitle, customIcon, closeCallback).show();
    // );
}
exports.add = add;
function addBanner(message, level = -1, customIcon = "bullhorn", sticky = false, closeCallback) {
    // notificationHistory.push(
    new Notification("banner", message, level, sticky ? -1 : 0, undefined, customIcon, closeCallback).show();
    // );
}
exports.addBanner = addBanner;


/***/ }),

/***/ "./src/scripts/elements/psa.ts":
/*!*************************************!*\
  !*** ./src/scripts/elements/psa.ts ***!
  \*************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
const Notifications = __importStar(__webpack_require__(/*! ./notifications */ "./src/scripts/elements/notifications.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
function clearMemory() {
    window.localStorage.setItem("confirmedPSAs", JSON.stringify([]));
}
function getMemory() {
    var _a, _b;
    return (_b = JSON.parse((_a = window.localStorage.getItem("confirmedPSAs")) !== null && _a !== void 0 ? _a : "[]")) !== null && _b !== void 0 ? _b : [];
}
function setMemory(id) {
    const list = getMemory();
    list.push(id);
    window.localStorage.setItem("confirmedPSAs", JSON.stringify(list));
}
function getLatest() {
    return __awaiter(this, void 0, void 0, function* () {
        const response = yield ape_1.default.psas.get();
        if (response.message === "Server is down for maintenance") {
            Notifications.addBanner("Server is currently under maintenance. <a target= '_blank' href='https://monkeytype.instatus.com/'>Click here</a> for more info.", -1, "bullhorn", true);
            return [];
        }
        return response.data;
    });
}
function show() {
    return __awaiter(this, void 0, void 0, function* () {
        const latest = yield getLatest();
        if (latest == null || latest.length == 0) {
            clearMemory();
            return;
        }
        const localmemory = getMemory();
        latest.forEach((psa) => {
            var _a;
            if (localmemory.includes(psa._id) && ((_a = psa.sticky) !== null && _a !== void 0 ? _a : false) === false) {
                return;
            }
            if (psa.date) {
                const dateObj = new Date(psa.date);
                const diff = psa.date - Date.now();
                const string = (0, misc_1.secondsToString)(diff / 1000, false, false, "text", false, true);
                psa.message = psa.message.replace("{dateDifference}", string);
                psa.message = psa.message.replace("{dateNoTime}", (0, format_1.default)(dateObj, "dd MMM yyyy"));
                psa.message = psa.message.replace("{date}", (0, format_1.default)(dateObj, "dd MMM yyyy HH:mm"));
            }
            Notifications.addBanner(psa.message, psa.level, "bullhorn", psa.sticky, () => {
                setMemory(psa._id);
            });
        });
    });
}
exports.show = show;


/***/ }),

/***/ "./src/scripts/elements/scroll-to-top.ts":
/*!***********************************************!*\
  !*** ./src/scripts/elements/scroll-to-top.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
let visible = false;
$(".scrollToTopButton").on("click", () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
});
$(window).scroll(() => {
    const page = ActivePage.get();
    if (page == "test")
        return;
    if (page == "about" || page == "settings" || page == "account") {
        const scroll = window.scrollY;
        if (!visible && scroll > 100) {
            $(".scrollToTopButton").removeClass("invisible");
            visible = true;
        }
        else if (visible && scroll < 100) {
            $(".scrollToTopButton").addClass("invisible");
            visible = false;
        }
    }
});


/***/ }),

/***/ "./src/scripts/elements/theme-colors.ts":
/*!**********************************************!*\
  !*** ./src/scripts/elements/theme-colors.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = exports.reset = exports.getAll = exports.get = void 0;
let colors = {
    bg: "#323437",
    main: "#e2b714",
    caret: "#e2b714",
    sub: "#646669",
    text: "#d1d0c5",
    error: "#ca4754",
    errorExtra: "#7e2a33",
    colorfulError: "#ca4754",
    colorfulErrorExtra: "#7e2a33",
};
function get(color) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!colors[color])
            update();
        return colors[color];
    });
}
exports.get = get;
function getAll() {
    return __awaiter(this, void 0, void 0, function* () {
        if (!colors.bg)
            update();
        return colors;
    });
}
exports.getAll = getAll;
function reset() {
    colors = {
        bg: "",
        main: "",
        caret: "",
        sub: "",
        text: "",
        error: "",
        errorExtra: "",
        colorfulError: "",
        colorfulErrorExtra: "",
    };
}
exports.reset = reset;
function update() {
    const st = getComputedStyle(document.body);
    colors.bg = st.getPropertyValue("--bg-color").replace(" ", "");
    colors.main = st.getPropertyValue("--main-color").replace(" ", "");
    colors.caret = st.getPropertyValue("--caret-color").replace(" ", "");
    colors.sub = st.getPropertyValue("--sub-color").replace(" ", "");
    colors.text = st.getPropertyValue("--text-color").replace(" ", "");
    colors.error = st.getPropertyValue("--error-color").replace(" ", "");
    colors.errorExtra = st
        .getPropertyValue("--error-extra-color")
        .replace(" ", "");
    colors.colorfulError = st
        .getPropertyValue("--colorful-error-color")
        .replace(" ", "");
    colors.colorfulErrorExtra = st
        .getPropertyValue("--colorful-error-extra-color")
        .replace(" ", "");
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/elements/version-check.ts":
/*!***********************************************!*\
  !*** ./src/scripts/elements/version-check.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const Notifications = __importStar(__webpack_require__(/*! ./notifications */ "./src/scripts/elements/notifications.ts"));
// import * as VersionPopup from "./version-popup";
function setMemory(v) {
    window.localStorage.setItem("lastSeenVersion", v);
}
function getMemory() {
    var _a;
    return (_a = window.localStorage.getItem("lastSeenVersion")) !== null && _a !== void 0 ? _a : "";
}
function show(version) {
    return __awaiter(this, void 0, void 0, function* () {
        const memory = yield getMemory();
        if (memory === "") {
            setMemory(version);
            return;
        }
        if (window.location.hostname === "localhost" ||
            window.location.hostname === "127.0.0.1") {
            caches.keys().then(function (names) {
                for (const name of names)
                    caches.delete(name);
            });
        }
        if (memory === version)
            return;
        caches.keys().then(function (names) {
            for (const name of names)
                caches.delete(name);
        });
        Notifications.addBanner(`Version ${version} has been released. Click the version number in the bottom right to view the changelog.`, 1, "code-branch", false);
        setMemory(version);
    });
}
exports.show = show;


/***/ }),

/***/ "./src/scripts/firebase.ts":
/*!*********************************!*\
  !*** ./src/scripts/firebase.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.Analytics = exports.Auth = void 0;
// Import the functions you need from the SDKs you need
const app_1 = __webpack_require__(/*! firebase/app */ "./node_modules/firebase/app/dist/index.esm.js");
const auth_1 = __webpack_require__(/*! firebase/auth */ "./node_modules/firebase/auth/dist/index.esm.js");
const firebase_config_1 = __webpack_require__(/*! ./constants/firebase-config */ "./src/scripts/constants/firebase-config.ts"); // eslint-disable-line require-path-exists/exists
const analytics_1 = __webpack_require__(/*! firebase/analytics */ "./node_modules/firebase/analytics/dist/index.esm.js");
// Initialize Firebase
let app;
try {
    app = (0, app_1.initializeApp)(firebase_config_1.firebaseConfig);
    exports.Auth = (0, auth_1.getAuth)(app);
    exports.Analytics = (0, analytics_1.getAnalytics)(app);
}
catch (e) {
    console.error(e);
    $("body").text("Failed to initialize Firebase. Are you sure you have the correct config in the firebase-config.ts file?");
}


/***/ }),

/***/ "./src/scripts/index.ts":
/*!******************************!*\
  !*** ./src/scripts/index.ts ***!
  \******************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


// this file should be concatenated at the top of the legacy js files
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__webpack_require__(/*! ../styles/index.scss */ "./src/styles/index.scss");
__webpack_require__(/*! ./firebase */ "./src/scripts/firebase.ts");
const DB = __importStar(__webpack_require__(/*! ./db */ "./src/scripts/db.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ./config */ "./src/scripts/config.ts"));
const TestStats = __importStar(__webpack_require__(/*! ./test/test-stats */ "./src/scripts/test/test-stats.ts"));
const Replay = __importStar(__webpack_require__(/*! ./test/replay */ "./src/scripts/test/replay.ts"));
const TestTimer = __importStar(__webpack_require__(/*! ./test/test-timer */ "./src/scripts/test/test-timer.ts"));
const Result = __importStar(__webpack_require__(/*! ./test/result */ "./src/scripts/test/result.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test/test-input */ "./src/scripts/test/test-input.ts"));
__webpack_require__(/*! ./controllers/account-controller */ "./src/scripts/controllers/account-controller.ts");
const glarses_mode_1 = __webpack_require__(/*! ./states/glarses-mode */ "./src/scripts/states/glarses-mode.ts");
__webpack_require__(/*! ./test/caps-warning */ "./src/scripts/test/caps-warning.ts");
__webpack_require__(/*! ./popups/support-popup */ "./src/scripts/popups/support-popup.ts");
__webpack_require__(/*! ./popups/contact-popup */ "./src/scripts/popups/contact-popup.ts");
__webpack_require__(/*! ./popups/version-popup */ "./src/scripts/popups/version-popup.ts");
__webpack_require__(/*! ./popups/edit-preset-popup */ "./src/scripts/popups/edit-preset-popup.ts");
__webpack_require__(/*! ./popups/simple-popups */ "./src/scripts/popups/simple-popups.ts");
__webpack_require__(/*! ./controllers/input-controller */ "./src/scripts/controllers/input-controller.ts");
__webpack_require__(/*! ./ready */ "./src/scripts/ready.ts");
__webpack_require__(/*! ./ui */ "./src/scripts/ui.ts");
__webpack_require__(/*! ./pages/about */ "./src/scripts/pages/about.ts");
__webpack_require__(/*! ./popups/pb-tables-popup */ "./src/scripts/popups/pb-tables-popup.ts");
__webpack_require__(/*! ./elements/scroll-to-top */ "./src/scripts/elements/scroll-to-top.ts");
__webpack_require__(/*! ./popups/mobile-test-config-popup */ "./src/scripts/popups/mobile-test-config-popup.ts");
__webpack_require__(/*! ./popups/edit-tags-popup */ "./src/scripts/popups/edit-tags-popup.ts");
const Account = __importStar(__webpack_require__(/*! ./pages/account */ "./src/scripts/pages/account.ts"));
const extendedGlobal = __webpack_require__.g;
extendedGlobal.snapshot = DB.getSnapshot;
extendedGlobal.config = config_1.default;
extendedGlobal.toggleFilterDebug = Account.toggleFilterDebug;
extendedGlobal.glarsesMode = glarses_mode_1.enable;
extendedGlobal.stats = TestStats.getStats;
extendedGlobal.replay = Replay.getReplayExport;
extendedGlobal.enableTimerDebug = TestTimer.enableTimerDebug;
extendedGlobal.getTimerStats = TestTimer.getTimerStats;
extendedGlobal.toggleUnsmoothedRaw = Result.toggleUnsmoothedRaw;
extendedGlobal.enableSpacingDebug = TestInput.enableSpacingDebug;


/***/ }),

/***/ "./src/scripts/observables/config-event.ts":
/*!*************************************************!*\
  !*** ./src/scripts/observables/config-event.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch(key, newValue, nosave, previousValue, fullConfig) {
    subscribers.forEach((fn) => {
        try {
            fn(key, newValue, nosave, previousValue, fullConfig);
        }
        catch (e) {
            console.error("Config event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/observables/page-change-event.ts":
/*!******************************************************!*\
  !*** ./src/scripts/observables/page-change-event.ts ***!
  \******************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch(previousPage, newPage) {
    subscribers.forEach((fn) => {
        try {
            fn(previousPage, newPage);
        }
        catch (e) {
            console.error("Page change event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/observables/reset-requested-event.ts":
/*!**********************************************************!*\
  !*** ./src/scripts/observables/reset-requested-event.ts ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch() {
    subscribers.forEach((fn) => {
        try {
            fn();
        }
        catch (e) {
            console.error("Reset requested event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/observables/results-shown-event.ts":
/*!********************************************************!*\
  !*** ./src/scripts/observables/results-shown-event.ts ***!
  \********************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch(results) {
    subscribers.forEach((fn) => {
        try {
            fn(results);
        }
        catch (e) {
            console.error("Page change event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/observables/timer-event.ts":
/*!************************************************!*\
  !*** ./src/scripts/observables/timer-event.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch(key, value, value2) {
    subscribers.forEach((fn) => {
        try {
            fn(key, value, value2);
        }
        catch (e) {
            console.error("Timer event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/observables/word-typed-event.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/observables/word-typed-event.ts ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch(word, typedCorrectly, burst, currentTestWord) {
    subscribers.forEach((fn) => {
        try {
            fn(word, typedCorrectly, burst, currentTestWord);
        }
        catch (e) {
            console.error("Word Typed event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/pages/about.ts":
/*!************************************!*\
  !*** ./src/scripts/pages/about.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = exports.fill = exports.reset = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
function reset() {
    $(".pageAbout .contributors").empty();
    $(".pageAbout .supporters").empty();
}
exports.reset = reset;
function fill() {
    return __awaiter(this, void 0, void 0, function* () {
        const supporters = yield Misc.getSupportersList();
        const contributors = yield Misc.getContributorsList();
        supporters.forEach((supporter) => {
            $(".pageAbout .supporters").append(`
      <div>${supporter}</div>
    `);
        });
        contributors.forEach((contributor) => {
            $(".pageAbout .contributors").append(`
      <div>${contributor}</div>
    `);
        });
    });
}
exports.fill = fill;
exports.page = new page_1.default("about", $(".page.pageAbout"), "/about", () => {
    //
}, () => __awaiter(void 0, void 0, void 0, function* () {
    reset();
}), () => {
    fill();
}, () => {
    //
});


/***/ }),

/***/ "./src/scripts/pages/account.ts":
/*!**************************************!*\
  !*** ./src/scripts/pages/account.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = exports.update = exports.smoothHistory = exports.reset = exports.toggleFilterDebug = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const ResultFilters = __importStar(__webpack_require__(/*! ../account/result-filters */ "./src/scripts/account/result-filters.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const ChartController = __importStar(__webpack_require__(/*! ../controllers/chart-controller */ "./src/scripts/controllers/chart-controller.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const MiniResultChart = __importStar(__webpack_require__(/*! ../account/mini-result-chart */ "./src/scripts/account/mini-result-chart.ts"));
const AllTimeStats = __importStar(__webpack_require__(/*! ../account/all-time-stats */ "./src/scripts/account/all-time-stats.ts"));
const PbTables = __importStar(__webpack_require__(/*! ../account/pb-tables */ "./src/scripts/account/pb-tables.ts"));
const LoadingPage = __importStar(__webpack_require__(/*! ./loading */ "./src/scripts/pages/loading.ts"));
const Focus = __importStar(__webpack_require__(/*! ../test/focus */ "./src/scripts/test/focus.ts"));
const SignOutButton = __importStar(__webpack_require__(/*! ../account/sign-out-button */ "./src/scripts/account/sign-out-button.ts"));
const TodayTracker = __importStar(__webpack_require__(/*! ../test/today-tracker */ "./src/scripts/test/today-tracker.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
let filterDebug = false;
//toggle filterdebug
function toggleFilterDebug() {
    filterDebug = !filterDebug;
    if (filterDebug) {
        console.log("filterDebug is on");
    }
}
exports.toggleFilterDebug = toggleFilterDebug;
let filteredResults = [];
let visibleTableLines = 0;
function loadMoreLines(lineIndex) {
    var _a, _b;
    if (filteredResults == [] || filteredResults.length == 0)
        return;
    let newVisibleLines;
    if (lineIndex && lineIndex > visibleTableLines) {
        newVisibleLines = Math.ceil(lineIndex / 10) * 10;
    }
    else {
        newVisibleLines = visibleTableLines + 10;
    }
    for (let i = visibleTableLines; i < newVisibleLines; i++) {
        const result = filteredResults[i];
        if (!result)
            continue;
        let diff = result.difficulty;
        if (diff == undefined) {
            diff = "normal";
        }
        let raw;
        try {
            raw = config_1.default.alwaysShowCPM
                ? (result.rawWpm * 5).toFixed(2)
                : result.rawWpm.toFixed(2);
            if (raw == undefined) {
                raw = "-";
            }
        }
        catch (e) {
            raw = "-";
        }
        let icons = `<span aria-label="${(_a = result.language) === null || _a === void 0 ? void 0 : _a.replace("_", " ")}" data-balloon-pos="up"><i class="fas fa-fw fa-globe-americas"></i></span>`;
        if (diff === "normal") {
            icons += `<span aria-label="${result.difficulty}" data-balloon-pos="up"><i class="far fa-fw fa-star"></i></span>`;
        }
        else if (diff === "expert") {
            icons += `<span aria-label="${result.difficulty}" data-balloon-pos="up"><i class="fas fa-fw fa-star-half-alt"></i></span>`;
        }
        else if (diff === "master") {
            icons += `<span aria-label="${result.difficulty}" data-balloon-pos="up"><i class="fas fa-fw fa-star"></i></span>`;
        }
        if (result.punctuation) {
            icons += `<span aria-label="punctuation" data-balloon-pos="up" style="font-weight:900">!?</span>`;
        }
        if (result.numbers) {
            icons += `<span aria-label="numbers" data-balloon-pos="up" style="font-weight:900">15</span>`;
        }
        if (result.blindMode) {
            icons += `<span aria-label="blind mode" data-balloon-pos="up"><i class="fas fa-fw fa-eye-slash"></i></span>`;
        }
        if (result.lazyMode) {
            icons += `<span aria-label="lazy mode" data-balloon-pos="up"><i class="fas fa-fw fa-couch"></i></span>`;
        }
        if (result.funbox !== "none" && result.funbox !== undefined) {
            icons += `<span aria-label="${result.funbox.replace(/_/g, " ")}" data-balloon-pos="up"><i class="fas fa-gamepad"></i></span>`;
        }
        if (result.chartData === undefined) {
            icons += `<span class="miniResultChartButton" aria-label="No chart data found" data-balloon-pos="up"><i class="fas fa-chart-line"></i></span>`;
        }
        else if (result.chartData === "toolong") {
            icons += `<span class="miniResultChartButton" aria-label="Chart history is not available for long tests" data-balloon-pos="up"><i class="fas fa-chart-line"></i></span>`;
        }
        else {
            icons += `<span class="miniResultChartButton" aria-label="View graph" data-balloon-pos="up" filteredResultsId="${i}" style="opacity: 1"><i class="fas fa-chart-line"></i></span>`;
        }
        let tagNames = "";
        if (result.tags !== undefined && result.tags.length > 0) {
            result.tags.forEach((tag) => {
                var _a;
                (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((snaptag) => {
                    if (tag === snaptag._id) {
                        tagNames += snaptag.name + ", ";
                    }
                });
            });
            tagNames = tagNames.substring(0, tagNames.length - 2);
        }
        let restags;
        if (result.tags === undefined) {
            restags = "[]";
        }
        else {
            restags = JSON.stringify(result.tags);
        }
        let tagIcons = `<span id="resultEditTags" resultId="${result._id}" tags='${restags}' aria-label="no tags" data-balloon-pos="up" style="opacity: .25"><i class="fas fa-fw fa-tag"></i></span>`;
        if (tagNames !== "") {
            if (result.tags !== undefined && result.tags.length > 1) {
                tagIcons = `<span id="resultEditTags" resultId="${result._id}" tags='${restags}' aria-label="${tagNames}" data-balloon-pos="up"><i class="fas fa-fw fa-tags"></i></span>`;
            }
            else {
                tagIcons = `<span id="resultEditTags" resultId="${result._id}" tags='${restags}' aria-label="${tagNames}" data-balloon-pos="up"><i class="fas fa-fw fa-tag"></i></span>`;
            }
        }
        let consistency = "-";
        if (result.consistency) {
            consistency = result.consistency.toFixed(2) + "%";
        }
        let pb = (_b = result.isPb) === null || _b === void 0 ? void 0 : _b.toString();
        if (pb) {
            pb = '<i class="fas fa-fw fa-crown"></i>';
        }
        else {
            pb = "";
        }
        let charStats = "-";
        if (result.charStats) {
            charStats = result.charStats.join("/");
        }
        else {
            charStats = result.correctChars + "/" + result.incorrectChars + "/-/-";
        }
        const date = new Date(result.timestamp);
        $(".pageAccount .history table tbody").append(`
    <tr class="resultRow" id="result-${i}">
    <td>${pb}</td>
    <td>${(config_1.default.alwaysShowCPM ? result.wpm * 5 : result.wpm).toFixed(2)}</td>
    <td>${raw}</td>
    <td>${result.acc.toFixed(2)}%</td>
    <td>${consistency}</td>
    <td>${charStats}</td>
    <td>${result.mode} ${result.mode2}</td>
    <td class="infoIcons">${icons}</td>
    <td>${tagIcons}</td>
    <td>${(0, format_1.default)(date, "dd MMM yyyy")}<br>
    ${(0, format_1.default)(date, "HH:mm")}
    </td>
    </tr>`);
    }
    visibleTableLines = newVisibleLines;
    if (visibleTableLines >= filteredResults.length) {
        $(".pageAccount .loadMoreButton").addClass("hidden");
    }
    else {
        $(".pageAccount .loadMoreButton").removeClass("hidden");
    }
}
function reset() {
    $(".pageAccount .history table tbody").empty();
    ChartController.accountActivity.data.datasets[0].data = [];
    ChartController.accountActivity.data.datasets[1].data = [];
    ChartController.accountHistory.data.datasets[0].data = [];
    ChartController.accountHistory.data.datasets[1].data = [];
    ChartController.accountActivity.updateColors();
    ChartController.accountHistory.updateColors();
}
exports.reset = reset;
let totalSecondsFiltered = 0;
let chartData = [];
let accChartData = [];
function smoothHistory(factor) {
    const smoothedWpmData = Misc.smooth(chartData.map((a) => a.y), factor);
    const smoothedAccData = Misc.smooth(accChartData.map((a) => a.y), factor);
    const chartData2 = chartData.map((a, i) => {
        const ret = Object.assign({}, a);
        ret.y = smoothedWpmData[i];
        return ret;
    });
    const accChartData2 = accChartData.map((a, i) => {
        const ret = Object.assign({}, a);
        ret.y = smoothedAccData[i];
        return ret;
    });
    ChartController.accountHistory.data.datasets[0].data = chartData2;
    ChartController.accountHistory.data.datasets[1].data = accChartData2;
    if (chartData2.length || accChartData2.length) {
        ChartController.accountHistory.update();
    }
}
exports.smoothHistory = smoothHistory;
function applyHistorySmoothing() {
    const smoothing = $(".pageAccount .content .below .smoothing input").val();
    $(".pageAccount .content .below .smoothing .value").text(smoothing);
    smoothHistory(parseInt(smoothing));
}
function update() {
    function cont() {
        var _a;
        LoadingPage.updateText("Displaying stats...");
        LoadingPage.updateBar(100);
        console.log("updating account page");
        ThemeColors.update();
        ChartController.accountHistory.updateColors();
        ChartController.accountActivity.updateColors();
        AllTimeStats.update();
        PbTables.update();
        chartData = [];
        accChartData = [];
        const wpmChartData = [];
        visibleTableLines = 0;
        let topWpm = 0;
        let topMode = "";
        let testRestarts = 0;
        let totalWpm = 0;
        let testCount = 0;
        let last10 = 0;
        let wpmLast10total = 0;
        let topAcc = 0;
        let totalAcc = 0;
        let totalAcc10 = 0;
        const rawWpm = {
            total: 0,
            count: 0,
            last10Total: 0,
            last10Count: 0,
            max: 0,
        };
        // let totalSeconds = 0;
        totalSecondsFiltered = 0;
        let topCons = 0;
        let totalCons = 0;
        let totalCons10 = 0;
        let consCount = 0;
        const activityChartData = {};
        filteredResults = [];
        $(".pageAccount .history table tbody").empty();
        (_a = DB.getSnapshot().results) === null || _a === void 0 ? void 0 : _a.forEach((result) => {
            // totalSeconds += tt;
            var _a, _b, _c, _d, _e;
            //apply filters
            try {
                let resdiff = result.difficulty;
                if (resdiff == undefined) {
                    resdiff = "normal";
                }
                if (!ResultFilters.getFilter("difficulty", resdiff)) {
                    if (filterDebug) {
                        console.log(`skipping result due to difficulty filter`, result);
                    }
                    return;
                }
                if (!ResultFilters.getFilter("mode", result.mode)) {
                    if (filterDebug) {
                        console.log(`skipping result due to mode filter`, result);
                    }
                    return;
                }
                if (result.mode == "time") {
                    let timefilter = "custom";
                    if ([15, 30, 60, 120].includes(parseInt(result.mode2))) {
                        timefilter = result.mode2;
                    }
                    if (!ResultFilters.getFilter("time", timefilter)) {
                        if (filterDebug) {
                            console.log(`skipping result due to time filter`, result);
                        }
                        return;
                    }
                }
                else if (result.mode == "words") {
                    let wordfilter = "custom";
                    if ([10, 25, 50, 100, 200].includes(parseInt(result.mode2))) {
                        wordfilter = result.mode2;
                    }
                    if (!ResultFilters.getFilter("words", wordfilter)) {
                        if (filterDebug) {
                            console.log(`skipping result due to word filter`, result);
                        }
                        return;
                    }
                }
                if (result.quoteLength != null) {
                    let filter = undefined;
                    if (result.quoteLength === 0) {
                        filter = "short";
                    }
                    else if (result.quoteLength === 1) {
                        filter = "medium";
                    }
                    else if (result.quoteLength === 2) {
                        filter = "long";
                    }
                    else if (result.quoteLength === 3) {
                        filter = "thicc";
                    }
                    if (filter !== undefined &&
                        !ResultFilters.getFilter("quoteLength", filter)) {
                        if (filterDebug) {
                            console.log(`skipping result due to quoteLength filter`, result);
                        }
                        return;
                    }
                }
                let langFilter = ResultFilters.getFilter("language", (_a = result.language) !== null && _a !== void 0 ? _a : "english");
                if (result.language === "english_expanded" &&
                    ResultFilters.getFilter("language", "english_1k")) {
                    langFilter = true;
                }
                if (!langFilter) {
                    if (filterDebug) {
                        console.log(`skipping result due to language filter`, result);
                    }
                    return;
                }
                let puncfilter = "off";
                if (result.punctuation) {
                    puncfilter = "on";
                }
                if (!ResultFilters.getFilter("punctuation", puncfilter)) {
                    if (filterDebug) {
                        console.log(`skipping result due to punctuation filter`, result);
                    }
                    return;
                }
                let numfilter = "off";
                if (result.numbers) {
                    numfilter = "on";
                }
                if (!ResultFilters.getFilter("numbers", numfilter)) {
                    if (filterDebug) {
                        console.log(`skipping result due to numbers filter`, result);
                    }
                    return;
                }
                if (result.funbox === "none" || result.funbox === undefined) {
                    if (!ResultFilters.getFilter("funbox", "none")) {
                        if (filterDebug) {
                            console.log(`skipping result due to funbox filter`, result);
                        }
                        return;
                    }
                }
                else {
                    if (!ResultFilters.getFilter("funbox", result.funbox)) {
                        if (filterDebug) {
                            console.log(`skipping result due to funbox filter`, result);
                        }
                        return;
                    }
                }
                let tagHide = true;
                if (result.tags === undefined || result.tags.length === 0) {
                    //no tags, show when no tag is enabled
                    if (((_b = DB.getSnapshot().tags) === null || _b === void 0 ? void 0 : _b.length) || 0 > 0) {
                        if (ResultFilters.getFilter("tags", "none"))
                            tagHide = false;
                    }
                    else {
                        tagHide = false;
                    }
                }
                else {
                    //tags exist
                    const validTags = (_c = DB.getSnapshot().tags) === null || _c === void 0 ? void 0 : _c.map((t) => t._id);
                    if (validTags === undefined)
                        return;
                    result.tags.forEach((tag) => {
                        //check if i even need to check tags anymore
                        if (!tagHide)
                            return;
                        //check if tag is valid
                        if (validTags === null || validTags === void 0 ? void 0 : validTags.includes(tag)) {
                            //tag valid, check if filter is on
                            if (ResultFilters.getFilter("tags", tag))
                                tagHide = false;
                        }
                        else {
                            //tag not found in valid tags, meaning probably deleted
                            if (ResultFilters.getFilter("tags", "none"))
                                tagHide = false;
                        }
                    });
                }
                if (tagHide) {
                    if (filterDebug) {
                        console.log(`skipping result due to tag filter`, result);
                    }
                    return;
                }
                const timeSinceTest = Math.abs(result.timestamp - Date.now()) / 1000;
                let datehide = true;
                if (ResultFilters.getFilter("date", "all") ||
                    (ResultFilters.getFilter("date", "last_day") &&
                        timeSinceTest <= 86400) ||
                    (ResultFilters.getFilter("date", "last_week") &&
                        timeSinceTest <= 604800) ||
                    (ResultFilters.getFilter("date", "last_month") &&
                        timeSinceTest <= 2592000) ||
                    (ResultFilters.getFilter("date", "last_3months") &&
                        timeSinceTest <= 7776000)) {
                    datehide = false;
                }
                if (datehide) {
                    if (filterDebug) {
                        console.log(`skipping result due to date filter`, result);
                    }
                    return;
                }
                filteredResults.push(result);
            }
            catch (e) {
                Notifications.add("Something went wrong when filtering. Resetting filters.", 0);
                console.log(result);
                console.error(e);
                ResultFilters.reset();
                ResultFilters.updateActive();
                update();
            }
            //filters done
            //=======================================
            const resultDate = new Date(result.timestamp);
            resultDate.setSeconds(0);
            resultDate.setMinutes(0);
            resultDate.setHours(0);
            resultDate.setMilliseconds(0);
            const resultTimestamp = resultDate.getTime();
            if (Object.keys(activityChartData).includes(String(resultTimestamp))) {
                activityChartData[resultTimestamp].amount++;
                activityChartData[resultTimestamp].time +=
                    result.testDuration +
                        result.incompleteTestSeconds -
                        ((_d = result.afkDuration) !== null && _d !== void 0 ? _d : 0);
                activityChartData[resultTimestamp].totalWpm += result.wpm;
            }
            else {
                activityChartData[resultTimestamp] = {
                    amount: 1,
                    time: result.testDuration +
                        result.incompleteTestSeconds -
                        ((_e = result.afkDuration) !== null && _e !== void 0 ? _e : 0),
                    totalWpm: result.wpm,
                };
            }
            let tt = 0;
            if (result.testDuration == undefined &&
                result.mode2 !== "custom" &&
                result.mode2 !== "zen") {
                //test finished before testDuration field was introduced - estimate
                if (result.mode == "time") {
                    tt = result.mode2;
                }
                else if (result.mode == "words") {
                    tt = (result.mode2 / result.wpm) * 60;
                }
            }
            else {
                tt = parseFloat(result.testDuration); //legacy results could have a string here
            }
            if (result.incompleteTestSeconds != undefined) {
                tt += result.incompleteTestSeconds;
            }
            else if (result.restartCount != undefined &&
                result.restartCount > 0) {
                tt += (tt / 4) * result.restartCount;
            }
            // if (result.incompleteTestSeconds != undefined) {
            //   tt += result.incompleteTestSeconds;
            // } else if (result.restartCount != undefined && result.restartCount > 0) {
            //   tt += (tt / 4) * result.restartCount;
            // }
            totalSecondsFiltered += tt;
            if (last10 < 10) {
                last10++;
                wpmLast10total += result.wpm;
                totalAcc10 += result.acc;
                result.consistency !== undefined
                    ? (totalCons10 += result.consistency)
                    : 0;
            }
            testCount++;
            if (result.consistency !== undefined) {
                consCount++;
                totalCons += result.consistency;
                if (result.consistency > topCons) {
                    topCons = result.consistency;
                }
            }
            if (result.rawWpm != null) {
                if (rawWpm.last10Count < 10) {
                    rawWpm.last10Count++;
                    rawWpm.last10Total += result.rawWpm;
                }
                rawWpm.total += result.rawWpm;
                rawWpm.count++;
                if (result.rawWpm > rawWpm.max) {
                    rawWpm.max = result.rawWpm;
                }
            }
            if (result.acc > topAcc) {
                topAcc = result.acc;
            }
            totalAcc += result.acc;
            if (result.restartCount != undefined) {
                testRestarts += result.restartCount;
            }
            chartData.push({
                x: result.timestamp,
                y: config_1.default.alwaysShowCPM ? Misc.roundTo2(result.wpm * 5) : result.wpm,
                wpm: config_1.default.alwaysShowCPM
                    ? Misc.roundTo2(result.wpm * 5)
                    : result.wpm,
                acc: result.acc,
                mode: result.mode,
                mode2: result.mode2,
                punctuation: result.punctuation,
                language: result.language,
                timestamp: result.timestamp,
                difficulty: result.difficulty,
                raw: config_1.default.alwaysShowCPM
                    ? Misc.roundTo2(result.rawWpm * 5)
                    : result.rawWpm,
            });
            wpmChartData.push(result.wpm);
            accChartData.push({
                x: result.timestamp,
                y: 100 - result.acc,
                errorRate: 100 - result.acc,
            });
            if (result.wpm > topWpm) {
                const puncsctring = result.punctuation ? ",<br>with punctuation" : "";
                const numbsctring = result.numbers
                    ? ",<br> " + (result.punctuation ? "&" : "") + "with numbers"
                    : "";
                topWpm = result.wpm;
                if (result.mode == "custom")
                    topMode = result.mode;
                else {
                    topMode =
                        result.mode + " " + result.mode2 + puncsctring + numbsctring;
                }
            }
            totalWpm += result.wpm;
        });
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .group.history table thead tr td:nth-child(2)").text("cpm");
        }
        else {
            $(".pageAccount .group.history table thead tr td:nth-child(2)").text("wpm");
        }
        loadMoreLines();
        ////////
        const activityChartData_amount = [];
        const activityChartData_time = [];
        const activityChartData_avgWpm = [];
        // let lastTimestamp = 0;
        Object.keys(activityChartData).forEach((date) => {
            const dateInt = parseInt(date);
            activityChartData_amount.push({
                x: dateInt,
                y: activityChartData[dateInt].amount,
            });
            activityChartData_time.push({
                x: dateInt,
                y: Misc.roundTo2(activityChartData[dateInt].time),
                amount: activityChartData[dateInt].amount,
            });
            activityChartData_avgWpm.push({
                x: dateInt,
                y: Misc.roundTo2((config_1.default.alwaysShowCPM
                    ? activityChartData[dateInt].totalWpm * 5
                    : activityChartData[dateInt].totalWpm) /
                    activityChartData[dateInt].amount),
            });
            // lastTimestamp = date;
        });
        const accountActivityScaleOptions = ChartController.accountActivity.options.scales;
        if (config_1.default.alwaysShowCPM) {
            accountActivityScaleOptions["avgWpm"].title.text = "Average Cpm";
        }
        else {
            accountActivityScaleOptions["avgWpm"].title.text = "Average Wpm";
        }
        ChartController.accountActivity.data.datasets[0].data =
            activityChartData_time;
        ChartController.accountActivity.data.datasets[1].data =
            activityChartData_avgWpm;
        const accountHistoryScaleOptions = ChartController.accountHistory.options.scales;
        if (config_1.default.alwaysShowCPM) {
            accountHistoryScaleOptions["wpm"].title.text = "Characters per Minute";
        }
        else {
            accountHistoryScaleOptions["wpm"].title.text = "Words per Minute";
        }
        ChartController.accountHistory.data.datasets[0].data = chartData;
        ChartController.accountHistory.data.datasets[1].data = accChartData;
        const wpms = chartData.map((r) => r.y);
        const minWpmChartVal = Math.min(...wpms);
        const maxWpmChartVal = Math.max(...wpms);
        // let accuracies = accChartData.map((r) => r.y);
        accountHistoryScaleOptions["wpm"].max =
            Math.floor(maxWpmChartVal) + (10 - (Math.floor(maxWpmChartVal) % 10));
        if (!config_1.default.startGraphsAtZero) {
            accountHistoryScaleOptions["wpm"].min = Math.floor(minWpmChartVal);
        }
        else {
            accountHistoryScaleOptions["wpm"].min = 0;
        }
        if (chartData == [] || chartData.length == 0) {
            $(".pageAccount .group.noDataError").removeClass("hidden");
            $(".pageAccount .group.chart").addClass("hidden");
            $(".pageAccount .group.dailyActivityChart").addClass("hidden");
            $(".pageAccount .group.history").addClass("hidden");
            $(".pageAccount .triplegroup.stats").addClass("hidden");
        }
        else {
            $(".pageAccount .group.noDataError").addClass("hidden");
            $(".pageAccount .group.chart").removeClass("hidden");
            $(".pageAccount .group.dailyActivityChart").removeClass("hidden");
            $(".pageAccount .group.history").removeClass("hidden");
            $(".pageAccount .triplegroup.stats").removeClass("hidden");
        }
        $(".pageAccount .timeTotalFiltered .val").text(Misc.secondsToString(Math.round(totalSecondsFiltered), true, true));
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .highestWpm .title").text("highest cpm");
            $(".pageAccount .highestWpm .val").text(Misc.roundTo2(topWpm * 5));
        }
        else {
            $(".pageAccount .highestWpm .title").text("highest wpm");
            $(".pageAccount .highestWpm .val").text(Misc.roundTo2(topWpm));
        }
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .averageWpm .title").text("average cpm");
            $(".pageAccount .averageWpm .val").text(Math.round((totalWpm * 5) / testCount));
        }
        else {
            $(".pageAccount .averageWpm .title").text("average wpm");
            $(".pageAccount .averageWpm .val").text(Math.round(totalWpm / testCount));
        }
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .averageWpm10 .title").text("average cpm (last 10 tests)");
            $(".pageAccount .averageWpm10 .val").text(Math.round((wpmLast10total * 5) / last10));
        }
        else {
            $(".pageAccount .averageWpm10 .title").text("average wpm (last 10 tests)");
            $(".pageAccount .averageWpm10 .val").text(Math.round(wpmLast10total / last10));
        }
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .highestRaw .title").text("highest raw cpm");
            $(".pageAccount .highestRaw .val").text(Misc.roundTo2(rawWpm.max * 5));
        }
        else {
            $(".pageAccount .highestRaw .title").text("highest raw wpm");
            $(".pageAccount .highestRaw .val").text(Misc.roundTo2(rawWpm.max));
        }
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .averageRaw .title").text("average raw cpm");
            $(".pageAccount .averageRaw .val").text(Math.round((rawWpm.total * 5) / rawWpm.count));
        }
        else {
            $(".pageAccount .averageRaw .title").text("average raw wpm");
            $(".pageAccount .averageRaw .val").text(Math.round(rawWpm.total / rawWpm.count));
        }
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .averageRaw10 .title").text("average raw cpm (last 10 tests)");
            $(".pageAccount .averageRaw10 .val").text(Math.round((rawWpm.last10Total * 5) / rawWpm.last10Count));
        }
        else {
            $(".pageAccount .averageRaw10 .title").text("average raw wpm (last 10 tests)");
            $(".pageAccount .averageRaw10 .val").text(Math.round(rawWpm.last10Total / rawWpm.last10Count));
        }
        $(".pageAccount .highestWpm .mode").html(topMode);
        $(".pageAccount .testsTaken .val").text(testCount);
        $(".pageAccount .highestAcc .val").text(topAcc + "%");
        $(".pageAccount .avgAcc .val").text(Math.round(totalAcc / testCount) + "%");
        $(".pageAccount .avgAcc10 .val").text(Math.round(totalAcc10 / last10) + "%");
        if (totalCons == 0 || totalCons == undefined) {
            $(".pageAccount .avgCons .val").text("-");
            $(".pageAccount .avgCons10 .val").text("-");
        }
        else {
            $(".pageAccount .highestCons .val").text(topCons + "%");
            $(".pageAccount .avgCons .val").text(Math.round(totalCons / consCount) + "%");
            $(".pageAccount .avgCons10 .val").text(Math.round(totalCons10 / Math.min(last10, consCount)) + "%");
        }
        $(".pageAccount .testsStarted .val").text(`${testCount + testRestarts}`);
        $(".pageAccount .testsCompleted .val").text(`${testCount}(${Math.floor((testCount / (testCount + testRestarts)) * 100)}%)`);
        $(".pageAccount .testsCompleted .avgres").text(`
      ${(testRestarts / testCount).toFixed(1)} restarts per completed test
    `);
        const wpmPoints = filteredResults.map((r) => r.wpm).reverse();
        const trend = Misc.findLineByLeastSquares(wpmPoints);
        const wpmChange = trend[1][1] - trend[0][1];
        const wpmChangePerHour = wpmChange * (3600 / totalSecondsFiltered);
        const plus = wpmChangePerHour > 0 ? "+" : "";
        $(".pageAccount .group.chart .below .text").text(`Speed change per hour spent typing: ${plus +
            Misc.roundTo2(config_1.default.alwaysShowCPM ? wpmChangePerHour * 5 : wpmChangePerHour)} ${config_1.default.alwaysShowCPM ? "cpm" : "wpm"}.`);
        applyHistorySmoothing();
        ChartController.accountActivity.updateColors();
        LoadingPage.updateBar(100, true);
        setTimeout(() => {
            if (ActivePage.get() == "account")
                SignOutButton.show();
        }, 125);
        Focus.set(false);
        Misc.swapElements($(".pageAccount .preloader"), $(".pageAccount .content"), 250);
    }
    if (DB.getSnapshot() === null) {
        Notifications.add(`Missing account data. Please refresh.`, -1);
        $(".pageAccount .preloader").html("Missing account data. Please refresh.");
    }
    else if (DB.getSnapshot().results === undefined) {
        LoadingPage.updateBar(45, true);
        DB.getUserResults().then((d) => {
            TodayTracker.addAllFromToday();
            if (d) {
                ResultFilters.updateActive();
                update();
            }
        });
    }
    else {
        console.log("using db snap");
        try {
            cont();
        }
        catch (e) {
            console.error(e);
            Notifications.add(`Something went wrong: ${e}`, -1);
        }
    }
}
exports.update = update;
function sortAndRefreshHistory(keyString, headerClass, forceDescending = null) {
    // Removes styling from previous sorting requests:
    $("td").removeClass("header-sorted");
    $("td").children("i").remove();
    $(headerClass).addClass("header-sorted");
    if (filteredResults.length < 2)
        return;
    const key = keyString;
    // This allows to reverse the sorting order when clicking multiple times on the table header
    let descending = true;
    if (forceDescending !== null) {
        if (forceDescending == true) {
            $(headerClass).append('<i class="fas fa-sort-down" aria-hidden="true"></i>');
        }
        else {
            descending = false;
            $(headerClass).append('<i class="fas fa-sort-up" aria-hidden="true"></i>');
        }
    }
    else if (parseInt(filteredResults[0][key]) <=
        parseInt(filteredResults[filteredResults.length - 1][key])) {
        descending = true;
        $(headerClass).append('<i class="fas fa-sort-down" aria-hidden="true"></i>');
    }
    else {
        descending = false;
        $(headerClass).append('<i class="fas fa-sort-up", aria-hidden="true"></i>');
    }
    const temp = [];
    const parsedIndexes = [];
    while (temp.length < filteredResults.length) {
        let lowest = Number.MAX_VALUE;
        let highest = -1;
        let idx = -1;
        for (let i = 0; i < filteredResults.length; i++) {
            //find the lowest wpm with index not already parsed
            if (!descending) {
                if (filteredResults[i][key] <= lowest &&
                    !parsedIndexes.includes(i)) {
                    lowest = filteredResults[i][key];
                    idx = i;
                }
            }
            else {
                if (filteredResults[i][key] >= highest &&
                    !parsedIndexes.includes(i)) {
                    highest = filteredResults[i][key];
                    idx = i;
                }
            }
        }
        temp.push(filteredResults[idx]);
        parsedIndexes.push(idx);
    }
    filteredResults = temp;
    $(".pageAccount .history table tbody").empty();
    visibleTableLines = 0;
    loadMoreLines();
}
$(".pageAccount .toggleAccuracyOnChart").on("click", () => {
    UpdateConfig.setChartAccuracy(!config_1.default.chartAccuracy);
});
$(".pageAccount .toggleChartStyle").on("click", () => {
    if (config_1.default.chartStyle == "line") {
        UpdateConfig.setChartStyle("scatter");
    }
    else {
        UpdateConfig.setChartStyle("line");
    }
});
$(".pageAccount .loadMoreButton").on("click", () => {
    loadMoreLines();
});
$(".pageAccount #accountHistoryChart").on("click", () => {
    var _a, _b, _c;
    const index = ChartController.accountHistoryActiveIndex;
    loadMoreLines(index);
    if (!window)
        return;
    const windowHeight = (_a = $(window).height()) !== null && _a !== void 0 ? _a : 0;
    const offset = (_c = (_b = $(`#result-${index}`).offset()) === null || _b === void 0 ? void 0 : _b.top) !== null && _c !== void 0 ? _c : 0;
    const scrollTo = offset - windowHeight / 2;
    $([document.documentElement, document.body]).animate({
        scrollTop: scrollTo,
    }, 500);
    $(".resultRow").removeClass("active");
    $(`#result-${index}`).addClass("active");
});
$(document).on("click", ".pageAccount .miniResultChartButton", (event) => {
    var _a;
    console.log("updating");
    const filteredId = $(event.currentTarget).attr("filteredResultsId");
    if (filteredId === undefined)
        return;
    MiniResultChart.updateData(filteredResults[parseInt(filteredId)].chartData);
    MiniResultChart.show();
    MiniResultChart.updatePosition(event.pageX - ((_a = $(".pageAccount .miniResultChartWrapper").outerWidth()) !== null && _a !== void 0 ? _a : 0), event.pageY + 30);
});
$(document).on("click", ".history-wpm-header", () => {
    sortAndRefreshHistory("wpm", ".history-wpm-header");
});
$(document).on("click", ".history-raw-header", () => {
    sortAndRefreshHistory("rawWpm", ".history-raw-header");
});
$(document).on("click", ".history-acc-header", () => {
    sortAndRefreshHistory("acc", ".history-acc-header");
});
$(document).on("click", ".history-correct-chars-header", () => {
    sortAndRefreshHistory("correctChars", ".history-correct-chars-header");
});
$(document).on("click", ".history-incorrect-chars-header", () => {
    sortAndRefreshHistory("incorrectChars", ".history-incorrect-chars-header");
});
$(document).on("click", ".history-consistency-header", () => {
    sortAndRefreshHistory("consistency", ".history-consistency-header");
});
$(document).on("click", ".history-date-header", () => {
    sortAndRefreshHistory("timestamp", ".history-date-header");
});
// Resets sorting to by date' when applying filers (normal or advanced)
$(document).on("click", ".buttonsAndTitle .buttons .button", () => {
    // We want to 'force' descending sort:
    sortAndRefreshHistory("timestamp", ".history-date-header", true);
});
$(".pageAccount .topFilters .button, .pageAccount .filterButtons .button ").click(() => {
    setTimeout(() => {
        update();
    }, 0);
});
$(".pageAccount .content .below .smoothing input").on("input", () => {
    applyHistorySmoothing();
});
$(".pageAccount .content .group.aboveHistory .exportCSV").on("click", () => {
    Misc.downloadResultsCSV(filteredResults);
});
exports.page = new page_1.default("account", $(".page.pageAccount"), "/account", () => {
    SignOutButton.hide();
}, () => __awaiter(void 0, void 0, void 0, function* () {
    reset();
}), () => {
    update();
    // SignOutButton.show();
}, () => {
    //
});


/***/ }),

/***/ "./src/scripts/pages/loading.ts":
/*!**************************************!*\
  !*** ./src/scripts/pages/loading.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = exports.showBar = exports.updateText = exports.updateBar = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
function updateBar(percentage, fast) {
    const speed = fast ? 100 : 1000;
    $(".pageLoading .fill, .pageAccount .fill")
        .stop(true, true)
        .animate({
        width: percentage + "%",
    }, speed);
}
exports.updateBar = updateBar;
function updateText(text) {
    $(".pageLoading .text, .pageAccount .text").text(text);
}
exports.updateText = updateText;
function showBar() {
    return new Promise((resolve) => {
        Misc.swapElements($(".pageLoading .icon"), $(".pageLoading .barWrapper"), 125, () => {
            resolve();
        });
        Misc.swapElements($(".pageAccount .icon"), $(".pageAccount .barWrapper"), 125, () => {
            resolve();
        });
    });
}
exports.showBar = showBar;
exports.page = new page_1.default("loading", $(".page.pageLoading"), "/", () => __awaiter(void 0, void 0, void 0, function* () {
    //
}), () => __awaiter(void 0, void 0, void 0, function* () {
    //
}), () => {
    //
}, () => {
    //
});


/***/ }),

/***/ "./src/scripts/pages/login.ts":
/*!************************************!*\
  !*** ./src/scripts/pages/login.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = void 0;
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
exports.page = new page_1.default("login", $(".page.pageLogin"), "/login", () => {
    //
}, () => {
    //
}, () => {
    //
}, () => {
    //
});


/***/ }),

/***/ "./src/scripts/pages/page.ts":
/*!***********************************!*\
  !*** ./src/scripts/pages/page.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
class Page {
    constructor(name, element, pathname, beforeHide, afterHide, beforeShow, afterShow) {
        this.name = name;
        this.element = element;
        this.pathname = pathname;
        this.beforeHide = beforeHide;
        this.afterHide = afterHide;
        this.beforeShow = beforeShow;
        this.afterShow = afterShow;
    }
}
exports["default"] = Page;


/***/ }),

/***/ "./src/scripts/pages/settings.ts":
/*!***************************************!*\
  !*** ./src/scripts/pages/settings.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = exports.setEventDisabled = exports.update = exports.showAccountSection = exports.updateAuthSections = exports.updateDiscordSection = exports.hideAccountSection = exports.fillSettingsPage = exports.reset = exports.groups = void 0;
const settings_group_1 = __importDefault(__webpack_require__(/*! ../settings/settings-group */ "./src/scripts/settings/settings-group.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Sound = __importStar(__webpack_require__(/*! ../controllers/sound-controller */ "./src/scripts/controllers/sound-controller.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Funbox = __importStar(__webpack_require__(/*! ../test/funbox */ "./src/scripts/test/funbox.ts"));
const TagController = __importStar(__webpack_require__(/*! ../controllers/tag-controller */ "./src/scripts/controllers/tag-controller.ts"));
const PresetController = __importStar(__webpack_require__(/*! ../controllers/preset-controller */ "./src/scripts/controllers/preset-controller.ts"));
const ThemePicker = __importStar(__webpack_require__(/*! ../settings/theme-picker */ "./src/scripts/settings/theme-picker.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const ImportExportSettingsPopup = __importStar(__webpack_require__(/*! ../popups/import-export-settings-popup */ "./src/scripts/popups/import-export-settings-popup.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const ApeKeysPopup = __importStar(__webpack_require__(/*! ../popups/ape-keys-popup */ "./src/scripts/popups/ape-keys-popup.ts"));
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
exports.groups = {};
function initGroups() {
    return __awaiter(this, void 0, void 0, function* () {
        yield UpdateConfig.loadPromise;
        exports.groups.smoothCaret = new settings_group_1.default("smoothCaret", UpdateConfig.setSmoothCaret, "button");
        exports.groups.difficulty = new settings_group_1.default("difficulty", UpdateConfig.setDifficulty, "button");
        exports.groups.quickTab = new settings_group_1.default("quickTab", UpdateConfig.setQuickTabMode, "button");
        exports.groups.showLiveWpm = new settings_group_1.default("showLiveWpm", UpdateConfig.setShowLiveWpm, "button", () => {
            exports.groups["keymapMode"].updateInput();
        });
        exports.groups.showLiveAcc = new settings_group_1.default("showLiveAcc", UpdateConfig.setShowLiveAcc, "button");
        exports.groups.showLiveBurst = new settings_group_1.default("showLiveBurst", UpdateConfig.setShowLiveBurst, "button");
        exports.groups.showTimerProgress = new settings_group_1.default("showTimerProgress", UpdateConfig.setShowTimerProgress, "button");
        exports.groups.showAverage = new settings_group_1.default("showAverage", UpdateConfig.setShowAverage, "button");
        exports.groups.keymapMode = new settings_group_1.default("keymapMode", UpdateConfig.setKeymapMode, "button", () => {
            exports.groups["showLiveWpm"].updateInput();
        }, () => {
            if (config_1.default.keymapMode === "off") {
                $(".pageSettings .section.keymapStyle").addClass("hidden");
                $(".pageSettings .section.keymapLayout").addClass("hidden");
                $(".pageSettings .section.keymapLegendStyle").addClass("hidden");
            }
            else {
                $(".pageSettings .section.keymapStyle").removeClass("hidden");
                $(".pageSettings .section.keymapLayout").removeClass("hidden");
                $(".pageSettings .section.keymapLegendStyle").removeClass("hidden");
            }
        });
        exports.groups.keymapMatrix = new settings_group_1.default("keymapStyle", UpdateConfig.setKeymapStyle, "button");
        exports.groups.keymapLayout = new settings_group_1.default("keymapLayout", UpdateConfig.setKeymapLayout, "select");
        exports.groups.keymapLegendStyle = new settings_group_1.default("keymapLegendStyle", UpdateConfig.setKeymapLegendStyle, "button");
        exports.groups.showKeyTips = new settings_group_1.default("showKeyTips", UpdateConfig.setKeyTips, "button", undefined, () => {
            if (config_1.default.showKeyTips) {
                $(".pageSettings .tip").removeClass("hidden");
            }
            else {
                $(".pageSettings .tip").addClass("hidden");
            }
        });
        exports.groups.freedomMode = new settings_group_1.default("freedomMode", UpdateConfig.setFreedomMode, "button", () => {
            exports.groups["confidenceMode"].updateInput();
        });
        exports.groups.strictSpace = new settings_group_1.default("strictSpace", UpdateConfig.setStrictSpace, "button");
        exports.groups.oppositeShiftMode = new settings_group_1.default("oppositeShiftMode", UpdateConfig.setOppositeShiftMode, "button");
        exports.groups.confidenceMode = new settings_group_1.default("confidenceMode", UpdateConfig.setConfidenceMode, "button", () => {
            exports.groups["freedomMode"].updateInput();
            exports.groups["stopOnError"].updateInput();
        });
        exports.groups.indicateTypos = new settings_group_1.default("indicateTypos", UpdateConfig.setIndicateTypos, "button");
        exports.groups.hideExtraLetters = new settings_group_1.default("hideExtraLetters", UpdateConfig.setHideExtraLetters, "button");
        exports.groups.blindMode = new settings_group_1.default("blindMode", UpdateConfig.setBlindMode, "button");
        exports.groups.quickEnd = new settings_group_1.default("quickEnd", UpdateConfig.setQuickEnd, "button");
        exports.groups.repeatQuotes = new settings_group_1.default("repeatQuotes", UpdateConfig.setRepeatQuotes, "button");
        exports.groups.enableAds = new settings_group_1.default("enableAds", UpdateConfig.setEnableAds, "button");
        exports.groups.alwaysShowWordsHistory = new settings_group_1.default("alwaysShowWordsHistory", UpdateConfig.setAlwaysShowWordsHistory, "button");
        exports.groups.britishEnglish = new settings_group_1.default("britishEnglish", UpdateConfig.setBritishEnglish, "button");
        exports.groups.singleListCommandLine = new settings_group_1.default("singleListCommandLine", UpdateConfig.setSingleListCommandLine, "button");
        exports.groups.capsLockWarning = new settings_group_1.default("capsLockWarning", UpdateConfig.setCapsLockWarning, "button");
        exports.groups.flipTestColors = new settings_group_1.default("flipTestColors", UpdateConfig.setFlipTestColors, "button");
        exports.groups.swapEscAndTab = new settings_group_1.default("swapEscAndTab", UpdateConfig.setSwapEscAndTab, "button");
        exports.groups.showOutOfFocusWarning = new settings_group_1.default("showOutOfFocusWarning", UpdateConfig.setShowOutOfFocusWarning, "button");
        exports.groups.colorfulMode = new settings_group_1.default("colorfulMode", UpdateConfig.setColorfulMode, "button");
        exports.groups.startGraphsAtZero = new settings_group_1.default("startGraphsAtZero", UpdateConfig.setStartGraphsAtZero, "button");
        exports.groups.autoSwitchTheme = new settings_group_1.default("autoSwitchTheme", UpdateConfig.setAutoSwitchTheme, "button");
        exports.groups.randomTheme = new settings_group_1.default("randomTheme", UpdateConfig.setRandomTheme, "button");
        exports.groups.stopOnError = new settings_group_1.default("stopOnError", UpdateConfig.setStopOnError, "button", () => {
            exports.groups["confidenceMode"].updateInput();
        });
        exports.groups.soundVolume = new settings_group_1.default("soundVolume", UpdateConfig.setSoundVolume, "button");
        exports.groups.playSoundOnError = new settings_group_1.default("playSoundOnError", UpdateConfig.setPlaySoundOnError, "button", () => {
            if (config_1.default.playSoundOnError)
                Sound.playError();
        });
        exports.groups.playSoundOnClick = new settings_group_1.default("playSoundOnClick", UpdateConfig.setPlaySoundOnClick, "button", () => {
            if (config_1.default.playSoundOnClick !== "off")
                Sound.playClick();
        });
        exports.groups.showAllLines = new settings_group_1.default("showAllLines", UpdateConfig.setShowAllLines, "button");
        exports.groups.paceCaret = new settings_group_1.default("paceCaret", UpdateConfig.setPaceCaret, "button");
        exports.groups.repeatedPace = new settings_group_1.default("repeatedPace", UpdateConfig.setRepeatedPace, "button");
        exports.groups.minWpm = new settings_group_1.default("minWpm", UpdateConfig.setMinWpm, "button");
        exports.groups.minAcc = new settings_group_1.default("minAcc", UpdateConfig.setMinAcc, "button");
        exports.groups.minBurst = new settings_group_1.default("minBurst", UpdateConfig.setMinBurst, "button");
        exports.groups.smoothLineScroll = new settings_group_1.default("smoothLineScroll", UpdateConfig.setSmoothLineScroll, "button");
        exports.groups.lazyMode = new settings_group_1.default("lazyMode", UpdateConfig.setLazyMode, "button");
        exports.groups.layout = new settings_group_1.default("layout", UpdateConfig.setLayout, "select");
        exports.groups.language = new settings_group_1.default("language", UpdateConfig.setLanguage, "select");
        exports.groups.fontSize = new settings_group_1.default("fontSize", UpdateConfig.setFontSize, "button");
        exports.groups.pageWidth = new settings_group_1.default("pageWidth", UpdateConfig.setPageWidth, "button");
        exports.groups.caretStyle = new settings_group_1.default("caretStyle", UpdateConfig.setCaretStyle, "button");
        exports.groups.paceCaretStyle = new settings_group_1.default("paceCaretStyle", UpdateConfig.setPaceCaretStyle, "button");
        exports.groups.timerStyle = new settings_group_1.default("timerStyle", UpdateConfig.setTimerStyle, "button");
        exports.groups.highlightMode = new settings_group_1.default("highlightMode", UpdateConfig.setHighlightMode, "button");
        exports.groups.timerOpacity = new settings_group_1.default("timerOpacity", UpdateConfig.setTimerOpacity, "button");
        exports.groups.timerColor = new settings_group_1.default("timerColor", UpdateConfig.setTimerColor, "button");
        exports.groups.fontFamily = new settings_group_1.default("fontFamily", UpdateConfig.setFontFamily, "button", undefined, () => {
            const customButton = $(".pageSettings .section.fontFamily .buttons .custom");
            if ($(".pageSettings .section.fontFamily .buttons .active").length === 0) {
                customButton.addClass("active");
                customButton.text(`Custom (${config_1.default.fontFamily.replace(/_/g, " ")})`);
            }
            else {
                customButton.text("Custom");
            }
        });
        exports.groups.alwaysShowDecimalPlaces = new settings_group_1.default("alwaysShowDecimalPlaces", UpdateConfig.setAlwaysShowDecimalPlaces, "button");
        exports.groups.alwaysShowCPM = new settings_group_1.default("alwaysShowCPM", UpdateConfig.setAlwaysShowCPM, "button");
        exports.groups.customBackgroundSize = new settings_group_1.default("customBackgroundSize", UpdateConfig.setCustomBackgroundSize, "button");
        // groups.customLayoutfluid = new SettingsGroup(
        //   "customLayoutfluid",
        //   UpdateConfig.setCustomLayoutfluid
        // );
    });
}
function reset() {
    $(".pageSettings .section.themes .favThemes.buttons").empty();
    $(".pageSettings .section.themes .allThemes.buttons").empty();
    $(".pageSettings .section.themes .allCustomThemes.buttons").empty();
    $(".pageSettings .section.languageGroups .buttons").empty();
    $(".pageSettings select").empty().select2("destroy");
    $(".pageSettings .section.funbox .buttons").empty();
    $(".pageSettings .section.fontFamily .buttons").empty();
}
exports.reset = reset;
let groupsInitialized = false;
function fillSettingsPage() {
    return __awaiter(this, void 0, void 0, function* () {
        if (config_1.default.showKeyTips) {
            $(".pageSettings .tip").removeClass("hidden");
        }
        else {
            $(".pageSettings .tip").addClass("hidden");
        }
        // Language Selection Combobox
        const languageEl = $(".pageSettings .section.language select").empty();
        const languageGroups = yield Misc.getLanguageGroups();
        languageGroups.forEach((group) => {
            let langComboBox = `<optgroup label="${group.name}">`;
            group.languages.forEach((language) => {
                langComboBox += `<option value="${language}">
        ${language.replace(/_/g, " ")}
      </option>`;
            });
            langComboBox += `</optgroup>`;
            languageEl.append(langComboBox);
        });
        languageEl.select2({
            width: "100%",
        });
        const layoutEl = $(".pageSettings .section.layout select").empty();
        layoutEl.append(`<option value='default'>off</option>`);
        Object.keys(yield Misc.getLayoutsList()).forEach((layout) => {
            layoutEl.append(`<option value='${layout}'>${layout.replace(/_/g, " ")}</option>`);
        });
        layoutEl.select2({
            width: "100%",
        });
        const keymapEl = $(".pageSettings .section.keymapLayout select").empty();
        keymapEl.append(`<option value='overrideSync'>emulator sync</option>`);
        Object.keys(yield Misc.getLayoutsList()).forEach((layout) => {
            if (layout.toString() != "default") {
                keymapEl.append(`<option value='${layout}'>${layout.replace(/_/g, " ")}</option>`);
            }
        });
        keymapEl.select2({
            width: "100%",
        });
        const themeEl1 = $(".pageSettings .section.autoSwitchThemeInputs select.light").empty();
        const themeEl2 = $(".pageSettings .section.autoSwitchThemeInputs select.dark").empty();
        for (const theme of yield Misc.getThemesList()) {
            themeEl1.append(`<option value='${theme.name}'>${theme.name.replace(/_/g, " ")}</option>`);
            themeEl2.append(`<option value='${theme.name}'>${theme.name.replace(/_/g, " ")}</option>`);
        }
        themeEl1.select2({
            width: "100%",
        });
        themeEl2.select2({
            width: "100%",
        });
        $(`.pageSettings .section.autoSwitchThemeInputs select.light`)
            .val(config_1.default.themeLight)
            .trigger("change.select2");
        $(`.pageSettings .section.autoSwitchThemeInputs select.dark`)
            .val(config_1.default.themeDark)
            .trigger("change.select2");
        const funboxEl = $(".pageSettings .section.funbox .buttons").empty();
        funboxEl.append(`<div class="funbox button" funbox='none'>none</div>`);
        Misc.getFunboxList().then((funboxModes) => {
            funboxModes.forEach((funbox) => {
                if (funbox.name === "mirror") {
                    funboxEl.append(`<div class="funbox button" funbox='${funbox.name}' aria-label="${funbox.info}" data-balloon-pos="up" data-balloon-length="fit" type="${funbox.type}" style="transform:scaleX(-1);">${funbox.name.replace(/_/g, " ")}</div>`);
                }
                else {
                    funboxEl.append(`<div class="funbox button" funbox='${funbox.name}' aria-label="${funbox.info}" data-balloon-pos="up" data-balloon-length="fit" type="${funbox.type}">${funbox.name.replace(/_/g, " ")}</div>`);
                }
            });
        });
        let isCustomFont = true;
        const fontsEl = $(".pageSettings .section.fontFamily .buttons").empty();
        Misc.getFontsList().then((fonts) => {
            fonts.forEach((font) => {
                if (config_1.default.fontFamily === font.name)
                    isCustomFont = false;
                fontsEl.append(`<div class="button${config_1.default.fontFamily === font.name ? " active" : ""}" style="font-family:${font.display !== undefined ? font.display : font.name}" fontFamily="${font.name.replace(/ /g, "_")}" tabindex="0"
        onclick="this.blur();">${font.display !== undefined ? font.display : font.name}</div>`);
            });
            fontsEl.append(isCustomFont
                ? `<div class="button no-auto-handle custom active" onclick="this.blur();">Custom (${config_1.default.fontFamily.replace(/_/g, " ")})</div>`
                : '<div class="button no-auto-handle custom" onclick="this.blur();">Custom</div>');
        });
        $(".pageSettings .section.customBackgroundSize input").val(config_1.default.customBackground);
        $(".pageSettings .section.customLayoutfluid input").val(config_1.default.customLayoutfluid.replace(/#/g, " "));
        setEventDisabled(true);
        if (!groupsInitialized) {
            yield initGroups();
            groupsInitialized = true;
        }
        else {
            Object.keys(exports.groups).forEach((groupKey) => {
                exports.groups[groupKey].updateInput();
            });
        }
        setEventDisabled(false);
        yield ThemePicker.refreshButtons();
        yield UpdateConfig.loadPromise;
    });
}
exports.fillSettingsPage = fillSettingsPage;
// export let settingsFillPromise = fillSettingsPage();
function hideAccountSection() {
    $(`.sectionGroupTitle[group='account']`).addClass("hidden");
    $(`.settingsGroup.account`).addClass("hidden");
    $(`.pageSettings .section.needsAccount`).addClass("hidden");
}
exports.hideAccountSection = hideAccountSection;
function updateDiscordSection() {
    //no code and no discord
    if (firebase_1.Auth.currentUser == null) {
        $(".pageSettings .section.discordIntegration").addClass("hidden");
    }
    else {
        if (DB.getSnapshot() == null)
            return;
        $(".pageSettings .section.discordIntegration").removeClass("hidden");
        if (DB.getSnapshot().discordId == undefined) {
            //show button
            $(".pageSettings .section.discordIntegration .buttons").removeClass("hidden");
            $(".pageSettings .section.discordIntegration .info").addClass("hidden");
        }
        else {
            $(".pageSettings .section.discordIntegration .buttons").addClass("hidden");
            $(".pageSettings .section.discordIntegration .info").removeClass("hidden");
        }
    }
}
exports.updateDiscordSection = updateDiscordSection;
function updateAuthSections() {
    $(".pageSettings .section.passwordAuthSettings .button").addClass("hidden");
    $(".pageSettings .section.googleAuthSettings .button").addClass("hidden");
    const user = firebase_1.Auth.currentUser;
    if (!user)
        return;
    const passwordProvider = user.providerData.find((provider) => provider.providerId === "password");
    const googleProvider = user.providerData.find((provider) => provider.providerId === "google.com");
    if (passwordProvider) {
        $(".pageSettings .section.passwordAuthSettings #emailPasswordAuth").removeClass("hidden");
        $(".pageSettings .section.passwordAuthSettings #passPasswordAuth").removeClass("hidden");
    }
    else {
        $(".pageSettings .section.passwordAuthSettings #addPasswordAuth").removeClass("hidden");
    }
    if (googleProvider) {
        $(".pageSettings .section.googleAuthSettings #removeGoogleAuth").removeClass("hidden");
        if (passwordProvider) {
            $(".pageSettings .section.googleAuthSettings #removeGoogleAuth").removeClass("disabled");
        }
        else {
            $(".pageSettings .section.googleAuthSettings #removeGoogleAuth").addClass("disabled");
        }
    }
    else {
        $(".pageSettings .section.googleAuthSettings #addGoogleAuth").removeClass("hidden");
    }
}
exports.updateAuthSections = updateAuthSections;
function setActiveFunboxButton() {
    $(`.pageSettings .section.funbox .button`).removeClass("active");
    $(`.pageSettings .section.funbox .button[funbox='${config_1.default.funbox}']`).addClass("active");
}
function refreshTagsSettingsSection() {
    var _a;
    if (firebase_1.Auth.currentUser !== null && DB.getSnapshot() !== null) {
        const tagsEl = $(".pageSettings .section.tags .tagsList").empty();
        (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
            // let tagPbString = "No PB found";
            // if (tag.pb != undefined && tag.pb > 0) {
            //   tagPbString = `PB: ${tag.pb}`;
            // }
            tagsEl.append(`

      <div class="buttons tag" id="${tag._id}">
        <div class="button tagButton ${tag.active ? "active" : ""}" active="${tag.active}">
          <div class="title">${tag.name}</div>
        </div>
        <div class="clearPbButton button">
          <i class="fas fa-crown fa-fw"></i>
        </div>
        <div class="editButton button">
          <i class="fas fa-pen fa-fw"></i>
        </div>
        <div class="removeButton button">
          <i class="fas fa-trash fa-fw"></i>
        </div>
      </div>

      `);
        });
        $(".pageSettings .section.tags").removeClass("hidden");
    }
    else {
        $(".pageSettings .section.tags").addClass("hidden");
    }
}
function refreshPresetsSettingsSection() {
    var _a;
    if (firebase_1.Auth.currentUser !== null && DB.getSnapshot() !== null) {
        const presetsEl = $(".pageSettings .section.presets .presetsList").empty();
        (_a = DB.getSnapshot().presets) === null || _a === void 0 ? void 0 : _a.forEach((preset) => {
            presetsEl.append(`
      <div class="buttons preset" id="${preset._id}">
        <div class="button presetButton">
          <div class="title">${preset.name}</div>
        </div>
        <div class="editButton button">
          <i class="fas fa-pen fa-fw"></i>
        </div>
        <div class="removeButton button">
          <i class="fas fa-trash fa-fw"></i>
        </div>
      </div>
      
      `);
        });
        $(".pageSettings .section.presets").removeClass("hidden");
    }
    else {
        $(".pageSettings .section.presets").addClass("hidden");
    }
}
function showAccountSection() {
    $(`.sectionGroupTitle[group='account']`).removeClass("hidden");
    $(`.settingsGroup.account`).removeClass("hidden");
    $(`.pageSettings .section.needsAccount`).removeClass("hidden");
    refreshTagsSettingsSection();
    refreshPresetsSettingsSection();
    updateDiscordSection();
}
exports.showAccountSection = showAccountSection;
function update() {
    Object.keys(exports.groups).forEach((group) => {
        exports.groups[group].updateInput();
    });
    refreshTagsSettingsSection();
    refreshPresetsSettingsSection();
    // LanguagePicker.setActiveGroup(); Shifted from grouped btns to combo-box
    setActiveFunboxButton();
    ThemePicker.updateActiveTab(true);
    ThemePicker.setCustomInputs(true);
    updateDiscordSection();
    updateAuthSections();
    // ThemePicker.updateActiveButton();
    $(".pageSettings .section.paceCaret input.customPaceCaretSpeed").val(config_1.default.paceCaretCustomSpeed);
    $(".pageSettings .section.minWpm input.customMinWpmSpeed").val(config_1.default.minWpmCustomSpeed);
    $(".pageSettings .section.minAcc input.customMinAcc").val(config_1.default.minAccCustom);
    $(".pageSettings .section.minBurst input.customMinBurst").val(config_1.default.minBurstCustomSpeed);
    if (config_1.default.autoSwitchTheme) {
        $(".pageSettings .section.autoSwitchThemeInputs").removeClass("hidden");
    }
    else {
        $(".pageSettings .section.autoSwitchThemeInputs").addClass("hidden");
    }
    if (config_1.default.customBackground !== "") {
        $(".pageSettings .section.customBackgroundFilter").removeClass("hidden");
    }
    else {
        $(".pageSettings .section.customBackgroundFilter").addClass("hidden");
    }
}
exports.update = update;
function toggleSettingsGroup(groupName) {
    $(`.pageSettings .settingsGroup.${groupName}`)
        .stop(true, true)
        .slideToggle(250)
        .toggleClass("slideup");
    if ($(`.pageSettings .settingsGroup.${groupName}`).hasClass("slideup")) {
        $(`.pageSettings .sectionGroupTitle[group=${groupName}] .fas`)
            .stop(true, true)
            .animate({
            deg: -90,
        }, {
            duration: 250,
            step: function (now) {
                $(this).css({
                    transform: "rotate(" + now + "deg)",
                });
            },
        });
    }
    else {
        $(`.pageSettings .sectionGroupTitle[group=${groupName}] .fas`)
            .stop(true, true)
            .animate({
            deg: 0,
        }, {
            duration: 250,
            step: function (now) {
                $(this).css({
                    transform: "rotate(" + now + "deg)",
                });
            },
        });
    }
}
$(document).on("focusout", ".pageSettings .section.paceCaret input.customPaceCaretSpeed", () => {
    UpdateConfig.setPaceCaretCustomSpeed(parseInt($(".pageSettings .section.paceCaret input.customPaceCaretSpeed").val()));
});
$(document).on("click", ".pageSettings .section.paceCaret .button.save", () => {
    UpdateConfig.setPaceCaretCustomSpeed(parseInt($(".pageSettings .section.paceCaret input.customPaceCaretSpeed").val()));
});
$(document).on("focusout", ".pageSettings .section.minWpm input.customMinWpmSpeed", () => {
    UpdateConfig.setMinWpmCustomSpeed(parseInt($(".pageSettings .section.minWpm input.customMinWpmSpeed").val()));
});
$(document).on("click", ".pageSettings .section.minWpm .button.save", () => {
    UpdateConfig.setMinWpmCustomSpeed(parseInt($(".pageSettings .section.minWpm input.customMinWpmSpeed").val()));
});
$(document).on("focusout", ".pageSettings .section.minAcc input.customMinAcc", () => {
    UpdateConfig.setMinAccCustom(parseInt($(".pageSettings .section.minAcc input.customMinAcc").val()));
});
$(document).on("click", ".pageSettings .section.minAcc .button.save", () => {
    UpdateConfig.setMinAccCustom(parseInt($(".pageSettings .section.minAcc input.customMinAcc").val()));
});
$(document).on("focusout", ".pageSettings .section.minBurst input.customMinBurst", () => {
    UpdateConfig.setMinBurstCustomSpeed(parseInt($(".pageSettings .section.minBurst input.customMinBurst").val()));
});
$(document).on("click", ".pageSettings .section.minBurst .button.save", () => {
    UpdateConfig.setMinBurstCustomSpeed(parseInt($(".pageSettings .section.minBurst input.customMinBurst").val()));
});
// Commented because started using combo-box for choosing languages instead of grouped buttons
// languages
// $(document).on(
//   "click",
//   ".pageSettings .section.languageGroups .button",
//   (e) => {
//     const group = $(e.currentTarget).attr("group");
//     LanguagePicker.setActiveGroup(group, true);
//   }
// );
//funbox
$(document).on("click", ".pageSettings .section.funbox .button", (e) => {
    const funbox = $(e.currentTarget).attr("funbox");
    const type = $(e.currentTarget).attr("type");
    Funbox.setFunbox(funbox, type);
    setActiveFunboxButton();
});
//tags
$(document).on("click", ".pageSettings .section.tags .tagsList .tag .tagButton", (e) => {
    const target = e.currentTarget;
    const tagid = $(target).parent(".tag").attr("id");
    TagController.toggle(tagid);
    $(target).toggleClass("active");
});
$(document).on("click", ".pageSettings .section.presets .presetsList .preset .presetButton", (e) => {
    const target = e.currentTarget;
    const presetid = $(target).parent(".preset").attr("id");
    console.log("Applying Preset");
    configEventDisabled = true;
    PresetController.apply(presetid);
    configEventDisabled = false;
    update();
});
$("#importSettingsButton").on("click", () => {
    ImportExportSettingsPopup.show("import");
});
$("#exportSettingsButton").on("click", () => {
    const configJSON = JSON.stringify(config_1.default);
    navigator.clipboard.writeText(configJSON).then(function () {
        Notifications.add("JSON Copied to clipboard", 0);
    }, function () {
        ImportExportSettingsPopup.show("export");
    });
});
$(".pageSettings .sectionGroupTitle").on("click", (e) => {
    toggleSettingsGroup($(e.currentTarget).attr("group"));
});
$(".pageSettings .section.apeKeys #showApeKeysPopup").on("click", () => {
    ApeKeysPopup.show();
});
$(".pageSettings .section.customBackgroundSize .inputAndButton .save").on("click", () => {
    UpdateConfig.setCustomBackground($(".pageSettings .section.customBackgroundSize .inputAndButton input").val());
});
$(".pageSettings .section.customBackgroundSize .inputAndButton input").keypress((e) => {
    if (e.key === "Enter") {
        UpdateConfig.setCustomBackground($(".pageSettings .section.customBackgroundSize .inputAndButton input").val());
    }
});
$(".pageSettings .section.customLayoutfluid .inputAndButton .save").on("click", () => {
    UpdateConfig.setCustomLayoutfluid($(".pageSettings .section.customLayoutfluid .inputAndButton input").val()).then((bool) => {
        if (bool) {
            Notifications.add("Custom layoutfluid saved", 1);
        }
    });
});
$(".pageSettings .section.customLayoutfluid .inputAndButton .input").keypress((e) => {
    if (e.key === "Enter") {
        UpdateConfig.setCustomLayoutfluid($(".pageSettings .section.customLayoutfluid .inputAndButton input").val()).then((bool) => {
            if (bool) {
                Notifications.add("Custom layoutfluid saved", 1);
            }
        });
    }
});
$(".quickNav .links a").on("click", (e) => {
    const settingsGroup = e.target.innerText;
    const isOpen = $(`.pageSettings .settingsGroup.${settingsGroup}`).hasClass("slideup");
    isOpen && toggleSettingsGroup(settingsGroup);
});
$(document).on("change", `.pageSettings .section.autoSwitchThemeInputs select.light`, (e) => {
    const target = $(e.currentTarget);
    if (target.hasClass("disabled") || target.hasClass("no-auto-handle")) {
        return;
    }
    UpdateConfig.setThemeLight(target.val());
});
$(document).on("change", `.pageSettings .section.autoSwitchThemeInputs select.dark`, (e) => {
    const target = $(e.currentTarget);
    if (target.hasClass("disabled") || target.hasClass("no-auto-handle")) {
        return;
    }
    UpdateConfig.setThemeDark(target.val());
});
let configEventDisabled = false;
function setEventDisabled(value) {
    configEventDisabled = value;
}
exports.setEventDisabled = setEventDisabled;
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "fullConfigChange")
        setEventDisabled(true);
    if (eventKey === "fullConfigChangeFinished") {
        setEventDisabled(false);
    }
    if (configEventDisabled || eventKey === "saveToLocalStorage")
        return;
    if (ActivePage.get() === "settings" && eventKey !== "theme") {
        update();
    }
});
exports.page = new page_1.default("settings", $(".page.pageSettings"), "/settings", () => {
    //
}, () => __awaiter(void 0, void 0, void 0, function* () {
    reset();
}), () => __awaiter(void 0, void 0, void 0, function* () {
    yield fillSettingsPage();
    update();
}), () => {
    //
});


/***/ }),

/***/ "./src/scripts/pages/test.ts":
/*!***********************************!*\
  !*** ./src/scripts/pages/test.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestStats = __importStar(__webpack_require__(/*! ../test/test-stats */ "./src/scripts/test/test-stats.ts"));
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const TestConfig = __importStar(__webpack_require__(/*! ../test/test-config */ "./src/scripts/test/test-config.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const Funbox = __importStar(__webpack_require__(/*! ../test/funbox */ "./src/scripts/test/funbox.ts"));
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
exports.page = new page_1.default("test", $(".page.pageTest"), "/", () => __awaiter(void 0, void 0, void 0, function* () {
    TestLogic.restart();
    Funbox.clear();
    TestConfig.hide();
    $("#wordsInput").focusout();
}), () => __awaiter(void 0, void 0, void 0, function* () {
    //
}), () => {
    TestConfig.show();
    TestStats.resetIncomplete();
    ManualRestart.set();
    TestLogic.restart(undefined, undefined, undefined, undefined, true);
    Funbox.activate(config_1.default.funbox);
}, () => {
    TestUI.focusWords();
});


/***/ }),

/***/ "./src/scripts/popups/ape-keys-popup.ts":
/*!**********************************************!*\
  !*** ./src/scripts/popups/ape-keys-popup.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.hide = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
let apeKeys = {};
function getData() {
    return __awaiter(this, void 0, void 0, function* () {
        Loader.show();
        const response = yield ape_1.default.apeKeys.get();
        Loader.hide();
        if (response.status !== 200) {
            Notifications.add("Error getting ape keys: " + response.message, -1);
            return undefined;
        }
        apeKeys = response.data;
    });
}
function refreshList() {
    const data = apeKeys;
    if (!data)
        return;
    const table = $("#apeKeysPopupWrapper table tbody");
    table.empty();
    const apeKeyIds = Object.keys(data);
    if (apeKeyIds.length === 0) {
        table.append("<tr><td colspan='6' style='text-align: center;'>No keys found</td></tr>");
        return;
    }
    apeKeyIds.forEach((apeKeyId) => {
        const key = data[apeKeyId];
        table.append(`
      <tr keyId="${apeKeyId}">
        <td>
          <div class="icon-button">
            ${key.enabled
            ? `<i class="fas fa-check-square"></i>`
            : `<i class="far fa-fw fa-square"></i>`}
          </div>
        </td>
        <td>${key.name}</td>
        <td>${(0, format_1.default)(new Date(key.createdOn), "dd MMM yyyy HH:mm")}</td>
        <td>${(0, format_1.default)(new Date(key.modifiedOn), "dd MMM yyyy HH:mm")}</td>
        <td>${key.lastUsedOn === -1
            ? "-"
            : (0, format_1.default)(new Date(key.lastUsedOn), "dd MMM yyyy HH:mm")}</td>
        <td>
          <div class="keyButtons">
            <div class="button edit">
              <i class="fas fa-fw fa-pen"></i>
            </div>
            <div class="button delete">
              <i class="fas fa-fw fa-trash-alt"></i>
            </div>
          </div>
        </td>
      </tr>
    `);
    });
}
function hide() {
    if (!$("#apeKeysPopupWrapper").hasClass("hidden")) {
        $("#apeKeysPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#apeKeysPopupWrapper").addClass("hidden");
        });
    }
}
exports.hide = hide;
//show the popup
function show() {
    return __awaiter(this, void 0, void 0, function* () {
        if ($("#apeKeysPopupWrapper").hasClass("hidden")) {
            yield getData();
            refreshList();
            $("#apeKeysPopupWrapper")
                .stop(true, true)
                .css("opacity", 0)
                .removeClass("hidden")
                .animate({
                opacity: 1,
            }, 100, () => {
                $("#apeKeysPopup textarea").trigger("focus").select();
            });
        }
    });
}
exports.show = show;
$("#apeKeysPopupWrapper").on("mousedown", (e) => {
    if ($(e.target).attr("id") === "apeKeysPopupWrapper") {
        hide();
    }
});
$("#apeKeysPopup .generateApeKey").on("click", () => {
    hide();
});
$(document).on("click", "#apeKeysPopup table .keyButtons .button", () => {
    hide();
});
$(document).on("click", "#apeKeysPopup table .icon-button", (e) => __awaiter(void 0, void 0, void 0, function* () {
    const keyId = $(e.target).closest("tr").attr("keyId");
    const key = apeKeys === null || apeKeys === void 0 ? void 0 : apeKeys[keyId];
    if (!key || !apeKeys)
        return;
    Loader.show();
    const response = yield ape_1.default.apeKeys.update(keyId, { enabled: !key.enabled });
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to update key: " + response.message, -1);
    }
    apeKeys[keyId].enabled = !key.enabled;
    refreshList();
    if (key.enabled) {
        Notifications.add("Key active", 1);
    }
    else {
        Notifications.add("Key inactive", 1);
    }
}));


/***/ }),

/***/ "./src/scripts/popups/contact-popup.ts":
/*!*********************************************!*\
  !*** ./src/scripts/popups/contact-popup.ts ***!
  \*********************************************/
/***/ (() => {


$(document.body).on("click", "#contactPopupButton", () => {
    $("#contactPopupWrapper")
        .css("opacity", 0)
        .removeClass("hidden")
        .animate({ opacity: 1 }, 125);
});
$(document.body).on("click", "#contactPopupWrapper", (e) => {
    if ($(e.target).attr("id") === "contactPopupWrapper") {
        $("#contactPopupWrapper")
            .css("opacity", 1)
            .animate({ opacity: 0 }, 125, () => {
            $("#contactPopupWrapper").addClass("hidden");
        });
    }
});


/***/ }),

/***/ "./src/scripts/popups/custom-test-duration-popup.ts":
/*!**********************************************************!*\
  !*** ./src/scripts/popups/custom-test-duration-popup.ts ***!
  \**********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function parseInput(input) {
    const re = /((-\s*)?\d+(\.\d+)?\s*[hms]?)/g;
    const seconds = [...input.toLowerCase().matchAll(re)]
        .map((match) => {
        const part = match[0];
        const duration = parseFloat(part.replace(/\s+/g, ""));
        if (part.includes("h")) {
            return 3600 * duration;
        }
        else if (part.includes("m")) {
            return 60 * duration;
        }
        else {
            return duration;
        }
    })
        .reduce((total, dur) => total + dur, 0);
    return Math.floor(seconds);
}
function format(duration) {
    const hours = Math.floor(duration / 3600);
    const minutes = Math.floor((duration % 3600) / 60);
    const seconds = (duration % 3600) % 60;
    const time = [];
    if (hours > 0) {
        time.push(`${hours} hour${hours === 1 ? "" : "s"}`);
    }
    if (minutes > 0) {
        time.push(`${minutes} minute${minutes === 1 ? "" : "s"}`);
    }
    if (seconds > 0) {
        time.push(`${seconds} second${seconds === 1 ? "" : "s"}`);
    }
    if (time.length === 3) {
        return `${time[0]}, ${time[1]} and ${time[2]}`;
    }
    else if (time.length === 2) {
        return `${time[0]} and ${time[1]}`;
    }
    else {
        return `${time[0]}`;
    }
}
function previewDuration() {
    const input = $("#customTestDurationPopup input").val();
    const duration = parseInput(input);
    let formattedDuration = "";
    if (duration < 0) {
        formattedDuration = "NEGATIVE TIME";
    }
    else if (duration == 0) {
        formattedDuration = "Infinite test";
    }
    else {
        formattedDuration = "Total time: " + format(duration);
    }
    $("#customTestDurationPopup .preview").text(formattedDuration);
}
function show() {
    if ($("#customTestDurationPopupWrapper").hasClass("hidden")) {
        $("#customTestDurationPopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#customTestDurationPopup input").trigger("focus").select();
        });
    }
    previewDuration();
}
exports.show = show;
function hide() {
    if (!$("#customTestDurationPopupWrapper").hasClass("hidden")) {
        $("#customTestDurationPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#customTestDurationPopupWrapper").addClass("hidden");
        });
    }
}
exports.hide = hide;
function apply() {
    const val = parseInput($("#customTestDurationPopup input").val());
    if (val !== null && !isNaN(val) && val >= 0) {
        UpdateConfig.setTimeConfig(val);
        ManualRestart.set();
        TestLogic.restart();
        if (val >= 1800) {
            Notifications.add("Stay safe and take breaks!", 0);
        }
        else if (val == 0) {
            Notifications.add("Infinite time! Make sure to use Bail Out from the command line to save your result.", 0, 7);
        }
    }
    else {
        Notifications.add("Custom time must be at least 1", 0);
    }
    hide();
}
$("#customTestDurationPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "customTestDurationPopupWrapper") {
        hide();
    }
});
$("#customTestDurationPopup input").keyup((e) => {
    previewDuration();
    if (e.key === "Enter") {
        apply();
    }
});
$("#customTestDurationPopup .button").on("click", () => {
    apply();
});
$(document).on("click", "#top .config .time .text-button", (e) => {
    const mode = $(e.currentTarget).attr("timeConfig");
    if (mode == "custom") {
        show();
    }
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" &&
        !$("#customTestDurationPopupWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/popups/custom-text-popup.ts":
/*!*************************************************!*\
  !*** ./src/scripts/popups/custom-text-popup.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.isVisible = exports.hide = exports.show = void 0;
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const ChallengeController = __importStar(__webpack_require__(/*! ../controllers/challenge-controller */ "./src/scripts/controllers/challenge-controller.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const WordFilterPopup = __importStar(__webpack_require__(/*! ./word-filter-popup */ "./src/scripts/popups/word-filter-popup.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const SavedTextsPopup = __importStar(__webpack_require__(/*! ./saved-texts-popup */ "./src/scripts/popups/saved-texts-popup.ts"));
const wrapper = "#customTextPopupWrapper";
const popup = "#customTextPopup";
function show() {
    if ($(wrapper).hasClass("hidden")) {
        if ($(`${popup} .checkbox input`).prop("checked")) {
            $(`${popup} .inputs .randomInputFields`).removeClass("hidden");
        }
        else {
            $(`${popup} .inputs .randomInputFields`).addClass("hidden");
        }
        $(wrapper)
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            let newtext = CustomText.text.join(CustomText.delimiter);
            newtext = newtext.replace(/\n /g, "\n");
            $(`${popup} textarea`).val(newtext);
            $(`${popup} .wordcount input`).val(CustomText.word === -1 ? "" : CustomText.word);
            $(`${popup} .time input`).val(CustomText.time === -1 ? "" : CustomText.time);
            $(`${popup} textarea`).trigger("focus");
        });
    }
    setTimeout(() => {
        $(`${popup} textarea`).trigger("focus");
    }, 150);
}
exports.show = show;
$(`${popup} .delimiterCheck input`).change(() => {
    let delimiter;
    if ($(`${popup} .delimiterCheck input`).prop("checked")) {
        delimiter = "|";
    }
    else {
        delimiter = " ";
    }
    if ($(`${popup} textarea`).val() != CustomText.text.join(CustomText.delimiter)) {
        const currentText = $(`${popup} textarea`).val();
        const currentTextSplit = currentText.split(CustomText.delimiter);
        let newtext = currentTextSplit.join(delimiter);
        newtext = newtext.replace(/\n /g, "\n");
        $(`${popup} textarea`).val(newtext);
    }
    else {
        let newtext = CustomText.text.join(delimiter);
        newtext = newtext.replace(/\n /g, "\n");
        $(`${popup} textarea`).val(newtext);
    }
    CustomText.setDelimiter(delimiter);
});
function hide() {
    if (!$(wrapper).hasClass("hidden")) {
        $(wrapper)
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $(wrapper).addClass("hidden");
        });
    }
}
exports.hide = hide;
function isVisible() {
    return !$(wrapper).hasClass("hidden");
}
exports.isVisible = isVisible;
$(wrapper).mousedown((e) => {
    if ($(e.target).attr("id") === "customTextPopupWrapper") {
        hide();
    }
});
$(`${popup} .inputs .checkbox input`).change(() => {
    if ($(`${popup} .checkbox input`).prop("checked")) {
        $(`${popup} .inputs .randomInputFields`).removeClass("hidden");
    }
    else {
        $(`${popup} .inputs .randomInputFields`).addClass("hidden");
    }
});
$(`${popup} textarea`).on("keypress", (e) => {
    if (e.code === "Enter" && e.ctrlKey) {
        $(`${popup} .button.apply`).click();
    }
});
$(`${popup} .randomInputFields .wordcount input`).on("keypress", () => {
    $(`${popup} .randomInputFields .time input`).val("");
});
$(`${popup} .randomInputFields .time input`).on("keypress", () => {
    $(`${popup} .randomInputFields .wordcount input`).val("");
});
$(`${popup} .buttonsTop .showSavedTexts`).on("click", () => {
    SavedTextsPopup.show();
});
$(`${popup} .buttonsTop .saveCustomText`).on("click", () => {
    hide();
});
function apply() {
    let text = $(`${popup} textarea`).val().normalize();
    text = text.trim();
    // text = text.replace(/[\r]/gm, " ");
    text = text.replace(/\\\\t/gm, "\t");
    text = text.replace(/\\\\n/gm, "\n");
    text = text.replace(/\\t/gm, "\t");
    text = text.replace(/\\n/gm, "\n");
    text = text.replace(/ +/gm, " ");
    // text = text.replace(/(\r\n)+/g, "\r\n");
    // text = text.replace(/(\n)+/g, "\n");
    // text = text.replace(/(\r)+/g, "\r");
    text = text.replace(/( *(\r\n|\r|\n) *)/g, "\n ");
    if ($(`${popup} .typographyCheck input`).prop("checked")) {
        text = Misc.cleanTypographySymbols(text);
    }
    // text = Misc.remove_non_ascii(text);
    text = text.replace(/[\u2060]/g, "");
    CustomText.setText(text.split(CustomText.delimiter));
    CustomText.setWord(parseInt($(`${popup} .wordcount input`).val()) || -1);
    CustomText.setTime(parseInt($(`${popup} .time input`).val()) || -1);
    CustomText.setIsWordRandom($(`${popup} .checkbox input`).prop("checked") && CustomText.word > -1);
    CustomText.setIsTimeRandom($(`${popup} .checkbox input`).prop("checked") && CustomText.time > -1);
    if ($(`${popup} .checkbox input`).prop("checked") &&
        !CustomText.isTimeRandom &&
        !CustomText.isWordRandom) {
        Notifications.add("You need to specify word count or time in seconds to start a random custom test.", 0, 5);
        return;
    }
    if ($(`${popup} .checkbox input`).prop("checked") &&
        CustomText.isTimeRandom &&
        CustomText.isWordRandom) {
        Notifications.add("You need to pick between word count or time in seconds to start a random custom test.", 0, 5);
        return;
    }
    if ((CustomText.isWordRandom && CustomText.word === 0) ||
        (CustomText.isTimeRandom && CustomText.time === 0)) {
        Notifications.add("Infinite words! Make sure to use Bail Out from the command line to save your result.", 0, 7);
    }
    ChallengeController.clearActive();
    ManualRestart.set();
    if (config_1.default.mode !== "custom")
        UpdateConfig.setMode("custom");
    TestLogic.restart();
    hide();
}
$(document).on("click", `${popup} .button.apply`, () => {
    apply();
});
$(document).on("click", `${popup} .wordfilter`, () => {
    WordFilterPopup.show();
});
$(document).on("click", "#top .config .customText .text-button", () => {
    show();
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" &&
        !$("#customTextPopupWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/popups/custom-theme-popup.ts":
/*!**************************************************!*\
  !*** ./src/scripts/popups/custom-theme-popup.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, exports) => {


// import Config, * as UpdateConfig from "./config";
// import * as Notifications from "./notifications";
// import * as ThemePicker from "./theme-picker";
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
function show(value) {
    if ($("#customThemeShareWrapper").hasClass("hidden")) {
        // let save = [];
        // $.each(
        //   $(".pageSettings .section.customTheme [type='color']"),
        //   (index, element) => {
        //     save.push($(element).attr("value"));
        //   }
        // );
        // $("#customThemeShareWrapper input").val(JSON.stringify(save));
        $("#customThemeShareWrapper input").val(value);
        $("#customThemeShareWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#customThemeShare input").trigger("focus");
            $("#customThemeShare input").select();
            $("#customThemeShare input").trigger("focus");
        });
    }
}
exports.show = show;
function hide() {
    if (!$("#customThemeShareWrapper").hasClass("hidden")) {
        // try {
        //   UpdateConfig.setCustomThemeColors(
        //     JSON.parse($("#customThemeShareWrapper input").val())
        //   );
        // } catch (e) {
        //   Notifications.add(
        //     "Something went wrong. Reverting to default custom colors.",
        //     0,
        //     4
        //   );
        //   UpdateConfig.setCustomThemeColors(Config.defaultConfig.customThemeColors);
        // }
        // ThemePicker.setCustomInputs();
        $("#customThemeShareWrapper input").val("");
        $("#customThemeShareWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#customThemeShareWrapper").addClass("hidden");
        });
    }
}
$("#customThemeShareWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "customThemeShareWrapper") {
        hide();
    }
});
$("#customThemeShare .button").on("click", () => {
    hide();
});


/***/ }),

/***/ "./src/scripts/popups/custom-word-amount-popup.ts":
/*!********************************************************!*\
  !*** ./src/scripts/popups/custom-word-amount-popup.ts ***!
  \********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function show() {
    if ($("#customWordAmountPopupWrapper").hasClass("hidden")) {
        $("#customWordAmountPopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#customWordAmountPopup input").trigger("focus").select();
        });
    }
}
exports.show = show;
function hide() {
    if (!$("#customWordAmountPopupWrapper").hasClass("hidden")) {
        $("#customWordAmountPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#customWordAmountPopupWrapper").addClass("hidden");
        });
    }
}
exports.hide = hide;
function apply() {
    const val = parseInt($("#customWordAmountPopup input").val());
    if (val !== null && !isNaN(val) && val >= 0) {
        UpdateConfig.setWordCount(val);
        ManualRestart.set();
        TestLogic.restart();
        if (val > 2000) {
            Notifications.add("Stay safe and take breaks!", 0);
        }
        else if (val == 0) {
            Notifications.add("Infinite words! Make sure to use Bail Out from the command line to save your result.", 0, 7);
        }
    }
    else {
        Notifications.add("Custom word amount must be at least 1", 0);
    }
    hide();
}
$("#customWordAmountPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "customWordAmountPopupWrapper") {
        hide();
    }
});
$("#customWordAmountPopup input").on("keypress", (e) => {
    if (e.key === "Enter") {
        apply();
    }
});
$("#customWordAmountPopup .button").on("click", () => {
    apply();
});
$(document).on("click", "#top .config .wordCount .text-button", (e) => {
    const wrd = $(e.currentTarget).attr("wordCount");
    if (wrd == "custom") {
        show();
    }
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" &&
        !$("#customWordAmountPopupWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/popups/edit-preset-popup.ts":
/*!*************************************************!*\
  !*** ./src/scripts/popups/edit-preset-popup.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Config = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function show(action, id, name) {
    if (action === "add") {
        $("#presetWrapper #presetEdit").attr("action", "add");
        $("#presetWrapper #presetEdit .title").html("Create new preset");
        $("#presetWrapper #presetEdit .button").html(`<i class="fas fa-plus"></i>`);
        $("#presetWrapper #presetEdit input.text").val("");
        $("#presetWrapper #presetEdit input.text").removeClass("hidden");
        $("#presetWrapper #presetEdit label").addClass("hidden");
    }
    else if (action === "edit" && id && name) {
        $("#presetWrapper #presetEdit").attr("action", "edit");
        $("#presetWrapper #presetEdit").attr("presetid", id);
        $("#presetWrapper #presetEdit .title").html("Edit preset");
        $("#presetWrapper #presetEdit .button").html(`<i class="fas fa-pen"></i>`);
        $("#presetWrapper #presetEdit input.text").val(name);
        $("#presetWrapper #presetEdit input.text").removeClass("hidden");
        $("#presetWrapper #presetEdit label input").prop("checked", false);
        $("#presetWrapper #presetEdit label").removeClass("hidden");
    }
    else if (action === "remove" && id) {
        $("#presetWrapper #presetEdit").attr("action", "remove");
        $("#presetWrapper #presetEdit").attr("presetid", id);
        $("#presetWrapper #presetEdit .title").html("Remove preset " + name);
        $("#presetWrapper #presetEdit .button").html(`<i class="fas fa-check"></i>`);
        $("#presetWrapper #presetEdit input.text").addClass("hidden");
        $("#presetWrapper #presetEdit label").addClass("hidden");
    }
    if ($("#presetWrapper").hasClass("hidden")) {
        $("#presetWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#presetWrapper #presetEdit input").trigger("focus");
        });
    }
}
exports.show = show;
function hide() {
    if (!$("#presetWrapper").hasClass("hidden")) {
        $("#presetWrapper #presetEdit").attr("action", "");
        $("#presetWrapper #presetEdit").attr("tagid", "");
        $("#presetWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#presetWrapper").addClass("hidden");
        });
    }
}
function apply() {
    return __awaiter(this, void 0, void 0, function* () {
        const action = $("#presetWrapper #presetEdit").attr("action");
        const presetName = $("#presetWrapper #presetEdit input").val();
        const presetId = $("#presetWrapper #presetEdit").attr("presetId");
        const updateConfig = $("#presetWrapper #presetEdit label input").prop("checked");
        let configChanges = {};
        if ((updateConfig && action === "edit") || action === "add") {
            configChanges = Config.getConfigChanges();
            const tags = DB.getSnapshot().tags || [];
            const activeTagIds = tags
                .filter((tag) => tag.active)
                .map((tag) => tag._id);
            configChanges.tags = activeTagIds;
        }
        const snapshotPresets = DB.getSnapshot().presets || [];
        hide();
        Loader.show();
        if (action === "add") {
            const response = yield ape_1.default.presets.add(presetName, configChanges);
            if (response.status !== 200) {
                Notifications.add("Failed to add preset: " + response.message, -1);
            }
            else {
                Notifications.add("Preset added", 1, 2);
                snapshotPresets.push({
                    name: presetName,
                    config: configChanges,
                    _id: response.data.presetId,
                });
            }
        }
        else if (action === "edit") {
            const response = yield ape_1.default.presets.edit(presetId, presetName, configChanges);
            if (response.status !== 200) {
                Notifications.add("Failed to edit preset: " + response.message, -1);
            }
            else {
                Notifications.add("Preset updated", 1);
                const preset = snapshotPresets.filter((preset) => preset._id === presetId)[0];
                preset.name = presetName;
                if (updateConfig) {
                    preset.config = configChanges;
                }
            }
        }
        else if (action === "remove") {
            const response = yield ape_1.default.presets.delete(presetId);
            if (response.status !== 200) {
                Notifications.add("Failed to remove preset: " + response.message, -1);
            }
            else {
                Notifications.add("Preset removed", 1);
                snapshotPresets.forEach((preset, index) => {
                    if (preset._id === presetId) {
                        snapshotPresets.splice(index, 1);
                    }
                });
            }
        }
        Settings.update();
        Loader.hide();
    });
}
$("#presetWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "presetWrapper") {
        hide();
    }
});
$("#presetWrapper #presetEdit .button").on("click", () => {
    apply();
});
$("#presetWrapper #presetEdit input").on("keypress", (e) => {
    if (e.key === "Enter") {
        apply();
    }
});
$(document).on("click", ".pageSettings .section.presets .addPresetButton", () => {
    show("add");
});
$(document).on("click", ".pageSettings .section.presets .editButton", (e) => {
    const presetid = $(e.currentTarget).parent(".preset").attr("id");
    const name = $(e.currentTarget).siblings(".button").children(".title").text();
    show("edit", presetid, name);
});
$(document).on("click", ".pageSettings .section.presets .removeButton", (e) => {
    const presetid = $(e.currentTarget).parent(".preset").attr("id");
    const name = $(e.currentTarget).siblings(".button").children(".title").text();
    show("remove", presetid, name);
});


/***/ }),

/***/ "./src/scripts/popups/edit-tags-popup.ts":
/*!***********************************************!*\
  !*** ./src/scripts/popups/edit-tags-popup.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const ResultFilters = __importStar(__webpack_require__(/*! ../account/result-filters */ "./src/scripts/account/result-filters.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const ResultTagsPopup = __importStar(__webpack_require__(/*! ./result-tags-popup */ "./src/scripts/popups/result-tags-popup.ts"));
function show(action, id, name) {
    if (action === "add") {
        $("#tagsWrapper #tagsEdit").attr("action", "add");
        $("#tagsWrapper #tagsEdit .title").html("Add new tag");
        $("#tagsWrapper #tagsEdit .button").html(`<i class="fas fa-plus"></i>`);
        $("#tagsWrapper #tagsEdit input").val("");
        $("#tagsWrapper #tagsEdit input").removeClass("hidden");
    }
    else if (action === "edit" && id && name) {
        $("#tagsWrapper #tagsEdit").attr("action", "edit");
        $("#tagsWrapper #tagsEdit").attr("tagid", id);
        $("#tagsWrapper #tagsEdit .title").html("Edit tag name");
        $("#tagsWrapper #tagsEdit .button").html(`<i class="fas fa-pen"></i>`);
        $("#tagsWrapper #tagsEdit input").val(name);
        $("#tagsWrapper #tagsEdit input").removeClass("hidden");
    }
    else if (action === "remove" && id && name) {
        $("#tagsWrapper #tagsEdit").attr("action", "remove");
        $("#tagsWrapper #tagsEdit").attr("tagid", id);
        $("#tagsWrapper #tagsEdit .title").html("Remove tag " + name);
        $("#tagsWrapper #tagsEdit .button").html(`<i class="fas fa-check"></i>`);
        $("#tagsWrapper #tagsEdit input").addClass("hidden");
    }
    else if (action === "clearPb" && id && name) {
        $("#tagsWrapper #tagsEdit").attr("action", "clearPb");
        $("#tagsWrapper #tagsEdit").attr("tagid", id);
        $("#tagsWrapper #tagsEdit .title").html("Clear PB for tag " + name);
        $("#tagsWrapper #tagsEdit .button").html(`<i class="fas fa-check"></i>`);
        $("#tagsWrapper #tagsEdit input").addClass("hidden");
    }
    if ($("#tagsWrapper").hasClass("hidden")) {
        $("#tagsWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#tagsWrapper #tagsEdit input").trigger("focus");
        });
    }
}
exports.show = show;
function hide() {
    if (!$("#tagsWrapper").hasClass("hidden")) {
        $("#tagsWrapper #tagsEdit").attr("action", "");
        $("#tagsWrapper #tagsEdit").attr("tagid", "");
        $("#tagsWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#tagsWrapper").addClass("hidden");
        });
    }
}
function apply() {
    var _a, _b, _c, _d;
    return __awaiter(this, void 0, void 0, function* () {
        const action = $("#tagsWrapper #tagsEdit").attr("action");
        const tagName = $("#tagsWrapper #tagsEdit input").val();
        const tagId = $("#tagsWrapper #tagsEdit").attr("tagid");
        hide();
        Loader.show();
        if (action === "add") {
            const response = yield ape_1.default.users.createTag(tagName);
            if (response.status !== 200) {
                Notifications.add("Failed to add tag: " + response.message, -1);
            }
            else {
                Notifications.add("Tag added", 1);
                (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.push({
                    name: response.data.name,
                    _id: response.data._id,
                });
                ResultTagsPopup.updateButtons();
                Settings.update();
                ResultFilters.updateTags();
            }
        }
        else if (action === "edit") {
            const response = yield ape_1.default.users.editTag(tagId, tagName);
            if (response.status !== 200) {
                Notifications.add("Failed to edit tag: " + response.message, -1);
            }
            else {
                Notifications.add("Tag updated", 1);
                (_b = DB.getSnapshot().tags) === null || _b === void 0 ? void 0 : _b.forEach((tag) => {
                    if (tag._id === tagId) {
                        tag.name = tagName;
                    }
                });
                ResultTagsPopup.updateButtons();
                Settings.update();
                ResultFilters.updateTags();
            }
        }
        else if (action === "remove") {
            const response = yield ape_1.default.users.deleteTag(tagId);
            if (response.status !== 200) {
                Notifications.add("Failed to remove tag: " + response.message, -1);
            }
            else {
                Notifications.add("Tag removed", 1);
                (_c = DB.getSnapshot().tags) === null || _c === void 0 ? void 0 : _c.forEach((tag, index) => {
                    var _a;
                    if (tag._id === tagId) {
                        (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.splice(index, 1);
                    }
                });
                ResultTagsPopup.updateButtons();
                Settings.update();
                ResultFilters.updateTags();
            }
        }
        else if (action === "clearPb") {
            const response = yield ape_1.default.users.deleteTagPersonalBest(tagId);
            if (response.status !== 200) {
                Notifications.add("Failed to clear tag pb: " + response.message, -1);
            }
            else {
                Notifications.add("Tag PB cleared", 1);
                (_d = DB.getSnapshot().tags) === null || _d === void 0 ? void 0 : _d.forEach((tag) => {
                    if (tag._id === tagId) {
                        tag.personalBests = {
                            time: {},
                            words: {},
                            custom: { custom: [] },
                            zen: { zen: [] },
                            quote: { custom: [] },
                        };
                    }
                });
                ResultTagsPopup.updateButtons();
                Settings.update();
                ResultFilters.updateTags();
            }
        }
        Loader.hide();
    });
}
$("#tagsWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "tagsWrapper") {
        hide();
    }
});
$("#tagsWrapper #tagsEdit .button").on("click", () => {
    apply();
});
$("#tagsWrapper #tagsEdit input").on("keypress", (e) => {
    if (e.key === "Enter") {
        apply();
    }
});
$(document).on("click", ".pageSettings .section.tags .addTagButton", () => {
    show("add");
});
$(document).on("click", ".pageSettings .section.tags .tagsList .tag .editButton", (e) => {
    const tagid = $(e.currentTarget).parent(".tag").attr("id");
    const name = $(e.currentTarget)
        .siblings(".tagButton")
        .children(".title")
        .text();
    show("edit", tagid, name);
});
$(document).on("click", ".pageSettings .section.tags .tagsList .tag .clearPbButton", (e) => {
    const tagid = $(e.currentTarget).parent(".tag").attr("id");
    const name = $(e.currentTarget)
        .siblings(".tagButton")
        .children(".title")
        .text();
    show("clearPb", tagid, name);
});
$(document).on("click", ".pageSettings .section.tags .tagsList .tag .removeButton", (e) => {
    const tagid = $(e.currentTarget).parent(".tag").attr("id");
    const name = $(e.currentTarget)
        .siblings(".tagButton")
        .children(".title")
        .text();
    show("remove", tagid, name);
});


/***/ }),

/***/ "./src/scripts/popups/import-export-settings-popup.ts":
/*!************************************************************!*\
  !*** ./src/scripts/popups/import-export-settings-popup.ts ***!
  \************************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function show(mode, config) {
    if ($("#settingsImportWrapper").hasClass("hidden")) {
        $("#settingsImportWrapper").attr("mode", mode);
        if (mode === "export") {
            $("#settingsImportWrapper .button").addClass("hidden");
            $("#settingsImportWrapper input").val(config !== null && config !== void 0 ? config : "");
        }
        else if (mode === "import") {
            $("#settingsImportWrapper .button").removeClass("hidden");
        }
        $("#settingsImportWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#settingsImportWrapper input").trigger("focus");
            $("#settingsImportWrapper input").select();
            $("#settingsImportWrapper input").trigger("focus");
        });
    }
}
exports.show = show;
function hide() {
    if (!$("#settingsImportWrapper").hasClass("hidden")) {
        if ($("#settingsImportWrapper input").val() !== "") {
            try {
                UpdateConfig.apply(JSON.parse($("#settingsImportWrapper input").val()));
            }
            catch (e) {
                Notifications.add("An error occured while importing settings: " + e, -1);
            }
            UpdateConfig.saveFullConfigToLocalStorage();
        }
        $("#settingsImportWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({ opacity: 0 }, 100, () => {
            $("#settingsImportWrapper").addClass("hidden");
        });
    }
}
$("#settingsImport .button").on("click", () => {
    hide();
});
$("#settingsImportWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "settingsImportWrapper") {
        hide();
    }
});


/***/ }),

/***/ "./src/scripts/popups/mobile-test-config-popup.ts":
/*!********************************************************!*\
  !*** ./src/scripts/popups/mobile-test-config-popup.ts ***!
  \********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = void 0;
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const CustomWordAmountPopup = __importStar(__webpack_require__(/*! ./custom-word-amount-popup */ "./src/scripts/popups/custom-word-amount-popup.ts"));
const CustomTestDurationPopup = __importStar(__webpack_require__(/*! ./custom-test-duration-popup */ "./src/scripts/popups/custom-test-duration-popup.ts"));
const QuoteSearchPopup = __importStar(__webpack_require__(/*! ./quote-search-popup */ "./src/scripts/popups/quote-search-popup.ts"));
const CustomTextPopup = __importStar(__webpack_require__(/*! ./custom-text-popup */ "./src/scripts/popups/custom-text-popup.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const el = $("#mobileTestConfigPopup");
function update() {
    el.find(".button").removeClass("active");
    el.find(`.modeGroup .button[mode='${config_1.default.mode}']`).addClass("active");
    el.find(".timeGroup").addClass("hidden");
    el.find(".wordsGroup").addClass("hidden");
    el.find(".quoteGroup").addClass("hidden");
    el.find(".customGroup").addClass("hidden");
    el.find(`.${config_1.default.mode}Group`).removeClass("hidden");
    if (config_1.default.punctuation) {
        el.find(".punctuation").addClass("active");
    }
    else {
        el.find(".punctuation").removeClass("active");
    }
    if (config_1.default.numbers) {
        el.find(".numbers").addClass("active");
    }
    else {
        el.find(".numbers").removeClass("active");
    }
    if (config_1.default.mode === "time") {
        el.find(`.timeGroup .button[time='${config_1.default.time}']`).addClass("active");
        el.find(".punctuation").removeClass("disabled");
        el.find(".numbers").removeClass("disabled");
    }
    else if (config_1.default.mode === "words") {
        el.find(`.wordsGroup .button[words='${config_1.default.words}']`).addClass("active");
        el.find(".punctuation").removeClass("disabled");
        el.find(".numbers").removeClass("disabled");
    }
    else if (config_1.default.mode === "quote") {
        el.find(`.quoteGroup .button[quote='${config_1.default.quoteLength}']`).addClass("active");
        el.find(".punctuation").addClass("disabled");
        el.find(".numbers").addClass("disabled");
    }
    else if (config_1.default.mode === "zen") {
        el.find(".punctuation").addClass("disabled");
        el.find(".numbers").addClass("disabled");
    }
    else if (config_1.default.mode === "custom") {
        el.find(".punctuation").removeClass("disabled");
        el.find(".numbers").removeClass("disabled");
    }
}
exports.update = update;
function showPopup() {
    if ($("#mobileTestConfigPopupWrapper").hasClass("hidden")) {
        update();
        $("#mobileTestConfigPopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100);
    }
}
function hidePopup() {
    if (!$("#mobileTestConfigPopupWrapper").hasClass("hidden")) {
        $("#mobileTestConfigPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#mobileTestConfigPopupWrapper").addClass("hidden");
        });
    }
}
$("#mobileTestConfigPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "mobileTestConfigPopupWrapper") {
        hidePopup();
    }
});
$("#top .mobileConfig").on("click", () => {
    showPopup();
});
el.find(".wordsGroup .button").on("click", (e) => {
    const wrd = $(e.currentTarget).attr("words");
    if (wrd == "custom") {
        hidePopup();
        CustomWordAmountPopup.show();
    }
    else if (wrd !== undefined) {
        const wrdNum = parseInt(wrd);
        UpdateConfig.setWordCount(wrdNum);
        ManualRestart.set();
        TestLogic.restart();
    }
});
el.find(".timeGroup .button").on("click", (e) => {
    const time = $(e.currentTarget).attr("time");
    if (time == "custom") {
        hidePopup();
        CustomTestDurationPopup.show();
    }
    else if (time !== undefined) {
        const timeNum = parseInt(time);
        UpdateConfig.setTimeConfig(timeNum);
        ManualRestart.set();
        TestLogic.restart();
    }
});
el.find(".quoteGroup .button").on("click", (e) => {
    var _a;
    let len = ((_a = $(e.currentTarget).attr("quote")) !== null && _a !== void 0 ? _a : 0);
    if (len == -2) {
        // UpdateConfig.setQuoteLength(-2, false, e.shiftKey);
        hidePopup();
        QuoteSearchPopup.show();
    }
    else {
        if (len == -1) {
            len = [0, 1, 2, 3];
        }
        UpdateConfig.setQuoteLength(len, false, e.shiftKey);
        ManualRestart.set();
        TestLogic.restart();
    }
});
el.find(".customChange").on("click", () => {
    hidePopup();
    CustomTextPopup.show();
});
el.find(".punctuation").on("click", () => {
    UpdateConfig.setPunctuation(!config_1.default.punctuation);
    ManualRestart.set();
    TestLogic.restart();
});
el.find(".numbers").on("click", () => {
    UpdateConfig.setNumbers(!config_1.default.numbers);
    ManualRestart.set();
    TestLogic.restart();
});
el.find(".modeGroup .button").on("click", (e) => {
    if ($(e.currentTarget).hasClass("active"))
        return;
    const mode = $(e.currentTarget).attr("mode");
    UpdateConfig.setMode(mode);
    ManualRestart.set();
    TestLogic.restart();
});
$("#mobileTestConfigPopup .button").on("click", () => {
    // hidePopup();
    update();
});
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "mode")
        update();
});


/***/ }),

/***/ "./src/scripts/popups/pb-tables-popup.ts":
/*!***********************************************!*\
  !*** ./src/scripts/popups/pb-tables-popup.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
function update(mode) {
    $("#pbTablesPopup table tbody").empty();
    $($("#pbTablesPopup table thead tr td")[0]).text(mode);
    const snapshot = DB.getSnapshot();
    const allmode2 = (snapshot.personalBests === undefined
        ? undefined
        : snapshot.personalBests[mode]);
    if (allmode2 === undefined)
        return;
    const list = [];
    Object.keys(allmode2).forEach(function (key) {
        let pbs = allmode2[key];
        pbs = pbs.sort(function (a, b) {
            return b.wpm - a.wpm;
            // if (a.difficulty === b.difficulty) {
            //   return (a.language < b.language ? -1 : 1);
            // }
            // return (a.difficulty < b.difficulty ? -1 : 1)
        });
        pbs.forEach(function (pb) {
            pb.mode2 = key;
            list.push(pb);
        });
    });
    let mode2memory;
    list.forEach((pb) => {
        let dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pb.timestamp);
        if (pb.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        $("#pbTablesPopup table tbody").append(`
      <tr>
        <td>${mode2memory === pb.mode2 ? "" : pb.mode2}</td>
        <td>
          ${pb.wpm}
          <br />
          <span class="sub">${pb.acc ? pb.acc + "%" : "-"}</span>
        </td>
        <td>
          ${pb.raw ? pb.raw : "-"}
          <br />
          <span class="sub">${pb.consistency ? pb.consistency + "%" : "-"}</span>
        </td>
        <td>${pb.difficulty}</td>
        <td>${pb.language ? pb.language.replace(/_/g, " ") : "-"}</td>
        <td>${pb.punctuation ? '<i class="fas fa-check"></i>' : ""}</td>
        <td>${pb.lazyMode ? '<i class="fas fa-check"></i>' : ""}</td>
        <td>${dateText}</td>
      </tr>
    `);
        mode2memory = pb.mode2;
    });
}
function show(mode) {
    if ($("#pbTablesPopupWrapper").hasClass("hidden")) {
        update(mode);
        $("#pbTablesPopup .title").text(`All ${mode} personal bests`);
        $("#pbTablesPopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100);
    }
}
function hide() {
    if (!$("#pbTablesPopupWrapper").hasClass("hidden")) {
        $("#pbTablesPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#pbTablesPopupWrapper").addClass("hidden");
            $("#pbTablesPopup table tbody").empty();
        });
    }
}
$("#pbTablesPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "pbTablesPopupWrapper") {
        hide();
    }
});
$(".pageAccount .button.showAllTimePbs").on("click", () => {
    show("time");
});
$(".pageAccount .button.showAllWordsPbs").on("click", () => {
    show("words");
});


/***/ }),

/***/ "./src/scripts/popups/quote-approve-popup.ts":
/*!***************************************************!*\
  !*** ./src/scripts/popups/quote-approve-popup.ts ***!
  \***************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
let quotes = [];
function updateList() {
    $("#quoteApprovePopupWrapper .quotes").empty();
    quotes.forEach((quote, index) => {
        const quoteEl = $(`
      <div class="quote" id="${index}" dbid="${quote._id}">
        <textarea class="text">${quote.text}</textarea>
        <input type="text" class="source" placeholder="Source" value="${quote.source}">
        <div class="buttons">
          <div class="icon-button disabled undo" aria-label="Undo changes" data-balloon-pos="left"><i class="fas fa-fw fa-undo-alt"></i></div>
          <div class="icon-button refuse" aria-label="Refuse quote" data-balloon-pos="left"><i class="fas fa-fw fa-times"></i></div>
          <div class="icon-button approve" aria-label="Approve quote" data-balloon-pos="left"><i class="fas fa-fw fa-check"></i></div>
          <div class="icon-button edit hidden" aria-label="Edit and approve quote" data-balloon-pos="left"><i class="fas fa-fw fa-pen"></i></div>
        </div>
        <div class="bottom">
          <div class="length ${quote.text.length < 60 ? "red" : ""}">Quote length: ${quote.text.length}</div>
          <div class="language">Language: ${quote.language}</div>
          <div class="timestamp">Submitted on: ${(0, format_1.default)(new Date(quote.timestamp), "dd MMM yyyy HH:mm")}</div>
        </div>
      </div>
    `);
        $("#quoteApprovePopupWrapper .quotes").append(quoteEl);
    });
}
function updateQuoteLength(index) {
    var _a;
    const len = (_a = $(`#quoteApprovePopup .quote[id=${index}] .text`).val()) === null || _a === void 0 ? void 0 : _a.length;
    $(`#quoteApprovePopup .quote[id=${index}] .length`).text("Quote length: " + len);
    if (len < 60) {
        $(`#quoteApprovePopup .quote[id=${index}] .length`).addClass("red");
    }
    else {
        $(`#quoteApprovePopup .quote[id=${index}] .length`).removeClass("red");
    }
}
function getQuotes() {
    return __awaiter(this, void 0, void 0, function* () {
        Loader.show();
        const response = yield ape_1.default.quotes.get();
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to get new quotes: " + response.message, -1);
        }
        quotes = response.data;
        updateList();
    });
}
function show(noAnim = false) {
    return __awaiter(this, void 0, void 0, function* () {
        if ($("#quoteApprovePopupWrapper").hasClass("hidden")) {
            quotes = [];
            getQuotes();
            $("#quoteApprovePopupWrapper")
                .stop(true, true)
                .css("opacity", 0)
                .removeClass("hidden")
                .animate({ opacity: 1 }, noAnim ? 0 : 100);
        }
    });
}
exports.show = show;
function hide() {
    if (!$("#quoteApprovePopupWrapper").hasClass("hidden")) {
        $("#quoteApprovePopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#quoteApprovePopupWrapper").addClass("hidden");
            $("#quoteApprovePopupWrapper .quotes").empty();
        });
    }
}
exports.hide = hide;
function resetButtons(target) {
    $(target).closest(".quote").find(".icon-button").removeClass("disabled");
    if ($(target).closest(".quote").find(".edit").hasClass("hidden")) {
        $(target).closest(".quote").find(".undo").addClass("disabled");
    }
}
$("#quoteApprovePopupWrapper").on("mousedown", (e) => {
    if ($(e.target).attr("id") === "quoteApprovePopupWrapper") {
        hide();
    }
});
$("#quoteApprovePopupWrapper .button.refreshList").on("click", () => {
    $("#quoteApprovePopupWrapper .quotes").empty();
    getQuotes();
});
$(document).on("click", "#quoteApprovePopup .quote .undo", (e) => __awaiter(void 0, void 0, void 0, function* () {
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    $(`#quoteApprovePopup .quote[id=${index}] .text`).val(quotes[index].text);
    $(`#quoteApprovePopup .quote[id=${index}] .source`).val(quotes[index].source);
    $(`#quoteApprovePopup .quote[id=${index}] .undo`).addClass("disabled");
    $(`#quoteApprovePopup .quote[id=${index}] .approve`).removeClass("hidden");
    $(`#quoteApprovePopup .quote[id=${index}] .edit`).addClass("hidden");
    updateQuoteLength(index);
}));
$(document).on("click", "#quoteApprovePopup .quote .approve", (e) => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    if (!confirm("Are you sure?"))
        return;
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    const dbid = $(e.target).closest(".quote").attr("dbid");
    const target = e.target;
    $(target).closest(".quote").find(".icon-button").addClass("disabled");
    $(target).closest(".quote").find("textarea, input").prop("disabled", true);
    Loader.show();
    const response = yield ape_1.default.quotes.approveSubmission(dbid);
    Loader.hide();
    if (response.status !== 200) {
        resetButtons(target);
        $(target).closest(".quote").find("textarea, input").prop("disabled", false);
        return Notifications.add("Failed to approve quote: " + response.message, -1);
    }
    Notifications.add((_a = "Quote approved. " + response.message) !== null && _a !== void 0 ? _a : "", 1);
    quotes.splice(index, 1);
    updateList();
}));
$(document).on("click", "#quoteApprovePopup .quote .refuse", (e) => __awaiter(void 0, void 0, void 0, function* () {
    if (!confirm("Are you sure?"))
        return;
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    const dbid = $(e.target).closest(".quote").attr("dbid");
    const target = e.target;
    $(target).closest(".quote").find(".icon-button").addClass("disabled");
    $(target).closest(".quote").find("textarea, input").prop("disabled", true);
    Loader.show();
    const response = yield ape_1.default.quotes.rejectSubmission(dbid);
    Loader.hide();
    if (response.status !== 200) {
        resetButtons(target);
        $(target).closest(".quote").find("textarea, input").prop("disabled", false);
        return Notifications.add("Failed to refuse quote: " + response.message, -1);
    }
    Notifications.add("Quote refused.", 1);
    quotes.splice(index, 1);
    updateList();
}));
$(document).on("click", "#quoteApprovePopup .quote .edit", (e) => __awaiter(void 0, void 0, void 0, function* () {
    var _b;
    if (!confirm("Are you sure?"))
        return;
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    const dbid = $(e.target).closest(".quote").attr("dbid");
    const editText = $(`#quoteApprovePopup .quote[id=${index}] .text`).val();
    const editSource = $(`#quoteApprovePopup .quote[id=${index}] .source`).val();
    const target = e.target;
    $(target).closest(".quote").find(".icon-button").addClass("disabled");
    $(target).closest(".quote").find("textarea, input").prop("disabled", true);
    Loader.show();
    const response = yield ape_1.default.quotes.approveSubmission(dbid, editText, editSource);
    Loader.hide();
    if (response.status !== 200) {
        resetButtons(target);
        $(target).closest(".quote").find("textarea, input").prop("disabled", false);
        return Notifications.add("Failed to approve quote: " + response.message, -1);
    }
    Notifications.add((_b = "Quote edited and approved. " + response.message) !== null && _b !== void 0 ? _b : "", 1);
    quotes.splice(index, 1);
    updateList();
}));
$(document).on("input", "#quoteApprovePopup .quote .text", (e) => __awaiter(void 0, void 0, void 0, function* () {
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    $(`#quoteApprovePopup .quote[id=${index}] .undo`).removeClass("disabled");
    $(`#quoteApprovePopup .quote[id=${index}] .approve`).addClass("hidden");
    $(`#quoteApprovePopup .quote[id=${index}] .edit`).removeClass("hidden");
    updateQuoteLength(index);
}));
$(document).on("input", "#quoteApprovePopup .quote .source", (e) => __awaiter(void 0, void 0, void 0, function* () {
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    $(`#quoteApprovePopup .quote[id=${index}] .undo`).removeClass("disabled");
    $(`#quoteApprovePopup .quote[id=${index}] .approve`).addClass("hidden");
    $(`#quoteApprovePopup .quote[id=${index}] .edit`).removeClass("hidden");
}));


/***/ }),

/***/ "./src/scripts/popups/quote-rate-popup.ts":
/*!************************************************!*\
  !*** ./src/scripts/popups/quote-rate-popup.ts ***!
  \************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.clearQuoteStats = exports.show = exports.getQuoteStats = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const TestWords = __importStar(__webpack_require__(/*! ../test/test-words */ "./src/scripts/test/test-words.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
let rating = 0;
let quoteStats = null;
let currentQuote = null;
function reset() {
    $(`#quoteRatePopup .quote .text`).text("-");
    $(`#quoteRatePopup .quote .source .val`).text("-");
    $(`#quoteRatePopup .quote .id .val`).text("-");
    $(`#quoteRatePopup .quote .length .val`).text("-");
    $("#quoteRatePopup .ratingCount .val").text("-");
    $("#quoteRatePopup .ratingAverage .val").text("-");
}
function getRatingAverage(quoteStats) {
    if (!quoteStats.totalRating || !quoteStats.ratings) {
        return 0;
    }
    return Math.round((quoteStats.totalRating / quoteStats.ratings) * 10) / 10;
}
function getQuoteStats(quote) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!quote) {
            return;
        }
        currentQuote = quote;
        const response = yield ape_1.default.quotes.getRating(currentQuote);
        Loader.hide();
        if (response.status !== 200) {
            Notifications.add("Failed to get quote ratings: " + response.message, -1);
            return;
        }
        if (!response.data) {
            return {};
        }
        quoteStats = response.data;
        if (quoteStats && !quoteStats.average) {
            quoteStats.average = getRatingAverage(quoteStats);
        }
        return quoteStats;
    });
}
exports.getQuoteStats = getQuoteStats;
function refreshStars(force) {
    const limit = force ? force : rating;
    $(`#quoteRatePopup .star`).removeClass("active");
    for (let i = 1; i <= limit; i++) {
        $(`#quoteRatePopup .star[rating=${i}]`).addClass("active");
    }
}
function updateRatingStats() {
    var _a, _b, _c;
    return __awaiter(this, void 0, void 0, function* () {
        if (!quoteStats)
            yield getQuoteStats();
        $("#quoteRatePopup .ratingCount .val").text((_a = quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.ratings) !== null && _a !== void 0 ? _a : "0");
        $("#quoteRatePopup .ratingAverage .val").text((_c = (_b = quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.average) === null || _b === void 0 ? void 0 : _b.toFixed(1)) !== null && _c !== void 0 ? _c : "-");
    });
}
function updateData() {
    if (!currentQuote)
        return;
    let lengthDesc;
    if (currentQuote.group == 0) {
        lengthDesc = "short";
    }
    else if (currentQuote.group == 1) {
        lengthDesc = "medium";
    }
    else if (currentQuote.group == 2) {
        lengthDesc = "long";
    }
    else if (currentQuote.group == 3) {
        lengthDesc = "thicc";
    }
    $(`#quoteRatePopup .quote .text`).text(currentQuote.text);
    $(`#quoteRatePopup .quote .source .val`).text(currentQuote.source);
    $(`#quoteRatePopup .quote .id .val`).text(currentQuote.id);
    $(`#quoteRatePopup .quote .length .val`).text(lengthDesc);
    updateRatingStats();
}
function show(quote, shouldReset = true) {
    var _a, _b;
    if ($("#quoteRatePopupWrapper").hasClass("hidden")) {
        if (shouldReset) {
            reset();
        }
        currentQuote = quote;
        rating = 0;
        const snapshot = DB.getSnapshot();
        const alreadyRated = (_b = (_a = snapshot === null || snapshot === void 0 ? void 0 : snapshot.quoteRatings) === null || _a === void 0 ? void 0 : _a[currentQuote.language]) === null || _b === void 0 ? void 0 : _b[currentQuote.id];
        if (alreadyRated) {
            rating = alreadyRated;
        }
        refreshStars();
        updateData();
        $("#quoteRatePopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 125);
    }
}
exports.show = show;
function hide() {
    if (!$("#quoteRatePopupWrapper").hasClass("hidden")) {
        $("#quoteRatePopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#quoteRatePopupWrapper").addClass("hidden");
        });
    }
}
function clearQuoteStats() {
    quoteStats = null;
}
exports.clearQuoteStats = clearQuoteStats;
function submit() {
    var _a, _b, _c;
    return __awaiter(this, void 0, void 0, function* () {
        if (rating === 0) {
            return Notifications.add("Please select a rating");
        }
        if (!currentQuote) {
            return;
        }
        hide();
        const response = yield ape_1.default.quotes.addRating(currentQuote, rating);
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to submit quote rating: " + response.message, -1);
        }
        const snapshot = DB.getSnapshot();
        const quoteRatings = (_a = snapshot.quoteRatings) !== null && _a !== void 0 ? _a : {};
        if ((_b = quoteRatings === null || quoteRatings === void 0 ? void 0 : quoteRatings[currentQuote.language]) === null || _b === void 0 ? void 0 : _b[currentQuote.id]) {
            const oldRating = quoteRatings[currentQuote.language][currentQuote.id];
            const diff = rating - oldRating;
            quoteRatings[currentQuote.language][currentQuote.id] = rating;
            quoteStats = {
                ratings: quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.ratings,
                totalRating: isNaN(quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.totalRating)
                    ? 0
                    : (quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.totalRating) + diff,
                quoteId: currentQuote.id,
                language: currentQuote.language,
            };
            Notifications.add("Rating updated", 1);
        }
        else {
            if (!quoteRatings[currentQuote.language]) {
                quoteRatings[currentQuote.language] = {};
            }
            quoteRatings[currentQuote.language][currentQuote.id] = rating;
            if ((quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.ratings) && quoteStats.totalRating) {
                quoteStats.ratings++;
                quoteStats.totalRating += rating;
            }
            else {
                quoteStats = {
                    ratings: 1,
                    totalRating: rating,
                    quoteId: currentQuote.id,
                    language: currentQuote.language,
                };
            }
            Notifications.add("Rating submitted", 1);
        }
        snapshot.quoteRatings = quoteRatings;
        DB.setSnapshot(snapshot);
        quoteStats.average = getRatingAverage(quoteStats);
        $(".pageTest #result #rateQuoteButton .rating").text((_c = quoteStats.average) === null || _c === void 0 ? void 0 : _c.toFixed(1));
        $(".pageTest #result #rateQuoteButton .icon").removeClass("far");
        $(".pageTest #result #rateQuoteButton .icon").addClass("fas");
    });
}
$("#quoteRatePopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "quoteRatePopupWrapper") {
        hide();
    }
});
$("#quoteRatePopup .stars .star").hover((e) => {
    const ratingHover = parseInt($(e.currentTarget).attr("rating"));
    refreshStars(ratingHover);
});
$("#quoteRatePopup .stars .star").on("click", (e) => {
    const ratingHover = parseInt($(e.currentTarget).attr("rating"));
    rating = ratingHover;
});
$("#quoteRatePopup .stars .star").mouseout(() => {
    $(`#quoteRatePopup .star`).removeClass("active");
    refreshStars();
});
$("#quoteRatePopup .submitButton").on("click", () => {
    submit();
});
$(".pageTest #rateQuoteButton").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    // TODO remove this when done with TestWords
    show(TestWords.randomQuote);
}));


/***/ }),

/***/ "./src/scripts/popups/quote-report-popup.ts":
/*!**************************************************!*\
  !*** ./src/scripts/popups/quote-report-popup.ts ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestWords = __importStar(__webpack_require__(/*! ../test/test-words */ "./src/scripts/test/test-words.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const quotes_controller_1 = __importDefault(__webpack_require__(/*! ../controllers/quotes-controller */ "./src/scripts/controllers/quotes-controller.ts"));
const CAPTCHA_ID = 1;
const state = {
    previousPopupShowCallback: undefined,
    quoteToReport: undefined,
};
const defaultOptions = {
    quoteId: -1,
    previousPopupShowCallback: () => {
        //
    },
    noAnim: false,
};
function show(options = defaultOptions) {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        if ($("#quoteReportPopupWrapper").hasClass("hidden")) {
            const { quoteId, previousPopupShowCallback, noAnim } = options;
            state.previousPopupShowCallback = previousPopupShowCallback;
            const { quotes } = yield quotes_controller_1.default.getQuotes(config_1.default.language);
            state.quoteToReport = quotes.find((quote) => {
                return quote.id === quoteId;
            });
            $("#quoteReportPopup .quote").text((_a = state.quoteToReport) === null || _a === void 0 ? void 0 : _a.text);
            $("#quoteReportPopup .reason").val("Grammatical error");
            $("#quoteReportPopup .comment").val("");
            $("#quoteReportPopup .characterCount").text("-");
            $("#quoteReportPopup .reason").select2({
                minimumResultsForSearch: Infinity,
            });
            $("#quoteReportPopupWrapper")
                .stop(true, true)
                .css("opacity", 0)
                .removeClass("hidden")
                .animate({ opacity: 1 }, noAnim ? 0 : 100, () => {
                $("#quoteReportPopup textarea").trigger("focus").select();
            });
        }
    });
}
exports.show = show;
function hide() {
    return __awaiter(this, void 0, void 0, function* () {
        if (!$("#quoteReportPopupWrapper").hasClass("hidden")) {
            const noAnim = state.previousPopupShowCallback ? true : false;
            $("#quoteReportPopupWrapper")
                .stop(true, true)
                .css("opacity", 1)
                .animate({
                opacity: 0,
            }, noAnim ? 0 : 100, () => {
                grecaptcha.reset(CAPTCHA_ID);
                $("#quoteReportPopupWrapper").addClass("hidden");
                if (state.previousPopupShowCallback) {
                    state.previousPopupShowCallback();
                }
            });
        }
    });
}
exports.hide = hide;
function submitReport() {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        const captchaResponse = grecaptcha.getResponse(CAPTCHA_ID);
        if (!captchaResponse) {
            return Notifications.add("Please complete the captcha.");
        }
        const quoteId = (_a = state.quoteToReport) === null || _a === void 0 ? void 0 : _a.id.toString();
        const quoteLanguage = config_1.default.language;
        const reason = $("#quoteReportPopup .reason").val();
        const comment = $("#quoteReportPopup .comment").val();
        const captcha = captchaResponse;
        if (!quoteId) {
            return Notifications.add("Please select a quote.");
        }
        if (!reason) {
            return Notifications.add("Please select a valid report reason.");
        }
        const characterDifference = comment.length - 250;
        if (characterDifference > 0) {
            return Notifications.add(`Report comment is ${characterDifference} character(s) too long.`);
        }
        Loader.show();
        const response = yield ape_1.default.quotes.report(quoteId, quoteLanguage, reason, comment, captcha);
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to report quote: " + response.message, -1);
        }
        Notifications.add("Report submitted. Thank you!", 1);
        hide();
    });
}
$("#quoteReportPopupWrapper").on("mousedown", (e) => {
    if ($(e.target).attr("id") === "quoteReportPopupWrapper") {
        hide();
    }
});
$("#quoteReportPopup .comment").on("input", () => {
    setTimeout(() => {
        const len = $("#quoteReportPopup .comment").val().length;
        $("#quoteReportPopup .characterCount").text(len);
        if (len > 250) {
            $("#quoteReportPopup .characterCount").addClass("red");
        }
        else {
            $("#quoteReportPopup .characterCount").removeClass("red");
        }
    }, 1);
});
$("#quoteReportPopup .submit").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    yield submitReport();
}));
$(".pageTest #reportQuoteButton").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    show({
        quoteId: (_a = TestWords.randomQuote) === null || _a === void 0 ? void 0 : _a.id,
        noAnim: false,
    });
}));


/***/ }),

/***/ "./src/scripts/popups/quote-search-popup.ts":
/*!**************************************************!*\
  !*** ./src/scripts/popups/quote-search-popup.ts ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.apply = exports.hide = exports.show = exports.setSelectedId = exports.selectedId = void 0;
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const QuoteSubmitPopup = __importStar(__webpack_require__(/*! ./quote-submit-popup */ "./src/scripts/popups/quote-submit-popup.ts"));
const QuoteApprovePopup = __importStar(__webpack_require__(/*! ./quote-approve-popup */ "./src/scripts/popups/quote-approve-popup.ts"));
const QuoteReportPopup = __importStar(__webpack_require__(/*! ./quote-report-popup */ "./src/scripts/popups/quote-report-popup.ts"));
const search_service_1 = __webpack_require__(/*! ../utils/search-service */ "./src/scripts/utils/search-service.ts");
const debounce_1 = __webpack_require__(/*! ../utils/debounce */ "./src/scripts/utils/debounce.ts");
const strings_1 = __webpack_require__(/*! ../utils/strings */ "./src/scripts/utils/strings.ts");
const quotes_controller_1 = __importDefault(__webpack_require__(/*! ../controllers/quotes-controller */ "./src/scripts/controllers/quotes-controller.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
exports.selectedId = 1;
function setSelectedId(val) {
    exports.selectedId = val;
}
exports.setSelectedId = setSelectedId;
const searchServiceCache = {};
function getSearchService(language, data, textExtractor) {
    if (language in searchServiceCache) {
        return searchServiceCache[language];
    }
    const newSearchService = (0, search_service_1.buildSearchService)(data, textExtractor);
    searchServiceCache[language] = newSearchService;
    return newSearchService;
}
function highlightMatches(text, matchedText) {
    if (matchedText.length === 0) {
        return text;
    }
    const words = (0, strings_1.splitByAndKeep)(text, `.,"/#!$%^&*;:{}=-_\`~() `.split(""));
    const normalizedWords = words.map((word) => {
        const shouldHighlight = matchedText.find((match) => {
            return word.startsWith(match);
        });
        return shouldHighlight ? `<span class="highlight">${word}</span>` : word;
    });
    return normalizedWords.join("");
}
function applyQuoteLengthFilter(quotes) {
    const quoteLengthFilterValue = $("#quoteSearchPopup .quoteLengthFilter").val();
    if (quoteLengthFilterValue.length === 0) {
        return quotes;
    }
    const quoteLengthFilter = quoteLengthFilterValue.map((filterValue) => parseInt(filterValue, 10));
    const filteredQuotes = quotes.filter((quote) => quoteLengthFilter.includes(quote.group));
    return filteredQuotes;
}
function buildQuoteSearchResult(quote, matchedSearchTerms) {
    let lengthDesc;
    if (quote.length < 101) {
        lengthDesc = "short";
    }
    else if (quote.length < 301) {
        lengthDesc = "medium";
    }
    else if (quote.length < 601) {
        lengthDesc = "long";
    }
    else {
        lengthDesc = "thicc";
    }
    const isNotAuthed = !firebase_1.Auth.currentUser;
    return `
  <div class="searchResult" id="${quote.id}">
    <div class="text">
      ${highlightMatches(quote.text, matchedSearchTerms)}
    </div>
    <div class="id">
      <div class="sub">id</div>
      <span class="quote-id">
        ${highlightMatches(quote.id.toString(), matchedSearchTerms)}
      </span>
    </div>
    <div class="length">
      <div class="sub">length</div>
      ${lengthDesc}
    </div>
    <div class="source">
      <div class="sub">source</div>
      ${highlightMatches(quote.source, matchedSearchTerms)}</div>
    <div class="icon-button report ${isNotAuthed && "hidden"}" aria-label="Report quote" data-balloon-pos="left">
      <i class="fas fa-flag report"></i>
    </div>
  </div>
  `;
}
function updateResults(searchText) {
    return __awaiter(this, void 0, void 0, function* () {
        const { quotes } = yield quotes_controller_1.default.getQuotes(config_1.default.language);
        const quoteSearchService = getSearchService(config_1.default.language, quotes, (quote) => {
            return `${quote.text} ${quote.id} ${quote.source}`;
        });
        const { results: matches, matchedQueryTerms } = quoteSearchService.query(searchText);
        const quotesToShow = applyQuoteLengthFilter(searchText === "" ? quotes : matches);
        const resultsList = $("#quoteSearchResults");
        resultsList.empty();
        quotesToShow.slice(0, 100).forEach((quote) => {
            const quoteSearchResult = buildQuoteSearchResult(quote, matchedQueryTerms);
            resultsList.append(quoteSearchResult);
        });
        const resultsExceededText = quotesToShow.length > 100
            ? "<span style='opacity: 0.5'>(only showing 100)</span>"
            : "";
        $("#extraResults").html(`${quotesToShow.length} results ${resultsExceededText}`);
    });
}
function show(clearText = true) {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        if ($("#quoteSearchPopupWrapper").hasClass("hidden")) {
            if (clearText) {
                $("#quoteSearchPopup input").val("");
            }
            const quoteSearchInputValue = $("#quoteSearchPopup input").val();
            if (!firebase_1.Auth.currentUser) {
                $("#quoteSearchPopup #gotoSubmitQuoteButton").addClass("hidden");
            }
            else {
                $("#quoteSearchPopup #gotoSubmitQuoteButton").removeClass("hidden");
            }
            if ((_a = DB.getSnapshot()) === null || _a === void 0 ? void 0 : _a.quoteMod) {
                $("#quoteSearchPopup #goToApproveQuotes").removeClass("hidden");
            }
            else {
                $("#quoteSearchPopup #goToApproveQuotes").addClass("hidden");
            }
            $("#quoteSearchPopup .quoteLengthFilter").select2({
                placeholder: "Filter by length",
                maximumSelectionLength: Infinity,
                multiple: true,
                width: "100%",
                data: [
                    {
                        id: 0,
                        text: "short",
                        selected: false,
                    },
                    {
                        id: 1,
                        text: "medium",
                        selected: false,
                    },
                    {
                        id: 2,
                        text: "long",
                        selected: false,
                    },
                    {
                        id: 3,
                        text: "thicc",
                        selected: false,
                    },
                ],
            });
            $("#quoteSearchPopupWrapper")
                .stop(true, true)
                .css("opacity", 0)
                .removeClass("hidden")
                .animate({ opacity: 1 }, 100, () => {
                if (clearText) {
                    $("#quoteSearchPopup input").trigger("focus").select();
                }
                updateResults(quoteSearchInputValue);
            });
        }
    });
}
exports.show = show;
function hide(noAnim = false, focusWords = true) {
    if (!$("#quoteSearchPopupWrapper").hasClass("hidden")) {
        $("#quoteSearchPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, noAnim ? 0 : 100, () => {
            $("#quoteSearchPopupWrapper").addClass("hidden");
            if (focusWords) {
                TestUI.focusWords();
                $("#quoteSearchPopup .quoteLengthFilter").val([]);
                $("#quoteSearchPopup .quoteLengthFilter").trigger("change");
            }
        });
    }
}
exports.hide = hide;
function apply(val) {
    if (isNaN(val)) {
        val = parseInt(document.getElementById("searchBox").value);
    }
    let ret;
    if (val !== null && !isNaN(val) && val >= 0) {
        UpdateConfig.setQuoteLength(-2, false);
        exports.selectedId = val;
        ManualRestart.set();
        ret = true;
    }
    else {
        Notifications.add("Quote ID must be at least 1", 0);
        ret = false;
    }
    hide();
    return ret;
}
exports.apply = apply;
const searchForQuotes = (0, debounce_1.debounce)(() => {
    const searchText = document.getElementById("searchBox")
        .value;
    updateResults(searchText);
});
$("#quoteSearchPopup .searchBox").on("keyup", (e) => {
    if (e.code === "Escape")
        return;
    searchForQuotes();
});
$("#quoteSearchPopup .quoteLengthFilter").on("change", searchForQuotes);
$("#quoteSearchPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "quoteSearchPopupWrapper") {
        hide();
    }
});
$(document).on("click", "#quoteSearchPopup #gotoSubmitQuoteButton", () => {
    hide(true);
    QuoteSubmitPopup.show(true);
});
$(document).on("click", "#quoteSearchPopup #goToApproveQuotes", () => {
    hide(true);
    QuoteApprovePopup.show(true);
});
$(document).on("click", "#quoteSearchPopup .report", (e) => __awaiter(void 0, void 0, void 0, function* () {
    const quoteId = e.target.closest(".searchResult").id;
    const quoteIdSelectedForReport = parseInt(quoteId);
    hide(true, false);
    QuoteReportPopup.show({
        quoteId: quoteIdSelectedForReport,
        noAnim: true,
        previousPopupShowCallback: () => {
            show(false);
        },
    });
}));
$(document).on("click", "#top .config .quoteLength .text-button", (e) => {
    var _a;
    const len = (_a = $(e.currentTarget).attr("quoteLength")) !== null && _a !== void 0 ? _a : 0;
    if (len == -2) {
        show();
    }
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" &&
        !$("#quoteSearchPopupWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/popups/quote-submit-popup.ts":
/*!**************************************************!*\
  !*** ./src/scripts/popups/quote-submit-popup.ts ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
// import Config from "../config";
// import * as Misc from "../misc";
// let dropdownReady = false;
// async function initDropdown(): Promise<void> {
//   if (dropdownReady) return;
//   const languages = await Misc.getLanguageList();
//   languages.forEach((language) => {
//     if (
//       language === "english_commonly_misspelled" ||
//       language === "hungarian_2.5k"
//     )
//       return;
//     if (!/_\d*k$/g.test(language)) {
//       $("#quoteSubmitPopup #submitQuoteLanguage").append(
//         `<option value="${language}">${language.replace(/_/g, " ")}</option>`
//       );
//     }
//   });
//   $("#quoteSubmitPopup #submitQuoteLanguage").select2();
//   dropdownReady = true;
// }
function submitQuote() {
    return __awaiter(this, void 0, void 0, function* () {
        const text = $("#quoteSubmitPopup #submitQuoteText").val();
        const source = $("#quoteSubmitPopup #submitQuoteSource").val();
        const language = $("#quoteSubmitPopup #submitQuoteLanguage").val();
        const captcha = $("#quoteSubmitPopup #g-recaptcha-response").val();
        if (!text || !source || !language) {
            return Notifications.add("Please fill in all fields", 0);
        }
        Loader.show();
        const response = yield ape_1.default.quotes.submit(text, source, language, captcha);
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to submit quote: " + response.message, -1);
        }
        Notifications.add("Quote submitted.", 1);
        $("#quoteSubmitPopup #submitQuoteText").val("");
        $("#quoteSubmitPopup #submitQuoteSource").val("");
        $("#quoteSubmitPopup .characterCount").removeClass("red");
        $("#quoteSubmitPopup .characterCount").text("-");
        grecaptcha.reset();
    });
}
// @ts-ignore
// eslint-disable-next-line
function show(noAnim = false) {
    return __awaiter(this, void 0, void 0, function* () {
        Notifications.add("Quote submission is disabled temporarily due to a large submission queue.", 0, 5);
        return;
        // if ($("#quoteSubmitPopupWrapper").hasClass("hidden")) {
        //   await initDropdown();
        //   $("#quoteSubmitPopup #submitQuoteLanguage").val(
        //     Config.language.replace(/_\d*k$/g, "")
        //   );
        //   $("#quoteSubmitPopup #submitQuoteLanguage").trigger("change");
        //   $("#quoteSubmitPopup input").val("");
        //   $("#quoteSubmitPopupWrapper")
        //     .stop(true, true)
        //     .css("opacity", 0)
        //     .removeClass("hidden")
        //     .animate({ opacity: 1 }, noAnim ? 0 : 100, () => {
        //       $("#quoteSubmitPopup textarea").trigger("focus").select();
        //     });
        // }
    });
}
exports.show = show;
function hide() {
    if (!$("#quoteSubmitPopupWrapper").hasClass("hidden")) {
        $("#quoteSubmitPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#quoteSubmitPopupWrapper").addClass("hidden");
        });
    }
}
exports.hide = hide;
$("#quoteSubmitPopupWrapper").on("mousedown", (e) => {
    if ($(e.target).attr("id") === "quoteSubmitPopupWrapper") {
        hide();
    }
});
$(document).on("click", "#quoteSubmitPopup #submitQuoteButton", () => {
    submitQuote();
});
$("#quoteSubmitPopup textarea").on("input", () => {
    setTimeout(() => {
        var _a;
        const len = (_a = $("#quoteSubmitPopup textarea").val()) === null || _a === void 0 ? void 0 : _a.length;
        $("#quoteSubmitPopup .characterCount").text(len);
        if (len < 60) {
            $("#quoteSubmitPopup .characterCount").addClass("red");
        }
        else {
            $("#quoteSubmitPopup .characterCount").removeClass("red");
        }
    }, 1);
});
$("#quoteSubmitPopup input").on("keydown", (e) => {
    if (e.key === "Enter") {
        submitQuote();
    }
});


/***/ }),

/***/ "./src/scripts/popups/result-tags-popup.ts":
/*!*************************************************!*\
  !*** ./src/scripts/popups/result-tags-popup.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateButtons = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function show() {
    if ($("#resultEditTagsPanelWrapper").hasClass("hidden")) {
        $("#resultEditTagsPanelWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 125);
    }
}
function hide() {
    if (!$("#resultEditTagsPanelWrapper").hasClass("hidden")) {
        $("#resultEditTagsPanelWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#resultEditTagsPanelWrapper").addClass("hidden");
        });
    }
}
function updateButtons() {
    var _a;
    $("#resultEditTagsPanel .buttons").empty();
    (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
        $("#resultEditTagsPanel .buttons").append(`<div class="button tag" tagid="${tag._id}">${tag.name}</div>`);
    });
}
exports.updateButtons = updateButtons;
function updateActiveButtons(active) {
    if (active === [])
        return;
    $.each($("#resultEditTagsPanel .buttons .button"), (_, obj) => {
        var _a;
        const tagid = (_a = $(obj).attr("tagid")) !== null && _a !== void 0 ? _a : "";
        if (active.includes(tagid)) {
            $(obj).addClass("active");
        }
        else {
            $(obj).removeClass("active");
        }
    });
}
$(document).on("click", ".pageAccount .group.history #resultEditTags", (f) => {
    var _a;
    if (((_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.length) || 0 > 0) {
        const resultid = $(f.target).parents("span").attr("resultid");
        const tags = $(f.target).parents("span").attr("tags");
        $("#resultEditTagsPanel").attr("resultid", resultid);
        $("#resultEditTagsPanel").attr("tags", tags);
        updateActiveButtons(JSON.parse(tags));
        show();
    }
});
$(document).on("click", "#resultEditTagsPanelWrapper .button.tag", (f) => {
    $(f.target).toggleClass("active");
});
$("#resultEditTagsPanelWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "resultEditTagsPanelWrapper") {
        hide();
    }
});
$("#resultEditTagsPanel .confirmButton").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    const resultId = $("#resultEditTagsPanel").attr("resultid");
    // let oldtags = JSON.parse($("#resultEditTagsPanel").attr("tags"));
    const newTags = [];
    $.each($("#resultEditTagsPanel .buttons .button"), (_, obj) => {
        var _a;
        const tagid = (_a = $(obj).attr("tagid")) !== null && _a !== void 0 ? _a : "";
        if ($(obj).hasClass("active")) {
            newTags.push(tagid);
        }
    });
    Loader.show();
    hide();
    const response = yield ape_1.default.results.updateTags(resultId, newTags);
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to update result tags: " + response.message, -1);
    }
    Notifications.add("Tags updated.", 1, 2);
    (_a = DB.getSnapshot().results) === null || _a === void 0 ? void 0 : _a.forEach((result) => {
        if (result._id === resultId) {
            result.tags = newTags;
        }
    });
    let tagNames = "";
    if (newTags.length > 0) {
        newTags.forEach((tag) => {
            var _a;
            (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((snaptag) => {
                if (tag === snaptag._id) {
                    tagNames += snaptag.name + ", ";
                }
            });
        });
        tagNames = tagNames.substring(0, tagNames.length - 2);
    }
    let restags;
    if (newTags === undefined) {
        restags = "[]";
    }
    else {
        restags = JSON.stringify(newTags);
    }
    $(`.pageAccount #resultEditTags[resultid='${resultId}']`).attr("tags", restags);
    if (newTags.length > 0) {
        $(`.pageAccount #resultEditTags[resultid='${resultId}']`).css("opacity", 1);
        $(`.pageAccount #resultEditTags[resultid='${resultId}']`).attr("aria-label", tagNames);
    }
    else {
        $(`.pageAccount #resultEditTags[resultid='${resultId}']`).css("opacity", 0.25);
        $(`.pageAccount #resultEditTags[resultid='${resultId}']`).attr("aria-label", "no tags");
    }
}));


/***/ }),

/***/ "./src/scripts/popups/saved-texts-popup.ts":
/*!*************************************************!*\
  !*** ./src/scripts/popups/saved-texts-popup.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
function show() {
    return __awaiter(this, void 0, void 0, function* () {
        const names = CustomText.getCustomTextNames();
        const listEl = $(`#savedTextsPopup .list`).empty();
        let list = "";
        if (names.length === 0) {
            list += "<div>No saved custom texts found</div>";
        }
        else {
            for (const name of names) {
                list += `<div class="savedText">
      <div class="button name">${name}</div>
      <div class="button delete">
      <i class="fas fa-fw fa-trash"></i>
      </div>
      </div>`;
            }
        }
        listEl.html(list);
        $("#savedTextsPopupWrapper").removeClass("hidden");
        $("#customTextPopupWrapper").addClass("hidden");
    });
}
exports.show = show;
function hide(full = false) {
    $("#savedTextsPopupWrapper").addClass("hidden");
    if (!full)
        $("#customTextPopupWrapper").removeClass("hidden");
}
function applySaved(name) {
    const text = CustomText.getCustomText(name);
    $(`#customTextPopupWrapper textarea`).val(text.join(CustomText.delimiter));
}
$(document).on("click", `#savedTextsPopupWrapper .list .savedText .button.name`, (e) => {
    const name = $(e.target).text();
    applySaved(name);
    hide();
});
$(document).on("click", `#savedTextsPopupWrapper .list .savedText .button.delete`, () => {
    hide(true);
});
$("#savedTextsPopupWrapper").mousedown((e) => {
    if ($(e.target).attr("id") === "savedTextsPopupWrapper") {
        hide();
    }
});


/***/ }),

/***/ "./src/scripts/popups/simple-popups.ts":
/*!*********************************************!*\
  !*** ./src/scripts/popups/simple-popups.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.list = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const AccountController = __importStar(__webpack_require__(/*! ../controllers/account-controller */ "./src/scripts/controllers/account-controller.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const ApeKeysPopup = __importStar(__webpack_require__(/*! ../popups/ape-keys-popup */ "./src/scripts/popups/ape-keys-popup.ts"));
const ThemePicker = __importStar(__webpack_require__(/*! ../settings/theme-picker */ "./src/scripts/settings/theme-picker.ts"));
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
const CustomTextPopup = __importStar(__webpack_require__(/*! ../popups/custom-text-popup */ "./src/scripts/popups/custom-text-popup.ts"));
const SavedTextsPopup = __importStar(__webpack_require__(/*! ./saved-texts-popup */ "./src/scripts/popups/saved-texts-popup.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const auth_1 = __webpack_require__(/*! firebase/auth */ "./node_modules/firebase/auth/dist/index.esm.js");
let activePopup = null;
exports.list = {};
class SimplePopup {
    constructor(id, type, title, inputs = [], text = "", buttonText = "Confirm", execFn, beforeInitFn, beforeShowFn) {
        this.parameters = [];
        this.id = id;
        this.type = type;
        this.execFn = (thisPopup, ...vals) => execFn(thisPopup, ...vals);
        this.title = title;
        this.inputs = inputs;
        this.text = text;
        this.wrapper = $("#simplePopupWrapper");
        this.element = $("#simplePopup");
        this.buttonText = buttonText;
        this.beforeInitFn = (thisPopup) => beforeInitFn(thisPopup);
        this.beforeShowFn = (thisPopup) => beforeShowFn(thisPopup);
        this.canClose = true;
    }
    reset() {
        this.element.html(`
    <div class="title"></div>
    <div class="inputs"></div>
    <div class="text"></div>
    <div class="button"></div>`);
    }
    init() {
        const el = this.element;
        el.find("input").val("");
        // if (el.attr("popupId") !== this.id) {
        this.reset();
        el.attr("popupId", this.id);
        el.find(".title").text(this.title);
        el.find(".text").text(this.text);
        this.initInputs();
        if (this.buttonText === "") {
            el.find(".button").remove();
        }
        else {
            el.find(".button").text(this.buttonText);
        }
        if (this.text === "") {
            el.find(".text").addClass("hidden");
        }
        else {
            el.find(".text").removeClass("hidden");
        }
        // }
    }
    initInputs() {
        const el = this.element;
        if (this.inputs.length > 0) {
            if (this.type === "number") {
                this.inputs.forEach((input) => {
                    el.find(".inputs").append(`
            <input
              type="number"
              min="1"
              value="${input.initVal}"
              placeholder="${input.placeholder}"
              class="${input.hidden ? "hidden" : ""}"
              ${input.hidden ? "" : "required"}
              autocomplete="off"
            >
          `);
                });
            }
            else if (this.type === "text") {
                this.inputs.forEach((input) => {
                    if (input.type) {
                        if (input.type === "textarea") {
                            el.find(".inputs").append(`
                <textarea
                  placeholder="${input.placeholder}"
                  class="${input.hidden ? "hidden" : ""}"
                  ${input.hidden ? "" : "required"}
                  ${input.disabled ? "disabled" : ""}
                  autocomplete="off"
                >${input.initVal}</textarea>
              `);
                        }
                        else if (input.type === "checkbox") {
                            el.find(".inputs").append(`
                <label class="checkbox">
                  <input type="checkbox">
                  <div class="customTextCheckbox"></div>
                  ${input.label}
                </label>
              `);
                        }
                        else {
                            el.find(".inputs").append(`
              <input
              type="${input.type}"
              value="${input.initVal}"
              placeholder="${input.placeholder}"
              class="${input.hidden ? "hidden" : ""}"
              ${input.hidden ? "" : "required"}
              ${input.disabled ? "disabled" : ""}
              autocomplete="off"
              >
              `);
                        }
                    }
                    else {
                        el.find(".inputs").append(`
              <input
                type="text"
                value="${input.initVal}"
                placeholder="${input.placeholder}"
                class="${input.hidden ? "hidden" : ""}"
                ${input.hidden ? "" : "required"}
                ${input.disabled ? "disabled" : ""}
                autocomplete="off"
              >
            `);
                    }
                });
            }
            el.find(".inputs").removeClass("hidden");
        }
        else {
            el.find(".inputs").addClass("hidden");
        }
    }
    exec() {
        if (!this.canClose)
            return;
        const vals = [];
        $.each($("#simplePopup input"), (_, el) => {
            if ($(el).is(":checkbox")) {
                vals.push($(el).is(":checked") ? "true" : "false");
            }
            else {
                vals.push($(el).val());
            }
        });
        this.execFn(this, ...vals);
        this.hide();
    }
    show(parameters = []) {
        activePopup = this;
        this.parameters = parameters;
        this.beforeInitFn(this);
        this.init();
        this.beforeShowFn(this);
        this.wrapper
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 125, () => {
            $($("#simplePopup").find("input")[0]).trigger("focus");
        });
    }
    hide() {
        if (!this.canClose)
            return;
        activePopup = null;
        this.wrapper
            .stop(true, true)
            .css("opacity", 1)
            .removeClass("hidden")
            .animate({ opacity: 0 }, 125, () => {
            this.wrapper.addClass("hidden");
        });
    }
}
function hide() {
    if (activePopup)
        return activePopup.hide();
    $("#simplePopupWrapper")
        .stop(true, true)
        .css("opacity", 1)
        .removeClass("hidden")
        .animate({ opacity: 0 }, 125, () => {
        $("#simplePopupWrapper").addClass("hidden");
    });
}
exports.hide = hide;
$("#simplePopupWrapper").mousedown((e) => {
    if ($(e.target).attr("id") === "simplePopupWrapper") {
        if (activePopup)
            return activePopup.hide();
        $("#simplePopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .removeClass("hidden")
            .animate({ opacity: 0 }, 125, () => {
            $("#simplePopupWrapper").addClass("hidden");
        });
    }
});
$(document).on("click", "#simplePopupWrapper .button", () => {
    var _a;
    const id = (_a = $("#simplePopup").attr("popupId")) !== null && _a !== void 0 ? _a : "";
    exports.list[id].exec();
});
$(document).on("keyup", "#simplePopupWrapper input", (e) => {
    var _a;
    if (e.key === "Enter") {
        e.preventDefault();
        const id = (_a = $("#simplePopup").attr("popupId")) !== null && _a !== void 0 ? _a : "";
        exports.list[id].exec();
    }
});
exports.list.updateEmail = new SimplePopup("updateEmail", "text", "Update Email", [
    {
        placeholder: "Password",
        type: "password",
        initVal: "",
    },
    {
        placeholder: "New email",
        initVal: "",
    },
    {
        placeholder: "Confirm new email",
        initVal: "",
    },
], "", "Update", (_thisPopup, password, email, emailConfirm) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (email !== emailConfirm) {
            Notifications.add("Emails don't match", 0);
            return;
        }
        if (user.providerData[0].providerId === "password") {
            const credential = auth_1.EmailAuthProvider.credential(user.email, password);
            yield (0, auth_1.reauthenticateWithCredential)(user, credential);
        }
        Loader.show();
        const response = yield ape_1.default.users.updateEmail(email, user.email);
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to update email: " + response.message, -1);
        }
        Notifications.add("Email updated", 1);
        setTimeout(() => {
            window.location.reload();
        }, 1000);
    }
    catch (e) {
        const typedError = e;
        if (typedError.code === "auth/wrong-password") {
            Notifications.add("Incorrect password", -1);
        }
        else {
            Notifications.add("Something went wrong: " + e, -1);
        }
    }
}), (thisPopup) => {
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    if (!user.providerData.find((p) => (p === null || p === void 0 ? void 0 : p.providerId) === "password")) {
        thisPopup.inputs = [];
        thisPopup.buttonText = "";
        thisPopup.text = "Password authentication is not enabled";
    }
}, (_thisPopup) => {
    //
});
exports.list.updateName = new SimplePopup("updateName", "text", "Update Name", [
    {
        placeholder: "Password",
        type: "password",
        initVal: "",
    },
    {
        placeholder: "New name",
        type: "text",
        initVal: "",
    },
], "", "Update", (_thisPopup, pass, newName) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (user.providerData[0].providerId === "password") {
            const credential = auth_1.EmailAuthProvider.credential(user.email, pass);
            yield (0, auth_1.reauthenticateWithCredential)(user, credential);
        }
        else if (user.providerData[0].providerId === "google.com") {
            yield (0, auth_1.reauthenticateWithPopup)(user, AccountController.gmailProvider);
        }
        Loader.show();
        const checkNameResponse = yield ape_1.default.users.getNameAvailability(newName);
        if (checkNameResponse.status !== 200) {
            Loader.hide();
            return Notifications.add("Failed to check name: " + checkNameResponse.message, -1);
        }
        const updateNameResponse = yield ape_1.default.users.updateName(newName);
        if (updateNameResponse.status !== 200) {
            Loader.hide();
            return Notifications.add("Failed to update name: " + updateNameResponse.message, -1);
        }
        Notifications.add("Name updated", 1);
        DB.getSnapshot().name = newName;
        $("#menu .icon-button.account .text").text(newName);
    }
    catch (e) {
        const typedError = e;
        if (typedError.code === "auth/wrong-password") {
            Notifications.add("Incorrect password", -1);
        }
        else {
            Notifications.add("Something went wrong: " + e, -1);
        }
    }
    Loader.hide();
}), (thisPopup) => {
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    if (user.providerData[0].providerId === "google.com") {
        thisPopup.inputs[0].hidden = true;
        thisPopup.buttonText = "Reauthenticate to update";
    }
}, (_thisPopup) => {
    //
});
exports.list.updatePassword = new SimplePopup("updatePassword", "text", "Update Password", [
    {
        placeholder: "Password",
        type: "password",
        initVal: "",
    },
    {
        placeholder: "New password",
        type: "password",
        initVal: "",
    },
    {
        placeholder: "Confirm new password",
        type: "password",
        initVal: "",
    },
], "", "Update", (_thisPopup, previousPass, newPass, newPassConfirm) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        const credential = auth_1.EmailAuthProvider.credential(user.email, previousPass);
        if (newPass !== newPassConfirm) {
            Notifications.add("New passwords don't match", 0);
            return;
        }
        Loader.show();
        yield (0, auth_1.reauthenticateWithCredential)(user, credential);
        yield (0, auth_1.updatePassword)(user, newPass);
        Loader.hide();
        Notifications.add("Password updated", 1);
        setTimeout(() => {
            window.location.reload();
        }, 1000);
    }
    catch (e) {
        const typedError = e;
        Loader.hide();
        if (typedError.code === "auth/wrong-password") {
            Notifications.add("Incorrect password", -1);
        }
        else {
            Notifications.add("Something went wrong: " + e, -1);
        }
    }
}), (thisPopup) => {
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    if (!user.providerData.find((p) => (p === null || p === void 0 ? void 0 : p.providerId) === "password")) {
        thisPopup.inputs = [];
        thisPopup.buttonText = "";
        thisPopup.text = "Password authentication is not enabled";
    }
}, (_thisPopup) => {
    //
});
exports.list.addPasswordAuth = new SimplePopup("addPasswordAuth", "text", "Add Password Authentication", [
    {
        placeholder: "email",
        type: "email",
        initVal: "",
    },
    {
        placeholder: "confirm email",
        type: "email",
        initVal: "",
    },
    {
        placeholder: "new password",
        type: "password",
        initVal: "",
    },
    {
        placeholder: "confirm new password",
        type: "password",
        initVal: "",
    },
], "", "Add", (_thisPopup, email, emailConfirm, pass, passConfirm) => __awaiter(void 0, void 0, void 0, function* () {
    if (email !== emailConfirm) {
        Notifications.add("Emails don't match", 0);
        return;
    }
    if (pass !== passConfirm) {
        Notifications.add("Passwords don't match", 0);
        return;
    }
    yield AccountController.addPasswordAuth(email, pass);
}), () => {
    //
}, (_thisPopup) => {
    //
});
exports.list.deleteAccount = new SimplePopup("deleteAccount", "text", "Delete Account", [
    {
        placeholder: "Password",
        type: "password",
        initVal: "",
    },
], "This is the last time you can change your mind. After pressing the button everything is gone.", "Delete", (_thisPopup, password) => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    //
    try {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (user.providerData[0].providerId === "password") {
            const credential = auth_1.EmailAuthProvider.credential(user.email, password);
            yield (0, auth_1.reauthenticateWithCredential)(user, credential);
        }
        else if (user.providerData[0].providerId === "google.com") {
            yield (0, auth_1.reauthenticateWithPopup)(user, AccountController.gmailProvider);
        }
        Loader.show();
        Notifications.add("Deleting stats...", 0);
        const usersResponse = yield ape_1.default.users.delete();
        Loader.hide();
        if (usersResponse.status !== 200) {
            return Notifications.add("Failed to delete user stats: " + usersResponse.message, -1);
        }
        Loader.show();
        Notifications.add("Deleting results...", 0);
        const resultsResponse = yield ape_1.default.results.deleteAll();
        Loader.hide();
        if (resultsResponse.status !== 200) {
            return Notifications.add("Failed to delete user results: " + resultsResponse.message, -1);
        }
        Notifications.add("Deleting login information...", 0);
        yield ((_a = firebase_1.Auth.currentUser) === null || _a === void 0 ? void 0 : _a.delete());
        Notifications.add("Goodbye", 1, 5);
        setTimeout(() => {
            location.reload();
        }, 3000);
    }
    catch (e) {
        const typedError = e;
        Loader.hide();
        if (typedError.code === "auth/wrong-password") {
            Notifications.add("Incorrect password", -1);
        }
        else {
            Notifications.add("Something went wrong: " + e, -1);
        }
    }
}), (thisPopup) => {
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    if (user.providerData[0].providerId === "google.com") {
        thisPopup.inputs = [];
        thisPopup.buttonText = "Reauthenticate to delete";
    }
}, (_thisPopup) => {
    //
});
exports.list.clearTagPb = new SimplePopup("clearTagPb", "text", "Clear Tag PB", [], `Are you sure you want to clear this tags PB?`, "Clear", (thisPopup) => __awaiter(void 0, void 0, void 0, function* () {
    var _b;
    const tagId = thisPopup.parameters[0];
    Loader.show();
    const response = yield ape_1.default.users.deleteTagPersonalBest(tagId);
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to delete tag's PB: " + response.message);
    }
    if (response.data.resultCode === 1) {
        const tag = (_b = DB.getSnapshot().tags) === null || _b === void 0 ? void 0 : _b.filter((t) => t._id === tagId)[0];
        if (tag === undefined)
            return;
        tag.personalBests = {
            time: {},
            words: {},
            zen: { zen: [] },
            quote: { custom: [] },
            custom: { custom: [] },
        };
        $(`.pageSettings .section.tags .tagsList .tag[id="${tagId}"] .clearPbButton`).attr("aria-label", "No PB found");
        Notifications.add("Tag PB cleared.", 0);
    }
    else {
        Notifications.add("Something went wrong: " + response.message, -1);
    }
}), (thisPopup) => {
    thisPopup.text = `Are you sure you want to clear PB for tag ${thisPopup.parameters[1]}?`;
}, (_thisPopup) => {
    //
});
exports.list.applyCustomFont = new SimplePopup("applyCustomFont", "text", "Custom font", [{ placeholder: "Font name", initVal: "" }], "Make sure you have the font installed on your computer before applying.", "Apply", (_thisPopup, fontName) => {
    var _a;
    if (fontName === "")
        return;
    (_a = Settings.groups["fontFamily"]) === null || _a === void 0 ? void 0 : _a.setValue(fontName.replace(/\s/g, "_"));
}, () => {
    //
}, (_thisPopup) => {
    //
});
exports.list.resetPersonalBests = new SimplePopup("resetPersonalBests", "text", "Reset Personal Bests", [
    {
        placeholder: "Password",
        type: "password",
        initVal: "",
    },
], "", "Reset", (_thisPopup, password) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (user.providerData[0].providerId === "password") {
            const credential = auth_1.EmailAuthProvider.credential(user.email, password);
            yield (0, auth_1.reauthenticateWithCredential)(user, credential);
        }
        else if (user.providerData[0].providerId === "google.com") {
            yield (0, auth_1.reauthenticateWithPopup)(user, AccountController.gmailProvider);
        }
        Loader.show();
        const response = yield ape_1.default.users.deletePersonalBests();
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to reset personal bests: " + response.message, -1);
        }
        Notifications.add("Personal bests have been reset", 1);
        DB.getSnapshot().personalBests = {
            time: {},
            words: {},
            zen: { zen: [] },
            quote: { custom: [] },
            custom: { custom: [] },
        };
    }
    catch (e) {
        Loader.hide();
        Notifications.add(e, -1);
    }
}), (thisPopup) => {
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    if (user.providerData[0].providerId === "google.com") {
        thisPopup.inputs = [];
        thisPopup.buttonText = "Reauthenticate to reset";
    }
}, (_thisPopup) => {
    //
});
exports.list.resetSettings = new SimplePopup("resetSettings", "text", "Reset Settings", [], "Are you sure you want to reset all your settings?", "Reset", () => {
    UpdateConfig.reset();
    // setTimeout(() => {
    //   location.reload();
    // }, 1000);
}, () => {
    //
}, (_thisPopup) => {
    //
});
exports.list.unlinkDiscord = new SimplePopup("unlinkDiscord", "text", "Unlink Discord", [], "Are you sure you want to unlink your Discord account?", "Unlink", () => __awaiter(void 0, void 0, void 0, function* () {
    Loader.show();
    const response = yield ape_1.default.users.unlinkDiscord();
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to unlink Discord: " + response.message, -1);
    }
    Notifications.add("Accounts unlinked", 1);
    DB.getSnapshot().discordId = undefined;
    Settings.updateDiscordSection();
}), () => {
    //
}, (_thisPopup) => {
    //
});
exports.list.generateApeKey = new SimplePopup("generateApeKey", "text", "Generate new key", [
    {
        placeholder: "Name",
        initVal: "",
    },
], "", "Generate", (_thisPopup, name) => __awaiter(void 0, void 0, void 0, function* () {
    Loader.show();
    const response = yield ape_1.default.apeKeys.generate(name, false);
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to generate key: " + response.message, -1);
    }
    else {
        const data = response.data;
        exports.list["viewApeKey"].show([data.apeKey]);
    }
}), () => {
    //
}, (_thisPopup) => {
    //
});
exports.list.viewApeKey = new SimplePopup("viewApeKey", "text", "Ape Key", [
    {
        type: "textarea",
        disabled: true,
        placeholder: "Key",
        initVal: "",
    },
], "This is your new Ape Key. Please keep it safe. You will only see it once!", "Close", (_thisPopup) => {
    ApeKeysPopup.show();
}, (_thisPopup) => {
    _thisPopup.inputs[0].initVal = _thisPopup.parameters[0];
}, (_thisPopup) => {
    _thisPopup.canClose = false;
    $("#simplePopup textarea").css("height", "110px");
    $("#simplePopup .button").addClass("hidden");
    setTimeout(() => {
        _thisPopup.canClose = true;
        $("#simplePopup .button").removeClass("hidden");
    }, 3000);
});
exports.list.deleteApeKey = new SimplePopup("deleteApeKey", "text", "Delete Ape Key", [], "Are you sure?", "Delete", (_thisPopup) => __awaiter(void 0, void 0, void 0, function* () {
    Loader.show();
    const response = yield ape_1.default.apeKeys.delete(_thisPopup.parameters[0]);
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to delete key: " + response.message, -1);
    }
    Notifications.add("Key deleted", 1);
    ApeKeysPopup.show();
}), (_thisPopup) => {
    //
}, (_thisPopup) => {
    //
});
exports.list.editApeKey = new SimplePopup("editApeKey", "text", "Edit Ape Key", [
    {
        placeholder: "Name",
        initVal: "",
    },
], "", "Edit", (_thisPopup, input) => __awaiter(void 0, void 0, void 0, function* () {
    Loader.show();
    const response = yield ape_1.default.apeKeys.update(_thisPopup.parameters[0], {
        name: input,
    });
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to update key: " + response.message, -1);
    }
    Notifications.add("Key updated", 1);
    ApeKeysPopup.show();
}), (_thisPopup) => {
    //
}, (_thisPopup) => {
    //
});
exports.list.saveCustomText = new SimplePopup("saveCustomText", "text", "Save custom text", [
    {
        placeholder: "Name",
        initVal: "",
    },
], "", "Save", (_thisPopup, input) => {
    const text = $(`#customTextPopup textarea`).val().normalize();
    CustomText.setCustomText(input, text);
    Notifications.add("Custom text saved", 1);
    CustomTextPopup.show();
}, () => {
    //
}, () => {
    //
});
exports.list.deleteCustomText = new SimplePopup("deleteCustomText", "text", "Delete custom text", [], "Are you sure?", "Delete", (_thisPopup) => {
    CustomText.deleteCustomText(_thisPopup.parameters[0]);
    Notifications.add("Custom text deleted", 1);
    SavedTextsPopup.show();
}, (_thisPopup) => {
    _thisPopup.text = `Are you sure you want to delete custom text ${_thisPopup.parameters[0]}?`;
}, () => {
    //
});
exports.list.updateCustomTheme = new SimplePopup("updateCustomTheme", "text", "Update Custom Theme", [
    {
        type: "text",
        placeholder: "Name",
        initVal: "",
    },
    {
        type: "checkbox",
        initVal: "false",
        label: "Update custom theme to current colors",
    },
], "", "Update", (_thisPopup, name, updateColors) => __awaiter(void 0, void 0, void 0, function* () {
    const snapshot = DB.getSnapshot();
    const customTheme = snapshot.customThemes.find((t) => t._id === _thisPopup.parameters[0]);
    if (customTheme === undefined) {
        Notifications.add("Custom theme does not exist!", -1);
        return;
    }
    let newColors = [];
    if (updateColors === "true") {
        $.each($(".pageSettings .customTheme .customThemeEdit [type='color']"), (_index, element) => {
            newColors.push($(element).attr("value"));
        });
    }
    else {
        newColors = customTheme.colors;
    }
    const newTheme = {
        name: name,
        colors: newColors,
    };
    Loader.show();
    yield DB.editCustomTheme(customTheme._id, newTheme);
    Loader.hide();
    UpdateConfig.setCustomThemeColors(newColors);
    Notifications.add("Custom theme updated", 1);
    ThemePicker.refreshButtons();
}), (_thisPopup) => {
    const snapshot = DB.getSnapshot();
    const customTheme = snapshot.customThemes.find((t) => t._id === _thisPopup.parameters[0]);
    if (!customTheme)
        return;
    _thisPopup.inputs[0].initVal = customTheme.name;
}, (_thisPopup) => {
    //
});
exports.list.deleteCustomTheme = new SimplePopup("deleteCustomTheme", "text", "Delete Custom Theme", [], "Are you sure?", "Delete", (_thisPopup) => __awaiter(void 0, void 0, void 0, function* () {
    Loader.show();
    yield DB.deleteCustomTheme(_thisPopup.parameters[0]);
    Loader.hide();
    Notifications.add("Custom theme deleted", 1);
    ThemePicker.refreshButtons();
}), (_thisPopup) => {
    //
}, (_thisPopup) => {
    //
});
$(".pageSettings .section.discordIntegration #unlinkDiscordButton").on("click", () => {
    exports.list["unlinkDiscord"].show();
});
$("#resetSettingsButton").on("click", () => {
    exports.list["resetSettings"].show();
});
$(".pageSettings #resetPersonalBestsButton").on("click", () => {
    exports.list["resetPersonalBests"].show();
});
$(".pageSettings #updateAccountName").on("click", () => {
    exports.list["updateName"].show();
});
$(".pageSettings #addPasswordAuth").on("click", () => {
    exports.list["addPasswordAuth"].show();
});
$(".pageSettings #emailPasswordAuth").on("click", () => {
    exports.list["updateEmail"].show();
});
$(".pageSettings #passPasswordAuth").on("click", () => {
    exports.list["updatePassword"].show();
});
$(".pageSettings #deleteAccount").on("click", () => {
    exports.list["deleteAccount"].show();
});
$("#apeKeysPopup .generateApeKey").on("click", () => {
    exports.list["generateApeKey"].show();
});
$(`#customTextPopup .buttonsTop .saveCustomText`).on("click", () => {
    exports.list["saveCustomText"].show();
});
$(document).on("click", ".pageSettings .section.themes .customTheme .delButton", (e) => {
    const $parentElement = $(e.currentTarget).parent(".customTheme.button");
    const customThemeId = $parentElement.attr("customThemeId");
    exports.list["deleteCustomTheme"].show([customThemeId]);
});
$(document).on("click", ".pageSettings .section.themes .customTheme .editButton", (e) => {
    const $parentElement = $(e.currentTarget).parent(".customTheme.button");
    const customThemeId = $parentElement.attr("customThemeId");
    exports.list["updateCustomTheme"].show([customThemeId]);
});
$(document).on("click", `#savedTextsPopupWrapper .list .savedText .button.delete`, (e) => {
    const name = $(e.target).siblings(".button.name").text();
    exports.list["deleteCustomText"].show([name]);
});
$(document).on("click", "#apeKeysPopup table tbody tr .button.delete", (e) => {
    const keyId = $(e.target).closest("tr").attr("keyId");
    exports.list["deleteApeKey"].show([keyId]);
});
$(document).on("click", "#apeKeysPopup table tbody tr .button.edit", (e) => {
    const keyId = $(e.target).closest("tr").attr("keyId");
    exports.list["editApeKey"].show([keyId]);
});
$(document).on("click", ".pageSettings .section.fontFamily .button.custom", () => {
    exports.list["applyCustomFont"].show([]);
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" && !$("#simplePopupWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/popups/support-popup.ts":
/*!*********************************************!*\
  !*** ./src/scripts/popups/support-popup.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const Commandline = __importStar(__webpack_require__(/*! ../elements/commandline */ "./src/scripts/elements/commandline.ts"));
const CommandlineLists = __importStar(__webpack_require__(/*! ../elements/commandline-lists */ "./src/scripts/elements/commandline-lists.ts"));
$(document.body).on("click", "#supportMeButton", () => {
    $("#supportMeWrapper")
        .css("opacity", 0)
        .removeClass("hidden")
        .animate({ opacity: 1 }, 125);
});
$(document.body).on("click", "#supportMeWrapper", () => {
    $("#supportMeWrapper")
        .css("opacity", 1)
        .animate({ opacity: 0 }, 125, () => {
        $("#supportMeWrapper").addClass("hidden");
    });
});
$(document.body).on("click", "#supportMeWrapper .button.ads", () => {
    CommandlineLists.pushCurrent(CommandlineLists.commandsEnableAds);
    Commandline.show();
    $("#supportMeWrapper")
        .css("opacity", 1)
        .animate({ opacity: 0 }, 125, () => {
        $("#supportMeWrapper").addClass("hidden");
    });
});
$(document.body).on("click", "#supportMeWrapper a.button", () => {
    $("#supportMeWrapper")
        .css("opacity", 1)
        .animate({ opacity: 0 }, 125, () => {
        $("#supportMeWrapper").addClass("hidden");
    });
});


/***/ }),

/***/ "./src/scripts/popups/version-popup.ts":
/*!*********************************************!*\
  !*** ./src/scripts/popups/version-popup.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
function show() {
    $("#versionHistoryWrapper")
        .css("opacity", 0)
        .removeClass("hidden")
        .animate({ opacity: 1 }, 125);
}
exports.show = show;
$(document.body).on("click", ".version", (e) => {
    if (e.shiftKey)
        return;
    show();
});
$(document.body).on("click", "#versionHistoryWrapper", (e) => {
    if ($(e.target).attr("id") === "versionHistoryWrapper") {
        $("#versionHistoryWrapper")
            .css("opacity", 1)
            .animate({ opacity: 0 }, 125, () => {
            $("#versionHistoryWrapper").addClass("hidden");
        });
    }
});


/***/ }),

/***/ "./src/scripts/popups/word-filter-popup.ts":
/*!*************************************************!*\
  !*** ./src/scripts/popups/word-filter-popup.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
let initialised = false;
function init() {
    return __awaiter(this, void 0, void 0, function* () {
        if (!initialised) {
            $("#wordFilterPopup .languageInput").empty();
            const LanguageList = yield Misc.getLanguageList();
            LanguageList.forEach((language) => {
                let prettyLang = language;
                prettyLang = prettyLang.replace("_", " ");
                $("#wordFilterPopup .languageInput").append(`
        <option value=${language}>${prettyLang}</option>
      `);
            });
            initialised = true;
        }
    });
}
function show() {
    return __awaiter(this, void 0, void 0, function* () {
        yield init();
        $("#wordFilterPopupWrapper").removeClass("hidden");
        $("#customTextPopupWrapper").addClass("hidden");
        $("#wordFilterPopup .languageInput").select2({
            width: "100%",
        });
    });
}
exports.show = show;
function hide() {
    $("#wordFilterPopupWrapper").addClass("hidden");
    $("#customTextPopupWrapper").removeClass("hidden");
}
function filter(language) {
    return __awaiter(this, void 0, void 0, function* () {
        let filterin = $("#wordFilterPopup .wordIncludeInput").val();
        filterin = Misc.escapeRegExp(filterin === null || filterin === void 0 ? void 0 : filterin.trim());
        filterin = filterin.replace(/\s+/gi, "|");
        const regincl = new RegExp(filterin, "i");
        let filterout = $("#wordFilterPopup .wordExcludeInput").val();
        filterout = Misc.escapeRegExp(filterout.trim());
        filterout = filterout.replace(/\s+/gi, "|");
        const regexcl = new RegExp(filterout, "i");
        const filteredWords = [];
        const languageWordList = yield Misc.getLanguage(language);
        const maxLengthInput = $("#wordFilterPopup .wordMaxInput").val();
        const minLengthInput = $("#wordFilterPopup .wordMinInput").val();
        let maxLength;
        let minLength;
        if (maxLengthInput == "") {
            maxLength = 999;
        }
        else {
            maxLength = parseInt(maxLengthInput);
        }
        if (minLengthInput == "") {
            minLength = 1;
        }
        else {
            minLength = parseInt(minLengthInput);
        }
        for (let i = 0; i < languageWordList.words.length; i++) {
            const word = languageWordList.words[i];
            const test1 = regincl.test(word);
            const test2 = regexcl.test(word);
            if (((test1 && !test2) || (test1 && filterout == "")) &&
                word.length <= maxLength &&
                word.length >= minLength) {
                filteredWords.push(word);
            }
        }
        return filteredWords;
    });
}
function apply(set) {
    return __awaiter(this, void 0, void 0, function* () {
        const language = $("#wordFilterPopup .languageInput").val();
        const filteredWords = yield filter(language);
        const customText = filteredWords.join(CustomText.delimiter);
        $("#customTextPopup textarea").val((_, val) => (set ? "" : val + " ") + customText);
        hide();
    });
}
$("#wordFilterPopupWrapper").mousedown((e) => {
    if ($(e.target).attr("id") === "wordFilterPopupWrapper") {
        hide();
    }
});
$("#wordFilterPopup .languageInput").one("select2:open", function () {
    $("input.select2-search__field").prop("placeholder", "search");
});
$("#wordFilterPopupWrapper .button").mousedown((e) => {
    $("#wordFilterPopupWrapper .loadingIndicator").removeClass("hidden");
    $("#wordFilterPopupWrapper .button").addClass("hidden");
    setTimeout(() => {
        apply($(e.target).is("#set")).then(() => {
            $("#wordFilterPopupWrapper .loadingIndicator").addClass("hidden");
            $("#wordFilterPopupWrapper .button").removeClass("hidden");
        });
    }, 1);
});


/***/ }),

/***/ "./src/scripts/ready.ts":
/*!******************************!*\
  !*** ./src/scripts/ready.ts ***!
  \******************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const ManualRestart = __importStar(__webpack_require__(/*! ./test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const config_1 = __importStar(__webpack_require__(/*! ./config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Misc = __importStar(__webpack_require__(/*! ./utils/misc */ "./src/scripts/utils/misc.ts"));
const VerificationController = __importStar(__webpack_require__(/*! ./controllers/verification-controller */ "./src/scripts/controllers/verification-controller.ts"));
const RouteController = __importStar(__webpack_require__(/*! ./controllers/route-controller */ "./src/scripts/controllers/route-controller.ts"));
const PageController = __importStar(__webpack_require__(/*! ./controllers/page-controller */ "./src/scripts/controllers/page-controller.ts"));
const MonkeyPower = __importStar(__webpack_require__(/*! ./elements/monkey-power */ "./src/scripts/elements/monkey-power.ts"));
const NewVersionNotification = __importStar(__webpack_require__(/*! ./elements/version-check */ "./src/scripts/elements/version-check.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Focus = __importStar(__webpack_require__(/*! ./test/focus */ "./src/scripts/test/focus.ts"));
ManualRestart.set();
UpdateConfig.loadFromLocalStorage();
if (window.location.hostname === "localhost") {
    $("#bottom .version .text").text("localhost");
    $("#bottom .version").css("opacity", 1);
}
else {
    Misc.getReleasesFromGitHub().then((v) => {
        NewVersionNotification.show(v[0].name);
    });
}
Focus.set(true, true);
RouteController.handleInitialPageClasses(window.location.pathname);
$(document).ready(() => {
    if (window.location.pathname === "/") {
        // $("#top .config").removeClass("hidden");
    }
    $("body").css("transition", "all .25s, transform .05s");
    if (config_1.default.quickTab) {
        $("#restartTestButton").addClass("hidden");
    }
    if (!window.localStorage.getItem("merchbannerclosed")) {
        Notifications.addBanner(`Checkout our merchandise, available at <a target="_blank" href="https://monkeytype.store/">monkeytype.store</a>`, 1, "images/merchdropwebsite2.png", false, () => {
            window.localStorage.setItem("merchbannerclosed", "true");
        });
    }
    $("#centerContent")
        .css("opacity", "0")
        .removeClass("hidden")
        .stop(true, true)
        .animate({ opacity: 1 }, 250, () => {
        if (window.location.pathname === "/verify") {
            const fragment = new URLSearchParams(window.location.hash.slice(1));
            if (fragment.has("access_token")) {
                const accessToken = fragment.get("access_token");
                const tokenType = fragment.get("token_type");
                VerificationController.set({
                    accessToken: accessToken,
                    tokenType: tokenType,
                });
                history.replaceState("/", "", "/");
            }
            const page = window.location.pathname.replace("/", "");
            PageController.change(page);
        }
        else if (window.location.pathname === "/account") {
            // history.replaceState("/", null, "/");
        }
        else if (/challenge_.+/g.test(window.location.pathname)) {
            //do nothing
            // }
        }
        else if (window.location.pathname !== "/") {
            // let page = window.location.pathname.replace("/", "");
            // PageController.change(page);
        }
    });
    // Settings.settingsFillPromise.then(Settings.update);
    MonkeyPower.init();
});


/***/ }),

/***/ "./src/scripts/settings/settings-group.ts":
/*!************************************************!*\
  !*** ./src/scripts/settings/settings-group.ts ***!
  \************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
class SettingsGroup {
    constructor(configName, configFunction, mode, setCallback, updateCallback) {
        this.configName = configName;
        this.configValue = config_1.default[configName];
        this.mode = mode;
        this.configFunction = configFunction;
        this.setCallback = setCallback;
        this.updateCallback = updateCallback;
        this.updateInput();
        if (this.mode === "select") {
            $(document).on("change", `.pageSettings .section.${this.configName} select`, (e) => {
                const target = $(e.currentTarget);
                if (target.hasClass("disabled") ||
                    target.hasClass("no-auto-handle")) {
                    return;
                }
                this.setValue(target.val());
            });
        }
        else if (this.mode === "button") {
            $(document).on("click", `.pageSettings .section.${this.configName} .button`, (e) => {
                const target = $(e.currentTarget);
                if (target.hasClass("disabled") ||
                    target.hasClass("no-auto-handle")) {
                    return;
                }
                let value = target.attr(configName);
                const params = target.attr("params");
                if (!value && !params)
                    return;
                if (value === "true")
                    value = true;
                if (value === "false")
                    value = false;
                this.setValue(value, params);
            });
        }
    }
    setValue(value, params) {
        if (params === undefined) {
            this.configFunction(value);
        }
        else {
            this.configFunction(value, ...params);
        }
        this.updateInput();
        if (this.setCallback)
            this.setCallback();
    }
    updateInput() {
        this.configValue = config_1.default[this.configName];
        $(`.pageSettings .section.${this.configName} .button`).removeClass("active");
        if (this.mode === "select") {
            $(`.pageSettings .section.${this.configName} select`)
                .val(this.configValue)
                .trigger("change.select2");
        }
        else if (this.mode === "button") {
            $(`.pageSettings .section.${this.configName} .button[${this.configName}='${this.configValue}']`).addClass("active");
        }
        if (this.updateCallback)
            this.updateCallback();
    }
}
exports["default"] = SettingsGroup;


/***/ }),

/***/ "./src/scripts/settings/theme-picker.ts":
/*!**********************************************!*\
  !*** ./src/scripts/settings/theme-picker.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateActiveTab = exports.saveCustomThemeColors = exports.setCustomInputs = exports.refreshButtons = exports.updateActiveButton = void 0;
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const ThemeController = __importStar(__webpack_require__(/*! ../controllers/theme-controller */ "./src/scripts/controllers/theme-controller.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const ChartController = __importStar(__webpack_require__(/*! ../controllers/chart-controller */ "./src/scripts/controllers/chart-controller.ts"));
const CustomThemePopup = __importStar(__webpack_require__(/*! ../popups/custom-theme-popup */ "./src/scripts/popups/custom-theme-popup.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
function updateActiveButton() {
    let activeThemeName = config_1.default.theme;
    if (config_1.default.randomTheme !== "off" &&
        config_1.default.randomTheme !== "custom" &&
        ThemeController.randomTheme !== null) {
        activeThemeName = ThemeController.randomTheme;
    }
    $(`.pageSettings .section.themes .theme`).removeClass("active");
    $(`.pageSettings .section.themes .theme[theme=${activeThemeName}]`).addClass("active");
}
exports.updateActiveButton = updateActiveButton;
function updateColors(colorPicker, color, onlyStyle = false, noThemeUpdate = false) {
    if (onlyStyle) {
        const colorID = colorPicker.find("input[type=color]").attr("id");
        if (colorID === undefined)
            console.error("Could not find color ID!");
        if (!noThemeUpdate && colorID !== undefined) {
            document.documentElement.style.setProperty(colorID, color);
        }
        const pickerButton = colorPicker.find("label");
        pickerButton.val(color);
        pickerButton.attr("value", color);
        if (pickerButton.attr("for") !== "--bg-color") {
            pickerButton.css("background-color", color);
        }
        colorPicker.find("input[type=text]").val(color);
        colorPicker.find("input[type=color]").attr("value", color);
        return;
    }
    const colorREGEX = [
        {
            rule: /\b[0-9]{1,3},\s?[0-9]{1,3},\s?[0-9]{1,3}\s*\b/,
            start: "rgb(",
            end: ")",
        },
        {
            rule: /\b[A-Z, a-z, 0-9]{6}\b/,
            start: "#",
            end: "",
        },
        {
            rule: /\b[0-9]{1,3},\s?[0-9]{1,3}%,\s?[0-9]{1,3}%?\s*\b/,
            start: "hsl(",
            end: ")",
        },
    ];
    color = color.replace("", "");
    for (const regex of colorREGEX) {
        if (color.match(regex.rule)) {
            color = regex.start + color + regex.end;
            break;
        }
    }
    $(".colorConverter").css("color", color);
    const hexColor = Misc.convertRGBtoHEX($(".colorConverter").css("color"));
    if (hexColor === undefined) {
        return;
    }
    color = hexColor;
    const colorID = colorPicker.find("input[type=color]").attr("id");
    if (colorID === undefined)
        console.error("Could not find color ID!");
    if (!noThemeUpdate && colorID !== undefined) {
        document.documentElement.style.setProperty(colorID, color);
    }
    const pickerButton = colorPicker.find("label");
    pickerButton.val(color);
    pickerButton.attr("value", color);
    if (pickerButton.attr("for") !== "--bg-color") {
        pickerButton.css("background-color", color);
    }
    colorPicker.find("input[type=text]").val(color);
    colorPicker.find("input[type=color]").attr("value", color);
}
function refreshButtons() {
    return __awaiter(this, void 0, void 0, function* () {
        if (config_1.default.customTheme) {
            // Update custom theme buttons
            const customThemesEl = $(".pageSettings .section.themes .allCustomThemes.buttons").empty();
            const addButton = $(".pageSettings .section.themes .addCustomThemeButton");
            if (firebase_1.Auth.currentUser === null) {
                $(".pageSettings .section.themes .customThemeEdit .saveCustomThemeButton").text("save");
                return;
            }
            else {
                $(".pageSettings .section.themes .customThemeEdit .saveCustomThemeButton").text("save as new");
            }
            addButton.removeClass("hidden");
            const customThemes = DB.getSnapshot().customThemes;
            customThemes.forEach((customTheme) => {
                // const activeTheme =
                //   Config.customThemeId === customTheme._id ? "active" : "";
                const bgColor = customTheme.colors[0];
                const mainColor = customTheme.colors[1];
                customThemesEl.append(`<div class="customTheme button" customThemeId='${customTheme._id}' 
        style="color:${mainColor};background:${bgColor}">
        <div class="editButton"><i class="fas fa-pen"></i></div>
        <div class="text">${customTheme.name.replace(/_/g, " ")}</div>
        <div class="delButton"><i class="fas fa-trash fa-fw"></i></div>
        </div>`);
            });
        }
        else {
            // Update theme buttons
            const favThemesEl = $(".pageSettings .section.themes .favThemes.buttons").empty();
            const themesEl = $(".pageSettings .section.themes .allThemes.buttons").empty();
            let activeThemeName = config_1.default.theme;
            if (config_1.default.randomTheme !== "off" &&
                config_1.default.randomTheme !== "custom" &&
                ThemeController.randomTheme !== null) {
                activeThemeName = ThemeController.randomTheme;
            }
            const themes = yield Misc.getSortedThemesList();
            //first show favourites
            if (config_1.default.favThemes.length > 0) {
                favThemesEl.css({ paddingBottom: "1rem" });
                themes.forEach((theme) => {
                    if (config_1.default.favThemes.includes(theme.name)) {
                        const activeTheme = activeThemeName === theme.name ? "active" : "";
                        favThemesEl.append(`<div class="theme button ${activeTheme}" theme='${theme.name}' 
            style="color:${theme.mainColor};background:${theme.bgColor}">
            <div class="activeIndicator"><i class="fas fa-circle"></i></div>
            <div class="text">${theme.name.replace(/_/g, " ")}</div>
            <div class="favButton active"><i class="fas fa-star"></i></div></div>`);
                    }
                });
            }
            else {
                favThemesEl.css({ paddingBottom: "0" });
            }
            //then the rest
            themes.forEach((theme) => {
                if (config_1.default.favThemes.includes(theme.name)) {
                    return;
                }
                const activeTheme = activeThemeName === theme.name ? "active" : "";
                themesEl.append(`<div class="theme button ${activeTheme}" theme='${theme.name}' style="color:${theme.mainColor};background:${theme.bgColor}">
        <div class="activeIndicator"><i class="fas fa-circle"></i></div>
        <div class="text">${theme.name.replace(/_/g, " ")}</div>
        <div class="favButton"><i class="far fa-star"></i></div></div>`);
            });
        }
        updateActiveButton();
    });
}
exports.refreshButtons = refreshButtons;
function setCustomInputs(noThemeUpdate = false) {
    $(".pageSettings .section.themes .tabContainer .customTheme .colorPicker").each((_index, element) => {
        const currentColor = config_1.default.customThemeColors[ThemeController.colorVars.indexOf($(element).find("input[type=color]").attr("id"))];
        updateColors($(element), currentColor, false, noThemeUpdate);
    });
}
exports.setCustomInputs = setCustomInputs;
function toggleFavourite(themeName) {
    if (config_1.default.favThemes.includes(themeName)) {
        // already favourite, remove
        UpdateConfig.setFavThemes(config_1.default.favThemes.filter((t) => t !== themeName));
    }
    else {
        // add to favourites
        const newList = config_1.default.favThemes;
        newList.push(themeName);
        UpdateConfig.setFavThemes(newList);
    }
    UpdateConfig.saveFullConfigToLocalStorage();
}
function saveCustomThemeColors() {
    const newColors = [];
    $.each($(".pageSettings .customTheme .customThemeEdit [type='color']"), (_index, element) => {
        newColors.push($(element).attr("value"));
    });
    UpdateConfig.setCustomThemeColors(newColors);
    Notifications.add("Custom theme saved", 1);
}
exports.saveCustomThemeColors = saveCustomThemeColors;
function updateActiveTab(forced = false) {
    // Set force to true only when some change for the active tab has taken place
    // Prevent theme buttons from being added twice by doing an update only when the state has changed
    const $presetTabButton = $(".pageSettings .section.themes .tabs .button[tab='preset']");
    const $customTabButton = $(".pageSettings .section.themes .tabs .button[tab='custom']");
    if (config_1.default.customTheme) {
        $presetTabButton.removeClass("active");
        if (!$customTabButton.hasClass("active") || forced) {
            $customTabButton.addClass("active");
            refreshButtons();
        }
        Misc.swapElements($('.pageSettings [tabContent="preset"]'), $('.pageSettings [tabContent="custom"]'), 250);
    }
    else {
        $customTabButton.removeClass("active");
        if (!$presetTabButton.hasClass("active") || forced) {
            $presetTabButton.addClass("active");
            refreshButtons();
        }
        Misc.swapElements($('.pageSettings [tabContent="custom"]'), $('.pageSettings [tabContent="preset"]'), 250);
    }
}
exports.updateActiveTab = updateActiveTab;
// Add events to the DOM
// Handle click on theme: preset or custom tab
$(".pageSettings .section.themes .tabs .button").on("click", (e) => {
    $(".pageSettings .section.themes .tabs .button").removeClass("active");
    const $target = $(e.currentTarget);
    $target.addClass("active");
    // setCustomInputs();
    if ($target.attr("tab") == "preset") {
        UpdateConfig.setCustomTheme(false);
    }
    else {
        UpdateConfig.setCustomTheme(true);
    }
});
// Handle click on custom theme button
$(document).on("click", ".pageSettings .section.themes .customTheme.button", (e) => {
    var _a;
    // Do not apply if user wanted to delete it
    if ($(e.target).hasClass("delButton"))
        return;
    if ($(e.target).hasClass("editButton"))
        return;
    const customThemeId = (_a = $(e.currentTarget).attr("customThemeId")) !== null && _a !== void 0 ? _a : "";
    ThemeController.set(customThemeId, true);
});
// Handle click on favorite preset theme button
$(document).on("click", ".pageSettings .section.themes .theme .favButton", (e) => {
    const theme = $(e.currentTarget).parents(".theme.button").attr("theme");
    if (theme !== undefined)
        toggleFavourite(theme);
    else {
        console.error("Could not find the theme attribute attached to the button clicked!");
    }
});
// Handle click on preset theme button
$(document).on("click", ".pageSettings .section.themes .theme.button", (e) => {
    const theme = $(e.currentTarget).attr("theme");
    if (!$(e.target).hasClass("favButton") && theme !== undefined) {
        UpdateConfig.setTheme(theme);
        updateActiveButton();
    }
});
$(".pageSettings .section.themes .tabContainer .customTheme input[type=color]").on("input", (e) => {
    const $colorVar = $(e.currentTarget).attr("id");
    const $pickedColor = $(e.currentTarget).val();
    updateColors($(".colorPicker #" + $colorVar).parent(), $pickedColor, true);
});
$(".pageSettings .section.themes .tabContainer .customTheme input[type=color]").on("change", (e) => {
    const $colorVar = $(e.currentTarget).attr("id");
    const $pickedColor = $(e.currentTarget).val();
    updateColors($(".colorPicker #" + $colorVar).parent(), $pickedColor);
});
$(".pageSettings .section.themes .tabContainer .customTheme input[type=text]")
    .on("blur", (e) => {
    if (e.target.id === "name")
        return;
    const $colorVar = $(e.currentTarget).attr("id");
    const $pickedColor = $(e.currentTarget).val();
    updateColors($(".colorPicker #" + $colorVar).parent(), $pickedColor);
})
    .on("keypress", function (e) {
    if (e.target.id === "name")
        return;
    if (e.code === "Enter") {
        $(this).attr("disabled", "disabled");
        const $colorVar = $(e.currentTarget).attr("id");
        const $pickedColor = $(e.currentTarget).val();
        updateColors($(".colorPicker #" + $colorVar).parent(), $pickedColor);
        $(this).removeAttr("disabled");
    }
});
$(".pageSettings #loadCustomColorsFromPreset").on("click", () => {
    // previewTheme(Config.theme);
    $("#currentTheme").attr("href", `themes/${config_1.default.theme}.css`);
    ThemeController.colorVars.forEach((e) => {
        document.documentElement.style.setProperty(e, "");
    });
    setTimeout(() => __awaiter(void 0, void 0, void 0, function* () {
        ChartController.updateAllChartColors();
        const themeColors = yield ThemeColors.getAll();
        ThemeController.colorVars.forEach((colorName) => {
            let color;
            if (colorName === "--bg-color") {
                color = themeColors.bg;
            }
            else if (colorName === "--main-color") {
                color = themeColors.main;
            }
            else if (colorName === "--sub-color") {
                color = themeColors.sub;
            }
            else if (colorName === "--caret-color") {
                color = themeColors.caret;
            }
            else if (colorName === "--text-color") {
                color = themeColors.text;
            }
            else if (colorName === "--error-color") {
                color = themeColors.error;
            }
            else if (colorName === "--error-extra-color") {
                color = themeColors.errorExtra;
            }
            else if (colorName === "--colorful-error-color") {
                color = themeColors.colorfulError;
            }
            else if (colorName === "--colorful-error-extra-color") {
                color = themeColors.colorfulErrorExtra;
            }
            updateColors($(".colorPicker #" + colorName).parent(), color);
        });
    }), 250);
});
// Handles click on share custom theme button
$("#shareCustomThemeButton").on("click", () => {
    const share = [];
    $.each($(".pageSettings .customTheme .customThemeEdit [type='color']"), (_, element) => {
        share.push($(element).attr("value"));
    });
    const url = "https://monkeytype.com?customTheme=" + btoa(JSON.stringify(share));
    navigator.clipboard.writeText(url).then(function () {
        Notifications.add("URL Copied to clipboard", 0);
    }, function () {
        CustomThemePopup.show(url);
    });
});
$(".pageSettings .saveCustomThemeButton").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    saveCustomThemeColors();
    if (firebase_1.Auth.currentUser) {
        const newCustomTheme = {
            name: "custom",
            colors: config_1.default.customThemeColors,
        };
        Loader.show();
        const response = yield DB.addCustomTheme(newCustomTheme);
        Loader.hide();
        if (response) {
            updateActiveTab(true);
        }
    }
    else {
        updateActiveTab(true);
    }
}));
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "customThemeId")
        refreshButtons();
    // if (eventKey === "customTheme") updateActiveTab();
});


/***/ }),

/***/ "./src/scripts/states/active-page.ts":
/*!*******************************************!*\
  !*** ./src/scripts/states/active-page.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.set = exports.get = void 0;
let activePage = "loading";
function get() {
    return activePage;
}
exports.get = get;
function set(active) {
    activePage = active;
}
exports.set = set;


/***/ }),

/***/ "./src/scripts/states/glarses-mode.ts":
/*!********************************************!*\
  !*** ./src/scripts/states/glarses-mode.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.enable = exports.get = void 0;
let glarsesMode = false;
function get() {
    return glarsesMode;
}
exports.get = get;
function enable() {
    glarsesMode = true;
    console.log("Glarses Mode On - test result will be hidden. You can check the stats in the console (here)");
    console.log("To disable Glarses Mode refresh the page.");
}
exports.enable = enable;


/***/ }),

/***/ "./src/scripts/states/page-transition.ts":
/*!***********************************************!*\
  !*** ./src/scripts/states/page-transition.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.get = exports.set = void 0;
let transition = true;
function set(val) {
    transition = val;
}
exports.set = set;
function get() {
    return transition;
}
exports.get = get;


/***/ }),

/***/ "./src/scripts/states/slow-timer.ts":
/*!******************************************!*\
  !*** ./src/scripts/states/slow-timer.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.get = exports.clear = exports.set = void 0;
let slowTimer = false;
function set() {
    if (slowTimer)
        return;
    slowTimer = true;
    console.error("Slow timer, disabling animations");
    // Notifications.add("Slow timer detected", -1, 5);
}
exports.set = set;
function clear() {
    slowTimer = false;
}
exports.clear = clear;
function get() {
    return slowTimer;
}
exports.get = get;


/***/ }),

/***/ "./src/scripts/states/test-active.ts":
/*!*******************************************!*\
  !*** ./src/scripts/states/test-active.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.set = exports.get = void 0;
let testActive = false;
function get() {
    return testActive;
}
exports.get = get;
function set(active) {
    testActive = active;
}
exports.set = set;


/***/ }),

/***/ "./src/scripts/states/time.ts":
/*!************************************!*\
  !*** ./src/scripts/states/time.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.increment = exports.set = exports.get = void 0;
let time = 0;
function get() {
    return time;
}
exports.get = get;
function set(active) {
    time = active;
}
exports.set = set;
function increment() {
    time++;
}
exports.increment = increment;


/***/ }),

/***/ "./src/scripts/test/british-english.ts":
/*!*********************************************!*\
  !*** ./src/scripts/test/british-english.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.replace = exports.getList = void 0;
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
let list = [];
function getList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (list.length === 0) {
            return $.getJSON("languages/britishenglish.json", function (data) {
                list = data;
                return list;
            });
        }
        else {
            return list;
        }
    });
}
exports.getList = getList;
function replace(word) {
    return __awaiter(this, void 0, void 0, function* () {
        const list = yield getList();
        const replacement = list.find((a) => word.match(RegExp(`^([\\W]*${a[0]}[\\W]*)$`, "gi")));
        return replacement
            ? word.replace(RegExp(`^(?:([\\W]*)(${replacement[0]})([\\W]*))$`, "gi"), (_, $1, $2, $3) => $1 +
                ($2.charAt(0) === $2.charAt(0).toUpperCase()
                    ? $2 === $2.toUpperCase()
                        ? replacement[1].toUpperCase()
                        : (0, misc_1.capitalizeFirstLetterOfEachWord)(replacement[1])
                    : replacement[1]) +
                $3)
            : word;
    });
}
exports.replace = replace;


/***/ }),

/***/ "./src/scripts/test/caps-warning.ts":
/*!******************************************!*\
  !*** ./src/scripts/test/caps-warning.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.capsState = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
exports.capsState = false;
function show() {
    if ($("#capsWarning").hasClass("hidden")) {
        $("#capsWarning").removeClass("hidden");
    }
}
function hide() {
    if (!$("#capsWarning").hasClass("hidden")) {
        $("#capsWarning").addClass("hidden");
    }
}
$(document).keydown(function (event) {
    var _a, _b;
    if (((_a = event === null || event === void 0 ? void 0 : event.originalEvent) === null || _a === void 0 ? void 0 : _a.getModifierState) &&
        ((_b = event === null || event === void 0 ? void 0 : event.originalEvent) === null || _b === void 0 ? void 0 : _b.getModifierState("CapsLock"))) {
        exports.capsState = true;
    }
    else {
        exports.capsState = false;
    }
    try {
        if (config_1.default.capsLockWarning && exports.capsState) {
            show();
        }
        else {
            hide();
        }
    }
    catch (_c) { }
});
$(document).keyup(function (event) {
    var _a, _b;
    if (((_a = event === null || event === void 0 ? void 0 : event.originalEvent) === null || _a === void 0 ? void 0 : _a.getModifierState) &&
        ((_b = event === null || event === void 0 ? void 0 : event.originalEvent) === null || _b === void 0 ? void 0 : _b.getModifierState("CapsLock"))) {
        //filthy fix but optional chaining refues to work
        exports.capsState = true;
    }
    else {
        exports.capsState = false;
    }
    try {
        if (config_1.default.capsLockWarning && exports.capsState) {
            show();
        }
        else {
            hide();
        }
    }
    catch (_c) { }
});


/***/ }),

/***/ "./src/scripts/test/caret.ts":
/*!***********************************!*\
  !*** ./src/scripts/test/caret.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.updatePosition = exports.hide = exports.startAnimation = exports.stopAnimation = exports.caretAnimating = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
exports.caretAnimating = true;
function stopAnimation() {
    if (exports.caretAnimating === true) {
        $("#caret").css("animation-name", "none");
        $("#caret").css("opacity", "1");
        exports.caretAnimating = false;
    }
}
exports.stopAnimation = stopAnimation;
function startAnimation() {
    if (exports.caretAnimating === false) {
        if (config_1.default.smoothCaret && !SlowTimer.get()) {
            $("#caret").css("animation-name", "caretFlashSmooth");
        }
        else {
            $("#caret").css("animation-name", "caretFlashHard");
        }
        exports.caretAnimating = true;
    }
}
exports.startAnimation = startAnimation;
function hide() {
    $("#caret").addClass("hidden");
}
exports.hide = hide;
function updatePosition() {
    var _a, _b;
    return __awaiter(this, void 0, void 0, function* () {
        if ($("#wordsWrapper").hasClass("hidden"))
            return;
        // if ($("#caret").hasClass("off")) {
        //   return;
        // }
        const caret = $("#caret");
        let inputLen = TestInput.input.current.length;
        inputLen = Misc.trailingComposeChars.test(TestInput.input.current)
            ? TestInput.input.current.search(Misc.trailingComposeChars) + 1
            : inputLen;
        let currentLetterIndex = inputLen - 1;
        if (currentLetterIndex == -1) {
            currentLetterIndex = 0;
        }
        //insert temporary character so the caret will work in zen mode
        const activeWordEmpty = $("#words .active").children().length == 0;
        if (activeWordEmpty) {
            $("#words .active").append('<letter style="opacity: 0;">_</letter>');
        }
        const currentWordNodeList = (_a = document === null || document === void 0 ? void 0 : document.querySelector("#words .active")) === null || _a === void 0 ? void 0 : _a.querySelectorAll("letter");
        if (!currentWordNodeList)
            return;
        let currentLetter = currentWordNodeList[currentLetterIndex];
        if (inputLen > currentWordNodeList.length) {
            currentLetter = currentWordNodeList[currentWordNodeList.length - 1];
        }
        if (config_1.default.mode != "zen" && $(currentLetter).length == 0)
            return;
        const currentLanguage = yield Misc.getCurrentLanguage(config_1.default.language);
        const isLanguageLeftToRight = currentLanguage.leftToRight;
        const currentLetterPosLeft = isLanguageLeftToRight
            ? currentLetter.offsetLeft
            : currentLetter.offsetLeft + ((_b = $(currentLetter).width()) !== null && _b !== void 0 ? _b : 0);
        const currentLetterPosTop = currentLetter.offsetTop;
        const letterHeight = $(currentLetter).height();
        let newTop = 0;
        let newLeft = 0;
        newTop = currentLetterPosTop - Math.round(letterHeight / 5);
        if (inputLen == 0) {
            newLeft = isLanguageLeftToRight
                ? currentLetterPosLeft - caret.width() / 2
                : currentLetterPosLeft + caret.width() / 2;
        }
        else {
            newLeft = isLanguageLeftToRight
                ? currentLetterPosLeft +
                    $(currentLetter).width() -
                    caret.width() / 2
                : currentLetterPosLeft -
                    $(currentLetter).width() +
                    caret.width() / 2;
        }
        let smoothlinescroll = $("#words .smoothScroller").height();
        if (smoothlinescroll === undefined)
            smoothlinescroll = 0;
        if (config_1.default.smoothCaret) {
            caret.stop(true, false).animate({
                top: newTop - smoothlinescroll,
                left: newLeft,
            }, SlowTimer.get() ? 0 : 100);
        }
        else {
            caret.stop(true, true).animate({
                top: newTop - smoothlinescroll,
                left: newLeft,
            }, 0);
        }
        if (config_1.default.showAllLines) {
            const browserHeight = window.innerHeight;
            const middlePos = browserHeight / 2 - $("#caret").outerHeight() / 2;
            const contentHeight = document.body.scrollHeight;
            if (newTop >= middlePos &&
                contentHeight > browserHeight &&
                TestActive.get()) {
                const newscrolltop = newTop - middlePos / 2;
                // console.log('---------');
                // console.log(newTop);
                // console.log(middlePos);
                // console.log(browserHeight);
                // console.log(contentHeight);
                window.scrollTo({
                    left: 0,
                    top: newscrolltop,
                    behavior: "smooth",
                });
            }
        }
        if (activeWordEmpty) {
            $("#words .active").children().remove();
        }
    });
}
exports.updatePosition = updatePosition;
function show() {
    if ($("#result").hasClass("hidden")) {
        updatePosition();
        $("#caret").removeClass("hidden");
        startAnimation();
    }
}
exports.show = show;


/***/ }),

/***/ "./src/scripts/test/custom-text.ts":
/*!*****************************************!*\
  !*** ./src/scripts/test/custom-text.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getCustomTextNames = exports.deleteCustomText = exports.setCustomText = exports.getCustomText = exports.setDelimiter = exports.setWord = exports.setTime = exports.setIsTimeRandom = exports.setIsWordRandom = exports.setText = exports.delimiter = exports.time = exports.word = exports.isTimeRandom = exports.isWordRandom = exports.text = void 0;
exports.text = [
    "The",
    "quick",
    "brown",
    "fox",
    "jumps",
    "over",
    "the",
    "lazy",
    "dog",
];
exports.isWordRandom = false;
exports.isTimeRandom = false;
exports.delimiter = " ";
function setText(txt) {
    exports.text = txt;
}
exports.setText = setText;
function setIsWordRandom(val) {
    exports.isWordRandom = val;
}
exports.setIsWordRandom = setIsWordRandom;
function setIsTimeRandom(val) {
    exports.isTimeRandom = val;
}
exports.setIsTimeRandom = setIsTimeRandom;
function setTime(val) {
    exports.time = val;
}
exports.setTime = setTime;
function setWord(val) {
    exports.word = val;
}
exports.setWord = setWord;
function setDelimiter(val) {
    exports.delimiter = val;
}
exports.setDelimiter = setDelimiter;
function getCustomText(name) {
    const customText = getCustomTextObject();
    return customText[name].split(/ +/);
}
exports.getCustomText = getCustomText;
function setCustomText(name, text) {
    const customText = getCustomTextObject();
    if (typeof text === "string")
        customText[name] = text;
    else
        customText[name] = text.join(" ");
    window.localStorage.setItem("customText", JSON.stringify(customText));
}
exports.setCustomText = setCustomText;
function deleteCustomText(name) {
    const customText = getCustomTextObject();
    if (customText[name])
        delete customText[name];
    window.localStorage.setItem("customText", JSON.stringify(customText));
}
exports.deleteCustomText = deleteCustomText;
function getCustomTextObject() {
    var _a;
    return JSON.parse((_a = window.localStorage.getItem("customText")) !== null && _a !== void 0 ? _a : "{}");
}
function getCustomTextNames() {
    return Object.keys(getCustomTextObject());
}
exports.getCustomTextNames = getCustomTextNames;


/***/ }),

/***/ "./src/scripts/test/focus.ts":
/*!***********************************!*\
  !*** ./src/scripts/test/focus.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.set = void 0;
const Caret = __importStar(__webpack_require__(/*! ./caret */ "./src/scripts/test/caret.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const unfocusPx = 3;
let state = false;
function set(foc, withCursor = false) {
    if (foc && !state) {
        state = true;
        Caret.stopAnimation();
        $("#top").addClass("focus");
        $("#bottom").addClass("focus");
        if (!withCursor)
            $("body").css("cursor", "none");
        $("#middle").addClass("focus");
        $("#bannerCenter").addClass("focus");
    }
    else if (!foc && state) {
        state = false;
        Caret.startAnimation();
        $("#top").removeClass("focus");
        $("#bottom").removeClass("focus");
        $("body").css("cursor", "default");
        $("#middle").removeClass("focus");
        $("#bannerCenter").removeClass("focus");
    }
}
exports.set = set;
$(document).mousemove(function (event) {
    if (!state)
        return;
    if (ActivePage.get() == "loading")
        return;
    if (ActivePage.get() == "account" && state == true)
        return;
    if ($("#top").hasClass("focus") &&
        event.originalEvent &&
        // To avoid mouse/desk vibration from creating a flashy effect, we'll unfocus @ >5px instead of >0px
        (event.originalEvent.movementX > unfocusPx ||
            event.originalEvent.movementY > unfocusPx)) {
        set(false);
    }
});


/***/ }),

/***/ "./src/scripts/test/funbox.ts":
/*!************************************!*\
  !*** ./src/scripts/test/funbox.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.rememberSettings = exports.activate = exports.clear = exports.setFunbox = exports.toggleScript = exports.reset = exports.startMemoryTimer = exports.resetMemoryTimer = void 0;
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ./manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const TTS = __importStar(__webpack_require__(/*! ./tts */ "./src/scripts/test/tts.ts"));
const ModesNotice = __importStar(__webpack_require__(/*! ../elements/modes-notice */ "./src/scripts/elements/modes-notice.ts"));
let modeSaved = null;
let memoryTimer = null;
let memoryInterval = null;
let settingsMemory = {};
function rememberSetting(settingName, value, setFunction) {
    var _a;
    (_a = settingsMemory[settingName]) !== null && _a !== void 0 ? _a : (settingsMemory[settingName] = {
        value,
        setFunction,
    });
}
function loadMemory() {
    Notifications.add("Reverting funbox settings", 0);
    Object.keys(settingsMemory).forEach((setting) => {
        settingsMemory[setting].setFunction(settingsMemory[setting].value, true);
    });
    settingsMemory = {};
}
function showMemoryTimer() {
    $("#typingTest #memoryTimer").stop(true, true).animate({
        opacity: 1,
    }, 125);
}
function hideMemoryTimer() {
    $("#typingTest #memoryTimer").stop(true, true).animate({
        opacity: 0,
    }, 125);
}
function resetMemoryTimer() {
    if (memoryInterval !== null) {
        clearInterval(memoryInterval);
        memoryInterval = null;
    }
    memoryTimer = null;
    hideMemoryTimer();
}
exports.resetMemoryTimer = resetMemoryTimer;
function updateMemoryTimer(sec) {
    $("#typingTest #memoryTimer").text(`Timer left to memorise all words: ${sec}s`);
}
function startMemoryTimer() {
    resetMemoryTimer();
    memoryTimer = Math.round(Math.pow(TestWords.words.length, 1.2));
    updateMemoryTimer(memoryTimer);
    showMemoryTimer();
    memoryInterval = setInterval(() => {
        if (memoryTimer === null)
            return;
        memoryTimer -= 1;
        memoryTimer == 0 ? hideMemoryTimer() : updateMemoryTimer(memoryTimer);
        if (memoryTimer <= 0) {
            resetMemoryTimer();
            $("#wordsWrapper").addClass("hidden");
        }
    }, 1000);
}
exports.startMemoryTimer = startMemoryTimer;
function reset() {
    resetMemoryTimer();
}
exports.reset = reset;
function toggleScript(...params) {
    if (config_1.default.funbox === "tts") {
        TTS.speak(params[0]);
    }
}
exports.toggleScript = toggleScript;
function setFunbox(funbox, mode) {
    modeSaved = mode;
    UpdateConfig.setFunbox(funbox, false);
    if (funbox === "none")
        loadMemory();
    return true;
}
exports.setFunbox = setFunbox;
function clear() {
    return __awaiter(this, void 0, void 0, function* () {
        $("#funBoxTheme").attr("href", ``);
        $("#words").removeClass("nospace");
        $("#words").removeClass("arrows");
        reset();
        $("#wordsWrapper").removeClass("hidden");
        ManualRestart.set();
        ModesNotice.update();
        return true;
    });
}
exports.clear = clear;
function activate(funbox) {
    return __awaiter(this, void 0, void 0, function* () {
        let mode = modeSaved;
        if (funbox === undefined || funbox === null) {
            funbox = config_1.default.funbox;
        }
        const funboxInfo = yield Misc.getFunbox(funbox);
        $("#funBoxTheme").attr("href", ``);
        $("#words").removeClass("nospace");
        $("#words").removeClass("arrows");
        if ((yield Misc.getCurrentLanguage(config_1.default.language)).ligatures) {
            if (funbox == "choo_choo" || funbox == "earthquake") {
                Notifications.add("Current language does not support this funbox mode", 0);
                UpdateConfig.setFunbox("none", true);
                yield clear();
                return;
            }
        }
        if (funbox !== "none" && (config_1.default.mode === "zen" || config_1.default.mode == "quote")) {
            if ((funboxInfo === null || funboxInfo === void 0 ? void 0 : funboxInfo.affectsWordGeneration) === true) {
                Notifications.add(`${Misc.capitalizeFirstLetterOfEachWord(config_1.default.mode)} mode does not support the ${funbox} funbox`, 0);
                UpdateConfig.setFunbox("none", true);
                yield clear();
                return;
            }
        }
        // if (funbox === "none") {
        reset();
        $("#wordsWrapper").removeClass("hidden");
        // }
        if (funbox === "none" && mode === undefined) {
            mode = null;
        }
        else if ((funbox !== "none" && mode === undefined) ||
            (funbox !== "none" && mode === null)) {
            const list = yield Misc.getFunboxList();
            mode = list.filter((f) => f.name === funbox)[0].type;
        }
        ManualRestart.set();
        if (mode === "style") {
            if (funbox != undefined) {
                $("#funBoxTheme").attr("href", `funbox/${funbox}.css`);
            }
            if (funbox === "simon_says") {
                UpdateConfig.setKeymapMode("next", true);
            }
            if (funbox === "read_ahead" ||
                funbox === "read_ahead_easy" ||
                funbox === "read_ahead_hard") {
                UpdateConfig.setHighlightMode("letter", true);
            }
        }
        else if (mode === "script") {
            if (funbox === "tts") {
                $("#funBoxTheme").attr("href", `funbox/simon_says.css`);
                UpdateConfig.setKeymapMode("off", true);
                UpdateConfig.setHighlightMode("letter", true);
            }
            else if (funbox === "layoutfluid") {
                UpdateConfig.setLayout(config_1.default.customLayoutfluid
                    ? config_1.default.customLayoutfluid.split("#")[0]
                    : "qwerty", true);
                UpdateConfig.setKeymapLayout(config_1.default.customLayoutfluid
                    ? config_1.default.customLayoutfluid.split("#")[0]
                    : "qwerty", true);
            }
            else if (funbox === "memory") {
                UpdateConfig.setMode("words", true);
                UpdateConfig.setShowAllLines(true, true);
                if (config_1.default.keymapMode === "next") {
                    UpdateConfig.setKeymapMode("react", true);
                }
            }
            else if (funbox === "nospace") {
                $("#words").addClass("nospace");
                UpdateConfig.setHighlightMode("letter", true);
            }
            else if (funbox === "arrows") {
                $("#words").addClass("arrows");
                UpdateConfig.setHighlightMode("letter", true);
            }
        }
        // ModesNotice.update();
        return true;
    });
}
exports.activate = activate;
function rememberSettings() {
    return __awaiter(this, void 0, void 0, function* () {
        const funbox = config_1.default.funbox;
        let mode = modeSaved;
        if (funbox === "none" && mode === undefined) {
            mode = null;
        }
        else if ((funbox !== "none" && mode === undefined) ||
            (funbox !== "none" && mode === null)) {
            const list = yield Misc.getFunboxList();
            mode = list.filter((f) => f.name === funbox)[0].type;
        }
        if (mode === "style") {
            if (funbox === "simon_says") {
                rememberSetting("keymapMode", config_1.default.keymapMode, UpdateConfig.setKeymapMode);
            }
            if (funbox === "read_ahead" ||
                funbox === "read_ahead_easy" ||
                funbox === "read_ahead_hard") {
                rememberSetting("highlightMode", config_1.default.highlightMode, UpdateConfig.setHighlightMode);
            }
        }
        else if (mode === "script") {
            if (funbox === "tts") {
                rememberSetting("keymapMode", config_1.default.keymapMode, UpdateConfig.setKeymapMode);
            }
            else if (funbox === "layoutfluid") {
                rememberSetting("keymapMode", config_1.default.keymapMode, UpdateConfig.setKeymapMode);
                rememberSetting("layout", config_1.default.layout, UpdateConfig.setLayout);
                rememberSetting("keymapLayout", config_1.default.keymapLayout, UpdateConfig.setKeymapLayout);
            }
            else if (funbox === "memory") {
                rememberSetting("mode", config_1.default.mode, UpdateConfig.setMode);
                rememberSetting("showAllLines", config_1.default.showAllLines, UpdateConfig.setShowAllLines);
                if (config_1.default.keymapMode === "next") {
                    rememberSetting("keymapMode", config_1.default.keymapMode, UpdateConfig.setKeymapMode);
                }
            }
            else if (funbox === "nospace") {
                rememberSetting("highlightMode", config_1.default.highlightMode, UpdateConfig.setHighlightMode);
            }
            else if (funbox === "arrows") {
                rememberSetting("highlightMode", config_1.default.highlightMode, UpdateConfig.setHighlightMode);
            }
            else if (funbox === "58008") {
                rememberSetting("numbers", config_1.default.numbers, UpdateConfig.setNumbers);
            }
        }
    });
}
exports.rememberSettings = rememberSettings;


/***/ }),

/***/ "./src/scripts/test/layout-emulator.ts":
/*!*********************************************!*\
  !*** ./src/scripts/test/layout-emulator.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getCharFromEvent = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const caps_warning_1 = __webpack_require__(/*! ./caps-warning */ "./src/scripts/test/caps-warning.ts");
function getCharFromEvent(event) {
    return __awaiter(this, void 0, void 0, function* () {
        function emulatedLayoutShouldShiftKey(event, newKeyPreview) {
            if (caps_warning_1.capsState)
                return Misc.isASCIILetter(newKeyPreview) !== event.shiftKey;
            return event.shiftKey;
        }
        const layout = yield Misc.getLayout(config_1.default.layout);
        let keyEventCodes = [];
        if (layout.type === "ansi") {
            keyEventCodes = [
                "Backquote",
                "Digit1",
                "Digit2",
                "Digit3",
                "Digit4",
                "Digit5",
                "Digit6",
                "Digit7",
                "Digit8",
                "Digit9",
                "Digit0",
                "Minus",
                "Equal",
                "KeyQ",
                "KeyW",
                "KeyE",
                "KeyR",
                "KeyT",
                "KeyY",
                "KeyU",
                "KeyI",
                "KeyO",
                "KeyP",
                "BracketLeft",
                "BracketRight",
                "Backslash",
                "KeyA",
                "KeyS",
                "KeyD",
                "KeyF",
                "KeyG",
                "KeyH",
                "KeyJ",
                "KeyK",
                "KeyL",
                "Semicolon",
                "Quote",
                "KeyZ",
                "KeyX",
                "KeyC",
                "KeyV",
                "KeyB",
                "KeyN",
                "KeyM",
                "Comma",
                "Period",
                "Slash",
                "Space",
            ];
        }
        else if (layout.type === "iso") {
            keyEventCodes = [
                "Backquote",
                "Digit1",
                "Digit2",
                "Digit3",
                "Digit4",
                "Digit5",
                "Digit6",
                "Digit7",
                "Digit8",
                "Digit9",
                "Digit0",
                "Minus",
                "Equal",
                "KeyQ",
                "KeyW",
                "KeyE",
                "KeyR",
                "KeyT",
                "KeyY",
                "KeyU",
                "KeyI",
                "KeyO",
                "KeyP",
                "BracketLeft",
                "BracketRight",
                "KeyA",
                "KeyS",
                "KeyD",
                "KeyF",
                "KeyG",
                "KeyH",
                "KeyJ",
                "KeyK",
                "KeyL",
                "Semicolon",
                "Quote",
                "IntlBackslash",
                "Backquote",
                "KeyZ",
                "KeyX",
                "KeyC",
                "KeyV",
                "KeyB",
                "KeyN",
                "KeyM",
                "Comma",
                "Period",
                "Slash",
                "Space",
            ];
        }
        else if (layout.type === "matrix") {
            keyEventCodes = [
                "Backquote",
                "Digit1",
                "Digit2",
                "Digit3",
                "Digit4",
                "Digit5",
                "Digit6",
                "Digit7",
                "Digit8",
                "Digit9",
                "Digit0",
                "Minus",
                "Equal",
                "KeyQ",
                "KeyW",
                "KeyE",
                "KeyR",
                "KeyT",
                "KeyY",
                "KeyU",
                "KeyI",
                "KeyO",
                "KeyP",
                "BracketLeft",
                "BracketRight",
                "Backslash",
                "KeyA",
                "KeyS",
                "KeyD",
                "KeyF",
                "KeyG",
                "KeyH",
                "KeyJ",
                "KeyK",
                "KeyL",
                "Semicolon",
                "Quote",
                "KeyZ",
                "KeyX",
                "KeyC",
                "KeyV",
                "KeyB",
                "KeyN",
                "KeyM",
                "Comma",
                "Period",
                "Slash",
                "Space",
            ];
        }
        const layoutKeys = layout.keys;
        const layoutMap = layoutKeys["row1"]
            .concat(layoutKeys["row2"])
            .concat(layoutKeys["row3"])
            .concat(layoutKeys["row4"])
            .concat(layoutKeys["row5"]);
        let mapIndex = null;
        for (let i = 0; i < keyEventCodes.length; i++) {
            if (event.code == keyEventCodes[i]) {
                mapIndex = i;
            }
        }
        if (!mapIndex) {
            if (event.code.includes("Numpad")) {
                return event.key;
            }
            else {
                return null;
            }
        }
        const newKeyPreview = layoutMap[mapIndex][0];
        const shift = emulatedLayoutShouldShiftKey(event, newKeyPreview) ? 1 : 0;
        const char = layoutMap[mapIndex][shift];
        if (char) {
            return char;
        }
        else {
            return event.key;
        }
    });
}
exports.getCharFromEvent = getCharFromEvent;


/***/ }),

/***/ "./src/scripts/test/lazy-mode.ts":
/*!***************************************!*\
  !*** ./src/scripts/test/lazy-mode.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.replaceAccents = void 0;
const accents = [
    ["", "a"],
    ["", "e"],
    ["", "i"],
    ["", "o"],
    ["", "u"],
    ["", "n"],
    ["", "c"],
    ["", "r"],
    ["", "d"],
    ["", "t"],
    ["", "ae"],
    ["", "oe"],
    ["", "w"],
    ["g", "g"],
    ["", "h"],
    ["", "j"],
    ["", "n"],
    ["", "s"],
    ["", "z"],
    ["", "y"],
    ["", "l"],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
];
function replaceAccents(word, accentsOverride) {
    let newWord = word;
    if (!accents && !accentsOverride)
        return newWord;
    let regex;
    const list = accentsOverride || accents;
    for (let i = 0; i < list.length; i++) {
        regex = new RegExp(`[${list[i][0]}]`, "gi");
        newWord = newWord.replace(regex, list[i][1]);
    }
    return newWord;
}
exports.replaceAccents = replaceAccents;


/***/ }),

/***/ "./src/scripts/test/live-acc.ts":
/*!**************************************!*\
  !*** ./src/scripts/test/live-acc.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = exports.update = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
function update(acc) {
    let number = Math.floor(acc);
    if (config_1.default.blindMode) {
        number = 100;
    }
    document.querySelector("#miniTimerAndLiveWpm .acc").innerHTML =
        number + "%";
    document.querySelector("#liveAcc").innerHTML = number + "%";
}
exports.update = update;
function show() {
    if (!config_1.default.showLiveAcc)
        return;
    if (!TestActive.get())
        return;
    if (config_1.default.timerStyle === "mini") {
        // $("#miniTimerAndLiveWpm .wpm").css("opacity", Config.timerOpacity);
        if (!$("#miniTimerAndLiveWpm .acc").hasClass("hidden"))
            return;
        $("#miniTimerAndLiveWpm .acc")
            .removeClass("hidden")
            .css("opacity", 0)
            .animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
    else {
        // $("#liveWpm").css("opacity", Config.timerOpacity);
        if (!$("#liveAcc").hasClass("hidden"))
            return;
        $("#liveAcc").removeClass("hidden").css("opacity", 0).animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
}
exports.show = show;
function hide() {
    // $("#liveWpm").css("opacity", 0);
    // $("#miniTimerAndLiveWpm .wpm").css("opacity", 0);
    $("#liveAcc").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#liveAcc").addClass("hidden");
    });
    $("#miniTimerAndLiveWpm .acc").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#miniTimerAndLiveWpm .acc").addClass("hidden");
    });
}
exports.hide = hide;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "showLiveAcc")
        eventValue ? show() : hide();
});


/***/ }),

/***/ "./src/scripts/test/live-burst.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/live-burst.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = exports.update = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
function update(burst) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!config_1.default.showLiveBurst)
            return;
        let number = burst;
        if (config_1.default.blindMode) {
            number = 0;
        }
        document.querySelector("#miniTimerAndLiveWpm .burst").innerHTML =
            number.toString();
        document.querySelector("#liveBurst").innerHTML =
            number.toString();
    });
}
exports.update = update;
function show() {
    if (!config_1.default.showLiveBurst)
        return;
    if (!TestActive.get())
        return;
    if (config_1.default.timerStyle === "mini") {
        if (!$("#miniTimerAndLiveWpm .burst").hasClass("hidden"))
            return;
        $("#miniTimerAndLiveWpm .burst")
            .removeClass("hidden")
            .css("opacity", 0)
            .animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
    else {
        if (!$("#liveBurst").hasClass("hidden"))
            return;
        $("#liveBurst").removeClass("hidden").css("opacity", 0).animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
}
exports.show = show;
function hide() {
    $("#liveBurst").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#liveBurst").addClass("hidden");
    });
    $("#miniTimerAndLiveWpm .burst").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#miniTimerAndLiveWpm .burst").addClass("hidden");
    });
}
exports.hide = hide;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "showLiveBurst")
        eventValue ? show() : hide();
});


/***/ }),

/***/ "./src/scripts/test/live-wpm.ts":
/*!**************************************!*\
  !*** ./src/scripts/test/live-wpm.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = exports.update = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const liveWpmElement = document.querySelector("#liveWpm");
const miniLiveWpmElement = document.querySelector("#miniTimerAndLiveWpm .wpm");
function update(wpm, raw) {
    // if (!TestActive.get() || !Config.showLiveWpm) {
    //   hideLiveWpm();
    // } else {
    //   showLiveWpm();
    // }
    let number = wpm;
    if (config_1.default.blindMode) {
        number = raw;
    }
    if (config_1.default.alwaysShowCPM) {
        number = Math.round(number * 5);
    }
    miniLiveWpmElement.innerHTML = number.toString();
    liveWpmElement.innerHTML = number.toString();
}
exports.update = update;
function show() {
    if (!config_1.default.showLiveWpm)
        return;
    if (!TestActive.get())
        return;
    if (config_1.default.timerStyle === "mini") {
        // $("#miniTimerAndLiveWpm .wpm").css("opacity", Config.timerOpacity);
        if (!$("#miniTimerAndLiveWpm .wpm").hasClass("hidden"))
            return;
        $("#miniTimerAndLiveWpm .wpm")
            .removeClass("hidden")
            .css("opacity", 0)
            .animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
    else {
        // $("#liveWpm").css("opacity", Config.timerOpacity);
        if (!$("#liveWpm").hasClass("hidden"))
            return;
        $("#liveWpm").removeClass("hidden").css("opacity", 0).animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
}
exports.show = show;
function hide() {
    $("#liveWpm").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#liveWpm").addClass("hidden");
    });
    $("#miniTimerAndLiveWpm .wpm").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#miniTimerAndLiveWpm .wpm").addClass("hidden");
    });
}
exports.hide = hide;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "showLiveWpm")
        eventValue ? show() : hide();
});


/***/ }),

/***/ "./src/scripts/test/manual-restart-tracker.ts":
/*!****************************************************!*\
  !*** ./src/scripts/test/manual-restart-tracker.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.get = exports.reset = exports.set = void 0;
let state = false;
function set() {
    state = true;
}
exports.set = set;
function reset() {
    state = false;
}
exports.reset = reset;
function get() {
    return state;
}
exports.get = get;


/***/ }),

/***/ "./src/scripts/test/monkey.ts":
/*!************************************!*\
  !*** ./src/scripts/test/monkey.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = exports.stop = exports.type = exports.updateFastOpacity = void 0;
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "monkey" && TestActive.get()) {
        if (config_1.default.monkey) {
            $("#monkey").removeClass("hidden");
        }
        else {
            $("#monkey").addClass("hidden");
        }
    }
});
let left = false;
let right = false;
// 0 hand up
// 1 hand down
// 00 both hands up
// 01 right hand down
// 10 left hand down
// 11 both hands down
const elements = {
    "00": document.querySelector("#monkey .up"),
    "01": document.querySelector("#monkey .right"),
    "10": document.querySelector("#monkey .left"),
    "11": document.querySelector("#monkey .both"),
};
const elementsFast = {
    "00": document.querySelector("#monkey .fast .up"),
    "01": document.querySelector("#monkey .fast .right"),
    "10": document.querySelector("#monkey .fast .left"),
    "11": document.querySelector("#monkey .fast .both"),
};
let last = "right";
function toBit(b) {
    return b ? "1" : "0";
}
function update() {
    var _a, _b, _c;
    if (!config_1.default.monkey)
        return;
    if (!((_a = document.querySelector("#monkey")) === null || _a === void 0 ? void 0 : _a.classList.contains("hidden"))) {
        Object.keys(elements).forEach((key) => {
            var _a;
            (_a = elements[key]) === null || _a === void 0 ? void 0 : _a.classList.add("hidden");
        });
        Object.keys(elementsFast).forEach((key) => {
            var _a;
            (_a = elementsFast[key]) === null || _a === void 0 ? void 0 : _a.classList.add("hidden");
        });
        const id = `${toBit(left)}${toBit(right)}`;
        (_b = elements[id]) === null || _b === void 0 ? void 0 : _b.classList.remove("hidden");
        (_c = elementsFast[id]) === null || _c === void 0 ? void 0 : _c.classList.remove("hidden");
    }
}
function updateFastOpacity(num) {
    if (!config_1.default.monkey)
        return;
    const opacity = (0, misc_1.mapRange)(num, 130, 180, 0, 1);
    $("#monkey .fast").animate({ opacity: opacity }, 1000);
    let animDuration = (0, misc_1.mapRange)(num, 130, 180, 0.25, 0.01);
    if (animDuration == 0.25)
        animDuration = 0;
    $("#monkey").css({ animationDuration: animDuration + "s" });
}
exports.updateFastOpacity = updateFastOpacity;
function type() {
    if (!config_1.default.monkey)
        return;
    if (!left && last == "right") {
        left = true;
        last = "left";
    }
    else if (!right) {
        right = true;
        last = "right";
    }
    update();
}
exports.type = type;
function stop() {
    if (!config_1.default.monkey)
        return;
    if (left) {
        left = false;
    }
    else if (right) {
        right = false;
    }
    update();
}
exports.stop = stop;
function show() {
    if (!config_1.default.monkey)
        return;
    $("#monkey")
        .css("opacity", 0)
        .removeClass("hidden")
        .animate({ opacity: 1 }, 125);
}
exports.show = show;
function hide() {
    $("#monkey")
        .css("opacity", 1)
        .animate({ opacity: 1 }, 125, () => {
        $("#monkey").addClass("hidden");
    });
}
exports.hide = hide;


/***/ }),

/***/ "./src/scripts/test/out-of-focus.ts":
/*!******************************************!*\
  !*** ./src/scripts/test/out-of-focus.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.hide = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const outOfFocusTimeouts = [];
function hide() {
    $("#words").css("transition", "none").removeClass("blurred");
    $(".outOfFocusWarning").addClass("hidden");
    Misc.clearTimeouts(outOfFocusTimeouts);
}
exports.hide = hide;
function show() {
    outOfFocusTimeouts.push(setTimeout(() => {
        $("#words").css("transition", "0.25s").addClass("blurred");
        $(".outOfFocusWarning").removeClass("hidden");
    }, 1000));
}
exports.show = show;


/***/ }),

/***/ "./src/scripts/test/pace-caret.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/pace-caret.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.start = exports.handleSpace = exports.reset = exports.update = exports.init = exports.settings = void 0;
const TestStats = __importStar(__webpack_require__(/*! ./test-stats */ "./src/scripts/test/test-stats.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const TestUI = __importStar(__webpack_require__(/*! ./test-ui */ "./src/scripts/test/test-ui.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const TestState = __importStar(__webpack_require__(/*! ./test-state */ "./src/scripts/test/test-state.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
exports.settings = null;
function resetCaretPosition() {
    var _a;
    if (config_1.default.paceCaret === "off" && !TestState.isPaceRepeat)
        return;
    if (!$("#paceCaret").hasClass("hidden")) {
        $("#paceCaret").addClass("hidden");
    }
    if (config_1.default.mode === "zen")
        return;
    const caret = $("#paceCaret");
    const firstLetter = ((_a = document === null || document === void 0 ? void 0 : document.querySelector("#words .word")) === null || _a === void 0 ? void 0 : _a.querySelector("letter"));
    const firstLetterHeight = $(firstLetter).height();
    if (firstLetter === undefined || firstLetterHeight === undefined)
        return;
    caret.stop(true, true).animate({
        top: firstLetter.offsetTop - firstLetterHeight / 4,
        left: firstLetter.offsetLeft,
    }, 0, "linear");
}
function init() {
    return __awaiter(this, void 0, void 0, function* () {
        $("#paceCaret").addClass("hidden");
        const mode2 = Misc.getMode2(config_1.default, TestWords.randomQuote);
        let wpm;
        if (config_1.default.paceCaret === "pb") {
            wpm = yield DB.getLocalPB(config_1.default.mode, mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode, config_1.default.funbox);
        }
        else if (config_1.default.paceCaret === "average") {
            [wpm] = yield DB.getUserAverage10(config_1.default.mode, mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode);
            wpm = Math.round(wpm);
        }
        else if (config_1.default.paceCaret === "custom") {
            wpm = config_1.default.paceCaretCustomSpeed;
        }
        else if (TestState.isPaceRepeat == true) {
            wpm = TestStats.lastTestWpm;
        }
        if (wpm === undefined || wpm < 1 || Number.isNaN(wpm)) {
            exports.settings = null;
            return;
        }
        const characters = wpm * 5;
        const cps = characters / 60; //characters per step
        const spc = 60 / characters; //seconds per character
        exports.settings = {
            wpm: wpm,
            cps: cps,
            spc: spc,
            correction: 0,
            currentWordIndex: 0,
            currentLetterIndex: -1,
            wordsStatus: {},
            timeout: null,
        };
        resetCaretPosition();
    });
}
exports.init = init;
function update(expectedStepEnd) {
    if (exports.settings === null || !TestActive.get() || TestUI.resultVisible) {
        return;
    }
    // if ($("#paceCaret").hasClass("hidden")) {
    //   $("#paceCaret").removeClass("hidden");
    // }
    try {
        exports.settings.currentLetterIndex++;
        if (exports.settings.currentLetterIndex >=
            TestWords.words.get(exports.settings.currentWordIndex).length) {
            //go to the next word
            exports.settings.currentLetterIndex = -1;
            exports.settings.currentWordIndex++;
        }
        if (!config_1.default.blindMode) {
            if (exports.settings.correction < 0) {
                while (exports.settings.correction < 0) {
                    exports.settings.currentLetterIndex--;
                    if (exports.settings.currentLetterIndex <= -2) {
                        //go to the previous word
                        exports.settings.currentLetterIndex =
                            TestWords.words.get(exports.settings.currentWordIndex - 1).length - 1;
                        exports.settings.currentWordIndex--;
                    }
                    exports.settings.correction++;
                }
            }
            else if (exports.settings.correction > 0) {
                while (exports.settings.correction > 0) {
                    exports.settings.currentLetterIndex++;
                    if (exports.settings.currentLetterIndex >=
                        TestWords.words.get(exports.settings.currentWordIndex).length) {
                        //go to the next word
                        exports.settings.currentLetterIndex = -1;
                        exports.settings.currentWordIndex++;
                    }
                    exports.settings.correction--;
                }
            }
        }
    }
    catch (e) {
        //out of words
        exports.settings = null;
        $("#paceCaret").addClass("hidden");
        return;
    }
    try {
        const caret = $("#paceCaret");
        let currentLetter;
        let newTop;
        let newLeft;
        try {
            const newIndex = exports.settings.currentWordIndex -
                (TestWords.words.currentIndex - TestUI.currentWordElementIndex);
            const word = document.querySelectorAll("#words .word")[newIndex];
            if (exports.settings.currentLetterIndex === -1) {
                currentLetter = word.querySelectorAll("letter")[0];
            }
            else {
                currentLetter = (word.querySelectorAll("letter")[exports.settings.currentLetterIndex]);
            }
            const currentLetterHeight = $(currentLetter).height(), currentLetterWidth = $(currentLetter).width(), caretWidth = caret.width();
            if (currentLetterHeight === undefined ||
                currentLetterWidth === undefined ||
                caretWidth === undefined) {
                throw ``;
            }
            newTop = currentLetter.offsetTop - currentLetterHeight / 5;
            newLeft;
            if (exports.settings.currentLetterIndex === -1) {
                newLeft = currentLetter.offsetLeft;
            }
            else {
                newLeft =
                    currentLetter.offsetLeft + currentLetterWidth - caretWidth / 2;
            }
            caret.removeClass("hidden");
        }
        catch (e) {
            caret.addClass("hidden");
        }
        const duration = expectedStepEnd - performance.now();
        if (newTop !== undefined) {
            let smoothlinescroll = $("#words .smoothScroller").height();
            if (smoothlinescroll === undefined)
                smoothlinescroll = 0;
            $("#paceCaret").css({
                top: newTop - smoothlinescroll,
            });
            if (config_1.default.smoothCaret) {
                caret.stop(true, true).animate({
                    left: newLeft,
                }, SlowTimer.get() ? 0 : duration, "linear");
            }
            else {
                caret.stop(true, true).animate({
                    left: newLeft,
                }, 0, "linear");
            }
        }
        exports.settings.timeout = setTimeout(() => {
            var _a;
            try {
                update(expectedStepEnd + ((_a = exports.settings === null || exports.settings === void 0 ? void 0 : exports.settings.spc) !== null && _a !== void 0 ? _a : 0) * 1000);
            }
            catch (e) {
                exports.settings = null;
            }
        }, duration);
    }
    catch (e) {
        console.error(e);
        $("#paceCaret").addClass("hidden");
    }
}
exports.update = update;
function reset() {
    if (exports.settings !== null && exports.settings.timeout !== null) {
        clearTimeout(exports.settings.timeout);
    }
    exports.settings = null;
}
exports.reset = reset;
function handleSpace(correct, currentWord) {
    if (correct) {
        if (exports.settings !== null &&
            exports.settings.wordsStatus[TestWords.words.currentIndex] === true &&
            !config_1.default.blindMode) {
            exports.settings.wordsStatus[TestWords.words.currentIndex] = undefined;
            exports.settings.correction -= currentWord.length + 1;
        }
    }
    else {
        if (exports.settings !== null &&
            exports.settings.wordsStatus[TestWords.words.currentIndex] === undefined &&
            !config_1.default.blindMode) {
            exports.settings.wordsStatus[TestWords.words.currentIndex] = true;
            exports.settings.correction += currentWord.length + 1;
        }
    }
}
exports.handleSpace = handleSpace;
function start() {
    var _a;
    update(performance.now() + ((_a = exports.settings === null || exports.settings === void 0 ? void 0 : exports.settings.spc) !== null && _a !== void 0 ? _a : 0) * 1000);
}
exports.start = start;
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "paceCaret")
        init();
});


/***/ }),

/***/ "./src/scripts/test/pb-crown.ts":
/*!**************************************!*\
  !*** ./src/scripts/test/pb-crown.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.hide = void 0;
function hide() {
    $("#result .stats .wpm .crown").css("opacity", 0).addClass("hidden");
}
exports.hide = hide;
function show() {
    $("#result .stats .wpm .crown")
        .removeClass("hidden")
        .css("opacity", "0")
        .animate({
        opacity: 1,
    }, 250, "easeOutCubic");
}
exports.show = show;


/***/ }),

/***/ "./src/scripts/test/poetry.ts":
/*!************************************!*\
  !*** ./src/scripts/test/poetry.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getPoem = exports.Poem = void 0;
const axios_1 = __importDefault(__webpack_require__(/*! axios */ "./node_modules/axios/index.js"));
const bannedChars = ["", "_", " "];
const maxWords = 100;
const apiURL = "https://poetrydb.org/random";
class Poem {
    constructor(title, author, words) {
        this.title = title;
        this.author = author;
        this.words = words;
        this.cleanUpText();
    }
    cleanUpText() {
        let count = 0;
        const scrubbedWords = [];
        for (let i = 0; i < this.words.length; i++) {
            let scrubbed = "";
            for (let j = 0; j < this.words[i].length; j++) {
                if (!bannedChars.includes(this.words[i][j])) {
                    scrubbed += this.words[i][j];
                }
            }
            if (scrubbed == "")
                continue;
            scrubbedWords.push(scrubbed);
            count++;
            if (count == maxWords)
                break;
        }
        this.words = scrubbedWords;
    }
}
exports.Poem = Poem;
function getPoem() {
    return __awaiter(this, void 0, void 0, function* () {
        console.log("Getting poem");
        const response = yield axios_1.default.get(apiURL);
        try {
            const poemObj = response.data[0];
            const words = [];
            poemObj.lines.forEach((line) => {
                line.split(/ +/).forEach((word) => {
                    words.push(word);
                });
            });
            return new Poem(poemObj.title, poemObj.author, words);
        }
        catch (e) {
            console.log(e);
        }
        return;
    });
}
exports.getPoem = getPoem;


/***/ }),

/***/ "./src/scripts/test/practise-words.ts":
/*!********************************************!*\
  !*** ./src/scripts/test/practise-words.ts ***!
  \********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hidePopup = exports.showPopup = exports.resetBefore = exports.init = exports.before = void 0;
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const CustomText = __importStar(__webpack_require__(/*! ./custom-text */ "./src/scripts/test/custom-text.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
exports.before = {
    mode: null,
    punctuation: null,
    numbers: null,
};
function init(missed, slow) {
    if (config_1.default.mode === "zen")
        return;
    let limit;
    if ((missed && !slow) || (!missed && slow)) {
        limit = 20;
    }
    else if (missed && slow) {
        limit = 10;
    }
    else {
        limit = 10;
    }
    let sortableMissedWords = [];
    if (missed) {
        Object.keys(TestInput.missedWords).forEach((missedWord) => {
            sortableMissedWords.push([missedWord, TestInput.missedWords[missedWord]]);
        });
        sortableMissedWords.sort((a, b) => {
            return b[1] - a[1];
        });
        sortableMissedWords = sortableMissedWords.slice(0, limit);
    }
    if (missed && !slow && sortableMissedWords.length == 0) {
        Notifications.add("You haven't missed any words", 0);
        return;
    }
    let sortableSlowWords = [];
    if (slow) {
        sortableSlowWords = TestWords.words.get().map((e, i) => [
            e,
            TestInput.burstHistory[i],
        ]);
        sortableSlowWords.sort((a, b) => {
            return a[1] - b[1];
        });
        sortableSlowWords = sortableSlowWords.slice(0, Math.min(limit, Math.round(TestWords.words.length * 0.2)));
    }
    // console.log(sortableMissedWords);
    // console.log(sortableSlowWords);
    if (sortableMissedWords.length == 0 && sortableSlowWords.length == 0) {
        Notifications.add("Could not start a new custom test", 0);
        return;
    }
    const newCustomText = [];
    sortableMissedWords.forEach((missed) => {
        for (let i = 0; i < missed[1]; i++) {
            newCustomText.push(missed[0]);
        }
    });
    sortableSlowWords.forEach((slow, index) => {
        for (let i = 0; i < sortableSlowWords.length - index; i++) {
            newCustomText.push(slow[0]);
        }
    });
    // console.log(newCustomText);
    const mode = exports.before.mode === null ? config_1.default.mode : exports.before.mode;
    const punctuation = exports.before.punctuation === null ? config_1.default.punctuation : exports.before.punctuation;
    const numbers = exports.before.numbers === null ? config_1.default.numbers : exports.before.numbers;
    UpdateConfig.setMode("custom");
    CustomText.setText(newCustomText);
    CustomText.setIsWordRandom(true);
    CustomText.setWord((sortableSlowWords.length + sortableMissedWords.length) * 5);
    CustomText.setTime(-1);
    exports.before.mode = mode;
    exports.before.punctuation = punctuation;
    exports.before.numbers = numbers;
}
exports.init = init;
function resetBefore() {
    exports.before.mode = null;
    exports.before.punctuation = null;
    exports.before.numbers = null;
}
exports.resetBefore = resetBefore;
function showPopup(focus = false) {
    if ($("#practiseWordsPopupWrapper").hasClass("hidden")) {
        if (config_1.default.mode === "zen") {
            Notifications.add("Practice words is unsupported in zen mode", 0);
            return;
        }
        $("#practiseWordsPopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            if (focus) {
                console.log("focusing");
                $("#practiseWordsPopup .missed").trigger("focus");
            }
        });
    }
}
exports.showPopup = showPopup;
function hidePopup() {
    if (!$("#practiseWordsPopupWrapper").hasClass("hidden")) {
        $("#practiseWordsPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#practiseWordsPopupWrapper").addClass("hidden");
        });
    }
}
exports.hidePopup = hidePopup;
$("#practiseWordsPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "practiseWordsPopupWrapper") {
        hidePopup();
    }
});
$("#practiseWordsPopup .button").on("keypress", (e) => {
    if (e.key === "Enter") {
        $(e.currentTarget).click();
    }
});
$("#practiseWordsPopup .button.both").on("focusout", (e) => {
    e.preventDefault();
    $("#practiseWordsPopup .missed").trigger("focus");
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" &&
        !$("#practiseWordsPopupWrapper").hasClass("hidden")) {
        hidePopup();
        event.preventDefault();
    }
});
$(document).on("keypress", "#practiseWordsButton", (event) => {
    if (event.key === "Enter") {
        showPopup(true);
    }
});
$(document.body).on("click", "#practiseWordsButton", () => {
    showPopup();
});
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "mode")
        resetBefore();
});


/***/ }),

/***/ "./src/scripts/test/replay.ts":
/*!************************************!*\
  !*** ./src/scripts/test/replay.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getReplayExport = exports.replayGetWordsList = exports.addReplayEvent = exports.stopReplayRecording = exports.startReplayRecording = exports.pauseReplay = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Sound = __importStar(__webpack_require__(/*! ../controllers/sound-controller */ "./src/scripts/controllers/sound-controller.ts"));
let wordsList = [];
let replayData = [];
let replayStartTime = 0;
let replayRecording = true;
let wordPos = 0;
let curPos = 0;
let targetWordPos = 0;
let targetCurPos = 0;
let timeoutList = [];
let stopwatchList = [];
const toggleButton = (_a = document.getElementById("playpauseReplayButton")) === null || _a === void 0 ? void 0 : _a.children[0];
function replayGetWordsList(wordsListFromScript) {
    wordsList = wordsListFromScript;
}
exports.replayGetWordsList = replayGetWordsList;
function initializeReplayPrompt() {
    const replayWordsElement = document.getElementById("replayWords");
    if (replayWordsElement === null)
        return;
    replayWordsElement.innerHTML = "";
    let wordCount = 0;
    replayData.forEach((item) => {
        //trim wordsList for timed tests
        if (item.action === "backWord") {
            wordCount--;
        }
        else if (item.action === "submitCorrectWord" ||
            item.action === "submitErrorWord") {
            wordCount++;
        }
    });
    wordsList.forEach((item, i) => {
        if (i > wordCount)
            return;
        const x = document.createElement("div");
        x.className = "word";
        for (i = 0; i < item.length; i++) {
            const letter = document.createElement("letter");
            letter.innerHTML = item[i];
            x.appendChild(letter);
        }
        replayWordsElement.appendChild(x);
    });
}
function pauseReplay() {
    var _a;
    timeoutList.forEach((item) => {
        clearTimeout(item);
    });
    timeoutList = [];
    stopwatchList.forEach((item) => {
        clearTimeout(item);
    });
    stopwatchList = [];
    targetCurPos = curPos;
    targetWordPos = wordPos;
    if (toggleButton === undefined)
        return;
    toggleButton.className = "fas fa-play";
    (_a = toggleButton.parentNode) === null || _a === void 0 ? void 0 : _a.setAttribute("aria-label", "Resume replay");
}
exports.pauseReplay = pauseReplay;
function playSound(error = false) {
    if (error) {
        if (config_1.default.playSoundOnError) {
            Sound.playError();
        }
        else {
            Sound.playClick();
        }
    }
    else {
        Sound.playClick();
    }
}
function handleDisplayLogic(item, nosound = false) {
    var _a, _b, _c;
    let activeWord = (_a = document.getElementById("replayWords")) === null || _a === void 0 ? void 0 : _a.children[wordPos];
    if (activeWord === undefined)
        return;
    if (item.action === "correctLetter") {
        if (!nosound)
            playSound();
        activeWord.children[curPos].classList.add("correct");
        curPos++;
    }
    else if (item.action === "incorrectLetter") {
        if (!nosound)
            playSound(true);
        let myElement;
        if (curPos >= activeWord.children.length) {
            //if letter is an extra
            myElement = document.createElement("letter");
            myElement.classList.add("extra");
            myElement.innerHTML = (_c = (_b = item.value) === null || _b === void 0 ? void 0 : _b.toString()) !== null && _c !== void 0 ? _c : "";
            activeWord.appendChild(myElement);
        }
        myElement = activeWord.children[curPos];
        myElement.classList.add("incorrect");
        curPos++;
    }
    else if (item.action === "setLetterIndex" &&
        typeof item.value === "number") {
        if (!nosound)
            playSound();
        curPos = item.value;
        // remove all letters from cursor to end of word
        for (const myElement of [...activeWord.children].slice(curPos)) {
            if (myElement.classList.contains("extra")) {
                myElement.remove();
            }
            else {
                myElement.className = "";
            }
        }
    }
    else if (item.action === "submitCorrectWord") {
        if (!nosound)
            playSound();
        wordPos++;
        curPos = 0;
    }
    else if (item.action === "submitErrorWord") {
        if (!nosound)
            playSound(true);
        activeWord.classList.add("error");
        wordPos++;
        curPos = 0;
    }
    else if (item.action === "backWord") {
        if (!nosound)
            playSound();
        wordPos--;
        const replayWords = document.getElementById("replayWords");
        if (replayWords !== null)
            activeWord = replayWords.children[wordPos];
        curPos = activeWord.children.length;
        while (activeWord.children[curPos - 1].className === "")
            curPos--;
        activeWord.classList.remove("error");
    }
}
function loadOldReplay() {
    let startingIndex = 0;
    curPos = 0;
    wordPos = 0;
    replayData.forEach((item, i) => {
        if (wordPos < targetWordPos ||
            (wordPos === targetWordPos && curPos < targetCurPos)) {
            //quickly display everything up to the target
            handleDisplayLogic(item, true);
            startingIndex = i + 1;
        }
    });
    const time = Math.floor(replayData[startingIndex].time / 1000);
    $("#replayStopwatch").text(time + "s");
    return startingIndex;
}
function toggleReplayDisplay() {
    var _a;
    if ($("#resultReplay").stop(true, true).hasClass("hidden")) {
        initializeReplayPrompt();
        loadOldReplay();
        //show
        if (!$("#watchReplayButton").hasClass("loaded")) {
            $("#words").html(`<div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>`);
            $("#resultReplay")
                .removeClass("hidden")
                .css("display", "none")
                .slideDown(250);
        }
        else {
            $("#resultReplay")
                .removeClass("hidden")
                .css("display", "none")
                .slideDown(250);
        }
    }
    else {
        //hide
        if (((_a = toggleButton === null || toggleButton === void 0 ? void 0 : toggleButton.parentNode) === null || _a === void 0 ? void 0 : _a.getAttribute("aria-label")) !=
            "Start replay") {
            pauseReplay();
        }
        $("#resultReplay").slideUp(250, () => {
            $("#resultReplay").addClass("hidden");
        });
    }
}
function startReplayRecording() {
    if (!$("#resultReplay").stop(true, true).hasClass("hidden")) {
        //hide replay display if user left it open
        toggleReplayDisplay();
    }
    $("#replayStopwatch").text(0 + "s");
    replayData = [];
    replayStartTime = performance.now();
    replayRecording = true;
    targetCurPos = 0;
    targetWordPos = 0;
}
exports.startReplayRecording = startReplayRecording;
function stopReplayRecording() {
    replayRecording = false;
}
exports.stopReplayRecording = stopReplayRecording;
function addReplayEvent(action, value) {
    if (!replayRecording) {
        return;
    }
    const timeDelta = performance.now() - replayStartTime;
    replayData.push({ action: action, value: value, time: timeDelta });
}
exports.addReplayEvent = addReplayEvent;
function playReplay() {
    var _a;
    curPos = 0;
    wordPos = 0;
    if (toggleButton === undefined)
        return;
    toggleButton.className = "fas fa-pause";
    (_a = toggleButton.parentNode) === null || _a === void 0 ? void 0 : _a.setAttribute("aria-label", "Pause replay");
    initializeReplayPrompt();
    const startingIndex = loadOldReplay();
    const lastTime = replayData[startingIndex].time;
    let swTime = Math.round(lastTime / 1000); //starting time
    const swEndTime = Math.round(replayData[replayData.length - 1].time / 1000);
    while (swTime <= swEndTime) {
        const time = swTime;
        stopwatchList.push(setTimeout(() => {
            $("#replayStopwatch").text(time + "s");
        }, time * 1000 - lastTime));
        swTime++;
    }
    replayData.forEach((item, i) => {
        if (i < startingIndex)
            return;
        timeoutList.push(setTimeout(() => {
            handleDisplayLogic(item);
        }, item.time - lastTime));
    });
    timeoutList.push(setTimeout(() => {
        //after the replay has finished, this will run
        targetCurPos = 0;
        targetWordPos = 0;
        toggleButton.className = "fas fa-play";
        toggleButton.parentNode.setAttribute("aria-label", "Start replay");
    }, replayData[replayData.length - 1].time - lastTime));
}
function getReplayExport() {
    return JSON.stringify({
        replayData: replayData,
        wordsList: wordsList,
    });
}
exports.getReplayExport = getReplayExport;
$(".pageTest #playpauseReplayButton").on("click", () => {
    if ((toggleButton === null || toggleButton === void 0 ? void 0 : toggleButton.className) === "fas fa-play") {
        playReplay();
    }
    else if ((toggleButton === null || toggleButton === void 0 ? void 0 : toggleButton.className) === "fas fa-pause") {
        pauseReplay();
    }
});
$("#replayWords").on("click", "letter", (event) => {
    var _a;
    //allows user to click on the place they want to start their replay at
    pauseReplay();
    const replayWords = document.querySelector("#replayWords");
    const words = [...((_a = replayWords === null || replayWords === void 0 ? void 0 : replayWords.children) !== null && _a !== void 0 ? _a : [])];
    targetWordPos = words.indexOf(event.target.parentNode);
    const letters = [...words[targetWordPos].children];
    targetCurPos = letters.indexOf(event.target);
    initializeReplayPrompt();
    loadOldReplay();
});
$(document).on("keypress", "#watchReplayButton", (event) => {
    if (event.key === "Enter") {
        toggleReplayDisplay();
    }
});
$(document.body).on("click", "#watchReplayButton", () => {
    toggleReplayDisplay();
});


/***/ }),

/***/ "./src/scripts/test/result.ts":
/*!************************************!*\
  !*** ./src/scripts/test/result.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = exports.updateRateQuote = exports.updateCrown = exports.hideCrown = exports.showCrown = exports.updateTodayTracker = exports.updateGraphPBLine = exports.toggleUnsmoothedRaw = void 0;
const TestUI = __importStar(__webpack_require__(/*! ./test-ui */ "./src/scripts/test/test-ui.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const TestStats = __importStar(__webpack_require__(/*! ./test-stats */ "./src/scripts/test/test-stats.ts"));
const Keymap = __importStar(__webpack_require__(/*! ../elements/keymap */ "./src/scripts/elements/keymap.ts"));
const ChartController = __importStar(__webpack_require__(/*! ../controllers/chart-controller */ "./src/scripts/controllers/chart-controller.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const TodayTracker = __importStar(__webpack_require__(/*! ./today-tracker */ "./src/scripts/test/today-tracker.ts"));
const PbCrown = __importStar(__webpack_require__(/*! ./pb-crown */ "./src/scripts/test/pb-crown.ts"));
const QuoteRatePopup = __importStar(__webpack_require__(/*! ../popups/quote-rate-popup */ "./src/scripts/popups/quote-rate-popup.ts"));
const GlarsesMode = __importStar(__webpack_require__(/*! ../states/glarses-mode */ "./src/scripts/states/glarses-mode.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const ResultsShownEvent = __importStar(__webpack_require__(/*! ../observables/results-shown-event */ "./src/scripts/observables/results-shown-event.ts"));
const chart_js_1 = __webpack_require__(/*! chart.js */ "./node_modules/chart.js/dist/chart.esm.js");
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
let result;
let maxChartVal;
let useUnsmoothedRaw = false;
function toggleUnsmoothedRaw() {
    useUnsmoothedRaw = !useUnsmoothedRaw;
    Notifications.add(useUnsmoothedRaw ? "on" : "off", 1);
}
exports.toggleUnsmoothedRaw = toggleUnsmoothedRaw;
let resultAnnotation = [];
let resultScaleOptions = ChartController.result.options.scales;
function updateGraph() {
    var _a, _b;
    return __awaiter(this, void 0, void 0, function* () {
        const labels = [];
        for (let i = 1; i <= TestInput.wpmHistory.length; i++) {
            if (TestStats.lastSecondNotRound && i === TestInput.wpmHistory.length) {
                labels.push(Misc.roundTo2(result.testDuration).toString());
            }
            else {
                labels.push(i.toString());
            }
        }
        ChartController.result.data.labels = labels;
        resultScaleOptions["wpm"].title.text = config_1.default.alwaysShowCPM
            ? "Character per Minute"
            : "Words per Minute";
        const chartData1 = config_1.default.alwaysShowCPM
            ? TestInput.wpmHistory.map((a) => a * 5)
            : TestInput.wpmHistory;
        let chartData2;
        if (result.chartData === "toolong")
            return;
        if (useUnsmoothedRaw) {
            chartData2 =
                (_b = (config_1.default.alwaysShowCPM
                    ? (_a = result.chartData.unsmoothedRaw) === null || _a === void 0 ? void 0 : _a.map((a) => a * 5)
                    : result.chartData.unsmoothedRaw)) !== null && _b !== void 0 ? _b : [];
        }
        else {
            chartData2 = config_1.default.alwaysShowCPM
                ? result.chartData.raw.map((a) => a * 5)
                : result.chartData.raw;
        }
        ChartController.result.data.datasets[0].data = chartData1;
        ChartController.result.data.datasets[1].data = chartData2;
        ChartController.result.data.datasets[0].label = config_1.default.alwaysShowCPM
            ? "cpm"
            : "wpm";
        maxChartVal = Math.max(...[Math.max(...chartData2), Math.max(...chartData1)]);
        if (!config_1.default.startGraphsAtZero) {
            const minChartVal = Math.min(...[Math.min(...chartData2), Math.min(...chartData1)]);
            resultScaleOptions["wpm"].min = minChartVal;
            resultScaleOptions["raw"].min = minChartVal;
        }
        else {
            resultScaleOptions["wpm"].min = 0;
            resultScaleOptions["raw"].min = 0;
        }
        ChartController.result.data.datasets[2].data = result.chartData.err;
        const fc = yield ThemeColors.get("sub");
        if (config_1.default.funbox !== "none") {
            let content = config_1.default.funbox;
            if (config_1.default.funbox === "layoutfluid") {
                content += " " + config_1.default.customLayoutfluid.replace(/#/g, " ");
            }
            resultAnnotation.push({
                display: true,
                id: "funbox-label",
                type: "line",
                scaleID: "wpm",
                value: resultScaleOptions["wpm"].min,
                borderColor: "transparent",
                borderWidth: 1,
                borderDash: [2, 2],
                label: {
                    backgroundColor: "transparent",
                    font: {
                        family: config_1.default.fontFamily.replace(/_/g, " "),
                        size: 11,
                        style: "normal",
                        weight: chart_js_1.Chart.defaults.font.weight,
                        lineHeight: chart_js_1.Chart.defaults.font.lineHeight,
                    },
                    color: fc,
                    padding: 3,
                    borderRadius: 3,
                    position: "start",
                    enabled: true,
                    content: `${content}`,
                },
            });
        }
        resultScaleOptions["wpm"].max = maxChartVal;
        resultScaleOptions["raw"].max = maxChartVal;
        resultScaleOptions["error"].max = Math.max(...result.chartData.err) + 1;
    });
}
function updateGraphPBLine() {
    var _a, _b, _c;
    return __awaiter(this, void 0, void 0, function* () {
        const themecolors = yield ThemeColors.getAll();
        const lpb = yield DB.getLocalPB(result.mode, result.mode2, (_a = result.punctuation) !== null && _a !== void 0 ? _a : false, result.language, result.difficulty, (_b = result.lazyMode) !== null && _b !== void 0 ? _b : false, (_c = result.funbox) !== null && _c !== void 0 ? _c : "none");
        if (lpb == 0)
            return;
        const chartlpb = Misc.roundTo2(config_1.default.alwaysShowCPM ? lpb * 5 : lpb).toFixed(2);
        resultAnnotation.push({
            display: true,
            type: "line",
            id: "lpb",
            scaleID: "wpm",
            value: chartlpb,
            borderColor: themecolors["sub"],
            borderWidth: 1,
            borderDash: [2, 2],
            label: {
                backgroundColor: themecolors["sub"],
                font: {
                    family: config_1.default.fontFamily.replace(/_/g, " "),
                    size: 11,
                    style: "normal",
                    weight: chart_js_1.Chart.defaults.font.weight,
                    lineHeight: chart_js_1.Chart.defaults.font.lineHeight,
                },
                color: themecolors["bg"],
                padding: 3,
                borderRadius: 3,
                position: "center",
                enabled: true,
                content: `PB: ${chartlpb}`,
            },
        });
        if (maxChartVal >= parseFloat(chartlpb) - 20 &&
            maxChartVal <= parseFloat(chartlpb) + 20) {
            maxChartVal = parseFloat(chartlpb) + 15;
        }
        resultScaleOptions["wpm"].max = Math.round(maxChartVal + 5);
        resultScaleOptions["raw"].max = Math.round(maxChartVal + 5);
    });
}
exports.updateGraphPBLine = updateGraphPBLine;
function updateWpmAndAcc() {
    let inf = false;
    if (result.wpm >= 1000) {
        inf = true;
    }
    if (config_1.default.alwaysShowDecimalPlaces) {
        if (config_1.default.alwaysShowCPM == false) {
            $("#result .stats .wpm .top .text").text("wpm");
            if (inf) {
                $("#result .stats .wpm .bottom").text("Infinite");
            }
            else {
                $("#result .stats .wpm .bottom").text(Misc.roundTo2(result.wpm).toFixed(2));
            }
            $("#result .stats .raw .bottom").text(Misc.roundTo2(result.rawWpm).toFixed(2));
            $("#result .stats .wpm .bottom").attr("aria-label", Misc.roundTo2(result.wpm * 5).toFixed(2) + " cpm");
        }
        else {
            $("#result .stats .wpm .top .text").text("cpm");
            if (inf) {
                $("#result .stats .wpm .bottom").text("Infinite");
            }
            else {
                $("#result .stats .wpm .bottom").text(Misc.roundTo2(result.wpm * 5).toFixed(2));
            }
            $("#result .stats .raw .bottom").text(Misc.roundTo2(result.rawWpm * 5).toFixed(2));
            $("#result .stats .wpm .bottom").attr("aria-label", Misc.roundTo2(result.wpm).toFixed(2) + " wpm");
        }
        $("#result .stats .acc .bottom").text(result.acc == 100 ? "100%" : Misc.roundTo2(result.acc).toFixed(2) + "%");
        let time = Misc.roundTo2(result.testDuration).toFixed(2) + "s";
        if (result.testDuration > 61) {
            time = Misc.secondsToString(Misc.roundTo2(result.testDuration));
        }
        $("#result .stats .time .bottom .text").text(time);
        $("#result .stats .raw .bottom").removeAttr("aria-label");
        $("#result .stats .acc .bottom").removeAttr("aria-label");
    }
    else {
        //not showing decimal places
        if (config_1.default.alwaysShowCPM == false) {
            $("#result .stats .wpm .top .text").text("wpm");
            $("#result .stats .wpm .bottom").attr("aria-label", result.wpm + ` (${Misc.roundTo2(result.wpm * 5)} cpm)`);
            if (inf) {
                $("#result .stats .wpm .bottom").text("Infinite");
            }
            else {
                $("#result .stats .wpm .bottom").text(Math.round(result.wpm));
            }
            $("#result .stats .raw .bottom").text(Math.round(result.rawWpm));
            $("#result .stats .raw .bottom").attr("aria-label", result.rawWpm);
        }
        else {
            $("#result .stats .wpm .top .text").text("cpm");
            $("#result .stats .wpm .bottom").attr("aria-label", Misc.roundTo2(result.wpm * 5) + ` (${Misc.roundTo2(result.wpm)} wpm)`);
            if (inf) {
                $("#result .stats .wpm .bottom").text("Infinite");
            }
            else {
                $("#result .stats .wpm .bottom").text(Math.round(result.wpm * 5));
            }
            $("#result .stats .raw .bottom").text(Math.round(result.rawWpm * 5));
            $("#result .stats .raw .bottom").attr("aria-label", result.rawWpm * 5);
        }
        $("#result .stats .acc .bottom").text(Math.floor(result.acc) + "%");
        $("#result .stats .acc .bottom").attr("aria-label", result.acc + "%");
    }
}
function updateConsistency() {
    if (config_1.default.alwaysShowDecimalPlaces) {
        $("#result .stats .consistency .bottom").text(Misc.roundTo2(result.consistency).toFixed(2) + "%");
        $("#result .stats .consistency .bottom").attr("aria-label", `${result.keyConsistency.toFixed(2)}% key`);
    }
    else {
        $("#result .stats .consistency .bottom").text(Math.round(result.consistency) + "%");
        $("#result .stats .consistency .bottom").attr("aria-label", `${result.consistency}% (${result.keyConsistency}% key)`);
    }
}
function updateTime() {
    const afkSecondsPercent = Misc.roundTo2((result.afkDuration / result.testDuration) * 100);
    $("#result .stats .time .bottom .afk").text("");
    if (afkSecondsPercent > 0) {
        $("#result .stats .time .bottom .afk").text(afkSecondsPercent + "% afk");
    }
    $("#result .stats .time .bottom").attr("aria-label", `${result.afkDuration}s afk ${afkSecondsPercent}%`);
    if (config_1.default.alwaysShowDecimalPlaces) {
        let time = Misc.roundTo2(result.testDuration).toFixed(2) + "s";
        if (result.testDuration > 61) {
            time = Misc.secondsToString(Misc.roundTo2(result.testDuration));
        }
        $("#result .stats .time .bottom .text").text(time);
    }
    else {
        let time = Math.round(result.testDuration) + "s";
        if (result.testDuration > 61) {
            time = Misc.secondsToString(Math.round(result.testDuration));
        }
        $("#result .stats .time .bottom .text").text(time);
        $("#result .stats .time .bottom").attr("aria-label", `${Misc.roundTo2(result.testDuration)}s (${result.afkDuration}s afk ${afkSecondsPercent}%)`);
    }
}
function updateTodayTracker() {
    $("#result .stats .time .bottom .timeToday").text(TodayTracker.getString());
}
exports.updateTodayTracker = updateTodayTracker;
function updateKey() {
    $("#result .stats .key .bottom").text(result.charStats[0] +
        "/" +
        result.charStats[1] +
        "/" +
        result.charStats[2] +
        "/" +
        result.charStats[3]);
}
function showCrown() {
    PbCrown.show();
}
exports.showCrown = showCrown;
function hideCrown() {
    PbCrown.hide();
    $("#result .stats .wpm .crown").attr("aria-label", "");
}
exports.hideCrown = hideCrown;
function updateCrown() {
    return __awaiter(this, void 0, void 0, function* () {
        let pbDiff = 0;
        const lpb = yield DB.getLocalPB(config_1.default.mode, result.mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode, config_1.default.funbox);
        pbDiff = Math.abs(result.wpm - lpb);
        $("#result .stats .wpm .crown").attr("aria-label", "+" + Misc.roundTo2(pbDiff));
    });
}
exports.updateCrown = updateCrown;
function updateTags(dontSave) {
    var _a;
    const activeTags = [];
    try {
        (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
            if (tag.active === true) {
                activeTags.push(tag);
            }
        });
    }
    catch (e) { }
    $("#result .stats .tags").addClass("hidden");
    if (activeTags.length == 0) {
        $("#result .stats .tags").addClass("hidden");
    }
    else {
        $("#result .stats .tags").removeClass("hidden");
    }
    $("#result .stats .tags .bottom").text("");
    let annotationSide = "start";
    let labelAdjust = 15;
    activeTags.forEach((tag) => __awaiter(this, void 0, void 0, function* () {
        const tpb = yield DB.getLocalTagPB(tag._id, config_1.default.mode, result.mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode);
        $("#result .stats .tags .bottom").append(`
      <div tagid="${tag._id}" aria-label="PB: ${tpb}" data-balloon-pos="up">${tag.name}<i class="fas fa-crown hidden"></i></div>
    `);
        if (config_1.default.mode != "quote" && !dontSave) {
            if (tpb < result.wpm) {
                //new pb for that tag
                DB.saveLocalTagPB(tag._id, config_1.default.mode, result.mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode, result.wpm, result.acc, result.rawWpm, result.consistency);
                $(`#result .stats .tags .bottom div[tagid="${tag._id}"] .fas`).removeClass("hidden");
                $(`#result .stats .tags .bottom div[tagid="${tag._id}"]`).attr("aria-label", "+" + Misc.roundTo2(result.wpm - tpb));
                // console.log("new pb for tag " + tag.name);
            }
            else {
                const themecolors = yield ThemeColors.getAll();
                resultAnnotation.push({
                    display: true,
                    type: "line",
                    id: "tpb",
                    scaleID: "wpm",
                    value: config_1.default.alwaysShowCPM ? tpb * 5 : tpb,
                    borderColor: themecolors["sub"],
                    borderWidth: 1,
                    borderDash: [2, 2],
                    label: {
                        backgroundColor: themecolors["sub"],
                        font: {
                            family: config_1.default.fontFamily.replace(/_/g, " "),
                            size: 11,
                            style: "normal",
                            weight: chart_js_1.Chart.defaults.font.weight,
                            lineHeight: chart_js_1.Chart.defaults.font.lineHeight,
                        },
                        color: themecolors["bg"],
                        padding: 3,
                        borderRadius: 3,
                        position: annotationSide,
                        xAdjust: labelAdjust,
                        enabled: true,
                        content: `${tag.name} PB: ${Misc.roundTo2(config_1.default.alwaysShowCPM ? tpb * 5 : tpb).toFixed(2)}`,
                    },
                });
                if (annotationSide === "start") {
                    annotationSide = "end";
                    labelAdjust = -15;
                }
                else {
                    annotationSide = "start";
                    labelAdjust = 15;
                }
            }
        }
    }));
}
function updateTestType(randomQuote) {
    let testType = "";
    testType += config_1.default.mode;
    if (config_1.default.mode === "time") {
        testType += " " + config_1.default.time;
    }
    else if (config_1.default.mode === "words") {
        testType += " " + config_1.default.words;
    }
    else if (config_1.default.mode === "quote") {
        if (randomQuote.group !== undefined) {
            testType += " " + ["short", "medium", "long", "thicc"][randomQuote.group];
        }
    }
    if (config_1.default.mode != "custom" &&
        config_1.default.funbox !== "gibberish" &&
        config_1.default.funbox !== "ascii" &&
        config_1.default.funbox !== "58008") {
        testType += "<br>" + result.language.replace(/_/g, " ");
    }
    if (config_1.default.punctuation) {
        testType += "<br>punctuation";
    }
    if (config_1.default.numbers) {
        testType += "<br>numbers";
    }
    if (config_1.default.blindMode) {
        testType += "<br>blind";
    }
    if (config_1.default.lazyMode) {
        testType += "<br>lazy";
    }
    if (config_1.default.funbox !== "none") {
        testType += "<br>" + config_1.default.funbox.replace(/_/g, " ");
    }
    if (config_1.default.difficulty == "expert") {
        testType += "<br>expert";
    }
    else if (config_1.default.difficulty == "master") {
        testType += "<br>master";
    }
    $("#result .stats .testType .bottom").html(testType);
}
function updateOther(difficultyFailed, failReason, afkDetected, isRepeated, tooShort) {
    let otherText = "";
    if (difficultyFailed) {
        otherText += `<br>failed (${failReason})`;
    }
    if (afkDetected) {
        otherText += "<br>afk detected";
    }
    if (TestStats.invalid) {
        otherText += "<br>invalid";
        let extra = "";
        if (result.wpm < 0 || result.wpm > 350) {
            extra += "wpm";
        }
        if (result.acc < 75 || result.acc > 100) {
            if (extra.length > 0) {
                extra += ", ";
            }
            extra += "accuracy";
        }
        if (extra.length > 0) {
            otherText += ` (${extra})`;
        }
    }
    if (isRepeated) {
        otherText += "<br>repeated";
    }
    if (result.bailedOut) {
        otherText += "<br>bailed out";
    }
    if (tooShort) {
        otherText += "<br>too short";
    }
    if (otherText == "") {
        $("#result .stats .info").addClass("hidden");
    }
    else {
        $("#result .stats .info").removeClass("hidden");
        otherText = otherText.substring(4);
        $("#result .stats .info .bottom").html(otherText);
    }
}
function updateRateQuote(randomQuote) {
    var _a, _b;
    if (config_1.default.mode === "quote") {
        const userqr = (_b = (_a = DB.getSnapshot().quoteRatings) === null || _a === void 0 ? void 0 : _a[randomQuote.language]) === null || _b === void 0 ? void 0 : _b[randomQuote.id];
        if (userqr) {
            $(".pageTest #result #rateQuoteButton .icon")
                .removeClass("far")
                .addClass("fas");
        }
        QuoteRatePopup.getQuoteStats(randomQuote).then((quoteStats) => {
            var _a, _b;
            $(".pageTest #result #rateQuoteButton .rating").text((_b = (_a = quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.average) === null || _a === void 0 ? void 0 : _a.toFixed(1)) !== null && _b !== void 0 ? _b : "");
            $(".pageTest #result #rateQuoteButton")
                .css({ opacity: 0 })
                .removeClass("hidden")
                .css({ opacity: 1 });
        });
    }
}
exports.updateRateQuote = updateRateQuote;
function updateQuoteSource(randomQuote) {
    if (config_1.default.mode === "quote") {
        $("#result .stats .source").removeClass("hidden");
        $("#result .stats .source .bottom").html(randomQuote.source);
    }
    else {
        $("#result .stats .source").addClass("hidden");
    }
}
function update(res, difficultyFailed, failReason, afkDetected, isRepeated, tooShort, randomQuote, dontSave) {
    return __awaiter(this, void 0, void 0, function* () {
        resultScaleOptions = ChartController.result.options.scales;
        resultAnnotation = [];
        result = res;
        $("#result #resultWordsHistory").addClass("hidden");
        $("#retrySavingResultButton").addClass("hidden");
        $(".pageTest #result #rateQuoteButton .icon")
            .removeClass("fas")
            .addClass("far");
        $(".pageTest #result #rateQuoteButton .rating").text("");
        $(".pageTest #result #rateQuoteButton").addClass("hidden");
        $("#testModesNotice").css("opacity", 0);
        $("#words").removeClass("blurred");
        $("#wordsInput").blur();
        $("#result .stats .time .bottom .afk").text("");
        if (firebase_1.Auth.currentUser != null) {
            $("#result .loginTip").addClass("hidden");
        }
        else {
            $("#result .loginTip").removeClass("hidden");
        }
        updateWpmAndAcc();
        updateConsistency();
        updateTime();
        updateKey();
        updateTestType(randomQuote);
        updateQuoteSource(randomQuote);
        yield updateGraph();
        yield updateGraphPBLine();
        updateTags(dontSave);
        updateOther(difficultyFailed, failReason, afkDetected, isRepeated, tooShort);
        ChartController.result.options
            .plugins.annotation.annotations =
            resultAnnotation;
        ChartController.result.updateColors();
        ChartController.result.resize();
        if ($("#result .stats .tags").hasClass("hidden") &&
            $("#result .stats .info").hasClass("hidden")) {
            $("#result .stats .infoAndTags").addClass("hidden");
        }
        else {
            $("#result .stats .infoAndTags").removeClass("hidden");
        }
        if (GlarsesMode.get()) {
            $("#middle #result .noStressMessage").remove();
            $("#middle #result").prepend(`

      <div class='noStressMessage' style="
        text-align: center;
        grid-column: 1/3;
        font-size: 2rem;
        padding-bottom: 2rem;
      ">
      <i class="fas fa-check"></i>
      </div>

    `);
            $("#middle #result .stats").addClass("hidden");
            $("#middle #result .chart").addClass("hidden");
            $("#middle #result #resultWordsHistory").addClass("hidden");
            $("#middle #result #resultReplay").addClass("hidden");
            $("#middle #result .loginTip").addClass("hidden");
            $("#middle #result #showWordHistoryButton").addClass("hidden");
            $("#middle #result #watchReplayButton").addClass("hidden");
            $("#middle #result #saveScreenshotButton").addClass("hidden");
            console.log(`Test Completed: ${result.wpm} wpm ${result.acc}% acc ${result.rawWpm} raw ${result.consistency}% consistency`);
        }
        else {
            $("#middle #result .stats").removeClass("hidden");
            $("#middle #result .chart").removeClass("hidden");
            // $("#middle #result #resultWordsHistory").removeClass("hidden");
            if (firebase_1.Auth.currentUser == null) {
                $("#middle #result .loginTip").removeClass("hidden");
            }
            $("#middle #result #showWordHistoryButton").removeClass("hidden");
            $("#middle #result #watchReplayButton").removeClass("hidden");
            $("#middle #result #saveScreenshotButton").removeClass("hidden");
        }
        if (window.scrollY > 0) {
            $([document.documentElement, document.body])
                .stop()
                .animate({ scrollTop: 0 }, 250);
        }
        Misc.swapElements($("#typingTest"), $("#result"), 250, () => {
            TestUI.setResultCalculating(false);
            $("#words").empty();
            ChartController.result.resize();
            if (config_1.default.alwaysShowWordsHistory && config_1.default.burstHeatmap) {
                TestUI.applyBurstHeatmap();
            }
            $("#result").trigger("focus");
            window.scrollTo({ top: 0 });
            $("#testModesNotice").addClass("hidden");
        }, () => {
            $("#resultExtraButtons").removeClass("hidden").css("opacity", 0).animate({
                opacity: 1,
            }, 125);
            if (config_1.default.alwaysShowWordsHistory && !GlarsesMode.get()) {
                TestUI.toggleResultWords();
            }
            Keymap.hide();
        });
        ResultsShownEvent.dispatch({
            res,
            difficultyFailed,
            failReason,
            afkDetected,
            isRepeated,
            tooShort,
            randomQuote,
            dontSave,
        });
    });
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/test/shift-tracker.ts":
/*!*******************************************!*\
  !*** ./src/scripts/test/shift-tracker.ts ***!
  \*******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.isUsingOppositeShift = exports.reset = exports.rightState = exports.leftState = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const caps_warning_1 = __webpack_require__(/*! ./caps-warning */ "./src/scripts/test/caps-warning.ts");
exports.leftState = false;
exports.rightState = false;
let caseState = false;
const keymapStrings = {
    left: null,
    right: null,
    keymap: null,
};
function dynamicKeymapLegendStyle(uppercase) {
    const keymapKeys = [
        ...document.getElementsByClassName("keymap-key"),
    ];
    const layoutKeys = keymapKeys.map((el) => el.dataset["key"]);
    const keys = keymapKeys.map((el) => el.childNodes[1]);
    if (caps_warning_1.capsState)
        uppercase = !uppercase;
    if (layoutKeys.filter((v) => v === undefined).length > 2)
        return;
    if ((uppercase && caseState) || (!uppercase && !caseState))
        return;
    caseState = uppercase;
    const index = caseState ? 1 : 0;
    for (let i = 0; i < layoutKeys.length; i++) {
        const layoutKey = layoutKeys[i], key = keys[i];
        if (key === undefined || layoutKey === undefined)
            continue;
        key.textContent = layoutKey[index];
    }
}
function buildKeymapStrings() {
    return __awaiter(this, void 0, void 0, function* () {
        if (keymapStrings.keymap === config_1.default.keymapLayout)
            return;
        const layout = yield Misc.getLayout(config_1.default.keymapLayout);
        if (layout === undefined)
            return;
        const layoutKeys = layout.keys;
        const layoutKeysEntries = Object.entries(layoutKeys);
        keymapStrings.keymap = config_1.default.keymapLayout;
        if (!layout) {
            keymapStrings.left = null;
            keymapStrings.right = null;
        }
        else {
            keymapStrings.left = layoutKeysEntries
                .map(([rowName, row]) => row
                // includes "6" and "y" (buttons on qwerty) into the left hand
                .slice(0, ["row1", "row2"].includes(rowName)
                ? rowName === "row1"
                    ? 7
                    : 6
                : 5)
                .map((key) => key.split("")))
                .flat(2);
            keymapStrings.right = layoutKeysEntries
                .map(([rowName, row]) => row
                // includes "b" (buttons on qwerty) into the right hand
                .slice(["row1", "row4"].includes(rowName)
                ? rowName === "row1"
                    ? 6
                    : 4
                : 5)
                .map((key) => key.split("")))
                .flat(2);
        }
    });
}
$(document).on("keydown", (e) => {
    if (e.code === "ShiftLeft") {
        exports.leftState = true;
        exports.rightState = false;
    }
    else if (e.code === "ShiftRight") {
        exports.leftState = false;
        exports.rightState = true;
    }
    if (config_1.default.keymapLegendStyle === "dynamic") {
        dynamicKeymapLegendStyle(exports.leftState || exports.rightState);
    }
});
$(document).keyup((e) => {
    if (e.code === "ShiftLeft" || e.code === "ShiftRight") {
        exports.leftState = false;
        exports.rightState = false;
    }
    if (config_1.default.keymapLegendStyle === "dynamic") {
        dynamicKeymapLegendStyle(exports.leftState || exports.rightState);
    }
});
function reset() {
    exports.leftState = false;
    exports.rightState = false;
}
exports.reset = reset;
const leftSideKeys = [
    "KeyQ",
    "KeyW",
    "KeyE",
    "KeyR",
    "KeyT",
    "KeyA",
    "KeyS",
    "KeyD",
    "KeyF",
    "KeyG",
    "KeyZ",
    "KeyX",
    "KeyC",
    "KeyV",
    "Backquote",
    "Digit1",
    "Digit2",
    "Digit3",
    "Digit4",
    "Digit5",
];
const rightSideKeys = [
    "KeyU",
    "KeyI",
    "KeyO",
    "KeyP",
    "KeyH",
    "KeyJ",
    "KeyK",
    "KeyL",
    "KeyN",
    "KeyM",
    "Digit7",
    "Digit8",
    "Digit9",
    "Digit0",
    "Backslash",
    "BracketLeft",
    "BracketRight",
    "Semicolon",
    "Quote",
    "Comma",
    "Period",
    "Slash",
];
function isUsingOppositeShift(event) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!exports.leftState && !exports.rightState)
            return null;
        if (config_1.default.oppositeShiftMode === "on") {
            if (!rightSideKeys.includes(event.code) &&
                !leftSideKeys.includes(event.code)) {
                return null;
            }
            if ((exports.leftState && rightSideKeys.includes(event.code)) ||
                (exports.rightState && leftSideKeys.includes(event.code))) {
                return true;
            }
            else {
                return false;
            }
        }
        else if (config_1.default.oppositeShiftMode === "keymap") {
            yield buildKeymapStrings();
            if (!keymapStrings.left || !keymapStrings.right)
                return null;
            if ((exports.leftState && keymapStrings.right.includes(event.key)) ||
                (exports.rightState && keymapStrings.left.includes(event.key))) {
                return true;
            }
            else {
                return false;
            }
        }
        return true;
    });
}
exports.isUsingOppositeShift = isUsingOppositeShift;


/***/ }),

/***/ "./src/scripts/test/tbd-mode.ts":
/*!**************************************!*\
  !*** ./src/scripts/test/tbd-mode.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getTbdMode = void 0;
const wordset_1 = __webpack_require__(/*! ./wordset */ "./src/scripts/test/wordset.ts");
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const PageChangeEvent = __importStar(__webpack_require__(/*! ../observables/page-change-event */ "./src/scripts/observables/page-change-event.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ConfigStuff = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ResultsShownEvent = __importStar(__webpack_require__(/*! ../observables/results-shown-event */ "./src/scripts/observables/results-shown-event.ts"));
const WordTypedEvent = __importStar(__webpack_require__(/*! ../observables/word-typed-event */ "./src/scripts/observables/word-typed-event.ts"));
const ResetRequestedEvent = __importStar(__webpack_require__(/*! ../observables/reset-requested-event */ "./src/scripts/observables/reset-requested-event.ts"));
const debounce_1 = __webpack_require__(/*! ../utils/debounce */ "./src/scripts/utils/debounce.ts");
class TbdConfig {
    init() {
        TbdEvents.addSubscriber("sorterSelectChanged", (data) => {
            this.set("sorter", data["value"]);
        });
        TbdEvents.addSubscriber("configUpdateRequested", (data) => {
            switch (data["configSetting"]) {
                case "targetSpeed":
                    this.processTargetSpeedUpdateRequest();
                    break;
                case "groupSize":
                    this.processGroupSizeUpdateRequest();
                    break;
                case "animations":
                    this.processAnimationToggleRequest();
                    break;
                case "unbeatenWordPercentage":
                    this.processUnbeatenWordPercentageRequest();
                    break;
            }
        });
    }
    get(key, defaultValue = "") {
        const configData = TbdData.getAll().config;
        return configData[key] || defaultValue;
    }
    set(key, value) {
        const original = this.get(key);
        if (original == value) {
            return;
        }
        const data = TbdData.getAll();
        data.config[key] = value;
        TbdData.updateData(data);
        TbdEvents.dispatchEvent(`${key}-changed`, {
            original: original,
            newValue: value,
        });
    }
    bumpTargetSpeed() {
        const current = this.getTargetSpeed();
        this.set("targetSpeed", (current + 5).toString());
    }
    getSorterName() {
        return this.get("sorter", "alphabetical-asc");
    }
    getSorter() {
        return TbdSorting.getSorter(this.getSorterName());
    }
    getTargetSpeed() {
        return parseInt(this.get("targetSpeed", "75"));
    }
    getGroupSize() {
        return parseInt(this.get("groupSize", "30"));
    }
    getUnbeatenWordPercentage() {
        return parseInt(this.get("unbeatenWordPercentage", "60"));
    }
    processTargetSpeedUpdateRequest() {
        const newSpeed = parseInt(prompt("New target speed", this.getTargetSpeed().toString()) || "");
        if (newSpeed > 0) {
            this.set("targetSpeed", newSpeed.toString());
        }
    }
    processAnimationToggleRequest() {
        const enabled = confirm("Confirm to enable, cancel to disable.");
        if (enabled) {
            this.set("animationsEnabled", "1");
        }
        else {
            this.set("animationsEnabled", "0");
        }
    }
    areAnimationsEnabled() {
        return this.get("animationsEnabled", "1") == "1";
    }
    processGroupSizeUpdateRequest() {
        const newSize = parseInt(prompt("New group size", this.getGroupSize().toString()) || "");
        if (newSize > 0) {
            this.set("groupSize", newSize.toString());
        }
    }
    processUnbeatenWordPercentageRequest() {
        const newPercentage = parseInt(prompt(`The odds (still random) that a test word will be one that hasn't been typed faster than the current group threshold. 
        
        Must be between 10-90`, this.getUnbeatenWordPercentage().toString()) || "");
        if (isNaN(newPercentage)) {
            return;
        }
        if (newPercentage < 10 || newPercentage > 90) {
            alert(`${newPercentage} isn't a valid choice.`);
            return;
        }
        this.set("unbeatenWordPercentage", newPercentage.toString());
    }
}
class TbdSorting {
    static getSorter(name) {
        switch (name) {
            case "alphabetical-asc":
                return TbdSorting.alphabeticalAscendingSorter;
            case "alphabetical-desc":
                return TbdSorting.alphabeticalDescendingSorter;
            case "speed-asc":
                return TbdSorting.speedAscendingSorter;
            case "speed-desc":
                return TbdSorting.speedDescendingSorter;
            case "typedCount":
                return TbdSorting.typedCountSorter;
            case "missedCount":
                return TbdSorting.missedCountSorter;
        }
        return TbdSorting.alphabeticalAscendingSorter;
    }
    static randomSorter() {
        return Math.random() < 0.5 ? -1 : 1;
    }
    static alphabeticalDescendingSorter(word, word2) {
        return word.toLowerCase() < word2.toLowerCase() ? 1 : -1;
    }
    static alphabeticalAscendingSorter(word, word2) {
        return word.toLowerCase() < word2.toLowerCase() ? -1 : 1;
    }
    static speedAscendingSorter(word, word2) {
        const speed1 = TbdData.getMedianSpeedForWord(word);
        const speed2 = TbdData.getMedianSpeedForWord(word2);
        return speed1 - speed2;
    }
    static speedDescendingSorter(word, word2) {
        const speed1 = TbdData.getMedianSpeedForWord(word);
        const speed2 = TbdData.getMedianSpeedForWord(word2);
        return speed2 - speed1;
    }
    static typedCountSorter(word, word2) {
        const typed1 = TbdData.getSpeedsForWord(word).length;
        const typed2 = TbdData.getSpeedsForWord(word2).length;
        return typed2 - typed1;
    }
    static missedCountSorter(word, word2) {
        return (TbdData.getMistypedCountForWord(word2) -
            TbdData.getMistypedCountForWord(word));
    }
}
class TbdMode {
    constructor(config) {
        this.previousWord = "";
        this.config = config;
        this.monkeyTypeWordset = new wordset_1.Wordset([]);
        this.currentGroup = new TbdGroup(this.monkeyTypeWordset);
        this.groups = new TbdGroups();
    }
    init() {
        WordTypedEvent.subscribe(this.handleWordTyped.bind(this));
        ResultsShownEvent.subscribe(this.handleResultsShownEvent.bind(this));
        TbdEvents.addSubscriber("resetButtonClicked", this.resetCurrentWords.bind(this));
        TbdEvents.addSubscriber("wordClicked", this.resetWord.bind(this));
        TbdEvents.addSubscriber("targetSpeed-changed", () => {
            this.regenerateGroupsFromWordset(this.monkeyTypeWordset);
        });
        TbdEvents.addSubscriber("groupSize-changed", () => {
            this.regenerateGroupsFromWordset(this.monkeyTypeWordset);
        });
        TbdEvents.addSubscriber("wordsReset", () => {
            this.regenerateGroupsFromWordset(this.monkeyTypeWordset);
        });
        TbdEvents.addSubscriber("nextGroup", (data) => {
            this.currentGroup = data["group"];
        });
        TbdEvents.addSubscriber("groupsRegenerated", () => {
            ResetRequestedEvent.dispatch();
        });
        TbdEvents.addSubscriber("actionButtonClicked", (data) => {
            switch (data["actionValue"]) {
                case "resetCurrentWords":
                    this.handleResetCurrentWordsRequest();
                    break;
                case "resetAllWords":
                    this.handleResetAllWordsRequest();
                    break;
                case "copyAllData":
                    this.handleCopyDataRequest();
                    break;
                case "importData":
                    this.handleImportDataRequest();
                    break;
            }
        });
    }
    handleWordTyped(_word, isCorrect, burst, currentWordElement) {
        if (!isCorrect) {
            return;
        }
        const wordElement = currentWordElement;
        const typedAboveTarget = burst > this.getConfig().getTargetSpeed();
        if (typedAboveTarget) {
            TbdEvents.dispatchEvent("wordTypedCorrectly", { wordElement });
        }
        else {
            TbdEvents.dispatchEvent("wordMissed", { wordElement });
        }
    }
    handleResetCurrentWordsRequest() {
        if (confirm("Are you sure you want to reset data for the current wordset? This includes all" +
            " words in the language or custom word set you are using, not just the current group!")) {
            TbdData.resetDataForWords(this.monkeyTypeWordset.words);
        }
    }
    handleCopyDataRequest() {
        navigator.clipboard.writeText(JSON.stringify(TbdData.getAll())).then(() => {
            alert("JSON copied to your clipboard");
        }, () => {
            alert("There was a problem copying the data to your clipboard");
        });
    }
    handleImportDataRequest() {
        const exportJson = prompt("Enter the JSON you got from an export here") || "";
        if (exportJson == "") {
            return;
        }
        const parsed = JSON.parse(exportJson);
        if ("words" in parsed && "config" in parsed) {
            TbdData.updateData(parsed, true);
            location.reload();
        }
        else {
            alert("There was something wrong with your JSON, sorry!");
        }
    }
    getConfig() {
        return this.config;
    }
    getWord(originalWordset) {
        this.handleWordsetForNextWord(originalWordset);
        const group = this.getCurrentGroup();
        const random = Math.random() * 100;
        const unbeatenWordset = group.getUnbeatenWordset();
        const isThereMoreThanOneWord = group.getWordset().length > 1;
        let nextWord;
        if (unbeatenWordset.length > 0 &&
            random <= this.getConfig().getUnbeatenWordPercentage()) {
            nextWord = unbeatenWordset.randomWord();
        }
        else {
            nextWord = group.getWordset().randomWord();
        }
        if (this.previousWord == nextWord && isThereMoreThanOneWord) {
            return this.getWord(originalWordset);
        }
        this.previousWord = nextWord;
        return nextWord;
    }
    getCurrentGroup() {
        return this.currentGroup;
    }
    getFirstIncompleteGroup() {
        return this.groups.getFirstIncompleteGroup(this.config.getTargetSpeed());
    }
    recalculateCurrentGroup() {
        if (this.getCurrentGroup().getUnbeatenWordset().length > 0 &&
            this.getCurrentGroup().getThreshold() <= this.getConfig().getTargetSpeed()) {
            const index = this.groups.getGroups().indexOf(this.getCurrentGroup());
            TbdEvents.dispatchEvent("nextGroup", {
                group: this.getCurrentGroup(),
                groupNumber: index + 1,
            });
            return;
        }
        let next = this.getFirstIncompleteGroup();
        while (next == null) {
            this.getConfig().bumpTargetSpeed(); // side effects, regenerates all groups
            next = this.getFirstIncompleteGroup();
        }
        const index = this.groups.getGroups().indexOf(this.currentGroup);
        TbdEvents.dispatchEvent("nextGroup", {
            group: next,
            groupNumber: index + 1,
        });
    }
    getMonkeyTypeWordset() {
        return this.monkeyTypeWordset;
    }
    handleWordsetForNextWord(wordset) {
        if (this.monkeyTypeWordset.length != wordset.length &&
            wordset.words.join("$") != this.monkeyTypeWordset.words.join("$")) {
            this.handleNewWordset(wordset);
        }
    }
    handleNewWordset(wordset) {
        this.monkeyTypeWordset = wordset;
        this.regenerateGroupsFromWordset(wordset);
    }
    regenerateGroupsFromWordset(wordset) {
        const notAboveTargetSpeed = wordset.words.filter((word) => {
            return !TbdData.hasWordBeenTypedFasterThan(word, this.config.getTargetSpeed());
        });
        const uniqueBelowTarget = new Set(notAboveTargetSpeed);
        if (uniqueBelowTarget.size == 0) {
            this.getConfig().bumpTargetSpeed();
            // Bumping the target triggers a regeneration of groups and infinite loops are no fun
            return;
        }
        this.groups.regenerateGroups(Array.from(uniqueBelowTarget), this.config.getGroupSize());
    }
    handleResultsShownEvent(results) {
        if (!results.difficultyFailed) {
            this.saveBurstsFromLatestResults();
        }
        this.saveMissesFromLatestResult();
        this.recalculateCurrentGroup();
        this.getCurrentGroup().increaseThresholdUntilSomeWordsAreUnbeaten();
        TbdEvents.dispatchEvent("resultsProcessed", {
            currentGroup: this.getCurrentGroup(),
            monkeyTypeWordset: this.monkeyTypeWordset,
            targetSpeed: this.config.getTargetSpeed(),
        });
    }
    saveBurstsFromLatestResults() {
        const resultWords = TestInput.input.history;
        const resultBursts = TestInput.burstHistory;
        for (let i = 0; i < resultWords.length; i++) {
            const word = resultWords[i];
            const burst = resultBursts[i];
            TbdData.addBurst(word, burst);
        }
    }
    resetCurrentWords() {
        if (!confirm("Are you sure you want to reset the stats for the current words?")) {
            return;
        }
        TbdData.resetDataForWords(this.monkeyTypeWordset.words);
    }
    resetWord(data) {
        const word = data["word"];
        if (!confirm(`Reset all data for ${word}?`)) {
            return;
        }
        TbdData.resetDataForWord(word);
    }
    saveMissesFromLatestResult() {
        Object.keys(TestInput.missedWords).forEach((word) => {
            const missedCount = TestInput.missedWords[word];
            TbdData.addToMissedCount(word, missedCount);
        });
    }
    handleResetAllWordsRequest() {
        let confirmationWord = "delete";
        let slowestSpeed = 1000;
        const allData = TbdData.getAll();
        Object.keys(allData.words)
            .filter((word) => TbdData.getMedianSpeedForWord(word) > 0)
            .forEach((word) => {
            const median = TbdData.getMedianSpeedForWord(word);
            if (median > 0 &&
                median < slowestSpeed &&
                word.length >= confirmationWord.length) {
                confirmationWord = word;
                slowestSpeed = median;
            }
        });
        const confirmationString = `${confirmationWord} ${confirmationWord} ${confirmationWord}`;
        const response = prompt(`This will delete ALL your word data. To confirm, type: ${confirmationString}`);
        if (response == null) {
            return;
        }
        if (response == confirmationString) {
            allData.words = {};
            TbdData.updateData(allData, true);
            alert("Ok! Your data has been deleted and you're starting over from scratch.");
            // Lazy, I know
            location.reload();
        }
        else {
            alert(`Good effort, but you typed 
        
        '${response}' 
        
        instead of 
        
        '${confirmationString}' 
        
        No reset for you!`);
        }
    }
}
class TbdUI {
    constructor(tbdMode) {
        this.$groupThreshold = $("#tbdModeGroupThreshold");
        this.$tbdModeGroupCount = $("#tbdModeGroupCount");
        this.$wordInfo = $("#tbdModeWordInfo");
        this.$wordsDiv = $("#tbdmodeInfo .wordsContainer .words");
        this.$progressMeterTotal = $("#tbdmodeInfo .progressMeterTotal");
        this.$targetThreshold = $("#tbdModeTargetThreshold");
        this.$progressMeterGroup = $("#tbdmodeInfo .progressMeterGroup");
        this.$tbdModeInfo = $("#tbdmodeInfo");
        this.$tbdModeHelpButton = $(".tbdModeHelpButton");
        this.$tbdModeHelp = $("#tbdHelp");
        this.$tbdBeatenExample = $(".tbdBeatenExample");
        this.$tbdLostExample = $(".tbdLostExample");
        this.$tbdModeActionsSelect = $("#tbdModeActionsSelect");
        this.$tbdModeActionsButton = $("#tbdModeActionButton");
        this.$tbdModeConfigSettingsSelect = $("#tbdModeConfigSettings");
        this.$tbdModeConfigSettingsUpdateButton = $("#tbdModeUpdateConfigSettingsUpdateButton");
        this.$sorterSelect = $("#tbdModeSorterSelect");
        this.currentlyAnimating = [];
        this.$tbdModeGroupNumber = $("#tbdModeCurrentGroupNumber");
        this.tbdMode = tbdMode;
        const wordsContainer = document.getElementById("tbdModeWordsContainer");
        if (!(wordsContainer instanceof HTMLDivElement)) {
            throw new Error("Could not locate TBD words container");
        }
        this.wordsContainer = wordsContainer;
        this.$wordInfo.hide();
        this.$tbdModeInfo.hide();
    }
    init() {
        document.body.classList.add("tbdMode");
        this.$tbdModeInfo.show(300);
        PageChangeEvent.subscribe(this.pageChangeHandler.bind(this));
        this.wordsContainer.addEventListener("mousemove", this.updateWordInfo.bind(this));
        this.wordsContainer.addEventListener("click", this.handleWordClicked.bind(this));
        this.wordsContainer.addEventListener("mouseleave", () => {
            return this.$wordInfo.hide(0);
        });
        TbdEvents.addSubscriber("wordTypedCorrectly", (data) => {
            data["wordElement"]
                .children("letter")
                .each((_index, element) => {
                this.animate(element, "tbdBeaten");
            });
        });
        TbdEvents.addSubscriber("wordMissed", (data) => {
            data["wordElement"].addClass("tbdLowOpacity");
            this.animate(data["wordElement"][0], "tbdLost");
        });
        TbdEvents.addSubscriber("groupThresholdChanged", (data) => {
            this.$groupThreshold.text(data["threshold"]);
        });
        TbdEvents.addSubscriber("resultsProcessed", (data) => {
            const group = data["currentGroup"];
            this.updateUiWords(group.getWordset().words);
        });
        TbdEvents.addSubscriber("resultsProcessed", (data) => {
            this.updateTotalProgressMeter(data["monkeyTypeWordset"], data["targetSpeed"]);
        });
        TbdEvents.addSubscriber("resultsProcessed", (data) => {
            this.updateGroupProgressMeter(data["currentGroup"], data["targetSpeed"]);
        });
        this.$sorterSelect.on("change", (event) => {
            if (!(event.target instanceof HTMLSelectElement)) {
                return;
            }
            TbdEvents.dispatchEvent("sorterSelectChanged", {
                value: event.target.value,
            });
        });
        TbdEvents.addSubscriber("sorter-changed", this.handleSorterChange.bind(this));
        TbdEvents.addSubscriber("nextGroup", (data) => {
            const group = data["group"];
            this.updateUiWords(group.getWordset().words);
        });
        TbdEvents.addSubscriber("nextGroup", () => {
            this.updateGroupProgressMeter(this.tbdMode.getCurrentGroup(), this.tbdMode.getConfig().getTargetSpeed());
            this.updateTotalProgressMeter(this.tbdMode.getMonkeyTypeWordset(), this.tbdMode.getConfig().getTargetSpeed());
        });
        // Can't use targetSpeed-changed because of stupid recursive way of
        // auto bumping threshold to ensure there are always groups
        TbdEvents.addSubscriber("nextGroup", () => {
            this.$targetThreshold.text(this.tbdMode.getConfig().getTargetSpeed().toString());
        });
        this.$tbdModeHelpButton.on("click", () => {
            this.$tbdModeHelp.toggle(250);
            this.$wordsDiv.toggle(250);
        });
        this.$tbdBeatenExample.on("click", (event) => {
            this.animate(event.target, "tbdBeaten");
        });
        this.$tbdLostExample.on("click", (event) => {
            this.animate(event.target, "tbdLost");
        });
        this.$targetThreshold.text(this.tbdMode.getConfig().getTargetSpeed());
        this.$groupThreshold.text(this.tbdMode.getCurrentGroup().getThreshold());
        this.$tbdModeConfigSettingsUpdateButton.on("click", () => {
            const selectValue = this.$tbdModeConfigSettingsSelect.val();
            if (selectValue == "") {
                alert("Select an option from the dropdown first");
            }
            else {
                TbdEvents.dispatchEvent("configUpdateRequested", {
                    configSetting: selectValue,
                });
            }
        });
        this.$tbdModeActionsButton.on("click", () => {
            const selectValue = this.$tbdModeActionsSelect.val();
            if (selectValue == "") {
                alert("Select an option from the dropdown first");
            }
            else {
                TbdEvents.dispatchEvent("actionButtonClicked", {
                    actionValue: selectValue,
                });
            }
        });
        TbdEvents.addSubscriber("wordSaved", (data) => {
            const word = data["word"] || "";
            if (word == "") {
                return;
            }
            const element = this.getWordElement(word);
            if (!element) {
                return;
            }
            this.updateWord(word);
        });
        TbdEvents.addSubscriber("groupsRegenerated", (data) => {
            this.$tbdModeGroupCount.text(data["groups"].length);
        });
        TbdEvents.addSubscriber("nextGroup", (data) => {
            this.$tbdModeGroupNumber.text(data["groupNumber"]);
            this.$groupThreshold.text(data["group"].getThreshold());
        });
        this.$sorterSelect
            .find(`option[value="${this.tbdMode.getConfig().getSorterName()}"]`)
            .attr("selected", "");
    }
    /**
     * @param element
     * @param animation - both the keyframe animation and class with that animation. For simplicity
     * they must be the same.
     */
    animate(element, animation) {
        if (!this.tbdMode.getConfig().areAnimationsEnabled()) {
            return;
        }
        if (this.currentlyAnimating.includes(element)) {
            return;
        }
        const callback = (event) => {
            if (event.animationName !== animation) {
                return;
            }
            const index = this.currentlyAnimating.findIndex((animatingElement) => animatingElement == element);
            if (index >= 0) {
                delete this.currentlyAnimating[index];
            }
            element.classList.remove(animation);
            element.removeEventListener("animationend", callback);
        };
        element.addEventListener("animationend", callback);
        this.currentlyAnimating.push(element);
        element.classList.add(animation);
    }
    handleWordClicked(event) {
        var _a;
        const target = event.target;
        if (!(target instanceof HTMLDivElement)) {
            return;
        }
        if (!target.classList.contains("tbdWord")) {
            return;
        }
        const word = ((_a = target.parentElement) === null || _a === void 0 ? void 0 : _a.dataset["word"]) || "";
        if (word == "") {
            return;
        }
        TbdEvents.dispatchEvent("wordClicked", { word: word });
    }
    handleSorterChange(data) {
        const sorter = TbdSorting.getSorter(data["newValue"] || "");
        this.sortWords(sorter);
    }
    selectSorterOption(sorterName) {
        [...document.querySelectorAll("#tbdModeSorterSelect option")].forEach((option) => {
            if (!(option instanceof HTMLOptionElement)) {
                return;
            }
            if (option["value"] == sorterName) {
                option["selected"] = true;
            }
        });
    }
    updateTotalProgressMeter(monkeyTypeWordset, targetSpeed) {
        const allWords = monkeyTypeWordset.words;
        const count = allWords.length;
        const beatenAtTargetCount = allWords.filter((word) => {
            return TbdData.hasWordBeenTypedFasterThan(word, targetSpeed);
        }).length;
        const percent = (beatenAtTargetCount / count) * 100 || 0;
        this.$progressMeterTotal.css("width", `${percent}%`);
        this.$progressMeterTotal.attr("title", `${beatenAtTargetCount} words of ${count} total have been typed faster than the target of ${targetSpeed}`);
    }
    updateGroupProgressMeter(currentGroup, targetSpeed) {
        const groupWordset = currentGroup.getWordset();
        const beatenAtTargetCount = groupWordset.words.filter((word) => {
            return TbdData.hasWordBeenTypedFasterThan(word, targetSpeed);
        }).length;
        const percent = (beatenAtTargetCount / groupWordset.length) * 100 || 0;
        this.$progressMeterGroup.css("width", `${percent}%`);
        this.$progressMeterGroup.attr("title", `${beatenAtTargetCount} words of ${groupWordset.length} in the current group have been typed faster than the target of ${targetSpeed}`);
    }
    pageChangeHandler(_previousPage, nextPage) {
        const pagesToShowInfo = ["test"];
        if (pagesToShowInfo.includes(nextPage.name)) {
            this.$tbdModeInfo.show();
        }
        else {
            this.$tbdModeInfo.hide();
        }
    }
    updateUiWords(wordsToShow) {
        var _a;
        // Remove words we don't want to show
        this.$wordsDiv.hide();
        (_a = [...document.querySelectorAll(".words .tbdWordContainer")]) === null || _a === void 0 ? void 0 : _a.forEach((wordElement) => {
            // @ts-ignore
            const word = wordElement.dataset["word"];
            if (!wordsToShow.includes(word)) {
                // @ts-ignore
                wordElement.parentElement.removeChild(wordElement);
            }
        });
        wordsToShow.forEach((word) => {
            this.updateWord(word);
        });
        this.sortWords(this.tbdMode.getConfig().getSorter());
        this.$wordsDiv.show();
    }
    updateWord(word) {
        const wordElement = this.getOrCreateWordElement(word);
        const targetSpeed = this.tbdMode.getConfig().getTargetSpeed();
        const groupSpeed = this.tbdMode.getCurrentGroup().getThreshold();
        // Timeout ensures transitions work
        setTimeout(() => {
            var _a;
            wordElement.dataset["beatenAtTarget"] =
                TbdData.hasWordBeenTypedFasterThan(word, targetSpeed) ? "1" : "0";
            wordElement.dataset["beatenAtGroup"] = TbdData.hasWordBeenTypedFasterThan(word, groupSpeed)
                ? "1"
                : "0";
            wordElement.dataset["typed"] =
                TbdData.getSpeedsForWord(word).length == 0 ? "0" : "1";
            wordElement.dataset["missedMore"] =
                TbdData.getMistypedCountForWord(word) >
                    TbdData.getSpeedsForWord(word).length
                    ? "1"
                    : "0";
            const percentComplete = TbdData.getMedianSpeedForWord(word) / targetSpeed;
            const modifier = Math.min(percentComplete, 1);
            const baseScale = 0.75;
            const additional = (1 - baseScale) * modifier;
            // @ts-ignore
            (_a = wordElement.querySelector("div").style) === null || _a === void 0 ? void 0 : _a.transform = `scale(${baseScale + additional})`;
        }, 0);
    }
    sortWords(sorter) {
        var _a;
        const words = (_a = [...document.querySelectorAll(".tbdWordContainer")]) === null || _a === void 0 ? void 0 : _a.map((wordContainerElement) => {
            if (!(wordContainerElement instanceof HTMLDivElement)) {
                throw new Error("RUH ROH");
            }
            return wordContainerElement.dataset["word"] || "";
        });
        const sorted = words.sort(sorter);
        sorted.forEach((word) => {
            const element = this.getOrCreateWordElement(word);
            this.$wordsDiv.append(element);
        });
    }
    getWordElement(word) {
        const query = `.tbdWordContainer[data-word="${word}"]`;
        return document.querySelector(query);
    }
    getOrCreateWordElement(word) {
        const element = this.getWordElement(word);
        if (element) {
            return element;
        }
        const newDiv = document.createElement("div");
        newDiv.innerHTML = `<div class="tbdWord">${word}</div>`;
        newDiv.dataset["word"] = word;
        newDiv.classList.add("tbdWordContainer");
        this.$wordsDiv.append(newDiv);
        return newDiv;
    }
    updateWordInfo(event) {
        var _a;
        const target = event.target;
        if (!(target instanceof HTMLElement)) {
            return;
        }
        if (!target.classList.contains("tbdWord")) {
            return;
        }
        const word = (_a = target.parentElement) === null || _a === void 0 ? void 0 : _a.dataset["word"];
        if (word == undefined) {
            return;
        }
        const wordData = TbdData.getDataForWord(word);
        let wordInfoHtml = `
        <h3>"${word}"</h3>
        <div class="heading">Counts</div>
        <div class="statContainer">
          <span class="label">Correct: </span>
          <span class="stat good">${wordData.speeds.length}</span.>
        </div>
        <div class="statContainer">
          <span class="label">Missed: </span>
          <span class="stat bad">${TbdData.getMistypedCountForWord(word)}</span>
        </div>`;
        if (wordData.speeds.length) {
            wordInfoHtml += `
            <div class="heading">Speeds</div>
        <div class="statContainer">
          <span class="label">Worst: </span>
          <span class="stat bad">${TbdData.getSlowestSpeedForWord(word)}</span>
        </div>
        <div class="statContainer">
          <span class="label">Mean: </span>
          <span class="stat">${TbdData.getMeanSpeedForWord(word)}</span>
        </div>
        <div class="statContainer">
          <span class="label">Median: </span>
          <span class="stat">${TbdData.getMedianSpeedForWord(word)}</span>
        </div>
        <div class="statContainer">
          <span class="label">Best: </span>
          <span class="stat good">${TbdData.getFastestSpeedForWord(word)}</span>
        </div>`;
        }
        wordInfoHtml += `<div class="helpText">click to reset word data</div>`;
        this.$wordInfo.html(wordInfoHtml);
        this.getOrCreateWordElement(word).append(this.$wordInfo[0]);
        this.$wordInfo.show(200);
    }
}
class TbdEvents {
    static dispatchEvent(name, data = {}) {
        const subscribers = this.subscribers[name] || [];
        subscribers.forEach((subscriber) => {
            subscriber(data);
        });
    }
    static addSubscriber(name, callback) {
        if (!Array.isArray(TbdEvents.subscribers[name])) {
            TbdEvents.subscribers[name] = [];
        }
        TbdEvents.subscribers[name].push(callback);
    }
}
TbdEvents.subscribers = {};
TbdEvents.debouncedDispatch = (0, debounce_1.debounce)(TbdEvents.dispatchEvent, 50);
class TbdData {
    static getAll() {
        if (TbdData.data) {
            return TbdData.data;
        }
        TbdData.data = TbdData.getFromLocalStorage();
        return TbdData.data;
    }
    static getFromLocalStorage() {
        const defaultValue = { words: {}, config: {} };
        const storedData = localStorage.getItem(TbdData.localStorageKey);
        if (storedData == null) {
            return defaultValue;
        }
        // Try parsing local storage
        const parsed = JSON.parse(storedData);
        if (typeof parsed == "object") {
            return parsed;
        }
        return defaultValue;
    }
    static updateData(data, immediately = false) {
        TbdData.data = data;
        if (immediately) {
            TbdData.updateLocalStorage(data);
        }
        else {
            TbdData.debouncedUpdateLocalStorage(data);
        }
    }
    static getDataForWord(word) {
        const data = TbdData.getAll();
        if (!data.words[word]) {
            return { speeds: [], missedCount: 0 };
        }
        return data.words[word];
    }
    static resetDataForWord(word) {
        TbdData.saveWordData(word, { speeds: [], missedCount: 0 });
        TbdEvents.dispatchEvent("wordReset", { word: word });
    }
    static resetDataForWords(words) {
        words.forEach((word) => TbdData.resetDataForWord(word));
        TbdEvents.dispatchEvent("wordsReset", { words: words });
    }
    static hasWordBeenTypedFasterThan(word, threshold) {
        return TbdData.getMedianSpeedForWord(word) > threshold;
    }
    static getSpeedsForWord(word) {
        return TbdData.getDataForWord(word).speeds || [];
    }
    static getSlowestSpeedForWord(word) {
        const speeds = TbdData.getSpeedsForWord(word);
        if (speeds.length == 0) {
            return 0;
        }
        return Math.min(...speeds);
    }
    static getFastestSpeedForWord(word) {
        const speeds = TbdData.getSpeedsForWord(word);
        if (speeds.length == 0) {
            return 0;
        }
        return Math.max(...speeds);
    }
    static getMistypedCountForWord(word) {
        return TbdData.getDataForWord(word).missedCount;
    }
    static getMedianSpeedForWord(word) {
        const wordSpeeds = TbdData.getSpeedsForWord(word);
        if (wordSpeeds.length < 1) {
            return 0;
        }
        return (0, misc_1.median)(wordSpeeds);
    }
    static getMeanSpeedForWord(word) {
        const speeds = TbdData.getSpeedsForWord(word);
        if (speeds.length == 0) {
            return 0;
        }
        return Math.round((0, misc_1.mean)(speeds));
    }
    static saveWordData(word, wordData) {
        const data = TbdData.getAll();
        data.words[word] = wordData;
        TbdData.updateData(data);
        TbdEvents.dispatchEvent("wordSaved", { word: word, data: wordData });
    }
    static addBurst(word, speed) {
        if (word == "") {
            return;
        }
        const wordData = TbdData.getDataForWord(word);
        wordData.speeds.push(speed);
        TbdData.saveWordData(word, wordData);
    }
    static addToMissedCount(word, missedCount) {
        const data = TbdData.getDataForWord(word);
        data.missedCount += missedCount;
        TbdData.saveWordData(word, data);
    }
    static updateLocalStorage(data) {
        localStorage.setItem(TbdData.localStorageKey, JSON.stringify(data));
    }
}
TbdData.localStorageKey = "tbdModeData";
TbdData.debouncedUpdateLocalStorage = (0, debounce_1.debounce)(TbdData.updateLocalStorage, 1000);
class TbdGroups {
    constructor() {
        this.groups = [];
    }
    setGroups(groups) {
        this.groups = groups;
    }
    getGroups() {
        return this.groups;
    }
    getFirstIncompleteGroup(targetSpeed) {
        return (this.groups.find((group) => {
            return group
                .getWordset()
                .words.some((word) => !TbdData.hasWordBeenTypedFasterThan(word, targetSpeed));
        }) || null);
    }
    regenerateGroups(words, desiredGroupSize) {
        this.groups = [];
        if (words.length == 0) {
            return;
        }
        const randomlySorted = words.sort(TbdSorting.randomSorter);
        // This is an effort to ensure there are no tiny group sizes, like if there are 200
        // words and a group size of 18. Creating groups of size 18 would mean getting 11 groups
        // of 18 and 1 group of 2. This method ends up creating 8 groups of 17 (136) + 4 groups of
        // 16 (64). I'm sure there is a better way to calculate it but this seems to work and I'm
        // lazy when it comes to math.
        const total = words.length;
        const actualGroupCount = Math.ceil(total / desiredGroupSize);
        const maxGroupSize = Math.ceil(total / actualGroupCount);
        const reducedGroupSize = maxGroupSize - 1;
        const sizesToCreate = [];
        let remainingWords = total;
        for (let i = 0; i < actualGroupCount; i++) {
            if (remainingWords % maxGroupSize == 0) {
                sizesToCreate.push(maxGroupSize);
                remainingWords -= maxGroupSize;
            }
            else {
                sizesToCreate.push(reducedGroupSize);
                remainingWords -= reducedGroupSize;
            }
        }
        let start = 0;
        sizesToCreate.forEach((size) => {
            const words = randomlySorted.slice(start, start + size);
            const wordset = new wordset_1.Wordset(words);
            this.groups.push(new TbdGroup(wordset));
            start = start + size;
        });
        TbdEvents.dispatchEvent("groupsRegenerated", { groups: this.groups });
        TbdEvents.dispatchEvent("nextGroup", {
            group: this.getGroups()[0],
            groupNumber: 1,
        });
    }
}
class TbdGroup {
    constructor(wordset) {
        this.threshold = 1;
        this.wordset = wordset;
    }
    getWordset() {
        return this.wordset;
    }
    getThreshold() {
        return this.threshold;
    }
    bumpThreshold() {
        this.threshold += 1;
        TbdEvents.dispatchEvent("groupThresholdChanged", {
            threshold: this.threshold,
        });
    }
    getUnbeatenWordset() {
        const unbeatenWords = this.wordset.words.filter((word) => {
            return !TbdData.hasWordBeenTypedFasterThan(word, this.getThreshold());
        });
        return new wordset_1.Wordset(unbeatenWords);
    }
    increaseThresholdUntilSomeWordsAreUnbeaten() {
        if (this.wordset.length == 0) {
            return;
        }
        while (this.getUnbeatenWordset().length == 0) {
            this.bumpThreshold();
        }
    }
}
ConfigEvent.subscribe(handleFunboxChange);
function isTbdMode() {
    return config_1.default.funbox == "tbdmode";
}
function handleFunboxChange(key, _newValue, _nosave, _previousValue, _fullConfig) {
    if (key != "funbox") {
        return;
    }
    if (isTbdMode() && !getTbdMode()) {
        const tbdConfig = new TbdConfig();
        tbdConfig.init();
        tbdMode = new TbdMode(tbdConfig);
        tbdMode.init();
        const ui = new TbdUI(tbdMode);
        ui.init();
    }
    else if (!isTbdMode() && getTbdMode()) {
        // This was the easiest way I could think of to ensure there's nothing left over
        // after switching from TBD Mode to something else.
        location.reload();
    }
}
let tbdMode;
function getTbdMode() {
    return tbdMode;
}
exports.getTbdMode = getTbdMode;
ConfigStuff.setFunbox("tbdmode");


/***/ }),

/***/ "./src/scripts/test/test-config.ts":
/*!*****************************************!*\
  !*** ./src/scripts/test/test-config.ts ***!
  \*****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = exports.hide = exports.show = void 0;
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
// export function show() {
//   $("#top .config").removeClass("hidden").css("opacity", 1);
// }
// export function hide() {
//   $("#top .config").css("opacity", 0).addClass("hidden");
// }
function show() {
    $("#top .config")
        .stop(true, true)
        .removeClass("hidden")
        .css("opacity", 0)
        .animate({
        opacity: 1,
    }, 125);
}
exports.show = show;
function hide() {
    $("#top .config")
        .stop(true, true)
        .css("opacity", 1)
        .animate({
        opacity: 0,
    }, 125, () => {
        $("#top .config").addClass("hidden");
    });
}
exports.hide = hide;
function update(previous, current) {
    if (previous === current)
        return;
    $("#top .config .mode .text-button").removeClass("active");
    $("#top .config .mode .text-button[mode='" + current + "']").addClass("active");
    if (current == "time") {
        // $("#top .config .wordCount").addClass("hidden");
        // $("#top .config .time").removeClass("hidden");
        // $("#top .config .customText").addClass("hidden");
        $("#top .config .punctuationMode").removeClass("disabled");
        $("#top .config .numbersMode").removeClass("disabled");
        // $("#top .config .puncAndNum").removeClass("disabled");
        // $("#top .config .punctuationMode").removeClass("hidden");
        // $("#top .config .numbersMode").removeClass("hidden");
        // $("#top .config .quoteLength").addClass("hidden");
    }
    else if (current == "words") {
        // $("#top .config .wordCount").removeClass("hidden");
        // $("#top .config .time").addClass("hidden");
        // $("#top .config .customText").addClass("hidden");
        $("#top .config .punctuationMode").removeClass("disabled");
        $("#top .config .numbersMode").removeClass("disabled");
        // $("#top .config .puncAndNum").removeClass("disabled");
        // $("#top .config .punctuationMode").removeClass("hidden");
        // $("#top .config .numbersMode").removeClass("hidden");
        // $("#top .config .quoteLength").addClass("hidden");
    }
    else if (current == "custom") {
        // $("#top .config .wordCount").addClass("hidden");
        // $("#top .config .time").addClass("hidden");
        // $("#top .config .customText").removeClass("hidden");
        $("#top .config .punctuationMode").removeClass("disabled");
        $("#top .config .numbersMode").removeClass("disabled");
        // $("#top .config .puncAndNum").removeClass("disabled");
        // $("#top .config .punctuationMode").removeClass("hidden");
        // $("#top .config .numbersMode").removeClass("hidden");
        // $("#top .config .quoteLength").addClass("hidden");
    }
    else if (current == "quote") {
        // $("#top .config .wordCount").addClass("hidden");
        // $("#top .config .time").addClass("hidden");
        // $("#top .config .customText").addClass("hidden");
        $("#top .config .punctuationMode").addClass("disabled");
        $("#top .config .numbersMode").addClass("disabled");
        // $("#top .config .puncAndNum").addClass("disabled");
        // $("#top .config .punctuationMode").removeClass("hidden");
        // $("#top .config .numbersMode").removeClass("hidden");
        // $("#result .stats .source").removeClass("hidden");
        // $("#top .config .quoteLength").removeClass("hidden");
    }
    else if (current == "zen") {
        // $("#top .config .wordCount").addClass("hidden");
        // $("#top .config .time").addClass("hidden");
        // $("#top .config .customText").addClass("hidden");
        // $("#top .config .punctuationMode").addClass("hidden");
        // $("#top .config .numbersMode").addClass("hidden");
        // $("#top .config .quoteLength").addClass("hidden");
    }
    const submenu = {
        time: "time",
        words: "wordCount",
        custom: "customText",
        quote: "quoteLength",
        zen: "",
    };
    const animTime = 250;
    if (current == "zen") {
        $(`#top .config .${submenu[previous]}`).animate({
            opacity: 0,
        }, animTime / 2, () => {
            $(`#top .config .${submenu[previous]}`).addClass("hidden");
        });
        $(`#top .config .puncAndNum`).animate({
            opacity: 0,
        }, animTime / 2, () => {
            $(`#top .config .puncAndNum`).addClass("invisible");
        });
        return;
    }
    if (previous == "zen") {
        setTimeout(() => {
            $(`#top .config .${submenu[current]}`).removeClass("hidden");
            $(`#top .config .${submenu[current]}`)
                .css({ opacity: 0 })
                .animate({
                opacity: 1,
            }, animTime / 2);
            $(`#top .config .puncAndNum`).removeClass("invisible");
            $(`#top .config .puncAndNum`)
                .css({ opacity: 0 })
                .animate({
                opacity: 1,
            }, animTime / 2);
        }, animTime / 2);
        return;
    }
    Misc.swapElements($("#top .config ." + submenu[previous]), $("#top .config ." + submenu[current]), animTime);
}
exports.update = update;
ConfigEvent.subscribe((eventKey, eventValue, _nosave, eventPreviousValue) => {
    if (eventKey === "mode") {
        update(eventPreviousValue, eventValue);
    }
});


/***/ }),

/***/ "./src/scripts/test/test-input.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-input.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.restart = exports.pushBurstToHistory = exports.pushToRawHistory = exports.pushToWpmHistory = exports.pushMissedWord = exports.resetKeypressTimings = exports.recordKeypressSpacing = exports.setKeypressDuration = exports.pushKeypressDuration = exports.setKeypressTimingsTooLong = exports.incrementAccuracy = exports.pushKeypressesToHistory = exports.setBurstStart = exports.pushKeypressWord = exports.incrementKeypressErrors = exports.setKeypressNotAfk = exports.incrementKeypressCount = exports.updateLastKeypress = exports.enableSpacingDebug = exports.spacingDebug = exports.setBailout = exports.bailout = exports.burstHistory = exports.rawHistory = exports.wpmHistory = exports.keypressTimings = exports.accuracy = exports.missedWords = exports.currentBurstStart = exports.lastKeypress = exports.currentKeypress = exports.keypressPerSecond = exports.corrected = exports.input = void 0;
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
class Input {
    constructor() {
        this.current = "";
        this.history = [];
        this.historyLength = 0;
        this.length = 0;
    }
    reset() {
        this.current = "";
        this.history = [];
        this.length = 0;
    }
    resetHistory() {
        this.history = [];
        this.length = 0;
    }
    setCurrent(val) {
        this.current = val;
        this.length = this.current.length;
    }
    appendCurrent(val) {
        this.current += val;
        this.length = this.current.length;
    }
    resetCurrent() {
        this.current = "";
    }
    getCurrent() {
        return this.current;
    }
    pushHistory() {
        this.history.push(this.current);
        this.historyLength = this.history.length;
        this.resetCurrent();
    }
    popHistory() {
        var _a;
        const ret = (_a = this.history.pop()) !== null && _a !== void 0 ? _a : "";
        this.historyLength = this.history.length;
        return ret;
    }
    getHistory(i) {
        if (i === undefined) {
            return this.history;
        }
        else {
            return this.history[i];
        }
    }
    getHistoryLast() {
        return this.history[this.history.length - 1];
    }
}
class Corrected {
    constructor() {
        this.current = "";
        this.history = [];
    }
    setCurrent(val) {
        this.current = val;
    }
    appendCurrent(val) {
        this.current += val;
    }
    resetCurrent() {
        this.current = "";
    }
    resetHistory() {
        this.history = [];
    }
    reset() {
        this.resetCurrent();
        this.resetHistory();
    }
    getHistory(i) {
        return this.history[i];
    }
    popHistory() {
        var _a;
        return (_a = this.history.pop()) !== null && _a !== void 0 ? _a : "";
    }
    pushHistory() {
        this.history.push(this.current);
        this.current = "";
    }
}
exports.input = new Input();
exports.corrected = new Corrected();
exports.keypressPerSecond = [];
exports.currentKeypress = {
    count: 0,
    errors: 0,
    words: [],
    afk: true,
};
exports.currentBurstStart = 0;
exports.missedWords = {};
exports.accuracy = {
    correct: 0,
    incorrect: 0,
};
exports.keypressTimings = {
    spacing: {
        current: -1,
        array: [],
    },
    duration: {
        current: -1,
        array: [],
    },
};
exports.wpmHistory = [];
exports.rawHistory = [];
exports.burstHistory = [];
exports.bailout = false;
function setBailout(tf) {
    exports.bailout = tf;
}
exports.setBailout = setBailout;
exports.spacingDebug = false;
function enableSpacingDebug() {
    exports.spacingDebug = true;
    console.clear();
}
exports.enableSpacingDebug = enableSpacingDebug;
function updateLastKeypress() {
    exports.lastKeypress = performance.now();
}
exports.updateLastKeypress = updateLastKeypress;
function incrementKeypressCount() {
    exports.currentKeypress.count++;
}
exports.incrementKeypressCount = incrementKeypressCount;
function setKeypressNotAfk() {
    exports.currentKeypress.afk = false;
}
exports.setKeypressNotAfk = setKeypressNotAfk;
function incrementKeypressErrors() {
    exports.currentKeypress.errors++;
}
exports.incrementKeypressErrors = incrementKeypressErrors;
function pushKeypressWord(wordIndex) {
    exports.currentKeypress.words.push(wordIndex);
}
exports.pushKeypressWord = pushKeypressWord;
function setBurstStart(time) {
    exports.currentBurstStart = time;
}
exports.setBurstStart = setBurstStart;
function pushKeypressesToHistory() {
    exports.keypressPerSecond.push(exports.currentKeypress);
    exports.currentKeypress = {
        count: 0,
        errors: 0,
        words: [],
        afk: true,
    };
}
exports.pushKeypressesToHistory = pushKeypressesToHistory;
function incrementAccuracy(correctincorrect) {
    if (correctincorrect) {
        exports.accuracy.correct++;
    }
    else {
        exports.accuracy.incorrect++;
    }
}
exports.incrementAccuracy = incrementAccuracy;
function setKeypressTimingsTooLong() {
    exports.keypressTimings.spacing.array = "toolong";
    exports.keypressTimings.duration.array = "toolong";
}
exports.setKeypressTimingsTooLong = setKeypressTimingsTooLong;
function pushKeypressDuration(val) {
    exports.keypressTimings.duration.array.push((0, misc_1.roundTo2)(val));
}
exports.pushKeypressDuration = pushKeypressDuration;
function setKeypressDuration(val) {
    exports.keypressTimings.duration.current = (0, misc_1.roundTo2)(val);
}
exports.setKeypressDuration = setKeypressDuration;
function pushKeypressSpacing(val) {
    exports.keypressTimings.spacing.array.push((0, misc_1.roundTo2)(val));
}
function setKeypressSpacing(val) {
    exports.keypressTimings.spacing.current = (0, misc_1.roundTo2)(val);
}
function recordKeypressSpacing() {
    const now = performance.now();
    const diff = Math.abs(exports.keypressTimings.spacing.current - now);
    if (exports.keypressTimings.spacing.current !== -1) {
        pushKeypressSpacing(diff);
        if (exports.spacingDebug) {
            console.log("spacing debug", "push", diff, "length", exports.keypressTimings.spacing.array.length);
        }
    }
    setKeypressSpacing(now);
    if (exports.spacingDebug) {
        console.log("spacing debug", "set", now, "length", exports.keypressTimings.spacing.array.length);
    }
    if (exports.spacingDebug) {
        console.log("spacing debug", "recorded", "length", exports.keypressTimings.spacing.array.length);
    }
}
exports.recordKeypressSpacing = recordKeypressSpacing;
function resetKeypressTimings() {
    exports.keypressTimings = {
        spacing: {
            current: performance.now(),
            array: [],
        },
        duration: {
            current: performance.now(),
            array: [],
        },
    };
    if (exports.spacingDebug)
        console.clear();
}
exports.resetKeypressTimings = resetKeypressTimings;
function pushMissedWord(word) {
    if (!Object.keys(exports.missedWords).includes(word)) {
        exports.missedWords[word] = 1;
    }
    else {
        exports.missedWords[word]++;
    }
}
exports.pushMissedWord = pushMissedWord;
function pushToWpmHistory(wpm) {
    exports.wpmHistory.push(wpm);
}
exports.pushToWpmHistory = pushToWpmHistory;
function pushToRawHistory(raw) {
    exports.rawHistory.push(raw);
}
exports.pushToRawHistory = pushToRawHistory;
function pushBurstToHistory(speed) {
    if (exports.burstHistory[TestWords.words.currentIndex] === undefined) {
        exports.burstHistory.push(speed);
    }
    else {
        //repeated word - override
        exports.burstHistory[TestWords.words.currentIndex] = speed;
    }
}
exports.pushBurstToHistory = pushBurstToHistory;
function restart() {
    exports.wpmHistory = [];
    exports.rawHistory = [];
    exports.burstHistory = [];
    exports.keypressPerSecond = [];
    exports.currentKeypress = {
        count: 0,
        errors: 0,
        words: [],
        afk: true,
    };
    exports.currentBurstStart = 0;
    exports.missedWords = {};
    exports.accuracy = {
        correct: 0,
        incorrect: 0,
    };
    exports.keypressTimings = {
        spacing: {
            current: -1,
            array: [],
        },
        duration: {
            current: -1,
            array: [],
        },
    };
}
exports.restart = restart;


/***/ }),

/***/ "./src/scripts/test/test-logic.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-logic.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.fail = exports.finish = exports.retrySavingResult = exports.addWord = exports.init = exports.restart = exports.startTest = exports.punctuateWord = exports.setNotSignedInUid = exports.clearNotSignedInResult = exports.notSignedInLastResult = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const TestUI = __importStar(__webpack_require__(/*! ./test-ui */ "./src/scripts/test/test-ui.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ./manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const quotes_controller_1 = __importDefault(__webpack_require__(/*! ../controllers/quotes-controller */ "./src/scripts/controllers/quotes-controller.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const CustomText = __importStar(__webpack_require__(/*! ./custom-text */ "./src/scripts/test/custom-text.ts"));
const TestStats = __importStar(__webpack_require__(/*! ./test-stats */ "./src/scripts/test/test-stats.ts"));
const PractiseWords = __importStar(__webpack_require__(/*! ./practise-words */ "./src/scripts/test/practise-words.ts"));
const ShiftTracker = __importStar(__webpack_require__(/*! ./shift-tracker */ "./src/scripts/test/shift-tracker.ts"));
const Focus = __importStar(__webpack_require__(/*! ./focus */ "./src/scripts/test/focus.ts"));
const Funbox = __importStar(__webpack_require__(/*! ./funbox */ "./src/scripts/test/funbox.ts"));
const Keymap = __importStar(__webpack_require__(/*! ../elements/keymap */ "./src/scripts/elements/keymap.ts"));
const ThemeController = __importStar(__webpack_require__(/*! ../controllers/theme-controller */ "./src/scripts/controllers/theme-controller.ts"));
const PaceCaret = __importStar(__webpack_require__(/*! ./pace-caret */ "./src/scripts/test/pace-caret.ts"));
const Caret = __importStar(__webpack_require__(/*! ./caret */ "./src/scripts/test/caret.ts"));
const LiveWpm = __importStar(__webpack_require__(/*! ./live-wpm */ "./src/scripts/test/live-wpm.ts"));
const LiveAcc = __importStar(__webpack_require__(/*! ./live-acc */ "./src/scripts/test/live-acc.ts"));
const LiveBurst = __importStar(__webpack_require__(/*! ./live-burst */ "./src/scripts/test/live-burst.ts"));
const TimerProgress = __importStar(__webpack_require__(/*! ./timer-progress */ "./src/scripts/test/timer-progress.ts"));
const QuoteSearchPopup = __importStar(__webpack_require__(/*! ../popups/quote-search-popup */ "./src/scripts/popups/quote-search-popup.ts"));
const QuoteSubmitPopup = __importStar(__webpack_require__(/*! ../popups/quote-submit-popup */ "./src/scripts/popups/quote-submit-popup.ts"));
const PbCrown = __importStar(__webpack_require__(/*! ./pb-crown */ "./src/scripts/test/pb-crown.ts"));
const TestTimer = __importStar(__webpack_require__(/*! ./test-timer */ "./src/scripts/test/test-timer.ts"));
const OutOfFocus = __importStar(__webpack_require__(/*! ./out-of-focus */ "./src/scripts/test/out-of-focus.ts"));
const AccountButton = __importStar(__webpack_require__(/*! ../elements/account-button */ "./src/scripts/elements/account-button.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Replay = __importStar(__webpack_require__(/*! ./replay */ "./src/scripts/test/replay.ts"));
const Poetry = __importStar(__webpack_require__(/*! ./poetry */ "./src/scripts/test/poetry.ts"));
const Wikipedia = __importStar(__webpack_require__(/*! ./wikipedia */ "./src/scripts/test/wikipedia.ts"));
const TodayTracker = __importStar(__webpack_require__(/*! ./today-tracker */ "./src/scripts/test/today-tracker.ts"));
const WeakSpot = __importStar(__webpack_require__(/*! ./weak-spot */ "./src/scripts/test/weak-spot.ts"));
const Wordset = __importStar(__webpack_require__(/*! ./wordset */ "./src/scripts/test/wordset.ts"));
const ChallengeContoller = __importStar(__webpack_require__(/*! ../controllers/challenge-controller */ "./src/scripts/controllers/challenge-controller.ts"));
const QuoteRatePopup = __importStar(__webpack_require__(/*! ../popups/quote-rate-popup */ "./src/scripts/popups/quote-rate-popup.ts"));
const BritishEnglish = __importStar(__webpack_require__(/*! ./british-english */ "./src/scripts/test/british-english.ts"));
const LazyMode = __importStar(__webpack_require__(/*! ./lazy-mode */ "./src/scripts/test/lazy-mode.ts"));
const Result = __importStar(__webpack_require__(/*! ./result */ "./src/scripts/test/result.ts"));
const MonkeyPower = __importStar(__webpack_require__(/*! ../elements/monkey-power */ "./src/scripts/elements/monkey-power.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const TestState = __importStar(__webpack_require__(/*! ./test-state */ "./src/scripts/test/test-state.ts"));
const ModesNotice = __importStar(__webpack_require__(/*! ../elements/modes-notice */ "./src/scripts/elements/modes-notice.ts"));
const PageTransition = __importStar(__webpack_require__(/*! ../states/page-transition */ "./src/scripts/states/page-transition.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const TimerEvent = __importStar(__webpack_require__(/*! ../observables/timer-event */ "./src/scripts/observables/timer-event.ts"));
const ResetRequestedEvent = __importStar(__webpack_require__(/*! ../observables/reset-requested-event */ "./src/scripts/observables/reset-requested-event.ts"));
const Last10Average = __importStar(__webpack_require__(/*! ../elements/last-10-average */ "./src/scripts/elements/last-10-average.ts"));
const Monkey = __importStar(__webpack_require__(/*! ./monkey */ "./src/scripts/test/monkey.ts"));
const tbd_mode_1 = __webpack_require__(/*! ./tbd-mode */ "./src/scripts/test/tbd-mode.ts");
const object_hash_1 = __importDefault(__webpack_require__(/*! object-hash */ "./node_modules/object-hash/dist/object_hash.js"));
const AnalyticsController = __importStar(__webpack_require__(/*! ../controllers/analytics-controller */ "./src/scripts/controllers/analytics-controller.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
let failReason = "";
exports.notSignedInLastResult = null;
function clearNotSignedInResult() {
    exports.notSignedInLastResult = null;
}
exports.clearNotSignedInResult = clearNotSignedInResult;
function setNotSignedInUid(uid) {
    if (exports.notSignedInLastResult === null)
        return;
    exports.notSignedInLastResult.uid = uid;
    delete exports.notSignedInLastResult.hash;
    exports.notSignedInLastResult.hash = (0, object_hash_1.default)(exports.notSignedInLastResult);
}
exports.setNotSignedInUid = setNotSignedInUid;
let spanishSentenceTracker = "";
function punctuateWord(previousWord, currentWord, index, maxindex) {
    let word = currentWord;
    const currentLanguage = config_1.default.language.split("_")[0];
    const lastChar = Misc.getLastChar(previousWord);
    if (config_1.default.funbox === "58008") {
        if (currentWord.length > 3) {
            if (Math.random() < 0.75) {
                const special = ["/", "*", "-", "+"][Math.floor(Math.random() * 4)];
                word = Misc.setCharAt(word, Math.floor(word.length / 2), special);
            }
        }
    }
    else {
        if ((index == 0 || lastChar == "." || lastChar == "?" || lastChar == "!") &&
            currentLanguage != "code") {
            //always capitalise the first word or if there was a dot unless using a code alphabet
            word = Misc.capitalizeFirstLetterOfEachWord(word);
            if (currentLanguage == "spanish" || currentLanguage == "catalan") {
                const rand = Math.random();
                if (rand > 0.9) {
                    word = "" + word;
                    spanishSentenceTracker = "?";
                }
                else if (rand > 0.8) {
                    word = "" + word;
                    spanishSentenceTracker = "!";
                }
            }
        }
        else if ((Math.random() < 0.1 &&
            lastChar != "." &&
            lastChar != "," &&
            index != maxindex - 2) ||
            index == maxindex - 1) {
            if (currentLanguage == "spanish" || currentLanguage == "catalan") {
                if (spanishSentenceTracker == "?" || spanishSentenceTracker == "!") {
                    word += spanishSentenceTracker;
                    spanishSentenceTracker = "";
                }
            }
            else {
                const rand = Math.random();
                if (rand <= 0.8) {
                    word += ".";
                }
                else if (rand > 0.8 && rand < 0.9) {
                    if (currentLanguage == "french") {
                        word = "?";
                    }
                    else if (currentLanguage == "arabic" ||
                        currentLanguage == "persian" ||
                        currentLanguage == "urdu") {
                        word += "";
                    }
                    else if (currentLanguage == "greek") {
                        word += ";";
                    }
                    else {
                        word += "?";
                    }
                }
                else {
                    if (currentLanguage == "french") {
                        word = "!";
                    }
                    else {
                        word += "!";
                    }
                }
            }
        }
        else if (Math.random() < 0.01 &&
            lastChar != "," &&
            lastChar != "." &&
            currentLanguage !== "russian") {
            word = `"${word}"`;
        }
        else if (Math.random() < 0.011 &&
            lastChar != "," &&
            lastChar != "." &&
            currentLanguage !== "russian" &&
            currentLanguage !== "ukrainian") {
            word = `'${word}'`;
        }
        else if (Math.random() < 0.012 && lastChar != "," && lastChar != ".") {
            if (currentLanguage == "code") {
                const r = Math.random();
                if (r < 0.25) {
                    word = `(${word})`;
                }
                else if (r < 0.5) {
                    word = `{${word}}`;
                }
                else if (r < 0.75) {
                    word = `[${word}]`;
                }
                else {
                    word = `<${word}>`;
                }
            }
            else {
                word = `(${word})`;
            }
        }
        else if (Math.random() < 0.013 &&
            lastChar != "," &&
            lastChar != "." &&
            lastChar != ";" &&
            lastChar != "" &&
            lastChar != ":") {
            if (currentLanguage == "french") {
                word = ":";
            }
            else if (currentLanguage == "greek") {
                word = "";
            }
            else {
                word += ":";
            }
        }
        else if (Math.random() < 0.014 &&
            lastChar != "," &&
            lastChar != "." &&
            previousWord != "-") {
            word = "-";
        }
        else if (Math.random() < 0.015 &&
            lastChar != "," &&
            lastChar != "." &&
            lastChar != ";" &&
            lastChar != "" &&
            lastChar != ":") {
            if (currentLanguage == "french") {
                word = ";";
            }
            else if (currentLanguage == "greek") {
                word = "";
            }
            else if (currentLanguage == "arabic") {
                word += "";
            }
            else {
                word += ";";
            }
        }
        else if (Math.random() < 0.2 && lastChar != ",") {
            if (currentLanguage == "arabic" ||
                currentLanguage == "urdu" ||
                currentLanguage == "persian") {
                word += "";
            }
            else {
                word += ",";
            }
        }
        else if (Math.random() < 0.25 && currentLanguage == "code") {
            const specials = ["{", "}", "[", "]", "(", ")", ";", "=", "+", "%", "/"];
            word = Misc.randomElementFromArray(specials);
        }
    }
    return word;
}
exports.punctuateWord = punctuateWord;
function startTest() {
    if (PageTransition.get()) {
        return false;
    }
    if (!UpdateConfig.dbConfigLoaded) {
        UpdateConfig.setChangedBeforeDb(true);
    }
    if (firebase_1.Auth.currentUser !== null) {
        AnalyticsController.log("testStarted");
    }
    else {
        AnalyticsController.log("testStartedNoLogin");
    }
    TestActive.set(true);
    Replay.startReplayRecording();
    Replay.replayGetWordsList(TestWords.words.list);
    TestInput.resetKeypressTimings();
    TimerProgress.restart();
    TimerProgress.show();
    $("#liveWpm").text("0");
    LiveWpm.show();
    LiveAcc.show();
    LiveBurst.show();
    TimerProgress.update();
    TestTimer.clear();
    Monkey.show();
    if (config_1.default.funbox === "memory") {
        Funbox.resetMemoryTimer();
        $("#wordsWrapper").addClass("hidden");
    }
    try {
        if (config_1.default.paceCaret !== "off" ||
            (config_1.default.repeatedPace && TestState.isPaceRepeat)) {
            PaceCaret.start();
        }
    }
    catch (e) { }
    //use a recursive self-adjusting timer to avoid time drift
    TestStats.setStart(performance.now());
    TestTimer.start();
    return true;
}
exports.startTest = startTest;
function restart(withSameWordset = false, _, // this is nosave and should be renamed to nosave when needed
event, practiseMissed = false, noAnim = false) {
    if (TestUI.testRestarting || TestUI.resultCalculating) {
        event === null || event === void 0 ? void 0 : event.preventDefault();
        return;
    }
    if (ActivePage.get() == "test" && !TestUI.resultVisible) {
        if (!ManualRestart.get()) {
            if (TestWords.hasTab) {
                if (!(event === null || event === void 0 ? void 0 : event.shiftKey))
                    return;
            }
            if (config_1.default.mode !== "zen")
                event === null || event === void 0 ? void 0 : event.preventDefault();
            if (!Misc.canQuickRestart(config_1.default.mode, config_1.default.words, config_1.default.time, CustomText)) {
                let message = "Use your mouse to confirm.";
                if (config_1.default.quickTab) {
                    message = "Press shift + tab or use your mouse to confirm.";
                }
                Notifications.add("Quick restart disabled. " + message, 0, 3);
                return;
            }
            // }else{
            //   return;
            // }
        }
    }
    if (TestActive.get()) {
        TestInput.pushKeypressesToHistory();
        const testSeconds = TestStats.calculateTestSeconds(performance.now());
        const afkseconds = TestStats.calculateAfkSeconds(testSeconds);
        // incompleteTestSeconds += ;
        let tt = testSeconds - afkseconds;
        if (tt < 0)
            tt = 0;
        console.log(`increasing incomplete time by ${tt}s (${testSeconds}s - ${afkseconds}s afk)`);
        TestStats.incrementIncompleteSeconds(tt);
        TestStats.incrementRestartCount();
        if (tt > 600) {
            Notifications.add(`Your time typing just increased by ${Misc.roundTo2(tt / 60)} minutes. If you think this is incorrect please contact Miodec and dont refresh the website.`, -1);
        }
        // restartCount++;
    }
    if (config_1.default.mode == "zen") {
        $("#words").empty();
    }
    if (PractiseWords.before.mode !== null &&
        !withSameWordset &&
        !practiseMissed) {
        Notifications.add("Reverting to previous settings.", 0);
        if (PractiseWords.before.punctuation !== null) {
            UpdateConfig.setPunctuation(PractiseWords.before.punctuation);
        }
        if (PractiseWords.before.numbers !== null) {
            UpdateConfig.setNumbers(PractiseWords.before.numbers);
        }
        UpdateConfig.setMode(PractiseWords.before.mode);
        PractiseWords.resetBefore();
    }
    let repeatWithPace = false;
    if (TestUI.resultVisible && config_1.default.repeatedPace && withSameWordset) {
        repeatWithPace = true;
    }
    ManualRestart.reset();
    TestTimer.clear();
    TestStats.restart();
    TestInput.restart();
    TestInput.corrected.reset();
    ShiftTracker.reset();
    Caret.hide();
    TestActive.set(false);
    Replay.stopReplayRecording();
    LiveWpm.hide();
    LiveAcc.hide();
    LiveBurst.hide();
    TimerProgress.hide();
    Replay.pauseReplay();
    TestInput.setBailout(false);
    PaceCaret.reset();
    Monkey.hide();
    if (config_1.default.showAverage)
        Last10Average.update();
    $("#showWordHistoryButton").removeClass("loaded");
    $("#restartTestButton").blur();
    Funbox.resetMemoryTimer();
    QuoteRatePopup.clearQuoteStats();
    if (ActivePage.get() == "test" && window.scrollY > 0) {
        window.scrollTo({ top: 0, behavior: "smooth" });
    }
    $("#wordsInput").val(" ");
    TestUI.reset();
    $("#timerNumber").css("opacity", 0);
    let el = null;
    if (TestUI.resultVisible) {
        //results are being displayed
        el = $("#result");
    }
    else {
        //words are being displayed
        el = $("#typingTest");
    }
    if (TestUI.resultVisible) {
        if (config_1.default.randomTheme !== "off" &&
            !PageTransition.get()
        // && Config.customThemeId === ""
        ) {
            ThemeController.randomizeTheme();
        }
    }
    TestUI.setResultVisible(false);
    PageTransition.set(true);
    TestUI.setTestRestarting(true);
    el.stop(true, true).animate({
        opacity: 0,
    }, noAnim ? 0 : 125, () => __awaiter(this, void 0, void 0, function* () {
        if (ActivePage.get() == "test")
            Focus.set(false);
        TestUI.focusWords();
        $("#monkey .fast").stop(true, true).css("opacity", 0);
        $("#monkey").stop(true, true).css({ animationDuration: "0s" });
        $("#typingTest").css("opacity", 0).removeClass("hidden");
        $("#wordsInput").val(" ");
        let shouldQuoteRepeat = false;
        if (config_1.default.mode === "quote" &&
            config_1.default.repeatQuotes === "typing" &&
            failReason !== "") {
            shouldQuoteRepeat = true;
        }
        yield Funbox.rememberSettings();
        if (config_1.default.funbox === "arrows") {
            UpdateConfig.setPunctuation(false, true);
            UpdateConfig.setNumbers(false, true);
        }
        else if (config_1.default.funbox === "58008") {
            UpdateConfig.setNumbers(false, true);
        }
        else if (config_1.default.funbox === "specials") {
            UpdateConfig.setPunctuation(false, true);
            UpdateConfig.setNumbers(false, true);
        }
        else if (config_1.default.funbox === "ascii") {
            UpdateConfig.setPunctuation(false, true);
            UpdateConfig.setNumbers(false, true);
        }
        if (withSameWordset &&
            (config_1.default.funbox === "plus_one" || config_1.default.funbox === "plus_two")) {
            Notifications.add("Sorry, this funbox won't work with repeated tests.", 0, 4);
            withSameWordset = false;
        }
        if (!withSameWordset && !shouldQuoteRepeat) {
            TestState.setRepeated(false);
            TestState.setPaceRepeat(repeatWithPace);
            TestWords.setHasTab(false);
            yield init();
            yield PaceCaret.init();
        }
        else {
            TestState.setRepeated(true);
            TestState.setPaceRepeat(repeatWithPace);
            TestActive.set(false);
            Replay.stopReplayRecording();
            TestWords.words.resetCurrentIndex();
            TestInput.input.reset();
            TestUI.showWords();
            if (config_1.default.keymapMode === "next" && config_1.default.mode !== "zen") {
                Keymap.highlightKey(TestWords.words
                    .getCurrent()
                    .substring(TestInput.input.current.length, TestInput.input.current.length + 1)
                    .toString()
                    .toUpperCase());
            }
            Funbox.toggleScript(TestWords.words.getCurrent());
            yield PaceCaret.init();
        }
        failReason = "";
        if (config_1.default.mode === "quote") {
            TestState.setRepeated(false);
        }
        if (config_1.default.keymapMode !== "off") {
            Keymap.show();
        }
        else {
            Keymap.hide();
        }
        (document.querySelector("#miniTimerAndLiveWpm .wpm")).innerHTML = "0";
        (document.querySelector("#miniTimerAndLiveWpm .acc")).innerHTML = "100%";
        (document.querySelector("#miniTimerAndLiveWpm .burst")).innerHTML = "0";
        document.querySelector("#liveWpm").innerHTML = "0";
        document.querySelector("#liveAcc").innerHTML = "100%";
        document.querySelector("#liveBurst").innerHTML = "0";
        if (config_1.default.funbox === "memory") {
            Funbox.startMemoryTimer();
            if (config_1.default.keymapMode === "next") {
                UpdateConfig.setKeymapMode("react");
            }
        }
        const mode2 = Misc.getMode2(config_1.default, TestWords.randomQuote);
        let fbtext = "";
        if (config_1.default.funbox !== "none") {
            fbtext = " " + config_1.default.funbox;
        }
        $(".pageTest #premidTestMode").text(`${config_1.default.mode} ${mode2} ${config_1.default.language.replace(/_/g, " ")}${fbtext}`);
        $(".pageTest #premidSecondsLeft").text(config_1.default.time);
        if (config_1.default.funbox === "layoutfluid") {
            UpdateConfig.setLayout(config_1.default.customLayoutfluid
                ? config_1.default.customLayoutfluid.split("#")[0]
                : "qwerty", true);
            UpdateConfig.setKeymapLayout(config_1.default.customLayoutfluid
                ? config_1.default.customLayoutfluid.split("#")[0]
                : "qwerty", true);
            Keymap.highlightKey(TestWords.words
                .getCurrent()
                .substring(TestInput.input.current.length, TestInput.input.current.length + 1)
                .toString()
                .toUpperCase());
        }
        $("#result").addClass("hidden");
        $("#testModesNotice").removeClass("hidden").css({
            opacity: 1,
        });
        // resetPaceCaret();
        ModesNotice.update();
        $("#typingTest")
            .css("opacity", 0)
            .removeClass("hidden")
            .stop(true, true)
            .animate({
            opacity: 1,
        }, noAnim ? 0 : 125, () => {
            TestUI.setTestRestarting(false);
            // resetPaceCaret();
            PbCrown.hide();
            TestTimer.clear();
            if ($("#commandLineWrapper").hasClass("hidden")) {
                TestUI.focusWords();
            }
            // ChartController.result.update();
            PageTransition.set(false);
            // console.log(TestStats.incompleteSeconds);
            // console.log(TestStats.restartCount);
        });
    }));
}
exports.restart = restart;
function applyFunboxesToWord(word, wordset) {
    var _a;
    if (config_1.default.funbox === "rAnDoMcAsE") {
        let randomcaseword = "";
        for (let i = 0; i < word.length; i++) {
            if (i % 2 != 0) {
                randomcaseword += word[i].toUpperCase();
            }
            else {
                randomcaseword += word[i];
            }
        }
        word = randomcaseword;
    }
    else if (config_1.default.funbox === "capitals") {
        word = Misc.capitalizeFirstLetterOfEachWord(word);
    }
    else if (config_1.default.funbox === "gibberish") {
        word = Misc.getGibberish();
    }
    else if (config_1.default.funbox === "arrows") {
        word = Misc.getArrows();
    }
    else if (config_1.default.funbox === "58008") {
        word = Misc.getNumbers(7);
    }
    else if (config_1.default.funbox === "specials") {
        word = Misc.getSpecials();
    }
    else if (config_1.default.funbox === "ascii") {
        word = Misc.getASCII();
    }
    else if (wordset !== undefined && config_1.default.funbox === "weakspot") {
        word = WeakSpot.getWord(wordset);
    }
    else if (wordset !== undefined && config_1.default.funbox === "tbdmode") {
        word = ((_a = (0, tbd_mode_1.getTbdMode)()) === null || _a === void 0 ? void 0 : _a.getWord(wordset)) || word;
    }
    return word;
}
function applyBritishEnglishToWord(word) {
    return __awaiter(this, void 0, void 0, function* () {
        if (config_1.default.britishEnglish && /english/.test(config_1.default.language)) {
            word = yield BritishEnglish.replace(word);
        }
        return word;
    });
}
function applyLazyModeToWord(word, language) {
    if (config_1.default.lazyMode === true && !language.noLazyMode) {
        word = LazyMode.replaceAccents(word, language.accents);
    }
    return word;
}
function getNextWord(wordset, language, wordsBound) {
    var _a, _b;
    return __awaiter(this, void 0, void 0, function* () {
        let randomWord = wordset.randomWord();
        const previousWord = TestWords.words.get(TestWords.words.length - 1, true);
        const previousWord2 = TestWords.words.get(TestWords.words.length - 2, true);
        if (config_1.default.mode === "quote") {
            randomWord =
                (_b = (_a = TestWords.randomQuote.textSplit) === null || _a === void 0 ? void 0 : _a[TestWords.words.length]) !== null && _b !== void 0 ? _b : "";
        }
        else if (config_1.default.mode == "custom" &&
            !CustomText.isWordRandom &&
            !CustomText.isTimeRandom) {
            randomWord = CustomText.text[TestWords.words.length];
        }
        else if (config_1.default.mode == "custom" &&
            (CustomText.isWordRandom || CustomText.isTimeRandom) &&
            (wordset.length < 4 || PractiseWords.before.mode !== null)) {
            randomWord = wordset.randomWord();
        }
        else {
            let regenarationCount = 0; //infinite loop emergency stop button
            while (regenarationCount < 100 &&
                (previousWord == randomWord ||
                    previousWord2 == randomWord ||
                    (!config_1.default.punctuation && randomWord == "I"))) {
                regenarationCount++;
                randomWord = wordset.randomWord();
            }
        }
        if (randomWord === undefined) {
            randomWord = wordset.randomWord();
        }
        randomWord = randomWord.replace(/ +/gm, " ");
        randomWord = randomWord.replace(/^ | $/gm, "");
        randomWord = applyLazyModeToWord(randomWord, language);
        randomWord = yield applyBritishEnglishToWord(randomWord);
        randomWord = applyFunboxesToWord(randomWord, wordset);
        if (config_1.default.punctuation) {
            randomWord = punctuateWord(TestWords.words.get(TestWords.words.length - 1), randomWord, TestWords.words.length, wordsBound);
        }
        if (config_1.default.numbers) {
            if (Math.random() < 0.1) {
                randomWord = Misc.getNumbers(4);
            }
        }
        return randomWord;
    });
}
let rememberLazyMode;
function init() {
    return __awaiter(this, void 0, void 0, function* () {
        TestActive.set(false);
        MonkeyPower.reset();
        Replay.stopReplayRecording();
        TestWords.words.reset();
        TestUI.setCurrentWordElementIndex(0);
        // accuracy = {
        //   correct: 0,
        //   incorrect: 0,
        // };
        TestInput.input.resetHistory();
        TestInput.input.resetCurrent();
        if (ActivePage.get() == "test") {
            yield Funbox.activate();
        }
        let language = yield Misc.getLanguage(config_1.default.language);
        if (language && language.name !== config_1.default.language) {
            UpdateConfig.setLanguage("english");
        }
        if (!language) {
            UpdateConfig.setLanguage("english");
            language = yield Misc.getLanguage(config_1.default.language);
        }
        if (config_1.default.lazyMode === true && language.noLazyMode) {
            rememberLazyMode = true;
            Notifications.add("This language does not support lazy mode.", 0);
            UpdateConfig.setLazyMode(false, true);
        }
        else if (rememberLazyMode === true && !language.noLazyMode) {
            UpdateConfig.setLazyMode(true, true);
        }
        if (config_1.default.lazyMode === false && !language.noLazyMode) {
            rememberLazyMode = false;
        }
        let wordsBound = 100;
        if (config_1.default.showAllLines) {
            if (config_1.default.mode === "quote") {
                wordsBound = 100;
            }
            else if (config_1.default.mode === "custom") {
                if (CustomText.isWordRandom) {
                    wordsBound = CustomText.word;
                }
                else if (CustomText.isTimeRandom) {
                    wordsBound = 100;
                }
                else {
                    wordsBound = CustomText.text.length;
                }
            }
            else if (config_1.default.mode != "time") {
                wordsBound = config_1.default.words;
            }
        }
        else {
            if (config_1.default.mode === "words" && config_1.default.words < wordsBound) {
                wordsBound = config_1.default.words;
            }
            if (config_1.default.mode == "custom" &&
                CustomText.isWordRandom &&
                CustomText.word < wordsBound) {
                wordsBound = CustomText.word;
            }
            if (config_1.default.mode == "custom" && CustomText.isTimeRandom) {
                wordsBound = 100;
            }
            if (config_1.default.mode == "custom" &&
                !CustomText.isWordRandom &&
                !CustomText.isTimeRandom &&
                CustomText.text.length < wordsBound) {
                wordsBound = CustomText.text.length;
            }
        }
        if ((config_1.default.mode === "custom" &&
            CustomText.isWordRandom &&
            CustomText.word == 0) ||
            (config_1.default.mode === "custom" &&
                CustomText.isTimeRandom &&
                CustomText.time == 0)) {
            wordsBound = 100;
        }
        if (config_1.default.mode === "words" && config_1.default.words === 0) {
            wordsBound = 100;
        }
        if (config_1.default.funbox === "plus_one") {
            wordsBound = 2;
            if (config_1.default.mode === "words" && config_1.default.words < wordsBound) {
                wordsBound = config_1.default.words;
            }
        }
        if (config_1.default.funbox === "plus_two") {
            wordsBound = 3;
            if (config_1.default.mode === "words" && config_1.default.words < wordsBound) {
                wordsBound = config_1.default.words;
            }
        }
        if (config_1.default.mode == "time" ||
            config_1.default.mode == "words" ||
            config_1.default.mode == "custom") {
            let wordList = language.words;
            if (config_1.default.mode == "custom") {
                wordList = CustomText.text;
            }
            const wordset = Wordset.withWords(wordList, config_1.default.funbox);
            if ((config_1.default.funbox == "wikipedia" || config_1.default.funbox == "poetry") &&
                config_1.default.mode != "custom") {
                let wordCount = 0;
                // If mode is words, get as many sections as you need until the wordCount is fullfilled
                while ((config_1.default.mode == "words" && config_1.default.words >= wordCount) ||
                    (config_1.default.mode === "time" && wordCount < 100)) {
                    const section = config_1.default.funbox == "wikipedia"
                        ? yield Wikipedia.getSection(config_1.default.language)
                        : yield Poetry.getPoem();
                    if (section === undefined)
                        continue;
                    for (const word of section.words) {
                        if (wordCount >= config_1.default.words && config_1.default.mode == "words") {
                            wordCount++;
                            break;
                        }
                        wordCount++;
                        TestWords.words.push(word);
                    }
                }
            }
            else {
                for (let i = 0; i < wordsBound; i++) {
                    const randomWord = yield getNextWord(wordset, language, wordsBound);
                    if (/\t/g.test(randomWord)) {
                        TestWords.setHasTab(true);
                    }
                    if (/ +/.test(randomWord)) {
                        const randomList = randomWord.split(" ");
                        let id = 0;
                        while (id < randomList.length) {
                            TestWords.words.push(randomList[id]);
                            id++;
                            if (TestWords.words.length == wordsBound &&
                                config_1.default.mode == "custom" &&
                                CustomText.isWordRandom) {
                                break;
                            }
                        }
                        if (config_1.default.mode == "custom" &&
                            !CustomText.isWordRandom &&
                            !CustomText.isTimeRandom) {
                            //
                        }
                        else {
                            i = TestWords.words.length - 1;
                        }
                    }
                    else {
                        TestWords.words.push(randomWord);
                    }
                }
            }
        }
        else if (config_1.default.mode === "quote") {
            const quotesCollection = yield quotes_controller_1.default.getQuotes(config_1.default.language, config_1.default.quoteLength);
            if (quotesCollection.length === 0) {
                TestUI.setTestRestarting(false);
                Notifications.add(`No ${config_1.default.language.replace(/_\d*k$/g, "")} quotes found`, 0);
                if (firebase_1.Auth.currentUser) {
                    QuoteSubmitPopup.show(false);
                }
                UpdateConfig.setMode("words");
                restart();
                return;
            }
            let rq = undefined;
            if (config_1.default.quoteLength.includes(-2) && config_1.default.quoteLength.length == 1) {
                const targetQuote = quotes_controller_1.default.getQuoteById(QuoteSearchPopup.selectedId);
                if (targetQuote === undefined) {
                    rq = quotesCollection.groups[0][0];
                    Notifications.add("Quote Id Does Not Exist", 0);
                }
                else {
                    rq = targetQuote;
                }
            }
            else {
                const randomQuote = quotes_controller_1.default.getRandomQuote();
                if (randomQuote === null) {
                    Notifications.add("No quotes found for selected quote length", 0);
                    TestUI.setTestRestarting(false);
                    return;
                }
                rq = randomQuote;
            }
            if (rq === undefined)
                return;
            rq.text = rq.text.replace(/ +/gm, " ");
            rq.text = rq.text.replace(/\\\\t/gm, "\t");
            rq.text = rq.text.replace(/\\\\n/gm, "\n");
            rq.text = rq.text.replace(/\\t/gm, "\t");
            rq.text = rq.text.replace(/\\n/gm, "\n");
            rq.text = rq.text.replace(/( *(\r\n|\r|\n) *)/g, "\n ");
            rq.text = rq.text.replace(//g, "...");
            rq.text = rq.text.trim();
            rq.textSplit = rq.text.split(" ");
            rq.language = config_1.default.language.replace(/_\d*k$/g, "");
            TestWords.setRandomQuote(rq);
            const w = TestWords.randomQuote.textSplit;
            if (w === undefined)
                return;
            if (config_1.default.showAllLines) {
                wordsBound = w.length;
            }
            else {
                wordsBound = Math.min(wordsBound, w.length);
            }
            for (let i = 0; i < wordsBound; i++) {
                if (/\t/g.test(w[i])) {
                    TestWords.setHasTab(true);
                }
                w[i] = applyLazyModeToWord(w[i], language);
                w[i] = yield applyBritishEnglishToWord(w[i]);
                w[i] = applyFunboxesToWord(w[i]);
                TestWords.words.push(w[i]);
            }
        }
        //handle right-to-left languages
        if (language.leftToRight) {
            TestUI.arrangeCharactersLeftToRight();
        }
        else {
            TestUI.arrangeCharactersRightToLeft();
        }
        if (language.ligatures) {
            $("#words").addClass("withLigatures");
            $("#resultWordsHistory .words").addClass("withLigatures");
            $("#resultReplay .words").addClass("withLigatures");
        }
        else {
            $("#words").removeClass("withLigatures");
            $("#resultWordsHistory .words").removeClass("withLigatures");
            $("#resultReplay .words").removeClass("withLigatures");
        }
        // if (Config.mode == "zen") {
        //   // Creating an empty active word element for zen mode
        //   $("#words").append('<div class="word active"></div>');
        //   $("#words").css("height", "auto");
        //   $("#wordsWrapper").css("height", "auto");
        // } else {
        TestUI.showWords();
        if (config_1.default.keymapMode === "next" && config_1.default.mode !== "zen") {
            Keymap.highlightKey(TestWords.words
                .getCurrent()
                .substring(TestInput.input.current.length, TestInput.input.current.length + 1)
                .toString()
                .toUpperCase());
        }
        Funbox.toggleScript(TestWords.words.getCurrent());
        // }
    });
}
exports.init = init;
function addWord() {
    var _a, _b;
    return __awaiter(this, void 0, void 0, function* () {
        let bound = 100;
        if (config_1.default.funbox === "plus_one")
            bound = 1;
        if (config_1.default.funbox === "plus_two")
            bound = 2;
        if (TestWords.words.length - TestInput.input.history.length > bound ||
            (config_1.default.mode === "words" &&
                TestWords.words.length >= config_1.default.words &&
                config_1.default.words > 0) ||
            (config_1.default.mode === "custom" &&
                CustomText.isWordRandom &&
                TestWords.words.length >= CustomText.word &&
                CustomText.word != 0) ||
            (config_1.default.mode === "custom" &&
                !CustomText.isWordRandom &&
                !CustomText.isTimeRandom &&
                TestWords.words.length >= CustomText.text.length) ||
            (config_1.default.mode === "quote" &&
                TestWords.words.length >= ((_b = (_a = TestWords.randomQuote.textSplit) === null || _a === void 0 ? void 0 : _a.length) !== null && _b !== void 0 ? _b : 0))) {
            return;
        }
        if (config_1.default.funbox === "wikipedia" || config_1.default.funbox == "poetry") {
            if (TestWords.words.length - TestWords.words.currentIndex < 20) {
                const section = config_1.default.funbox == "wikipedia"
                    ? yield Wikipedia.getSection(config_1.default.language)
                    : yield Poetry.getPoem();
                if (section === undefined)
                    return;
                let wordCount = 0;
                for (const word of section.words) {
                    if (wordCount >= config_1.default.words && config_1.default.mode == "words") {
                        break;
                    }
                    wordCount++;
                    TestWords.words.push(word);
                    TestUI.addWord(word);
                }
            }
            else {
                return;
            }
        }
        const language = config_1.default.mode !== "custom"
            ? yield Misc.getCurrentLanguage(config_1.default.language)
            : Object.assign(Object.assign({}, (yield Misc.getCurrentLanguage(config_1.default.language))), { words: CustomText.text });
        const wordset = Wordset.withWords(language.words, config_1.default.funbox);
        const randomWord = yield getNextWord(wordset, language, bound);
        const split = randomWord.split(" ");
        if (split.length > 1) {
            split.forEach((word) => {
                TestWords.words.push(word);
                TestUI.addWord(word);
            });
        }
        else {
            TestWords.words.push(randomWord);
            TestUI.addWord(randomWord);
        }
    });
}
exports.addWord = addWord;
const retrySaving = {
    completedEvent: null,
    canRetry: false,
};
function retrySavingResult() {
    return __awaiter(this, void 0, void 0, function* () {
        const { completedEvent } = retrySaving;
        if (completedEvent === null) {
            Notifications.add("Could not retry saving the result as the result no longer exists.", 0, -1);
            return;
        }
        if (!retrySaving.canRetry) {
            return;
        }
        retrySaving.canRetry = false;
        $("#retrySavingResultButton").addClass("hidden");
        AccountButton.loading(true);
        Notifications.add("Retrying to save...");
        const response = yield ape_1.default.results.save(completedEvent);
        AccountButton.loading(false);
        Result.hideCrown();
        if (response.status !== 200) {
            retrySaving.canRetry = true;
            $("#retrySavingResultButton").removeClass("hidden");
            return Notifications.add("Result not saved. " + response.message, -1);
        }
        completedEvent._id = response.data.insertedId;
        if (response.data.isPb) {
            completedEvent.isPb = true;
        }
        DB.saveLocalResult(completedEvent);
        DB.updateLocalStats({
            time: completedEvent.testDuration +
                completedEvent.incompleteTestSeconds -
                completedEvent.afkDuration,
            started: TestStats.restartCount + 1,
        });
        AnalyticsController.log("testCompleted");
        if (response.data.isPb) {
            //new pb
            Result.showCrown();
            Result.updateCrown();
            DB.saveLocalPB(config_1.default.mode, completedEvent.mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode, completedEvent.wpm, completedEvent.acc, completedEvent.rawWpm, completedEvent.consistency);
        }
        $("#retrySavingResultButton").addClass("hidden");
        Notifications.add("Result saved", 1);
    });
}
exports.retrySavingResult = retrySavingResult;
function buildCompletedEvent(difficultyFailed) {
    var _a, _b, _c;
    //build completed event object
    const completedEvent = {
        wpm: undefined,
        rawWpm: undefined,
        charStats: undefined,
        acc: undefined,
        mode: config_1.default.mode,
        mode2: undefined,
        quoteLength: -1,
        punctuation: config_1.default.punctuation,
        numbers: config_1.default.numbers,
        lazyMode: config_1.default.lazyMode,
        timestamp: Date.now(),
        language: config_1.default.language,
        restartCount: TestStats.restartCount,
        incompleteTestSeconds: TestStats.incompleteSeconds < 0
            ? 0
            : Misc.roundTo2(TestStats.incompleteSeconds),
        difficulty: config_1.default.difficulty,
        blindMode: config_1.default.blindMode,
        tags: undefined,
        keySpacing: TestInput.keypressTimings.spacing.array,
        keyDuration: TestInput.keypressTimings.duration.array,
        consistency: undefined,
        keyConsistency: undefined,
        funbox: config_1.default.funbox,
        bailedOut: TestInput.bailout,
        chartData: {
            wpm: TestInput.wpmHistory,
            raw: undefined,
            err: undefined,
        },
        customText: undefined,
        testDuration: undefined,
        afkDuration: undefined,
    };
    // stats
    const stats = TestStats.calculateStats();
    if (stats.time % 1 != 0 && config_1.default.mode !== "time") {
        TestStats.setLastSecondNotRound();
    }
    TestStats.setLastTestWpm(stats.wpm);
    completedEvent.wpm = stats.wpm;
    completedEvent.rawWpm = stats.wpmRaw;
    completedEvent.charStats = [
        stats.correctChars + stats.correctSpaces,
        stats.incorrectChars,
        stats.extraChars,
        stats.missedChars,
    ];
    completedEvent.acc = stats.acc;
    // if the last second was not rounded, add another data point to the history
    if (TestStats.lastSecondNotRound && !difficultyFailed) {
        const wpmAndRaw = TestStats.calculateWpmAndRaw();
        TestInput.pushToWpmHistory(wpmAndRaw.wpm);
        TestInput.pushToRawHistory(wpmAndRaw.raw);
        TestInput.pushKeypressesToHistory();
    }
    //consistency
    const rawPerSecond = TestInput.keypressPerSecond.map((f) => Math.round((f.count / 5) * 60));
    const stddev = Misc.stdDev(rawPerSecond);
    const avg = Misc.mean(rawPerSecond);
    let consistency = Misc.roundTo2(Misc.kogasa(stddev / avg));
    let keyConsistencyArray = TestInput.keypressTimings.spacing.array === "toolong"
        ? []
        : TestInput.keypressTimings.spacing.array.slice();
    if (keyConsistencyArray.length > 0) {
        keyConsistencyArray = keyConsistencyArray.slice(0, keyConsistencyArray.length - 1);
    }
    let keyConsistency = Misc.roundTo2(Misc.kogasa(Misc.stdDev(keyConsistencyArray) / Misc.mean(keyConsistencyArray)));
    if (!consistency || isNaN(consistency)) {
        consistency = 0;
    }
    if (!keyConsistency || isNaN(keyConsistency)) {
        keyConsistency = 0;
    }
    completedEvent.keyConsistency = keyConsistency;
    completedEvent.consistency = consistency;
    const smoothedraw = Misc.smooth(rawPerSecond, 1);
    completedEvent.chartData.raw = smoothedraw;
    completedEvent.chartData.unsmoothedRaw = rawPerSecond;
    //smoothed consistency
    const stddev2 = Misc.stdDev(smoothedraw);
    const avg2 = Misc.mean(smoothedraw);
    const smoothConsistency = Misc.roundTo2(Misc.kogasa(stddev2 / avg2));
    completedEvent.smoothConsistency = smoothConsistency;
    //wpm consistency
    const stddev3 = Misc.stdDev((_a = completedEvent.chartData.wpm) !== null && _a !== void 0 ? _a : []);
    const avg3 = Misc.mean((_b = completedEvent.chartData.wpm) !== null && _b !== void 0 ? _b : []);
    const wpmConsistency = Misc.roundTo2(Misc.kogasa(stddev3 / avg3));
    completedEvent.wpmConsistency = wpmConsistency;
    completedEvent.testDuration = parseFloat(stats.time.toString());
    completedEvent.afkDuration = TestStats.calculateAfkSeconds(completedEvent.testDuration);
    completedEvent.chartData.err = [];
    for (let i = 0; i < TestInput.keypressPerSecond.length; i++) {
        completedEvent.chartData.err.push(TestInput.keypressPerSecond[i].errors);
    }
    if (config_1.default.mode === "quote") {
        completedEvent.quoteLength = TestWords.randomQuote.group;
        completedEvent.lang = config_1.default.language.replace(/_\d*k$/g, "");
    }
    // @ts-ignore TODO fix this
    completedEvent.mode2 = Misc.getMode2(config_1.default, TestWords.randomQuote);
    if (config_1.default.mode === "custom") {
        completedEvent.customText = {};
        completedEvent.customText.textLen = CustomText.text.length;
        completedEvent.customText.isWordRandom = CustomText.isWordRandom;
        completedEvent.customText.isTimeRandom = CustomText.isTimeRandom;
        completedEvent.customText.word = CustomText.word;
        completedEvent.customText.time = CustomText.time;
    }
    else {
        delete completedEvent.customText;
    }
    //tags
    const activeTagsIds = [];
    try {
        (_c = DB.getSnapshot().tags) === null || _c === void 0 ? void 0 : _c.forEach((tag) => {
            if (tag.active === true) {
                activeTagsIds.push(tag._id);
            }
        });
    }
    catch (e) { }
    completedEvent.tags = activeTagsIds;
    if (completedEvent.mode != "custom")
        delete completedEvent.customText;
    return completedEvent;
}
function finish(difficultyFailed = false) {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        if (!TestActive.get())
            return;
        if (config_1.default.mode == "zen" && TestInput.input.current.length != 0) {
            TestInput.input.pushHistory();
            TestInput.corrected.pushHistory();
            Replay.replayGetWordsList(TestInput.input.history);
        }
        TestInput.recordKeypressSpacing(); //this is needed in case there is afk time at the end - to make sure test duration makes sense
        TestUI.setResultCalculating(true);
        TestUI.setResultVisible(true);
        TestStats.setEnd(performance.now());
        TestActive.set(false);
        Replay.stopReplayRecording();
        Focus.set(false);
        Caret.hide();
        LiveWpm.hide();
        PbCrown.hide();
        LiveAcc.hide();
        LiveBurst.hide();
        TimerProgress.hide();
        OutOfFocus.hide();
        TestTimer.clear();
        Funbox.clear();
        Monkey.hide();
        //need one more calculation for the last word if test auto ended
        if (TestInput.burstHistory.length !== TestInput.input.getHistory().length) {
            const burst = TestStats.calculateBurst();
            TestInput.pushBurstToHistory(burst);
        }
        //remove afk from zen
        if (config_1.default.mode == "zen" || TestInput.bailout) {
            TestStats.removeAfkData();
        }
        const completedEvent = buildCompletedEvent(difficultyFailed);
        //todo check if any fields are undefined
        ///////// completed event ready
        //afk check
        const kps = TestInput.keypressPerSecond.slice(-5);
        let afkDetected = kps.every((second) => second.afk);
        if (TestInput.bailout)
            afkDetected = false;
        let tooShort = false;
        let dontSave = false;
        //fail checks
        if (difficultyFailed) {
            Notifications.add(`Test failed - ${failReason}`, 0, 1);
            dontSave = true;
        }
        else if (afkDetected) {
            Notifications.add("Test invalid - AFK detected", 0);
            dontSave = true;
        }
        else if (TestState.isRepeated) {
            Notifications.add("Test invalid - repeated", 0);
            dontSave = true;
        }
        else if ((config_1.default.mode === "time" &&
            completedEvent.mode2 < 15 &&
            completedEvent.mode2 > 0) ||
            (config_1.default.mode === "time" &&
                completedEvent.mode2 == 0 &&
                completedEvent.testDuration < 15) ||
            (config_1.default.mode === "words" &&
                completedEvent.mode2 < 10 &&
                completedEvent.mode2 > 0) ||
            (config_1.default.mode === "words" &&
                completedEvent.mode2 == 0 &&
                completedEvent.testDuration < 15) ||
            (config_1.default.mode === "custom" &&
                !CustomText.isWordRandom &&
                !CustomText.isTimeRandom &&
                CustomText.text.length < 10) ||
            (config_1.default.mode === "custom" &&
                CustomText.isWordRandom &&
                !CustomText.isTimeRandom &&
                CustomText.word < 10) ||
            (config_1.default.mode === "custom" &&
                !CustomText.isWordRandom &&
                CustomText.isTimeRandom &&
                CustomText.time < 15) ||
            (config_1.default.mode === "zen" && completedEvent.testDuration < 15)) {
            Notifications.add("Test invalid - too short", 0);
            tooShort = true;
            dontSave = true;
        }
        else if (completedEvent.wpm < 0 || completedEvent.wpm > 350) {
            Notifications.add("Test invalid - wpm", 0);
            TestStats.setInvalid();
            dontSave = true;
        }
        else if (completedEvent.acc < 75 || completedEvent.acc > 100) {
            Notifications.add("Test invalid - accuracy", 0);
            TestStats.setInvalid();
            dontSave = true;
        }
        // test is valid
        if (!dontSave) {
            TodayTracker.addSeconds(completedEvent.testDuration +
                (TestStats.incompleteSeconds < 0
                    ? 0
                    : Misc.roundTo2(TestStats.incompleteSeconds)) -
                completedEvent.afkDuration);
            Result.updateTodayTracker();
        }
        if (firebase_1.Auth.currentUser == null) {
            $(".pageTest #result #rateQuoteButton").addClass("hidden");
            $(".pageTest #result #reportQuoteButton").addClass("hidden");
            AnalyticsController.log("testCompletedNoLogin");
            if (!dontSave)
                exports.notSignedInLastResult = completedEvent;
            dontSave = true;
        }
        else {
            $(".pageTest #result #reportQuoteButton").removeClass("hidden");
        }
        yield Result.update(completedEvent, difficultyFailed, failReason, afkDetected, TestState.isRepeated, tooShort, TestWords.randomQuote, dontSave);
        if (completedEvent.chartData !== "toolong") {
            delete completedEvent.chartData.unsmoothedRaw;
        }
        if (completedEvent.testDuration > 122) {
            completedEvent.chartData = "toolong";
            completedEvent.keySpacing = "toolong";
            completedEvent.keyDuration = "toolong";
            TestInput.setKeypressTimingsTooLong();
        }
        if (dontSave) {
            AnalyticsController.log("testCompletedInvalid");
            return;
        }
        // user is logged in
        if (config_1.default.difficulty == "normal" ||
            ((config_1.default.difficulty == "master" || config_1.default.difficulty == "expert") &&
                !difficultyFailed)) {
            TestStats.resetIncomplete();
        }
        completedEvent.uid = (_a = firebase_1.Auth.currentUser) === null || _a === void 0 ? void 0 : _a.uid;
        Result.updateRateQuote(TestWords.randomQuote);
        AccountButton.loading(true);
        completedEvent.challenge = ChallengeContoller.verify(completedEvent);
        if (completedEvent.challenge === null)
            completedEvent === null || completedEvent === void 0 ? true : delete completedEvent.challenge;
        completedEvent.hash = (0, object_hash_1.default)(completedEvent);
        const response = yield ape_1.default.results.save(completedEvent);
        AccountButton.loading(false);
        if (response.status !== 200) {
            console.log("Error saving result", completedEvent);
            $("#retrySavingResultButton").removeClass("hidden");
            if (response.message === "Incorrect result hash") {
                console.log(completedEvent);
            }
            retrySaving.completedEvent = completedEvent;
            retrySaving.canRetry = true;
            return Notifications.add("Failed to save result: " + response.message, -1);
        }
        Result.hideCrown();
        completedEvent._id = response.data.insertedId;
        if (response.data.isPb) {
            completedEvent.isPb = true;
        }
        DB.saveLocalResult(completedEvent);
        DB.updateLocalStats({
            time: completedEvent.testDuration +
                completedEvent.incompleteTestSeconds -
                completedEvent.afkDuration,
            started: TestStats.restartCount + 1,
        });
        AnalyticsController.log("testCompleted");
        if (response.data.isPb) {
            //new pb
            Result.showCrown();
            Result.updateCrown();
            DB.saveLocalPB(config_1.default.mode, completedEvent.mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode, completedEvent.wpm, completedEvent.acc, completedEvent.rawWpm, completedEvent.consistency);
        }
        $("#retrySavingResultButton").addClass("hidden");
    });
}
exports.finish = finish;
function fail(reason) {
    failReason = reason;
    // input.pushHistory();
    // corrected.pushHistory();
    TestInput.pushKeypressesToHistory();
    finish(true);
    const testSeconds = TestStats.calculateTestSeconds(performance.now());
    const afkseconds = TestStats.calculateAfkSeconds(testSeconds);
    let tt = testSeconds - afkseconds;
    if (tt < 0)
        tt = 0;
    TestStats.incrementIncompleteSeconds(tt);
    TestStats.incrementRestartCount();
}
exports.fail = fail;
$(document).on("click", "#testModesNotice .text-button.restart", () => {
    restart();
});
$(document).on("keypress", "#restartTestButton", (event) => {
    if (event.key === "Enter") {
        ManualRestart.reset();
        if (TestActive.get() &&
            config_1.default.repeatQuotes === "typing" &&
            config_1.default.mode === "quote") {
            restart(true);
        }
        else {
            restart();
        }
    }
});
$(document.body).on("click", "#restartTestButton", () => {
    ManualRestart.set();
    if (TestUI.resultCalculating)
        return;
    if (TestActive.get() &&
        config_1.default.repeatQuotes === "typing" &&
        config_1.default.mode === "quote") {
        restart(true);
    }
    else {
        restart();
    }
});
$(document.body).on("click", "#retrySavingResultButton", retrySavingResult);
$(document).on("keypress", "#nextTestButton", (event) => {
    if (event.key === "Enter") {
        restart();
    }
});
$(document.body).on("click", "#nextTestButton", () => {
    ManualRestart.set();
    restart();
});
$(document.body).on("click", "#restartTestButtonWithSameWordset", () => {
    if (config_1.default.mode == "zen") {
        Notifications.add("Repeat test disabled in zen mode");
        return;
    }
    ManualRestart.set();
    restart(true);
});
$(document).on("keypress", "#restartTestButtonWithSameWordset", (event) => {
    if (config_1.default.mode == "zen") {
        Notifications.add("Repeat test disabled in zen mode");
        return;
    }
    if (event.key === "Enter") {
        restart(true);
    }
});
$(document).on("click", "#top .config .wordCount .text-button", (e) => {
    var _a;
    const wrd = (_a = $(e.currentTarget).attr("wordCount")) !== null && _a !== void 0 ? _a : "15";
    if (wrd != "custom") {
        UpdateConfig.setWordCount(parseInt(wrd));
        ManualRestart.set();
        restart();
    }
});
$(document).on("click", "#top .config .time .text-button", (e) => {
    var _a;
    const mode = (_a = $(e.currentTarget).attr("timeConfig")) !== null && _a !== void 0 ? _a : "10";
    if (mode != "custom") {
        UpdateConfig.setTimeConfig(parseInt(mode));
        ManualRestart.set();
        restart();
    }
});
$(document).on("click", "#top .config .quoteLength .text-button", (e) => {
    var _a;
    let len = parseInt((_a = $(e.currentTarget).attr("quoteLength")) !== null && _a !== void 0 ? _a : "1");
    if (len != -2) {
        if (len == -1) {
            len = [0, 1, 2, 3];
        }
        UpdateConfig.setQuoteLength(len, false, e.shiftKey);
        ManualRestart.set();
        restart();
    }
});
$(document).on("click", "#top .config .punctuationMode .text-button", () => {
    UpdateConfig.setPunctuation(!config_1.default.punctuation);
    ManualRestart.set();
    restart();
});
$(document).on("click", "#top .config .numbersMode .text-button", () => {
    UpdateConfig.setNumbers(!config_1.default.numbers);
    ManualRestart.set();
    restart();
});
$(document).on("click", "#top .config .mode .text-button", (e) => {
    var _a;
    if ($(e.currentTarget).hasClass("active"))
        return;
    const mode = ((_a = $(e.currentTarget).attr("mode")) !== null && _a !== void 0 ? _a : "time");
    if (mode === undefined)
        return;
    UpdateConfig.setMode(mode);
    ManualRestart.set();
    restart();
});
$("#practiseWordsPopup .button.missed").on("click", () => {
    PractiseWords.hidePopup();
    PractiseWords.init(true, false);
    restart(false, false, undefined, true);
});
$("#practiseWordsPopup .button.slow").on("click", () => {
    PractiseWords.hidePopup();
    PractiseWords.init(false, true);
    restart(false, false, undefined, true);
});
$("#practiseWordsPopup .button.both").on("click", () => {
    PractiseWords.hidePopup();
    PractiseWords.init(true, true);
    restart(false, false, undefined, true);
});
$(document).on("click", "#quoteSearchPopup #quoteSearchResults .searchResult", (e) => {
    var _a;
    if (e.target.classList.contains("report")) {
        return;
    }
    const sid = parseInt((_a = $(e.currentTarget).attr("id")) !== null && _a !== void 0 ? _a : "");
    QuoteSearchPopup.setSelectedId(sid);
    if (QuoteSearchPopup.apply(sid) === true)
        restart();
});
$(document).on("click", "#top #menu #startTestButton, #top .logo", () => {
    if (ActivePage.get() === "test")
        restart();
});
// ===============================
ConfigEvent.subscribe((eventKey, eventValue, nosave) => {
    if (eventKey === "difficulty" && !nosave)
        restart(false, nosave);
    if (eventKey === "showAllLines" && !nosave)
        restart();
    if (eventKey === "keymapMode" && !nosave)
        restart(false, nosave);
    if (eventKey === "lazyMode" && eventValue === false && !nosave) {
        rememberLazyMode = false;
    }
});
TimerEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "fail" && eventValue !== undefined)
        fail(eventValue);
    if (eventKey === "finish")
        finish();
});
ResetRequestedEvent.subscribe(() => {
    restart();
});


/***/ }),

/***/ "./src/scripts/test/test-state.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-state.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.setActiveChallenge = exports.setPaceRepeat = exports.setRepeated = exports.activeChallenge = exports.isPaceRepeat = exports.isRepeated = void 0;
exports.isRepeated = false;
exports.isPaceRepeat = false;
exports.activeChallenge = null;
function setRepeated(tf) {
    exports.isRepeated = tf;
}
exports.setRepeated = setRepeated;
function setPaceRepeat(tf) {
    exports.isPaceRepeat = tf;
}
exports.setPaceRepeat = setPaceRepeat;
function setActiveChallenge(val) {
    exports.activeChallenge = val;
}
exports.setActiveChallenge = setActiveChallenge;


/***/ }),

/***/ "./src/scripts/test/test-stats.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-stats.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.calculateStats = exports.removeAfkData = exports.calculateAccuracy = exports.calculateBurst = exports.setLastSecondNotRound = exports.calculateAfkSeconds = exports.setStart = exports.setEnd = exports.calculateWpmAndRaw = exports.calculateTestSeconds = exports.setInvalid = exports.resetIncomplete = exports.incrementIncompleteSeconds = exports.incrementRestartCount = exports.incompleteSeconds = exports.restartCount = exports.restart = exports.getStats = exports.setLastTestWpm = exports.lastTestWpm = exports.lastSecondNotRound = exports.end2 = exports.start2 = exports.end = exports.start = exports.invalid = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
exports.invalid = false;
exports.lastSecondNotRound = false;
exports.lastTestWpm = 0;
function setLastTestWpm(wpm) {
    exports.lastTestWpm = wpm;
}
exports.setLastTestWpm = setLastTestWpm;
function getStats() {
    const ret = {
        start: exports.start,
        end: exports.end,
        wpmHistory: TestInput.wpmHistory,
        rawHistory: TestInput.wpmHistory,
        burstHistory: TestInput.burstHistory,
        keypressPerSecond: TestInput.keypressPerSecond,
        currentKeypress: TestInput.currentKeypress,
        lastKeypress: TestInput.lastKeypress,
        currentBurstStart: TestInput.currentBurstStart,
        lastSecondNotRound: exports.lastSecondNotRound,
        missedWords: TestInput.missedWords,
        accuracy: TestInput.accuracy,
        keypressTimings: TestInput.keypressTimings,
    };
    try {
        ret.keySpacingStats = {
            average: TestInput.keypressTimings.spacing.array.reduce((previous, current) => (current += previous)) / TestInput.keypressTimings.spacing.array.length,
            sd: Misc.stdDev(TestInput.keypressTimings.spacing.array),
        };
    }
    catch (e) {
        //
    }
    try {
        ret.keyDurationStats = {
            average: TestInput.keypressTimings.duration.array.reduce((previous, current) => (current += previous)) / TestInput.keypressTimings.duration.array.length,
            sd: Misc.stdDev(TestInput.keypressTimings.duration.array),
        };
    }
    catch (e) {
        //
    }
    return ret;
}
exports.getStats = getStats;
function restart() {
    exports.start = 0;
    exports.end = 0;
    exports.invalid = false;
    exports.lastSecondNotRound = false;
}
exports.restart = restart;
exports.restartCount = 0;
exports.incompleteSeconds = 0;
function incrementRestartCount() {
    exports.restartCount++;
}
exports.incrementRestartCount = incrementRestartCount;
function incrementIncompleteSeconds(val) {
    exports.incompleteSeconds += val;
}
exports.incrementIncompleteSeconds = incrementIncompleteSeconds;
function resetIncomplete() {
    exports.restartCount = 0;
    exports.incompleteSeconds = 0;
}
exports.resetIncomplete = resetIncomplete;
function setInvalid() {
    exports.invalid = true;
}
exports.setInvalid = setInvalid;
function calculateTestSeconds(now) {
    if (now === undefined) {
        const endAfkSeconds = (exports.end - TestInput.lastKeypress) / 1000;
        if ((config_1.default.mode == "zen" || TestInput.bailout) && endAfkSeconds < 7) {
            return (TestInput.lastKeypress - exports.start) / 1000;
        }
        else {
            return (exports.end - exports.start) / 1000;
        }
    }
    else {
        return (now - exports.start) / 1000;
    }
}
exports.calculateTestSeconds = calculateTestSeconds;
function calculateWpmAndRaw() {
    let chars = 0;
    let correctWordChars = 0;
    let spaces = 0;
    //check input history
    for (let i = 0; i < TestInput.input.history.length; i++) {
        const word = config_1.default.mode == "zen"
            ? TestInput.input.getHistory(i)
            : TestWords.words.get(i);
        if (TestInput.input.getHistory(i) == word) {
            //the word is correct
            //+1 for space
            correctWordChars += word.length;
            if (i < TestInput.input.history.length - 1 &&
                Misc.getLastChar(TestInput.input.getHistory(i)) !== "\n") {
                spaces++;
            }
        }
        chars += TestInput.input.getHistory(i).length;
    }
    if (TestInput.input.current !== "") {
        const word = config_1.default.mode == "zen"
            ? TestInput.input.current
            : TestWords.words.getCurrent();
        //check whats currently typed
        const toAdd = {
            correct: 0,
            incorrect: 0,
            missed: 0,
        };
        for (let c = 0; c < word.length; c++) {
            if (c < TestInput.input.current.length) {
                //on char that still has a word list pair
                if (TestInput.input.current[c] == word[c]) {
                    toAdd.correct++;
                }
                else {
                    toAdd.incorrect++;
                }
            }
            else {
                //on char that is extra
                toAdd.missed++;
            }
        }
        chars += toAdd.correct;
        chars += toAdd.incorrect;
        chars += toAdd.missed;
        if (toAdd.incorrect == 0) {
            //word is correct so far, add chars
            correctWordChars += toAdd.correct;
        }
    }
    if (config_1.default.funbox === "nospace" || config_1.default.funbox === "arrows") {
        spaces = 0;
    }
    chars += TestInput.input.current.length;
    const testSeconds = calculateTestSeconds(performance.now());
    const wpm = Math.round(((correctWordChars + spaces) * (60 / testSeconds)) / 5);
    const raw = Math.round(((chars + spaces) * (60 / testSeconds)) / 5);
    return {
        wpm: wpm,
        raw: raw,
    };
}
exports.calculateWpmAndRaw = calculateWpmAndRaw;
function setEnd(e) {
    exports.end = e;
    exports.end2 = Date.now();
}
exports.setEnd = setEnd;
function setStart(s) {
    exports.start = s;
    exports.start2 = Date.now();
}
exports.setStart = setStart;
function calculateAfkSeconds(testSeconds) {
    let extraAfk = 0;
    if (testSeconds !== undefined) {
        if (config_1.default.mode === "time") {
            extraAfk = Math.round(testSeconds) - TestInput.keypressPerSecond.length;
        }
        else {
            extraAfk = Math.ceil(testSeconds) - TestInput.keypressPerSecond.length;
        }
        if (extraAfk < 0)
            extraAfk = 0;
        // console.log("-- extra afk debug");
        // console.log("should be " + Math.ceil(testSeconds));
        // console.log(keypressPerSecond.length);
        // console.log(
        //   `gonna add extra ${extraAfk} seconds of afk because of no keypress data`
        // );
    }
    const ret = TestInput.keypressPerSecond.filter((x) => x.afk).length;
    return ret + extraAfk;
}
exports.calculateAfkSeconds = calculateAfkSeconds;
function setLastSecondNotRound() {
    exports.lastSecondNotRound = true;
}
exports.setLastSecondNotRound = setLastSecondNotRound;
function calculateBurst() {
    const timeToWrite = (performance.now() - TestInput.currentBurstStart) / 1000;
    let wordLength;
    wordLength = TestInput.input.current.length;
    if (wordLength == 0) {
        wordLength = TestInput.input.getHistoryLast().length;
    }
    const speed = Misc.roundTo2((wordLength * (60 / timeToWrite)) / 5);
    return Math.round(speed);
}
exports.calculateBurst = calculateBurst;
function calculateAccuracy() {
    const acc = (TestInput.accuracy.correct /
        (TestInput.accuracy.correct + TestInput.accuracy.incorrect)) *
        100;
    return isNaN(acc) ? 100 : acc;
}
exports.calculateAccuracy = calculateAccuracy;
function removeAfkData() {
    const testSeconds = calculateTestSeconds();
    TestInput.keypressPerSecond.splice(testSeconds);
    TestInput.keypressTimings.duration.array.splice(testSeconds);
    TestInput.keypressTimings.spacing.array.splice(testSeconds);
    TestInput.wpmHistory.splice(testSeconds);
}
exports.removeAfkData = removeAfkData;
function countChars() {
    let correctWordChars = 0;
    let correctChars = 0;
    let incorrectChars = 0;
    let extraChars = 0;
    let missedChars = 0;
    let spaces = 0;
    let correctspaces = 0;
    for (let i = 0; i < TestInput.input.history.length; i++) {
        const word = config_1.default.mode == "zen"
            ? TestInput.input.getHistory(i)
            : TestWords.words.get(i);
        if (TestInput.input.getHistory(i) === "") {
            //last word that was not started
            continue;
        }
        if (TestInput.input.getHistory(i) == word) {
            //the word is correct
            correctWordChars += word.length;
            correctChars += word.length;
            if (i < TestInput.input.history.length - 1 &&
                Misc.getLastChar(TestInput.input.getHistory(i)) !== "\n") {
                correctspaces++;
            }
        }
        else if (TestInput.input.getHistory(i).length >= word.length) {
            //too many chars
            for (let c = 0; c < TestInput.input.getHistory(i).length; c++) {
                if (c < word.length) {
                    //on char that still has a word list pair
                    if (TestInput.input.getHistory(i)[c] == word[c]) {
                        correctChars++;
                    }
                    else {
                        incorrectChars++;
                    }
                }
                else {
                    //on char that is extra
                    extraChars++;
                }
            }
        }
        else {
            //not enough chars
            const toAdd = {
                correct: 0,
                incorrect: 0,
                missed: 0,
            };
            for (let c = 0; c < word.length; c++) {
                if (c < TestInput.input.getHistory(i).length) {
                    //on char that still has a word list pair
                    if (TestInput.input.getHistory(i)[c] == word[c]) {
                        toAdd.correct++;
                    }
                    else {
                        toAdd.incorrect++;
                    }
                }
                else {
                    //on char that is extra
                    toAdd.missed++;
                }
            }
            correctChars += toAdd.correct;
            incorrectChars += toAdd.incorrect;
            if (i === TestInput.input.history.length - 1 && config_1.default.mode == "time") {
                //last word - check if it was all correct - add to correct word chars
                if (toAdd.incorrect === 0)
                    correctWordChars += toAdd.correct;
            }
            else {
                missedChars += toAdd.missed;
            }
        }
        if (i < TestInput.input.history.length - 1) {
            spaces++;
        }
    }
    if (config_1.default.funbox === "nospace" || config_1.default.funbox === "arrows") {
        spaces = 0;
        correctspaces = 0;
    }
    return {
        spaces: spaces,
        correctWordChars: correctWordChars,
        allCorrectChars: correctChars,
        incorrectChars: config_1.default.mode == "zen" ? TestInput.accuracy.incorrect : incorrectChars,
        extraChars: extraChars,
        missedChars: missedChars,
        correctSpaces: correctspaces,
    };
}
function calculateStats() {
    let testSeconds = calculateTestSeconds();
    // console.log((end2 - start2) / 1000);
    // console.log(testSeconds);
    if (config_1.default.mode != "custom") {
        testSeconds = Misc.roundTo2(testSeconds);
    }
    const chars = countChars();
    const wpm = Misc.roundTo2(((chars.correctWordChars + chars.correctSpaces) * (60 / testSeconds)) / 5);
    const wpmraw = Misc.roundTo2(((chars.allCorrectChars +
        chars.spaces +
        chars.incorrectChars +
        chars.extraChars) *
        (60 / testSeconds)) /
        5);
    const acc = Misc.roundTo2(calculateAccuracy());
    return {
        wpm: isNaN(wpm) ? 0 : wpm,
        wpmRaw: isNaN(wpmraw) ? 0 : wpmraw,
        acc: acc,
        correctChars: chars.correctWordChars,
        incorrectChars: chars.incorrectChars,
        missedChars: chars.missedChars,
        extraChars: chars.extraChars,
        allChars: chars.allCorrectChars +
            chars.spaces +
            chars.incorrectChars +
            chars.extraChars,
        time: Misc.roundTo2(testSeconds),
        spaces: chars.spaces,
        correctSpaces: chars.correctSpaces,
    };
}
exports.calculateStats = calculateStats;


/***/ }),

/***/ "./src/scripts/test/test-timer.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-timer.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


//most of the code is thanks to
//https://stackoverflow.com/questions/29971898/how-to-create-an-accurate-timer-in-javascript
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.start = exports.getTimerStats = exports.clear = exports.enableTimerDebug = void 0;
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const CustomText = __importStar(__webpack_require__(/*! ./custom-text */ "./src/scripts/test/custom-text.ts"));
const TimerProgress = __importStar(__webpack_require__(/*! ./timer-progress */ "./src/scripts/test/timer-progress.ts"));
const LiveWpm = __importStar(__webpack_require__(/*! ./live-wpm */ "./src/scripts/test/live-wpm.ts"));
const TestStats = __importStar(__webpack_require__(/*! ./test-stats */ "./src/scripts/test/test-stats.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const Monkey = __importStar(__webpack_require__(/*! ./monkey */ "./src/scripts/test/monkey.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Caret = __importStar(__webpack_require__(/*! ./caret */ "./src/scripts/test/caret.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const Time = __importStar(__webpack_require__(/*! ../states/time */ "./src/scripts/states/time.ts"));
const TimerEvent = __importStar(__webpack_require__(/*! ../observables/timer-event */ "./src/scripts/observables/timer-event.ts"));
let slowTimerCount = 0;
let timer = null;
const interval = 1000;
let expected = 0;
let timerDebug = false;
function enableTimerDebug() {
    timerDebug = true;
}
exports.enableTimerDebug = enableTimerDebug;
function clear() {
    Time.set(0);
    if (timer !== null)
        clearTimeout(timer);
}
exports.clear = clear;
function premid() {
    if (timerDebug)
        console.time("premid");
    const premidSecondsLeft = document.querySelector("#premidSecondsLeft");
    if (premidSecondsLeft !== null) {
        premidSecondsLeft.innerHTML = (config_1.default.time - Time.get()).toString();
    }
    if (timerDebug)
        console.timeEnd("premid");
}
function updateTimer() {
    if (timerDebug)
        console.time("timer progress update");
    if (config_1.default.mode === "time" ||
        (config_1.default.mode === "custom" && CustomText.isTimeRandom)) {
        TimerProgress.update();
    }
    if (timerDebug)
        console.timeEnd("timer progress update");
}
function calculateWpmRaw() {
    if (timerDebug)
        console.time("calculate wpm and raw");
    const wpmAndRaw = TestStats.calculateWpmAndRaw();
    if (timerDebug)
        console.timeEnd("calculate wpm and raw");
    if (timerDebug)
        console.time("update live wpm");
    LiveWpm.update(wpmAndRaw.wpm, wpmAndRaw.raw);
    if (timerDebug)
        console.timeEnd("update live wpm");
    if (timerDebug)
        console.time("push to history");
    TestInput.pushToWpmHistory(wpmAndRaw.wpm);
    TestInput.pushToRawHistory(wpmAndRaw.raw);
    if (timerDebug)
        console.timeEnd("push to history");
    return wpmAndRaw;
}
function monkey(wpmAndRaw) {
    if (timerDebug)
        console.time("update monkey");
    const num = config_1.default.blindMode ? wpmAndRaw.raw : wpmAndRaw.wpm;
    Monkey.updateFastOpacity(num);
    if (timerDebug)
        console.timeEnd("update monkey");
}
function calculateAcc() {
    if (timerDebug)
        console.time("calculate acc");
    const acc = Misc.roundTo2(TestStats.calculateAccuracy());
    if (timerDebug)
        console.timeEnd("calculate acc");
    return acc;
}
function layoutfluid() {
    if (timerDebug)
        console.time("layoutfluid");
    if (config_1.default.funbox === "layoutfluid" && config_1.default.mode === "time") {
        const layouts = config_1.default.customLayoutfluid
            ? config_1.default.customLayoutfluid.split("#")
            : ["qwerty", "dvorak", "colemak"];
        const switchTime = config_1.default.time / layouts.length;
        const time = Time.get();
        const index = Math.floor(time / switchTime);
        const layout = layouts[index];
        const flooredSwitchTimes = [];
        for (let i = 1; i < layouts.length; i++) {
            flooredSwitchTimes.push(Math.floor(switchTime * i));
        }
        if (flooredSwitchTimes.includes(time + 3)) {
            Notifications.add("3", 0, 1);
        }
        else if (flooredSwitchTimes.includes(time + 2)) {
            Notifications.add("2", 0, 1);
        }
        else if (flooredSwitchTimes.includes(time + 1)) {
            Notifications.add("1", 0, 1);
        }
        if (config_1.default.layout !== layout && layout !== undefined) {
            Notifications.add(`--- !!! ${layout} !!! ---`, 0);
            UpdateConfig.setLayout(layout, true);
            UpdateConfig.setKeymapLayout(layout, true);
        }
    }
    if (timerDebug)
        console.timeEnd("layoutfluid");
}
function checkIfFailed(wpmAndRaw, acc) {
    if (timerDebug)
        console.time("fail conditions");
    TestInput.pushKeypressesToHistory();
    if (config_1.default.minWpm === "custom" &&
        wpmAndRaw.wpm < config_1.default.minWpmCustomSpeed &&
        TestWords.words.currentIndex > 3) {
        if (timer !== null)
            clearTimeout(timer);
        SlowTimer.clear();
        slowTimerCount = 0;
        TimerEvent.dispatch("fail", "min wpm");
        return;
    }
    if (config_1.default.minAcc === "custom" &&
        acc < config_1.default.minAccCustom &&
        TestWords.words.currentIndex > 3) {
        if (timer !== null)
            clearTimeout(timer);
        SlowTimer.clear();
        slowTimerCount = 0;
        TimerEvent.dispatch("fail", "min accuracy");
        return;
    }
    if (timerDebug)
        console.timeEnd("fail conditions");
}
function checkIfTimeIsUp() {
    if (timerDebug)
        console.time("times up check");
    if (config_1.default.mode == "time" ||
        (config_1.default.mode === "custom" && CustomText.isTimeRandom)) {
        if ((Time.get() >= config_1.default.time &&
            config_1.default.time !== 0 &&
            config_1.default.mode === "time") ||
            (Time.get() >= CustomText.time &&
                CustomText.time !== 0 &&
                config_1.default.mode === "custom")) {
            //times up
            if (timer !== null)
                clearTimeout(timer);
            Caret.hide();
            TestInput.input.pushHistory();
            TestInput.corrected.pushHistory();
            SlowTimer.clear();
            slowTimerCount = 0;
            TimerEvent.dispatch("finish");
            return;
        }
    }
    if (timerDebug)
        console.timeEnd("times up check");
}
// ---------------------------------------
let timerStats = [];
function getTimerStats() {
    return timerStats;
}
exports.getTimerStats = getTimerStats;
function timerStep() {
    return __awaiter(this, void 0, void 0, function* () {
        if (timerDebug)
            console.time("timer step -----------------------------");
        Time.increment();
        premid();
        updateTimer();
        const wpmAndRaw = calculateWpmRaw();
        const acc = calculateAcc();
        monkey(wpmAndRaw);
        layoutfluid();
        checkIfFailed(wpmAndRaw, acc);
        checkIfTimeIsUp();
        if (timerDebug)
            console.timeEnd("timer step -----------------------------");
    });
}
function start() {
    return __awaiter(this, void 0, void 0, function* () {
        SlowTimer.clear();
        slowTimerCount = 0;
        timerStats = [];
        expected = TestStats.start + interval;
        (function loop() {
            const delay = expected - performance.now();
            timerStats.push({
                dateNow: Date.now(),
                now: performance.now(),
                expected: expected,
                nextDelay: delay,
            });
            if ((config_1.default.mode === "time" && config_1.default.time < 130 && config_1.default.time > 0) ||
                (config_1.default.mode === "words" && config_1.default.words < 250 && config_1.default.words > 0)) {
                if (delay < interval / 2) {
                    //slow timer
                    SlowTimer.set();
                }
                if (delay < interval / 10) {
                    slowTimerCount++;
                    if (slowTimerCount > 5) {
                        //slow timer
                        if (window.navigator.userAgent.includes("Edg")) {
                            Notifications.add('This bad performance could be caused by "efficiency mode" on Microsoft Edge.');
                        }
                        Notifications.add("Stopping the test due to bad performance. This would cause test calculations to be incorrect. If this happens a lot, please report this.", -1);
                        TimerEvent.dispatch("fail", "slow timer");
                    }
                }
            }
            timer = setTimeout(function () {
                // time++;
                if (!TestActive.get()) {
                    if (timer !== null)
                        clearTimeout(timer);
                    SlowTimer.clear();
                    slowTimerCount = 0;
                    return;
                }
                timerStep();
                expected += interval;
                loop();
            }, delay);
        })();
    });
}
exports.start = start;


/***/ }),

/***/ "./src/scripts/test/test-ui.ts":
/*!*************************************!*\
  !*** ./src/scripts/test/test-ui.ts ***!
  \*************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.highlightBadWord = exports.applyBurstHeatmap = exports.toggleResultWords = exports.arrangeCharactersLeftToRight = exports.arrangeCharactersRightToLeft = exports.lineJump = exports.updateWordElement = exports.screenshot = exports.colorful = exports.flipColors = exports.addWord = exports.showWords = exports.updateActiveElement = exports.focusWords = exports.reset = exports.setResultCalculating = exports.setTestRestarting = exports.setActiveWordTop = exports.setCurrentWordElementIndex = exports.setResultVisible = exports.resultCalculating = exports.currentTestLine = exports.lineTransition = exports.testRestartingPromise = exports.testRestarting = exports.activeWordTop = exports.resultVisible = exports.currentWordElementIndex = void 0;
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const CustomText = __importStar(__webpack_require__(/*! ./custom-text */ "./src/scripts/test/custom-text.ts"));
const Caret = __importStar(__webpack_require__(/*! ./caret */ "./src/scripts/test/caret.ts"));
const OutOfFocus = __importStar(__webpack_require__(/*! ./out-of-focus */ "./src/scripts/test/out-of-focus.ts"));
const Replay = __importStar(__webpack_require__(/*! ./replay */ "./src/scripts/test/replay.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventValue === undefined || typeof eventValue !== "boolean")
        return;
    if (eventKey === "flipTestColors")
        flipColors(eventValue);
    if (eventKey === "colorfulMode")
        colorful(eventValue);
    if (eventKey === "highlightMode")
        updateWordElement(eventValue);
    if (eventKey === "burstHeatmap")
        applyBurstHeatmap();
});
exports.currentWordElementIndex = 0;
exports.resultVisible = false;
exports.activeWordTop = 0;
exports.testRestarting = false;
exports.lineTransition = false;
exports.currentTestLine = 0;
exports.resultCalculating = false;
function setResultVisible(val) {
    exports.resultVisible = val;
}
exports.setResultVisible = setResultVisible;
function setCurrentWordElementIndex(val) {
    exports.currentWordElementIndex = val;
}
exports.setCurrentWordElementIndex = setCurrentWordElementIndex;
function setActiveWordTop(val) {
    exports.activeWordTop = val;
}
exports.setActiveWordTop = setActiveWordTop;
let restartingResolve;
function setTestRestarting(val) {
    exports.testRestarting = val;
    if (val === true) {
        exports.testRestartingPromise = new Promise((resolve) => {
            restartingResolve = resolve;
        });
    }
    else {
        if (restartingResolve)
            restartingResolve();
        restartingResolve = null;
    }
}
exports.setTestRestarting = setTestRestarting;
function setResultCalculating(val) {
    exports.resultCalculating = val;
}
exports.setResultCalculating = setResultCalculating;
function reset() {
    exports.currentTestLine = 0;
    exports.currentWordElementIndex = 0;
}
exports.reset = reset;
function focusWords() {
    if (!$("#wordsWrapper").hasClass("hidden")) {
        $("#wordsInput").trigger("focus");
    }
}
exports.focusWords = focusWords;
function updateActiveElement(backspace) {
    const active = document.querySelector("#words .active");
    if (config_1.default.mode == "zen" && backspace) {
        active === null || active === void 0 ? void 0 : active.remove();
    }
    else if (active !== null) {
        if (config_1.default.highlightMode == "word") {
            active.querySelectorAll("letter").forEach((e) => {
                e.classList.remove("correct");
            });
        }
        active.classList.remove("active");
    }
    try {
        const activeWord = document.querySelectorAll("#words .word")[exports.currentWordElementIndex];
        activeWord.classList.add("active");
        activeWord.classList.remove("error");
        exports.activeWordTop = document.querySelector("#words .active")
            .offsetTop;
        if (config_1.default.highlightMode == "word") {
            activeWord.querySelectorAll("letter").forEach((e) => {
                e.classList.add("correct");
            });
        }
    }
    catch (e) { }
}
exports.updateActiveElement = updateActiveElement;
function getWordHTML(word) {
    let newlineafter = false;
    let retval = `<div class='word'>`;
    for (let c = 0; c < word.length; c++) {
        if (config_1.default.funbox === "arrows") {
            if (word.charAt(c) === "") {
                retval += `<letter><i class="fas fa-arrow-up"></i></letter>`;
            }
            if (word.charAt(c) === "") {
                retval += `<letter><i class="fas fa-arrow-down"></i></letter>`;
            }
            if (word.charAt(c) === "") {
                retval += `<letter><i class="fas fa-arrow-left"></i></letter>`;
            }
            if (word.charAt(c) === "") {
                retval += `<letter><i class="fas fa-arrow-right"></i></letter>`;
            }
        }
        else if (word.charAt(c) === "\t") {
            retval += `<letter class='tabChar'><i class="fas fa-long-arrow-alt-right"></i></letter>`;
        }
        else if (word.charAt(c) === "\n") {
            newlineafter = true;
            retval += `<letter class='nlChar'><i class="fas fa-angle-down"></i></letter>`;
        }
        else {
            retval += "<letter>" + word.charAt(c) + "</letter>";
        }
    }
    retval += "</div>";
    if (newlineafter)
        retval += "<div class='newline'></div>";
    return retval;
}
function showWords() {
    $("#words").empty();
    let wordsHTML = "";
    if (config_1.default.mode !== "zen") {
        for (let i = 0; i < TestWords.words.length; i++) {
            wordsHTML += getWordHTML(TestWords.words.get(i));
        }
    }
    else {
        wordsHTML =
            '<div class="word">word height</div><div class="word active"></div>';
    }
    $("#words").html(wordsHTML);
    $("#wordsWrapper").removeClass("hidden");
    const wordHeight = ($(document.querySelector(".word")).outerHeight(true));
    const wordsHeight = ($(document.querySelector("#words")).outerHeight(true));
    if (config_1.default.showAllLines &&
        config_1.default.mode != "time" &&
        !(CustomText.isWordRandom && CustomText.word == 0) &&
        !CustomText.isTimeRandom) {
        $("#words").css("height", "auto");
        $("#wordsWrapper").css("height", "auto");
        let nh = wordHeight * 3;
        if (nh > wordsHeight) {
            nh = wordsHeight;
        }
        $(".outOfFocusWarning").css("line-height", nh + "px");
    }
    else {
        $("#words")
            .css("height", wordHeight * 4 + "px")
            .css("overflow", "hidden");
        $("#wordsWrapper")
            .css("height", wordHeight * 3 + "px")
            .css("overflow", "hidden");
        $(".outOfFocusWarning").css("line-height", wordHeight * 3 + "px");
    }
    if (config_1.default.mode === "zen") {
        $(document.querySelector(".word")).remove();
    }
    updateActiveElement();
    Caret.updatePosition();
}
exports.showWords = showWords;
function addWord(word) {
    $("#words").append(getWordHTML(word));
}
exports.addWord = addWord;
function flipColors(tf) {
    if (tf) {
        $("#words").addClass("flipped");
    }
    else {
        $("#words").removeClass("flipped");
    }
}
exports.flipColors = flipColors;
function colorful(tc) {
    if (tc) {
        $("#words").addClass("colorfulMode");
    }
    else {
        $("#words").removeClass("colorfulMode");
    }
}
exports.colorful = colorful;
function screenshot() {
    return __awaiter(this, void 0, void 0, function* () {
        let revealReplay = false;
        function revertScreenshot() {
            $("#notificationCenter").removeClass("hidden");
            $("#commandLineMobileButton").removeClass("hidden");
            $(".pageTest .ssWatermark").addClass("hidden");
            $(".pageTest .ssWatermark").text("monkeytype.com");
            $(".pageTest .buttons").removeClass("hidden");
            if (revealReplay)
                $("#resultReplay").removeClass("hidden");
            if (firebase_1.Auth.currentUser == null) {
                $(".pageTest .loginTip").removeClass("hidden");
            }
        }
        if (!$("#resultReplay").hasClass("hidden")) {
            revealReplay = true;
            Replay.pauseReplay();
        }
        const dateNow = new Date(Date.now());
        $("#resultReplay").addClass("hidden");
        $(".pageTest .ssWatermark").removeClass("hidden");
        $(".pageTest .ssWatermark").text((0, format_1.default)(dateNow, "dd MMM yyyy HH:mm") + " | monkeytype.com ");
        if (firebase_1.Auth.currentUser != null) {
            $(".pageTest .ssWatermark").text(DB.getSnapshot().name +
                " | " +
                (0, format_1.default)(dateNow, "dd MMM yyyy HH:mm") +
                " | monkeytype.com  ");
        }
        $(".pageTest .buttons").addClass("hidden");
        const src = $("#middle");
        const sourceX = src.position().left; /*X position from div#target*/
        const sourceY = src.position().top; /*Y position from div#target*/
        const sourceWidth = (src.outerWidth(true)); /*clientWidth/offsetWidth from div#target*/
        const sourceHeight = (src.outerHeight(true)); /*clientHeight/offsetHeight from div#target*/
        $("#notificationCenter").addClass("hidden");
        $("#commandLineMobileButton").addClass("hidden");
        $(".pageTest .loginTip").addClass("hidden");
        try {
            const paddingX = 50;
            const paddingY = 25;
            html2canvas(document.body, {
                backgroundColor: yield ThemeColors.get("bg"),
                width: sourceWidth + paddingX * 2,
                height: sourceHeight + paddingY * 2,
                x: sourceX - paddingX,
                y: sourceY - paddingY,
            }).then((canvas) => {
                canvas.toBlob((blob) => {
                    try {
                        if (blob === null)
                            return;
                        if (navigator.userAgent.toLowerCase().indexOf("firefox") > -1) {
                            open(URL.createObjectURL(blob));
                            revertScreenshot();
                        }
                        else {
                            navigator.clipboard
                                .write([
                                new ClipboardItem(Object.defineProperty({}, blob.type, {
                                    value: blob,
                                    enumerable: true,
                                })),
                            ])
                                .then(() => {
                                Notifications.add("Copied to clipboard", 1, 2);
                                revertScreenshot();
                            });
                        }
                    }
                    catch (e) {
                        Notifications.add("Error saving image to clipboard: " + e.message, -1);
                        revertScreenshot();
                    }
                });
            });
        }
        catch (e) {
            Notifications.add("Error creating image: " + e.message, -1);
            revertScreenshot();
        }
        setTimeout(() => {
            revertScreenshot();
        }, 3000);
    });
}
exports.screenshot = screenshot;
function updateWordElement(showError = !config_1.default.blindMode) {
    const input = TestInput.input.current;
    const wordAtIndex = document.querySelector("#words .word.active");
    const currentWord = TestWords.words.getCurrent();
    if (!currentWord && config_1.default.mode !== "zen")
        return;
    let ret = "";
    let newlineafter = false;
    if (config_1.default.mode === "zen") {
        for (let i = 0; i < TestInput.input.current.length; i++) {
            if (TestInput.input.current[i] === "\t") {
                ret += `<letter class='tabChar correct' style="opacity: 0"><i class="fas fa-long-arrow-alt-right"></i></letter>`;
            }
            else if (TestInput.input.current[i] === "\n") {
                newlineafter = true;
                ret += `<letter class='nlChar correct' style="opacity: 0"><i class="fas fa-angle-down"></i></letter>`;
            }
            else {
                ret += `<letter class="correct">${TestInput.input.current[i]}</letter>`;
            }
        }
    }
    else {
        let correctSoFar = false;
        // slice earlier if input has trailing compose characters
        const inputWithoutComposeLength = Misc.trailingComposeChars.test(input)
            ? input.search(Misc.trailingComposeChars)
            : input.length;
        if (input.search(Misc.trailingComposeChars) < currentWord.length &&
            currentWord.slice(0, inputWithoutComposeLength) ===
                input.slice(0, inputWithoutComposeLength)) {
            correctSoFar = true;
        }
        let wordHighlightClassString = correctSoFar ? "correct" : "incorrect";
        if (config_1.default.blindMode) {
            wordHighlightClassString = "correct";
        }
        for (let i = 0; i < input.length; i++) {
            const charCorrect = currentWord[i] == input[i];
            let correctClass = "correct";
            if (config_1.default.highlightMode == "off") {
                correctClass = "";
            }
            let currentLetter = currentWord[i];
            let tabChar = "";
            let nlChar = "";
            if (config_1.default.funbox === "arrows") {
                if (currentLetter === "") {
                    currentLetter = `<i class="fas fa-arrow-up"></i>`;
                }
                if (currentLetter === "") {
                    currentLetter = `<i class="fas fa-arrow-down"></i>`;
                }
                if (currentLetter === "") {
                    currentLetter = `<i class="fas fa-arrow-left"></i>`;
                }
                if (currentLetter === "") {
                    currentLetter = `<i class="fas fa-arrow-right"></i>`;
                }
            }
            else if (currentLetter === "\t") {
                tabChar = "tabChar";
                currentLetter = `<i class="fas fa-long-arrow-alt-right"></i>`;
            }
            else if (currentLetter === "\n") {
                nlChar = "nlChar";
                currentLetter = `<i class="fas fa-angle-down"></i>`;
            }
            if (Misc.trailingComposeChars.test(input) &&
                i > input.search(Misc.trailingComposeChars)) {
                continue;
            }
            if (charCorrect) {
                ret += `<letter class="${config_1.default.highlightMode == "word"
                    ? wordHighlightClassString
                    : correctClass} ${tabChar}${nlChar}">${currentLetter}</letter>`;
            }
            else if (currentLetter !== undefined &&
                Misc.trailingComposeChars.test(input) &&
                i === input.search(Misc.trailingComposeChars)) {
                ret += `<letter class="${config_1.default.highlightMode == "word" ? wordHighlightClassString : ""} dead">${currentLetter}</letter>`;
            }
            else if (!showError) {
                if (currentLetter !== undefined) {
                    ret += `<letter class="${config_1.default.highlightMode == "word"
                        ? wordHighlightClassString
                        : correctClass} ${tabChar}${nlChar}">${currentLetter}</letter>`;
                }
            }
            else if (currentLetter === undefined) {
                if (!config_1.default.hideExtraLetters) {
                    let letter = input[i];
                    if (letter == " " || letter == "\t" || letter == "\n") {
                        letter = "_";
                    }
                    ret += `<letter class="${config_1.default.highlightMode == "word"
                        ? wordHighlightClassString
                        : "incorrect"} extra ${tabChar}${nlChar}">${letter}</letter>`;
                }
            }
            else {
                ret +=
                    `<letter class="${config_1.default.highlightMode == "word"
                        ? wordHighlightClassString
                        : "incorrect"} ${tabChar}${nlChar}">` +
                        (config_1.default.indicateTypos === "replace"
                            ? input[i] == " "
                                ? "_"
                                : input[i]
                            : currentLetter) +
                        (config_1.default.indicateTypos === "below" ? `<hint>${input[i]}</hint>` : "") +
                        "</letter>";
            }
        }
        const inputWithSingleComposeLength = Misc.trailingComposeChars.test(input)
            ? input.search(Misc.trailingComposeChars) + 1
            : input.length;
        if (inputWithSingleComposeLength < currentWord.length) {
            for (let i = inputWithSingleComposeLength; i < currentWord.length; i++) {
                if (config_1.default.funbox === "arrows") {
                    if (currentWord[i] === "") {
                        ret += `<letter><i class="fas fa-arrow-up"></i></letter>`;
                    }
                    if (currentWord[i] === "") {
                        ret += `<letter><i class="fas fa-arrow-down"></i></letter>`;
                    }
                    if (currentWord[i] === "") {
                        ret += `<letter><i class="fas fa-arrow-left"></i></letter>`;
                    }
                    if (currentWord[i] === "") {
                        ret += `<letter><i class="fas fa-arrow-right"></i></letter>`;
                    }
                }
                else if (currentWord[i] === "\t") {
                    ret += `<letter class='tabChar'><i class="fas fa-long-arrow-alt-right"></i></letter>`;
                }
                else if (currentWord[i] === "\n") {
                    ret += `<letter class='nlChar'><i class="fas fa-angle-down"></i></letter>`;
                }
                else {
                    ret +=
                        `<letter class="${config_1.default.highlightMode == "word" ? wordHighlightClassString : ""}">` +
                            currentWord[i] +
                            "</letter>";
                }
            }
        }
        if (config_1.default.highlightMode === "letter" && config_1.default.hideExtraLetters) {
            if (input.length > currentWord.length && !config_1.default.blindMode) {
                $(wordAtIndex).addClass("error");
            }
            else if (input.length == currentWord.length) {
                $(wordAtIndex).removeClass("error");
            }
        }
    }
    wordAtIndex.innerHTML = ret;
    if (newlineafter)
        $("#words").append("<div class='newline'></div>");
}
exports.updateWordElement = updateWordElement;
function lineJump(currentTop) {
    var _a;
    //last word of the line
    if (exports.currentTestLine > 0) {
        const hideBound = currentTop;
        const toHide = [];
        const wordElements = $("#words .word");
        for (let i = 0; i < exports.currentWordElementIndex; i++) {
            if ($(wordElements[i]).hasClass("hidden"))
                continue;
            const forWordTop = Math.floor(wordElements[i].offsetTop);
            if (forWordTop < hideBound - 10) {
                toHide.push($($("#words .word")[i]));
            }
        }
        const wordHeight = ($(document.querySelector(".word")).outerHeight(true));
        if (config_1.default.smoothLineScroll && toHide.length > 0) {
            exports.lineTransition = true;
            $("#words").prepend(`<div class="smoothScroller" style="position: fixed;height:${wordHeight}px;width:100%"></div>`);
            $("#words .smoothScroller").animate({
                height: 0,
            }, SlowTimer.get() ? 0 : 125, () => {
                $("#words .smoothScroller").remove();
            });
            $("#paceCaret").animate({
                top: ((_a = document.querySelector("#paceCaret")) === null || _a === void 0 ? void 0 : _a.offsetTop) -
                    wordHeight,
            }, SlowTimer.get() ? 0 : 125);
            $("#words").animate({
                marginTop: `-${wordHeight}px`,
            }, SlowTimer.get() ? 0 : 125, () => {
                exports.activeWordTop = (document.querySelector("#words .active")).offsetTop;
                exports.currentWordElementIndex -= toHide.length;
                exports.lineTransition = false;
                toHide.forEach((el) => el.remove());
                $("#words").css("marginTop", "0");
            });
        }
        else {
            toHide.forEach((el) => el.remove());
            exports.currentWordElementIndex -= toHide.length;
            $("#paceCaret").css({
                top: document.querySelector("#paceCaret").offsetTop -
                    wordHeight,
            });
        }
    }
    exports.currentTestLine++;
}
exports.lineJump = lineJump;
function arrangeCharactersRightToLeft() {
    $("#words").addClass("rightToLeftTest");
    $("#resultWordsHistory .words").addClass("rightToLeftTest");
    $("#resultReplay .words").addClass("rightToLeftTest");
}
exports.arrangeCharactersRightToLeft = arrangeCharactersRightToLeft;
function arrangeCharactersLeftToRight() {
    $("#words").removeClass("rightToLeftTest");
    $("#resultWordsHistory .words").removeClass("rightToLeftTest");
    $("#resultReplay .words").removeClass("rightToLeftTest");
}
exports.arrangeCharactersLeftToRight = arrangeCharactersLeftToRight;
function loadWordsHistory() {
    return __awaiter(this, void 0, void 0, function* () {
        $("#resultWordsHistory .words").empty();
        let wordsHTML = "";
        for (let i = 0; i < TestInput.input.history.length + 2; i++) {
            const input = TestInput.input.getHistory(i);
            const word = TestWords.words.get(i);
            let wordEl = "";
            try {
                if (input === "")
                    throw new Error("empty input word");
                if (TestInput.corrected.getHistory(i) !== undefined &&
                    TestInput.corrected.getHistory(i) !== "") {
                    wordEl = `<div class='word' burst="${TestInput.burstHistory[i]}" input="${TestInput.corrected
                        .getHistory(i)
                        .replace(/"/g, "&quot;")
                        .replace(/ /g, "_")}">`;
                }
                else {
                    wordEl = `<div class='word' burst="${TestInput.burstHistory[i]}" input="${input.replace(/"/g, "&quot;").replace(/ /g, "_")}">`;
                }
                if (i === TestInput.input.history.length - 1) {
                    //last word
                    const wordstats = {
                        correct: 0,
                        incorrect: 0,
                        missed: 0,
                    };
                    const length = config_1.default.mode == "zen" ? input.length : word.length;
                    for (let c = 0; c < length; c++) {
                        if (c < input.length) {
                            //on char that still has a word list pair
                            if (config_1.default.mode == "zen" || input[c] == word[c]) {
                                wordstats.correct++;
                            }
                            else {
                                wordstats.incorrect++;
                            }
                        }
                        else {
                            //on char that is extra
                            wordstats.missed++;
                        }
                    }
                    if (wordstats.incorrect !== 0 || config_1.default.mode !== "time") {
                        if (config_1.default.mode != "zen" && input !== word) {
                            wordEl = `<div class='word error' burst="${TestInput.burstHistory[i]}" input="${input.replace(/"/g, "&quot;").replace(/ /g, "_")}">`;
                        }
                    }
                }
                else {
                    if (config_1.default.mode != "zen" && input !== word) {
                        wordEl = `<div class='word error' burst="${TestInput.burstHistory[i]}" input="${input.replace(/"/g, "&quot;").replace(/ /g, "_")}">`;
                    }
                }
                let loop;
                if (config_1.default.mode == "zen" || input.length > word.length) {
                    //input is longer - extra characters possible (loop over input)
                    loop = input.length;
                }
                else {
                    //input is shorter or equal (loop over word list)
                    loop = word.length;
                }
                for (let c = 0; c < loop; c++) {
                    let correctedChar;
                    try {
                        correctedChar = TestInput.corrected.getHistory(i)[c];
                    }
                    catch (e) {
                        correctedChar = undefined;
                    }
                    let extraCorrected = "";
                    if (c + 1 === loop &&
                        TestInput.corrected.getHistory(i) !== undefined &&
                        TestInput.corrected.getHistory(i).length > input.length) {
                        extraCorrected = "extraCorrected";
                    }
                    if (config_1.default.mode == "zen" || word[c] !== undefined) {
                        if (config_1.default.mode == "zen" || input[c] === word[c]) {
                            if (correctedChar === input[c] || correctedChar === undefined) {
                                wordEl += `<letter class="correct ${extraCorrected}">${input[c]}</letter>`;
                            }
                            else {
                                wordEl +=
                                    `<letter class="corrected ${extraCorrected}">` +
                                        input[c] +
                                        "</letter>";
                            }
                        }
                        else {
                            if (input[c] === TestInput.input.current) {
                                wordEl +=
                                    `<letter class='correct ${extraCorrected}'>` +
                                        word[c] +
                                        "</letter>";
                            }
                            else if (input[c] === undefined) {
                                wordEl += "<letter>" + word[c] + "</letter>";
                            }
                            else {
                                wordEl +=
                                    `<letter class="incorrect ${extraCorrected}">` +
                                        word[c] +
                                        "</letter>";
                            }
                        }
                    }
                    else {
                        wordEl += '<letter class="incorrect extra">' + input[c] + "</letter>";
                    }
                }
                wordEl += "</div>";
            }
            catch (e) {
                try {
                    wordEl = "<div class='word'>";
                    for (let c = 0; c < word.length; c++) {
                        wordEl += "<letter>" + word[c] + "</letter>";
                    }
                    wordEl += "</div>";
                }
                catch (_a) { }
            }
            wordsHTML += wordEl;
        }
        $("#resultWordsHistory .words").html(wordsHTML);
        $("#showWordHistoryButton").addClass("loaded");
        return true;
    });
}
function toggleResultWords() {
    if (exports.resultVisible) {
        if ($("#resultWordsHistory").stop(true, true).hasClass("hidden")) {
            //show
            if (!$("#showWordHistoryButton").hasClass("loaded")) {
                $("#words").html(`<div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>`);
                loadWordsHistory().then(() => {
                    if (config_1.default.burstHeatmap) {
                        applyBurstHeatmap();
                    }
                    $("#resultWordsHistory")
                        .removeClass("hidden")
                        .css("display", "none")
                        .slideDown(250, () => {
                        if (config_1.default.burstHeatmap) {
                            applyBurstHeatmap();
                        }
                    });
                });
            }
            else {
                if (config_1.default.burstHeatmap) {
                    applyBurstHeatmap();
                }
                $("#resultWordsHistory")
                    .removeClass("hidden")
                    .css("display", "none")
                    .slideDown(250);
            }
        }
        else {
            //hide
            $("#resultWordsHistory").slideUp(250, () => {
                $("#resultWordsHistory").addClass("hidden");
            });
        }
    }
}
exports.toggleResultWords = toggleResultWords;
function applyBurstHeatmap() {
    var _a, _b;
    if (config_1.default.burstHeatmap) {
        $("#resultWordsHistory .heatmapLegend").removeClass("hidden");
        let burstlist = [...TestInput.burstHistory];
        burstlist = burstlist.filter((x) => x !== Infinity);
        burstlist = burstlist.filter((x) => x < 350);
        if (((_a = TestInput.input.getHistory(TestInput.input.getHistory().length - 1)) === null || _a === void 0 ? void 0 : _a.length) !== ((_b = TestWords.words.getCurrent()) === null || _b === void 0 ? void 0 : _b.length)) {
            burstlist = burstlist.splice(0, burstlist.length - 1);
        }
        const median = Misc.median(burstlist);
        const adatm = [];
        burstlist.forEach((burst) => {
            adatm.push(Math.abs(median - burst));
        });
        const step = Misc.mean(adatm);
        const steps = [
            {
                val: 0,
                class: "heatmap-0",
            },
            {
                val: median - step * 1.5,
                class: "heatmap-1",
            },
            {
                val: median - step * 0.5,
                class: "heatmap-2",
            },
            {
                val: median + step * 0.5,
                class: "heatmap-3",
            },
            {
                val: median + step * 1.5,
                class: "heatmap-4",
            },
        ];
        $("#resultWordsHistory .words .word").each((_, word) => {
            const wordBurstVal = parseInt($(word).attr("burst"));
            let cls = "";
            steps.forEach((step) => {
                if (wordBurstVal > step.val)
                    cls = step.class;
            });
            $(word).addClass(cls);
        });
    }
    else {
        $("#resultWordsHistory .heatmapLegend").addClass("hidden");
        $("#resultWordsHistory .words .word").removeClass("heatmap-0");
        $("#resultWordsHistory .words .word").removeClass("heatmap-1");
        $("#resultWordsHistory .words .word").removeClass("heatmap-2");
        $("#resultWordsHistory .words .word").removeClass("heatmap-3");
        $("#resultWordsHistory .words .word").removeClass("heatmap-4");
    }
}
exports.applyBurstHeatmap = applyBurstHeatmap;
function highlightBadWord(index, showError) {
    if (!showError)
        return;
    $($("#words .word")[index]).addClass("error");
}
exports.highlightBadWord = highlightBadWord;
$(document.body).on("click", "#saveScreenshotButton", () => {
    screenshot();
});
$(document).on("click", "#testModesNotice .text-button.blind", () => {
    UpdateConfig.setBlindMode(!config_1.default.blindMode);
});
$(".pageTest #copyWordsListButton").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    try {
        let words;
        if (config_1.default.mode == "zen") {
            words = TestInput.input.history.join(" ");
        }
        else {
            words = TestWords.words.get()
                .slice(0, TestInput.input.history.length)
                .join(" ");
        }
        yield navigator.clipboard.writeText(words);
        Notifications.add("Copied to clipboard", 0, 2);
    }
    catch (e) {
        Notifications.add("Could not copy to clipboard: " + e, -1);
    }
}));
$(".pageTest #toggleBurstHeatmap").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    UpdateConfig.setBurstHeatmap(!config_1.default.burstHeatmap);
}));
$(document).on("mouseleave", "#resultWordsHistory .words .word", () => {
    $(".wordInputAfter").remove();
});
$("#wpmChart").on("mouseleave", () => {
    $(".wordInputAfter").remove();
});
$(document).on("mouseenter", "#resultWordsHistory .words .word", (e) => {
    if (exports.resultVisible) {
        const input = $(e.currentTarget).attr("input");
        const burst = parseInt($(e.currentTarget).attr("burst"));
        if (input != undefined) {
            $(e.currentTarget).append(`<div class="wordInputAfter">
          <div class="text">
          ${input
                .replace(/\t/g, "_")
                .replace(/\n/g, "_")
                .replace(/</g, "&lt")
                .replace(/>/g, "&gt")}
          </div>
          <div class="speed">
          ${Math.round(config_1.default.alwaysShowCPM ? burst * 5 : burst)}${config_1.default.alwaysShowCPM ? "cpm" : "wpm"}
          </div>
          </div>`);
        }
    }
});
$("#wordsInput").on("focus", () => {
    if (!exports.resultVisible && config_1.default.showOutOfFocusWarning) {
        OutOfFocus.hide();
    }
    Caret.show();
});
$("#wordsInput").on("focusout", () => {
    if (!exports.resultVisible && config_1.default.showOutOfFocusWarning) {
        OutOfFocus.show();
    }
    Caret.hide();
});
$(document).on("keypress", "#showWordHistoryButton", (event) => {
    if (event.key === "Enter") {
        toggleResultWords();
    }
});
$(document.body).on("click", "#showWordHistoryButton", () => {
    toggleResultWords();
});
$("#wordsWrapper").on("click", () => {
    focusWords();
});


/***/ }),

/***/ "./src/scripts/test/test-words.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-words.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.setHasTab = exports.setRandomQuote = exports.randomQuote = exports.hasTab = exports.words = void 0;
class Words {
    constructor() {
        this.list = [];
        this.length = 0;
        this.currentIndex = 0;
    }
    get(i, raw = false) {
        var _a, _b;
        if (i === undefined) {
            return this.list;
        }
        else {
            if (raw) {
                return (_b = (_a = this.list[i]) === null || _a === void 0 ? void 0 : _a.replace(/[.?!":\-,]/g, "")) === null || _b === void 0 ? void 0 : _b.toLowerCase();
            }
            else {
                return this.list[i];
            }
        }
    }
    getCurrent() {
        return this.list[this.currentIndex];
    }
    getLast() {
        return this.list[this.list.length - 1];
    }
    push(word) {
        this.list.push(word);
        this.length = this.list.length;
    }
    reset() {
        this.list = [];
        this.currentIndex = 0;
        this.length = this.list.length;
    }
    resetCurrentIndex() {
        this.currentIndex = 0;
    }
    decreaseCurrentIndex() {
        this.currentIndex--;
    }
    increaseCurrentIndex() {
        this.currentIndex++;
    }
    clean() {
        for (const s of this.list) {
            if (/ +/.test(s)) {
                const id = this.list.indexOf(s);
                const tempList = s.split(" ");
                this.list.splice(id, 1);
                for (let i = 0; i < tempList.length; i++) {
                    this.list.splice(id + i, 0, tempList[i]);
                }
            }
        }
    }
}
exports.words = new Words();
exports.hasTab = false;
exports.randomQuote = null;
function setRandomQuote(rq) {
    exports.randomQuote = rq;
}
exports.setRandomQuote = setRandomQuote;
function setHasTab(tf) {
    exports.hasTab = tf;
}
exports.setHasTab = setHasTab;


/***/ }),

/***/ "./src/scripts/test/timer-progress.ts":
/*!********************************************!*\
  !*** ./src/scripts/test/timer-progress.ts ***!
  \********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateStyle = exports.update = exports.restart = exports.hide = exports.show = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const CustomText = __importStar(__webpack_require__(/*! ./custom-text */ "./src/scripts/test/custom-text.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const Time = __importStar(__webpack_require__(/*! ../states/time */ "./src/scripts/states/time.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
function show() {
    const op = config_1.default.showTimerProgress ? config_1.default.timerOpacity : 0;
    if (config_1.default.mode != "zen" && config_1.default.timerStyle === "bar") {
        $("#timerWrapper").stop(true, true).removeClass("hidden").animate({
            opacity: op,
        }, 125);
    }
    else if (config_1.default.timerStyle === "text") {
        $("#timerNumber")
            .stop(true, true)
            .removeClass("hidden")
            .css("opacity", 0)
            .animate({
            opacity: op,
        }, 125);
    }
    else if (config_1.default.mode == "zen" || config_1.default.timerStyle === "mini") {
        if (op > 0) {
            $("#miniTimerAndLiveWpm .time")
                .stop(true, true)
                .removeClass("hidden")
                .animate({
                opacity: op,
            }, 125);
        }
    }
}
exports.show = show;
function hide() {
    $("#timerWrapper").stop(true, true).animate({
        opacity: 0,
    }, 125);
    $("#miniTimerAndLiveWpm .time")
        .stop(true, true)
        .animate({
        opacity: 0,
    }, 125, () => {
        $("#miniTimerAndLiveWpm .time").addClass("hidden");
    });
    $("#timerNumber").stop(true, true).animate({
        opacity: 0,
    }, 125);
}
exports.hide = hide;
function restart() {
    if (config_1.default.timerStyle === "bar") {
        if (config_1.default.mode === "time") {
            $("#timer").stop(true, true).animate({
                width: "100vw",
            }, 0);
        }
        else if (config_1.default.mode === "words" || config_1.default.mode === "custom") {
            $("#timer").stop(true, true).animate({
                width: "0vw",
            }, 0);
        }
    }
}
exports.restart = restart;
const timerNumberElement = document.querySelector("#timerNumber");
const miniTimerNumberElement = document.querySelector("#miniTimerAndLiveWpm .time");
function update() {
    var _a, _b, _c;
    const time = Time.get();
    if (config_1.default.mode === "time" ||
        (config_1.default.mode === "custom" && CustomText.isTimeRandom)) {
        let maxtime = config_1.default.time;
        if (config_1.default.mode === "custom" && CustomText.isTimeRandom) {
            maxtime = CustomText.time;
        }
        if (config_1.default.timerStyle === "bar") {
            const percent = 100 - ((time + 1) / maxtime) * 100;
            $("#timer")
                .stop(true, true)
                .animate({
                width: percent + "vw",
            }, SlowTimer.get() ? 0 : 1000, "linear");
        }
        else if (config_1.default.timerStyle === "text") {
            let displayTime = Misc.secondsToString(maxtime - time);
            if (maxtime === 0) {
                displayTime = Misc.secondsToString(time);
            }
            if (timerNumberElement !== null) {
                timerNumberElement.innerHTML = "<div>" + displayTime + "</div>";
            }
        }
        else if (config_1.default.timerStyle === "mini") {
            let displayTime = Misc.secondsToString(maxtime - time);
            if (maxtime === 0) {
                displayTime = Misc.secondsToString(time);
            }
            if (miniTimerNumberElement !== null) {
                miniTimerNumberElement.innerHTML = displayTime;
            }
        }
    }
    else if (config_1.default.mode === "words" ||
        config_1.default.mode === "custom" ||
        config_1.default.mode === "quote") {
        let outof = TestWords.words.length;
        if (config_1.default.mode === "words") {
            outof = config_1.default.words;
        }
        if (config_1.default.mode === "custom") {
            if (CustomText.isWordRandom) {
                outof = CustomText.word;
            }
            else {
                outof = CustomText.text.length;
            }
        }
        if (config_1.default.mode === "quote") {
            outof = (_c = (_b = (_a = TestWords.randomQuote) === null || _a === void 0 ? void 0 : _a.textSplit) === null || _b === void 0 ? void 0 : _b.length) !== null && _c !== void 0 ? _c : 1;
        }
        if (config_1.default.timerStyle === "bar") {
            const percent = Math.floor(((TestWords.words.currentIndex + 1) / outof) * 100);
            $("#timer")
                .stop(true, true)
                .animate({
                width: percent + "vw",
            }, SlowTimer.get() ? 0 : 250);
        }
        else if (config_1.default.timerStyle === "text") {
            if (outof === 0) {
                if (timerNumberElement !== null) {
                    timerNumberElement.innerHTML =
                        "<div>" + `${TestInput.input.history.length}` + "</div>";
                }
            }
            else {
                if (timerNumberElement !== null) {
                    timerNumberElement.innerHTML =
                        "<div>" + `${TestInput.input.history.length}/${outof}` + "</div>";
                }
            }
        }
        else if (config_1.default.timerStyle === "mini") {
            if (config_1.default.words === 0) {
                if (miniTimerNumberElement !== null) {
                    miniTimerNumberElement.innerHTML = `${TestInput.input.history.length}`;
                }
            }
            else {
                if (miniTimerNumberElement !== null) {
                    miniTimerNumberElement.innerHTML = `${TestInput.input.history.length}/${outof}`;
                }
            }
        }
    }
    else if (config_1.default.mode == "zen") {
        if (config_1.default.timerStyle === "text") {
            if (timerNumberElement !== null) {
                timerNumberElement.innerHTML =
                    "<div>" + `${TestInput.input.history.length}` + "</div>";
            }
        }
        else {
            if (miniTimerNumberElement !== null) {
                miniTimerNumberElement.innerHTML = `${TestInput.input.history.length}`;
            }
        }
    }
}
exports.update = update;
function updateStyle() {
    if (!TestActive.get())
        return;
    hide();
    update();
    setTimeout(() => {
        show();
    }, 125);
}
exports.updateStyle = updateStyle;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "showTimerProgress") {
        if (eventValue === true && TestActive.get()) {
            show();
        }
        else {
            hide();
        }
    }
    if (eventKey === "timerStyle")
        updateStyle();
});


/***/ }),

/***/ "./src/scripts/test/today-tracker.ts":
/*!*******************************************!*\
  !*** ./src/scripts/test/today-tracker.ts ***!
  \*******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.addAllFromToday = exports.getString = exports.addSeconds = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
let seconds = 0;
let addedAllToday = false;
let dayToday;
function addSeconds(s) {
    if (addedAllToday) {
        const nowDate = new Date().getDate();
        if (nowDate > dayToday) {
            seconds = s;
            return;
        }
    }
    seconds += s;
}
exports.addSeconds = addSeconds;
function getString() {
    const secString = Misc.secondsToString(Math.round(seconds), true, true);
    return secString + (addedAllToday === true ? " today" : " session");
}
exports.getString = getString;
function addAllFromToday() {
    const todayDate = new Date();
    todayDate.setSeconds(0);
    todayDate.setMinutes(0);
    todayDate.setHours(0);
    todayDate.setMilliseconds(0);
    dayToday = todayDate.getDate();
    const todayDateMS = todayDate.getTime();
    seconds = 0;
    const results = DB.getSnapshot().results;
    results === null || results === void 0 ? void 0 : results.forEach((result) => {
        const resultDate = new Date(result.timestamp);
        resultDate.setSeconds(0);
        resultDate.setMinutes(0);
        resultDate.setHours(0);
        resultDate.setMilliseconds(0);
        const resultDateMS = resultDate.getTime();
        if (resultDateMS >= todayDateMS) {
            seconds +=
                result.testDuration + result.incompleteTestSeconds - result.afkDuration;
        }
    });
    addedAllToday = true;
}
exports.addAllFromToday = addAllFromToday;


/***/ }),

/***/ "./src/scripts/test/tts.ts":
/*!*********************************!*\
  !*** ./src/scripts/test/tts.ts ***!
  \*********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.speak = exports.clear = exports.init = exports.setLanguage = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
let voice;
function setLanguage(lang = config_1.default.language) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!voice)
            return;
        const language = yield Misc.getLanguage(lang);
        const bcp = language.bcp47 ? language.bcp47 : "en-US";
        voice.lang = bcp;
    });
}
exports.setLanguage = setLanguage;
function init() {
    return __awaiter(this, void 0, void 0, function* () {
        voice = new SpeechSynthesisUtterance();
        setLanguage();
    });
}
exports.init = init;
function clear() {
    voice = undefined;
}
exports.clear = clear;
function speak(text) {
    window.speechSynthesis.cancel();
    if (voice === undefined)
        init();
    if (voice !== undefined) {
        voice.text = text;
        window.speechSynthesis.speak(voice);
    }
}
exports.speak = speak;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "funbox") {
        if (eventValue === "none") {
            clear();
        }
        else if (eventValue === "tts") {
            init();
        }
    }
    if (eventKey === "language" && config_1.default.funbox === "tts")
        setLanguage();
});


/***/ }),

/***/ "./src/scripts/test/weak-spot.ts":
/*!***************************************!*\
  !*** ./src/scripts/test/weak-spot.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getWord = exports.updateScore = void 0;
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
// Changes how quickly it 'learns' scores - very roughly the score for a char
// is based on last perCharCount occurrences. Make it smaller to adjust faster.
const perCharCount = 50;
// Choose the highest scoring word from this many random words. Higher values
// will choose words with more weak letters on average.
const wordSamples = 20;
// Score penatly (in milliseconds) for getting a letter wrong.
const incorrectPenalty = 5000;
const scores = {};
class Score {
    constructor() {
        this.average = 0.0;
        this.count = 0;
    }
    update(score) {
        if (this.count < perCharCount) {
            this.count++;
        }
        const adjustRate = 1.0 / this.count;
        // Keep an exponential moving average of the score over time.
        this.average = score * adjustRate + this.average * (1 - adjustRate);
    }
}
function updateScore(char, isCorrect) {
    const timings = TestInput.keypressTimings.spacing.array;
    if (timings.length === 0 || typeof timings === "string") {
        return;
    }
    let score = timings[timings.length - 1];
    if (!isCorrect) {
        score += incorrectPenalty;
    }
    if (!(char in scores)) {
        scores[char] = new Score();
    }
    scores[char].update(score);
}
exports.updateScore = updateScore;
function score(word) {
    let total = 0.0;
    let numChars = 0;
    for (const c of word) {
        if (c in scores) {
            total += scores[c].average;
            numChars++;
        }
    }
    return numChars == 0 ? 0.0 : total / numChars;
}
function getWord(wordset) {
    let highScore;
    let randomWord = "";
    for (let i = 0; i < wordSamples; i++) {
        const newWord = wordset.randomWord();
        const newScore = score(newWord);
        if (i == 0 || highScore === undefined || newScore > highScore) {
            randomWord = newWord;
            highScore = newScore;
        }
    }
    return randomWord;
}
exports.getWord = getWord;


/***/ }),

/***/ "./src/scripts/test/wikipedia.ts":
/*!***************************************!*\
  !*** ./src/scripts/test/wikipedia.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getSection = exports.getTLD = exports.Section = void 0;
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
class Section {
    constructor(title, author, words) {
        this.title = title;
        this.author = author;
        this.words = words;
    }
}
exports.Section = Section;
function getTLD(languageGroup) {
    return __awaiter(this, void 0, void 0, function* () {
        // language group to tld
        switch (languageGroup.name) {
            case "english":
                return "en";
            case "spanish":
                return "es";
            case "french":
                return "fr";
            case "german":
                return "de";
            case "portuguese":
                return "pt";
            case "italian":
                return "it";
            case "dutch":
                return "nl";
            default:
                return "en";
        }
    });
}
exports.getTLD = getTLD;
function getSection(language) {
    return __awaiter(this, void 0, void 0, function* () {
        // console.log("Getting section");
        Loader.show();
        // get TLD for wikipedia according to language group
        let urlTLD = "en";
        const currentLanguageGroup = yield Misc.findCurrentGroup(language);
        if (currentLanguageGroup !== undefined) {
            urlTLD = yield getTLD(currentLanguageGroup);
        }
        const randomPostURL = `https://${urlTLD}.wikipedia.org/api/rest_v1/page/random/summary`;
        const sectionObj = { title: "", author: "" };
        const randomPostReq = yield fetch(randomPostURL);
        let pageid = 0;
        if (randomPostReq.status == 200) {
            const postObj = yield randomPostReq.json();
            sectionObj.title = postObj.title;
            sectionObj.author = postObj.author;
            pageid = postObj.pageid;
        }
        return new Promise((res, rej) => {
            if (randomPostReq.status != 200) {
                Loader.hide();
                rej(randomPostReq.status);
            }
            const sectionURL = `https://${urlTLD}.wikipedia.org/w/api.php?action=query&format=json&pageids=${pageid}&prop=extracts&exintro=true&origin=*`;
            const sectionReq = new XMLHttpRequest();
            sectionReq.onload = () => {
                if (sectionReq.readyState == 4) {
                    if (sectionReq.status == 200) {
                        let sectionText = JSON.parse(sectionReq.responseText).query
                            .pages[pageid.toString()].extract;
                        const words = [];
                        // Remove double whitespaces and finally trailing whitespaces.
                        sectionText = sectionText.replace(/<\/p><p>+/g, " ");
                        sectionText = $("<div/>").html(sectionText).text();
                        sectionText = sectionText.replace(/\s+/g, " ");
                        sectionText = sectionText.trim();
                        // // Add spaces
                        // sectionText = sectionText.replace(/[a-zA-Z0-9]{3,}\.[a-zA-Z]/g, (x) =>
                        //   x.replace(/\./, ". ")
                        // );
                        sectionText.split(" ").forEach((word) => {
                            words.push(word);
                        });
                        const section = new Section(sectionObj.title, sectionObj.author, words);
                        Loader.hide();
                        res(section);
                    }
                    else {
                        Loader.hide();
                        rej(sectionReq.status);
                    }
                }
            };
            sectionReq.open("GET", sectionURL);
            sectionReq.send();
        });
    });
}
exports.getSection = getSection;


/***/ }),

/***/ "./src/scripts/test/wordset.ts":
/*!*************************************!*\
  !*** ./src/scripts/test/wordset.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.withWords = exports.Wordset = void 0;
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
let currentWordset = null;
let currentWordGenerator = null;
class Wordset {
    constructor(words) {
        this.words = words;
        this.length = this.words.length;
    }
    randomWord() {
        return (0, misc_1.randomElementFromArray)(this.words);
    }
}
exports.Wordset = Wordset;
const prefixSize = 2;
class CharDistribution {
    constructor() {
        this.chars = {};
        this.count = 0;
    }
    addChar(char) {
        this.count++;
        if (char in this.chars) {
            this.chars[char]++;
        }
        else {
            this.chars[char] = 1;
        }
    }
    randomChar() {
        const randomIndex = (0, misc_1.randomIntFromRange)(0, this.count - 1);
        let runningCount = 0;
        for (const [char, charCount] of Object.entries(this.chars)) {
            runningCount += charCount;
            if (runningCount > randomIndex) {
                return char;
            }
        }
        return Object.keys(this.chars)[0];
    }
}
class WordGenerator extends Wordset {
    constructor(words) {
        super(words);
        this.ngrams = {};
        // Can generate an unbounded number of words in theory.
        this.length = Infinity;
        for (let word of words) {
            // Mark the end of each word with a space.
            word += " ";
            let prefix = "";
            for (const c of word) {
                // Add `c` to the distribution of chars that can come after `prefix`.
                if (!(prefix in this.ngrams)) {
                    this.ngrams[prefix] = new CharDistribution();
                }
                this.ngrams[prefix].addChar(c);
                prefix = (prefix + c).substr(-prefixSize);
            }
        }
    }
    randomWord() {
        let word = "";
        for (;;) {
            const prefix = word.substr(-prefixSize);
            const charDistribution = this.ngrams[prefix];
            if (!charDistribution) {
                // This shouldn't happen if this.ngrams is complete. If it does
                // somehow, start generating a new word.
                word = "";
                continue;
            }
            // Pick a random char from the distribution that comes after `prefix`.
            const nextChar = charDistribution.randomChar();
            if (nextChar == " ") {
                // A space marks the end of the word, so stop generating and return.
                break;
            }
            word += nextChar;
        }
        return word;
    }
}
function withWords(words, funbox) {
    if (funbox == "pseudolang") {
        if (currentWordGenerator == null || words !== currentWordGenerator.words) {
            currentWordGenerator = new WordGenerator(words);
        }
        return currentWordGenerator;
    }
    else {
        if (currentWordset == null || words !== currentWordset.words) {
            currentWordset = new Wordset(words);
        }
        return currentWordset;
    }
}
exports.withWords = withWords;


/***/ }),

/***/ "./src/scripts/ui.ts":
/*!***************************!*\
  !*** ./src/scripts/ui.ts ***!
  \***************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateKeytips = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ./config */ "./src/scripts/config.ts"));
const Caret = __importStar(__webpack_require__(/*! ./test/caret */ "./src/scripts/test/caret.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./elements/notifications */ "./src/scripts/elements/notifications.ts"));
const CustomText = __importStar(__webpack_require__(/*! ./test/custom-text */ "./src/scripts/test/custom-text.ts"));
const TestActive = __importStar(__webpack_require__(/*! ./states/test-active */ "./src/scripts/states/test-active.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ./observables/config-event */ "./src/scripts/observables/config-event.ts"));
function updateKeytips() {
    if (config_1.default.swapEscAndTab) {
        $(".pageSettings .tip").html(`
    tip: You can also change all these settings quickly using the
    command line (
    <key>tab</key>
    )`);
        $("#bottom .keyTips").html(`
    <key>esc</key> - restart test<br>
      <key>tab</key> - command line`);
    }
    else {
        $(".pageSettings .tip").html(`
    tip: You can also change all these settings quickly using the
    command line (
    <key>esc</key>
    )`);
        $("#bottom .keyTips").html(`
    <key>tab</key> - restart test<br>
      <key>esc</key> or <key>ctrl/cmd</key>+<key>shift</key>+<key>p</key> - command line`);
    }
}
exports.updateKeytips = updateKeytips;
if (window.location.hostname === "localhost") {
    window.onerror = function (error) {
        Notifications.add(error.toString(), -1);
    };
    $("#top .logo .top").text("localhost");
    $("head title").text($("head title").text() + " (localhost)");
    $("body").append(`<div class="devIndicator tl">local</div><div class="devIndicator br">local</div>`);
    $(".pageSettings .discordIntegration .buttons a").attr("href", "https://discord.com/api/oauth2/authorize?client_id=798272335035498557&redirect_uri=http%3A%2F%2Flocalhost%3A5000%2Fverify&response_type=token&scope=identify");
}
//stop space scrolling
window.addEventListener("keydown", function (e) {
    if (e.code === "Space" && e.target === document.body) {
        e.preventDefault();
    }
});
window.addEventListener("beforeunload", (event) => {
    // Cancel the event as stated by the standard.
    if ((config_1.default.mode === "words" && config_1.default.words < 1000) ||
        (config_1.default.mode === "time" && config_1.default.time < 3600) ||
        config_1.default.mode === "quote" ||
        (config_1.default.mode === "custom" &&
            CustomText.isWordRandom &&
            CustomText.word < 1000) ||
        (config_1.default.mode === "custom" &&
            CustomText.isTimeRandom &&
            CustomText.time < 1000) ||
        (config_1.default.mode === "custom" &&
            !CustomText.isWordRandom &&
            CustomText.text.length < 1000)) {
        //ignore
    }
    else {
        if (TestActive.get()) {
            event.preventDefault();
            // Chrome requires returnValue to be set.
            event.returnValue = "";
        }
    }
});
$(window).on("resize", () => {
    console.log("Updating caret position");
    Caret.updatePosition();
});
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "swapEscAndTab")
        updateKeytips();
});


/***/ }),

/***/ "./src/scripts/utils/debounce.ts":
/*!***************************************!*\
  !*** ./src/scripts/utils/debounce.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.debounce = void 0;
function debounce(fn, ms = 250) {
    let timeoutId;
    return function (...args) {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => fn.apply(this, args), ms);
    };
}
exports.debounce = debounce;


/***/ }),

/***/ "./src/scripts/utils/misc.ts":
/*!***********************************!*\
  !*** ./src/scripts/utils/misc.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.regexIndexOf = exports.setCharAt = exports.clearTimeouts = exports.canQuickRestart = exports.mapRange = exports.isUsernameValid = exports.cleanTypographySymbols = exports.escapeRegExp = exports.remove_non_ascii = exports.getWords = exports.toggleFullscreen = exports.objectToQueryString = exports.findGetParameter = exports.getPositionString = exports.getArrows = exports.getASCII = exports.getSpecials = exports.getNumbers = exports.secondsToString = exports.getGibberish = exports.findLineByLeastSquares = exports.roundTo2 = exports.whorf = exports.kogasa = exports.isASCIILetter = exports.capitalizeFirstLetterOfEachWord = exports.getLastChar = exports.getReleasesFromGitHub = exports.median = exports.mean = exports.stdDev = exports.smooth = exports.getChallengeList = exports.findCurrentGroup = exports.getCurrentLanguage = exports.getLanguage = exports.getLanguageGroups = exports.getLanguageList = exports.getContributorsList = exports.getSupportersList = exports.getFontsList = exports.getLayout = exports.getLayoutsList = exports.getFunbox = exports.getFunboxList = exports.getSortedThemesList = exports.getThemesList = exports.isColorDark = exports.isColorLight = exports.getuid = void 0;
exports.createErrorMessage = exports.randomElementFromObject = exports.randomElementFromArray = exports.shuffle = exports.randomIntFromRange = exports.downloadResultsCSV = exports.getMode2 = exports.swapElements = exports.convertRemToPixels = exports.trailingComposeChars = exports.convertRGBtoHEX = void 0;
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
function getuid() {
    var _a;
    console.error("Only share this uid with Miodec and nobody else!");
    console.log((_a = firebase_1.Auth.currentUser) === null || _a === void 0 ? void 0 : _a.uid);
    console.error("Only share this uid with Miodec and nobody else!");
}
exports.getuid = getuid;
function hexToHSL(hex) {
    // Convert hex to RGB first
    let r;
    let g;
    let b;
    if (hex.length == 4) {
        r = ("0x" + hex[1] + hex[1]);
        g = ("0x" + hex[2] + hex[2]);
        b = ("0x" + hex[3] + hex[3]);
    }
    else if (hex.length == 7) {
        r = ("0x" + hex[1] + hex[2]);
        g = ("0x" + hex[3] + hex[4]);
        b = ("0x" + hex[5] + hex[6]);
    }
    else {
        r = 0x00;
        g = 0x00;
        b = 0x00;
    }
    // Then to HSL
    r /= 255;
    g /= 255;
    b /= 255;
    const cmin = Math.min(r, g, b);
    const cmax = Math.max(r, g, b);
    const delta = cmax - cmin;
    let h = 0;
    let s = 0;
    let l = 0;
    if (delta == 0)
        h = 0;
    else if (cmax == r)
        h = ((g - b) / delta) % 6;
    else if (cmax == g)
        h = (b - r) / delta + 2;
    else
        h = (r - g) / delta + 4;
    h = Math.round(h * 60);
    if (h < 0)
        h += 360;
    l = (cmax + cmin) / 2;
    s = delta == 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));
    s = +(s * 100).toFixed(1);
    l = +(l * 100).toFixed(1);
    return {
        hue: h,
        sat: s,
        lgt: l,
        string: "hsl(" + h + "," + s + "%," + l + "%)",
    };
}
function isColorLight(hex) {
    const hsl = hexToHSL(hex);
    return hsl.lgt >= 50;
}
exports.isColorLight = isColorLight;
function isColorDark(hex) {
    const hsl = hexToHSL(hex);
    return hsl.lgt < 50;
}
exports.isColorDark = isColorDark;
let themesList = [];
function getThemesList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (themesList.length == 0) {
            return $.getJSON("themes/_list.json", function (data) {
                const list = data.sort(function (a, b) {
                    const nameA = a.name.toLowerCase();
                    const nameB = b.name.toLowerCase();
                    if (nameA < nameB)
                        return -1;
                    if (nameA > nameB)
                        return 1;
                    return 0;
                });
                themesList = list;
                return themesList;
            });
        }
        else {
            return themesList;
        }
    });
}
exports.getThemesList = getThemesList;
let sortedThemesList = [];
function getSortedThemesList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (sortedThemesList.length === 0) {
            if (themesList.length === 0) {
                yield getThemesList();
            }
            let sorted = [...themesList];
            sorted = sorted.sort((a, b) => {
                const b1 = hexToHSL(a.bgColor);
                const b2 = hexToHSL(b.bgColor);
                return b2.lgt - b1.lgt;
            });
            sortedThemesList = sorted;
            return sortedThemesList;
        }
        else {
            return sortedThemesList;
        }
    });
}
exports.getSortedThemesList = getSortedThemesList;
let funboxList = [];
function getFunboxList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (funboxList.length === 0) {
            return $.getJSON("funbox/_list.json", function (data) {
                funboxList = data.sort(function (a, b) {
                    const nameA = a.name.toLowerCase();
                    const nameB = b.name.toLowerCase();
                    if (nameA < nameB)
                        return -1;
                    if (nameA > nameB)
                        return 1;
                    return 0;
                });
                return funboxList;
            });
        }
        else {
            return funboxList;
        }
    });
}
exports.getFunboxList = getFunboxList;
function getFunbox(funbox) {
    return __awaiter(this, void 0, void 0, function* () {
        const list = yield getFunboxList();
        return list.find(function (element) {
            return element.name == funbox;
        });
    });
}
exports.getFunbox = getFunbox;
let layoutsList = {};
function getLayoutsList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (Object.keys(layoutsList).length === 0) {
            return $.getJSON("layouts/_list.json", function (data) {
                layoutsList = data;
                return layoutsList;
            });
        }
        else {
            return layoutsList;
        }
    });
}
exports.getLayoutsList = getLayoutsList;
function getLayout(layoutName) {
    return __awaiter(this, void 0, void 0, function* () {
        if (Object.keys(layoutsList).length === 0) {
            yield getLayoutsList();
        }
        return layoutsList[layoutName];
    });
}
exports.getLayout = getLayout;
let fontsList = [];
function getFontsList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (fontsList.length === 0) {
            return $.getJSON("fonts/_list.json", function (data) {
                fontsList = data.sort(function (a, b) {
                    const nameA = a.name.toLowerCase();
                    const nameB = b.name.toLowerCase();
                    if (nameA < nameB)
                        return -1;
                    if (nameA > nameB)
                        return 1;
                    return 0;
                });
                return fontsList;
            });
        }
        else {
            return fontsList;
        }
    });
}
exports.getFontsList = getFontsList;
let supportersList = [];
function getSupportersList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (supportersList.length === 0) {
            return $.getJSON("about/supporters.json", function (data) {
                supportersList = data;
                return supportersList;
            });
        }
        else {
            return supportersList;
        }
    });
}
exports.getSupportersList = getSupportersList;
let contributorsList = [];
function getContributorsList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (contributorsList.length === 0) {
            return $.getJSON("about/contributors.json", function (data) {
                contributorsList = data;
                return contributorsList;
            });
        }
        else {
            return contributorsList;
        }
    });
}
exports.getContributorsList = getContributorsList;
let languageList = [];
function getLanguageList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (languageList.length === 0) {
            return $.getJSON("languages/_list.json", function (data) {
                languageList = data;
                return languageList;
            });
        }
        else {
            return languageList;
        }
    });
}
exports.getLanguageList = getLanguageList;
let languageGroupList = [];
function getLanguageGroups() {
    return __awaiter(this, void 0, void 0, function* () {
        if (languageGroupList.length === 0) {
            return $.getJSON("languages/_groups.json", function (data) {
                languageGroupList = data;
                return languageGroupList;
            });
        }
        else {
            return languageGroupList;
        }
    });
}
exports.getLanguageGroups = getLanguageGroups;
let currentLanguage;
function getLanguage(lang) {
    return __awaiter(this, void 0, void 0, function* () {
        try {
            if (currentLanguage == undefined || currentLanguage.name !== lang) {
                console.log("getting language json");
                yield $.getJSON(`languages/${lang}.json`, function (data) {
                    currentLanguage = data;
                });
            }
            return currentLanguage;
        }
        catch (e) {
            console.error(`error getting language`);
            console.error(e);
            yield $.getJSON(`languages/english.json`, function (data) {
                currentLanguage = data;
            });
            return currentLanguage;
        }
    });
}
exports.getLanguage = getLanguage;
function getCurrentLanguage(languageName) {
    return __awaiter(this, void 0, void 0, function* () {
        return yield getLanguage(languageName);
    });
}
exports.getCurrentLanguage = getCurrentLanguage;
function findCurrentGroup(language) {
    return __awaiter(this, void 0, void 0, function* () {
        let retgroup;
        const groups = yield getLanguageGroups();
        groups.forEach((group) => {
            if (retgroup === undefined) {
                if (group.languages.includes(language)) {
                    retgroup = group;
                }
            }
        });
        return retgroup;
    });
}
exports.findCurrentGroup = findCurrentGroup;
let challengeList = [];
function getChallengeList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (challengeList.length === 0) {
            return $.getJSON("challenges/_list.json", function (data) {
                challengeList = data;
                return challengeList;
            });
        }
        else {
            return challengeList;
        }
    });
}
exports.getChallengeList = getChallengeList;
function smooth(arr, windowSize, getter = (value) => value) {
    const get = getter;
    const result = [];
    for (let i = 0; i < arr.length; i += 1) {
        const leftOffeset = i - windowSize;
        const from = leftOffeset >= 0 ? leftOffeset : 0;
        const to = i + windowSize + 1;
        let count = 0;
        let sum = 0;
        for (let j = from; j < to && j < arr.length; j += 1) {
            sum += get(arr[j]);
            count += 1;
        }
        result[i] = sum / count;
    }
    return result;
}
exports.smooth = smooth;
function stdDev(array) {
    try {
        const n = array.length;
        const mean = array.reduce((a, b) => a + b) / n;
        return Math.sqrt(array.map((x) => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / n);
    }
    catch (e) {
        return 0;
    }
}
exports.stdDev = stdDev;
function mean(array) {
    try {
        return (array.reduce((previous, current) => (current += previous)) / array.length);
    }
    catch (e) {
        return 0;
    }
}
exports.mean = mean;
//https://www.w3resource.com/javascript-exercises/fundamental/javascript-fundamental-exercise-88.php
function median(arr) {
    try {
        const mid = Math.floor(arr.length / 2), nums = [...arr].sort((a, b) => a - b);
        return arr.length % 2 !== 0 ? nums[mid] : (nums[mid - 1] + nums[mid]) / 2;
    }
    catch (e) {
        return 0;
    }
}
exports.median = median;
function getReleasesFromGitHub() {
    return __awaiter(this, void 0, void 0, function* () {
        return $.getJSON("https://api.github.com/repos/Miodec/monkeytype/releases", (data) => {
            $("#bottom .version .text").text(data[0].name);
            $("#bottom .version").css("opacity", 1);
            $("#versionHistory .releases").empty();
            data.forEach((release) => {
                if (!release.draft && !release.prerelease) {
                    $("#versionHistory .releases").append(`
          <div class="release">
            <div class="title">${release.name}</div>
            <div class="date">${(0, format_1.default)(new Date(release.published_at), "dd MMM yyyy")}</div>
            <div class="body">${release.body.replace(/\r\n/g, "<br>")}</div>
          </div>
        `);
                }
            });
        });
    });
}
exports.getReleasesFromGitHub = getReleasesFromGitHub;
// function getPatreonNames() {
//   let namesel = $(".pageAbout .section .supporters");
//   firebase
//     .functions()
//     .httpsCallable("getPatreons")()
//     .then((data) => {
//       let names = data.data;
//       names.forEach((name) => {
//         namesel.append(`<div>${name}</div>`);
//       });
//     });
// }
function getLastChar(word) {
    try {
        return word.charAt(word.length - 1);
    }
    catch (_a) {
        return "";
    }
}
exports.getLastChar = getLastChar;
function capitalizeFirstLetterOfEachWord(str) {
    return str
        .split(/ +/)
        .map((s) => s.charAt(0).toUpperCase() + s.slice(1))
        .join(" ");
}
exports.capitalizeFirstLetterOfEachWord = capitalizeFirstLetterOfEachWord;
function isASCIILetter(c) {
    return c.length === 1 && /[a-z]/i.test(c);
}
exports.isASCIILetter = isASCIILetter;
function kogasa(cov) {
    return (100 * (1 - Math.tanh(cov + Math.pow(cov, 3) / 3 + Math.pow(cov, 5) / 5)));
}
exports.kogasa = kogasa;
function whorf(speed, wordlen) {
    return Math.min(speed, Math.floor(speed * Math.pow(1.03, -2 * (wordlen - 3))));
}
exports.whorf = whorf;
function roundTo2(num) {
    return Math.round((num + Number.EPSILON) * 100) / 100;
}
exports.roundTo2 = roundTo2;
function findLineByLeastSquares(values_y) {
    let sum_x = 0;
    let sum_y = 0;
    let sum_xy = 0;
    let sum_xx = 0;
    let count = 0;
    /*
     * We'll use those letiables for faster read/write access.
     */
    let x = 0;
    let y = 0;
    const values_length = values_y.length;
    /*
     * Nothing to do.
     */
    if (values_length === 0) {
        return [[], []];
    }
    /*
     * Calculate the sum for each of the parts necessary.
     */
    for (let v = 0; v < values_length; v++) {
        x = v + 1;
        y = values_y[v];
        sum_x += x;
        sum_y += y;
        sum_xx += x * x;
        sum_xy += x * y;
        count++;
    }
    /*
     * Calculate m and b for the formular:
     * y = x * m + b
     */
    const m = (count * sum_xy - sum_x * sum_y) / (count * sum_xx - sum_x * sum_x);
    const b = sum_y / count - (m * sum_x) / count;
    const returnpoint1 = [1, 1 * m + b];
    const returnpoint2 = [values_length, values_length * m + b];
    return [returnpoint1, returnpoint2];
}
exports.findLineByLeastSquares = findLineByLeastSquares;
function getGibberish() {
    const randLen = randomIntFromRange(1, 7);
    let ret = "";
    for (let i = 0; i < randLen; i++) {
        ret += String.fromCharCode(97 + randomIntFromRange(0, 25));
    }
    return ret;
}
exports.getGibberish = getGibberish;
function secondsToString(sec, alwaysShowMinutes = false, alwaysShowHours = false, delimiter = ":", showSeconds = true, showDays = false) {
    sec = Math.abs(sec);
    let days = 0;
    let hours;
    if (showDays) {
        days = Math.floor(sec / 86400);
        hours = Math.floor((sec % 86400) / 3600);
    }
    else {
        hours = Math.floor(sec / 3600);
    }
    const minutes = Math.floor((sec % 3600) / 60);
    const seconds = roundTo2((sec % 3600) % 60);
    let daysString;
    let hoursString;
    let minutesString;
    let secondsString;
    if (showDays) {
        days < 10 && delimiter !== "text"
            ? (daysString = "0" + days)
            : (daysString = days);
    }
    hours < 10 && delimiter !== "text"
        ? (hoursString = "0" + hours)
        : (hoursString = hours);
    minutes < 10 && delimiter !== "text"
        ? (minutesString = "0" + minutes)
        : (minutesString = minutes);
    seconds < 10 &&
        (minutes > 0 || hours > 0 || alwaysShowMinutes) &&
        delimiter !== "text"
        ? (secondsString = "0" + seconds)
        : (secondsString = seconds);
    let ret = "";
    if (days > 0 && showDays) {
        ret += daysString;
        if (delimiter === "text") {
            if (days == 1) {
                ret += " day ";
            }
            else {
                ret += " days ";
            }
        }
        else {
            ret += delimiter;
        }
    }
    if (hours > 0 || alwaysShowHours) {
        ret += hoursString;
        if (delimiter === "text") {
            if (hours == 1) {
                ret += " hour ";
            }
            else {
                ret += " hours ";
            }
        }
        else {
            ret += delimiter;
        }
    }
    if (minutes > 0 || hours > 0 || alwaysShowMinutes) {
        ret += minutesString;
        if (delimiter === "text") {
            if (minutes == 1) {
                ret += " minute ";
            }
            else {
                ret += " minutes ";
            }
        }
        else if (showSeconds) {
            ret += delimiter;
        }
    }
    if (showSeconds) {
        ret += secondsString;
        if (delimiter === "text") {
            if (seconds == 1) {
                ret += " second";
            }
            else {
                ret += " seconds";
            }
        }
    }
    if (hours === 0 && minutes === 0 && !showSeconds && delimiter === "text") {
        ret = "less than 1 minute";
    }
    return ret.trim();
}
exports.secondsToString = secondsToString;
function getNumbers(len) {
    const randLen = randomIntFromRange(1, len);
    let ret = "";
    for (let i = 0; i < randLen; i++) {
        const randomNum = randomIntFromRange(0, 9);
        ret += randomNum.toString();
    }
    return ret;
}
exports.getNumbers = getNumbers;
function getSpecials() {
    const randLen = randomIntFromRange(1, 7);
    let ret = "";
    const specials = [
        "!",
        "@",
        "#",
        "$",
        "%",
        "^",
        "&",
        "*",
        "(",
        ")",
        "-",
        "_",
        "=",
        "+",
        "{",
        "}",
        "[",
        "]",
        "'",
        '"',
        "/",
        "\\",
        "|",
    ];
    for (let i = 0; i < randLen; i++) {
        ret += randomElementFromArray(specials);
    }
    return ret;
}
exports.getSpecials = getSpecials;
function getASCII() {
    const randLen = randomIntFromRange(1, 10);
    let ret = "";
    for (let i = 0; i < randLen; i++) {
        let ran = 33 + randomIntFromRange(0, 93);
        while (ran == 96 || ran == 94)
            ran = 33 + randomIntFromRange(0, 93); //todo remove when input rewrite is fixed
        ret += String.fromCharCode(ran);
    }
    return ret;
}
exports.getASCII = getASCII;
function getArrows() {
    const arrowArray = ["", "", "", ""];
    let arrowWord = "";
    let lastchar;
    for (let i = 0; i < 5; i++) {
        let random = randomElementFromArray(arrowArray);
        while (random === lastchar) {
            random = randomElementFromArray(arrowArray);
        }
        lastchar = random;
        arrowWord += random;
    }
    return arrowWord;
}
exports.getArrows = getArrows;
function getPositionString(number) {
    let numend = "th";
    const t = number % 10;
    const h = number % 100;
    if (t == 1 && h != 11) {
        numend = "st";
    }
    if (t == 2 && h != 12) {
        numend = "nd";
    }
    if (t == 3 && h != 13) {
        numend = "rd";
    }
    return number + numend;
}
exports.getPositionString = getPositionString;
function findGetParameter(parameterName) {
    let result = null;
    let tmp = [];
    location.search
        .substr(1)
        .split("&")
        .forEach(function (item) {
        tmp = item.split("=");
        if (tmp[0] === parameterName)
            result = decodeURIComponent(tmp[1]);
    });
    return result;
}
exports.findGetParameter = findGetParameter;
function objectToQueryString(obj) {
    const str = [];
    for (const p in obj) {
        if (Object.prototype.hasOwnProperty.call(obj, p)) {
            // Arrays get encoded as a comma(%2C)-separated list
            str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
        }
    }
    return str.join("&");
}
exports.objectToQueryString = objectToQueryString;
function toggleFullscreen() {
    const elem = document.documentElement;
    if (!document.fullscreenElement &&
        !document.mozFullScreenElement &&
        !document.webkitFullscreenElement &&
        !document.msFullscreenElement) {
        if (elem.requestFullscreen) {
            elem.requestFullscreen();
        }
        else if (elem.msRequestFullscreen) {
            elem.msRequestFullscreen();
        }
        else if (elem.mozRequestFullScreen) {
            elem.mozRequestFullScreen();
        }
        else if (elem.webkitRequestFullscreen) {
            // @ts-ignore
            elem.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
        }
    }
    else {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        }
        else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
        else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        }
        else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
        }
    }
}
exports.toggleFullscreen = toggleFullscreen;
function getWords() {
    const words = [...document.querySelectorAll("#words .word")]
        .map((word) => {
        return [...word.querySelectorAll("letter")]
            .map((letter) => letter.textContent)
            .join("");
    })
        .join(" ");
    return words;
}
exports.getWords = getWords;
//credit: https://www.w3resource.com/javascript-exercises/javascript-string-exercise-32.php
function remove_non_ascii(str) {
    if (str === null || str === "")
        return "";
    else
        str = str.toString();
    return str.replace(/[^\x20-\x7E]/g, "");
}
exports.remove_non_ascii = remove_non_ascii;
function escapeRegExp(str) {
    return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
}
exports.escapeRegExp = escapeRegExp;
function cleanTypographySymbols(textToClean) {
    const specials = {
        "": '"',
        "": '"',
        "": "'",
        "": "'",
        ",": ",",
        "": "-",
        "": "...",
        "": "<<",
        "": ">>",
        "": "-",
        "": " ",
        "": " ",
        "": " ",
    };
    return textToClean.replace(/[,\u2007\u202F\u00A0]/g, (char) => specials[char] || "");
}
exports.cleanTypographySymbols = cleanTypographySymbols;
function isUsernameValid(name) {
    if (name === null || name === undefined || name === "")
        return false;
    if (/miodec/.test(name.toLowerCase()))
        return false;
    if (/bitly/.test(name.toLowerCase()))
        return false;
    if (name.length > 14)
        return false;
    if (/^\..*/.test(name.toLowerCase()))
        return false;
    return /^[0-9a-zA-Z_.-]+$/.test(name);
}
exports.isUsernameValid = isUsernameValid;
function mapRange(x, in_min, in_max, out_min, out_max) {
    let num = ((x - in_min) * (out_max - out_min)) / (in_max - in_min) + out_min;
    if (out_min > out_max) {
        if (num > out_min) {
            num = out_min;
        }
        else if (num < out_max) {
            num = out_max;
        }
    }
    else {
        if (num < out_min) {
            num = out_min;
        }
        else if (num > out_max) {
            num = out_max;
        }
    }
    return num;
}
exports.mapRange = mapRange;
function canQuickRestart(mode, words, time, CustomText) {
    if ((mode === "words" && words < 1000) ||
        (mode === "time" && time < 3600) ||
        mode === "quote" ||
        (mode === "custom" && CustomText.isWordRandom && CustomText.word < 1000) ||
        (mode === "custom" && CustomText.isTimeRandom && CustomText.time < 3600) ||
        (mode === "custom" &&
            !CustomText.isWordRandom &&
            CustomText.text.length < 1000)) {
        return true;
    }
    else {
        return false;
    }
}
exports.canQuickRestart = canQuickRestart;
function clearTimeouts(timeouts) {
    timeouts.forEach((to) => {
        if (typeof to === "number")
            clearTimeout(to);
        else
            clearTimeout(to);
    });
}
exports.clearTimeouts = clearTimeouts;
//https://stackoverflow.com/questions/1431094/how-do-i-replace-a-character-at-a-particular-index-in-javascript
function setCharAt(str, index, chr) {
    if (index > str.length - 1)
        return str;
    return str.substring(0, index) + chr + str.substring(index + 1);
}
exports.setCharAt = setCharAt;
//https://stackoverflow.com/questions/273789/is-there-a-version-of-javascripts-string-indexof-that-allows-for-regular-expr
function regexIndexOf(string, regex, startpos) {
    const indexOf = string.substring(startpos || 0).search(regex);
    return indexOf >= 0 ? indexOf + (startpos || 0) : indexOf;
}
exports.regexIndexOf = regexIndexOf;
function convertRGBtoHEX(rgb) {
    const match = rgb.match(/^rgb\((\d+), \s*(\d+), \s*(\d+)\)$/);
    if (match === null)
        return;
    if (match.length < 3)
        return;
    function hexCode(i) {
        // Take the last 2 characters and convert
        // them to Hexadecimal.
        return ("0" + parseInt(i).toString(16)).slice(-2);
    }
    return "#" + hexCode(match[1]) + hexCode(match[2]) + hexCode(match[3]);
}
exports.convertRGBtoHEX = convertRGBtoHEX;
String.prototype.lastIndexOfRegex = function (regex) {
    const match = this.match(regex);
    return match ? this.lastIndexOf(match[match.length - 1]) : -1;
};
exports.trailingComposeChars = /[\u02B0-\u02FF`^~]+$|.*$/;
//https://stackoverflow.com/questions/36532307/rem-px-in-javascript
function convertRemToPixels(rem) {
    return rem * parseFloat(getComputedStyle(document.documentElement).fontSize);
}
exports.convertRemToPixels = convertRemToPixels;
function swapElements(el1, el2, totalDuration, callback = function () {
    return;
}, middleCallback = function () {
    return;
}) {
    if ((el1.hasClass("hidden") && !el2.hasClass("hidden")) ||
        (!el1.hasClass("hidden") && el2.hasClass("hidden"))) {
        //one of them is hidden and the other is visible
        if (el1.hasClass("hidden")) {
            callback();
            return false;
        }
        $(el1)
            .removeClass("hidden")
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, totalDuration / 2, () => {
            middleCallback();
            $(el1).addClass("hidden");
            $(el2)
                .removeClass("hidden")
                .css("opacity", 0)
                .animate({
                opacity: 1,
            }, totalDuration / 2, () => {
                callback();
            });
        });
    }
    else if (el1.hasClass("hidden") && el2.hasClass("hidden")) {
        //both are hidden, only fade in the second
        $(el2)
            .removeClass("hidden")
            .css("opacity", 0)
            .animate({
            opacity: 1,
        }, totalDuration, () => {
            callback();
        });
    }
    else {
        callback();
    }
    return;
}
exports.swapElements = swapElements;
function getMode2(config, randomQuote) {
    const mode = config.mode;
    if (mode === "time") {
        return config.time.toString();
    }
    else if (mode === "words") {
        return config.words.toString();
    }
    else if (mode === "custom") {
        return "custom";
    }
    else if (mode === "zen") {
        return "zen";
    }
    else if (mode === "quote") {
        return randomQuote.id.toString();
    }
    return "";
}
exports.getMode2 = getMode2;
function downloadResultsCSV(array) {
    return __awaiter(this, void 0, void 0, function* () {
        Loader.show();
        const csvString = [
            [
                "_id",
                "isPb",
                "wpm",
                "acc",
                "rawWpm",
                "consistency",
                "charStats",
                "mode",
                "mode2",
                "quoteLength",
                "restartCount",
                "testDuration",
                "afkDuration",
                "incompleteTestSeconds",
                "punctuation",
                "numbers",
                "language",
                "funbox",
                "difficulty",
                "lazyMode",
                "blindMode",
                "bailedOut",
                "tags",
                "timestamp",
            ],
            ...array.map((item) => [
                item._id,
                item.isPb,
                item.wpm,
                item.acc,
                item.rawWpm,
                item.consistency,
                item.charStats.join(","),
                item.mode,
                item.mode2,
                item.quoteLength,
                item.restartCount,
                item.testDuration,
                item.afkDuration,
                item.incompleteTestSeconds,
                item.punctuation,
                item.numbers,
                item.language,
                item.funbox,
                item.difficulty,
                item.lazyMode,
                item.blindMode,
                item.bailedOut,
                item.tags.join(","),
                item.timestamp,
            ]),
        ]
            .map((e) => e.join("|"))
            .join("\n");
        const blob = new Blob([csvString], { type: "text/csv" });
        const href = window.URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.setAttribute("href", href);
        link.setAttribute("download", "results.csv");
        document.body.appendChild(link); // Required for FF
        link.click();
        link.remove();
        Loader.hide();
    });
}
exports.downloadResultsCSV = downloadResultsCSV;
/**
 * Gets an integer between min and max, both are inclusive.
 * @param min
 * @param max
 * @returns Random integer betwen min and max.
 */
function randomIntFromRange(min, max) {
    const minNorm = Math.ceil(min);
    const maxNorm = Math.floor(max);
    return Math.floor(Math.random() * (maxNorm - minNorm + 1) + minNorm);
}
exports.randomIntFromRange = randomIntFromRange;
/**
 * Shuffle an array of elements using the FisherYates algorithm.
 * This function mutates the input array.
 * @param elements
 */
function shuffle(elements) {
    for (let i = elements.length - 1; i > 0; --i) {
        const j = randomIntFromRange(0, i);
        const temp = elements[j];
        elements[j] = elements[i];
        elements[i] = temp;
    }
}
exports.shuffle = shuffle;
function randomElementFromArray(array) {
    return array[randomIntFromRange(0, array.length - 1)];
}
exports.randomElementFromArray = randomElementFromArray;
function randomElementFromObject(object) {
    return randomElementFromArray(Object.values(object));
}
exports.randomElementFromObject = randomElementFromObject;
function createErrorMessage(error, message) {
    if (error instanceof Error)
        return `${message}: ${error.message}`;
    return `${message}`;
}
exports.createErrorMessage = createErrorMessage;


/***/ }),

/***/ "./src/scripts/utils/search-service.ts":
/*!*********************************************!*\
  !*** ./src/scripts/utils/search-service.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.buildSearchService = void 0;
const stemmer_1 = __webpack_require__(/*! stemmer */ "./node_modules/stemmer/index.js");
const damerau_levenshtein_1 = __importDefault(__webpack_require__(/*! damerau-levenshtein */ "./node_modules/damerau-levenshtein/index.js"));
const DEFAULT_OPTIONS = {
    fuzzyMatchSensitivity: 0.2,
    scoreForSimilarMatch: 0.5,
    scoreForExactMatch: 1, // When ranking results, the score a match gets for having an exact match with a token in the search query.
};
function inverseDocumentFrequency(numberOfDocuments, numberOfDocumentsWithTerm) {
    if (numberOfDocumentsWithTerm === 0) {
        return 0;
    }
    return Math.log10(numberOfDocuments / numberOfDocumentsWithTerm);
}
function tokenize(text) {
    return text.match(/[^\\\][.,"/#!?$%^&*;:{}=\-_`~()\s]+/g) || [];
}
const buildSearchService = (documents, getSearchableText, options = DEFAULT_OPTIONS) => {
    const reverseIndex = {};
    const normalizedTokenToOriginal = {};
    documents.forEach((document, documentIndex) => {
        const rawTokens = tokenize(getSearchableText(document));
        const internalDocument = {
            id: documentIndex,
        };
        rawTokens.forEach((token) => {
            const stemmedToken = (0, stemmer_1.stemmer)(token);
            if (!(stemmedToken in normalizedTokenToOriginal)) {
                normalizedTokenToOriginal[stemmedToken] = new Set();
            }
            normalizedTokenToOriginal[stemmedToken].add(token);
            if (!(stemmedToken in reverseIndex)) {
                reverseIndex[stemmedToken] = new Set();
            }
            reverseIndex[stemmedToken].add(internalDocument);
        });
    });
    const tokenSet = Object.keys(reverseIndex);
    const query = (searchQuery) => {
        const searchResult = {
            results: [],
            matchedQueryTerms: [],
        };
        const normalizedSearchQuery = new Set(tokenize(searchQuery).map((token) => (0, stemmer_1.stemmer)(token)));
        if (normalizedSearchQuery.size === 0) {
            return searchResult;
        }
        const results = new Map();
        const matchedTokens = new Set();
        normalizedSearchQuery.forEach((searchToken) => {
            tokenSet.forEach((token) => {
                const { similarity } = (0, damerau_levenshtein_1.default)(searchToken, token);
                const matchesSearchToken = token === searchToken;
                const isSimilar = similarity >= 1 - options.fuzzyMatchSensitivity;
                if (matchesSearchToken || isSimilar) {
                    const documentMatches = reverseIndex[token];
                    const idf = inverseDocumentFrequency(documents.length, documentMatches.size);
                    documentMatches.forEach((document) => {
                        var _a;
                        const currentScore = (_a = results.get(document.id)) !== null && _a !== void 0 ? _a : 0;
                        const scoreForExactMatch = matchesSearchToken
                            ? options.scoreForExactMatch
                            : 0;
                        const scoreForSimilarity = isSimilar
                            ? options.scoreForSimilarMatch
                            : 0;
                        const score = scoreForExactMatch + scoreForSimilarity;
                        const scoreForToken = score * idf;
                        results.set(document.id, currentScore + scoreForToken);
                    });
                    normalizedTokenToOriginal[token].forEach((originalToken) => {
                        matchedTokens.add(originalToken);
                    });
                }
            });
        });
        const orderedResults = [...results]
            .sort((match1, match2) => {
            return match2[1] - match1[1];
        })
            .map((match) => documents[match[0]]);
        searchResult.results = orderedResults;
        searchResult.matchedQueryTerms = [...matchedTokens];
        return searchResult;
    };
    return {
        query,
    };
};
exports.buildSearchService = buildSearchService;


/***/ }),

/***/ "./src/scripts/utils/strings.ts":
/*!**************************************!*\
  !*** ./src/scripts/utils/strings.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.splitByAndKeep = void 0;
/**
 *
 * @param text String to split
 * @param delimiters Single character delimiters.
 */
function splitByAndKeep(text, delimiters) {
    const splitString = [];
    let currentToken = [];
    const delimiterSet = new Set(delimiters);
    for (const char of text) {
        if (delimiterSet.has(char)) {
            if (currentToken.length > 0) {
                splitString.push(currentToken.join(""));
            }
            splitString.push(char);
            currentToken = [];
        }
        else {
            currentToken.push(char);
        }
    }
    if (currentToken.length > 0) {
        splitString.push(currentToken.join(""));
    }
    return splitString;
}
exports.splitByAndKeep = splitByAndKeep;


/***/ }),

/***/ "./src/scripts/utils/url-handler.ts":
/*!******************************************!*\
  !*** ./src/scripts/utils/url-handler.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.loadCustomThemeFromUrl = void 0;
const Misc = __importStar(__webpack_require__(/*! ./misc */ "./src/scripts/utils/misc.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function loadCustomThemeFromUrl() {
    var _a;
    const getValue = Misc.findGetParameter("customTheme");
    if (getValue === null)
        return;
    const urlEncoded = getValue.split(",");
    let base64decoded = null;
    try {
        base64decoded = JSON.parse((_a = atob(getValue)) !== null && _a !== void 0 ? _a : "");
    }
    catch (e) {
        //
    }
    let colorArray = [];
    if (Array.isArray(urlEncoded) && urlEncoded.length === 9) {
        colorArray = urlEncoded;
    }
    else if (Array.isArray(base64decoded) && base64decoded.length === 9) {
        colorArray = base64decoded;
    }
    if (colorArray.length === 0) {
        return Notifications.add("Invalid custom theme ", 0);
    }
    const oldCustomTheme = config_1.default.customTheme;
    const oldCustomThemeColors = config_1.default.customThemeColors;
    try {
        UpdateConfig.setCustomThemeColors(colorArray);
        Notifications.add("Custom theme applied", 1);
        if (!config_1.default.customTheme)
            UpdateConfig.setCustomTheme(true);
    }
    catch (e) {
        Notifications.add("Something went wrong. Reverting to previous state.", 0);
        console.error(e);
        UpdateConfig.setCustomTheme(oldCustomTheme);
        UpdateConfig.setCustomThemeColors(oldCustomThemeColors);
    }
}
exports.loadCustomThemeFromUrl = loadCustomThemeFromUrl;


/***/ }),

/***/ "./src/scripts/version.ts":
/*!********************************!*\
  !*** ./src/scripts/version.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CLIENT_VERSION = void 0;
exports.CLIENT_VERSION = "DEVELOPMENT-CLIENT";
$(document.body).on("click", ".version", (e) => {
    if (e.shiftKey) {
        alert(exports.CLIENT_VERSION);
    }
});


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = __webpack_modules__;
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/chunk loaded */
/******/ 	(() => {
/******/ 		var deferred = [];
/******/ 		__webpack_require__.O = (result, chunkIds, fn, priority) => {
/******/ 			if(chunkIds) {
/******/ 				priority = priority || 0;
/******/ 				for(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];
/******/ 				deferred[i] = [chunkIds, fn, priority];
/******/ 				return;
/******/ 			}
/******/ 			var notFulfilled = Infinity;
/******/ 			for (var i = 0; i < deferred.length; i++) {
/******/ 				var [chunkIds, fn, priority] = deferred[i];
/******/ 				var fulfilled = true;
/******/ 				for (var j = 0; j < chunkIds.length; j++) {
/******/ 					if ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {
/******/ 						chunkIds.splice(j--, 1);
/******/ 					} else {
/******/ 						fulfilled = false;
/******/ 						if(priority < notFulfilled) notFulfilled = priority;
/******/ 					}
/******/ 				}
/******/ 				if(fulfilled) {
/******/ 					deferred.splice(i--, 1)
/******/ 					var r = fn();
/******/ 					if (r !== undefined) result = r;
/******/ 				}
/******/ 			}
/******/ 			return result;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/global */
/******/ 	(() => {
/******/ 		__webpack_require__.g = (function() {
/******/ 			if (typeof globalThis === 'object') return globalThis;
/******/ 			try {
/******/ 				return this || new Function('return this')();
/******/ 			} catch (e) {
/******/ 				if (typeof window === 'object') return window;
/******/ 			}
/******/ 		})();
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/jsonp chunk loading */
/******/ 	(() => {
/******/ 		// no baseURI
/******/ 		
/******/ 		// object to store loaded and loading chunks
/******/ 		// undefined = chunk not loaded, null = chunk preloaded/prefetched
/******/ 		// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded
/******/ 		var installedChunks = {
/******/ 			"monkeytype": 0
/******/ 		};
/******/ 		
/******/ 		// no chunk on demand loading
/******/ 		
/******/ 		// no prefetching
/******/ 		
/******/ 		// no preloaded
/******/ 		
/******/ 		// no HMR
/******/ 		
/******/ 		// no HMR manifest
/******/ 		
/******/ 		__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);
/******/ 		
/******/ 		// install a JSONP callback for chunk loading
/******/ 		var webpackJsonpCallback = (parentChunkLoadingFunction, data) => {
/******/ 			var [chunkIds, moreModules, runtime] = data;
/******/ 			// add "moreModules" to the modules object,
/******/ 			// then flag all "chunkIds" as loaded and fire callback
/******/ 			var moduleId, chunkId, i = 0;
/******/ 			if(chunkIds.some((id) => (installedChunks[id] !== 0))) {
/******/ 				for(moduleId in moreModules) {
/******/ 					if(__webpack_require__.o(moreModules, moduleId)) {
/******/ 						__webpack_require__.m[moduleId] = moreModules[moduleId];
/******/ 					}
/******/ 				}
/******/ 				if(runtime) var result = runtime(__webpack_require__);
/******/ 			}
/******/ 			if(parentChunkLoadingFunction) parentChunkLoadingFunction(data);
/******/ 			for(;i < chunkIds.length; i++) {
/******/ 				chunkId = chunkIds[i];
/******/ 				if(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {
/******/ 					installedChunks[chunkId][0]();
/******/ 				}
/******/ 				installedChunks[chunkId] = 0;
/******/ 			}
/******/ 			return __webpack_require__.O(result);
/******/ 		}
/******/ 		
/******/ 		var chunkLoadingGlobal = self["webpackChunkmonkeytype_frontend"] = self["webpackChunkmonkeytype_frontend"] || [];
/******/ 		chunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));
/******/ 		chunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module depends on other loaded chunks and execution need to be delayed
/******/ 	var __webpack_exports__ = __webpack_require__.O(undefined, ["vendor"], () => (__webpack_require__("./src/scripts/index.ts")))
/******/ 	__webpack_exports__ = __webpack_require__.O(__webpack_exports__);
/******/ 	
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHVDQUF1Qyx3QkFBd0Isa0RBQWtEO0FBQzdILFlBQVksdUNBQXVDLHdCQUF3QixrRUFBa0U7QUFDN0ksWUFBWSxTQUFTO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHVDQUF1Qyx3QkFBd0Isa0RBQWtEO0FBQzdILFlBQVksdUNBQXVDLHdCQUF3QixrRUFBa0U7QUFDN0ksWUFBWSxTQUFTO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHVDQUF1Qyx3QkFBd0Isa0RBQWtEO0FBQzdILFlBQVksdUNBQXVDLHdCQUF3QixrRUFBa0U7QUFDN0ksWUFBWSxTQUFTO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHVDQUF1Qyx3QkFBd0Isa0RBQWtEO0FBQzdILFlBQVksdUNBQXVDLHdCQUF3QixrRUFBa0U7QUFDN0ksWUFBWSxTQUFTO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSx1Q0FBdUMsd0JB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QXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFD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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLE9BQU87QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9EQUFvRDtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0MscUNBQXFDO0FBQzdFLHdDQUF3QyxxQ0FBcUM7QUFDN0U7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0Esd0NBQXdDLHFDQUFxQztBQUM3RSx3Q0FBd0MscUNBQXFDO0FBQzdFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHdDQUF3QyxxQ0FBcUM7QUFDN0Usd0NBQXdDLHFDQUFxQztBQUM3RTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLHFDQUFxQztBQUM3RSx3Q0FBd0Msc0NBQXNDO0FBQzlFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHdDQUF3QyxxQ0FBcUM7QUFDN0Usd0NBQXdDLHNDQUFzQztBQUM5RTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSx3Q0FBd0MscUNBQXFDO0FBQzdFLHdDQUF3QyxzQ0FBc0M7QUFDOUU7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0Esd0NBQXdDLHFDQUFxQztBQUM3RSx3Q0FBd0Msc0NBQXNDO0FBQzlFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHdDQUF3QyxxQ0FBcUM7QUFDN0Usd0NBQXdDLHNDQUFzQztBQUM5RTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSx3Q0FBd0MscUNBQXFDO0FBQzdFLHdDQUF3QyxzQ0FBc0M7QUFDOUU7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxxQ0FBcUM7QUFDN0Usd0NBQXdDLHNDQUFzQztBQUM5RTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSx3Q0FBd0MscUNBQXFDO0FBQzdFLHdDQUF3QyxzQ0FBc0M7QUFDOUU7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0Esd0NBQXdDLHFDQUFxQztBQUM3RSx3Q0FBd0Msc0NBQXNDO0FBQzlFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHdDQUF3QyxxQ0FBcUM7QUFDN0Usd0NBQXdDLHNDQUFzQztBQUM5RTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSx3Q0FBd0MscUNBQXFDO0FBQzdFLHdDQUF3QyxzQ0FBc0M7QUFDOUU7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0Esd0NBQXdDLHFDQUFxQztBQUM3RSx3Q0FBd0Msc0NBQXNDO0FBQzlFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0MscUNBQXFDO0FBQzdFLHdDQUF3QyxzQ0FBc0M7QUFDOUU7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0Esd0NBQXdDLHFDQUFxQztBQUM3RSx3Q0FBd0Msc0NBQXNDO0FBQzlFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHdDQUF3QyxxQ0FBcUM7QUFDN0Usd0NBQXdDLHNDQUFzQztBQUM5RTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLHFDQUFxQztBQUM3RSx3Q0FBd0Msc0NBQXNDO0FBQzlFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHdDQUF3QyxxQ0FBcUM7QUFDN0Usd0NBQXdDLHNDQUFzQztBQUM5RTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSx3Q0FBd0MscUNBQXFDO0FBQzdFLHdDQUF3QyxzQ0FBc0M7QUFDOUU7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7Ozs7Ozs7Ozs7O0FDL1JZO0FBQ2I7QUFDQTtBQUNBLG1DQUFtQyxvQ0FBb0MsZ0JBQWdCO0FBQ3ZGLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsMENBQTBDLDRCQUE0QjtBQUN0RSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsa0NBQWtDLEdBQUcsY0FBYyxHQUFHLFdBQVcsR0FBRyxhQUFhLEdBQUcsZ0NBQWdDO0FBQ3BILHdCQUF3QixtQkFBTyxDQUFDLGtDQUFPO0FBQ3ZDLGlDQUFpQyxtQkFBTyxDQUFDLHdFQUEwQjtBQUNuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0M7Ozs7Ozs7Ozs7O0FDbkdyQjtBQUNiO0FBQ0E7QUFDQSxtQ0FBbUMsb0NBQW9DLGdCQUFnQjtBQUN2RixDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLDBDQUEwQyw0QkFBNEI7QUFDdEUsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsK0RBQStELGlCQUFpQjtBQUM1RztBQUNBLG9DQUFvQyxNQUFNLCtCQUErQixZQUFZO0FBQ3JGLG1DQUFtQyxNQUFNLG1DQUFtQyxZQUFZO0FBQ3hGLGdDQUFnQztBQUNoQztBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELDZCQUE2QixHQUFHLGlDQUFpQyxHQUFHLG1CQUFtQixHQUFHLHNCQUFzQixHQUFHLG9CQUFvQixHQUFHLFdBQVcsR0FBRyxlQUFlLEdBQUcsaUJBQWlCLEdBQUcsbUJBQW1CO0FBQ2pOLGlDQUFpQyxtQkFBTyxDQUFDLHdFQUEwQjtBQUNuRSxxQ0FBcUMsbUJBQU8sQ0FBQyx5RUFBb0I7QUFDakUsMEJBQTBCLG1CQUFPLENBQUMsa0RBQWU7QUFDakQsOEJBQThCLG1CQUFPLENBQUMsMENBQVc7QUFDakQsc0NBQXNDLG1CQUFPLENBQUMsZ0dBQXNDO0FBQ3BGLGlDQUFpQyxtQkFBTyxDQUFDLDhFQUE2QjtBQUN0RSx3QkFBd0IsbUJBQU8sQ0FBQyxrQ0FBTztBQUN2QyxtQ0FBbUMsbUJBQU8sQ0FBQywwRUFBMkI7QUFDdEUseUNBQXlDLG1CQUFPLENBQUMsOEZBQXFDO0FBQ3RGO0FBQ0EsbUJBQW1CO0FBQ25CLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxLQUFLO0FBQzNDO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELEtBQUs7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxrREFBa0Qsa0JBQWtCO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFFBQVEsbUJBQW1CO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxtQkFBbUI7QUFDM0I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0EsSUFBSSxtQkFBbUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBLGlDQUFpQyx3QkFBd0I7QUFDekQ7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlEQUFpRCxrQ0FBa0M7QUFDbkY7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7Ozs7Ozs7Ozs7O0FDdFdZO0FBQ2I7QUFDQTtBQUNBLG1DQUFtQyxvQ0FBb0MsZ0JBQWdCO0FBQ3ZGLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsMENBQTBDLDRCQUE0QjtBQUN0RSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QiwrREFBK0QsaUJBQWlCO0FBQzVHO0FBQ0Esb0NBQW9DLE1BQU0sK0JBQStCLFlBQVk7QUFDckYsbUNBQW1DLE1BQU0sbUNBQW1DLFlBQVk7QUFDeEYsZ0NBQWdDO0FBQ2hDO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSw2Q0FBNkM7QUFDN0M7QUFDQSw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsY0FBYyxHQUFHLFdBQVcsR0FBRyxZQUFZO0FBQzNDLDhCQUE4QixtQkFBTyxDQUFDLDBDQUFRO0FBQzlDLG1DQUFtQyxtQkFBTyxDQUFDLDBFQUEyQjtBQUN0RSw4QkFBOEIsbUJBQU8sQ0FBQywwREFBbUI7QUFDekQsd0JBQXdCLG1CQUFPLENBQUMsa0NBQU87QUFDdkMsNEJBQTRCLG1CQUFPLENBQUMsNERBQW9CO0FBQ3hELFlBQVk7QUFDWjtBQUNBLElBQUksWUFBWTtBQUNoQjtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLGdCQUFnQjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLGNBQWM7Ozs7Ozs7Ozs7O0FDL0REO0FBQ2I7QUFDQTtBQUNBLG1DQUFtQyxvQ0FBb0MsZ0JBQWdCO0FBQ3ZGLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsMENBQTBDLDRCQUE0QjtBQUN0RSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QiwrREFBK0QsaUJBQWlCO0FBQzVHO0FBQ0Esb0NBQW9DLE1BQU0sK0JBQStCLFlBQVk7QUFDckYsbUNBQW1DLE1BQU0sbUNBQW1DLFlBQVk7QUFDeEYsZ0NBQWdDO0FBQ2hDO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSw2Q0FBNkM7QUFDN0M7QUFDQSw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0Qsd0JBQXdCLEdBQUcsdUJBQXVCLEdBQUcsa0JBQWtCLEdBQUcsc0JBQXNCLEdBQUcsc0JBQXNCLEdBQUcscUJBQXFCLEdBQUcsbUJBQW1CLEdBQUcsa0JBQWtCLEdBQUcsd0JBQXdCLEdBQUcseUJBQXlCLEdBQUcseUJBQXlCLEdBQUcsdUJBQXVCLEdBQUcsc0JBQXNCLEdBQUcsMEJBQTBCLEdBQUcsc0JBQXNCLEdBQUcsb0JBQW9CLEdBQUcsbUJBQW1CLEdBQUcsbUJBQW1CO0FBQzNiLDhCQUE4QixtQkFBTyxDQUFDLHlDQUFPO0FBQzdDLG1DQUFtQyxtQkFBTyxDQUFDLDJFQUEyQjtBQUN0RSxtQ0FBbUMsbUJBQU8sQ0FBQyx5RUFBMEI7QUFDckUsaUNBQWlDLG1CQUFPLENBQUMsdURBQWlCO0FBQzFELHlDQUF5QyxtQkFBTyxDQUFDLDZFQUE0QjtBQUM3RSxtQkFBbUIsbUJBQU8sQ0FBQyw2Q0FBWTtBQUN2QywyQkFBMkIsbUJBQU8sQ0FBQyxpRkFBOEI7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLHNCQUFzQjtBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLHdCQUF3QjtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLHNCQUFzQjtBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLHlCQUF5QjtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0Q7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2REFBNkQsWUFBWSw4QkFBOEI7QUFDdkc7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZELGVBQWUsY0FBYztBQUMxRjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCLDZCQUE2QjtBQUM3QiwyQkFBMkIsU0FBUztBQUNwQyw2QkFBNkIsWUFBWTtBQUN6Qyw4QkFBOEIsWUFBWTtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBLHdEQUF3RDtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1Qiw2QkFBNkI7QUFDN0IsMkJBQTJCLFNBQVM7QUFDcEMsNkJBQTZCLFlBQVk7QUFDekMsOEJBQThCLFlBQVk7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCLDZCQUE2QjtBQUM3QiwyQkFBMkIsU0FBUztBQUNwQyw2QkFBNkIsWUFBWTtBQUN6Qyw4QkFBOEIsWUFBWTtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1Qiw2QkFBNkI7QUFDN0IsMkJBQTJCLFNBQVM7QUFDcEMsNkJBQTZCLFlBQVk7QUFDekMsOEJBQThCLFlBQVk7QUFDMUM7QUFDQTtBQUNBLHlEQUF5RDtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLFFBQVEsTUFBTSxZQUFZLFFBQVE7QUFDeEU7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLFlBQVk7QUFDdEMsMEJBQTBCLFlBQVk7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDOXNCYTtBQUNiO0FBQ0E7QUFDQSxtQ0FBbUMsb0NBQW9DLGdCQUFnQjtBQUN2RixDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLDBDQUEwQyw0QkFBNEI7QUFDdEUsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGNBQWMsR0FBRyxlQUFlO0FBQ2hDLG1CQUFtQixtQkFBTyxDQUFDLDhDQUFhO0FBQ3hDLDBCQUEwQixtQkFBTyxDQUFDLGtEQUFlO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjOzs7Ozs7Ozs7OztBQzNDRDtBQUNiO0FBQ0E7QUFDQSxtQ0FBbUMsb0NBQW9DLGdCQUFnQjtBQUN2RixDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLDBDQUEwQyw0QkFBNEI7QUFDdEUsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsK0RBQStELGlCQUFpQjtBQUM1RztBQUNBLG9DQUFvQyxNQUFNLCtCQUErQixZQUFZO0FBQ3JGLG1DQUFtQyxNQUFNLG1DQUFtQyxZQUFZO0FBQ3hGLGdDQUFnQztBQUNoQztBQUNBLEtBQUs7QUFDTDtBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxlQUFlLEdBQUcsbUJBQW1CLEdBQUcsa0JBQWtCLEdBQUcsdUJBQXVCLEdBQUcsMkJBQTJCLEdBQUcsMEJBQTBCLEdBQUcscUJBQXFCLEdBQUcscUNBQXFDLEdBQUcsK0JBQStCLEdBQUcsMkJBQTJCLEdBQUcseUJBQXlCLEdBQUcsNEJBQTRCLEdBQUcseUJBQXlCLEdBQUcsNkJBQTZCLEdBQUcsZUFBZTtBQUN4Wix3QkFBd0IsbUJBQU8sQ0FBQyxrQ0FBTztBQUN2QywwQkFBMEIsbUJBQU8sQ0FBQyxrREFBZTtBQUNqRCxtQ0FBbUMsbUJBQU8sQ0FBQyxnRUFBaUI7QUFDNUQsMkJBQTJCLG1CQUFPLENBQUMsc0ZBQWlDO0FBQ3BFLHFDQUFxQyxtQkFBTyxDQUFDLHNGQUFpQztBQUM5RSxxQ0FBcUMsbUJBQU8sQ0FBQyw4RUFBNkI7QUFDMUUsbUNBQW1DLG1CQUFPLENBQUMsb0ZBQWdDO0FBQzNFLDhCQUE4QixtQkFBTyxDQUFDLDBDQUFXO0FBQ2pELG1DQUFtQyxtQkFBTyxDQUFDLG9FQUF3QjtBQUNuRSw0QkFBNEIsbUJBQU8sQ0FBQyxzREFBaUI7QUFDckQsK0JBQStCLG1CQUFPLENBQUMsNERBQW9CO0FBQzNELDRCQUE0QixtQkFBTyxDQUFDLG9EQUFnQjtBQUNwRCxtQ0FBbUMsbUJBQU8sQ0FBQyxrRkFBK0I7QUFDMUUsc0NBQXNDLG1CQUFPLENBQUMsd0ZBQWtDO0FBQ2hGLGdDQUFnQyxtQkFBTyxDQUFDLDhEQUFxQjtBQUM3RCw4QkFBOEIsbUJBQU8sQ0FBQywwREFBbUI7QUFDekQseUNBQXlDLG1CQUFPLENBQUMsOEZBQXFDO0FBQ3RGLCtCQUErQixtQkFBTyxDQUFDLDREQUFvQjtBQUMzRCwrQkFBK0IsbUJBQU8sQ0FBQyw0REFBb0I7QUFDM0QsaUNBQWlDLG1CQUFPLENBQUMsd0VBQTBCO0FBQ25FLGlDQUFpQyxtQkFBTyxDQUFDLDhFQUE2QjtBQUN0RSxtQkFBbUIsbUJBQU8sQ0FBQyw4Q0FBYTtBQUN4QyxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULEtBQUs7QUFDTCxDQUFDO0FBQ0QsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxJQUFJLGtDQUFrQztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnRkFBZ0YsUUFBUTtBQUN4RjtBQUNBO0FBQ0E7QUFDQSxnRkFBZ0YsUUFBUTtBQUN4RjtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksb0NBQW9DO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLO0FBQ0wsQ0FBQztBQUNELDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSwwQkFBMEI7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCLHFCQUFxQjtBQUNyQjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQSxJQUFJLGVBQWU7QUFDbkI7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7Ozs7Ozs7Ozs7O0FDdnNHWTtBQUNiO0FBQ0E7QUFDQSxtQ0FBbUMsb0NBQW9DLGdCQUFnQjtBQUN2RixDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLDBDQUEwQyw0QkFBNEI7QUFDdEUsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELFlBQVksR0FBRyxxQ0FBcUM7QUFDcEQscUNBQXFDLG1CQUFPLENBQUMsc0ZBQWlDO0FBQzlFLDhCQUE4QixtQkFBTyxDQUFDLDBDQUFXO0FBQ2pELDJCQUEyQixtQkFBTyxDQUFDLGtEQUFlO0FBQ2xELHNDQUFzQyxtQkFBTyxDQUFDLHdFQUFxQjtBQUNuRSw0QkFBNEIsbUJBQU8sQ0FBQyxzREFBaUI7QUFDckQsd0JBQXdCLG1CQUFPLENBQUMsa0NBQU87QUFDdkMsbUNBQW1DLG1CQUFPLENBQUMsMEVBQTJCO0FBQ3RFLHlDQUF5QyxtQkFBTyxDQUFDLDhGQUFxQztBQUN0RixvQ0FBb0MsbUJBQU8sQ0FBQywwRUFBMkI7QUFDdkUsbUJBQW1CLG1CQUFPLENBQUMsOENBQWE7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRCxLQUFLO0FBQ3JEO0FBQ0E7QUFDQSw4Q0FBOEMsS0FBSztBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRCxLQUFLO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBLDJEQUEyRCxPQUFPLElBQUksU0FBUyxPQUFPLFlBQVk7QUFDbEc7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDJDQUEyQyxzQkFBc0I7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscURBQXFEO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EscURBQXFELFNBQVM7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0Q7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksWUFBWTtBQUNoQjtBQUNBO0FBQ0E7QUFDQSxJQUFJLFlBQVk7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxxREFBcUQsZ0VBQWdFO0FBQ3JIO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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UztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzREFBc0Q7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxREFBcUQseUJBQXlCO0FBQzlFLHVEQUF1RCxVQUFVLEdBQUcsMkRBQTJEO0FBQy9IO0FBQ0EsUUFBUSx1Q0FBdUM7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0dBQWdHO0FBQ2hHLHFHQUFxRyxFQUFFLCtDQUErQztBQUN0SjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQsRUFBRTtBQUN6RDtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsNEJBQTRCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxNQUFNO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLGlCQUFpQixNQUFNO0FBQ3ZCLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRCxZ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QSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLFlBQVk7QUFDbkM7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLFlBQVk7QUFDL0I7QUFDQSxLQUFLO0FBQ0w7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixZQUFZO0FBQ25DO0FBQ0EsU0FBUztBQUNUO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNELHdCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0QsdUJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNELDJCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRCw0QkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0QsMEJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNB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O0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsOENBQThDLHVCQUF1QjtBQUNyRTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLDBCQUEwQjtBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSx3QkFBd0I7Ozs7Ozs7Ozs7O0FDMU9YO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsK0NBQStDO0FBQ3JFO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEM7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQzs7Ozs7Ozs7Ozs7QUN2VFk7QUFDYjtBQUNBO0FBQ0EsbUNBQW1DLG9DQUFvQyxnQkFBZ0I7QUFDdkYsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSwwQ0FBMEMsNEJBQTRCO0FBQ3RFLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLCtEQUErRCxpQkFBaUI7QUFDNUc7QUFDQSxvQ0FBb0MsTUFBTSwrQkFBK0IsWUFBWTtBQUNyRixtQ0FBbUMsTUFBTSxtQ0FBbUMsWUFBWTtBQUN4RixnQ0FBZ0M7QUFDaEM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDZDQUE2QztBQUM3QztBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxjQUFjLEdBQUcsdUJBQXVCLEdBQUcsbUJBQW1CLEdBQUcsaUJBQWlCLEdBQUcsaUJBQWlCLEdBQUcsMEJBQTBCLEdBQUcseUJBQXlCLEdBQUcsMkJBQTJCO0FBQzdMLDRCQUE0QixtQkFBTyxDQUFDLGdEQUFXO0FBQy9DLGlDQUFpQyxtQkFBTyxDQUFDLDBDQUFXO0FBQ3BELDBCQUEwQixtQkFBTyxDQUFDLGtEQUFlO0FBQ2pELCtCQUErQixtQkFBTyxDQUFDLHNEQUFjO0FBQ3JELDRCQUE0QixtQkFBTyxDQUFDLDREQUFvQjtBQUN4RCxxQ0FBcUMsbUJBQU8sQ0FBQyxzRkFBaUM7QUFDOUUsaUNBQWlDLG1CQUFPLENBQUMsd0VBQTBCO0FBQ25FLHdCQUF3QixtQkFBTyxDQUFDLGtDQUFPO0FBQ3ZDLGtDQUFrQyxtQkFBTyxDQUFDLDREQUFpQjtBQUMzRCw2QkFBNkIsbUJBQU8sQ0FBQyxrREFBWTtBQUNqRCxvQ0FBb0MsbUJBQU8sQ0FBQyw0RUFBNEI7QUFDeEUsaUNBQWlDLG1CQUFPLENBQUMsb0VBQXdCO0FBQ2pFLCtCQUErQixtQkFBTyxDQUFDLHNEQUFjO0FBQ3JELG1DQUFtQyxtQkFBTyxDQUFDLDBFQUEyQjtBQUN0RSx1Q0FBdUMsbUJBQU8sQ0FBQyw0RkFBb0M7QUFDbkYsbUJBQW1CLG1CQUFPLENBQUMsMkRBQVU7QUFDckMsbUJBQW1CLG1CQUFPLENBQUMsOENBQWE7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGtDQUFrQztBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLFFBQVE7QUFDeEMsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsU0FBUztBQUN6QyxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0ZBQWtGLCtCQUErQjtBQUNqSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUdBQXFHLDJCQUEyQjtBQUNoSTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVFQUF1RSxpQ0FBaUM7QUFDeEc7QUFDQTtBQUNBO0FBQ0EsdUVBQXVFLG1CQUFtQixLQUFLLHNCQUFzQjtBQUNySDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTRELG1CQUFtQixRQUFRLGtCQUFrQjtBQUN6RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdFQUFnRSxtQ0FBbUMsS0FBSyxtQkFBbUIsUUFBUSxrQkFBa0I7QUFDcko7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVEsb0JBQW9CLElBQUksMEJBQTBCLFNBQVM7QUFDdkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RCxRQUFRO0FBQ3JFLDZEQUE2RCxRQUFRO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsVUFBVSxNQUFNLHlFQUF5RTtBQUM3SCxxQkFBcUI7QUFDckIsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsV0FBVztBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLE1BQU07QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLFlBQVk7QUFDbkM7QUFDQSx1QkFBdUIsWUFBWTtBQUNuQyxTQUFTO0FBQ1Q7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLFlBQVksTUFBTSxXQUFXLFFBQVEsZUFBZSxNQUFNLG1CQUFtQjtBQUN4SDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsY0FBYztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsUUFBUTtBQUN0QztBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQSxjQUFjOzs7Ozs7Ozs7OztBQ2xuQkQ7QUFDYjtBQUNBO0FBQ0EsbUNBQW1DLG9DQUFvQyxnQkFBZ0I7QUFDdkYsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSwwQ0FBMEMsNEJBQTRCO0FBQ3RFLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLCtEQUErRCxpQkFBaUI7QUFDNUc7QUFDQSxvQ0FBb0MsTUFBTSwrQkFBK0IsWUFBWTtBQUNyRixtQ0FBbUMsTUFBTSxtQ0FBbUMsWUFBWTtBQUN4RixnQ0FBZ0M7QUFDaEM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDZDQUE2QztBQUM3QztBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCw0QkFBNEIsR0FBRyxhQUFhLEdBQUcsa0JBQWtCLEdBQUcsaUJBQWlCO0FBQ3JGLGlDQUFpQyxtQkFBTyxDQUFDLDBDQUFXO0FBQ3BELDBCQUEwQixtQkFBTyxDQUFDLGtEQUFlO0FBQ2pELHVCQUF1QixtQkFBTyxDQUFDLDBEQUFnQjtBQUMvQyxpQkFBaUI7QUFDakIsa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsdUJBQXVCO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlCQUFpQjtBQUN6QixRQUFRLGtCQUFrQjtBQUMxQjtBQUNBO0FBQ0EsUUFBUSxpQkFBaUI7QUFDekIsUUFBUSxrQkFBa0I7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLFFBQVEsaUJBQWlCO0FBQ3pCLFFBQVEsa0JBQWtCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsSUFBSSxpQkFBaUI7QUFDckIsSUFBSSxrQkFBa0I7QUFDdEI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSw0QkFBNEI7Ozs7Ozs7Ozs7O0FDak5mO0FBQ2I7QUFDQTtBQUNBLG1DQUFtQyxvQ0FBb0MsZ0JBQWdCO0FBQ3ZGLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsMENBQTBDLDRCQUE0QjtBQUN0RSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QztBQUM3QztBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxrQkFBa0I7QUFDbEIsa0JBQWtCLG1CQUFPLENBQUMsZ0RBQVc7QUFDckMsK0JBQStCLG1CQUFPLENBQUMsc0RBQWM7QUFDckQscUNBQXFDLG1CQUFPLENBQUMsd0ZBQWtDO0FBQy9FLGlDQUFpQyxtQkFBTyxDQUFDLDhFQUE2QjtBQUN0RSxlQUFlLG1CQUFPLENBQUMsa0RBQWU7QUFDdEMsaUNBQWlDLG1CQUFPLENBQUMsMENBQVc7QUFDcEQsaUNBQWlDLG1CQUFPLENBQUMsMENBQVc7QUFDcEQsdUNBQXVDLG1CQUFPLENBQUMsNEZBQW9DO0FBQ25GLG9DQUFvQyxtQkFBTyxDQUFDLHNGQUFpQztBQUM3RSx5Q0FBeUMsbUJBQU8sQ0FBQyxnR0FBc0M7QUFDdkYsbUJBQW1CLG1CQUFPLENBQUMsMERBQW1CO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxJQUFJO0FBQ3ZDO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsZUFBZTtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTRELGFBQWE7QUFDekU7QUFDQTtBQUNBLG9EQUFvRCxhQUFhO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0RBQWdEO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQiw0QkFBNEI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0Qyx5QkFBeUI7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDLHVCQUF1QixFQUFFLE9BQU8sRUFBRSw2Q0FBNkMsRUFBRSxPQUFPO0FBQ3ZJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixpQkFBaUI7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsZ0JBQWdCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0Msa0RBQWtEO0FBQzFGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLGdCQUFnQjtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLGlFQUFpRSx3QkFBd0I7QUFDckk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaUJBQWlCO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHdDQUF3QztBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MsV0FBVztBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsNkJBQTZCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFD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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUM7QUFDdkM7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixtQkFBbUI7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixhQUFhO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1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O1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTs7Ozs7V0MzQkE7V0FDQTtXQUNBO1dBQ0E7V0FDQSx5Q0FBeUMsd0NBQXdDO1dBQ2pGO1dBQ0E7V0FDQTs7Ozs7V0NQQTtXQUNBO1dBQ0E7V0FDQTtXQUNBLEdBQUc7V0FDSDtXQUNBO1dBQ0EsQ0FBQzs7Ozs7V0NQRDs7Ozs7V0NBQTtXQUNBO1dBQ0E7V0FDQSx1REFBdUQsaUJBQWlCO1dBQ3hFO1dBQ0EsZ0RBQWdELGFBQWE7V0FDN0Q7Ozs7O1dDTkE7O1dBRUE7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBOztXQUVBOztXQUVBOztXQUVBOztXQUVBOztXQUVBOztXQUVBOztXQUVBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBLE1BQU0scUJBQXFCO1dBQzNCO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7O1dBRUE7V0FDQTtXQUNBOzs7OztVRWhEQTtVQUNBO1VBQ0E7VUFDQTtVQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zdHlsZXMvaW5kZXguc2Nzcz84NmVjIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9hY2NvdW50L2FsbC10aW1lLXN0YXRzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9hY2NvdW50L21pbmktcmVzdWx0LWNoYXJ0LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9hY2NvdW50L3BiLXRhYmxlcy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvYWNjb3VudC9yZXN1bHQtZmlsdGVycy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvYWNjb3VudC9zaWduLW91dC1idXR0b24udHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2FwZS9lbmRwb2ludHMvYXBlLWtleXMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2FwZS9lbmRwb2ludHMvY29uZmlncy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvYXBlL2VuZHBvaW50cy9pbmRleC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvYXBlL2VuZHBvaW50cy9sZWFkZXJib2FyZHMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2FwZS9lbmRwb2ludHMvcHJlc2V0cy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvYXBlL2VuZHBvaW50cy9wc2FzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9hcGUvZW5kcG9pbnRzL3F1b3Rlcy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvYXBlL2VuZHBvaW50cy9yZXN1bHRzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9hcGUvZW5kcG9pbnRzL3VzZXJzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9hcGUvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbmZpZy12YWxpZGF0aW9uLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb25maWcudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbnN0YW50cy9kZWZhdWx0LWNvbmZpZy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29uc3RhbnRzL2RlZmF1bHQtc25hcHNob3QudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbnN0YW50cy9maXJlYmFzZS1jb25maWcudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbnRyb2xsZXJzL2FjY291bnQtY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29udHJvbGxlcnMvYW5hbHl0aWNzLWNvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbnRyb2xsZXJzL2NoYWxsZW5nZS1jb250cm9sbGVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb250cm9sbGVycy9jaGFydC1jb250cm9sbGVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb250cm9sbGVycy9pbnB1dC1jb250cm9sbGVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb250cm9sbGVycy9wYWdlLWNvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbnRyb2xsZXJzL3ByZXNldC1jb250cm9sbGVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb250cm9sbGVycy9xdW90ZXMtY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29udHJvbGxlcnMvcm91dGUtY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29udHJvbGxlcnMvc291bmQtY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29udHJvbGxlcnMvdGFnLWNvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbnRyb2xsZXJzL3RoZW1lLWNvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbnRyb2xsZXJzL3ZlcmlmaWNhdGlvbi1jb250cm9sbGVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9kYi50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvZWxlbWVudHMvYWNjb3VudC1idXR0b24udHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2VsZW1lbnRzL2NvbW1hbmRsaW5lLWxpc3RzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9lbGVtZW50cy9jb21tYW5kbGluZS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvZWxlbWVudHMvY3VzdG9tLWJhY2tncm91bmQtZmlsdGVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9lbGVtZW50cy9rZXltYXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2VsZW1lbnRzL2xhc3QtMTAtYXZlcmFnZS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvZWxlbWVudHMvbGVhZGVyYm9hcmRzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9lbGVtZW50cy9sb2FkZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2VsZW1lbnRzL21vZGVzLW5vdGljZS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvZWxlbWVudHMvbW9ua2V5LXBvd2VyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9lbGVtZW50cy9ub3RpZmljYXRpb25zLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9lbGVtZW50cy9wc2EudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2VsZW1lbnRzL3Njcm9sbC10by10b3AudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2VsZW1lbnRzL3RoZW1lLWNvbG9ycy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvZWxlbWVudHMvdmVyc2lvbi1jaGVjay50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvZmlyZWJhc2UudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2luZGV4LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9vYnNlcnZhYmxlcy9jb25maWctZXZlbnQudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL29ic2VydmFibGVzL3BhZ2UtY2hhbmdlLWV2ZW50LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9vYnNlcnZhYmxlcy9yZXNldC1yZXF1ZXN0ZWQtZXZlbnQudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL29ic2VydmFibGVzL3Jlc3VsdHMtc2hvd24tZXZlbnQudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL29ic2VydmFibGVzL3RpbWVyLWV2ZW50LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9vYnNlcnZhYmxlcy93b3JkLXR5cGVkLWV2ZW50LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wYWdlcy9hYm91dC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcGFnZXMvYWNjb3VudC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcGFnZXMvbG9hZGluZy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcGFnZXMvbG9naW4udHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BhZ2VzL3BhZ2UudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BhZ2VzL3NldHRpbmdzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wYWdlcy90ZXN0LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvYXBlLWtleXMtcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9jb250YWN0LXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvY3VzdG9tLXRlc3QtZHVyYXRpb24tcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9jdXN0b20tdGV4dC1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL2N1c3RvbS10aGVtZS1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL2N1c3RvbS13b3JkLWFtb3VudC1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL2VkaXQtcHJlc2V0LXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvZWRpdC10YWdzLXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvaW1wb3J0LWV4cG9ydC1zZXR0aW5ncy1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL21vYmlsZS10ZXN0LWNvbmZpZy1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL3BiLXRhYmxlcy1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL3F1b3RlLWFwcHJvdmUtcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9xdW90ZS1yYXRlLXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvcXVvdGUtcmVwb3J0LXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvcXVvdGUtc2VhcmNoLXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvcXVvdGUtc3VibWl0LXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvcmVzdWx0LXRhZ3MtcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9zYXZlZC10ZXh0cy1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL3NpbXBsZS1wb3B1cHMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9zdXBwb3J0LXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvdmVyc2lvbi1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL3dvcmQtZmlsdGVyLXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9yZWFkeS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvc2V0dGluZ3Mvc2V0dGluZ3MtZ3JvdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3NldHRpbmdzL3RoZW1lLXBpY2tlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvc3RhdGVzL2FjdGl2ZS1wYWdlLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9zdGF0ZXMvZ2xhcnNlcy1tb2RlLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9zdGF0ZXMvcGFnZS10cmFuc2l0aW9uLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9zdGF0ZXMvc2xvdy10aW1lci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvc3RhdGVzL3Rlc3QtYWN0aXZlLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9zdGF0ZXMvdGltZS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9icml0aXNoLWVuZ2xpc2gudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvY2Fwcy13YXJuaW5nLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L2NhcmV0LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L2N1c3RvbS10ZXh0LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L2ZvY3VzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L2Z1bmJveC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9sYXlvdXQtZW11bGF0b3IudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvbGF6eS1tb2RlLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L2xpdmUtYWNjLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L2xpdmUtYnVyc3QudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvbGl2ZS13cG0udHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvbWFudWFsLXJlc3RhcnQtdHJhY2tlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9tb25rZXkudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3Qvb3V0LW9mLWZvY3VzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3BhY2UtY2FyZXQudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvcGItY3Jvd24udHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvcG9ldHJ5LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3ByYWN0aXNlLXdvcmRzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3JlcGxheS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9yZXN1bHQudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3Qvc2hpZnQtdHJhY2tlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC90YmQtbW9kZS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC90ZXN0LWNvbmZpZy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC90ZXN0LWlucHV0LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3Rlc3QtbG9naWMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvdGVzdC1zdGF0ZS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC90ZXN0LXN0YXRzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3Rlc3QtdGltZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvdGVzdC11aS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC90ZXN0LXdvcmRzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3RpbWVyLXByb2dyZXNzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3RvZGF5LXRyYWNrZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvdHRzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3dlYWstc3BvdC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC93aWtpcGVkaWEudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3Qvd29yZHNldC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdWkudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3V0aWxzL2RlYm91bmNlLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy91dGlscy9taXNjLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy91dGlscy9zZWFyY2gtc2VydmljZS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdXRpbHMvc3RyaW5ncy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdXRpbHMvdXJsLWhhbmRsZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3ZlcnNpb24udHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kL3dlYnBhY2svcnVudGltZS9jaHVuayBsb2FkZWQiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC93ZWJwYWNrL3J1bnRpbWUvZ2xvYmFsIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC93ZWJwYWNrL3J1bnRpbWUvanNvbnAgY2h1bmsgbG9hZGluZyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kL3dlYnBhY2svYmVmb3JlLXN0YXJ0dXAiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC93ZWJwYWNrL3N0YXJ0dXAiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC93ZWJwYWNrL2FmdGVyLXN0YXJ0dXAiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gZXh0cmFjdGVkIGJ5IG1pbmktY3NzLWV4dHJhY3QtcGx1Z2luXG5leHBvcnQge307IiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudXBkYXRlID0gZXhwb3J0cy5jbGVhciA9IHZvaWQgMDtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmZ1bmN0aW9uIGNsZWFyKCkge1xuICAgICQoXCIucGFnZUFjY291bnQgLmdsb2JhbFRpbWVUeXBpbmcgLnZhbFwiKS50ZXh0KGAtYCk7XG4gICAgJChcIi5wYWdlQWNjb3VudCAuZ2xvYmFsVGVzdHNTdGFydGVkIC52YWxcIikudGV4dChgLWApO1xuICAgICQoXCIucGFnZUFjY291bnQgLmdsb2JhbFRlc3RzQ29tcGxldGVkIC52YWxcIikudGV4dChgLWApO1xufVxuZXhwb3J0cy5jbGVhciA9IGNsZWFyO1xuZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgY29uc3Qgc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdCgpO1xuICAgIGlmIChzbmFwc2hvdC5nbG9iYWxTdGF0cyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIC8vIGxldCB0aCA9IE1hdGguZmxvb3IoREIuZ2V0U25hcHNob3QoKS5nbG9iYWxTdGF0cy50aW1lIC8gMzYwMCk7XG4gICAgICAgIC8vIGxldCB0bSA9IE1hdGguZmxvb3IoKERCLmdldFNuYXBzaG90KCkuZ2xvYmFsU3RhdHMudGltZSAlIDM2MDApIC8gNjApO1xuICAgICAgICAvLyBsZXQgdHMgPSBNYXRoLmZsb29yKChEQi5nZXRTbmFwc2hvdCgpLmdsb2JhbFN0YXRzLnRpbWUgJSAzNjAwKSAlIDYwKTtcbiAgICAgICAgY29uc3Qgc2Vjb25kcyA9IChfYiA9IChfYSA9IHNuYXBzaG90ID09PSBudWxsIHx8IHNuYXBzaG90ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzbmFwc2hvdC5nbG9iYWxTdGF0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRpbWUpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IDA7XG4gICAgICAgIGxldCBzdHJpbmcgPSBcIlwiO1xuICAgICAgICBpZiAoc2Vjb25kcyA9PT0gMCkge1xuICAgICAgICAgICAgc3RyaW5nID0gXCItXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzdHJpbmcgPSBNaXNjLnNlY29uZHNUb1N0cmluZyhNYXRoLnJvdW5kKHNlY29uZHMpLCB0cnVlLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5nbG9iYWxUaW1lVHlwaW5nIC52YWxcIikudGV4dChzdHJpbmcpO1xuICAgIH1cbiAgICBpZiAoc25hcHNob3QuZ2xvYmFsU3RhdHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5nbG9iYWxUZXN0c1N0YXJ0ZWQgLnZhbFwiKS50ZXh0KHNuYXBzaG90Lmdsb2JhbFN0YXRzLnN0YXJ0ZWQpO1xuICAgIH1cbiAgICBpZiAoc25hcHNob3QuZ2xvYmFsU3RhdHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5nbG9iYWxUZXN0c0NvbXBsZXRlZCAudmFsXCIpLnRleHQoc25hcHNob3QuZ2xvYmFsU3RhdHMuY29tcGxldGVkKTtcbiAgICB9XG59XG5leHBvcnRzLnVwZGF0ZSA9IHVwZGF0ZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZURhdGEgPSBleHBvcnRzLnNob3cgPSBleHBvcnRzLnVwZGF0ZVBvc2l0aW9uID0gdm9pZCAwO1xuY29uc3QgQ2hhcnRDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9jaGFydC1jb250cm9sbGVyXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgbWluaVJlc3VsdFNjYWxlT3B0aW9ucyA9IENoYXJ0Q29udHJvbGxlci5yZXN1bHQub3B0aW9ucy5zY2FsZXM7XG5mdW5jdGlvbiB1cGRhdGVQb3NpdGlvbih4LCB5KSB7XG4gICAgJChcIi5wYWdlQWNjb3VudCAubWluaVJlc3VsdENoYXJ0V3JhcHBlclwiKS5jc3MoeyB0b3A6IHksIGxlZnQ6IHggfSk7XG59XG5leHBvcnRzLnVwZGF0ZVBvc2l0aW9uID0gdXBkYXRlUG9zaXRpb247XG5mdW5jdGlvbiBzaG93KCkge1xuICAgICQoXCIucGFnZUFjY291bnQgLm1pbmlSZXN1bHRDaGFydFdyYXBwZXJcIikuc3RvcCh0cnVlLCB0cnVlKS5mYWRlSW4oMTI1KTtcbiAgICAkKFwiLnBhZ2VBY2NvdW50IC5taW5pUmVzdWx0Q2hhcnRCZ1wiKS5zdG9wKHRydWUsIHRydWUpLmZhZGVJbigxMjUpO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgJChcIi5wYWdlQWNjb3VudCAubWluaVJlc3VsdENoYXJ0V3JhcHBlclwiKS5zdG9wKHRydWUsIHRydWUpLmZhZGVPdXQoMTI1KTtcbiAgICAkKFwiLnBhZ2VBY2NvdW50IC5taW5pUmVzdWx0Q2hhcnRCZ1wiKS5zdG9wKHRydWUsIHRydWUpLmZhZGVPdXQoMTI1KTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZURhdGEoZGF0YSkge1xuICAgIC8vIGxldCBkYXRhID0gZmlsdGVyZWRSZXN1bHRzW2ZpbHRlcmVkSWRdLmNoYXJ0RGF0YTtcbiAgICBjb25zdCBsYWJlbHMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBkYXRhLndwbS5sZW5ndGg7IGkrKykge1xuICAgICAgICBsYWJlbHMucHVzaChpLnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgICBDaGFydENvbnRyb2xsZXIubWluaVJlc3VsdC5kYXRhLmxhYmVscyA9IGxhYmVscztcbiAgICBDaGFydENvbnRyb2xsZXIubWluaVJlc3VsdC5kYXRhLmRhdGFzZXRzWzBdLmRhdGEgPSBkYXRhLndwbTtcbiAgICBDaGFydENvbnRyb2xsZXIubWluaVJlc3VsdC5kYXRhLmRhdGFzZXRzWzFdLmRhdGEgPSBkYXRhLnJhdztcbiAgICBDaGFydENvbnRyb2xsZXIubWluaVJlc3VsdC5kYXRhLmRhdGFzZXRzWzJdLmRhdGEgPSBkYXRhLmVycjtcbiAgICBjb25zdCBtYXhDaGFydFZhbCA9IE1hdGgubWF4KC4uLltNYXRoLm1heCguLi5kYXRhLndwbSksIE1hdGgubWF4KC4uLmRhdGEucmF3KV0pO1xuICAgIGNvbnN0IG1pbkNoYXJ0VmFsID0gTWF0aC5taW4oLi4uW01hdGgubWluKC4uLmRhdGEud3BtKSwgTWF0aC5taW4oLi4uZGF0YS5yYXcpXSk7XG4gICAgbWluaVJlc3VsdFNjYWxlT3B0aW9uc1tcIndwbVwiXS5tYXggPSBNYXRoLnJvdW5kKG1heENoYXJ0VmFsKTtcbiAgICBtaW5pUmVzdWx0U2NhbGVPcHRpb25zW1wicmF3XCJdLm1heCA9IE1hdGgucm91bmQobWF4Q2hhcnRWYWwpO1xuICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5zdGFydEdyYXBoc0F0WmVybykge1xuICAgICAgICBtaW5pUmVzdWx0U2NhbGVPcHRpb25zW1wid3BtXCJdLm1pbiA9IE1hdGgucm91bmQobWluQ2hhcnRWYWwpO1xuICAgICAgICBtaW5pUmVzdWx0U2NhbGVPcHRpb25zW1wicmF3XCJdLm1pbiA9IE1hdGgucm91bmQobWluQ2hhcnRWYWwpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgbWluaVJlc3VsdFNjYWxlT3B0aW9uc1tcIndwbVwiXS5taW4gPSAwO1xuICAgICAgICBtaW5pUmVzdWx0U2NhbGVPcHRpb25zW1wicmF3XCJdLm1pbiA9IDA7XG4gICAgfVxuICAgIENoYXJ0Q29udHJvbGxlci5taW5pUmVzdWx0LnVwZGF0ZUNvbG9ycygpO1xufVxuZXhwb3J0cy51cGRhdGVEYXRhID0gdXBkYXRlRGF0YTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZUFjY291bnQgLm1pbmlSZXN1bHRDaGFydEJnXCIsICgpID0+IHtcbiAgICBoaWRlKCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZSA9IHZvaWQgMDtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgZm9ybWF0XzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImRhdGUtZm5zL2Zvcm1hdFwiKSk7XG5mdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgJChcIi5wYWdlQWNjb3VudCAudGltZVBiVGFibGUgdGJvZHlcIikuaHRtbChgXG4gIDx0cj5cbiAgICA8dGQ+MTU8L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgPC90cj5cbiAgPHRyPlxuICAgIDx0ZD4zMDwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICA8L3RyPlxuICA8dHI+XG4gICAgPHRkPjYwPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gIDwvdHI+XG4gIDx0cj5cbiAgICA8dGQ+MTIwPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gIDwvdHI+XG4gIGApO1xuICAgICQoXCIucGFnZUFjY291bnQgLndvcmRzUGJUYWJsZSB0Ym9keVwiKS5odG1sKGBcbiAgPHRyPlxuICAgIDx0ZD4xMDwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICA8L3RyPlxuICA8dHI+XG4gICAgPHRkPjI1PC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gIDwvdHI+XG4gIDx0cj5cbiAgICA8dGQ+NTA8L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgPC90cj5cbiAgPHRyPlxuICAgIDx0ZD4xMDA8L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgPC90cj5cbiAgYCk7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSkge1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC50aW1lUGJUYWJsZSB0aGVhZCB0ciB0ZDpudGgtY2hpbGQoMiksIC5wYWdlQWNjb3VudCAud29yZHNQYlRhYmxlIHRoZWFkIHRyIHRkOm50aC1jaGlsZCgyKVwiKS5odG1sKCdjcG08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj5hY2N1cmFjeTwvc3Bhbj4nKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLnRpbWVQYlRhYmxlIHRoZWFkIHRyIHRkOm50aC1jaGlsZCgyKSwgLnBhZ2VBY2NvdW50IC53b3Jkc1BiVGFibGUgdGhlYWQgdHIgdGQ6bnRoLWNoaWxkKDIpXCIpLmh0bWwoJ3dwbTxicj48c3BhbiBjbGFzcz1cInN1YlwiPmFjY3VyYWN5PC9zcGFuPicpO1xuICAgIH1cbiAgICBjb25zdCBwYiA9IERCLmdldFNuYXBzaG90KCkucGVyc29uYWxCZXN0cztcbiAgICBpZiAocGIgPT09IHVuZGVmaW5lZClcbiAgICAgICAgcmV0dXJuO1xuICAgIGxldCBwYkRhdGE7XG4gICAgbGV0IHRleHQ7XG4gICAgbGV0IGRhdGVUZXh0ID0gYC08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPmA7XG4gICAgY29uc3QgbXVsdGlwbGllciA9IGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSA/IDUgOiAxO1xuICAgIHRleHQgPSBcIlwiO1xuICAgIHRyeSB7XG4gICAgICAgIHBiRGF0YSA9IHBiLnRpbWVbMTVdLnNvcnQoKGEsIGIpID0+IGIud3BtIC0gYS53cG0pWzBdO1xuICAgICAgICBkYXRlVGV4dCA9IGAtPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj5gO1xuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUocGJEYXRhLnRpbWVzdGFtcCk7XG4gICAgICAgIGlmIChwYkRhdGEudGltZXN0YW1wKSB7XG4gICAgICAgICAgICBkYXRlVGV4dCA9XG4gICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiZGQgTU1NIHl5eXlcIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjxicj48ZGl2IGNsYXNzPSdzdWInPlwiICtcbiAgICAgICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiSEg6bW1cIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjwvZGl2PlwiO1xuICAgICAgICB9XG4gICAgICAgIHRleHQgKz0gYDx0cj5cbiAgICAgIDx0ZD4xNTwvdGQ+XG4gICAgICA8dGQ+JHtNaXNjLnJvdW5kVG8yKHBiRGF0YS53cG0gKiBtdWx0aXBsaWVyKX08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiRGF0YS5hY2MgPT09IHVuZGVmaW5lZCA/IFwiLVwiIDogcGJEYXRhLmFjYyArIFwiJVwifTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPiR7TWlzYy5yb3VuZFRvMihwYkRhdGEucmF3ICogbXVsdGlwbGllcil9PGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYkRhdGEuY29uc2lzdGVuY3kgPT09IHVuZGVmaW5lZCA/IFwiLVwiIDogcGJEYXRhLmNvbnNpc3RlbmN5ICsgXCIlXCJ9PC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+JHtkYXRlVGV4dH08L3RkPlxuICAgIDwvdHI+YDtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgdGV4dCArPSBgPHRyPlxuICAgICAgPHRkPjE1PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICA8L3RyPmA7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIHBiRGF0YSA9IHBiLnRpbWVbMzBdLnNvcnQoKGEsIGIpID0+IGIud3BtIC0gYS53cG0pWzBdO1xuICAgICAgICBkYXRlVGV4dCA9IGAtPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj5gO1xuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUocGJEYXRhLnRpbWVzdGFtcCk7XG4gICAgICAgIGlmIChwYkRhdGEudGltZXN0YW1wKSB7XG4gICAgICAgICAgICBkYXRlVGV4dCA9XG4gICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiZGQgTU1NIHl5eXlcIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjxicj48ZGl2IGNsYXNzPSdzdWInPlwiICtcbiAgICAgICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiSEg6bW1cIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjwvZGl2PlwiO1xuICAgICAgICB9XG4gICAgICAgIHRleHQgKz0gYDx0cj5cbiAgICA8dGQ+MzA8L3RkPlxuICAgICAgPHRkPiR7TWlzYy5yb3VuZFRvMihwYkRhdGEud3BtICogbXVsdGlwbGllcil9PGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYkRhdGEuYWNjID09PSB1bmRlZmluZWQgPyBcIi1cIiA6IHBiRGF0YS5hY2MgKyBcIiVcIn08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4ke01pc2Mucm91bmRUbzIocGJEYXRhLnJhdyAqIG11bHRpcGxpZXIpfTxicj48c3BhbiBjbGFzcz1cInN1YlwiPiR7cGJEYXRhLmNvbnNpc3RlbmN5ID09PSB1bmRlZmluZWQgPyBcIi1cIiA6IHBiRGF0YS5jb25zaXN0ZW5jeSArIFwiJVwifTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPiR7ZGF0ZVRleHR9PC90ZD5cbiAgICA8L3RyPmA7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHRleHQgKz0gYDx0cj5cbiAgICAgIDx0ZD4zMDwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgPC90cj5gO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBwYkRhdGEgPSBwYi50aW1lWzYwXS5zb3J0KChhLCBiKSA9PiBiLndwbSAtIGEud3BtKVswXTtcbiAgICAgICAgZGF0ZVRleHQgPSBgLTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+YDtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHBiRGF0YS50aW1lc3RhbXApO1xuICAgICAgICBpZiAocGJEYXRhLnRpbWVzdGFtcCkge1xuICAgICAgICAgICAgZGF0ZVRleHQgPVxuICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcImRkIE1NTSB5eXl5XCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8YnI+PGRpdiBjbGFzcz0nc3ViJz5cIiArXG4gICAgICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcIkhIOm1tXCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8L2Rpdj5cIjtcbiAgICAgICAgfVxuICAgICAgICB0ZXh0ICs9IGA8dHI+XG4gICAgICA8dGQ+NjA8L3RkPlxuICAgICAgPHRkPiR7TWlzYy5yb3VuZFRvMihwYkRhdGEud3BtICogbXVsdGlwbGllcil9PGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYkRhdGEuYWNjID09PSB1bmRlZmluZWQgPyBcIi1cIiA6IHBiRGF0YS5hY2MgKyBcIiVcIn08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4ke01pc2Mucm91bmRUbzIocGJEYXRhLnJhdyAqIG11bHRpcGxpZXIpfTxicj48c3BhbiBjbGFzcz1cInN1YlwiPiR7cGJEYXRhLmNvbnNpc3RlbmN5ID09PSB1bmRlZmluZWQgPyBcIi1cIiA6IHBiRGF0YS5jb25zaXN0ZW5jeSArIFwiJVwifTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPiR7ZGF0ZVRleHR9PC90ZD5cbiAgICA8L3RyPmA7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHRleHQgKz0gYDx0cj5cbiAgICAgIDx0ZD42MDwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgPC90cj5gO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBwYkRhdGEgPSBwYi50aW1lWzEyMF0uc29ydCgoYSwgYikgPT4gYi53cG0gLSBhLndwbSlbMF07XG4gICAgICAgIGRhdGVUZXh0ID0gYC08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPmA7XG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShwYkRhdGEudGltZXN0YW1wKTtcbiAgICAgICAgaWYgKHBiRGF0YS50aW1lc3RhbXApIHtcbiAgICAgICAgICAgIGRhdGVUZXh0ID1cbiAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJkZCBNTU0geXl5eVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPGJyPjxkaXYgY2xhc3M9J3N1Yic+XCIgK1xuICAgICAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJISDptbVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPC9kaXY+XCI7XG4gICAgICAgIH1cbiAgICAgICAgdGV4dCArPSBgPHRyPlxuICAgICAgPHRkPjEyMDwvdGQ+XG4gICAgICA8dGQ+JHtNaXNjLnJvdW5kVG8yKHBiRGF0YS53cG0gKiBtdWx0aXBsaWVyKX08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiRGF0YS5hY2MgPT09IHVuZGVmaW5lZCA/IFwiLVwiIDogcGJEYXRhLmFjYyArIFwiJVwifTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPiR7TWlzYy5yb3VuZFRvMihwYkRhdGEucmF3ICogbXVsdGlwbGllcil9PGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYkRhdGEuY29uc2lzdGVuY3kgPT09IHVuZGVmaW5lZCA/IFwiLVwiIDogcGJEYXRhLmNvbnNpc3RlbmN5ICsgXCIlXCJ9PC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+JHtkYXRlVGV4dH08L3RkPlxuICAgIDwvdHI+YDtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgdGV4dCArPSBgPHRyPlxuICAgICAgPHRkPjEyMDwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgPC90cj5gO1xuICAgIH1cbiAgICAkKFwiLnBhZ2VBY2NvdW50IC50aW1lUGJUYWJsZSB0Ym9keVwiKS5odG1sKHRleHQpO1xuICAgIHRleHQgPSBcIlwiO1xuICAgIHRyeSB7XG4gICAgICAgIHBiRGF0YSA9IHBiLndvcmRzWzEwXS5zb3J0KChhLCBiKSA9PiBiLndwbSAtIGEud3BtKVswXTtcbiAgICAgICAgZGF0ZVRleHQgPSBgLTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+YDtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHBiRGF0YS50aW1lc3RhbXApO1xuICAgICAgICBpZiAocGJEYXRhLnRpbWVzdGFtcCkge1xuICAgICAgICAgICAgZGF0ZVRleHQgPVxuICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcImRkIE1NTSB5eXl5XCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8YnI+PGRpdiBjbGFzcz0nc3ViJz5cIiArXG4gICAgICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcIkhIOm1tXCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8L2Rpdj5cIjtcbiAgICAgICAgfVxuICAgICAgICB0ZXh0ICs9IGA8dHI+XG4gICAgICA8dGQ+MTA8L3RkPlxuICAgICAgPHRkPiR7TWlzYy5yb3VuZFRvMihwYkRhdGEud3BtICogbXVsdGlwbGllcil9PGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYkRhdGEuYWNjID09PSB1bmRlZmluZWQgPyBcIi1cIiA6IHBiRGF0YS5hY2MgKyBcIiVcIn08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4ke01pc2Mucm91bmRUbzIocGJEYXRhLnJhdyAqIG11bHRpcGxpZXIpfTxicj48c3BhbiBjbGFzcz1cInN1YlwiPiR7cGJEYXRhLmNvbnNpc3RlbmN5ID09PSB1bmRlZmluZWQgPyBcIi1cIiA6IHBiRGF0YS5jb25zaXN0ZW5jeSArIFwiJVwifTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPiR7ZGF0ZVRleHR9PC90ZD5cbiAgICA8L3RyPmA7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHRleHQgKz0gYDx0cj5cbiAgICAgIDx0ZD4xMDwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgPC90cj5gO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBwYkRhdGEgPSBwYi53b3Jkc1syNV0uc29ydCgoYSwgYikgPT4gYi53cG0gLSBhLndwbSlbMF07XG4gICAgICAgIGRhdGVUZXh0ID0gYC08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPmA7XG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShwYkRhdGEudGltZXN0YW1wKTtcbiAgICAgICAgaWYgKHBiRGF0YS50aW1lc3RhbXApIHtcbiAgICAgICAgICAgIGRhdGVUZXh0ID1cbiAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJkZCBNTU0geXl5eVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPGJyPjxkaXYgY2xhc3M9J3N1Yic+XCIgK1xuICAgICAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJISDptbVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPC9kaXY+XCI7XG4gICAgICAgIH1cbiAgICAgICAgdGV4dCArPSBgPHRyPlxuICAgICAgPHRkPjI1PC90ZD5cbiAgICAgIDx0ZD4ke01pc2Mucm91bmRUbzIocGJEYXRhLndwbSAqIG11bHRpcGxpZXIpfTxicj48c3BhbiBjbGFzcz1cInN1YlwiPiR7cGJEYXRhLmFjYyA9PT0gdW5kZWZpbmVkID8gXCItXCIgOiBwYkRhdGEuYWNjICsgXCIlXCJ9PC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+JHtNaXNjLnJvdW5kVG8yKHBiRGF0YS5yYXcgKiBtdWx0aXBsaWVyKX08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiRGF0YS5jb25zaXN0ZW5jeSA9PT0gdW5kZWZpbmVkID8gXCItXCIgOiBwYkRhdGEuY29uc2lzdGVuY3kgKyBcIiVcIn08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4ke2RhdGVUZXh0fTwvdGQ+XG4gICAgPC90cj5gO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICB0ZXh0ICs9IGA8dHI+XG4gICAgICA8dGQ+MjU8L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgIDwvdHI+YDtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgcGJEYXRhID0gcGIud29yZHNbNTBdLnNvcnQoKGEsIGIpID0+IGIud3BtIC0gYS53cG0pWzBdO1xuICAgICAgICBkYXRlVGV4dCA9IGAtPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj5gO1xuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUocGJEYXRhLnRpbWVzdGFtcCk7XG4gICAgICAgIGlmIChwYkRhdGEudGltZXN0YW1wKSB7XG4gICAgICAgICAgICBkYXRlVGV4dCA9XG4gICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiZGQgTU1NIHl5eXlcIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjxicj48ZGl2IGNsYXNzPSdzdWInPlwiICtcbiAgICAgICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiSEg6bW1cIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjwvZGl2PlwiO1xuICAgICAgICB9XG4gICAgICAgIHRleHQgKz0gYDx0cj5cbiAgICAgIDx0ZD41MDwvdGQ+XG4gICAgICA8dGQ+JHtNaXNjLnJvdW5kVG8yKHBiRGF0YS53cG0gKiBtdWx0aXBsaWVyKX08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiRGF0YS5hY2MgPT09IHVuZGVmaW5lZCA/IFwiLVwiIDogcGJEYXRhLmFjYyArIFwiJVwifTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPiR7TWlzYy5yb3VuZFRvMihwYkRhdGEucmF3ICogbXVsdGlwbGllcil9PGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYkRhdGEuY29uc2lzdGVuY3kgPT09IHVuZGVmaW5lZCA/IFwiLVwiIDogcGJEYXRhLmNvbnNpc3RlbmN5ICsgXCIlXCJ9PC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+JHtkYXRlVGV4dH08L3RkPlxuICAgIDwvdHI+YDtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgdGV4dCArPSBgPHRyPlxuICAgICAgPHRkPjUwPC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICA8L3RyPmA7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIHBiRGF0YSA9IHBiLndvcmRzWzEwMF0uc29ydCgoYSwgYikgPT4gYi53cG0gLSBhLndwbSlbMF07XG4gICAgICAgIGRhdGVUZXh0ID0gYC08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPmA7XG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShwYkRhdGEudGltZXN0YW1wKTtcbiAgICAgICAgaWYgKHBiRGF0YS50aW1lc3RhbXApIHtcbiAgICAgICAgICAgIGRhdGVUZXh0ID1cbiAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJkZCBNTU0geXl5eVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPGJyPjxkaXYgY2xhc3M9J3N1Yic+XCIgK1xuICAgICAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJISDptbVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPC9kaXY+XCI7XG4gICAgICAgIH1cbiAgICAgICAgdGV4dCArPSBgPHRyPlxuICAgICAgPHRkPjEwMDwvdGQ+XG4gICAgICA8dGQ+JHtNaXNjLnJvdW5kVG8yKHBiRGF0YS53cG0gKiBtdWx0aXBsaWVyKX08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiRGF0YS5hY2MgPT09IHVuZGVmaW5lZCA/IFwiLVwiIDogcGJEYXRhLmFjYyArIFwiJVwifTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPiR7TWlzYy5yb3VuZFRvMihwYkRhdGEucmF3ICogbXVsdGlwbGllcil9PGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYkRhdGEuY29uc2lzdGVuY3kgPT09IHVuZGVmaW5lZCA/IFwiLVwiIDogcGJEYXRhLmNvbnNpc3RlbmN5ICsgXCIlXCJ9PC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+JHtkYXRlVGV4dH08L3RkPlxuICAgIDwvdHI+YDtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgdGV4dCArPSBgPHRyPlxuICAgICAgPHRkPjEwMDwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgPC90cj5gO1xuICAgIH1cbiAgICAkKFwiLnBhZ2VBY2NvdW50IC53b3Jkc1BiVGFibGUgdGJvZHlcIikuaHRtbCh0ZXh0KTtcbn1cbmV4cG9ydHMudXBkYXRlID0gdXBkYXRlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudXBkYXRlVGFncyA9IGV4cG9ydHMudG9nZ2xlID0gZXhwb3J0cy51cGRhdGVBY3RpdmUgPSBleHBvcnRzLnJlc2V0ID0gZXhwb3J0cy5sb2FkVGFncyA9IGV4cG9ydHMuZ2V0RmlsdGVyID0gZXhwb3J0cy5nZXRHcm91cCA9IGV4cG9ydHMuZ2V0RmlsdGVycyA9IGV4cG9ydHMubG9hZCA9IGV4cG9ydHMuZmlsdGVycyA9IGV4cG9ydHMuZGVmYXVsdFJlc3VsdEZpbHRlcnMgPSB2b2lkIDA7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuZXhwb3J0cy5kZWZhdWx0UmVzdWx0RmlsdGVycyA9IHtcbiAgICBkaWZmaWN1bHR5OiB7XG4gICAgICAgIG5vcm1hbDogdHJ1ZSxcbiAgICAgICAgZXhwZXJ0OiB0cnVlLFxuICAgICAgICBtYXN0ZXI6IHRydWUsXG4gICAgfSxcbiAgICBtb2RlOiB7XG4gICAgICAgIHdvcmRzOiB0cnVlLFxuICAgICAgICB0aW1lOiB0cnVlLFxuICAgICAgICBxdW90ZTogdHJ1ZSxcbiAgICAgICAgemVuOiB0cnVlLFxuICAgICAgICBjdXN0b206IHRydWUsXG4gICAgfSxcbiAgICB3b3Jkczoge1xuICAgICAgICAxMDogdHJ1ZSxcbiAgICAgICAgMjU6IHRydWUsXG4gICAgICAgIDUwOiB0cnVlLFxuICAgICAgICAxMDA6IHRydWUsXG4gICAgICAgIGN1c3RvbTogdHJ1ZSxcbiAgICB9LFxuICAgIHRpbWU6IHtcbiAgICAgICAgMTU6IHRydWUsXG4gICAgICAgIDMwOiB0cnVlLFxuICAgICAgICA2MDogdHJ1ZSxcbiAgICAgICAgMTIwOiB0cnVlLFxuICAgICAgICBjdXN0b206IHRydWUsXG4gICAgfSxcbiAgICBxdW90ZUxlbmd0aDoge1xuICAgICAgICBzaG9ydDogdHJ1ZSxcbiAgICAgICAgbWVkaXVtOiB0cnVlLFxuICAgICAgICBsb25nOiB0cnVlLFxuICAgICAgICB0aGljYzogdHJ1ZSxcbiAgICB9LFxuICAgIHB1bmN0dWF0aW9uOiB7XG4gICAgICAgIG9uOiB0cnVlLFxuICAgICAgICBvZmY6IHRydWUsXG4gICAgfSxcbiAgICBudW1iZXJzOiB7XG4gICAgICAgIG9uOiB0cnVlLFxuICAgICAgICBvZmY6IHRydWUsXG4gICAgfSxcbiAgICBkYXRlOiB7XG4gICAgICAgIGxhc3RfZGF5OiBmYWxzZSxcbiAgICAgICAgbGFzdF93ZWVrOiBmYWxzZSxcbiAgICAgICAgbGFzdF9tb250aDogZmFsc2UsXG4gICAgICAgIGxhc3RfM21vbnRoczogZmFsc2UsXG4gICAgICAgIGFsbDogdHJ1ZSxcbiAgICB9LFxuICAgIHRhZ3M6IHtcbiAgICAgICAgbm9uZTogdHJ1ZSxcbiAgICB9LFxuICAgIGxhbmd1YWdlOiB7fSxcbiAgICBmdW5ib3g6IHtcbiAgICAgICAgbm9uZTogdHJ1ZSxcbiAgICB9LFxufTtcbmV4cG9ydHMuZmlsdGVycyA9IGV4cG9ydHMuZGVmYXVsdFJlc3VsdEZpbHRlcnM7XG5mdW5jdGlvbiBzYXZlKCkge1xuICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInJlc3VsdEZpbHRlcnNcIiwgSlNPTi5zdHJpbmdpZnkoZXhwb3J0cy5maWx0ZXJzKSk7XG59XG5mdW5jdGlvbiBsb2FkKCkge1xuICAgIGNvbnNvbGUubG9nKFwibG9hZGluZyBmaWx0ZXJzXCIpO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG5ld1Jlc3VsdEZpbHRlcnMgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJyZXN1bHRGaWx0ZXJzXCIpO1xuICAgICAgICBpZiAobmV3UmVzdWx0RmlsdGVycyAhPSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgIG5ld1Jlc3VsdEZpbHRlcnMgIT09IFwiXCIgJiZcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKEpTT04ucGFyc2UobmV3UmVzdWx0RmlsdGVycykpLmxlbmd0aCA+PVxuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGV4cG9ydHMuZGVmYXVsdFJlc3VsdEZpbHRlcnMpLmxlbmd0aCkge1xuICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzID0gSlNPTi5wYXJzZShuZXdSZXN1bHRGaWx0ZXJzKTtcbiAgICAgICAgICAgIC8vIHNhdmUoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVycyA9IGV4cG9ydHMuZGVmYXVsdFJlc3VsdEZpbHRlcnM7XG4gICAgICAgICAgICAvLyBzYXZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmV3VGFncyA9IHsgbm9uZTogZmFsc2UgfTtcbiAgICAgICAgT2JqZWN0LmtleXMoZXhwb3J0cy5kZWZhdWx0UmVzdWx0RmlsdGVycy50YWdzKS5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgIGlmIChleHBvcnRzLmZpbHRlcnMudGFnc1t0YWddICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBuZXdUYWdzW3RhZ10gPSBleHBvcnRzLmZpbHRlcnMudGFnc1t0YWddO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV3VGFnc1t0YWddID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGV4cG9ydHMuZmlsdGVycy50YWdzID0gbmV3VGFncztcbiAgICAgICAgc2F2ZSgpO1xuICAgIH1cbiAgICBjYXRjaCAoX2EpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJlcnJvciBpbiBsb2FkaW5nIHJlc3VsdCBmaWx0ZXJzXCIpO1xuICAgICAgICBleHBvcnRzLmZpbHRlcnMgPSBleHBvcnRzLmRlZmF1bHRSZXN1bHRGaWx0ZXJzO1xuICAgICAgICBzYXZlKCk7XG4gICAgfVxufVxuZXhwb3J0cy5sb2FkID0gbG9hZDtcbmZ1bmN0aW9uIGdldEZpbHRlcnMoKSB7XG4gICAgcmV0dXJuIGV4cG9ydHMuZmlsdGVycztcbn1cbmV4cG9ydHMuZ2V0RmlsdGVycyA9IGdldEZpbHRlcnM7XG5mdW5jdGlvbiBnZXRHcm91cChncm91cCkge1xuICAgIHJldHVybiBleHBvcnRzLmZpbHRlcnNbZ3JvdXBdO1xufVxuZXhwb3J0cy5nZXRHcm91cCA9IGdldEdyb3VwO1xuLy8gZXhwb3J0IGZ1bmN0aW9uIHNldEZpbHRlcihncm91cCwgZmlsdGVyLCB2YWx1ZSkge1xuLy8gICBmaWx0ZXJzW2dyb3VwXVtmaWx0ZXJdID0gdmFsdWU7XG4vLyB9XG5mdW5jdGlvbiBnZXRGaWx0ZXIoZ3JvdXAsIGZpbHRlcikge1xuICAgIHJldHVybiBleHBvcnRzLmZpbHRlcnNbZ3JvdXBdW2ZpbHRlcl07XG59XG5leHBvcnRzLmdldEZpbHRlciA9IGdldEZpbHRlcjtcbi8vIGV4cG9ydCBmdW5jdGlvbiB0b2dnbGVGaWx0ZXIoZ3JvdXAsIGZpbHRlcikge1xuLy8gICBmaWx0ZXJzW2dyb3VwXVtmaWx0ZXJdID0gIWZpbHRlcnNbZ3JvdXBdW2ZpbHRlcl07XG4vLyB9XG5mdW5jdGlvbiBsb2FkVGFncyh0YWdzKSB7XG4gICAgY29uc29sZS5sb2coXCJsb2FkaW5nIHRhZ3NcIik7XG4gICAgdGFncy5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgZXhwb3J0cy5kZWZhdWx0UmVzdWx0RmlsdGVycy50YWdzW3RhZy5faWRdID0gdHJ1ZTtcbiAgICB9KTtcbn1cbmV4cG9ydHMubG9hZFRhZ3MgPSBsb2FkVGFncztcbmZ1bmN0aW9uIHJlc2V0KCkge1xuICAgIGV4cG9ydHMuZmlsdGVycyA9IGV4cG9ydHMuZGVmYXVsdFJlc3VsdEZpbHRlcnM7XG4gICAgc2F2ZSgpO1xufVxuZXhwb3J0cy5yZXNldCA9IHJlc2V0O1xuZnVuY3Rpb24gdXBkYXRlQWN0aXZlKCkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICBjb25zdCBhYm92ZUNoYXJ0RGlzcGxheSA9IHt9O1xuICAgIE9iamVjdC5rZXlzKGdldEZpbHRlcnMoKSkuZm9yRWFjaCgoZ3JvdXApID0+IHtcbiAgICAgICAgYWJvdmVDaGFydERpc3BsYXlbZ3JvdXBdID0ge1xuICAgICAgICAgICAgYWxsOiB0cnVlLFxuICAgICAgICAgICAgYXJyYXk6IFtdLFxuICAgICAgICB9O1xuICAgICAgICBPYmplY3Qua2V5cyhnZXRHcm91cChncm91cCkpLmZvckVhY2goKGZpbHRlcikgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgY29uc3QgZ3JvdXBBYm92ZUNoYXJ0RGlzcGxheSA9IGFib3ZlQ2hhcnREaXNwbGF5W2dyb3VwXTtcbiAgICAgICAgICAgIGlmIChncm91cEFib3ZlQ2hhcnREaXNwbGF5ID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKGdldEZpbHRlcihncm91cCwgZmlsdGVyKSkge1xuICAgICAgICAgICAgICAgIChfYSA9IGdyb3VwQWJvdmVDaGFydERpc3BsYXlbXCJhcnJheVwiXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnB1c2goZmlsdGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChncm91cEFib3ZlQ2hhcnREaXNwbGF5W1wiYWxsXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBBYm92ZUNoYXJ0RGlzcGxheVtcImFsbFwiXSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBidXR0b25FbDtcbiAgICAgICAgICAgIGlmIChncm91cCA9PT0gXCJkYXRlXCIpIHtcbiAgICAgICAgICAgICAgICBidXR0b25FbCA9ICQoYC5wYWdlQWNjb3VudCAuZ3JvdXAudG9wRmlsdGVycyAuZmlsdGVyR3JvdXBbZ3JvdXA9XCIke2dyb3VwfVwiXSAuYnV0dG9uW2ZpbHRlcj1cIiR7ZmlsdGVyfVwiXWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgYnV0dG9uRWwgPSAkKGAucGFnZUFjY291bnQgLmdyb3VwLmZpbHRlckJ1dHRvbnMgLmZpbHRlckdyb3VwW2dyb3VwPVwiJHtncm91cH1cIl0gLmJ1dHRvbltmaWx0ZXI9XCIke2ZpbHRlcn1cIl1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChnZXRGaWx0ZXIoZ3JvdXAsIGZpbHRlcikpIHtcbiAgICAgICAgICAgICAgICBidXR0b25FbC5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGJ1dHRvbkVsLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBmdW5jdGlvbiBhZGRUZXh0KGdyb3VwKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2U7XG4gICAgICAgIGxldCByZXQgPSBcIlwiO1xuICAgICAgICByZXQgKz0gXCI8ZGl2IGNsYXNzPSdncm91cCc+XCI7XG4gICAgICAgIGlmIChncm91cCA9PSBcImRpZmZpY3VsdHlcIikge1xuICAgICAgICAgICAgcmV0ICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwiRGlmZmljdWx0eVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXN0YXJcIj48L2k+YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChncm91cCA9PSBcIm1vZGVcIikge1xuICAgICAgICAgICAgcmV0ICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwiTW9kZVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWJhcnNcIj48L2k+YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChncm91cCA9PSBcInB1bmN0dWF0aW9uXCIpIHtcbiAgICAgICAgICAgIHJldCArPSBgPHNwYW4gYXJpYS1sYWJlbD1cIlB1bmN0dWF0aW9uXCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PHNwYW4gY2xhc3M9XCJwdW5jXCIgc3R5bGU9XCJmb250LXdlaWdodDogOTAwO1xuICAgICAgd2lkdGg6IDEuMjVyZW07XG4gICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gICAgICBsZXR0ZXItc3BhY2luZzogLS4xcmVtO1wiPiE/PC9zcGFuPmA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZ3JvdXAgPT0gXCJudW1iZXJzXCIpIHtcbiAgICAgICAgICAgIHJldCArPSBgPHNwYW4gYXJpYS1sYWJlbD1cIk51bWJlcnNcIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48c3BhbiBjbGFzcz1cIm51bWJlcnNcIiBzdHlsZT1cImZvbnQtd2VpZ2h0OiA5MDA7XG4gICAgICAgIHdpZHRoOiAxLjI1cmVtO1xuICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICAgIG1hcmdpbi1yaWdodDogLjFyZW07XG4gICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgICAgICAgbGV0dGVyLXNwYWNpbmc6IC0uMXJlbTtcIj4xNTwvc3Bhbj5gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGdyb3VwID09IFwid29yZHNcIikge1xuICAgICAgICAgICAgcmV0ICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwiV29yZHNcIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1mb250XCI+PC9pPmA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZ3JvdXAgPT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgICAgIHJldCArPSBgPHNwYW4gYXJpYS1sYWJlbD1cIlRpbWVcIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1jbG9ja1wiPjwvaT5gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGdyb3VwID09IFwiZGF0ZVwiKSB7XG4gICAgICAgICAgICByZXQgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCJEYXRlXCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtY2FsZW5kYXJcIj48L2k+YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChncm91cCA9PSBcInRhZ3NcIikge1xuICAgICAgICAgICAgcmV0ICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwiVGFnc1wiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXRhZ3NcIj48L2k+YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChncm91cCA9PSBcImxhbmd1YWdlXCIpIHtcbiAgICAgICAgICAgIHJldCArPSBgPHNwYW4gYXJpYS1sYWJlbD1cIkxhbmd1YWdlXCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtZ2xvYmUtYW1lcmljYXNcIj48L2k+YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChncm91cCA9PSBcImZ1bmJveFwiKSB7XG4gICAgICAgICAgICByZXQgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCJGdW5ib3hcIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1nYW1lcGFkXCI+PC9pPmA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKChfYSA9IGFib3ZlQ2hhcnREaXNwbGF5W2dyb3VwXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmFsbCkge1xuICAgICAgICAgICAgcmV0ICs9IFwiYWxsXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoZ3JvdXAgPT09IFwidGFnc1wiKSB7XG4gICAgICAgICAgICAgICAgcmV0ICs9IChfYyA9IChfYiA9IGFib3ZlQ2hhcnREaXNwbGF5LnRhZ3MpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5hcnJheSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLm1hcCgoaWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlkID09IFwibm9uZVwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlkO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzbmFwc2hvdCA9IERCLmdldFNuYXBzaG90KCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSAoX2EgPSBzbmFwc2hvdC50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmlsdGVyKCh0KSA9PiB0Ll9pZCA9PSBpZClbMF07XG4gICAgICAgICAgICAgICAgICAgIGlmIChuYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoX2IgPSBzbmFwc2hvdC50YWdzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZmlsdGVyKCh0KSA9PiB0Ll9pZCA9PSBpZClbMF0ubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmFtZTtcbiAgICAgICAgICAgICAgICB9KS5qb2luKFwiLCBcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXQgKz0gKF9lID0gKF9kID0gYWJvdmVDaGFydERpc3BsYXlbZ3JvdXBdKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QuYXJyYXkpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5qb2luKFwiLCBcIikucmVwbGFjZSgvXy9nLCBcIiBcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0ICs9IFwiPC9zcGFuPjwvZGl2PlwiO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH1cbiAgICBsZXQgY2hhcnRTdHJpbmcgPSBcIlwiO1xuICAgIC8vZGF0ZVxuICAgIGNoYXJ0U3RyaW5nICs9IGFkZFRleHQoXCJkYXRlXCIpO1xuICAgIGNoYXJ0U3RyaW5nICs9IGA8ZGl2IGNsYXNzPVwic3BhY2VyXCI+PC9kaXY+YDtcbiAgICAvL21vZGVcbiAgICBjaGFydFN0cmluZyArPSBhZGRUZXh0KFwibW9kZVwiKTtcbiAgICBjaGFydFN0cmluZyArPSBgPGRpdiBjbGFzcz1cInNwYWNlclwiPjwvZGl2PmA7XG4gICAgLy90aW1lXG4gICAgaWYgKChfYiA9IChfYSA9IGFib3ZlQ2hhcnREaXNwbGF5Lm1vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5hcnJheSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmluY2x1ZGVzKFwidGltZVwiKSkge1xuICAgICAgICBjaGFydFN0cmluZyArPSBhZGRUZXh0KFwidGltZVwiKTtcbiAgICAgICAgY2hhcnRTdHJpbmcgKz0gYDxkaXYgY2xhc3M9XCJzcGFjZXJcIj48L2Rpdj5gO1xuICAgIH1cbiAgICAvL3dvcmRzXG4gICAgaWYgKChfZCA9IChfYyA9IGFib3ZlQ2hhcnREaXNwbGF5Lm1vZGUpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5hcnJheSkgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmluY2x1ZGVzKFwid29yZHNcIikpIHtcbiAgICAgICAgY2hhcnRTdHJpbmcgKz0gYWRkVGV4dChcIndvcmRzXCIpO1xuICAgICAgICBjaGFydFN0cmluZyArPSBgPGRpdiBjbGFzcz1cInNwYWNlclwiPjwvZGl2PmA7XG4gICAgfVxuICAgIC8vZGlmZlxuICAgIGNoYXJ0U3RyaW5nICs9IGFkZFRleHQoXCJkaWZmaWN1bHR5XCIpO1xuICAgIGNoYXJ0U3RyaW5nICs9IGA8ZGl2IGNsYXNzPVwic3BhY2VyXCI+PC9kaXY+YDtcbiAgICAvL3B1bmNcbiAgICBjaGFydFN0cmluZyArPSBhZGRUZXh0KFwicHVuY3R1YXRpb25cIik7XG4gICAgY2hhcnRTdHJpbmcgKz0gYDxkaXYgY2xhc3M9XCJzcGFjZXJcIj48L2Rpdj5gO1xuICAgIC8vbnVtYmVyc1xuICAgIGNoYXJ0U3RyaW5nICs9IGFkZFRleHQoXCJudW1iZXJzXCIpO1xuICAgIGNoYXJ0U3RyaW5nICs9IGA8ZGl2IGNsYXNzPVwic3BhY2VyXCI+PC9kaXY+YDtcbiAgICAvL2xhbmd1YWdlXG4gICAgY2hhcnRTdHJpbmcgKz0gYWRkVGV4dChcImxhbmd1YWdlXCIpO1xuICAgIGNoYXJ0U3RyaW5nICs9IGA8ZGl2IGNsYXNzPVwic3BhY2VyXCI+PC9kaXY+YDtcbiAgICAvL2Z1bmJveFxuICAgIGNoYXJ0U3RyaW5nICs9IGFkZFRleHQoXCJmdW5ib3hcIik7XG4gICAgY2hhcnRTdHJpbmcgKz0gYDxkaXYgY2xhc3M9XCJzcGFjZXJcIj48L2Rpdj5gO1xuICAgIC8vdGFnc1xuICAgIGNoYXJ0U3RyaW5nICs9IGFkZFRleHQoXCJ0YWdzXCIpO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5ncm91cC5jaGFydCAuYWJvdmVcIikuaHRtbChjaGFydFN0cmluZyk7XG4gICAgfSwgMCk7XG59XG5leHBvcnRzLnVwZGF0ZUFjdGl2ZSA9IHVwZGF0ZUFjdGl2ZTtcbmZ1bmN0aW9uIHRvZ2dsZShncm91cCwgZmlsdGVyKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKGdyb3VwID09PSBcImRhdGVcIikge1xuICAgICAgICAgICAgT2JqZWN0LmtleXMoZ2V0R3JvdXAoXCJkYXRlXCIpKS5mb3JFYWNoKChkYXRlKSA9PiB7XG4gICAgICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzW1wiZGF0ZVwiXVtkYXRlXSA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZXhwb3J0cy5maWx0ZXJzW2dyb3VwXVtmaWx0ZXJdID0gIWV4cG9ydHMuZmlsdGVyc1tncm91cF1bZmlsdGVyXTtcbiAgICAgICAgc2F2ZSgpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlNvbWV0aGluZyB3ZW50IHdyb25nIHRvZ2dsaW5nIGZpbHRlci4gUmV2ZXJ0aW5nIHRvIGRlZmF1bHRzLlwiLCAwKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJ0b2dnbGluZyBmaWx0ZXIgZXJyb3JcIik7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIHJlc2V0KCk7XG4gICAgICAgIHVwZGF0ZUFjdGl2ZSgpO1xuICAgIH1cbn1cbmV4cG9ydHMudG9nZ2xlID0gdG9nZ2xlO1xuZnVuY3Rpb24gdXBkYXRlVGFncygpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgICQoXCIucGFnZUFjY291bnQgLmNvbnRlbnQgLmZpbHRlckJ1dHRvbnMgLmJ1dHRvbnNBbmRUaXRsZS50YWdzIC5idXR0b25zXCIpLmVtcHR5KCk7XG4gICAgY29uc3Qgc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdCgpO1xuICAgIGlmICgoKF9hID0gc25hcHNob3QudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgfHwgMCA+IDApIHtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuY29udGVudCAuZmlsdGVyQnV0dG9ucyAuYnV0dG9uc0FuZFRpdGxlLnRhZ3NcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmNvbnRlbnQgLmZpbHRlckJ1dHRvbnMgLmJ1dHRvbnNBbmRUaXRsZS50YWdzIC5idXR0b25zXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cImJ1dHRvblwiIGZpbHRlcj1cIm5vbmVcIj5ubyB0YWc8L2Rpdj5gKTtcbiAgICAgICAgKF9iID0gc25hcHNob3QudGFncykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuY29udGVudCAuZmlsdGVyQnV0dG9ucyAuYnV0dG9uc0FuZFRpdGxlLnRhZ3MgLmJ1dHRvbnNcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwiYnV0dG9uXCIgZmlsdGVyPVwiJHt0YWcuX2lkfVwiPiR7dGFnLm5hbWV9PC9kaXY+YCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuY29udGVudCAuZmlsdGVyQnV0dG9ucyAuYnV0dG9uc0FuZFRpdGxlLnRhZ3NcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxufVxuZXhwb3J0cy51cGRhdGVUYWdzID0gdXBkYXRlVGFncztcbiQoXCIucGFnZUFjY291bnQgLmZpbHRlckJ1dHRvbnMgLmJ1dHRvbnNBbmRUaXRsZSAuYnV0dG9ucywgLnBhZ2VBY2NvdW50IC5ncm91cC50b3BGaWx0ZXJzIC5idXR0b25zQW5kVGl0bGUudGVzdERhdGUgLmJ1dHRvbnNcIikub24oXCJjbGlja1wiLCBcIi5idXR0b25cIiwgKGUpID0+IHtcbiAgICBjb25zdCBncm91cCA9ICQoZS50YXJnZXQpXG4gICAgICAgIC5wYXJlbnRzKFwiLmJ1dHRvbnNcIilcbiAgICAgICAgLmF0dHIoXCJncm91cFwiKTtcbiAgICBjb25zdCBmaWx0ZXIgPSAkKGUudGFyZ2V0KS5hdHRyKFwiZmlsdGVyXCIpO1xuICAgIGlmICgkKGUudGFyZ2V0KS5oYXNDbGFzcyhcImFsbEZpbHRlcnNcIikpIHtcbiAgICAgICAgT2JqZWN0LmtleXMoZ2V0RmlsdGVycygpKS5mb3JFYWNoKChncm91cCkgPT4ge1xuICAgICAgICAgICAgT2JqZWN0LmtleXMoZ2V0R3JvdXAoZ3JvdXApKS5mb3JFYWNoKChmaWx0ZXIpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZ3JvdXAgPT09IFwiZGF0ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE8gZmlndXJlIG91dCB3aHkgXCJmaWx0ZXJcIiBpcyBuZXZlclxuICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVyc1tncm91cF1bZmlsdGVyXSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChleHBvcnRzLmZpbHRlcnNbZ3JvdXBdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgICAgICBleHBvcnRzLmZpbHRlcnNbZ3JvdXBdW2ZpbHRlcl0gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgZXhwb3J0cy5maWx0ZXJzW1wiZGF0ZVwiXVtcImFsbFwiXSA9IHRydWU7XG4gICAgfVxuICAgIGVsc2UgaWYgKCQoZS50YXJnZXQpLmhhc0NsYXNzKFwibm9GaWx0ZXJzXCIpKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKGdldEZpbHRlcnMoKSkuZm9yRWFjaCgoZ3JvdXApID0+IHtcbiAgICAgICAgICAgIGlmIChncm91cCAhPT0gXCJkYXRlXCIpIHtcbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhnZXRHcm91cChncm91cCkpLmZvckVhY2goKGZpbHRlcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPIGZpZ3VyZSBvdXQgd2h5IFwiZmlsdGVyXCIgaXMgbmV2ZXJcbiAgICAgICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgICAgICBleHBvcnRzLmZpbHRlcnNbZ3JvdXBdW2ZpbHRlcl0gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKCQoZS50YXJnZXQpLmhhc0NsYXNzKFwiYnV0dG9uXCIpKSB7XG4gICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhnZXRHcm91cChncm91cCkpLmZvckVhY2goKGZpbHRlcikgPT4ge1xuICAgICAgICAgICAgICAgIC8vIFRPRE8gZmlndXJlIG91dCB3aHkgXCJmaWx0ZXJcIiBpcyBuZXZlclxuICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICBleHBvcnRzLmZpbHRlcnNbZ3JvdXBdW2ZpbHRlcl0gPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gVE9ETyBmaWd1cmUgb3V0IHdoeSBcImZpbHRlclwiIGlzIG5ldmVyXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBleHBvcnRzLmZpbHRlcnNbZ3JvdXBdW2ZpbHRlcl0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdG9nZ2xlKGdyb3VwLCBmaWx0ZXIpO1xuICAgICAgICAgICAgLy8gZmlsdGVyc1tncm91cF1bZmlsdGVyXSA9ICFmaWx0ZXJzW2dyb3VwXVtmaWx0ZXJdO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZUFjdGl2ZSgpO1xuICAgIHNhdmUoKTtcbn0pO1xuJChcIi5wYWdlQWNjb3VudCAudG9wRmlsdGVycyAuYnV0dG9uLmFsbEZpbHRlcnNcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgT2JqZWN0LmtleXMoZ2V0RmlsdGVycygpKS5mb3JFYWNoKChncm91cCkgPT4ge1xuICAgICAgICBPYmplY3Qua2V5cyhnZXRHcm91cChncm91cCkpLmZvckVhY2goKGZpbHRlcikgPT4ge1xuICAgICAgICAgICAgaWYgKGdyb3VwID09PSBcImRhdGVcIikge1xuICAgICAgICAgICAgICAgIC8vIFRPRE8gZmlndXJlIG91dCB3aHkgXCJmaWx0ZXJcIiBpcyBuZXZlclxuICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICBleHBvcnRzLmZpbHRlcnNbZ3JvdXBdW2ZpbHRlcl0gPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFRPRE8gZmlndXJlIG91dCB3aHkgXCJmaWx0ZXJcIiBpcyBuZXZlclxuICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICBleHBvcnRzLmZpbHRlcnNbZ3JvdXBdW2ZpbHRlcl0gPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBleHBvcnRzLmZpbHRlcnNbXCJkYXRlXCJdW1wiYWxsXCJdID0gdHJ1ZTtcbiAgICB1cGRhdGVBY3RpdmUoKTtcbiAgICBzYXZlKCk7XG59KTtcbiQoXCIucGFnZUFjY291bnQgLnRvcEZpbHRlcnMgLmJ1dHRvbi5jdXJyZW50Q29uZmlnRmlsdGVyXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBPYmplY3Qua2V5cyhnZXRGaWx0ZXJzKCkpLmZvckVhY2goKGdyb3VwKSA9PiB7XG4gICAgICAgIE9iamVjdC5rZXlzKGdldEdyb3VwKGdyb3VwKSkuZm9yRWFjaCgoZmlsdGVyKSA9PiB7XG4gICAgICAgICAgICAvLyBUT0RPIGZpZ3VyZSBvdXQgd2h5IFwiZmlsdGVyXCIgaXMgbmV2ZXJcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVyc1tncm91cF1bZmlsdGVyXSA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBleHBvcnRzLmZpbHRlcnNbXCJkaWZmaWN1bHR5XCJdW2NvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eV0gPSB0cnVlO1xuICAgIGV4cG9ydHMuZmlsdGVyc1tcIm1vZGVcIl1bY29uZmlnXzEuZGVmYXVsdC5tb2RlXSA9IHRydWU7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgaWYgKFsxNSwgMzAsIDYwLCAxMjBdLmluY2x1ZGVzKGNvbmZpZ18xLmRlZmF1bHQudGltZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZ1RpbWUgPSBjb25maWdfMS5kZWZhdWx0LnRpbWU7XG4gICAgICAgICAgICBleHBvcnRzLmZpbHRlcnNbXCJ0aW1lXCJdW2NvbmZpZ1RpbWVdID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVyc1tcInRpbWVcIl1bXCJjdXN0b21cIl0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ3b3Jkc1wiKSB7XG4gICAgICAgIGlmIChbMTAsIDI1LCA1MCwgMTAwLCAyMDBdLmluY2x1ZGVzKGNvbmZpZ18xLmRlZmF1bHQud29yZHMpKSB7XG4gICAgICAgICAgICBjb25zdCBjb25maWdXb3JkcyA9IGNvbmZpZ18xLmRlZmF1bHQud29yZHM7XG4gICAgICAgICAgICBleHBvcnRzLmZpbHRlcnNbXCJ3b3Jkc1wiXVtjb25maWdXb3Jkc10gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzW1wid29yZHNcIl1bXCJjdXN0b21cIl0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgIGNvbnN0IGZpbHRlck5hbWUgPSBbXG4gICAgICAgICAgICBcInNob3J0XCIsXG4gICAgICAgICAgICBcIm1lZGl1bVwiLFxuICAgICAgICAgICAgXCJsb25nXCIsXG4gICAgICAgICAgICBcInRoaWNjXCIsXG4gICAgICAgIF07XG4gICAgICAgIGZpbHRlck5hbWUuZm9yRWFjaCgocWwsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5xdW90ZUxlbmd0aC5pbmNsdWRlcyhpbmRleCkpIHtcbiAgICAgICAgICAgICAgICBleHBvcnRzLmZpbHRlcnNbXCJxdW90ZUxlbmd0aFwiXVtxbF0gPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzW1wicXVvdGVMZW5ndGhcIl1bcWxdID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbikge1xuICAgICAgICBleHBvcnRzLmZpbHRlcnNbXCJwdW5jdHVhdGlvblwiXVtcIm9uXCJdID0gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGV4cG9ydHMuZmlsdGVyc1tcInB1bmN0dWF0aW9uXCJdW1wib2ZmXCJdID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubnVtYmVycykge1xuICAgICAgICBleHBvcnRzLmZpbHRlcnNbXCJudW1iZXJzXCJdW1wib25cIl0gPSB0cnVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZXhwb3J0cy5maWx0ZXJzW1wibnVtYmVyc1wiXVtcIm9mZlwiXSA9IHRydWU7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIiAmJiAvZW5nbGlzaC4qLy50ZXN0KGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UpKSB7XG4gICAgICAgIGV4cG9ydHMuZmlsdGVyc1tcImxhbmd1YWdlXCJdW1wiZW5nbGlzaFwiXSA9IHRydWU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBleHBvcnRzLmZpbHRlcnNbXCJsYW5ndWFnZVwiXVtjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlXSA9IHRydWU7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJub25lXCIpIHtcbiAgICAgICAgZXhwb3J0cy5maWx0ZXJzLmZ1bmJveC5ub25lID0gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGV4cG9ydHMuZmlsdGVycy5mdW5ib3hbY29uZmlnXzEuZGVmYXVsdC5mdW5ib3hdID0gdHJ1ZTtcbiAgICB9XG4gICAgZXhwb3J0cy5maWx0ZXJzW1widGFnc1wiXVtcIm5vbmVcIl0gPSB0cnVlO1xuICAgIChfYSA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICBpZiAodGFnLmFjdGl2ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzW1widGFnc1wiXVtcIm5vbmVcIl0gPSBmYWxzZTtcbiAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVyc1tcInRhZ3NcIl1bdGFnLl9pZF0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgZXhwb3J0cy5maWx0ZXJzW1wiZGF0ZVwiXVtcImFsbFwiXSA9IHRydWU7XG4gICAgdXBkYXRlQWN0aXZlKCk7XG4gICAgc2F2ZSgpO1xufSk7XG4kKFwiLnBhZ2VBY2NvdW50IC50b3BGaWx0ZXJzIC5idXR0b24udG9nZ2xlQWR2YW5jZWRGaWx0ZXJzXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICQoXCIucGFnZUFjY291bnQgLmZpbHRlckJ1dHRvbnNcIikuc2xpZGVUb2dnbGUoMjUwKTtcbiAgICAkKFwiLnBhZ2VBY2NvdW50IC50b3BGaWx0ZXJzIC5idXR0b24udG9nZ2xlQWR2YW5jZWRGaWx0ZXJzXCIpLnRvZ2dsZUNsYXNzKFwiYWN0aXZlXCIpO1xufSk7XG5NaXNjLmdldExhbmd1YWdlTGlzdCgpLnRoZW4oKGxhbmd1YWdlcykgPT4ge1xuICAgIGxhbmd1YWdlcy5mb3JFYWNoKChsYW5ndWFnZSkgPT4ge1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5jb250ZW50IC5maWx0ZXJCdXR0b25zIC5idXR0b25zQW5kVGl0bGUubGFuZ3VhZ2VzIC5idXR0b25zXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cImJ1dHRvblwiIGZpbHRlcj1cIiR7bGFuZ3VhZ2V9XCI+JHtsYW5ndWFnZS5yZXBsYWNlKFwiX1wiLCBcIiBcIil9PC9kaXY+YCk7XG4gICAgfSk7XG59KTtcbiQoXCIucGFnZUFjY291bnQgLmNvbnRlbnQgLmZpbHRlckJ1dHRvbnMgLmJ1dHRvbnNBbmRUaXRsZS5mdW5ib3ggLmJ1dHRvbnNcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwiYnV0dG9uXCIgZmlsdGVyPVwibm9uZVwiPm5vbmU8L2Rpdj5gKTtcbk1pc2MuZ2V0RnVuYm94TGlzdCgpLnRoZW4oKGZ1bmJveE1vZGVzKSA9PiB7XG4gICAgZnVuYm94TW9kZXMuZm9yRWFjaCgoZnVuYm94KSA9PiB7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmNvbnRlbnQgLmZpbHRlckJ1dHRvbnMgLmJ1dHRvbnNBbmRUaXRsZS5mdW5ib3ggLmJ1dHRvbnNcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwiYnV0dG9uXCIgZmlsdGVyPVwiJHtmdW5ib3gubmFtZX1cIj4ke2Z1bmJveC5uYW1lLnJlcGxhY2UoL18vZywgXCIgXCIpfTwvZGl2PmApO1xuICAgIH0pO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGlkZSA9IGV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgLy8gJChcIi5zaWduT3V0XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpLmNzcyhcIm9wYWNpdHlcIiwgMSk7XG4gICAgJChcIi5zaWduT3V0XCIpXG4gICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAuY3NzKHtcbiAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgdHJhbnNpdGlvbjogXCIwc1wiLFxuICAgIH0pXG4gICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogMSxcbiAgICB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgJChcIi5zaWduT3V0XCIpLmNzcyh7IHRyYW5zaXRpb246IFwiMC4yNXNcIiB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgICQoXCIuc2lnbk91dFwiKVxuICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAuY3NzKHtcbiAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgdHJhbnNpdGlvbjogXCIwc1wiLFxuICAgIH0pXG4gICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogMCxcbiAgICB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgJChcIi5zaWduT3V0XCIpLmNzcyh7IHRyYW5zaXRpb246IFwiMC4yNXNcIiB9KTtcbiAgICAgICAgJChcIi5zaWduT3V0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xuICAgIC8vICQoXCIuc2lnbk91dFwiKS5jc3MoXCJvcGFjaXR5XCIsIDApLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbi8vICQoXCIjbGl2ZVdwbVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKS5jc3MoXCJvcGFjaXR5XCIsIDApLmFuaW1hdGUoXG4vLyAgIHtcbi8vICAgICBvcGFjaXR5OiBDb25maWcudGltZXJPcGFjaXR5LFxuLy8gICB9LFxuLy8gICAxMjVcbi8vICk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgQkFTRV9QQVRIID0gXCIvYXBlLWtleXNcIjtcbmZ1bmN0aW9uIGdldEFwZUtleXNFbmRwb2ludHMoYXBlQ2xpZW50KSB7XG4gICAgZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5nZXQoQkFTRV9QQVRIKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGdlbmVyYXRlKG5hbWUsIGVuYWJsZWQpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7IG5hbWUsIGVuYWJsZWQgfTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucG9zdChCQVNFX1BBVEgsIHsgcGF5bG9hZCB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHVwZGF0ZShhcGVLZXlJZCwgdXBkYXRlcykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IE9iamVjdC5hc3NpZ24oe30sIHVwZGF0ZXMpO1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wYXRjaChgJHtCQVNFX1BBVEh9LyR7YXBlS2V5SWR9YCwgeyBwYXlsb2FkIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gX2RlbGV0ZShhcGVLZXlJZCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5kZWxldGUoYCR7QkFTRV9QQVRIfS8ke2FwZUtleUlkfWApO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0LFxuICAgICAgICBnZW5lcmF0ZSxcbiAgICAgICAgdXBkYXRlLFxuICAgICAgICBkZWxldGU6IF9kZWxldGUsXG4gICAgfTtcbn1cbmV4cG9ydHMuZGVmYXVsdCA9IGdldEFwZUtleXNFbmRwb2ludHM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgQkFTRV9QQVRIID0gXCIvY29uZmlnc1wiO1xuZnVuY3Rpb24gZ2V0Q29uZmlnc0VuZHBvaW50cyhhcGVDbGllbnQpIHtcbiAgICBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmdldChCQVNFX1BBVEgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gc2F2ZShjb25maWcpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucGF0Y2goQkFTRV9QQVRILCB7IHBheWxvYWQ6IHsgY29uZmlnIH0gfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBnZXQsXG4gICAgICAgIHNhdmUsXG4gICAgfTtcbn1cbmV4cG9ydHMuZGVmYXVsdCA9IGdldENvbmZpZ3NFbmRwb2ludHM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IGNvbmZpZ3NfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9jb25maWdzXCIpKTtcbmNvbnN0IGxlYWRlcmJvYXJkc18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL2xlYWRlcmJvYXJkc1wiKSk7XG5jb25zdCBwcmVzZXRzXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vcHJlc2V0c1wiKSk7XG5jb25zdCBwc2FzXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vcHNhc1wiKSk7XG5jb25zdCBxdW90ZXNfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9xdW90ZXNcIikpO1xuY29uc3QgcmVzdWx0c18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL3Jlc3VsdHNcIikpO1xuY29uc3QgdXNlcnNfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi91c2Vyc1wiKSk7XG5jb25zdCBhcGVfa2V5c18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL2FwZS1rZXlzXCIpKTtcbmV4cG9ydHMuZGVmYXVsdCA9IHtcbiAgICBnZXRDb25maWdzRW5kcG9pbnRzOiBjb25maWdzXzEuZGVmYXVsdCxcbiAgICBnZXRMZWFkZXJib2FyZHNFbmRwb2ludHM6IGxlYWRlcmJvYXJkc18xLmRlZmF1bHQsXG4gICAgZ2V0UHJlc2V0c0VuZHBvaW50czogcHJlc2V0c18xLmRlZmF1bHQsXG4gICAgZ2V0UHNhc0VuZHBvaW50czogcHNhc18xLmRlZmF1bHQsXG4gICAgZ2V0UXVvdGVzRW5kcG9pbnRzOiBxdW90ZXNfMS5kZWZhdWx0LFxuICAgIGdldFJlc3VsdHNFbmRwb2ludHM6IHJlc3VsdHNfMS5kZWZhdWx0LFxuICAgIGdldFVzZXJzRW5kcG9pbnRzOiB1c2Vyc18xLmRlZmF1bHQsXG4gICAgZ2V0QXBlS2V5c0VuZHBvaW50czogYXBlX2tleXNfMS5kZWZhdWx0LFxufTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBCQVNFX1BBVEggPSBcIi9sZWFkZXJib2FyZHNcIjtcbmZ1bmN0aW9uIGdldExlYWRlcmJvYXJkc0VuZHBvaW50cyhhcGVDbGllbnQpIHtcbiAgICBmdW5jdGlvbiBnZXQobGFuZ3VhZ2UsIG1vZGUsIG1vZGUyLCBza2lwID0gMCwgbGltaXQgPSA1MCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3Qgc2VhcmNoUXVlcnkgPSB7XG4gICAgICAgICAgICAgICAgbGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgbW9kZSxcbiAgICAgICAgICAgICAgICBtb2RlMixcbiAgICAgICAgICAgICAgICBza2lwLFxuICAgICAgICAgICAgICAgIGxpbWl0OiBNYXRoLm1heChNYXRoLm1pbihsaW1pdCwgNTApLCAwKSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmdldChCQVNFX1BBVEgsIHsgc2VhcmNoUXVlcnkgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBnZXRSYW5rKGxhbmd1YWdlLCBtb2RlLCBtb2RlMikge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3Qgc2VhcmNoUXVlcnkgPSB7XG4gICAgICAgICAgICAgICAgbGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgbW9kZSxcbiAgICAgICAgICAgICAgICBtb2RlMixcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmdldChgJHtCQVNFX1BBVEh9L3JhbmtgLCB7IHNlYXJjaFF1ZXJ5IH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHsgZ2V0LCBnZXRSYW5rIH07XG59XG5leHBvcnRzLmRlZmF1bHQgPSBnZXRMZWFkZXJib2FyZHNFbmRwb2ludHM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgQkFTRV9QQVRIID0gXCIvcHJlc2V0c1wiO1xuZnVuY3Rpb24gZ2V0UHJlc2V0c0VuZHBvaW50cyhhcGVDbGllbnQpIHtcbiAgICBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmdldChCQVNFX1BBVEgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gYWRkKHByZXNldE5hbWUsIGNvbmZpZ0NoYW5nZXMpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgbmFtZTogcHJlc2V0TmFtZSxcbiAgICAgICAgICAgICAgICBjb25maWc6IGNvbmZpZ0NoYW5nZXMsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wb3N0KEJBU0VfUEFUSCwgeyBwYXlsb2FkIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZWRpdChwcmVzZXRJZCwgcHJlc2V0TmFtZSwgY29uZmlnQ2hhbmdlcykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgICAgICBfaWQ6IHByZXNldElkLFxuICAgICAgICAgICAgICAgIG5hbWU6IHByZXNldE5hbWUsXG4gICAgICAgICAgICAgICAgY29uZmlnOiBjb25maWdDaGFuZ2VzLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucGF0Y2goQkFTRV9QQVRILCB7IHBheWxvYWQgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBfZGVsZXRlKHByZXNldElkKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmRlbGV0ZShgJHtCQVNFX1BBVEh9LyR7cHJlc2V0SWR9YCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4geyBnZXQsIGFkZCwgZWRpdCwgZGVsZXRlOiBfZGVsZXRlIH07XG59XG5leHBvcnRzLmRlZmF1bHQgPSBnZXRQcmVzZXRzRW5kcG9pbnRzO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IHZlcnNpb25fMSA9IHJlcXVpcmUoXCIuLi8uLi92ZXJzaW9uXCIpO1xuY29uc3QgQkFTRV9QQVRIID0gXCIvcHNhc1wiO1xuZnVuY3Rpb24gZ2V0UHNhc0VuZHBvaW50cyhhcGVDbGllbnQpIHtcbiAgICBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmdldChCQVNFX1BBVEgsIHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIFwiQ2xpZW50LVZlcnNpb25cIjogdmVyc2lvbl8xLkNMSUVOVF9WRVJTSU9OLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiB7IGdldCB9O1xufVxuZXhwb3J0cy5kZWZhdWx0ID0gZ2V0UHNhc0VuZHBvaW50cztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBCQVNFX1BBVEggPSBcIi9xdW90ZXNcIjtcbmZ1bmN0aW9uIGdldFF1b3Rlc0VuZHBvaW50cyhhcGVDbGllbnQpIHtcbiAgICBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmdldChCQVNFX1BBVEgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gc3VibWl0KHRleHQsIHNvdXJjZSwgbGFuZ3VhZ2UsIGNhcHRjaGEpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgICAgICBzb3VyY2UsXG4gICAgICAgICAgICAgICAgbGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgY2FwdGNoYSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBvc3QoQkFTRV9QQVRILCB7IHBheWxvYWQgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBhcHByb3ZlU3VibWlzc2lvbihxdW90ZVN1Ym1pc3Npb25JZCwgZWRpdFRleHQsIGVkaXRTb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgcXVvdGVJZDogcXVvdGVTdWJtaXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgZWRpdFRleHQsXG4gICAgICAgICAgICAgICAgZWRpdFNvdXJjZSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBvc3QoYCR7QkFTRV9QQVRIfS9hcHByb3ZlYCwgeyBwYXlsb2FkIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gcmVqZWN0U3VibWlzc2lvbihxdW90ZVN1Ym1pc3Npb25JZCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wb3N0KGAke0JBU0VfUEFUSH0vcmVqZWN0YCwge1xuICAgICAgICAgICAgICAgIHBheWxvYWQ6IHsgcXVvdGVJZDogcXVvdGVTdWJtaXNzaW9uSWQgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZ2V0UmF0aW5nKHF1b3RlKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBzZWFyY2hRdWVyeSA9IHtcbiAgICAgICAgICAgICAgICBxdW90ZUlkOiBxdW90ZS5pZCxcbiAgICAgICAgICAgICAgICBsYW5ndWFnZTogcXVvdGUubGFuZ3VhZ2UsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5nZXQoYCR7QkFTRV9QQVRIfS9yYXRpbmdgLCB7IHNlYXJjaFF1ZXJ5IH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gYWRkUmF0aW5nKHF1b3RlLCByYXRpbmcpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgcXVvdGVJZDogcXVvdGUuaWQsXG4gICAgICAgICAgICAgICAgcmF0aW5nLFxuICAgICAgICAgICAgICAgIGxhbmd1YWdlOiBxdW90ZS5sYW5ndWFnZSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBvc3QoYCR7QkFTRV9QQVRIfS9yYXRpbmdgLCB7IHBheWxvYWQgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiByZXBvcnQocXVvdGVJZCwgcXVvdGVMYW5ndWFnZSwgcmVhc29uLCBjb21tZW50LCBjYXB0Y2hhKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICAgICAgICAgIHF1b3RlSWQsXG4gICAgICAgICAgICAgICAgcXVvdGVMYW5ndWFnZSxcbiAgICAgICAgICAgICAgICByZWFzb24sXG4gICAgICAgICAgICAgICAgY29tbWVudCxcbiAgICAgICAgICAgICAgICBjYXB0Y2hhLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucG9zdChgJHtCQVNFX1BBVEh9L3JlcG9ydGAsIHsgcGF5bG9hZCB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIGdldCxcbiAgICAgICAgc3VibWl0LFxuICAgICAgICBhcHByb3ZlU3VibWlzc2lvbixcbiAgICAgICAgcmVqZWN0U3VibWlzc2lvbixcbiAgICAgICAgZ2V0UmF0aW5nLFxuICAgICAgICBhZGRSYXRpbmcsXG4gICAgICAgIHJlcG9ydCxcbiAgICB9O1xufVxuZXhwb3J0cy5kZWZhdWx0ID0gZ2V0UXVvdGVzRW5kcG9pbnRzO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IHZlcnNpb25fMSA9IHJlcXVpcmUoXCIuLi8uLi92ZXJzaW9uXCIpO1xuY29uc3QgQkFTRV9QQVRIID0gXCIvcmVzdWx0c1wiO1xuZnVuY3Rpb24gZ2V0UmVzdWx0c0VuZHBvaW50cyhhcGVDbGllbnQpIHtcbiAgICBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmdldChCQVNFX1BBVEgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gc2F2ZShyZXN1bHQpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucG9zdChCQVNFX1BBVEgsIHtcbiAgICAgICAgICAgICAgICBwYXlsb2FkOiB7IHJlc3VsdCB9LFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsgXCJDbGllbnQtVmVyc2lvblwiOiB2ZXJzaW9uXzEuQ0xJRU5UX1ZFUlNJT04gfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gdXBkYXRlVGFncyhyZXN1bHRJZCwgdGFnSWRzKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBhdGNoKGAke0JBU0VfUEFUSH0vdGFnc2AsIHtcbiAgICAgICAgICAgICAgICBwYXlsb2FkOiB7IHJlc3VsdElkLCB0YWdJZHMgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZGVsZXRlQWxsKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5kZWxldGUoQkFTRV9QQVRIKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiB7IGdldCwgc2F2ZSwgdXBkYXRlVGFncywgZGVsZXRlQWxsIH07XG59XG5leHBvcnRzLmRlZmF1bHQgPSBnZXRSZXN1bHRzRW5kcG9pbnRzO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IEJBU0VfUEFUSCA9IFwiL3VzZXJzXCI7XG5mdW5jdGlvbiBnZXRVc2Vyc0VuZHBvaW50cyhhcGVDbGllbnQpIHtcbiAgICBmdW5jdGlvbiBnZXREYXRhKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5nZXQoQkFTRV9QQVRIKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGNyZWF0ZShuYW1lLCBlbWFpbCwgdWlkKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICAgICAgICAgIGVtYWlsLFxuICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgdWlkLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucG9zdChgJHtCQVNFX1BBVEh9L3NpZ251cGAsIHsgcGF5bG9hZCB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGdldE5hbWVBdmFpbGFiaWxpdHkobmFtZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5nZXQoYCR7QkFTRV9QQVRIfS9jaGVja05hbWUvJHtuYW1lfWApO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gX2RlbGV0ZSgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZGVsZXRlKEJBU0VfUEFUSCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiB1cGRhdGVOYW1lKG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucGF0Y2goYCR7QkFTRV9QQVRIfS9uYW1lYCwgeyBwYXlsb2FkOiB7IG5hbWUgfSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHVwZGF0ZUxlYWRlcmJvYXJkTWVtb3J5KG1vZGUsIG1vZGUyLCBsYW5ndWFnZSwgcmFuaykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgICAgICBtb2RlLFxuICAgICAgICAgICAgICAgIG1vZGUyLFxuICAgICAgICAgICAgICAgIGxhbmd1YWdlLFxuICAgICAgICAgICAgICAgIHJhbmssXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wYXRjaChgJHtCQVNFX1BBVEh9L2xlYWRlcmJvYXJkTWVtb3J5YCwgeyBwYXlsb2FkIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gdXBkYXRlRW1haWwobmV3RW1haWwsIHByZXZpb3VzRW1haWwpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgbmV3RW1haWwsXG4gICAgICAgICAgICAgICAgcHJldmlvdXNFbWFpbCxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBhdGNoKGAke0JBU0VfUEFUSH0vZW1haWxgLCB7IHBheWxvYWQgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBkZWxldGVQZXJzb25hbEJlc3RzKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5kZWxldGUoYCR7QkFTRV9QQVRIfS9wZXJzb25hbEJlc3RzYCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBnZXRUYWdzKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5nZXQoYCR7QkFTRV9QQVRIfS90YWdzYCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBjcmVhdGVUYWcodGFnTmFtZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wb3N0KGAke0JBU0VfUEFUSH0vdGFnc2AsIHsgcGF5bG9hZDogeyB0YWdOYW1lIH0gfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBlZGl0VGFnKHRhZ0lkLCBuZXdOYW1lKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICAgICAgICAgIHRhZ0lkLFxuICAgICAgICAgICAgICAgIG5ld05hbWUsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wYXRjaChgJHtCQVNFX1BBVEh9L3RhZ3NgLCB7IHBheWxvYWQgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBkZWxldGVUYWcodGFnSWQpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZGVsZXRlKGAke0JBU0VfUEFUSH0vdGFncy8ke3RhZ0lkfWApO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZGVsZXRlVGFnUGVyc29uYWxCZXN0KHRhZ0lkKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmRlbGV0ZShgJHtCQVNFX1BBVEh9L3RhZ3MvJHt0YWdJZH0vcGVyc29uYWxCZXN0YCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBnZXRDdXN0b21UaGVtZXMoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmdldChgJHtCQVNFX1BBVEh9L2N1c3RvbVRoZW1lc2ApO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZWRpdEN1c3RvbVRoZW1lKHRoZW1lSWQsIG5ld1RoZW1lKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICAgICAgICAgIHRoZW1lSWQ6IHRoZW1lSWQsXG4gICAgICAgICAgICAgICAgdGhlbWU6IHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogbmV3VGhlbWUubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgY29sb3JzOiBuZXdUaGVtZS5jb2xvcnMsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBhdGNoKGAke0JBU0VfUEFUSH0vY3VzdG9tVGhlbWVzYCwgeyBwYXlsb2FkIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZGVsZXRlQ3VzdG9tVGhlbWUodGhlbWVJZCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgICAgICB0aGVtZUlkOiB0aGVtZUlkLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZGVsZXRlKGAke0JBU0VfUEFUSH0vY3VzdG9tVGhlbWVzYCwgeyBwYXlsb2FkIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gYWRkQ3VzdG9tVGhlbWUobmV3VGhlbWUpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7IG5hbWU6IG5ld1RoZW1lLm5hbWUsIGNvbG9yczogbmV3VGhlbWUuY29sb3JzIH07XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBvc3QoYCR7QkFTRV9QQVRIfS9jdXN0b21UaGVtZXNgLCB7IHBheWxvYWQgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBsaW5rRGlzY29yZChkYXRhKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBvc3QoYCR7QkFTRV9QQVRIfS9kaXNjb3JkL2xpbmtgLCB7XG4gICAgICAgICAgICAgICAgcGF5bG9hZDogeyBkYXRhIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHVubGlua0Rpc2NvcmQoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBvc3QoYCR7QkFTRV9QQVRIfS9kaXNjb3JkL3VubGlua2ApO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0RGF0YSxcbiAgICAgICAgY3JlYXRlLFxuICAgICAgICBnZXROYW1lQXZhaWxhYmlsaXR5LFxuICAgICAgICBkZWxldGU6IF9kZWxldGUsXG4gICAgICAgIHVwZGF0ZU5hbWUsXG4gICAgICAgIHVwZGF0ZUxlYWRlcmJvYXJkTWVtb3J5LFxuICAgICAgICB1cGRhdGVFbWFpbCxcbiAgICAgICAgZGVsZXRlUGVyc29uYWxCZXN0cyxcbiAgICAgICAgZ2V0VGFncyxcbiAgICAgICAgY3JlYXRlVGFnLFxuICAgICAgICBlZGl0VGFnLFxuICAgICAgICBkZWxldGVUYWcsXG4gICAgICAgIGRlbGV0ZVRhZ1BlcnNvbmFsQmVzdCxcbiAgICAgICAgbGlua0Rpc2NvcmQsXG4gICAgICAgIHVubGlua0Rpc2NvcmQsXG4gICAgICAgIGdldEN1c3RvbVRoZW1lcyxcbiAgICAgICAgYWRkQ3VzdG9tVGhlbWUsXG4gICAgICAgIGVkaXRDdXN0b21UaGVtZSxcbiAgICAgICAgZGVsZXRlQ3VzdG9tVGhlbWUsXG4gICAgfTtcbn1cbmV4cG9ydHMuZGVmYXVsdCA9IGdldFVzZXJzRW5kcG9pbnRzO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IGF4aW9zXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImF4aW9zXCIpKTtcbmNvbnN0IGVuZHBvaW50c18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL2VuZHBvaW50c1wiKSk7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xuY29uc3QgYXV0aF8xID0gcmVxdWlyZShcImZpcmViYXNlL2F1dGhcIik7XG5jb25zdCBERVZfU0VSVkVSX0hPU1QgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6NTAwNVwiO1xuY29uc3QgUFJPRF9TRVJWRVJfSE9TVCA9IFwiaHR0cHM6Ly9hcGkubW9ua2V5dHlwZS5jb21cIjtcbmNvbnN0IEFQSV9QQVRIID0gXCJcIjtcbmNvbnN0IEJBU0VfVVJMID0gd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lID09PSBcImxvY2FsaG9zdFwiID8gREVWX1NFUlZFUl9IT1NUIDogUFJPRF9TRVJWRVJfSE9TVDtcbmNvbnN0IEFQSV9VUkwgPSBgJHtCQVNFX1VSTH0ke0FQSV9QQVRIfWA7XG4vLyBBZGFwdHMgdGhlIGFwZSBjbGllbnQncyB2aWV3IG9mIHJlcXVlc3Qgb3B0aW9ucyB0byB0aGUgdW5kZXJseWluZyBIVFRQIGNsaWVudC5cbmZ1bmN0aW9uIGFkYXB0UmVxdWVzdE9wdGlvbnMob3B0aW9ucykge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgICAgICBjb25zdCBpZFRva2VuID0gY3VycmVudFVzZXIgJiYgKHlpZWxkICgwLCBhdXRoXzEuZ2V0SWRUb2tlbikoY3VycmVudFVzZXIpKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBhcmFtczogb3B0aW9ucy5zZWFyY2hRdWVyeSxcbiAgICAgICAgICAgIGRhdGE6IG9wdGlvbnMucGF5bG9hZCxcbiAgICAgICAgICAgIGhlYWRlcnM6IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zLmhlYWRlcnMpLCB7IEFjY2VwdDogXCJhcHBsaWNhdGlvbi9qc29uXCIsIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiIH0pLCAoaWRUb2tlbiAmJiB7IEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtpZFRva2VufWAgfSkpLFxuICAgICAgICB9O1xuICAgIH0pO1xufVxuLy8gV3JhcCB0aGUgdW5kZXJseWluZyBIVFRQIGNsaWVudCdzIG1ldGhvZCB3aXRoIG91ciBvd24uXG5mdW5jdGlvbiBhcGVpZnlDbGllbnRNZXRob2QoY2xpZW50TWV0aG9kLCBtZXRob2RUeXBlKSB7XG4gICAgcmV0dXJuIChlbmRwb2ludCwgb3B0aW9ucyA9IHt9KSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jO1xuICAgICAgICBsZXQgZXJyb3JNZXNzYWdlID0gXCJcIjtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3RPcHRpb25zID0geWllbGQgYWRhcHRSZXF1ZXN0T3B0aW9ucyhvcHRpb25zKTtcbiAgICAgICAgICAgIGxldCByZXNwb25zZTtcbiAgICAgICAgICAgIGlmIChtZXRob2RUeXBlID09PSBcImdldFwiIHx8IG1ldGhvZFR5cGUgPT09IFwiZGVsZXRlXCIpIHtcbiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHlpZWxkIGNsaWVudE1ldGhvZChlbmRwb2ludCwgcmVxdWVzdE9wdGlvbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB5aWVsZCBjbGllbnRNZXRob2QoZW5kcG9pbnQsIHJlcXVlc3RPcHRpb25zLmRhdGEsIHJlcXVlc3RPcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHsgbWVzc2FnZSwgZGF0YSB9ID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICAgICAgICBkYXRhLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgY29uc3QgdHlwZWRFcnJvciA9IGVycm9yO1xuICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gdHlwZWRFcnJvci5tZXNzYWdlO1xuICAgICAgICAgICAgaWYgKGF4aW9zXzEuZGVmYXVsdC5pc0F4aW9zRXJyb3IodHlwZWRFcnJvcikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7IHN0YXR1czogKF9iID0gKF9hID0gdHlwZWRFcnJvci5yZXNwb25zZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YXR1cykgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogNTAwLCBtZXNzYWdlOiB0eXBlZEVycm9yLm1lc3NhZ2UgfSwgKF9jID0gdHlwZWRFcnJvci5yZXNwb25zZSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdGF0dXM6IDUwMCxcbiAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yTWVzc2FnZSxcbiAgICAgICAgfTtcbiAgICB9KTtcbn1cbmNvbnN0IGF4aW9zQ2xpZW50ID0gYXhpb3NfMS5kZWZhdWx0LmNyZWF0ZSh7XG4gICAgYmFzZVVSTDogQVBJX1VSTCxcbiAgICB0aW1lb3V0OiAxMDAwMCxcbn0pO1xuY29uc3QgYXBlQ2xpZW50ID0ge1xuICAgIGdldDogYXBlaWZ5Q2xpZW50TWV0aG9kKGF4aW9zQ2xpZW50LmdldCwgXCJnZXRcIiksXG4gICAgcG9zdDogYXBlaWZ5Q2xpZW50TWV0aG9kKGF4aW9zQ2xpZW50LnBvc3QsIFwicG9zdFwiKSxcbiAgICBwdXQ6IGFwZWlmeUNsaWVudE1ldGhvZChheGlvc0NsaWVudC5wdXQsIFwicHV0XCIpLFxuICAgIHBhdGNoOiBhcGVpZnlDbGllbnRNZXRob2QoYXhpb3NDbGllbnQucGF0Y2gsIFwicGF0Y2hcIiksXG4gICAgZGVsZXRlOiBhcGVpZnlDbGllbnRNZXRob2QoYXhpb3NDbGllbnQuZGVsZXRlLCBcImRlbGV0ZVwiKSxcbn07XG4vLyBBUEkgRW5kcG9pbnRzXG5jb25zdCBBcGUgPSB7XG4gICAgdXNlcnM6IGVuZHBvaW50c18xLmRlZmF1bHQuZ2V0VXNlcnNFbmRwb2ludHMoYXBlQ2xpZW50KSxcbiAgICBjb25maWdzOiBlbmRwb2ludHNfMS5kZWZhdWx0LmdldENvbmZpZ3NFbmRwb2ludHMoYXBlQ2xpZW50KSxcbiAgICByZXN1bHRzOiBlbmRwb2ludHNfMS5kZWZhdWx0LmdldFJlc3VsdHNFbmRwb2ludHMoYXBlQ2xpZW50KSxcbiAgICBwc2FzOiBlbmRwb2ludHNfMS5kZWZhdWx0LmdldFBzYXNFbmRwb2ludHMoYXBlQ2xpZW50KSxcbiAgICBxdW90ZXM6IGVuZHBvaW50c18xLmRlZmF1bHQuZ2V0UXVvdGVzRW5kcG9pbnRzKGFwZUNsaWVudCksXG4gICAgbGVhZGVyYm9hcmRzOiBlbmRwb2ludHNfMS5kZWZhdWx0LmdldExlYWRlcmJvYXJkc0VuZHBvaW50cyhhcGVDbGllbnQpLFxuICAgIHByZXNldHM6IGVuZHBvaW50c18xLmRlZmF1bHQuZ2V0UHJlc2V0c0VuZHBvaW50cyhhcGVDbGllbnQpLFxuICAgIGFwZUtleXM6IGVuZHBvaW50c18xLmRlZmF1bHQuZ2V0QXBlS2V5c0VuZHBvaW50cyhhcGVDbGllbnQpLFxufTtcbmV4cG9ydHMuZGVmYXVsdCA9IEFwZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaXNDb25maWdWYWx1ZVZhbGlkQXN5bmMgPSBleHBvcnRzLmlzQ29uZmlnVmFsdWVWYWxpZCA9IGV4cG9ydHMuaXNDb25maWdLZXlWYWxpZCA9IHZvaWQgMDtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuZnVuY3Rpb24gaXNDb25maWdLZXlWYWxpZChuYW1lKSB7XG4gICAgaWYgKG5hbWUgPT09IG51bGwgfHwgbmFtZSA9PT0gdW5kZWZpbmVkIHx8IG5hbWUgPT09IFwiXCIpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAobmFtZS5sZW5ndGggPiAzMClcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiAvXlswLTlhLXpBLVpfLlxcLSMrXSskLy50ZXN0KG5hbWUpO1xufVxuZXhwb3J0cy5pc0NvbmZpZ0tleVZhbGlkID0gaXNDb25maWdLZXlWYWxpZDtcbmZ1bmN0aW9uIGludmFsaWQoa2V5LCB2YWwsIGN1c3RvbU1lc3NhZ2UpIHtcbiAgICBpZiAoY3VzdG9tTWVzc2FnZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGBJbnZhbGlkIHZhbHVlIGZvciAke2tleX0gKCR7dmFsfSkuIFBsZWFzZSB0cnkgdG8gY2hhbmdlIHRoaXMgc2V0dGluZyBhZ2Fpbi5gLCAtMSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgSW52YWxpZCB2YWx1ZSBmb3IgJHtrZXl9ICgke3ZhbH0pLiAke2N1c3RvbU1lc3NhZ2V9YCwgLTEpO1xuICAgIH1cbiAgICBjb25zb2xlLmVycm9yKGBJbnZhbGlkIHZhbHVlIGtleSAke2tleX0gdmFsdWUgJHt2YWx9IHR5cGUgJHt0eXBlb2YgdmFsfWApO1xufVxuZnVuY3Rpb24gaXNBcnJheSh2YWwpIHtcbiAgICByZXR1cm4gdmFsIGluc3RhbmNlb2YgQXJyYXk7XG59XG5mdW5jdGlvbiBpc0NvbmZpZ1ZhbHVlVmFsaWQoa2V5LCB2YWwsIHBvc3NpYmxlVHlwZXMpIHtcbiAgICBsZXQgaXNWYWxpZCA9IGZhbHNlO1xuICAgIC8vIG1pZ2h0IGJlIHVzZWQgaW4gdGhlIGZ1dHVyZVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgIGxldCBjdXN0b21NZXNzYWdlID0gdW5kZWZpbmVkO1xuICAgIGZvciAoY29uc3QgcG9zc2libGVUeXBlIG9mIHBvc3NpYmxlVHlwZXMpIHtcbiAgICAgICAgc3dpdGNoIChwb3NzaWJsZVR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJib29sZWFuXCI6XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09IFwiYm9vbGVhblwiKVxuICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJudWxsXCI6XG4gICAgICAgICAgICAgICAgaWYgKHZhbCA9PT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgaXNWYWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibnVtYmVyXCI6XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09IFwibnVtYmVyXCIpXG4gICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIm51bWJlckFycmF5XCI6XG4gICAgICAgICAgICAgICAgaWYgKGlzQXJyYXkodmFsKSAmJiB2YWwuZXZlcnkoKHYpID0+IHR5cGVvZiB2ID09PSBcIm51bWJlclwiKSkge1xuICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwic3RyaW5nXCI6XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09IFwic3RyaW5nXCIpXG4gICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInN0cmluZ0FycmF5XCI6XG4gICAgICAgICAgICAgICAgaWYgKGlzQXJyYXkodmFsKSAmJiB2YWwuZXZlcnkoKHYpID0+IHR5cGVvZiB2ID09PSBcInN0cmluZ1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwidW5kZWZpbmVkXCI6XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09IFwidW5kZWZpbmVkXCIgfHwgdmFsID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBpZiAoaXNBcnJheShwb3NzaWJsZVR5cGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwb3NzaWJsZVR5cGUuaW5jbHVkZXModmFsKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWlzVmFsaWQpXG4gICAgICAgIGludmFsaWQoa2V5LCB2YWwsIGN1c3RvbU1lc3NhZ2UpO1xuICAgIHJldHVybiBpc1ZhbGlkO1xufVxuZXhwb3J0cy5pc0NvbmZpZ1ZhbHVlVmFsaWQgPSBpc0NvbmZpZ1ZhbHVlVmFsaWQ7XG5mdW5jdGlvbiBpc0NvbmZpZ1ZhbHVlVmFsaWRBc3luYyhrZXksIHZhbCwgcG9zc2libGVUeXBlcykge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGxldCBpc1ZhbGlkID0gZmFsc2U7XG4gICAgICAgIGxldCBjdXN0b21NZXNzYWdlID0gdW5kZWZpbmVkO1xuICAgICAgICBmb3IgKGNvbnN0IHBvc3NpYmxlVHlwZSBvZiBwb3NzaWJsZVR5cGVzKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHBvc3NpYmxlVHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJsYXlvdXRmbHVpZFwiOiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsICE9PSBcInN0cmluZ1wiKVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxheW91dE5hbWVzID0gdmFsLnNwbGl0KC9bIyBdKy8pO1xuICAgICAgICAgICAgICAgICAgICBpZiAobGF5b3V0TmFtZXMubGVuZ3RoIDwgMiB8fCBsYXlvdXROYW1lcy5sZW5ndGggPiA1KVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnZlcnQgdGhlIGxheW91dCBuYW1lcyB0byBsYXlvdXRzXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxheW91dHMgPSB5aWVsZCBQcm9taXNlLmFsbChsYXlvdXROYW1lcy5tYXAoKGxheW91dE5hbWUpID0+IE1pc2MuZ2V0TGF5b3V0KGxheW91dE5hbWUpKSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIGFsbCBsYXlvdXRzIGV4aXN0XG4gICAgICAgICAgICAgICAgICAgIGlmICghbGF5b3V0cy5ldmVyeSgobGF5b3V0KSA9PiBsYXlvdXQgIT09IHVuZGVmaW5lZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGludmFsaWRMYXlvdXROYW1lcyA9IGxheW91dE5hbWVzLm1hcCgobGF5b3V0TmFtZSwgaW5kZXgpID0+IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXlvdXROYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dHNbaW5kZXhdLFxuICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnZhbGlkTGF5b3V0cyA9IGludmFsaWRMYXlvdXROYW1lc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKFtfLCBsYXlvdXRdKSA9PiBsYXlvdXQgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKChbbGF5b3V0TmFtZV0pID0+IGxheW91dE5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tTWVzc2FnZSA9IGBUaGUgZm9sbG93aW5nIGlucHV0dGVkIGxheW91dHMgZG8gbm90IGV4aXN0OiAke2ludmFsaWRMYXlvdXRzLmpvaW4oXCIsIFwiKX1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaXNWYWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzVmFsaWQpXG4gICAgICAgICAgICBpbnZhbGlkKGtleSwgdmFsLCBjdXN0b21NZXNzYWdlKTtcbiAgICAgICAgcmV0dXJuIGlzVmFsaWQ7XG4gICAgfSk7XG59XG5leHBvcnRzLmlzQ29uZmlnVmFsdWVWYWxpZEFzeW5jID0gaXNDb25maWdWYWx1ZVZhbGlkQXN5bmM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNldFNob3dMaXZlQWNjID0gZXhwb3J0cy5zZXRTaG93TGl2ZVdwbSA9IGV4cG9ydHMuc2V0U2hvd1RpbWVyUHJvZ3Jlc3MgPSBleHBvcnRzLnNldFBhY2VDYXJldFN0eWxlID0gZXhwb3J0cy5zZXRDYXJldFN0eWxlID0gZXhwb3J0cy5zZXRQYWdlV2lkdGggPSBleHBvcnRzLnNldE9wcG9zaXRlU2hpZnRNb2RlID0gZXhwb3J0cy5zZXRTdHJpY3RTcGFjZSA9IGV4cG9ydHMuc2V0Q29sb3JmdWxNb2RlID0gZXhwb3J0cy5zZXRGbGlwVGVzdENvbG9ycyA9IGV4cG9ydHMuc2V0UmVwZWF0UXVvdGVzID0gZXhwb3J0cy5zZXRFbmFibGVBZHMgPSBleHBvcnRzLnNldFF1aWNrRW5kID0gZXhwb3J0cy5zZXRTaG93QWxsTGluZXMgPSBleHBvcnRzLnNldENhcHNMb2NrV2FybmluZyA9IGV4cG9ydHMuc2V0U2luZ2xlTGlzdENvbW1hbmRMaW5lID0gZXhwb3J0cy5zZXRBbHdheXNTaG93V29yZHNIaXN0b3J5ID0gZXhwb3J0cy5zZXRNaW5CdXJzdEN1c3RvbVNwZWVkID0gZXhwb3J0cy5zZXRNaW5CdXJzdCA9IGV4cG9ydHMuc2V0TWluQWNjQ3VzdG9tID0gZXhwb3J0cy5zZXRNaW5BY2MgPSBleHBvcnRzLnNldE1pbldwbUN1c3RvbVNwZWVkID0gZXhwb3J0cy5zZXRNaW5XcG0gPSBleHBvcnRzLnNldFJlcGVhdGVkUGFjZSA9IGV4cG9ydHMuc2V0UGFjZUNhcmV0Q3VzdG9tU3BlZWQgPSBleHBvcnRzLnNldFBhY2VDYXJldCA9IGV4cG9ydHMuc2V0U3dhcEVzY0FuZFRhYiA9IGV4cG9ydHMuc2V0U2hvd091dE9mRm9jdXNXYXJuaW5nID0gZXhwb3J0cy5zZXRBbHdheXNTaG93Q1BNID0gZXhwb3J0cy5zZXRBbHdheXNTaG93RGVjaW1hbFBsYWNlcyA9IGV4cG9ydHMuc2V0U3RvcE9uRXJyb3IgPSBleHBvcnRzLnNldENoYXJ0U3R5bGUgPSBleHBvcnRzLnNldENoYXJ0QWNjdXJhY3kgPSBleHBvcnRzLnNldEJsaW5kTW9kZSA9IGV4cG9ydHMuc2V0RnVuYm94ID0gZXhwb3J0cy5zZXRGYXZUaGVtZXMgPSBleHBvcnRzLnNldERpZmZpY3VsdHkgPSBleHBvcnRzLnNldFNvdW5kVm9sdW1lID0gZXhwb3J0cy5zZXRQbGF5U291bmRPbkNsaWNrID0gZXhwb3J0cy5zZXRQbGF5U291bmRPbkVycm9yID0gZXhwb3J0cy5zZXRNb2RlID0gZXhwb3J0cy5zZXRQdW5jdHVhdGlvbiA9IGV4cG9ydHMuc2V0TnVtYmVycyA9IGV4cG9ydHMuc2F2ZUZ1bGxDb25maWdUb0xvY2FsU3RvcmFnZSA9IGV4cG9ydHMuc2V0Q2hhbmdlZEJlZm9yZURiID0gZXhwb3J0cy5zZXREYkNvbmZpZ0xvYWRlZCA9IGV4cG9ydHMuc2V0TG9jYWxTdG9yYWdlQ29uZmlnID0gZXhwb3J0cy5jaGFuZ2VkQmVmb3JlRGIgPSBleHBvcnRzLmRiQ29uZmlnTG9hZGVkID0gZXhwb3J0cy5sb2NhbFN0b3JhZ2VDb25maWcgPSB2b2lkIDA7XG5leHBvcnRzLmxvYWRQcm9taXNlID0gZXhwb3J0cy5zZXRDb25maWcgPSBleHBvcnRzLmdldENvbmZpZ0NoYW5nZXMgPSBleHBvcnRzLmxvYWRGcm9tTG9jYWxTdG9yYWdlID0gZXhwb3J0cy5yZXNldCA9IGV4cG9ydHMuYXBwbHkgPSBleHBvcnRzLnNldEJ1cnN0SGVhdG1hcCA9IGV4cG9ydHMuc2V0TW9ua2V5UG93ZXJMZXZlbCA9IGV4cG9ydHMuc2V0Q3VzdG9tQmFja2dyb3VuZEZpbHRlciA9IGV4cG9ydHMuc2V0Q3VzdG9tQmFja2dyb3VuZFNpemUgPSBleHBvcnRzLnNldEN1c3RvbUxheW91dGZsdWlkID0gZXhwb3J0cy5zZXRDdXN0b21CYWNrZ3JvdW5kID0gZXhwb3J0cy5zZXRGb250U2l6ZSA9IGV4cG9ydHMuc2V0TGF5b3V0ID0gZXhwb3J0cy5zZXRLZXltYXBMYXlvdXQgPSBleHBvcnRzLnNldEtleW1hcFN0eWxlID0gZXhwb3J0cy5zZXRLZXltYXBMZWdlbmRTdHlsZSA9IGV4cG9ydHMuc2V0S2V5bWFwTW9kZSA9IGV4cG9ydHMuc2V0TW9ua2V5ID0gZXhwb3J0cy5zZXRMYW5ndWFnZSA9IGV4cG9ydHMuc2V0Q3VzdG9tVGhlbWVDb2xvcnMgPSBleHBvcnRzLnNldExhenlNb2RlID0gZXhwb3J0cy5zZXRCcml0aXNoRW5nbGlzaCA9IGV4cG9ydHMuc2V0UmFuZG9tVGhlbWUgPSBleHBvcnRzLnNldFRoZW1lRGFyayA9IGV4cG9ydHMuc2V0VGhlbWVMaWdodCA9IGV4cG9ydHMuc2V0VGhlbWUgPSBleHBvcnRzLnNldEN1c3RvbVRoZW1lID0gZXhwb3J0cy5zZXRBdXRvU3dpdGNoVGhlbWUgPSBleHBvcnRzLnNldEluZGljYXRlVHlwb3MgPSBleHBvcnRzLnNldENvbmZpZGVuY2VNb2RlID0gZXhwb3J0cy5zZXRGcmVlZG9tTW9kZSA9IGV4cG9ydHMuc2V0Rm9udEZhbWlseSA9IGV4cG9ydHMucHJldmlld0ZvbnRGYW1pbHkgPSBleHBvcnRzLnNldFF1aWNrVGFiTW9kZSA9IGV4cG9ydHMuc2V0U21vb3RoTGluZVNjcm9sbCA9IGV4cG9ydHMuc2V0U3RhcnRHcmFwaHNBdFplcm8gPSBleHBvcnRzLnNldFNtb290aENhcmV0ID0gZXhwb3J0cy5zZXRXb3JkQ291bnQgPSBleHBvcnRzLnNldFF1b3RlTGVuZ3RoID0gZXhwb3J0cy5zZXRUaW1lQ29uZmlnID0gZXhwb3J0cy5zZXRLZXlUaXBzID0gZXhwb3J0cy5zZXRUaW1lck9wYWNpdHkgPSBleHBvcnRzLnNldFRpbWVyQ29sb3IgPSBleHBvcnRzLnNldFRpbWVyU3R5bGUgPSBleHBvcnRzLnNldEhpZGVFeHRyYUxldHRlcnMgPSBleHBvcnRzLnNldEhpZ2hsaWdodE1vZGUgPSBleHBvcnRzLnNldFNob3dBdmVyYWdlID0gZXhwb3J0cy5zZXRTaG93TGl2ZUJ1cnN0ID0gdm9pZCAwO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vZGJcIikpO1xuY29uc3QgT3V0T2ZGb2N1cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0L291dC1vZi1mb2N1c1wiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgY29uZmlnX3ZhbGlkYXRpb25fMSA9IHJlcXVpcmUoXCIuL2NvbmZpZy12YWxpZGF0aW9uXCIpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmNvbnN0IGRlZmF1bHRfY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vY29uc3RhbnRzL2RlZmF1bHQtY29uZmlnXCIpKTtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi9maXJlYmFzZVwiKTtcbmNvbnN0IEFuYWx5dGljc0NvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY29udHJvbGxlcnMvYW5hbHl0aWNzLWNvbnRyb2xsZXJcIikpO1xuZXhwb3J0cy5kYkNvbmZpZ0xvYWRlZCA9IGZhbHNlO1xuZXhwb3J0cy5jaGFuZ2VkQmVmb3JlRGIgPSBmYWxzZTtcbmZ1bmN0aW9uIHNldExvY2FsU3RvcmFnZUNvbmZpZyh2YWwpIHtcbiAgICBleHBvcnRzLmxvY2FsU3RvcmFnZUNvbmZpZyA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0TG9jYWxTdG9yYWdlQ29uZmlnID0gc2V0TG9jYWxTdG9yYWdlQ29uZmlnO1xuZnVuY3Rpb24gc2V0RGJDb25maWdMb2FkZWQodmFsKSB7XG4gICAgZXhwb3J0cy5kYkNvbmZpZ0xvYWRlZCA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0RGJDb25maWdMb2FkZWQgPSBzZXREYkNvbmZpZ0xvYWRlZDtcbmZ1bmN0aW9uIHNldENoYW5nZWRCZWZvcmVEYih2YWwpIHtcbiAgICBleHBvcnRzLmNoYW5nZWRCZWZvcmVEYiA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0Q2hhbmdlZEJlZm9yZURiID0gc2V0Q2hhbmdlZEJlZm9yZURiO1xubGV0IGxvYWREb25lO1xubGV0IGNvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRfY29uZmlnXzEuZGVmYXVsdCk7XG5mdW5jdGlvbiBzYXZlVG9Mb2NhbFN0b3JhZ2Uoa2V5LCBub3NhdmUgPSBmYWxzZSwgbm9EYkNoZWNrID0gZmFsc2UpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoIWV4cG9ydHMuZGJDb25maWdMb2FkZWQgJiYgIW5vRGJDaGVjayAmJiAhbm9zYXZlKSB7XG4gICAgICAgICAgICBzZXRDaGFuZ2VkQmVmb3JlRGIodHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vc2F2ZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgbG9jYWxUb1NhdmUgPSBjb25maWc7XG4gICAgICAgIGRlbGV0ZSBsb2NhbFRvU2F2ZS5yZXN1bHRGaWx0ZXJzO1xuICAgICAgICBjb25zdCBsb2NhbFRvU2F2ZVN0cmluZ2lmaWVkID0gSlNPTi5zdHJpbmdpZnkobG9jYWxUb1NhdmUpO1xuICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJjb25maWdcIiwgbG9jYWxUb1NhdmVTdHJpbmdpZmllZCk7XG4gICAgICAgIGlmICghbm9EYkNoZWNrKSB7XG4gICAgICAgICAgICAvLyBhd2FpdCBEQi5zYXZlQ29uZmlnKGRiVG9TYXZlKTtcbiAgICAgICAgICAgIHlpZWxkIHNhdmVUb0RhdGFiYXNlKGtleSk7XG4gICAgICAgIH1cbiAgICAgICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzYXZlVG9Mb2NhbFN0b3JhZ2VcIiwgbG9jYWxUb1NhdmVTdHJpbmdpZmllZCk7XG4gICAgfSk7XG59XG5sZXQgY29uZmlnVG9TZW5kID0ge307XG5sZXQgc2F2ZVRpbWVvdXQgPSBudWxsO1xuZnVuY3Rpb24gc2F2ZVRvRGF0YWJhc2Uoa2V5KSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uZmlnVG9TZW5kW2tleV0gPSBjb25maWdba2V5XTtcbiAgICAgICAgaWYgKHNhdmVUaW1lb3V0ID09PSBudWxsKSB7XG4gICAgICAgICAgICBzYXZlVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBjb25maWdUb1NlbmQucmVzdWx0RmlsdGVycztcbiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoY29uZmlnVG9TZW5kKS5sZW5ndGggPiAwKVxuICAgICAgICAgICAgICAgICAgICBEQi5zYXZlQ29uZmlnKGNvbmZpZ1RvU2VuZCk7XG4gICAgICAgICAgICAgICAgY29uZmlnVG9TZW5kID0ge307XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHNhdmVUaW1lb3V0KTtcbiAgICAgICAgICAgICAgICBzYXZlVGltZW91dCA9IG51bGw7XG4gICAgICAgICAgICB9KSwgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lID09PSBcImxvY2FsaG9zdFwiID8gMCA6IDEwMDApO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5mdW5jdGlvbiBzYXZlRnVsbENvbmZpZ1RvTG9jYWxTdG9yYWdlKG5vRGJDaGVjayA9IGZhbHNlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCFleHBvcnRzLmRiQ29uZmlnTG9hZGVkICYmICFub0RiQ2hlY2spIHtcbiAgICAgICAgICAgIHNldENoYW5nZWRCZWZvcmVEYih0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzYXZlID0gY29uZmlnO1xuICAgICAgICBkZWxldGUgc2F2ZS5yZXN1bHRGaWx0ZXJzO1xuICAgICAgICBjb25zdCBzdHJpbmdpZmllZCA9IEpTT04uc3RyaW5naWZ5KHNhdmUpO1xuICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJjb25maWdcIiwgc3RyaW5naWZpZWQpO1xuICAgICAgICBpZiAoIW5vRGJDaGVjaylcbiAgICAgICAgICAgIHlpZWxkIERCLnNhdmVDb25maWcoc2F2ZSk7XG4gICAgICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic2F2ZVRvTG9jYWxTdG9yYWdlXCIsIHN0cmluZ2lmaWVkKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc2F2ZUZ1bGxDb25maWdUb0xvY2FsU3RvcmFnZSA9IHNhdmVGdWxsQ29uZmlnVG9Mb2NhbFN0b3JhZ2U7XG4vL251bWJlcnNcbmZ1bmN0aW9uIHNldE51bWJlcnMobnVtYiwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwibnVtYmVyc1wiLCBudW1iLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChjb25maWcubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgIG51bWIgPSBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLm51bWJlcnMgPSBudW1iO1xuICAgIGlmICghY29uZmlnLm51bWJlcnMpIHtcbiAgICAgICAgJChcIiN0b3AgLmNvbmZpZyAubnVtYmVyc01vZGUgLnRleHQtYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiN0b3AgLmNvbmZpZyAubnVtYmVyc01vZGUgLnRleHQtYnV0dG9uXCIpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgIH1cbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJudW1iZXJzXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJudW1iZXJzXCIsIGNvbmZpZy5udW1iZXJzKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0TnVtYmVycyA9IHNldE51bWJlcnM7XG4vL3B1bmN0dWF0aW9uXG5mdW5jdGlvbiBzZXRQdW5jdHVhdGlvbihwdW5jLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJwdW5jdHVhdGlvblwiLCBwdW5jLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChjb25maWcubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgIHB1bmMgPSBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnB1bmN0dWF0aW9uID0gcHVuYztcbiAgICBpZiAoIWNvbmZpZy5wdW5jdHVhdGlvbikge1xuICAgICAgICAkKFwiI3RvcCAuY29uZmlnIC5wdW5jdHVhdGlvbk1vZGUgLnRleHQtYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiN0b3AgLmNvbmZpZyAucHVuY3R1YXRpb25Nb2RlIC50ZXh0LWJ1dHRvblwiKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICB9XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwicHVuY3R1YXRpb25cIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInB1bmN0dWF0aW9uXCIsIGNvbmZpZy5wdW5jdHVhdGlvbik7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFB1bmN0dWF0aW9uID0gc2V0UHVuY3R1YXRpb247XG5mdW5jdGlvbiBzZXRNb2RlKG1vZGUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcIm1vZGVcIiwgbW9kZSwgW1xuICAgICAgICBbXCJ0aW1lXCIsIFwid29yZHNcIiwgXCJxdW90ZVwiLCBcInplblwiLCBcImN1c3RvbVwiXSxcbiAgICBdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChtb2RlICE9PSBcIndvcmRzXCIgJiYgY29uZmlnLmZ1bmJveCA9PT0gXCJtZW1vcnlcIikge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIk1lbW9yeSBmdW5ib3ggY2FuIG9ubHkgYmUgdXNlZCB3aXRoIHdvcmRzIG1vZGUuXCIsIDApO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IHByZXZpb3VzID0gY29uZmlnLm1vZGU7XG4gICAgY29uZmlnLm1vZGUgPSBtb2RlO1xuICAgIGlmIChjb25maWcubW9kZSA9PSBcImN1c3RvbVwiKSB7XG4gICAgICAgIHNldFB1bmN0dWF0aW9uKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgc2V0TnVtYmVycyhmYWxzZSwgdHJ1ZSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZy5tb2RlID09IFwicXVvdGVcIikge1xuICAgICAgICBzZXRQdW5jdHVhdGlvbihmYWxzZSwgdHJ1ZSk7XG4gICAgICAgIHNldE51bWJlcnMoZmFsc2UsIHRydWUpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWcubW9kZSA9PSBcInplblwiKSB7XG4gICAgICAgIGlmIChjb25maWcucGFjZUNhcmV0ICE9IFwib2ZmXCIpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGBQYWNlIGNhcmV0IHdpbGwgbm90IHdvcmsgd2l0aCB6ZW4gbW9kZS5gLCAwKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJtb2RlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJtb2RlXCIsIGNvbmZpZy5tb2RlLCBub3NhdmUsIHByZXZpb3VzKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0TW9kZSA9IHNldE1vZGU7XG5mdW5jdGlvbiBzZXRQbGF5U291bmRPbkVycm9yKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwicGxheSBzb3VuZCBvbiBlcnJvclwiLCB2YWwsIFtcImJvb2xlYW5cIl0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnBsYXlTb3VuZE9uRXJyb3IgPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwicGxheVNvdW5kT25FcnJvclwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwicGxheVNvdW5kT25FcnJvclwiLCBjb25maWcucGxheVNvdW5kT25FcnJvcik7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFBsYXlTb3VuZE9uRXJyb3IgPSBzZXRQbGF5U291bmRPbkVycm9yO1xuZnVuY3Rpb24gc2V0UGxheVNvdW5kT25DbGljayh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInBsYXkgc291bmQgb24gY2xpY2tcIiwgdmFsLCBbXG4gICAgICAgIFtcIm9mZlwiLCBcIjFcIiwgXCIyXCIsIFwiM1wiLCBcIjRcIiwgXCI1XCIsIFwiNlwiLCBcIjdcIl0sXG4gICAgXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcucGxheVNvdW5kT25DbGljayA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJwbGF5U291bmRPbkNsaWNrXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJwbGF5U291bmRPbkNsaWNrXCIsIGNvbmZpZy5wbGF5U291bmRPbkNsaWNrKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0UGxheVNvdW5kT25DbGljayA9IHNldFBsYXlTb3VuZE9uQ2xpY2s7XG5mdW5jdGlvbiBzZXRTb3VuZFZvbHVtZSh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInNvdW5kIHZvbHVtZVwiLCB2YWwsIFtbXCIwLjFcIiwgXCIwLjVcIiwgXCIxLjBcIl1dKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5zb3VuZFZvbHVtZSA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJzb3VuZFZvbHVtZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic291bmRWb2x1bWVcIiwgY29uZmlnLnNvdW5kVm9sdW1lKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0U291bmRWb2x1bWUgPSBzZXRTb3VuZFZvbHVtZTtcbi8vZGlmZmljdWx0eVxuZnVuY3Rpb24gc2V0RGlmZmljdWx0eShkaWZmLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJkaWZmaWN1bHR5XCIsIGRpZmYsIFtbXCJub3JtYWxcIiwgXCJleHBlcnRcIiwgXCJtYXN0ZXJcIl1dKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5kaWZmaWN1bHR5ID0gZGlmZjtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJkaWZmaWN1bHR5XCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJkaWZmaWN1bHR5XCIsIGNvbmZpZy5kaWZmaWN1bHR5LCBub3NhdmUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXREaWZmaWN1bHR5ID0gc2V0RGlmZmljdWx0eTtcbi8vc2V0IGZhdiB0aGVtZXNcbmZ1bmN0aW9uIHNldEZhdlRoZW1lcyh0aGVtZXMsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImZhdm9yaXRlIHRoZW1lc1wiLCB0aGVtZXMsIFtcInN0cmluZ0FycmF5XCJdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5mYXZUaGVtZXMgPSB0aGVtZXM7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiZmF2VGhlbWVzXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJmYXZUaGVtZXNcIiwgY29uZmlnLmZhdlRoZW1lcyk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEZhdlRoZW1lcyA9IHNldEZhdlRoZW1lcztcbmZ1bmN0aW9uIHNldEZ1bmJveChmdW5ib3gsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImZ1bmJveFwiLCBmdW5ib3gsIFtcInN0cmluZ1wiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25zdCB2YWwgPSBmdW5ib3ggPyBmdW5ib3ggOiBcIm5vbmVcIjtcbiAgICBjb25maWcuZnVuYm94ID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImZ1bmJveFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiZnVuYm94XCIsIGNvbmZpZy5mdW5ib3gpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRGdW5ib3ggPSBzZXRGdW5ib3g7XG5mdW5jdGlvbiBzZXRCbGluZE1vZGUoYmxpbmQsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImJsaW5kIG1vZGVcIiwgYmxpbmQsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLmJsaW5kTW9kZSA9IGJsaW5kO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImJsaW5kTW9kZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiYmxpbmRNb2RlXCIsIGNvbmZpZy5ibGluZE1vZGUsIG5vc2F2ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEJsaW5kTW9kZSA9IHNldEJsaW5kTW9kZTtcbmZ1bmN0aW9uIHNldENoYXJ0QWNjdXJhY3koY2hhcnRBY2N1cmFjeSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiY2hhcnQgYWNjdXJhY3lcIiwgY2hhcnRBY2N1cmFjeSwgW1wiYm9vbGVhblwiXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuY2hhcnRBY2N1cmFjeSA9IGNoYXJ0QWNjdXJhY3k7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiY2hhcnRBY2N1cmFjeVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiY2hhcnRBY2N1cmFjeVwiLCBjb25maWcuY2hhcnRBY2N1cmFjeSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldENoYXJ0QWNjdXJhY3kgPSBzZXRDaGFydEFjY3VyYWN5O1xuZnVuY3Rpb24gc2V0Q2hhcnRTdHlsZShjaGFydFN0eWxlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJjaGFydCBzdHlsZVwiLCBjaGFydFN0eWxlLCBbW1wibGluZVwiLCBcInNjYXR0ZXJcIl1dKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5jaGFydFN0eWxlID0gY2hhcnRTdHlsZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJjaGFydFN0eWxlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJjaGFydFN0eWxlXCIsIGNvbmZpZy5jaGFydFN0eWxlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0Q2hhcnRTdHlsZSA9IHNldENoYXJ0U3R5bGU7XG5mdW5jdGlvbiBzZXRTdG9wT25FcnJvcihzb2UsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInN0b3Agb24gZXJyb3JcIiwgc29lLCBbW1wib2ZmXCIsIFwid29yZFwiLCBcImxldHRlclwiXV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnN0b3BPbkVycm9yID0gc29lO1xuICAgIGlmIChjb25maWcuc3RvcE9uRXJyb3IgIT09IFwib2ZmXCIpIHtcbiAgICAgICAgY29uZmlnLmNvbmZpZGVuY2VNb2RlID0gXCJvZmZcIjtcbiAgICB9XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwic3RvcE9uRXJyb3JcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInN0b3BPbkVycm9yXCIsIGNvbmZpZy5zdG9wT25FcnJvciwgbm9zYXZlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0U3RvcE9uRXJyb3IgPSBzZXRTdG9wT25FcnJvcjtcbmZ1bmN0aW9uIHNldEFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiYWx3YXlzIHNob3cgZGVjaW1hbCBwbGFjZXNcIiwgdmFsLCBbXCJib29sZWFuXCJdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5hbHdheXNTaG93RGVjaW1hbFBsYWNlcyA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJhbHdheXNTaG93RGVjaW1hbFBsYWNlc1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiYWx3YXlzU2hvd0RlY2ltYWxQbGFjZXNcIiwgY29uZmlnLmFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0QWx3YXlzU2hvd0RlY2ltYWxQbGFjZXMgPSBzZXRBbHdheXNTaG93RGVjaW1hbFBsYWNlcztcbmZ1bmN0aW9uIHNldEFsd2F5c1Nob3dDUE0odmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJhbHdheXMgc2hvdyBDUE1cIiwgdmFsLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5hbHdheXNTaG93Q1BNID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImFsd2F5c1Nob3dDUE1cIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImFsd2F5c1Nob3dDUE1cIiwgY29uZmlnLmFsd2F5c1Nob3dDUE0pO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRBbHdheXNTaG93Q1BNID0gc2V0QWx3YXlzU2hvd0NQTTtcbmZ1bmN0aW9uIHNldFNob3dPdXRPZkZvY3VzV2FybmluZyh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInNob3cgb3V0IG9mIGZvY3VzIHdhcm5pbmdcIiwgdmFsLCBbXCJib29sZWFuXCJdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5zaG93T3V0T2ZGb2N1c1dhcm5pbmcgPSB2YWw7XG4gICAgaWYgKCFjb25maWcuc2hvd091dE9mRm9jdXNXYXJuaW5nKSB7XG4gICAgICAgIE91dE9mRm9jdXMuaGlkZSgpO1xuICAgIH1cbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJzaG93T3V0T2ZGb2N1c1dhcm5pbmdcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInNob3dPdXRPZkZvY3VzV2FybmluZ1wiLCBjb25maWcuc2hvd091dE9mRm9jdXNXYXJuaW5nKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0U2hvd091dE9mRm9jdXNXYXJuaW5nID0gc2V0U2hvd091dE9mRm9jdXNXYXJuaW5nO1xuZnVuY3Rpb24gc2V0U3dhcEVzY0FuZFRhYih2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInN3YXAgZXNjIGFuZCB0YWJcIiwgdmFsLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5zd2FwRXNjQW5kVGFiID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInN3YXBFc2NBbmRUYWJcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInN3YXBFc2NBbmRUYWJcIiwgY29uZmlnLnN3YXBFc2NBbmRUYWIpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRTd2FwRXNjQW5kVGFiID0gc2V0U3dhcEVzY0FuZFRhYjtcbi8vcGFjZSBjYXJldFxuZnVuY3Rpb24gc2V0UGFjZUNhcmV0KHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwicGFjZSBjYXJldFwiLCB2YWwsIFtbXCJjdXN0b21cIiwgXCJvZmZcIiwgXCJhdmVyYWdlXCIsIFwicGJcIl1dKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSBcImNvbXBsZXRlXCIpIHtcbiAgICAgICAgaWYgKHZhbCA9PSBcInBiXCIgJiYgZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyID09PSBudWxsKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlBCIHBhY2UgY2FyZXQgaXMgdW5hdmFpbGFibGUgd2l0aG91dCBhbiBhY2NvdW50XCIsIDApO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIGlmIChjb25maWcubW9kZSA9PT0gXCJ6ZW5cIiAmJiB2YWwgIT0gXCJvZmZcIikge1xuICAgIC8vICAgTm90aWZpY2F0aW9ucy5hZGQoYENhbid0IHVzZSBwYWNlIGNhcmV0IHdpdGggemVuIG1vZGUuYCwgMCk7XG4gICAgLy8gICB2YWwgPSBcIm9mZlwiO1xuICAgIC8vIH1cbiAgICBjb25maWcucGFjZUNhcmV0ID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInBhY2VDYXJldFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwicGFjZUNhcmV0XCIsIGNvbmZpZy5wYWNlQ2FyZXQsIG5vc2F2ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFBhY2VDYXJldCA9IHNldFBhY2VDYXJldDtcbmZ1bmN0aW9uIHNldFBhY2VDYXJldEN1c3RvbVNwZWVkKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwicGFjZSBjYXJldCBjdXN0b20gc3BlZWRcIiwgdmFsLCBbXCJudW1iZXJcIl0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnBhY2VDYXJldEN1c3RvbVNwZWVkID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInBhY2VDYXJldEN1c3RvbVNwZWVkXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJwYWNlQ2FyZXRDdXN0b21TcGVlZFwiLCBjb25maWcucGFjZUNhcmV0Q3VzdG9tU3BlZWQpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRQYWNlQ2FyZXRDdXN0b21TcGVlZCA9IHNldFBhY2VDYXJldEN1c3RvbVNwZWVkO1xuZnVuY3Rpb24gc2V0UmVwZWF0ZWRQYWNlKHBhY2UsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInJlcGVhdGVkIHBhY2VcIiwgcGFjZSwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcucmVwZWF0ZWRQYWNlID0gcGFjZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJyZXBlYXRlZFBhY2VcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInJlcGVhdGVkUGFjZVwiLCBjb25maWcucmVwZWF0ZWRQYWNlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0UmVwZWF0ZWRQYWNlID0gc2V0UmVwZWF0ZWRQYWNlO1xuLy9taW4gd3BtXG5mdW5jdGlvbiBzZXRNaW5XcG0obWlud3BtLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJtaW4gV1BNXCIsIG1pbndwbSwgW1tcIm9mZlwiLCBcImN1c3RvbVwiXV0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLm1pbldwbSA9IG1pbndwbTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJtaW5XcG1cIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcIm1pbldwbVwiLCBjb25maWcubWluV3BtLCBub3NhdmUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRNaW5XcG0gPSBzZXRNaW5XcG07XG5mdW5jdGlvbiBzZXRNaW5XcG1DdXN0b21TcGVlZCh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcIm1pbiBXUE0gY3VzdG9tIHNwZWVkXCIsIHZhbCwgW1wibnVtYmVyXCJdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5taW5XcG1DdXN0b21TcGVlZCA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJtaW5XcG1DdXN0b21TcGVlZFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwibWluV3BtQ3VzdG9tU3BlZWRcIiwgY29uZmlnLm1pbldwbUN1c3RvbVNwZWVkKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0TWluV3BtQ3VzdG9tU3BlZWQgPSBzZXRNaW5XcG1DdXN0b21TcGVlZDtcbi8vbWluIGFjY1xuZnVuY3Rpb24gc2V0TWluQWNjKG1pbiwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwibWluIGFjY1wiLCBtaW4sIFtbXCJvZmZcIiwgXCJjdXN0b21cIl1dKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5taW5BY2MgPSBtaW47XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwibWluQWNjXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJtaW5BY2NcIiwgY29uZmlnLm1pbkFjYywgbm9zYXZlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0TWluQWNjID0gc2V0TWluQWNjO1xuZnVuY3Rpb24gc2V0TWluQWNjQ3VzdG9tKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwibWluIGFjYyBjdXN0b21cIiwgdmFsLCBbXCJudW1iZXJcIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLm1pbkFjY0N1c3RvbSA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJtaW5BY2NDdXN0b21cIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcIm1pbkFjY0N1c3RvbVwiLCBjb25maWcubWluQWNjQ3VzdG9tKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0TWluQWNjQ3VzdG9tID0gc2V0TWluQWNjQ3VzdG9tO1xuLy9taW4gYnVyc3RcbmZ1bmN0aW9uIHNldE1pbkJ1cnN0KG1pbiwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwibWluIGJ1cnN0XCIsIG1pbiwgW1tcIm9mZlwiLCBcImZpeGVkXCIsIFwiZmxleFwiXV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLm1pbkJ1cnN0ID0gbWluO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcIm1pbkJ1cnN0XCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJtaW5CdXJzdFwiLCBjb25maWcubWluQnVyc3QsIG5vc2F2ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldE1pbkJ1cnN0ID0gc2V0TWluQnVyc3Q7XG5mdW5jdGlvbiBzZXRNaW5CdXJzdEN1c3RvbVNwZWVkKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwibWluIGJ1cnN0IGN1c3RvbSBzcGVlZFwiLCB2YWwsIFtcIm51bWJlclwiXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcubWluQnVyc3RDdXN0b21TcGVlZCA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJtaW5CdXJzdEN1c3RvbVNwZWVkXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJtaW5CdXJzdEN1c3RvbVNwZWVkXCIsIGNvbmZpZy5taW5CdXJzdEN1c3RvbVNwZWVkKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0TWluQnVyc3RDdXN0b21TcGVlZCA9IHNldE1pbkJ1cnN0Q3VzdG9tU3BlZWQ7XG4vL2Fsd2F5cyBzaG93IHdvcmRzIGhpc3RvcnlcbmZ1bmN0aW9uIHNldEFsd2F5c1Nob3dXb3Jkc0hpc3RvcnkodmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJhbHdheXMgc2hvdyB3b3JkcyBoaXN0b3J5XCIsIHZhbCwgW1wiYm9vbGVhblwiXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuYWx3YXlzU2hvd1dvcmRzSGlzdG9yeSA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJhbHdheXNTaG93V29yZHNIaXN0b3J5XCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJhbHdheXNTaG93V29yZHNIaXN0b3J5XCIsIGNvbmZpZy5hbHdheXNTaG93V29yZHNIaXN0b3J5KTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0QWx3YXlzU2hvd1dvcmRzSGlzdG9yeSA9IHNldEFsd2F5c1Nob3dXb3Jkc0hpc3Rvcnk7XG4vL3NpbmdsZSBsaXN0IGNvbW1hbmQgbGluZVxuZnVuY3Rpb24gc2V0U2luZ2xlTGlzdENvbW1hbmRMaW5lKG9wdGlvbiwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwic2luZ2xlIGxpc3QgY29tbWFuZCBsaW5lXCIsIG9wdGlvbiwgW1tcIm1hbnVhbFwiLCBcIm9uXCJdXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuc2luZ2xlTGlzdENvbW1hbmRMaW5lID0gb3B0aW9uO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInNpbmdsZUxpc3RDb21tYW5kTGluZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic2luZ2xlTGlzdENvbW1hbmRMaW5lXCIsIGNvbmZpZy5zaW5nbGVMaXN0Q29tbWFuZExpbmUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRTaW5nbGVMaXN0Q29tbWFuZExpbmUgPSBzZXRTaW5nbGVMaXN0Q29tbWFuZExpbmU7XG4vL2NhcHMgbG9jayB3YXJuaW5nXG5mdW5jdGlvbiBzZXRDYXBzTG9ja1dhcm5pbmcodmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJjYXBzIGxvY2sgd2FybmluZ1wiLCB2YWwsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLmNhcHNMb2NrV2FybmluZyA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJjYXBzTG9ja1dhcm5pbmdcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImNhcHNMb2NrV2FybmluZ1wiLCBjb25maWcuY2Fwc0xvY2tXYXJuaW5nKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0Q2Fwc0xvY2tXYXJuaW5nID0gc2V0Q2Fwc0xvY2tXYXJuaW5nO1xuZnVuY3Rpb24gc2V0U2hvd0FsbExpbmVzKHNhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwic2hvdyBhbGwgbGluZXNcIiwgc2FsLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5zaG93QWxsTGluZXMgPSBzYWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwic2hvd0FsbExpbmVzXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzaG93QWxsTGluZXNcIiwgY29uZmlnLnNob3dBbGxMaW5lcywgbm9zYXZlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0U2hvd0FsbExpbmVzID0gc2V0U2hvd0FsbExpbmVzO1xuZnVuY3Rpb24gc2V0UXVpY2tFbmQocWUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInF1aWNrIGVuZFwiLCBxZSwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcucXVpY2tFbmQgPSBxZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJxdWlja0VuZFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwicXVpY2tFbmRcIiwgY29uZmlnLnF1aWNrRW5kKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0UXVpY2tFbmQgPSBzZXRRdWlja0VuZDtcbmZ1bmN0aW9uIHNldEVuYWJsZUFkcyh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImVuYWJsZSBhZHNcIiwgdmFsLCBbW1wib25cIiwgXCJvZmZcIiwgXCJtYXhcIl1dKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5lbmFibGVBZHMgPSB2YWw7XG4gICAgaWYgKCFub3NhdmUpIHtcbiAgICAgICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiZW5hYmxlQWRzXCIsIG5vc2F2ZSk7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgIH0sIDMwMDApO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkFkIHNldHRpbmdzIGNoYW5nZWQuIFJlZnJlc2hpbmcuLi5cIiwgMCk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRFbmFibGVBZHMgPSBzZXRFbmFibGVBZHM7XG5mdW5jdGlvbiBzZXRSZXBlYXRRdW90ZXModmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJyZXBlYXQgcXVvdGVzXCIsIHZhbCwgW1tcIm9mZlwiLCBcInR5cGluZ1wiXV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnJlcGVhdFF1b3RlcyA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJyZXBlYXRRdW90ZXNcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInJlcGVhdFF1b3Rlc1wiLCBjb25maWcucmVwZWF0UXVvdGVzKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0UmVwZWF0UXVvdGVzID0gc2V0UmVwZWF0UXVvdGVzO1xuLy9mbGlwIGNvbG9yc1xuZnVuY3Rpb24gc2V0RmxpcFRlc3RDb2xvcnMoZmxpcCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiZmxpcCB0ZXN0IGNvbG9yc1wiLCBmbGlwLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5mbGlwVGVzdENvbG9ycyA9IGZsaXA7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiZmxpcFRlc3RDb2xvcnNcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImZsaXBUZXN0Q29sb3JzXCIsIGNvbmZpZy5mbGlwVGVzdENvbG9ycyk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEZsaXBUZXN0Q29sb3JzID0gc2V0RmxpcFRlc3RDb2xvcnM7XG4vL2V4dHJhIGNvbG9yXG5mdW5jdGlvbiBzZXRDb2xvcmZ1bE1vZGUoZXh0cmEsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImNvbG9yZnVsIG1vZGVcIiwgZXh0cmEsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLmNvbG9yZnVsTW9kZSA9IGV4dHJhO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImNvbG9yZnVsTW9kZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiY29sb3JmdWxNb2RlXCIsIGNvbmZpZy5jb2xvcmZ1bE1vZGUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRDb2xvcmZ1bE1vZGUgPSBzZXRDb2xvcmZ1bE1vZGU7XG4vL3N0cmljdCBzcGFjZVxuZnVuY3Rpb24gc2V0U3RyaWN0U3BhY2UodmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJzdHJpY3Qgc3BhY2VcIiwgdmFsLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5zdHJpY3RTcGFjZSA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJzdHJpY3RTcGFjZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic3RyaWN0U3BhY2VcIiwgY29uZmlnLnN0cmljdFNwYWNlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0U3RyaWN0U3BhY2UgPSBzZXRTdHJpY3RTcGFjZTtcbi8vb3Bwb3NpdGUgc2hpZnQgc3BhY2VcbmZ1bmN0aW9uIHNldE9wcG9zaXRlU2hpZnRNb2RlKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwib3Bwb3NpdGUgc2hpZnQgbW9kZVwiLCB2YWwsIFtbXCJvZmZcIiwgXCJvblwiLCBcImtleW1hcFwiXV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLm9wcG9zaXRlU2hpZnRNb2RlID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcIm9wcG9zaXRlU2hpZnRNb2RlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJvcHBvc2l0ZVNoaWZ0TW9kZVwiLCBjb25maWcub3Bwb3NpdGVTaGlmdE1vZGUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRPcHBvc2l0ZVNoaWZ0TW9kZSA9IHNldE9wcG9zaXRlU2hpZnRNb2RlO1xuZnVuY3Rpb24gc2V0UGFnZVdpZHRoKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwicGFnZSB3aWR0aFwiLCB2YWwsIFtcbiAgICAgICAgW1wibWF4XCIsIFwiMTAwXCIsIFwiMTI1XCIsIFwiMTUwXCIsIFwiMjAwXCJdLFxuICAgIF0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnBhZ2VXaWR0aCA9IHZhbDtcbiAgICAkKFwiI2NlbnRlckNvbnRlbnRcIikucmVtb3ZlQ2xhc3MoXCJ3aWRlMTI1XCIpO1xuICAgICQoXCIjY2VudGVyQ29udGVudFwiKS5yZW1vdmVDbGFzcyhcIndpZGUxNTBcIik7XG4gICAgJChcIiNjZW50ZXJDb250ZW50XCIpLnJlbW92ZUNsYXNzKFwid2lkZTIwMFwiKTtcbiAgICAkKFwiI2NlbnRlckNvbnRlbnRcIikucmVtb3ZlQ2xhc3MoXCJ3aWRlbWF4XCIpO1xuICAgIGlmICh2YWwgIT09IFwiMTAwXCIpIHtcbiAgICAgICAgJChcIiNjZW50ZXJDb250ZW50XCIpLmFkZENsYXNzKFwid2lkZVwiICsgdmFsKTtcbiAgICB9XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwicGFnZVdpZHRoXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJwYWdlV2lkdGhcIiwgY29uZmlnLnBhZ2VXaWR0aCk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFBhZ2VXaWR0aCA9IHNldFBhZ2VXaWR0aDtcbmZ1bmN0aW9uIHNldENhcmV0U3R5bGUoY2FyZXRTdHlsZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiY2FyZXQgc3R5bGVcIiwgY2FyZXRTdHlsZSwgW1xuICAgICAgICBbXCJvZmZcIiwgXCJkZWZhdWx0XCIsIFwiYmxvY2tcIiwgXCJvdXRsaW5lXCIsIFwidW5kZXJsaW5lXCIsIFwiY2Fycm90XCIsIFwiYmFuYW5hXCJdLFxuICAgIF0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmNhcmV0U3R5bGUgPSBjYXJldFN0eWxlO1xuICAgICQoXCIjY2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJvZmZcIik7XG4gICAgJChcIiNjYXJldFwiKS5yZW1vdmVDbGFzcyhcImRlZmF1bHRcIik7XG4gICAgJChcIiNjYXJldFwiKS5yZW1vdmVDbGFzcyhcInVuZGVybGluZVwiKTtcbiAgICAkKFwiI2NhcmV0XCIpLnJlbW92ZUNsYXNzKFwib3V0bGluZVwiKTtcbiAgICAkKFwiI2NhcmV0XCIpLnJlbW92ZUNsYXNzKFwiYmxvY2tcIik7XG4gICAgJChcIiNjYXJldFwiKS5yZW1vdmVDbGFzcyhcImNhcnJvdFwiKTtcbiAgICAkKFwiI2NhcmV0XCIpLnJlbW92ZUNsYXNzKFwiYmFuYW5hXCIpO1xuICAgIGlmIChjYXJldFN0eWxlID09IFwib2ZmXCIpIHtcbiAgICAgICAgJChcIiNjYXJldFwiKS5hZGRDbGFzcyhcIm9mZlwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY2FyZXRTdHlsZSA9PSBcImRlZmF1bHRcIikge1xuICAgICAgICAkKFwiI2NhcmV0XCIpLmFkZENsYXNzKFwiZGVmYXVsdFwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY2FyZXRTdHlsZSA9PSBcImJsb2NrXCIpIHtcbiAgICAgICAgJChcIiNjYXJldFwiKS5hZGRDbGFzcyhcImJsb2NrXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjYXJldFN0eWxlID09IFwib3V0bGluZVwiKSB7XG4gICAgICAgICQoXCIjY2FyZXRcIikuYWRkQ2xhc3MoXCJvdXRsaW5lXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjYXJldFN0eWxlID09IFwidW5kZXJsaW5lXCIpIHtcbiAgICAgICAgJChcIiNjYXJldFwiKS5hZGRDbGFzcyhcInVuZGVybGluZVwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY2FyZXRTdHlsZSA9PSBcImNhcnJvdFwiKSB7XG4gICAgICAgICQoXCIjY2FyZXRcIikuYWRkQ2xhc3MoXCJjYXJyb3RcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNhcmV0U3R5bGUgPT0gXCJiYW5hbmFcIikge1xuICAgICAgICAkKFwiI2NhcmV0XCIpLmFkZENsYXNzKFwiYmFuYW5hXCIpO1xuICAgIH1cbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJjYXJldFN0eWxlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJjYXJldFN0eWxlXCIsIGNvbmZpZy5jYXJldFN0eWxlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0Q2FyZXRTdHlsZSA9IHNldENhcmV0U3R5bGU7XG5mdW5jdGlvbiBzZXRQYWNlQ2FyZXRTdHlsZShjYXJldFN0eWxlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJwYWNlIGNhcmV0IHN0eWxlXCIsIGNhcmV0U3R5bGUsIFtcbiAgICAgICAgW1wib2ZmXCIsIFwiZGVmYXVsdFwiLCBcImJsb2NrXCIsIFwib3V0bGluZVwiLCBcInVuZGVybGluZVwiLCBcImNhcnJvdFwiLCBcImJhbmFuYVwiXSxcbiAgICBdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5wYWNlQ2FyZXRTdHlsZSA9IGNhcmV0U3R5bGU7XG4gICAgJChcIiNwYWNlQ2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJvZmZcIik7XG4gICAgJChcIiNwYWNlQ2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJkZWZhdWx0XCIpO1xuICAgICQoXCIjcGFjZUNhcmV0XCIpLnJlbW92ZUNsYXNzKFwidW5kZXJsaW5lXCIpO1xuICAgICQoXCIjcGFjZUNhcmV0XCIpLnJlbW92ZUNsYXNzKFwib3V0bGluZVwiKTtcbiAgICAkKFwiI3BhY2VDYXJldFwiKS5yZW1vdmVDbGFzcyhcImJsb2NrXCIpO1xuICAgICQoXCIjcGFjZUNhcmV0XCIpLnJlbW92ZUNsYXNzKFwiY2Fycm90XCIpO1xuICAgICQoXCIjcGFjZUNhcmV0XCIpLnJlbW92ZUNsYXNzKFwiYmFuYW5hXCIpO1xuICAgIGlmIChjYXJldFN0eWxlID09IFwiZGVmYXVsdFwiKSB7XG4gICAgICAgICQoXCIjcGFjZUNhcmV0XCIpLmFkZENsYXNzKFwiZGVmYXVsdFwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY2FyZXRTdHlsZSA9PSBcImJsb2NrXCIpIHtcbiAgICAgICAgJChcIiNwYWNlQ2FyZXRcIikuYWRkQ2xhc3MoXCJibG9ja1wiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY2FyZXRTdHlsZSA9PSBcIm91dGxpbmVcIikge1xuICAgICAgICAkKFwiI3BhY2VDYXJldFwiKS5hZGRDbGFzcyhcIm91dGxpbmVcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNhcmV0U3R5bGUgPT0gXCJ1bmRlcmxpbmVcIikge1xuICAgICAgICAkKFwiI3BhY2VDYXJldFwiKS5hZGRDbGFzcyhcInVuZGVybGluZVwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY2FyZXRTdHlsZSA9PSBcImNhcnJvdFwiKSB7XG4gICAgICAgICQoXCIjcGFjZUNhcmV0XCIpLmFkZENsYXNzKFwiY2Fycm90XCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjYXJldFN0eWxlID09IFwiYmFuYW5hXCIpIHtcbiAgICAgICAgJChcIiNwYWNlQ2FyZXRcIikuYWRkQ2xhc3MoXCJiYW5hbmFcIik7XG4gICAgfVxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInBhY2VDYXJldFN0eWxlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJwYWNlQ2FyZXRTdHlsZVwiLCBjb25maWcucGFjZUNhcmV0U3R5bGUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRQYWNlQ2FyZXRTdHlsZSA9IHNldFBhY2VDYXJldFN0eWxlO1xuZnVuY3Rpb24gc2V0U2hvd1RpbWVyUHJvZ3Jlc3ModGltZXIsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInNob3cgdGltZXIgcHJvZ3Jlc3NcIiwgdGltZXIsIFtcImJvb2xlYW5cIl0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnNob3dUaW1lclByb2dyZXNzID0gdGltZXI7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwic2hvd1RpbWVyUHJvZ3Jlc3NcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInNob3dUaW1lclByb2dyZXNzXCIsIGNvbmZpZy5zaG93VGltZXJQcm9ncmVzcyk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFNob3dUaW1lclByb2dyZXNzID0gc2V0U2hvd1RpbWVyUHJvZ3Jlc3M7XG5mdW5jdGlvbiBzZXRTaG93TGl2ZVdwbShsaXZlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJzaG93IGxpdmUgV1BNXCIsIGxpdmUsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLnNob3dMaXZlV3BtID0gbGl2ZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJzaG93TGl2ZVdwbVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic2hvd0xpdmVXcG1cIiwgY29uZmlnLnNob3dMaXZlV3BtKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0U2hvd0xpdmVXcG0gPSBzZXRTaG93TGl2ZVdwbTtcbmZ1bmN0aW9uIHNldFNob3dMaXZlQWNjKGxpdmUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInNob3cgbGl2ZSBhY2NcIiwgbGl2ZSwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcuc2hvd0xpdmVBY2MgPSBsaXZlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInNob3dMaXZlQWNjXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzaG93TGl2ZUFjY1wiLCBjb25maWcuc2hvd0xpdmVBY2MpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRTaG93TGl2ZUFjYyA9IHNldFNob3dMaXZlQWNjO1xuZnVuY3Rpb24gc2V0U2hvd0xpdmVCdXJzdChsaXZlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJzaG93IGxpdmUgYnVyc3RcIiwgbGl2ZSwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcuc2hvd0xpdmVCdXJzdCA9IGxpdmU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwic2hvd0xpdmVCdXJzdFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic2hvd0xpdmVCdXJzdFwiLCBjb25maWcuc2hvd0xpdmVCdXJzdCk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFNob3dMaXZlQnVyc3QgPSBzZXRTaG93TGl2ZUJ1cnN0O1xuZnVuY3Rpb24gc2V0U2hvd0F2ZXJhZ2UodmFsdWUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInNob3cgYXZlcmFnZVwiLCB2YWx1ZSwgW1tcIm9mZlwiLCBcIndwbVwiLCBcImFjY1wiLCBcImJvdGhcIl1dKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5zaG93QXZlcmFnZSA9IHZhbHVlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInNob3dBdmVyYWdlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzaG93QXZlcmFnZVwiLCBjb25maWcuc2hvd0F2ZXJhZ2UsIG5vc2F2ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFNob3dBdmVyYWdlID0gc2V0U2hvd0F2ZXJhZ2U7XG5mdW5jdGlvbiBzZXRIaWdobGlnaHRNb2RlKG1vZGUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImhpZ2hsaWdodCBtb2RlXCIsIG1vZGUsIFtbXCJvZmZcIiwgXCJsZXR0ZXJcIiwgXCJ3b3JkXCJdXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAobW9kZSA9PT0gXCJ3b3JkXCIgJiZcbiAgICAgICAgKGNvbmZpZy5mdW5ib3ggPT09IFwibm9zcGFjZVwiIHx8XG4gICAgICAgICAgICBjb25maWcuZnVuYm94ID09PSBcInJlYWRfYWhlYWRcIiB8fFxuICAgICAgICAgICAgY29uZmlnLmZ1bmJveCA9PT0gXCJyZWFkX2FoZWFkX2Vhc3lcIiB8fFxuICAgICAgICAgICAgY29uZmlnLmZ1bmJveCA9PT0gXCJyZWFkX2FoZWFkX2hhcmRcIiB8fFxuICAgICAgICAgICAgY29uZmlnLmZ1bmJveCA9PT0gXCJ0dHNcIiB8fFxuICAgICAgICAgICAgY29uZmlnLmZ1bmJveCA9PT0gXCJhcnJvd3NcIikpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDYW4ndCB1c2Ugd29yZCBoaWdobGlnaHQgd2l0aCB0aGlzIGZ1bmJveFwiLCAwKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuaGlnaGxpZ2h0TW9kZSA9IG1vZGU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiaGlnaGxpZ2h0TW9kZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiaGlnaGxpZ2h0TW9kZVwiLCBjb25maWcuaGlnaGxpZ2h0TW9kZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEhpZ2hsaWdodE1vZGUgPSBzZXRIaWdobGlnaHRNb2RlO1xuZnVuY3Rpb24gc2V0SGlkZUV4dHJhTGV0dGVycyh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImhpZGUgZXh0cmEgbGV0dGVyc1wiLCB2YWwsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLmhpZGVFeHRyYUxldHRlcnMgPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiaGlkZUV4dHJhTGV0dGVyc1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiaGlkZUV4dHJhTGV0dGVyc1wiLCBjb25maWcuaGlkZUV4dHJhTGV0dGVycyk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEhpZGVFeHRyYUxldHRlcnMgPSBzZXRIaWRlRXh0cmFMZXR0ZXJzO1xuZnVuY3Rpb24gc2V0VGltZXJTdHlsZShzdHlsZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwidGltZXIgc3R5bGVcIiwgc3R5bGUsIFtbXCJiYXJcIiwgXCJ0ZXh0XCIsIFwibWluaVwiXV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnRpbWVyU3R5bGUgPSBzdHlsZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJ0aW1lclN0eWxlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJ0aW1lclN0eWxlXCIsIGNvbmZpZy50aW1lclN0eWxlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0VGltZXJTdHlsZSA9IHNldFRpbWVyU3R5bGU7XG5mdW5jdGlvbiBzZXRUaW1lckNvbG9yKGNvbG9yLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJ0aW1lciBjb2xvclwiLCBjb2xvciwgW1xuICAgICAgICBbXCJibGFja1wiLCBcInN1YlwiLCBcInRleHRcIiwgXCJtYWluXCJdLFxuICAgIF0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnRpbWVyQ29sb3IgPSBjb2xvcjtcbiAgICAkKFwiI3RpbWVyXCIpLnJlbW92ZUNsYXNzKFwidGltZXJTdWJcIik7XG4gICAgJChcIiN0aW1lclwiKS5yZW1vdmVDbGFzcyhcInRpbWVyVGV4dFwiKTtcbiAgICAkKFwiI3RpbWVyXCIpLnJlbW92ZUNsYXNzKFwidGltZXJNYWluXCIpO1xuICAgICQoXCIjdGltZXJOdW1iZXJcIikucmVtb3ZlQ2xhc3MoXCJ0aW1lclN1YlwiKTtcbiAgICAkKFwiI3RpbWVyTnVtYmVyXCIpLnJlbW92ZUNsYXNzKFwidGltZXJUZXh0XCIpO1xuICAgICQoXCIjdGltZXJOdW1iZXJcIikucmVtb3ZlQ2xhc3MoXCJ0aW1lck1haW5cIik7XG4gICAgJChcIiNsYXJnZUxpdmVXcG1BbmRBY2NcIikucmVtb3ZlQ2xhc3MoXCJ0aW1lclN1YlwiKTtcbiAgICAkKFwiI2xhcmdlTGl2ZVdwbUFuZEFjY1wiKS5yZW1vdmVDbGFzcyhcInRpbWVyVGV4dFwiKTtcbiAgICAkKFwiI2xhcmdlTGl2ZVdwbUFuZEFjY1wiKS5yZW1vdmVDbGFzcyhcInRpbWVyTWFpblwiKTtcbiAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG1cIikucmVtb3ZlQ2xhc3MoXCJ0aW1lclN1YlwiKTtcbiAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG1cIikucmVtb3ZlQ2xhc3MoXCJ0aW1lclRleHRcIik7XG4gICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtXCIpLnJlbW92ZUNsYXNzKFwidGltZXJNYWluXCIpO1xuICAgIGlmIChjb2xvciA9PT0gXCJtYWluXCIpIHtcbiAgICAgICAgJChcIiN0aW1lclwiKS5hZGRDbGFzcyhcInRpbWVyTWFpblwiKTtcbiAgICAgICAgJChcIiN0aW1lck51bWJlclwiKS5hZGRDbGFzcyhcInRpbWVyTWFpblwiKTtcbiAgICAgICAgJChcIiNsYXJnZUxpdmVXcG1BbmRBY2NcIikuYWRkQ2xhc3MoXCJ0aW1lck1haW5cIik7XG4gICAgICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbVwiKS5hZGRDbGFzcyhcInRpbWVyTWFpblwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29sb3IgPT09IFwic3ViXCIpIHtcbiAgICAgICAgJChcIiN0aW1lclwiKS5hZGRDbGFzcyhcInRpbWVyU3ViXCIpO1xuICAgICAgICAkKFwiI3RpbWVyTnVtYmVyXCIpLmFkZENsYXNzKFwidGltZXJTdWJcIik7XG4gICAgICAgICQoXCIjbGFyZ2VMaXZlV3BtQW5kQWNjXCIpLmFkZENsYXNzKFwidGltZXJTdWJcIik7XG4gICAgICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbVwiKS5hZGRDbGFzcyhcInRpbWVyU3ViXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb2xvciA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgJChcIiN0aW1lclwiKS5hZGRDbGFzcyhcInRpbWVyVGV4dFwiKTtcbiAgICAgICAgJChcIiN0aW1lck51bWJlclwiKS5hZGRDbGFzcyhcInRpbWVyVGV4dFwiKTtcbiAgICAgICAgJChcIiNsYXJnZUxpdmVXcG1BbmRBY2NcIikuYWRkQ2xhc3MoXCJ0aW1lclRleHRcIik7XG4gICAgICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbVwiKS5hZGRDbGFzcyhcInRpbWVyVGV4dFwiKTtcbiAgICB9XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwidGltZXJDb2xvclwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwidGltZXJDb2xvclwiLCBjb25maWcudGltZXJDb2xvcik7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFRpbWVyQ29sb3IgPSBzZXRUaW1lckNvbG9yO1xuZnVuY3Rpb24gc2V0VGltZXJPcGFjaXR5KG9wYWNpdHksIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInRpbWVyIG9wYWNpdHlcIiwgb3BhY2l0eSwgW1xuICAgICAgICBbXCIwLjI1XCIsIFwiMC41XCIsIFwiMC43NVwiLCBcIjFcIl0sXG4gICAgXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcudGltZXJPcGFjaXR5ID0gb3BhY2l0eTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJ0aW1lck9wYWNpdHlcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInRpbWVyT3BhY2l0eVwiLCBjb25maWcudGltZXJPcGFjaXR5KTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0VGltZXJPcGFjaXR5ID0gc2V0VGltZXJPcGFjaXR5O1xuLy9rZXkgdGlwc1xuZnVuY3Rpb24gc2V0S2V5VGlwcyhrZXlUaXBzLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJrZXkgdGlwc1wiLCBrZXlUaXBzLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5zaG93S2V5VGlwcyA9IGtleVRpcHM7XG4gICAgaWYgKGNvbmZpZy5zaG93S2V5VGlwcykge1xuICAgICAgICAkKFwiI2JvdHRvbSAua2V5VGlwc1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIjYm90dG9tIC5rZXlUaXBzXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJzaG93S2V5VGlwc1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic2hvd0tleVRpcHNcIiwgY29uZmlnLnNob3dLZXlUaXBzKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0S2V5VGlwcyA9IHNldEtleVRpcHM7XG4vL21vZGVcbmZ1bmN0aW9uIHNldFRpbWVDb25maWcodGltZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwidGltZVwiLCB0aW1lLCBbXCJudW1iZXJcIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uc3QgbmV3VGltZSA9IGlzTmFOKHRpbWUpIHx8IHRpbWUgPCAwID8gZGVmYXVsdF9jb25maWdfMS5kZWZhdWx0LnRpbWUgOiB0aW1lO1xuICAgICQoXCIjdG9wIC5jb25maWcgLnRpbWUgLnRleHQtYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgIGNvbnN0IHRpbWVDdXN0b20gPSAhWzE1LCAzMCwgNjAsIDEyMF0uaW5jbHVkZXMobmV3VGltZSkgPyBcImN1c3RvbVwiIDogbmV3VGltZTtcbiAgICBjb25maWcudGltZSA9IG5ld1RpbWU7XG4gICAgJChcIiN0b3AgLmNvbmZpZyAudGltZSAudGV4dC1idXR0b25bdGltZUNvbmZpZz0nXCIgKyB0aW1lQ3VzdG9tICsgXCInXVwiKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJ0aW1lXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJ0aW1lXCIsIGNvbmZpZy50aW1lKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0VGltZUNvbmZpZyA9IHNldFRpbWVDb25maWc7XG4vL3F1b3RlIGxlbmd0aFxuZnVuY3Rpb24gc2V0UXVvdGVMZW5ndGgobGVuLCBub3NhdmUsIG11bHRpcGxlTW9kZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInF1b3RlIGxlbmd0aFwiLCBsZW4sIFtcbiAgICAgICAgWy0yLCAtMSwgMCwgMSwgMiwgM10sXG4gICAgICAgIFwibnVtYmVyQXJyYXlcIixcbiAgICBdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChBcnJheS5pc0FycmF5KGxlbikpIHtcbiAgICAgICAgLy9jb25maWcgbG9hZFxuICAgICAgICBpZiAobGVuLmxlbmd0aCA9PT0gMSAmJiBsZW5bMF0gPT09IC0xKVxuICAgICAgICAgICAgbGVuID0gWzFdO1xuICAgICAgICBjb25maWcucXVvdGVMZW5ndGggPSBsZW47XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoY29uZmlnLnF1b3RlTGVuZ3RoKSlcbiAgICAgICAgICAgIGNvbmZpZy5xdW90ZUxlbmd0aCA9IFtdO1xuICAgICAgICBpZiAobGVuID09PSBudWxsIHx8IGlzTmFOKGxlbikgfHwgbGVuIDwgLTIgfHwgbGVuID4gMykge1xuICAgICAgICAgICAgbGVuID0gMTtcbiAgICAgICAgfVxuICAgICAgICBsZW4gPSBwYXJzZUludChsZW4udG9TdHJpbmcoKSk7XG4gICAgICAgIGlmIChtdWx0aXBsZU1vZGUpIHtcbiAgICAgICAgICAgIGlmICghY29uZmlnLnF1b3RlTGVuZ3RoLmluY2x1ZGVzKGxlbikpIHtcbiAgICAgICAgICAgICAgICBjb25maWcucXVvdGVMZW5ndGgucHVzaChsZW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5xdW90ZUxlbmd0aC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy5xdW90ZUxlbmd0aCA9IGNvbmZpZy5xdW90ZUxlbmd0aC5maWx0ZXIoKHFsKSA9PiBxbCAhPT0gbGVuKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25maWcucXVvdGVMZW5ndGggPSBbbGVuXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBpZiAoIW5vc2F2ZSkgc2V0TW9kZShcInF1b3RlXCIsIG5vc2F2ZSk7XG4gICAgJChcIiN0b3AgLmNvbmZpZyAucXVvdGVMZW5ndGggLnRleHQtYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgIGNvbmZpZy5xdW90ZUxlbmd0aC5mb3JFYWNoKChxbCkgPT4ge1xuICAgICAgICAkKFwiI3RvcCAuY29uZmlnIC5xdW90ZUxlbmd0aCAudGV4dC1idXR0b25bcXVvdGVMZW5ndGg9J1wiICsgcWwgKyBcIiddXCIpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgIH0pO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInF1b3RlTGVuZ3RoXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJxdW90ZUxlbmd0aFwiLCBjb25maWcucXVvdGVMZW5ndGgpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRRdW90ZUxlbmd0aCA9IHNldFF1b3RlTGVuZ3RoO1xuZnVuY3Rpb24gc2V0V29yZENvdW50KHdvcmRDb3VudCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwid29yZHNcIiwgd29yZENvdW50LCBbXCJudW1iZXJcIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uc3QgbmV3V29yZENvdW50ID0gd29yZENvdW50IDwgMCB8fCB3b3JkQ291bnQgPiAxMDAwMDAgPyBkZWZhdWx0X2NvbmZpZ18xLmRlZmF1bHQud29yZHMgOiB3b3JkQ291bnQ7XG4gICAgJChcIiN0b3AgLmNvbmZpZyAud29yZENvdW50IC50ZXh0LWJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICBjb25zdCB3b3JkQ3VzdG9tID0gIVsxMCwgMjUsIDUwLCAxMDAsIDIwMF0uaW5jbHVkZXMobmV3V29yZENvdW50KVxuICAgICAgICA/IFwiY3VzdG9tXCJcbiAgICAgICAgOiBuZXdXb3JkQ291bnQ7XG4gICAgY29uZmlnLndvcmRzID0gbmV3V29yZENvdW50O1xuICAgICQoXCIjdG9wIC5jb25maWcgLndvcmRDb3VudCAudGV4dC1idXR0b25bd29yZENvdW50PSdcIiArIHdvcmRDdXN0b20gKyBcIiddXCIpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcIndvcmRzXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJ3b3Jkc1wiLCBjb25maWcud29yZHMpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRXb3JkQ291bnQgPSBzZXRXb3JkQ291bnQ7XG4vL2NhcmV0XG5mdW5jdGlvbiBzZXRTbW9vdGhDYXJldChtb2RlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJzbW9vdGggY2FyZXRcIiwgbW9kZSwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcuc21vb3RoQ2FyZXQgPSBtb2RlO1xuICAgIGlmIChtb2RlKSB7XG4gICAgICAgICQoXCIjY2FyZXRcIikuY3NzKFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJjYXJldEZsYXNoU21vb3RoXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiNjYXJldFwiKS5jc3MoXCJhbmltYXRpb24tbmFtZVwiLCBcImNhcmV0Rmxhc2hIYXJkXCIpO1xuICAgIH1cbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJzbW9vdGhDYXJldFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic21vb3RoQ2FyZXRcIiwgY29uZmlnLnNtb290aENhcmV0KTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0U21vb3RoQ2FyZXQgPSBzZXRTbW9vdGhDYXJldDtcbmZ1bmN0aW9uIHNldFN0YXJ0R3JhcGhzQXRaZXJvKG1vZGUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInN0YXJ0IGdyYXBocyBhdCB6ZXJvXCIsIG1vZGUsIFtcImJvb2xlYW5cIl0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnN0YXJ0R3JhcGhzQXRaZXJvID0gbW9kZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJzdGFydEdyYXBoc0F0WmVyb1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic3RhcnRHcmFwaHNBdFplcm9cIiwgY29uZmlnLnN0YXJ0R3JhcGhzQXRaZXJvKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0U3RhcnRHcmFwaHNBdFplcm8gPSBzZXRTdGFydEdyYXBoc0F0WmVybztcbi8vbGluZXNjcm9sbFxuZnVuY3Rpb24gc2V0U21vb3RoTGluZVNjcm9sbChtb2RlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJzbW9vdGggbGluZSBzY3JvbGxcIiwgbW9kZSwgW1wiYm9vbGVhblwiXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuc21vb3RoTGluZVNjcm9sbCA9IG1vZGU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwic21vb3RoTGluZVNjcm9sbFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic21vb3RoTGluZVNjcm9sbFwiLCBjb25maWcuc21vb3RoTGluZVNjcm9sbCk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFNtb290aExpbmVTY3JvbGwgPSBzZXRTbW9vdGhMaW5lU2Nyb2xsO1xuLy9xdWljayB0YWJcbmZ1bmN0aW9uIHNldFF1aWNrVGFiTW9kZShtb2RlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJxdWljayB0YWIgbW9kZVwiLCBtb2RlLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5xdWlja1RhYiA9IG1vZGU7XG4gICAgaWYgKCFjb25maWcucXVpY2tUYWIpIHtcbiAgICAgICAgJChcIiNyZXN0YXJ0VGVzdEJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiNyZXN0YXJ0VGVzdEJ1dHRvblwiKS5jc3MoXCJvcGFjaXR5XCIsIDEpO1xuICAgICAgICAkKFwiI2JvdHRvbSAua2V5VGlwc1wiKVxuICAgICAgICAgICAgLmh0bWwoYDxrZXk+dGFiPC9rZXk+IGFuZCA8a2V5PmVudGVyPC9rZXk+IC8gPGtleT5zcGFjZTwva2V5PiAtIHJlc3RhcnQgdGVzdDxicj5cbiAgICAgIDxrZXk+Y3RybC9jbWQ8L2tleT4rPGtleT5zaGlmdDwva2V5Pis8a2V5PnA8L2tleT4gb3IgPGtleT5lc2M8L2tleT4gLSBjb21tYW5kIGxpbmVgKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIjcmVzdGFydFRlc3RCdXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjYm90dG9tIC5rZXlUaXBzXCIpLmh0bWwoYDxrZXk+dGFiPC9rZXk+IC0gcmVzdGFydCB0ZXN0PGJyPlxuICAgIDxrZXk+Y3RybC9jbWQ8L2tleT4rPGtleT5zaGlmdDwva2V5Pis8a2V5PnA8L2tleT4gb3IgPGtleT5lc2M8L2tleT4gLSBjb21tYW5kIGxpbmVgKTtcbiAgICB9XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwicXVpY2tUYWJcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInF1aWNrVGFiXCIsIGNvbmZpZy5xdWlja1RhYik7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFF1aWNrVGFiTW9kZSA9IHNldFF1aWNrVGFiTW9kZTtcbmZ1bmN0aW9uIHByZXZpZXdGb250RmFtaWx5KGZvbnQpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJwcmV2aWV3IGZvbnQgZmFtaWx5XCIsIGZvbnQsIFtcInN0cmluZ1wiXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoXCItLWZvbnRcIiwgJ1wiJyArIGZvbnQucmVwbGFjZSgvXy9nLCBcIiBcIikgKyAnXCIsIFwiUm9ib3RvIE1vbm9cIicpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5wcmV2aWV3Rm9udEZhbWlseSA9IHByZXZpZXdGb250RmFtaWx5O1xuLy9mb250IGZhbWlseVxuZnVuY3Rpb24gc2V0Rm9udEZhbWlseShmb250LCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJmb250IGZhbWlseVwiLCBmb250LCBbXCJzdHJpbmdcIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgaWYgKGZvbnQgPT09IFwiXCIpIHtcbiAgICAgICAgZm9udCA9IFwicm9ib3RvX21vbm9cIjtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJFbXB0eSBpbnB1dCByZWNlaXZlZCwgcmV2ZXJ0ZWQgdG8gdGhlIGRlZmF1bHQgZm9udC5cIiwgMCwgMywgXCJDdXN0b20gZm9udFwiKTtcbiAgICB9XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ0tleVZhbGlkKShmb250KSkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgSW52YWxpZCBmb250IG5hbWUgdmFsdWU6IFwiJHtmb250fVwiLmAsIC0xLCAzLCBcIkN1c3RvbSBmb250XCIpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5mb250RmFtaWx5ID0gZm9udDtcbiAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoXCItLWZvbnRcIiwgYFwiJHtmb250LnJlcGxhY2UoL18vZywgXCIgXCIpfVwiLCBcIlJvYm90byBNb25vXCJgKTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJmb250RmFtaWx5XCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJmb250RmFtaWx5XCIsIGNvbmZpZy5mb250RmFtaWx5KTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0Rm9udEZhbWlseSA9IHNldEZvbnRGYW1pbHk7XG4vL2ZyZWVkb21cbmZ1bmN0aW9uIHNldEZyZWVkb21Nb2RlKGZyZWVkb20sIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImZyZWVkb20gbW9kZVwiLCBmcmVlZG9tLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChmcmVlZG9tID09IG51bGwpIHtcbiAgICAgICAgZnJlZWRvbSA9IGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuZnJlZWRvbU1vZGUgPSBmcmVlZG9tO1xuICAgIGlmIChjb25maWcuZnJlZWRvbU1vZGUgJiYgY29uZmlnLmNvbmZpZGVuY2VNb2RlICE9PSBcIm9mZlwiKSB7XG4gICAgICAgIGNvbmZpZy5jb25maWRlbmNlTW9kZSA9IFwib2ZmXCI7XG4gICAgfVxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImZyZWVkb21Nb2RlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJmcmVlZG9tTW9kZVwiLCBjb25maWcuZnJlZWRvbU1vZGUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRGcmVlZG9tTW9kZSA9IHNldEZyZWVkb21Nb2RlO1xuZnVuY3Rpb24gc2V0Q29uZmlkZW5jZU1vZGUoY20sIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImNvbmZpZGVuY2UgbW9kZVwiLCBjbSwgW1tcIm9mZlwiLCBcIm9uXCIsIFwibWF4XCJdXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuY29uZmlkZW5jZU1vZGUgPSBjbTtcbiAgICBpZiAoY29uZmlnLmNvbmZpZGVuY2VNb2RlICE9PSBcIm9mZlwiKSB7XG4gICAgICAgIGNvbmZpZy5mcmVlZG9tTW9kZSA9IGZhbHNlO1xuICAgICAgICBjb25maWcuc3RvcE9uRXJyb3IgPSBcIm9mZlwiO1xuICAgIH1cbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJjb25maWRlbmNlTW9kZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiY29uZmlkZW5jZU1vZGVcIiwgY29uZmlnLmNvbmZpZGVuY2VNb2RlLCBub3NhdmUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRDb25maWRlbmNlTW9kZSA9IHNldENvbmZpZGVuY2VNb2RlO1xuZnVuY3Rpb24gc2V0SW5kaWNhdGVUeXBvcyh2YWx1ZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiaW5kaWNhdGUgdHlwb3NcIiwgdmFsdWUsIFtbXCJvZmZcIiwgXCJiZWxvd1wiLCBcInJlcGxhY2VcIl1dKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5pbmRpY2F0ZVR5cG9zID0gdmFsdWU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiaW5kaWNhdGVUeXBvc1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiaW5kaWNhdGVUeXBvc1wiLCBjb25maWcuaW5kaWNhdGVUeXBvcyk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEluZGljYXRlVHlwb3MgPSBzZXRJbmRpY2F0ZVR5cG9zO1xuZnVuY3Rpb24gc2V0QXV0b1N3aXRjaFRoZW1lKGJvb2xlYW4sIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImF1dG8gc3dpdGNoIHRoZW1lXCIsIGJvb2xlYW4sIFtcImJvb2xlYW5cIl0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgYm9vbGVhbiA9IGJvb2xlYW4gIT09IG51bGwgJiYgYm9vbGVhbiAhPT0gdm9pZCAwID8gYm9vbGVhbiA6IGRlZmF1bHRfY29uZmlnXzEuZGVmYXVsdC5hdXRvU3dpdGNoVGhlbWU7XG4gICAgY29uZmlnLmF1dG9Td2l0Y2hUaGVtZSA9IGJvb2xlYW47XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiYXV0b1N3aXRjaFRoZW1lXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJhdXRvU3dpdGNoVGhlbWVcIiwgY29uZmlnLmF1dG9Td2l0Y2hUaGVtZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEF1dG9Td2l0Y2hUaGVtZSA9IHNldEF1dG9Td2l0Y2hUaGVtZTtcbmZ1bmN0aW9uIHNldEN1c3RvbVRoZW1lKGJvb2xlYW4sIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImN1c3RvbSB0aGVtZVwiLCBib29sZWFuLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5jdXN0b21UaGVtZSA9IGJvb2xlYW47XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiY3VzdG9tVGhlbWVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImN1c3RvbVRoZW1lXCIsIGNvbmZpZy5jdXN0b21UaGVtZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEN1c3RvbVRoZW1lID0gc2V0Q3VzdG9tVGhlbWU7XG5mdW5jdGlvbiBzZXRUaGVtZShuYW1lLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJ0aGVtZVwiLCBuYW1lLCBbXCJzdHJpbmdcIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLnRoZW1lID0gbmFtZTtcbiAgICBzZXRDdXN0b21UaGVtZShmYWxzZSk7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwidGhlbWVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInRoZW1lXCIsIGNvbmZpZy50aGVtZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFRoZW1lID0gc2V0VGhlbWU7XG5mdW5jdGlvbiBzZXRUaGVtZUxpZ2h0KG5hbWUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInRoZW1lIGxpZ2h0XCIsIG5hbWUsIFtcInN0cmluZ1wiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcudGhlbWVMaWdodCA9IG5hbWU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwidGhlbWVMaWdodFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwidGhlbWVMaWdodFwiLCBjb25maWcudGhlbWVMaWdodCwgbm9zYXZlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0VGhlbWVMaWdodCA9IHNldFRoZW1lTGlnaHQ7XG5mdW5jdGlvbiBzZXRUaGVtZURhcmsobmFtZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwidGhlbWUgZGFya1wiLCBuYW1lLCBbXCJzdHJpbmdcIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLnRoZW1lRGFyayA9IG5hbWU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwidGhlbWVEYXJrXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJ0aGVtZURhcmtcIiwgY29uZmlnLnRoZW1lRGFyaywgbm9zYXZlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0VGhlbWVEYXJrID0gc2V0VGhlbWVEYXJrO1xuZnVuY3Rpb24gc2V0VGhlbWVzKHRoZW1lLCBjdXN0b21TdGF0ZSwgY3VzdG9tVGhlbWVDb2xvcnMsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInRoZW1lc1wiLCB0aGVtZSwgW1wic3RyaW5nXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5jdXN0b21UaGVtZUNvbG9ycyA9IGN1c3RvbVRoZW1lQ29sb3JzO1xuICAgIGNvbmZpZy50aGVtZSA9IHRoZW1lO1xuICAgIGNvbmZpZy5jdXN0b21UaGVtZSA9IGN1c3RvbVN0YXRlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInRoZW1lXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzZXRUaGVtZXNcIiwgY3VzdG9tU3RhdGUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZnVuY3Rpb24gc2V0UmFuZG9tVGhlbWUodmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJyYW5kb20gdGhlbWVcIiwgdmFsLCBbXG4gICAgICAgIFtcIm9mZlwiLCBcIm9uXCIsIFwiZmF2XCIsIFwibGlnaHRcIiwgXCJkYXJrXCIsIFwiY3VzdG9tXCJdLFxuICAgIF0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHZhbCA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyID09PSBudWxsKSB7XG4gICAgICAgICAgICBjb25maWcucmFuZG9tVGhlbWUgPSB2YWw7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFEQi5nZXRTbmFwc2hvdCgpKVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIGlmIChEQi5nZXRTbmFwc2hvdCgpLmN1c3RvbVRoZW1lcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiWW91IG5lZWQgdG8gY3JlYXRlIGEgY3VzdG9tIHRoZW1lIGZpcnN0XCIsIDApO1xuICAgICAgICAgICAgY29uZmlnLnJhbmRvbVRoZW1lID0gXCJvZmZcIjtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25maWcucmFuZG9tVGhlbWUgPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwicmFuZG9tVGhlbWVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInJhbmRvbVRoZW1lXCIsIGNvbmZpZy5yYW5kb21UaGVtZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFJhbmRvbVRoZW1lID0gc2V0UmFuZG9tVGhlbWU7XG5mdW5jdGlvbiBzZXRCcml0aXNoRW5nbGlzaCh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImJyaXRpc2ggZW5nbGlzaFwiLCB2YWwsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgaWYgKCF2YWwpIHtcbiAgICAgICAgdmFsID0gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5icml0aXNoRW5nbGlzaCA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJicml0aXNoRW5nbGlzaFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiYnJpdGlzaEVuZ2xpc2hcIiwgY29uZmlnLmJyaXRpc2hFbmdsaXNoKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0QnJpdGlzaEVuZ2xpc2ggPSBzZXRCcml0aXNoRW5nbGlzaDtcbmZ1bmN0aW9uIHNldExhenlNb2RlKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwibGF6eSBtb2RlXCIsIHZhbCwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAoIXZhbCkge1xuICAgICAgICB2YWwgPSBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmxhenlNb2RlID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImxhenlNb2RlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJsYXp5TW9kZVwiLCBjb25maWcubGF6eU1vZGUsIG5vc2F2ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldExhenlNb2RlID0gc2V0TGF6eU1vZGU7XG5mdW5jdGlvbiBzZXRDdXN0b21UaGVtZUNvbG9ycyhjb2xvcnMsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImN1c3RvbSB0aGVtZSBjb2xvcnNcIiwgY29sb3JzLCBbXCJzdHJpbmdBcnJheVwiXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoY29sb3JzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29uZmlnLmN1c3RvbVRoZW1lQ29sb3JzID0gY29sb3JzO1xuICAgICAgICAvLyBUaGVtZUNvbnRyb2xsZXIuc2V0KFwiY3VzdG9tXCIpO1xuICAgICAgICAvLyBhcHBseUN1c3RvbVRoZW1lQ29sb3JzKCk7XG4gICAgfVxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImN1c3RvbVRoZW1lQ29sb3JzXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJjdXN0b21UaGVtZUNvbG9yc1wiLCBjb25maWcuY3VzdG9tVGhlbWVDb2xvcnMsIG5vc2F2ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEN1c3RvbVRoZW1lQ29sb3JzID0gc2V0Q3VzdG9tVGhlbWVDb2xvcnM7XG5mdW5jdGlvbiBzZXRMYW5ndWFnZShsYW5ndWFnZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwibGFuZ3VhZ2VcIiwgbGFuZ3VhZ2UsIFtcInN0cmluZ1wiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcubGFuZ3VhZ2UgPSBsYW5ndWFnZTtcbiAgICBBbmFseXRpY3NDb250cm9sbGVyLmxvZyhcImNoYW5nZWRMYW5ndWFnZVwiLCB7IGxhbmd1YWdlIH0pO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImxhbmd1YWdlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJsYW5ndWFnZVwiLCBjb25maWcubGFuZ3VhZ2UpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRMYW5ndWFnZSA9IHNldExhbmd1YWdlO1xuZnVuY3Rpb24gc2V0TW9ua2V5KG1vbmtleSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwibW9ua2V5XCIsIG1vbmtleSwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcubW9ua2V5ID0gbW9ua2V5O1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcIm1vbmtleVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwibW9ua2V5XCIsIGNvbmZpZy5tb25rZXkpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRNb25rZXkgPSBzZXRNb25rZXk7XG5mdW5jdGlvbiBzZXRLZXltYXBNb2RlKG1vZGUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImtleW1hcCBtb2RlXCIsIG1vZGUsIFtcbiAgICAgICAgW1wib2ZmXCIsIFwic3RhdGljXCIsIFwicmVhY3RcIiwgXCJuZXh0XCJdLFxuICAgIF0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgJChcIi5hY3RpdmUta2V5XCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlLWtleVwiKTtcbiAgICAkKFwiLmtleW1hcC1rZXlcIikuYXR0cihcInN0eWxlXCIsIFwiXCIpO1xuICAgIGNvbmZpZy5rZXltYXBNb2RlID0gbW9kZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJrZXltYXBNb2RlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJrZXltYXBNb2RlXCIsIGNvbmZpZy5rZXltYXBNb2RlLCBub3NhdmUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRLZXltYXBNb2RlID0gc2V0S2V5bWFwTW9kZTtcbmZ1bmN0aW9uIHNldEtleW1hcExlZ2VuZFN0eWxlKHN0eWxlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJrZXltYXAgbGVnZW5kIHN0eWxlXCIsIHN0eWxlLCBbXG4gICAgICAgIFtcImxvd2VyY2FzZVwiLCBcInVwcGVyY2FzZVwiLCBcImJsYW5rXCIsIFwiZHluYW1pY1wiXSxcbiAgICBdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8vIFJlbW92ZSBleGlzdGluZyBzdHlsZXNcbiAgICBjb25zdCBrZXltYXBMZWdlbmRTdHlsZXMgPSBbXCJsb3dlcmNhc2VcIiwgXCJ1cHBlcmNhc2VcIiwgXCJibGFua1wiLCBcImR5bmFtaWNcIl07XG4gICAga2V5bWFwTGVnZW5kU3R5bGVzLmZvckVhY2goKG5hbWUpID0+IHtcbiAgICAgICAgJChcIi5rZXltYXBMZWdlbmRTdHlsZVwiKS5yZW1vdmVDbGFzcyhuYW1lKTtcbiAgICB9KTtcbiAgICBzdHlsZSA9IHN0eWxlIHx8IFwibG93ZXJjYXNlXCI7XG4gICAgLy8gTXV0YXRlIHRoZSBrZXltYXAgaW4gdGhlIERPTSwgaWYgaXQgZXhpc3RzLlxuICAgIC8vIDEuIFJlbW92ZSBldmVyeXRoaW5nXG4gICAgJChcIi5rZXltYXAta2V5ID4gLmxldHRlclwiKS5jc3MoXCJkaXNwbGF5XCIsIFwiXCIpO1xuICAgICQoXCIua2V5bWFwLWtleSA+IC5sZXR0ZXJcIikuY3NzKFwidGV4dC10cmFuc2Zvcm1cIiwgXCJcIik7XG4gICAgLy8gMi4gQXBwZW5kIHNwZWNpYWwgc3R5bGVzIG9udG8gdGhlIERPTSBlbGVtZW50c1xuICAgIGlmIChzdHlsZSA9PT0gXCJ1cHBlcmNhc2VcIikge1xuICAgICAgICAkKFwiLmtleW1hcC1rZXkgPiAubGV0dGVyXCIpLmNzcyhcInRleHQtdHJhbnNmb3JtXCIsIFwiY2FwaXRhbGl6ZVwiKTtcbiAgICB9XG4gICAgaWYgKHN0eWxlID09PSBcImJsYW5rXCIpIHtcbiAgICAgICAgJChcIi5rZXltYXAta2V5ID4gLmxldHRlclwiKS5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcbiAgICB9XG4gICAgLy8gVXBkYXRlIGFuZCBzYXZlIHRvIGNvb2tpZSBmb3IgcGVyc2lzdGVuY2VcbiAgICAkKFwiLmtleW1hcExlZ2VuZFN0eWxlXCIpLmFkZENsYXNzKHN0eWxlKTtcbiAgICBjb25maWcua2V5bWFwTGVnZW5kU3R5bGUgPSBzdHlsZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJrZXltYXBMZWdlbmRTdHlsZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwia2V5bWFwTGVnZW5kU3R5bGVcIiwgY29uZmlnLmtleW1hcExlZ2VuZFN0eWxlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0S2V5bWFwTGVnZW5kU3R5bGUgPSBzZXRLZXltYXBMZWdlbmRTdHlsZTtcbmZ1bmN0aW9uIHNldEtleW1hcFN0eWxlKHN0eWxlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJrZXltYXAgc3R5bGVcIiwgc3R5bGUsIFtcbiAgICAgICAgW1wic3RhZ2dlcmVkXCIsIFwiYWxpY2VcIiwgXCJtYXRyaXhcIiwgXCJzcGxpdFwiLCBcInNwbGl0X21hdHJpeFwiXSxcbiAgICBdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHN0eWxlID0gc3R5bGUgfHwgXCJzdGFnZ2VyZWRcIjtcbiAgICBjb25maWcua2V5bWFwU3R5bGUgPSBzdHlsZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJrZXltYXBTdHlsZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwia2V5bWFwU3R5bGVcIiwgY29uZmlnLmtleW1hcFN0eWxlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0S2V5bWFwU3R5bGUgPSBzZXRLZXltYXBTdHlsZTtcbmZ1bmN0aW9uIHNldEtleW1hcExheW91dChsYXlvdXQsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImtleW1hcCBsYXlvdXRcIiwgbGF5b3V0LCBbXCJzdHJpbmdcIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLmtleW1hcExheW91dCA9IGxheW91dDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJrZXltYXBMYXlvdXRcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImtleW1hcExheW91dFwiLCBjb25maWcua2V5bWFwTGF5b3V0KTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0S2V5bWFwTGF5b3V0ID0gc2V0S2V5bWFwTGF5b3V0O1xuZnVuY3Rpb24gc2V0TGF5b3V0KGxheW91dCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwibGF5b3V0XCIsIGxheW91dCwgW1wic3RyaW5nXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5sYXlvdXQgPSBsYXlvdXQ7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwibGF5b3V0XCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJsYXlvdXRcIiwgY29uZmlnLmxheW91dCwgbm9zYXZlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0TGF5b3V0ID0gc2V0TGF5b3V0O1xuLy8gZXhwb3J0IGZ1bmN0aW9uIHNldFNhdmVkTGF5b3V0KGxheW91dDogc3RyaW5nLCBub3NhdmU/OiBib29sZWFuKTogYm9vbGVhbiB7XG4vLyAgIGlmIChsYXlvdXQgPT0gbnVsbCB8fCBsYXlvdXQgPT0gdW5kZWZpbmVkKSB7XG4vLyAgICAgbGF5b3V0ID0gXCJxd2VydHlcIjtcbi8vICAgfVxuLy8gICBjb25maWcuc2F2ZWRMYXlvdXQgPSBsYXlvdXQ7XG4vLyAgIHNldExheW91dChsYXlvdXQsIG5vc2F2ZSk7XG4vLyAgIHJldHVybiB0cnVlO1xuLy8gfVxuZnVuY3Rpb24gc2V0Rm9udFNpemUoZm9udFNpemUsIG5vc2F2ZSkge1xuICAgIGZvbnRTaXplID0gZm9udFNpemUudG9TdHJpbmcoKTsgLy90b2RvIHJlbW92ZSBhZnRlciBhcm91bmQgYSB3ZWVrXG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiZm9udCBzaXplXCIsIGZvbnRTaXplLCBbXG4gICAgICAgIFtcIjFcIiwgXCIxMjVcIiwgXCIxNVwiLCBcIjJcIiwgXCIzXCIsIFwiNFwiXSxcbiAgICBdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5mb250U2l6ZSA9IGZvbnRTaXplO1xuICAgICQoXCIjd29yZHNcIikucmVtb3ZlQ2xhc3MoXCJzaXplMTI1XCIpO1xuICAgICQoXCIjY2FyZXQsICNwYWNlQ2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJzaXplMTI1XCIpO1xuICAgICQoXCIjd29yZHNcIikucmVtb3ZlQ2xhc3MoXCJzaXplMTVcIik7XG4gICAgJChcIiNjYXJldCwgI3BhY2VDYXJldFwiKS5yZW1vdmVDbGFzcyhcInNpemUxNVwiKTtcbiAgICAkKFwiI3dvcmRzXCIpLnJlbW92ZUNsYXNzKFwic2l6ZTJcIik7XG4gICAgJChcIiNjYXJldCwgI3BhY2VDYXJldFwiKS5yZW1vdmVDbGFzcyhcInNpemUyXCIpO1xuICAgICQoXCIjd29yZHNcIikucmVtb3ZlQ2xhc3MoXCJzaXplM1wiKTtcbiAgICAkKFwiI2NhcmV0LCAjcGFjZUNhcmV0XCIpLnJlbW92ZUNsYXNzKFwic2l6ZTNcIik7XG4gICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcInNpemUzNVwiKTtcbiAgICAkKFwiI2NhcmV0LCAjcGFjZUNhcmV0XCIpLnJlbW92ZUNsYXNzKFwic2l6ZTM1XCIpO1xuICAgICQoXCIjd29yZHNcIikucmVtb3ZlQ2xhc3MoXCJzaXplNFwiKTtcbiAgICAkKFwiI2NhcmV0LCAjcGFjZUNhcmV0XCIpLnJlbW92ZUNsYXNzKFwic2l6ZTRcIik7XG4gICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtXCIpLnJlbW92ZUNsYXNzKFwic2l6ZTEyNVwiKTtcbiAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG1cIikucmVtb3ZlQ2xhc3MoXCJzaXplMTVcIik7XG4gICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtXCIpLnJlbW92ZUNsYXNzKFwic2l6ZTJcIik7XG4gICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtXCIpLnJlbW92ZUNsYXNzKFwic2l6ZTNcIik7XG4gICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtXCIpLnJlbW92ZUNsYXNzKFwic2l6ZTM1XCIpO1xuICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbVwiKS5yZW1vdmVDbGFzcyhcInNpemU0XCIpO1xuICAgIGlmIChmb250U2l6ZSA9PSBcIjEyNVwiKSB7XG4gICAgICAgICQoXCIjd29yZHNcIikuYWRkQ2xhc3MoXCJzaXplMTI1XCIpO1xuICAgICAgICAkKFwiI2NhcmV0LCAjcGFjZUNhcmV0XCIpLmFkZENsYXNzKFwic2l6ZTEyNVwiKTtcbiAgICAgICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtXCIpLmFkZENsYXNzKFwic2l6ZTEyNVwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZm9udFNpemUgPT0gXCIxNVwiKSB7XG4gICAgICAgICQoXCIjd29yZHNcIikuYWRkQ2xhc3MoXCJzaXplMTVcIik7XG4gICAgICAgICQoXCIjY2FyZXQsICNwYWNlQ2FyZXRcIikuYWRkQ2xhc3MoXCJzaXplMTVcIik7XG4gICAgICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbVwiKS5hZGRDbGFzcyhcInNpemUxNVwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZm9udFNpemUgPT0gXCIyXCIpIHtcbiAgICAgICAgJChcIiN3b3Jkc1wiKS5hZGRDbGFzcyhcInNpemUyXCIpO1xuICAgICAgICAkKFwiI2NhcmV0LCAjcGFjZUNhcmV0XCIpLmFkZENsYXNzKFwic2l6ZTJcIik7XG4gICAgICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbVwiKS5hZGRDbGFzcyhcInNpemUyXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChmb250U2l6ZSA9PSBcIjNcIikge1xuICAgICAgICAkKFwiI3dvcmRzXCIpLmFkZENsYXNzKFwic2l6ZTNcIik7XG4gICAgICAgICQoXCIjY2FyZXQsICNwYWNlQ2FyZXRcIikuYWRkQ2xhc3MoXCJzaXplM1wiKTtcbiAgICAgICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtXCIpLmFkZENsYXNzKFwic2l6ZTNcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGZvbnRTaXplID09IFwiNFwiKSB7XG4gICAgICAgICQoXCIjd29yZHNcIikuYWRkQ2xhc3MoXCJzaXplNFwiKTtcbiAgICAgICAgJChcIiNjYXJldCwgI3BhY2VDYXJldFwiKS5hZGRDbGFzcyhcInNpemU0XCIpO1xuICAgICAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG1cIikuYWRkQ2xhc3MoXCJzaXplNFwiKTtcbiAgICB9XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiZm9udFNpemVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImZvbnRTaXplXCIsIGNvbmZpZy5mb250U2l6ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEZvbnRTaXplID0gc2V0Rm9udFNpemU7XG5mdW5jdGlvbiBzZXRDdXN0b21CYWNrZ3JvdW5kKHZhbHVlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJjdXN0b20gYmFja2dyb3VuZFwiLCB2YWx1ZSwgW1wic3RyaW5nXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIHZhbHVlID0gdmFsdWUudHJpbSgpO1xuICAgIGlmICgoLyhodHRwc3xodHRwKTpcXC9cXC8od3d3XFwufCkuK1xcLi4rXFwvLisoXFwucG5nfFxcLmdpZnxcXC5qcGVnfFxcLmpwZykvZ2kudGVzdCh2YWx1ZSkgJiZcbiAgICAgICAgIS9bPD5dLy50ZXN0KHZhbHVlKSkgfHxcbiAgICAgICAgdmFsdWUgPT0gXCJcIikge1xuICAgICAgICBjb25maWcuY3VzdG9tQmFja2dyb3VuZCA9IHZhbHVlO1xuICAgICAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJjdXN0b21CYWNrZ3JvdW5kXCIsIG5vc2F2ZSk7XG4gICAgICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiY3VzdG9tQmFja2dyb3VuZFwiLCBjb25maWcuY3VzdG9tQmFja2dyb3VuZCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkludmFsaWQgY3VzdG9tIGJhY2tncm91bmQgVVJMXCIsIDApO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0Q3VzdG9tQmFja2dyb3VuZCA9IHNldEN1c3RvbUJhY2tncm91bmQ7XG5mdW5jdGlvbiBzZXRDdXN0b21MYXlvdXRmbHVpZCh2YWx1ZSwgbm9zYXZlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgdHJpbW1lZCA9IHZhbHVlLnRyaW0oKTtcbiAgICAgICAgaWYgKCEoeWllbGQgKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkQXN5bmMpKFwibGF5b3V0Zmx1aWRcIiwgdHJpbW1lZCwgW1wibGF5b3V0Zmx1aWRcIl0pKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGN1c3RvbUxheW91dGZsdWlkID0gdHJpbW1lZC5yZXBsYWNlKC8gL2csIFwiI1wiKTtcbiAgICAgICAgY29uZmlnLmN1c3RvbUxheW91dGZsdWlkID0gY3VzdG9tTGF5b3V0Zmx1aWQ7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmN1c3RvbUxheW91dGZsdWlkIGlucHV0XCIpLnZhbChjdXN0b21MYXlvdXRmbHVpZC5yZXBsYWNlKC8jL2csIFwiIFwiKSk7XG4gICAgICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImN1c3RvbUxheW91dGZsdWlkXCIsIG5vc2F2ZSk7XG4gICAgICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiY3VzdG9tTGF5b3V0Rmx1aWRcIiwgY29uZmlnLmN1c3RvbUxheW91dGZsdWlkKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG59XG5leHBvcnRzLnNldEN1c3RvbUxheW91dGZsdWlkID0gc2V0Q3VzdG9tTGF5b3V0Zmx1aWQ7XG5mdW5jdGlvbiBzZXRDdXN0b21CYWNrZ3JvdW5kU2l6ZSh2YWx1ZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiY3VzdG9tIGJhY2tncm91bmQgc2l6ZVwiLCB2YWx1ZSwgW1xuICAgICAgICBbXCJtYXhcIiwgXCJjb3ZlclwiLCBcImNvbnRhaW5cIl0sXG4gICAgXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAodmFsdWUgIT0gXCJjb3ZlclwiICYmIHZhbHVlICE9IFwiY29udGFpblwiICYmIHZhbHVlICE9IFwibWF4XCIpIHtcbiAgICAgICAgdmFsdWUgPSBcImNvdmVyXCI7XG4gICAgfVxuICAgIGNvbmZpZy5jdXN0b21CYWNrZ3JvdW5kU2l6ZSA9IHZhbHVlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImN1c3RvbUJhY2tncm91bmRTaXplXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJjdXN0b21CYWNrZ3JvdW5kU2l6ZVwiLCBjb25maWcuY3VzdG9tQmFja2dyb3VuZFNpemUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRDdXN0b21CYWNrZ3JvdW5kU2l6ZSA9IHNldEN1c3RvbUJhY2tncm91bmRTaXplO1xuZnVuY3Rpb24gc2V0Q3VzdG9tQmFja2dyb3VuZEZpbHRlcihhcnJheSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiY3VzdG9tIGJhY2tncm91bmQgZmlsdGVyXCIsIGFycmF5LCBbXCJudW1iZXJBcnJheVwiXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuY3VzdG9tQmFja2dyb3VuZEZpbHRlciA9IGFycmF5O1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImN1c3RvbUJhY2tncm91bmRGaWx0ZXJcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImN1c3RvbUJhY2tncm91bmRGaWx0ZXJcIiwgY29uZmlnLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRDdXN0b21CYWNrZ3JvdW5kRmlsdGVyID0gc2V0Q3VzdG9tQmFja2dyb3VuZEZpbHRlcjtcbmZ1bmN0aW9uIHNldE1vbmtleVBvd2VyTGV2ZWwobGV2ZWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcIm1vbmtleSBwb3dlciBsZXZlbFwiLCBsZXZlbCwgW1xuICAgICAgICBbXCJvZmZcIiwgXCIxXCIsIFwiMlwiLCBcIjNcIiwgXCI0XCJdLFxuICAgIF0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKCFbXCJvZmZcIiwgXCIxXCIsIFwiMlwiLCBcIjNcIiwgXCI0XCJdLmluY2x1ZGVzKGxldmVsKSlcbiAgICAgICAgbGV2ZWwgPSBcIm9mZlwiO1xuICAgIGNvbmZpZy5tb25rZXlQb3dlckxldmVsID0gbGV2ZWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwibW9ua2V5UG93ZXJMZXZlbFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwibW9ua2V5UG93ZXJMZXZlbFwiLCBjb25maWcubW9ua2V5UG93ZXJMZXZlbCk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldE1vbmtleVBvd2VyTGV2ZWwgPSBzZXRNb25rZXlQb3dlckxldmVsO1xuZnVuY3Rpb24gc2V0QnVyc3RIZWF0bWFwKHZhbHVlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJidXJzdCBoZWF0bWFwXCIsIHZhbHVlLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgdmFsdWUgPSBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmJ1cnN0SGVhdG1hcCA9IHZhbHVlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImJ1cnN0SGVhdG1hcFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiYnVyc3RIZWF0bWFwXCIsIGNvbmZpZy5idXJzdEhlYXRtYXApO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRCdXJzdEhlYXRtYXAgPSBzZXRCdXJzdEhlYXRtYXA7XG5mdW5jdGlvbiBhcHBseShjb25maWdUb0FwcGx5KSB7XG4gICAgaWYgKCFjb25maWdUb0FwcGx5KVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgY29uZmlnT2JqID0gY29uZmlnVG9BcHBseTtcbiAgICBPYmplY3Qua2V5cyhkZWZhdWx0X2NvbmZpZ18xLmRlZmF1bHQpLmZvckVhY2goKGNvbmZpZ0tleSkgPT4ge1xuICAgICAgICBpZiAoY29uZmlnT2JqW2NvbmZpZ0tleV0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBkZWZhdWx0X2NvbmZpZ18xLmRlZmF1bHRbY29uZmlnS2V5XTtcbiAgICAgICAgICAgIGNvbmZpZ09ialtjb25maWdLZXldID0gbmV3VmFsdWU7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoY29uZmlnT2JqICE9PSB1bmRlZmluZWQgJiYgY29uZmlnT2JqICE9PSBudWxsKSB7XG4gICAgICAgIHNldFRoZW1lTGlnaHQoY29uZmlnT2JqLnRoZW1lTGlnaHQsIHRydWUpO1xuICAgICAgICBzZXRUaGVtZURhcmsoY29uZmlnT2JqLnRoZW1lRGFyaywgdHJ1ZSk7XG4gICAgICAgIHNldEF1dG9Td2l0Y2hUaGVtZShjb25maWdPYmouYXV0b1N3aXRjaFRoZW1lLCB0cnVlKTtcbiAgICAgICAgc2V0VGhlbWVzKGNvbmZpZ09iai50aGVtZSwgY29uZmlnT2JqLmN1c3RvbVRoZW1lLCBjb25maWdPYmouY3VzdG9tVGhlbWVDb2xvcnMsIHRydWUpO1xuICAgICAgICBzZXRDdXN0b21MYXlvdXRmbHVpZChjb25maWdPYmouY3VzdG9tTGF5b3V0Zmx1aWQsIHRydWUpO1xuICAgICAgICBzZXRDdXN0b21CYWNrZ3JvdW5kKGNvbmZpZ09iai5jdXN0b21CYWNrZ3JvdW5kLCB0cnVlKTtcbiAgICAgICAgc2V0Q3VzdG9tQmFja2dyb3VuZFNpemUoY29uZmlnT2JqLmN1c3RvbUJhY2tncm91bmRTaXplLCB0cnVlKTtcbiAgICAgICAgc2V0Q3VzdG9tQmFja2dyb3VuZEZpbHRlcihjb25maWdPYmouY3VzdG9tQmFja2dyb3VuZEZpbHRlciwgdHJ1ZSk7XG4gICAgICAgIHNldFF1aWNrVGFiTW9kZShjb25maWdPYmoucXVpY2tUYWIsIHRydWUpO1xuICAgICAgICBzZXRLZXlUaXBzKGNvbmZpZ09iai5zaG93S2V5VGlwcywgdHJ1ZSk7XG4gICAgICAgIHNldFRpbWVDb25maWcoY29uZmlnT2JqLnRpbWUsIHRydWUpO1xuICAgICAgICBzZXRRdW90ZUxlbmd0aChjb25maWdPYmoucXVvdGVMZW5ndGgsIHRydWUpO1xuICAgICAgICBzZXRXb3JkQ291bnQoY29uZmlnT2JqLndvcmRzLCB0cnVlKTtcbiAgICAgICAgc2V0TGFuZ3VhZ2UoY29uZmlnT2JqLmxhbmd1YWdlLCB0cnVlKTtcbiAgICAgICAgc2V0TGF5b3V0KGNvbmZpZ09iai5sYXlvdXQsIHRydWUpO1xuICAgICAgICBzZXRGb250U2l6ZShjb25maWdPYmouZm9udFNpemUsIHRydWUpO1xuICAgICAgICBzZXRGcmVlZG9tTW9kZShjb25maWdPYmouZnJlZWRvbU1vZGUsIHRydWUpO1xuICAgICAgICBzZXRDYXJldFN0eWxlKGNvbmZpZ09iai5jYXJldFN0eWxlLCB0cnVlKTtcbiAgICAgICAgc2V0UGFjZUNhcmV0U3R5bGUoY29uZmlnT2JqLnBhY2VDYXJldFN0eWxlLCB0cnVlKTtcbiAgICAgICAgc2V0RGlmZmljdWx0eShjb25maWdPYmouZGlmZmljdWx0eSwgdHJ1ZSk7XG4gICAgICAgIHNldEJsaW5kTW9kZShjb25maWdPYmouYmxpbmRNb2RlLCB0cnVlKTtcbiAgICAgICAgc2V0UXVpY2tFbmQoY29uZmlnT2JqLnF1aWNrRW5kLCB0cnVlKTtcbiAgICAgICAgc2V0RmxpcFRlc3RDb2xvcnMoY29uZmlnT2JqLmZsaXBUZXN0Q29sb3JzLCB0cnVlKTtcbiAgICAgICAgc2V0Q29sb3JmdWxNb2RlKGNvbmZpZ09iai5jb2xvcmZ1bE1vZGUsIHRydWUpO1xuICAgICAgICBzZXRDb25maWRlbmNlTW9kZShjb25maWdPYmouY29uZmlkZW5jZU1vZGUsIHRydWUpO1xuICAgICAgICBzZXRJbmRpY2F0ZVR5cG9zKGNvbmZpZ09iai5pbmRpY2F0ZVR5cG9zLCB0cnVlKTtcbiAgICAgICAgc2V0VGltZXJTdHlsZShjb25maWdPYmoudGltZXJTdHlsZSwgdHJ1ZSk7XG4gICAgICAgIHNldFRpbWVyQ29sb3IoY29uZmlnT2JqLnRpbWVyQ29sb3IsIHRydWUpO1xuICAgICAgICBzZXRUaW1lck9wYWNpdHkoY29uZmlnT2JqLnRpbWVyT3BhY2l0eSwgdHJ1ZSk7XG4gICAgICAgIHNldEtleW1hcE1vZGUoY29uZmlnT2JqLmtleW1hcE1vZGUsIHRydWUpO1xuICAgICAgICBzZXRLZXltYXBTdHlsZShjb25maWdPYmoua2V5bWFwU3R5bGUsIHRydWUpO1xuICAgICAgICBzZXRLZXltYXBMZWdlbmRTdHlsZShjb25maWdPYmoua2V5bWFwTGVnZW5kU3R5bGUsIHRydWUpO1xuICAgICAgICBzZXRLZXltYXBMYXlvdXQoY29uZmlnT2JqLmtleW1hcExheW91dCwgdHJ1ZSk7XG4gICAgICAgIHNldEZvbnRGYW1pbHkoY29uZmlnT2JqLmZvbnRGYW1pbHksIHRydWUpO1xuICAgICAgICBzZXRTbW9vdGhDYXJldChjb25maWdPYmouc21vb3RoQ2FyZXQsIHRydWUpO1xuICAgICAgICBzZXRTbW9vdGhMaW5lU2Nyb2xsKGNvbmZpZ09iai5zbW9vdGhMaW5lU2Nyb2xsLCB0cnVlKTtcbiAgICAgICAgc2V0U2hvd0xpdmVXcG0oY29uZmlnT2JqLnNob3dMaXZlV3BtLCB0cnVlKTtcbiAgICAgICAgc2V0U2hvd0xpdmVBY2MoY29uZmlnT2JqLnNob3dMaXZlQWNjLCB0cnVlKTtcbiAgICAgICAgc2V0U2hvd0xpdmVCdXJzdChjb25maWdPYmouc2hvd0xpdmVCdXJzdCwgdHJ1ZSk7XG4gICAgICAgIHNldFNob3dUaW1lclByb2dyZXNzKGNvbmZpZ09iai5zaG93VGltZXJQcm9ncmVzcywgdHJ1ZSk7XG4gICAgICAgIHNldEFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzKGNvbmZpZ09iai5hbHdheXNTaG93RGVjaW1hbFBsYWNlcywgdHJ1ZSk7XG4gICAgICAgIHNldEFsd2F5c1Nob3dXb3Jkc0hpc3RvcnkoY29uZmlnT2JqLmFsd2F5c1Nob3dXb3Jkc0hpc3RvcnksIHRydWUpO1xuICAgICAgICBzZXRTaW5nbGVMaXN0Q29tbWFuZExpbmUoY29uZmlnT2JqLnNpbmdsZUxpc3RDb21tYW5kTGluZSwgdHJ1ZSk7XG4gICAgICAgIHNldENhcHNMb2NrV2FybmluZyhjb25maWdPYmouY2Fwc0xvY2tXYXJuaW5nLCB0cnVlKTtcbiAgICAgICAgc2V0UGxheVNvdW5kT25FcnJvcihjb25maWdPYmoucGxheVNvdW5kT25FcnJvciwgdHJ1ZSk7XG4gICAgICAgIHNldFBsYXlTb3VuZE9uQ2xpY2soY29uZmlnT2JqLnBsYXlTb3VuZE9uQ2xpY2ssIHRydWUpO1xuICAgICAgICBzZXRTb3VuZFZvbHVtZShjb25maWdPYmouc291bmRWb2x1bWUsIHRydWUpO1xuICAgICAgICBzZXRTdG9wT25FcnJvcihjb25maWdPYmouc3RvcE9uRXJyb3IsIHRydWUpO1xuICAgICAgICBzZXRGYXZUaGVtZXMoY29uZmlnT2JqLmZhdlRoZW1lcywgdHJ1ZSk7XG4gICAgICAgIHNldEZ1bmJveChjb25maWdPYmouZnVuYm94LCB0cnVlKTtcbiAgICAgICAgc2V0UmFuZG9tVGhlbWUoY29uZmlnT2JqLnJhbmRvbVRoZW1lLCB0cnVlKTtcbiAgICAgICAgc2V0U2hvd0FsbExpbmVzKGNvbmZpZ09iai5zaG93QWxsTGluZXMsIHRydWUpO1xuICAgICAgICBzZXRTd2FwRXNjQW5kVGFiKGNvbmZpZ09iai5zd2FwRXNjQW5kVGFiLCB0cnVlKTtcbiAgICAgICAgc2V0U2hvd091dE9mRm9jdXNXYXJuaW5nKGNvbmZpZ09iai5zaG93T3V0T2ZGb2N1c1dhcm5pbmcsIHRydWUpO1xuICAgICAgICBzZXRQYWNlQ2FyZXQoY29uZmlnT2JqLnBhY2VDYXJldCwgdHJ1ZSk7XG4gICAgICAgIHNldFBhY2VDYXJldEN1c3RvbVNwZWVkKGNvbmZpZ09iai5wYWNlQ2FyZXRDdXN0b21TcGVlZCwgdHJ1ZSk7XG4gICAgICAgIHNldFJlcGVhdGVkUGFjZShjb25maWdPYmoucmVwZWF0ZWRQYWNlLCB0cnVlKTtcbiAgICAgICAgc2V0UGFnZVdpZHRoKGNvbmZpZ09iai5wYWdlV2lkdGgsIHRydWUpO1xuICAgICAgICBzZXRDaGFydEFjY3VyYWN5KGNvbmZpZ09iai5jaGFydEFjY3VyYWN5LCB0cnVlKTtcbiAgICAgICAgc2V0Q2hhcnRTdHlsZShjb25maWdPYmouY2hhcnRTdHlsZSwgdHJ1ZSk7XG4gICAgICAgIHNldE1pbkJ1cnN0KGNvbmZpZ09iai5taW5CdXJzdCwgdHJ1ZSk7XG4gICAgICAgIHNldE1pbkJ1cnN0Q3VzdG9tU3BlZWQoY29uZmlnT2JqLm1pbkJ1cnN0Q3VzdG9tU3BlZWQsIHRydWUpO1xuICAgICAgICBzZXRNaW5XcG0oY29uZmlnT2JqLm1pbldwbSwgdHJ1ZSk7XG4gICAgICAgIHNldE1pbldwbUN1c3RvbVNwZWVkKGNvbmZpZ09iai5taW5XcG1DdXN0b21TcGVlZCwgdHJ1ZSk7XG4gICAgICAgIHNldE1pbkFjYyhjb25maWdPYmoubWluQWNjLCB0cnVlKTtcbiAgICAgICAgc2V0TWluQWNjQ3VzdG9tKGNvbmZpZ09iai5taW5BY2NDdXN0b20sIHRydWUpO1xuICAgICAgICBzZXROdW1iZXJzKGNvbmZpZ09iai5udW1iZXJzLCB0cnVlKTtcbiAgICAgICAgc2V0UHVuY3R1YXRpb24oY29uZmlnT2JqLnB1bmN0dWF0aW9uLCB0cnVlKTtcbiAgICAgICAgc2V0SGlnaGxpZ2h0TW9kZShjb25maWdPYmouaGlnaGxpZ2h0TW9kZSwgdHJ1ZSk7XG4gICAgICAgIHNldEFsd2F5c1Nob3dDUE0oY29uZmlnT2JqLmFsd2F5c1Nob3dDUE0sIHRydWUpO1xuICAgICAgICBzZXRIaWRlRXh0cmFMZXR0ZXJzKGNvbmZpZ09iai5oaWRlRXh0cmFMZXR0ZXJzLCB0cnVlKTtcbiAgICAgICAgc2V0U3RhcnRHcmFwaHNBdFplcm8oY29uZmlnT2JqLnN0YXJ0R3JhcGhzQXRaZXJvLCB0cnVlKTtcbiAgICAgICAgc2V0U3RyaWN0U3BhY2UoY29uZmlnT2JqLnN0cmljdFNwYWNlLCB0cnVlKTtcbiAgICAgICAgc2V0T3Bwb3NpdGVTaGlmdE1vZGUoY29uZmlnT2JqLm9wcG9zaXRlU2hpZnRNb2RlLCB0cnVlKTtcbiAgICAgICAgc2V0TW9kZShjb25maWdPYmoubW9kZSwgdHJ1ZSk7XG4gICAgICAgIHNldE1vbmtleShjb25maWdPYmoubW9ua2V5LCB0cnVlKTtcbiAgICAgICAgc2V0UmVwZWF0UXVvdGVzKGNvbmZpZ09iai5yZXBlYXRRdW90ZXMsIHRydWUpO1xuICAgICAgICBzZXRNb25rZXlQb3dlckxldmVsKGNvbmZpZ09iai5tb25rZXlQb3dlckxldmVsLCB0cnVlKTtcbiAgICAgICAgc2V0QnVyc3RIZWF0bWFwKGNvbmZpZ09iai5idXJzdEhlYXRtYXAsIHRydWUpO1xuICAgICAgICBzZXRCcml0aXNoRW5nbGlzaChjb25maWdPYmouYnJpdGlzaEVuZ2xpc2gsIHRydWUpO1xuICAgICAgICBzZXRMYXp5TW9kZShjb25maWdPYmoubGF6eU1vZGUsIHRydWUpO1xuICAgICAgICBzZXRTaG93QXZlcmFnZShjb25maWdPYmouc2hvd0F2ZXJhZ2UsIHRydWUpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgc2V0RW5hYmxlQWRzKGNvbmZpZ09iai5lbmFibGVBZHMsIHRydWUpO1xuICAgICAgICAgICAgaWYgKGNvbmZpZy5lbmFibGVBZHMgPT09IFwibWF4XCIgfHwgY29uZmlnLmVuYWJsZUFkcyA9PT0gXCJvblwiKSB7XG4gICAgICAgICAgICAgICAgJChcImhlYWRcIikuYXBwZW5kKGBcbiAgICAgICAgICA8c2NyaXB0XG4gICAgICAgICAgc3JjPVwiaHR0cHM6Ly9oYi52bnRzbS5jb20vdjMvbGl2ZS9hZC1tYW5hZ2VyLm1pbi5qc1wiXG4gICAgICAgICAgdHlwZT1cInRleHQvamF2YXNjcmlwdFwiXG4gICAgICAgICAgZGF0YS1zaXRlLWlkPVwiNjBiNzhhZjEyMTE5MTIyYjg5NTg5MTBmXCJcbiAgICAgICAgICBkYXRhLW1vZGU9XCJzY2FuXCJcbiAgICAgICAgICBpZD1cImFkU2NyaXB0XCJcbiAgICAgICAgICBhc3luY1xuICAgICAgICAgID48L3NjcmlwdD5cbiAgICAgICAgYCk7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5lbmFibGVBZHMgPT09IFwibWF4XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgICAgJChcIiNhZF9yaWNoX21lZGlhXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiI2FkX3JpY2hfbWVkaWFcIikuaHRtbChgPGRpdiBjbGFzcz1cInZtLXBsYWNlbWVudFwiIGRhdGEtaWQ9XCI2MGJmNzM3ZWUwNGNiNzYxYzg4YWFmYjFcIiBzdHlsZT1cImRpc3BsYXk6bm9uZVwiPjwvZGl2PmApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJChcIiNhZF9yaWNoX21lZGlhXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLzxkaXYgY2xhc3M9XCJ2bS1wbGFjZW1lbnRcIiBkYXRhLWlkPVwiNjBiZjczZGFlMDRjYjc2MWM4OGFhZmI1XCI+PC9kaXY+XG4gICAgICAgICAgICAgICAgJChcIiNhZF9mb290ZXJcIikuaHRtbChgPGRpdiBjbGFzcz1cInZtLXBsYWNlbWVudFwiIGRhdGEtaWQ9XCI2MGJmNzNkYWUwNGNiNzYxYzg4YWFmYjVcIj48L2Rpdj5gKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX2Zvb3RlclwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAvLyAkKFwiI2FkX2Zvb3RlcjJcIikuaHRtbChgPGRpdiBjbGFzcz1cInZtLXBsYWNlbWVudFwiIGRhdGEtaWQ9XCI2MGJmNzNlOWUwNGNiNzYxYzg4YWFmYjdcIj48L2Rpdj5gKTtcbiAgICAgICAgICAgICAgICAvLyAkKFwiI2FkX2Zvb3RlcjJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9hYm91dDFcIikuaHRtbChgPGRpdiBjbGFzcz1cInZtLXBsYWNlbWVudFwiIGRhdGEtaWQ9XCI2MGJmNzNkYWUwNGNiNzYxYzg4YWFmYjVcIj48L2Rpdj5gKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX2Fib3V0MVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX2Fib3V0MlwiKS5odG1sKGA8ZGl2IGNsYXNzPVwidm0tcGxhY2VtZW50XCIgZGF0YS1pZD1cIjYwYmY3M2RhZTA0Y2I3NjFjODhhYWZiNVwiPjwvZGl2PmApO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfYWJvdXQyXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfc2V0dGluZ3MwXCIpLmh0bWwoYDxkaXYgY2xhc3M9XCJ2bS1wbGFjZW1lbnRcIiBkYXRhLWlkPVwiNjBiZjczZGFlMDRjYjc2MWM4OGFhZmI1XCI+PC9kaXY+YCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9zZXR0aW5nczBcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9zZXR0aW5nczFcIikuaHRtbChgPGRpdiBjbGFzcz1cInZtLXBsYWNlbWVudFwiIGRhdGEtaWQ9XCI2MGJmNzNkYWUwNGNiNzYxYzg4YWFmYjVcIj48L2Rpdj5gKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX3NldHRpbmdzMVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX3NldHRpbmdzMlwiKS5odG1sKGA8ZGl2IGNsYXNzPVwidm0tcGxhY2VtZW50XCIgZGF0YS1pZD1cIjYwYmY3M2RhZTA0Y2I3NjFjODhhYWZiNVwiPjwvZGl2PmApO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfc2V0dGluZ3MyXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfc2V0dGluZ3MzXCIpLmh0bWwoYDxkaXYgY2xhc3M9XCJ2bS1wbGFjZW1lbnRcIiBkYXRhLWlkPVwiNjBiZjczZGFlMDRjYjc2MWM4OGFhZmI1XCI+PC9kaXY+YCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9zZXR0aW5nczNcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9hY2NvdW50XCIpLmh0bWwoYDxkaXYgY2xhc3M9XCJ2bS1wbGFjZW1lbnRcIiBkYXRhLWlkPVwiNjBiZjczZGFlMDRjYjc2MWM4OGFhZmI1XCI+PC9kaXY+YCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9hY2NvdW50XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICQoXCIuZm9vdGVyYWRzXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJChcIiNhZFNjcmlwdFwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKFwiLmZvb3RlcmFkc1wiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX2xlZnRcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9yaWdodFwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX2Zvb3RlclwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX2Zvb3RlcjJcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9mb290ZXIzXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfc2V0dGluZ3MwXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfc2V0dGluZ3MxXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfc2V0dGluZ3MyXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfc2V0dGluZ3MzXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfYWNjb3VudFwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX2Fib3V0MVwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX2Fib3V0MlwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJFcnJvciBpbml0aWFsaXNpbmcgYWRzOiBcIiArIGUubWVzc2FnZSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yIGluaXRpYWxpc2luZyBhZHMgXCIgKyBlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgJChcIi5mb290ZXJhZHNcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAkKFwiI2FkX2xlZnRcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAkKFwiI2FkX3JpZ2h0XCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgJChcIiNhZF9mb290ZXJcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAkKFwiI2FkX2Zvb3RlcjJcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAkKFwiI2FkX2Zvb3RlcjNcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAkKFwiI2FkX3NldHRpbmdzMFwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICQoXCIjYWRfc2V0dGluZ3MxXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgJChcIiNhZF9zZXR0aW5nczJcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAkKFwiI2FkX3NldHRpbmdzM1wiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICQoXCIjYWRfYWNjb3VudFwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICQoXCIjYWRfYWJvdXQxXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgJChcIiNhZF9hYm91dDJcIikucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJjb25maWdBcHBsaWVkXCIsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGNvbmZpZyk7XG4gICAgfVxufVxuZXhwb3J0cy5hcHBseSA9IGFwcGx5O1xuZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJmdWxsQ29uZmlnQ2hhbmdlXCIpO1xuICAgIGFwcGx5KGRlZmF1bHRfY29uZmlnXzEuZGVmYXVsdCk7XG4gICAgc2F2ZUZ1bGxDb25maWdUb0xvY2FsU3RvcmFnZSgpO1xufVxuZXhwb3J0cy5yZXNldCA9IHJlc2V0O1xuZnVuY3Rpb24gbG9hZEZyb21Mb2NhbFN0b3JhZ2UoKSB7XG4gICAgY29uc29sZS5sb2coXCJsb2FkaW5nIGxvY2FsU3RvcmFnZSBjb25maWdcIik7XG4gICAgY29uc3QgbmV3Q29uZmlnU3RyaW5nID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiY29uZmlnXCIpO1xuICAgIGxldCBuZXdDb25maWc7XG4gICAgaWYgKG5ld0NvbmZpZ1N0cmluZyAhPT0gdW5kZWZpbmVkICYmXG4gICAgICAgIG5ld0NvbmZpZ1N0cmluZyAhPT0gbnVsbCAmJlxuICAgICAgICBuZXdDb25maWdTdHJpbmcgIT09IFwiXCIpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG5ld0NvbmZpZyA9IEpTT04ucGFyc2UobmV3Q29uZmlnU3RyaW5nKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgbmV3Q29uZmlnID0ge307XG4gICAgICAgIH1cbiAgICAgICAgYXBwbHkobmV3Q29uZmlnKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJhcHBseWluZyBsb2NhbFN0b3JhZ2UgY29uZmlnXCIpO1xuICAgICAgICBleHBvcnRzLmxvY2FsU3RvcmFnZUNvbmZpZyA9IG5ld0NvbmZpZztcbiAgICAgICAgc2F2ZUZ1bGxDb25maWdUb0xvY2FsU3RvcmFnZSh0cnVlKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJzYXZpbmcgbG9jYWxTdG9yYWdlIGNvbmZpZ1wiKTtcbiAgICB9XG4gICAgLy8gVGVzdExvZ2ljLnJlc3RhcnQoZmFsc2UsIHRydWUpO1xuICAgIGxvYWREb25lKCk7XG59XG5leHBvcnRzLmxvYWRGcm9tTG9jYWxTdG9yYWdlID0gbG9hZEZyb21Mb2NhbFN0b3JhZ2U7XG5mdW5jdGlvbiBnZXRDb25maWdDaGFuZ2VzKCkge1xuICAgIGNvbnN0IGNvbmZpZ0NoYW5nZXMgPSB7fTtcbiAgICBPYmplY3Qua2V5cyhjb25maWcpXG4gICAgICAgIC5maWx0ZXIoKGtleSkgPT4ge1xuICAgICAgICByZXR1cm4gY29uZmlnW2tleV0gIT0gZGVmYXVsdF9jb25maWdfMS5kZWZhdWx0W2tleV07XG4gICAgfSlcbiAgICAgICAgLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICBjb25maWdDaGFuZ2VzW2tleV0gPSBjb25maWdba2V5XTtcbiAgICB9KTtcbiAgICByZXR1cm4gY29uZmlnQ2hhbmdlcztcbn1cbmV4cG9ydHMuZ2V0Q29uZmlnQ2hhbmdlcyA9IGdldENvbmZpZ0NoYW5nZXM7XG5mdW5jdGlvbiBzZXRDb25maWcobmV3Q29uZmlnKSB7XG4gICAgY29uZmlnID0gbmV3Q29uZmlnO1xufVxuZXhwb3J0cy5zZXRDb25maWcgPSBzZXRDb25maWc7XG5leHBvcnRzLmxvYWRQcm9taXNlID0gbmV3IFByb21pc2UoKHYpID0+IHtcbiAgICBsb2FkRG9uZSA9IHY7XG59KTtcbmV4cG9ydHMuZGVmYXVsdCA9IGNvbmZpZztcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5kZWZhdWx0ID0ge1xuICAgIHRoZW1lOiBcInNlcmlrYV9kYXJrXCIsXG4gICAgdGhlbWVMaWdodDogXCJzZXJpa2FcIixcbiAgICB0aGVtZURhcms6IFwic2VyaWthX2RhcmtcIixcbiAgICBhdXRvU3dpdGNoVGhlbWU6IGZhbHNlLFxuICAgIGN1c3RvbVRoZW1lOiBmYWxzZSxcbiAgICBjdXN0b21UaGVtZUNvbG9yczogW1xuICAgICAgICBcIiMzMjM0MzdcIixcbiAgICAgICAgXCIjZTJiNzE0XCIsXG4gICAgICAgIFwiI2UyYjcxNFwiLFxuICAgICAgICBcIiM2NDY2NjlcIixcbiAgICAgICAgXCIjZDFkMGM1XCIsXG4gICAgICAgIFwiI2NhNDc1NFwiLFxuICAgICAgICBcIiM3ZTJhMzNcIixcbiAgICAgICAgXCIjY2E0NzU0XCIsXG4gICAgICAgIFwiIzdlMmEzM1wiLFxuICAgIF0sXG4gICAgZmF2VGhlbWVzOiBbXSxcbiAgICBzaG93S2V5VGlwczogdHJ1ZSxcbiAgICBzaG93TGl2ZVdwbTogZmFsc2UsXG4gICAgc2hvd1RpbWVyUHJvZ3Jlc3M6IHRydWUsXG4gICAgc21vb3RoQ2FyZXQ6IHRydWUsXG4gICAgcXVpY2tUYWI6IGZhbHNlLFxuICAgIHB1bmN0dWF0aW9uOiBmYWxzZSxcbiAgICBudW1iZXJzOiBmYWxzZSxcbiAgICB3b3JkczogNTAsXG4gICAgdGltZTogMzAsXG4gICAgbW9kZTogXCJ0aW1lXCIsXG4gICAgcXVvdGVMZW5ndGg6IFsxXSxcbiAgICBsYW5ndWFnZTogXCJlbmdsaXNoXCIsXG4gICAgZm9udFNpemU6IFwiMTVcIixcbiAgICBmcmVlZG9tTW9kZTogZmFsc2UsXG4gICAgcmVzdWx0RmlsdGVyczogbnVsbCxcbiAgICBkaWZmaWN1bHR5OiBcIm5vcm1hbFwiLFxuICAgIGJsaW5kTW9kZTogZmFsc2UsXG4gICAgcXVpY2tFbmQ6IGZhbHNlLFxuICAgIGNhcmV0U3R5bGU6IFwiZGVmYXVsdFwiLFxuICAgIHBhY2VDYXJldFN0eWxlOiBcImRlZmF1bHRcIixcbiAgICBmbGlwVGVzdENvbG9yczogZmFsc2UsXG4gICAgbGF5b3V0OiBcImRlZmF1bHRcIixcbiAgICBmdW5ib3g6IFwibm9uZVwiLFxuICAgIGNvbmZpZGVuY2VNb2RlOiBcIm9mZlwiLFxuICAgIGluZGljYXRlVHlwb3M6IFwib2ZmXCIsXG4gICAgdGltZXJTdHlsZTogXCJtaW5pXCIsXG4gICAgY29sb3JmdWxNb2RlOiBmYWxzZSxcbiAgICByYW5kb21UaGVtZTogXCJvZmZcIixcbiAgICB0aW1lckNvbG9yOiBcIm1haW5cIixcbiAgICB0aW1lck9wYWNpdHk6IFwiMVwiLFxuICAgIHN0b3BPbkVycm9yOiBcIm9mZlwiLFxuICAgIHNob3dBbGxMaW5lczogZmFsc2UsXG4gICAga2V5bWFwTW9kZTogXCJvZmZcIixcbiAgICBrZXltYXBTdHlsZTogXCJzdGFnZ2VyZWRcIixcbiAgICBrZXltYXBMZWdlbmRTdHlsZTogXCJsb3dlcmNhc2VcIixcbiAgICBrZXltYXBMYXlvdXQ6IFwib3ZlcnJpZGVTeW5jXCIsXG4gICAgZm9udEZhbWlseTogXCJSb2JvdG9fTW9ub1wiLFxuICAgIHNtb290aExpbmVTY3JvbGw6IGZhbHNlLFxuICAgIGFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzOiBmYWxzZSxcbiAgICBhbHdheXNTaG93V29yZHNIaXN0b3J5OiBmYWxzZSxcbiAgICBzaW5nbGVMaXN0Q29tbWFuZExpbmU6IFwibWFudWFsXCIsXG4gICAgY2Fwc0xvY2tXYXJuaW5nOiB0cnVlLFxuICAgIHBsYXlTb3VuZE9uRXJyb3I6IGZhbHNlLFxuICAgIHBsYXlTb3VuZE9uQ2xpY2s6IFwib2ZmXCIsXG4gICAgc291bmRWb2x1bWU6IFwiMC41XCIsXG4gICAgc3RhcnRHcmFwaHNBdFplcm86IHRydWUsXG4gICAgc3dhcEVzY0FuZFRhYjogZmFsc2UsXG4gICAgc2hvd091dE9mRm9jdXNXYXJuaW5nOiB0cnVlLFxuICAgIHBhY2VDYXJldDogXCJvZmZcIixcbiAgICBwYWNlQ2FyZXRDdXN0b21TcGVlZDogMTAwLFxuICAgIHJlcGVhdGVkUGFjZTogdHJ1ZSxcbiAgICBwYWdlV2lkdGg6IFwiMTAwXCIsXG4gICAgY2hhcnRBY2N1cmFjeTogdHJ1ZSxcbiAgICBjaGFydFN0eWxlOiBcImxpbmVcIixcbiAgICBtaW5XcG06IFwib2ZmXCIsXG4gICAgbWluV3BtQ3VzdG9tU3BlZWQ6IDEwMCxcbiAgICBoaWdobGlnaHRNb2RlOiBcImxldHRlclwiLFxuICAgIGFsd2F5c1Nob3dDUE06IGZhbHNlLFxuICAgIGVuYWJsZUFkczogXCJvZmZcIixcbiAgICBoaWRlRXh0cmFMZXR0ZXJzOiBmYWxzZSxcbiAgICBzdHJpY3RTcGFjZTogZmFsc2UsXG4gICAgbWluQWNjOiBcIm9mZlwiLFxuICAgIG1pbkFjY0N1c3RvbTogOTAsXG4gICAgc2hvd0xpdmVBY2M6IGZhbHNlLFxuICAgIHNob3dMaXZlQnVyc3Q6IGZhbHNlLFxuICAgIG1vbmtleTogZmFsc2UsXG4gICAgcmVwZWF0UXVvdGVzOiBcIm9mZlwiLFxuICAgIG9wcG9zaXRlU2hpZnRNb2RlOiBcIm9mZlwiLFxuICAgIGN1c3RvbUJhY2tncm91bmQ6IFwiXCIsXG4gICAgY3VzdG9tQmFja2dyb3VuZFNpemU6IFwiY292ZXJcIixcbiAgICBjdXN0b21CYWNrZ3JvdW5kRmlsdGVyOiBbMCwgMSwgMSwgMSwgMV0sXG4gICAgY3VzdG9tTGF5b3V0Zmx1aWQ6IFwicXdlcnR5I2R2b3JhayNjb2xlbWFrXCIsXG4gICAgbW9ua2V5UG93ZXJMZXZlbDogXCJvZmZcIixcbiAgICBtaW5CdXJzdDogXCJvZmZcIixcbiAgICBtaW5CdXJzdEN1c3RvbVNwZWVkOiAxMDAsXG4gICAgYnVyc3RIZWF0bWFwOiBmYWxzZSxcbiAgICBicml0aXNoRW5nbGlzaDogZmFsc2UsXG4gICAgbGF6eU1vZGU6IGZhbHNlLFxuICAgIHNob3dBdmVyYWdlOiBcIm9mZlwiLFxufTtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5kZWZhdWx0U25hcCA9IHZvaWQgMDtcbmV4cG9ydHMuZGVmYXVsdFNuYXAgPSB7XG4gICAgcmVzdWx0czogdW5kZWZpbmVkLFxuICAgIHBlcnNvbmFsQmVzdHM6IHtcbiAgICAgICAgdGltZToge30sXG4gICAgICAgIHdvcmRzOiB7fSxcbiAgICAgICAgemVuOiB7IHplbjogW10gfSxcbiAgICAgICAgcXVvdGU6IHsgY3VzdG9tOiBbXSB9LFxuICAgICAgICBjdXN0b206IHsgY3VzdG9tOiBbXSB9LFxuICAgIH0sXG4gICAgbmFtZTogXCJcIixcbiAgICBjdXN0b21UaGVtZXM6IFtdLFxuICAgIHByZXNldHM6IFtdLFxuICAgIHRhZ3M6IFtdLFxuICAgIGZhdm91cml0ZVRoZW1lczogW10sXG4gICAgYmFubmVkOiB1bmRlZmluZWQsXG4gICAgdmVyaWZpZWQ6IHVuZGVmaW5lZCxcbiAgICBlbWFpbFZlcmlmaWVkOiB1bmRlZmluZWQsXG4gICAgbGJNZW1vcnk6IHsgdGltZTogeyAxNTogeyBlbmdsaXNoOiAwIH0sIDYwOiB7IGVuZ2xpc2g6IDAgfSB9IH0sXG4gICAgZ2xvYmFsU3RhdHM6IHtcbiAgICAgICAgdGltZTogMCxcbiAgICAgICAgc3RhcnRlZDogMCxcbiAgICAgICAgY29tcGxldGVkOiAwLFxuICAgIH0sXG4gICAgcXVvdGVSYXRpbmdzOiB1bmRlZmluZWQsXG4gICAgcXVvdGVNb2Q6IGZhbHNlLFxufTtcbiIsIlwidXNlIHN0cmljdFwiO1xuLy8gVG8gZmluZCB5b3VyIGNvbmZpZywgZ28gdG8gaHR0cHM6Ly9jb25zb2xlLmZpcmViYXNlLmdvb2dsZS5jb20vIGFuZCBzZWxlY3QgeW91ciBwcm9qZWN0XG4vLyBHbyB0byAodG9wIGxlZnQpIFNldHRpbmdzID4gUHJvamVjdCBTZXR0aW5ncyA+IEdlbmVyYWxcbi8vIHNjcm9sbCBkb3duIHRvIFlvdXIgYXBwcyA+IFdlYiBBcHBzIChpZiBpdCBkb2VzbnQgZXhpc3QsIGNyZWF0ZSBvbmUpID4gU0RLIHNldHVwIGFuZCBjb25maWd1cmF0aW9uID4gc2VsZWN0IG5wbVxuLy8geW91ciBjb25maWcgc2hvdWxkIGJlIHZpc2libGUgdGhlcmVcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZmlyZWJhc2VDb25maWcgPSB2b2lkIDA7XG5leHBvcnRzLmZpcmViYXNlQ29uZmlnID0ge1xuICAgIGFwaUtleTogXCJBSXphU3lDOFpHbENuYVlKWXN6NWJzTXRtSkdidThRcXRDVnBNNGdcIixcbiAgICBhdXRoRG9tYWluOiBcIm1vbmtleXR5cGUtZDQ0MGEuZmlyZWJhc2VhcHAuY29tXCIsXG4gICAgcHJvamVjdElkOiBcIm1vbmtleXR5cGUtZDQ0MGFcIixcbiAgICBzdG9yYWdlQnVja2V0OiBcIm1vbmtleXR5cGUtZDQ0MGEuYXBwc3BvdC5jb21cIixcbiAgICBtZXNzYWdpbmdTZW5kZXJJZDogXCI0MDk3OTg3NDU0MzBcIixcbiAgICBhcHBJZDogXCIxOjQwOTc5ODc0NTQzMDp3ZWI6Njg0MzU1N2IzNmEyNTE1NjM3MGFmN1wiXG59O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zaWduT3V0ID0gZXhwb3J0cy5hZGRQYXNzd29yZEF1dGggPSBleHBvcnRzLnJlbW92ZUdvb2dsZUF1dGggPSBleHBvcnRzLmFkZEdvb2dsZUF1dGggPSBleHBvcnRzLnNpZ25JbldpdGhHb29nbGUgPSBleHBvcnRzLnNpZ25JbiA9IGV4cG9ydHMuZ2V0RGF0YUFuZEluaXQgPSBleHBvcnRzLnNlbmRWZXJpZmljYXRpb25FbWFpbCA9IGV4cG9ydHMuZ21haWxQcm92aWRlciA9IHZvaWQgMDtcbmNvbnN0IGFwZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9hcGVcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBBY2NvdW50QnV0dG9uID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9hY2NvdW50LWJ1dHRvblwiKSk7XG5jb25zdCBBY2NvdW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wYWdlcy9hY2NvdW50XCIpKTtcbmNvbnN0IFZlcmlmaWNhdGlvbkNvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdmVyaWZpY2F0aW9uLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBTZXR0aW5ncyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcGFnZXMvc2V0dGluZ3NcIikpO1xuY29uc3QgQWxsVGltZVN0YXRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9hY2NvdW50L2FsbC10aW1lLXN0YXRzXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBUZXN0TG9naWMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC1sb2dpY1wiKSk7XG5jb25zdCBQYWdlQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9wYWdlLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgUFNBID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9wc2FcIikpO1xuY29uc3QgRm9jdXMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvZm9jdXNcIikpO1xuY29uc3QgTG9hZGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sb2FkZXJcIikpO1xuY29uc3QgUGFnZVRyYW5zaXRpb24gPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9wYWdlLXRyYW5zaXRpb25cIikpO1xuY29uc3QgQWN0aXZlUGFnZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL2FjdGl2ZS1wYWdlXCIpKTtcbmNvbnN0IFRlc3RBY3RpdmUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy90ZXN0LWFjdGl2ZVwiKSk7XG5jb25zdCBMb2FkaW5nUGFnZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcGFnZXMvbG9hZGluZ1wiKSk7XG5jb25zdCBSZXN1bHRGaWx0ZXJzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9hY2NvdW50L3Jlc3VsdC1maWx0ZXJzXCIpKTtcbmNvbnN0IFBhY2VDYXJldCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9wYWNlLWNhcmV0XCIpKTtcbmNvbnN0IENvbW1hbmRsaW5lTGlzdHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2NvbW1hbmRsaW5lLWxpc3RzXCIpKTtcbmNvbnN0IFRhZ0NvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGFnLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgUmVzdWx0VGFnc1BvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wb3B1cHMvcmVzdWx0LXRhZ3MtcG9wdXBcIikpO1xuY29uc3QgVVJMSGFuZGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvdXJsLWhhbmRsZXJcIikpO1xuY29uc3QgYXV0aF8xID0gcmVxdWlyZShcImZpcmViYXNlL2F1dGhcIik7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xuY29uc3QgZGlmZmVyZW5jZUluRGF5c18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJkYXRlLWZucy9kaWZmZXJlbmNlSW5EYXlzXCIpKTtcbmNvbnN0IGRlZmF1bHRfc25hcHNob3RfMSA9IHJlcXVpcmUoXCIuLi9jb25zdGFudHMvZGVmYXVsdC1zbmFwc2hvdFwiKTtcbmV4cG9ydHMuZ21haWxQcm92aWRlciA9IG5ldyBhdXRoXzEuR29vZ2xlQXV0aFByb3ZpZGVyKCk7XG5mdW5jdGlvbiBzZW5kVmVyaWZpY2F0aW9uRW1haWwoKSB7XG4gICAgTG9hZGVyLnNob3coKTtcbiAgICBjb25zdCB1c2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgIGlmICh1c2VyID09PSBudWxsKVxuICAgICAgICByZXR1cm47XG4gICAgKDAsIGF1dGhfMS5zZW5kRW1haWxWZXJpZmljYXRpb24pKHVzZXIpXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJFbWFpbCBzZW50IHRvIFwiICsgdXNlci5lbWFpbCwgNDAwMCk7XG4gICAgfSlcbiAgICAgICAgLmNhdGNoKChlKSA9PiB7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRXJyb3I6IFwiICsgZS5tZXNzYWdlLCAzMDAwKTtcbiAgICAgICAgY29uc29sZS5lcnJvcihlLm1lc3NhZ2UpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5zZW5kVmVyaWZpY2F0aW9uRW1haWwgPSBzZW5kVmVyaWZpY2F0aW9uRW1haWw7XG5mdW5jdGlvbiBnZXREYXRhQW5kSW5pdCgpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZ2V0dGluZyBhY2NvdW50IGRhdGFcIik7XG4gICAgICAgICAgICBpZiAoQWN0aXZlUGFnZS5nZXQoKSA9PT0gXCJsb2FkaW5nXCIpIHtcbiAgICAgICAgICAgICAgICBMb2FkaW5nUGFnZS51cGRhdGVCYXIoOTApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgTG9hZGluZ1BhZ2UudXBkYXRlQmFyKDQ1KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIExvYWRpbmdQYWdlLnVwZGF0ZVRleHQoXCJEb3dubG9hZGluZyB1c2VyIGRhdGEuLi5cIik7XG4gICAgICAgICAgICB5aWVsZCBMb2FkaW5nUGFnZS5zaG93QmFyKCk7XG4gICAgICAgICAgICB5aWVsZCBEQi5pbml0U25hcHNob3QoKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBlcnJvcjtcbiAgICAgICAgICAgIEFjY291bnRCdXR0b24ubG9hZGluZyhmYWxzZSk7XG4gICAgICAgICAgICBpZiAoZS5yZXNwb25zZUNvZGUgPT09IDQyOSkge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRG9pbmcgc28gd2lsbCBzYXZlIHlvdSBiYW5kd2lkdGgsIG1ha2UgdGhlIG5leHQgdGVzdCBiZSByZWFkeSBmYXN0ZXIgYW5kIHdpbGwgbm90IHNpZ24geW91IG91dCAod2hpY2ggY291bGQgbWVhbiB5b3VyIG5ldyBwZXJzb25hbCBiZXN0IHdvdWxkIG5vdCBzYXZlIHRvIHlvdXIgYWNjb3VudCkuXCIsIDAsIDApO1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiWW91IHdpbGwgcnVuIGludG8gdGhpcyBlcnJvciBpZiB5b3UgcmVmcmVzaCB0aGUgd2Vic2l0ZSB0byByZXN0YXJ0IHRoZSB0ZXN0LiBJdCBpcyBOT1QgcmVjb21tZW5kZWQgdG8gZG8gdGhhdC4gSW5zdGVhZCwgdXNlIHRhYiArIGVudGVyIG9yIGp1c3QgdGFiICh3aXRoIHF1aWNrIHRhYiBtb2RlIGVuYWJsZWQpIHRvIHJlc3RhcnQgdGhlIHRlc3QuXCIsIDAsIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbXNnID0gZS5tZXNzYWdlIHx8IGU7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBnZXQgdXNlciBkYXRhOiBcIiArIG1zZywgLTEpO1xuICAgICAgICAgICAgJChcIiN0b3AgI21lbnUgLmFjY291bnRcIikuY3NzKFwib3BhY2l0eVwiLCAxKTtcbiAgICAgICAgICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09PSBcImxvYWRpbmdcIilcbiAgICAgICAgICAgICAgICBQYWdlQ29udHJvbGxlci5jaGFuZ2UoXCJcIik7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT0gXCJsb2FkaW5nXCIpIHtcbiAgICAgICAgICAgIExvYWRpbmdQYWdlLnVwZGF0ZUJhcigxMDApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgTG9hZGluZ1BhZ2UudXBkYXRlQmFyKDQ1KTtcbiAgICAgICAgfVxuICAgICAgICBMb2FkaW5nUGFnZS51cGRhdGVUZXh0KFwiQXBwbHlpbmcgc2V0dGluZ3MuLi5cIik7XG4gICAgICAgIGNvbnN0IHNuYXBzaG90ID0gREIuZ2V0U25hcHNob3QoKTtcbiAgICAgICAgJChcIiNtZW51IC5pY29uLWJ1dHRvbi5hY2NvdW50IC50ZXh0XCIpLnRleHQoc25hcHNob3QubmFtZSk7XG4gICAgICAgIFJlc3VsdEZpbHRlcnMubG9hZFRhZ3Moc25hcHNob3QudGFncyk7XG4gICAgICAgIFByb21pc2UuYWxsKFtNaXNjLmdldExhbmd1YWdlTGlzdCgpLCBNaXNjLmdldEZ1bmJveExpc3QoKV0pLnRoZW4oKHZhbHVlcykgPT4ge1xuICAgICAgICAgICAgY29uc3QgW2xhbmd1YWdlcywgZnVuYm94ZXNdID0gdmFsdWVzO1xuICAgICAgICAgICAgbGFuZ3VhZ2VzLmZvckVhY2goKGxhbmd1YWdlKSA9PiB7XG4gICAgICAgICAgICAgICAgUmVzdWx0RmlsdGVycy5kZWZhdWx0UmVzdWx0RmlsdGVycy5sYW5ndWFnZVtsYW5ndWFnZV0gPSB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBmdW5ib3hlcy5mb3JFYWNoKChmdW5ib3gpID0+IHtcbiAgICAgICAgICAgICAgICBSZXN1bHRGaWx0ZXJzLmRlZmF1bHRSZXN1bHRGaWx0ZXJzLmZ1bmJveFtmdW5ib3gubmFtZV0gPSB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBmaWx0ZXJzID0gZGVmYXVsdFJlc3VsdEZpbHRlcnM7XG4gICAgICAgICAgICBSZXN1bHRGaWx0ZXJzLmxvYWQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghc25hcHNob3QubmFtZSkge1xuICAgICAgICAgICAgLy92ZXJpZnkgdXNlcm5hbWVcbiAgICAgICAgICAgIC8vaW52YWxpZCwgZ2V0IG5ld1xuICAgICAgICAgICAgbGV0IG5hbWVHb29kID0gZmFsc2U7XG4gICAgICAgICAgICBsZXQgbmFtZSA9IFwiXCI7XG4gICAgICAgICAgICB3aGlsZSAoIW5hbWVHb29kKSB7XG4gICAgICAgICAgICAgICAgbmFtZSA9XG4gICAgICAgICAgICAgICAgICAgIChfYSA9IHByb21wdChcIlBsZWFzZSBwcm92aWRlIGEgbmV3IHVzZXJuYW1lIChjYW5ub3QgYmUgbG9uZ2VyIHRoYW4gMTYgY2hhcmFjdGVycywgY2FuIG9ubHkgY29udGFpbiBsZXR0ZXJzLCBudW1iZXJzLCB1bmRlcnNjb3JlcywgZG90cyBhbmQgZGFzaGVzKTpcIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiXCI7XG4gICAgICAgICAgICAgICAgaWYgKCFuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLnVwZGF0ZU5hbWUobmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHVwZGF0ZSBuYW1lOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBuYW1lR29vZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJOYW1lIHVwZGF0ZWRcIiwgMSk7XG4gICAgICAgICAgICAgICAgc25hcHNob3QubmFtZSA9IG5hbWU7XG4gICAgICAgICAgICAgICAgREIuc2V0U25hcHNob3Qoc25hcHNob3QpO1xuICAgICAgICAgICAgICAgICQoXCIjbWVudSAuaWNvbi1idXR0b24uYWNjb3VudCAudGV4dFwiKS50ZXh0KG5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghVXBkYXRlQ29uZmlnLmNoYW5nZWRCZWZvcmVEYikge1xuICAgICAgICAgICAgLy9jb25maWcgZGlkbnQgY2hhbmdlIGJlZm9yZSBkYiBsb2FkZWRcbiAgICAgICAgICAgIGlmIChVcGRhdGVDb25maWcubG9jYWxTdG9yYWdlQ29uZmlnID09PSBudWxsICYmIHNuYXBzaG90LmNvbmZpZykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibm8gbG9jYWwgY29uZmlnLCBhcHBseWluZyBkYlwiKTtcbiAgICAgICAgICAgICAgICBBY2NvdW50QnV0dG9uLmxvYWRpbmcoZmFsc2UpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5hcHBseShzbmFwc2hvdC5jb25maWcpO1xuICAgICAgICAgICAgICAgIFNldHRpbmdzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zYXZlRnVsbENvbmZpZ1RvTG9jYWxTdG9yYWdlKHRydWUpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHNuYXBzaG90LmNvbmZpZyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgLy9sb2FkaW5nIGRiIGNvbmZpZywga2VlcCBmb3Igbm93XG4gICAgICAgICAgICAgICAgbGV0IGNvbmZpZ3NEaWZmZXJlbnQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhjb25maWdfMS5kZWZhdWx0KS5mb3JFYWNoKChrZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBrZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ3NEaWZmZXJlbnQpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ICE9PSBcInJlc3VsdEZpbHRlcnNcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvbmZpZ18xLmRlZmF1bHRba2V5XSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdFtrZXldLmZvckVhY2goKGFycnZhbCwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5VmFsdWUgPSAoKF9hID0gc25hcHNob3QgPT09IG51bGwgfHwgc25hcHNob3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNuYXBzaG90LmNvbmZpZykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hW2tleV0pW2luZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcnJ2YWwgIT0gYXJyYXlWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3NEaWZmZXJlbnQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAuY29uZmlnIGlzIGRpZmZlcmVudDogJHthcnJ2YWx9ICE9ICR7YXJyYXlWYWx1ZX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdFtrZXldICE9ICgoX2EgPSBzbmFwc2hvdCA9PT0gbnVsbCB8fCBzbmFwc2hvdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogc25hcHNob3QuY29uZmlnKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Fba2V5XSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3NEaWZmZXJlbnQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYC4uY29uZmlnIGlzIGRpZmZlcmVudCAke2tleX06ICR7Y29uZmlnXzEuZGVmYXVsdFtrZXldfSAhPSAkeyhfYiA9IHNuYXBzaG90ID09PSBudWxsIHx8IHNuYXBzaG90ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzbmFwc2hvdC5jb25maWcpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYltrZXldfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3NEaWZmZXJlbnQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYC4uLmNvbmZpZyBpcyBkaWZmZXJlbnRgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChjb25maWdzRGlmZmVyZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY29uZmlncyBhcmUgZGlmZmVyZW50LCBhcHBseWluZyBjb25maWcgZnJvbSBkYlwiKTtcbiAgICAgICAgICAgICAgICAgICAgQWNjb3VudEJ1dHRvbi5sb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLmFwcGx5KHNuYXBzaG90LmNvbmZpZyk7XG4gICAgICAgICAgICAgICAgICAgIFNldHRpbmdzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2F2ZUZ1bGxDb25maWdUb0xvY2FsU3RvcmFnZSh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT0gXCJ0ZXN0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBEQi5zYXZlQ29uZmlnKGNvbmZpZ18xLmRlZmF1bHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXREYkNvbmZpZ0xvYWRlZCh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY29uZmlnIGNoYW5nZWQgYmVmb3JlIGRiXCIpO1xuICAgICAgICAgICAgQWNjb3VudEJ1dHRvbi5sb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5wYWNlQ2FyZXQgPT09IFwicGJcIiB8fCBjb25maWdfMS5kZWZhdWx0LnBhY2VDYXJldCA9PT0gXCJhdmVyYWdlXCIpIHtcbiAgICAgICAgICAgIGlmICghVGVzdEFjdGl2ZS5nZXQoKSkge1xuICAgICAgICAgICAgICAgIFBhY2VDYXJldC5pbml0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgQWNjb3VudEJ1dHRvbi5sb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgUmVzdWx0RmlsdGVycy51cGRhdGVUYWdzKCk7XG4gICAgICAgIENvbW1hbmRsaW5lTGlzdHMudXBkYXRlVGFnQ29tbWFuZHMoKTtcbiAgICAgICAgVGFnQ29udHJvbGxlci5sb2FkQWN0aXZlRnJvbUxvY2FsU3RvcmFnZSgpO1xuICAgICAgICBSZXN1bHRUYWdzUG9wdXAudXBkYXRlQnV0dG9ucygpO1xuICAgICAgICBTZXR0aW5ncy5zaG93QWNjb3VudFNlY3Rpb24oKTtcbiAgICAgICAgUGFnZVRyYW5zaXRpb24uc2V0KGZhbHNlKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJhY2NvdW50IGxvYWRpbmcgZmluaXNoZWRcIik7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xufVxuZXhwb3J0cy5nZXREYXRhQW5kSW5pdCA9IGdldERhdGFBbmRJbml0O1xuZnVuY3Rpb24gbG9hZFVzZXIodXNlcikge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIC8vIFVzZXIgaXMgc2lnbmVkIGluLlxuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5jb250ZW50IHAuYWNjb3VudFZlcmlmaWNhdGluTm90aWNlXCIpLnJlbW92ZSgpO1xuICAgICAgICBpZiAodXNlci5lbWFpbFZlcmlmaWVkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuY29udGVudFwiKS5wcmVwZW5kKGA8cCBjbGFzcz1cImFjY291bnRWZXJpZmljYXRpbk5vdGljZVwiIHN0eWxlPVwidGV4dC1hbGlnbjpjZW50ZXJcIj5Zb3VyIGFjY291bnQgaXMgbm90IHZlcmlmaWVkLiA8YSBjbGFzcz1cInNlbmRWZXJpZmljYXRpb25FbWFpbFwiPlNlbmQgdGhlIHZlcmlmaWNhdGlvbiBlbWFpbCBhZ2FpbjwvYT4uYCk7XG4gICAgICAgIH1cbiAgICAgICAgUGFnZVRyYW5zaXRpb24uc2V0KGZhbHNlKTtcbiAgICAgICAgQWNjb3VudEJ1dHRvbi51cGRhdGUoKTtcbiAgICAgICAgQWNjb3VudEJ1dHRvbi5sb2FkaW5nKHRydWUpO1xuICAgICAgICBpZiAoKHlpZWxkIGdldERhdGFBbmRJbml0KCkpID09PSBmYWxzZSkge1xuICAgICAgICAgICAgc2lnbk91dCgpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHZhciBkaXNwbGF5TmFtZSA9IHVzZXIuZGlzcGxheU5hbWU7XG4gICAgICAgIC8vIHZhciBlbWFpbCA9IHVzZXIuZW1haWw7XG4gICAgICAgIC8vIHZhciBlbWFpbFZlcmlmaWVkID0gdXNlci5lbWFpbFZlcmlmaWVkO1xuICAgICAgICAvLyB2YXIgcGhvdG9VUkwgPSB1c2VyLnBob3RvVVJMO1xuICAgICAgICAvLyB2YXIgaXNBbm9ueW1vdXMgPSB1c2VyLmlzQW5vbnltb3VzO1xuICAgICAgICAvLyB2YXIgdWlkID0gdXNlci51aWQ7XG4gICAgICAgIC8vIHZhciBwcm92aWRlckRhdGEgPSB1c2VyLnByb3ZpZGVyRGF0YTtcbiAgICAgICAgJChcIi5wYWdlTG9naW4gLnByZWxvYWRlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gc2hvd0Zhdm91cml0ZVRoZW1lc0F0VGhlVG9wKCk7XG4gICAgICAgIGxldCB0ZXh0ID0gXCJBY2NvdW50IGNyZWF0ZWQgb24gXCIgKyB1c2VyLm1ldGFkYXRhLmNyZWF0aW9uVGltZTtcbiAgICAgICAgY29uc3QgY3JlYXRpb25EYXRlID0gbmV3IERhdGUodXNlci5tZXRhZGF0YS5jcmVhdGlvblRpbWUpO1xuICAgICAgICBjb25zdCBkaWZmRGF5cyA9ICgwLCBkaWZmZXJlbmNlSW5EYXlzXzEuZGVmYXVsdCkobmV3IERhdGUoKSwgY3JlYXRpb25EYXRlKTtcbiAgICAgICAgdGV4dCArPSBgICgke2RpZmZEYXlzfSBkYXkke2RpZmZEYXlzICE9IDEgPyBcInNcIiA6IFwiXCJ9IGFnbylgO1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5ncm91cC5jcmVhdGVkRGF0ZVwiKS50ZXh0KHRleHQpO1xuICAgICAgICBpZiAoVmVyaWZpY2F0aW9uQ29udHJvbGxlci5kYXRhICE9PSBudWxsKSB7XG4gICAgICAgICAgICBWZXJpZmljYXRpb25Db250cm9sbGVyLnZlcmlmeSh1c2VyLnVpZCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmNvbnN0IGF1dGhMaXN0ZW5lciA9IGZpcmViYXNlXzEuQXV0aC5vbkF1dGhTdGF0ZUNoYW5nZWQoZnVuY3Rpb24gKHVzZXIpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAvLyBhd2FpdCBVcGRhdGVDb25maWcubG9hZFByb21pc2U7XG4gICAgICAgIGNvbnNvbGUubG9nKGBhdXRoIHN0YXRlIGNoYW5nZWQsIHVzZXIgJHt1c2VyID8gdHJ1ZSA6IGZhbHNlfWApO1xuICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgICAgeWllbGQgbG9hZFVzZXIodXNlcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09IFwiL2FjY291bnRcIikge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZShcIlwiLCBcIlwiLCBcIi9sb2dpblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFBhZ2VUcmFuc2l0aW9uLnNldChmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT0gXCIvbG9naW5cIikge1xuICAgICAgICAgICAgICAgIFBhZ2VDb250cm9sbGVyLmNoYW5nZShcImFjY291bnRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgIT0gXCIvYWNjb3VudFwiKSB7XG4gICAgICAgICAgICAgICAgUGFnZUNvbnRyb2xsZXIuY2hhbmdlKCk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIEZvY3VzLnNldChmYWxzZSk7XG4gICAgICAgICAgICAgICAgfSwgMTI1IC8gMik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBBY2NvdW50LnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIC8vIFNpZ25PdXRCdXR0b24uc2hvdygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgUGFnZUNvbnRyb2xsZXIuY2hhbmdlKCk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBGb2N1cy5zZXQoZmFsc2UpO1xuICAgICAgICAgICAgfSwgMTI1IC8gMik7XG4gICAgICAgIH1cbiAgICAgICAgVVJMSGFuZGxlci5sb2FkQ3VzdG9tVGhlbWVGcm9tVXJsKCk7XG4gICAgICAgIGlmICgvY2hhbGxlbmdlXy4rL2cudGVzdCh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUpKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkNoYWxsZW5nZSBsaW5rcyB0ZW1wb3JhcmlseSBkaXNhYmxlZC4gUGxlYXNlIHVzZSB0aGUgY29tbWFuZCBsaW5lIHRvIGxvYWQgdGhlIGNoYWxsZW5nZSBtYW51YWxseVwiLCAwLCA3KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIC8vIE5vdGlmaWNhdGlvbnMuYWRkKFwiTG9hZGluZyBjaGFsbGVuZ2VcIiwgMCk7XG4gICAgICAgICAgICAvLyBsZXQgY2hhbGxlbmdlTmFtZSA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5zcGxpdChcIl9cIilbMV07XG4gICAgICAgICAgICAvLyBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIC8vICAgQ2hhbGxlbmdlQ29udHJvbGxlci5zZXR1cChjaGFsbGVuZ2VOYW1lKTtcbiAgICAgICAgICAgIC8vIH0sIDEwMDApO1xuICAgICAgICB9XG4gICAgICAgIFBTQS5zaG93KCk7XG4gICAgfSk7XG59KTtcbmZ1bmN0aW9uIHNpZ25JbigpIHtcbiAgICBVcGRhdGVDb25maWcuc2V0Q2hhbmdlZEJlZm9yZURiKGZhbHNlKTtcbiAgICBhdXRoTGlzdGVuZXIoKTtcbiAgICAkKFwiLnBhZ2VMb2dpbiAucHJlbG9hZGVyXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICQoXCIucGFnZUxvZ2luIC5idXR0b25cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICBjb25zdCBlbWFpbCA9ICQoXCIucGFnZUxvZ2luIC5sb2dpbiBpbnB1dFwiKVswXS52YWx1ZTtcbiAgICBjb25zdCBwYXNzd29yZCA9ICQoXCIucGFnZUxvZ2luIC5sb2dpbiBpbnB1dFwiKVsxXS52YWx1ZTtcbiAgICBjb25zdCBwZXJzaXN0ZW5jZSA9ICQoXCIucGFnZUxvZ2luIC5sb2dpbiAjcmVtZW1iZXJNZSBpbnB1dFwiKS5wcm9wKFwiY2hlY2tlZFwiKVxuICAgICAgICA/IGF1dGhfMS5icm93c2VyTG9jYWxQZXJzaXN0ZW5jZVxuICAgICAgICA6IGF1dGhfMS5icm93c2VyU2Vzc2lvblBlcnNpc3RlbmNlO1xuICAgICgwLCBhdXRoXzEuc2V0UGVyc2lzdGVuY2UpKGZpcmViYXNlXzEuQXV0aCwgcGVyc2lzdGVuY2UpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gKDAsIGF1dGhfMS5zaWduSW5XaXRoRW1haWxBbmRQYXNzd29yZCkoZmlyZWJhc2VfMS5BdXRoLCBlbWFpbCwgcGFzc3dvcmQpXG4gICAgICAgICAgICAudGhlbigoZSkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgeWllbGQgbG9hZFVzZXIoZS51c2VyKTtcbiAgICAgICAgICAgIFBhZ2VDb250cm9sbGVyLmNoYW5nZShcImFjY291bnRcIik7XG4gICAgICAgICAgICBpZiAoVGVzdExvZ2ljLm5vdFNpZ25lZEluTGFzdFJlc3VsdCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5zZXROb3RTaWduZWRJblVpZChlLnVzZXIudWlkKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucmVzdWx0cy5zYXZlKFRlc3RMb2dpYy5ub3RTaWduZWRJbkxhc3RSZXN1bHQpO1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gc2F2ZSBsYXN0IHJlc3VsdDogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5jbGVhck5vdFNpZ25lZEluUmVzdWx0KCk7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJMYXN0IHRlc3QgcmVzdWx0IHNhdmVkXCIsIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9UT0RPOiByZWRpcmVjdCB1c2VyIHRvIHJlbGV2YW50IHBhZ2VcbiAgICAgICAgfSkpXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICBsZXQgbWVzc2FnZSA9IGVycm9yLm1lc3NhZ2U7XG4gICAgICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT0gXCJhdXRoL3dyb25nLXBhc3N3b3JkXCIpIHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlID0gXCJJbmNvcnJlY3QgcGFzc3dvcmQuXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChlcnJvci5jb2RlID09PSBcImF1dGgvdXNlci1ub3QtZm91bmRcIikge1xuICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBcIlVzZXIgbm90IGZvdW5kLlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQobWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgJChcIi5wYWdlTG9naW4gLnByZWxvYWRlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUxvZ2luIC5idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5leHBvcnRzLnNpZ25JbiA9IHNpZ25JbjtcbmZ1bmN0aW9uIHNpZ25JbldpdGhHb29nbGUoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0Q2hhbmdlZEJlZm9yZURiKGZhbHNlKTtcbiAgICAgICAgJChcIi5wYWdlTG9naW4gLnByZWxvYWRlclwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIi5wYWdlTG9naW4gLmJ1dHRvblwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICBhdXRoTGlzdGVuZXIoKTtcbiAgICAgICAgbGV0IHNpZ25lZEluVXNlcjtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHBlcnNpc3RlbmNlID0gJChcIi5wYWdlTG9naW4gLmxvZ2luICNyZW1lbWJlck1lIGlucHV0XCIpLnByb3AoXCJjaGVja2VkXCIpXG4gICAgICAgICAgICAgICAgPyBhdXRoXzEuYnJvd3NlckxvY2FsUGVyc2lzdGVuY2VcbiAgICAgICAgICAgICAgICA6IGF1dGhfMS5icm93c2VyU2Vzc2lvblBlcnNpc3RlbmNlO1xuICAgICAgICAgICAgeWllbGQgKDAsIGF1dGhfMS5zZXRQZXJzaXN0ZW5jZSkoZmlyZWJhc2VfMS5BdXRoLCBwZXJzaXN0ZW5jZSk7XG4gICAgICAgICAgICBzaWduZWRJblVzZXIgPSB5aWVsZCAoMCwgYXV0aF8xLnNpZ25JbldpdGhQb3B1cCkoZmlyZWJhc2VfMS5BdXRoLCBleHBvcnRzLmdtYWlsUHJvdmlkZXIpO1xuICAgICAgICAgICAgaWYgKChfYSA9ICgwLCBhdXRoXzEuZ2V0QWRkaXRpb25hbFVzZXJJbmZvKShzaWduZWRJblVzZXIpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaXNOZXdVc2VyKSB7XG4gICAgICAgICAgICAgICAgLy9hc2sgZm9yIHVzZXJuYW1lXG4gICAgICAgICAgICAgICAgbGV0IG5hbWVHb29kID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgbGV0IG5hbWUgPSBcIlwiO1xuICAgICAgICAgICAgICAgIHdoaWxlICghbmFtZUdvb2QpIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZSA9XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9tcHQoXCJQbGVhc2UgcHJvdmlkZSBhIG5ldyB1c2VybmFtZSAoY2Fubm90IGJlIGxvbmdlciB0aGFuIDE2IGNoYXJhY3RlcnMsIGNhbiBvbmx5IGNvbnRhaW4gbGV0dGVycywgbnVtYmVycywgdW5kZXJzY29yZXMsIGRvdHMgYW5kIGRhc2hlcyk6XCIpIHx8IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmICghbmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2lnbk91dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJChcIi5wYWdlTG9naW4gLnByZWxvYWRlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMuZ2V0TmFtZUF2YWlsYWJpbGl0eShuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gY2hlY2sgbmFtZTogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbmFtZUdvb2QgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL2NyZWF0ZSBkYXRhYmFzZSBvYmplY3QgZm9yIHRoZSBuZXcgdXNlclxuICAgICAgICAgICAgICAgIC8vIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmNyZWF0ZShuYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgcmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAvLyAgIGxldCBtc2cgPSBlPy5yZXNwb25zZT8uZGF0YT8ubWVzc2FnZSA/PyBlLm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgLy8gICBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBjcmVhdGUgYWNjb3VudDogXCIgKyBtc2csIC0xKTtcbiAgICAgICAgICAgICAgICAvLyAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHlpZWxkICgwLCBhdXRoXzEudXBkYXRlUHJvZmlsZSkoc2lnbmVkSW5Vc2VyLnVzZXIsIHsgZGlzcGxheU5hbWU6IG5hbWUgfSk7XG4gICAgICAgICAgICAgICAgICAgIHlpZWxkICgwLCBhdXRoXzEuc2VuZEVtYWlsVmVyaWZpY2F0aW9uKShzaWduZWRJblVzZXIudXNlcik7XG4gICAgICAgICAgICAgICAgICAgIEFsbFRpbWVTdGF0cy5jbGVhcigpO1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkFjY291bnQgY3JlYXRlZFwiLCAxLCAzKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIiNtZW51IC5pY29uLWJ1dHRvbi5hY2NvdW50IC50ZXh0XCIpLnRleHQobmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICQoXCIucGFnZUxvZ2luIC5idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi5wYWdlTG9naW4gLnByZWxvYWRlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgeWllbGQgbG9hZFVzZXIoc2lnbmVkSW5Vc2VyLnVzZXIpO1xuICAgICAgICAgICAgICAgICAgICBQYWdlQ29udHJvbGxlci5jaGFuZ2UoXCJhY2NvdW50XCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoVGVzdExvZ2ljLm5vdFNpZ25lZEluTGFzdFJlc3VsdCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgVGVzdExvZ2ljLnNldE5vdFNpZ25lZEluVWlkKHNpZ25lZEluVXNlci51c2VyLnVpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHRzU2F2ZVJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5yZXN1bHRzLnNhdmUoVGVzdExvZ2ljLm5vdFNpZ25lZEluTGFzdFJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0c1NhdmVSZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IFRlc3RMb2dpYy5ub3RTaWduZWRJbkxhc3RSZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgREIuc2F2ZUxvY2FsUmVzdWx0KHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgREIudXBkYXRlTG9jYWxTdGF0cyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IHJlc3VsdC50ZXN0RHVyYXRpb24gK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmluY29tcGxldGVUZXN0U2Vjb25kcyAtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuYWZrRHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB5aWVsZCBsb2FkVXNlcihzaWduZWRJblVzZXIudXNlcik7XG4gICAgICAgICAgICAgICAgUGFnZUNvbnRyb2xsZXIuY2hhbmdlKFwiYWNjb3VudFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gTWlzYy5jcmVhdGVFcnJvck1lc3NhZ2UoZSwgXCJGYWlsZWQgdG8gc2lnbiBpbiB3aXRoIEdvb2dsZVwiKTtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKG1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgICQoXCIucGFnZUxvZ2luIC5wcmVsb2FkZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VMb2dpbiAuYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICBpZiAoc2lnbmVkSW5Vc2VyICYmICgoX2IgPSAoMCwgYXV0aF8xLmdldEFkZGl0aW9uYWxVc2VySW5mbykoc2lnbmVkSW5Vc2VyKSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmlzTmV3VXNlcikpIHtcbiAgICAgICAgICAgICAgICB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmRlbGV0ZSgpO1xuICAgICAgICAgICAgICAgIHlpZWxkIHNpZ25lZEluVXNlci51c2VyLmRlbGV0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2lnbk91dCgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLnNpZ25JbldpdGhHb29nbGUgPSBzaWduSW5XaXRoR29vZ2xlO1xuZnVuY3Rpb24gYWRkR29vZ2xlQXV0aCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyID09PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAoMCwgYXV0aF8xLmxpbmtXaXRoUG9wdXApKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciwgZXhwb3J0cy5nbWFpbFByb3ZpZGVyKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiR29vZ2xlIGF1dGhlbnRpY2F0aW9uIGFkZGVkXCIsIDEpO1xuICAgICAgICAgICAgU2V0dGluZ3MudXBkYXRlQXV0aFNlY3Rpb25zKCk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gYWRkIEdvb2dsZSBhdXRoZW5pY2F0aW9uOiBcIiArIGVycm9yLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5leHBvcnRzLmFkZEdvb2dsZUF1dGggPSBhZGRHb29nbGVBdXRoO1xuZnVuY3Rpb24gcmVtb3ZlR29vZ2xlQXV0aCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCB1c2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgICAgICBpZiAodXNlciA9PT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKHVzZXIucHJvdmlkZXJEYXRhLmZpbmQoKHByb3ZpZGVyKSA9PiBwcm92aWRlci5wcm92aWRlcklkID09PSBcInBhc3N3b3JkXCIpKSB7XG4gICAgICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB5aWVsZCAoMCwgYXV0aF8xLnJlYXV0aGVudGljYXRlV2l0aFBvcHVwKSh1c2VyLCBleHBvcnRzLmdtYWlsUHJvdmlkZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBNaXNjLmNyZWF0ZUVycm9yTWVzc2FnZShlLCBcIkZhaWxlZCB0byByZWF1dGhlbnRpY2F0ZVwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQobWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgKDAsIGF1dGhfMS51bmxpbmspKHVzZXIsIFwiZ29vZ2xlLmNvbVwiKVxuICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkdvb2dsZSBhdXRoZW50aWNhdGlvbiByZW1vdmVkXCIsIDEpO1xuICAgICAgICAgICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgU2V0dGluZ3MudXBkYXRlQXV0aFNlY3Rpb25zKCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHJlbW92ZSBHb29nbGUgYXV0aGVudGljYXRpb246IFwiICsgZXJyb3IubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlBhc3N3b3JkIGF1dGhlbnRpY2F0aW9uIG5lZWRzIHRvIGJlIGVuYWJsZWQgdG8gcmVtb3ZlIEdvb2dsZSBhdXRoZW50aWNhdGlvblwiLCAtMSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMucmVtb3ZlR29vZ2xlQXV0aCA9IHJlbW92ZUdvb2dsZUF1dGg7XG5mdW5jdGlvbiBhZGRQYXNzd29yZEF1dGgoZW1haWwsIHBhc3N3b3JkKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgTG9hZGVyLnNob3coKTtcbiAgICAgICAgY29uc3QgdXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICAgICAgaWYgKHVzZXIgPT09IG51bGwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmICh1c2VyLnByb3ZpZGVyRGF0YS5maW5kKChwcm92aWRlcikgPT4gcHJvdmlkZXIucHJvdmlkZXJJZCA9PT0gXCJnb29nbGUuY29tXCIpKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHlpZWxkICgwLCBhdXRoXzEucmVhdXRoZW50aWNhdGVXaXRoUG9wdXApKHVzZXIsIGV4cG9ydHMuZ21haWxQcm92aWRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IE1pc2MuY3JlYXRlRXJyb3JNZXNzYWdlKGUsIFwiRmFpbGVkIHRvIHJlYXV0aGVudGljYXRlXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChtZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY3JlZGVudGlhbCA9IGF1dGhfMS5FbWFpbEF1dGhQcm92aWRlci5jcmVkZW50aWFsKGVtYWlsLCBwYXNzd29yZCk7XG4gICAgICAgICgwLCBhdXRoXzEubGlua1dpdGhDcmVkZW50aWFsKSh1c2VyLCBjcmVkZW50aWFsKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUGFzc3dvcmQgYXV0aGVuaWNhdGlvbiBhZGRlZFwiLCAxKTtcbiAgICAgICAgICAgIFNldHRpbmdzLnVwZGF0ZUF1dGhTZWN0aW9ucygpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGFkZCBwYXNzd29yZCBhdXRoZW5pY2F0aW9uOiBcIiArIGVycm9yLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5leHBvcnRzLmFkZFBhc3N3b3JkQXV0aCA9IGFkZFBhc3N3b3JkQXV0aDtcbmZ1bmN0aW9uIHNpZ25PdXQoKSB7XG4gICAgZmlyZWJhc2VfMS5BdXRoLnNpZ25PdXQoKVxuICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiU2lnbmVkIG91dFwiLCAwLCAyKTtcbiAgICAgICAgQWxsVGltZVN0YXRzLmNsZWFyKCk7XG4gICAgICAgIFNldHRpbmdzLmhpZGVBY2NvdW50U2VjdGlvbigpO1xuICAgICAgICBBY2NvdW50QnV0dG9uLnVwZGF0ZSgpO1xuICAgICAgICBQYWdlQ29udHJvbGxlci5jaGFuZ2UoXCJsb2dpblwiKTtcbiAgICAgICAgREIuc2V0U25hcHNob3QoZGVmYXVsdF9zbmFwc2hvdF8xLmRlZmF1bHRTbmFwKTtcbiAgICAgICAgJChcIi5wYWdlTG9naW4gLmJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIH0pXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoZXJyb3IubWVzc2FnZSwgLTEpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5zaWduT3V0ID0gc2lnbk91dDtcbmZ1bmN0aW9uIHNpZ25VcCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAkKFwiLnBhZ2VMb2dpbiAuYnV0dG9uXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICQoXCIucGFnZUxvZ2luIC5wcmVsb2FkZXJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIGNvbnN0IG5uYW1lID0gJChcIi5wYWdlTG9naW4gLnJlZ2lzdGVyIGlucHV0XCIpWzBdLnZhbHVlO1xuICAgICAgICBjb25zdCBlbWFpbCA9ICQoXCIucGFnZUxvZ2luIC5yZWdpc3RlciBpbnB1dFwiKVsxXS52YWx1ZTtcbiAgICAgICAgY29uc3QgZW1haWxWZXJpZnkgPSAkKFwiLnBhZ2VMb2dpbiAucmVnaXN0ZXIgaW5wdXRcIilbMl1cbiAgICAgICAgICAgIC52YWx1ZTtcbiAgICAgICAgY29uc3QgcGFzc3dvcmQgPSAkKFwiLnBhZ2VMb2dpbiAucmVnaXN0ZXIgaW5wdXRcIilbM11cbiAgICAgICAgICAgIC52YWx1ZTtcbiAgICAgICAgY29uc3QgcGFzc3dvcmRWZXJpZnkgPSAkKFwiLnBhZ2VMb2dpbiAucmVnaXN0ZXIgaW5wdXRcIilbNF0udmFsdWU7XG4gICAgICAgIGlmIChlbWFpbCAhPT0gZW1haWxWZXJpZnkpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRW1haWxzIGRvIG5vdCBtYXRjaFwiLCAwLCAzKTtcbiAgICAgICAgICAgICQoXCIucGFnZUxvZ2luIC5wcmVsb2FkZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VMb2dpbiAuYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhc3N3b3JkICE9PSBwYXNzd29yZFZlcmlmeSkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJQYXNzd29yZHMgZG8gbm90IG1hdGNoXCIsIDAsIDMpO1xuICAgICAgICAgICAgJChcIi5wYWdlTG9naW4gLnByZWxvYWRlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUxvZ2luIC5idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMuZ2V0TmFtZUF2YWlsYWJpbGl0eShubmFtZSk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQocmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgJChcIi5wYWdlTG9naW4gLnByZWxvYWRlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUxvZ2luIC5idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBhdXRoTGlzdGVuZXIoKTtcbiAgICAgICAgbGV0IGNyZWF0ZWRBdXRoVXNlcjtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNyZWF0ZWRBdXRoVXNlciA9IHlpZWxkICgwLCBhdXRoXzEuY3JlYXRlVXNlcldpdGhFbWFpbEFuZFBhc3N3b3JkKShmaXJlYmFzZV8xLkF1dGgsIGVtYWlsLCBwYXNzd29yZCk7XG4gICAgICAgICAgICBjb25zdCBzaWduSW5SZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMuY3JlYXRlKG5uYW1lLCBlbWFpbCwgY3JlYXRlZEF1dGhVc2VyLnVzZXIudWlkKTtcbiAgICAgICAgICAgIGlmIChzaWduSW5SZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHRocm93IHNpZ25JblJlc3BvbnNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgeWllbGQgKDAsIGF1dGhfMS51cGRhdGVQcm9maWxlKShjcmVhdGVkQXV0aFVzZXIudXNlciwgeyBkaXNwbGF5TmFtZTogbm5hbWUgfSk7XG4gICAgICAgICAgICB5aWVsZCAoMCwgYXV0aF8xLnNlbmRFbWFpbFZlcmlmaWNhdGlvbikoY3JlYXRlZEF1dGhVc2VyLnVzZXIpO1xuICAgICAgICAgICAgQWxsVGltZVN0YXRzLmNsZWFyKCk7XG4gICAgICAgICAgICAkKFwiI21lbnUgLmljb24tYnV0dG9uLmFjY291bnQgLnRleHRcIikudGV4dChubmFtZSk7XG4gICAgICAgICAgICAkKFwiLnBhZ2VMb2dpbiAuYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VMb2dpbiAucHJlbG9hZGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgeWllbGQgbG9hZFVzZXIoY3JlYXRlZEF1dGhVc2VyLnVzZXIpO1xuICAgICAgICAgICAgaWYgKFRlc3RMb2dpYy5ub3RTaWduZWRJbkxhc3RSZXN1bHQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMuc2V0Tm90U2lnbmVkSW5VaWQoY3JlYXRlZEF1dGhVc2VyLnVzZXIudWlkKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucmVzdWx0cy5zYXZlKFRlc3RMb2dpYy5ub3RTaWduZWRJbkxhc3RSZXN1bHQpO1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBUZXN0TG9naWMubm90U2lnbmVkSW5MYXN0UmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICBEQi5zYXZlTG9jYWxSZXN1bHQocmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgREIudXBkYXRlTG9jYWxTdGF0cyh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lOiByZXN1bHQudGVzdER1cmF0aW9uICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuaW5jb21wbGV0ZVRlc3RTZWNvbmRzIC1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuYWZrRHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydGVkOiAxLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBQYWdlQ29udHJvbGxlci5jaGFuZ2UoXCJhY2NvdW50XCIpO1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJBY2NvdW50IGNyZWF0ZWRcIiwgMSwgMyk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIC8vbWFrZSBzdXJlIHRvIGRvIGNsZWFuIHVwIGhlcmVcbiAgICAgICAgICAgIGlmIChjcmVhdGVkQXV0aFVzZXIpIHtcbiAgICAgICAgICAgICAgICB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmRlbGV0ZSgpO1xuICAgICAgICAgICAgICAgIHlpZWxkIGNyZWF0ZWRBdXRoVXNlci51c2VyLmRlbGV0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gTWlzYy5jcmVhdGVFcnJvck1lc3NhZ2UoZSwgXCJGYWlsZWQgdG8gY3JlYXRlIGFjY291bnRcIik7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChtZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICAkKFwiLnBhZ2VMb2dpbiAucHJlbG9hZGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlTG9naW4gLmJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgc2lnbk91dCgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfSk7XG59XG4kKFwiLnBhZ2VMb2dpbiAjZm9yZ290UGFzc3dvcmRCdXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY29uc3QgZW1haWxGaWVsZCA9ICQoXCIucGFnZUxvZ2luIC5sb2dpbiBpbnB1dFwiKVswXS52YWx1ZSB8fCBcIlwiO1xuICAgIGNvbnN0IGVtYWlsID0gcHJvbXB0KFwiRW1haWwgYWRkcmVzc1wiLCBlbWFpbEZpZWxkKTtcbiAgICBpZiAoZW1haWwpIHtcbiAgICAgICAgKDAsIGF1dGhfMS5zZW5kUGFzc3dvcmRSZXNldEVtYWlsKShmaXJlYmFzZV8xLkF1dGgsIGVtYWlsKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gRW1haWwgc2VudC5cbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRW1haWwgc2VudFwiLCAxLCAyKTtcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgIC8vIEFuIGVycm9yIGhhcHBlbmVkLlxuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoZXJyb3IubWVzc2FnZSwgLTEpO1xuICAgICAgICB9KTtcbiAgICB9XG59KTtcbiQoXCIucGFnZUxvZ2luIC5sb2dpbiBpbnB1dFwiKS5rZXl1cCgoZSkgPT4ge1xuICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDaGFuZ2VkQmVmb3JlRGIoZmFsc2UpO1xuICAgICAgICBzaWduSW4oKTtcbiAgICB9XG59KTtcbiQoXCIucGFnZUxvZ2luIC5sb2dpbiAuYnV0dG9uLnNpZ25JblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0Q2hhbmdlZEJlZm9yZURiKGZhbHNlKTtcbiAgICBzaWduSW4oKTtcbn0pO1xuJChcIi5wYWdlTG9naW4gLmxvZ2luIC5idXR0b24uc2lnbkluV2l0aEdvb2dsZVwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0Q2hhbmdlZEJlZm9yZURiKGZhbHNlKTtcbiAgICBzaWduSW5XaXRoR29vZ2xlKCk7XG59KTtcbi8vICQoXCIucGFnZUxvZ2luIC5sb2dpbiAuYnV0dG9uLnNpZ25JbldpdGhHaXRIdWJcIikub24oXCJjbGlja1wiLChlKSA9PiB7XG4vLyBVcGRhdGVDb25maWcuc2V0Q2hhbmdlZEJlZm9yZURiKGZhbHNlKTtcbi8vIHNpZ25JbldpdGhHaXRIdWIoKTtcbi8vIH0pO1xuJChcIi5zaWduT3V0XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHNpZ25PdXQoKTtcbn0pO1xuJChcIi5wYWdlTG9naW4gLnJlZ2lzdGVyIGlucHV0XCIpLmtleXVwKChlKSA9PiB7XG4gICAgaWYgKCQoXCIucGFnZUxvZ2luIC5yZWdpc3RlciAuYnV0dG9uXCIpLmhhc0NsYXNzKFwiZGlzYWJsZWRcIikpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICBzaWduVXAoKTtcbiAgICB9XG59KTtcbiQoXCIucGFnZUxvZ2luIC5yZWdpc3RlciAuYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGlmICgkKFwiLnBhZ2VMb2dpbiAucmVnaXN0ZXIgLmJ1dHRvblwiKS5oYXNDbGFzcyhcImRpc2FibGVkXCIpKVxuICAgICAgICByZXR1cm47XG4gICAgc2lnblVwKCk7XG59KTtcbiQoXCIucGFnZVNldHRpbmdzICNhZGRHb29nbGVBdXRoXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgYWRkR29vZ2xlQXV0aCgpO1xufSkpO1xuJChcIi5wYWdlU2V0dGluZ3MgI3JlbW92ZUdvb2dsZUF1dGhcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgcmVtb3ZlR29vZ2xlQXV0aCgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VBY2NvdW50IC5zZW5kVmVyaWZpY2F0aW9uRW1haWxcIiwgKCkgPT4ge1xuICAgIHNlbmRWZXJpZmljYXRpb25FbWFpbCgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5sb2cgPSB2b2lkIDA7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xuY29uc3QgYW5hbHl0aWNzXzEgPSByZXF1aXJlKFwiZmlyZWJhc2UvYW5hbHl0aWNzXCIpO1xuZnVuY3Rpb24gbG9nKGV2ZW50TmFtZSwgcGFyYW1zKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICgwLCBhbmFseXRpY3NfMS5sb2dFdmVudCkoZmlyZWJhc2VfMS5BbmFseXRpY3MsIGV2ZW50TmFtZSwgcGFyYW1zKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJBbmFseXRpY3MgdW5hdmFpbGFibGVcIik7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMubG9nID0gbG9nO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zZXR1cCA9IGV4cG9ydHMudmVyaWZ5ID0gZXhwb3J0cy5jbGVhckFjdGl2ZSA9IHZvaWQgMDtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBNYW51YWxSZXN0YXJ0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L21hbnVhbC1yZXN0YXJ0LXRyYWNrZXJcIikpO1xuY29uc3QgQ3VzdG9tVGV4dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9jdXN0b20tdGV4dFwiKSk7XG5jb25zdCBGdW5ib3ggPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvZnVuYm94XCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpLCBVcGRhdGVDb25maWcgPSBjb25maWdfMTtcbmNvbnN0IFRlc3RVSSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LXVpXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuY29uc3QgVGVzdFN0YXRlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3Qtc3RhdGVcIikpO1xubGV0IGNoYWxsZW5nZUxvYWRpbmcgPSBmYWxzZTtcbmZ1bmN0aW9uIGNsZWFyQWN0aXZlKCkge1xuICAgIGlmIChUZXN0U3RhdGUuYWN0aXZlQ2hhbGxlbmdlICYmXG4gICAgICAgICFjaGFsbGVuZ2VMb2FkaW5nICYmXG4gICAgICAgICFUZXN0VUkudGVzdFJlc3RhcnRpbmcpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDaGFsbGVuZ2UgY2xlYXJlZFwiLCAwKTtcbiAgICAgICAgVGVzdFN0YXRlLnNldEFjdGl2ZUNoYWxsZW5nZShudWxsKTtcbiAgICB9XG59XG5leHBvcnRzLmNsZWFyQWN0aXZlID0gY2xlYXJBY3RpdmU7XG5mdW5jdGlvbiB2ZXJpZnkocmVzdWx0KSB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKFRlc3RTdGF0ZS5hY3RpdmVDaGFsbGVuZ2UpIHtcbiAgICAgICAgICAgIGNvbnN0IGFmayA9IChyZXN1bHQuYWZrRHVyYXRpb24gLyByZXN1bHQudGVzdER1cmF0aW9uKSAqIDEwMDtcbiAgICAgICAgICAgIGlmIChhZmsgPiAxMCkge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGBDaGFsbGVuZ2UgZmFpbGVkOiBBRksgdGltZSBpcyBncmVhdGVyIHRoYW4gMTAlYCwgMCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIVRlc3RTdGF0ZS5hY3RpdmVDaGFsbGVuZ2UucmVxdWlyZW1lbnRzKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoYCR7VGVzdFN0YXRlLmFjdGl2ZUNoYWxsZW5nZS5kaXNwbGF5fSBjaGFsbGVuZ2UgcGFzc2VkIWAsIDEpO1xuICAgICAgICAgICAgICAgIHJldHVybiBUZXN0U3RhdGUuYWN0aXZlQ2hhbGxlbmdlLm5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsZXQgcmVxdWlyZW1lbnRzTWV0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBjb25zdCBmYWlsUmVhc29ucyA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcmVxdWlyZW1lbnRUeXBlIGluIFRlc3RTdGF0ZS5hY3RpdmVDaGFsbGVuZ2UucmVxdWlyZW1lbnRzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXF1aXJlbWVudHNNZXQgPT0gZmFsc2UpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxdWlyZW1lbnRWYWx1ZSA9IFRlc3RTdGF0ZS5hY3RpdmVDaGFsbGVuZ2UucmVxdWlyZW1lbnRzW3JlcXVpcmVtZW50VHlwZV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXF1aXJlbWVudFR5cGUgPT0gXCJ3cG1cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgd3BtTW9kZSA9IE9iamVjdC5rZXlzKHJlcXVpcmVtZW50VmFsdWUpWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdwbU1vZGUgPT0gXCJleGFjdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGgucm91bmQocmVzdWx0LndwbSkgIT0gcmVxdWlyZW1lbnRWYWx1ZVtcImV4YWN0XCJdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVtZW50c01ldCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsUmVhc29ucy5wdXNoKGBXUE0gbm90ICR7cmVxdWlyZW1lbnRWYWx1ZVtcImV4YWN0XCJdfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHdwbU1vZGUgPT0gXCJtaW5cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQud3BtIDwgcmVxdWlyZW1lbnRWYWx1ZVtcIm1pblwiXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlbWVudHNNZXQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbFJlYXNvbnMucHVzaChgV1BNIGJlbG93ICR7cmVxdWlyZW1lbnRWYWx1ZVtcIm1pblwiXX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVxdWlyZW1lbnRUeXBlID09IFwiYWNjXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjY01vZGUgPSBPYmplY3Qua2V5cyhyZXF1aXJlbWVudFZhbHVlKVswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY2NNb2RlID09IFwiZXhhY3RcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuYWNjICE9IHJlcXVpcmVtZW50VmFsdWVbXCJleGFjdFwiXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlbWVudHNNZXQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbFJlYXNvbnMucHVzaChgQWNjdXJhY3kgbm90ICR7cmVxdWlyZW1lbnRWYWx1ZVtcImV4YWN0XCJdfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFjY01vZGUgPT0gXCJtaW5cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuYWNjIDwgcmVxdWlyZW1lbnRWYWx1ZVtcIm1pblwiXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlbWVudHNNZXQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbFJlYXNvbnMucHVzaChgQWNjdXJhY3kgYmVsb3cgJHtyZXF1aXJlbWVudFZhbHVlW1wibWluXCJdfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXF1aXJlbWVudFR5cGUgPT0gXCJhZmtcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWZrTW9kZSA9IE9iamVjdC5rZXlzKHJlcXVpcmVtZW50VmFsdWUpWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFma01vZGUgPT0gXCJtYXhcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLnJvdW5kKGFmaykgPiByZXF1aXJlbWVudFZhbHVlW1wibWF4XCJdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVtZW50c01ldCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsUmVhc29ucy5wdXNoKGBBRksgcGVyY2VudGFnZSBhYm92ZSAke3JlcXVpcmVtZW50VmFsdWVbXCJtYXhcIl19YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlcXVpcmVtZW50VHlwZSA9PSBcInRpbWVcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZU1vZGUgPSBPYmplY3Qua2V5cyhyZXF1aXJlbWVudFZhbHVlKVswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aW1lTW9kZSA9PSBcIm1pblwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGgucm91bmQocmVzdWx0LnRlc3REdXJhdGlvbikgPCByZXF1aXJlbWVudFZhbHVlW1wibWluXCJdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVtZW50c01ldCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsUmVhc29ucy5wdXNoKGBUZXN0IHRpbWUgYmVsb3cgJHtyZXF1aXJlbWVudFZhbHVlW1wibWluXCJdfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXF1aXJlbWVudFR5cGUgPT0gXCJmdW5ib3hcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZnVuYm94TW9kZSA9IHJlcXVpcmVtZW50VmFsdWVbXCJleGFjdFwiXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmdW5ib3hNb2RlICE9IHJlc3VsdC5mdW5ib3gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlbWVudHNNZXQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsUmVhc29ucy5wdXNoKGAke2Z1bmJveE1vZGV9IGZ1bmJveCBub3QgYWN0aXZlYCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVxdWlyZW1lbnRUeXBlID09IFwicmF3XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhd01vZGUgPSBPYmplY3Qua2V5cyhyZXF1aXJlbWVudFZhbHVlKVswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyYXdNb2RlID09IFwiZXhhY3RcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLnJvdW5kKHJlc3VsdC5yYXdXcG0pICE9IHJlcXVpcmVtZW50VmFsdWVbXCJleGFjdFwiXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlbWVudHNNZXQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbFJlYXNvbnMucHVzaChgUmF3IFdQTSBub3QgJHtyZXF1aXJlbWVudFZhbHVlW1wiZXhhY3RcIl19YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlcXVpcmVtZW50VHlwZSA9PSBcImNvblwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb25Nb2RlID0gT2JqZWN0LmtleXMocmVxdWlyZW1lbnRWYWx1ZSlbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uTW9kZSA9PSBcImV4YWN0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5yb3VuZChyZXN1bHQuY29uc2lzdGVuY3kpICE9IHJlcXVpcmVtZW50VmFsdWVbXCJleGFjdFwiXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlbWVudHNNZXQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbFJlYXNvbnMucHVzaChgQ29uc2lzdGVuY3kgbm90ICR7cmVxdWlyZW1lbnRWYWx1ZVtcImV4YWN0XCJdfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXF1aXJlbWVudFR5cGUgPT0gXCJjb25maWdcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBjb25maWdLZXkgaW4gcmVxdWlyZW1lbnRWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZpZ1ZhbHVlID0gcmVxdWlyZW1lbnRWYWx1ZVtjb25maWdLZXldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0W2NvbmZpZ0tleV0gIT0gY29uZmlnVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZW1lbnRzTWV0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxSZWFzb25zLnB1c2goYCR7Y29uZmlnS2V5fSBub3Qgc2V0IHRvICR7Y29uZmlnVmFsdWV9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyZXF1aXJlbWVudHNNZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFRlc3RTdGF0ZS5hY3RpdmVDaGFsbGVuZ2UuYXV0b1JvbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiWW91IHdpbGwgcmVjZWl2ZSBhIHJvbGUgc2hvcnRseS4gUGxlYXNlIGRvbid0IHBvc3QgYSBzY3JlZW5zaG90IGluIGNoYWxsZW5nZSBzdWJtaXNzaW9ucy5cIiwgMSwgNSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoYCR7VGVzdFN0YXRlLmFjdGl2ZUNoYWxsZW5nZS5kaXNwbGF5fSBjaGFsbGVuZ2UgcGFzc2VkIWAsIDEpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gVGVzdFN0YXRlLmFjdGl2ZUNoYWxsZW5nZS5uYW1lO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoYCR7VGVzdFN0YXRlLmFjdGl2ZUNoYWxsZW5nZS5kaXNwbGF5fSBjaGFsbGVuZ2UgZmFpbGVkOiAke2ZhaWxSZWFzb25zLmpvaW4oXCIsIFwiKX1gLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoYFNvbWV0aGluZyB3ZW50IHdyb25nIHdoZW4gdmVyaWZ5aW5nIGNoYWxsZW5nZTogJHtlLm1lc3NhZ2V9YCwgMCk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cbmV4cG9ydHMudmVyaWZ5ID0gdmVyaWZ5O1xuZnVuY3Rpb24gc2V0dXAoY2hhbGxlbmdlTmFtZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNoYWxsZW5nZUxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0RnVuYm94KFwibm9uZVwiKTtcbiAgICAgICAgY29uc3QgbGlzdCA9IHlpZWxkIE1pc2MuZ2V0Q2hhbGxlbmdlTGlzdCgpO1xuICAgICAgICBjb25zdCBjaGFsbGVuZ2UgPSBsaXN0LmZpbHRlcigoYykgPT4gYy5uYW1lID09PSBjaGFsbGVuZ2VOYW1lKVswXTtcbiAgICAgICAgbGV0IG5vdGl0ZXh0O1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKGNoYWxsZW5nZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDaGFsbGVuZ2Ugbm90IGZvdW5kXCIsIDApO1xuICAgICAgICAgICAgICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICQoXCIjdG9wIC5jb25maWdcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgICAgICQoXCIucGFnZS5wYWdlVGVzdFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICB9LCAyNTApO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjaGFsbGVuZ2UudHlwZSA9PT0gXCJjdXN0b21UaW1lXCIpIHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZUNvbmZpZyhjaGFsbGVuZ2UucGFyYW1ldGVyc1swXSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ0aW1lXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXREaWZmaWN1bHR5KFwibm9ybWFsXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIGlmIChjaGFsbGVuZ2UubmFtZSA9PT0gXCJlbmdsaXNoTWFzdGVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldExhbmd1YWdlKFwiZW5nbGlzaF8xMGtcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXROdW1iZXJzKHRydWUsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UHVuY3R1YXRpb24odHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY2hhbGxlbmdlLnR5cGUgPT09IFwiY3VzdG9tV29yZHNcIikge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRXb3JkQ291bnQoY2hhbGxlbmdlLnBhcmFtZXRlcnNbMF0sIHRydWUpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwid29yZHNcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldERpZmZpY3VsdHkoXCJub3JtYWxcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjaGFsbGVuZ2UudHlwZSA9PT0gXCJjdXN0b21UZXh0XCIpIHtcbiAgICAgICAgICAgICAgICBDdXN0b21UZXh0LnNldFRleHQoY2hhbGxlbmdlLnBhcmFtZXRlcnNbMF0uc3BsaXQoXCIgXCIpKTtcbiAgICAgICAgICAgICAgICBDdXN0b21UZXh0LnNldElzVGltZVJhbmRvbShmYWxzZSk7XG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC5zZXRJc1dvcmRSYW5kb20oY2hhbGxlbmdlLnBhcmFtZXRlcnNbMV0pO1xuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQuc2V0V29yZChjaGFsbGVuZ2UucGFyYW1ldGVyc1syXSk7XG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC5zZXRUaW1lKC0xKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcImN1c3RvbVwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RGlmZmljdWx0eShcIm5vcm1hbFwiLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNoYWxsZW5nZS50eXBlID09PSBcInNjcmlwdFwiKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBmZXRjaChcIi9jaGFsbGVuZ2VzL1wiICsgY2hhbGxlbmdlLnBhcmFtZXRlcnNbMF0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNjcmlwdGRhdGEgPSB5aWVsZCByZXNwb25zZS50ZXh0KCk7XG4gICAgICAgICAgICAgICAgbGV0IHRleHQgPSBzY3JpcHRkYXRhLnRyaW0oKTtcbiAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9bXFxuXFxyXFx0IF0vZ20sIFwiIFwiKTtcbiAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC8gKy9nbSwgXCIgXCIpO1xuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQuc2V0VGV4dCh0ZXh0LnNwbGl0KFwiIFwiKSk7XG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC5zZXRJc1dvcmRSYW5kb20oZmFsc2UpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwiY3VzdG9tXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXREaWZmaWN1bHR5KFwibm9ybWFsXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIGlmIChjaGFsbGVuZ2UucGFyYW1ldGVyc1sxXSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaGVtZShjaGFsbGVuZ2UucGFyYW1ldGVyc1sxXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjaGFsbGVuZ2UucGFyYW1ldGVyc1syXSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIEZ1bmJveC5hY3RpdmF0ZShjaGFsbGVuZ2UucGFyYW1ldGVyc1syXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY2hhbGxlbmdlLnR5cGUgPT09IFwiYWNjdXJhY3lcIikge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lQ29uZmlnKDAsIHRydWUpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwidGltZVwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RGlmZmljdWx0eShcIm1hc3RlclwiLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNoYWxsZW5nZS50eXBlID09PSBcImZ1bmJveFwiKSB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZ1bmJveChjaGFsbGVuZ2UucGFyYW1ldGVyc1swXSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldERpZmZpY3VsdHkoXCJub3JtYWxcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzFdID09PSBcIndvcmRzXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFdvcmRDb3VudChjaGFsbGVuZ2UucGFyYW1ldGVyc1syXSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzFdID09PSBcInRpbWVcIikge1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZUNvbmZpZyhjaGFsbGVuZ2UucGFyYW1ldGVyc1syXSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzFdLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBpZiAoY2hhbGxlbmdlLnBhcmFtZXRlcnNbM10gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RGlmZmljdWx0eShjaGFsbGVuZ2UucGFyYW1ldGVyc1szXSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY2hhbGxlbmdlLnR5cGUgPT09IFwic3BlY2lhbFwiKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNoYWxsZW5nZS5uYW1lID09PSBcInNlbWltYWtcIikge1xuICAgICAgICAgICAgICAgICAgICAvLyBzbyBjYW4geW91IG1ha2UgYSBsaW5rIHRoYXQgc2V0cyB1cCAxMjBzLCAxMGssIHB1bmN0LCBzdG9wIG9uIHdvcmQsIGFuZCBzZW1pbWFrIGFzIHRoZSBsYXlvdXQ/XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwidGltZVwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVDb25maWcoMTIwLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldExhbmd1YWdlKFwiZW5nbGlzaF8xMGtcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQdW5jdHVhdGlvbih0cnVlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFN0b3BPbkVycm9yKFwid29yZFwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldExheW91dChcInNlbWltYWtcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBMYXlvdXQoXCJvdmVycmlkZVN5bmNcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBNb2RlKFwic3RhdGljXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgICAgICAgICBub3RpdGV4dCA9IGNoYWxsZW5nZS5tZXNzYWdlO1xuICAgICAgICAgICAgJChcIiN0b3AgLmNvbmZpZ1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZS5wYWdlVGVzdFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIGlmIChub3RpdGV4dCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoYENoYWxsZW5nZSAnJHtjaGFsbGVuZ2UuZGlzcGxheX0nIGxvYWRlZC5gLCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ2hhbGxlbmdlIGxvYWRlZC4gXCIgKyBub3RpdGV4dCwgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBUZXN0U3RhdGUuc2V0QWN0aXZlQ2hhbGxlbmdlKGNoYWxsZW5nZSk7XG4gICAgICAgICAgICBjaGFsbGVuZ2VMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJTb21ldGhpbmcgd2VudCB3cm9uZzogXCIgKyBlLCAtMSk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuc2V0dXAgPSBzZXR1cDtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXkpID0+IHtcbiAgICBpZiAoW1xuICAgICAgICBcImRpZmZpY3VsdHlcIixcbiAgICAgICAgXCJudW1iZXJzXCIsXG4gICAgICAgIFwicHVuY3R1YXRpb25cIixcbiAgICAgICAgXCJtb2RlXCIsXG4gICAgICAgIFwiZnVuYm94XCIsXG4gICAgICAgIFwicGFjZUNhcmV0XCIsXG4gICAgICAgIFwic2hvd0FsbExpbmVzXCIsXG4gICAgICAgIFwic2hvd0xpdmVXcG1cIixcbiAgICAgICAgXCJoaWdobGlnaHRNb2RlXCIsXG4gICAgICAgIFwidGltZVwiLFxuICAgICAgICBcIndvcmRzXCIsXG4gICAgICAgIFwia2V5bWFwTW9kZVwiLFxuICAgICAgICBcImtleW1hcExheW91dFwiLFxuICAgICAgICBcImxheW91dFwiLFxuICAgIF0uaW5jbHVkZXMoZXZlbnRLZXkpKSB7XG4gICAgICAgIGNsZWFyQWN0aXZlKCk7XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZUFsbENoYXJ0Q29sb3JzID0gZXhwb3J0cy5zZXREZWZhdWx0Rm9udEZhbWlseSA9IGV4cG9ydHMudXBkYXRlQ29sb3JzID0gZXhwb3J0cy5taW5pUmVzdWx0ID0gZXhwb3J0cy5hY2NvdW50QWN0aXZpdHkgPSBleHBvcnRzLmFjY291bnRIaXN0b3J5ID0gZXhwb3J0cy5hY2NvdW50SGlzdG9yeUFjdGl2ZUluZGV4ID0gZXhwb3J0cy5yZXN1bHQgPSB2b2lkIDA7XG5jb25zdCBjaGFydF9qc18xID0gcmVxdWlyZShcImNoYXJ0LmpzXCIpO1xuY29uc3QgY2hhcnRqc19wbHVnaW5fdHJlbmRsaW5lXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImNoYXJ0anMtcGx1Z2luLXRyZW5kbGluZVwiKSk7XG5jb25zdCBjaGFydGpzX3BsdWdpbl9hbm5vdGF0aW9uXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImNoYXJ0anMtcGx1Z2luLWFubm90YXRpb25cIikpO1xuY2hhcnRfanNfMS5DaGFydC5yZWdpc3RlcihjaGFydF9qc18xLkJhckNvbnRyb2xsZXIsIGNoYXJ0X2pzXzEuQmFyRWxlbWVudCwgY2hhcnRfanNfMS5DYXRlZ29yeVNjYWxlLCBjaGFydF9qc18xLkZpbGxlciwgY2hhcnRfanNfMS5MaW5lYXJTY2FsZSwgY2hhcnRfanNfMS5MaW5lQ29udHJvbGxlciwgY2hhcnRfanNfMS5MaW5lRWxlbWVudCwgY2hhcnRfanNfMS5Qb2ludEVsZW1lbnQsIGNoYXJ0X2pzXzEuU2NhdHRlckNvbnRyb2xsZXIsIGNoYXJ0X2pzXzEuVGltZVNjYWxlLCBjaGFydF9qc18xLlRpbWVTZXJpZXNTY2FsZSwgY2hhcnRfanNfMS5Ub29sdGlwLCBjaGFydGpzX3BsdWdpbl90cmVuZGxpbmVfMS5kZWZhdWx0LCBjaGFydGpzX3BsdWdpbl9hbm5vdGF0aW9uXzEuZGVmYXVsdCk7XG5jaGFydF9qc18xLkNoYXJ0LmRlZmF1bHRzLmFuaW1hdGlvbi5kdXJhdGlvbiA9IDA7XG5jaGFydF9qc18xLkNoYXJ0LmRlZmF1bHRzLmVsZW1lbnRzLmxpbmUudGVuc2lvbiA9IDAuMztcbmNoYXJ0X2pzXzEuQ2hhcnQuZGVmYXVsdHMuZWxlbWVudHMubGluZS5maWxsID0gXCJvcmlnaW5cIjtcbmNvbnN0IFRlc3RJbnB1dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LWlucHV0XCIpKTtcbmNvbnN0IFRoZW1lQ29sb3JzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy90aGVtZS1jb2xvcnNcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuY29uc3QgZm9ybWF0XzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImRhdGUtZm5zL2Zvcm1hdFwiKSk7XG5yZXF1aXJlKFwiY2hhcnRqcy1hZGFwdGVyLWRhdGUtZm5zXCIpO1xuY2xhc3MgQ2hhcnRXaXRoVXBkYXRlQ29sb3JzIGV4dGVuZHMgY2hhcnRfanNfMS5DaGFydCB7XG4gICAgY29uc3RydWN0b3IoaXRlbSwgY29uZmlnKSB7XG4gICAgICAgIHN1cGVyKGl0ZW0sIGNvbmZpZyk7XG4gICAgfVxuICAgIHVwZGF0ZUNvbG9ycygpIHtcbiAgICAgICAgdXBkYXRlQ29sb3JzKHRoaXMpO1xuICAgIH1cbn1cbmV4cG9ydHMucmVzdWx0ID0gbmV3IENoYXJ0V2l0aFVwZGF0ZUNvbG9ycygkKFwiI3dwbUNoYXJ0XCIpLCB7XG4gICAgdHlwZTogXCJsaW5lXCIsXG4gICAgZGF0YToge1xuICAgICAgICBsYWJlbHM6IFtdLFxuICAgICAgICBkYXRhc2V0czogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGxhYmVsOiBcIndwbVwiLFxuICAgICAgICAgICAgICAgIGRhdGE6IFtdLFxuICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiBcInJnYmEoMTI1LCAxMjUsIDEyNSwgMSlcIixcbiAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMixcbiAgICAgICAgICAgICAgICB5QXhpc0lEOiBcIndwbVwiLFxuICAgICAgICAgICAgICAgIG9yZGVyOiAyLFxuICAgICAgICAgICAgICAgIHBvaW50UmFkaXVzOiAyLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJyYXdcIixcbiAgICAgICAgICAgICAgICBkYXRhOiBbXSxcbiAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogXCJyZ2JhKDEyNSwgMTI1LCAxMjUsIDEpXCIsXG4gICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDIsXG4gICAgICAgICAgICAgICAgeUF4aXNJRDogXCJyYXdcIixcbiAgICAgICAgICAgICAgICBvcmRlcjogMyxcbiAgICAgICAgICAgICAgICBwb2ludFJhZGl1czogMixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbGFiZWw6IFwiZXJyb3JzXCIsXG4gICAgICAgICAgICAgICAgZGF0YTogW10sXG4gICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IFwicmdiYSgyNTUsIDEyNSwgMTI1LCAxKVwiLFxuICAgICAgICAgICAgICAgIHBvaW50QmFja2dyb3VuZENvbG9yOiBcInJnYmEoMjU1LCAxMjUsIDEyNSwgMSlcIixcbiAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMixcbiAgICAgICAgICAgICAgICBvcmRlcjogMSxcbiAgICAgICAgICAgICAgICB5QXhpc0lEOiBcImVycm9yXCIsXG4gICAgICAgICAgICAgICAgdHlwZTogXCJzY2F0dGVyXCIsXG4gICAgICAgICAgICAgICAgcG9pbnRTdHlsZTogXCJjcm9zc1JvdFwiLFxuICAgICAgICAgICAgICAgIHBvaW50UmFkaXVzOiBmdW5jdGlvbiAoY29udGV4dCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGNvbnRleHQuZGF0YUluZGV4O1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGNvbnRleHQuZGF0YXNldC5kYXRhW2luZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdm9pZCAwID8gdmFsdWUgOiAwKSA8PSAwID8gMCA6IDM7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBwb2ludEhvdmVyUmFkaXVzOiBmdW5jdGlvbiAoY29udGV4dCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGNvbnRleHQuZGF0YUluZGV4O1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGNvbnRleHQuZGF0YXNldC5kYXRhW2luZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdm9pZCAwID8gdmFsdWUgOiAwKSA8PSAwID8gMCA6IDU7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgfSxcbiAgICBvcHRpb25zOiB7XG4gICAgICAgIHJlc3BvbnNpdmU6IHRydWUsXG4gICAgICAgIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlLFxuICAgICAgICBzY2FsZXM6IHtcbiAgICAgICAgICAgIHg6IHtcbiAgICAgICAgICAgICAgICBheGlzOiBcInhcIixcbiAgICAgICAgICAgICAgICB0aWNrczoge1xuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXBQYWRkaW5nOiAyMCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiU2Vjb25kc1wiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgd3BtOiB7XG4gICAgICAgICAgICAgICAgYXhpczogXCJ5XCIsXG4gICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIldvcmRzIHBlciBNaW51dGVcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJlZ2luQXRaZXJvOiB0cnVlLFxuICAgICAgICAgICAgICAgIG1pbjogMCxcbiAgICAgICAgICAgICAgICB0aWNrczoge1xuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXBQYWRkaW5nOiAyMCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGdyaWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJhdzoge1xuICAgICAgICAgICAgICAgIGF4aXM6IFwieVwiLFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiUmF3IFdvcmRzIHBlciBNaW51dGVcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJlZ2luQXRaZXJvOiB0cnVlLFxuICAgICAgICAgICAgICAgIG1pbjogMCxcbiAgICAgICAgICAgICAgICB0aWNrczoge1xuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXBQYWRkaW5nOiAyMCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGdyaWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgICAgIGF4aXM6IFwieVwiLFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IFwicmlnaHRcIixcbiAgICAgICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIkVycm9yc1wiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYmVnaW5BdFplcm86IHRydWUsXG4gICAgICAgICAgICAgICAgdGlja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgcHJlY2lzaW9uOiAwLFxuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXBQYWRkaW5nOiAyMCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGdyaWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHBsdWdpbnM6IHtcbiAgICAgICAgICAgIGFubm90YXRpb246IHtcbiAgICAgICAgICAgICAgICBhbm5vdGF0aW9uczogW10sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdG9vbHRpcDoge1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogeyBkdXJhdGlvbjogMjUwIH0sXG4gICAgICAgICAgICAgICAgbW9kZTogXCJpbmRleFwiLFxuICAgICAgICAgICAgICAgIGludGVyc2VjdDogZmFsc2UsXG4gICAgICAgICAgICAgICAgY2FsbGJhY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgIGFmdGVyTGFiZWw6IGZ1bmN0aW9uICh0aSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiLndvcmRJbnB1dEFmdGVyXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmRzVG9IaWdobGlnaHQgPSBUZXN0SW5wdXQua2V5cHJlc3NQZXJTZWNvbmRbcGFyc2VJbnQodGkubGFiZWwpIC0gMV0ud29yZHM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdW5pcXVlID0gWy4uLm5ldyBTZXQod29yZHNUb0hpZ2hsaWdodCldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXF1ZS5mb3JFYWNoKCh3b3JkSW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgd29yZEVsID0gJCgkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeSAud29yZHMgLndvcmRcIilbd29yZEluZGV4XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gd29yZEVsLmF0dHIoXCJpbnB1dFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0ICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29yZEVsLmFwcGVuZChgPGRpdiBjbGFzcz1cIndvcmRJbnB1dEFmdGVyXCI+JHtpbnB1dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXHQvZywgXCJfXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcbi9nLCBcIl9cIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvPC9nLCBcIiZsdFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8+L2csIFwiJmd0XCIpfTwvZGl2PmApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoX2EpIHsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgfSxcbn0pO1xuZXhwb3J0cy5hY2NvdW50SGlzdG9yeSA9IG5ldyBDaGFydFdpdGhVcGRhdGVDb2xvcnMoJChcIi5wYWdlQWNjb3VudCAjYWNjb3VudEhpc3RvcnlDaGFydFwiKSwge1xuICAgIHR5cGU6IFwibGluZVwiLFxuICAgIGRhdGE6IHtcbiAgICAgICAgbGFiZWxzOiBbXSxcbiAgICAgICAgZGF0YXNldHM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB5QXhpc0lEOiBcIndwbVwiLFxuICAgICAgICAgICAgICAgIGxhYmVsOiBcIndwbVwiLFxuICAgICAgICAgICAgICAgIGZpbGw6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRhdGE6IFtdLFxuICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiBcIiNmNDQzMzZcIixcbiAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMixcbiAgICAgICAgICAgICAgICB0cmVuZGxpbmVMaW5lYXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IFwicmdiYSgyNTUsMTA1LDE4MCwgLjgpXCIsXG4gICAgICAgICAgICAgICAgICAgIGxpbmVTdHlsZTogXCJkb3R0ZWRcIixcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDQsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgeUF4aXNJRDogXCJhY2NcIixcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJhY2NcIixcbiAgICAgICAgICAgICAgICBmaWxsOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBkYXRhOiBbXSxcbiAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogXCIjY2NjY2NjXCIsXG4gICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDIsXG4gICAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgIH0sXG4gICAgb3B0aW9uczoge1xuICAgICAgICByZXNwb25zaXZlOiB0cnVlLFxuICAgICAgICBtYWludGFpbkFzcGVjdFJhdGlvOiBmYWxzZSxcbiAgICAgICAgaG92ZXI6IHtcbiAgICAgICAgICAgIG1vZGU6IFwibmVhcmVzdFwiLFxuICAgICAgICAgICAgaW50ZXJzZWN0OiBmYWxzZSxcbiAgICAgICAgfSxcbiAgICAgICAgc2NhbGVzOiB7XG4gICAgICAgICAgICB4OiB7XG4gICAgICAgICAgICAgICAgYXhpczogXCJ4XCIsXG4gICAgICAgICAgICAgICAgdHlwZTogXCJ0aW1lc2VyaWVzXCIsXG4gICAgICAgICAgICAgICAgYm91bmRzOiBcInRpY2tzXCIsXG4gICAgICAgICAgICAgICAgZGlzcGxheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgb2Zmc2V0OiB0cnVlLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIkRhdGVcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHdwbToge1xuICAgICAgICAgICAgICAgIGF4aXM6IFwieVwiLFxuICAgICAgICAgICAgICAgIGJlZ2luQXRaZXJvOiB0cnVlLFxuICAgICAgICAgICAgICAgIG1pbjogMCxcbiAgICAgICAgICAgICAgICB0aWNrczoge1xuICAgICAgICAgICAgICAgICAgICBzdGVwU2l6ZTogMTAsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiV29yZHMgcGVyIE1pbnV0ZVwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYWNjOiB7XG4gICAgICAgICAgICAgICAgYXhpczogXCJ5XCIsXG4gICAgICAgICAgICAgICAgYmVnaW5BdFplcm86IHRydWUsXG4gICAgICAgICAgICAgICAgbWF4OiAxMDAsXG4gICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogXCJyaWdodFwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiRXJyb3IgcmF0ZSAoMTAwIC0gYWNjdXJhY3kpXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBncmlkOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBwbHVnaW5zOiB7XG4gICAgICAgICAgICBhbm5vdGF0aW9uOiB7XG4gICAgICAgICAgICAgICAgYW5ub3RhdGlvbnM6IFtdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRvb2x0aXA6IHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHsgZHVyYXRpb246IDI1MCB9LFxuICAgICAgICAgICAgICAgIC8vIERpc2FibGUgdGhlIG9uLWNhbnZhcyB0b29sdGlwXG4gICAgICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpbnRlcnNlY3Q6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGV4dGVybmFsOiBmdW5jdGlvbiAoY3R4KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY3R4KVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICBjdHgudG9vbHRpcC5vcHRpb25zLmRpc3BsYXlDb2xvcnMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrczoge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGJlZm9yZUxhYmVsOiBmdW5jdGlvbiAodG9vbHRpcEl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b29sdGlwSXRlbS5kYXRhc2V0SW5kZXggIT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHREYXRhID0gdG9vbHRpcEl0ZW0uZGF0YXNldC5kYXRhW3Rvb2x0aXBJdGVtLmRhdGFJbmRleF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGBlcnJvciByYXRlOiAke01pc2Mucm91bmRUbzIocmVzdWx0RGF0YS5lcnJvclJhdGUpfSVcXG5hY2M6ICR7TWlzYy5yb3VuZFRvMigxMDAgLSByZXN1bHREYXRhLmVycm9yUmF0ZSl9JWA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHREYXRhID0gdG9vbHRpcEl0ZW0uZGF0YXNldC5kYXRhW3Rvb2x0aXBJdGVtLmRhdGFJbmRleF07XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgbGFiZWwgPSBgJHtjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0gPyBcImNwbVwiIDogXCJ3cG1cIn06ICR7cmVzdWx0RGF0YS53cG19YCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJcXG5cIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYHJhdzogJHtyZXN1bHREYXRhLnJhd31gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlxcblwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgYWNjOiAke3Jlc3VsdERhdGEuYWNjfWAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiXFxuXFxuXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBtb2RlOiAke3Jlc3VsdERhdGEubW9kZX0gYDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHREYXRhLm1vZGUgPT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCArPSByZXN1bHREYXRhLm1vZGUyO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0RGF0YS5tb2RlID09IFwid29yZHNcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsICs9IHJlc3VsdERhdGEubW9kZTI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgZGlmZiA9IHJlc3VsdERhdGEuZGlmZmljdWx0eTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaWZmID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmYgPSBcIm5vcm1hbFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgKz0gXCJcXG5cIiArIGBkaWZmaWN1bHR5OiAke2RpZmZ9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsICs9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJcXG5cIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBwdW5jdHVhdGlvbjogJHtyZXN1bHREYXRhLnB1bmN0dWF0aW9ufWAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlxcblwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGxhbmd1YWdlOiAke3Jlc3VsdERhdGEubGFuZ3VhZ2V9YCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiXFxuXFxuXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgZGF0ZTogJHsoMCwgZm9ybWF0XzEuZGVmYXVsdCkobmV3IERhdGUocmVzdWx0RGF0YS50aW1lc3RhbXApLCBcImRkIE1NTSB5eXl5IEhIOm1tXCIpfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGFiZWw7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgYWZ0ZXJMYWJlbDogZnVuY3Rpb24gKHRvb2x0aXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cG9ydHMuYWNjb3VudEhpc3RvcnlBY3RpdmVJbmRleCA9IHRvb2x0aXAuZGF0YUluZGV4O1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgfSxcbn0pO1xuZXhwb3J0cy5hY2NvdW50QWN0aXZpdHkgPSBuZXcgQ2hhcnRXaXRoVXBkYXRlQ29sb3JzKCQoXCIucGFnZUFjY291bnQgI2FjY291bnRBY3Rpdml0eUNoYXJ0XCIpLCB7XG4gICAgdHlwZTogXCJiYXJcIixcbiAgICBkYXRhOiB7XG4gICAgICAgIGxhYmVsczogW10sXG4gICAgICAgIGRhdGFzZXRzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgeUF4aXNJRDogXCJjb3VudFwiLFxuICAgICAgICAgICAgICAgIGxhYmVsOiBcIlNlY29uZHNcIixcbiAgICAgICAgICAgICAgICBkYXRhOiBbXSxcbiAgICAgICAgICAgICAgICB0cmVuZGxpbmVMaW5lYXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IFwicmdiYSgyNTUsMTA1LDE4MCwgLjgpXCIsXG4gICAgICAgICAgICAgICAgICAgIGxpbmVTdHlsZTogXCJkb3R0ZWRcIixcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvcmRlcjogMyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgeUF4aXNJRDogXCJhdmdXcG1cIixcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJBdmVyYWdlIFdwbVwiLFxuICAgICAgICAgICAgICAgIGRhdGE6IFtdLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwibGluZVwiLFxuICAgICAgICAgICAgICAgIG9yZGVyOiAyLFxuICAgICAgICAgICAgICAgIHRlbnNpb246IDAsXG4gICAgICAgICAgICAgICAgZmlsbDogZmFsc2UsXG4gICAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgIH0sXG4gICAgb3B0aW9uczoge1xuICAgICAgICByZXNwb25zaXZlOiB0cnVlLFxuICAgICAgICBtYWludGFpbkFzcGVjdFJhdGlvOiBmYWxzZSxcbiAgICAgICAgaG92ZXI6IHtcbiAgICAgICAgICAgIG1vZGU6IFwibmVhcmVzdFwiLFxuICAgICAgICAgICAgaW50ZXJzZWN0OiBmYWxzZSxcbiAgICAgICAgfSxcbiAgICAgICAgc2NhbGVzOiB7XG4gICAgICAgICAgICB4OiB7XG4gICAgICAgICAgICAgICAgYXhpczogXCJ4XCIsXG4gICAgICAgICAgICAgICAgdGlja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwUGFkZGluZzogMjAsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0eXBlOiBcInRpbWVcIixcbiAgICAgICAgICAgICAgICB0aW1lOiB7XG4gICAgICAgICAgICAgICAgICAgIHVuaXQ6IFwiZGF5XCIsXG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlGb3JtYXRzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXk6IFwiZCBNTU1cIixcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJvdW5kczogXCJ0aWNrc1wiLFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiRGF0ZVwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb2Zmc2V0OiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvdW50OiB7XG4gICAgICAgICAgICAgICAgYXhpczogXCJ5XCIsXG4gICAgICAgICAgICAgICAgYmVnaW5BdFplcm86IHRydWUsXG4gICAgICAgICAgICAgICAgbWluOiAwLFxuICAgICAgICAgICAgICAgIHRpY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcFBhZGRpbmc6IDIwLFxuICAgICAgICAgICAgICAgICAgICBzdGVwU2l6ZTogMTAsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiVGltZSBUeXBpbmdcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGF2Z1dwbToge1xuICAgICAgICAgICAgICAgIGF4aXM6IFwieVwiLFxuICAgICAgICAgICAgICAgIGJlZ2luQXRaZXJvOiB0cnVlLFxuICAgICAgICAgICAgICAgIG1pbjogMCxcbiAgICAgICAgICAgICAgICB0aWNrczoge1xuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXBQYWRkaW5nOiAyMCxcbiAgICAgICAgICAgICAgICAgICAgc3RlcFNpemU6IDEwLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogXCJyaWdodFwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiQXZlcmFnZSBXcG1cIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGdyaWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHBsdWdpbnM6IHtcbiAgICAgICAgICAgIGFubm90YXRpb246IHtcbiAgICAgICAgICAgICAgICBhbm5vdGF0aW9uczogW10sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdG9vbHRpcDoge1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogeyBkdXJhdGlvbjogMjUwIH0sXG4gICAgICAgICAgICAgICAgY2FsbGJhY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBmdW5jdGlvbiAodG9vbHRpcEl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdERhdGEgPSB0b29sdGlwSXRlbVswXS5kYXRhc2V0LmRhdGFbdG9vbHRpcEl0ZW1bMF0uZGF0YUluZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoMCwgZm9ybWF0XzEuZGVmYXVsdCkobmV3IERhdGUocmVzdWx0RGF0YS54KSwgXCJkZCBNTU0geXl5eVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgYmVmb3JlTGFiZWw6IGZ1bmN0aW9uICh0b29sdGlwSXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0RGF0YSA9IHRvb2x0aXBJdGVtLmRhdGFzZXQuZGF0YVt0b29sdGlwSXRlbS5kYXRhSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0b29sdGlwSXRlbS5kYXRhc2V0SW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgVGltZSBUeXBpbmc6ICR7TWlzYy5zZWNvbmRzVG9TdHJpbmcoTWF0aC5yb3VuZChyZXN1bHREYXRhLnkpLCB0cnVlLCB0cnVlKX1cXG5UZXN0cyBDb21wbGV0ZWQ6ICR7cmVzdWx0RGF0YS5hbW91bnR9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgQXZlcmFnZSAke2NvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSA/IFwiQ3BtXCIgOiBcIldwbVwifTogJHtNaXNjLnJvdW5kVG8yKHJlc3VsdERhdGEueSl9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIH0sXG59KTtcbmV4cG9ydHMubWluaVJlc3VsdCA9IG5ldyBDaGFydFdpdGhVcGRhdGVDb2xvcnMoJChcIi5wYWdlQWNjb3VudCAjbWluaVJlc3VsdENoYXJ0XCIpLCB7XG4gICAgdHlwZTogXCJsaW5lXCIsXG4gICAgZGF0YToge1xuICAgICAgICBsYWJlbHM6IFtdLFxuICAgICAgICBkYXRhc2V0czogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGxhYmVsOiBcIndwbVwiLFxuICAgICAgICAgICAgICAgIGRhdGE6IFtdLFxuICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiBcInJnYmEoMTI1LCAxMjUsIDEyNSwgMSlcIixcbiAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMixcbiAgICAgICAgICAgICAgICB5QXhpc0lEOiBcIndwbVwiLFxuICAgICAgICAgICAgICAgIG9yZGVyOiAyLFxuICAgICAgICAgICAgICAgIHBvaW50UmFkaXVzOiAyLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJyYXdcIixcbiAgICAgICAgICAgICAgICBkYXRhOiBbXSxcbiAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogXCJyZ2JhKDEyNSwgMTI1LCAxMjUsIDEpXCIsXG4gICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDIsXG4gICAgICAgICAgICAgICAgeUF4aXNJRDogXCJyYXdcIixcbiAgICAgICAgICAgICAgICBvcmRlcjogMyxcbiAgICAgICAgICAgICAgICBwb2ludFJhZGl1czogMixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbGFiZWw6IFwiZXJyb3JzXCIsXG4gICAgICAgICAgICAgICAgZGF0YTogW10sXG4gICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IFwicmdiYSgyNTUsIDEyNSwgMTI1LCAxKVwiLFxuICAgICAgICAgICAgICAgIHBvaW50QmFja2dyb3VuZENvbG9yOiBcInJnYmEoMjU1LCAxMjUsIDEyNSwgMSlcIixcbiAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMixcbiAgICAgICAgICAgICAgICBvcmRlcjogMSxcbiAgICAgICAgICAgICAgICB5QXhpc0lEOiBcImVycm9yXCIsXG4gICAgICAgICAgICAgICAgdHlwZTogXCJzY2F0dGVyXCIsXG4gICAgICAgICAgICAgICAgcG9pbnRTdHlsZTogXCJjcm9zc1JvdFwiLFxuICAgICAgICAgICAgICAgIHBvaW50UmFkaXVzOiBmdW5jdGlvbiAoY29udGV4dCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGNvbnRleHQuZGF0YUluZGV4O1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGNvbnRleHQuZGF0YXNldC5kYXRhW2luZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdm9pZCAwID8gdmFsdWUgOiAwKSA8PSAwID8gMCA6IDM7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBwb2ludEhvdmVyUmFkaXVzOiBmdW5jdGlvbiAoY29udGV4dCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGNvbnRleHQuZGF0YUluZGV4O1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGNvbnRleHQuZGF0YXNldC5kYXRhW2luZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdm9pZCAwID8gdmFsdWUgOiAwKSA8PSAwID8gMCA6IDU7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgfSxcbiAgICBvcHRpb25zOiB7XG4gICAgICAgIHJlc3BvbnNpdmU6IHRydWUsXG4gICAgICAgIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlLFxuICAgICAgICBzY2FsZXM6IHtcbiAgICAgICAgICAgIHg6IHtcbiAgICAgICAgICAgICAgICBheGlzOiBcInhcIixcbiAgICAgICAgICAgICAgICB0aWNrczoge1xuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXBQYWRkaW5nOiAyMCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiU2Vjb25kc1wiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgd3BtOiB7XG4gICAgICAgICAgICAgICAgYXhpczogXCJ5XCIsXG4gICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIldvcmRzIHBlciBNaW51dGVcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJlZ2luQXRaZXJvOiB0cnVlLFxuICAgICAgICAgICAgICAgIG1pbjogMCxcbiAgICAgICAgICAgICAgICB0aWNrczoge1xuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXBQYWRkaW5nOiAyMCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGdyaWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJhdzoge1xuICAgICAgICAgICAgICAgIGF4aXM6IFwieVwiLFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiUmF3IFdvcmRzIHBlciBNaW51dGVcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJlZ2luQXRaZXJvOiB0cnVlLFxuICAgICAgICAgICAgICAgIG1pbjogMCxcbiAgICAgICAgICAgICAgICB0aWNrczoge1xuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXBQYWRkaW5nOiAyMCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGdyaWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IFwicmlnaHRcIixcbiAgICAgICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIkVycm9yc1wiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYmVnaW5BdFplcm86IHRydWUsXG4gICAgICAgICAgICAgICAgdGlja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgcHJlY2lzaW9uOiAwLFxuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXBQYWRkaW5nOiAyMCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGdyaWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHBsdWdpbnM6IHtcbiAgICAgICAgICAgIGFubm90YXRpb246IHtcbiAgICAgICAgICAgICAgICBhbm5vdGF0aW9uczogW10sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdG9vbHRpcDoge1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogeyBkdXJhdGlvbjogMjUwIH0sXG4gICAgICAgICAgICAgICAgbW9kZTogXCJpbmRleFwiLFxuICAgICAgICAgICAgICAgIGludGVyc2VjdDogZmFsc2UsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIH0sXG59KTtcbmZ1bmN0aW9uIHVwZGF0ZUFjY3VyYWN5KCkge1xuICAgIGV4cG9ydHMuYWNjb3VudEhpc3RvcnkuZGF0YS5kYXRhc2V0c1sxXS5oaWRkZW4gPSAhY29uZmlnXzEuZGVmYXVsdC5jaGFydEFjY3VyYWN5O1xuICAgIGV4cG9ydHMuYWNjb3VudEhpc3Rvcnkub3B0aW9ucy5zY2FsZXNbXCJhY2NcIl0uZGlzcGxheSA9XG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQuY2hhcnRBY2N1cmFjeTtcbiAgICBleHBvcnRzLmFjY291bnRIaXN0b3J5LnVwZGF0ZSgpO1xufVxuZnVuY3Rpb24gdXBkYXRlU3R5bGUoKSB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuY2hhcnRTdHlsZSA9PSBcInNjYXR0ZXJcIikge1xuICAgICAgICBleHBvcnRzLmFjY291bnRIaXN0b3J5LmRhdGEuZGF0YXNldHNbMF0uc2hvd0xpbmUgPSBmYWxzZTtcbiAgICAgICAgZXhwb3J0cy5hY2NvdW50SGlzdG9yeS5kYXRhLmRhdGFzZXRzWzFdLnNob3dMaW5lID0gZmFsc2U7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBleHBvcnRzLmFjY291bnRIaXN0b3J5LmRhdGEuZGF0YXNldHNbMF0uc2hvd0xpbmUgPSB0cnVlO1xuICAgICAgICBleHBvcnRzLmFjY291bnRIaXN0b3J5LmRhdGEuZGF0YXNldHNbMV0uc2hvd0xpbmUgPSB0cnVlO1xuICAgIH1cbiAgICBleHBvcnRzLmFjY291bnRIaXN0b3J5LnVwZGF0ZUNvbG9ycygpO1xufVxuZnVuY3Rpb24gdXBkYXRlQ29sb3JzKGNoYXJ0KSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgYmdjb2xvciA9IHlpZWxkIFRoZW1lQ29sb3JzLmdldChcImJnXCIpO1xuICAgICAgICBjb25zdCBzdWJjb2xvciA9IHlpZWxkIFRoZW1lQ29sb3JzLmdldChcInN1YlwiKTtcbiAgICAgICAgY29uc3QgbWFpbmNvbG9yID0geWllbGQgVGhlbWVDb2xvcnMuZ2V0KFwibWFpblwiKTtcbiAgICAgICAgY29uc3QgZXJyb3Jjb2xvciA9IHlpZWxkIFRoZW1lQ29sb3JzLmdldChcImVycm9yXCIpO1xuICAgICAgICBpZiAoY2hhcnQuZGF0YS5kYXRhc2V0cy5ldmVyeSgoZGF0YXNldCkgPT4gZGF0YXNldC5kYXRhLmxlbmd0aCA9PT0gMCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjaGFydC5kYXRhLmRhdGFzZXRzWzBdLmJvcmRlckNvbG9yID0gbWFpbmNvbG9yO1xuICAgICAgICBjaGFydC5kYXRhLmRhdGFzZXRzWzFdLmJvcmRlckNvbG9yID0gc3ViY29sb3I7XG4gICAgICAgIGlmIChjaGFydC5kYXRhLmRhdGFzZXRzWzJdKSB7XG4gICAgICAgICAgICBjaGFydC5kYXRhLmRhdGFzZXRzWzJdLmJvcmRlckNvbG9yID0gZXJyb3Jjb2xvcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hhcnQuZGF0YS5kYXRhc2V0c1swXS50eXBlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmIChjaGFydC5jb25maWcudHlwZSA9PT0gXCJsaW5lXCIpIHtcbiAgICAgICAgICAgICAgICBjaGFydC5kYXRhLmRhdGFzZXRzWzBdLnBvaW50QmFja2dyb3VuZENvbG9yID0gbWFpbmNvbG9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY2hhcnQuY29uZmlnLnR5cGUgPT09IFwiYmFyXCIpIHtcbiAgICAgICAgICAgICAgICBjaGFydC5kYXRhLmRhdGFzZXRzWzBdLmJhY2tncm91bmRDb2xvciA9IG1haW5jb2xvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjaGFydC5kYXRhLmRhdGFzZXRzWzBdLnR5cGUgPT09IFwiYmFyXCIpIHtcbiAgICAgICAgICAgIGNoYXJ0LmRhdGEuZGF0YXNldHNbMF0uYmFja2dyb3VuZENvbG9yID0gbWFpbmNvbG9yO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNoYXJ0LmRhdGEuZGF0YXNldHNbMF0udHlwZSA9PT0gXCJsaW5lXCIpIHtcbiAgICAgICAgICAgIGNoYXJ0LmRhdGEuZGF0YXNldHNbMF0ucG9pbnRCYWNrZ3JvdW5kQ29sb3IgPSBtYWluY29sb3I7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoYXJ0LmRhdGEuZGF0YXNldHNbMV0udHlwZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZiAoY2hhcnQuY29uZmlnLnR5cGUgPT09IFwibGluZVwiKSB7XG4gICAgICAgICAgICAgICAgY2hhcnQuZGF0YS5kYXRhc2V0c1sxXS5wb2ludEJhY2tncm91bmRDb2xvciA9IHN1YmNvbG9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY2hhcnQuY29uZmlnLnR5cGUgPT09IFwiYmFyXCIpIHtcbiAgICAgICAgICAgICAgICBjaGFydC5kYXRhLmRhdGFzZXRzWzFdLmJhY2tncm91bmRDb2xvciA9IHN1YmNvbG9yO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNoYXJ0LmRhdGEuZGF0YXNldHNbMV0udHlwZSA9PT0gXCJiYXJcIikge1xuICAgICAgICAgICAgY2hhcnQuZGF0YS5kYXRhc2V0c1sxXS5iYWNrZ3JvdW5kQ29sb3IgPSBzdWJjb2xvcjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjaGFydC5kYXRhLmRhdGFzZXRzWzFdLnR5cGUgPT09IFwibGluZVwiKSB7XG4gICAgICAgICAgICBjaGFydC5kYXRhLmRhdGFzZXRzWzFdLnBvaW50QmFja2dyb3VuZENvbG9yID0gc3ViY29sb3I7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhcnRTY2FsZU9wdGlvbnMgPSBjaGFydC5vcHRpb25zO1xuICAgICAgICBPYmplY3Qua2V5cyhjaGFydFNjYWxlT3B0aW9ucy5zY2FsZXMpLmZvckVhY2goKHNjYWxlSUQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGF4aXMgPSBjaGFydFNjYWxlT3B0aW9ucy5zY2FsZXNbc2NhbGVJRF07XG4gICAgICAgICAgICBheGlzLnRpY2tzLmNvbG9yID0gc3ViY29sb3I7XG4gICAgICAgICAgICBheGlzLnRpdGxlLmNvbG9yID0gc3ViY29sb3I7XG4gICAgICAgIH0pO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY2hhcnQuZGF0YS5kYXRhc2V0c1swXVxuICAgICAgICAgICAgICAgIC50cmVuZGxpbmVMaW5lYXIuc3R5bGUgPSBzdWJjb2xvcjtcbiAgICAgICAgICAgIGNoYXJ0LmRhdGEuZGF0YXNldHNbMV1cbiAgICAgICAgICAgICAgICAudHJlbmRsaW5lTGluZWFyLnN0eWxlID0gc3ViY29sb3I7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKF9hKSB7IH1cbiAgICAgICAgY2hhcnQub3B0aW9ucy5wbHVnaW5zLmFubm90YXRpb25cbiAgICAgICAgICAgIC5hbm5vdGF0aW9ucy5mb3JFYWNoKChhbm5vdGF0aW9uKSA9PiB7XG4gICAgICAgICAgICBpZiAoYW5ub3RhdGlvbi5pZCAhPT0gXCJmdW5ib3gtbGFiZWxcIikge1xuICAgICAgICAgICAgICAgIGFubm90YXRpb24uYm9yZGVyQ29sb3IgPSBzdWJjb2xvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFubm90YXRpb24ubGFiZWwuYmFja2dyb3VuZENvbG9yID0gc3ViY29sb3I7XG4gICAgICAgICAgICBhbm5vdGF0aW9uLmxhYmVsLmNvbG9yID0gYmdjb2xvcjtcbiAgICAgICAgfSk7XG4gICAgICAgIGNoYXJ0LnVwZGF0ZShcIm5vbmVcIik7XG4gICAgfSk7XG59XG5leHBvcnRzLnVwZGF0ZUNvbG9ycyA9IHVwZGF0ZUNvbG9ycztcbmZ1bmN0aW9uIHNldERlZmF1bHRGb250RmFtaWx5KGZvbnQpIHtcbiAgICBjaGFydF9qc18xLkNoYXJ0LmRlZmF1bHRzLmZvbnQuZmFtaWx5ID0gZm9udC5yZXBsYWNlKC9fL2csIFwiIFwiKTtcbn1cbmV4cG9ydHMuc2V0RGVmYXVsdEZvbnRGYW1pbHkgPSBzZXREZWZhdWx0Rm9udEZhbWlseTtcbmZ1bmN0aW9uIHVwZGF0ZUFsbENoYXJ0Q29sb3JzKCkge1xuICAgIFRoZW1lQ29sb3JzLnVwZGF0ZSgpO1xuICAgIGV4cG9ydHMuYWNjb3VudEhpc3RvcnkudXBkYXRlQ29sb3JzKCk7XG4gICAgZXhwb3J0cy5yZXN1bHQudXBkYXRlQ29sb3JzKCk7XG4gICAgZXhwb3J0cy5hY2NvdW50QWN0aXZpdHkudXBkYXRlQ29sb3JzKCk7XG4gICAgZXhwb3J0cy5taW5pUmVzdWx0LnVwZGF0ZUNvbG9ycygpO1xufVxuZXhwb3J0cy51cGRhdGVBbGxDaGFydENvbG9ycyA9IHVwZGF0ZUFsbENoYXJ0Q29sb3JzO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSwgZXZlbnRWYWx1ZSkgPT4ge1xuICAgIGlmIChldmVudEtleSA9PT0gXCJjaGFydEFjY3VyYWN5XCIpXG4gICAgICAgIHVwZGF0ZUFjY3VyYWN5KCk7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImNoYXJ0U3R5bGVcIilcbiAgICAgICAgdXBkYXRlU3R5bGUoKTtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiZm9udEZhbWlseVwiKVxuICAgICAgICBzZXREZWZhdWx0Rm9udEZhbWlseShldmVudFZhbHVlKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgVGVzdExvZ2ljID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtbG9naWNcIikpO1xuY29uc3QgVGVzdFVJID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtdWlcIikpO1xuY29uc3QgVGVzdFN0YXRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3Qtc3RhdHNcIikpO1xuY29uc3QgTW9ua2V5ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L21vbmtleVwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBLZXltYXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2tleW1hcFwiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IExpdmVBY2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvbGl2ZS1hY2NcIikpO1xuY29uc3QgTGl2ZUJ1cnN0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2xpdmUtYnVyc3RcIikpO1xuY29uc3QgRnVuYm94ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2Z1bmJveFwiKSk7XG5jb25zdCBTb3VuZCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9zb3VuZC1jb250cm9sbGVyXCIpKTtcbmNvbnN0IENhcmV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2NhcmV0XCIpKTtcbmNvbnN0IE1hbnVhbFJlc3RhcnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvbWFudWFsLXJlc3RhcnQtdHJhY2tlclwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IEN1c3RvbVRleHQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvY3VzdG9tLXRleHRcIikpO1xuY29uc3QgUGFnZUNvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vcGFnZS1jb250cm9sbGVyXCIpKTtcbmNvbnN0IFNldHRpbmdzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wYWdlcy9zZXR0aW5nc1wiKSk7XG5jb25zdCBMYXlvdXRFbXVsYXRvciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9sYXlvdXQtZW11bGF0b3JcIikpO1xuY29uc3QgUGFjZUNhcmV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3BhY2UtY2FyZXRcIikpO1xuY29uc3QgVGltZXJQcm9ncmVzcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90aW1lci1wcm9ncmVzc1wiKSk7XG5jb25zdCBGb2N1cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9mb2N1c1wiKSk7XG5jb25zdCBTaGlmdFRyYWNrZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3Qvc2hpZnQtdHJhY2tlclwiKSk7XG5jb25zdCBSZXBsYXkgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvcmVwbGF5XCIpKTtcbmNvbnN0IE1vbmtleVBvd2VyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9tb25rZXktcG93ZXJcIikpO1xuY29uc3QgV2Vha1Nwb3QgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3Qvd2Vhay1zcG90XCIpKTtcbmNvbnN0IExlYWRlcmJvYXJkcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbGVhZGVyYm9hcmRzXCIpKTtcbmNvbnN0IEFjdGl2ZVBhZ2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9hY3RpdmUtcGFnZVwiKSk7XG5jb25zdCBUZXN0QWN0aXZlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvdGVzdC1hY3RpdmVcIikpO1xuY29uc3QgVGVzdElucHV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtaW5wdXRcIikpO1xuY29uc3QgVGVzdFdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3Qtd29yZHNcIikpO1xuY29uc3QgV29yZFR5cGVkRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL3dvcmQtdHlwZWQtZXZlbnRcIikpO1xubGV0IGRvbnRJbnNlcnRTcGFjZSA9IGZhbHNlO1xubGV0IGNvcnJlY3RTaGlmdFVzZWQgPSB0cnVlO1xuY29uc3Qgd29yZHNJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwid29yZHNJbnB1dFwiKTtcbmZ1bmN0aW9uIHNldFdvcmRzSW5wdXQodmFsdWUpIHtcbiAgICAvLyBPbmx5IGNoYW5nZSAjd29yZHNJbnB1dCBpZiBpdCdzIG5vdCBhbHJlYWR5IHRoZSB3YW50ZWQgdmFsdWVcbiAgICAvLyBBdm9pZHMgU2FmYXJpIHRyaWdnZXJpbmcgdW5uZWVkZWQgZXZlbnRzLCBjYXVzaW5nIGlzc3VlcyB3aXRoXG4gICAgLy8gZGVhZCBrZXlzLlxuICAgIC8vIGNvbnNvbGUubG9nKFwic2V0dGluZ3Mgd29yZHMgaW5wdXQgdG8gXCIgKyB2YWx1ZSk7XG4gICAgaWYgKHZhbHVlICE9PSB3b3Jkc0lucHV0LnZhbHVlKSB7XG4gICAgICAgIHdvcmRzSW5wdXQudmFsdWUgPSB2YWx1ZTtcbiAgICB9XG59XG5mdW5jdGlvbiB1cGRhdGVVSSgpIHtcbiAgICBjb25zdCBhY2MgPSBNaXNjLnJvdW5kVG8yKFRlc3RTdGF0cy5jYWxjdWxhdGVBY2N1cmFjeSgpKTtcbiAgICBpZiAoIWlzTmFOKGFjYykpXG4gICAgICAgIExpdmVBY2MudXBkYXRlKGFjYyk7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTW9kZSA9PT0gXCJuZXh0XCIgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9PSBcInplblwiKSB7XG4gICAgICAgIEtleW1hcC5oaWdobGlnaHRLZXkoVGVzdFdvcmRzLndvcmRzXG4gICAgICAgICAgICAuZ2V0Q3VycmVudCgpXG4gICAgICAgICAgICAuY2hhckF0KFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aClcbiAgICAgICAgICAgIC50b1N0cmluZygpXG4gICAgICAgICAgICAudG9VcHBlckNhc2UoKSk7XG4gICAgfVxufVxuZnVuY3Rpb24gYmFja3NwYWNlVG9QcmV2aW91cygpIHtcbiAgICBpZiAoIVRlc3RBY3RpdmUuZ2V0KCkpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoVGVzdElucHV0LmlucHV0Lmhpc3RvcnkubGVuZ3RoID09IDAgfHxcbiAgICAgICAgVGVzdFVJLmN1cnJlbnRXb3JkRWxlbWVudEluZGV4ID09IDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoKFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5W1Rlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXggLSAxXSA9PVxuICAgICAgICBUZXN0V29yZHMud29yZHMuZ2V0KFRlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXggLSAxKSAmJlxuICAgICAgICAhY29uZmlnXzEuZGVmYXVsdC5mcmVlZG9tTW9kZSkgfHxcbiAgICAgICAgJCgkKFwiLndvcmRcIilbVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleCAtIDFdKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmNvbmZpZGVuY2VNb2RlID09PSBcIm9uXCIgfHwgY29uZmlnXzEuZGVmYXVsdC5jb25maWRlbmNlTW9kZSA9PT0gXCJtYXhcIikge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50ID0gVGVzdElucHV0LmlucHV0LnBvcEhpc3RvcnkoKTtcbiAgICBUZXN0SW5wdXQuY29ycmVjdGVkLnBvcEhpc3RvcnkoKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwibm9zcGFjZVwiIHx8IGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcImFycm93c1wiKSB7XG4gICAgICAgIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50ID0gVGVzdElucHV0LmlucHV0LmN1cnJlbnQuc2xpY2UoMCwgLTEpO1xuICAgIH1cbiAgICBUZXN0V29yZHMud29yZHMuZGVjcmVhc2VDdXJyZW50SW5kZXgoKTtcbiAgICBUZXN0VUkuc2V0Q3VycmVudFdvcmRFbGVtZW50SW5kZXgoVGVzdFVJLmN1cnJlbnRXb3JkRWxlbWVudEluZGV4IC0gMSk7XG4gICAgVGVzdFVJLnVwZGF0ZUFjdGl2ZUVsZW1lbnQodHJ1ZSk7XG4gICAgRnVuYm94LnRvZ2dsZVNjcmlwdChUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpKTtcbiAgICBUZXN0VUkudXBkYXRlV29yZEVsZW1lbnQoKTtcbiAgICBDYXJldC51cGRhdGVQb3NpdGlvbigpO1xuICAgIFJlcGxheS5hZGRSZXBsYXlFdmVudChcImJhY2tXb3JkXCIpO1xufVxuZnVuY3Rpb24gaGFuZGxlU3BhY2UoKSB7XG4gICAgdmFyIF9hO1xuICAgIGlmICghVGVzdEFjdGl2ZS5nZXQoKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChUZXN0SW5wdXQuaW5wdXQuY3VycmVudCA9PT0gXCJcIilcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIikge1xuICAgICAgICAkKFwiI3dvcmRzIC53b3JkLmFjdGl2ZVwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgJChcIiN3b3Jkc1wiKS5hcHBlbmQoXCI8ZGl2IGNsYXNzPSd3b3JkIGFjdGl2ZSc+PC9kaXY+XCIpO1xuICAgIH1cbiAgICBjb25zdCBjdXJyZW50V29yZCA9IFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KCk7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcImxheW91dGZsdWlkXCIgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9PSBcInRpbWVcIikge1xuICAgICAgICAvLyBoZXJlIEkgbmVlZCB0byBjaGVjayBpZiBDb25maWcuY3VzdG9tTGF5b3V0Rmx1aWQgZXhpc3RzIGJlY2F1c2Ugb2YgbXkgc2N1ZmZlZCBzb2x1dGlvbiBvZiByZXR1cm5pbmcgd2hlbmV2ZXIgdmFsdWUgaXMgdW5kZWZpbmVkIGluIHRoZSBzZXRDdXN0b21MYXlvdXRmbHVpZCBmdW5jdGlvblxuICAgICAgICBjb25zdCBsYXlvdXRzID0gY29uZmlnXzEuZGVmYXVsdC5jdXN0b21MYXlvdXRmbHVpZFxuICAgICAgICAgICAgPyBjb25maWdfMS5kZWZhdWx0LmN1c3RvbUxheW91dGZsdWlkLnNwbGl0KFwiI1wiKVxuICAgICAgICAgICAgOiBbXCJxd2VydHlcIiwgXCJkdm9yYWtcIiwgXCJjb2xlbWFrXCJdO1xuICAgICAgICBsZXQgaW5kZXggPSAwO1xuICAgICAgICBjb25zdCBvdXRvZiA9IFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGg7XG4gICAgICAgIGluZGV4ID0gTWF0aC5mbG9vcigoVGVzdElucHV0LmlucHV0Lmhpc3RvcnkubGVuZ3RoICsgMSkgLyAob3V0b2YgLyBsYXlvdXRzLmxlbmd0aCkpO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5sYXlvdXQgIT09IGxheW91dHNbaW5kZXhdICYmIGxheW91dHNbaW5kZXhdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGAtLS0gISEhICR7bGF5b3V0c1tpbmRleF19ICEhISAtLS1gLCAwKTtcbiAgICAgICAgfVxuICAgICAgICBVcGRhdGVDb25maWcuc2V0TGF5b3V0KGxheW91dHNbaW5kZXhdKTtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcExheW91dChsYXlvdXRzW2luZGV4XSk7XG4gICAgICAgIEtleW1hcC5oaWdobGlnaHRLZXkoVGVzdFdvcmRzLndvcmRzXG4gICAgICAgICAgICAuZ2V0Q3VycmVudCgpXG4gICAgICAgICAgICAuY2hhckF0KFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aClcbiAgICAgICAgICAgIC50b1N0cmluZygpXG4gICAgICAgICAgICAudG9VcHBlckNhc2UoKSk7XG4gICAgICAgIChfYSA9IFNldHRpbmdzLmdyb3Vwc1tcImxheW91dFwiXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnVwZGF0ZUlucHV0KCk7XG4gICAgfVxuICAgIGRvbnRJbnNlcnRTcGFjZSA9IHRydWU7XG4gICAgY29uc3QgYnVyc3QgPSBUZXN0U3RhdHMuY2FsY3VsYXRlQnVyc3QoKTtcbiAgICBMaXZlQnVyc3QudXBkYXRlKE1hdGgucm91bmQoYnVyc3QpKTtcbiAgICBUZXN0SW5wdXQucHVzaEJ1cnN0VG9IaXN0b3J5KGJ1cnN0KTtcbiAgICAvL2NvcnJlY3Qgd29yZCBvciBpbiB6ZW4gbW9kZVxuICAgIGNvbnN0IGlzV29yZENvcnJlY3QgPSBjdXJyZW50V29yZCA9PSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCB8fCBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIjtcbiAgICAvLyBUaGlzIHdpbGwgcHJvYmFibHkgYnJlYWsgaWYgbGV0dGVyIG1vZGUgaXMgb24gb3Igc29tZXRoaW5nXG4gICAgY29uc3QgJGN1cnJlbnRUZXN0V29yZCA9ICQoYCN3b3JkcyAud29yZC5hY3RpdmVgKTtcbiAgICBXb3JkVHlwZWRFdmVudC5kaXNwYXRjaChjdXJyZW50V29yZCwgaXNXb3JkQ29ycmVjdCwgYnVyc3QsICRjdXJyZW50VGVzdFdvcmQpO1xuICAgIE1vbmtleVBvd2VyLmFkZFBvd2VyKGlzV29yZENvcnJlY3QsIHRydWUpO1xuICAgIFRlc3RJbnB1dC5pbmNyZW1lbnRBY2N1cmFjeShpc1dvcmRDb3JyZWN0KTtcbiAgICBpZiAoaXNXb3JkQ29ycmVjdCkge1xuICAgICAgICBQYWNlQ2FyZXQuaGFuZGxlU3BhY2UodHJ1ZSwgY3VycmVudFdvcmQpO1xuICAgICAgICBUZXN0SW5wdXQuaW5wdXQucHVzaEhpc3RvcnkoKTtcbiAgICAgICAgVGVzdFdvcmRzLndvcmRzLmluY3JlYXNlQ3VycmVudEluZGV4KCk7XG4gICAgICAgIFRlc3RVSS5zZXRDdXJyZW50V29yZEVsZW1lbnRJbmRleChUZXN0VUkuY3VycmVudFdvcmRFbGVtZW50SW5kZXggKyAxKTtcbiAgICAgICAgVGVzdFVJLnVwZGF0ZUFjdGl2ZUVsZW1lbnQoKTtcbiAgICAgICAgRnVuYm94LnRvZ2dsZVNjcmlwdChUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpKTtcbiAgICAgICAgQ2FyZXQudXBkYXRlUG9zaXRpb24oKTtcbiAgICAgICAgVGVzdElucHV0LmluY3JlbWVudEtleXByZXNzQ291bnQoKTtcbiAgICAgICAgVGVzdElucHV0LnB1c2hLZXlwcmVzc1dvcmQoVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleCk7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCAhPT0gXCJub3NwYWNlXCIgJiYgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggIT09IFwiYXJyb3dzXCIpIHtcbiAgICAgICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgICAgICB9XG4gICAgICAgIFJlcGxheS5hZGRSZXBsYXlFdmVudChcInN1Ym1pdENvcnJlY3RXb3JkXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ICE9PSBcIm5vc3BhY2VcIiAmJiBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCAhPT0gXCJhcnJvd3NcIikge1xuICAgICAgICAgICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LnBsYXlTb3VuZE9uRXJyb3IgfHwgY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUpIHtcbiAgICAgICAgICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIFNvdW5kLnBsYXlFcnJvcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFRlc3RJbnB1dC5wdXNoTWlzc2VkV29yZChUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpKTtcbiAgICAgICAgVGVzdElucHV0LmluY3JlbWVudEtleXByZXNzRXJyb3JzKCk7XG4gICAgICAgIGNvbnN0IGNpbCA9IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aDtcbiAgICAgICAgaWYgKGNpbCA8PSBUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpLmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKGNpbCA+PSBUZXN0SW5wdXQuY29ycmVjdGVkLmN1cnJlbnQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgVGVzdElucHV0LmNvcnJlY3RlZC5jdXJyZW50ICs9IFwiX1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgVGVzdElucHV0LmNvcnJlY3RlZC5jdXJyZW50ID1cbiAgICAgICAgICAgICAgICAgICAgVGVzdElucHV0LmNvcnJlY3RlZC5jdXJyZW50LnN1YnN0cmluZygwLCBjaWwpICtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiX1wiICtcbiAgICAgICAgICAgICAgICAgICAgICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQuY3VycmVudC5zdWJzdHJpbmcoY2lsICsgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc3RvcE9uRXJyb3IgIT0gXCJvZmZcIikge1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSA9PSBcImV4cGVydFwiIHx8IGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSA9PSBcIm1hc3RlclwiKSB7XG4gICAgICAgICAgICAgICAgLy9mYWlsZWQgZHVlIHRvIGRpZmYgd2hlbiBwcmVzc2luZyBzcGFjZVxuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5mYWlsKFwiZGlmZmljdWx0eVwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zdG9wT25FcnJvciA9PSBcIndvcmRcIikge1xuICAgICAgICAgICAgICAgIGRvbnRJbnNlcnRTcGFjZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIFJlcGxheS5hZGRSZXBsYXlFdmVudChcImluY29ycmVjdExldHRlclwiLCBcIl9cIik7XG4gICAgICAgICAgICAgICAgVGVzdFVJLnVwZGF0ZVdvcmRFbGVtZW50KHRydWUpO1xuICAgICAgICAgICAgICAgIENhcmV0LnVwZGF0ZVBvc2l0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgUGFjZUNhcmV0LmhhbmRsZVNwYWNlKGZhbHNlLCBjdXJyZW50V29yZCk7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSAmJiBjb25maWdfMS5kZWZhdWx0LmhpZ2hsaWdodE1vZGUgIT09IFwib2ZmXCIpIHtcbiAgICAgICAgICAgICQoXCIjd29yZHMgLndvcmQuYWN0aXZlIGxldHRlclwiKS5hZGRDbGFzcyhcImNvcnJlY3RcIik7XG4gICAgICAgIH1cbiAgICAgICAgVGVzdElucHV0LmlucHV0LnB1c2hIaXN0b3J5KCk7XG4gICAgICAgIFRlc3RVSS5oaWdobGlnaHRCYWRXb3JkKFRlc3RVSS5jdXJyZW50V29yZEVsZW1lbnRJbmRleCwgIWNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlKTtcbiAgICAgICAgVGVzdFdvcmRzLndvcmRzLmluY3JlYXNlQ3VycmVudEluZGV4KCk7XG4gICAgICAgIFRlc3RVSS5zZXRDdXJyZW50V29yZEVsZW1lbnRJbmRleChUZXN0VUkuY3VycmVudFdvcmRFbGVtZW50SW5kZXggKyAxKTtcbiAgICAgICAgVGVzdFVJLnVwZGF0ZUFjdGl2ZUVsZW1lbnQoKTtcbiAgICAgICAgRnVuYm94LnRvZ2dsZVNjcmlwdChUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpKTtcbiAgICAgICAgQ2FyZXQudXBkYXRlUG9zaXRpb24oKTtcbiAgICAgICAgVGVzdElucHV0LmluY3JlbWVudEtleXByZXNzQ291bnQoKTtcbiAgICAgICAgVGVzdElucHV0LnB1c2hLZXlwcmVzc1dvcmQoVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleCk7XG4gICAgICAgIFRlc3RJbnB1dC51cGRhdGVMYXN0S2V5cHJlc3MoKTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSA9PSBcImV4cGVydFwiIHx8IGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSA9PSBcIm1hc3RlclwiKSB7XG4gICAgICAgICAgICBUZXN0TG9naWMuZmFpbChcImRpZmZpY3VsdHlcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleCA9PSBUZXN0V29yZHMud29yZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAvL3N1Ym1pdHRlZCBsYXN0IHdvcmQgdGhhdCBpcyBpbmNvcnJlY3RcbiAgICAgICAgICAgIFRlc3RMb2dpYy5maW5pc2goKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBSZXBsYXkuYWRkUmVwbGF5RXZlbnQoXCJzdWJtaXRFcnJvcldvcmRcIik7XG4gICAgfVxuICAgIGxldCB3b3JkTGVuZ3RoO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiemVuXCIpIHtcbiAgICAgICAgd29yZExlbmd0aCA9IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHdvcmRMZW5ndGggPSBUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpLmxlbmd0aDtcbiAgICB9XG4gICAgY29uc3QgZmxleCA9IE1pc2Mud2hvcmYoY29uZmlnXzEuZGVmYXVsdC5taW5CdXJzdEN1c3RvbVNwZWVkLCB3b3JkTGVuZ3RoKTtcbiAgICBpZiAoKGNvbmZpZ18xLmRlZmF1bHQubWluQnVyc3QgPT09IFwiZml4ZWRcIiAmJiBidXJzdCA8IGNvbmZpZ18xLmRlZmF1bHQubWluQnVyc3RDdXN0b21TcGVlZCkgfHxcbiAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubWluQnVyc3QgPT09IFwiZmxleFwiICYmIGJ1cnN0IDwgZmxleCkpIHtcbiAgICAgICAgVGVzdExvZ2ljLmZhaWwoXCJtaW4gYnVyc3RcIik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgVGVzdElucHV0LmNvcnJlY3RlZC5wdXNoSGlzdG9yeSgpO1xuICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5zaG93QWxsTGluZXMgfHxcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwidGltZVwiIHx8XG4gICAgICAgIChDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJiBDdXN0b21UZXh0LndvcmQgPT0gMCkgfHxcbiAgICAgICAgQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20pIHtcbiAgICAgICAgY29uc3QgY3VycmVudFRvcCA9IE1hdGguZmxvb3IoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIiN3b3JkcyAud29yZFwiKVtUZXN0VUkuY3VycmVudFdvcmRFbGVtZW50SW5kZXggLSAxXS5vZmZzZXRUb3ApO1xuICAgICAgICBsZXQgbmV4dFRvcDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG5leHRUb3AgPSBNYXRoLmZsb29yKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIjd29yZHMgLndvcmRcIilbVGVzdFVJLmN1cnJlbnRXb3JkRWxlbWVudEluZGV4XS5vZmZzZXRUb3ApO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBuZXh0VG9wID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmV4dFRvcCA+IGN1cnJlbnRUb3AgJiYgIVRlc3RVSS5saW5lVHJhbnNpdGlvbikge1xuICAgICAgICAgICAgVGVzdFVJLmxpbmVKdW1wKGN1cnJlbnRUb3ApO1xuICAgICAgICB9XG4gICAgfSAvL2VuZCBvZiBsaW5lIHdyYXBcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBNb2RlID09PSBcInJlYWN0XCIpIHtcbiAgICAgICAgS2V5bWFwLmZsYXNoS2V5KFwiIFwiLCB0cnVlKTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ3b3Jkc1wiIHx8XG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiB8fFxuICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIiB8fFxuICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiemVuXCIpIHtcbiAgICAgICAgVGltZXJQcm9ncmVzcy51cGRhdGUoKTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInRpbWVcIiB8fFxuICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ3b3Jkc1wiIHx8XG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcImN1c3RvbVwiIHx8XG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInF1b3RlXCIpIHtcbiAgICAgICAgVGVzdExvZ2ljLmFkZFdvcmQoKTtcbiAgICB9XG59XG5mdW5jdGlvbiBpc0NoYXJDb3JyZWN0KGNoYXIsIGNoYXJJbmRleCkge1xuICAgIGlmICghY29ycmVjdFNoaWZ0VXNlZClcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY29uc3Qgb3JpZ2luYWxDaGFyID0gVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKVtjaGFySW5kZXhdO1xuICAgIGlmIChvcmlnaW5hbENoYXIgPT0gY2hhcikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2Uuc3BsaXQoXCJfXCIpWzBdID09IFwicnVzc2lhblwiKSB7XG4gICAgICAgIGlmICgoY2hhciA9PT0gXCLQtVwiIHx8IGNoYXIgPT09IFwiZVwiKSAmJiBvcmlnaW5hbENoYXIgPT0gXCLRkVwiKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hhciA9PT0gXCLRkVwiICYmIChvcmlnaW5hbENoYXIgPT0gXCLQtVwiIHx8IG9yaWdpbmFsQ2hhciA9PT0gXCJlXCIpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwiYXJyb3dzXCIpIHtcbiAgICAgICAgaWYgKChjaGFyID09PSBcIndcIiB8fCBjaGFyID09PSBcIkFycm93VXBcIikgJiYgb3JpZ2luYWxDaGFyID09IFwi4oaRXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICgoY2hhciA9PT0gXCJzXCIgfHwgY2hhciA9PT0gXCJBcnJvd0Rvd25cIikgJiYgb3JpZ2luYWxDaGFyID09IFwi4oaTXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICgoY2hhciA9PT0gXCJhXCIgfHwgY2hhciA9PT0gXCJBcnJvd0xlZnRcIikgJiYgb3JpZ2luYWxDaGFyID09IFwi4oaQXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICgoY2hhciA9PT0gXCJkXCIgfHwgY2hhciA9PT0gXCJBcnJvd1JpZ2h0XCIpICYmIG9yaWdpbmFsQ2hhciA9PSBcIuKGklwiKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoKGNoYXIgPT09IGDigJlgIHx8IGNoYXIgPT09IFwi4oCYXCIgfHwgY2hhciA9PT0gXCInXCIpICYmXG4gICAgICAgIChvcmlnaW5hbENoYXIgPT0gYOKAmWAgfHwgb3JpZ2luYWxDaGFyID09PSBcIuKAmFwiIHx8IG9yaWdpbmFsQ2hhciA9PT0gXCInXCIpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoKGNoYXIgPT09IGBcImAgfHwgY2hhciA9PT0gXCLigJ1cIiB8fCBjaGFyID09IFwi4oCcXCIgfHwgY2hhciA9PT0gXCLigJ5cIikgJiZcbiAgICAgICAgKG9yaWdpbmFsQ2hhciA9PSBgXCJgIHx8XG4gICAgICAgICAgICBvcmlnaW5hbENoYXIgPT09IFwi4oCdXCIgfHxcbiAgICAgICAgICAgIG9yaWdpbmFsQ2hhciA9PT0gXCLigJxcIiB8fFxuICAgICAgICAgICAgb3JpZ2luYWxDaGFyID09PSBcIuKAnlwiKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKChjaGFyID09PSBcIuKAk1wiIHx8IGNoYXIgPT09IFwi4oCUXCIgfHwgY2hhciA9PSBcIi1cIikgJiZcbiAgICAgICAgKG9yaWdpbmFsQ2hhciA9PSBcIi1cIiB8fCBvcmlnaW5hbENoYXIgPT09IFwi4oCTXCIgfHwgb3JpZ2luYWxDaGFyID09PSBcIuKAlFwiKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuZnVuY3Rpb24gaGFuZGxlQ2hhcihjaGFyLCBjaGFySW5kZXgpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgaWYgKFRlc3RVSS5yZXN1bHRDYWxjdWxhdGluZyB8fCBUZXN0VUkucmVzdWx0VmlzaWJsZSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjaGFyID09PSBcIuKAplwiKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMzsgaSsrKSB7XG4gICAgICAgICAgICBoYW5kbGVDaGFyKFwiLlwiLCBjaGFySW5kZXggKyBpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjaGFyID09PSBcIlxcblwiICYmIGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcIjU4MDA4XCIpIHtcbiAgICAgICAgY2hhciA9IFwiIFwiO1xuICAgIH1cbiAgICBpZiAoY2hhciAhPT0gXCJcXG5cIiAmJiBjaGFyICE9PSBcIlxcdFwiICYmIC9cXHMvLnRlc3QoY2hhcikpIHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcIm5vc3BhY2VcIiB8fCBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIilcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaGFuZGxlU3BhY2UoKTtcbiAgICAgICAgLy9pbnNlcnQgc3BhY2UgZm9yIGV4cGVydCBhbmQgbWFzdGVyIG9yIHN0cmljdCBzcGFjZSxcbiAgICAgICAgLy9vciBmb3Igc3RvcCBvbiBlcnJvciBzZXQgdG8gd29yZCxcbiAgICAgICAgLy9vdGhlcndpc2UgZG9udCBkbyBhbnl0aGluZ1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ICE9PSBcIm5vcm1hbFwiIHx8XG4gICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5zdHJpY3RTcGFjZSAmJiBjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT09IFwiemVuXCIpIHx8XG4gICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0LnN0b3BPbkVycm9yID09PSBcIndvcmRcIikge1xuICAgICAgICAgICAgaWYgKGRvbnRJbnNlcnRTcGFjZSkge1xuICAgICAgICAgICAgICAgIGRvbnRJbnNlcnRTcGFjZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9PSBcInplblwiICYmXG4gICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KClbY2hhckluZGV4XSAhPT0gXCJcXG5cIiAmJlxuICAgICAgICBjaGFyID09PSBcIlxcblwiKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy9zdGFydCB0aGUgdGVzdFxuICAgIGlmICghVGVzdEFjdGl2ZS5nZXQoKSAmJiAhVGVzdExvZ2ljLnN0YXJ0VGVzdCgpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgRm9jdXMuc2V0KHRydWUpO1xuICAgIENhcmV0LnN0b3BBbmltYXRpb24oKTtcbiAgICBjb25zdCB0aGlzQ2hhckNvcnJlY3QgPSBpc0NoYXJDb3JyZWN0KGNoYXIsIGNoYXJJbmRleCk7XG4gICAgaWYgKHRoaXNDaGFyQ29ycmVjdCAmJiBjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT09IFwiemVuXCIpIHtcbiAgICAgICAgY2hhciA9IFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KCkuY2hhckF0KGNoYXJJbmRleCk7XG4gICAgfVxuICAgIGlmICghdGhpc0NoYXJDb3JyZWN0ICYmIGNoYXIgPT09IFwiXFxuXCIpIHtcbiAgICAgICAgaWYgKFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50ID09PSBcIlwiKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjaGFyID0gXCIgXCI7XG4gICAgfVxuICAgIGlmIChUZXN0SW5wdXQuaW5wdXQuY3VycmVudCA9PT0gXCJcIikge1xuICAgICAgICBUZXN0SW5wdXQuc2V0QnVyc3RTdGFydChwZXJmb3JtYW5jZS5ub3coKSk7XG4gICAgfVxuICAgIGNvbnN0IHJlc3VsdGluZ1dvcmQgPSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5zdWJzdHJpbmcoMCwgY2hhckluZGV4KSArXG4gICAgICAgIGNoYXIgK1xuICAgICAgICBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5zdWJzdHJpbmcoY2hhckluZGV4ICsgMSk7XG4gICAgaWYgKCF0aGlzQ2hhckNvcnJlY3QgJiYgTWlzYy50cmFpbGluZ0NvbXBvc2VDaGFycy50ZXN0KHJlc3VsdGluZ1dvcmQpKSB7XG4gICAgICAgIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50ID0gcmVzdWx0aW5nV29yZDtcbiAgICAgICAgVGVzdFVJLnVwZGF0ZVdvcmRFbGVtZW50KCk7XG4gICAgICAgIENhcmV0LnVwZGF0ZVBvc2l0aW9uKCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgTW9ua2V5UG93ZXIuYWRkUG93ZXIodGhpc0NoYXJDb3JyZWN0KTtcbiAgICBUZXN0SW5wdXQuaW5jcmVtZW50QWNjdXJhY3kodGhpc0NoYXJDb3JyZWN0KTtcbiAgICBpZiAoIXRoaXNDaGFyQ29ycmVjdCkge1xuICAgICAgICBUZXN0SW5wdXQuaW5jcmVtZW50S2V5cHJlc3NFcnJvcnMoKTtcbiAgICAgICAgVGVzdElucHV0LnB1c2hNaXNzZWRXb3JkKFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KCkpO1xuICAgIH1cbiAgICBXZWFrU3BvdC51cGRhdGVTY29yZShjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiemVuXCIgPyBjaGFyIDogVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKVtjaGFySW5kZXhdLCB0aGlzQ2hhckNvcnJlY3QpO1xuICAgIGlmICh0aGlzQ2hhckNvcnJlY3QpIHtcbiAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQucGxheVNvdW5kT25FcnJvciB8fCBjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSkge1xuICAgICAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBTb3VuZC5wbGF5RXJyb3IoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWNvcnJlY3RTaGlmdFVzZWQgJiYgY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ICE9IFwibWFzdGVyXCIpXG4gICAgICAgIHJldHVybjtcbiAgICAvL3VwZGF0ZSBjdXJyZW50IGNvcnJlY3RlZCB2ZXJzaW9uLiBpZiBpdHMgZW1wdHkgdGhlbiBhZGQgdGhlIGN1cnJlbnQgY2hhci4gaWYgaXRzIG5vdCB0aGVuIHJlcGxhY2UgdGhlIGxhc3QgY2hhcmFjdGVyIHdpdGggdGhlIGN1cnJlbnRseSBwcmVzc2VkIG9uZSAvIGFkZCBpdFxuICAgIGlmIChUZXN0SW5wdXQuY29ycmVjdGVkLmN1cnJlbnQgPT09IFwiXCIpIHtcbiAgICAgICAgVGVzdElucHV0LmNvcnJlY3RlZC5jdXJyZW50ICs9IHJlc3VsdGluZ1dvcmQ7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoY2hhckluZGV4ID49IFRlc3RJbnB1dC5jb3JyZWN0ZWQuY3VycmVudC5sZW5ndGgpIHtcbiAgICAgICAgICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQuY3VycmVudCArPSBjaGFyO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCF0aGlzQ2hhckNvcnJlY3QpIHtcbiAgICAgICAgICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQuY3VycmVudCA9XG4gICAgICAgICAgICAgICAgVGVzdElucHV0LmNvcnJlY3RlZC5jdXJyZW50LnN1YnN0cmluZygwLCBjaGFySW5kZXgpICtcbiAgICAgICAgICAgICAgICAgICAgY2hhciArXG4gICAgICAgICAgICAgICAgICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQuY3VycmVudC5zdWJzdHJpbmcoY2hhckluZGV4ICsgMSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgVGVzdElucHV0LmluY3JlbWVudEtleXByZXNzQ291bnQoKTtcbiAgICBUZXN0SW5wdXQudXBkYXRlTGFzdEtleXByZXNzKCk7XG4gICAgVGVzdElucHV0LnB1c2hLZXlwcmVzc1dvcmQoVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleCk7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSAhPT0gXCJtYXN0ZXJcIiAmJlxuICAgICAgICBjb25maWdfMS5kZWZhdWx0LnN0b3BPbkVycm9yID09IFwibGV0dGVyXCIgJiZcbiAgICAgICAgIXRoaXNDaGFyQ29ycmVjdCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIFJlcGxheS5hZGRSZXBsYXlFdmVudCh0aGlzQ2hhckNvcnJlY3QgPyBcImNvcnJlY3RMZXR0ZXJcIiA6IFwiaW5jb3JyZWN0TGV0dGVyXCIsIGNoYXIpO1xuICAgIC8vdXBkYXRlIHRoZSBhY3RpdmUgd29yZCB0b3AsIGJ1dCBvbmx5IG9uY2VcbiAgICBpZiAoVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoID09PSAxICYmXG4gICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXggPT09IDApIHtcbiAgICAgICAgVGVzdFVJLnNldEFjdGl2ZVdvcmRUb3AoKF9hID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN3b3JkcyAuYWN0aXZlXCIpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Eub2Zmc2V0VG9wKTtcbiAgICB9XG4gICAgLy9tYXggbGVuZ3RoIG9mIHRoZSBpbnB1dCBpcyAyMCB1bmxlc3MgaW4gemVuIG1vZGUgdGhlbiBpdHMgMzBcbiAgICBpZiAoKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ6ZW5cIiAmJiBjaGFySW5kZXggPCAzMCkgfHxcbiAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJ6ZW5cIiAmJlxuICAgICAgICAgICAgY2hhckluZGV4IDwgVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKS5sZW5ndGggKyAyMCkpIHtcbiAgICAgICAgVGVzdElucHV0LmlucHV0LmN1cnJlbnQgPSByZXN1bHRpbmdXb3JkO1xuICAgIH1cbiAgICBpZiAoIXRoaXNDaGFyQ29ycmVjdCAmJiBjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHkgPT0gXCJtYXN0ZXJcIikge1xuICAgICAgICBUZXN0SW5wdXQuaW5wdXQucHVzaEhpc3RvcnkoKTtcbiAgICAgICAgVGVzdElucHV0LmNvcnJlY3RlZC5wdXNoSGlzdG9yeSgpO1xuICAgICAgICBUZXN0TG9naWMuZmFpbChcImRpZmZpY3VsdHlcIik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy9rZXltYXBcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBNb2RlID09PSBcInJlYWN0XCIpIHtcbiAgICAgICAgS2V5bWFwLmZsYXNoS2V5KGNoYXIsIHRoaXNDaGFyQ29ycmVjdCk7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT0gXCJ6ZW5cIikge1xuICAgICAgICAvL25vdCBhcHBsaWNhYmxlIHRvIHplbiBtb2RlXG4gICAgICAgIC8vYXV0byBzdG9wIHRoZSB0ZXN0IGlmIHRoZSBsYXN0IHdvcmQgaXMgY29ycmVjdFxuICAgICAgICBjb25zdCBjdXJyZW50V29yZCA9IFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KCk7XG4gICAgICAgIGNvbnN0IGxhc3RpbmRleCA9IFRlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXg7XG4gICAgICAgIGlmICgoY3VycmVudFdvcmQgPT0gVGVzdElucHV0LmlucHV0LmN1cnJlbnQgfHxcbiAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0LnF1aWNrRW5kICYmXG4gICAgICAgICAgICAgICAgY3VycmVudFdvcmQubGVuZ3RoID09IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCAmJlxuICAgICAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQuc3RvcE9uRXJyb3IgPT0gXCJvZmZcIikpICYmXG4gICAgICAgICAgICBsYXN0aW5kZXggPT0gVGVzdFdvcmRzLndvcmRzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgIFRlc3RJbnB1dC5pbnB1dC5wdXNoSGlzdG9yeSgpO1xuICAgICAgICAgICAgVGVzdElucHV0LmNvcnJlY3RlZC5wdXNoSGlzdG9yeSgpO1xuICAgICAgICAgICAgVGVzdExvZ2ljLmZpbmlzaCgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGFjdGl2ZVdvcmRUb3BCZWZvcmVKdW1wID0gKF9iID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN3b3JkcyAud29yZC5hY3RpdmVcIikpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5vZmZzZXRUb3A7XG4gICAgVGVzdFVJLnVwZGF0ZVdvcmRFbGVtZW50KCk7XG4gICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LmhpZGVFeHRyYUxldHRlcnMpIHtcbiAgICAgICAgY29uc3QgbmV3QWN0aXZlVG9wID0gKF9jID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN3b3JkcyAud29yZC5hY3RpdmVcIikpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5vZmZzZXRUb3A7XG4gICAgICAgIC8vc3RvcCB0aGUgd29yZCBqdW1wIGJ5IHNsaWNpbmcgb2ZmIHRoZSBsYXN0IGNoYXJhY3RlciwgdXBkYXRlIHdvcmQgYWdhaW5cbiAgICAgICAgaWYgKGFjdGl2ZVdvcmRUb3BCZWZvcmVKdW1wIDwgbmV3QWN0aXZlVG9wICYmXG4gICAgICAgICAgICAhVGVzdFVJLmxpbmVUcmFuc2l0aW9uICYmXG4gICAgICAgICAgICBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50VG9wID0gTWF0aC5mbG9vcigoX2QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiI3dvcmRzIC53b3JkXCIpW1Rlc3RVSS5jdXJyZW50V29yZEVsZW1lbnRJbmRleCAtIDFdKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Qub2Zmc2V0VG9wKTtcbiAgICAgICAgICAgICAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuc2hvd0FsbExpbmVzKVxuICAgICAgICAgICAgICAgICAgICBUZXN0VUkubGluZUp1bXAoY3VycmVudFRvcCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCA9IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50LnNsaWNlKDAsIC0xKTtcbiAgICAgICAgICAgICAgICBUZXN0VUkudXBkYXRlV29yZEVsZW1lbnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvL3NpbXVsYXRlIHNwYWNlIHByZXNzIGluIG5vc3BhY2UgZnVuYm94XG4gICAgaWYgKCgoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwibm9zcGFjZVwiIHx8IGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcImFycm93c1wiKSAmJlxuICAgICAgICBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGggPT09IFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KCkubGVuZ3RoKSB8fFxuICAgICAgICAoY2hhciA9PT0gXCJcXG5cIiAmJiB0aGlzQ2hhckNvcnJlY3QpKSB7XG4gICAgICAgIGhhbmRsZVNwYWNlKCk7XG4gICAgfVxuICAgIGlmIChjaGFyICE9PSBcIlxcblwiKSB7XG4gICAgICAgIENhcmV0LnVwZGF0ZVBvc2l0aW9uKCk7XG4gICAgfVxufVxuZnVuY3Rpb24gaGFuZGxlVGFiKGV2ZW50LCBwb3B1cFZpc2libGUpIHtcbiAgICAvL3RvZG8gcmVmYWN0b3IgdGhpcyBtZXNzXG4gICAgaWYgKFRlc3RVSS5yZXN1bHRDYWxjdWxhdGluZykge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbiAgICBpZiAoQWN0aXZlUGFnZS5nZXQoKSAhPT0gXCJ0ZXN0XCIgJiYgcG9wdXBWaXNpYmxlKSB7XG4gICAgICAgIC8vIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCQoXCIjY3VzdG9tVGV4dFBvcHVwIC50ZXh0YXJlYVwiKS5pcyhcIjpmb2N1c1wiKSkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zdCBhcmVhID0gJChcIiNjdXN0b21UZXh0UG9wdXAgLnRleHRhcmVhXCIpWzBdO1xuICAgICAgICBjb25zdCBzdGFydCA9IGFyZWEuc2VsZWN0aW9uU3RhcnQ7XG4gICAgICAgIGNvbnN0IGVuZCA9IGFyZWEuc2VsZWN0aW9uRW5kO1xuICAgICAgICAvLyBzZXQgdGV4dGFyZWEgdmFsdWUgdG86IHRleHQgYmVmb3JlIGNhcmV0ICsgdGFiICsgdGV4dCBhZnRlciBjYXJldFxuICAgICAgICBhcmVhLnZhbHVlID1cbiAgICAgICAgICAgIGFyZWEudmFsdWUuc3Vic3RyaW5nKDAsIHN0YXJ0KSArIFwiXFx0XCIgKyBhcmVhLnZhbHVlLnN1YnN0cmluZyhlbmQpO1xuICAgICAgICAvLyBwdXQgY2FyZXQgYXQgcmlnaHQgcG9zaXRpb24gYWdhaW5cbiAgICAgICAgYXJlYS5zZWxlY3Rpb25TdGFydCA9IGFyZWEuc2VsZWN0aW9uRW5kID0gc3RhcnQgKyAxO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGVsc2UgaWYgKCFUZXN0VUkucmVzdWx0Q2FsY3VsYXRpbmcgJiZcbiAgICAgICAgJChcIiNjb21tYW5kTGluZVdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikgJiZcbiAgICAgICAgJChcIiNzaW1wbGVQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikgJiZcbiAgICAgICAgJChcIiNxdW90ZVN1Ym1pdFBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSAmJlxuICAgICAgICBBY3RpdmVQYWdlLmdldCgpICE9IFwibG9naW5cIikge1xuICAgICAgICBpZiAoQWN0aXZlUGFnZS5nZXQoKSA9PSBcInRlc3RcIikge1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucXVpY2tUYWIpIHtcbiAgICAgICAgICAgICAgICBpZiAoISQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAgICAgICAgICAgICBMZWFkZXJib2FyZHMuaGlkZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocG9wdXBWaXNpYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKFRlc3RVSS5yZXN1bHRWaXNpYmxlIHx8XG4gICAgICAgICAgICAgICAgICAgICEoKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiICYmICFldmVudC5zaGlmdEtleSkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIChUZXN0V29yZHMuaGFzVGFiICYmICFldmVudC5zaGlmdEtleSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5zaGlmdEtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIE1hbnVhbFJlc3RhcnQucmVzZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoVGVzdEFjdGl2ZS5nZXQoKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5yZXBlYXRRdW90ZXMgPT09IFwidHlwaW5nXCIgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCh0cnVlLCBmYWxzZSwgZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoZmFsc2UsIGZhbHNlLCBldmVudCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZUNoYXIoXCJcXHRcIiwgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgc2V0V29yZHNJbnB1dChcIiBcIiArIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghVGVzdFVJLnJlc3VsdFZpc2libGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoKFRlc3RXb3Jkcy5oYXNUYWIgJiYgZXZlbnQuc2hpZnRLZXkpIHx8XG4gICAgICAgICAgICAgICAgICAgICghVGVzdFdvcmRzLmhhc1RhYiAmJiBjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT09IFwiemVuXCIpIHx8XG4gICAgICAgICAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiemVuXCIgJiYgZXZlbnQuc2hpZnRLZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICQoXCIjcmVzdGFydFRlc3RCdXR0b25cIikudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlQ2hhcihcIlxcdFwiLCBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICBzZXRXb3Jkc0lucHV0KFwiIFwiICsgVGVzdElucHV0LmlucHV0LmN1cnJlbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LnF1aWNrVGFiKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgUGFnZUNvbnRyb2xsZXIuY2hhbmdlKFwidGVzdFwiKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiQoZG9jdW1lbnQpLmtleWRvd24oKGV2ZW50KSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT0gXCJsb2FkaW5nXCIpXG4gICAgICAgIHJldHVybiBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIC8vYXV0b2ZvY3VzXG4gICAgY29uc3Qgd29yZHNGb2N1c2VkID0gJChcIiN3b3Jkc0lucHV0XCIpLmlzKFwiOmZvY3VzXCIpO1xuICAgIGNvbnN0IHBhZ2VUZXN0QWN0aXZlID0gQWN0aXZlUGFnZS5nZXQoKSA9PT0gXCJ0ZXN0XCI7XG4gICAgY29uc3QgY29tbWFuZExpbmVWaXNpYmxlID0gISQoXCIjY29tbWFuZExpbmVXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpO1xuICAgIGNvbnN0IGxlYWRlcmJvYXJkc1Zpc2libGUgPSAhJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpO1xuICAgIGNvbnN0IHBvcHVwcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucG9wdXBXcmFwcGVyXCIpO1xuICAgIGxldCBwb3B1cFZpc2libGUgPSBmYWxzZTtcbiAgICBmb3IgKGNvbnN0IHBvcHVwIG9mIHBvcHVwcykge1xuICAgICAgICBpZiAoIXBvcHVwLmNsYXNzTGlzdC5jb250YWlucyhcImhpZGRlblwiKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgcG9wdXBWaXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGFsbG93VHlwaW5nID0gcGFnZVRlc3RBY3RpdmUgJiZcbiAgICAgICAgIWNvbW1hbmRMaW5lVmlzaWJsZSAmJlxuICAgICAgICAhbGVhZGVyYm9hcmRzVmlzaWJsZSAmJlxuICAgICAgICAhcG9wdXBWaXNpYmxlICYmXG4gICAgICAgICFUZXN0VUkucmVzdWx0VmlzaWJsZSAmJlxuICAgICAgICAod29yZHNGb2N1c2VkIHx8IGV2ZW50LmtleSAhPT0gXCJFbnRlclwiKTtcbiAgICBpZiAoYWxsb3dUeXBpbmcgJiYgIXdvcmRzRm9jdXNlZCAmJiBldmVudC5rZXkgIT09IFwiRW50ZXJcIikge1xuICAgICAgICBUZXN0VUkuZm9jdXNXb3JkcygpO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zaG93T3V0T2ZGb2N1c1dhcm5pbmcpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy90YWJcbiAgICBpZiAoKGV2ZW50LmtleSA9PSBcIlRhYlwiICYmICFjb25maWdfMS5kZWZhdWx0LnN3YXBFc2NBbmRUYWIpIHx8XG4gICAgICAgIChldmVudC5rZXkgPT0gXCJFc2NhcGVcIiAmJiBjb25maWdfMS5kZWZhdWx0LnN3YXBFc2NBbmRUYWIpKSB7XG4gICAgICAgIGhhbmRsZVRhYihldmVudCwgcG9wdXBWaXNpYmxlKTtcbiAgICB9XG4gICAgaWYgKCFhbGxvd1R5cGluZylcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmICghKChfYSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc1RydXN0ZWQpIHx8IFRlc3RVSS50ZXN0UmVzdGFydGluZykge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChUZXN0SW5wdXQuc3BhY2luZ0RlYnVnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwic3BhY2luZyBkZWJ1Z1wiLCBcImtleXByZXNzXCIsIGV2ZW50LmtleSwgXCJsZW5ndGhcIiwgVGVzdElucHV0LmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmFycmF5Lmxlbmd0aCk7XG4gICAgfVxuICAgIFRlc3RJbnB1dC5yZWNvcmRLZXlwcmVzc1NwYWNpbmcoKTtcbiAgICBUZXN0SW5wdXQuc2V0S2V5cHJlc3NEdXJhdGlvbihwZXJmb3JtYW5jZS5ub3coKSk7XG4gICAgVGVzdElucHV0LnNldEtleXByZXNzTm90QWZrKCk7XG4gICAgLy9ibG9ja2luZyBmaXJlZm94IGZyb20gZ29pbmcgYmFjayBpbiBoaXN0b3J5IHdpdGggYmFja3NwYWNlXG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJCYWNrc3BhY2VcIikge1xuICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICAgICAgY29uc3QgdCA9IC9JTlBVVHxTRUxFQ1R8VEVYVEFSRUEvaTtcbiAgICAgICAgaWYgKCF0LnRlc3QoZXZlbnQudGFyZ2V0LnRhZ05hbWUpXG4gICAgICAgIC8vIGlmIHRoaXMgYnJlYWtzIGluIHRoZSBmdXR1cmUsIGNhbGwgbWlvIGFuZCB0ZWxsIGhpbSB0byBzdG9wIGJlaW5nIGxhenlcbiAgICAgICAgLy8gKGV2ZW50LnRhcmdldCBhcyB1bmtub3duIGFzIEtleWJvYXJkRXZlbnQpLmRpc2FibGVkIHx8XG4gICAgICAgIC8vIChldmVudC50YXJnZXQgYXMgdW5rbm93biBhcyBFbGVtZW50KS5yZWFkT25seVxuICAgICAgICApIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuY29uZmlkZW5jZU1vZGUgPT09IFwibWF4XCIpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ICE9PSBcImFycm93c1wiICYmIC9BcnJvdy9pLnRlc3QoZXZlbnQua2V5KSkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIE1vbmtleS50eXBlKCk7XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJCYWNrc3BhY2VcIiAmJiBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgYmFja3NwYWNlVG9QcmV2aW91cygpO1xuICAgICAgICBpZiAoVGVzdElucHV0LmlucHV0LmN1cnJlbnQpIHtcbiAgICAgICAgICAgIHNldFdvcmRzSW5wdXQoXCIgXCIgKyBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCArIFwiIFwiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgaWYgKGV2ZW50LnNoaWZ0S2V5ICYmIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiKSB7XG4gICAgICAgICAgICBUZXN0TG9naWMuZmluaXNoKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZXZlbnQuc2hpZnRLZXkgJiZcbiAgICAgICAgICAgICgoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwidGltZVwiICYmIGNvbmZpZ18xLmRlZmF1bHQudGltZSA9PT0gMCkgfHxcbiAgICAgICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwid29yZHNcIiAmJiBjb25maWdfMS5kZWZhdWx0LndvcmRzID09PSAwKSkpIHtcbiAgICAgICAgICAgIFRlc3RJbnB1dC5zZXRCYWlsb3V0KHRydWUpO1xuICAgICAgICAgICAgVGVzdExvZ2ljLmZpbmlzaCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaGFuZGxlQ2hhcihcIlxcblwiLCBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGgpO1xuICAgICAgICAgICAgc2V0V29yZHNJbnB1dChcIiBcIiArIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvL3Nob3cgZGVhZCBrZXlzXG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJEZWFkXCIgJiZcbiAgICAgICAgIU1pc2MudHJhaWxpbmdDb21wb3NlQ2hhcnMudGVzdChUZXN0SW5wdXQuaW5wdXQuY3VycmVudCkpIHtcbiAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgICAgIGNvbnN0IHdvcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3dvcmRzIC53b3JkLmFjdGl2ZVwiKTtcbiAgICAgICAgY29uc3QgbGVuID0gVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoOyAvLyBoYXZlIHRvIGRvIHRoaXMgYmVjYXVzZSBwcmV0dGllciB3cmFwcyB0aGUgbGluZSBhbmQgY2F1c2VzIGFuIGVycm9yXG4gICAgICAgIHdvcmQgPT09IG51bGwgfHwgd29yZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogd29yZC5xdWVyeVNlbGVjdG9yQWxsKFwibGV0dGVyXCIpW2xlbl0uY2xhc3NMaXN0LnRvZ2dsZShcImRlYWRcIik7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm9wcG9zaXRlU2hpZnRNb2RlICE9PSBcIm9mZlwiKSB7XG4gICAgICAgIGNvcnJlY3RTaGlmdFVzZWQgPVxuICAgICAgICAgICAgKHlpZWxkIFNoaWZ0VHJhY2tlci5pc1VzaW5nT3Bwb3NpdGVTaGlmdChldmVudCkpICE9PSBmYWxzZTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcImFycm93c1wiKSB7XG4gICAgICAgIGxldCBjaGFyID0gZXZlbnQua2V5O1xuICAgICAgICBpZiAoW1wiQXJyb3dMZWZ0XCIsIFwiQXJyb3dVcFwiLCBcIkFycm93UmlnaHRcIiwgXCJBcnJvd0Rvd25cIl0uaW5jbHVkZXMoY2hhcikpIHtcbiAgICAgICAgICAgIGlmIChjaGFyID09PSBcIkFycm93TGVmdFwiKVxuICAgICAgICAgICAgICAgIGNoYXIgPSBcImFcIjtcbiAgICAgICAgICAgIGlmIChjaGFyID09PSBcIkFycm93UmlnaHRcIilcbiAgICAgICAgICAgICAgICBjaGFyID0gXCJkXCI7XG4gICAgICAgICAgICBpZiAoY2hhciA9PT0gXCJBcnJvd0Rvd25cIilcbiAgICAgICAgICAgICAgICBjaGFyID0gXCJzXCI7XG4gICAgICAgICAgICBpZiAoY2hhciA9PT0gXCJBcnJvd1VwXCIpXG4gICAgICAgICAgICAgICAgY2hhciA9IFwid1wiO1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGhhbmRsZUNoYXIoY2hhciwgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoKTtcbiAgICAgICAgICAgIHVwZGF0ZVVJKCk7XG4gICAgICAgICAgICBzZXRXb3Jkc0lucHV0KFwiIFwiICsgVGVzdElucHV0LmlucHV0LmN1cnJlbnQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQubGF5b3V0ICE9PSBcImRlZmF1bHRcIiAmJlxuICAgICAgICAhKGV2ZW50LmN0cmxLZXkgfHxcbiAgICAgICAgICAgIChldmVudC5hbHRLZXkgJiYgd2luZG93Lm5hdmlnYXRvci5wbGF0Zm9ybS5zZWFyY2goXCJMaW51eFwiKSA+IC0xKSkpIHtcbiAgICAgICAgY29uc3QgY2hhciA9IHlpZWxkIExheW91dEVtdWxhdG9yLmdldENoYXJGcm9tRXZlbnQoZXZlbnQpO1xuICAgICAgICBpZiAoY2hhciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGhhbmRsZUNoYXIoY2hhciwgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoKTtcbiAgICAgICAgICAgIHVwZGF0ZVVJKCk7XG4gICAgICAgICAgICBzZXRXb3Jkc0lucHV0KFwiIFwiICsgVGVzdElucHV0LmlucHV0LmN1cnJlbnQpO1xuICAgICAgICB9XG4gICAgfVxufSkpO1xuJChcIiN3b3Jkc0lucHV0XCIpLmtleXVwKChldmVudCkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBpZiAoISgoX2EgPSBldmVudC5vcmlnaW5hbEV2ZW50KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaXNUcnVzdGVkKSB8fCBUZXN0VUkudGVzdFJlc3RhcnRpbmcpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoVGVzdFVJLnJlc3VsdFZpc2libGUpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBub3cgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICBpZiAoVGVzdElucHV0LmtleXByZXNzVGltaW5ncy5kdXJhdGlvbi5jdXJyZW50ICE9PSAtMSkge1xuICAgICAgICBjb25zdCBkaWZmID0gTWF0aC5hYnMoVGVzdElucHV0LmtleXByZXNzVGltaW5ncy5kdXJhdGlvbi5jdXJyZW50IC0gbm93KTtcbiAgICAgICAgVGVzdElucHV0LnB1c2hLZXlwcmVzc0R1cmF0aW9uKGRpZmYpO1xuICAgIH1cbiAgICBUZXN0SW5wdXQuc2V0S2V5cHJlc3NEdXJhdGlvbihub3cpO1xuICAgIE1vbmtleS5zdG9wKCk7XG59KTtcbiQoXCIjd29yZHNJbnB1dFwiKS5vbihcImJlZm9yZWlucHV0XCIsIChldmVudCkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBpZiAoISgoX2EgPSBldmVudC5vcmlnaW5hbEV2ZW50KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaXNUcnVzdGVkKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChldmVudC50YXJnZXQudmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gXCIgXCI7XG4gICAgfVxufSk7XG4kKFwiI3dvcmRzSW5wdXRcIikub24oXCJpbnB1dFwiLCAoZXZlbnQpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKCEoKF9hID0gZXZlbnQub3JpZ2luYWxFdmVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlzVHJ1c3RlZCkgfHwgVGVzdFVJLnRlc3RSZXN0YXJ0aW5nKSB7XG4gICAgICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9IFwiIFwiO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIFRlc3RJbnB1dC5zZXRLZXlwcmVzc05vdEFmaygpO1xuICAgIGNvbnN0IHJlYWxJbnB1dFZhbHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlLm5vcm1hbGl6ZSgpO1xuICAgIGNvbnN0IGlucHV0VmFsdWUgPSByZWFsSW5wdXRWYWx1ZS5zbGljZSgxKTtcbiAgICAvLyBpbnB1dCB3aWxsIGJlIG1vZGlmaWVkIGV2ZW4gd2l0aCB0aGUgcHJldmVudERlZmF1bHQoKSBpblxuICAgIC8vIGJlZm9yZWlucHV0L2tleWRvd24gaWYgaXQncyBwYXJ0IG9mIGEgY29tcG9zZSBzZXF1ZW5jZS4gdGhpcyB1bmRvZXNcbiAgICAvLyB0aGUgZWZmZWN0cyBvZiB0aGF0IGFuZCB0YWtlcyB0aGUgaW5wdXQgb3V0IG9mIGNvbXBvc2UgbW9kZS5cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5sYXlvdXQgIT09IFwiZGVmYXVsdFwiICYmXG4gICAgICAgIGlucHV0VmFsdWUubGVuZ3RoID49IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCkge1xuICAgICAgICBzZXRXb3Jkc0lucHV0KFwiIFwiICsgVGVzdElucHV0LmlucHV0LmN1cnJlbnQpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChyZWFsSW5wdXRWYWx1ZS5sZW5ndGggPT09IDAgJiYgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIC8vIGZhbGxiYWNrIGZvciB3aGVuIG5vIEJhY2tzcGFjZSBrZXlkb3duIGV2ZW50IChtb2JpbGUpXG4gICAgICAgIGJhY2tzcGFjZVRvUHJldmlvdXMoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoaW5wdXRWYWx1ZS5sZW5ndGggPCBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGgpIHtcbiAgICAgICAgVGVzdElucHV0LmlucHV0LmN1cnJlbnQgPSBpbnB1dFZhbHVlO1xuICAgICAgICBUZXN0VUkudXBkYXRlV29yZEVsZW1lbnQoKTtcbiAgICAgICAgQ2FyZXQudXBkYXRlUG9zaXRpb24oKTtcbiAgICAgICAgaWYgKCFNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzLnRlc3QoVGVzdElucHV0LmlucHV0LmN1cnJlbnQpKSB7XG4gICAgICAgICAgICBSZXBsYXkuYWRkUmVwbGF5RXZlbnQoXCJzZXRMZXR0ZXJJbmRleFwiLCBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKGlucHV0VmFsdWUgIT09IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50KSB7XG4gICAgICAgIGxldCBkaWZmU3RhcnQgPSAwO1xuICAgICAgICB3aGlsZSAoaW5wdXRWYWx1ZVtkaWZmU3RhcnRdID09PSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudFtkaWZmU3RhcnRdKSB7XG4gICAgICAgICAgICBkaWZmU3RhcnQrKztcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gZGlmZlN0YXJ0OyBpIDwgaW5wdXRWYWx1ZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaGFuZGxlQ2hhcihpbnB1dFZhbHVlW2ldLCBpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXRXb3Jkc0lucHV0KFwiIFwiICsgVGVzdElucHV0LmlucHV0LmN1cnJlbnQpO1xuICAgIHVwZGF0ZVVJKCk7XG4gICAgLy8gZm9yY2UgY2FyZXQgYXQgZW5kIG9mIGlucHV0XG4gICAgLy8gZG9pbmcgaXQgb24gbmV4dCBjeWNsZSBiZWNhdXNlIENocm9taXVtIG9uIEFuZHJvaWQgd29uJ3QgbGV0IG1lIGVkaXRcbiAgICAvLyB0aGUgc2VsZWN0aW9uIGluc2lkZSB0aGUgaW5wdXQgZXZlbnRcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LnNlbGVjdGlvblN0YXJ0ICE9PVxuICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlLmxlbmd0aCAmJlxuICAgICAgICAgICAgKCFNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzLnRlc3QoZXZlbnQudGFyZ2V0LnZhbHVlKSB8fFxuICAgICAgICAgICAgICAgICgoX2EgPSBldmVudC50YXJnZXQuc2VsZWN0aW9uU3RhcnQpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDApIDxcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlLnNlYXJjaChNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzKSkpIHtcbiAgICAgICAgICAgIGV2ZW50LnRhcmdldC5zZWxlY3Rpb25TdGFydCA9IGV2ZW50LnRhcmdldC5zZWxlY3Rpb25FbmQgPSBldmVudC50YXJnZXQudmFsdWUubGVuZ3RoO1xuICAgICAgICB9XG4gICAgfSwgMCk7XG59KTtcbiQoXCIjd29yZHNJbnB1dFwiKS5vbihcImZvY3VzXCIsIChldmVudCkgPT4ge1xuICAgIGV2ZW50LnRhcmdldC5zZWxlY3Rpb25TdGFydCA9IGV2ZW50LnRhcmdldC5zZWxlY3Rpb25FbmQgPSBldmVudC50YXJnZXQudmFsdWUubGVuZ3RoO1xufSk7XG4kKFwiI3dvcmRzSW5wdXRcIikub24oXCJjb3B5IHBhc3RlXCIsIChldmVudCkgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuY2hhbmdlID0gdm9pZCAwO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBBY3RpdmVQYWdlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvYWN0aXZlLXBhZ2VcIikpO1xuY29uc3QgU2V0dGluZ3MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BhZ2VzL3NldHRpbmdzXCIpKTtcbmNvbnN0IEFjY291bnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BhZ2VzL2FjY291bnRcIikpO1xuY29uc3QgTWFudWFsUmVzdGFydCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9tYW51YWwtcmVzdGFydC10cmFja2VyXCIpKTtcbmNvbnN0IFBhZ2VUZXN0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wYWdlcy90ZXN0XCIpKTtcbmNvbnN0IFBhZ2VBYm91dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcGFnZXMvYWJvdXRcIikpO1xuY29uc3QgUGFnZUNoYW5nZUV2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9wYWdlLWNoYW5nZS1ldmVudFwiKSk7XG5jb25zdCBQYWdlTG9naW4gPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BhZ2VzL2xvZ2luXCIpKTtcbmNvbnN0IFBhZ2VMb2FkaW5nID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wYWdlcy9sb2FkaW5nXCIpKTtcbmNvbnN0IFBhZ2VUcmFuc2l0aW9uID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvcGFnZS10cmFuc2l0aW9uXCIpKTtcbmZ1bmN0aW9uIGNoYW5nZShwYWdlKSB7XG4gICAgaWYgKFBhZ2VUcmFuc2l0aW9uLmdldCgpKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBjaGFuZ2UgcGFnZSAke3BhZ2V9IHN0b3BwZWRgKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhgY2hhbmdlIHBhZ2UgJHtwYWdlfWApO1xuICAgIGlmIChwYWdlID09PSBcIlwiKVxuICAgICAgICBwYWdlID0gXCJ0ZXN0XCI7XG4gICAgaWYgKHBhZ2UgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIC8vdXNlIHdpbmRvdyBsb2FjYXRpb25cbiAgICAgICAgY29uc3QgcGFnZXMgPSB7XG4gICAgICAgICAgICBcIi9cIjogXCJ0ZXN0XCIsXG4gICAgICAgICAgICBcIi9sb2dpblwiOiBcImxvZ2luXCIsXG4gICAgICAgICAgICBcIi9zZXR0aW5nc1wiOiBcInNldHRpbmdzXCIsXG4gICAgICAgICAgICBcIi9hYm91dFwiOiBcImFib3V0XCIsXG4gICAgICAgICAgICBcIi9hY2NvdW50XCI6IFwiYWNjb3VudFwiLFxuICAgICAgICB9O1xuICAgICAgICBsZXQgcGF0aCA9IHBhZ2VzW3dpbmRvdy5sb2NhdGlvbi5wYXRobmFtZV07XG4gICAgICAgIGlmICghcGF0aCkge1xuICAgICAgICAgICAgcGF0aCA9IFwidGVzdFwiO1xuICAgICAgICB9XG4gICAgICAgIHBhZ2UgPSBwYXRoO1xuICAgIH1cbiAgICBpZiAoQWN0aXZlUGFnZS5nZXQoKSA9PT0gcGFnZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhgcGFnZSAke3BhZ2V9IGFscmVhZHkgYWN0aXZlYCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgcGFnZXMgPSB7XG4gICAgICAgIGxvYWRpbmc6IFBhZ2VMb2FkaW5nLnBhZ2UsXG4gICAgICAgIHRlc3Q6IFBhZ2VUZXN0LnBhZ2UsXG4gICAgICAgIHNldHRpbmdzOiBTZXR0aW5ncy5wYWdlLFxuICAgICAgICBhYm91dDogUGFnZUFib3V0LnBhZ2UsXG4gICAgICAgIGFjY291bnQ6IEFjY291bnQucGFnZSxcbiAgICAgICAgbG9naW46IFBhZ2VMb2dpbi5wYWdlLFxuICAgIH07XG4gICAgY29uc3QgcHJldmlvdXNQYWdlID0gcGFnZXNbQWN0aXZlUGFnZS5nZXQoKV07XG4gICAgY29uc3QgbmV4dFBhZ2UgPSBwYWdlc1twYWdlXTtcbiAgICBwcmV2aW91c1BhZ2UgPT09IG51bGwgfHwgcHJldmlvdXNQYWdlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwcmV2aW91c1BhZ2UuYmVmb3JlSGlkZSgpO1xuICAgIFBhZ2VUcmFuc2l0aW9uLnNldCh0cnVlKTtcbiAgICBBY3RpdmVQYWdlLnNldCh1bmRlZmluZWQpO1xuICAgICQoXCIucGFnZVwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICBNaXNjLnN3YXBFbGVtZW50cyhwcmV2aW91c1BhZ2UuZWxlbWVudCwgbmV4dFBhZ2UuZWxlbWVudCwgMjUwLCAoKSA9PiB7XG4gICAgICAgIFBhZ2VUcmFuc2l0aW9uLnNldChmYWxzZSk7XG4gICAgICAgIEFjdGl2ZVBhZ2Uuc2V0KG5leHRQYWdlLm5hbWUpO1xuICAgICAgICBwcmV2aW91c1BhZ2UgPT09IG51bGwgfHwgcHJldmlvdXNQYWdlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwcmV2aW91c1BhZ2UuYWZ0ZXJIaWRlKCk7XG4gICAgICAgIG5leHRQYWdlLmVsZW1lbnQuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgIGhpc3RvcnkucHVzaFN0YXRlKG5leHRQYWdlLnBhdGhuYW1lLCBcIlwiLCBuZXh0UGFnZS5wYXRobmFtZSk7XG4gICAgICAgIG5leHRQYWdlID09PSBudWxsIHx8IG5leHRQYWdlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuZXh0UGFnZS5hZnRlclNob3coKTtcbiAgICB9LCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHlpZWxkIChuZXh0UGFnZSA9PT0gbnVsbCB8fCBuZXh0UGFnZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmV4dFBhZ2UuYmVmb3JlU2hvdygpKTtcbiAgICB9KSk7XG4gICAgUGFnZUNoYW5nZUV2ZW50LmRpc3BhdGNoKHByZXZpb3VzUGFnZSwgbmV4dFBhZ2UpO1xufVxuZXhwb3J0cy5jaGFuZ2UgPSBjaGFuZ2U7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3RvcCAubG9nb1wiLCAoKSA9PiB7XG4gICAgY2hhbmdlKFwidGVzdFwiKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0b3AgI21lbnUgLmljb24tYnV0dG9uXCIsIChlKSA9PiB7XG4gICAgaWYgKCEkKGUuY3VycmVudFRhcmdldCkuaGFzQ2xhc3MoXCJsZWFkZXJib2FyZHNcIikpIHtcbiAgICAgICAgY29uc3QgaHJlZiA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiaHJlZlwiKTtcbiAgICAgICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICAgICAgY2hhbmdlKGhyZWYucmVwbGFjZShcIi9cIiwgXCJcIikpO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59KTtcbiQoXCIucGFnZVRlc3QgLmxvZ2luVGlwIC5saW5rXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgY2hhbmdlKFwibG9naW5cIik7XG59KSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5hcHBseSA9IHZvaWQgMDtcbmNvbnN0IFVwZGF0ZUNvbmZpZyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IFRlc3RMb2dpYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LWxvZ2ljXCIpKTtcbmNvbnN0IFRhZ0NvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGFnLWNvbnRyb2xsZXJcIikpO1xuZnVuY3Rpb24gYXBwbHkoX2lkKSB7XG4gICAgdmFyIF9hO1xuICAgIC8vIGNvbnNvbGUubG9nKERCLmdldFNuYXBzaG90KCkucHJlc2V0cyk7XG4gICAgY29uc3Qgc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdCgpO1xuICAgIChfYSA9IHNuYXBzaG90LnByZXNldHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKChwcmVzZXQpID0+IHtcbiAgICAgICAgaWYgKHByZXNldC5faWQgPT0gX2lkKSB7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuYXBwbHkocHJlc2V0LmNvbmZpZyk7XG4gICAgICAgICAgICBUYWdDb250cm9sbGVyLmNsZWFyKHRydWUpO1xuICAgICAgICAgICAgaWYgKHByZXNldC5jb25maWcudGFncykge1xuICAgICAgICAgICAgICAgIHByZXNldC5jb25maWcudGFncy5mb3JFYWNoKCh0YWdpZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBUYWdDb250cm9sbGVyLnNldCh0YWdpZCwgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUHJlc2V0IGFwcGxpZWRcIiwgMSwgMik7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2F2ZUZ1bGxDb25maWdUb0xvY2FsU3RvcmFnZSgpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmFwcGx5ID0gYXBwbHk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgbWlzY18xID0gcmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIik7XG5jb25zdCBjb25maWdfZXZlbnRfMSA9IHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIik7XG5jb25zdCBkZWZhdWx0UXVvdGVDb2xsZWN0aW9uID0ge1xuICAgIHF1b3RlczogW10sXG4gICAgbGVuZ3RoOiAwLFxuICAgIGxhbmd1YWdlOiBudWxsLFxuICAgIGdyb3VwczogW10sXG59O1xuY2xhc3MgUXVvdGVzQ29udHJvbGxlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMucXVvdGVDb2xsZWN0aW9uID0gZGVmYXVsdFF1b3RlQ29sbGVjdGlvbjtcbiAgICAgICAgdGhpcy5xdW90ZVF1ZXVlID0gW107XG4gICAgICAgIHRoaXMucXVldWVJbmRleCA9IDA7XG4gICAgfVxuICAgIGdldFF1b3RlcyhsYW5ndWFnZSwgcXVvdGVMZW5ndGhzKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBub3JtYWxpemVkTGFuZ3VhZ2UgPSBsYW5ndWFnZS5yZXBsYWNlKC9fXFxkKmskL2csIFwiXCIpO1xuICAgICAgICAgICAgaWYgKHRoaXMucXVvdGVDb2xsZWN0aW9uLmxhbmd1YWdlICE9PSBub3JtYWxpemVkTGFuZ3VhZ2UpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0geWllbGQgJC5nZXRKU09OKGBxdW90ZXMvJHtub3JtYWxpemVkTGFuZ3VhZ2V9Lmpzb25gKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEucXVvdGVzID09PSB1bmRlZmluZWQgfHwgZGF0YS5xdW90ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFF1b3RlQ29sbGVjdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnF1b3RlQ29sbGVjdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1b3RlczogW10sXG4gICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGg6IGRhdGEucXVvdGVzLmxlbmd0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwczogW10sXG4gICAgICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogZGF0YS5sYW5ndWFnZSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgLy8gVHJhbnNmb3JtIEpTT04gUXVvdGUgc2NoZW1hIHRvIE1vbmtleVR5cGVzIFF1b3RlIHNjaGVtYVxuICAgICAgICAgICAgICAgICAgICBkYXRhLnF1b3Rlcy5mb3JFYWNoKChxdW90ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbW9ua2V5VHlwZVF1b3RlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHF1b3RlLnRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiBxdW90ZS5zb3VyY2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoOiBxdW90ZS5sZW5ndGgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHF1b3RlLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlOiBkYXRhLmxhbmd1YWdlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucXVvdGVDb2xsZWN0aW9uLnF1b3Rlcy5wdXNoKG1vbmtleVR5cGVRdW90ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBkYXRhLmdyb3Vwcy5mb3JFYWNoKChxdW90ZUdyb3VwLCBncm91cEluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsb3dlciA9IHF1b3RlR3JvdXBbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1cHBlciA9IHF1b3RlR3JvdXBbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnF1b3RlQ29sbGVjdGlvbi5ncm91cHNbZ3JvdXBJbmRleF0gPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucXVvdGVDb2xsZWN0aW9uLnF1b3Rlcy5maWx0ZXIoKHF1b3RlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChxdW90ZS5sZW5ndGggPj0gbG93ZXIgJiYgcXVvdGUubGVuZ3RoIDw9IHVwcGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdW90ZS5ncm91cCA9IGdyb3VwSW5kZXg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAocXVvdGVMZW5ndGhzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUXVvdGVRdWV1ZShxdW90ZUxlbmd0aHMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChfYSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFF1b3RlQ29sbGVjdGlvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5xdW90ZUNvbGxlY3Rpb247XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXRRdW90ZUJ5SWQoaWQpIHtcbiAgICAgICAgY29uc3QgdGFyZ2V0UXVvdGUgPSB0aGlzLnF1b3RlQ29sbGVjdGlvbi5xdW90ZXMuZmluZCgocXVvdGUpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBxdW90ZS5pZCA9PT0gaWQ7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGFyZ2V0UXVvdGU7XG4gICAgfVxuICAgIHVwZGF0ZVF1b3RlUXVldWUocXVvdGVHcm91cHMpIHtcbiAgICAgICAgdGhpcy5xdW90ZVF1ZXVlID0gW107XG4gICAgICAgIHF1b3RlR3JvdXBzLmZvckVhY2goKGdyb3VwKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICBpZiAoZ3JvdXAgPCAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgKF9hID0gdGhpcy5xdW90ZUNvbGxlY3Rpb24uZ3JvdXBzW2dyb3VwXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHF1b3RlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5xdW90ZVF1ZXVlLnB1c2gocXVvdGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICAoMCwgbWlzY18xLnNodWZmbGUpKHRoaXMucXVvdGVRdWV1ZSk7XG4gICAgICAgIHRoaXMucXVldWVJbmRleCA9IDA7XG4gICAgfVxuICAgIGdldFJhbmRvbVF1b3RlKCkge1xuICAgICAgICBpZiAodGhpcy5xdW90ZVF1ZXVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucXVldWVJbmRleCA+PSB0aGlzLnF1b3RlUXVldWUubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLnF1ZXVlSW5kZXggPSAwO1xuICAgICAgICAgICAgKDAsIG1pc2NfMS5zaHVmZmxlKSh0aGlzLnF1b3RlUXVldWUpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJhbmRvbVF1b3RlID0gdGhpcy5xdW90ZVF1ZXVlW3RoaXMucXVldWVJbmRleF07XG4gICAgICAgIHRoaXMucXVldWVJbmRleCArPSAxO1xuICAgICAgICByZXR1cm4gcmFuZG9tUXVvdGU7XG4gICAgfVxuICAgIGdldEN1cnJlbnRRdW90ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMucXVvdGVRdWV1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnF1b3RlUXVldWVbdGhpcy5xdWV1ZUluZGV4XTtcbiAgICB9XG59XG5jb25zdCBxdW90ZUNvbnRyb2xsZXIgPSBuZXcgUXVvdGVzQ29udHJvbGxlcigpO1xuKDAsIGNvbmZpZ19ldmVudF8xLnN1YnNjcmliZSkoKGtleSwgbmV3VmFsdWUpID0+IHtcbiAgICBpZiAoa2V5ID09PSBcInF1b3RlTGVuZ3RoXCIpIHtcbiAgICAgICAgcXVvdGVDb250cm9sbGVyLnVwZGF0ZVF1b3RlUXVldWUobmV3VmFsdWUpO1xuICAgIH1cbn0pO1xuZXhwb3J0cy5kZWZhdWx0ID0gcXVvdGVDb250cm9sbGVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGFuZGxlSW5pdGlhbFBhZ2VDbGFzc2VzID0gdm9pZCAwO1xuLy8gaW1wb3J0ICogYXMgRnVuYm94IGZyb20gXCIuLi90ZXN0L2Z1bmJveFwiO1xuY29uc3QgUGFnZUNvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vcGFnZS1jb250cm9sbGVyXCIpKTtcbi8vIGltcG9ydCBDb25maWcgZnJvbSBcIi4uL2NvbmZpZ1wiO1xuY29uc3QgQWN0aXZlUGFnZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL2FjdGl2ZS1wYWdlXCIpKTtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi4vZmlyZWJhc2VcIik7XG5jb25zdCBtYXBwZWRSb3V0ZXMgPSB7XG4gICAgXCIvXCI6IFwicGFnZUxvYWRpbmdcIixcbiAgICBcIi9sb2dpblwiOiBcInBhZ2VMb2FkaW5nXCIsXG4gICAgXCIvc2V0dGluZ3NcIjogXCJwYWdlTG9hZGluZ1wiLFxuICAgIFwiL2Fib3V0XCI6IFwicGFnZUxvYWRpbmdcIixcbiAgICBcIi9hY2NvdW50XCI6IFwicGFnZUFjY291bnRcIixcbiAgICBcIi92ZXJpZnlcIjogXCJwYWdlTG9hZGluZ1wiLFxufTtcbmZ1bmN0aW9uIGhhbmRsZUluaXRpYWxQYWdlQ2xhc3NlcyhwYXRobmFtZSkge1xuICAgIGlmICghbWFwcGVkUm91dGVzW3BhdGhuYW1lXSkge1xuICAgICAgICBwYXRobmFtZSA9IFwiL1wiO1xuICAgIH1cbiAgICBjb25zdCBlbCA9ICQoXCIucGFnZS5cIiArIG1hcHBlZFJvdXRlc1twYXRobmFtZV0pO1xuICAgICQoZWwpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICQoZWwpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgIGxldCBwYWdlTmFtZSA9IFwibG9hZGluZ1wiO1xuICAgIGlmIChwYXRobmFtZSA9PT0gXCIvYWNjb3VudFwiKVxuICAgICAgICBwYWdlTmFtZSA9IFwiYWNjb3VudFwiO1xuICAgIEFjdGl2ZVBhZ2Uuc2V0KHBhZ2VOYW1lKTtcbn1cbmV4cG9ydHMuaGFuZGxlSW5pdGlhbFBhZ2VDbGFzc2VzID0gaGFuZGxlSW5pdGlhbFBhZ2VDbGFzc2VzO1xuLy8gaG9uZXN0bHkgaW0gbm90IHN1cmUgd2hhdCB0aGlzIGRvZXNcbi8vIChmdW5jdGlvbiAoaGlzdG9yeSk6IHZvaWQge1xuLy8gICBjb25zdCBwdXNoU3RhdGUgPSBoaXN0b3J5LnB1c2hTdGF0ZTtcbi8vICAgaGlzdG9yeS5wdXNoU3RhdGUgPSBmdW5jdGlvbiAoc3RhdGUpOiB2b2lkIHtcbi8vICAgICBpZiAoQ29uZmlnLmZ1bmJveCA9PT0gXCJtZW1vcnlcIiAmJiBzdGF0ZSAhPT0gXCIvXCIpIHtcbi8vICAgICAgIEZ1bmJveC5yZXNldE1lbW9yeVRpbWVyKCk7XG4vLyAgICAgfVxuLy8gICAgIC8vIEB0cy1pZ25vcmVcbi8vICAgICByZXR1cm4gcHVzaFN0YXRlLmFwcGx5KGhpc3RvcnksIGFyZ3VtZW50cyk7XG4vLyAgIH07XG4vLyB9KSh3aW5kb3cuaGlzdG9yeSk7XG4kKHdpbmRvdykub24oXCJwb3BzdGF0ZVwiLCAoZSkgPT4ge1xuICAgIGNvbnN0IHN0YXRlID0gZS5vcmlnaW5hbEV2ZW50LnN0YXRlO1xuICAgIGlmIChzdGF0ZSA9PSBcIlwiIHx8IHN0YXRlID09IFwiL1wiKSB7XG4gICAgICAgIC8vIHNob3cgdGVzdFxuICAgICAgICBQYWdlQ29udHJvbGxlci5jaGFuZ2UoXCJ0ZXN0XCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChzdGF0ZSA9PSBcImFib3V0XCIpIHtcbiAgICAgICAgLy8gc2hvdyBhYm91dFxuICAgICAgICBQYWdlQ29udHJvbGxlci5jaGFuZ2UoXCJhYm91dFwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoc3RhdGUgPT0gXCJhY2NvdW50XCIgfHwgc3RhdGUgPT0gXCJsb2dpblwiKSB7XG4gICAgICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIpIHtcbiAgICAgICAgICAgIFBhZ2VDb250cm9sbGVyLmNoYW5nZShcImFjY291bnRcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBQYWdlQ29udHJvbGxlci5jaGFuZ2UoXCJsb2dpblwiKTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2V0Vm9sdW1lID0gZXhwb3J0cy5wbGF5RXJyb3IgPSBleHBvcnRzLnBsYXlDbGljayA9IGV4cG9ydHMucHJldmlld0NsaWNrID0gZXhwb3J0cy5pbml0ID0gZXhwb3J0cy5pbml0RXJyb3JTb3VuZCA9IHZvaWQgMDtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgaG93bGVyXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcImhvd2xlclwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmNvbnN0IG1pc2NfMSA9IHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpO1xubGV0IGVycm9yU291bmQgPSBudWxsO1xubGV0IGNsaWNrU291bmRzID0gbnVsbDtcbmZ1bmN0aW9uIGluaXRFcnJvclNvdW5kKCkge1xuICAgIGlmIChlcnJvclNvdW5kICE9PSBudWxsKVxuICAgICAgICByZXR1cm47XG4gICAgZXJyb3JTb3VuZCA9IG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBbXCIuLi9zb3VuZC9lcnJvci53YXZcIl0gfSk7XG59XG5leHBvcnRzLmluaXRFcnJvclNvdW5kID0gaW5pdEVycm9yU291bmQ7XG5mdW5jdGlvbiBpbml0KCkge1xuICAgIGlmIChjbGlja1NvdW5kcyAhPT0gbnVsbClcbiAgICAgICAgcmV0dXJuO1xuICAgIGNsaWNrU291bmRzID0ge1xuICAgICAgICAxOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMS9jbGljazFfMS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2sxL2NsaWNrMV8xLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMS9jbGljazFfMi53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2sxL2NsaWNrMV8yLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMS9jbGljazFfMy53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2sxL2NsaWNrMV8zLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIDI6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2syL2NsaWNrMl8xLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazIvY2xpY2syXzEud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2syL2NsaWNrMl8yLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazIvY2xpY2syXzIud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2syL2NsaWNrMl8zLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazIvY2xpY2syXzMud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgMzogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazMvY2xpY2szXzEud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMy9jbGljazNfMS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazMvY2xpY2szXzIud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMy9jbGljazNfMi53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazMvY2xpY2szXzMud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMy9jbGljazNfMy53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICA0OiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNC9jbGljazRfMS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s0L2NsaWNrNF8xMS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazQvY2xpY2s0XzIud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNC9jbGljazRfMjIud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s0L2NsaWNrNF8zLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazQvY2xpY2s0XzMzLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNC9jbGljazRfNC53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s0L2NsaWNrNF80NC53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazQvY2xpY2s0XzUud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNC9jbGljazRfNTUud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s0L2NsaWNrNF82LndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazQvY2xpY2s0XzY2LndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIDU6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s1L2NsaWNrNV8xLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazUvY2xpY2s1XzExLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNS9jbGljazVfMi53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s1L2NsaWNrNV8yMi53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazUvY2xpY2s1XzMud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNS9jbGljazVfMzMud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s1L2NsaWNrNV80LndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazUvY2xpY2s1XzQ0LndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNS9jbGljazVfNS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s1L2NsaWNrNV81NS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazUvY2xpY2s1XzYud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNS9jbGljazVfNjYud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgNjogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazYvY2xpY2s2XzEud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNi9jbGljazZfMTEud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s2L2NsaWNrNl8yLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazYvY2xpY2s2XzIyLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNi9jbGljazZfMy53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s2L2NsaWNrNl8zMy53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICA3OiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNy9jbGljazdfMS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s3L2NsaWNrN18xMS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazcvY2xpY2s3XzIud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNy9jbGljazdfMjIud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s3L2NsaWNrN18zLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazcvY2xpY2s3XzMzLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgfTtcbn1cbmV4cG9ydHMuaW5pdCA9IGluaXQ7XG5mdW5jdGlvbiBwcmV2aWV3Q2xpY2sodmFsKSB7XG4gICAgaWYgKGNsaWNrU291bmRzID09PSBudWxsKVxuICAgICAgICBpbml0KCk7XG4gICAgY2xpY2tTb3VuZHNbdmFsXVswXS5zb3VuZHNbMF0uc2VlaygwKTtcbiAgICBjbGlja1NvdW5kc1t2YWxdWzBdLnNvdW5kc1swXS5wbGF5KCk7XG59XG5leHBvcnRzLnByZXZpZXdDbGljayA9IHByZXZpZXdDbGljaztcbmZ1bmN0aW9uIHBsYXlDbGljaygpIHtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5wbGF5U291bmRPbkNsaWNrID09PSBcIm9mZlwiKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKGNsaWNrU291bmRzID09PSBudWxsKVxuICAgICAgICBpbml0KCk7XG4gICAgY29uc3QgcmFuZG9tU291bmQgPSAoMCwgbWlzY18xLnJhbmRvbUVsZW1lbnRGcm9tQXJyYXkpKGNsaWNrU291bmRzW2NvbmZpZ18xLmRlZmF1bHQucGxheVNvdW5kT25DbGlja10pO1xuICAgIHJhbmRvbVNvdW5kLmNvdW50ZXIrKztcbiAgICBpZiAocmFuZG9tU291bmQuY291bnRlciA9PT0gMilcbiAgICAgICAgcmFuZG9tU291bmQuY291bnRlciA9IDA7XG4gICAgcmFuZG9tU291bmQuc291bmRzW3JhbmRvbVNvdW5kLmNvdW50ZXJdLnNlZWsoMCk7XG4gICAgcmFuZG9tU291bmQuc291bmRzW3JhbmRvbVNvdW5kLmNvdW50ZXJdLnBsYXkoKTtcbn1cbmV4cG9ydHMucGxheUNsaWNrID0gcGxheUNsaWNrO1xuZnVuY3Rpb24gcGxheUVycm9yKCkge1xuICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5wbGF5U291bmRPbkVycm9yKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKGVycm9yU291bmQgPT09IG51bGwpXG4gICAgICAgIGluaXRFcnJvclNvdW5kKCk7XG4gICAgZXJyb3JTb3VuZC5zZWVrKDApO1xuICAgIGVycm9yU291bmQucGxheSgpO1xufVxuZXhwb3J0cy5wbGF5RXJyb3IgPSBwbGF5RXJyb3I7XG5mdW5jdGlvbiBzZXRWb2x1bWUodmFsKSB7XG4gICAgLy8gbm90IHN1cmUgd2h5IGl0IGNvbXBsYWlucyBidXQgaXQgd29ya3NcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgaG93bGVyXzEuZGVmYXVsdC5Ib3dsZXIudm9sdW1lKHZhbCk7XG59XG5leHBvcnRzLnNldFZvbHVtZSA9IHNldFZvbHVtZTtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXksIGV2ZW50VmFsdWUpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwicGxheVNvdW5kT25DbGlja1wiICYmIGV2ZW50VmFsdWUgIT09IFwib2ZmXCIpXG4gICAgICAgIGluaXQoKTtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwic291bmRWb2x1bWVcIilcbiAgICAgICAgc2V0Vm9sdW1lKGV2ZW50VmFsdWUpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5sb2FkQWN0aXZlRnJvbUxvY2FsU3RvcmFnZSA9IGV4cG9ydHMudG9nZ2xlID0gZXhwb3J0cy5zZXQgPSBleHBvcnRzLmNsZWFyID0gZXhwb3J0cy5zYXZlQWN0aXZlVG9Mb2NhbFN0b3JhZ2UgPSB2b2lkIDA7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgTW9kZXNOb3RpY2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL21vZGVzLW5vdGljZVwiKSk7XG5mdW5jdGlvbiBzYXZlQWN0aXZlVG9Mb2NhbFN0b3JhZ2UoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHRhZ3MgPSBbXTtcbiAgICB0cnkge1xuICAgICAgICAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgIGlmICh0YWcuYWN0aXZlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdGFncy5wdXNoKHRhZy5faWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiYWN0aXZlVGFnc1wiLCBKU09OLnN0cmluZ2lmeSh0YWdzKSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7IH1cbn1cbmV4cG9ydHMuc2F2ZUFjdGl2ZVRvTG9jYWxTdG9yYWdlID0gc2F2ZUFjdGl2ZVRvTG9jYWxTdG9yYWdlO1xuZnVuY3Rpb24gY2xlYXIobm9zYXZlID0gZmFsc2UpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3Qgc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdCgpO1xuICAgIHNuYXBzaG90LnRhZ3MgPSAoX2EgPSBzbmFwc2hvdC50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWFwKCh0YWcpID0+IHtcbiAgICAgICAgdGFnLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gdGFnO1xuICAgIH0pO1xuICAgIERCLnNldFNuYXBzaG90KHNuYXBzaG90KTtcbiAgICBNb2Rlc05vdGljZS51cGRhdGUoKTtcbiAgICBpZiAoIW5vc2F2ZSlcbiAgICAgICAgc2F2ZUFjdGl2ZVRvTG9jYWxTdG9yYWdlKCk7XG59XG5leHBvcnRzLmNsZWFyID0gY2xlYXI7XG5mdW5jdGlvbiBzZXQodGFnaWQsIHN0YXRlLCBub3NhdmUgPSBmYWxzZSkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBzbmFwc2hvdCA9IERCLmdldFNuYXBzaG90KCk7XG4gICAgc25hcHNob3QudGFncyA9IChfYSA9IHNuYXBzaG90LnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tYXAoKHRhZykgPT4ge1xuICAgICAgICBpZiAodGFnLl9pZCA9PT0gdGFnaWQpIHtcbiAgICAgICAgICAgIHRhZy5hY3RpdmUgPSBzdGF0ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGFnO1xuICAgIH0pO1xuICAgIERCLnNldFNuYXBzaG90KHNuYXBzaG90KTtcbiAgICBNb2Rlc05vdGljZS51cGRhdGUoKTtcbiAgICBpZiAoIW5vc2F2ZSlcbiAgICAgICAgc2F2ZUFjdGl2ZVRvTG9jYWxTdG9yYWdlKCk7XG59XG5leHBvcnRzLnNldCA9IHNldDtcbmZ1bmN0aW9uIHRvZ2dsZSh0YWdpZCwgbm9zYXZlID0gZmFsc2UpIHtcbiAgICB2YXIgX2E7XG4gICAgKF9hID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgIGlmICh0YWcuX2lkID09PSB0YWdpZCkge1xuICAgICAgICAgICAgaWYgKHRhZy5hY3RpdmUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRhZy5hY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGFnLmFjdGl2ZSA9ICF0YWcuYWN0aXZlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG4gICAgTW9kZXNOb3RpY2UudXBkYXRlKCk7XG4gICAgaWYgKCFub3NhdmUpXG4gICAgICAgIHNhdmVBY3RpdmVUb0xvY2FsU3RvcmFnZSgpO1xufVxuZXhwb3J0cy50b2dnbGUgPSB0b2dnbGU7XG5mdW5jdGlvbiBsb2FkQWN0aXZlRnJvbUxvY2FsU3RvcmFnZSgpIHtcbiAgICB2YXIgX2E7XG4gICAgbGV0IG5ld1RhZ3MgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJhY3RpdmVUYWdzXCIpO1xuICAgIGlmIChuZXdUYWdzICE9IHVuZGVmaW5lZCAmJiBuZXdUYWdzICE9PSBcIlwiKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBuZXdUYWdzID0gKF9hID0gSlNPTi5wYXJzZShuZXdUYWdzKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogW107XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIG5ld1RhZ3MgPSBbXTtcbiAgICAgICAgfVxuICAgICAgICBuZXdUYWdzLmZvckVhY2goKG50YWcpID0+IHtcbiAgICAgICAgICAgIHRvZ2dsZShudGFnLCB0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHNhdmVBY3RpdmVUb0xvY2FsU3RvcmFnZSgpO1xuICAgIH1cbn1cbmV4cG9ydHMubG9hZEFjdGl2ZUZyb21Mb2NhbFN0b3JhZ2UgPSBsb2FkQWN0aXZlRnJvbUxvY2FsU3RvcmFnZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfYSwgX2I7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmFwcGx5Q3VzdG9tQmFja2dyb3VuZCA9IGV4cG9ydHMuYXBwbHlDdXN0b21CYWNrZ3JvdW5kU2l6ZSA9IGV4cG9ydHMuY2xlYXJSYW5kb20gPSBleHBvcnRzLnJhbmRvbWl6ZVRoZW1lID0gZXhwb3J0cy5jbGVhclByZXZpZXcgPSBleHBvcnRzLnNldCA9IGV4cG9ydHMucHJldmlldyA9IGV4cG9ydHMuY29sb3JWYXJzID0gZXhwb3J0cy5yYW5kb21UaGVtZSA9IHZvaWQgMDtcbmNvbnN0IFRoZW1lQ29sb3JzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy90aGVtZS1jb2xvcnNcIikpO1xuY29uc3QgQ2hhcnRDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2NoYXJ0LWNvbnRyb2xsZXJcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBCYWNrZ3JvdW5kRmlsdGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9jdXN0b20tYmFja2dyb3VuZC1maWx0ZXJcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBBbmFseXRpY3NDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9hbmFseXRpY3MtY29udHJvbGxlclwiKSk7XG5sZXQgaXNQcmV2aWV3aW5nVGhlbWUgPSBmYWxzZTtcbmV4cG9ydHMucmFuZG9tVGhlbWUgPSBudWxsO1xuZXhwb3J0cy5jb2xvclZhcnMgPSBbXG4gICAgXCItLWJnLWNvbG9yXCIsXG4gICAgXCItLW1haW4tY29sb3JcIixcbiAgICBcIi0tY2FyZXQtY29sb3JcIixcbiAgICBcIi0tc3ViLWNvbG9yXCIsXG4gICAgXCItLXRleHQtY29sb3JcIixcbiAgICBcIi0tZXJyb3ItY29sb3JcIixcbiAgICBcIi0tZXJyb3ItZXh0cmEtY29sb3JcIixcbiAgICBcIi0tY29sb3JmdWwtZXJyb3ItY29sb3JcIixcbiAgICBcIi0tY29sb3JmdWwtZXJyb3ItZXh0cmEtY29sb3JcIixcbl07XG5mdW5jdGlvbiB1cGRhdGVGYXZpY29uKHNpemUsIGN1cnZlU2l6ZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgbGV0IG1haW5jb2xvciwgYmdjb2xvcjtcbiAgICAgICAgICAgIGJnY29sb3IgPSB5aWVsZCBUaGVtZUNvbG9ycy5nZXQoXCJiZ1wiKTtcbiAgICAgICAgICAgIG1haW5jb2xvciA9IHlpZWxkIFRoZW1lQ29sb3JzLmdldChcIm1haW5cIik7XG4gICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLmhvc3RuYW1lID09PSBcImxvY2FsaG9zdFwiKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3dhcCA9IG1haW5jb2xvcjtcbiAgICAgICAgICAgICAgICBtYWluY29sb3IgPSBiZ2NvbG9yO1xuICAgICAgICAgICAgICAgIGJnY29sb3IgPSBzd2FwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGJnY29sb3IgPT0gbWFpbmNvbG9yKSB7XG4gICAgICAgICAgICAgICAgYmdjb2xvciA9IFwiIzExMVwiO1xuICAgICAgICAgICAgICAgIG1haW5jb2xvciA9IFwiI2VlZVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IHNpemU7XG4gICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gc2l6ZTtcbiAgICAgICAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICBjdHgubW92ZVRvKDAsIGN1cnZlU2l6ZSk7XG4gICAgICAgICAgICAvL3RvcCBsZWZ0XG4gICAgICAgICAgICBjdHgucXVhZHJhdGljQ3VydmVUbygwLCAwLCBjdXJ2ZVNpemUsIDApO1xuICAgICAgICAgICAgY3R4LmxpbmVUbyhzaXplIC0gY3VydmVTaXplLCAwKTtcbiAgICAgICAgICAgIC8vdG9wIHJpZ2h0XG4gICAgICAgICAgICBjdHgucXVhZHJhdGljQ3VydmVUbyhzaXplLCAwLCBzaXplLCBjdXJ2ZVNpemUpO1xuICAgICAgICAgICAgY3R4LmxpbmVUbyhzaXplLCBzaXplIC0gY3VydmVTaXplKTtcbiAgICAgICAgICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKHNpemUsIHNpemUsIHNpemUgLSBjdXJ2ZVNpemUsIHNpemUpO1xuICAgICAgICAgICAgY3R4LmxpbmVUbyhjdXJ2ZVNpemUsIHNpemUpO1xuICAgICAgICAgICAgY3R4LnF1YWRyYXRpY0N1cnZlVG8oMCwgc2l6ZSwgMCwgc2l6ZSAtIGN1cnZlU2l6ZSk7XG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYmdjb2xvcjtcbiAgICAgICAgICAgIGN0eC5maWxsKCk7XG4gICAgICAgICAgICBjdHguZm9udCA9IFwiOTAwIFwiICsgKHNpemUgLyAyKSAqIDEuMiArIFwicHggTGV4ZW5kIERlY2FcIjtcbiAgICAgICAgICAgIGN0eC50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xuICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IG1haW5jb2xvcjtcbiAgICAgICAgICAgIGN0eC5maWxsVGV4dChcIm10XCIsIHNpemUgLyAyICsgMSwgKHNpemUgLyAzKSAqIDIuMSk7XG4gICAgICAgICAgICAvLyAkKFwiYm9keVwiKS5wcmVwZW5kKGNhbnZhcyk7XG4gICAgICAgICAgICAkKFwiI2Zhdmljb25cIikuYXR0cihcImhyZWZcIiwgY2FudmFzLnRvRGF0YVVSTChcImltYWdlL3BuZ1wiKSk7XG4gICAgICAgIH0pLCAxMjUpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gY2xlYXJDdXN0b21UaGVtZSgpIHtcbiAgICBleHBvcnRzLmNvbG9yVmFycy5mb3JFYWNoKChlKSA9PiB7XG4gICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eShlLCBcIlwiKTtcbiAgICB9KTtcbn1cbmNvbnN0IGxvYWRTdHlsZSA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpbmtcIik7XG4gICAgICAgICAgICBsaW5rLnR5cGUgPSBcInRleHQvY3NzXCI7XG4gICAgICAgICAgICBsaW5rLnJlbCA9IFwic3R5bGVzaGVldFwiO1xuICAgICAgICAgICAgbGluay5pZCA9IFwiY3VycmVudFRoZW1lXCI7XG4gICAgICAgICAgICBsaW5rLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKG5hbWUgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgICAgICAgICBsaW5rLmhyZWYgPSBgdGhlbWVzL3NlcmlrYV9kYXJrLmNzc2A7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsaW5rLmhyZWYgPSBgdGhlbWVzLyR7bmFtZX0uY3NzYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGhlYWRTY3JpcHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2N1cnJlbnRUaGVtZVwiKTtcbiAgICAgICAgICAgIGhlYWRTY3JpcHQucmVwbGFjZVdpdGgobGluayk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufTtcbi8vIGV4cG9ydCBmdW5jdGlvbiBjaGFuZ2VDdXN0b21UaGVtZSh0aGVtZUlkOiBzdHJpbmcsIG5vc2F2ZSA9IGZhbHNlKTogdm9pZCB7XG4vLyAgIGNvbnN0IGN1c3RvbVRoZW1lcyA9IERCLmdldFNuYXBzaG90KCkuY3VzdG9tVGhlbWVzO1xuLy8gICBjb25zdCBjb2xvcnMgPSBjdXN0b21UaGVtZXMuZmluZCgoZSkgPT4gZS5faWQgPT09IHRoZW1lSWQpXG4vLyAgICAgPy5jb2xvcnMgYXMgc3RyaW5nW107XG4vLyAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZUNvbG9ycyhjb2xvcnMsIG5vc2F2ZSk7XG4vLyB9XG5mdW5jdGlvbiBhcHBseSh0aGVtZU5hbWUsIGlzQ3VzdG9tLCBpc1ByZXZpZXcgPSBmYWxzZSkge1xuICAgIGNsZWFyQ3VzdG9tVGhlbWUoKTtcbiAgICBsZXQgbmFtZSA9IFwic2VyaWthX2RhcmtcIjtcbiAgICBpZiAoIWlzQ3VzdG9tKSB7XG4gICAgICAgIG5hbWUgPSB0aGVtZU5hbWU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBuYW1lID0gXCJjdXN0b21cIjtcbiAgICB9XG4gICAgVGhlbWVDb2xvcnMucmVzZXQoKTtcbiAgICAkKFwiLmtleW1hcC1rZXlcIikuYXR0cihcInN0eWxlXCIsIFwiXCIpO1xuICAgIC8vICQoXCIjY3VycmVudFRoZW1lXCIpLmF0dHIoXCJocmVmXCIsIGB0aGVtZXMvJHtuYW1lfS5jc3NgKTtcbiAgICBsb2FkU3R5bGUobmFtZSkudGhlbigoKSA9PiB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIFRoZW1lQ29sb3JzLnVwZGF0ZSgpO1xuICAgICAgICBpZiAoaXNDdXN0b20pIHtcbiAgICAgICAgICAgIGxldCBjb2xvclZhbHVlcyA9IGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tVGhlbWVDb2xvcnM7XG4gICAgICAgICAgICBjb25zdCBzbmFwc2hvdCA9IERCLmdldFNuYXBzaG90KCk7XG4gICAgICAgICAgICBpZiAoaXNDdXN0b20gJiYgIWlzUHJldmlldyAmJiBzbmFwc2hvdCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1c3RvbUNvbG9ycyA9IChfYiA9IChfYSA9IHNuYXBzaG90LmN1c3RvbVRoZW1lcy5maW5kKChlKSA9PiBlLl9pZCA9PT0gdGhlbWVOYW1lKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNvbG9ycykgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogW107XG4gICAgICAgICAgICAgICAgaWYgKGN1c3RvbUNvbG9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZUNvbG9ycyhjdXN0b21Db2xvcnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGVtZU5hbWUgIT09IFwiY3VzdG9tXCIgJiYgc25hcHNob3QpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXN0b21UaGVtZXMgPSBzbmFwc2hvdC5jdXN0b21UaGVtZXM7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VzdG9tVGhlbWVCeUlkID0gY3VzdG9tVGhlbWVzLmZpbmQoKGUpID0+IGUuX2lkID09PSB0aGVtZU5hbWUpO1xuICAgICAgICAgICAgICAgIGNvbG9yVmFsdWVzID0gY3VzdG9tVGhlbWVCeUlkID09PSBudWxsIHx8IGN1c3RvbVRoZW1lQnlJZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY3VzdG9tVGhlbWVCeUlkLmNvbG9ycztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGV4cG9ydHMuY29sb3JWYXJzLmZvckVhY2goKGUsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KGUsIGNvbG9yVmFsdWVzW2luZGV4XSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBBbmFseXRpY3NDb250cm9sbGVyLmxvZyhcImNoYW5nZWRUaGVtZVwiLCB7IHRoZW1lOiB0aGVtZU5hbWUgfSk7XG4gICAgICAgIGlmICghaXNQcmV2aWV3KSB7XG4gICAgICAgICAgICBUaGVtZUNvbG9ycy5nZXRBbGwoKS50aGVuKChjb2xvcnMpID0+IHtcbiAgICAgICAgICAgICAgICAkKFwiLmtleW1hcC1rZXlcIikuYXR0cihcInN0eWxlXCIsIFwiXCIpO1xuICAgICAgICAgICAgICAgIENoYXJ0Q29udHJvbGxlci51cGRhdGVBbGxDaGFydENvbG9ycygpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZUZhdmljb24oMTI4LCAzMik7XG4gICAgICAgICAgICAgICAgJChcIiNtZXRhVGhlbWVDb2xvclwiKS5hdHRyKFwiY29udGVudFwiLCBjb2xvcnMuYmcpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgJChcIi5jdXJyZW50LXRoZW1lIC50ZXh0XCIpLnRleHQoaXNDdXN0b20gPyBcImN1c3RvbVwiIDogdGhlbWVOYW1lLnJlcGxhY2UoL18vZywgXCIgXCIpKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHByZXZpZXcodGhlbWVJZGVudGlmaWVyLCBpc0N1c3RvbSwgcmFuZG9tVGhlbWUgPSBmYWxzZSkge1xuICAgIGlzUHJldmlld2luZ1RoZW1lID0gdHJ1ZTtcbiAgICBhcHBseSh0aGVtZUlkZW50aWZpZXIsIGlzQ3VzdG9tLCAhcmFuZG9tVGhlbWUpO1xufVxuZXhwb3J0cy5wcmV2aWV3ID0gcHJldmlldztcbmZ1bmN0aW9uIHNldCh0aGVtZUlkZW50aWZpZXIsIGlzQ3VzdG9tKSB7XG4gICAgYXBwbHkodGhlbWVJZGVudGlmaWVyLCBpc0N1c3RvbSk7XG59XG5leHBvcnRzLnNldCA9IHNldDtcbmZ1bmN0aW9uIGNsZWFyUHJldmlldygpIHtcbiAgICBpZiAoaXNQcmV2aWV3aW5nVGhlbWUpIHtcbiAgICAgICAgaXNQcmV2aWV3aW5nVGhlbWUgPSBmYWxzZTtcbiAgICAgICAgZXhwb3J0cy5yYW5kb21UaGVtZSA9IG51bGw7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmN1c3RvbVRoZW1lKSB7XG4gICAgICAgICAgICBhcHBseShcImN1c3RvbVwiLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGFwcGx5KGNvbmZpZ18xLmRlZmF1bHQudGhlbWUsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMuY2xlYXJQcmV2aWV3ID0gY2xlYXJQcmV2aWV3O1xuZnVuY3Rpb24gcmFuZG9taXplVGhlbWUoKSB7XG4gICAgbGV0IHJhbmRvbUxpc3Q7XG4gICAgTWlzYy5nZXRUaGVtZXNMaXN0KCkudGhlbigodGhlbWVzKSA9PiB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnJhbmRvbVRoZW1lID09PSBcImZhdlwiICYmIGNvbmZpZ18xLmRlZmF1bHQuZmF2VGhlbWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJhbmRvbUxpc3QgPSBjb25maWdfMS5kZWZhdWx0LmZhdlRoZW1lcztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LnJhbmRvbVRoZW1lID09PSBcImxpZ2h0XCIpIHtcbiAgICAgICAgICAgIHJhbmRvbUxpc3QgPSB0aGVtZXNcbiAgICAgICAgICAgICAgICAuZmlsdGVyKCh0KSA9PiBNaXNjLmlzQ29sb3JMaWdodCh0LmJnQ29sb3IpKVxuICAgICAgICAgICAgICAgIC5tYXAoKHQpID0+IHQubmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5yYW5kb21UaGVtZSA9PT0gXCJkYXJrXCIpIHtcbiAgICAgICAgICAgIHJhbmRvbUxpc3QgPSB0aGVtZXNcbiAgICAgICAgICAgICAgICAuZmlsdGVyKCh0KSA9PiBNaXNjLmlzQ29sb3JEYXJrKHQuYmdDb2xvcikpXG4gICAgICAgICAgICAgICAgLm1hcCgodCkgPT4gdC5uYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LnJhbmRvbVRoZW1lID09PSBcIm9uXCIpIHtcbiAgICAgICAgICAgIHJhbmRvbUxpc3QgPSB0aGVtZXMubWFwKCh0KSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHQubmFtZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmFuZG9tTGlzdCA9IERCLmdldFNuYXBzaG90KCkuY3VzdG9tVGhlbWVzLm1hcCgoY3QpID0+IGN0Ll9pZCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcHJldmlvdXNUaGVtZSA9IGV4cG9ydHMucmFuZG9tVGhlbWU7XG4gICAgICAgIGV4cG9ydHMucmFuZG9tVGhlbWUgPSBNaXNjLnJhbmRvbUVsZW1lbnRGcm9tQXJyYXkocmFuZG9tTGlzdCk7XG4gICAgICAgIC8vIGlmIChDb25maWcucmFuZG9tVGhlbWUgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgLy8gY2hhbmdlQ3VzdG9tVGhlbWUocmFuZG9tVGhlbWUsIHRydWUpO1xuICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICBwcmV2aWV3KGV4cG9ydHMucmFuZG9tVGhlbWUsIGNvbmZpZ18xLmRlZmF1bHQucmFuZG9tVGhlbWUgPT09IFwiY3VzdG9tXCIpO1xuICAgICAgICAvLyB9XG4gICAgICAgIGlmIChwcmV2aW91c1RoZW1lICE9IGV4cG9ydHMucmFuZG9tVGhlbWUpIHtcbiAgICAgICAgICAgIGxldCBuYW1lID0gZXhwb3J0cy5yYW5kb21UaGVtZS5yZXBsYWNlKC9fL2csIFwiIFwiKTtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnJhbmRvbVRoZW1lID09PSBcImN1c3RvbVwiKSB7XG4gICAgICAgICAgICAgICAgbmFtZSA9ICgoX2IgPSAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpLmN1c3RvbVRoZW1lcy5maW5kKChjdCkgPT4gY3QuX2lkID09PSBleHBvcnRzLnJhbmRvbVRoZW1lKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm5hbWUpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IFwiY3VzdG9tXCIpLnJlcGxhY2UoL18vZywgXCIgXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQobmFtZSwgMCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMucmFuZG9taXplVGhlbWUgPSByYW5kb21pemVUaGVtZTtcbmZ1bmN0aW9uIGNsZWFyUmFuZG9tKCkge1xuICAgIGlmIChleHBvcnRzLnJhbmRvbVRoZW1lID09PSBudWxsKVxuICAgICAgICByZXR1cm47XG4gICAgZXhwb3J0cy5yYW5kb21UaGVtZSA9IG51bGw7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tVGhlbWUpIHtcbiAgICAgICAgYXBwbHkoXCJjdXN0b21cIiwgdHJ1ZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBhcHBseShjb25maWdfMS5kZWZhdWx0LnRoZW1lLCBmYWxzZSk7XG4gICAgfVxufVxuZXhwb3J0cy5jbGVhclJhbmRvbSA9IGNsZWFyUmFuZG9tO1xuZnVuY3Rpb24gYXBwbHlDdXN0b21CYWNrZ3JvdW5kU2l6ZSgpIHtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5jdXN0b21CYWNrZ3JvdW5kU2l6ZSA9PSBcIm1heFwiKSB7XG4gICAgICAgICQoXCIuY3VzdG9tQmFja2dyb3VuZCBpbWdcIikuY3NzKHtcbiAgICAgICAgICAgIC8vIHdpZHRoOiBcImNhbGMoMTAwJSlcIixcbiAgICAgICAgICAgIC8vIGhlaWdodDogXCJjYWxjKDEwMCUpXCIsXG4gICAgICAgICAgICBvYmplY3RGaXQ6IFwiXCIsXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIi5jdXN0b21CYWNrZ3JvdW5kIGltZ1wiKS5jc3Moe1xuICAgICAgICAgICAgb2JqZWN0Rml0OiBjb25maWdfMS5kZWZhdWx0LmN1c3RvbUJhY2tncm91bmRTaXplLFxuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLmFwcGx5Q3VzdG9tQmFja2dyb3VuZFNpemUgPSBhcHBseUN1c3RvbUJhY2tncm91bmRTaXplO1xuZnVuY3Rpb24gYXBwbHlDdXN0b21CYWNrZ3JvdW5kKCkge1xuICAgIC8vICQoXCIuY3VzdG9tQmFja2dyb3VuZFwiKS5jc3Moe1xuICAgIC8vICAgYmFja2dyb3VuZEltYWdlOiBgdXJsKCR7Q29uZmlnLmN1c3RvbUJhY2tncm91bmR9KWAsXG4gICAgLy8gICBiYWNrZ3JvdW5kQXR0YWNobWVudDogXCJmaXhlZFwiLFxuICAgIC8vIH0pO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmN1c3RvbUJhY2tncm91bmQgPT09IFwiXCIpIHtcbiAgICAgICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcIm5vRXJyb3JCb3JkZXJcIik7XG4gICAgICAgICQoXCIjcmVzdWx0V29yZHNIaXN0b3J5XCIpLnJlbW92ZUNsYXNzKFwibm9FcnJvckJvcmRlclwiKTtcbiAgICAgICAgJChcIi5jdXN0b21CYWNrZ3JvdW5kIGltZ1wiKS5yZW1vdmUoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIjd29yZHNcIikuYWRkQ2xhc3MoXCJub0Vycm9yQm9yZGVyXCIpO1xuICAgICAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeVwiKS5hZGRDbGFzcyhcIm5vRXJyb3JCb3JkZXJcIik7XG4gICAgICAgICQoXCIuY3VzdG9tQmFja2dyb3VuZFwiKS5odG1sKGA8aW1nIHNyYz1cIiR7Y29uZmlnXzEuZGVmYXVsdC5jdXN0b21CYWNrZ3JvdW5kfVwiIC8+YCk7XG4gICAgICAgIEJhY2tncm91bmRGaWx0ZXIuYXBwbHkoKTtcbiAgICAgICAgYXBwbHlDdXN0b21CYWNrZ3JvdW5kU2l6ZSgpO1xuICAgIH1cbn1cbmV4cG9ydHMuYXBwbHlDdXN0b21CYWNrZ3JvdW5kID0gYXBwbHlDdXN0b21CYWNrZ3JvdW5kO1xuKF9iID0gKF9hID0gd2luZG93XG4gICAgLm1hdGNoTWVkaWEpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jYWxsKHdpbmRvdywgXCIocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspXCIpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuYXV0b1N3aXRjaFRoZW1lIHx8IGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tVGhlbWUpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoZXZlbnQubWF0Y2hlcykge1xuICAgICAgICBzZXQoY29uZmlnXzEuZGVmYXVsdC50aGVtZURhcmssIGZhbHNlKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHNldChjb25maWdfMS5kZWZhdWx0LnRoZW1lTGlnaHQsIGZhbHNlKTtcbiAgICB9XG59KTtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXksIGV2ZW50VmFsdWUsIG5vc2F2ZSkgPT4ge1xuICAgIGlmIChldmVudEtleSA9PT0gXCJjdXN0b21UaGVtZVwiKSB7XG4gICAgICAgIGV2ZW50VmFsdWUgPyBzZXQoXCJjdXN0b21cIiwgdHJ1ZSkgOiBzZXQoY29uZmlnXzEuZGVmYXVsdC50aGVtZSwgZmFsc2UpO1xuICAgIH1cbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiY3VzdG9tVGhlbWVDb2xvcnNcIikge1xuICAgICAgICBub3NhdmUgPyBwcmV2aWV3KFwiY3VzdG9tXCIsIHRydWUpIDogc2V0KFwiY3VzdG9tXCIsIHRydWUpO1xuICAgIH1cbiAgICBpZiAoZXZlbnRLZXkgPT09IFwidGhlbWVcIikge1xuICAgICAgICBjbGVhclByZXZpZXcoKTtcbiAgICAgICAgc2V0KGV2ZW50VmFsdWUsIGZhbHNlKTtcbiAgICB9XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcInNldFRoZW1lc1wiKSB7XG4gICAgICAgIGNsZWFyUHJldmlldygpO1xuICAgICAgICBpZiAoZXZlbnRWYWx1ZSkge1xuICAgICAgICAgICAgc2V0KFwiY3VzdG9tXCIsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYXV0b1N3aXRjaFRoZW1lKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5tYXRjaE1lZGlhICYmXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tYXRjaE1lZGlhKFwiKHByZWZlcnMtY29sb3Itc2NoZW1lOiBkYXJrKVwiKS5tYXRjaGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHNldChjb25maWdfMS5kZWZhdWx0LnRoZW1lRGFyaywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0KGNvbmZpZ18xLmRlZmF1bHQudGhlbWVMaWdodCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNldChjb25maWdfMS5kZWZhdWx0LnRoZW1lLCBmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcInJhbmRvbVRoZW1lXCIgJiYgZXZlbnRWYWx1ZSA9PT0gXCJvZmZcIilcbiAgICAgICAgY2xlYXJSYW5kb20oKTtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiY3VzdG9tQmFja2dyb3VuZFwiKVxuICAgICAgICBhcHBseUN1c3RvbUJhY2tncm91bmQoKTtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiY3VzdG9tQmFja2dyb3VuZFNpemVcIilcbiAgICAgICAgYXBwbHlDdXN0b21CYWNrZ3JvdW5kU2l6ZSgpO1xuICAgIGlmIChldmVudEtleSA9PT0gXCJhdXRvU3dpdGNoVGhlbWVcIikge1xuICAgICAgICBpZiAoZXZlbnRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5tYXRjaE1lZGlhICYmXG4gICAgICAgICAgICAgICAgd2luZG93Lm1hdGNoTWVkaWEoXCIocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspXCIpLm1hdGNoZXMpIHtcbiAgICAgICAgICAgICAgICBzZXQoY29uZmlnXzEuZGVmYXVsdC50aGVtZURhcmssIGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNldChjb25maWdfMS5kZWZhdWx0LnRoZW1lTGlnaHQsIGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHNldChjb25maWdfMS5kZWZhdWx0LnRoZW1lLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcInRoZW1lTGlnaHRcIiAmJlxuICAgICAgICBjb25maWdfMS5kZWZhdWx0LmF1dG9Td2l0Y2hUaGVtZSAmJlxuICAgICAgICAhKHdpbmRvdy5tYXRjaE1lZGlhICYmXG4gICAgICAgICAgICB3aW5kb3cubWF0Y2hNZWRpYShcIihwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaylcIikubWF0Y2hlcykgJiZcbiAgICAgICAgIW5vc2F2ZSkge1xuICAgICAgICBzZXQoY29uZmlnXzEuZGVmYXVsdC50aGVtZUxpZ2h0LCBmYWxzZSk7XG4gICAgfVxuICAgIGlmIChldmVudEtleSA9PT0gXCJ0aGVtZURhcmtcIiAmJlxuICAgICAgICBjb25maWdfMS5kZWZhdWx0LmF1dG9Td2l0Y2hUaGVtZSAmJlxuICAgICAgICB3aW5kb3cubWF0Y2hNZWRpYSAmJlxuICAgICAgICB3aW5kb3cubWF0Y2hNZWRpYShcIihwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaylcIikubWF0Y2hlcyAmJlxuICAgICAgICAhbm9zYXZlKSB7XG4gICAgICAgIHNldChjb25maWdfMS5kZWZhdWx0LnRoZW1lRGFyaywgZmFsc2UpO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy52ZXJpZnkgPSBleHBvcnRzLnNldCA9IGV4cG9ydHMuZGF0YSA9IHZvaWQgMDtcbmNvbnN0IGFwZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9hcGVcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBTZXR0aW5ncyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcGFnZXMvc2V0dGluZ3NcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IExvYWRlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbG9hZGVyXCIpKTtcbmV4cG9ydHMuZGF0YSA9IG51bGw7XG5mdW5jdGlvbiBzZXQodmFsKSB7XG4gICAgZXhwb3J0cy5kYXRhID0gdmFsO1xufVxuZXhwb3J0cy5zZXQgPSBzZXQ7XG5mdW5jdGlvbiB2ZXJpZnkodWlkKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKGV4cG9ydHMuZGF0YSA9PT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJMaW5raW5nIERpc2NvcmQgYWNjb3VudFwiLCAwLCAzKTtcbiAgICAgICAgTG9hZGVyLnNob3coKTtcbiAgICAgICAgZXhwb3J0cy5kYXRhLnVpZCA9IHVpZDtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmxpbmtEaXNjb3JkKGV4cG9ydHMuZGF0YSk7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGxpbmsgRGlzY29yZDogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJBY2NvdW50cyBsaW5rZWRcIiwgMSk7XG4gICAgICAgIGNvbnN0IHNuYXBzaG90ID0gREIuZ2V0U25hcHNob3QoKTtcbiAgICAgICAgc25hcHNob3QuZGlzY29yZElkID0gcmVzcG9uc2UuZGF0YS5kaWQ7XG4gICAgICAgIERCLnNldFNuYXBzaG90KHNuYXBzaG90KTtcbiAgICAgICAgU2V0dGluZ3MudXBkYXRlRGlzY29yZFNlY3Rpb24oKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMudmVyaWZ5ID0gdmVyaWZ5O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51cGRhdGVMb2NhbFN0YXRzID0gZXhwb3J0cy5zYXZlTG9jYWxSZXN1bHQgPSBleHBvcnRzLnNhdmVDb25maWcgPSBleHBvcnRzLnVwZGF0ZUxiTWVtb3J5ID0gZXhwb3J0cy5zYXZlTG9jYWxUYWdQQiA9IGV4cG9ydHMuZ2V0TG9jYWxUYWdQQiA9IGV4cG9ydHMuc2F2ZUxvY2FsUEIgPSBleHBvcnRzLmdldExvY2FsUEIgPSBleHBvcnRzLmdldFVzZXJBdmVyYWdlMTAgPSBleHBvcnRzLmdldFVzZXJIaWdoZXN0V3BtID0gZXhwb3J0cy5kZWxldGVDdXN0b21UaGVtZSA9IGV4cG9ydHMuZWRpdEN1c3RvbVRoZW1lID0gZXhwb3J0cy5hZGRDdXN0b21UaGVtZSA9IGV4cG9ydHMuZ2V0Q3VzdG9tVGhlbWVCeUlkID0gZXhwb3J0cy5nZXRVc2VyUmVzdWx0cyA9IGV4cG9ydHMuaW5pdFNuYXBzaG90ID0gZXhwb3J0cy5zZXRTbmFwc2hvdCA9IGV4cG9ydHMuZ2V0U25hcHNob3QgPSB2b2lkIDA7XG5jb25zdCBhcGVfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9hcGVcIikpO1xuY29uc3QgQWNjb3VudEJ1dHRvbiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9lbGVtZW50cy9hY2NvdW50LWJ1dHRvblwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgTG9hZGluZ1BhZ2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vcGFnZXMvbG9hZGluZ1wiKSk7XG5jb25zdCBkZWZhdWx0X2NvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL2NvbnN0YW50cy9kZWZhdWx0LWNvbmZpZ1wiKSk7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4vZmlyZWJhc2VcIik7XG5jb25zdCBkZWZhdWx0X3NuYXBzaG90XzEgPSByZXF1aXJlKFwiLi9jb25zdGFudHMvZGVmYXVsdC1zbmFwc2hvdFwiKTtcbmxldCBkYlNuYXBzaG90O1xuZnVuY3Rpb24gZ2V0U25hcHNob3QoKSB7XG4gICAgcmV0dXJuIGRiU25hcHNob3Q7XG59XG5leHBvcnRzLmdldFNuYXBzaG90ID0gZ2V0U25hcHNob3Q7XG5mdW5jdGlvbiBzZXRTbmFwc2hvdChuZXdTbmFwc2hvdCkge1xuICAgIHRyeSB7XG4gICAgICAgIGRlbGV0ZSBuZXdTbmFwc2hvdC5iYW5uZWQ7XG4gICAgfVxuICAgIGNhdGNoIChfYSkgeyB9XG4gICAgdHJ5IHtcbiAgICAgICAgZGVsZXRlIG5ld1NuYXBzaG90LnZlcmlmaWVkO1xuICAgIH1cbiAgICBjYXRjaCAoX2IpIHsgfVxuICAgIGRiU25hcHNob3QgPSBuZXdTbmFwc2hvdDtcbn1cbmV4cG9ydHMuc2V0U25hcHNob3QgPSBzZXRTbmFwc2hvdDtcbmZ1bmN0aW9uIGluaXRTbmFwc2hvdCgpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lO1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIC8vc2VuZCBhcGkgcmVxdWVzdCB3aXRoIHRva2VuIHRoYXQgcmV0dXJucyB0YWdzLCBwcmVzZXRzLCBhbmQgZGF0YSBuZWVkZWQgZm9yIHNuYXBcbiAgICAgICAgY29uc3Qgc25hcCA9IGRlZmF1bHRfc25hcHNob3RfMS5kZWZhdWx0U25hcDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgPT0gbnVsbClcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAvLyBpZiAoQWN0aXZlUGFnZS5nZXQoKSA9PSBcImxvYWRpbmdcIikge1xuICAgICAgICAgICAgLy8gICBMb2FkaW5nUGFnZS51cGRhdGVCYXIoMjIuNSk7XG4gICAgICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gICBMb2FkaW5nUGFnZS51cGRhdGVCYXIoMTYpO1xuICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgLy8gTG9hZGluZ1BhZ2UudXBkYXRlVGV4dChcIkRvd25sb2FkaW5nIHVzZXIuLi5cIik7XG4gICAgICAgICAgICBjb25zdCBbdXNlclJlc3BvbnNlLCBjb25maWdSZXNwb25zZSwgdGFnc1Jlc3BvbnNlLCBwcmVzZXRzUmVzcG9uc2VdID0geWllbGQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgICAgIGFwZV8xLmRlZmF1bHQudXNlcnMuZ2V0RGF0YSgpLFxuICAgICAgICAgICAgICAgIGFwZV8xLmRlZmF1bHQuY29uZmlncy5nZXQoKSxcbiAgICAgICAgICAgICAgICBhcGVfMS5kZWZhdWx0LnVzZXJzLmdldFRhZ3MoKSxcbiAgICAgICAgICAgICAgICBhcGVfMS5kZWZhdWx0LnByZXNldHMuZ2V0KCksXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIGlmICh1c2VyUmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyB7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGAke3VzZXJSZXNwb25zZS5tZXNzYWdlfSAodXNlcilgLFxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZUNvZGU6IHVzZXJSZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb25maWdSZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHRocm93IHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogYCR7Y29uZmlnUmVzcG9uc2UubWVzc2FnZX0gKGNvbmZpZylgLFxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZUNvZGU6IGNvbmZpZ1Jlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRhZ3NSZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHRocm93IHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogYCR7dGFnc1Jlc3BvbnNlLm1lc3NhZ2V9ICh0YWdzKWAsXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlQ29kZTogdGFnc1Jlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHByZXNldHNSZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHRocm93IHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogYCR7cHJlc2V0c1Jlc3BvbnNlLm1lc3NhZ2V9IChwcmVzZXRzKWAsXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlQ29kZTogcHJlc2V0c1Jlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgW3VzZXJEYXRhLCBjb25maWdEYXRhLCB0YWdzRGF0YSwgcHJlc2V0c0RhdGFdID0gW1xuICAgICAgICAgICAgICAgIHVzZXJSZXNwb25zZSxcbiAgICAgICAgICAgICAgICBjb25maWdSZXNwb25zZSxcbiAgICAgICAgICAgICAgICB0YWdzUmVzcG9uc2UsXG4gICAgICAgICAgICAgICAgcHJlc2V0c1Jlc3BvbnNlLFxuICAgICAgICAgICAgXS5tYXAoKHJlc3BvbnNlKSA9PiByZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICAgIHNuYXAubmFtZSA9IHVzZXJEYXRhLm5hbWU7XG4gICAgICAgICAgICBzbmFwLnBlcnNvbmFsQmVzdHMgPSB1c2VyRGF0YS5wZXJzb25hbEJlc3RzO1xuICAgICAgICAgICAgc25hcC5iYW5uZWQgPSB1c2VyRGF0YS5iYW5uZWQ7XG4gICAgICAgICAgICBzbmFwLnZlcmlmaWVkID0gdXNlckRhdGEudmVyaWZpZWQ7XG4gICAgICAgICAgICBzbmFwLmRpc2NvcmRJZCA9IHVzZXJEYXRhLmRpc2NvcmRJZDtcbiAgICAgICAgICAgIHNuYXAuZ2xvYmFsU3RhdHMgPSB7XG4gICAgICAgICAgICAgICAgdGltZTogdXNlckRhdGEudGltZVR5cGluZyxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiB1c2VyRGF0YS5zdGFydGVkVGVzdHMsXG4gICAgICAgICAgICAgICAgY29tcGxldGVkOiB1c2VyRGF0YS5jb21wbGV0ZWRUZXN0cyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAodXNlckRhdGEucXVvdGVNb2QgPT09IHRydWUpXG4gICAgICAgICAgICAgICAgc25hcC5xdW90ZU1vZCA9IHRydWU7XG4gICAgICAgICAgICBzbmFwLnF1b3RlUmF0aW5ncyA9IHVzZXJEYXRhLnF1b3RlUmF0aW5ncztcbiAgICAgICAgICAgIHNuYXAuZmF2b3VyaXRlVGhlbWVzID1cbiAgICAgICAgICAgICAgICB1c2VyRGF0YS5mYXZvdXJpdGVUaGVtZXMgPT09IHVuZGVmaW5lZCA/IFtdIDogdXNlckRhdGEuZmF2b3VyaXRlVGhlbWVzO1xuICAgICAgICAgICAgaWYgKCgoX2EgPSB1c2VyRGF0YS5sYk1lbW9yeSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRpbWUxNSkgfHwgKChfYiA9IHVzZXJEYXRhLmxiTWVtb3J5KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudGltZTYwKSkge1xuICAgICAgICAgICAgICAgIC8vb2xkIG1lbW9yeSBmb3JtYXRcbiAgICAgICAgICAgICAgICBzbmFwLmxiTWVtb3J5ID0ge307XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh1c2VyRGF0YS5sYk1lbW9yeSkge1xuICAgICAgICAgICAgICAgIHNuYXAubGJNZW1vcnkgPSB1c2VyRGF0YS5sYk1lbW9yeTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGlmIChBY3RpdmVQYWdlLmdldCgpID09IFwibG9hZGluZ1wiKSB7XG4gICAgICAgICAgICAvLyAgIExvYWRpbmdQYWdlLnVwZGF0ZUJhcig0NSk7XG4gICAgICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gICBMb2FkaW5nUGFnZS51cGRhdGVCYXIoMzIpO1xuICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgLy8gTG9hZGluZ1BhZ2UudXBkYXRlVGV4dChcIkRvd25sb2FkaW5nIGNvbmZpZy4uLlwiKTtcbiAgICAgICAgICAgIGlmIChjb25maWdEYXRhKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3Q29uZmlnID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdF9jb25maWdfMS5kZWZhdWx0KTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBjb25maWdEYXRhLmNvbmZpZykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGNvbmZpZ0RhdGEuY29uZmlnW2tleV07XG4gICAgICAgICAgICAgICAgICAgIG5ld0NvbmZpZ1trZXldID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNuYXAuY29uZmlnID0gbmV3Q29uZmlnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT0gXCJsb2FkaW5nXCIpIHtcbiAgICAgICAgICAgIC8vICAgTG9hZGluZ1BhZ2UudXBkYXRlQmFyKDY3LjUpO1xuICAgICAgICAgICAgLy8gfSBlbHNlIHtcbiAgICAgICAgICAgIC8vICAgTG9hZGluZ1BhZ2UudXBkYXRlQmFyKDQ4KTtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIC8vIExvYWRpbmdQYWdlLnVwZGF0ZVRleHQoXCJEb3dubG9hZGluZyB0YWdzLi4uXCIpO1xuICAgICAgICAgICAgc25hcC5jdXN0b21UaGVtZXMgPSAoX2MgPSB1c2VyRGF0YS5jdXN0b21UaGVtZXMpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IFtdO1xuICAgICAgICAgICAgc25hcC50YWdzID0gdGFnc0RhdGE7XG4gICAgICAgICAgICBzbmFwLnRhZ3MgPSAoX2QgPSBzbmFwLnRhZ3MpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGEubmFtZSA+IGIubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoYS5uYW1lIDwgYi5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT0gXCJsb2FkaW5nXCIpIHtcbiAgICAgICAgICAgIC8vICAgTG9hZGluZ1BhZ2UudXBkYXRlQmFyKDkwKTtcbiAgICAgICAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyAgIExvYWRpbmdQYWdlLnVwZGF0ZUJhcig2NCk7XG4gICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAvLyBMb2FkaW5nUGFnZS51cGRhdGVUZXh0KFwiRG93bmxvYWRpbmcgcHJlc2V0cy4uLlwiKTtcbiAgICAgICAgICAgIHNuYXAucHJlc2V0cyA9IHByZXNldHNEYXRhO1xuICAgICAgICAgICAgc25hcC5wcmVzZXRzID0gKF9lID0gc25hcC5wcmVzZXRzKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Uuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChhLm5hbWUgPiBiLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGEubmFtZSA8IGIubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRiU25hcHNob3QgPSBzbmFwO1xuICAgICAgICAgICAgcmV0dXJuIGRiU25hcHNob3Q7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGRiU25hcHNob3QgPSBkZWZhdWx0X3NuYXBzaG90XzEuZGVmYXVsdFNuYXA7XG4gICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmluaXRTbmFwc2hvdCA9IGluaXRTbmFwc2hvdDtcbmZ1bmN0aW9uIGdldFVzZXJSZXN1bHRzKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgICAgIGlmICh1c2VyID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmIChkYlNuYXBzaG90ID09PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAoZGJTbmFwc2hvdC5yZXN1bHRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgTG9hZGluZ1BhZ2UudXBkYXRlVGV4dChcIkRvd25sb2FkaW5nIHJlc3VsdHMuLi5cIik7XG4gICAgICAgICAgICBMb2FkaW5nUGFnZS51cGRhdGVCYXIoOTApO1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnJlc3VsdHMuZ2V0KCk7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVycm9yIGdldHRpbmcgcmVzdWx0czogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICByZXN1bHRzLmZvckVhY2goKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuYmFpbGVkT3V0ID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5iYWlsZWRPdXQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmJsaW5kTW9kZSA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQuYmxpbmRNb2RlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5sYXp5TW9kZSA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQubGF6eU1vZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmRpZmZpY3VsdHkgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRpZmZpY3VsdHkgPSBcIm5vcm1hbFwiO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZnVuYm94ID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5mdW5ib3ggPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lmxhbmd1YWdlID09PSB1bmRlZmluZWQgfHwgcmVzdWx0Lmxhbmd1YWdlID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5sYW5ndWFnZSA9IFwiZW5nbGlzaFwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lm51bWJlcnMgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lm51bWJlcnMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnB1bmN0dWF0aW9uID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdW5jdHVhdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkYlNuYXBzaG90LnJlc3VsdHMgPSByZXN1bHRzID09PSBudWxsIHx8IHJlc3VsdHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3VsdHMuc29ydCgoYSwgYikgPT4gYi50aW1lc3RhbXAgLSBhLnRpbWVzdGFtcCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRVc2VyUmVzdWx0cyA9IGdldFVzZXJSZXN1bHRzO1xuZnVuY3Rpb24gZ2V0Q3VzdG9tVGhlbWVCeUlkKHRoZW1lSUQpIHtcbiAgICByZXR1cm4gZGJTbmFwc2hvdC5jdXN0b21UaGVtZXMuZmluZCgodCkgPT4gdC5faWQgPT09IHRoZW1lSUQpO1xufVxuZXhwb3J0cy5nZXRDdXN0b21UaGVtZUJ5SWQgPSBnZXRDdXN0b21UaGVtZUJ5SWQ7XG5mdW5jdGlvbiBhZGRDdXN0b21UaGVtZSh0aGVtZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChkYlNuYXBzaG90ID09PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAoZGJTbmFwc2hvdC5jdXN0b21UaGVtZXMubGVuZ3RoID49IDEwKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlRvbyBtYW55IGN1c3RvbSB0aGVtZXMhXCIsIDApO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5hZGRDdXN0b21UaGVtZSh0aGVtZSk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJFcnJvciBhZGRpbmcgY3VzdG9tIHRoZW1lOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuZXdDdXN0b21UaGVtZSA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhlbWUpLCB7IF9pZDogcmVzcG9uc2UuZGF0YS50aGVtZS5faWQgfSk7XG4gICAgICAgIGRiU25hcHNob3QuY3VzdG9tVGhlbWVzLnB1c2gobmV3Q3VzdG9tVGhlbWUpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuYWRkQ3VzdG9tVGhlbWUgPSBhZGRDdXN0b21UaGVtZTtcbmZ1bmN0aW9uIGVkaXRDdXN0b21UaGVtZSh0aGVtZUlkLCBuZXdUaGVtZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgICAgIGlmICh1c2VyID09PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAoZGJTbmFwc2hvdCA9PT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgY29uc3QgY3VzdG9tVGhlbWUgPSBkYlNuYXBzaG90LmN1c3RvbVRoZW1lcy5maW5kKCh0KSA9PiB0Ll9pZCA9PT0gdGhlbWVJZCk7XG4gICAgICAgIGlmICghY3VzdG9tVGhlbWUpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRWRpdGluZyBmYWlsZWQ6IEN1c3RvbSB0aGVtZSB3aXRoIGlkOiBcIiArIHRoZW1lSWQgKyBcIiBkb2VzIG5vdCBleGlzdFwiLCAtMSk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmVkaXRDdXN0b21UaGVtZSh0aGVtZUlkLCBuZXdUaGVtZSk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJFcnJvciBlZGl0aW5nIGN1c3RvbSB0aGVtZTogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmV3Q3VzdG9tVGhlbWUgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG5ld1RoZW1lKSwgeyBfaWQ6IHRoZW1lSWQgfSk7XG4gICAgICAgIGRiU25hcHNob3QuY3VzdG9tVGhlbWVzW2RiU25hcHNob3QuY3VzdG9tVGhlbWVzLmluZGV4T2YoY3VzdG9tVGhlbWUpXSA9XG4gICAgICAgICAgICBuZXdDdXN0b21UaGVtZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG59XG5leHBvcnRzLmVkaXRDdXN0b21UaGVtZSA9IGVkaXRDdXN0b21UaGVtZTtcbmZ1bmN0aW9uIGRlbGV0ZUN1c3RvbVRoZW1lKHRoZW1lSWQpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCB1c2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgICAgICBpZiAodXNlciA9PT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKGRiU25hcHNob3QgPT09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGNvbnN0IGN1c3RvbVRoZW1lID0gZGJTbmFwc2hvdC5jdXN0b21UaGVtZXMuZmluZCgodCkgPT4gdC5faWQgPT09IHRoZW1lSWQpO1xuICAgICAgICBpZiAoIWN1c3RvbVRoZW1lKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMuZGVsZXRlQ3VzdG9tVGhlbWUodGhlbWVJZCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJFcnJvciBkZWxldGluZyBjdXN0b20gdGhlbWU6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGRiU25hcHNob3QuY3VzdG9tVGhlbWVzID0gZGJTbmFwc2hvdC5jdXN0b21UaGVtZXMuZmlsdGVyKCh0KSA9PiB0Ll9pZCAhPT0gdGhlbWVJZCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xufVxuZXhwb3J0cy5kZWxldGVDdXN0b21UaGVtZSA9IGRlbGV0ZUN1c3RvbVRoZW1lO1xuZnVuY3Rpb24gZ2V0VXNlckhpZ2hlc3RXcG0obW9kZSwgbW9kZTIsIHB1bmN0dWF0aW9uLCBsYW5ndWFnZSwgZGlmZmljdWx0eSwgbGF6eU1vZGUpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBmdW5jdGlvbiBjb250KCkge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgbGV0IHRvcFdwbSA9IDA7XG4gICAgICAgICAgICAoX2EgPSBkYlNuYXBzaG90LnJlc3VsdHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lm1vZGUgPT0gbW9kZSAmJlxuICAgICAgICAgICAgICAgICAgICByZXN1bHQubW9kZTIgPT0gbW9kZTIgJiZcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1bmN0dWF0aW9uID09IHB1bmN0dWF0aW9uICYmXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5sYW5ndWFnZSA9PSBsYW5ndWFnZSAmJlxuICAgICAgICAgICAgICAgICAgICByZXN1bHQuZGlmZmljdWx0eSA9PSBkaWZmaWN1bHR5ICYmXG4gICAgICAgICAgICAgICAgICAgIChyZXN1bHQubGF6eU1vZGUgPT09IGxhenlNb2RlIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAocmVzdWx0LmxhenlNb2RlID09PSB1bmRlZmluZWQgJiYgbGF6eU1vZGUgPT09IGZhbHNlKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC53cG0gPiB0b3BXcG0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcFdwbSA9IHJlc3VsdC53cG07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0b3BXcG07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmV0dmFsID0gZGJTbmFwc2hvdCA9PT0gbnVsbCB8fCBkYlNuYXBzaG90LnJlc3VsdHMgPT09IHVuZGVmaW5lZCA/IDAgOiBjb250KCk7XG4gICAgICAgIHJldHVybiByZXR2YWw7XG4gICAgfSk7XG59XG5leHBvcnRzLmdldFVzZXJIaWdoZXN0V3BtID0gZ2V0VXNlckhpZ2hlc3RXcG07XG5mdW5jdGlvbiBnZXRVc2VyQXZlcmFnZTEwKG1vZGUsIG1vZGUyLCBwdW5jdHVhdGlvbiwgbGFuZ3VhZ2UsIGRpZmZpY3VsdHksIGxhenlNb2RlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3Qgc25hcHNob3QgPSBnZXRTbmFwc2hvdCgpO1xuICAgICAgICBpZiAoIXNuYXBzaG90KVxuICAgICAgICAgICAgcmV0dXJuIFswLCAwXTtcbiAgICAgICAgZnVuY3Rpb24gY29udCgpIHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIGNvbnN0IGFjdGl2ZVRhZ0lkcyA9IFtdO1xuICAgICAgICAgICAgKF9hID0gc25hcHNob3QudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0YWcuYWN0aXZlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZVRhZ0lkcy5wdXNoKHRhZy5faWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGV0IHdwbVN1bSA9IDA7XG4gICAgICAgICAgICBsZXQgYWNjU3VtID0gMDtcbiAgICAgICAgICAgIGxldCBsYXN0MTBXcG0gPSAwO1xuICAgICAgICAgICAgbGV0IGxhc3QxMEFjYyA9IDA7XG4gICAgICAgICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgICAgICAgbGV0IGxhc3QxMENvdW50ID0gMDtcbiAgICAgICAgICAgIGlmIChzbmFwc2hvdC5yZXN1bHRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHJlc3VsdCBvZiBzbmFwc2hvdC5yZXN1bHRzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubW9kZSA9PT0gbW9kZSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1bmN0dWF0aW9uID09PSBwdW5jdHVhdGlvbiAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lmxhbmd1YWdlID09PSBsYW5ndWFnZSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRpZmZpY3VsdHkgPT09IGRpZmZpY3VsdHkgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIChyZXN1bHQubGF6eU1vZGUgPT09IGxhenlNb2RlIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJlc3VsdC5sYXp5TW9kZSA9PT0gdW5kZWZpbmVkICYmIGxhenlNb2RlID09PSBmYWxzZSkpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAoYWN0aXZlVGFnSWRzLmxlbmd0aCA9PT0gMCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZVRhZ0lkcy5zb21lKCh0YWdJZCkgPT4gcmVzdWx0LnRhZ3MuaW5jbHVkZXModGFnSWQpKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvbnRpbnVlIGlmIHRoZSBtb2RlMiBkb2Vzbid0IG1hdGNoIGFuZCBpdCdzIG5vdCBhIHF1b3RlXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lm1vZGUyICE9PSBtb2RlMiAmJiBtb2RlICE9PSBcInF1b3RlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEdyYWIgdGhlIG1vc3QgcmVjZW50IHJlc3VsdHMgZnJvbSB0aGUgY3VycmVudCBtb2RlXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFzdDEwQ291bnQgPCAxMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QxMFdwbSArPSByZXN1bHQud3BtO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QxMEFjYyArPSByZXN1bHQuYWNjO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QxMENvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgbW9kZTIgbWF0Y2hlcyBhbmQgaWYgaXQgZG9lcywgYWRkIGl0IHRvIHRoZSBzdW0sIGZvciBxdW90ZXMsIHRoaXMgaXMgdGhlIHF1b3RlIGlkXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lm1vZGUyID09PSBtb2RlMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdwbVN1bSArPSByZXN1bHQud3BtO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY1N1bSArPSByZXN1bHQuYWNjO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50ID49IDEwKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgbGFzdCAxMCBhdmVyYWdlIHdwbSAmIGFjYyBmb3IgcXVvdGVcbiAgICAgICAgICAgIC8vIGlmIHRoZSBjdXJyZW50IHF1b3RlIGlkIGhhcyBuZXZlciBiZWVuIGNvbXBsZXRlZCBiZWZvcmUgYnkgdGhlIHVzZXJcbiAgICAgICAgICAgIGlmIChjb3VudCA9PT0gMCAmJiBtb2RlID09PSBcInF1b3RlXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gW2xhc3QxMFdwbSAvIGxhc3QxMENvdW50LCBsYXN0MTBBY2MgLyBsYXN0MTBDb3VudF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gW3dwbVN1bSAvIGNvdW50LCBhY2NTdW0gLyBjb3VudF07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmV0dmFsID0gc25hcHNob3QgPT09IG51bGwgfHwgKHlpZWxkIGdldFVzZXJSZXN1bHRzKCkpID09PSBudWxsID8gWzAsIDBdIDogY29udCgpO1xuICAgICAgICByZXR1cm4gcmV0dmFsO1xuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRVc2VyQXZlcmFnZTEwID0gZ2V0VXNlckF2ZXJhZ2UxMDtcbmZ1bmN0aW9uIGdldExvY2FsUEIobW9kZSwgbW9kZTIsIHB1bmN0dWF0aW9uLCBsYW5ndWFnZSwgZGlmZmljdWx0eSwgbGF6eU1vZGUsIGZ1bmJveCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChmdW5ib3ggIT09IFwibm9uZVwiICYmIGZ1bmJveCAhPT0gXCJwbHVzX29uZVwiICYmIGZ1bmJveCAhPT0gXCJwbHVzX3R3b1wiKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBjb250KCkge1xuICAgICAgICAgICAgbGV0IHJldCA9IDA7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGlmICghZGJTbmFwc2hvdC5wZXJzb25hbEJlc3RzKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICAgICAgICAgIGRiU25hcHNob3QucGVyc29uYWxCZXN0c1ttb2RlXVttb2RlMl0uZm9yRWFjaCgocGIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBiLnB1bmN0dWF0aW9uID09IHB1bmN0dWF0aW9uICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBwYi5kaWZmaWN1bHR5ID09IGRpZmZpY3VsdHkgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHBiLmxhbmd1YWdlID09IGxhbmd1YWdlICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAocGIubGF6eU1vZGUgPT09IGxhenlNb2RlIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKHBiLmxhenlNb2RlID09PSB1bmRlZmluZWQgJiYgbGF6eU1vZGUgPT09IGZhbHNlKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IHBiLndwbTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmV0dmFsID0gZGJTbmFwc2hvdCA9PT0gbnVsbCA/IDAgOiBjb250KCk7XG4gICAgICAgIHJldHVybiByZXR2YWw7XG4gICAgfSk7XG59XG5leHBvcnRzLmdldExvY2FsUEIgPSBnZXRMb2NhbFBCO1xuZnVuY3Rpb24gc2F2ZUxvY2FsUEIobW9kZSwgbW9kZTIsIHB1bmN0dWF0aW9uLCBsYW5ndWFnZSwgZGlmZmljdWx0eSwgbGF6eU1vZGUsIHdwbSwgYWNjLCByYXcsIGNvbnNpc3RlbmN5KSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKG1vZGUgPT0gXCJxdW90ZVwiKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBmdW5jdGlvbiBjb250KCkge1xuICAgICAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAoZGJTbmFwc2hvdC5wZXJzb25hbEJlc3RzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBkYlNuYXBzaG90LnBlcnNvbmFsQmVzdHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWU6IHt9LFxuICAgICAgICAgICAgICAgICAgICB3b3Jkczoge30sXG4gICAgICAgICAgICAgICAgICAgIHplbjogeyB6ZW46IFtdIH0sXG4gICAgICAgICAgICAgICAgICAgIHF1b3RlOiB7IGN1c3RvbTogW10gfSxcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tOiB7IGN1c3RvbTogW10gfSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRiU25hcHNob3QucGVyc29uYWxCZXN0c1ttb2RlXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKG1vZGUgPT09IFwiemVuXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZGJTbmFwc2hvdC5wZXJzb25hbEJlc3RzW1wiemVuXCJdID0geyB6ZW46IFtdIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkYlNuYXBzaG90LnBlcnNvbmFsQmVzdHNbbW9kZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXN0b206IFtdLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkYlNuYXBzaG90LnBlcnNvbmFsQmVzdHNbbW9kZV1bbW9kZTJdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBkYlNuYXBzaG90LnBlcnNvbmFsQmVzdHNbbW9kZV1bbW9kZTJdID1cbiAgICAgICAgICAgICAgICAgICAgW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkYlNuYXBzaG90LnBlcnNvbmFsQmVzdHNbbW9kZV1bbW9kZTJdLmZvckVhY2goKHBiKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHBiLnB1bmN0dWF0aW9uID09IHB1bmN0dWF0aW9uICYmXG4gICAgICAgICAgICAgICAgICAgIHBiLmRpZmZpY3VsdHkgPT0gZGlmZmljdWx0eSAmJlxuICAgICAgICAgICAgICAgICAgICBwYi5sYW5ndWFnZSA9PSBsYW5ndWFnZSAmJlxuICAgICAgICAgICAgICAgICAgICAocGIubGF6eU1vZGUgPT09IGxhenlNb2RlIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAocGIubGF6eU1vZGUgPT09IHVuZGVmaW5lZCAmJiBsYXp5TW9kZSA9PT0gZmFsc2UpKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHBiLndwbSA9IHdwbTtcbiAgICAgICAgICAgICAgICAgICAgcGIuYWNjID0gYWNjO1xuICAgICAgICAgICAgICAgICAgICBwYi5yYXcgPSByYXc7XG4gICAgICAgICAgICAgICAgICAgIHBiLnRpbWVzdGFtcCA9IERhdGUubm93KCk7XG4gICAgICAgICAgICAgICAgICAgIHBiLmNvbnNpc3RlbmN5ID0gY29uc2lzdGVuY3k7XG4gICAgICAgICAgICAgICAgICAgIHBiLmxhenlNb2RlID0gbGF6eU1vZGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoIWZvdW5kKSB7XG4gICAgICAgICAgICAgICAgLy9ub3RoaW5nIGZvdW5kXG4gICAgICAgICAgICAgICAgZGJTbmFwc2hvdC5wZXJzb25hbEJlc3RzW21vZGVdW21vZGUyXS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IGxhbmd1YWdlLFxuICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5OiBkaWZmaWN1bHR5LFxuICAgICAgICAgICAgICAgICAgICBsYXp5TW9kZTogbGF6eU1vZGUsXG4gICAgICAgICAgICAgICAgICAgIHB1bmN0dWF0aW9uOiBwdW5jdHVhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgd3BtOiB3cG0sXG4gICAgICAgICAgICAgICAgICAgIGFjYzogYWNjLFxuICAgICAgICAgICAgICAgICAgICByYXc6IHJhdyxcbiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICAgICAgICAgICAgICBjb25zaXN0ZW5jeTogY29uc2lzdGVuY3ksXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRiU25hcHNob3QgIT0gbnVsbCkge1xuICAgICAgICAgICAgY29udCgpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLnNhdmVMb2NhbFBCID0gc2F2ZUxvY2FsUEI7XG5mdW5jdGlvbiBnZXRMb2NhbFRhZ1BCKHRhZ0lkLCBtb2RlLCBtb2RlMiwgcHVuY3R1YXRpb24sIGxhbmd1YWdlLCBkaWZmaWN1bHR5LCBsYXp5TW9kZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIGNvbnQoKSB7XG4gICAgICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAgICAgbGV0IHJldCA9IDA7XG4gICAgICAgICAgICBjb25zdCBmaWx0ZXJlZHRhZyA9ICgoX2EgPSBnZXRTbmFwc2hvdCgpLnRhZ3MpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFtdKS5maWx0ZXIoKHQpID0+IHQuX2lkID09PSB0YWdJZClbMF07XG4gICAgICAgICAgICBpZiAoZmlsdGVyZWR0YWcgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICAgICAgaWYgKGZpbHRlcmVkdGFnLnBlcnNvbmFsQmVzdHMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGZpbHRlcmVkdGFnLnBlcnNvbmFsQmVzdHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWU6IHt9LFxuICAgICAgICAgICAgICAgICAgICB3b3Jkczoge30sXG4gICAgICAgICAgICAgICAgICAgIHplbjogeyB6ZW46IFtdIH0sXG4gICAgICAgICAgICAgICAgICAgIHF1b3RlOiB7IGN1c3RvbTogW10gfSxcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tOiB7IGN1c3RvbTogW10gfSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBwZXJzb25hbEJlc3RzID0gKChfYiA9IGZpbHRlcmVkdGFnLnBlcnNvbmFsQmVzdHNbbW9kZV1bbW9kZTJdKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBbXSk7XG4gICAgICAgICAgICAgICAgcGVyc29uYWxCZXN0cy5mb3JFYWNoKChwYikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAocGIucHVuY3R1YXRpb24gPT0gcHVuY3R1YXRpb24gJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHBiLmRpZmZpY3VsdHkgPT0gZGlmZmljdWx0eSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgcGIubGFuZ3VhZ2UgPT0gbGFuZ3VhZ2UgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIChwYi5sYXp5TW9kZSA9PT0gbGF6eU1vZGUgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAocGIubGF6eU1vZGUgPT09IHVuZGVmaW5lZCAmJiBsYXp5TW9kZSA9PT0gZmFsc2UpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gcGIud3BtO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXR2YWwgPSBkYlNuYXBzaG90ID09PSBudWxsID8gMCA6IGNvbnQoKTtcbiAgICAgICAgcmV0dXJuIHJldHZhbDtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0TG9jYWxUYWdQQiA9IGdldExvY2FsVGFnUEI7XG5mdW5jdGlvbiBzYXZlTG9jYWxUYWdQQih0YWdJZCwgbW9kZSwgbW9kZTIsIHB1bmN0dWF0aW9uLCBsYW5ndWFnZSwgZGlmZmljdWx0eSwgbGF6eU1vZGUsIHdwbSwgYWNjLCByYXcsIGNvbnNpc3RlbmN5KSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKG1vZGUgPT0gXCJxdW90ZVwiKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBmdW5jdGlvbiBjb250KCkge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgY29uc3QgZmlsdGVyZWR0YWcgPSAoX2EgPSBkYlNuYXBzaG90LnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5maWx0ZXIoKHQpID0+IHQuX2lkID09PSB0YWdJZClbMF07XG4gICAgICAgICAgICBpZiAoIWZpbHRlcmVkdGFnLnBlcnNvbmFsQmVzdHMpIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJlZHRhZy5wZXJzb25hbEJlc3RzID0ge1xuICAgICAgICAgICAgICAgICAgICB0aW1lOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgd29yZHM6IHt9LFxuICAgICAgICAgICAgICAgICAgICB6ZW46IHsgemVuOiBbXSB9LFxuICAgICAgICAgICAgICAgICAgICBxdW90ZTogeyBjdXN0b206IFtdIH0sXG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbTogeyBjdXN0b206IFtdIH0sXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYgKGZpbHRlcmVkdGFnLnBlcnNvbmFsQmVzdHNbbW9kZV1bbW9kZTJdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWR0YWcucGVyc29uYWxCZXN0c1ttb2RlXVttb2RlMl0gPVxuICAgICAgICAgICAgICAgICAgICAgICAgW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZpbHRlcmVkdGFnLnBlcnNvbmFsQmVzdHNbbW9kZV1bbW9kZTJdLmZvckVhY2goKHBiKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYi5wdW5jdHVhdGlvbiA9PSBwdW5jdHVhdGlvbiAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgcGIuZGlmZmljdWx0eSA9PSBkaWZmaWN1bHR5ICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBwYi5sYW5ndWFnZSA9PSBsYW5ndWFnZSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgKHBiLmxhenlNb2RlID09PSBsYXp5TW9kZSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwYi5sYXp5TW9kZSA9PT0gdW5kZWZpbmVkICYmIGxhenlNb2RlID09PSBmYWxzZSkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYi53cG0gPSB3cG07XG4gICAgICAgICAgICAgICAgICAgICAgICBwYi5hY2MgPSBhY2M7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYi5yYXcgPSByYXc7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYi50aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGIuY29uc2lzdGVuY3kgPSBjb25zaXN0ZW5jeTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBiLmxhenlNb2RlID0gbGF6eU1vZGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoIWZvdW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vbm90aGluZyBmb3VuZFxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZHRhZy5wZXJzb25hbEJlc3RzW21vZGVdW21vZGUyXS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlOiBsYW5ndWFnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IGRpZmZpY3VsdHksXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXp5TW9kZTogbGF6eU1vZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwdW5jdHVhdGlvbjogcHVuY3R1YXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICB3cG06IHdwbSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjYzogYWNjLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmF3OiByYXcsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zaXN0ZW5jeTogY29uc2lzdGVuY3ksXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgLy90aGF0IG1vZGUgb3IgbW9kZTIgaXMgbm90IGZvdW5kXG4gICAgICAgICAgICAgICAgZmlsdGVyZWR0YWcucGVyc29uYWxCZXN0cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgdGltZToge30sXG4gICAgICAgICAgICAgICAgICAgIHdvcmRzOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgemVuOiB7IHplbjogW10gfSxcbiAgICAgICAgICAgICAgICAgICAgcXVvdGU6IHsgY3VzdG9tOiBbXSB9LFxuICAgICAgICAgICAgICAgICAgICBjdXN0b206IHsgY3VzdG9tOiBbXSB9LFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgaWYgKG1vZGUgPT09IFwiemVuXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWR0YWcucGVyc29uYWxCZXN0c1tcInplblwiXSA9IHsgemVuOiBbXSB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWR0YWcucGVyc29uYWxCZXN0c1ttb2RlXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbTogW10sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZpbHRlcmVkdGFnLnBlcnNvbmFsQmVzdHNbbW9kZV1bbW9kZTJdID0gW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogbGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5OiBkaWZmaWN1bHR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgbGF6eU1vZGU6IGxhenlNb2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHVuY3R1YXRpb246IHB1bmN0dWF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgd3BtOiB3cG0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhY2M6IGFjYyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhdzogcmF3LFxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc2lzdGVuY3k6IGNvbnNpc3RlbmN5LFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRiU25hcHNob3QgIT0gbnVsbCkge1xuICAgICAgICAgICAgY29udCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc2F2ZUxvY2FsVGFnUEIgPSBzYXZlTG9jYWxUYWdQQjtcbmZ1bmN0aW9uIHVwZGF0ZUxiTWVtb3J5KG1vZGUsIG1vZGUyLCBsYW5ndWFnZSwgcmFuaywgYXBpID0gZmFsc2UpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAvL2NvdWxkIGRiU25hcHNob3QganVzdCBiZSB1c2VkIGhlcmUgaW5zdGVhZCBvZiBnZXRTbmFwc2hvdCgpXG4gICAgICAgIGlmIChtb2RlID09PSBcInRpbWVcIikge1xuICAgICAgICAgICAgY29uc3QgdGltZU1vZGUgPSBtb2RlLCB0aW1lTW9kZTIgPSBtb2RlMjtcbiAgICAgICAgICAgIGNvbnN0IHNuYXBzaG90ID0gZ2V0U25hcHNob3QoKTtcbiAgICAgICAgICAgIGlmIChzbmFwc2hvdC5sYk1lbW9yeSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgc25hcHNob3QubGJNZW1vcnkgPSB7IHRpbWU6IHsgMTU6IHsgZW5nbGlzaDogMCB9LCA2MDogeyBlbmdsaXNoOiAwIH0gfSB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNuYXBzaG90LmxiTWVtb3J5W3RpbWVNb2RlXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgc25hcHNob3QubGJNZW1vcnlbdGltZU1vZGVdID0ge1xuICAgICAgICAgICAgICAgICAgICAxNTogeyBlbmdsaXNoOiAwIH0sXG4gICAgICAgICAgICAgICAgICAgIDYwOiB7IGVuZ2xpc2g6IDAgfSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNuYXBzaG90LmxiTWVtb3J5W3RpbWVNb2RlXVt0aW1lTW9kZTJdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBzbmFwc2hvdC5sYk1lbW9yeVt0aW1lTW9kZV1bdGltZU1vZGUyXSA9IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgY3VycmVudCA9IHNuYXBzaG90LmxiTWVtb3J5W3RpbWVNb2RlXVt0aW1lTW9kZTJdW2xhbmd1YWdlXTtcbiAgICAgICAgICAgIHNuYXBzaG90LmxiTWVtb3J5W3RpbWVNb2RlXVt0aW1lTW9kZTJdW2xhbmd1YWdlXSA9IHJhbms7XG4gICAgICAgICAgICBpZiAoYXBpICYmIGN1cnJlbnQgIT0gcmFuaykge1xuICAgICAgICAgICAgICAgIHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMudXBkYXRlTGVhZGVyYm9hcmRNZW1vcnkobW9kZSwgbW9kZTIsIGxhbmd1YWdlLCByYW5rKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNldFNuYXBzaG90KHNuYXBzaG90KTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy51cGRhdGVMYk1lbW9yeSA9IHVwZGF0ZUxiTWVtb3J5O1xuZnVuY3Rpb24gc2F2ZUNvbmZpZyhjb25maWcpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyICE9PSBudWxsKSB7XG4gICAgICAgICAgICBBY2NvdW50QnV0dG9uLmxvYWRpbmcodHJ1ZSk7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQuY29uZmlncy5zYXZlKGNvbmZpZyk7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBzYXZlIGNvbmZpZzogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBBY2NvdW50QnV0dG9uLmxvYWRpbmcoZmFsc2UpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLnNhdmVDb25maWcgPSBzYXZlQ29uZmlnO1xuZnVuY3Rpb24gc2F2ZUxvY2FsUmVzdWx0KHJlc3VsdCkge1xuICAgIGNvbnN0IHNuYXBzaG90ID0gZ2V0U25hcHNob3QoKTtcbiAgICBpZiAoc25hcHNob3QgIT09IG51bGwgJiYgc25hcHNob3QucmVzdWx0cyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHNuYXBzaG90LnJlc3VsdHMudW5zaGlmdChyZXN1bHQpO1xuICAgICAgICBzZXRTbmFwc2hvdChzbmFwc2hvdCk7XG4gICAgfVxufVxuZXhwb3J0cy5zYXZlTG9jYWxSZXN1bHQgPSBzYXZlTG9jYWxSZXN1bHQ7XG5mdW5jdGlvbiB1cGRhdGVMb2NhbFN0YXRzKHN0YXRzKSB7XG4gICAgY29uc3Qgc25hcHNob3QgPSBnZXRTbmFwc2hvdCgpO1xuICAgIGlmIChzbmFwc2hvdC5nbG9iYWxTdGF0cyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHNuYXBzaG90Lmdsb2JhbFN0YXRzID0ge307XG4gICAgfVxuICAgIGlmIChzbmFwc2hvdCAhPT0gbnVsbCAmJiBzbmFwc2hvdC5nbG9iYWxTdGF0cyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmIChzbmFwc2hvdC5nbG9iYWxTdGF0cy50aW1lID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgc25hcHNob3QuZ2xvYmFsU3RhdHMudGltZSA9IHN0YXRzLnRpbWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzbmFwc2hvdC5nbG9iYWxTdGF0cy50aW1lICs9IHN0YXRzLnRpbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNuYXBzaG90Lmdsb2JhbFN0YXRzLnN0YXJ0ZWQgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBzbmFwc2hvdC5nbG9iYWxTdGF0cy5zdGFydGVkID0gc3RhdHMuc3RhcnRlZDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHNuYXBzaG90Lmdsb2JhbFN0YXRzLnN0YXJ0ZWQgKz0gc3RhdHMuc3RhcnRlZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc25hcHNob3QuZ2xvYmFsU3RhdHMuY29tcGxldGVkID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgc25hcHNob3QuZ2xvYmFsU3RhdHMuY29tcGxldGVkID0gMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHNuYXBzaG90Lmdsb2JhbFN0YXRzLmNvbXBsZXRlZCArPSAxO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNldFNuYXBzaG90KHNuYXBzaG90KTtcbn1cbmV4cG9ydHMudXBkYXRlTG9jYWxTdGF0cyA9IHVwZGF0ZUxvY2FsU3RhdHM7XG4vLyBleHBvcnQgYXN5bmMgZnVuY3Rpb24gREIuZ2V0TG9jYWxUYWdQQih0YWdJZCkge1xuLy8gICBmdW5jdGlvbiBjb250KCkge1xuLy8gICAgIGxldCByZXQgPSAwO1xuLy8gICAgIHRyeSB7XG4vLyAgICAgICByZXQgPSBkYlNuYXBzaG90LnRhZ3MuZmlsdGVyKCh0KSA9PiB0LmlkID09PSB0YWdJZClbMF0ucGI7XG4vLyAgICAgICBpZiAocmV0ID09IHVuZGVmaW5lZCkge1xuLy8gICAgICAgICByZXQgPSAwO1xuLy8gICAgICAgfVxuLy8gICAgICAgcmV0dXJuIHJldDtcbi8vICAgICB9IGNhdGNoIChlKSB7XG4vLyAgICAgICByZXR1cm4gcmV0O1xuLy8gICAgIH1cbi8vICAgfVxuLy8gICBjb25zdCByZXR2YWwgPSBkYlNuYXBzaG90ICE9PSBudWxsID8gY29udCgpIDogdW5kZWZpbmVkO1xuLy8gICByZXR1cm4gcmV0dmFsO1xuLy8gfVxuLy8gZXhwb3J0IGFzeW5jIGZ1bmN0aW8odGFnSWQsIHdwbSkge1xuLy8gICBmdW5jdGlvbiBjb250KCkge1xuLy8gICAgIGRiU25hcHNob3QudGFncy5mb3JFYWNoKCh0YWcpID0+IHtcbi8vICAgICAgIGlmICh0YWcuX2lkID09PSB0YWdJZCkge1xuLy8gICAgICAgICB0YWcucGIgPSB3cG07XG4vLyAgICAgICB9XG4vLyAgICAgfSk7XG4vLyAgIH1cbi8vICAgaWYgKGRiU25hcHNob3QgIT0gbnVsbCkge1xuLy8gICAgIGNvbnQoKTtcbi8vICAgfVxuLy8gfVxuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudXBkYXRlID0gZXhwb3J0cy5sb2FkaW5nID0gdm9pZCAwO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuLi9maXJlYmFzZVwiKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuZnVuY3Rpb24gbG9hZGluZyh0cnVlZmFsc2UpIHtcbiAgICBpZiAodHJ1ZWZhbHNlKSB7XG4gICAgICAgICQoXCIjdG9wICNtZW51IC5hY2NvdW50IC5pY29uXCIpLmh0bWwoJzxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXNwaW4gZmEtY2lyY2xlLW5vdGNoXCI+PC9pPicpO1xuICAgICAgICAkKFwiI3RvcCAjbWVudSAuYWNjb3VudFwiKS5jc3MoXCJvcGFjaXR5XCIsIDEpLmNzcyhcInBvaW50ZXItZXZlbnRzXCIsIFwibm9uZVwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIjdG9wICNtZW51IC5hY2NvdW50IC5pY29uXCIpLmh0bWwoJzxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXVzZXJcIj48L2k+Jyk7XG4gICAgICAgICQoXCIjdG9wICNtZW51IC5hY2NvdW50XCIpLmNzcyhcIm9wYWNpdHlcIiwgMSkuY3NzKFwicG9pbnRlci1ldmVudHNcIiwgXCJhdXRvXCIpO1xuICAgIH1cbn1cbmV4cG9ydHMubG9hZGluZyA9IGxvYWRpbmc7XG5mdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciAhPSBudWxsKSB7XG4gICAgICAgIE1pc2Muc3dhcEVsZW1lbnRzKCQoXCIjbWVudSAuaWNvbi1idXR0b24ubG9naW5cIiksICQoXCIjbWVudSAuaWNvbi1idXR0b24uYWNjb3VudFwiKSwgMjUwKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIE1pc2Muc3dhcEVsZW1lbnRzKCQoXCIjbWVudSAuaWNvbi1idXR0b24uYWNjb3VudFwiKSwgJChcIiNtZW51IC5pY29uLWJ1dHRvbi5sb2dpblwiKSwgMjUwKTtcbiAgICB9XG59XG5leHBvcnRzLnVwZGF0ZSA9IHVwZGF0ZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZ2V0TGlzdCA9IGV4cG9ydHMucHVzaEN1cnJlbnQgPSBleHBvcnRzLnNldEN1cnJlbnQgPSBleHBvcnRzLmRlZmF1bHRDb21tYW5kcyA9IGV4cG9ydHMudXBkYXRlVGhlbWVDb21tYW5kcyA9IGV4cG9ydHMuY29tbWFuZHNDaGFsbGVuZ2VzID0gZXhwb3J0cy50aGVtZUNvbW1hbmRzID0gZXhwb3J0cy51cGRhdGVDdXN0b21UaGVtZUxpc3RDb21tYW5kcyA9IGV4cG9ydHMuY3VzdG9tVGhlbWVMaXN0Q29tbWFuZHMgPSBleHBvcnRzLmN1c3RvbVRoZW1lQ29tbWFuZHMgPSBleHBvcnRzLmNvbW1hbmRzRW5hYmxlQWRzID0gZXhwb3J0cy51cGRhdGVQcmVzZXRDb21tYW5kcyA9IGV4cG9ydHMudXBkYXRlVGFnQ29tbWFuZHMgPSBleHBvcnRzLmNvbW1hbmRzS2V5bWFwTGF5b3V0cyA9IGV4cG9ydHMuY3VycmVudCA9IHZvaWQgMDtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBTb3VuZCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvc291bmQtY29udHJvbGxlclwiKSk7XG5jb25zdCBUaGVtZUNvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL3RoZW1lLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgQ3VzdG9tVGV4dFBvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wb3B1cHMvY3VzdG9tLXRleHQtcG9wdXBcIikpO1xuY29uc3QgTWFudWFsUmVzdGFydCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9tYW51YWwtcmVzdGFydC10cmFja2VyXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpLCBVcGRhdGVDb25maWcgPSBjb25maWdfMTtcbmNvbnN0IFByYWN0aXNlV29yZHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvcHJhY3Rpc2Utd29yZHNcIikpO1xuY29uc3QgVGVzdFVJID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtdWlcIikpO1xuY29uc3QgVGVzdExvZ2ljID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtbG9naWNcIikpO1xuY29uc3QgRnVuYm94ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2Z1bmJveFwiKSk7XG5jb25zdCBUYWdDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy90YWctY29udHJvbGxlclwiKSk7XG5jb25zdCBQcmVzZXRDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9wcmVzZXQtY29udHJvbGxlclwiKSk7XG5jb25zdCBDdXN0b21UZXh0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2N1c3RvbS10ZXh0XCIpKTtcbmNvbnN0IFNldHRpbmdzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wYWdlcy9zZXR0aW5nc1wiKSk7XG5jb25zdCBDaGFsbGVuZ2VDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9jaGFsbGVuZ2UtY29udHJvbGxlclwiKSk7XG5jb25zdCBQYWNlQ2FyZXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvcGFjZS1jYXJldFwiKSk7XG5jb25zdCBUZXN0SW5wdXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC1pbnB1dFwiKSk7XG5jb25zdCBNb2Rlc05vdGljZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbW9kZXMtbm90aWNlXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuLi9maXJlYmFzZVwiKTtcbmV4cG9ydHMuY3VycmVudCA9IFtdO1xuZnVuY3Rpb24gY2FuQmFpbE91dCgpIHtcbiAgICByZXR1cm4gKChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gJiZcbiAgICAgICAgKEN1c3RvbVRleHQud29yZCA+PSA1MDAwIHx8IEN1c3RvbVRleHQud29yZCA9PSAwKSkgfHxcbiAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgIUN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmXG4gICAgICAgICAgICAhQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20gJiZcbiAgICAgICAgICAgIEN1c3RvbVRleHQudGV4dC5sZW5ndGggPj0gNTAwMCkgfHxcbiAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20gJiZcbiAgICAgICAgICAgIChDdXN0b21UZXh0LnRpbWUgPj0gMzYwMCB8fCBDdXN0b21UZXh0LnRpbWUgPT0gMCkpIHx8XG4gICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIiAmJiBjb25maWdfMS5kZWZhdWx0LndvcmRzID49IDUwMDApIHx8XG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQud29yZHMgPT09IDAgfHxcbiAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ0aW1lXCIgJiYgKGNvbmZpZ18xLmRlZmF1bHQudGltZSA+PSAzNjAwIHx8IGNvbmZpZ18xLmRlZmF1bHQudGltZSA9PT0gMCkpIHx8XG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiKTtcbn1cbmNvbnN0IGNvbW1hbmRzTGF5b3V0cyA9IHtcbiAgICB0aXRsZTogXCJMYXlvdXQgZW11bGF0b3IuLi5cIixcbiAgICBjb25maWdLZXk6IFwibGF5b3V0XCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjb3VsZG5vdGxvYWRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQ291bGQgbm90IGxvYWQgdGhlIGxheW91dHMgbGlzdCA6KFwiLFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuTWlzYy5nZXRMYXlvdXRzTGlzdCgpLnRoZW4oKGxheW91dHMpID0+IHtcbiAgICBjb21tYW5kc0xheW91dHMubGlzdCA9IFtdO1xuICAgIGNvbW1hbmRzTGF5b3V0cy5saXN0LnB1c2goe1xuICAgICAgICBpZDogXCJjaGFuZ2VMYXlvdXREZWZhdWx0XCIsXG4gICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgIGNvbmZpZ1ZhbHVlOiBcImRlZmF1bHRcIixcbiAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldExheW91dChcImRlZmF1bHRcIik7XG4gICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICB9LFxuICAgIH0pO1xuICAgIE9iamVjdC5rZXlzKGxheW91dHMpLmZvckVhY2goKGxheW91dCkgPT4ge1xuICAgICAgICBjb21tYW5kc0xheW91dHMubGlzdC5wdXNoKHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUxheW91dFwiICsgTWlzYy5jYXBpdGFsaXplRmlyc3RMZXR0ZXJPZkVhY2hXb3JkKGxheW91dCksXG4gICAgICAgICAgICBkaXNwbGF5OiBsYXlvdXQgPT09IFwiZGVmYXVsdFwiID8gXCJvZmZcIiA6IGxheW91dC5yZXBsYWNlKC9fL2csIFwiIFwiKSxcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBsYXlvdXQsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlQ29uZmlnLnNldFNhdmVkTGF5b3V0KGxheW91dCk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldExheW91dChsYXlvdXQpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuZXhwb3J0cy5jb21tYW5kc0tleW1hcExheW91dHMgPSB7XG4gICAgdGl0bGU6IFwiQ2hhbmdlIGtleW1hcCBsYXlvdXQuLi5cIixcbiAgICBjb25maWdLZXk6IFwia2V5bWFwTGF5b3V0XCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjb3VsZG5vdGxvYWRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQ291bGQgbm90IGxvYWQgdGhlIGxheW91dHMgbGlzdCA6KFwiLFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuTWlzYy5nZXRMYXlvdXRzTGlzdCgpLnRoZW4oKGxheW91dHMpID0+IHtcbiAgICBleHBvcnRzLmNvbW1hbmRzS2V5bWFwTGF5b3V0cy5saXN0ID0gW107XG4gICAgZXhwb3J0cy5jb21tYW5kc0tleW1hcExheW91dHMubGlzdC5wdXNoKHtcbiAgICAgICAgaWQ6IFwiY2hhbmdlS2V5bWFwTGF5b3V0T3ZlcnJpZGVTeW5jXCIsXG4gICAgICAgIGRpc3BsYXk6IFwiZW11bGF0b3Igc3luY1wiLFxuICAgICAgICBjb25maWdWYWx1ZTogXCJvdmVycmlkZVN5bmNcIixcbiAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcExheW91dChcIm92ZXJyaWRlU3luY1wiKTtcbiAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgIH0sXG4gICAgfSk7XG4gICAgT2JqZWN0LmtleXMobGF5b3V0cykuZm9yRWFjaCgobGF5b3V0KSA9PiB7XG4gICAgICAgIGlmIChsYXlvdXQudG9TdHJpbmcoKSAhPSBcImRlZmF1bHRcIikge1xuICAgICAgICAgICAgZXhwb3J0cy5jb21tYW5kc0tleW1hcExheW91dHMubGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgICBpZDogXCJjaGFuZ2VLZXltYXBMYXlvdXRcIiArIE1pc2MuY2FwaXRhbGl6ZUZpcnN0TGV0dGVyT2ZFYWNoV29yZChsYXlvdXQpLFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IGxheW91dC5yZXBsYWNlKC9fL2csIFwiIFwiKSxcbiAgICAgICAgICAgICAgICBjb25maWdWYWx1ZTogbGF5b3V0LFxuICAgICAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcExheW91dChsYXlvdXQpO1xuICAgICAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xufSk7XG5jb25zdCBjb21tYW5kc0xhbmd1YWdlcyA9IHtcbiAgICB0aXRsZTogXCJMYW5ndWFnZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJsYW5ndWFnZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY291bGRub3Rsb2FkXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkNvdWxkIG5vdCBsb2FkIHRoZSBsYW5ndWFnZXMgbGlzdCA6KFwiLFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29tbWFuZHNMYW5ndWFnZXMubGlzdCA9IFtdO1xuTWlzYy5nZXRMYW5ndWFnZUxpc3QoKS50aGVuKChsYW5ndWFnZXMpID0+IHtcbiAgICBsYW5ndWFnZXMuZm9yRWFjaCgobGFuZ3VhZ2UpID0+IHtcbiAgICAgICAgY29tbWFuZHNMYW5ndWFnZXMubGlzdC5wdXNoKHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUxhbmd1YWdlXCIgKyBNaXNjLmNhcGl0YWxpemVGaXJzdExldHRlck9mRWFjaFdvcmQobGFuZ3VhZ2UpLFxuICAgICAgICAgICAgZGlzcGxheTogbGFuZ3VhZ2UucmVwbGFjZSgvXy9nLCBcIiBcIiksXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogbGFuZ3VhZ2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldExhbmd1YWdlKGxhbmd1YWdlKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbmNvbnN0IGNvbW1hbmRzRnVuYm94ID0ge1xuICAgIHRpdGxlOiBcIkZ1bmJveC4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJmdW5ib3hcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUZ1bmJveE5vbmVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibm9uZVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwibm9uZVwiLFxuICAgICAgICAgICAgYWxpYXM6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKEZ1bmJveC5zZXRGdW5ib3goXCJub25lXCIsIG51bGwpKSB7XG4gICAgICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbk1pc2MuZ2V0RnVuYm94TGlzdCgpLnRoZW4oKGZ1bmJveGVzKSA9PiB7XG4gICAgZnVuYm94ZXMuZm9yRWFjaCgoZnVuYm94KSA9PiB7XG4gICAgICAgIGNvbW1hbmRzRnVuYm94Lmxpc3QucHVzaCh7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VGdW5ib3hcIiArIGZ1bmJveC5uYW1lLFxuICAgICAgICAgICAgZGlzcGxheTogZnVuYm94Lm5hbWUucmVwbGFjZSgvXy9nLCBcIiBcIiksXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZnVuYm94Lm5hbWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKEZ1bmJveC5zZXRGdW5ib3goZnVuYm94Lm5hbWUsIGZ1bmJveC50eXBlKSkge1xuICAgICAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG5jb25zdCBjb21tYW5kc0ZvbnRzID0ge1xuICAgIHRpdGxlOiBcIkZvbnQgZmFtaWx5Li4uXCIsXG4gICAgY29uZmlnS2V5OiBcImZvbnRGYW1pbHlcIixcbiAgICBsaXN0OiBbXSxcbn07XG5NaXNjLmdldEZvbnRzTGlzdCgpLnRoZW4oKGZvbnRzKSA9PiB7XG4gICAgZm9udHMuZm9yRWFjaCgoZm9udCkgPT4ge1xuICAgICAgICBjb21tYW5kc0ZvbnRzLmxpc3QucHVzaCh7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VGb250XCIgKyBmb250Lm5hbWUucmVwbGFjZSgvIC9nLCBcIl9cIiksXG4gICAgICAgICAgICBkaXNwbGF5OiBmb250LmRpc3BsYXkgIT09IHVuZGVmaW5lZCA/IGZvbnQuZGlzcGxheSA6IGZvbnQubmFtZSxcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmb250Lm5hbWUsXG4gICAgICAgICAgICBob3ZlcjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5wcmV2aWV3Rm9udEZhbWlseShmb250Lm5hbWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Rm9udEZhbWlseShmb250Lm5hbWUucmVwbGFjZSgvIC9nLCBcIl9cIikpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgY29tbWFuZHNGb250cy5saXN0LnB1c2goe1xuICAgICAgICBpZDogXCJzZXRGb250RmFtaWx5Q3VzdG9tXCIsXG4gICAgICAgIGRpc3BsYXk6IFwiY3VzdG9tLi4uXCIsXG4gICAgICAgIGlucHV0OiB0cnVlLFxuICAgICAgICBob3ZlcjogKCkgPT4ge1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnByZXZpZXdGb250RmFtaWx5KGNvbmZpZ18xLmRlZmF1bHQuZm9udEZhbWlseSk7XG4gICAgICAgIH0sXG4gICAgICAgIGV4ZWM6IChuYW1lKSA9PiB7XG4gICAgICAgICAgICBpZiAoIW5hbWUpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZvbnRGYW1pbHkobmFtZS5yZXBsYWNlKC9cXHMvZywgXCJfXCIpKTtcbiAgICAgICAgICAgIC8vIFNldHRpbmdzLmdyb3Vwcy5mb250RmFtaWx5LnVwZGF0ZUlucHV0KCk7XG4gICAgICAgIH0sXG4gICAgfSk7XG59KTtcbmNvbnN0IGNvbW1hbmRzVGFncyA9IHtcbiAgICB0aXRsZTogXCJDaGFuZ2UgdGFncy4uLlwiLFxuICAgIGxpc3Q6IFtdLFxufTtcbmZ1bmN0aW9uIHVwZGF0ZVRhZ0NvbW1hbmRzKCkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICBpZiAoKF9jID0gKF9iID0gKF9hID0gREIuZ2V0U25hcHNob3QoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRhZ3MpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5sZW5ndGgpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IDAgPiAwKSB7XG4gICAgICAgIGNvbW1hbmRzVGFncy5saXN0ID0gW107XG4gICAgICAgIGNvbW1hbmRzVGFncy5saXN0LnB1c2goe1xuICAgICAgICAgICAgaWQ6IFwiY2xlYXJUYWdzXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBgQ2xlYXIgdGFnc2AsXG4gICAgICAgICAgICBpY29uOiBcImZhLXRpbWVzXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNuYXBzaG90ID0gREIuZ2V0U25hcHNob3QoKTtcbiAgICAgICAgICAgICAgICBzbmFwc2hvdC50YWdzID0gKF9hID0gc25hcHNob3QudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1hcCgodGFnKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRhZy5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRhZztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBEQi5zZXRTbmFwc2hvdChzbmFwc2hvdCk7XG4gICAgICAgICAgICAgICAgTW9kZXNOb3RpY2UudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgVGFnQ29udHJvbGxlci5zYXZlQWN0aXZlVG9Mb2NhbFN0b3JhZ2UoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgICAoX2QgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgIGxldCBkaXMgPSB0YWcubmFtZTtcbiAgICAgICAgICAgIGlmICh0YWcuYWN0aXZlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZGlzID0gJzxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWNoZWNrXCI+PC9pPicgKyBkaXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBkaXMgPSAnPGkgY2xhc3M9XCJmYXMgZmEtZndcIj48L2k+JyArIGRpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbW1hbmRzVGFncy5saXN0LnB1c2goe1xuICAgICAgICAgICAgICAgIGlkOiBcInRvZ2dsZVRhZ1wiICsgdGFnLl9pZCxcbiAgICAgICAgICAgICAgICBub0ljb246IHRydWUsXG4gICAgICAgICAgICAgICAgZGlzcGxheTogZGlzLFxuICAgICAgICAgICAgICAgIHN0aWNreTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIFRhZ0NvbnRyb2xsZXIudG9nZ2xlKHRhZy5faWQpO1xuICAgICAgICAgICAgICAgICAgICBNb2Rlc05vdGljZS51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucGFjZUNhcmV0ID09PSBcImF2ZXJhZ2VcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgUGFjZUNhcmV0LmluaXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIE1vZGVzTm90aWNlLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGxldCB0eHQgPSB0YWcubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhZy5hY3RpdmUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR4dCA9ICc8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1jaGVja1wiPjwvaT4nICsgdHh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHh0ID0gJzxpIGNsYXNzPVwiZmFzIGZhLWZ3XCI+PC9pPicgKyB0eHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCQoXCIjY29tbWFuZExpbmVcIikuaGFzQ2xhc3MoXCJhbGxDb21tYW5kc1wiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJChgI2NvbW1hbmRMaW5lIC5zdWdnZXN0aW9ucyAuZW50cnlbY29tbWFuZD0ndG9nZ2xlVGFnJHt0YWcuX2lkfSddYCkuaHRtbChgPGRpdiBjbGFzcz1cImljb25cIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS10YWdcIj48L2k+PC9kaXY+PGRpdj5UYWdzICA+IGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKGAjY29tbWFuZExpbmUgLnN1Z2dlc3Rpb25zIC5lbnRyeVtjb21tYW5kPSd0b2dnbGVUYWcke3RhZy5faWR9J11gKS5odG1sKHR4dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBkZWZhdWx0Q29tbWFuZHMubGlzdFs0XS52aXNpYmxlID0gdHJ1ZTtcbiAgICB9XG59XG5leHBvcnRzLnVwZGF0ZVRhZ0NvbW1hbmRzID0gdXBkYXRlVGFnQ29tbWFuZHM7XG5jb25zdCBjb21tYW5kc1ByZXNldHMgPSB7XG4gICAgdGl0bGU6IFwiUHJlc2V0cy4uLlwiLFxuICAgIGxpc3Q6IFtdLFxufTtcbmZ1bmN0aW9uIHVwZGF0ZVByZXNldENvbW1hbmRzKCkge1xuICAgIGNvbnN0IHNuYXBzaG90ID0gREIuZ2V0U25hcHNob3QoKTtcbiAgICBpZiAoIXNuYXBzaG90IHx8ICFzbmFwc2hvdC5wcmVzZXRzIHx8IHNuYXBzaG90LnByZXNldHMubGVuZ3RoID09PSAwKVxuICAgICAgICByZXR1cm47XG4gICAgY29tbWFuZHNQcmVzZXRzLmxpc3QgPSBbXTtcbiAgICBzbmFwc2hvdC5wcmVzZXRzLmZvckVhY2goKHByZXNldCkgPT4ge1xuICAgICAgICBjb25zdCBkaXMgPSBwcmVzZXQubmFtZTtcbiAgICAgICAgY29tbWFuZHNQcmVzZXRzLmxpc3QucHVzaCh7XG4gICAgICAgICAgICBpZDogXCJhcHBseVByZXNldFwiICsgcHJlc2V0Ll9pZCxcbiAgICAgICAgICAgIGRpc3BsYXk6IGRpcyxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBTZXR0aW5ncy5zZXRFdmVudERpc2FibGVkKHRydWUpO1xuICAgICAgICAgICAgICAgIFByZXNldENvbnRyb2xsZXIuYXBwbHkocHJlc2V0Ll9pZCk7XG4gICAgICAgICAgICAgICAgU2V0dGluZ3Muc2V0RXZlbnREaXNhYmxlZChmYWxzZSk7XG4gICAgICAgICAgICAgICAgU2V0dGluZ3MudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgTW9kZXNOb3RpY2UudXBkYXRlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMudXBkYXRlUHJlc2V0Q29tbWFuZHMgPSB1cGRhdGVQcmVzZXRDb21tYW5kcztcbmNvbnN0IGNvbW1hbmRzUmVwZWF0UXVvdGVzID0ge1xuICAgIHRpdGxlOiBcIlJlcGVhdCBxdW90ZXMuLi5cIixcbiAgICBjb25maWdLZXk6IFwicmVwZWF0UXVvdGVzXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRSZXBlYXRRdW90ZXNPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UmVwZWF0UXVvdGVzKFwib2ZmXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UmVwZWF0UXVvdGVzVHlwaW5nXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInR5cGluZ1wiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwidHlwaW5nXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFJlcGVhdFF1b3RlcyhcInR5cGluZ1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0xpdmVXcG0gPSB7XG4gICAgdGl0bGU6IFwiTGl2ZSBXUE0uLi5cIixcbiAgICBjb25maWdLZXk6IFwic2hvd0xpdmVXcG1cIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldExpdmVXcG1PZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNob3dMaXZlV3BtKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldExpdmVXcG1PblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNob3dMaXZlV3BtKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzU2hvd0F2ZXJhZ2UgPSB7XG4gICAgdGl0bGU6IFwiU2hvdyBhdmVyYWdlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInNob3dBdmVyYWdlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTaG93QXZlcmFnZU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaG93QXZlcmFnZShcIm9mZlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNob3dBdmVyYWdlU3BlZWRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwid3BtXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJ3cG1cIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2hvd0F2ZXJhZ2UoXCJ3cG1cIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTaG93QXZlcmFnZUFjY1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJhY2N1cmFjeVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiYWNjXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNob3dBdmVyYWdlKFwiYWNjXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U2hvd0F2ZXJhZ2VCb3RoXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImJvdGhcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImJvdGhcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2hvd0F2ZXJhZ2UoXCJib3RoXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzTGl2ZUFjYyA9IHtcbiAgICB0aXRsZTogXCJMaXZlIGFjY3VyYWN5Li4uXCIsXG4gICAgY29uZmlnS2V5OiBcInNob3dMaXZlQWNjXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRMaXZlQWNjT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaG93TGl2ZUFjYyhmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRMaXZlQWNjT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaG93TGl2ZUFjYyh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0xpdmVCdXJzdCA9IHtcbiAgICB0aXRsZTogXCJMaXZlIGJ1cnN0Li4uXCIsXG4gICAgY29uZmlnS2V5OiBcInNob3dMaXZlQnVyc3RcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldExpdmVCdXJzdE9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2hvd0xpdmVCdXJzdChmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRMaXZlQnVyc3RPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNob3dMaXZlQnVyc3QodHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNTaG93VGltZXIgPSB7XG4gICAgdGl0bGU6IFwiVGltZXIvcHJvZ3Jlc3MuLi5cIixcbiAgICBjb25maWdLZXk6IFwic2hvd1RpbWVyUHJvZ3Jlc3NcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFRpbWVyUHJvZ3Jlc3NPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNob3dUaW1lclByb2dyZXNzKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFRpbWVyUHJvZ3Jlc3NPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNob3dUaW1lclByb2dyZXNzKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzS2V5VGlwcyA9IHtcbiAgICB0aXRsZTogXCJLZXkgdGlwcy4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJzaG93S2V5VGlwc1wiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0S2V5VGlwc09mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5VGlwcyhmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRLZXlUaXBzT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXlUaXBzKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzRnJlZWRvbU1vZGUgPSB7XG4gICAgdGl0bGU6IFwiRnJlZWRvbSBtb2RlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImZyZWVkb21Nb2RlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRmcmVlZG9tTW9kZU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RnJlZWRvbU1vZGUoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0ZnJlZWRvbU1vZGVPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZyZWVkb21Nb2RlKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzU3RyaWN0U3BhY2UgPSB7XG4gICAgdGl0bGU6IFwiU3RyaWN0IHNwYWNlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInN0cmljdFNwYWNlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTdHJpY3RTcGFjZU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U3RyaWN0U3BhY2UoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U3RyaWN0U3BhY2VPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFN0cmljdFNwYWNlKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzQmxpbmRNb2RlID0ge1xuICAgIHRpdGxlOiBcIkJsaW5kIG1vZGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwiYmxpbmRNb2RlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRCbGluZE1vZGVPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEJsaW5kTW9kZShmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRCbGluZE1vZGVPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEJsaW5kTW9kZSh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1Nob3dXb3Jkc0hpc3RvcnkgPSB7XG4gICAgdGl0bGU6IFwiQWx3YXlzIHNob3cgd29yZHMgaGlzdG9yeS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJhbHdheXNTaG93V29yZHNIaXN0b3J5XCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRBbHdheXNTaG93V29yZHNIaXN0b3J5T2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRBbHdheXNTaG93V29yZHNIaXN0b3J5KGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEFsd2F5c1Nob3dXb3Jkc0hpc3RvcnlPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEFsd2F5c1Nob3dXb3Jkc0hpc3RvcnkodHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNJbmRpY2F0ZVR5cG9zID0ge1xuICAgIHRpdGxlOiBcIkluZGljYXRlIHR5cG9zLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImluZGljYXRlVHlwb3NcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEluZGljYXRlVHlwb3NPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0SW5kaWNhdGVUeXBvcyhcIm9mZlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEluZGljYXRlVHlwb3NCZWxvd1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJiZWxvd1wiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiYmVsb3dcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0SW5kaWNhdGVUeXBvcyhcImJlbG93XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0SW5kaWNhdGVUeXBvc1JlcGxhY2VcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwicmVwbGFjZVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwicmVwbGFjZVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRJbmRpY2F0ZVR5cG9zKFwicmVwbGFjZVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0hpZGVFeHRyYUxldHRlcnMgPSB7XG4gICAgdGl0bGU6IFwiSGlkZSBleHRyYSBsZXR0ZXJzLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImhpZGVFeHRyYUxldHRlcnNcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEhpZGVFeHRyYUxldHRlcnNPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEhpZGVFeHRyYUxldHRlcnMoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0SGlkZUV4dHJhTGV0dGVyc09uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0SGlkZUV4dHJhTGV0dGVycyh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1F1aWNrRW5kID0ge1xuICAgIHRpdGxlOiBcIlF1aWNrIGVuZC4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJxdWlja0VuZFwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UXVpY2tFbmRPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFF1aWNrRW5kKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFF1aWNrRW5kT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRRdWlja0VuZCh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc09wcG9zaXRlU2hpZnRNb2RlID0ge1xuICAgIHRpdGxlOiBcIkNoYW5nZSBvcHBvc2l0ZSBzaGlmdCBtb2RlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcIm9wcG9zaXRlU2hpZnRNb2RlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRPcHBvc2l0ZVNoaWZ0TW9kZU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRPcHBvc2l0ZVNoaWZ0TW9kZShcIm9mZlwiKTtcbiAgICAgICAgICAgICAgICBNb2Rlc05vdGljZS51cGRhdGUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldE9wcG9zaXRlU2hpZnRNb2RlT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9uXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE9wcG9zaXRlU2hpZnRNb2RlKFwib25cIik7XG4gICAgICAgICAgICAgICAgTW9kZXNOb3RpY2UudXBkYXRlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRPcHBvc2l0ZVNoaWZ0TW9kZUtleW1hcFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJrZXltYXBcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImtleW1hcFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRPcHBvc2l0ZVNoaWZ0TW9kZShcImtleW1hcFwiKTtcbiAgICAgICAgICAgICAgICBNb2Rlc05vdGljZS51cGRhdGUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1NvdW5kT25FcnJvciA9IHtcbiAgICB0aXRsZTogXCJTb3VuZCBvbiBlcnJvci4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJwbGF5U291bmRPbkVycm9yXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRQbGF5U291bmRPbkVycm9yT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQbGF5U291bmRPbkVycm9yKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFBsYXlTb3VuZE9uRXJyb3JPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBsYXlTb3VuZE9uRXJyb3IodHJ1ZSk7XG4gICAgICAgICAgICAgICAgU291bmQucGxheUVycm9yKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNTb3VuZFZvbHVtZSA9IHtcbiAgICB0aXRsZTogXCJTb3VuZCB2b2x1bWUuLi5cIixcbiAgICBjb25maWdLZXk6IFwic291bmRWb2x1bWVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNvdW5kVm9sdW1lMC4xXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInF1aWV0XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCIwLjFcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U291bmRWb2x1bWUoXCIwLjFcIik7XG4gICAgICAgICAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTb3VuZFZvbHVtZTAuNVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJtZWRpdW1cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjAuNVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTb3VuZFZvbHVtZShcIjAuNVwiKTtcbiAgICAgICAgICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNvdW5kVm9sdW1lMS4wXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImxvdWRcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjEuMFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTb3VuZFZvbHVtZShcIjEuMFwiKTtcbiAgICAgICAgICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0ZsaXBUZXN0Q29sb3JzID0ge1xuICAgIHRpdGxlOiBcIkZsaXAgdGVzdCBjb2xvcnMuLi5cIixcbiAgICBjb25maWdLZXk6IFwiZmxpcFRlc3RDb2xvcnNcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEZsaXBUZXN0Q29sb3JzT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGbGlwVGVzdENvbG9ycyhmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRGbGlwVGVzdENvbG9yc09uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RmxpcFRlc3RDb2xvcnModHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNTbW9vdGhMaW5lU2Nyb2xsID0ge1xuICAgIHRpdGxlOiBcIlNtb290aCBsaW5lIHNjcm9sbC4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJzbW9vdGhMaW5lU2Nyb2xsXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTbW9vdGhMaW5lU2Nyb2xsT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTbW9vdGhMaW5lU2Nyb2xsKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNtb290aExpbmVTY3JvbGxPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNtb290aExpbmVTY3JvbGwodHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNBbHdheXNTaG93RGVjaW1hbCA9IHtcbiAgICB0aXRsZTogXCJBbHdheXMgc2hvdyBkZWNpbWFsIHBsYWNlcy4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJhbHdheXNTaG93RGVjaW1hbFBsYWNlc1wiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0QWx3YXlzU2hvd0RlY2ltYWxQbGFjZXNPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRBbHdheXNTaG93RGVjaW1hbFBsYWNlcyh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0Fsd2F5c1Nob3dDUE0gPSB7XG4gICAgdGl0bGU6IFwiQWx3YXlzIHNob3cgQ1BNLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImFsd2F5c1Nob3dDUE1cIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEFsd2F5c1Nob3dDUE1PZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEFsd2F5c1Nob3dDUE0oZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0QWx3YXlzU2hvd0NQTU9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0QWx3YXlzU2hvd0NQTSh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1N0YXJ0R3JhcGhzQXRaZXJvID0ge1xuICAgIHRpdGxlOiBcIlN0YXJ0IGdyYXBocyBhdCB6ZXJvLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInN0YXJ0R3JhcGhzQXRaZXJvXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTdGFydEdyYXBoc0F0WmVyb09mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U3RhcnRHcmFwaHNBdFplcm8oZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U3RhcnRHcmFwaHNBdFplcm9PblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFN0YXJ0R3JhcGhzQXRaZXJvKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzTGF6eU1vZGUgPSB7XG4gICAgdGl0bGU6IFwiTGF6eSBtb2RlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImxhenlNb2RlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRMYXp5TW9kZU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TGF6eU1vZGUoZmFsc2UpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRMYXp5TW9kZU9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TGF6eU1vZGUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1N3YXBFc2NBbmRUYWIgPSB7XG4gICAgdGl0bGU6IFwiU3dhcCBlc2MgYW5kIHRhYi4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJzd2FwRXNjQW5kVGFiXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTd2FwRXNjQW5kVGFiT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTd2FwRXNjQW5kVGFiKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFN3YXBFc2NBbmRUYWJPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFN3YXBFc2NBbmRUYWIodHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNTaG93QWxsTGluZXMgPSB7XG4gICAgdGl0bGU6IFwiU2hvdyBhbGwgbGluZXMuLi5cIixcbiAgICBjb25maWdLZXk6IFwic2hvd0FsbExpbmVzXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTaG93QWxsTGluZXNPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNob3dBbGxMaW5lcyhmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTaG93QWxsTGluZXNPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNob3dBbGxMaW5lcyh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0NvbG9yZnVsTW9kZSA9IHtcbiAgICB0aXRsZTogXCJDb2xvcmZ1bCBtb2RlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImNvbG9yZnVsTW9kZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0Q29sb3JmdWxNb2RlT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDb2xvcmZ1bE1vZGUoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0Q29sb3JmdWxNb2RlT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDb2xvcmZ1bE1vZGUodHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNPdXRPZkZvY3VzV2FybmluZyA9IHtcbiAgICB0aXRsZTogXCJDb2xvcmZ1bCBtb2RlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInNob3dPdXRPZkZvY3VzV2FybmluZ1wiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U2hvd091dE9mRm9jdXNXYXJuaW5nT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaG93T3V0T2ZGb2N1c1dhcm5pbmcoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U2hvd091dE9mRm9jdXNXYXJuaW5nT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaG93T3V0T2ZGb2N1c1dhcm5pbmcodHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNLZXltYXBNb2RlID0ge1xuICAgIHRpdGxlOiBcIktleW1hcCBtb2RlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImtleW1hcE1vZGVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEtleW1hcE1vZGVPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTW9kZShcIm9mZlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEtleW1hcE1vZGVTdGF0aWNcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwic3RhdGljXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJzdGF0aWNcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTW9kZShcInN0YXRpY1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEtleW1hcE1vZGVOZXh0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm5leHRcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm5leHRcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTW9kZShcIm5leHRcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRLZXltYXBNb2RlUmVhY3RcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwicmVhY3RcIixcbiAgICAgICAgICAgIGFsaWFzOiBcImZsYXNoXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJyZWFjdFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBNb2RlKFwicmVhY3RcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNTb3VuZE9uQ2xpY2sgPSB7XG4gICAgdGl0bGU6IFwiU291bmQgb24gY2xpY2suLi5cIixcbiAgICBjb25maWdLZXk6IFwicGxheVNvdW5kT25DbGlja1wiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U291bmRPbkNsaWNrT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBsYXlTb3VuZE9uQ2xpY2soXCJvZmZcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTb3VuZE9uQ2xpY2sxXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImNsaWNrXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCIxXCIsXG4gICAgICAgICAgICBob3ZlcjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFNvdW5kLnByZXZpZXdDbGljayhcIjFcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQbGF5U291bmRPbkNsaWNrKFwiMVwiKTtcbiAgICAgICAgICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNvdW5kT25DbGljazJcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiYmVlcFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiMlwiLFxuICAgICAgICAgICAgaG92ZXI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBTb3VuZC5wcmV2aWV3Q2xpY2soXCIyXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGxheVNvdW5kT25DbGljayhcIjJcIik7XG4gICAgICAgICAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTb3VuZE9uQ2xpY2szXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInBvcFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiM1wiLFxuICAgICAgICAgICAgaG92ZXI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBTb3VuZC5wcmV2aWV3Q2xpY2soXCIzXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGxheVNvdW5kT25DbGljayhcIjNcIik7XG4gICAgICAgICAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTb3VuZE9uQ2xpY2s0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm5rIGNyZWFtc1wiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiNFwiLFxuICAgICAgICAgICAgaG92ZXI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBTb3VuZC5wcmV2aWV3Q2xpY2soXCI0XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGxheVNvdW5kT25DbGljayhcIjRcIik7XG4gICAgICAgICAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTb3VuZE9uQ2xpY2s1XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInR5cGV3cml0ZXJcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjVcIixcbiAgICAgICAgICAgIGhvdmVyOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgU291bmQucHJldmlld0NsaWNrKFwiNVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBsYXlTb3VuZE9uQ2xpY2soXCI1XCIpO1xuICAgICAgICAgICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U291bmRPbkNsaWNrNlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvc3VcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjZcIixcbiAgICAgICAgICAgIGhvdmVyOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgU291bmQucHJldmlld0NsaWNrKFwiNlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBsYXlTb3VuZE9uQ2xpY2soXCI2XCIpO1xuICAgICAgICAgICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U291bmRPbkNsaWNrN1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJoaXRtYXJrZXJcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjdcIixcbiAgICAgICAgICAgIGhvdmVyOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgU291bmQucHJldmlld0NsaWNrKFwiN1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBsYXlTb3VuZE9uQ2xpY2soXCI3XCIpO1xuICAgICAgICAgICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzUmFuZG9tVGhlbWUgPSB7XG4gICAgdGl0bGU6IFwiUmFuZG9tIHRoZW1lLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInJhbmRvbVRoZW1lXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRSYW5kb21PZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UmFuZG9tVGhlbWUoXCJvZmZcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRSYW5kb21PblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib25cIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UmFuZG9tVGhlbWUoXCJvblwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFJhbmRvbUZhdlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJmYXZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImZhdlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRSYW5kb21UaGVtZShcImZhdlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFJhbmRvbUxpZ2h0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImxpZ2h0XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJsaWdodFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRSYW5kb21UaGVtZShcImxpZ2h0XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UmFuZG9tRGFya1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJkYXJrXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJkYXJrXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFJhbmRvbVRoZW1lKFwiZGFya1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFJhbmRvbUN1c3RvbVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJjdXN0b21cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImN1c3RvbVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJNdWx0aXBsZSBjdXN0b20gdGhlbWVzIGFyZSBhdmFpbGFibGUgdG8gbG9nZ2VkIGluIHVzZXJzIG9ubHlcIiwgMCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFJhbmRvbVRoZW1lKFwiY3VzdG9tXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzRGlmZmljdWx0eSA9IHtcbiAgICB0aXRsZTogXCJEaWZmaWN1bHR5Li4uXCIsXG4gICAgY29uZmlnS2V5OiBcImRpZmZpY3VsdHlcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldERpZmZpY3VsdHlOb3JtYWxcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibm9ybWFsXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJub3JtYWxcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RGlmZmljdWx0eShcIm5vcm1hbFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldERpZmZpY3VsdHlFeHBlcnRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiZXhwZXJ0XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJleHBlcnRcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RGlmZmljdWx0eShcImV4cGVydFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldERpZmZpY3VsdHlNYXN0ZXJcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibWFzdGVyXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJtYXN0ZXJcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RGlmZmljdWx0eShcIm1hc3RlclwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5leHBvcnRzLmNvbW1hbmRzRW5hYmxlQWRzID0ge1xuICAgIHRpdGxlOiBcIlNldCBlbmFibGUgYWRzLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImVuYWJsZUFkc1wiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0RW5hYmxlQWRzT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEVuYWJsZUFkcyhcIm9mZlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEVuYWJsZUFkc09uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvblwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRFbmFibGVBZHMoXCJvblwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEVuYWJsZU1heFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJzZWxsb3V0XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJtYXhcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RW5hYmxlQWRzKFwibWF4XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmV4cG9ydHMuY3VzdG9tVGhlbWVDb21tYW5kcyA9IHtcbiAgICB0aXRsZTogXCJDdXN0b20gdGhlbWVcIixcbiAgICBjb25maWdLZXk6IFwiY3VzdG9tVGhlbWVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEN1c3RvbVRoZW1lT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZShmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRDdXN0b21UaGVtZU9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWUodHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuZXhwb3J0cy5jdXN0b21UaGVtZUxpc3RDb21tYW5kcyA9IHtcbiAgICB0aXRsZTogXCJDdXN0b20gdGhlbWVzIGxpc3QuLi5cIixcbiAgICAvLyBjb25maWdLZXk6IFwiY3VzdG9tVGhlbWVJZFwiLFxuICAgIGxpc3Q6IFtdLFxufTtcbmZ1bmN0aW9uIHVwZGF0ZUN1c3RvbVRoZW1lTGlzdENvbW1hbmRzKCkge1xuICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBleHBvcnRzLmN1c3RvbVRoZW1lTGlzdENvbW1hbmRzLmxpc3QgPSBbXTtcbiAgICBjb25zdCBzbmFwc2hvdCA9IERCLmdldFNuYXBzaG90KCk7XG4gICAgaWYgKCFzbmFwc2hvdClcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChEQi5nZXRTbmFwc2hvdCgpLmN1c3RvbVRoZW1lcy5sZW5ndGggPCAwKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiWW91IG5lZWQgdG8gY3JlYXRlIGEgY3VzdG9tIHRoZW1lIGZpcnN0XCIsIDApO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIERCLmdldFNuYXBzaG90KCkuY3VzdG9tVGhlbWVzLmZvckVhY2goKHRoZW1lKSA9PiB7XG4gICAgICAgIGV4cG9ydHMuY3VzdG9tVGhlbWVMaXN0Q29tbWFuZHMubGlzdC5wdXNoKHtcbiAgICAgICAgICAgIGlkOiBcInNldEN1c3RvbVRoZW1lSWRcIiArIHRoZW1lLl9pZCxcbiAgICAgICAgICAgIGRpc3BsYXk6IHRoZW1lLm5hbWUsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdGhlbWUuX2lkLFxuICAgICAgICAgICAgaG92ZXI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBUaGVtZUNvbnRyb2xsZXIucHJldmlldyh0aGVtZS5faWQsIHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWVJZCh0aGVtZS5faWQpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZSh0cnVlKTtcbiAgICAgICAgICAgICAgICBUaGVtZUNvbnRyb2xsZXIuc2V0KHRoZW1lLl9pZCwgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICByZXR1cm47XG59XG5leHBvcnRzLnVwZGF0ZUN1c3RvbVRoZW1lTGlzdENvbW1hbmRzID0gdXBkYXRlQ3VzdG9tVGhlbWVMaXN0Q29tbWFuZHM7XG5jb25zdCBjb21tYW5kc0NhcmV0U3R5bGUgPSB7XG4gICAgdGl0bGU6IFwiQ2hhbmdlIGNhcmV0IHN0eWxlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImNhcmV0U3R5bGVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldENhcmV0U3R5bGVPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q2FyZXRTdHlsZShcIm9mZlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldENhcmV0U3R5bGVEZWZhdWx0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImxpbmVcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImRlZmF1bHRcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q2FyZXRTdHlsZShcImRlZmF1bHRcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRDYXJldFN0eWxlQmxvY2tcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiYmxvY2tcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImJsb2NrXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldENhcmV0U3R5bGUoXCJibG9ja1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldENhcmV0U3R5bGVPdXRsaW5lXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm91dGxpbmUtYmxvY2tcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm91dGxpbmVcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q2FyZXRTdHlsZShcIm91dGxpbmVcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRDYXJldFN0eWxlVW5kZXJsaW5lXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInVuZGVybGluZVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwidW5kZXJsaW5lXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldENhcmV0U3R5bGUoXCJ1bmRlcmxpbmVcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRDYXJldFN0eWxlQ2Fycm90XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImNhcnJvdFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiY2Fycm90XCIsXG4gICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q2FyZXRTdHlsZShcImNhcnJvdFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldENhcmV0U3R5bGVCYW5hbmFcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiYmFuYW5hXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJiYW5hbmFcIixcbiAgICAgICAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDYXJldFN0eWxlKFwiYmFuYW5hXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzUGFjZUNhcmV0U3R5bGUgPSB7XG4gICAgdGl0bGU6IFwiQ2hhbmdlIHBhY2UgY2FyZXQgc3R5bGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwicGFjZUNhcmV0U3R5bGVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFBhY2VDYXJldFN0eWxlRGVmYXVsdFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJsaW5lXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJkZWZhdWx0XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBhY2VDYXJldFN0eWxlKFwiZGVmYXVsdFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFBhY2VDYXJldFN0eWxlQmxvY2tcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiYmxvY2tcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImJsb2NrXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBhY2VDYXJldFN0eWxlKFwiYmxvY2tcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRQYWNlQ2FyZXRTdHlsZU91dGxpbmVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib3V0bGluZS1ibG9ja1wiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib3V0bGluZVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWNlQ2FyZXRTdHlsZShcIm91dGxpbmVcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRQYWNlQ2FyZXRTdHlsZVVuZGVybGluZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJ1bmRlcmxpbmVcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcInVuZGVybGluZVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWNlQ2FyZXRTdHlsZShcInVuZGVybGluZVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFBhY2VDYXJldFN0eWxlQ2Fycm90XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImNhcnJvdFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiY2Fycm90XCIsXG4gICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGFjZUNhcmV0U3R5bGUoXCJjYXJyb3RcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRQYWNlQ2FyZXRTdHlsZUJhbmFuYVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJiYW5hbmFcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImJhbmFuYVwiLFxuICAgICAgICAgICAgdmlzaWJsZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBhY2VDYXJldFN0eWxlKFwiYmFuYW5hXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzUmVwZWF0ZWRQYWNlID0ge1xuICAgIHRpdGxlOiBcIlJlcGVhdGVkIHBhY2UuLi5cIixcbiAgICBjb25maWdLZXk6IFwicmVwZWF0ZWRQYWNlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRSZXBlYXRlZFBhY2VPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFJlcGVhdGVkUGFjZShmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRSZXBlYXRlZFBhY2VPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFJlcGVhdGVkUGFjZSh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1BhY2VDYXJldCA9IHtcbiAgICB0aXRsZTogXCJQYWNlIGNhcmV0IG1vZGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwicGFjZUNhcmV0XCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRQYWNlQ2FyZXRPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGFjZUNhcmV0KFwib2ZmXCIpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRQYWNlQ2FyZXRQYlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJwYlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwicGJcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGFjZUNhcmV0KFwicGJcIik7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFBhY2VDYXJldEF2ZXJhZ2VcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiYXZlcmFnZVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiYXZlcmFnZVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWNlQ2FyZXQoXCJhdmVyYWdlXCIpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRQYWNlQ2FyZXRDdXN0b21cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiY3VzdG9tLi4uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJjdXN0b21cIixcbiAgICAgICAgICAgIGlucHV0OiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKGlucHV0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFpbnB1dClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWNlQ2FyZXRDdXN0b21TcGVlZChwYXJzZUludChpbnB1dCkpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWNlQ2FyZXQoXCJjdXN0b21cIik7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc01pbldwbSA9IHtcbiAgICB0aXRsZTogXCJDaGFuZ2UgbWluIHdwbSBtb2RlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcIm1pbldwbVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0TWluV3BtT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1pbldwbShcIm9mZlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldE1pbldwbUN1c3RvbVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJjdXN0b20uLi5cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImN1c3RvbVwiLFxuICAgICAgICAgICAgaW5wdXQ6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoaW5wdXQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWlucHV0KVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1pbldwbUN1c3RvbVNwZWVkKHBhcnNlSW50KGlucHV0KSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1pbldwbShcImN1c3RvbVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc01pbkFjYyA9IHtcbiAgICB0aXRsZTogXCJDaGFuZ2UgbWluIGFjY3VyYWN5IG1vZGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwibWluQWNjXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRNaW5BY2NPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TWluQWNjKFwib2ZmXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0TWluQWNjQ3VzdG9tXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImN1c3RvbS4uLlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiY3VzdG9tXCIsXG4gICAgICAgICAgICBpbnB1dDogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6IChpbnB1dCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghaW5wdXQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TWluQWNjQ3VzdG9tKHBhcnNlSW50KGlucHV0KSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1pbkFjYyhcImN1c3RvbVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc01pbkJ1cnN0ID0ge1xuICAgIHRpdGxlOiBcIkNoYW5nZSBtaW4gYnVyc3QgbW9kZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJtaW5CdXJzdFwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0TWluQnVyc3RPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TWluQnVyc3QoXCJvZmZcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRNaW5CdXJzdEZpeGVkXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImZpeGVkLi4uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJmaXhlZFwiLFxuICAgICAgICAgICAgaW5wdXQ6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoaW5wdXQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWlucHV0KVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1pbkJ1cnN0KFwiZml4ZWRcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1pbkJ1cnN0Q3VzdG9tU3BlZWQocGFyc2VJbnQoaW5wdXQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldE1pbkJ1cnN0RmxleFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJmbGV4Li4uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJmbGV4XCIsXG4gICAgICAgICAgICBpbnB1dDogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6IChpbnB1dCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghaW5wdXQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TWluQnVyc3QoXCJmbGV4XCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNaW5CdXJzdEN1c3RvbVNwZWVkKHBhcnNlSW50KGlucHV0KSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNLZXltYXBTdHlsZSA9IHtcbiAgICB0aXRsZTogXCJLZXltYXAgc3R5bGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwia2V5bWFwU3R5bGVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEtleW1hcFN0eWxlU3RhZ2dlcmVkXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInN0YWdnZXJlZFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwic3RhZ2dlcmVkXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcFN0eWxlKFwic3RhZ2dlcmVkXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0S2V5bWFwU3R5bGVBbGljZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJhbGljZVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiYWxpY2VcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwU3R5bGUoXCJhbGljZVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEtleW1hcFN0eWxlTWF0cml4XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm1hdHJpeFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwibWF0cml4XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcFN0eWxlKFwibWF0cml4XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0S2V5bWFwU3R5bGVTcGxpdFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJzcGxpdFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwic3BsaXRcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwU3R5bGUoXCJzcGxpdFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEtleW1hcFN0eWxlU3BsaXRNYXRyaXhcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwic3BsaXQgbWF0cml4XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJzcGxpdF9tYXRyaXhcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwU3R5bGUoXCJzcGxpdF9tYXRyaXhcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNLZXltYXBMZWdlbmRTdHlsZSA9IHtcbiAgICB0aXRsZTogXCJLZXltYXAgbGVnZW5kIHN0eWxlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImtleW1hcExlZ2VuZFN0eWxlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRLZXltYXBMZWdlbmRTdHlsZUxvd2VyY2FzZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJsb3dlcmNhc2VcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImxvd2VyY2FzZVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBMZWdlbmRTdHlsZShcImxvd2VyY2FzZVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEtleW1hcExlZ2VuZFN0eWxlVXBwZXJjYXNlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInVwcGVyY2FzZVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwidXBwZXJjYXNlXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcExlZ2VuZFN0eWxlKFwidXBwZXJjYXNlXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0S2V5bWFwTGVnZW5kU3R5bGVCbGFua1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJibGFua1wiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiYmxhbmtcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTGVnZW5kU3R5bGUoXCJibGFua1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEtleW1hcExlZ2VuZFN0eWxlRHluYW1pY1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJkeW5hbWljXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJkeW5hbWljXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcExlZ2VuZFN0eWxlKFwiZHluYW1pY1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0JyaXRpc2hFbmdsaXNoID0ge1xuICAgIHRpdGxlOiBcIkJyaXRpc2ggZW5nbGlzaC4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJicml0aXNoRW5nbGlzaFwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0QnJpdGlzaEVuZ2xpc2hPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEJyaXRpc2hFbmdsaXNoKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0QnJpdGlzaEVuZ2xpc2hPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEJyaXRpc2hFbmdsaXNoKHRydWUpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNIaWdobGlnaHRNb2RlID0ge1xuICAgIHRpdGxlOiBcIkhpZ2hsaWdodCBtb2RlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImhpZ2hsaWdodE1vZGVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEhpZ2hsaWdodE1vZGVPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0SGlnaGxpZ2h0TW9kZShcIm9mZlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEhpZ2hsaWdodE1vZGVMZXR0ZXJcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibGV0dGVyXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJsZXR0ZXJcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0SGlnaGxpZ2h0TW9kZShcImxldHRlclwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEhpZ2hsaWdodE1vZGVXb3JkXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIndvcmRcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIndvcmRcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0SGlnaGxpZ2h0TW9kZShcIndvcmRcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNUaW1lclN0eWxlID0ge1xuICAgIHRpdGxlOiBcIlRpbWVyL3Byb2dyZXNzIHN0eWxlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInRpbWVyU3R5bGVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFRpbWVyU3R5bGVCYXJcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiYmFyXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJiYXJcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZXJTdHlsZShcImJhclwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFRpbWVyU3R5bGVUZXh0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInRleHRcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcInRleHRcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZXJTdHlsZShcInRleHRcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRUaW1lclN0eWxlTWluaVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJtaW5pXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJtaW5pXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVyU3R5bGUoXCJtaW5pXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzVGltZXJDb2xvciA9IHtcbiAgICB0aXRsZTogXCJUaW1lci9wcm9ncmVzcyBjb2xvci4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJ0aW1lckNvbG9yXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRUaW1lckNvbG9yQmxhY2tcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVyQ29sb3IoXCJibGFja1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFRpbWVyQ29sb3JTdWJcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwic3ViXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJzdWJcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZXJDb2xvcihcInN1YlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFRpbWVyQ29sb3JUZXh0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInRleHRcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcInRleHRcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZXJDb2xvcihcInRleHRcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRUaW1lckNvbG9yTWFpblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJtYWluXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJtYWluXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVyQ29sb3IoXCJtYWluXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzU2luZ2xlTGlzdENvbW1hbmRMaW5lID0ge1xuICAgIHRpdGxlOiBcIlNpbmdsZSBsaXN0IGNvbW1hbmQgbGluZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJzaW5nbGVMaXN0Q29tbWFuZExpbmVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNpbmdsZUxpc3RDb21tYW5kTGluZU1hbnVhbFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJtYW51YWxcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm1hbnVhbFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaW5nbGVMaXN0Q29tbWFuZExpbmUoXCJtYW51YWxcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzaW5nbGVMaXN0Q29tbWFuZExpbmVPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib25cIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2luZ2xlTGlzdENvbW1hbmRMaW5lKFwib25cIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNDYXBzTG9ja1dhcm5pbmcgPSB7XG4gICAgdGl0bGU6IFwiQ2FwcyBsb2NrIHdhcm5pbmcuLi5cIixcbiAgICBjb25maWdLZXk6IFwiY2Fwc0xvY2tXYXJuaW5nXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjYXBzTG9ja1dhcm5pbmdPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldENhcHNMb2NrV2FybmluZyh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNhcHNMb2NrV2FybmluZ09mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q2Fwc0xvY2tXYXJuaW5nKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1RpbWVyT3BhY2l0eSA9IHtcbiAgICB0aXRsZTogXCJUaW1lci9wcm9ncmVzcyBvcGFjaXR5Li4uXCIsXG4gICAgY29uZmlnS2V5OiBcInRpbWVyT3BhY2l0eVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0VGltZXJPcGFjaXR5LjI1XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIi4yNVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDAuMjUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVyT3BhY2l0eShcIjAuMjVcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRUaW1lck9wYWNpdHkuNVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIuNVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDAuNSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZXJPcGFjaXR5KFwiMC41XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0VGltZXJPcGFjaXR5Ljc1XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIi43NVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDAuNzUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVyT3BhY2l0eShcIjAuNzVcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRUaW1lck9wYWNpdHkxXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjFcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAxLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lck9wYWNpdHkoXCIxXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzV29yZENvdW50ID0ge1xuICAgIHRpdGxlOiBcIkNoYW5nZSB3b3JkIGNvdW50Li4uXCIsXG4gICAgY29uZmlnS2V5OiBcIndvcmRzXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VXb3JkQ291bnQxMFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIxMFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDEwLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwid29yZHNcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFdvcmRDb3VudCgxMCk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVdvcmRDb3VudDI1XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjI1XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMjUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ3b3Jkc1wiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0V29yZENvdW50KDI1KTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlV29yZENvdW50NTBcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiNTBcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiA1MCxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcIndvcmRzXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRXb3JkQ291bnQoNTApO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VXb3JkQ291bnQxMDBcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiMTAwXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMTAwLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwid29yZHNcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFdvcmRDb3VudCgxMDApO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VXb3JkQ291bnQyMDBcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiMjAwXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMjAwLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwid29yZHNcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFdvcmRDb3VudCgyMDApO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VXb3JkQ291bnRDdXN0b21cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiY3VzdG9tLi4uXCIsXG4gICAgICAgICAgICBpbnB1dDogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6IChpbnB1dCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghaW5wdXQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcIndvcmRzXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRXb3JkQ291bnQocGFyc2VJbnQoaW5wdXQpKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzUXVvdGVMZW5ndGhDb25maWcgPSB7XG4gICAgdGl0bGU6IFwiQ2hhbmdlIHF1b3RlIGxlbmd0aC4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJxdW90ZUxlbmd0aFwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUXVvdGVMZW5ndGhBbGxcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiYWxsXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogWzAsIDEsIDIsIDNdLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwicXVvdGVcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFF1b3RlTGVuZ3RoKFswLCAxLCAyLCAzXSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVF1b3RlTGVuZ3RoU2hvcnRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwic2hvcnRcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAwLFxuICAgICAgICAgICAgY29uZmlnVmFsdWVNb2RlOiBcImluY2x1ZGVcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcInF1b3RlXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRRdW90ZUxlbmd0aCgwKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUXVvdGVMZW5ndGhNZWRpdW1cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibWVkaXVtXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMSxcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlTW9kZTogXCJpbmNsdWRlXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJxdW90ZVwiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UXVvdGVMZW5ndGgoMSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVF1b3RlTGVuZ3RoTG9uZ1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJsb25nXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlTW9kZTogXCJpbmNsdWRlXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJxdW90ZVwiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UXVvdGVMZW5ndGgoMik7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVF1b3RlTGVuZ3RoVGhpY2NcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwidGhpY2NcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAzLFxuICAgICAgICAgICAgY29uZmlnVmFsdWVNb2RlOiBcImluY2x1ZGVcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcInF1b3RlXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRRdW90ZUxlbmd0aCgzKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzUHVuY3R1YXRpb24gPSB7XG4gICAgdGl0bGU6IFwiQ2hhbmdlIHB1bmN0dWF0aW9uLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInB1bmN0dWF0aW9uXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VQdW5jdHVhdGlvbk9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UHVuY3R1YXRpb24odHJ1ZSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVB1bmN0dWF0aW9uT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQdW5jdHVhdGlvbihmYWxzZSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc051bWJlcnMgPSB7XG4gICAgdGl0bGU6IFwiTnVtYmVycy4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJudW1iZXJzXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VOdW1iZXJzT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXROdW1iZXJzKHRydWUpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VOdW1iZXJzT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXROdW1iZXJzKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzU21vb3RoQ2FyZXQgPSB7XG4gICAgdGl0bGU6IFwiU21vb3RoIGNhcmV0Li4uXCIsXG4gICAgY29uZmlnS2V5OiBcInNtb290aENhcmV0XCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTbW9vdGhDYXJldE9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U21vb3RoQ2FyZXQodHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTbW9vdGhDYXJldE9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U21vb3RoQ2FyZXQoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzUXVpY2tUYWIgPSB7XG4gICAgdGl0bGU6IFwiUXVpY2sgdGFiLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInF1aWNrVGFiXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VRdWlja1RhYk9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UXVpY2tUYWJNb2RlKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUXVpY2tUYWJPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFF1aWNrVGFiTW9kZShmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNNb2RlID0ge1xuICAgIHRpdGxlOiBcIkNoYW5nZSBtb2RlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcIm1vZGVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZU1vZGVUaW1lXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInRpbWVcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcInRpbWVcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcInRpbWVcIik7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZU1vZGVXb3Jkc1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJ3b3Jkc1wiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwid29yZHNcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcIndvcmRzXCIpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VNb2RlUXVvdGVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwicXVvdGVcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcInF1b3RlXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJxdW90ZVwiKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTW9kZUN1c3RvbVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJjdXN0b21cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImN1c3RvbVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwiY3VzdG9tXCIpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VNb2RlWmVuXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInplblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiemVuXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ6ZW5cIik7XG4gICAgICAgICAgICAgICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzVGltZUNvbmZpZyA9IHtcbiAgICB0aXRsZTogXCJDaGFuZ2UgdGltZSBjb25maWcuLi5cIixcbiAgICBjb25maWdLZXk6IFwidGltZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlVGltZUNvbmZpZzE1XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjE1XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMTUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ0aW1lXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lQ29uZmlnKDE1KTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlVGltZUNvbmZpZzMwXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjMwXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMzAsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ0aW1lXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lQ29uZmlnKDMwKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlVGltZUNvbmZpZzYwXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjYwXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogNjAsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ0aW1lXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lQ29uZmlnKDYwKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlVGltZUNvbmZpZzEyMFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIxMjBcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAxMjAsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ0aW1lXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lQ29uZmlnKDEyMCk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVRpbWVDb25maWdDdXN0b21cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiY3VzdG9tLi4uXCIsXG4gICAgICAgICAgICBpbnB1dDogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6IChpbnB1dCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghaW5wdXQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcInRpbWVcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVDb25maWcocGFyc2VJbnQoaW5wdXQpKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzQ29uZmlkZW5jZU1vZGUgPSB7XG4gICAgdGl0bGU6IFwiQ29uZmlkZW5jZSBtb2RlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImNvbmZpZGVuY2VNb2RlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VDb25maWRlbmNlTW9kZU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDb25maWRlbmNlTW9kZShcIm9mZlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUNvbmZpZGVuY2VNb2RlT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9uXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldENvbmZpZGVuY2VNb2RlKFwib25cIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VDb25maWRlbmNlTW9kZU1heFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJtYXhcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm1heFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDb25maWRlbmNlTW9kZShcIm1heFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1N0b3BPbkVycm9yID0ge1xuICAgIHRpdGxlOiBcIlN0b3Agb24gZXJyb3IuLi5cIixcbiAgICBjb25maWdLZXk6IFwic3RvcE9uRXJyb3JcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVN0b3BPbkVycm9yT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFN0b3BPbkVycm9yKFwib2ZmXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU3RvcE9uRXJyb3JMZXR0ZXJcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibGV0dGVyXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJsZXR0ZXJcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U3RvcE9uRXJyb3IoXCJsZXR0ZXJcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTdG9wT25FcnJvcldvcmRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwid29yZFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwid29yZFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTdG9wT25FcnJvcihcIndvcmRcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNGb250U2l6ZSA9IHtcbiAgICB0aXRsZTogXCJGb250IHNpemUuLi5cIixcbiAgICBjb25maWdLZXk6IFwiZm9udFNpemVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUZvbnRTaXplMVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIxeFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDEsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZvbnRTaXplKFwiMVwiKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlRm9udFNpemUxMjVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiMS4yNXhcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAxMjUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZvbnRTaXplKFwiMTI1XCIpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VGb250U2l6ZTE1XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjEuNXhcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAxNSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Rm9udFNpemUoXCIxNVwiKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlRm9udFNpemUyXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjJ4XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Rm9udFNpemUoXCIyXCIpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VGb250U2l6ZTNcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiM3hcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAzLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGb250U2l6ZShcIjNcIik7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUZvbnRTaXplNFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCI0eFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDQsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZvbnRTaXplKFwiNFwiKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzUGFnZVdpZHRoID0ge1xuICAgIHRpdGxlOiBcIlBhZ2Ugd2lkdGguLi5cIixcbiAgICBjb25maWdLZXk6IFwicGFnZVdpZHRoXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRQYWdlV2lkdGgxMDBcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiMTAwXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCIxMDBcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGFnZVdpZHRoKFwiMTAwXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UGFnZVdpZHRoMTI1XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjEyNVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiMTI1XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBhZ2VXaWR0aChcIjEyNVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFBhZ2VXaWR0aDE1MFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIxNTBcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjE1MFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWdlV2lkdGgoXCIxNTBcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRQYWdlV2lkdGgyMDBcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiMjAwXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCIyMDBcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGFnZVdpZHRoKFwiMjAwXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UGFnZVdpZHRoTWF4XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm1heFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwibWF4XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBhZ2VXaWR0aChcIm1heFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1ByYWN0aXNlV29yZHMgPSB7XG4gICAgdGl0bGU6IFwiUHJhY3RpY2Ugd29yZHMuLi5cIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInByYWN0aXNlV29yZHNNaXNzZWRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibWlzc2VkXCIsXG4gICAgICAgICAgICBub0ljb246IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgUHJhY3Rpc2VXb3Jkcy5pbml0KHRydWUsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydChmYWxzZSwgZmFsc2UsIHVuZGVmaW5lZCwgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJwcmFjdGlzZVdvcmRzU2xvd1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJzbG93XCIsXG4gICAgICAgICAgICBub0ljb246IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgUHJhY3Rpc2VXb3Jkcy5pbml0KGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydChmYWxzZSwgZmFsc2UsIHVuZGVmaW5lZCwgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJwcmFjdGlzZVdvcmRzQm90aFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJib3RoXCIsXG4gICAgICAgICAgICBub0ljb246IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgUHJhY3Rpc2VXb3Jkcy5pbml0KHRydWUsIHRydWUpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KGZhbHNlLCBmYWxzZSwgdW5kZWZpbmVkLCB0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5leHBvcnRzLnRoZW1lQ29tbWFuZHMgPSB7XG4gICAgdGl0bGU6IFwiVGhlbWUuLi5cIixcbiAgICBjb25maWdLZXk6IFwidGhlbWVcIixcbiAgICBsaXN0OiBbXSxcbn07XG5NaXNjLmdldFRoZW1lc0xpc3QoKS50aGVuKCh0aGVtZXMpID0+IHtcbiAgICB0aGVtZXMuZm9yRWFjaCgodGhlbWUpID0+IHtcbiAgICAgICAgZXhwb3J0cy50aGVtZUNvbW1hbmRzLmxpc3QucHVzaCh7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VUaGVtZVwiICsgTWlzYy5jYXBpdGFsaXplRmlyc3RMZXR0ZXJPZkVhY2hXb3JkKHRoZW1lLm5hbWUpLFxuICAgICAgICAgICAgZGlzcGxheTogdGhlbWUubmFtZS5yZXBsYWNlKC9fL2csIFwiIFwiKSxcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0aGVtZS5uYW1lLFxuICAgICAgICAgICAgaG92ZXI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBwcmV2aWV3VGhlbWUodGhlbWUubmFtZSk7XG4gICAgICAgICAgICAgICAgVGhlbWVDb250cm9sbGVyLnByZXZpZXcodGhlbWUubmFtZSwgZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGhlbWUodGhlbWUubmFtZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuZXhwb3J0cy5jb21tYW5kc0NoYWxsZW5nZXMgPSB7XG4gICAgdGl0bGU6IFwiTG9hZCBjaGFsbGVuZ2UuLi5cIixcbiAgICBsaXN0OiBbXSxcbn07XG5NaXNjLmdldENoYWxsZW5nZUxpc3QoKS50aGVuKChjaGFsbGVuZ2VzKSA9PiB7XG4gICAgY2hhbGxlbmdlcy5mb3JFYWNoKChjaGFsbGVuZ2UpID0+IHtcbiAgICAgICAgZXhwb3J0cy5jb21tYW5kc0NoYWxsZW5nZXMubGlzdC5wdXNoKHtcbiAgICAgICAgICAgIGlkOiBcImxvYWRDaGFsbGVuZ2VcIiArIE1pc2MuY2FwaXRhbGl6ZUZpcnN0TGV0dGVyT2ZFYWNoV29yZChjaGFsbGVuZ2UubmFtZSksXG4gICAgICAgICAgICBub0ljb246IHRydWUsXG4gICAgICAgICAgICBkaXNwbGF5OiBjaGFsbGVuZ2UuZGlzcGxheSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBDaGFsbGVuZ2VDb250cm9sbGVyLnNldHVwKGNoYWxsZW5nZS5uYW1lKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydChmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuLy8gZXhwb3J0IGZ1bmN0aW9uIHNob3dGYXZvdXJpdGVUaGVtZXNBdFRoZVRvcCgpIHtcbmZ1bmN0aW9uIHVwZGF0ZVRoZW1lQ29tbWFuZHMoKSB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZmF2VGhlbWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZXhwb3J0cy50aGVtZUNvbW1hbmRzLmxpc3QgPSBbXTtcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5mYXZUaGVtZXMuZm9yRWFjaCgodGhlbWUpID0+IHtcbiAgICAgICAgICAgIGV4cG9ydHMudGhlbWVDb21tYW5kcy5saXN0LnB1c2goe1xuICAgICAgICAgICAgICAgIGlkOiBcImNoYW5nZVRoZW1lXCIgKyBNaXNjLmNhcGl0YWxpemVGaXJzdExldHRlck9mRWFjaFdvcmQodGhlbWUpLFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRoZW1lLnJlcGxhY2UoL18vZywgXCIgXCIpLFxuICAgICAgICAgICAgICAgIGhvdmVyOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHByZXZpZXdUaGVtZSh0aGVtZSk7XG4gICAgICAgICAgICAgICAgICAgIFRoZW1lQ29udHJvbGxlci5wcmV2aWV3KHRoZW1lLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaGVtZSh0aGVtZSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgTWlzYy5nZXRUaGVtZXNMaXN0KCkudGhlbigodGhlbWVzKSA9PiB7XG4gICAgICAgICAgICB0aGVtZXMuZm9yRWFjaCgodGhlbWUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mYXZUaGVtZXMuaW5jbHVkZXModGhlbWUubmFtZSkpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBleHBvcnRzLnRoZW1lQ29tbWFuZHMubGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IFwiY2hhbmdlVGhlbWVcIiArIE1pc2MuY2FwaXRhbGl6ZUZpcnN0TGV0dGVyT2ZFYWNoV29yZCh0aGVtZS5uYW1lKSxcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogdGhlbWUubmFtZS5yZXBsYWNlKC9fL2csIFwiIFwiKSxcbiAgICAgICAgICAgICAgICAgICAgaG92ZXI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByZXZpZXdUaGVtZSh0aGVtZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFRoZW1lQ29udHJvbGxlci5wcmV2aWV3KHRoZW1lLm5hbWUsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRoZW1lKHRoZW1lLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMudXBkYXRlVGhlbWVDb21tYW5kcyA9IHVwZGF0ZVRoZW1lQ29tbWFuZHM7XG5jb25zdCBjb21tYW5kc0NvcHlXb3Jkc1RvQ2xpcGJvYXJkID0ge1xuICAgIHRpdGxlOiBcIkFyZSB5b3Ugc3VyZS4uLlwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY29weU5vXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIk5ldmVybWluZFwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjb3B5WWVzXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlllcywgSSBhbSBzdXJlXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgd29yZHMgPSBNaXNjLmdldFdvcmRzKCk7XG4gICAgICAgICAgICAgICAgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQod29yZHMpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkNvcGllZCB0byBjbGlwYm9hcmRcIiwgMSk7XG4gICAgICAgICAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBjb3B5IVwiLCAtMSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNNb25rZXlQb3dlckxldmVsID0ge1xuICAgIHRpdGxlOiBcIlBvd2VyIG1vZGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwibW9ua2V5UG93ZXJMZXZlbFwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwibW9ua2V5UG93ZXJMZXZlbE9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4gVXBkYXRlQ29uZmlnLnNldE1vbmtleVBvd2VyTGV2ZWwoXCJvZmZcIiksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcIm1vbmtleVBvd2VyTGV2ZWwxXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm1lbGxvd1wiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiMVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4gVXBkYXRlQ29uZmlnLnNldE1vbmtleVBvd2VyTGV2ZWwoXCIxXCIpLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJtb25rZXlQb3dlckxldmVsMlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJoaWdoXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCIyXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiBVcGRhdGVDb25maWcuc2V0TW9ua2V5UG93ZXJMZXZlbChcIjJcIiksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcIm1vbmtleVBvd2VyTGV2ZWwzXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInVsdHJhXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCIzXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiBVcGRhdGVDb25maWcuc2V0TW9ua2V5UG93ZXJMZXZlbChcIjNcIiksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcIm1vbmtleVBvd2VyTGV2ZWw0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm92ZXIgOTAwMFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiNFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4gVXBkYXRlQ29uZmlnLnNldE1vbmtleVBvd2VyTGV2ZWwoXCI0XCIpLFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuZXhwb3J0cy5kZWZhdWx0Q29tbWFuZHMgPSB7XG4gICAgdGl0bGU6IFwiXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VQdW5jdHVhdGlvblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJQdW5jdHVhdGlvbi4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCIhP1wiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzUHVuY3R1YXRpb24sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZU1vZGVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiTW9kZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1iYXJzXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNNb2RlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VUaW1lQ29uZmlnXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlRpbWUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtY2xvY2tcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1RpbWVDb25maWcsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVdvcmRDb3VudFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJXb3Jkcy4uLlwiLFxuICAgICAgICAgICAgYWxpYXM6IFwid29yZHNcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtZm9udFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzV29yZENvdW50LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VRdW90ZUxlbmd0aFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJRdW90ZSBsZW5ndGguLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtcXVvdGUtcmlnaHRcIixcbiAgICAgICAgICAgIGFsaWFzOiBcInF1b3Rlc1wiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzUXVvdGVMZW5ndGhDb25maWcsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlVGFnc1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJUYWdzLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXRhZ1wiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzVGFncyxcbiAgICAgICAgICAgIGJlZm9yZVN1Ymdyb3VwOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdXBkYXRlVGFnQ29tbWFuZHMoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBleGVjOiAoKTogdm9pZCA9PiB7XG4gICAgICAgICAgICAvLyAgIHVwZGF0ZVRhZ0NvbW1hbmRzKCk7XG4gICAgICAgICAgICAvLyAgIGN1cnJlbnQucHVzaCgpO1xuICAgICAgICAgICAgLy8gICBDb21tYW5kbGluZS5zaG93KCk7XG4gICAgICAgICAgICAvLyB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIGlkOiBcImFwcGx5UHJlc2V0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlByZXNldHMuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtc2xpZGVycy1oXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNQcmVzZXRzLFxuICAgICAgICAgICAgYmVmb3JlU3ViZ3JvdXA6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB1cGRhdGVQcmVzZXRDb21tYW5kcygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIGV4ZWM6ICgpOiB2b2lkID0+IHtcbiAgICAgICAgICAgIC8vICAgdXBkYXRlUHJlc2V0Q29tbWFuZHMoKTtcbiAgICAgICAgICAgIC8vICAgY3VycmVudC5wdXNoKGNvbW1hbmRzUHJlc2V0cyk7XG4gICAgICAgICAgICAvLyAgIENvbW1hbmRsaW5lLnNob3coKTtcbiAgICAgICAgICAgIC8vIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUNvbmZpZGVuY2VNb2RlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkNvbmZpZGVuY2UgbW9kZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1iYWNrc3BhY2VcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0NvbmZpZGVuY2VNb2RlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTdG9wT25FcnJvclwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJTdG9wIG9uIGVycm9yLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWhhbmQtcGFwZXJcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1N0b3BPbkVycm9yLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VOdW1iZXJzXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIk51bWJlcnMuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiMTVcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc051bWJlcnMsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVNtb290aENhcmV0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlNtb290aCBjYXJldC4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1pLWN1cnNvclwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzU21vb3RoQ2FyZXQsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVF1aWNrVGFiXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlF1aWNrIHRhYi4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1yZWRvLWFsdFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzUXVpY2tUYWIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVJlcGVhdFF1b3Rlc1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJSZXBlYXQgcXVvdGVzLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXN5bmMtYWx0XCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNSZXBlYXRRdW90ZXMsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUxpdmVXcG1cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiTGl2ZSBXUE0uLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtdGFjaG9tZXRlci1hbHRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0xpdmVXcG0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUxpdmVBY2NcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiTGl2ZSBhY2N1cmFjeS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1wZXJjZW50YWdlXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNMaXZlQWNjLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VMaXZlQnVyc3RcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiTGl2ZSBidXJzdC4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1maXJlLWFsdFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzTGl2ZUJ1cnN0LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTaG93VGltZXJcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiVGltZXIvcHJvZ3Jlc3MuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtY2xvY2tcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1Nob3dUaW1lcixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlS2V5VGlwc1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJLZXkgdGlwcy4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1xdWVzdGlvblwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzS2V5VGlwcyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlRnJlZWRvbU1vZGVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiRnJlZWRvbSBtb2RlLi4uXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNGcmVlZG9tTW9kZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU3RyaWN0U3BhY2VcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiU3RyaWN0IHNwYWNlLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLW1pbnVzXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNTdHJpY3RTcGFjZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlQmxpbmRNb2RlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkJsaW5kIG1vZGUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtZXllLXNsYXNoXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNCbGluZE1vZGUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVNob3dXb3Jkc0hpc3RvcnlcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQWx3YXlzIHNob3cgd29yZHMgaGlzdG9yeS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1hbGlnbi1sZWZ0XCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNTaG93V29yZHNIaXN0b3J5LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VJbmRpY2F0ZVR5cG9zXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkluZGljYXRlIHR5cG9zLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWV4Y2xhbWF0aW9uXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNJbmRpY2F0ZVR5cG9zLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VIaWRlRXh0cmFMZXR0ZXJzXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkhpZGUgZXh0cmEgbGV0dGVycy4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1leWUtc2xhc2hcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0hpZGVFeHRyYUxldHRlcnMsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVF1aWNrRW5kXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlF1aWNrIGVuZC4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1zdGVwLWZvcndhcmRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1F1aWNrRW5kLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzaW5nbGVMaXN0Q29tbWFuZExpbmVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiU2luZ2xlIGxpc3QgY29tbWFuZCBsaW5lLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWxpc3RcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1NpbmdsZUxpc3RDb21tYW5kTGluZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2Fwc0xvY2tXYXJuaW5nXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkNhcHMgbG9jayB3YXJuaW5nLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNDYXBzTG9ja1dhcm5pbmcsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZU1pbldwbVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJNaW5pbXVtIHdwbS4uLlwiLFxuICAgICAgICAgICAgYWxpYXM6IFwibWluaW11bVwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1ib21iXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNNaW5XcG0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZU1pbkFjY1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJNaW5pbXVtIGFjY3VyYWN5Li4uXCIsXG4gICAgICAgICAgICBhbGlhczogXCJtaW5pbXVtXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWJvbWJcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc01pbkFjYyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTWluQnVyc3RcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiTWluaW11bSBidXJzdC4uLlwiLFxuICAgICAgICAgICAgYWxpYXM6IFwibWluaW11bVwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1ib21iXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNNaW5CdXJzdCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlT3Bwb3NpdGVTaGlmdE1vZGVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQ2hhbmdlIG9wcG9zaXRlIHNoaWZ0IG1vZGUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtZXhjaGFuZ2UtYWx0XCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNPcHBvc2l0ZVNoaWZ0TW9kZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU291bmRPbkNsaWNrXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlNvdW5kIG9uIGNsaWNrLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXZvbHVtZS11cFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzU291bmRPbkNsaWNrLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTb3VuZE9uRXJyb3JcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiU291bmQgb24gZXJyb3IuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtdm9sdW1lLW11dGVcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1NvdW5kT25FcnJvcixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU291bmRWb2x1bWVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiU291bmQgdm9sdW1lLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXZvbHVtZS1kb3duXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNTb3VuZFZvbHVtZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlRmxpcFRlc3RDb2xvcnNcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiRmxpcCB0ZXN0IGNvbG9ycy4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1hZGp1c3RcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0ZsaXBUZXN0Q29sb3JzLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTbW9vdGhMaW5lU2Nyb2xsXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlNtb290aCBsaW5lIHNjcm9sbC4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1hbGlnbi1sZWZ0XCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNTbW9vdGhMaW5lU2Nyb2xsLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VBbHdheXNTaG93RGVjaW1hbFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJBbHdheXMgc2hvdyBkZWNpbWFsIHBsYWNlcy4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCIwMFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzQWx3YXlzU2hvd0RlY2ltYWwsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUFsd2F5c1Nob3dDUE1cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQWx3YXlzIHNob3cgQ1BNLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXRhY2hvbWV0ZXItYWx0XCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNBbHdheXNTaG93Q1BNLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTdGFydEdyYXBoc0F0WmVyb1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJTdGFydCBncmFwaHMgYXQgemVyby4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1jaGFydC1saW5lXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNTdGFydEdyYXBoc0F0WmVybyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU3dhcEVzY0FuZFRhYlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJTd2FwIGVzYyBhbmQgdGFiLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWV4Y2hhbmdlLWFsdFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzU3dhcEVzY0FuZFRhYixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTGF6eU1vZGVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiTGF6eSBtb2RlLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWNvdWNoXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNMYXp5TW9kZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU2hvd0FsbExpbmVzXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlNob3cgYWxsIGxpbmVzLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWFsaWduLWxlZnRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1Nob3dBbGxMaW5lcyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlQ29sb3JmdWxNb2RlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkNvbG9yZnVsIG1vZGUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtZmlsbC1kcmlwXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNDb2xvcmZ1bE1vZGUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZU91dE9mRm9jdXNXYXJuaW5nXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIk91dCBvZiBmb2N1cyB3YXJuaW5nLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWV4Y2xhbWF0aW9uXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNPdXRPZkZvY3VzV2FybmluZyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0RW5hYmxlQWRzXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkVuYWJsZSBhZHMuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtYWRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBleHBvcnRzLmNvbW1hbmRzRW5hYmxlQWRzLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VUaGVtZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJUaGVtZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1wYWxldHRlXCIsXG4gICAgICAgICAgICBzdWJncm91cDogZXhwb3J0cy50aGVtZUNvbW1hbmRzLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRDdXN0b21UaGVtZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJDdXN0b20gdGhlbWUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtcGFsZXR0ZVwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGV4cG9ydHMuY3VzdG9tVGhlbWVDb21tYW5kcyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0Q3VzdG9tVGhlbWVJZFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJDdXN0b20gdGhlbWVzLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXBhbGV0dGVcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBleHBvcnRzLmN1c3RvbVRoZW1lTGlzdENvbW1hbmRzLFxuICAgICAgICAgICAgYmVmb3JlU3ViZ3JvdXA6ICgpID0+IHVwZGF0ZUN1c3RvbVRoZW1lTGlzdENvbW1hbmRzKCksXG4gICAgICAgICAgICBhdmFpbGFibGU6ICgpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyICE9PSBudWxsO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUmFuZG9tVGhlbWVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiUmFuZG9tIHRoZW1lLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXJhbmRvbVwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzUmFuZG9tVGhlbWUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInJhbmRvbWl6ZVRoZW1lXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIk5leHQgcmFuZG9tIHRoZW1lXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXJhbmRvbVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4gVGhlbWVDb250cm9sbGVyLnJhbmRvbWl6ZVRoZW1lKCksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZURpZmZpY3VsdHlcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiRGlmZmljdWx0eS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1zdGFyXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNEaWZmaWN1bHR5LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VDYXJldFN0eWxlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkNhcmV0IHN0eWxlLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWktY3Vyc29yXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNDYXJldFN0eWxlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VQYWNlQ2FyZXRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiUGFjZSBjYXJldCBtb2RlLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWktY3Vyc29yXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNQYWNlQ2FyZXQsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVBhY2VDYXJldFN0eWxlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlBhY2UgY2FyZXQgc3R5bGUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtaS1jdXJzb3JcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1BhY2VDYXJldFN0eWxlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VSZXBlYXRlZFBhY2VcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiUmVwZWF0ZWQgcGFjZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1pLWN1cnNvclwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzUmVwZWF0ZWRQYWNlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VUaW1lclN0eWxlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlRpbWVyL3Byb2dyZXNzIHN0eWxlLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWNsb2NrXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNUaW1lclN0eWxlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VUaW1lckNvbG9yXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlRpbWVyL3Byb2dyZXNzIGNvbG9yLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWNsb2NrXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNUaW1lckNvbG9yLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VUaW1lck9wYWNpdHlcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiVGltZXIvcHJvZ3Jlc3Mgb3BhY2l0eS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1jbG9ja1wiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzVGltZXJPcGFjaXR5LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VIaWdobGlnaHRNb2RlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkhpZ2hsaWdodCBtb2RlLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWhpZ2hsaWdodGVyXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNIaWdobGlnaHRNb2RlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTaG93QXZlcmFnZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJTaG93IGF2ZXJhZ2UuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtY2hhcnQtYmFyXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNTaG93QXZlcmFnZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlQ3VzdG9tQmFja2dyb3VuZFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJDdXN0b20gYmFja2dyb3VuZC4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1pbWFnZVwiLFxuICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBcIlwiLFxuICAgICAgICAgICAgaW5wdXQ6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoaW5wdXQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWlucHV0KVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbUJhY2tncm91bmQoaW5wdXQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTGFuZ3VhZ2VcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiTGFuZ3VhZ2UuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtbGFuZ3VhZ2VcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0xhbmd1YWdlcyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlQnJpdGlzaEVuZ2xpc2hcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQnJpdGlzaCBlbmdsaXNoLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWxhbmd1YWdlXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNCcml0aXNoRW5nbGlzaCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlRnVuYm94XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkZ1bmJveC4uLlwiLFxuICAgICAgICAgICAgYWxpYXM6IFwiZnVuIGJveFwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1nYW1lcGFkXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNGdW5ib3gsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUxheW91dFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJMYXlvdXQgZW11bGF0b3IuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEta2V5Ym9hcmRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0xheW91dHMsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInRvZ2dsZUtleW1hcFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJLZXltYXAgbW9kZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1rZXlib2FyZFwiLFxuICAgICAgICAgICAgYWxpYXM6IFwia2V5Ym9hcmRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0tleW1hcE1vZGUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUtleW1hcFN0eWxlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIktleW1hcCBzdHlsZS4uLlwiLFxuICAgICAgICAgICAgYWxpYXM6IFwia2V5Ym9hcmRcIixcbiAgICAgICAgICAgIGljb246IFwiZmEta2V5Ym9hcmRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0tleW1hcFN0eWxlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VLZXltYXBMZWdlbmRTdHlsZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJLZXltYXAgbGVnZW5kIHN0eWxlLi4uXCIsXG4gICAgICAgICAgICBhbGlhczogXCJrZXlib2FyZFwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1rZXlib2FyZFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzS2V5bWFwTGVnZW5kU3R5bGUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUtleW1hcExheW91dFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJLZXltYXAgbGF5b3V0Li4uXCIsXG4gICAgICAgICAgICBhbGlhczogXCJrZXlib2FyZFwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1rZXlib2FyZFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGV4cG9ydHMuY29tbWFuZHNLZXltYXBMYXlvdXRzLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VDdXN0b21MYXlvdXRmbHVpZFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJDdXN0b20gbGF5b3V0Zmx1aWQuLi5cIixcbiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogXCJxd2VydHkgZHZvcmFrIGNvbGVtYWtcIixcbiAgICAgICAgICAgIGlucHV0OiB0cnVlLFxuICAgICAgICAgICAgaWNvbjogXCJmYS10aW50XCIsXG4gICAgICAgICAgICBleGVjOiAoaW5wdXQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaW5wdXQgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21MYXlvdXRmbHVpZChpbnB1dCk7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcImxheW91dGZsdWlkXCIpXG4gICAgICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlQ29uZmlnLnNldExheW91dChcbiAgICAgICAgICAgICAgICAvLyAgIENvbmZpZy5jdXN0b21MYXlvdXRmbHVpZFxuICAgICAgICAgICAgICAgIC8vICAgICA/IENvbmZpZy5jdXN0b21MYXlvdXRmbHVpZC5zcGxpdChcIl9cIilbMF1cbiAgICAgICAgICAgICAgICAvLyAgICAgOiBcInF3ZXJ0eVwiXG4gICAgICAgICAgICAgICAgLy8gKTtcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGVDb25maWcuc2V0S2V5bWFwTGF5b3V0KFxuICAgICAgICAgICAgICAgIC8vICAgQ29uZmlnLmN1c3RvbUxheW91dGZsdWlkXG4gICAgICAgICAgICAgICAgLy8gICAgID8gQ29uZmlnLmN1c3RvbUxheW91dGZsdWlkLnNwbGl0KFwiX1wiKVswXVxuICAgICAgICAgICAgICAgIC8vICAgICA6IFwicXdlcnR5XCJcbiAgICAgICAgICAgICAgICAvLyApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlRm9udFNpemVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiRm9udCBzaXplLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWZvbnRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0ZvbnRTaXplLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VGb250RmFtaWx5XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkZvbnQgZmFtaWx5Li4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWZvbnRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0ZvbnRzLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VQYWdlV2lkdGhcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiUGFnZSB3aWR0aC4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1hcnJvd3MtYWx0LWhcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1BhZ2VXaWR0aCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwidmlld1R5cGluZ1BhZ2VcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiVmlldyBUeXBpbmcgUGFnZVwiLFxuICAgICAgICAgICAgYWxpYXM6IFwic3RhcnQgYmVnaW4gdHlwZSB0ZXN0XCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWtleWJvYXJkXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgJChcIiN0b3AgI21lbnUgLmljb24tYnV0dG9uLnZpZXctc3RhcnRcIikudHJpZ2dlcihcImNsaWNrXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwidmlld0xlYWRlcmJvYXJkc1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJWaWV3IExlYWRlcmJvYXJkcyBQYWdlXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWNyb3duXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgJChcIiN0b3AgI21lbnUgLmljb24tYnV0dG9uLnZpZXctbGVhZGVyYm9hcmRzXCIpLnRyaWdnZXIoXCJjbGlja1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInZpZXdBYm91dFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJWaWV3IEFib3V0IFBhZ2VcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtaW5mb1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICQoXCIjdG9wICNtZW51IC5pY29uLWJ1dHRvbi52aWV3LWFib3V0XCIpLnRyaWdnZXIoXCJjbGlja1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInZpZXdTZXR0aW5nc1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJWaWV3IFNldHRpbmdzIFBhZ2VcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtY29nXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgJChcIiN0b3AgI21lbnUgLmljb24tYnV0dG9uLnZpZXctc2V0dGluZ3NcIikudHJpZ2dlcihcImNsaWNrXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwidmlld1F1b3RlU2VhcmNoUG9wdXBcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiU2VhcmNoIGZvciBxdW90ZXNcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtc2VhcmNoXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJxdW90ZVwiKTtcbiAgICAgICAgICAgICAgICAkKFwiI3F1b3RlLXNlYXJjaC1idXR0b25cIikudHJpZ2dlcihcImNsaWNrXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNob3VsZEZvY3VzVGVzdFVJOiBmYWxzZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwidmlld0FjY291bnRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiVmlldyBBY2NvdW50IFBhZ2VcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtdXNlclwiLFxuICAgICAgICAgICAgYWxpYXM6IFwic3RhdHNcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAkKFwiI3RvcCAjbWVudSAuaWNvbi1idXR0b24udmlldy1hY2NvdW50XCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAgICAgICAgID8gJChcIiN0b3AgI21lbnUgLmljb24tYnV0dG9uLnZpZXctbG9naW5cIikudHJpZ2dlcihcImNsaWNrXCIpXG4gICAgICAgICAgICAgICAgICAgIDogJChcIiN0b3AgI21lbnUgLmljb24tYnV0dG9uLnZpZXctYWNjb3VudFwiKS50cmlnZ2VyKFwiY2xpY2tcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJ0b2dnbGVGdWxsc2NyZWVuXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlRvZ2dsZSBGdWxsc2NyZWVuXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWV4cGFuZFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIE1pc2MudG9nZ2xlRnVsbHNjcmVlbigpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiYmFpbE91dFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJCYWlsIG91dC4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1ydW5uaW5nXCIsXG4gICAgICAgICAgICBzdWJncm91cDoge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBcIkFyZSB5b3Ugc3VyZS4uLlwiLFxuICAgICAgICAgICAgICAgIGxpc3Q6IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IFwiYmFpbE91dE5vXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBcIk5ldmVybWluZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgYXZhaWxhYmxlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbkJhaWxPdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBcImJhaWxPdXRGb3JTdXJlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBcIlllcywgSSBhbSBzdXJlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVGVzdElucHV0LnNldEJhaWxvdXQodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVGVzdExvZ2ljLmZpbmlzaCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYW5CYWlsT3V0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdmlzaWJsZTogZmFsc2UsXG4gICAgICAgICAgICBhdmFpbGFibGU6ICgpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FuQmFpbE91dCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwibG9hZENoYWxsZW5nZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJMb2FkIGNoYWxsZW5nZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1hd2FyZFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGV4cG9ydHMuY29tbWFuZHNDaGFsbGVuZ2VzLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJqb2luRGlzY29yZFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJKb2luIHRoZSBEaXNjb3JkIHNlcnZlclwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS11c2Vyc1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKFwiaHR0cHM6Ly9kaXNjb3JkLmdnL21vbmtleXR5cGVcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJyZXBlYXRUZXN0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlJlcGVhdCB0ZXN0XCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXN5bmMtYWx0XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQodHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXZhaWxhYmxlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFRlc3RVSS5yZXN1bHRWaXNpYmxlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwicHJhY3Rpc2VXb3Jkc1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJQcmFjdGljZSB3b3Jkcy4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1leGNsYW1hdGlvbi10cmlhbmdsZVwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzUHJhY3Rpc2VXb3JkcyxcbiAgICAgICAgICAgIGF2YWlsYWJsZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBUZXN0VUkucmVzdWx0VmlzaWJsZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInRvZ2dsZVdvcmRIaXN0b3J5XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlRvZ2dsZSB3b3JkIGhpc3RvcnlcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtYWxpZ24tbGVmdFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFRlc3RVSS50b2dnbGVSZXN1bHRXb3JkcygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGF2YWlsYWJsZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBUZXN0VUkucmVzdWx0VmlzaWJsZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNhdmVTY3JlZW5zaG90XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlNhdmUgc2NyZWVuc2hvdFwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1pbWFnZVwiLFxuICAgICAgICAgICAgYWxpYXM6IFwic3MgcGljdHVyZVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBUZXN0VUkuc2NyZWVuc2hvdCgpO1xuICAgICAgICAgICAgICAgIH0sIDUwMCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXZhaWxhYmxlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFRlc3RVSS5yZXN1bHRWaXNpYmxlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlQ3VzdG9tTW9kZVRleHRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQ2hhbmdlIGN1c3RvbSB0ZXh0XCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWFsaWduLWxlZnRcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBDdXN0b21UZXh0UG9wdXAuc2hvdygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwidG9nZ2xlTW9ua2V5XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlRvZ2dsZSBNb25rZXlcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtZWdnXCIsXG4gICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9ua2V5KCFjb25maWdfMS5kZWZhdWx0Lm1vbmtleSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjb3B5V29yZHNUb0NsaXBib2FyZFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJDb3B5IHdvcmRzIHRvIGNsaXBib2FyZFwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1jb3B5XCIsXG4gICAgICAgICAgICBzdWJncm91cDogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBleHBvcnRzLmN1cnJlbnQucHVzaChjb21tYW5kc0NvcHlXb3Jkc1RvQ2xpcGJvYXJkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImltcG9ydFNldHRpbmdzSlNPTlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJJbXBvcnQgc2V0dGluZ3MgSlNPTlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1jb2dcIixcbiAgICAgICAgICAgIGlucHV0OiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKGlucHV0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFpbnB1dClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5hcHBseShKU09OLnBhcnNlKGlucHV0KSk7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zYXZlRnVsbENvbmZpZ1RvTG9jYWxTdG9yYWdlKCk7XG4gICAgICAgICAgICAgICAgICAgIFNldHRpbmdzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkRvbmVcIiwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQW4gZXJyb3Igb2NjdXJlZCB3aGlsZSBpbXBvcnRpbmcgc2V0dGluZ3M6IFwiICsgZSwgLTEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImV4cG9ydFNldHRpbmdzSlNPTlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJFeHBvcnQgc2V0dGluZ3MgSlNPTlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1jb2dcIixcbiAgICAgICAgICAgIGlucHV0OiB0cnVlLFxuICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBcIlwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJtb25rZXlQb3dlclwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJQb3dlciBtb2RlLi4uXCIsXG4gICAgICAgICAgICBhbGlhczogXCJwb3dlcm1vZGVcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtZWdnXCIsXG4gICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc01vbmtleVBvd2VyTGV2ZWwsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNsZWFyU3dDYWNoZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJDbGVhciBTVyBjYWNoZVwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1jb2dcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNsaXN0ID0geWllbGQgY2FjaGVzLmtleXMoKTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgY2xpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgeWllbGQgY2FjaGVzLmRlbGV0ZShuYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgfSksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImdldFN3Q2FjaGVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiR2V0IFNXIGNhY2hlXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWNvZ1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoeWllbGQgY2FjaGVzLmtleXMoKSk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmV4cG9ydHMuY3VycmVudCA9IFtleHBvcnRzLmRlZmF1bHRDb21tYW5kc107XG5mdW5jdGlvbiBzZXRDdXJyZW50KHZhbCkge1xuICAgIGV4cG9ydHMuY3VycmVudCA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0Q3VycmVudCA9IHNldEN1cnJlbnQ7XG5mdW5jdGlvbiBwdXNoQ3VycmVudCh2YWwpIHtcbiAgICBleHBvcnRzLmN1cnJlbnQucHVzaCh2YWwpO1xufVxuZXhwb3J0cy5wdXNoQ3VycmVudCA9IHB1c2hDdXJyZW50O1xuY29uc3QgbGlzdHNPYmplY3QgPSB7XG4gICAgY29tbWFuZHNDaGFsbGVuZ2VzOiBleHBvcnRzLmNvbW1hbmRzQ2hhbGxlbmdlcyxcbiAgICBjb21tYW5kc0xhbmd1YWdlcyxcbiAgICBjb21tYW5kc0RpZmZpY3VsdHksXG4gICAgY29tbWFuZHNMYXp5TW9kZSxcbiAgICBjb21tYW5kc1BhY2VDYXJldCxcbiAgICBjb21tYW5kc1Nob3dBdmVyYWdlLFxuICAgIGNvbW1hbmRzTWluV3BtLFxuICAgIGNvbW1hbmRzTWluQWNjLFxuICAgIGNvbW1hbmRzTWluQnVyc3QsXG4gICAgY29tbWFuZHNGdW5ib3gsXG4gICAgY29tbWFuZHNDb25maWRlbmNlTW9kZSxcbiAgICBjb21tYW5kc1N0b3BPbkVycm9yLFxuICAgIGNvbW1hbmRzTGF5b3V0cyxcbiAgICBjb21tYW5kc09wcG9zaXRlU2hpZnRNb2RlLFxuICAgIGNvbW1hbmRzVGFncyxcbn07XG5mdW5jdGlvbiBnZXRMaXN0KGxpc3QpIHtcbiAgICByZXR1cm4gbGlzdHNPYmplY3RbbGlzdF07XG59XG5leHBvcnRzLmdldExpc3QgPSBnZXRMaXN0O1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSwgZXZlbnRWYWx1ZSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwic2F2ZVRvTG9jYWxTdG9yYWdlXCIpIHtcbiAgICAgICAgZXhwb3J0cy5kZWZhdWx0Q29tbWFuZHMubGlzdC5maWx0ZXIoKGNvbW1hbmQpID0+IGNvbW1hbmQuaWQgPT0gXCJleHBvcnRTZXR0aW5nc0pTT05cIilbMF0uZGVmYXVsdFZhbHVlID0gZXZlbnRWYWx1ZTtcbiAgICB9XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImN1c3RvbUJhY2tncm91bmRcIikge1xuICAgICAgICBleHBvcnRzLmRlZmF1bHRDb21tYW5kcy5saXN0LmZpbHRlcigoY29tbWFuZCkgPT4gY29tbWFuZC5pZCA9PSBcImNoYW5nZUN1c3RvbUJhY2tncm91bmRcIilbMF0uZGVmYXVsdFZhbHVlID0gZXZlbnRWYWx1ZTtcbiAgICB9XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImN1c3RvbUxheW91dEZsdWlkXCIpIHtcbiAgICAgICAgZXhwb3J0cy5kZWZhdWx0Q29tbWFuZHMubGlzdC5maWx0ZXIoKGNvbW1hbmQpID0+IGNvbW1hbmQuaWQgPT0gXCJjaGFuZ2VDdXN0b21MYXlvdXRmbHVpZFwiKVswXS5kZWZhdWx0VmFsdWUgPSAoX2EgPSBldmVudFZhbHVlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVwbGFjZSgvIy9nLCBcIiBcIik7XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zaG93ID0gZXhwb3J0cy5pc1NpbmdsZUxpc3RDb21tYW5kTGluZUFjdGl2ZSA9IHZvaWQgMDtcbmNvbnN0IFRoZW1lQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvdGhlbWUtY29udHJvbGxlclwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBGb2N1cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9mb2N1c1wiKSk7XG5jb25zdCBDb21tYW5kbGluZUxpc3RzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2NvbW1hbmRsaW5lLWxpc3RzXCIpKTtcbmNvbnN0IFRlc3RVSSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LXVpXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IEFuYWx5dGljc0NvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL2FuYWx5dGljcy1jb250cm9sbGVyXCIpKTtcbmNvbnN0IFBhZ2VUcmFuc2l0aW9uID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvcGFnZS10cmFuc2l0aW9uXCIpKTtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi4vZmlyZWJhc2VcIik7XG5sZXQgY29tbWFuZExpbmVNb3VzZU1vZGUgPSBmYWxzZTtcbmZ1bmN0aW9uIHNob3dJbnB1dChjb21tYW5kLCBwbGFjZWhvbGRlciwgZGVmYXVsdFZhbHVlID0gXCJcIikge1xuICAgICQoXCIjY29tbWFuZExpbmVXcmFwcGVyXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICQoXCIjY29tbWFuZExpbmVcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgJChcIiNjb21tYW5kSW5wdXRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgJChcIiNjb21tYW5kSW5wdXQgaW5wdXRcIikuYXR0cihcInBsYWNlaG9sZGVyXCIsIHBsYWNlaG9sZGVyKTtcbiAgICAkKFwiI2NvbW1hbmRJbnB1dCBpbnB1dFwiKS52YWwoZGVmYXVsdFZhbHVlKTtcbiAgICAkKFwiI2NvbW1hbmRJbnB1dCBpbnB1dFwiKS50cmlnZ2VyKFwiZm9jdXNcIik7XG4gICAgJChcIiNjb21tYW5kSW5wdXQgaW5wdXRcIikuYXR0cihcImNvbW1hbmRcIiwgXCJcIik7XG4gICAgJChcIiNjb21tYW5kSW5wdXQgaW5wdXRcIikuYXR0cihcImNvbW1hbmRcIiwgY29tbWFuZCk7XG4gICAgaWYgKGRlZmF1bHRWYWx1ZSAhPSBcIlwiKSB7XG4gICAgICAgICQoXCIjY29tbWFuZElucHV0IGlucHV0XCIpLnNlbGVjdCgpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGlzU2luZ2xlTGlzdENvbW1hbmRMaW5lQWN0aXZlKCkge1xuICAgIHJldHVybiAkKFwiI2NvbW1hbmRMaW5lXCIpLmhhc0NsYXNzKFwiYWxsQ29tbWFuZHNcIik7XG59XG5leHBvcnRzLmlzU2luZ2xlTGlzdENvbW1hbmRMaW5lQWN0aXZlID0gaXNTaW5nbGVMaXN0Q29tbWFuZExpbmVBY3RpdmU7XG5mdW5jdGlvbiBzaG93Rm91bmQoKSB7XG4gICAgJChcIiNjb21tYW5kTGluZSAuc3VnZ2VzdGlvbnNcIikuZW1wdHkoKTtcbiAgICBsZXQgY29tbWFuZHNIVE1MID0gXCJcIjtcbiAgICBjb25zdCBsaXN0ID0gQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50W0NvbW1hbmRsaW5lTGlzdHMuY3VycmVudC5sZW5ndGggLSAxXTtcbiAgICAkLmVhY2gobGlzdC5saXN0LCAoX2luZGV4LCBvYmopID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBpZiAob2JqLmZvdW5kICYmIChvYmouYXZhaWxhYmxlICE9PSB1bmRlZmluZWQgPyBvYmouYXZhaWxhYmxlKCkgOiB0cnVlKSkge1xuICAgICAgICAgICAgbGV0IGljb24gPSAoX2EgPSBvYmouaWNvbikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCJmYS1jaGV2cm9uLXJpZ2h0XCI7XG4gICAgICAgICAgICBjb25zdCBmYUljb24gPSAvXmZhLS9nLnRlc3QoaWNvbik7XG4gICAgICAgICAgICBpZiAoIWZhSWNvbikge1xuICAgICAgICAgICAgICAgIGljb24gPSBgPGRpdiBjbGFzcz1cInRleHRJY29uXCI+JHtpY29ufTwvZGl2PmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpY29uID0gYDxpIGNsYXNzPVwiZmFzIGZhLWZ3ICR7aWNvbn1cIj48L2k+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChsaXN0LmNvbmZpZ0tleSkge1xuICAgICAgICAgICAgICAgIGlmICgob2JqLmNvbmZpZ1ZhbHVlTW9kZSAmJlxuICAgICAgICAgICAgICAgICAgICBvYmouY29uZmlnVmFsdWVNb2RlID09PSBcImluY2x1ZGVcIiAmJlxuICAgICAgICAgICAgICAgICAgICAvLyB0b2RvIGZpZ3VyZSB0aGlzIG91dCB3aXRob3V0IHVzaW5nIGFueVxuICAgICAgICAgICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0W2xpc3QuY29uZmlnS2V5XS5pbmNsdWRlcyhvYmouY29uZmlnVmFsdWUpKSB8fFxuICAgICAgICAgICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0W2xpc3QuY29uZmlnS2V5XSA9PT0gb2JqLmNvbmZpZ1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGljb24gPSBgPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtY2hlY2tcIj48L2k+YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGljb24gPSBgPGkgY2xhc3M9XCJmYXMgZmEtZndcIj48L2k+YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgaWNvbkhUTUwgPSBgPGRpdiBjbGFzcz1cImljb25cIj4ke2ljb259PC9kaXY+YDtcbiAgICAgICAgICAgIGlmIChvYmoubm9JY29uICYmICFpc1NpbmdsZUxpc3RDb21tYW5kTGluZUFjdGl2ZSgpKSB7XG4gICAgICAgICAgICAgICAgaWNvbkhUTUwgPSBcIlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29tbWFuZHNIVE1MICs9IGA8ZGl2IGNsYXNzPVwiZW50cnlcIiBjb21tYW5kPVwiJHtvYmouaWR9XCI+JHtpY29uSFRNTH08ZGl2PiR7b2JqLmRpc3BsYXl9PC9kaXY+PC9kaXY+YDtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgICQoXCIjY29tbWFuZExpbmUgLnN1Z2dlc3Rpb25zXCIpLmh0bWwoY29tbWFuZHNIVE1MKTtcbiAgICBpZiAoJChcIiNjb21tYW5kTGluZSAuc3VnZ2VzdGlvbnMgLmVudHJ5XCIpLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICQoXCIjY29tbWFuZExpbmUgLnNlcGFyYXRvclwiKS5jc3MoeyBoZWlnaHQ6IDAsIG1hcmdpbjogMCB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIjY29tbWFuZExpbmUgLnNlcGFyYXRvclwiKS5jc3Moe1xuICAgICAgICAgICAgaGVpZ2h0OiBcIjFweFwiLFxuICAgICAgICAgICAgXCJtYXJnaW4tYm90dG9tXCI6IFwiLjVyZW1cIixcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGVudHJpZXMgPSAkKFwiI2NvbW1hbmRMaW5lIC5zdWdnZXN0aW9ucyAuZW50cnlcIik7XG4gICAgaWYgKGVudHJpZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAkKGVudHJpZXNbMF0pLmFkZENsYXNzKFwiYWN0aXZlS2V5Ym9hcmRcIik7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAkLmVhY2gobGlzdC5saXN0LCAoX2luZGV4LCBvYmopID0+IHtcbiAgICAgICAgICAgICAgICBpZiAob2JqLmZvdW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgoIS90aGVtZS9naS50ZXN0KG9iai5pZCkgfHwgb2JqLmlkID09PSBcInRvZ2dsZUN1c3RvbVRoZW1lXCIpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAhVGhlbWVDb250cm9sbGVyLnJhbmRvbVRoZW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBUaGVtZUNvbnRyb2xsZXIuY2xlYXJQcmV2aWV3KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCEvZm9udC9naS50ZXN0KG9iai5pZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5wcmV2aWV3Rm9udEZhbWlseShjb25maWdfMS5kZWZhdWx0LmZvbnRGYW1pbHkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmouaG92ZXIpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouaG92ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgfVxuICAgIH1cbiAgICAkKFwiI2NvbW1hbmRMaW5lIC5saXN0VGl0bGVcIikucmVtb3ZlKCk7XG59XG5mdW5jdGlvbiB1cGRhdGVTdWdnZXN0ZWQoKSB7XG4gICAgY29uc3QgaW5wdXRWYWwgPSAkKFwiI2NvbW1hbmRMaW5lIGlucHV0XCIpLnZhbCgpXG4gICAgICAgIC50b0xvd2VyQ2FzZSgpXG4gICAgICAgIC5zcGxpdChcIiBcIilcbiAgICAgICAgLmZpbHRlcigocywgaSkgPT4gcyB8fCBpID09IDApOyAvL3JlbW92ZSBlbXB0eSBlbnRyaWVzIGFmdGVyIGZpcnN0XG4gICAgY29uc3QgbGlzdCA9IENvbW1hbmRsaW5lTGlzdHMuY3VycmVudFtDb21tYW5kbGluZUxpc3RzLmN1cnJlbnQubGVuZ3RoIC0gMV07XG4gICAgaWYgKGlucHV0VmFsWzBdID09PSBcIlwiICYmXG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQuc2luZ2xlTGlzdENvbW1hbmRMaW5lID09PSBcIm9uXCIgJiZcbiAgICAgICAgQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAkLmVhY2gobGlzdC5saXN0LCAoX2luZGV4LCBvYmopID0+IHtcbiAgICAgICAgICAgIG9iai5mb3VuZCA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgICAgc2hvd0ZvdW5kKCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy9pZ25vcmUgdGhlIHByZWNlZWRpbmcgXCI+XCJzIGluIHRoZSBjb21tYW5kIGxpbmUgaW5wdXRcbiAgICBpZiAoaW5wdXRWYWxbMF0gJiYgaW5wdXRWYWxbMF1bMF0gPT0gXCI+XCIpIHtcbiAgICAgICAgaW5wdXRWYWxbMF0gPSBpbnB1dFZhbFswXS5yZXBsYWNlKC9ePisvLCBcIlwiKTtcbiAgICB9XG4gICAgaWYgKGlucHV0VmFsWzBdID09IFwiXCIgJiYgaW5wdXRWYWwubGVuZ3RoID09IDEpIHtcbiAgICAgICAgJC5lYWNoKGxpc3QubGlzdCwgKF9pbmRleCwgb2JqKSA9PiB7XG4gICAgICAgICAgICBpZiAob2JqLnZpc2libGUgIT09IGZhbHNlKVxuICAgICAgICAgICAgICAgIG9iai5mb3VuZCA9IHRydWU7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJC5lYWNoKGxpc3QubGlzdCwgKF9pbmRleCwgb2JqKSA9PiB7XG4gICAgICAgICAgICBsZXQgZm91bmRjb3VudCA9IDA7XG4gICAgICAgICAgICAkLmVhY2goaW5wdXRWYWwsIChfaW5kZXgyLCBvYmoyKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG9iajIgPT0gXCJcIilcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGNvbnN0IGVzY2FwZWQgPSBvYmoyLnJlcGxhY2UoL1stW1xcXXt9KCkqKz8uLFxcXFxeJHwjXFxzXS9nLCBcIlxcXFwkJlwiKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZSA9IG5ldyBSZWdFeHAoXCJcXFxcYlwiICsgZXNjYXBlZCwgXCJnXCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IG9iai5kaXNwbGF5LnRvTG93ZXJDYXNlKCkubWF0Y2gocmUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlczIgPSBvYmouYWxpYXMgIT09IHVuZGVmaW5lZCA/IG9iai5hbGlhcy50b0xvd2VyQ2FzZSgpLm1hdGNoKHJlKSA6IG51bGw7XG4gICAgICAgICAgICAgICAgaWYgKChyZXMgIT0gbnVsbCAmJiByZXMubGVuZ3RoID4gMCkgfHxcbiAgICAgICAgICAgICAgICAgICAgKHJlczIgIT0gbnVsbCAmJiByZXMyLmxlbmd0aCA+IDApKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvdW5kY291bnQrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZvdW5kY291bnQtLTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChmb3VuZGNvdW50ID4gaW5wdXRWYWwubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgIG9iai5mb3VuZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBvYmouZm91bmQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHNob3dGb3VuZCgpO1xufVxubGV0IHNob3cgPSAoKSA9PiB7XG4gICAgaWYgKCEkKFwiLnBhZ2UucGFnZUxvYWRpbmdcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpXG4gICAgICAgIHJldHVybjtcbiAgICBGb2N1cy5zZXQoZmFsc2UpO1xuICAgICQoXCIjY29tbWFuZExpbmVcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgJChcIiNjb21tYW5kSW5wdXRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgaWYgKCQoXCIjY29tbWFuZExpbmVXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjY29tbWFuZExpbmVXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgfSwgMTAwKTtcbiAgICB9XG4gICAgJChcIiNjb21tYW5kTGluZSBpbnB1dFwiKS52YWwoXCJcIik7XG4gICAgQ29tbWFuZGxpbmVMaXN0cy51cGRhdGVUaGVtZUNvbW1hbmRzKCk7XG4gICAgdXBkYXRlU3VnZ2VzdGVkKCk7XG4gICAgJChcIiNjb21tYW5kTGluZSBpbnB1dFwiKS50cmlnZ2VyKFwiZm9jdXNcIik7XG59O1xuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoc2hvdWxkRm9jdXNUZXN0VUkgPSB0cnVlKSB7XG4gICAgVXBkYXRlQ29uZmlnLnByZXZpZXdGb250RmFtaWx5KGNvbmZpZ18xLmRlZmF1bHQuZm9udEZhbWlseSk7XG4gICAgLy8gYXBwbHlDdXN0b21UaGVtZUNvbG9ycygpO1xuICAgIGlmICghVGhlbWVDb250cm9sbGVyLnJhbmRvbVRoZW1lKSB7XG4gICAgICAgIFRoZW1lQ29udHJvbGxlci5jbGVhclByZXZpZXcoKTtcbiAgICB9XG4gICAgJChcIiNjb21tYW5kTGluZVdyYXBwZXJcIilcbiAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiAwLFxuICAgIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAkKFwiI2NvbW1hbmRMaW5lV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiNjb21tYW5kTGluZVwiKS5yZW1vdmVDbGFzcyhcImFsbENvbW1hbmRzXCIpO1xuICAgICAgICBpZiAoc2hvdWxkRm9jdXNUZXN0VUkpIHtcbiAgICAgICAgICAgIFRlc3RVSS5mb2N1c1dvcmRzKCk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoc2hvdWxkRm9jdXNUZXN0VUkpIHtcbiAgICAgICAgVGVzdFVJLmZvY3VzV29yZHMoKTtcbiAgICB9XG59XG5mdW5jdGlvbiB0cmlnZ2VyKGNvbW1hbmQpIHtcbiAgICBsZXQgc3ViZ3JvdXAgPSBmYWxzZTtcbiAgICBsZXQgaW5wdXQgPSBmYWxzZTtcbiAgICBsZXQgc2hvdWxkRm9jdXNUZXN0VUkgPSB0cnVlO1xuICAgIGNvbnN0IGxpc3QgPSBDb21tYW5kbGluZUxpc3RzLmN1cnJlbnRbQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50Lmxlbmd0aCAtIDFdO1xuICAgIGxldCBzdGlja3kgPSBmYWxzZTtcbiAgICAkLmVhY2gobGlzdC5saXN0LCAoX2luZGV4LCBvYmopID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBpZiAob2JqLmlkID09IGNvbW1hbmQpIHtcbiAgICAgICAgICAgIGlmIChvYmouc2hvdWxkRm9jdXNUZXN0VUkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHNob3VsZEZvY3VzVGVzdFVJID0gb2JqLnNob3VsZEZvY3VzVGVzdFVJO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9iai5pbnB1dCkge1xuICAgICAgICAgICAgICAgIGlucHV0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBjb25zdCBlc2NhcGVkID0gKF9hID0gb2JqLmRpc3BsYXkuc3BsaXQoXCI8L2k+XCIpWzFdKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBvYmouZGlzcGxheTtcbiAgICAgICAgICAgICAgICBzaG93SW5wdXQob2JqLmlkLCBlc2NhcGVkLCBvYmouZGVmYXVsdFZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG9iai5zdWJncm91cCkge1xuICAgICAgICAgICAgICAgIHN1Ymdyb3VwID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAob2JqLmJlZm9yZVN1Ymdyb3VwKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5iZWZvcmVTdWJncm91cCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBDb21tYW5kbGluZUxpc3RzLmN1cnJlbnQucHVzaChvYmouc3ViZ3JvdXApO1xuICAgICAgICAgICAgICAgICgwLCBleHBvcnRzLnNob3cpKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqLmV4ZWMpXG4gICAgICAgICAgICAgICAgICAgIG9iai5leGVjKCk7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5zdGlja3kgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RpY2t5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoIXN1Ymdyb3VwICYmICFpbnB1dCAmJiAhc3RpY2t5KSB7XG4gICAgICAgIEFuYWx5dGljc0NvbnRyb2xsZXIubG9nKFwidXNlZENvbW1hbmRMaW5lXCIsIHsgY29tbWFuZCB9KTtcbiAgICAgICAgaGlkZShzaG91bGRGb2N1c1Rlc3RVSSk7XG4gICAgfVxufVxuLy90b2RvIHJld3JpdGUgdGhpcyBtZXNzXG5mdW5jdGlvbiBhZGRDaGlsZENvbW1hbmRzKHVuaWZpZWRDb21tYW5kcywgY29tbWFuZEl0ZW0sIHBhcmVudENvbW1hbmREaXNwbGF5ID0gXCJcIiwgcGFyZW50Q29tbWFuZCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgbGV0IGNvbW1hbmRJdGVtRGlzcGxheSA9IGNvbW1hbmRJdGVtLmRpc3BsYXkucmVwbGFjZSgvXFxzP1xcLlxcLlxcLiQvZywgXCJcIik7XG4gICAgbGV0IGljb24gPSBgPGkgY2xhc3M9XCJmYXMgZmEtZndcIj48L2k+YDtcbiAgICBpZiAoY29tbWFuZEl0ZW0uY29uZmlnVmFsdWUgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICBjb25maWdfMS5kZWZhdWx0W3BhcmVudENvbW1hbmQgPT09IG51bGwgfHwgcGFyZW50Q29tbWFuZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcGFyZW50Q29tbWFuZC5jb25maWdLZXldID09PVxuICAgICAgICAgICAgY29tbWFuZEl0ZW0uY29uZmlnVmFsdWUpIHtcbiAgICAgICAgaWNvbiA9IGA8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1jaGVja1wiPjwvaT5gO1xuICAgIH1cbiAgICBpZiAoY29tbWFuZEl0ZW0ubm9JY29uKSB7XG4gICAgICAgIGljb24gPSBcIlwiO1xuICAgIH1cbiAgICBpZiAocGFyZW50Q29tbWFuZERpc3BsYXkpIHtcbiAgICAgICAgY29tbWFuZEl0ZW1EaXNwbGF5ID1cbiAgICAgICAgICAgIHBhcmVudENvbW1hbmREaXNwbGF5ICsgXCIgPiBcIiArIGljb24gKyBjb21tYW5kSXRlbURpc3BsYXk7XG4gICAgfVxuICAgIGlmIChjb21tYW5kSXRlbS5zdWJncm91cCkge1xuICAgICAgICBjb25zdCBjb21tYW5kID0gY29tbWFuZEl0ZW07XG4gICAgICAgIGlmIChjb21tYW5kLmJlZm9yZVN1Ymdyb3VwKVxuICAgICAgICAgICAgY29tbWFuZC5iZWZvcmVTdWJncm91cCgpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgKF9iID0gKChfYSA9IGNvbW1hbmRJdGVtKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3ViZ3JvdXApLmxpc3QpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5mb3JFYWNoKChjbWQpID0+IHtcbiAgICAgICAgICAgICAgICBjb21tYW5kSXRlbS5jb25maWdLZXkgPSBjb21tYW5kSXRlbVxuICAgICAgICAgICAgICAgICAgICAuc3ViZ3JvdXAuY29uZmlnS2V5O1xuICAgICAgICAgICAgICAgIGFkZENoaWxkQ29tbWFuZHModW5pZmllZENvbW1hbmRzLCBjbWQsIGNvbW1hbmRJdGVtRGlzcGxheSwgY29tbWFuZEl0ZW0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBjb21tYW5kSXRlbS5leGVjKCk7XG4gICAgICAgICAgICAvLyBjb25zdCBjdXJyZW50Q29tbWFuZHNJbmRleCA9IENvbW1hbmRsaW5lTGlzdHMuY3VycmVudC5sZW5ndGggLSAxO1xuICAgICAgICAgICAgLy8gQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50W2N1cnJlbnRDb21tYW5kc0luZGV4XS5saXN0LmZvckVhY2goKGNtZCkgPT4ge1xuICAgICAgICAgICAgLy8gICBpZiAoY21kLmFsaWFzID09PSB1bmRlZmluZWQpIGNtZC5hbGlhcyA9IGNvbW1hbmRJdGVtLmFsaWFzO1xuICAgICAgICAgICAgLy8gICBhZGRDaGlsZENvbW1hbmRzKHVuaWZpZWRDb21tYW5kcywgY21kLCBjb21tYW5kSXRlbURpc3BsYXkpO1xuICAgICAgICAgICAgLy8gfSk7XG4gICAgICAgICAgICAvLyBDb21tYW5kbGluZUxpc3RzLmN1cnJlbnQucG9wKCk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgdGVtcENvbW1hbmRJdGVtID0gT2JqZWN0LmFzc2lnbih7fSwgY29tbWFuZEl0ZW0pO1xuICAgICAgICBpZiAocGFyZW50Q29tbWFuZCkge1xuICAgICAgICAgICAgdGVtcENvbW1hbmRJdGVtLmljb24gPSBwYXJlbnRDb21tYW5kLmljb247XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhcmVudENvbW1hbmREaXNwbGF5KVxuICAgICAgICAgICAgdGVtcENvbW1hbmRJdGVtLmRpc3BsYXkgPSBjb21tYW5kSXRlbURpc3BsYXk7XG4gICAgICAgIHVuaWZpZWRDb21tYW5kcy5wdXNoKHRlbXBDb21tYW5kSXRlbSk7XG4gICAgfVxufVxuZnVuY3Rpb24gZ2VuZXJhdGVTaW5nbGVMaXN0T2ZDb21tYW5kcygpIHtcbiAgICBjb25zdCBhbGxDb21tYW5kcyA9IFtdO1xuICAgIGNvbnN0IG9sZFNob3dDb21tYW5kTGluZSA9IGV4cG9ydHMuc2hvdztcbiAgICBleHBvcnRzLnNob3cgPSAoKSA9PiB7XG4gICAgICAgIC8vXG4gICAgfTtcbiAgICBDb21tYW5kbGluZUxpc3RzLmRlZmF1bHRDb21tYW5kcy5saXN0LmZvckVhY2goKGMpID0+IGFkZENoaWxkQ29tbWFuZHMoYWxsQ29tbWFuZHMsIGMpKTtcbiAgICBleHBvcnRzLnNob3cgPSBvbGRTaG93Q29tbWFuZExpbmU7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdGl0bGU6IFwiQWxsIENvbW1hbmRzXCIsXG4gICAgICAgIGxpc3Q6IGFsbENvbW1hbmRzLFxuICAgIH07XG59XG5mdW5jdGlvbiB1c2VTaW5nbGVMaXN0Q29tbWFuZExpbmUoc3Nob3cgPSB0cnVlKSB7XG4gICAgY29uc3QgYWxsQ29tbWFuZHMgPSBnZW5lcmF0ZVNpbmdsZUxpc3RPZkNvbW1hbmRzKCk7XG4gICAgLy8gaWYgKENvbmZpZy5zaW5nbGVMaXN0Q29tbWFuZExpbmUgPT0gXCJtYW51YWxcIikge1xuICAgIC8vIENvbW1hbmRsaW5lTGlzdHMucHVzaEN1cnJlbnQoYWxsQ29tbWFuZHMpO1xuICAgIC8vIH0gZWxzZSBpZiAoQ29uZmlnLnNpbmdsZUxpc3RDb21tYW5kTGluZSA9PSBcIm9uXCIpIHtcbiAgICBDb21tYW5kbGluZUxpc3RzLnNldEN1cnJlbnQoW2FsbENvbW1hbmRzXSk7XG4gICAgLy8gfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnNpbmdsZUxpc3RDb21tYW5kTGluZSAhPSBcIm1hbnVhbFwiKSB7XG4gICAgICAgICQoXCIjY29tbWFuZExpbmVcIikuYWRkQ2xhc3MoXCJhbGxDb21tYW5kc1wiKTtcbiAgICB9XG4gICAgaWYgKHNzaG93KVxuICAgICAgICAoMCwgZXhwb3J0cy5zaG93KSgpO1xufVxuZnVuY3Rpb24gcmVzdG9yZU9sZENvbW1hbmRMaW5lKHNzaG93ID0gdHJ1ZSkge1xuICAgIGlmIChpc1NpbmdsZUxpc3RDb21tYW5kTGluZUFjdGl2ZSgpKSB7XG4gICAgICAgICQoXCIjY29tbWFuZExpbmVcIikucmVtb3ZlQ2xhc3MoXCJhbGxDb21tYW5kc1wiKTtcbiAgICAgICAgQ29tbWFuZGxpbmVMaXN0cy5zZXRDdXJyZW50KENvbW1hbmRsaW5lTGlzdHMuY3VycmVudC5maWx0ZXIoKGwpID0+IGwudGl0bGUgIT0gXCJBbGwgQ29tbWFuZHNcIikpO1xuICAgICAgICBpZiAoQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50Lmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgIENvbW1hbmRsaW5lTGlzdHMuc2V0Q3VycmVudChbQ29tbWFuZGxpbmVMaXN0cy5kZWZhdWx0Q29tbWFuZHNdKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoc3Nob3cpXG4gICAgICAgICgwLCBleHBvcnRzLnNob3cpKCk7XG59XG4kKFwiI2NvbW1hbmRMaW5lIGlucHV0XCIpLmtleXVwKChlKSA9PiB7XG4gICAgY29tbWFuZExpbmVNb3VzZU1vZGUgPSBmYWxzZTtcbiAgICAkKFwiI2NvbW1hbmRMaW5lV3JhcHBlciAjY29tbWFuZExpbmUgLnN1Z2dlc3Rpb25zIC5lbnRyeVwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZU1vdXNlXCIpO1xuICAgIGlmIChlLmtleSA9PT0gXCJBcnJvd1VwXCIgfHxcbiAgICAgICAgZS5rZXkgPT09IFwiQXJyb3dEb3duXCIgfHxcbiAgICAgICAgZS5rZXkgPT09IFwiRW50ZXJcIiB8fFxuICAgICAgICBlLmtleSA9PT0gXCJUYWJcIiB8fFxuICAgICAgICBlLmNvZGUgPT0gXCJBbHRMZWZ0XCIgfHxcbiAgICAgICAgKGUua2V5Lmxlbmd0aCA+IDEgJiYgZS5rZXkgIT09IFwiQmFja3NwYWNlXCIgJiYgZS5rZXkgIT09IFwiRGVsZXRlXCIpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdXBkYXRlU3VnZ2VzdGVkKCk7XG59KTtcbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcbiAgICAkKGRvY3VtZW50KS5vbihcImtleWRvd25cIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgIGlmIChQYWdlVHJhbnNpdGlvbi5nZXQoKSlcbiAgICAgICAgICAgIHJldHVybiBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAvLyBvcGVucyBjb21tYW5kIGxpbmUgaWYgZXNjYXBlLCBjdHJsL2NtZCArIHNoaWZ0ICsgcCwgb3IgdGFiIGlzIHByZXNzZWQgaWYgdGhlIHNldHRpbmcgc3dhcEVzY0FuZFRhYiBpcyBlbmFibGVkXG4gICAgICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIgfHxcbiAgICAgICAgICAgIChldmVudC5rZXkgJiZcbiAgICAgICAgICAgICAgICBldmVudC5rZXkudG9Mb3dlckNhc2UoKSA9PT0gXCJwXCIgJiZcbiAgICAgICAgICAgICAgICAoZXZlbnQubWV0YUtleSB8fCBldmVudC5jdHJsS2V5KSAmJlxuICAgICAgICAgICAgICAgIGV2ZW50LnNoaWZ0S2V5KSB8fFxuICAgICAgICAgICAgKGV2ZW50LmtleSA9PT0gXCJUYWJcIiAmJiBjb25maWdfMS5kZWZhdWx0LnN3YXBFc2NBbmRUYWIpKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgY29uc3QgcG9wdXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5wb3B1cFdyYXBwZXJcIik7XG4gICAgICAgICAgICBsZXQgcG9wdXBWaXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHBvcHVwIG9mIHBvcHVwcykge1xuICAgICAgICAgICAgICAgIGlmICghcG9wdXAuY2xhc3NMaXN0LmNvbnRhaW5zKFwiaGlkZGVuXCIpID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHBvcHVwVmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwb3B1cFZpc2libGUpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKCEkKFwiI2NvbW1hbmRMaW5lV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAgICAgICAgIGlmIChDb21tYW5kbGluZUxpc3RzLmN1cnJlbnQubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICBDb21tYW5kbGluZUxpc3RzLmN1cnJlbnQucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICQoXCIjY29tbWFuZExpbmVcIikucmVtb3ZlQ2xhc3MoXCJhbGxDb21tYW5kc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgKDAsIGV4cG9ydHMuc2hvdykoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGhpZGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZvbnRGYW1pbHkoY29uZmlnXzEuZGVmYXVsdC5mb250RmFtaWx5LCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gXCJUYWJcIiB8fCAhY29uZmlnXzEuZGVmYXVsdC5zd2FwRXNjQW5kVGFiKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc2luZ2xlTGlzdENvbW1hbmRMaW5lID09IFwib25cIikge1xuICAgICAgICAgICAgICAgICAgICB1c2VTaW5nbGVMaXN0Q29tbWFuZExpbmUoZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgQ29tbWFuZGxpbmVMaXN0cy5zZXRDdXJyZW50KFtDb21tYW5kbGluZUxpc3RzLmRlZmF1bHRDb21tYW5kc10pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAoMCwgZXhwb3J0cy5zaG93KSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KTtcbiQoXCIjY29tbWFuZElucHV0IGlucHV0XCIpLm9uKFwia2V5ZG93blwiLCAoZSkgPT4ge1xuICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIC8vZW50ZXJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zdCBjb21tYW5kID0gJChcIiNjb21tYW5kSW5wdXQgaW5wdXRcIikuYXR0cihcImNvbW1hbmRcIik7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gJChcIiNjb21tYW5kSW5wdXQgaW5wdXRcIikudmFsKCk7XG4gICAgICAgIGNvbnN0IGxpc3QgPSBDb21tYW5kbGluZUxpc3RzLmN1cnJlbnRbQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50Lmxlbmd0aCAtIDFdO1xuICAgICAgICAkLmVhY2gobGlzdC5saXN0LCAoX2luZGV4LCBvYmopID0+IHtcbiAgICAgICAgICAgIGlmIChvYmouaWQgPT0gY29tbWFuZCkge1xuICAgICAgICAgICAgICAgIGlmIChvYmouZXhlYylcbiAgICAgICAgICAgICAgICAgICAgb2JqLmV4ZWModmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmIChvYmouc3ViZ3JvdXAgIT09IG51bGwgJiYgb2JqLnN1Ymdyb3VwICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPOiB3aGF0IGlzIHRoaXMgZm9yP1xuICAgICAgICAgICAgICAgICAgICAvLyBzdWJncm91cCA9IG9iai5zdWJncm91cDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBBbmFseXRpY3NDb250cm9sbGVyLmxvZyhcInVzZWRDb21tYW5kTGluZVwiLCB7IGNvbW1hbmQ6IGNvbW1hbmQgIT09IG51bGwgJiYgY29tbWFuZCAhPT0gdm9pZCAwID8gY29tbWFuZCA6IFwiXCIgfSk7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG4gICAgcmV0dXJuO1xufSk7XG4kKGRvY3VtZW50KS5vbihcIm1vdXNlbW92ZVwiLCAoKSA9PiB7XG4gICAgaWYgKCFjb21tYW5kTGluZU1vdXNlTW9kZSlcbiAgICAgICAgY29tbWFuZExpbmVNb3VzZU1vZGUgPSB0cnVlO1xufSk7XG4kKGRvY3VtZW50KS5vbihcIm1vdXNlZW50ZXJcIiwgXCIjY29tbWFuZExpbmVXcmFwcGVyICNjb21tYW5kTGluZSAuc3VnZ2VzdGlvbnMgLmVudHJ5XCIsIChlKSA9PiB7XG4gICAgaWYgKCFjb21tYW5kTGluZU1vdXNlTW9kZSlcbiAgICAgICAgcmV0dXJuO1xuICAgICQoZS50YXJnZXQpLmFkZENsYXNzKFwiYWN0aXZlTW91c2VcIik7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwibW91c2VsZWF2ZVwiLCBcIiNjb21tYW5kTGluZVdyYXBwZXIgI2NvbW1hbmRMaW5lIC5zdWdnZXN0aW9ucyAuZW50cnlcIiwgKGUpID0+IHtcbiAgICBpZiAoIWNvbW1hbmRMaW5lTW91c2VNb2RlKVxuICAgICAgICByZXR1cm47XG4gICAgJChlLnRhcmdldCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVNb3VzZVwiKTtcbn0pO1xuJChcIiNjb21tYW5kTGluZVdyYXBwZXIgI2NvbW1hbmRMaW5lIC5zdWdnZXN0aW9uc1wiKS5vbihcIm1vdXNlb3ZlclwiLCAoZSkgPT4ge1xuICAgIGlmICghY29tbWFuZExpbmVNb3VzZU1vZGUpXG4gICAgICAgIHJldHVybjtcbiAgICAvLyBjb25zb2xlLmxvZyhcImNsZWFyaW5nIGtleWJvYXJkIGFjdGl2ZVwiKTtcbiAgICAkKFwiI2NvbW1hbmRMaW5lV3JhcHBlciAjY29tbWFuZExpbmUgLnN1Z2dlc3Rpb25zIC5lbnRyeVwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZUtleWJvYXJkXCIpO1xuICAgIGNvbnN0IGhvdmVySWQgPSAkKGUudGFyZ2V0KS5hdHRyKFwiY29tbWFuZFwiKTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBsaXN0ID0gQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50W0NvbW1hbmRsaW5lTGlzdHMuY3VycmVudC5sZW5ndGggLSAxXTtcbiAgICAgICAgJC5lYWNoKGxpc3QubGlzdCwgKF9pbmRleCwgb2JqKSA9PiB7XG4gICAgICAgICAgICBpZiAob2JqLmlkID09IGhvdmVySWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoKCEvdGhlbWUvZ2kudGVzdChvYmouaWQpIHx8IG9iai5pZCA9PT0gXCJ0b2dnbGVDdXN0b21UaGVtZVwiKSAmJlxuICAgICAgICAgICAgICAgICAgICAhVGhlbWVDb250cm9sbGVyLnJhbmRvbVRoZW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIFRoZW1lQ29udHJvbGxlci5jbGVhclByZXZpZXcoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCEvZm9udC9naS50ZXN0KG9iai5pZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnByZXZpZXdGb250RmFtaWx5KGNvbmZpZ18xLmRlZmF1bHQuZm9udEZhbWlseSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvYmouaG92ZXIpXG4gICAgICAgICAgICAgICAgICAgIG9iai5ob3ZlcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHsgfVxufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI2NvbW1hbmRMaW5lV3JhcHBlciAjY29tbWFuZExpbmUgLnN1Z2dlc3Rpb25zIC5lbnRyeVwiLCAoZSkgPT4ge1xuICAgICQoXCIuc3VnZ2VzdGlvbnMgLmVudHJ5XCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlS2V5Ym9hcmRcIik7XG4gICAgdHJpZ2dlcigkKGUuY3VycmVudFRhcmdldCkuYXR0cihcImNvbW1hbmRcIikpO1xufSk7XG4kKFwiI2NvbW1hbmRMaW5lV3JhcHBlclwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJjb21tYW5kTGluZVdyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGb250RmFtaWx5KGNvbmZpZ18xLmRlZmF1bHQuZm9udEZhbWlseSwgdHJ1ZSk7XG4gICAgICAgIC8vIGlmIChDb25maWcuY3VzdG9tVGhlbWUgPT09IHRydWUpIHtcbiAgICAgICAgLy8gICBhcHBseUN1c3RvbVRoZW1lQ29sb3JzKCk7XG4gICAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAgIC8vICAgc2V0VGhlbWUoQ29uZmlnLnRoZW1lLCB0cnVlKTtcbiAgICAgICAgLy8gfVxuICAgIH1cbn0pO1xuLy9taWdodCBjb21lIGJhY2sgdG8gaXQgbGF0ZXJcbi8vIGZ1bmN0aW9uIHNoaWZ0Q29tbWFuZCgpe1xuLy8gICBsZXQgYWN0aXZlRW50cmllcyA9ICQoXCIjY29tbWFuZExpbmVXcmFwcGVyICNjb21tYW5kTGluZSAuc3VnZ2VzdGlvbnMgLmVudHJ5LmFjdGl2ZUtleWJvYXJkLCAjY29tbWFuZExpbmVXcmFwcGVyICNjb21tYW5kTGluZSAuc3VnZ2VzdGlvbnMgLmVudHJ5LmFjdGl2ZU1vdXNlXCIpO1xuLy8gICBhY3RpdmVFbnRyaWVzLmVhY2goKF9pbmRleCwgYWN0aXZlRW50cnkpID0+IHtcbi8vICAgICBsZXQgY29tbWFuZElkID0gYWN0aXZlRW50cnkuZ2V0QXR0cmlidXRlKCdjb21tYW5kJyk7XG4vLyAgICAgbGV0IGZvdW5kQ29tbWFuZCA9IG51bGw7XG4vLyAgICAgQ29tbWFuZGxpbmVMaXN0cy5kZWZhdWx0Q29tbWFuZHMubGlzdC5mb3JFYWNoKGNvbW1hbmQgPT4ge1xuLy8gICAgICAgaWYoZm91bmRDb21tYW5kID09PSBudWxsICYmIGNvbW1hbmQuaWQgPT09IGNvbW1hbmRJZCl7XG4vLyAgICAgICAgIGZvdW5kQ29tbWFuZCA9IGNvbW1hbmQ7XG4vLyAgICAgICB9XG4vLyAgICAgfSlcbi8vICAgICBpZihmb3VuZENvbW1hbmQuc2hpZnQpe1xuLy8gICAgICAgJChhY3RpdmVFbnRyeSkuZmluZCgnZGl2JykudGV4dChmb3VuZENvbW1hbmQuc2hpZnQuZGlzcGxheSk7XG4vLyAgICAgfVxuLy8gICB9KVxuLy8gfVxuLy8gbGV0IHNoaWZ0ZWRDb21tYW5kcyA9IGZhbHNlO1xuLy8gJChkb2N1bWVudCkub24oXCJrZXlkb3duXCIsIChlKSA9PiB7XG4vLyAgIGlmIChlLmtleSA9PT0gXCJTaGlmdFwiKSB7XG4vLyAgICAgaWYoc2hpZnRlZENvbW1hbmRzID09PSBmYWxzZSl7XG4vLyAgICAgICBzaGlmdGVkQ29tbWFuZHMgPSB0cnVlO1xuLy8gICAgICAgc2hpZnRDb21tYW5kKCk7XG4vLyAgICAgfVxuLy8gICB9XG4vLyB9KTtcbi8vICQoZG9jdW1lbnQpLmtleXVwKChlKSA9PiB7XG4vLyAgIGlmIChlLmtleSA9PT0gXCJTaGlmdFwiKSB7XG4vLyAgICAgc2hpZnRlZENvbW1hbmRzID0gZmFsc2U7XG4vLyAgIH1cbi8vIH0pO1xuJChkb2N1bWVudCkub24oXCJrZXlkb3duXCIsIChlKSA9PiB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICAvLyBpZiAoaXNQcmV2aWV3aW5nVGhlbWUpIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcImFwcGx5aW5nIHRoZW1lXCIpO1xuICAgIC8vIGFwcGx5Q3VzdG9tVGhlbWVDb2xvcnMoKTtcbiAgICAvLyBwcmV2aWV3VGhlbWUoQ29uZmlnLnRoZW1lLCBmYWxzZSk7XG4gICAgLy8gfVxuICAgIGlmICghJChcIiNjb21tYW5kTGluZVdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNjb21tYW5kTGluZSBpbnB1dFwiKS50cmlnZ2VyKFwiZm9jdXNcIik7XG4gICAgICAgIGlmIChlLmtleSA9PSBcIj5cIiAmJiBjb25maWdfMS5kZWZhdWx0LnNpbmdsZUxpc3RDb21tYW5kTGluZSA9PSBcIm1hbnVhbFwiKSB7XG4gICAgICAgICAgICBpZiAoIWlzU2luZ2xlTGlzdENvbW1hbmRMaW5lQWN0aXZlKCkpIHtcbiAgICAgICAgICAgICAgICB1c2VTaW5nbGVMaXN0Q29tbWFuZExpbmUoZmFsc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCQoXCIjY29tbWFuZExpbmUgaW5wdXRcIikudmFsKCkgPT0gXCI+XCIpIHtcbiAgICAgICAgICAgICAgICAvL3NvIHRoYXQgaXQgd2lsbCBpZ25vcmUgc3VjY2VlZGluZyBcIj5cIiB3aGVuIGlucHV0IGlzIGFscmVhZHkgXCI+XCJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChlLmtleSA9PT0gXCJCYWNrc3BhY2VcIiB8fCBlLmtleSA9PT0gXCJEZWxldGVcIikge1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5wdXRWYWwgPSAkKFwiI2NvbW1hbmRMaW5lIGlucHV0XCIpLnZhbCgpO1xuICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnNpbmdsZUxpc3RDb21tYW5kTGluZSA9PSBcIm1hbnVhbFwiICYmXG4gICAgICAgICAgICAgICAgICAgIGlzU2luZ2xlTGlzdENvbW1hbmRMaW5lQWN0aXZlKCkgJiZcbiAgICAgICAgICAgICAgICAgICAgaW5wdXRWYWxbMF0gIT09IFwiPlwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3RvcmVPbGRDb21tYW5kTGluZShmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgICAgIC8vZW50ZXJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbW1hbmQgPSAkKFwiLnN1Z2dlc3Rpb25zIC5lbnRyeS5hY3RpdmVLZXlib2FyZFwiKS5hdHRyKFwiY29tbWFuZFwiKTtcbiAgICAgICAgICAgIHRyaWdnZXIoY29tbWFuZCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUua2V5ID09PSBcIkFycm93VXBcIiB8fCBlLmtleSA9PT0gXCJBcnJvd0Rvd25cIiB8fCBlLmtleSA9PT0gXCJUYWJcIikge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgJChcIiNjb21tYW5kTGluZVdyYXBwZXIgI2NvbW1hbmRMaW5lIC5zdWdnZXN0aW9ucyAuZW50cnlcIikudW5iaW5kKFwibW91c2VlbnRlciBtb3VzZWxlYXZlXCIpO1xuICAgICAgICAgICAgY29uc3QgZW50cmllcyA9ICQoXCIuc3VnZ2VzdGlvbnMgLmVudHJ5XCIpO1xuICAgICAgICAgICAgbGV0IGFjdGl2ZW51bSA9IC0xO1xuICAgICAgICAgICAgbGV0IGhvdmVySWQ7XG4gICAgICAgICAgICAkLmVhY2goZW50cmllcywgKGluZGV4LCBvYmopID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoJChvYmopLmhhc0NsYXNzKFwiYWN0aXZlS2V5Ym9hcmRcIikpXG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZW51bSA9IGluZGV4O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoZS5rZXkgPT09IFwiQXJyb3dVcFwiIHx8IChlLmtleSA9PT0gXCJUYWJcIiAmJiBlLnNoaWZ0S2V5KSkge1xuICAgICAgICAgICAgICAgIGVudHJpZXMucmVtb3ZlQ2xhc3MoXCJhY3RpdmVLZXlib2FyZFwiKTtcbiAgICAgICAgICAgICAgICBpZiAoYWN0aXZlbnVtID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgJChlbnRyaWVzW2VudHJpZXMubGVuZ3RoIC0gMV0pLmFkZENsYXNzKFwiYWN0aXZlS2V5Ym9hcmRcIik7XG4gICAgICAgICAgICAgICAgICAgIGhvdmVySWQgPSAkKGVudHJpZXNbZW50cmllcy5sZW5ndGggLSAxXSkuYXR0cihcImNvbW1hbmRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKGVudHJpZXNbLS1hY3RpdmVudW1dKS5hZGRDbGFzcyhcImFjdGl2ZUtleWJvYXJkXCIpO1xuICAgICAgICAgICAgICAgICAgICBob3ZlcklkID0gJChlbnRyaWVzW2FjdGl2ZW51bV0pLmF0dHIoXCJjb21tYW5kXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlLmtleSA9PT0gXCJBcnJvd0Rvd25cIiB8fCAoZS5rZXkgPT09IFwiVGFiXCIgJiYgIWUuc2hpZnRLZXkpKSB7XG4gICAgICAgICAgICAgICAgZW50cmllcy5yZW1vdmVDbGFzcyhcImFjdGl2ZUtleWJvYXJkXCIpO1xuICAgICAgICAgICAgICAgIGlmIChhY3RpdmVudW0gKyAxID09IGVudHJpZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICQoZW50cmllc1swXSkuYWRkQ2xhc3MoXCJhY3RpdmVLZXlib2FyZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgaG92ZXJJZCA9ICQoZW50cmllc1swXSkuYXR0cihcImNvbW1hbmRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKGVudHJpZXNbKythY3RpdmVudW1dKS5hZGRDbGFzcyhcImFjdGl2ZUtleWJvYXJkXCIpO1xuICAgICAgICAgICAgICAgICAgICBob3ZlcklkID0gJChlbnRyaWVzW2FjdGl2ZW51bV0pLmF0dHIoXCJjb21tYW5kXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2Nyb2xsID0gTWF0aC5hYnMoKChfYSA9ICQoXCIuc3VnZ2VzdGlvbnNcIikub2Zmc2V0KCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50b3ApIC1cbiAgICAgICAgICAgICAgICAgICAgKChfYiA9ICQoXCIuZW50cnkuYWN0aXZlS2V5Ym9hcmRcIikub2Zmc2V0KCkpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50b3ApIC1cbiAgICAgICAgICAgICAgICAgICAgJChcIi5zdWdnZXN0aW9uc1wiKS5zY3JvbGxUb3AoKSkgLVxuICAgICAgICAgICAgICAgICAgICAkKFwiLnN1Z2dlc3Rpb25zXCIpLm91dGVySGVpZ2h0KCkgLyAyICtcbiAgICAgICAgICAgICAgICAgICAgJCgkKFwiLmVudHJ5XCIpWzBdKS5vdXRlckhlaWdodCgpO1xuICAgICAgICAgICAgICAgICQoXCIuc3VnZ2VzdGlvbnNcIikuc2Nyb2xsVG9wKHNjcm9sbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb3VsZCBub3Qgc2Nyb2xsIHN1Z2dlc3Rpb25zOiBcIiArIGUubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coYHNjcm9sbGluZyB0byAke3Njcm9sbH1gKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbGlzdCA9IENvbW1hbmRsaW5lTGlzdHMuY3VycmVudFtDb21tYW5kbGluZUxpc3RzLmN1cnJlbnQubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICAgICAgJC5lYWNoKGxpc3QubGlzdCwgKF9pbmRleCwgb2JqKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmouaWQgPT0gaG92ZXJJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCghL3RoZW1lL2dpLnRlc3Qob2JqLmlkKSB8fCBvYmouaWQgPT09IFwidG9nZ2xlQ3VzdG9tVGhlbWVcIikgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhVGhlbWVDb250cm9sbGVyLnJhbmRvbVRoZW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhlbWVDb250cm9sbGVyLmNsZWFyUHJldmlldygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEvZm9udC9naS50ZXN0KG9iai5pZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcucHJldmlld0ZvbnRGYW1pbHkoY29uZmlnXzEuZGVmYXVsdC5mb250RmFtaWx5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmouaG92ZXIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmhvdmVyKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7IH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm47XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjY29tbWFuZExpbmVNb2JpbGVCdXR0b25cIiwgKCkgPT4ge1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnNpbmdsZUxpc3RDb21tYW5kTGluZSA9PSBcIm9uXCIpIHtcbiAgICAgICAgdXNlU2luZ2xlTGlzdENvbW1hbmRMaW5lKGZhbHNlKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIENvbW1hbmRsaW5lTGlzdHMuc2V0Q3VycmVudChbQ29tbWFuZGxpbmVMaXN0cy5kZWZhdWx0Q29tbWFuZHNdKTtcbiAgICB9XG4gICAgKDAsIGV4cG9ydHMuc2hvdykoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNrZXltYXAgLnI1IC5rZXktc3BhY2VcIiwgKCkgPT4ge1xuICAgIENvbW1hbmRsaW5lTGlzdHMuc2V0Q3VycmVudChbQ29tbWFuZGxpbmVMaXN0cy5jb21tYW5kc0tleW1hcExheW91dHNdKTtcbiAgICAoMCwgZXhwb3J0cy5zaG93KSgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3Rlc3RNb2Rlc05vdGljZSAudGV4dC1idXR0b25cIiwgKGV2ZW50KSA9PiB7XG4gICAgY29uc3QgY29tbWFuZHMgPSBDb21tYW5kbGluZUxpc3RzLmdldExpc3QoJChldmVudC5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiY29tbWFuZHNcIikpO1xuICAgIGlmIChjb21tYW5kcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmICgkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJjb21tYW5kc1wiKSA9PT0gXCJjb21tYW5kc1RhZ3NcIikge1xuICAgICAgICAgICAgQ29tbWFuZGxpbmVMaXN0cy51cGRhdGVUYWdDb21tYW5kcygpO1xuICAgICAgICB9XG4gICAgICAgIENvbW1hbmRsaW5lTGlzdHMucHVzaEN1cnJlbnQoY29tbWFuZHMpO1xuICAgICAgICAoMCwgZXhwb3J0cy5zaG93KSgpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNib3R0b20gLmxlZnRyaWdodCAucmlnaHQgLmN1cnJlbnQtdGhlbWVcIiwgKGUpID0+IHtcbiAgICBpZiAoZS5zaGlmdEtleSkge1xuICAgICAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tVGhlbWUpIHtcbiAgICAgICAgICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAoREIuZ2V0U25hcHNob3QoKS5jdXN0b21UaGVtZXMubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIk5vIGN1c3RvbSB0aGVtZXMhXCIsIDApO1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWUoZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWVJZChcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBpZiAoIURCLmdldEN1c3RvbVRoZW1lQnlJZChDb25maWcuY3VzdG9tVGhlbWVJZCkpIHtcbiAgICAgICAgICAgICAgICAvLyAgIC8vIFR1cm4gb24gdGhlIGZpcnN0IGN1c3RvbSB0aGVtZVxuICAgICAgICAgICAgICAgIC8vICAgY29uc3QgZmlyc3RDdXN0b21UaGVtZUlkID0gREIuZ2V0U25hcHNob3QoKS5jdXN0b21UaGVtZXNbMF0uX2lkO1xuICAgICAgICAgICAgICAgIC8vICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lSWQoZmlyc3RDdXN0b21UaGVtZUlkKTtcbiAgICAgICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWUodHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lKGZhbHNlKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmN1c3RvbVRoZW1lKVxuICAgICAgICAgICAgQ29tbWFuZGxpbmVMaXN0cy51cGRhdGVDdXN0b21UaGVtZUxpc3RDb21tYW5kcygpO1xuICAgICAgICBDb21tYW5kbGluZUxpc3RzLnB1c2hDdXJyZW50KGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tVGhlbWVcbiAgICAgICAgICAgID8gQ29tbWFuZGxpbmVMaXN0cy5jdXN0b21UaGVtZUxpc3RDb21tYW5kc1xuICAgICAgICAgICAgOiBDb21tYW5kbGluZUxpc3RzLnRoZW1lQ29tbWFuZHMpO1xuICAgICAgICAoMCwgZXhwb3J0cy5zaG93KSgpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VBYm91dCAuYWJvdXRFbmFibGVBZHNcIiwgKCkgPT4ge1xuICAgIENvbW1hbmRsaW5lTGlzdHMucHVzaEN1cnJlbnQoQ29tbWFuZGxpbmVMaXN0cy5jb21tYW5kc0VuYWJsZUFkcyk7XG4gICAgKDAsIGV4cG9ydHMuc2hvdykoKTtcbn0pO1xuJChcIi5zdXBwb3J0QnV0dG9ucyAuYnV0dG9uLmFkc1wiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBDb21tYW5kbGluZUxpc3RzLnB1c2hDdXJyZW50KENvbW1hbmRsaW5lTGlzdHMuY29tbWFuZHNFbmFibGVBZHMpO1xuICAgICgwLCBleHBvcnRzLnNob3cpKCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmxvYWRDb25maWcgPSBleHBvcnRzLmFwcGx5ID0gZXhwb3J0cy5nZXRDU1MgPSB2b2lkIDA7XG5jb25zdCBVcGRhdGVDb25maWcgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBmaWx0ZXJzID0ge1xuICAgIGJsdXI6IHtcbiAgICAgICAgdmFsdWU6IDAsXG4gICAgICAgIGRlZmF1bHQ6IDAsXG4gICAgfSxcbiAgICBicmlnaHRuZXNzOiB7XG4gICAgICAgIHZhbHVlOiAxLFxuICAgICAgICBkZWZhdWx0OiAxLFxuICAgIH0sXG4gICAgc2F0dXJhdGU6IHtcbiAgICAgICAgdmFsdWU6IDEsXG4gICAgICAgIGRlZmF1bHQ6IDEsXG4gICAgfSxcbiAgICBvcGFjaXR5OiB7XG4gICAgICAgIHZhbHVlOiAxLFxuICAgICAgICBkZWZhdWx0OiAxLFxuICAgIH0sXG59O1xuZnVuY3Rpb24gZ2V0Q1NTKCkge1xuICAgIGxldCByZXQgPSBcIlwiO1xuICAgIE9iamVjdC5rZXlzKGZpbHRlcnMpLmZvckVhY2goKGZpbHRlcktleSkgPT4ge1xuICAgICAgICBjb25zdCBrZXkgPSBmaWx0ZXJLZXk7XG4gICAgICAgIGlmIChmaWx0ZXJzW2tleV0udmFsdWUgIT0gZmlsdGVyc1trZXldLmRlZmF1bHQpIHtcbiAgICAgICAgICAgIHJldCArPSBgJHtmaWx0ZXJLZXl9KCR7ZmlsdGVyc1trZXldLnZhbHVlfSR7ZmlsdGVyS2V5ID09IFwiYmx1clwiID8gXCJyZW1cIiA6IFwiXCJ9KSBgO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHJldDtcbn1cbmV4cG9ydHMuZ2V0Q1NTID0gZ2V0Q1NTO1xuZnVuY3Rpb24gYXBwbHkoKSB7XG4gICAgY29uc3QgZmlsdGVyQ1NTID0gZ2V0Q1NTKCk7XG4gICAgY29uc3QgY3NzID0ge1xuICAgICAgICBmaWx0ZXI6IGZpbHRlckNTUyxcbiAgICAgICAgd2lkdGg6IGBjYWxjKDEwMCUgKyAke2ZpbHRlcnMuYmx1ci52YWx1ZSAqIDR9cmVtKWAsXG4gICAgICAgIGhlaWdodDogYGNhbGMoMTAwJSArICR7ZmlsdGVycy5ibHVyLnZhbHVlICogNH1yZW0pYCxcbiAgICAgICAgbGVmdDogYC0ke2ZpbHRlcnMuYmx1ci52YWx1ZSAqIDJ9cmVtYCxcbiAgICAgICAgdG9wOiBgLSR7ZmlsdGVycy5ibHVyLnZhbHVlICogMn1yZW1gLFxuICAgICAgICBwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLFxuICAgIH07XG4gICAgJChcIi5jdXN0b21CYWNrZ3JvdW5kIGltZ1wiKS5jc3MoY3NzKTtcbn1cbmV4cG9ydHMuYXBwbHkgPSBhcHBseTtcbmZ1bmN0aW9uIHN5bmNTbGlkZXJzKCkge1xuICAgICQoXCIuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyIC5ibHVyIGlucHV0XCIpLnZhbChmaWx0ZXJzW1wiYmx1clwiXS52YWx1ZSk7XG4gICAgJChcIi5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgLmJyaWdodG5lc3MgaW5wdXRcIikudmFsKGZpbHRlcnNbXCJicmlnaHRuZXNzXCJdLnZhbHVlKTtcbiAgICAkKFwiLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlciAuc2F0dXJhdGUgaW5wdXRcIikudmFsKGZpbHRlcnNbXCJzYXR1cmF0ZVwiXS52YWx1ZSk7XG4gICAgJChcIi5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgLm9wYWNpdHkgaW5wdXRcIikudmFsKGZpbHRlcnNbXCJvcGFjaXR5XCJdLnZhbHVlKTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZU51bWJlcnMoKSB7XG4gICAgJChcIi5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgLmJsdXIgLnZhbHVlXCIpLmh0bWwoZmlsdGVycy5ibHVyLnZhbHVlLnRvRml4ZWQoMSkpO1xuICAgICQoXCIuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyIC5icmlnaHRuZXNzIC52YWx1ZVwiKS5odG1sKGZpbHRlcnMuYnJpZ2h0bmVzcy52YWx1ZS50b0ZpeGVkKDEpKTtcbiAgICAkKFwiLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlciAuc2F0dXJhdGUgLnZhbHVlXCIpLmh0bWwoZmlsdGVycy5zYXR1cmF0ZS52YWx1ZS50b0ZpeGVkKDEpKTtcbiAgICAkKFwiLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlciAub3BhY2l0eSAudmFsdWVcIikuaHRtbChmaWx0ZXJzLm9wYWNpdHkudmFsdWUudG9GaXhlZCgxKSk7XG59XG5mdW5jdGlvbiBsb2FkQ29uZmlnKGNvbmZpZykge1xuICAgIGZpbHRlcnMuYmx1ci52YWx1ZSA9IGNvbmZpZ1swXTtcbiAgICBmaWx0ZXJzLmJyaWdodG5lc3MudmFsdWUgPSBjb25maWdbMV07XG4gICAgZmlsdGVycy5zYXR1cmF0ZS52YWx1ZSA9IGNvbmZpZ1syXTtcbiAgICBmaWx0ZXJzLm9wYWNpdHkudmFsdWUgPSBjb25maWdbM107XG4gICAgdXBkYXRlTnVtYmVycygpO1xuICAgIHN5bmNTbGlkZXJzKCk7XG59XG5leHBvcnRzLmxvYWRDb25maWcgPSBsb2FkQ29uZmlnO1xuJChcIi5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgLmJsdXIgaW5wdXRcIikub24oXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgZmlsdGVyc1tcImJsdXJcIl0udmFsdWUgPSBwYXJzZUZsb2F0KCQoXCIuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyIC5ibHVyIGlucHV0XCIpLnZhbCgpKTtcbiAgICB1cGRhdGVOdW1iZXJzKCk7XG4gICAgYXBwbHkoKTtcbn0pO1xuJChcIi5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgLmJyaWdodG5lc3MgaW5wdXRcIikub24oXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgZmlsdGVyc1tcImJyaWdodG5lc3NcIl0udmFsdWUgPSBwYXJzZUZsb2F0KCQoXCIuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyIC5icmlnaHRuZXNzIGlucHV0XCIpLnZhbCgpKTtcbiAgICB1cGRhdGVOdW1iZXJzKCk7XG4gICAgYXBwbHkoKTtcbn0pO1xuJChcIi5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgLnNhdHVyYXRlIGlucHV0XCIpLm9uKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgIGZpbHRlcnNbXCJzYXR1cmF0ZVwiXS52YWx1ZSA9IHBhcnNlRmxvYXQoJChcIi5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgLnNhdHVyYXRlIGlucHV0XCIpLnZhbCgpKTtcbiAgICB1cGRhdGVOdW1iZXJzKCk7XG4gICAgYXBwbHkoKTtcbn0pO1xuJChcIi5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgLm9wYWNpdHkgaW5wdXRcIikub24oXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgZmlsdGVyc1tcIm9wYWNpdHlcIl0udmFsdWUgPSBwYXJzZUZsb2F0KCQoXCIuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyIC5vcGFjaXR5IGlucHV0XCIpLnZhbCgpKTtcbiAgICB1cGRhdGVOdW1iZXJzKCk7XG4gICAgYXBwbHkoKTtcbn0pO1xuJChcIi5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgIC5zYXZlLmJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjb25zdCBhcnIgPSBPYmplY3Qua2V5cyhmaWx0ZXJzKS5tYXAoKGZpbHRlcktleSkgPT4gZmlsdGVyc1tmaWx0ZXJLZXldLnZhbHVlKTtcbiAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tQmFja2dyb3VuZEZpbHRlcihhcnIsIGZhbHNlKTtcbiAgICBOb3RpZmljYXRpb25zLmFkZChcIkN1c3RvbSBiYWNrZ3JvdW5kIGZpbHRlcnMgc2F2ZWRcIiwgMSk7XG59KTtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXksIGV2ZW50VmFsdWUpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiY3VzdG9tQmFja2dyb3VuZEZpbHRlclwiKSB7XG4gICAgICAgIGxvYWRDb25maWcoZXZlbnRWYWx1ZS5tYXAoKGV2KSA9PiBwYXJzZUZsb2F0KGV2KSkpO1xuICAgICAgICBhcHBseSgpO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5yZWZyZXNoID0gZXhwb3J0cy5zaG93ID0gZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5mbGFzaEtleSA9IGV4cG9ydHMuaGlnaGxpZ2h0S2V5ID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBUaGVtZUNvbG9ycyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90aGVtZS1jb2xvcnNcIikpO1xuY29uc3QgU2xvd1RpbWVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvc2xvdy10aW1lclwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuZnVuY3Rpb24gaGlnaGxpZ2h0S2V5KGN1cnJlbnRLZXkpIHtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInplblwiKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKGN1cnJlbnRLZXkgPT09IFwiXCIpXG4gICAgICAgIGN1cnJlbnRLZXkgPSBcIiBcIjtcbiAgICB0cnkge1xuICAgICAgICBpZiAoJChcIi5hY3RpdmUta2V5XCIpICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgJChcIi5hY3RpdmUta2V5XCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlLWtleVwiKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgaGlnaGxpZ2h0S2V5O1xuICAgICAgICBpZiAoY3VycmVudEtleSA9PSBcIiBcIikge1xuICAgICAgICAgICAgaGlnaGxpZ2h0S2V5ID0gXCIja2V5bWFwIC5rZXktc3BhY2UsICNrZXltYXAgLmtleS1zcGxpdC1zcGFjZVwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGN1cnJlbnRLZXkgPT0gJ1wiJykge1xuICAgICAgICAgICAgaGlnaGxpZ2h0S2V5ID0gYCNrZXltYXAgLmtleW1hcC1rZXlbZGF0YS1rZXkqPScke2N1cnJlbnRLZXl9J11gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaGlnaGxpZ2h0S2V5ID0gYCNrZXltYXAgLmtleW1hcC1rZXlbZGF0YS1rZXkqPVwiJHtjdXJyZW50S2V5fVwiXWA7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coXCJoaWdobGlnaHRpbmdcIiwgaGlnaGxpZ2h0S2V5KTtcbiAgICAgICAgJChoaWdobGlnaHRLZXkpLmFkZENsYXNzKFwiYWN0aXZlLWtleVwiKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb3VsZCBub3QgdXBkYXRlIGhpZ2hsaWdodGVkIGtleW1hcCBrZXk6IFwiICsgZS5tZXNzYWdlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMuaGlnaGxpZ2h0S2V5ID0gaGlnaGxpZ2h0S2V5O1xuZnVuY3Rpb24gZmxhc2hLZXkoa2V5LCBjb3JyZWN0KSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKGtleSA9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmIChrZXkgPT0gXCIgXCIpIHtcbiAgICAgICAgICAgIGtleSA9IFwiI2tleW1hcCAua2V5LXNwYWNlLCAja2V5bWFwIC5rZXktc3BsaXQtc3BhY2VcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChrZXkgPT0gJ1wiJykge1xuICAgICAgICAgICAga2V5ID0gYCNrZXltYXAgLmtleW1hcC1rZXlbZGF0YS1rZXkqPScke2tleX0nXWA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBrZXkgPSBgI2tleW1hcCAua2V5bWFwLWtleVtkYXRhLWtleSo9XCIke2tleX1cIl1gO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRoZW1lY29sb3JzID0geWllbGQgVGhlbWVDb2xvcnMuZ2V0QWxsKCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoY29ycmVjdCB8fCBjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSkge1xuICAgICAgICAgICAgICAgICQoa2V5KVxuICAgICAgICAgICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IHRoZW1lY29sb3JzLmJnLFxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHRoZW1lY29sb3JzLm1haW4sXG4gICAgICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiB0aGVtZWNvbG9ycy5tYWluLFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IHRoZW1lY29sb3JzLnN1YixcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBcInRyYW5zcGFyZW50XCIsXG4gICAgICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiB0aGVtZWNvbG9ycy5zdWIsXG4gICAgICAgICAgICAgICAgfSwgU2xvd1RpbWVyLmdldCgpID8gMCA6IDUwMCwgXCJlYXNlT3V0RXhwb1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICQoa2V5KVxuICAgICAgICAgICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IHRoZW1lY29sb3JzLmJnLFxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHRoZW1lY29sb3JzLmVycm9yLFxuICAgICAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogdGhlbWVjb2xvcnMuZXJyb3IsXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogdGhlbWVjb2xvcnMuc3ViLFxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwidHJhbnNwYXJlbnRcIixcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IHRoZW1lY29sb3JzLnN1YixcbiAgICAgICAgICAgICAgICB9LCBTbG93VGltZXIuZ2V0KCkgPyAwIDogNTAwLCBcImVhc2VPdXRFeHBvXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZmxhc2hLZXkgPSBmbGFzaEtleTtcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgJChcIiNrZXltYXBcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuZnVuY3Rpb24gc2hvdygpIHtcbiAgICAkKFwiI2tleW1hcFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiByZWZyZXNoKGxheW91dE5hbWUgPSBjb25maWdfMS5kZWZhdWx0LmxheW91dCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmICghbGF5b3V0TmFtZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGxheW91dHMgPSB5aWVsZCBNaXNjLmdldExheW91dHNMaXN0KCk7XG4gICAgICAgICAgICBsZXQgbHRzID0gbGF5b3V0c1tsYXlvdXROYW1lXTsgLy9sYXlvdXQgdG8gc2hvd1xuICAgICAgICAgICAgbGV0IGxheW91dFN0cmluZyA9IGxheW91dE5hbWU7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBMYXlvdXQgPT09IFwib3ZlcnJpZGVTeW5jXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5sYXlvdXQgPT09IFwiZGVmYXVsdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGx0cyA9IGxheW91dHNbXCJxd2VydHlcIl07XG4gICAgICAgICAgICAgICAgICAgIGxheW91dFN0cmluZyA9IFwiZGVmYXVsdFwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbHRzID0gbGF5b3V0c1tjb25maWdfMS5kZWZhdWx0LmxheW91dF07XG4gICAgICAgICAgICAgICAgICAgIGxheW91dFN0cmluZyA9IGNvbmZpZ18xLmRlZmF1bHQubGF5b3V0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGx0cyA9IGxheW91dHNbY29uZmlnXzEuZGVmYXVsdC5rZXltYXBMYXlvdXRdO1xuICAgICAgICAgICAgICAgIGxheW91dFN0cmluZyA9IGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTGF5b3V0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgc2hvd1RvcFJvdyA9IGx0cy5rZXltYXBTaG93VG9wUm93O1xuICAgICAgICAgICAgY29uc3QgaXNNYXRyaXggPSBjb25maWdfMS5kZWZhdWx0LmtleW1hcFN0eWxlID09PSBcIm1hdHJpeFwiIHx8IGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwU3R5bGUgPT09IFwic3BsaXRfbWF0cml4XCI7XG4gICAgICAgICAgICBsZXQga2V5bWFwRWxlbWVudCA9IFwiXCI7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhsdHMua2V5cykuZm9yRWFjaCgocm93LCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvd0tleXMgPSBsdHMua2V5c1tyb3ddO1xuICAgICAgICAgICAgICAgIGxldCByb3dFbGVtZW50ID0gXCJcIjtcbiAgICAgICAgICAgICAgICBpZiAocm93ID09PSBcInJvdzFcIiAmJiAhc2hvd1RvcFJvdykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICgocm93ID09PSBcInJvdzJcIiB8fCByb3cgPT09IFwicm93M1wiIHx8IHJvdyA9PT0gXCJyb3c0XCIpICYmICFpc01hdHJpeCkge1xuICAgICAgICAgICAgICAgICAgICByb3dFbGVtZW50ICs9IFwiPGRpdj48L2Rpdj5cIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJvdyA9PT0gXCJyb3c0XCIgJiYgbHRzLnR5cGUgIT09IFwiaXNvXCIgJiYgIWlzTWF0cml4KSB7XG4gICAgICAgICAgICAgICAgICAgIHJvd0VsZW1lbnQgKz0gXCI8ZGl2PjwvZGl2PlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocm93ID09PSBcInJvdzVcIikge1xuICAgICAgICAgICAgICAgICAgICBsZXQgbGF5b3V0RGlzcGxheSA9IGxheW91dFN0cmluZy5yZXBsYWNlKC9fL2csIFwiIFwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTGVnZW5kU3R5bGUgPT09IFwiYmxhbmtcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGF5b3V0RGlzcGxheSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcm93RWxlbWVudCArPSBcIjxkaXY+PC9kaXY+XCI7XG4gICAgICAgICAgICAgICAgICAgIHJvd0VsZW1lbnQgKz0gYDxkaXYgY2xhc3M9XCJrZXltYXAta2V5IGtleS1zcGFjZVwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJsZXR0ZXJcIj4ke2xheW91dERpc3BsYXl9PC9kaXY+XG4gICAgICAgIDwvZGl2PmA7XG4gICAgICAgICAgICAgICAgICAgIHJvd0VsZW1lbnQgKz0gYDxkaXYgY2xhc3M9XCJrZXltYXAtc3BsaXQtc3BhY2VyXCI+PC9kaXY+YDtcbiAgICAgICAgICAgICAgICAgICAgcm93RWxlbWVudCArPSBgPGRpdiBjbGFzcz1cImtleW1hcC1rZXkga2V5LXNwbGl0LXNwYWNlXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImxldHRlclwiPjwvZGl2PlxuICAgICAgICA8L2Rpdj5gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb3dLZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93ID09PSBcInJvdzJcIiAmJiBpID09PSAxMilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBTdHlsZSA9PT0gXCJtYXRyaXhcIiB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwU3R5bGUgPT09IFwic3BsaXRfbWF0cml4XCIpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaSA+PSAxMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gcm93S2V5c1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1bXAgPSByb3cgPT09IFwicm93M1wiICYmIChpID09PSAzIHx8IGkgPT09IDYpID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGtleURpc3BsYXkgPSBrZXlbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBMZWdlbmRTdHlsZSA9PT0gXCJibGFua1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5RGlzcGxheSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LmtleW1hcExlZ2VuZFN0eWxlID09PSBcInVwcGVyY2FzZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5RGlzcGxheSA9IGtleURpc3BsYXkudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleUVsZW1lbnQgPSBgPGRpdiBjbGFzcz1cImtleW1hcC1rZXlcIiBkYXRhLWtleT1cIiR7a2V5LnJlcGxhY2UoJ1wiJywgXCImcXVvdDtcIil9XCI+XG4gICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibGV0dGVyXCI+JHtrZXlEaXNwbGF5fTwvc3Bhbj5cbiAgICAgICAgICAgICAgJHtidW1wID8gXCI8ZGl2IGNsYXNzPSdidW1wJz48L2Rpdj5cIiA6IFwiXCJ9XG4gICAgICAgICAgPC9kaXY+YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzcGxpdFNwYWNlciA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBTdHlsZSA9PT0gXCJzcGxpdFwiIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5rZXltYXBTdHlsZSA9PT0gXCJzcGxpdF9tYXRyaXhcIiB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwU3R5bGUgPT09IFwiYWxpY2VcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyb3cgPT09IFwicm93NFwiICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0LmtleW1hcFN0eWxlID09PSBcInNwbGl0XCIgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwU3R5bGUgPT09IFwiYWxpY2VcIikgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbHRzLnR5cGUgPT09IFwiaXNvXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IDYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwbGl0U3BhY2VyICs9IGA8ZGl2IGNsYXNzPVwia2V5bWFwLXNwbGl0LXNwYWNlclwiPjwvZGl2PmA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID09PSA1KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGxpdFNwYWNlciArPSBgPGRpdiBjbGFzcz1cImtleW1hcC1zcGxpdC1zcGFjZXJcIj48L2Rpdj5gO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwU3R5bGUgPT09IFwiYWxpY2VcIiAmJiByb3cgPT09IFwicm93NFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChsdHMudHlwZSA9PT0gXCJpc29cIiAmJiBpID09PSA2KSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobHRzLnR5cGUgIT09IFwiaXNvXCIgJiYgaSA9PT0gNSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BsaXRTcGFjZXIgKz0gYDxkaXYgY2xhc3M9XCJleHRyYS1rZXlcIj48c3BhbiBjbGFzcz1cImxldHRlclwiPjwvc3Bhbj48L2Rpdj5gO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJvd0VsZW1lbnQgKz0gc3BsaXRTcGFjZXIgKyBrZXlFbGVtZW50O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGtleW1hcEVsZW1lbnQgKz0gYDxkaXYgY2xhc3M9XCJyb3cgciR7aW5kZXggKyAxfVwiPiR7cm93RWxlbWVudH08L2Rpdj5gO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkKFwiI2tleW1hcFwiKS5odG1sKGtleW1hcEVsZW1lbnQpO1xuICAgICAgICAgICAgJChcIiNrZXltYXBcIikucmVtb3ZlQ2xhc3MoXCJzdGFnZ2VyZWRcIik7XG4gICAgICAgICAgICAkKFwiI2tleW1hcFwiKS5yZW1vdmVDbGFzcyhcIm1hdHJpeFwiKTtcbiAgICAgICAgICAgICQoXCIja2V5bWFwXCIpLnJlbW92ZUNsYXNzKFwic3BsaXRcIik7XG4gICAgICAgICAgICAkKFwiI2tleW1hcFwiKS5yZW1vdmVDbGFzcyhcInNwbGl0X21hdHJpeFwiKTtcbiAgICAgICAgICAgICQoXCIja2V5bWFwXCIpLnJlbW92ZUNsYXNzKFwiYWxpY2VcIik7XG4gICAgICAgICAgICAkKFwiI2tleW1hcFwiKS5hZGRDbGFzcyhjb25maWdfMS5kZWZhdWx0LmtleW1hcFN0eWxlKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic29tZXRoaW5nIHdlbnQgd3Jvbmcgd2hlbiBjaGFuZ2luZyBsYXlvdXQsIHJlc2V0dGluZ3M6IFwiICsgZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGVDb25maWcuc2V0S2V5bWFwTGF5b3V0KFwicXdlcnR5XCIsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLnJlZnJlc2ggPSByZWZyZXNoO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSkgPT4ge1xuICAgIGlmIChldmVudEtleSA9PT0gXCJsYXlvdXRcIiAmJiBjb25maWdfMS5kZWZhdWx0LmtleW1hcExheW91dCA9PT0gXCJvdmVycmlkZVN5bmNcIikge1xuICAgICAgICByZWZyZXNoKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTGF5b3V0KTtcbiAgICB9XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImtleW1hcExheW91dFwiIHx8IGV2ZW50S2V5ID09PSBcImtleW1hcFN0eWxlXCIpXG4gICAgICAgIHJlZnJlc2goKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5nZXRBY2MgPSBleHBvcnRzLmdldFdQTSA9IGV4cG9ydHMudXBkYXRlID0gdm9pZCAwO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBUZXN0V29yZHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC13b3Jkc1wiKSk7XG5sZXQgYXZlcmFnZVdQTSA9IDA7XG5sZXQgYXZlcmFnZUFjYyA9IDA7XG5mdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgbW9kZTIgPSBNaXNjLmdldE1vZGUyKGNvbmZpZ18xLmRlZmF1bHQsIFRlc3RXb3Jkcy5yYW5kb21RdW90ZSk7XG4gICAgICAgIGNvbnN0IFt3cG0sIGFjY10gPSAoeWllbGQgREIuZ2V0VXNlckF2ZXJhZ2UxMChjb25maWdfMS5kZWZhdWx0Lm1vZGUsIG1vZGUyLCBjb25maWdfMS5kZWZhdWx0LnB1bmN0dWF0aW9uLCBjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlLCBjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHksIGNvbmZpZ18xLmRlZmF1bHQubGF6eU1vZGUpKVxuICAgICAgICAgICAgLm1hcChNaXNjLnJvdW5kVG8yKVxuICAgICAgICAgICAgLm1hcCgobnVtKSA9PiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93RGVjaW1hbFBsYWNlcyA/IE1hdGgucm91bmQobnVtKSA6IG51bSkpO1xuICAgICAgICBhdmVyYWdlV1BNID0gd3BtO1xuICAgICAgICBhdmVyYWdlQWNjID0gYWNjO1xuICAgIH0pO1xufVxuZXhwb3J0cy51cGRhdGUgPSB1cGRhdGU7XG5mdW5jdGlvbiBnZXRXUE0oKSB7XG4gICAgcmV0dXJuIGF2ZXJhZ2VXUE07XG59XG5leHBvcnRzLmdldFdQTSA9IGdldFdQTTtcbmZ1bmN0aW9uIGdldEFjYygpIHtcbiAgICByZXR1cm4gYXZlcmFnZUFjYztcbn1cbmV4cG9ydHMuZ2V0QWNjID0gZ2V0QWNjO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zaG93ID0gZXhwb3J0cy5oaWRlID0gdm9pZCAwO1xuY29uc3QgYXBlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2FwZVwiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBmb3JtYXRfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiZGF0ZS1mbnMvZm9ybWF0XCIpKTtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi4vZmlyZWJhc2VcIik7XG5jb25zdCBjdXJyZW50TGVhZGVyYm9hcmQgPSBcInRpbWVfMTVcIjtcbmxldCBjdXJyZW50RGF0YSA9IHtcbiAgICAxNTogW10sXG4gICAgNjA6IFtdLFxufTtcbmxldCBjdXJyZW50UmFuayA9IHtcbiAgICAxNToge30sXG4gICAgNjA6IHt9LFxufTtcbmNvbnN0IHJlcXVlc3RpbmcgPSB7XG4gICAgMTU6IGZhbHNlLFxuICAgIDYwOiBmYWxzZSxcbn07XG5jb25zdCBsZWFkZXJib2FyZFNpbmdsZUxpbWl0ID0gNTA7XG5sZXQgdXBkYXRlVGltZXI7XG5mdW5jdGlvbiBjbGVhclRhYmxlKGxiKSB7XG4gICAgaWYgKGxiID09PSAxNSkge1xuICAgICAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgdGFibGUubGVmdCB0Ym9keVwiKS5lbXB0eSgpO1xuICAgICAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgdGFibGUubGVmdCB0Zm9vdFwiKS5lbXB0eSgpO1xuICAgIH1cbiAgICBlbHNlIGlmIChsYiA9PT0gNjApIHtcbiAgICAgICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyIHRhYmxlLnJpZ2h0IHRib2R5XCIpLmVtcHR5KCk7XG4gICAgICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciB0YWJsZS5yaWdodCB0Zm9vdFwiKS5lbXB0eSgpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHJlc2V0KCkge1xuICAgIGN1cnJlbnREYXRhID0ge1xuICAgICAgICAxNTogW10sXG4gICAgICAgIDYwOiBbXSxcbiAgICB9O1xuICAgIGN1cnJlbnRSYW5rID0ge1xuICAgICAgICAxNToge30sXG4gICAgICAgIDYwOiB7fSxcbiAgICB9O1xufVxuZnVuY3Rpb24gc3RvcFRpbWVyKCkge1xuICAgIGNsZWFySW50ZXJ2YWwodXBkYXRlVGltZXIpO1xuICAgIHVwZGF0ZVRpbWVyID0gdW5kZWZpbmVkO1xuICAgICQoXCIjbGVhZGVyYm9hcmRzIC5zdWJUaXRsZVwiKS50ZXh0KFwiTmV4dCB1cGRhdGUgaW46IC0tOi0tXCIpO1xufVxuZnVuY3Rpb24gdXBkYXRlVGltZXJFbGVtZW50KCkge1xuICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IG1pbnV0ZXNUb05leHRVcGRhdGUgPSAxNCAtIChkYXRlLmdldE1pbnV0ZXMoKSAlIDE1KTtcbiAgICBjb25zdCBzZWNvbmRzVG9OZXh0VXBkYXRlID0gNjAgLSBkYXRlLmdldFNlY29uZHMoKTtcbiAgICBjb25zdCB0b3RhbFNlY29uZHMgPSBtaW51dGVzVG9OZXh0VXBkYXRlICogNjAgKyBzZWNvbmRzVG9OZXh0VXBkYXRlO1xuICAgICQoXCIjbGVhZGVyYm9hcmRzIC5zdWJUaXRsZVwiKS50ZXh0KFwiTmV4dCB1cGRhdGUgaW46IFwiICsgTWlzYy5zZWNvbmRzVG9TdHJpbmcodG90YWxTZWNvbmRzLCB0cnVlKSk7XG59XG5mdW5jdGlvbiBzdGFydFRpbWVyKCkge1xuICAgIHVwZGF0ZVRpbWVyRWxlbWVudCgpO1xuICAgIHVwZGF0ZVRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICB1cGRhdGVUaW1lckVsZW1lbnQoKTtcbiAgICB9LCAxMDAwKTtcbn1cbmZ1bmN0aW9uIHNob3dMb2FkZXIobGIpIHtcbiAgICBpZiAobGIgPT09IDE1KSB7XG4gICAgICAgICQoYCNsZWFkZXJib2FyZHNXcmFwcGVyIC5sZWZ0VGFibGVMb2FkZXJgKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAobGIgPT09IDYwKSB7XG4gICAgICAgICQoYCNsZWFkZXJib2FyZHNXcmFwcGVyIC5yaWdodFRhYmxlTG9hZGVyYCkucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxufVxuZnVuY3Rpb24gaGlkZUxvYWRlcihsYikge1xuICAgIGlmIChsYiA9PT0gMTUpIHtcbiAgICAgICAgJChgI2xlYWRlcmJvYXJkc1dyYXBwZXIgLmxlZnRUYWJsZUxvYWRlcmApLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChsYiA9PT0gNjApIHtcbiAgICAgICAgJChgI2xlYWRlcmJvYXJkc1dyYXBwZXIgLnJpZ2h0VGFibGVMb2FkZXJgKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG59XG5mdW5jdGlvbiB1cGRhdGVGb290ZXIobGIpIHtcbiAgICBsZXQgc2lkZTtcbiAgICBpZiAobGIgPT09IDE1KSB7XG4gICAgICAgIHNpZGUgPSBcImxlZnRcIjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHNpZGUgPSBcInJpZ2h0XCI7XG4gICAgfVxuICAgICQoYCNsZWFkZXJib2FyZHNXcmFwcGVyIHRhYmxlLiR7c2lkZX0gdGZvb3RgKS5odG1sKGBcbiAgICA8dHI+XG4gICAgICA8dGQ+PGJyPjxicj48L3RkPlxuICAgICAgPHRkIGNvbHNwYW49XCI0XCIgc3R5bGU9XCJ0ZXh0LWFsaWduOmNlbnRlcjtcIj5Ob3QgcXVhbGlmaWVkPC8+XG4gICAgICA8dGQ+PGJyPjxicj48L3RkPlxuICAgIDwvdHI+XG4gICAgYCk7XG4gICAgbGV0IHRvcHBlcmNlbnQ7XG4gICAgaWYgKGN1cnJlbnRSYW5rW2xiXSkge1xuICAgICAgICBsZXQgbnVtID0gTWlzYy5yb3VuZFRvMigoY3VycmVudFJhbmtbbGJdW1wicmFua1wiXSAvIGN1cnJlbnRSYW5rW2xiXS5jb3VudCkgKiAxMDApO1xuICAgICAgICBpZiAobnVtID09IDApIHtcbiAgICAgICAgICAgIG51bSA9IDAuMDE7XG4gICAgICAgIH1cbiAgICAgICAgdG9wcGVyY2VudCA9IGBUb3AgJHtudW19JWA7XG4gICAgfVxuICAgIGlmIChjdXJyZW50UmFua1tsYl0pIHtcbiAgICAgICAgY29uc3QgZW50cnkgPSBjdXJyZW50UmFua1tsYl07XG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShlbnRyeS50aW1lc3RhbXApO1xuICAgICAgICAkKGAjbGVhZGVyYm9hcmRzV3JhcHBlciB0YWJsZS4ke3NpZGV9IHRmb290YCkuaHRtbChgXG4gICAgPHRyPlxuICAgIDx0ZD4ke2VudHJ5LnJhbmt9PC90ZD5cbiAgICA8dGQ+PHNwYW4gY2xhc3M9XCJ0b3BcIj5Zb3U8L3NwYW4+PGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+JHt0b3BwZXJjZW50fTwvc3Bhbj48L3RkPlxuICAgIDx0ZCBjbGFzcz1cImFsaWduUmlnaHRcIj4keyhjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE1cbiAgICAgICAgICAgID8gZW50cnkud3BtICogNVxuICAgICAgICAgICAgOiBlbnRyeS53cG0pLnRvRml4ZWQoMil9PGJyPjxkaXYgY2xhc3M9XCJzdWJcIj4ke2VudHJ5LmFjYy50b0ZpeGVkKDIpfSU8L2Rpdj48L3RkPlxuICAgIDx0ZCBjbGFzcz1cImFsaWduUmlnaHRcIj4keyhjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE1cbiAgICAgICAgICAgID8gZW50cnkucmF3ICogNVxuICAgICAgICAgICAgOiBlbnRyeS5yYXcpLnRvRml4ZWQoMil9PGJyPjxkaXYgY2xhc3M9XCJzdWJcIj4keyFlbnRyeS5jb25zaXN0ZW5jeSB8fCBlbnRyeS5jb25zaXN0ZW5jeSA9PT0gXCItXCJcbiAgICAgICAgICAgID8gXCItXCJcbiAgICAgICAgICAgIDogZW50cnkuY29uc2lzdGVuY3kudG9GaXhlZCgyKSArIFwiJVwifTwvZGl2PjwvdGQ+XG4gICAgPHRkIGNsYXNzPVwiYWxpZ25SaWdodFwiPnRpbWU8YnI+PGRpdiBjbGFzcz1cInN1YlwiPiR7bGJ9PC9kaXY+PC90ZD5cbiAgICA8dGQgY2xhc3M9XCJhbGlnblJpZ2h0XCI+JHsoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJkZCBNTU0geXl5eVwiKX08YnI+XG4gICAgPGRpdiBjbGFzcz0nc3ViJz4keygwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcIkhIOm1tXCIpfTwvZGl2PjwvdGQ+XG4gIDwvdHI+XG4gIGApO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGNoZWNrTGJNZW1vcnkobGIpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lO1xuICAgIGxldCBzaWRlO1xuICAgIGlmIChsYiA9PT0gMTUpIHtcbiAgICAgICAgc2lkZSA9IFwibGVmdFwiO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgc2lkZSA9IFwicmlnaHRcIjtcbiAgICB9XG4gICAgY29uc3QgbWVtb3J5ID0gKF9lID0gKF9kID0gKF9jID0gKF9iID0gKF9hID0gREIuZ2V0U25hcHNob3QoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxiTWVtb3J5KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudGltZSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jW2xiXSkgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kW1wiZW5nbGlzaFwiXSkgIT09IG51bGwgJiYgX2UgIT09IHZvaWQgMCA/IF9lIDogMDtcbiAgICBpZiAoY3VycmVudFJhbmtbbGJdKSB7XG4gICAgICAgIGNvbnN0IGRpZmZlcmVuY2UgPSBtZW1vcnkgLSBjdXJyZW50UmFua1tsYl0ucmFuaztcbiAgICAgICAgaWYgKGRpZmZlcmVuY2UgPiAwKSB7XG4gICAgICAgICAgICBEQi51cGRhdGVMYk1lbW9yeShcInRpbWVcIiwgbGIsIFwiZW5nbGlzaFwiLCBjdXJyZW50UmFua1tsYl0ucmFuaywgdHJ1ZSk7XG4gICAgICAgICAgICBpZiAobWVtb3J5ICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgJChgI2xlYWRlcmJvYXJkc1dyYXBwZXIgdGFibGUuJHtzaWRlfSB0Zm9vdCB0ciB0ZCAudG9wYCkuYXBwZW5kKGAgKDxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWFuZ2xlLXVwXCI+PC9pPiR7TWF0aC5hYnMoZGlmZmVyZW5jZSl9IHNpbmNlIHlvdSBsYXN0IGNoZWNrZWQpYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZGlmZmVyZW5jZSA8IDApIHtcbiAgICAgICAgICAgIERCLnVwZGF0ZUxiTWVtb3J5KFwidGltZVwiLCBsYiwgXCJlbmdsaXNoXCIsIGN1cnJlbnRSYW5rW2xiXS5yYW5rLCB0cnVlKTtcbiAgICAgICAgICAgIGlmIChtZW1vcnkgIT09IDApIHtcbiAgICAgICAgICAgICAgICAkKGAjbGVhZGVyYm9hcmRzV3JhcHBlciB0YWJsZS4ke3NpZGV9IHRmb290IHRyIHRkIC50b3BgKS5hcHBlbmQoYCAoPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtYW5nbGUtZG93blwiPjwvaT4ke01hdGguYWJzKGRpZmZlcmVuY2UpfSBzaW5jZSB5b3UgbGFzdCBjaGVja2VkKWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKG1lbW9yeSAhPT0gMCkge1xuICAgICAgICAgICAgICAgICQoYCNsZWFkZXJib2FyZHNXcmFwcGVyIHRhYmxlLiR7c2lkZX0gdGZvb3QgdHIgdGQgLnRvcGApLmFwcGVuZChgICggPSBzaW5jZSB5b3UgbGFzdCBjaGVja2VkKWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZmlsbFRhYmxlKGxiLCBwcmVwZW5kKSB7XG4gICAgdmFyIF9hO1xuICAgIGlmICghY3VycmVudERhdGFbbGJdKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IHNpZGU7XG4gICAgaWYgKGxiID09PSAxNSkge1xuICAgICAgICBzaWRlID0gXCJsZWZ0XCI7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBzaWRlID0gXCJyaWdodFwiO1xuICAgIH1cbiAgICBjb25zdCBsb2dnZWRJblVzZXJOYW1lID0gKF9hID0gREIuZ2V0U25hcHNob3QoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm5hbWU7XG4gICAgbGV0IGEgPSBjdXJyZW50RGF0YVtsYl0ubGVuZ3RoIC0gbGVhZGVyYm9hcmRTaW5nbGVMaW1pdDtcbiAgICBsZXQgYiA9IGN1cnJlbnREYXRhW2xiXS5sZW5ndGg7XG4gICAgaWYgKGEgPCAwKVxuICAgICAgICBhID0gMDtcbiAgICBpZiAocHJlcGVuZCkge1xuICAgICAgICBhID0gMDtcbiAgICAgICAgYiA9IHByZXBlbmQ7XG4gICAgfVxuICAgIGxldCBodG1sID0gXCJcIjtcbiAgICBmb3IgKGxldCBpID0gYTsgaSA8IGI7IGkrKykge1xuICAgICAgICBjb25zdCBlbnRyeSA9IGN1cnJlbnREYXRhW2xiXVtpXTtcbiAgICAgICAgaWYgKCFlbnRyeSkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVudHJ5LmhpZGRlbilcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbGV0IG1lQ2xhc3NTdHJpbmcgPSBcIlwiO1xuICAgICAgICBpZiAoZW50cnkubmFtZSA9PSBsb2dnZWRJblVzZXJOYW1lKSB7XG4gICAgICAgICAgICBtZUNsYXNzU3RyaW5nID0gJyBjbGFzcz1cIm1lXCInO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShlbnRyeS50aW1lc3RhbXApO1xuICAgICAgICBodG1sICs9IGBcbiAgICA8dHIgJHttZUNsYXNzU3RyaW5nfT5cbiAgICA8dGQ+JHtlbnRyeS5yYW5rID09PSAxID8gJzxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWNyb3duXCI+PC9pPicgOiBlbnRyeS5yYW5rfTwvdGQ+XG4gICAgPHRkPiR7ZW50cnkubmFtZX08L3RkPlxuICAgIDx0ZCBjbGFzcz1cImFsaWduUmlnaHRcIj4keyhjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE1cbiAgICAgICAgICAgID8gZW50cnkud3BtICogNVxuICAgICAgICAgICAgOiBlbnRyeS53cG0pLnRvRml4ZWQoMil9PGJyPjxkaXYgY2xhc3M9XCJzdWJcIj4ke2VudHJ5LmFjYy50b0ZpeGVkKDIpfSU8L2Rpdj48L3RkPlxuICAgIDx0ZCBjbGFzcz1cImFsaWduUmlnaHRcIj4keyhjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE1cbiAgICAgICAgICAgID8gZW50cnkucmF3ICogNVxuICAgICAgICAgICAgOiBlbnRyeS5yYXcpLnRvRml4ZWQoMil9PGJyPjxkaXYgY2xhc3M9XCJzdWJcIj4keyFlbnRyeS5jb25zaXN0ZW5jeSB8fCBlbnRyeS5jb25zaXN0ZW5jeSA9PT0gXCItXCJcbiAgICAgICAgICAgID8gXCItXCJcbiAgICAgICAgICAgIDogZW50cnkuY29uc2lzdGVuY3kudG9GaXhlZCgyKSArIFwiJVwifTwvZGl2PjwvdGQ+XG4gICAgPHRkIGNsYXNzPVwiYWxpZ25SaWdodFwiPnRpbWU8YnI+PGRpdiBjbGFzcz1cInN1YlwiPiR7bGJ9PC9kaXY+PC90ZD5cbiAgICA8dGQgY2xhc3M9XCJhbGlnblJpZ2h0XCI+JHsoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJkZCBNTU0geXl5eVwiKX08YnI+XG4gICAgPGRpdiBjbGFzcz0nc3ViJz4keygwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcIkhIOm1tXCIpfTwvZGl2PjwvdGQ+XG4gIDwvdHI+XG4gIGA7XG4gICAgfVxuICAgIGlmICghcHJlcGVuZCkge1xuICAgICAgICAkKGAjbGVhZGVyYm9hcmRzV3JhcHBlciB0YWJsZS4ke3NpZGV9IHRib2R5YCkuYXBwZW5kKGh0bWwpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChgI2xlYWRlcmJvYXJkc1dyYXBwZXIgdGFibGUuJHtzaWRlfSB0Ym9keWApLnByZXBlbmQoaHRtbCk7XG4gICAgfVxufVxuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXJcIilcbiAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiAwLFxuICAgIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICBjbGVhclRhYmxlKDE1KTtcbiAgICAgICAgY2xlYXJUYWJsZSg2MCk7XG4gICAgICAgIHJlc2V0KCk7XG4gICAgICAgIHN0b3BUaW1lcigpO1xuICAgICAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfSk7XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAuYnV0dG9ucyAuYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAkKGAjbGVhZGVyYm9hcmRzV3JhcHBlciAuYnV0dG9ucyAuYnV0dG9uW2JvYXJkPSR7Y3VycmVudExlYWRlcmJvYXJkfV1gKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgc2hvd0xvYWRlcigxNSk7XG4gICAgICAgIHNob3dMb2FkZXIoNjApO1xuICAgICAgICBjb25zdCBsZWFkZXJib2FyZFJlcXVlc3RzID0gW1xuICAgICAgICAgICAgYXBlXzEuZGVmYXVsdC5sZWFkZXJib2FyZHMuZ2V0KFwiZW5nbGlzaFwiLCBcInRpbWVcIiwgXCIxNVwiLCAwKSxcbiAgICAgICAgICAgIGFwZV8xLmRlZmF1bHQubGVhZGVyYm9hcmRzLmdldChcImVuZ2xpc2hcIiwgXCJ0aW1lXCIsIFwiNjBcIiwgMCksXG4gICAgICAgIF07XG4gICAgICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIpIHtcbiAgICAgICAgICAgIGxlYWRlcmJvYXJkUmVxdWVzdHMucHVzaChhcGVfMS5kZWZhdWx0LmxlYWRlcmJvYXJkcy5nZXRSYW5rKFwiZW5nbGlzaFwiLCBcInRpbWVcIiwgXCIxNVwiKSwgYXBlXzEuZGVmYXVsdC5sZWFkZXJib2FyZHMuZ2V0UmFuayhcImVuZ2xpc2hcIiwgXCJ0aW1lXCIsIFwiNjBcIikpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlcyA9IHlpZWxkIFByb21pc2UuYWxsKGxlYWRlcmJvYXJkUmVxdWVzdHMpO1xuICAgICAgICBjb25zdCBmYWlsZWRSZXNwb25zZSA9IHJlc3BvbnNlcy5maW5kKChyZXNwb25zZSkgPT4gcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApO1xuICAgICAgICBpZiAoZmFpbGVkUmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBsb2FkIGxlYWRlcmJvYXJkczogXCIgKyBmYWlsZWRSZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgW2xiMTVEYXRhLCBsYjYwRGF0YSwgbGIxNVJhbmssIGxiNjBSYW5rXSA9IHJlc3BvbnNlcy5tYXAoKHJlc3BvbnNlKSA9PiByZXNwb25zZS5kYXRhKTtcbiAgICAgICAgY3VycmVudERhdGFbMTVdID0gbGIxNURhdGE7XG4gICAgICAgIGN1cnJlbnREYXRhWzYwXSA9IGxiNjBEYXRhO1xuICAgICAgICBjdXJyZW50UmFua1sxNV0gPSBsYjE1UmFuaztcbiAgICAgICAgY3VycmVudFJhbmtbNjBdID0gbGI2MFJhbms7XG4gICAgICAgIGNvbnN0IGxlYWRlcmJvYXJkS2V5cyA9IFsxNSwgNjBdO1xuICAgICAgICBsZWFkZXJib2FyZEtleXMuZm9yRWFjaCgobGVhZGVyYm9hcmRUaW1lKSA9PiB7XG4gICAgICAgICAgICBoaWRlTG9hZGVyKGxlYWRlcmJvYXJkVGltZSk7XG4gICAgICAgICAgICBjbGVhclRhYmxlKGxlYWRlcmJvYXJkVGltZSk7XG4gICAgICAgICAgICB1cGRhdGVGb290ZXIobGVhZGVyYm9hcmRUaW1lKTtcbiAgICAgICAgICAgIGNoZWNrTGJNZW1vcnkobGVhZGVyYm9hcmRUaW1lKTtcbiAgICAgICAgICAgIGZpbGxUYWJsZShsZWFkZXJib2FyZFRpbWUpO1xuICAgICAgICB9KTtcbiAgICAgICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyIC5sZWZ0VGFibGVXcmFwcGVyXCIpLnJlbW92ZUNsYXNzKFwiaW52aXNpYmxlXCIpO1xuICAgICAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgLnJpZ2h0VGFibGVXcmFwcGVyXCIpLnJlbW92ZUNsYXNzKFwiaW52aXNpYmxlXCIpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gcmVxdWVzdE1vcmUobGIsIHByZXBlbmQgPSBmYWxzZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChwcmVwZW5kICYmIGN1cnJlbnREYXRhW2xiXVswXS5yYW5rID09PSAxKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAocmVxdWVzdGluZ1tsYl0pXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHJlcXVlc3RpbmdbbGJdID0gdHJ1ZTtcbiAgICAgICAgc2hvd0xvYWRlcihsYik7XG4gICAgICAgIGxldCBza2lwVmFsID0gY3VycmVudERhdGFbbGJdW2N1cnJlbnREYXRhW2xiXS5sZW5ndGggLSAxXS5yYW5rO1xuICAgICAgICBpZiAocHJlcGVuZCkge1xuICAgICAgICAgICAgc2tpcFZhbCA9IGN1cnJlbnREYXRhW2xiXVswXS5yYW5rIC0gbGVhZGVyYm9hcmRTaW5nbGVMaW1pdDtcbiAgICAgICAgfVxuICAgICAgICBsZXQgbGltaXRWYWw7XG4gICAgICAgIGlmIChza2lwVmFsIDwgMCkge1xuICAgICAgICAgICAgbGltaXRWYWwgPSBNYXRoLmFicyhza2lwVmFsKSAtIDE7XG4gICAgICAgICAgICBza2lwVmFsID0gMDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQubGVhZGVyYm9hcmRzLmdldChcImVuZ2xpc2hcIiwgXCJ0aW1lXCIsIGxiLCBza2lwVmFsLCBsaW1pdFZhbCk7XG4gICAgICAgIGNvbnN0IGRhdGEgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDAgfHwgZGF0YS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGhpZGVMb2FkZXIobGIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwcmVwZW5kKSB7XG4gICAgICAgICAgICBjdXJyZW50RGF0YVtsYl0udW5zaGlmdCguLi5kYXRhKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGN1cnJlbnREYXRhW2xiXS5wdXNoKC4uLmRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwcmVwZW5kICYmICFsaW1pdFZhbCkge1xuICAgICAgICAgICAgbGltaXRWYWwgPSBsZWFkZXJib2FyZFNpbmdsZUxpbWl0IC0gMTtcbiAgICAgICAgfVxuICAgICAgICBmaWxsVGFibGUobGIsIGxpbWl0VmFsKTtcbiAgICAgICAgaGlkZUxvYWRlcihsYik7XG4gICAgICAgIHJlcXVlc3RpbmdbbGJdID0gZmFsc2U7XG4gICAgfSk7XG59XG5mdW5jdGlvbiByZXF1ZXN0TmV3KGxiLCBza2lwKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgc2hvd0xvYWRlcihsYik7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5sZWFkZXJib2FyZHMuZ2V0KFwiZW5nbGlzaFwiLCBcInRpbWVcIiwgbGIsIHNraXApO1xuICAgICAgICBjb25zdCBkYXRhID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgY2xlYXJUYWJsZShsYik7XG4gICAgICAgIGN1cnJlbnREYXRhW2xiXSA9IFtdO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDAgfHwgZGF0YS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGhpZGVMb2FkZXIobGIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGN1cnJlbnREYXRhW2xiXSA9IGRhdGE7XG4gICAgICAgIGZpbGxUYWJsZShsYik7XG4gICAgICAgIGhpZGVMb2FkZXIobGIpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gc2hvdygpIHtcbiAgICBpZiAoJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIpIHtcbiAgICAgICAgICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5yaWdodFRhYmxlSnVtcFRvTWVcIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5sZWZ0VGFibGVKdW1wVG9NZVwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLnJpZ2h0VGFibGVKdW1wVG9NZVwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLmxlZnRUYWJsZUp1bXBUb01lXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSkge1xuICAgICAgICAgICAgJChcIiNsZWFkZXJib2FyZHMgdGFibGUgdGhlYWQgdHIgdGQ6bnRoLWNoaWxkKDMpXCIpLmh0bWwoJ2NwbTxicj48ZGl2IGNsYXNzPVwic3ViXCI+YWNjdXJhY3k8L2Rpdj4nKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIjbGVhZGVyYm9hcmRzIHRhYmxlIHRoZWFkIHRyIHRkOm50aC1jaGlsZCgzKVwiKS5odG1sKCd3cG08YnI+PGRpdiBjbGFzcz1cInN1YlwiPmFjY3VyYWN5PC9kaXY+Jyk7XG4gICAgICAgIH1cbiAgICAgICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICAgICB1cGRhdGUoKTtcbiAgICAgICAgICAgIHN0YXJ0VGltZXIoKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbiQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlclwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJsZWFkZXJib2FyZHNXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuLy8gJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyIC5idXR0b25zIC5idXR0b25cIikub24oXCJjbGlja1wiLChlKSA9PiB7XG4vLyAgIGN1cnJlbnRMZWFkZXJib2FyZCA9ICQoZS50YXJnZXQpLmF0dHIoXCJib2FyZFwiKTtcbi8vICAgdXBkYXRlKCk7XG4vLyB9KTtcbmxldCBsZWZ0U2Nyb2xsRW5hYmxlZCA9IHRydWU7XG4kKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAubGVmdFRhYmxlV3JhcHBlclwiKS5zY3JvbGwoKGUpID0+IHtcbiAgICBpZiAoIWxlZnRTY3JvbGxFbmFibGVkKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgZWxlbSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICBpZiAoTWF0aC5yb3VuZChlbGVtLnNjcm9sbFRvcCgpKSA8PSA1MCkge1xuICAgICAgICByZXF1ZXN0TW9yZSgxNSwgdHJ1ZSk7XG4gICAgfVxufSk7XG4kKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAubGVmdFRhYmxlV3JhcHBlclwiKS5zY3JvbGwoKGUpID0+IHtcbiAgICBpZiAoIWxlZnRTY3JvbGxFbmFibGVkKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgZWxlbSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICBpZiAoTWF0aC5yb3VuZChlbGVtWzBdLnNjcm9sbEhlaWdodCAtIGVsZW0uc2Nyb2xsVG9wKCkpIDw9XG4gICAgICAgIE1hdGgucm91bmQoZWxlbS5vdXRlckhlaWdodCgpKSArIDUwKSB7XG4gICAgICAgIHJlcXVlc3RNb3JlKDE1KTtcbiAgICB9XG59KTtcbmxldCByaWdodFNjcm9sbEVuYWJsZWQgPSB0cnVlO1xuJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLnJpZ2h0VGFibGVXcmFwcGVyXCIpLnNjcm9sbCgoZSkgPT4ge1xuICAgIGlmICghcmlnaHRTY3JvbGxFbmFibGVkKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgZWxlbSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICBpZiAoTWF0aC5yb3VuZChlbGVtLnNjcm9sbFRvcCgpKSA8PSA1MCkge1xuICAgICAgICByZXF1ZXN0TW9yZSg2MCwgdHJ1ZSk7XG4gICAgfVxufSk7XG4kKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAucmlnaHRUYWJsZVdyYXBwZXJcIikuc2Nyb2xsKChlKSA9PiB7XG4gICAgY29uc3QgZWxlbSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICBpZiAoTWF0aC5yb3VuZChlbGVtWzBdLnNjcm9sbEhlaWdodCAtIGVsZW0uc2Nyb2xsVG9wKCkpIDw9XG4gICAgICAgIE1hdGgucm91bmQoZWxlbS5vdXRlckhlaWdodCgpICsgNTApKSB7XG4gICAgICAgIHJlcXVlc3RNb3JlKDYwKTtcbiAgICB9XG59KTtcbiQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5sZWZ0VGFibGVKdW1wVG9Ub3BcIikub24oXCJjbGlja1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBsZWZ0U2Nyb2xsRW5hYmxlZCA9IGZhbHNlO1xuICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5sZWZ0VGFibGVXcmFwcGVyXCIpLnNjcm9sbFRvcCgwKTtcbiAgICB5aWVsZCByZXF1ZXN0TmV3KDE1LCAwKTtcbiAgICBsZWZ0U2Nyb2xsRW5hYmxlZCA9IHRydWU7XG59KSk7XG4kKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAubGVmdFRhYmxlSnVtcFRvTWVcIikub24oXCJjbGlja1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBpZiAoY3VycmVudFJhbmtbMTVdLnJhbmsgPT09IHVuZGVmaW5lZClcbiAgICAgICAgcmV0dXJuO1xuICAgIGxlZnRTY3JvbGxFbmFibGVkID0gZmFsc2U7XG4gICAgeWllbGQgcmVxdWVzdE5ldygxNSwgY3VycmVudFJhbmtbMTVdLnJhbmsgLSBsZWFkZXJib2FyZFNpbmdsZUxpbWl0IC8gMik7XG4gICAgY29uc3Qgcm93SGVpZ2h0ID0gJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLmxlZnRUYWJsZVdyYXBwZXIgdGFibGUgdGJvZHkgdGRcIikub3V0ZXJIZWlnaHQoKTtcbiAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAubGVmdFRhYmxlV3JhcHBlclwiKS5hbmltYXRlKHtcbiAgICAgICAgc2Nyb2xsVG9wOiByb3dIZWlnaHQgKlxuICAgICAgICAgICAgTWF0aC5taW4oY3VycmVudFJhbmtbMTVdLnJhbmssIGxlYWRlcmJvYXJkU2luZ2xlTGltaXQgLyAyKSAtXG4gICAgICAgICAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAubGVmdFRhYmxlV3JhcHBlclwiKS5vdXRlckhlaWdodCgpIC9cbiAgICAgICAgICAgICAgICAyLjI1LFxuICAgIH0sIDAsICgpID0+IHtcbiAgICAgICAgbGVmdFNjcm9sbEVuYWJsZWQgPSB0cnVlO1xuICAgIH0pO1xufSkpO1xuJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLnJpZ2h0VGFibGVKdW1wVG9Ub3BcIikub24oXCJjbGlja1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICByaWdodFNjcm9sbEVuYWJsZWQgPSBmYWxzZTtcbiAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAucmlnaHRUYWJsZVdyYXBwZXJcIikuc2Nyb2xsVG9wKDApO1xuICAgIHlpZWxkIHJlcXVlc3ROZXcoNjAsIDApO1xuICAgIHJpZ2h0U2Nyb2xsRW5hYmxlZCA9IHRydWU7XG59KSk7XG4kKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAucmlnaHRUYWJsZUp1bXBUb01lXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgaWYgKGN1cnJlbnRSYW5rWzYwXS5yYW5rID09PSB1bmRlZmluZWQpXG4gICAgICAgIHJldHVybjtcbiAgICBsZWZ0U2Nyb2xsRW5hYmxlZCA9IGZhbHNlO1xuICAgIHlpZWxkIHJlcXVlc3ROZXcoNjAsIGN1cnJlbnRSYW5rWzYwXS5yYW5rIC0gbGVhZGVyYm9hcmRTaW5nbGVMaW1pdCAvIDIpO1xuICAgIGNvbnN0IHJvd0hlaWdodCA9ICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5yaWdodFRhYmxlV3JhcHBlciB0YWJsZSB0Ym9keSB0ZFwiKS5vdXRlckhlaWdodCgpO1xuICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5yaWdodFRhYmxlV3JhcHBlclwiKS5hbmltYXRlKHtcbiAgICAgICAgc2Nyb2xsVG9wOiByb3dIZWlnaHQgKlxuICAgICAgICAgICAgTWF0aC5taW4oY3VycmVudFJhbmtbNjBdLnJhbmssIGxlYWRlcmJvYXJkU2luZ2xlTGltaXQgLyAyKSAtXG4gICAgICAgICAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAucmlnaHRUYWJsZVdyYXBwZXJcIikub3V0ZXJIZWlnaHQoKSAvXG4gICAgICAgICAgICAgICAgMi4yNSxcbiAgICB9LCAwLCAoKSA9PiB7XG4gICAgICAgIGxlZnRTY3JvbGxFbmFibGVkID0gdHJ1ZTtcbiAgICB9KTtcbn0pKTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjdG9wICNtZW51IC5pY29uLWJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUuY3VycmVudFRhcmdldCkuaGFzQ2xhc3MoXCJsZWFkZXJib2FyZHNcIikpIHtcbiAgICAgICAgc2hvdygpO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwia2V5ZG93blwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiICYmICEkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmhpZGUgPSBleHBvcnRzLnNob3cgPSB2b2lkIDA7XG5mdW5jdGlvbiBzaG93KCkge1xuICAgICQoXCIjYmFja2dyb3VuZExvYWRlclwiKS5zdG9wKHRydWUsIHRydWUpLmZhZGVJbigxMjUpO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgJChcIiNiYWNrZ3JvdW5kTG9hZGVyXCIpLnN0b3AodHJ1ZSwgdHJ1ZSkuZmFkZU91dCgxMjUpO1xufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudXBkYXRlID0gdm9pZCAwO1xuY29uc3QgUGFjZUNhcmV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3BhY2UtY2FyZXRcIikpO1xuY29uc3QgVGVzdFN0YXRlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3Qtc3RhdGVcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IExhc3QxMEF2ZXJhZ2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2xhc3QtMTAtYXZlcmFnZVwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IFRlc3RXb3JkcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LXdvcmRzXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuLi9maXJlYmFzZVwiKTtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXkpID0+IHtcbiAgICBpZiAoW1xuICAgICAgICBcImRpZmZpY3VsdHlcIixcbiAgICAgICAgXCJibGluZE1vZGVcIixcbiAgICAgICAgXCJzdG9wT25FcnJvclwiLFxuICAgICAgICBcInBhY2VDYXJldFwiLFxuICAgICAgICBcIm1pbldwbVwiLFxuICAgICAgICBcIm1pbkFjY1wiLFxuICAgICAgICBcIm1pbkJ1cnN0XCIsXG4gICAgICAgIFwiY29uZmlkZW5jZU1vZGVcIixcbiAgICAgICAgXCJsYXlvdXRcIixcbiAgICAgICAgXCJzaG93QXZlcmFnZVwiLFxuICAgICAgICBcImFsd2F5c1Nob3dDUE1cIixcbiAgICBdLmluY2x1ZGVzKGV2ZW50S2V5KSkge1xuICAgICAgICB1cGRhdGUoKTtcbiAgICB9XG59KTtcbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgbGV0IGFuaW0gPSBmYWxzZTtcbiAgICAgICAgaWYgKCQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS50ZXh0KCkgPT09IFwiXCIpXG4gICAgICAgICAgICBhbmltID0gdHJ1ZTtcbiAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmVtcHR5KCk7XG4gICAgICAgIGlmIChUZXN0U3RhdGUuaXNSZXBlYXRlZCAmJiBjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT09IFwicXVvdGVcIikge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uIHJlc3RhcnRcIiBzdHlsZT1cImNvbG9yOnZhcigtLWVycm9yLWNvbG9yKTtcIj48aSBjbGFzcz1cImZhcyBmYS1zeW5jLWFsdFwiPjwvaT5yZXBlYXRlZDwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChUZXN0V29yZHMuaGFzVGFiKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIj48aSBjbGFzcz1cImZhcyBmYS1sb25nLWFycm93LWFsdC1yaWdodFwiPjwvaT5zaGlmdCArIHRhYiB0byByZXN0YXJ0PC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFRlc3RTdGF0ZS5hY3RpdmVDaGFsbGVuZ2UpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiIGNvbW1hbmRzPVwiY29tbWFuZHNDaGFsbGVuZ2VzXCI+PGkgY2xhc3M9XCJmYXMgZmEtYXdhcmRcIj48L2k+JHtUZXN0U3RhdGUuYWN0aXZlQ2hhbGxlbmdlLmRpc3BsYXl9PC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ6ZW5cIikge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCI+PGkgY2xhc3M9XCJmYXMgZmEtcG9sbFwiPjwvaT5zaGlmdCArIGVudGVyIHRvIGZpbmlzaCB6ZW4gPC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCIgY29tbWFuZHM9XCJjb21tYW5kc0xhbmd1YWdlc1wiPjxpIGNsYXNzPVwiZmFzIGZhLWdsb2JlLWFtZXJpY2FzXCI+PC9pPiR7Y29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZS5yZXBsYWNlKC9fL2csIFwiIFwiKX08L2Rpdj5gKTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSA9PT0gXCJleHBlcnRcIikge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCIgY29tbWFuZHM9XCJjb21tYW5kc0RpZmZpY3VsdHlcIj48aSBjbGFzcz1cImZhcyBmYS1zdGFyLWhhbGYtYWx0XCI+PC9pPmV4cGVydDwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSA9PT0gXCJtYXN0ZXJcIikge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCIgY29tbWFuZHM9XCJjb21tYW5kc0RpZmZpY3VsdHlcIj48aSBjbGFzcz1cImZhcyBmYS1zdGFyXCI+PC9pPm1hc3RlcjwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSkge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uIGJsaW5kXCI+PGkgY2xhc3M9XCJmYXMgZmEtZXllLXNsYXNoXCI+PC9pPmJsaW5kPC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubGF6eU1vZGUpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiIGNvbW1hbmRzPVwiY29tbWFuZHNMYXp5TW9kZVwiPjxpIGNsYXNzPVwiZmFzIGZhLWNvdWNoXCI+PC9pPmxhenk8L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5wYWNlQ2FyZXQgIT09IFwib2ZmXCIgfHxcbiAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0LnJlcGVhdGVkUGFjZSAmJiBUZXN0U3RhdGUuaXNQYWNlUmVwZWF0KSkge1xuICAgICAgICAgICAgbGV0IHNwZWVkID0gXCJcIjtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgc3BlZWQgPSBgICgke01hdGgucm91bmQoUGFjZUNhcmV0LnNldHRpbmdzLndwbSl9IHdwbSlgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKF9iKSB7IH1cbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiIGNvbW1hbmRzPVwiY29tbWFuZHNQYWNlQ2FyZXRcIj48aSBjbGFzcz1cImZhcyBmYS10YWNob21ldGVyLWFsdFwiPjwvaT4ke2NvbmZpZ18xLmRlZmF1bHQucGFjZUNhcmV0ID09PSBcImF2ZXJhZ2VcIlxuICAgICAgICAgICAgICAgID8gXCJhdmVyYWdlXCJcbiAgICAgICAgICAgICAgICA6IGNvbmZpZ18xLmRlZmF1bHQucGFjZUNhcmV0ID09PSBcInBiXCJcbiAgICAgICAgICAgICAgICAgICAgPyBcInBiXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcImN1c3RvbVwifSBwYWNlJHtzcGVlZH08L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zaG93QXZlcmFnZSAhPT0gXCJvZmZcIikge1xuICAgICAgICAgICAgbGV0IGF2Z1dQTSA9IExhc3QxMEF2ZXJhZ2UuZ2V0V1BNKCk7XG4gICAgICAgICAgICBsZXQgYXZnQWNjID0gTGFzdDEwQXZlcmFnZS5nZXRBY2MoKTtcbiAgICAgICAgICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93RGVjaW1hbFBsYWNlcykge1xuICAgICAgICAgICAgICAgIGF2Z1dQTSA9IE1hdGgucm91bmQoYXZnV1BNKTtcbiAgICAgICAgICAgICAgICBhdmdBY2MgPSBNYXRoLnJvdW5kKGF2Z0FjYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyICYmIGF2Z1dQTSA+IDApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhdmdXUE1UZXh0ID0gW1wid3BtXCIsIFwiYm90aFwiXS5pbmNsdWRlcyhjb25maWdfMS5kZWZhdWx0LnNob3dBdmVyYWdlKVxuICAgICAgICAgICAgICAgICAgICA/IGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTVxuICAgICAgICAgICAgICAgICAgICAgICAgPyBgJHtNYXRoLnJvdW5kKGF2Z1dQTSAqIDUpfSBjcG1gXG4gICAgICAgICAgICAgICAgICAgICAgICA6IGAke2F2Z1dQTX0gd3BtYFxuICAgICAgICAgICAgICAgICAgICA6IFwiXCI7XG4gICAgICAgICAgICAgICAgY29uc3QgYXZnQWNjVGV4dCA9IFtcImFjY1wiLCBcImJvdGhcIl0uaW5jbHVkZXMoY29uZmlnXzEuZGVmYXVsdC5zaG93QXZlcmFnZSlcbiAgICAgICAgICAgICAgICAgICAgPyBgJHthdmdBY2N9JSBhY2NgXG4gICAgICAgICAgICAgICAgICAgIDogXCJcIjtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0ID0gYCR7YXZnV1BNVGV4dH0gJHthdmdBY2NUZXh0fWAudHJpbSgpO1xuICAgICAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiIGNvbW1hbmRzPVwiY29tbWFuZHNTaG93QXZlcmFnZVwiPjxpIGNsYXNzPVwiZmFzIGZhLWNoYXJ0LWJhclwiPjwvaT5hdmc6ICR7dGV4dH08L2Rpdj5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5taW5XcG0gIT09IFwib2ZmXCIpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiIGNvbW1hbmRzPVwiY29tbWFuZHNNaW5XcG1cIj48aSBjbGFzcz1cImZhcyBmYS1ib21iXCI+PC9pPm1pbiAke2NvbmZpZ18xLmRlZmF1bHQubWluV3BtQ3VzdG9tU3BlZWR9IHdwbTwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1pbkFjYyAhPT0gXCJvZmZcIikge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCIgY29tbWFuZHM9XCJjb21tYW5kc01pbkFjY1wiPjxpIGNsYXNzPVwiZmFzIGZhLWJvbWJcIj48L2k+bWluICR7Y29uZmlnXzEuZGVmYXVsdC5taW5BY2NDdXN0b219JSBhY2M8L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5taW5CdXJzdCAhPT0gXCJvZmZcIikge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCIgY29tbWFuZHM9XCJjb21tYW5kc01pbkJ1cnN0XCI+PGkgY2xhc3M9XCJmYXMgZmEtYm9tYlwiPjwvaT5taW4gJHtjb25maWdfMS5kZWZhdWx0Lm1pbkJ1cnN0Q3VzdG9tU3BlZWR9IGJ1cnN0ICR7Y29uZmlnXzEuZGVmYXVsdC5taW5CdXJzdCA9PT0gXCJmbGV4XCIgPyBcIihmbGV4KVwiIDogXCJcIn08L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggIT09IFwibm9uZVwiKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIiBjb21tYW5kcz1cImNvbW1hbmRzRnVuYm94XCI+PGkgY2xhc3M9XCJmYXMgZmEtZ2FtZXBhZFwiPjwvaT4ke2NvbmZpZ18xLmRlZmF1bHQuZnVuYm94LnJlcGxhY2UoL18vZywgXCIgXCIpfTwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmNvbmZpZGVuY2VNb2RlID09PSBcIm9uXCIpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiIGNvbW1hbmRzPVwiY29tbWFuZHNDb25maWRlbmNlTW9kZVwiPjxpIGNsYXNzPVwiZmFzIGZhLWJhY2tzcGFjZVwiPjwvaT5jb25maWRlbmNlPC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuY29uZmlkZW5jZU1vZGUgPT09IFwibWF4XCIpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiIGNvbW1hbmRzPVwiY29tbWFuZHNDb25maWRlbmNlTW9kZVwiPjxpIGNsYXNzPVwiZmFzIGZhLWJhY2tzcGFjZVwiPjwvaT5tYXggY29uZmlkZW5jZTwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnN0b3BPbkVycm9yICE9IFwib2ZmXCIpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiIGNvbW1hbmRzPVwiY29tbWFuZHNTdG9wT25FcnJvclwiPjxpIGNsYXNzPVwiZmFzIGZhLWhhbmQtcGFwZXJcIj48L2k+c3RvcCBvbiAke2NvbmZpZ18xLmRlZmF1bHQuc3RvcE9uRXJyb3J9PC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubGF5b3V0ICE9PSBcImRlZmF1bHRcIikge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCIgY29tbWFuZHM9XCJjb21tYW5kc0xheW91dHNcIj48aSBjbGFzcz1cImZhcyBmYS1rZXlib2FyZFwiPjwvaT5lbXVsYXRpbmcgJHtjb25maWdfMS5kZWZhdWx0LmxheW91dC5yZXBsYWNlKC9fL2csIFwiIFwiKX08L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5vcHBvc2l0ZVNoaWZ0TW9kZSAhPT0gXCJvZmZcIikge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCIgY29tbWFuZHM9XCJjb21tYW5kc09wcG9zaXRlU2hpZnRNb2RlXCI+PGkgY2xhc3M9XCJmYXMgZmEtZXhjaGFuZ2UtYWx0XCI+PC9pPm9wcG9zaXRlIHNoaWZ0JHtjb25maWdfMS5kZWZhdWx0Lm9wcG9zaXRlU2hpZnRNb2RlID09PSBcImtleW1hcFwiID8gXCIgKGtleW1hcClcIiA6IFwiXCJ9PC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHRhZ3NTdHJpbmcgPSBcIlwiO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgKF9hID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRhZy5hY3RpdmUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFnc1N0cmluZyArPSB0YWcubmFtZSArIFwiLCBcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICh0YWdzU3RyaW5nICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCIgY29tbWFuZHM9XCJjb21tYW5kc1RhZ3NcIj48aSBjbGFzcz1cImZhcyBmYS10YWdcIj48L2k+JHt0YWdzU3RyaW5nLnN1YnN0cmluZygwLCB0YWdzU3RyaW5nLmxlbmd0aCAtIDIpfTwvZGl2PmApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChfYykgeyB9XG4gICAgICAgIGlmIChhbmltKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIilcbiAgICAgICAgICAgICAgICAuY3NzKFwidHJhbnNpdGlvblwiLCBcIm5vbmVcIilcbiAgICAgICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmNzcyhcInRyYW5zaXRpb25cIiwgXCIuMTI1c1wiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLnVwZGF0ZSA9IHVwZGF0ZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuYWRkUG93ZXIgPSBleHBvcnRzLnJlc2V0ID0gZXhwb3J0cy5pbml0ID0gdm9pZCAwO1xuY29uc3QgVGhlbWVDb2xvcnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGhlbWUtY29sb3JzXCIpKTtcbmNvbnN0IFNsb3dUaW1lciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3Nsb3ctdGltZXJcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG4vKipcbiAqIEB0eXBlZGVmIHt7IHg6IG51bWJlciwgeTogbnVtYmVyIH19IHZlYzJcbiAqIEB0eXBlZGVmIHt2ZWMyICYgeyBwcmV2OiB2ZWMyLCB2ZWw6IHZlYzIsIGFscGhhOiBudW1iZXIsIGNvbG9yOiBzdHJpbmcgfX0gUGFydGljbGVcbiAqIEB0eXBlZGVmIHt7IHBhcnRpY2xlczogUGFydGljbGVbXSwgY2FyZXQ6IGFueSwgY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCwgY29udGV4dDJkOiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsIHJlbmRlcmluZzogYm9vbGVhbiwgbGFzdEZyYW1lOiBudW1iZXIsIGRlbHRhVGltZTogbnVtYmVyLCByZXNldFRpbWVPdXQ6IG51bWJlciB9fSBDVFhcbiAqL1xuLyoqXG4gKiBAdHlwZSB7Q1RYfSBjdHhcbiAqL1xuY29uc3QgY3R4ID0ge1xuICAgIHBhcnRpY2xlczogW10sXG4gICAgcmVuZGVyaW5nOiBmYWxzZSxcbn07XG5jb25zdCBncmF2aXR5ID0gMTAwMDtcbmNvbnN0IGRyYWcgPSAwLjA1O1xuY29uc3QgcGFydGljbGVTaXplID0gNDtcbmNvbnN0IHBhcnRpY2xlRmFkZSA9IDAuNjtcbmNvbnN0IHBhcnRpY2xlSW5pdFZlbCA9IDE1MDA7XG5jb25zdCBwYXJ0aWNsZUJvdW5jZU1vZCA9IDAuMztcbmNvbnN0IHBhcnRpY2xlQ3JlYXRlQ291bnQgPSBbNiwgM107XG5jb25zdCBzaGFrZUFtb3VudCA9IDEwO1xuZnVuY3Rpb24gY3JlYXRlQ2FudmFzKCkge1xuICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgY2FudmFzLnN0eWxlLmNzc1RleHQgPVxuICAgICAgICBcInBvc2l0aW9uOmZpeGVkO3RvcDowO2xlZnQ6MDtwb2ludGVyLWV2ZW50czpub25lO3otaW5kZXg6OTk5OTk5XCI7XG4gICAgY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICBjYW52YXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCAoKSA9PiB7XG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgICAgIGNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgIH0pO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKTtcbiAgICByZXR1cm4gY2FudmFzO1xufVxuLyoqXG4gKiBAcGFyYW0ge251bWJlcn0geFxuICogQHBhcmFtIHtudW1iZXJ9IHlcbiAqIEBwYXJhbSB7c3RyaW5nfSBjb2xvclxuICogQHJldHVybnMge1BhcnRpY2xlfVxuICovXG5mdW5jdGlvbiBjcmVhdGVQYXJ0aWNsZSh4LCB5LCBjb2xvcikge1xuICAgIHJldHVybiB7XG4gICAgICAgIHgsXG4gICAgICAgIHksXG4gICAgICAgIGNvbG9yLFxuICAgICAgICBhbHBoYTogMSxcbiAgICAgICAgcHJldjogeyB4LCB5IH0sXG4gICAgICAgIHZlbDoge1xuICAgICAgICAgICAgeDogcGFydGljbGVJbml0VmVsIC0gTWF0aC5yYW5kb20oKSAqIHBhcnRpY2xlSW5pdFZlbCAqIDIsXG4gICAgICAgICAgICB5OiBwYXJ0aWNsZUluaXRWZWwgLSBNYXRoLnJhbmRvbSgpICogcGFydGljbGVJbml0VmVsICogMixcbiAgICAgICAgfSxcbiAgICB9O1xufVxuLyoqXG4gKiBAcGFyYW0ge1BhcnRpY2xlfSBwYXJ0aWNsZVxuICovXG5mdW5jdGlvbiB1cGRhdGVQYXJ0aWNsZShwYXJ0aWNsZSkge1xuICAgIGlmICghY3R4LmNhbnZhcyB8fCAhY3R4LmRlbHRhVGltZSlcbiAgICAgICAgcmV0dXJuO1xuICAgIHBhcnRpY2xlLnByZXYueCA9IHBhcnRpY2xlLng7XG4gICAgcGFydGljbGUucHJldi55ID0gcGFydGljbGUueTtcbiAgICAvLyBVcGRhdGUgcG9zXG4gICAgcGFydGljbGUueCArPSBwYXJ0aWNsZS52ZWwueCAqIGN0eC5kZWx0YVRpbWU7XG4gICAgcGFydGljbGUueSArPSBwYXJ0aWNsZS52ZWwueSAqIGN0eC5kZWx0YVRpbWU7XG4gICAgaWYgKHBhcnRpY2xlLnggPiBjdHguY2FudmFzLndpZHRoKSB7XG4gICAgICAgIHBhcnRpY2xlLnZlbC54ICo9IC1wYXJ0aWNsZUJvdW5jZU1vZDtcbiAgICAgICAgcGFydGljbGUueCA9XG4gICAgICAgICAgICBjdHguY2FudmFzLndpZHRoIC0gKHBhcnRpY2xlLnggLSBjdHguY2FudmFzLndpZHRoKSAqIHBhcnRpY2xlQm91bmNlTW9kO1xuICAgIH1cbiAgICBlbHNlIGlmIChwYXJ0aWNsZS54IDwgMCkge1xuICAgICAgICBwYXJ0aWNsZS52ZWwueCAqPSAtcGFydGljbGVCb3VuY2VNb2Q7XG4gICAgICAgIHBhcnRpY2xlLnggKj0gLXBhcnRpY2xlQm91bmNlTW9kO1xuICAgIH1cbiAgICBpZiAocGFydGljbGUueSA+IGN0eC5jYW52YXMuaGVpZ2h0KSB7XG4gICAgICAgIHBhcnRpY2xlLnZlbC55ICo9IC1wYXJ0aWNsZUJvdW5jZU1vZDtcbiAgICAgICAgcGFydGljbGUueSA9XG4gICAgICAgICAgICBjdHguY2FudmFzLmhlaWdodCAtIChwYXJ0aWNsZS55IC0gY3R4LmNhbnZhcy5oZWlnaHQpICogcGFydGljbGVCb3VuY2VNb2Q7XG4gICAgfVxuICAgIGVsc2UgaWYgKHBhcnRpY2xlLnkgPCAwKSB7XG4gICAgICAgIHBhcnRpY2xlLnZlbC55ICo9IC0xO1xuICAgICAgICBwYXJ0aWNsZS55ICo9IC0xO1xuICAgIH1cbiAgICBwYXJ0aWNsZS52ZWwueSArPSBncmF2aXR5ICogY3R4LmRlbHRhVGltZTtcbiAgICBwYXJ0aWNsZS52ZWwueCAqPSAxIC0gZHJhZyAqIGN0eC5kZWx0YVRpbWU7XG4gICAgcGFydGljbGUuYWxwaGEgKj0gMSAtIHBhcnRpY2xlRmFkZSAqIGN0eC5kZWx0YVRpbWU7XG59XG5mdW5jdGlvbiBpbml0KCkge1xuICAgIGN0eC5jYXJldCA9ICQoXCIjY2FyZXRcIik7XG4gICAgY3R4LmNhbnZhcyA9IGNyZWF0ZUNhbnZhcygpO1xuICAgIGN0eC5jb250ZXh0MmQgPSBjdHguY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbn1cbmV4cG9ydHMuaW5pdCA9IGluaXQ7XG5mdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgaWYgKCFjdHgubGFzdEZyYW1lIHx8ICFjdHguY29udGV4dDJkIHx8ICFjdHguY2FudmFzKVxuICAgICAgICByZXR1cm47XG4gICAgY3R4LnJlbmRlcmluZyA9IHRydWU7XG4gICAgY29uc3QgdGltZSA9IERhdGUubm93KCk7XG4gICAgY3R4LmRlbHRhVGltZSA9ICh0aW1lIC0gY3R4Lmxhc3RGcmFtZSkgLyAxMDAwO1xuICAgIGN0eC5sYXN0RnJhbWUgPSB0aW1lO1xuICAgIGN0eC5jb250ZXh0MmQuY2xlYXJSZWN0KDAsIDAsIGN0eC5jYW52YXMud2lkdGgsIGN0eC5jYW52YXMuaGVpZ2h0KTtcbiAgICBjb25zdCBrZWVwID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjdHgucGFydGljbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2xlID0gY3R4LnBhcnRpY2xlc1tpXTtcbiAgICAgICAgaWYgKHBhcnRpY2xlLmFscGhhIDwgMC4xKVxuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIHVwZGF0ZVBhcnRpY2xlKHBhcnRpY2xlKTtcbiAgICAgICAgY3R4LmNvbnRleHQyZC5nbG9iYWxBbHBoYSA9IHBhcnRpY2xlLmFscGhhO1xuICAgICAgICBjdHguY29udGV4dDJkLnN0cm9rZVN0eWxlID0gcGFydGljbGUuY29sb3I7XG4gICAgICAgIGN0eC5jb250ZXh0MmQubGluZVdpZHRoID0gcGFydGljbGVTaXplO1xuICAgICAgICBjdHguY29udGV4dDJkLmJlZ2luUGF0aCgpO1xuICAgICAgICBjdHguY29udGV4dDJkLm1vdmVUbyhNYXRoLnJvdW5kKHBhcnRpY2xlLnByZXYueCksIE1hdGgucm91bmQocGFydGljbGUucHJldi55KSk7XG4gICAgICAgIGN0eC5jb250ZXh0MmQubGluZVRvKE1hdGgucm91bmQocGFydGljbGUueCksIE1hdGgucm91bmQocGFydGljbGUueSkpO1xuICAgICAgICBjdHguY29udGV4dDJkLnN0cm9rZSgpO1xuICAgICAgICBrZWVwLnB1c2gocGFydGljbGUpO1xuICAgIH1cbiAgICBjdHgucGFydGljbGVzID0ga2VlcDtcbiAgICBpZiAoY3R4LnBhcnRpY2xlcy5sZW5ndGggJiYgIVNsb3dUaW1lci5nZXQoKSkge1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocmVuZGVyKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGN0eC5jb250ZXh0MmQuY2xlYXJSZWN0KDAsIDAsIGN0eC5jYW52YXMud2lkdGgsIGN0eC5jYW52YXMuaGVpZ2h0KTtcbiAgICAgICAgY3R4LnJlbmRlcmluZyA9IGZhbHNlO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHJlc2V0KGltbWVkaWF0ZSA9IGZhbHNlKSB7XG4gICAgaWYgKCFjdHgucmVzZXRUaW1lT3V0KVxuICAgICAgICByZXR1cm47XG4gICAgZGVsZXRlIGN0eC5yZXNldFRpbWVPdXQ7XG4gICAgY2xlYXJUaW1lb3V0KGN0eC5yZXNldFRpbWVPdXQpO1xuICAgIGNvbnN0IGJvZHkgPSAkKGRvY3VtZW50LmJvZHkpO1xuICAgIGJvZHkuY3NzKFwidHJhbnNpdGlvblwiLCBcImFsbCAuMjVzLCB0cmFuc2Zvcm0gMC44c1wiKTtcbiAgICBib2R5LmNzcyhcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKDAsMClgKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgYm9keS5jc3MoXCJ0cmFuc2l0aW9uXCIsIFwiYWxsIC4yNXMsIHRyYW5zZm9ybSAuMDVzXCIpO1xuICAgICAgICAkKFwiaHRtbFwiKS5jc3MoXCJvdmVyZmxvd1wiLCBcImluaGVyaXRcIik7XG4gICAgICAgICQoXCJodG1sXCIpLmNzcyhcIm92ZXJmbG93LXlcIiwgXCJzY3JvbGxcIik7XG4gICAgfSwgaW1tZWRpYXRlID8gMCA6IDEwMDApO1xufVxuZXhwb3J0cy5yZXNldCA9IHJlc2V0O1xuZnVuY3Rpb24gc3RhcnRSZW5kZXIoKSB7XG4gICAgaWYgKCFjdHgucmVuZGVyaW5nKSB7XG4gICAgICAgIGN0eC5sYXN0RnJhbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICByZW5kZXIoKTtcbiAgICB9XG59XG5mdW5jdGlvbiByYW5kb21Db2xvcigpIHtcbiAgICBjb25zdCByID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjU2KS50b1N0cmluZygxNik7XG4gICAgY29uc3QgZyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI1NikudG9TdHJpbmcoMTYpO1xuICAgIGNvbnN0IGIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyNTYpLnRvU3RyaW5nKDE2KTtcbiAgICByZXR1cm4gYCMke3J9JHtnfSR7Yn1gO1xufVxuLyoqXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGdvb2QgR29vZCBwb3dlciBvciBub3Q/XG4gKi9cbmZ1bmN0aW9uIGFkZFBvd2VyKGdvb2QgPSB0cnVlLCBleHRyYSA9IGZhbHNlKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZTtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb25rZXlQb3dlckxldmVsID09PSBcIm9mZlwiIHx8IFNsb3dUaW1lci5nZXQoKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgLy8gU2hha2VcbiAgICAgICAgaWYgKFtcIjNcIiwgXCI0XCJdLmluY2x1ZGVzKGNvbmZpZ18xLmRlZmF1bHQubW9ua2V5UG93ZXJMZXZlbCkpIHtcbiAgICAgICAgICAgICQoXCJodG1sXCIpLmNzcyhcIm92ZXJmbG93XCIsIFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgY29uc3Qgc2hha2UgPSBbXG4gICAgICAgICAgICAgICAgTWF0aC5yb3VuZChzaGFrZUFtb3VudCAtIE1hdGgucmFuZG9tKCkgKiBzaGFrZUFtb3VudCksXG4gICAgICAgICAgICAgICAgTWF0aC5yb3VuZChzaGFrZUFtb3VudCAtIE1hdGgucmFuZG9tKCkgKiBzaGFrZUFtb3VudCksXG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgJChkb2N1bWVudC5ib2R5KS5jc3MoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke3NoYWtlWzBdfXB4LCAke3NoYWtlWzFdfXB4KWApO1xuICAgICAgICAgICAgaWYgKGN0eC5yZXNldFRpbWVPdXQpXG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGN0eC5yZXNldFRpbWVPdXQpO1xuICAgICAgICAgICAgY3R4LnJlc2V0VGltZU91dCA9IHNldFRpbWVvdXQocmVzZXQsIDIwMDApO1xuICAgICAgICB9XG4gICAgICAgIC8vIFNwYXJrc1xuICAgICAgICBjb25zdCBvZmZzZXQgPSAoX2EgPSBjdHguY2FyZXQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5vZmZzZXQoKTtcbiAgICAgICAgY29uc3QgY29vcmRzID0gW1xuICAgICAgICAgICAgKF9iID0gb2Zmc2V0ID09PSBudWxsIHx8IG9mZnNldCA9PT0gdm9pZCAwID8gdm9pZCAwIDogb2Zmc2V0LmxlZnQpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IDAsXG4gICAgICAgICAgICAoKF9jID0gb2Zmc2V0ID09PSBudWxsIHx8IG9mZnNldCA9PT0gdm9pZCAwID8gdm9pZCAwIDogb2Zmc2V0LnRvcCkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogMCkgKyAoKF9lID0gKF9kID0gY3R4LmNhcmV0KSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QuaGVpZ2h0KCkpICE9PSBudWxsICYmIF9lICE9PSB2b2lkIDAgPyBfZSA6IDApLFxuICAgICAgICBdO1xuICAgICAgICBmb3IgKGxldCBpID0gTWF0aC5yb3VuZCgocGFydGljbGVDcmVhdGVDb3VudFswXSArIE1hdGgucmFuZG9tKCkgKiBwYXJ0aWNsZUNyZWF0ZUNvdW50WzFdKSAqXG4gICAgICAgICAgICAoZXh0cmEgPyAyIDogMSkpOyBpID4gMDsgaS0tKSB7XG4gICAgICAgICAgICBjb25zdCBjb2xvciA9IFtcIjJcIiwgXCI0XCJdLmluY2x1ZGVzKGNvbmZpZ18xLmRlZmF1bHQubW9ua2V5UG93ZXJMZXZlbClcbiAgICAgICAgICAgICAgICA/IHJhbmRvbUNvbG9yKClcbiAgICAgICAgICAgICAgICA6IGdvb2RcbiAgICAgICAgICAgICAgICAgICAgPyB5aWVsZCBUaGVtZUNvbG9ycy5nZXQoXCJjYXJldFwiKVxuICAgICAgICAgICAgICAgICAgICA6IHlpZWxkIFRoZW1lQ29sb3JzLmdldChcImVycm9yXCIpO1xuICAgICAgICAgICAgY3R4LnBhcnRpY2xlcy5wdXNoKGNyZWF0ZVBhcnRpY2xlKC4uLmNvb3JkcywgY29sb3IpKTtcbiAgICAgICAgfVxuICAgICAgICBzdGFydFJlbmRlcigpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5hZGRQb3dlciA9IGFkZFBvd2VyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuYWRkQmFubmVyID0gZXhwb3J0cy5hZGQgPSB2b2lkIDA7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmxldCBpZCA9IDA7XG5jbGFzcyBOb3RpZmljYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKHR5cGUsIG1lc3NhZ2UsIGxldmVsLCBkdXJhdGlvbiwgY3VzdG9tVGl0bGUsIGN1c3RvbUljb24sIGNsb3NlQ2FsbGJhY2sgPSAoKSA9PiB7XG4gICAgICAgIC8vXG4gICAgfSkge1xuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlO1xuICAgICAgICB0aGlzLmxldmVsID0gbGV2ZWw7XG4gICAgICAgIGlmICh0eXBlID09PSBcImJhbm5lclwiKSB7XG4gICAgICAgICAgICB0aGlzLmR1cmF0aW9uID0gZHVyYXRpb247XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoZHVyYXRpb24gPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGxldmVsID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmR1cmF0aW9uID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHVyYXRpb24gPSAzMDAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZHVyYXRpb24gPSBkdXJhdGlvbiAqIDEwMDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jdXN0b21UaXRsZSA9IGN1c3RvbVRpdGxlO1xuICAgICAgICB0aGlzLmN1c3RvbUljb24gPSBjdXN0b21JY29uO1xuICAgICAgICB0aGlzLmlkID0gaWQrKztcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gY2xvc2VDYWxsYmFjaztcbiAgICB9XG4gICAgLy9sZXZlbFxuICAgIC8vMCAtIG5vdGljZVxuICAgIC8vMSAtIGdvb2RcbiAgICAvLy0xIC0gYmFkXG4gICAgc2hvdygpIHtcbiAgICAgICAgbGV0IGNscyA9IFwibm90aWNlXCI7XG4gICAgICAgIGxldCBpY29uID0gYDxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWV4Y2xhbWF0aW9uXCI+PC9pPmA7XG4gICAgICAgIGxldCB0aXRsZSA9IFwiTm90aWNlXCI7XG4gICAgICAgIGlmICh0aGlzLmxldmVsID09PSAxKSB7XG4gICAgICAgICAgICBjbHMgPSBcImdvb2RcIjtcbiAgICAgICAgICAgIGljb24gPSBgPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtY2hlY2tcIj48L2k+YDtcbiAgICAgICAgICAgIHRpdGxlID0gXCJTdWNjZXNzXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5sZXZlbCA9PT0gLTEpIHtcbiAgICAgICAgICAgIGNscyA9IFwiYmFkXCI7XG4gICAgICAgICAgICBpY29uID0gYDxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXRpbWVzXCI+PC9pPmA7XG4gICAgICAgICAgICB0aXRsZSA9IFwiRXJyb3JcIjtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IodGhpcy5tZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jdXN0b21UaXRsZSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRpdGxlID0gdGhpcy5jdXN0b21UaXRsZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50eXBlID09PSBcImJhbm5lclwiKSB7XG4gICAgICAgICAgICBpY29uID0gYDxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWJ1bGxob3JuXCI+PC9pPmA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY3VzdG9tSWNvbiAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGljb24gPSBgPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtJHt0aGlzLmN1c3RvbUljb259XCI+PC9pPmA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gXCJub3RpZmljYXRpb25cIikge1xuICAgICAgICAgICAgLy8gbW92ZUN1cnJlbnRUb0hpc3RvcnkoKTtcbiAgICAgICAgICAgIGNvbnN0IG9sZEhlaWdodCA9ICQoXCIjbm90aWZpY2F0aW9uQ2VudGVyIC5oaXN0b3J5XCIpLmhlaWdodCgpO1xuICAgICAgICAgICAgJChcIiNub3RpZmljYXRpb25DZW50ZXIgLmhpc3RvcnlcIikucHJlcGVuZChgXG4gICAgICAgICAgXG4gICAgICAgICAgPGRpdiBjbGFzcz1cIm5vdGlmICR7Y2xzfVwiIGlkPSR7dGhpcy5pZH0+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJpY29uXCI+JHtpY29ufTwvZGl2PlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWVzc2FnZVwiPjxkaXYgY2xhc3M9XCJ0aXRsZVwiPiR7dGl0bGV9PC9kaXY+JHt0aGlzLm1lc3NhZ2V9PC9kaXY+XG4gICAgICAgICAgPC9kaXY+ICAgICBcblxuICAgICAgICAgIGApO1xuICAgICAgICAgICAgY29uc3QgbmV3SGVpZ2h0ID0gJChcIiNub3RpZmljYXRpb25DZW50ZXIgLmhpc3RvcnlcIikuaGVpZ2h0KCk7XG4gICAgICAgICAgICAkKGAjbm90aWZpY2F0aW9uQ2VudGVyIC5ub3RpZltpZD0nJHt0aGlzLmlkfSddYCkucmVtb3ZlKCk7XG4gICAgICAgICAgICAkKFwiI25vdGlmaWNhdGlvbkNlbnRlciAuaGlzdG9yeVwiKVxuICAgICAgICAgICAgICAgIC5jc3MoXCJtYXJnaW4tdG9wXCIsIDApXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIG1hcmdpblRvcDogbmV3SGVpZ2h0IC0gb2xkSGVpZ2h0LFxuICAgICAgICAgICAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgJChcIiNub3RpZmljYXRpb25DZW50ZXIgLmhpc3RvcnlcIikuY3NzKFwibWFyZ2luLXRvcFwiLCAwKTtcbiAgICAgICAgICAgICAgICAkKFwiI25vdGlmaWNhdGlvbkNlbnRlciAuaGlzdG9yeVwiKS5wcmVwZW5kKGBcbiAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJub3RpZiAke2Nsc31cIiBpZD0ke3RoaXMuaWR9PlxuICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJpY29uXCI+JHtpY29ufTwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtZXNzYWdlXCI+PGRpdiBjbGFzcz1cInRpdGxlXCI+JHt0aXRsZX08L2Rpdj4ke3RoaXMubWVzc2FnZX08L2Rpdj5cbiAgICAgICAgICAgICAgICAgIDwvZGl2PiAgICAgXG5cbiAgICAgICAgICAgICAgYCk7XG4gICAgICAgICAgICAgICAgJChgI25vdGlmaWNhdGlvbkNlbnRlciAubm90aWZbaWQ9JyR7dGhpcy5pZH0nXWApXG4gICAgICAgICAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgICAgICB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgJChgI25vdGlmaWNhdGlvbkNlbnRlciAubm90aWZbaWQ9JyR7dGhpcy5pZH0nXWApLmNzcyhcIm9wYWNpdHlcIiwgXCJcIik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgJChgI25vdGlmaWNhdGlvbkNlbnRlciAubm90aWZbaWQ9JyR7dGhpcy5pZH0nXWApLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICQoYCNub3RpZmljYXRpb25DZW50ZXIgLm5vdGlmW2lkPScke3RoaXMuaWR9J11gKS5ob3ZlcigoKSA9PiB7XG4gICAgICAgICAgICAgICAgJChgI25vdGlmaWNhdGlvbkNlbnRlciAubm90aWZbaWQ9JyR7dGhpcy5pZH0nXWApLnRvZ2dsZUNsYXNzKFwiaG92ZXJcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnR5cGUgPT09IFwiYmFubmVyXCIpIHtcbiAgICAgICAgICAgIGxldCBsZWZ0c2lkZSA9IGA8ZGl2IGNsYXNzPVwiaWNvbiBsZWZ0aWNvblwiPiR7aWNvbn08L2Rpdj5gO1xuICAgICAgICAgICAgaWYgKC9eaW1hZ2VzXFwvLiovLnRlc3QodGhpcy5jdXN0b21JY29uKSkge1xuICAgICAgICAgICAgICAgIGxlZnRzaWRlID0gYDxkaXYgY2xhc3M9XCJpbWFnZVwiIHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKCR7dGhpcy5jdXN0b21JY29ufSlcIj48L2Rpdj5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJChcIiNiYW5uZXJDZW50ZXJcIikucHJlcGVuZChgXG4gICAgICAgIDxkaXYgY2xhc3M9XCJiYW5uZXIgJHtjbHN9XCIgaWQ9XCIke3RoaXMuaWR9XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb250YWluZXJcIj5cbiAgICAgICAgICAke2xlZnRzaWRlfVxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0ZXh0XCI+XG4gICAgICAgICAgICAke3RoaXMubWVzc2FnZX1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAke3RoaXMuZHVyYXRpb24gPj0gMFxuICAgICAgICAgICAgICAgID8gYFxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJjbG9zZUJ1dHRvblwiPlxuICAgICAgICAgICAgPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtdGltZXNcIj48L2k+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgYFxuICAgICAgICAgICAgICAgIDogYDxkaXYgY2xhc3M9XCJyaWdodGljb25cIj4ke2ljb259PC9kaXY+YH1cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICAgIGApO1xuICAgICAgICAgICAgY29uc3QgaGVpZ2h0ID0gJChcIiNiYW5uZXJDZW50ZXJcIikuaGVpZ2h0KCk7XG4gICAgICAgICAgICAkKFwiI2NlbnRlckNvbnRlbnRcIikuY3NzKFwicGFkZGluZy10b3BcIiwgaGVpZ2h0ICsgTWlzYy5jb252ZXJ0UmVtVG9QaXhlbHMoMikgKyBcInB4XCIpO1xuICAgICAgICAgICAgJChcIiNub3RpZmljYXRpb25DZW50ZXJcIikuY3NzKFwibWFyZ2luLXRvcFwiLCBoZWlnaHQgKyBcInB4XCIpO1xuICAgICAgICAgICAgaWYgKHRoaXMuZHVyYXRpb24gPj0gMCkge1xuICAgICAgICAgICAgICAgICQoYCNiYW5uZXJDZW50ZXIgLmJhbm5lcltpZD0nJHt0aGlzLmlkfSddIC5jbG9zZUJ1dHRvbmApLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZHVyYXRpb24gPiAwKSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgICAgICAgIH0sIHRoaXMuZHVyYXRpb24gKyAyNTApO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhpZGUoKSB7XG4gICAgICAgIGlmICh0aGlzLnR5cGUgPT09IFwibm90aWZpY2F0aW9uXCIpIHtcbiAgICAgICAgICAgICQoYCNub3RpZmljYXRpb25DZW50ZXIgLm5vdGlmW2lkPScke3RoaXMuaWR9J11gKVxuICAgICAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgICAgICAgICAkKGAjbm90aWZpY2F0aW9uQ2VudGVyIC5ub3RpZltpZD0nJHt0aGlzLmlkfSddYCkuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogMCxcbiAgICAgICAgICAgICAgICB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgJChgI25vdGlmaWNhdGlvbkNlbnRlciAubm90aWZbaWQ9JyR7dGhpcy5pZH0nXWApLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy50eXBlID09PSBcImJhbm5lclwiKSB7XG4gICAgICAgICAgICAkKGAjYmFubmVyQ2VudGVyIC5iYW5uZXJbaWQ9JyR7dGhpcy5pZH0nXWApLnJlbW92ZSgpO1xuICAgICAgICAgICAgY29uc3QgaGVpZ2h0ID0gJChcIiNiYW5uZXJDZW50ZXJcIikuaGVpZ2h0KCk7XG4gICAgICAgICAgICAkKFwiI2NlbnRlckNvbnRlbnRcIikuY3NzKFwicGFkZGluZy10b3BcIiwgaGVpZ2h0ICsgTWlzYy5jb252ZXJ0UmVtVG9QaXhlbHMoMikgKyBcInB4XCIpO1xuICAgICAgICAgICAgJChcIiNub3RpZmljYXRpb25DZW50ZXJcIikuY3NzKFwibWFyZ2luLXRvcFwiLCBoZWlnaHQgKyBcInB4XCIpO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gYWRkKG1lc3NhZ2UsIGxldmVsID0gMCwgZHVyYXRpb24sIGN1c3RvbVRpdGxlLCBjdXN0b21JY29uLCBjbG9zZUNhbGxiYWNrKSB7XG4gICAgLy8gbm90aWZpY2F0aW9uSGlzdG9yeS5wdXNoKFxuICAgIG5ldyBOb3RpZmljYXRpb24oXCJub3RpZmljYXRpb25cIiwgbWVzc2FnZSwgbGV2ZWwsIGR1cmF0aW9uLCBjdXN0b21UaXRsZSwgY3VzdG9tSWNvbiwgY2xvc2VDYWxsYmFjaykuc2hvdygpO1xuICAgIC8vICk7XG59XG5leHBvcnRzLmFkZCA9IGFkZDtcbmZ1bmN0aW9uIGFkZEJhbm5lcihtZXNzYWdlLCBsZXZlbCA9IC0xLCBjdXN0b21JY29uID0gXCJidWxsaG9yblwiLCBzdGlja3kgPSBmYWxzZSwgY2xvc2VDYWxsYmFjaykge1xuICAgIC8vIG5vdGlmaWNhdGlvbkhpc3RvcnkucHVzaChcbiAgICBuZXcgTm90aWZpY2F0aW9uKFwiYmFubmVyXCIsIG1lc3NhZ2UsIGxldmVsLCBzdGlja3kgPyAtMSA6IDAsIHVuZGVmaW5lZCwgY3VzdG9tSWNvbiwgY2xvc2VDYWxsYmFjaykuc2hvdygpO1xuICAgIC8vICk7XG59XG5leHBvcnRzLmFkZEJhbm5lciA9IGFkZEJhbm5lcjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmNvbnN0IGFwZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9hcGVcIikpO1xuY29uc3QgbWlzY18xID0gcmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIik7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgZm9ybWF0XzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImRhdGUtZm5zL2Zvcm1hdFwiKSk7XG5mdW5jdGlvbiBjbGVhck1lbW9yeSgpIHtcbiAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJjb25maXJtZWRQU0FzXCIsIEpTT04uc3RyaW5naWZ5KFtdKSk7XG59XG5mdW5jdGlvbiBnZXRNZW1vcnkoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICByZXR1cm4gKF9iID0gSlNPTi5wYXJzZSgoX2EgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJjb25maXJtZWRQU0FzXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIltdXCIpKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBbXTtcbn1cbmZ1bmN0aW9uIHNldE1lbW9yeShpZCkge1xuICAgIGNvbnN0IGxpc3QgPSBnZXRNZW1vcnkoKTtcbiAgICBsaXN0LnB1c2goaWQpO1xuICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImNvbmZpcm1lZFBTQXNcIiwgSlNPTi5zdHJpbmdpZnkobGlzdCkpO1xufVxuZnVuY3Rpb24gZ2V0TGF0ZXN0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5wc2FzLmdldCgpO1xuICAgICAgICBpZiAocmVzcG9uc2UubWVzc2FnZSA9PT0gXCJTZXJ2ZXIgaXMgZG93biBmb3IgbWFpbnRlbmFuY2VcIikge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGRCYW5uZXIoXCJTZXJ2ZXIgaXMgY3VycmVudGx5IHVuZGVyIG1haW50ZW5hbmNlLiA8YSB0YXJnZXQ9ICdfYmxhbmsnIGhyZWY9J2h0dHBzOi8vbW9ua2V5dHlwZS5pbnN0YXR1cy5jb20vJz5DbGljayBoZXJlPC9hPiBmb3IgbW9yZSBpbmZvLlwiLCAtMSwgXCJidWxsaG9yblwiLCB0cnVlKTtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgbGF0ZXN0ID0geWllbGQgZ2V0TGF0ZXN0KCk7XG4gICAgICAgIGlmIChsYXRlc3QgPT0gbnVsbCB8fCBsYXRlc3QubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIGNsZWFyTWVtb3J5KCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9jYWxtZW1vcnkgPSBnZXRNZW1vcnkoKTtcbiAgICAgICAgbGF0ZXN0LmZvckVhY2goKHBzYSkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgaWYgKGxvY2FsbWVtb3J5LmluY2x1ZGVzKHBzYS5faWQpICYmICgoX2EgPSBwc2Euc3RpY2t5KSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBmYWxzZSkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHBzYS5kYXRlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGF0ZU9iaiA9IG5ldyBEYXRlKHBzYS5kYXRlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBkaWZmID0gcHNhLmRhdGUgLSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0cmluZyA9ICgwLCBtaXNjXzEuc2Vjb25kc1RvU3RyaW5nKShkaWZmIC8gMTAwMCwgZmFsc2UsIGZhbHNlLCBcInRleHRcIiwgZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgICAgIHBzYS5tZXNzYWdlID0gcHNhLm1lc3NhZ2UucmVwbGFjZShcIntkYXRlRGlmZmVyZW5jZX1cIiwgc3RyaW5nKTtcbiAgICAgICAgICAgICAgICBwc2EubWVzc2FnZSA9IHBzYS5tZXNzYWdlLnJlcGxhY2UoXCJ7ZGF0ZU5vVGltZX1cIiwgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGVPYmosIFwiZGQgTU1NIHl5eXlcIikpO1xuICAgICAgICAgICAgICAgIHBzYS5tZXNzYWdlID0gcHNhLm1lc3NhZ2UucmVwbGFjZShcIntkYXRlfVwiLCAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZU9iaiwgXCJkZCBNTU0geXl5eSBISDptbVwiKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZEJhbm5lcihwc2EubWVzc2FnZSwgcHNhLmxldmVsLCBcImJ1bGxob3JuXCIsIHBzYS5zdGlja3ksICgpID0+IHtcbiAgICAgICAgICAgICAgICBzZXRNZW1vcnkocHNhLl9pZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IEFjdGl2ZVBhZ2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9hY3RpdmUtcGFnZVwiKSk7XG5sZXQgdmlzaWJsZSA9IGZhbHNlO1xuJChcIi5zY3JvbGxUb1RvcEJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICB3aW5kb3cuc2Nyb2xsVG8oeyB0b3A6IDAsIGJlaGF2aW9yOiBcInNtb290aFwiIH0pO1xufSk7XG4kKHdpbmRvdykuc2Nyb2xsKCgpID0+IHtcbiAgICBjb25zdCBwYWdlID0gQWN0aXZlUGFnZS5nZXQoKTtcbiAgICBpZiAocGFnZSA9PSBcInRlc3RcIilcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChwYWdlID09IFwiYWJvdXRcIiB8fCBwYWdlID09IFwic2V0dGluZ3NcIiB8fCBwYWdlID09IFwiYWNjb3VudFwiKSB7XG4gICAgICAgIGNvbnN0IHNjcm9sbCA9IHdpbmRvdy5zY3JvbGxZO1xuICAgICAgICBpZiAoIXZpc2libGUgJiYgc2Nyb2xsID4gMTAwKSB7XG4gICAgICAgICAgICAkKFwiLnNjcm9sbFRvVG9wQnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiaW52aXNpYmxlXCIpO1xuICAgICAgICAgICAgdmlzaWJsZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodmlzaWJsZSAmJiBzY3JvbGwgPCAxMDApIHtcbiAgICAgICAgICAgICQoXCIuc2Nyb2xsVG9Ub3BCdXR0b25cIikuYWRkQ2xhc3MoXCJpbnZpc2libGVcIik7XG4gICAgICAgICAgICB2aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZSA9IGV4cG9ydHMucmVzZXQgPSBleHBvcnRzLmdldEFsbCA9IGV4cG9ydHMuZ2V0ID0gdm9pZCAwO1xubGV0IGNvbG9ycyA9IHtcbiAgICBiZzogXCIjMzIzNDM3XCIsXG4gICAgbWFpbjogXCIjZTJiNzE0XCIsXG4gICAgY2FyZXQ6IFwiI2UyYjcxNFwiLFxuICAgIHN1YjogXCIjNjQ2NjY5XCIsXG4gICAgdGV4dDogXCIjZDFkMGM1XCIsXG4gICAgZXJyb3I6IFwiI2NhNDc1NFwiLFxuICAgIGVycm9yRXh0cmE6IFwiIzdlMmEzM1wiLFxuICAgIGNvbG9yZnVsRXJyb3I6IFwiI2NhNDc1NFwiLFxuICAgIGNvbG9yZnVsRXJyb3JFeHRyYTogXCIjN2UyYTMzXCIsXG59O1xuZnVuY3Rpb24gZ2V0KGNvbG9yKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCFjb2xvcnNbY29sb3JdKVxuICAgICAgICAgICAgdXBkYXRlKCk7XG4gICAgICAgIHJldHVybiBjb2xvcnNbY29sb3JdO1xuICAgIH0pO1xufVxuZXhwb3J0cy5nZXQgPSBnZXQ7XG5mdW5jdGlvbiBnZXRBbGwoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCFjb2xvcnMuYmcpXG4gICAgICAgICAgICB1cGRhdGUoKTtcbiAgICAgICAgcmV0dXJuIGNvbG9ycztcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0QWxsID0gZ2V0QWxsO1xuZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgY29sb3JzID0ge1xuICAgICAgICBiZzogXCJcIixcbiAgICAgICAgbWFpbjogXCJcIixcbiAgICAgICAgY2FyZXQ6IFwiXCIsXG4gICAgICAgIHN1YjogXCJcIixcbiAgICAgICAgdGV4dDogXCJcIixcbiAgICAgICAgZXJyb3I6IFwiXCIsXG4gICAgICAgIGVycm9yRXh0cmE6IFwiXCIsXG4gICAgICAgIGNvbG9yZnVsRXJyb3I6IFwiXCIsXG4gICAgICAgIGNvbG9yZnVsRXJyb3JFeHRyYTogXCJcIixcbiAgICB9O1xufVxuZXhwb3J0cy5yZXNldCA9IHJlc2V0O1xuZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgIGNvbnN0IHN0ID0gZ2V0Q29tcHV0ZWRTdHlsZShkb2N1bWVudC5ib2R5KTtcbiAgICBjb2xvcnMuYmcgPSBzdC5nZXRQcm9wZXJ0eVZhbHVlKFwiLS1iZy1jb2xvclwiKS5yZXBsYWNlKFwiIFwiLCBcIlwiKTtcbiAgICBjb2xvcnMubWFpbiA9IHN0LmdldFByb3BlcnR5VmFsdWUoXCItLW1haW4tY29sb3JcIikucmVwbGFjZShcIiBcIiwgXCJcIik7XG4gICAgY29sb3JzLmNhcmV0ID0gc3QuZ2V0UHJvcGVydHlWYWx1ZShcIi0tY2FyZXQtY29sb3JcIikucmVwbGFjZShcIiBcIiwgXCJcIik7XG4gICAgY29sb3JzLnN1YiA9IHN0LmdldFByb3BlcnR5VmFsdWUoXCItLXN1Yi1jb2xvclwiKS5yZXBsYWNlKFwiIFwiLCBcIlwiKTtcbiAgICBjb2xvcnMudGV4dCA9IHN0LmdldFByb3BlcnR5VmFsdWUoXCItLXRleHQtY29sb3JcIikucmVwbGFjZShcIiBcIiwgXCJcIik7XG4gICAgY29sb3JzLmVycm9yID0gc3QuZ2V0UHJvcGVydHlWYWx1ZShcIi0tZXJyb3ItY29sb3JcIikucmVwbGFjZShcIiBcIiwgXCJcIik7XG4gICAgY29sb3JzLmVycm9yRXh0cmEgPSBzdFxuICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcIi0tZXJyb3ItZXh0cmEtY29sb3JcIilcbiAgICAgICAgLnJlcGxhY2UoXCIgXCIsIFwiXCIpO1xuICAgIGNvbG9ycy5jb2xvcmZ1bEVycm9yID0gc3RcbiAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCItLWNvbG9yZnVsLWVycm9yLWNvbG9yXCIpXG4gICAgICAgIC5yZXBsYWNlKFwiIFwiLCBcIlwiKTtcbiAgICBjb2xvcnMuY29sb3JmdWxFcnJvckV4dHJhID0gc3RcbiAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCItLWNvbG9yZnVsLWVycm9yLWV4dHJhLWNvbG9yXCIpXG4gICAgICAgIC5yZXBsYWNlKFwiIFwiLCBcIlwiKTtcbn1cbmV4cG9ydHMudXBkYXRlID0gdXBkYXRlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9ub3RpZmljYXRpb25zXCIpKTtcbi8vIGltcG9ydCAqIGFzIFZlcnNpb25Qb3B1cCBmcm9tIFwiLi92ZXJzaW9uLXBvcHVwXCI7XG5mdW5jdGlvbiBzZXRNZW1vcnkodikge1xuICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImxhc3RTZWVuVmVyc2lvblwiLCB2KTtcbn1cbmZ1bmN0aW9uIGdldE1lbW9yeSgpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIChfYSA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImxhc3RTZWVuVmVyc2lvblwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCJcIjtcbn1cbmZ1bmN0aW9uIHNob3codmVyc2lvbikge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IG1lbW9yeSA9IHlpZWxkIGdldE1lbW9yeSgpO1xuICAgICAgICBpZiAobWVtb3J5ID09PSBcIlwiKSB7XG4gICAgICAgICAgICBzZXRNZW1vcnkodmVyc2lvbik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSA9PT0gXCJsb2NhbGhvc3RcIiB8fFxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lID09PSBcIjEyNy4wLjAuMVwiKSB7XG4gICAgICAgICAgICBjYWNoZXMua2V5cygpLnRoZW4oZnVuY3Rpb24gKG5hbWVzKSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBuYW1lIG9mIG5hbWVzKVxuICAgICAgICAgICAgICAgICAgICBjYWNoZXMuZGVsZXRlKG5hbWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1lbW9yeSA9PT0gdmVyc2lvbilcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY2FjaGVzLmtleXMoKS50aGVuKGZ1bmN0aW9uIChuYW1lcykge1xuICAgICAgICAgICAgZm9yIChjb25zdCBuYW1lIG9mIG5hbWVzKVxuICAgICAgICAgICAgICAgIGNhY2hlcy5kZWxldGUobmFtZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZEJhbm5lcihgVmVyc2lvbiAke3ZlcnNpb259IGhhcyBiZWVuIHJlbGVhc2VkLiBDbGljayB0aGUgdmVyc2lvbiBudW1iZXIgaW4gdGhlIGJvdHRvbSByaWdodCB0byB2aWV3IHRoZSBjaGFuZ2Vsb2cuYCwgMSwgXCJjb2RlLWJyYW5jaFwiLCBmYWxzZSk7XG4gICAgICAgIHNldE1lbW9yeSh2ZXJzaW9uKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQW5hbHl0aWNzID0gZXhwb3J0cy5BdXRoID0gdm9pZCAwO1xuLy8gSW1wb3J0IHRoZSBmdW5jdGlvbnMgeW91IG5lZWQgZnJvbSB0aGUgU0RLcyB5b3UgbmVlZFxuY29uc3QgYXBwXzEgPSByZXF1aXJlKFwiZmlyZWJhc2UvYXBwXCIpO1xuY29uc3QgYXV0aF8xID0gcmVxdWlyZShcImZpcmViYXNlL2F1dGhcIik7XG5jb25zdCBmaXJlYmFzZV9jb25maWdfMSA9IHJlcXVpcmUoXCIuL2NvbnN0YW50cy9maXJlYmFzZS1jb25maWdcIik7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1wYXRoLWV4aXN0cy9leGlzdHNcbmNvbnN0IGFuYWx5dGljc18xID0gcmVxdWlyZShcImZpcmViYXNlL2FuYWx5dGljc1wiKTtcbi8vIEluaXRpYWxpemUgRmlyZWJhc2VcbmxldCBhcHA7XG50cnkge1xuICAgIGFwcCA9ICgwLCBhcHBfMS5pbml0aWFsaXplQXBwKShmaXJlYmFzZV9jb25maWdfMS5maXJlYmFzZUNvbmZpZyk7XG4gICAgZXhwb3J0cy5BdXRoID0gKDAsIGF1dGhfMS5nZXRBdXRoKShhcHApO1xuICAgIGV4cG9ydHMuQW5hbHl0aWNzID0gKDAsIGFuYWx5dGljc18xLmdldEFuYWx5dGljcykoYXBwKTtcbn1cbmNhdGNoIChlKSB7XG4gICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAkKFwiYm9keVwiKS50ZXh0KFwiRmFpbGVkIHRvIGluaXRpYWxpemUgRmlyZWJhc2UuIEFyZSB5b3Ugc3VyZSB5b3UgaGF2ZSB0aGUgY29ycmVjdCBjb25maWcgaW4gdGhlIGZpcmViYXNlLWNvbmZpZy50cyBmaWxlP1wiKTtcbn1cbiIsIlwidXNlIHN0cmljdFwiO1xuLy8gdGhpcyBmaWxlIHNob3VsZCBiZSBjb25jYXRlbmF0ZWQgYXQgdGhlIHRvcCBvZiB0aGUgbGVnYWN5IGpzIGZpbGVzXG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnJlcXVpcmUoXCIuLi9zdHlsZXMvaW5kZXguc2Nzc1wiKTtcbnJlcXVpcmUoXCIuL2ZpcmViYXNlXCIpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vZGJcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vY29uZmlnXCIpKTtcbmNvbnN0IFRlc3RTdGF0cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0L3Rlc3Qtc3RhdHNcIikpO1xuY29uc3QgUmVwbGF5ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QvcmVwbGF5XCIpKTtcbmNvbnN0IFRlc3RUaW1lciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0L3Rlc3QtdGltZXJcIikpO1xuY29uc3QgUmVzdWx0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QvcmVzdWx0XCIpKTtcbmNvbnN0IFRlc3RJbnB1dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0L3Rlc3QtaW5wdXRcIikpO1xucmVxdWlyZShcIi4vY29udHJvbGxlcnMvYWNjb3VudC1jb250cm9sbGVyXCIpO1xuY29uc3QgZ2xhcnNlc19tb2RlXzEgPSByZXF1aXJlKFwiLi9zdGF0ZXMvZ2xhcnNlcy1tb2RlXCIpO1xucmVxdWlyZShcIi4vdGVzdC9jYXBzLXdhcm5pbmdcIik7XG5yZXF1aXJlKFwiLi9wb3B1cHMvc3VwcG9ydC1wb3B1cFwiKTtcbnJlcXVpcmUoXCIuL3BvcHVwcy9jb250YWN0LXBvcHVwXCIpO1xucmVxdWlyZShcIi4vcG9wdXBzL3ZlcnNpb24tcG9wdXBcIik7XG5yZXF1aXJlKFwiLi9wb3B1cHMvZWRpdC1wcmVzZXQtcG9wdXBcIik7XG5yZXF1aXJlKFwiLi9wb3B1cHMvc2ltcGxlLXBvcHVwc1wiKTtcbnJlcXVpcmUoXCIuL2NvbnRyb2xsZXJzL2lucHV0LWNvbnRyb2xsZXJcIik7XG5yZXF1aXJlKFwiLi9yZWFkeVwiKTtcbnJlcXVpcmUoXCIuL3VpXCIpO1xucmVxdWlyZShcIi4vcGFnZXMvYWJvdXRcIik7XG5yZXF1aXJlKFwiLi9wb3B1cHMvcGItdGFibGVzLXBvcHVwXCIpO1xucmVxdWlyZShcIi4vZWxlbWVudHMvc2Nyb2xsLXRvLXRvcFwiKTtcbnJlcXVpcmUoXCIuL3BvcHVwcy9tb2JpbGUtdGVzdC1jb25maWctcG9wdXBcIik7XG5yZXF1aXJlKFwiLi9wb3B1cHMvZWRpdC10YWdzLXBvcHVwXCIpO1xuY29uc3QgQWNjb3VudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9wYWdlcy9hY2NvdW50XCIpKTtcbmNvbnN0IGV4dGVuZGVkR2xvYmFsID0gZ2xvYmFsO1xuZXh0ZW5kZWRHbG9iYWwuc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdDtcbmV4dGVuZGVkR2xvYmFsLmNvbmZpZyA9IGNvbmZpZ18xLmRlZmF1bHQ7XG5leHRlbmRlZEdsb2JhbC50b2dnbGVGaWx0ZXJEZWJ1ZyA9IEFjY291bnQudG9nZ2xlRmlsdGVyRGVidWc7XG5leHRlbmRlZEdsb2JhbC5nbGFyc2VzTW9kZSA9IGdsYXJzZXNfbW9kZV8xLmVuYWJsZTtcbmV4dGVuZGVkR2xvYmFsLnN0YXRzID0gVGVzdFN0YXRzLmdldFN0YXRzO1xuZXh0ZW5kZWRHbG9iYWwucmVwbGF5ID0gUmVwbGF5LmdldFJlcGxheUV4cG9ydDtcbmV4dGVuZGVkR2xvYmFsLmVuYWJsZVRpbWVyRGVidWcgPSBUZXN0VGltZXIuZW5hYmxlVGltZXJEZWJ1ZztcbmV4dGVuZGVkR2xvYmFsLmdldFRpbWVyU3RhdHMgPSBUZXN0VGltZXIuZ2V0VGltZXJTdGF0cztcbmV4dGVuZGVkR2xvYmFsLnRvZ2dsZVVuc21vb3RoZWRSYXcgPSBSZXN1bHQudG9nZ2xlVW5zbW9vdGhlZFJhdztcbmV4dGVuZGVkR2xvYmFsLmVuYWJsZVNwYWNpbmdEZWJ1ZyA9IFRlc3RJbnB1dC5lbmFibGVTcGFjaW5nRGVidWc7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZGlzcGF0Y2ggPSBleHBvcnRzLnN1YnNjcmliZSA9IHZvaWQgMDtcbmNvbnN0IHN1YnNjcmliZXJzID0gW107XG5mdW5jdGlvbiBzdWJzY3JpYmUoZm4pIHtcbiAgICBzdWJzY3JpYmVycy5wdXNoKGZuKTtcbn1cbmV4cG9ydHMuc3Vic2NyaWJlID0gc3Vic2NyaWJlO1xuZnVuY3Rpb24gZGlzcGF0Y2goa2V5LCBuZXdWYWx1ZSwgbm9zYXZlLCBwcmV2aW91c1ZhbHVlLCBmdWxsQ29uZmlnKSB7XG4gICAgc3Vic2NyaWJlcnMuZm9yRWFjaCgoZm4pID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGZuKGtleSwgbmV3VmFsdWUsIG5vc2F2ZSwgcHJldmlvdXNWYWx1ZSwgZnVsbENvbmZpZyk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDb25maWcgZXZlbnQgc3Vic2NyaWJlciB0aHJldyBhbiBlcnJvclwiKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZGlzcGF0Y2ggPSBkaXNwYXRjaDtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5kaXNwYXRjaCA9IGV4cG9ydHMuc3Vic2NyaWJlID0gdm9pZCAwO1xuY29uc3Qgc3Vic2NyaWJlcnMgPSBbXTtcbmZ1bmN0aW9uIHN1YnNjcmliZShmbikge1xuICAgIHN1YnNjcmliZXJzLnB1c2goZm4pO1xufVxuZXhwb3J0cy5zdWJzY3JpYmUgPSBzdWJzY3JpYmU7XG5mdW5jdGlvbiBkaXNwYXRjaChwcmV2aW91c1BhZ2UsIG5ld1BhZ2UpIHtcbiAgICBzdWJzY3JpYmVycy5mb3JFYWNoKChmbikgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgZm4ocHJldmlvdXNQYWdlLCBuZXdQYWdlKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlBhZ2UgY2hhbmdlIGV2ZW50IHN1YnNjcmliZXIgdGhyZXcgYW4gZXJyb3JcIik7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmRpc3BhdGNoID0gZGlzcGF0Y2g7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZGlzcGF0Y2ggPSBleHBvcnRzLnN1YnNjcmliZSA9IHZvaWQgMDtcbmNvbnN0IHN1YnNjcmliZXJzID0gW107XG5mdW5jdGlvbiBzdWJzY3JpYmUoZm4pIHtcbiAgICBzdWJzY3JpYmVycy5wdXNoKGZuKTtcbn1cbmV4cG9ydHMuc3Vic2NyaWJlID0gc3Vic2NyaWJlO1xuZnVuY3Rpb24gZGlzcGF0Y2goKSB7XG4gICAgc3Vic2NyaWJlcnMuZm9yRWFjaCgoZm4pID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGZuKCk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJSZXNldCByZXF1ZXN0ZWQgZXZlbnQgc3Vic2NyaWJlciB0aHJldyBhbiBlcnJvclwiKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZGlzcGF0Y2ggPSBkaXNwYXRjaDtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5kaXNwYXRjaCA9IGV4cG9ydHMuc3Vic2NyaWJlID0gdm9pZCAwO1xuY29uc3Qgc3Vic2NyaWJlcnMgPSBbXTtcbmZ1bmN0aW9uIHN1YnNjcmliZShmbikge1xuICAgIHN1YnNjcmliZXJzLnB1c2goZm4pO1xufVxuZXhwb3J0cy5zdWJzY3JpYmUgPSBzdWJzY3JpYmU7XG5mdW5jdGlvbiBkaXNwYXRjaChyZXN1bHRzKSB7XG4gICAgc3Vic2NyaWJlcnMuZm9yRWFjaCgoZm4pID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGZuKHJlc3VsdHMpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiUGFnZSBjaGFuZ2UgZXZlbnQgc3Vic2NyaWJlciB0aHJldyBhbiBlcnJvclwiKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZGlzcGF0Y2ggPSBkaXNwYXRjaDtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5kaXNwYXRjaCA9IGV4cG9ydHMuc3Vic2NyaWJlID0gdm9pZCAwO1xuY29uc3Qgc3Vic2NyaWJlcnMgPSBbXTtcbmZ1bmN0aW9uIHN1YnNjcmliZShmbikge1xuICAgIHN1YnNjcmliZXJzLnB1c2goZm4pO1xufVxuZXhwb3J0cy5zdWJzY3JpYmUgPSBzdWJzY3JpYmU7XG5mdW5jdGlvbiBkaXNwYXRjaChrZXksIHZhbHVlLCB2YWx1ZTIpIHtcbiAgICBzdWJzY3JpYmVycy5mb3JFYWNoKChmbikgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgZm4oa2V5LCB2YWx1ZSwgdmFsdWUyKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlRpbWVyIGV2ZW50IHN1YnNjcmliZXIgdGhyZXcgYW4gZXJyb3JcIik7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmRpc3BhdGNoID0gZGlzcGF0Y2g7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZGlzcGF0Y2ggPSBleHBvcnRzLnN1YnNjcmliZSA9IHZvaWQgMDtcbmNvbnN0IHN1YnNjcmliZXJzID0gW107XG5mdW5jdGlvbiBzdWJzY3JpYmUoZm4pIHtcbiAgICBzdWJzY3JpYmVycy5wdXNoKGZuKTtcbn1cbmV4cG9ydHMuc3Vic2NyaWJlID0gc3Vic2NyaWJlO1xuZnVuY3Rpb24gZGlzcGF0Y2god29yZCwgdHlwZWRDb3JyZWN0bHksIGJ1cnN0LCBjdXJyZW50VGVzdFdvcmQpIHtcbiAgICBzdWJzY3JpYmVycy5mb3JFYWNoKChmbikgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgZm4od29yZCwgdHlwZWRDb3JyZWN0bHksIGJ1cnN0LCBjdXJyZW50VGVzdFdvcmQpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiV29yZCBUeXBlZCBldmVudCBzdWJzY3JpYmVyIHRocmV3IGFuIGVycm9yXCIpO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5kaXNwYXRjaCA9IGRpc3BhdGNoO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5wYWdlID0gZXhwb3J0cy5maWxsID0gZXhwb3J0cy5yZXNldCA9IHZvaWQgMDtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgcGFnZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL3BhZ2VcIikpO1xuZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgJChcIi5wYWdlQWJvdXQgLmNvbnRyaWJ1dG9yc1wiKS5lbXB0eSgpO1xuICAgICQoXCIucGFnZUFib3V0IC5zdXBwb3J0ZXJzXCIpLmVtcHR5KCk7XG59XG5leHBvcnRzLnJlc2V0ID0gcmVzZXQ7XG5mdW5jdGlvbiBmaWxsKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IHN1cHBvcnRlcnMgPSB5aWVsZCBNaXNjLmdldFN1cHBvcnRlcnNMaXN0KCk7XG4gICAgICAgIGNvbnN0IGNvbnRyaWJ1dG9ycyA9IHlpZWxkIE1pc2MuZ2V0Q29udHJpYnV0b3JzTGlzdCgpO1xuICAgICAgICBzdXBwb3J0ZXJzLmZvckVhY2goKHN1cHBvcnRlcikgPT4ge1xuICAgICAgICAgICAgJChcIi5wYWdlQWJvdXQgLnN1cHBvcnRlcnNcIikuYXBwZW5kKGBcbiAgICAgIDxkaXY+JHtzdXBwb3J0ZXJ9PC9kaXY+XG4gICAgYCk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb250cmlidXRvcnMuZm9yRWFjaCgoY29udHJpYnV0b3IpID0+IHtcbiAgICAgICAgICAgICQoXCIucGFnZUFib3V0IC5jb250cmlidXRvcnNcIikuYXBwZW5kKGBcbiAgICAgIDxkaXY+JHtjb250cmlidXRvcn08L2Rpdj5cbiAgICBgKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5leHBvcnRzLmZpbGwgPSBmaWxsO1xuZXhwb3J0cy5wYWdlID0gbmV3IHBhZ2VfMS5kZWZhdWx0KFwiYWJvdXRcIiwgJChcIi5wYWdlLnBhZ2VBYm91dFwiKSwgXCIvYWJvdXRcIiwgKCkgPT4ge1xuICAgIC8vXG59LCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICByZXNldCgpO1xufSksICgpID0+IHtcbiAgICBmaWxsKCk7XG59LCAoKSA9PiB7XG4gICAgLy9cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5wYWdlID0gZXhwb3J0cy51cGRhdGUgPSBleHBvcnRzLnNtb290aEhpc3RvcnkgPSBleHBvcnRzLnJlc2V0ID0gZXhwb3J0cy50b2dnbGVGaWx0ZXJEZWJ1ZyA9IHZvaWQgMDtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBSZXN1bHRGaWx0ZXJzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9hY2NvdW50L3Jlc3VsdC1maWx0ZXJzXCIpKTtcbmNvbnN0IFRoZW1lQ29sb3JzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy90aGVtZS1jb2xvcnNcIikpO1xuY29uc3QgQ2hhcnRDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9jaGFydC1jb250cm9sbGVyXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpLCBVcGRhdGVDb25maWcgPSBjb25maWdfMTtcbmNvbnN0IE1pbmlSZXN1bHRDaGFydCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vYWNjb3VudC9taW5pLXJlc3VsdC1jaGFydFwiKSk7XG5jb25zdCBBbGxUaW1lU3RhdHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2FjY291bnQvYWxsLXRpbWUtc3RhdHNcIikpO1xuY29uc3QgUGJUYWJsZXMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2FjY291bnQvcGItdGFibGVzXCIpKTtcbmNvbnN0IExvYWRpbmdQYWdlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2xvYWRpbmdcIikpO1xuY29uc3QgRm9jdXMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvZm9jdXNcIikpO1xuY29uc3QgU2lnbk91dEJ1dHRvbiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vYWNjb3VudC9zaWduLW91dC1idXR0b25cIikpO1xuY29uc3QgVG9kYXlUcmFja2VyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3RvZGF5LXRyYWNrZXJcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBwYWdlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vcGFnZVwiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IEFjdGl2ZVBhZ2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9hY3RpdmUtcGFnZVwiKSk7XG5jb25zdCBmb3JtYXRfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiZGF0ZS1mbnMvZm9ybWF0XCIpKTtcbmxldCBmaWx0ZXJEZWJ1ZyA9IGZhbHNlO1xuLy90b2dnbGUgZmlsdGVyZGVidWdcbmZ1bmN0aW9uIHRvZ2dsZUZpbHRlckRlYnVnKCkge1xuICAgIGZpbHRlckRlYnVnID0gIWZpbHRlckRlYnVnO1xuICAgIGlmIChmaWx0ZXJEZWJ1Zykge1xuICAgICAgICBjb25zb2xlLmxvZyhcImZpbHRlckRlYnVnIGlzIG9uXCIpO1xuICAgIH1cbn1cbmV4cG9ydHMudG9nZ2xlRmlsdGVyRGVidWcgPSB0b2dnbGVGaWx0ZXJEZWJ1ZztcbmxldCBmaWx0ZXJlZFJlc3VsdHMgPSBbXTtcbmxldCB2aXNpYmxlVGFibGVMaW5lcyA9IDA7XG5mdW5jdGlvbiBsb2FkTW9yZUxpbmVzKGxpbmVJbmRleCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgaWYgKGZpbHRlcmVkUmVzdWx0cyA9PSBbXSB8fCBmaWx0ZXJlZFJlc3VsdHMubGVuZ3RoID09IDApXG4gICAgICAgIHJldHVybjtcbiAgICBsZXQgbmV3VmlzaWJsZUxpbmVzO1xuICAgIGlmIChsaW5lSW5kZXggJiYgbGluZUluZGV4ID4gdmlzaWJsZVRhYmxlTGluZXMpIHtcbiAgICAgICAgbmV3VmlzaWJsZUxpbmVzID0gTWF0aC5jZWlsKGxpbmVJbmRleCAvIDEwKSAqIDEwO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgbmV3VmlzaWJsZUxpbmVzID0gdmlzaWJsZVRhYmxlTGluZXMgKyAxMDtcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IHZpc2libGVUYWJsZUxpbmVzOyBpIDwgbmV3VmlzaWJsZUxpbmVzOyBpKyspIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gZmlsdGVyZWRSZXN1bHRzW2ldO1xuICAgICAgICBpZiAoIXJlc3VsdClcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICBsZXQgZGlmZiA9IHJlc3VsdC5kaWZmaWN1bHR5O1xuICAgICAgICBpZiAoZGlmZiA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGRpZmYgPSBcIm5vcm1hbFwiO1xuICAgICAgICB9XG4gICAgICAgIGxldCByYXc7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByYXcgPSBjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE1cbiAgICAgICAgICAgICAgICA/IChyZXN1bHQucmF3V3BtICogNSkudG9GaXhlZCgyKVxuICAgICAgICAgICAgICAgIDogcmVzdWx0LnJhd1dwbS50b0ZpeGVkKDIpO1xuICAgICAgICAgICAgaWYgKHJhdyA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByYXcgPSBcIi1cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmF3ID0gXCItXCI7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGljb25zID0gYDxzcGFuIGFyaWEtbGFiZWw9XCIkeyhfYSA9IHJlc3VsdC5sYW5ndWFnZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlcGxhY2UoXCJfXCIsIFwiIFwiKX1cIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1nbG9iZS1hbWVyaWNhc1wiPjwvaT48L3NwYW4+YDtcbiAgICAgICAgaWYgKGRpZmYgPT09IFwibm9ybWFsXCIpIHtcbiAgICAgICAgICAgIGljb25zICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwiJHtyZXN1bHQuZGlmZmljdWx0eX1cIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhciBmYS1mdyBmYS1zdGFyXCI+PC9pPjwvc3Bhbj5gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGRpZmYgPT09IFwiZXhwZXJ0XCIpIHtcbiAgICAgICAgICAgIGljb25zICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwiJHtyZXN1bHQuZGlmZmljdWx0eX1cIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1zdGFyLWhhbGYtYWx0XCI+PC9pPjwvc3Bhbj5gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGRpZmYgPT09IFwibWFzdGVyXCIpIHtcbiAgICAgICAgICAgIGljb25zICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwiJHtyZXN1bHQuZGlmZmljdWx0eX1cIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1zdGFyXCI+PC9pPjwvc3Bhbj5gO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXN1bHQucHVuY3R1YXRpb24pIHtcbiAgICAgICAgICAgIGljb25zICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwicHVuY3R1YXRpb25cIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIiBzdHlsZT1cImZvbnQtd2VpZ2h0OjkwMFwiPiE/PC9zcGFuPmA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlc3VsdC5udW1iZXJzKSB7XG4gICAgICAgICAgICBpY29ucyArPSBgPHNwYW4gYXJpYS1sYWJlbD1cIm51bWJlcnNcIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIiBzdHlsZT1cImZvbnQtd2VpZ2h0OjkwMFwiPjE1PC9zcGFuPmA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlc3VsdC5ibGluZE1vZGUpIHtcbiAgICAgICAgICAgIGljb25zICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwiYmxpbmQgbW9kZVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWV5ZS1zbGFzaFwiPjwvaT48L3NwYW4+YDtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzdWx0LmxhenlNb2RlKSB7XG4gICAgICAgICAgICBpY29ucyArPSBgPHNwYW4gYXJpYS1sYWJlbD1cImxhenkgbW9kZVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWNvdWNoXCI+PC9pPjwvc3Bhbj5gO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXN1bHQuZnVuYm94ICE9PSBcIm5vbmVcIiAmJiByZXN1bHQuZnVuYm94ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGljb25zICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwiJHtyZXN1bHQuZnVuYm94LnJlcGxhY2UoL18vZywgXCIgXCIpfVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWdhbWVwYWRcIj48L2k+PC9zcGFuPmA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlc3VsdC5jaGFydERhdGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWNvbnMgKz0gYDxzcGFuIGNsYXNzPVwibWluaVJlc3VsdENoYXJ0QnV0dG9uXCIgYXJpYS1sYWJlbD1cIk5vIGNoYXJ0IGRhdGEgZm91bmRcIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1jaGFydC1saW5lXCI+PC9pPjwvc3Bhbj5gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHJlc3VsdC5jaGFydERhdGEgPT09IFwidG9vbG9uZ1wiKSB7XG4gICAgICAgICAgICBpY29ucyArPSBgPHNwYW4gY2xhc3M9XCJtaW5pUmVzdWx0Q2hhcnRCdXR0b25cIiBhcmlhLWxhYmVsPVwiQ2hhcnQgaGlzdG9yeSBpcyBub3QgYXZhaWxhYmxlIGZvciBsb25nIHRlc3RzXCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtY2hhcnQtbGluZVwiPjwvaT48L3NwYW4+YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGljb25zICs9IGA8c3BhbiBjbGFzcz1cIm1pbmlSZXN1bHRDaGFydEJ1dHRvblwiIGFyaWEtbGFiZWw9XCJWaWV3IGdyYXBoXCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCIgZmlsdGVyZWRSZXN1bHRzSWQ9XCIke2l9XCIgc3R5bGU9XCJvcGFjaXR5OiAxXCI+PGkgY2xhc3M9XCJmYXMgZmEtY2hhcnQtbGluZVwiPjwvaT48L3NwYW4+YDtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdGFnTmFtZXMgPSBcIlwiO1xuICAgICAgICBpZiAocmVzdWx0LnRhZ3MgIT09IHVuZGVmaW5lZCAmJiByZXN1bHQudGFncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXN1bHQudGFncy5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgKF9hID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgoc25hcHRhZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGFnID09PSBzbmFwdGFnLl9pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFnTmFtZXMgKz0gc25hcHRhZy5uYW1lICsgXCIsIFwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRhZ05hbWVzID0gdGFnTmFtZXMuc3Vic3RyaW5nKDAsIHRhZ05hbWVzLmxlbmd0aCAtIDIpO1xuICAgICAgICB9XG4gICAgICAgIGxldCByZXN0YWdzO1xuICAgICAgICBpZiAocmVzdWx0LnRhZ3MgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmVzdGFncyA9IFwiW11cIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlc3RhZ3MgPSBKU09OLnN0cmluZ2lmeShyZXN1bHQudGFncyk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHRhZ0ljb25zID0gYDxzcGFuIGlkPVwicmVzdWx0RWRpdFRhZ3NcIiByZXN1bHRJZD1cIiR7cmVzdWx0Ll9pZH1cIiB0YWdzPScke3Jlc3RhZ3N9JyBhcmlhLWxhYmVsPVwibm8gdGFnc1wiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiIHN0eWxlPVwib3BhY2l0eTogLjI1XCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtdGFnXCI+PC9pPjwvc3Bhbj5gO1xuICAgICAgICBpZiAodGFnTmFtZXMgIT09IFwiXCIpIHtcbiAgICAgICAgICAgIGlmIChyZXN1bHQudGFncyAhPT0gdW5kZWZpbmVkICYmIHJlc3VsdC50YWdzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICB0YWdJY29ucyA9IGA8c3BhbiBpZD1cInJlc3VsdEVkaXRUYWdzXCIgcmVzdWx0SWQ9XCIke3Jlc3VsdC5faWR9XCIgdGFncz0nJHtyZXN0YWdzfScgYXJpYS1sYWJlbD1cIiR7dGFnTmFtZXN9XCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtdGFnc1wiPjwvaT48L3NwYW4+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRhZ0ljb25zID0gYDxzcGFuIGlkPVwicmVzdWx0RWRpdFRhZ3NcIiByZXN1bHRJZD1cIiR7cmVzdWx0Ll9pZH1cIiB0YWdzPScke3Jlc3RhZ3N9JyBhcmlhLWxhYmVsPVwiJHt0YWdOYW1lc31cIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS10YWdcIj48L2k+PC9zcGFuPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGNvbnNpc3RlbmN5ID0gXCItXCI7XG4gICAgICAgIGlmIChyZXN1bHQuY29uc2lzdGVuY3kpIHtcbiAgICAgICAgICAgIGNvbnNpc3RlbmN5ID0gcmVzdWx0LmNvbnNpc3RlbmN5LnRvRml4ZWQoMikgKyBcIiVcIjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgcGIgPSAoX2IgPSByZXN1bHQuaXNQYikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnRvU3RyaW5nKCk7XG4gICAgICAgIGlmIChwYikge1xuICAgICAgICAgICAgcGIgPSAnPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtY3Jvd25cIj48L2k+JztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHBiID0gXCJcIjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgY2hhclN0YXRzID0gXCItXCI7XG4gICAgICAgIGlmIChyZXN1bHQuY2hhclN0YXRzKSB7XG4gICAgICAgICAgICBjaGFyU3RhdHMgPSByZXN1bHQuY2hhclN0YXRzLmpvaW4oXCIvXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY2hhclN0YXRzID0gcmVzdWx0LmNvcnJlY3RDaGFycyArIFwiL1wiICsgcmVzdWx0LmluY29ycmVjdENoYXJzICsgXCIvLS8tXCI7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHJlc3VsdC50aW1lc3RhbXApO1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5oaXN0b3J5IHRhYmxlIHRib2R5XCIpLmFwcGVuZChgXG4gICAgPHRyIGNsYXNzPVwicmVzdWx0Um93XCIgaWQ9XCJyZXN1bHQtJHtpfVwiPlxuICAgIDx0ZD4ke3BifTwvdGQ+XG4gICAgPHRkPiR7KGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSA/IHJlc3VsdC53cG0gKiA1IDogcmVzdWx0LndwbSkudG9GaXhlZCgyKX08L3RkPlxuICAgIDx0ZD4ke3Jhd308L3RkPlxuICAgIDx0ZD4ke3Jlc3VsdC5hY2MudG9GaXhlZCgyKX0lPC90ZD5cbiAgICA8dGQ+JHtjb25zaXN0ZW5jeX08L3RkPlxuICAgIDx0ZD4ke2NoYXJTdGF0c308L3RkPlxuICAgIDx0ZD4ke3Jlc3VsdC5tb2RlfSAke3Jlc3VsdC5tb2RlMn08L3RkPlxuICAgIDx0ZCBjbGFzcz1cImluZm9JY29uc1wiPiR7aWNvbnN9PC90ZD5cbiAgICA8dGQ+JHt0YWdJY29uc308L3RkPlxuICAgIDx0ZD4keygwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcImRkIE1NTSB5eXl5XCIpfTxicj5cbiAgICAkeygwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcIkhIOm1tXCIpfVxuICAgIDwvdGQ+XG4gICAgPC90cj5gKTtcbiAgICB9XG4gICAgdmlzaWJsZVRhYmxlTGluZXMgPSBuZXdWaXNpYmxlTGluZXM7XG4gICAgaWYgKHZpc2libGVUYWJsZUxpbmVzID49IGZpbHRlcmVkUmVzdWx0cy5sZW5ndGgpIHtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAubG9hZE1vcmVCdXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5sb2FkTW9yZUJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG59XG5mdW5jdGlvbiByZXNldCgpIHtcbiAgICAkKFwiLnBhZ2VBY2NvdW50IC5oaXN0b3J5IHRhYmxlIHRib2R5XCIpLmVtcHR5KCk7XG4gICAgQ2hhcnRDb250cm9sbGVyLmFjY291bnRBY3Rpdml0eS5kYXRhLmRhdGFzZXRzWzBdLmRhdGEgPSBbXTtcbiAgICBDaGFydENvbnRyb2xsZXIuYWNjb3VudEFjdGl2aXR5LmRhdGEuZGF0YXNldHNbMV0uZGF0YSA9IFtdO1xuICAgIENoYXJ0Q29udHJvbGxlci5hY2NvdW50SGlzdG9yeS5kYXRhLmRhdGFzZXRzWzBdLmRhdGEgPSBbXTtcbiAgICBDaGFydENvbnRyb2xsZXIuYWNjb3VudEhpc3RvcnkuZGF0YS5kYXRhc2V0c1sxXS5kYXRhID0gW107XG4gICAgQ2hhcnRDb250cm9sbGVyLmFjY291bnRBY3Rpdml0eS51cGRhdGVDb2xvcnMoKTtcbiAgICBDaGFydENvbnRyb2xsZXIuYWNjb3VudEhpc3RvcnkudXBkYXRlQ29sb3JzKCk7XG59XG5leHBvcnRzLnJlc2V0ID0gcmVzZXQ7XG5sZXQgdG90YWxTZWNvbmRzRmlsdGVyZWQgPSAwO1xubGV0IGNoYXJ0RGF0YSA9IFtdO1xubGV0IGFjY0NoYXJ0RGF0YSA9IFtdO1xuZnVuY3Rpb24gc21vb3RoSGlzdG9yeShmYWN0b3IpIHtcbiAgICBjb25zdCBzbW9vdGhlZFdwbURhdGEgPSBNaXNjLnNtb290aChjaGFydERhdGEubWFwKChhKSA9PiBhLnkpLCBmYWN0b3IpO1xuICAgIGNvbnN0IHNtb290aGVkQWNjRGF0YSA9IE1pc2Muc21vb3RoKGFjY0NoYXJ0RGF0YS5tYXAoKGEpID0+IGEueSksIGZhY3Rvcik7XG4gICAgY29uc3QgY2hhcnREYXRhMiA9IGNoYXJ0RGF0YS5tYXAoKGEsIGkpID0+IHtcbiAgICAgICAgY29uc3QgcmV0ID0gT2JqZWN0LmFzc2lnbih7fSwgYSk7XG4gICAgICAgIHJldC55ID0gc21vb3RoZWRXcG1EYXRhW2ldO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH0pO1xuICAgIGNvbnN0IGFjY0NoYXJ0RGF0YTIgPSBhY2NDaGFydERhdGEubWFwKChhLCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IHJldCA9IE9iamVjdC5hc3NpZ24oe30sIGEpO1xuICAgICAgICByZXQueSA9IHNtb290aGVkQWNjRGF0YVtpXTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9KTtcbiAgICBDaGFydENvbnRyb2xsZXIuYWNjb3VudEhpc3RvcnkuZGF0YS5kYXRhc2V0c1swXS5kYXRhID0gY2hhcnREYXRhMjtcbiAgICBDaGFydENvbnRyb2xsZXIuYWNjb3VudEhpc3RvcnkuZGF0YS5kYXRhc2V0c1sxXS5kYXRhID0gYWNjQ2hhcnREYXRhMjtcbiAgICBpZiAoY2hhcnREYXRhMi5sZW5ndGggfHwgYWNjQ2hhcnREYXRhMi5sZW5ndGgpIHtcbiAgICAgICAgQ2hhcnRDb250cm9sbGVyLmFjY291bnRIaXN0b3J5LnVwZGF0ZSgpO1xuICAgIH1cbn1cbmV4cG9ydHMuc21vb3RoSGlzdG9yeSA9IHNtb290aEhpc3Rvcnk7XG5mdW5jdGlvbiBhcHBseUhpc3RvcnlTbW9vdGhpbmcoKSB7XG4gICAgY29uc3Qgc21vb3RoaW5nID0gJChcIi5wYWdlQWNjb3VudCAuY29udGVudCAuYmVsb3cgLnNtb290aGluZyBpbnB1dFwiKS52YWwoKTtcbiAgICAkKFwiLnBhZ2VBY2NvdW50IC5jb250ZW50IC5iZWxvdyAuc21vb3RoaW5nIC52YWx1ZVwiKS50ZXh0KHNtb290aGluZyk7XG4gICAgc21vb3RoSGlzdG9yeShwYXJzZUludChzbW9vdGhpbmcpKTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICBmdW5jdGlvbiBjb250KCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIExvYWRpbmdQYWdlLnVwZGF0ZVRleHQoXCJEaXNwbGF5aW5nIHN0YXRzLi4uXCIpO1xuICAgICAgICBMb2FkaW5nUGFnZS51cGRhdGVCYXIoMTAwKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJ1cGRhdGluZyBhY2NvdW50IHBhZ2VcIik7XG4gICAgICAgIFRoZW1lQ29sb3JzLnVwZGF0ZSgpO1xuICAgICAgICBDaGFydENvbnRyb2xsZXIuYWNjb3VudEhpc3RvcnkudXBkYXRlQ29sb3JzKCk7XG4gICAgICAgIENoYXJ0Q29udHJvbGxlci5hY2NvdW50QWN0aXZpdHkudXBkYXRlQ29sb3JzKCk7XG4gICAgICAgIEFsbFRpbWVTdGF0cy51cGRhdGUoKTtcbiAgICAgICAgUGJUYWJsZXMudXBkYXRlKCk7XG4gICAgICAgIGNoYXJ0RGF0YSA9IFtdO1xuICAgICAgICBhY2NDaGFydERhdGEgPSBbXTtcbiAgICAgICAgY29uc3Qgd3BtQ2hhcnREYXRhID0gW107XG4gICAgICAgIHZpc2libGVUYWJsZUxpbmVzID0gMDtcbiAgICAgICAgbGV0IHRvcFdwbSA9IDA7XG4gICAgICAgIGxldCB0b3BNb2RlID0gXCJcIjtcbiAgICAgICAgbGV0IHRlc3RSZXN0YXJ0cyA9IDA7XG4gICAgICAgIGxldCB0b3RhbFdwbSA9IDA7XG4gICAgICAgIGxldCB0ZXN0Q291bnQgPSAwO1xuICAgICAgICBsZXQgbGFzdDEwID0gMDtcbiAgICAgICAgbGV0IHdwbUxhc3QxMHRvdGFsID0gMDtcbiAgICAgICAgbGV0IHRvcEFjYyA9IDA7XG4gICAgICAgIGxldCB0b3RhbEFjYyA9IDA7XG4gICAgICAgIGxldCB0b3RhbEFjYzEwID0gMDtcbiAgICAgICAgY29uc3QgcmF3V3BtID0ge1xuICAgICAgICAgICAgdG90YWw6IDAsXG4gICAgICAgICAgICBjb3VudDogMCxcbiAgICAgICAgICAgIGxhc3QxMFRvdGFsOiAwLFxuICAgICAgICAgICAgbGFzdDEwQ291bnQ6IDAsXG4gICAgICAgICAgICBtYXg6IDAsXG4gICAgICAgIH07XG4gICAgICAgIC8vIGxldCB0b3RhbFNlY29uZHMgPSAwO1xuICAgICAgICB0b3RhbFNlY29uZHNGaWx0ZXJlZCA9IDA7XG4gICAgICAgIGxldCB0b3BDb25zID0gMDtcbiAgICAgICAgbGV0IHRvdGFsQ29ucyA9IDA7XG4gICAgICAgIGxldCB0b3RhbENvbnMxMCA9IDA7XG4gICAgICAgIGxldCBjb25zQ291bnQgPSAwO1xuICAgICAgICBjb25zdCBhY3Rpdml0eUNoYXJ0RGF0YSA9IHt9O1xuICAgICAgICBmaWx0ZXJlZFJlc3VsdHMgPSBbXTtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuaGlzdG9yeSB0YWJsZSB0Ym9keVwiKS5lbXB0eSgpO1xuICAgICAgICAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpLnJlc3VsdHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIC8vIHRvdGFsU2Vjb25kcyArPSB0dDtcbiAgICAgICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2U7XG4gICAgICAgICAgICAvL2FwcGx5IGZpbHRlcnNcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgbGV0IHJlc2RpZmYgPSByZXN1bHQuZGlmZmljdWx0eTtcbiAgICAgICAgICAgICAgICBpZiAocmVzZGlmZiA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzZGlmZiA9IFwibm9ybWFsXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJkaWZmaWN1bHR5XCIsIHJlc2RpZmYpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJEZWJ1Zykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYHNraXBwaW5nIHJlc3VsdCBkdWUgdG8gZGlmZmljdWx0eSBmaWx0ZXJgLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcIm1vZGVcIiwgcmVzdWx0Lm1vZGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJEZWJ1Zykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYHNraXBwaW5nIHJlc3VsdCBkdWUgdG8gbW9kZSBmaWx0ZXJgLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5tb2RlID09IFwidGltZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCB0aW1lZmlsdGVyID0gXCJjdXN0b21cIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFsxNSwgMzAsIDYwLCAxMjBdLmluY2x1ZGVzKHBhcnNlSW50KHJlc3VsdC5tb2RlMikpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lZmlsdGVyID0gcmVzdWx0Lm1vZGUyO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJ0aW1lXCIsIHRpbWVmaWx0ZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyRGVidWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgc2tpcHBpbmcgcmVzdWx0IGR1ZSB0byB0aW1lIGZpbHRlcmAsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0Lm1vZGUgPT0gXCJ3b3Jkc1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCB3b3JkZmlsdGVyID0gXCJjdXN0b21cIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFsxMCwgMjUsIDUwLCAxMDAsIDIwMF0uaW5jbHVkZXMocGFyc2VJbnQocmVzdWx0Lm1vZGUyKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRmaWx0ZXIgPSByZXN1bHQubW9kZTI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcIndvcmRzXCIsIHdvcmRmaWx0ZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyRGVidWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgc2tpcHBpbmcgcmVzdWx0IGR1ZSB0byB3b3JkIGZpbHRlcmAsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5xdW90ZUxlbmd0aCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBmaWx0ZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQucXVvdGVMZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlciA9IFwic2hvcnRcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXN1bHQucXVvdGVMZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlciA9IFwibWVkaXVtXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0LnF1b3RlTGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIgPSBcImxvbmdcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXN1bHQucXVvdGVMZW5ndGggPT09IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlciA9IFwidGhpY2NcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICFSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcInF1b3RlTGVuZ3RoXCIsIGZpbHRlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJEZWJ1Zykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBza2lwcGluZyByZXN1bHQgZHVlIHRvIHF1b3RlTGVuZ3RoIGZpbHRlcmAsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IGxhbmdGaWx0ZXIgPSBSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcImxhbmd1YWdlXCIsIChfYSA9IHJlc3VsdC5sYW5ndWFnZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCJlbmdsaXNoXCIpO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubGFuZ3VhZ2UgPT09IFwiZW5nbGlzaF9leHBhbmRlZFwiICYmXG4gICAgICAgICAgICAgICAgICAgIFJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwibGFuZ3VhZ2VcIiwgXCJlbmdsaXNoXzFrXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhbmdGaWx0ZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWxhbmdGaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlckRlYnVnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgc2tpcHBpbmcgcmVzdWx0IGR1ZSB0byBsYW5ndWFnZSBmaWx0ZXJgLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IHB1bmNmaWx0ZXIgPSBcIm9mZlwiO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQucHVuY3R1YXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgcHVuY2ZpbHRlciA9IFwib25cIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcInB1bmN0dWF0aW9uXCIsIHB1bmNmaWx0ZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJEZWJ1Zykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYHNraXBwaW5nIHJlc3VsdCBkdWUgdG8gcHVuY3R1YXRpb24gZmlsdGVyYCwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxldCBudW1maWx0ZXIgPSBcIm9mZlwiO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubnVtYmVycykge1xuICAgICAgICAgICAgICAgICAgICBudW1maWx0ZXIgPSBcIm9uXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJudW1iZXJzXCIsIG51bWZpbHRlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlckRlYnVnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgc2tpcHBpbmcgcmVzdWx0IGR1ZSB0byBudW1iZXJzIGZpbHRlcmAsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmZ1bmJveCA9PT0gXCJub25lXCIgfHwgcmVzdWx0LmZ1bmJveCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJmdW5ib3hcIiwgXCJub25lXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyRGVidWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgc2tpcHBpbmcgcmVzdWx0IGR1ZSB0byBmdW5ib3ggZmlsdGVyYCwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcImZ1bmJveFwiLCByZXN1bHQuZnVuYm94KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlckRlYnVnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYHNraXBwaW5nIHJlc3VsdCBkdWUgdG8gZnVuYm94IGZpbHRlcmAsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IHRhZ0hpZGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudGFncyA9PT0gdW5kZWZpbmVkIHx8IHJlc3VsdC50YWdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAvL25vIHRhZ3MsIHNob3cgd2hlbiBubyB0YWcgaXMgZW5hYmxlZFxuICAgICAgICAgICAgICAgICAgICBpZiAoKChfYiA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmxlbmd0aCkgfHwgMCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcInRhZ3NcIiwgXCJub25lXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ0hpZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ0hpZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy90YWdzIGV4aXN0XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkVGFncyA9IChfYyA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLm1hcCgodCkgPT4gdC5faWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsaWRUYWdzID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC50YWdzLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9jaGVjayBpZiBpIGV2ZW4gbmVlZCB0byBjaGVjayB0YWdzIGFueW1vcmVcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGFnSGlkZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NoZWNrIGlmIHRhZyBpcyB2YWxpZFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbGlkVGFncyA9PT0gbnVsbCB8fCB2YWxpZFRhZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHZhbGlkVGFncy5pbmNsdWRlcyh0YWcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy90YWcgdmFsaWQsIGNoZWNrIGlmIGZpbHRlciBpcyBvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcInRhZ3NcIiwgdGFnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnSGlkZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy90YWcgbm90IGZvdW5kIGluIHZhbGlkIHRhZ3MsIG1lYW5pbmcgcHJvYmFibHkgZGVsZXRlZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcInRhZ3NcIiwgXCJub25lXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdIaWRlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGFnSGlkZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyRGVidWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBza2lwcGluZyByZXN1bHQgZHVlIHRvIHRhZyBmaWx0ZXJgLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgdGltZVNpbmNlVGVzdCA9IE1hdGguYWJzKHJlc3VsdC50aW1lc3RhbXAgLSBEYXRlLm5vdygpKSAvIDEwMDA7XG4gICAgICAgICAgICAgICAgbGV0IGRhdGVoaWRlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAoUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJkYXRlXCIsIFwiYWxsXCIpIHx8XG4gICAgICAgICAgICAgICAgICAgIChSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcImRhdGVcIiwgXCJsYXN0X2RheVwiKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZVNpbmNlVGVzdCA8PSA4NjQwMCkgfHxcbiAgICAgICAgICAgICAgICAgICAgKFJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwiZGF0ZVwiLCBcImxhc3Rfd2Vla1wiKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZVNpbmNlVGVzdCA8PSA2MDQ4MDApIHx8XG4gICAgICAgICAgICAgICAgICAgIChSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcImRhdGVcIiwgXCJsYXN0X21vbnRoXCIpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lU2luY2VUZXN0IDw9IDI1OTIwMDApIHx8XG4gICAgICAgICAgICAgICAgICAgIChSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcImRhdGVcIiwgXCJsYXN0XzNtb250aHNcIikgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTaW5jZVRlc3QgPD0gNzc3NjAwMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0ZWhpZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGRhdGVoaWRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJEZWJ1Zykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYHNraXBwaW5nIHJlc3VsdCBkdWUgdG8gZGF0ZSBmaWx0ZXJgLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZmlsdGVyZWRSZXN1bHRzLnB1c2gocmVzdWx0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJTb21ldGhpbmcgd2VudCB3cm9uZyB3aGVuIGZpbHRlcmluZy4gUmVzZXR0aW5nIGZpbHRlcnMuXCIsIDApO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgICAgICAgICBSZXN1bHRGaWx0ZXJzLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgUmVzdWx0RmlsdGVycy51cGRhdGVBY3RpdmUoKTtcbiAgICAgICAgICAgICAgICB1cGRhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vZmlsdGVycyBkb25lXG4gICAgICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0RGF0ZSA9IG5ldyBEYXRlKHJlc3VsdC50aW1lc3RhbXApO1xuICAgICAgICAgICAgcmVzdWx0RGF0ZS5zZXRTZWNvbmRzKDApO1xuICAgICAgICAgICAgcmVzdWx0RGF0ZS5zZXRNaW51dGVzKDApO1xuICAgICAgICAgICAgcmVzdWx0RGF0ZS5zZXRIb3VycygwKTtcbiAgICAgICAgICAgIHJlc3VsdERhdGUuc2V0TWlsbGlzZWNvbmRzKDApO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0VGltZXN0YW1wID0gcmVzdWx0RGF0ZS5nZXRUaW1lKCk7XG4gICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoYWN0aXZpdHlDaGFydERhdGEpLmluY2x1ZGVzKFN0cmluZyhyZXN1bHRUaW1lc3RhbXApKSkge1xuICAgICAgICAgICAgICAgIGFjdGl2aXR5Q2hhcnREYXRhW3Jlc3VsdFRpbWVzdGFtcF0uYW1vdW50Kys7XG4gICAgICAgICAgICAgICAgYWN0aXZpdHlDaGFydERhdGFbcmVzdWx0VGltZXN0YW1wXS50aW1lICs9XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC50ZXN0RHVyYXRpb24gK1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmluY29tcGxldGVUZXN0U2Vjb25kcyAtXG4gICAgICAgICAgICAgICAgICAgICAgICAoKF9kID0gcmVzdWx0LmFma0R1cmF0aW9uKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiAwKTtcbiAgICAgICAgICAgICAgICBhY3Rpdml0eUNoYXJ0RGF0YVtyZXN1bHRUaW1lc3RhbXBdLnRvdGFsV3BtICs9IHJlc3VsdC53cG07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBhY3Rpdml0eUNoYXJ0RGF0YVtyZXN1bHRUaW1lc3RhbXBdID0ge1xuICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IDEsXG4gICAgICAgICAgICAgICAgICAgIHRpbWU6IHJlc3VsdC50ZXN0RHVyYXRpb24gK1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmluY29tcGxldGVUZXN0U2Vjb25kcyAtXG4gICAgICAgICAgICAgICAgICAgICAgICAoKF9lID0gcmVzdWx0LmFma0R1cmF0aW9uKSAhPT0gbnVsbCAmJiBfZSAhPT0gdm9pZCAwID8gX2UgOiAwKSxcbiAgICAgICAgICAgICAgICAgICAgdG90YWxXcG06IHJlc3VsdC53cG0sXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCB0dCA9IDA7XG4gICAgICAgICAgICBpZiAocmVzdWx0LnRlc3REdXJhdGlvbiA9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgICAgICByZXN1bHQubW9kZTIgIT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgICAgICByZXN1bHQubW9kZTIgIT09IFwiemVuXCIpIHtcbiAgICAgICAgICAgICAgICAvL3Rlc3QgZmluaXNoZWQgYmVmb3JlIHRlc3REdXJhdGlvbiBmaWVsZCB3YXMgaW50cm9kdWNlZCAtIGVzdGltYXRlXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5tb2RlID09IFwidGltZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHR0ID0gcmVzdWx0Lm1vZGUyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXN1bHQubW9kZSA9PSBcIndvcmRzXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdHQgPSAocmVzdWx0Lm1vZGUyIC8gcmVzdWx0LndwbSkgKiA2MDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0dCA9IHBhcnNlRmxvYXQocmVzdWx0LnRlc3REdXJhdGlvbik7IC8vbGVnYWN5IHJlc3VsdHMgY291bGQgaGF2ZSBhIHN0cmluZyBoZXJlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmVzdWx0LmluY29tcGxldGVUZXN0U2Vjb25kcyAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0dCArPSByZXN1bHQuaW5jb21wbGV0ZVRlc3RTZWNvbmRzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0LnJlc3RhcnRDb3VudCAhPSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgICAgICByZXN1bHQucmVzdGFydENvdW50ID4gMCkge1xuICAgICAgICAgICAgICAgIHR0ICs9ICh0dCAvIDQpICogcmVzdWx0LnJlc3RhcnRDb3VudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGlmIChyZXN1bHQuaW5jb21wbGV0ZVRlc3RTZWNvbmRzICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgLy8gICB0dCArPSByZXN1bHQuaW5jb21wbGV0ZVRlc3RTZWNvbmRzO1xuICAgICAgICAgICAgLy8gfSBlbHNlIGlmIChyZXN1bHQucmVzdGFydENvdW50ICE9IHVuZGVmaW5lZCAmJiByZXN1bHQucmVzdGFydENvdW50ID4gMCkge1xuICAgICAgICAgICAgLy8gICB0dCArPSAodHQgLyA0KSAqIHJlc3VsdC5yZXN0YXJ0Q291bnQ7XG4gICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICB0b3RhbFNlY29uZHNGaWx0ZXJlZCArPSB0dDtcbiAgICAgICAgICAgIGlmIChsYXN0MTAgPCAxMCkge1xuICAgICAgICAgICAgICAgIGxhc3QxMCsrO1xuICAgICAgICAgICAgICAgIHdwbUxhc3QxMHRvdGFsICs9IHJlc3VsdC53cG07XG4gICAgICAgICAgICAgICAgdG90YWxBY2MxMCArPSByZXN1bHQuYWNjO1xuICAgICAgICAgICAgICAgIHJlc3VsdC5jb25zaXN0ZW5jeSAhPT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgID8gKHRvdGFsQ29uczEwICs9IHJlc3VsdC5jb25zaXN0ZW5jeSlcbiAgICAgICAgICAgICAgICAgICAgOiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGVzdENvdW50Kys7XG4gICAgICAgICAgICBpZiAocmVzdWx0LmNvbnNpc3RlbmN5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBjb25zQ291bnQrKztcbiAgICAgICAgICAgICAgICB0b3RhbENvbnMgKz0gcmVzdWx0LmNvbnNpc3RlbmN5O1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuY29uc2lzdGVuY3kgPiB0b3BDb25zKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvcENvbnMgPSByZXN1bHQuY29uc2lzdGVuY3k7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJlc3VsdC5yYXdXcG0gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmIChyYXdXcG0ubGFzdDEwQ291bnQgPCAxMCkge1xuICAgICAgICAgICAgICAgICAgICByYXdXcG0ubGFzdDEwQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgcmF3V3BtLmxhc3QxMFRvdGFsICs9IHJlc3VsdC5yYXdXcG07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJhd1dwbS50b3RhbCArPSByZXN1bHQucmF3V3BtO1xuICAgICAgICAgICAgICAgIHJhd1dwbS5jb3VudCsrO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQucmF3V3BtID4gcmF3V3BtLm1heCkge1xuICAgICAgICAgICAgICAgICAgICByYXdXcG0ubWF4ID0gcmVzdWx0LnJhd1dwbTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmVzdWx0LmFjYyA+IHRvcEFjYykge1xuICAgICAgICAgICAgICAgIHRvcEFjYyA9IHJlc3VsdC5hY2M7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0b3RhbEFjYyArPSByZXN1bHQuYWNjO1xuICAgICAgICAgICAgaWYgKHJlc3VsdC5yZXN0YXJ0Q291bnQgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGVzdFJlc3RhcnRzICs9IHJlc3VsdC5yZXN0YXJ0Q291bnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjaGFydERhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgeDogcmVzdWx0LnRpbWVzdGFtcCxcbiAgICAgICAgICAgICAgICB5OiBjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0gPyBNaXNjLnJvdW5kVG8yKHJlc3VsdC53cG0gKiA1KSA6IHJlc3VsdC53cG0sXG4gICAgICAgICAgICAgICAgd3BtOiBjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE1cbiAgICAgICAgICAgICAgICAgICAgPyBNaXNjLnJvdW5kVG8yKHJlc3VsdC53cG0gKiA1KVxuICAgICAgICAgICAgICAgICAgICA6IHJlc3VsdC53cG0sXG4gICAgICAgICAgICAgICAgYWNjOiByZXN1bHQuYWNjLFxuICAgICAgICAgICAgICAgIG1vZGU6IHJlc3VsdC5tb2RlLFxuICAgICAgICAgICAgICAgIG1vZGUyOiByZXN1bHQubW9kZTIsXG4gICAgICAgICAgICAgICAgcHVuY3R1YXRpb246IHJlc3VsdC5wdW5jdHVhdGlvbixcbiAgICAgICAgICAgICAgICBsYW5ndWFnZTogcmVzdWx0Lmxhbmd1YWdlLFxuICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogcmVzdWx0LnRpbWVzdGFtcCxcbiAgICAgICAgICAgICAgICBkaWZmaWN1bHR5OiByZXN1bHQuZGlmZmljdWx0eSxcbiAgICAgICAgICAgICAgICByYXc6IGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTVxuICAgICAgICAgICAgICAgICAgICA/IE1pc2Mucm91bmRUbzIocmVzdWx0LnJhd1dwbSAqIDUpXG4gICAgICAgICAgICAgICAgICAgIDogcmVzdWx0LnJhd1dwbSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgd3BtQ2hhcnREYXRhLnB1c2gocmVzdWx0LndwbSk7XG4gICAgICAgICAgICBhY2NDaGFydERhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgeDogcmVzdWx0LnRpbWVzdGFtcCxcbiAgICAgICAgICAgICAgICB5OiAxMDAgLSByZXN1bHQuYWNjLFxuICAgICAgICAgICAgICAgIGVycm9yUmF0ZTogMTAwIC0gcmVzdWx0LmFjYyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKHJlc3VsdC53cG0gPiB0b3BXcG0pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwdW5jc2N0cmluZyA9IHJlc3VsdC5wdW5jdHVhdGlvbiA/IFwiLDxicj53aXRoIHB1bmN0dWF0aW9uXCIgOiBcIlwiO1xuICAgICAgICAgICAgICAgIGNvbnN0IG51bWJzY3RyaW5nID0gcmVzdWx0Lm51bWJlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcIiw8YnI+IFwiICsgKHJlc3VsdC5wdW5jdHVhdGlvbiA/IFwiJlwiIDogXCJcIikgKyBcIndpdGggbnVtYmVyc1wiXG4gICAgICAgICAgICAgICAgICAgIDogXCJcIjtcbiAgICAgICAgICAgICAgICB0b3BXcG0gPSByZXN1bHQud3BtO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubW9kZSA9PSBcImN1c3RvbVwiKVxuICAgICAgICAgICAgICAgICAgICB0b3BNb2RlID0gcmVzdWx0Lm1vZGU7XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRvcE1vZGUgPVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lm1vZGUgKyBcIiBcIiArIHJlc3VsdC5tb2RlMiArIHB1bmNzY3RyaW5nICsgbnVtYnNjdHJpbmc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdG90YWxXcG0gKz0gcmVzdWx0LndwbTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0pIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmdyb3VwLmhpc3RvcnkgdGFibGUgdGhlYWQgdHIgdGQ6bnRoLWNoaWxkKDIpXCIpLnRleHQoXCJjcG1cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5ncm91cC5oaXN0b3J5IHRhYmxlIHRoZWFkIHRyIHRkOm50aC1jaGlsZCgyKVwiKS50ZXh0KFwid3BtXCIpO1xuICAgICAgICB9XG4gICAgICAgIGxvYWRNb3JlTGluZXMoKTtcbiAgICAgICAgLy8vLy8vLy9cbiAgICAgICAgY29uc3QgYWN0aXZpdHlDaGFydERhdGFfYW1vdW50ID0gW107XG4gICAgICAgIGNvbnN0IGFjdGl2aXR5Q2hhcnREYXRhX3RpbWUgPSBbXTtcbiAgICAgICAgY29uc3QgYWN0aXZpdHlDaGFydERhdGFfYXZnV3BtID0gW107XG4gICAgICAgIC8vIGxldCBsYXN0VGltZXN0YW1wID0gMDtcbiAgICAgICAgT2JqZWN0LmtleXMoYWN0aXZpdHlDaGFydERhdGEpLmZvckVhY2goKGRhdGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGVJbnQgPSBwYXJzZUludChkYXRlKTtcbiAgICAgICAgICAgIGFjdGl2aXR5Q2hhcnREYXRhX2Ftb3VudC5wdXNoKHtcbiAgICAgICAgICAgICAgICB4OiBkYXRlSW50LFxuICAgICAgICAgICAgICAgIHk6IGFjdGl2aXR5Q2hhcnREYXRhW2RhdGVJbnRdLmFtb3VudCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYWN0aXZpdHlDaGFydERhdGFfdGltZS5wdXNoKHtcbiAgICAgICAgICAgICAgICB4OiBkYXRlSW50LFxuICAgICAgICAgICAgICAgIHk6IE1pc2Mucm91bmRUbzIoYWN0aXZpdHlDaGFydERhdGFbZGF0ZUludF0udGltZSksXG4gICAgICAgICAgICAgICAgYW1vdW50OiBhY3Rpdml0eUNoYXJ0RGF0YVtkYXRlSW50XS5hbW91bnQsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGFjdGl2aXR5Q2hhcnREYXRhX2F2Z1dwbS5wdXNoKHtcbiAgICAgICAgICAgICAgICB4OiBkYXRlSW50LFxuICAgICAgICAgICAgICAgIHk6IE1pc2Mucm91bmRUbzIoKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTVxuICAgICAgICAgICAgICAgICAgICA/IGFjdGl2aXR5Q2hhcnREYXRhW2RhdGVJbnRdLnRvdGFsV3BtICogNVxuICAgICAgICAgICAgICAgICAgICA6IGFjdGl2aXR5Q2hhcnREYXRhW2RhdGVJbnRdLnRvdGFsV3BtKSAvXG4gICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5Q2hhcnREYXRhW2RhdGVJbnRdLmFtb3VudCksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIGxhc3RUaW1lc3RhbXAgPSBkYXRlO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgYWNjb3VudEFjdGl2aXR5U2NhbGVPcHRpb25zID0gQ2hhcnRDb250cm9sbGVyLmFjY291bnRBY3Rpdml0eS5vcHRpb25zLnNjYWxlcztcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSkge1xuICAgICAgICAgICAgYWNjb3VudEFjdGl2aXR5U2NhbGVPcHRpb25zW1wiYXZnV3BtXCJdLnRpdGxlLnRleHQgPSBcIkF2ZXJhZ2UgQ3BtXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhY2NvdW50QWN0aXZpdHlTY2FsZU9wdGlvbnNbXCJhdmdXcG1cIl0udGl0bGUudGV4dCA9IFwiQXZlcmFnZSBXcG1cIjtcbiAgICAgICAgfVxuICAgICAgICBDaGFydENvbnRyb2xsZXIuYWNjb3VudEFjdGl2aXR5LmRhdGEuZGF0YXNldHNbMF0uZGF0YSA9XG4gICAgICAgICAgICBhY3Rpdml0eUNoYXJ0RGF0YV90aW1lO1xuICAgICAgICBDaGFydENvbnRyb2xsZXIuYWNjb3VudEFjdGl2aXR5LmRhdGEuZGF0YXNldHNbMV0uZGF0YSA9XG4gICAgICAgICAgICBhY3Rpdml0eUNoYXJ0RGF0YV9hdmdXcG07XG4gICAgICAgIGNvbnN0IGFjY291bnRIaXN0b3J5U2NhbGVPcHRpb25zID0gQ2hhcnRDb250cm9sbGVyLmFjY291bnRIaXN0b3J5Lm9wdGlvbnMuc2NhbGVzO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNKSB7XG4gICAgICAgICAgICBhY2NvdW50SGlzdG9yeVNjYWxlT3B0aW9uc1tcIndwbVwiXS50aXRsZS50ZXh0ID0gXCJDaGFyYWN0ZXJzIHBlciBNaW51dGVcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGFjY291bnRIaXN0b3J5U2NhbGVPcHRpb25zW1wid3BtXCJdLnRpdGxlLnRleHQgPSBcIldvcmRzIHBlciBNaW51dGVcIjtcbiAgICAgICAgfVxuICAgICAgICBDaGFydENvbnRyb2xsZXIuYWNjb3VudEhpc3RvcnkuZGF0YS5kYXRhc2V0c1swXS5kYXRhID0gY2hhcnREYXRhO1xuICAgICAgICBDaGFydENvbnRyb2xsZXIuYWNjb3VudEhpc3RvcnkuZGF0YS5kYXRhc2V0c1sxXS5kYXRhID0gYWNjQ2hhcnREYXRhO1xuICAgICAgICBjb25zdCB3cG1zID0gY2hhcnREYXRhLm1hcCgocikgPT4gci55KTtcbiAgICAgICAgY29uc3QgbWluV3BtQ2hhcnRWYWwgPSBNYXRoLm1pbiguLi53cG1zKTtcbiAgICAgICAgY29uc3QgbWF4V3BtQ2hhcnRWYWwgPSBNYXRoLm1heCguLi53cG1zKTtcbiAgICAgICAgLy8gbGV0IGFjY3VyYWNpZXMgPSBhY2NDaGFydERhdGEubWFwKChyKSA9PiByLnkpO1xuICAgICAgICBhY2NvdW50SGlzdG9yeVNjYWxlT3B0aW9uc1tcIndwbVwiXS5tYXggPVxuICAgICAgICAgICAgTWF0aC5mbG9vcihtYXhXcG1DaGFydFZhbCkgKyAoMTAgLSAoTWF0aC5mbG9vcihtYXhXcG1DaGFydFZhbCkgJSAxMCkpO1xuICAgICAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuc3RhcnRHcmFwaHNBdFplcm8pIHtcbiAgICAgICAgICAgIGFjY291bnRIaXN0b3J5U2NhbGVPcHRpb25zW1wid3BtXCJdLm1pbiA9IE1hdGguZmxvb3IobWluV3BtQ2hhcnRWYWwpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYWNjb3VudEhpc3RvcnlTY2FsZU9wdGlvbnNbXCJ3cG1cIl0ubWluID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hhcnREYXRhID09IFtdIHx8IGNoYXJ0RGF0YS5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuZ3JvdXAubm9EYXRhRXJyb3JcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5ncm91cC5jaGFydFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmdyb3VwLmRhaWx5QWN0aXZpdHlDaGFydFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmdyb3VwLmhpc3RvcnlcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC50cmlwbGVncm91cC5zdGF0c1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmdyb3VwLm5vRGF0YUVycm9yXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuZ3JvdXAuY2hhcnRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5ncm91cC5kYWlseUFjdGl2aXR5Q2hhcnRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5ncm91cC5oaXN0b3J5XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAudHJpcGxlZ3JvdXAuc3RhdHNcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAudGltZVRvdGFsRmlsdGVyZWQgLnZhbFwiKS50ZXh0KE1pc2Muc2Vjb25kc1RvU3RyaW5nKE1hdGgucm91bmQodG90YWxTZWNvbmRzRmlsdGVyZWQpLCB0cnVlLCB0cnVlKSk7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0pIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmhpZ2hlc3RXcG0gLnRpdGxlXCIpLnRleHQoXCJoaWdoZXN0IGNwbVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmhpZ2hlc3RXcG0gLnZhbFwiKS50ZXh0KE1pc2Mucm91bmRUbzIodG9wV3BtICogNSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuaGlnaGVzdFdwbSAudGl0bGVcIikudGV4dChcImhpZ2hlc3Qgd3BtXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuaGlnaGVzdFdwbSAudmFsXCIpLnRleHQoTWlzYy5yb3VuZFRvMih0b3BXcG0pKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmVyYWdlV3BtIC50aXRsZVwiKS50ZXh0KFwiYXZlcmFnZSBjcG1cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmVyYWdlV3BtIC52YWxcIikudGV4dChNYXRoLnJvdW5kKCh0b3RhbFdwbSAqIDUpIC8gdGVzdENvdW50KSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmVyYWdlV3BtIC50aXRsZVwiKS50ZXh0KFwiYXZlcmFnZSB3cG1cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmVyYWdlV3BtIC52YWxcIikudGV4dChNYXRoLnJvdW5kKHRvdGFsV3BtIC8gdGVzdENvdW50KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSkge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZlcmFnZVdwbTEwIC50aXRsZVwiKS50ZXh0KFwiYXZlcmFnZSBjcG0gKGxhc3QgMTAgdGVzdHMpXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZlcmFnZVdwbTEwIC52YWxcIikudGV4dChNYXRoLnJvdW5kKCh3cG1MYXN0MTB0b3RhbCAqIDUpIC8gbGFzdDEwKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmVyYWdlV3BtMTAgLnRpdGxlXCIpLnRleHQoXCJhdmVyYWdlIHdwbSAobGFzdCAxMCB0ZXN0cylcIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmVyYWdlV3BtMTAgLnZhbFwiKS50ZXh0KE1hdGgucm91bmQod3BtTGFzdDEwdG90YWwgLyBsYXN0MTApKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5oaWdoZXN0UmF3IC50aXRsZVwiKS50ZXh0KFwiaGlnaGVzdCByYXcgY3BtXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuaGlnaGVzdFJhdyAudmFsXCIpLnRleHQoTWlzYy5yb3VuZFRvMihyYXdXcG0ubWF4ICogNSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuaGlnaGVzdFJhdyAudGl0bGVcIikudGV4dChcImhpZ2hlc3QgcmF3IHdwbVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmhpZ2hlc3RSYXcgLnZhbFwiKS50ZXh0KE1pc2Mucm91bmRUbzIocmF3V3BtLm1heCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0pIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2ZXJhZ2VSYXcgLnRpdGxlXCIpLnRleHQoXCJhdmVyYWdlIHJhdyBjcG1cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmVyYWdlUmF3IC52YWxcIikudGV4dChNYXRoLnJvdW5kKChyYXdXcG0udG90YWwgKiA1KSAvIHJhd1dwbS5jb3VudCkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZlcmFnZVJhdyAudGl0bGVcIikudGV4dChcImF2ZXJhZ2UgcmF3IHdwbVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2ZXJhZ2VSYXcgLnZhbFwiKS50ZXh0KE1hdGgucm91bmQocmF3V3BtLnRvdGFsIC8gcmF3V3BtLmNvdW50KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSkge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZlcmFnZVJhdzEwIC50aXRsZVwiKS50ZXh0KFwiYXZlcmFnZSByYXcgY3BtIChsYXN0IDEwIHRlc3RzKVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2ZXJhZ2VSYXcxMCAudmFsXCIpLnRleHQoTWF0aC5yb3VuZCgocmF3V3BtLmxhc3QxMFRvdGFsICogNSkgLyByYXdXcG0ubGFzdDEwQ291bnQpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2ZXJhZ2VSYXcxMCAudGl0bGVcIikudGV4dChcImF2ZXJhZ2UgcmF3IHdwbSAobGFzdCAxMCB0ZXN0cylcIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmVyYWdlUmF3MTAgLnZhbFwiKS50ZXh0KE1hdGgucm91bmQocmF3V3BtLmxhc3QxMFRvdGFsIC8gcmF3V3BtLmxhc3QxMENvdW50KSk7XG4gICAgICAgIH1cbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuaGlnaGVzdFdwbSAubW9kZVwiKS5odG1sKHRvcE1vZGUpO1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC50ZXN0c1Rha2VuIC52YWxcIikudGV4dCh0ZXN0Q291bnQpO1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5oaWdoZXN0QWNjIC52YWxcIikudGV4dCh0b3BBY2MgKyBcIiVcIik7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2Z0FjYyAudmFsXCIpLnRleHQoTWF0aC5yb3VuZCh0b3RhbEFjYyAvIHRlc3RDb3VudCkgKyBcIiVcIik7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2Z0FjYzEwIC52YWxcIikudGV4dChNYXRoLnJvdW5kKHRvdGFsQWNjMTAgLyBsYXN0MTApICsgXCIlXCIpO1xuICAgICAgICBpZiAodG90YWxDb25zID09IDAgfHwgdG90YWxDb25zID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZnQ29ucyAudmFsXCIpLnRleHQoXCItXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZnQ29uczEwIC52YWxcIikudGV4dChcIi1cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5oaWdoZXN0Q29ucyAudmFsXCIpLnRleHQodG9wQ29ucyArIFwiJVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2Z0NvbnMgLnZhbFwiKS50ZXh0KE1hdGgucm91bmQodG90YWxDb25zIC8gY29uc0NvdW50KSArIFwiJVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2Z0NvbnMxMCAudmFsXCIpLnRleHQoTWF0aC5yb3VuZCh0b3RhbENvbnMxMCAvIE1hdGgubWluKGxhc3QxMCwgY29uc0NvdW50KSkgKyBcIiVcIik7XG4gICAgICAgIH1cbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAudGVzdHNTdGFydGVkIC52YWxcIikudGV4dChgJHt0ZXN0Q291bnQgKyB0ZXN0UmVzdGFydHN9YCk7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLnRlc3RzQ29tcGxldGVkIC52YWxcIikudGV4dChgJHt0ZXN0Q291bnR9KCR7TWF0aC5mbG9vcigodGVzdENvdW50IC8gKHRlc3RDb3VudCArIHRlc3RSZXN0YXJ0cykpICogMTAwKX0lKWApO1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC50ZXN0c0NvbXBsZXRlZCAuYXZncmVzXCIpLnRleHQoYFxuICAgICAgJHsodGVzdFJlc3RhcnRzIC8gdGVzdENvdW50KS50b0ZpeGVkKDEpfSByZXN0YXJ0cyBwZXIgY29tcGxldGVkIHRlc3RcbiAgICBgKTtcbiAgICAgICAgY29uc3Qgd3BtUG9pbnRzID0gZmlsdGVyZWRSZXN1bHRzLm1hcCgocikgPT4gci53cG0pLnJldmVyc2UoKTtcbiAgICAgICAgY29uc3QgdHJlbmQgPSBNaXNjLmZpbmRMaW5lQnlMZWFzdFNxdWFyZXMod3BtUG9pbnRzKTtcbiAgICAgICAgY29uc3Qgd3BtQ2hhbmdlID0gdHJlbmRbMV1bMV0gLSB0cmVuZFswXVsxXTtcbiAgICAgICAgY29uc3Qgd3BtQ2hhbmdlUGVySG91ciA9IHdwbUNoYW5nZSAqICgzNjAwIC8gdG90YWxTZWNvbmRzRmlsdGVyZWQpO1xuICAgICAgICBjb25zdCBwbHVzID0gd3BtQ2hhbmdlUGVySG91ciA+IDAgPyBcIitcIiA6IFwiXCI7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmdyb3VwLmNoYXJ0IC5iZWxvdyAudGV4dFwiKS50ZXh0KGBTcGVlZCBjaGFuZ2UgcGVyIGhvdXIgc3BlbnQgdHlwaW5nOiAke3BsdXMgK1xuICAgICAgICAgICAgTWlzYy5yb3VuZFRvMihjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0gPyB3cG1DaGFuZ2VQZXJIb3VyICogNSA6IHdwbUNoYW5nZVBlckhvdXIpfSAke2NvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSA/IFwiY3BtXCIgOiBcIndwbVwifS5gKTtcbiAgICAgICAgYXBwbHlIaXN0b3J5U21vb3RoaW5nKCk7XG4gICAgICAgIENoYXJ0Q29udHJvbGxlci5hY2NvdW50QWN0aXZpdHkudXBkYXRlQ29sb3JzKCk7XG4gICAgICAgIExvYWRpbmdQYWdlLnVwZGF0ZUJhcigxMDAsIHRydWUpO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09IFwiYWNjb3VudFwiKVxuICAgICAgICAgICAgICAgIFNpZ25PdXRCdXR0b24uc2hvdygpO1xuICAgICAgICB9LCAxMjUpO1xuICAgICAgICBGb2N1cy5zZXQoZmFsc2UpO1xuICAgICAgICBNaXNjLnN3YXBFbGVtZW50cygkKFwiLnBhZ2VBY2NvdW50IC5wcmVsb2FkZXJcIiksICQoXCIucGFnZUFjY291bnQgLmNvbnRlbnRcIiksIDI1MCk7XG4gICAgfVxuICAgIGlmIChEQi5nZXRTbmFwc2hvdCgpID09PSBudWxsKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGBNaXNzaW5nIGFjY291bnQgZGF0YS4gUGxlYXNlIHJlZnJlc2guYCwgLTEpO1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5wcmVsb2FkZXJcIikuaHRtbChcIk1pc3NpbmcgYWNjb3VudCBkYXRhLiBQbGVhc2UgcmVmcmVzaC5cIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKERCLmdldFNuYXBzaG90KCkucmVzdWx0cyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIExvYWRpbmdQYWdlLnVwZGF0ZUJhcig0NSwgdHJ1ZSk7XG4gICAgICAgIERCLmdldFVzZXJSZXN1bHRzKCkudGhlbigoZCkgPT4ge1xuICAgICAgICAgICAgVG9kYXlUcmFja2VyLmFkZEFsbEZyb21Ub2RheSgpO1xuICAgICAgICAgICAgaWYgKGQpIHtcbiAgICAgICAgICAgICAgICBSZXN1bHRGaWx0ZXJzLnVwZGF0ZUFjdGl2ZSgpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwidXNpbmcgZGIgc25hcFwiKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnQoKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGBTb21ldGhpbmcgd2VudCB3cm9uZzogJHtlfWAsIC0xKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMudXBkYXRlID0gdXBkYXRlO1xuZnVuY3Rpb24gc29ydEFuZFJlZnJlc2hIaXN0b3J5KGtleVN0cmluZywgaGVhZGVyQ2xhc3MsIGZvcmNlRGVzY2VuZGluZyA9IG51bGwpIHtcbiAgICAvLyBSZW1vdmVzIHN0eWxpbmcgZnJvbSBwcmV2aW91cyBzb3J0aW5nIHJlcXVlc3RzOlxuICAgICQoXCJ0ZFwiKS5yZW1vdmVDbGFzcyhcImhlYWRlci1zb3J0ZWRcIik7XG4gICAgJChcInRkXCIpLmNoaWxkcmVuKFwiaVwiKS5yZW1vdmUoKTtcbiAgICAkKGhlYWRlckNsYXNzKS5hZGRDbGFzcyhcImhlYWRlci1zb3J0ZWRcIik7XG4gICAgaWYgKGZpbHRlcmVkUmVzdWx0cy5sZW5ndGggPCAyKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3Qga2V5ID0ga2V5U3RyaW5nO1xuICAgIC8vIFRoaXMgYWxsb3dzIHRvIHJldmVyc2UgdGhlIHNvcnRpbmcgb3JkZXIgd2hlbiBjbGlja2luZyBtdWx0aXBsZSB0aW1lcyBvbiB0aGUgdGFibGUgaGVhZGVyXG4gICAgbGV0IGRlc2NlbmRpbmcgPSB0cnVlO1xuICAgIGlmIChmb3JjZURlc2NlbmRpbmcgIT09IG51bGwpIHtcbiAgICAgICAgaWYgKGZvcmNlRGVzY2VuZGluZyA9PSB0cnVlKSB7XG4gICAgICAgICAgICAkKGhlYWRlckNsYXNzKS5hcHBlbmQoJzxpIGNsYXNzPVwiZmFzIGZhLXNvcnQtZG93blwiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvaT4nKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGRlc2NlbmRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICQoaGVhZGVyQ2xhc3MpLmFwcGVuZCgnPGkgY2xhc3M9XCJmYXMgZmEtc29ydC11cFwiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvaT4nKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChwYXJzZUludChmaWx0ZXJlZFJlc3VsdHNbMF1ba2V5XSkgPD1cbiAgICAgICAgcGFyc2VJbnQoZmlsdGVyZWRSZXN1bHRzW2ZpbHRlcmVkUmVzdWx0cy5sZW5ndGggLSAxXVtrZXldKSkge1xuICAgICAgICBkZXNjZW5kaW5nID0gdHJ1ZTtcbiAgICAgICAgJChoZWFkZXJDbGFzcykuYXBwZW5kKCc8aSBjbGFzcz1cImZhcyBmYS1zb3J0LWRvd25cIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L2k+Jyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBkZXNjZW5kaW5nID0gZmFsc2U7XG4gICAgICAgICQoaGVhZGVyQ2xhc3MpLmFwcGVuZCgnPGkgY2xhc3M9XCJmYXMgZmEtc29ydC11cFwiLCBhcmlhLWhpZGRlbj1cInRydWVcIj48L2k+Jyk7XG4gICAgfVxuICAgIGNvbnN0IHRlbXAgPSBbXTtcbiAgICBjb25zdCBwYXJzZWRJbmRleGVzID0gW107XG4gICAgd2hpbGUgKHRlbXAubGVuZ3RoIDwgZmlsdGVyZWRSZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICBsZXQgbG93ZXN0ID0gTnVtYmVyLk1BWF9WQUxVRTtcbiAgICAgICAgbGV0IGhpZ2hlc3QgPSAtMTtcbiAgICAgICAgbGV0IGlkeCA9IC0xO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpbHRlcmVkUmVzdWx0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgLy9maW5kIHRoZSBsb3dlc3Qgd3BtIHdpdGggaW5kZXggbm90IGFscmVhZHkgcGFyc2VkXG4gICAgICAgICAgICBpZiAoIWRlc2NlbmRpbmcpIHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWRSZXN1bHRzW2ldW2tleV0gPD0gbG93ZXN0ICYmXG4gICAgICAgICAgICAgICAgICAgICFwYXJzZWRJbmRleGVzLmluY2x1ZGVzKGkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvd2VzdCA9IGZpbHRlcmVkUmVzdWx0c1tpXVtrZXldO1xuICAgICAgICAgICAgICAgICAgICBpZHggPSBpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJlZFJlc3VsdHNbaV1ba2V5XSA+PSBoaWdoZXN0ICYmXG4gICAgICAgICAgICAgICAgICAgICFwYXJzZWRJbmRleGVzLmluY2x1ZGVzKGkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGhpZ2hlc3QgPSBmaWx0ZXJlZFJlc3VsdHNbaV1ba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgaWR4ID0gaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGVtcC5wdXNoKGZpbHRlcmVkUmVzdWx0c1tpZHhdKTtcbiAgICAgICAgcGFyc2VkSW5kZXhlcy5wdXNoKGlkeCk7XG4gICAgfVxuICAgIGZpbHRlcmVkUmVzdWx0cyA9IHRlbXA7XG4gICAgJChcIi5wYWdlQWNjb3VudCAuaGlzdG9yeSB0YWJsZSB0Ym9keVwiKS5lbXB0eSgpO1xuICAgIHZpc2libGVUYWJsZUxpbmVzID0gMDtcbiAgICBsb2FkTW9yZUxpbmVzKCk7XG59XG4kKFwiLnBhZ2VBY2NvdW50IC50b2dnbGVBY2N1cmFjeU9uQ2hhcnRcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnNldENoYXJ0QWNjdXJhY3koIWNvbmZpZ18xLmRlZmF1bHQuY2hhcnRBY2N1cmFjeSk7XG59KTtcbiQoXCIucGFnZUFjY291bnQgLnRvZ2dsZUNoYXJ0U3R5bGVcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuY2hhcnRTdHlsZSA9PSBcImxpbmVcIikge1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0Q2hhcnRTdHlsZShcInNjYXR0ZXJcIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0Q2hhcnRTdHlsZShcImxpbmVcIik7XG4gICAgfVxufSk7XG4kKFwiLnBhZ2VBY2NvdW50IC5sb2FkTW9yZUJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBsb2FkTW9yZUxpbmVzKCk7XG59KTtcbiQoXCIucGFnZUFjY291bnQgI2FjY291bnRIaXN0b3J5Q2hhcnRcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgY29uc3QgaW5kZXggPSBDaGFydENvbnRyb2xsZXIuYWNjb3VudEhpc3RvcnlBY3RpdmVJbmRleDtcbiAgICBsb2FkTW9yZUxpbmVzKGluZGV4KTtcbiAgICBpZiAoIXdpbmRvdylcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IHdpbmRvd0hlaWdodCA9IChfYSA9ICQod2luZG93KS5oZWlnaHQoKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogMDtcbiAgICBjb25zdCBvZmZzZXQgPSAoX2MgPSAoX2IgPSAkKGAjcmVzdWx0LSR7aW5kZXh9YCkub2Zmc2V0KCkpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50b3ApICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IDA7XG4gICAgY29uc3Qgc2Nyb2xsVG8gPSBvZmZzZXQgLSB3aW5kb3dIZWlnaHQgLyAyO1xuICAgICQoW2RvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgZG9jdW1lbnQuYm9keV0pLmFuaW1hdGUoe1xuICAgICAgICBzY3JvbGxUb3A6IHNjcm9sbFRvLFxuICAgIH0sIDUwMCk7XG4gICAgJChcIi5yZXN1bHRSb3dcIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgJChgI3Jlc3VsdC0ke2luZGV4fWApLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VBY2NvdW50IC5taW5pUmVzdWx0Q2hhcnRCdXR0b25cIiwgKGV2ZW50KSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnNvbGUubG9nKFwidXBkYXRpbmdcIik7XG4gICAgY29uc3QgZmlsdGVyZWRJZCA9ICQoZXZlbnQuY3VycmVudFRhcmdldCkuYXR0cihcImZpbHRlcmVkUmVzdWx0c0lkXCIpO1xuICAgIGlmIChmaWx0ZXJlZElkID09PSB1bmRlZmluZWQpXG4gICAgICAgIHJldHVybjtcbiAgICBNaW5pUmVzdWx0Q2hhcnQudXBkYXRlRGF0YShmaWx0ZXJlZFJlc3VsdHNbcGFyc2VJbnQoZmlsdGVyZWRJZCldLmNoYXJ0RGF0YSk7XG4gICAgTWluaVJlc3VsdENoYXJ0LnNob3coKTtcbiAgICBNaW5pUmVzdWx0Q2hhcnQudXBkYXRlUG9zaXRpb24oZXZlbnQucGFnZVggLSAoKF9hID0gJChcIi5wYWdlQWNjb3VudCAubWluaVJlc3VsdENoYXJ0V3JhcHBlclwiKS5vdXRlcldpZHRoKCkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDApLCBldmVudC5wYWdlWSArIDMwKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5oaXN0b3J5LXdwbS1oZWFkZXJcIiwgKCkgPT4ge1xuICAgIHNvcnRBbmRSZWZyZXNoSGlzdG9yeShcIndwbVwiLCBcIi5oaXN0b3J5LXdwbS1oZWFkZXJcIik7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIuaGlzdG9yeS1yYXctaGVhZGVyXCIsICgpID0+IHtcbiAgICBzb3J0QW5kUmVmcmVzaEhpc3RvcnkoXCJyYXdXcG1cIiwgXCIuaGlzdG9yeS1yYXctaGVhZGVyXCIpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLmhpc3RvcnktYWNjLWhlYWRlclwiLCAoKSA9PiB7XG4gICAgc29ydEFuZFJlZnJlc2hIaXN0b3J5KFwiYWNjXCIsIFwiLmhpc3RvcnktYWNjLWhlYWRlclwiKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5oaXN0b3J5LWNvcnJlY3QtY2hhcnMtaGVhZGVyXCIsICgpID0+IHtcbiAgICBzb3J0QW5kUmVmcmVzaEhpc3RvcnkoXCJjb3JyZWN0Q2hhcnNcIiwgXCIuaGlzdG9yeS1jb3JyZWN0LWNoYXJzLWhlYWRlclwiKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5oaXN0b3J5LWluY29ycmVjdC1jaGFycy1oZWFkZXJcIiwgKCkgPT4ge1xuICAgIHNvcnRBbmRSZWZyZXNoSGlzdG9yeShcImluY29ycmVjdENoYXJzXCIsIFwiLmhpc3RvcnktaW5jb3JyZWN0LWNoYXJzLWhlYWRlclwiKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5oaXN0b3J5LWNvbnNpc3RlbmN5LWhlYWRlclwiLCAoKSA9PiB7XG4gICAgc29ydEFuZFJlZnJlc2hIaXN0b3J5KFwiY29uc2lzdGVuY3lcIiwgXCIuaGlzdG9yeS1jb25zaXN0ZW5jeS1oZWFkZXJcIik7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIuaGlzdG9yeS1kYXRlLWhlYWRlclwiLCAoKSA9PiB7XG4gICAgc29ydEFuZFJlZnJlc2hIaXN0b3J5KFwidGltZXN0YW1wXCIsIFwiLmhpc3RvcnktZGF0ZS1oZWFkZXJcIik7XG59KTtcbi8vIFJlc2V0cyBzb3J0aW5nIHRvIGJ5IGRhdGUnIHdoZW4gYXBwbHlpbmcgZmlsZXJzIChub3JtYWwgb3IgYWR2YW5jZWQpXG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLmJ1dHRvbnNBbmRUaXRsZSAuYnV0dG9ucyAuYnV0dG9uXCIsICgpID0+IHtcbiAgICAvLyBXZSB3YW50IHRvICdmb3JjZScgZGVzY2VuZGluZyBzb3J0OlxuICAgIHNvcnRBbmRSZWZyZXNoSGlzdG9yeShcInRpbWVzdGFtcFwiLCBcIi5oaXN0b3J5LWRhdGUtaGVhZGVyXCIsIHRydWUpO1xufSk7XG4kKFwiLnBhZ2VBY2NvdW50IC50b3BGaWx0ZXJzIC5idXR0b24sIC5wYWdlQWNjb3VudCAuZmlsdGVyQnV0dG9ucyAuYnV0dG9uIFwiKS5jbGljaygoKSA9PiB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHVwZGF0ZSgpO1xuICAgIH0sIDApO1xufSk7XG4kKFwiLnBhZ2VBY2NvdW50IC5jb250ZW50IC5iZWxvdyAuc21vb3RoaW5nIGlucHV0XCIpLm9uKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgIGFwcGx5SGlzdG9yeVNtb290aGluZygpO1xufSk7XG4kKFwiLnBhZ2VBY2NvdW50IC5jb250ZW50IC5ncm91cC5hYm92ZUhpc3RvcnkgLmV4cG9ydENTVlwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBNaXNjLmRvd25sb2FkUmVzdWx0c0NTVihmaWx0ZXJlZFJlc3VsdHMpO1xufSk7XG5leHBvcnRzLnBhZ2UgPSBuZXcgcGFnZV8xLmRlZmF1bHQoXCJhY2NvdW50XCIsICQoXCIucGFnZS5wYWdlQWNjb3VudFwiKSwgXCIvYWNjb3VudFwiLCAoKSA9PiB7XG4gICAgU2lnbk91dEJ1dHRvbi5oaWRlKCk7XG59LCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICByZXNldCgpO1xufSksICgpID0+IHtcbiAgICB1cGRhdGUoKTtcbiAgICAvLyBTaWduT3V0QnV0dG9uLnNob3coKTtcbn0sICgpID0+IHtcbiAgICAvL1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnBhZ2UgPSBleHBvcnRzLnNob3dCYXIgPSBleHBvcnRzLnVwZGF0ZVRleHQgPSBleHBvcnRzLnVwZGF0ZUJhciA9IHZvaWQgMDtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgcGFnZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL3BhZ2VcIikpO1xuZnVuY3Rpb24gdXBkYXRlQmFyKHBlcmNlbnRhZ2UsIGZhc3QpIHtcbiAgICBjb25zdCBzcGVlZCA9IGZhc3QgPyAxMDAgOiAxMDAwO1xuICAgICQoXCIucGFnZUxvYWRpbmcgLmZpbGwsIC5wYWdlQWNjb3VudCAuZmlsbFwiKVxuICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgIHdpZHRoOiBwZXJjZW50YWdlICsgXCIlXCIsXG4gICAgfSwgc3BlZWQpO1xufVxuZXhwb3J0cy51cGRhdGVCYXIgPSB1cGRhdGVCYXI7XG5mdW5jdGlvbiB1cGRhdGVUZXh0KHRleHQpIHtcbiAgICAkKFwiLnBhZ2VMb2FkaW5nIC50ZXh0LCAucGFnZUFjY291bnQgLnRleHRcIikudGV4dCh0ZXh0KTtcbn1cbmV4cG9ydHMudXBkYXRlVGV4dCA9IHVwZGF0ZVRleHQ7XG5mdW5jdGlvbiBzaG93QmFyKCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICBNaXNjLnN3YXBFbGVtZW50cygkKFwiLnBhZ2VMb2FkaW5nIC5pY29uXCIpLCAkKFwiLnBhZ2VMb2FkaW5nIC5iYXJXcmFwcGVyXCIpLCAxMjUsICgpID0+IHtcbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIE1pc2Muc3dhcEVsZW1lbnRzKCQoXCIucGFnZUFjY291bnQgLmljb25cIiksICQoXCIucGFnZUFjY291bnQgLmJhcldyYXBwZXJcIiksIDEyNSwgKCkgPT4ge1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc2hvd0JhciA9IHNob3dCYXI7XG5leHBvcnRzLnBhZ2UgPSBuZXcgcGFnZV8xLmRlZmF1bHQoXCJsb2FkaW5nXCIsICQoXCIucGFnZS5wYWdlTG9hZGluZ1wiKSwgXCIvXCIsICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIC8vXG59KSwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgLy9cbn0pLCAoKSA9PiB7XG4gICAgLy9cbn0sICgpID0+IHtcbiAgICAvL1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucGFnZSA9IHZvaWQgMDtcbmNvbnN0IHBhZ2VfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9wYWdlXCIpKTtcbmV4cG9ydHMucGFnZSA9IG5ldyBwYWdlXzEuZGVmYXVsdChcImxvZ2luXCIsICQoXCIucGFnZS5wYWdlTG9naW5cIiksIFwiL2xvZ2luXCIsICgpID0+IHtcbiAgICAvL1xufSwgKCkgPT4ge1xuICAgIC8vXG59LCAoKSA9PiB7XG4gICAgLy9cbn0sICgpID0+IHtcbiAgICAvL1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNsYXNzIFBhZ2Uge1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIGVsZW1lbnQsIHBhdGhuYW1lLCBiZWZvcmVIaWRlLCBhZnRlckhpZGUsIGJlZm9yZVNob3csIGFmdGVyU2hvdykge1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgICAgICB0aGlzLnBhdGhuYW1lID0gcGF0aG5hbWU7XG4gICAgICAgIHRoaXMuYmVmb3JlSGlkZSA9IGJlZm9yZUhpZGU7XG4gICAgICAgIHRoaXMuYWZ0ZXJIaWRlID0gYWZ0ZXJIaWRlO1xuICAgICAgICB0aGlzLmJlZm9yZVNob3cgPSBiZWZvcmVTaG93O1xuICAgICAgICB0aGlzLmFmdGVyU2hvdyA9IGFmdGVyU2hvdztcbiAgICB9XG59XG5leHBvcnRzLmRlZmF1bHQgPSBQYWdlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5wYWdlID0gZXhwb3J0cy5zZXRFdmVudERpc2FibGVkID0gZXhwb3J0cy51cGRhdGUgPSBleHBvcnRzLnNob3dBY2NvdW50U2VjdGlvbiA9IGV4cG9ydHMudXBkYXRlQXV0aFNlY3Rpb25zID0gZXhwb3J0cy51cGRhdGVEaXNjb3JkU2VjdGlvbiA9IGV4cG9ydHMuaGlkZUFjY291bnRTZWN0aW9uID0gZXhwb3J0cy5maWxsU2V0dGluZ3NQYWdlID0gZXhwb3J0cy5yZXNldCA9IGV4cG9ydHMuZ3JvdXBzID0gdm9pZCAwO1xuY29uc3Qgc2V0dGluZ3NfZ3JvdXBfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vc2V0dGluZ3Mvc2V0dGluZ3MtZ3JvdXBcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgU291bmQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL3NvdW5kLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgRnVuYm94ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2Z1bmJveFwiKSk7XG5jb25zdCBUYWdDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy90YWctY29udHJvbGxlclwiKSk7XG5jb25zdCBQcmVzZXRDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9wcmVzZXQtY29udHJvbGxlclwiKSk7XG5jb25zdCBUaGVtZVBpY2tlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc2V0dGluZ3MvdGhlbWUtcGlja2VyXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgSW1wb3J0RXhwb3J0U2V0dGluZ3NQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcG9wdXBzL2ltcG9ydC1leHBvcnQtc2V0dGluZ3MtcG9wdXBcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBBY3RpdmVQYWdlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvYWN0aXZlLXBhZ2VcIikpO1xuY29uc3QgQXBlS2V5c1BvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wb3B1cHMvYXBlLWtleXMtcG9wdXBcIikpO1xuY29uc3QgcGFnZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL3BhZ2VcIikpO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuLi9maXJlYmFzZVwiKTtcbmV4cG9ydHMuZ3JvdXBzID0ge307XG5mdW5jdGlvbiBpbml0R3JvdXBzKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHlpZWxkIFVwZGF0ZUNvbmZpZy5sb2FkUHJvbWlzZTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzbW9vdGhDYXJldFwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJzbW9vdGhDYXJldFwiLCBVcGRhdGVDb25maWcuc2V0U21vb3RoQ2FyZXQsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImRpZmZpY3VsdHlcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiZGlmZmljdWx0eVwiLCBVcGRhdGVDb25maWcuc2V0RGlmZmljdWx0eSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wicXVpY2tUYWJcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwicXVpY2tUYWJcIiwgVXBkYXRlQ29uZmlnLnNldFF1aWNrVGFiTW9kZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic2hvd0xpdmVXcG1cIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwic2hvd0xpdmVXcG1cIiwgVXBkYXRlQ29uZmlnLnNldFNob3dMaXZlV3BtLCBcImJ1dHRvblwiLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImtleW1hcE1vZGVcIl0udXBkYXRlSW5wdXQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic2hvd0xpdmVBY2NcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwic2hvd0xpdmVBY2NcIiwgVXBkYXRlQ29uZmlnLnNldFNob3dMaXZlQWNjLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzaG93TGl2ZUJ1cnN0XCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInNob3dMaXZlQnVyc3RcIiwgVXBkYXRlQ29uZmlnLnNldFNob3dMaXZlQnVyc3QsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInNob3dUaW1lclByb2dyZXNzXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInNob3dUaW1lclByb2dyZXNzXCIsIFVwZGF0ZUNvbmZpZy5zZXRTaG93VGltZXJQcm9ncmVzcywgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic2hvd0F2ZXJhZ2VcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwic2hvd0F2ZXJhZ2VcIiwgVXBkYXRlQ29uZmlnLnNldFNob3dBdmVyYWdlLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJrZXltYXBNb2RlXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImtleW1hcE1vZGVcIiwgVXBkYXRlQ29uZmlnLnNldEtleW1hcE1vZGUsIFwiYnV0dG9uXCIsICgpID0+IHtcbiAgICAgICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic2hvd0xpdmVXcG1cIl0udXBkYXRlSW5wdXQoKTtcbiAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTW9kZSA9PT0gXCJvZmZcIikge1xuICAgICAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmtleW1hcFN0eWxlXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmtleW1hcExheW91dFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5rZXltYXBMZWdlbmRTdHlsZVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmtleW1hcFN0eWxlXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmtleW1hcExheW91dFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5rZXltYXBMZWdlbmRTdHlsZVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wia2V5bWFwTWF0cml4XCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImtleW1hcFN0eWxlXCIsIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBTdHlsZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wia2V5bWFwTGF5b3V0XCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImtleW1hcExheW91dFwiLCBVcGRhdGVDb25maWcuc2V0S2V5bWFwTGF5b3V0LCBcInNlbGVjdFwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJrZXltYXBMZWdlbmRTdHlsZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJrZXltYXBMZWdlbmRTdHlsZVwiLCBVcGRhdGVDb25maWcuc2V0S2V5bWFwTGVnZW5kU3R5bGUsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInNob3dLZXlUaXBzXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInNob3dLZXlUaXBzXCIsIFVwZGF0ZUNvbmZpZy5zZXRLZXlUaXBzLCBcImJ1dHRvblwiLCB1bmRlZmluZWQsICgpID0+IHtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnNob3dLZXlUaXBzKSB7XG4gICAgICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnRpcFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC50aXBcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImZyZWVkb21Nb2RlXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImZyZWVkb21Nb2RlXCIsIFVwZGF0ZUNvbmZpZy5zZXRGcmVlZG9tTW9kZSwgXCJidXR0b25cIiwgKCkgPT4ge1xuICAgICAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJjb25maWRlbmNlTW9kZVwiXS51cGRhdGVJbnB1dCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzdHJpY3RTcGFjZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJzdHJpY3RTcGFjZVwiLCBVcGRhdGVDb25maWcuc2V0U3RyaWN0U3BhY2UsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcIm9wcG9zaXRlU2hpZnRNb2RlXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcIm9wcG9zaXRlU2hpZnRNb2RlXCIsIFVwZGF0ZUNvbmZpZy5zZXRPcHBvc2l0ZVNoaWZ0TW9kZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiY29uZmlkZW5jZU1vZGVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiY29uZmlkZW5jZU1vZGVcIiwgVXBkYXRlQ29uZmlnLnNldENvbmZpZGVuY2VNb2RlLCBcImJ1dHRvblwiLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImZyZWVkb21Nb2RlXCJdLnVwZGF0ZUlucHV0KCk7XG4gICAgICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInN0b3BPbkVycm9yXCJdLnVwZGF0ZUlucHV0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImluZGljYXRlVHlwb3NcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiaW5kaWNhdGVUeXBvc1wiLCBVcGRhdGVDb25maWcuc2V0SW5kaWNhdGVUeXBvcywgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiaGlkZUV4dHJhTGV0dGVyc1wiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJoaWRlRXh0cmFMZXR0ZXJzXCIsIFVwZGF0ZUNvbmZpZy5zZXRIaWRlRXh0cmFMZXR0ZXJzLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJibGluZE1vZGVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiYmxpbmRNb2RlXCIsIFVwZGF0ZUNvbmZpZy5zZXRCbGluZE1vZGUsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInF1aWNrRW5kXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInF1aWNrRW5kXCIsIFVwZGF0ZUNvbmZpZy5zZXRRdWlja0VuZCwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wicmVwZWF0UXVvdGVzXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInJlcGVhdFF1b3Rlc1wiLCBVcGRhdGVDb25maWcuc2V0UmVwZWF0UXVvdGVzLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJlbmFibGVBZHNcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiZW5hYmxlQWRzXCIsIFVwZGF0ZUNvbmZpZy5zZXRFbmFibGVBZHMsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImFsd2F5c1Nob3dXb3Jkc0hpc3RvcnlcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiYWx3YXlzU2hvd1dvcmRzSGlzdG9yeVwiLCBVcGRhdGVDb25maWcuc2V0QWx3YXlzU2hvd1dvcmRzSGlzdG9yeSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiYnJpdGlzaEVuZ2xpc2hcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiYnJpdGlzaEVuZ2xpc2hcIiwgVXBkYXRlQ29uZmlnLnNldEJyaXRpc2hFbmdsaXNoLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzaW5nbGVMaXN0Q29tbWFuZExpbmVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwic2luZ2xlTGlzdENvbW1hbmRMaW5lXCIsIFVwZGF0ZUNvbmZpZy5zZXRTaW5nbGVMaXN0Q29tbWFuZExpbmUsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImNhcHNMb2NrV2FybmluZ1wiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJjYXBzTG9ja1dhcm5pbmdcIiwgVXBkYXRlQ29uZmlnLnNldENhcHNMb2NrV2FybmluZywgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiZmxpcFRlc3RDb2xvcnNcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiZmxpcFRlc3RDb2xvcnNcIiwgVXBkYXRlQ29uZmlnLnNldEZsaXBUZXN0Q29sb3JzLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzd2FwRXNjQW5kVGFiXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInN3YXBFc2NBbmRUYWJcIiwgVXBkYXRlQ29uZmlnLnNldFN3YXBFc2NBbmRUYWIsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInNob3dPdXRPZkZvY3VzV2FybmluZ1wiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJzaG93T3V0T2ZGb2N1c1dhcm5pbmdcIiwgVXBkYXRlQ29uZmlnLnNldFNob3dPdXRPZkZvY3VzV2FybmluZywgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiY29sb3JmdWxNb2RlXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImNvbG9yZnVsTW9kZVwiLCBVcGRhdGVDb25maWcuc2V0Q29sb3JmdWxNb2RlLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzdGFydEdyYXBoc0F0WmVyb1wiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJzdGFydEdyYXBoc0F0WmVyb1wiLCBVcGRhdGVDb25maWcuc2V0U3RhcnRHcmFwaHNBdFplcm8sIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImF1dG9Td2l0Y2hUaGVtZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJhdXRvU3dpdGNoVGhlbWVcIiwgVXBkYXRlQ29uZmlnLnNldEF1dG9Td2l0Y2hUaGVtZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wicmFuZG9tVGhlbWVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwicmFuZG9tVGhlbWVcIiwgVXBkYXRlQ29uZmlnLnNldFJhbmRvbVRoZW1lLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzdG9wT25FcnJvclwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJzdG9wT25FcnJvclwiLCBVcGRhdGVDb25maWcuc2V0U3RvcE9uRXJyb3IsIFwiYnV0dG9uXCIsICgpID0+IHtcbiAgICAgICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiY29uZmlkZW5jZU1vZGVcIl0udXBkYXRlSW5wdXQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic291bmRWb2x1bWVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwic291bmRWb2x1bWVcIiwgVXBkYXRlQ29uZmlnLnNldFNvdW5kVm9sdW1lLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJwbGF5U291bmRPbkVycm9yXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInBsYXlTb3VuZE9uRXJyb3JcIiwgVXBkYXRlQ29uZmlnLnNldFBsYXlTb3VuZE9uRXJyb3IsIFwiYnV0dG9uXCIsICgpID0+IHtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnBsYXlTb3VuZE9uRXJyb3IpXG4gICAgICAgICAgICAgICAgU291bmQucGxheUVycm9yKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInBsYXlTb3VuZE9uQ2xpY2tcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwicGxheVNvdW5kT25DbGlja1wiLCBVcGRhdGVDb25maWcuc2V0UGxheVNvdW5kT25DbGljaywgXCJidXR0b25cIiwgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucGxheVNvdW5kT25DbGljayAhPT0gXCJvZmZcIilcbiAgICAgICAgICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic2hvd0FsbExpbmVzXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInNob3dBbGxMaW5lc1wiLCBVcGRhdGVDb25maWcuc2V0U2hvd0FsbExpbmVzLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJwYWNlQ2FyZXRcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwicGFjZUNhcmV0XCIsIFVwZGF0ZUNvbmZpZy5zZXRQYWNlQ2FyZXQsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInJlcGVhdGVkUGFjZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJyZXBlYXRlZFBhY2VcIiwgVXBkYXRlQ29uZmlnLnNldFJlcGVhdGVkUGFjZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wibWluV3BtXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcIm1pbldwbVwiLCBVcGRhdGVDb25maWcuc2V0TWluV3BtLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJtaW5BY2NcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwibWluQWNjXCIsIFVwZGF0ZUNvbmZpZy5zZXRNaW5BY2MsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcIm1pbkJ1cnN0XCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcIm1pbkJ1cnN0XCIsIFVwZGF0ZUNvbmZpZy5zZXRNaW5CdXJzdCwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic21vb3RoTGluZVNjcm9sbFwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJzbW9vdGhMaW5lU2Nyb2xsXCIsIFVwZGF0ZUNvbmZpZy5zZXRTbW9vdGhMaW5lU2Nyb2xsLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJsYXp5TW9kZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJsYXp5TW9kZVwiLCBVcGRhdGVDb25maWcuc2V0TGF6eU1vZGUsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImxheW91dFwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJsYXlvdXRcIiwgVXBkYXRlQ29uZmlnLnNldExheW91dCwgXCJzZWxlY3RcIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wibGFuZ3VhZ2VcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwibGFuZ3VhZ2VcIiwgVXBkYXRlQ29uZmlnLnNldExhbmd1YWdlLCBcInNlbGVjdFwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJmb250U2l6ZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJmb250U2l6ZVwiLCBVcGRhdGVDb25maWcuc2V0Rm9udFNpemUsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInBhZ2VXaWR0aFwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJwYWdlV2lkdGhcIiwgVXBkYXRlQ29uZmlnLnNldFBhZ2VXaWR0aCwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiY2FyZXRTdHlsZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJjYXJldFN0eWxlXCIsIFVwZGF0ZUNvbmZpZy5zZXRDYXJldFN0eWxlLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJwYWNlQ2FyZXRTdHlsZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJwYWNlQ2FyZXRTdHlsZVwiLCBVcGRhdGVDb25maWcuc2V0UGFjZUNhcmV0U3R5bGUsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInRpbWVyU3R5bGVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwidGltZXJTdHlsZVwiLCBVcGRhdGVDb25maWcuc2V0VGltZXJTdHlsZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiaGlnaGxpZ2h0TW9kZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJoaWdobGlnaHRNb2RlXCIsIFVwZGF0ZUNvbmZpZy5zZXRIaWdobGlnaHRNb2RlLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJ0aW1lck9wYWNpdHlcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwidGltZXJPcGFjaXR5XCIsIFVwZGF0ZUNvbmZpZy5zZXRUaW1lck9wYWNpdHksIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInRpbWVyQ29sb3JcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwidGltZXJDb2xvclwiLCBVcGRhdGVDb25maWcuc2V0VGltZXJDb2xvciwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiZm9udEZhbWlseVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJmb250RmFtaWx5XCIsIFVwZGF0ZUNvbmZpZy5zZXRGb250RmFtaWx5LCBcImJ1dHRvblwiLCB1bmRlZmluZWQsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGN1c3RvbUJ1dHRvbiA9ICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmZvbnRGYW1pbHkgLmJ1dHRvbnMgLmN1c3RvbVwiKTtcbiAgICAgICAgICAgIGlmICgkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5mb250RmFtaWx5IC5idXR0b25zIC5hY3RpdmVcIikubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgY3VzdG9tQnV0dG9uLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgIGN1c3RvbUJ1dHRvbi50ZXh0KGBDdXN0b20gKCR7Y29uZmlnXzEuZGVmYXVsdC5mb250RmFtaWx5LnJlcGxhY2UoL18vZywgXCIgXCIpfSlgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGN1c3RvbUJ1dHRvbi50ZXh0KFwiQ3VzdG9tXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJhbHdheXNTaG93RGVjaW1hbFBsYWNlc1wiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJhbHdheXNTaG93RGVjaW1hbFBsYWNlc1wiLCBVcGRhdGVDb25maWcuc2V0QWx3YXlzU2hvd0RlY2ltYWxQbGFjZXMsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImFsd2F5c1Nob3dDUE1cIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiYWx3YXlzU2hvd0NQTVwiLCBVcGRhdGVDb25maWcuc2V0QWx3YXlzU2hvd0NQTSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiY3VzdG9tQmFja2dyb3VuZFNpemVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiY3VzdG9tQmFja2dyb3VuZFNpemVcIiwgVXBkYXRlQ29uZmlnLnNldEN1c3RvbUJhY2tncm91bmRTaXplLCBcImJ1dHRvblwiKTtcbiAgICAgICAgLy8gZ3JvdXBzLmN1c3RvbUxheW91dGZsdWlkID0gbmV3IFNldHRpbmdzR3JvdXAoXG4gICAgICAgIC8vICAgXCJjdXN0b21MYXlvdXRmbHVpZFwiLFxuICAgICAgICAvLyAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21MYXlvdXRmbHVpZFxuICAgICAgICAvLyApO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC5mYXZUaGVtZXMuYnV0dG9uc1wiKS5lbXB0eSgpO1xuICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAuYWxsVGhlbWVzLmJ1dHRvbnNcIikuZW1wdHkoKTtcbiAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLmFsbEN1c3RvbVRoZW1lcy5idXR0b25zXCIpLmVtcHR5KCk7XG4gICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubGFuZ3VhZ2VHcm91cHMgLmJ1dHRvbnNcIikuZW1wdHkoKTtcbiAgICAkKFwiLnBhZ2VTZXR0aW5ncyBzZWxlY3RcIikuZW1wdHkoKS5zZWxlY3QyKFwiZGVzdHJveVwiKTtcbiAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5mdW5ib3ggLmJ1dHRvbnNcIikuZW1wdHkoKTtcbiAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5mb250RmFtaWx5IC5idXR0b25zXCIpLmVtcHR5KCk7XG59XG5leHBvcnRzLnJlc2V0ID0gcmVzZXQ7XG5sZXQgZ3JvdXBzSW5pdGlhbGl6ZWQgPSBmYWxzZTtcbmZ1bmN0aW9uIGZpbGxTZXR0aW5nc1BhZ2UoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc2hvd0tleVRpcHMpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC50aXBcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAudGlwXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIC8vIExhbmd1YWdlIFNlbGVjdGlvbiBDb21ib2JveFxuICAgICAgICBjb25zdCBsYW5ndWFnZUVsID0gJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubGFuZ3VhZ2Ugc2VsZWN0XCIpLmVtcHR5KCk7XG4gICAgICAgIGNvbnN0IGxhbmd1YWdlR3JvdXBzID0geWllbGQgTWlzYy5nZXRMYW5ndWFnZUdyb3VwcygpO1xuICAgICAgICBsYW5ndWFnZUdyb3Vwcy5mb3JFYWNoKChncm91cCkgPT4ge1xuICAgICAgICAgICAgbGV0IGxhbmdDb21ib0JveCA9IGA8b3B0Z3JvdXAgbGFiZWw9XCIke2dyb3VwLm5hbWV9XCI+YDtcbiAgICAgICAgICAgIGdyb3VwLmxhbmd1YWdlcy5mb3JFYWNoKChsYW5ndWFnZSkgPT4ge1xuICAgICAgICAgICAgICAgIGxhbmdDb21ib0JveCArPSBgPG9wdGlvbiB2YWx1ZT1cIiR7bGFuZ3VhZ2V9XCI+XG4gICAgICAgICR7bGFuZ3VhZ2UucmVwbGFjZSgvXy9nLCBcIiBcIil9XG4gICAgICA8L29wdGlvbj5gO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBsYW5nQ29tYm9Cb3ggKz0gYDwvb3B0Z3JvdXA+YDtcbiAgICAgICAgICAgIGxhbmd1YWdlRWwuYXBwZW5kKGxhbmdDb21ib0JveCk7XG4gICAgICAgIH0pO1xuICAgICAgICBsYW5ndWFnZUVsLnNlbGVjdDIoe1xuICAgICAgICAgICAgd2lkdGg6IFwiMTAwJVwiLFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgbGF5b3V0RWwgPSAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5sYXlvdXQgc2VsZWN0XCIpLmVtcHR5KCk7XG4gICAgICAgIGxheW91dEVsLmFwcGVuZChgPG9wdGlvbiB2YWx1ZT0nZGVmYXVsdCc+b2ZmPC9vcHRpb24+YCk7XG4gICAgICAgIE9iamVjdC5rZXlzKHlpZWxkIE1pc2MuZ2V0TGF5b3V0c0xpc3QoKSkuZm9yRWFjaCgobGF5b3V0KSA9PiB7XG4gICAgICAgICAgICBsYXlvdXRFbC5hcHBlbmQoYDxvcHRpb24gdmFsdWU9JyR7bGF5b3V0fSc+JHtsYXlvdXQucmVwbGFjZSgvXy9nLCBcIiBcIil9PC9vcHRpb24+YCk7XG4gICAgICAgIH0pO1xuICAgICAgICBsYXlvdXRFbC5zZWxlY3QyKHtcbiAgICAgICAgICAgIHdpZHRoOiBcIjEwMCVcIixcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGtleW1hcEVsID0gJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ua2V5bWFwTGF5b3V0IHNlbGVjdFwiKS5lbXB0eSgpO1xuICAgICAgICBrZXltYXBFbC5hcHBlbmQoYDxvcHRpb24gdmFsdWU9J292ZXJyaWRlU3luYyc+ZW11bGF0b3Igc3luYzwvb3B0aW9uPmApO1xuICAgICAgICBPYmplY3Qua2V5cyh5aWVsZCBNaXNjLmdldExheW91dHNMaXN0KCkpLmZvckVhY2goKGxheW91dCkgPT4ge1xuICAgICAgICAgICAgaWYgKGxheW91dC50b1N0cmluZygpICE9IFwiZGVmYXVsdFwiKSB7XG4gICAgICAgICAgICAgICAga2V5bWFwRWwuYXBwZW5kKGA8b3B0aW9uIHZhbHVlPScke2xheW91dH0nPiR7bGF5b3V0LnJlcGxhY2UoL18vZywgXCIgXCIpfTwvb3B0aW9uPmApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAga2V5bWFwRWwuc2VsZWN0Mih7XG4gICAgICAgICAgICB3aWR0aDogXCIxMDAlXCIsXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCB0aGVtZUVsMSA9ICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmF1dG9Td2l0Y2hUaGVtZUlucHV0cyBzZWxlY3QubGlnaHRcIikuZW1wdHkoKTtcbiAgICAgICAgY29uc3QgdGhlbWVFbDIgPSAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5hdXRvU3dpdGNoVGhlbWVJbnB1dHMgc2VsZWN0LmRhcmtcIikuZW1wdHkoKTtcbiAgICAgICAgZm9yIChjb25zdCB0aGVtZSBvZiB5aWVsZCBNaXNjLmdldFRoZW1lc0xpc3QoKSkge1xuICAgICAgICAgICAgdGhlbWVFbDEuYXBwZW5kKGA8b3B0aW9uIHZhbHVlPScke3RoZW1lLm5hbWV9Jz4ke3RoZW1lLm5hbWUucmVwbGFjZSgvXy9nLCBcIiBcIil9PC9vcHRpb24+YCk7XG4gICAgICAgICAgICB0aGVtZUVsMi5hcHBlbmQoYDxvcHRpb24gdmFsdWU9JyR7dGhlbWUubmFtZX0nPiR7dGhlbWUubmFtZS5yZXBsYWNlKC9fL2csIFwiIFwiKX08L29wdGlvbj5gKTtcbiAgICAgICAgfVxuICAgICAgICB0aGVtZUVsMS5zZWxlY3QyKHtcbiAgICAgICAgICAgIHdpZHRoOiBcIjEwMCVcIixcbiAgICAgICAgfSk7XG4gICAgICAgIHRoZW1lRWwyLnNlbGVjdDIoe1xuICAgICAgICAgICAgd2lkdGg6IFwiMTAwJVwiLFxuICAgICAgICB9KTtcbiAgICAgICAgJChgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5hdXRvU3dpdGNoVGhlbWVJbnB1dHMgc2VsZWN0LmxpZ2h0YClcbiAgICAgICAgICAgIC52YWwoY29uZmlnXzEuZGVmYXVsdC50aGVtZUxpZ2h0KVxuICAgICAgICAgICAgLnRyaWdnZXIoXCJjaGFuZ2Uuc2VsZWN0MlwiKTtcbiAgICAgICAgJChgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5hdXRvU3dpdGNoVGhlbWVJbnB1dHMgc2VsZWN0LmRhcmtgKVxuICAgICAgICAgICAgLnZhbChjb25maWdfMS5kZWZhdWx0LnRoZW1lRGFyaylcbiAgICAgICAgICAgIC50cmlnZ2VyKFwiY2hhbmdlLnNlbGVjdDJcIik7XG4gICAgICAgIGNvbnN0IGZ1bmJveEVsID0gJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZnVuYm94IC5idXR0b25zXCIpLmVtcHR5KCk7XG4gICAgICAgIGZ1bmJveEVsLmFwcGVuZChgPGRpdiBjbGFzcz1cImZ1bmJveCBidXR0b25cIiBmdW5ib3g9J25vbmUnPm5vbmU8L2Rpdj5gKTtcbiAgICAgICAgTWlzYy5nZXRGdW5ib3hMaXN0KCkudGhlbigoZnVuYm94TW9kZXMpID0+IHtcbiAgICAgICAgICAgIGZ1bmJveE1vZGVzLmZvckVhY2goKGZ1bmJveCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChmdW5ib3gubmFtZSA9PT0gXCJtaXJyb3JcIikge1xuICAgICAgICAgICAgICAgICAgICBmdW5ib3hFbC5hcHBlbmQoYDxkaXYgY2xhc3M9XCJmdW5ib3ggYnV0dG9uXCIgZnVuYm94PScke2Z1bmJveC5uYW1lfScgYXJpYS1sYWJlbD1cIiR7ZnVuYm94LmluZm99XCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCIgZGF0YS1iYWxsb29uLWxlbmd0aD1cImZpdFwiIHR5cGU9XCIke2Z1bmJveC50eXBlfVwiIHN0eWxlPVwidHJhbnNmb3JtOnNjYWxlWCgtMSk7XCI+JHtmdW5ib3gubmFtZS5yZXBsYWNlKC9fL2csIFwiIFwiKX08L2Rpdj5gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZ1bmJveEVsLmFwcGVuZChgPGRpdiBjbGFzcz1cImZ1bmJveCBidXR0b25cIiBmdW5ib3g9JyR7ZnVuYm94Lm5hbWV9JyBhcmlhLWxhYmVsPVwiJHtmdW5ib3guaW5mb31cIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIiBkYXRhLWJhbGxvb24tbGVuZ3RoPVwiZml0XCIgdHlwZT1cIiR7ZnVuYm94LnR5cGV9XCI+JHtmdW5ib3gubmFtZS5yZXBsYWNlKC9fL2csIFwiIFwiKX08L2Rpdj5gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGxldCBpc0N1c3RvbUZvbnQgPSB0cnVlO1xuICAgICAgICBjb25zdCBmb250c0VsID0gJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZm9udEZhbWlseSAuYnV0dG9uc1wiKS5lbXB0eSgpO1xuICAgICAgICBNaXNjLmdldEZvbnRzTGlzdCgpLnRoZW4oKGZvbnRzKSA9PiB7XG4gICAgICAgICAgICBmb250cy5mb3JFYWNoKChmb250KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZm9udEZhbWlseSA9PT0gZm9udC5uYW1lKVxuICAgICAgICAgICAgICAgICAgICBpc0N1c3RvbUZvbnQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBmb250c0VsLmFwcGVuZChgPGRpdiBjbGFzcz1cImJ1dHRvbiR7Y29uZmlnXzEuZGVmYXVsdC5mb250RmFtaWx5ID09PSBmb250Lm5hbWUgPyBcIiBhY3RpdmVcIiA6IFwiXCJ9XCIgc3R5bGU9XCJmb250LWZhbWlseToke2ZvbnQuZGlzcGxheSAhPT0gdW5kZWZpbmVkID8gZm9udC5kaXNwbGF5IDogZm9udC5uYW1lfVwiIGZvbnRGYW1pbHk9XCIke2ZvbnQubmFtZS5yZXBsYWNlKC8gL2csIFwiX1wiKX1cIiB0YWJpbmRleD1cIjBcIlxuICAgICAgICBvbmNsaWNrPVwidGhpcy5ibHVyKCk7XCI+JHtmb250LmRpc3BsYXkgIT09IHVuZGVmaW5lZCA/IGZvbnQuZGlzcGxheSA6IGZvbnQubmFtZX08L2Rpdj5gKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZm9udHNFbC5hcHBlbmQoaXNDdXN0b21Gb250XG4gICAgICAgICAgICAgICAgPyBgPGRpdiBjbGFzcz1cImJ1dHRvbiBuby1hdXRvLWhhbmRsZSBjdXN0b20gYWN0aXZlXCIgb25jbGljaz1cInRoaXMuYmx1cigpO1wiPkN1c3RvbSAoJHtjb25maWdfMS5kZWZhdWx0LmZvbnRGYW1pbHkucmVwbGFjZSgvXy9nLCBcIiBcIil9KTwvZGl2PmBcbiAgICAgICAgICAgICAgICA6ICc8ZGl2IGNsYXNzPVwiYnV0dG9uIG5vLWF1dG8taGFuZGxlIGN1c3RvbVwiIG9uY2xpY2s9XCJ0aGlzLmJsdXIoKTtcIj5DdXN0b208L2Rpdj4nKTtcbiAgICAgICAgfSk7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRTaXplIGlucHV0XCIpLnZhbChjb25maWdfMS5kZWZhdWx0LmN1c3RvbUJhY2tncm91bmQpO1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5jdXN0b21MYXlvdXRmbHVpZCBpbnB1dFwiKS52YWwoY29uZmlnXzEuZGVmYXVsdC5jdXN0b21MYXlvdXRmbHVpZC5yZXBsYWNlKC8jL2csIFwiIFwiKSk7XG4gICAgICAgIHNldEV2ZW50RGlzYWJsZWQodHJ1ZSk7XG4gICAgICAgIGlmICghZ3JvdXBzSW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIHlpZWxkIGluaXRHcm91cHMoKTtcbiAgICAgICAgICAgIGdyb3Vwc0luaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGV4cG9ydHMuZ3JvdXBzKS5mb3JFYWNoKChncm91cEtleSkgPT4ge1xuICAgICAgICAgICAgICAgIGV4cG9ydHMuZ3JvdXBzW2dyb3VwS2V5XS51cGRhdGVJbnB1dCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgc2V0RXZlbnREaXNhYmxlZChmYWxzZSk7XG4gICAgICAgIHlpZWxkIFRoZW1lUGlja2VyLnJlZnJlc2hCdXR0b25zKCk7XG4gICAgICAgIHlpZWxkIFVwZGF0ZUNvbmZpZy5sb2FkUHJvbWlzZTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZmlsbFNldHRpbmdzUGFnZSA9IGZpbGxTZXR0aW5nc1BhZ2U7XG4vLyBleHBvcnQgbGV0IHNldHRpbmdzRmlsbFByb21pc2UgPSBmaWxsU2V0dGluZ3NQYWdlKCk7XG5mdW5jdGlvbiBoaWRlQWNjb3VudFNlY3Rpb24oKSB7XG4gICAgJChgLnNlY3Rpb25Hcm91cFRpdGxlW2dyb3VwPSdhY2NvdW50J11gKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAkKGAuc2V0dGluZ3NHcm91cC5hY2NvdW50YCkuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgJChgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5uZWVkc0FjY291bnRgKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbn1cbmV4cG9ydHMuaGlkZUFjY291bnRTZWN0aW9uID0gaGlkZUFjY291bnRTZWN0aW9uO1xuZnVuY3Rpb24gdXBkYXRlRGlzY29yZFNlY3Rpb24oKSB7XG4gICAgLy9ubyBjb2RlIGFuZCBubyBkaXNjb3JkXG4gICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciA9PSBudWxsKSB7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmRpc2NvcmRJbnRlZ3JhdGlvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChEQi5nZXRTbmFwc2hvdCgpID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmRpc2NvcmRJbnRlZ3JhdGlvblwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgaWYgKERCLmdldFNuYXBzaG90KCkuZGlzY29yZElkID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgLy9zaG93IGJ1dHRvblxuICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZGlzY29yZEludGVncmF0aW9uIC5idXR0b25zXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZGlzY29yZEludGVncmF0aW9uIC5pbmZvXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZGlzY29yZEludGVncmF0aW9uIC5idXR0b25zXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZGlzY29yZEludGVncmF0aW9uIC5pbmZvXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy51cGRhdGVEaXNjb3JkU2VjdGlvbiA9IHVwZGF0ZURpc2NvcmRTZWN0aW9uO1xuZnVuY3Rpb24gdXBkYXRlQXV0aFNlY3Rpb25zKCkge1xuICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnBhc3N3b3JkQXV0aFNldHRpbmdzIC5idXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZ29vZ2xlQXV0aFNldHRpbmdzIC5idXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgY29uc3QgdXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICBpZiAoIXVzZXIpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBwYXNzd29yZFByb3ZpZGVyID0gdXNlci5wcm92aWRlckRhdGEuZmluZCgocHJvdmlkZXIpID0+IHByb3ZpZGVyLnByb3ZpZGVySWQgPT09IFwicGFzc3dvcmRcIik7XG4gICAgY29uc3QgZ29vZ2xlUHJvdmlkZXIgPSB1c2VyLnByb3ZpZGVyRGF0YS5maW5kKChwcm92aWRlcikgPT4gcHJvdmlkZXIucHJvdmlkZXJJZCA9PT0gXCJnb29nbGUuY29tXCIpO1xuICAgIGlmIChwYXNzd29yZFByb3ZpZGVyKSB7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnBhc3N3b3JkQXV0aFNldHRpbmdzICNlbWFpbFBhc3N3b3JkQXV0aFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ucGFzc3dvcmRBdXRoU2V0dGluZ3MgI3Bhc3NQYXNzd29yZEF1dGhcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5wYXNzd29yZEF1dGhTZXR0aW5ncyAjYWRkUGFzc3dvcmRBdXRoXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBpZiAoZ29vZ2xlUHJvdmlkZXIpIHtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZ29vZ2xlQXV0aFNldHRpbmdzICNyZW1vdmVHb29nbGVBdXRoXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICBpZiAocGFzc3dvcmRQcm92aWRlcikge1xuICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZ29vZ2xlQXV0aFNldHRpbmdzICNyZW1vdmVHb29nbGVBdXRoXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5nb29nbGVBdXRoU2V0dGluZ3MgI3JlbW92ZUdvb2dsZUF1dGhcIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZ29vZ2xlQXV0aFNldHRpbmdzICNhZGRHb29nbGVBdXRoXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbn1cbmV4cG9ydHMudXBkYXRlQXV0aFNlY3Rpb25zID0gdXBkYXRlQXV0aFNlY3Rpb25zO1xuZnVuY3Rpb24gc2V0QWN0aXZlRnVuYm94QnV0dG9uKCkge1xuICAgICQoYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZnVuYm94IC5idXR0b25gKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAkKGAucGFnZVNldHRpbmdzIC5zZWN0aW9uLmZ1bmJveCAuYnV0dG9uW2Z1bmJveD0nJHtjb25maWdfMS5kZWZhdWx0LmZ1bmJveH0nXWApLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xufVxuZnVuY3Rpb24gcmVmcmVzaFRhZ3NTZXR0aW5nc1NlY3Rpb24oKSB7XG4gICAgdmFyIF9hO1xuICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgIT09IG51bGwgJiYgREIuZ2V0U25hcHNob3QoKSAhPT0gbnVsbCkge1xuICAgICAgICBjb25zdCB0YWdzRWwgPSAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50YWdzIC50YWdzTGlzdFwiKS5lbXB0eSgpO1xuICAgICAgICAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgIC8vIGxldCB0YWdQYlN0cmluZyA9IFwiTm8gUEIgZm91bmRcIjtcbiAgICAgICAgICAgIC8vIGlmICh0YWcucGIgIT0gdW5kZWZpbmVkICYmIHRhZy5wYiA+IDApIHtcbiAgICAgICAgICAgIC8vICAgdGFnUGJTdHJpbmcgPSBgUEI6ICR7dGFnLnBifWA7XG4gICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICB0YWdzRWwuYXBwZW5kKGBcblxuICAgICAgPGRpdiBjbGFzcz1cImJ1dHRvbnMgdGFnXCIgaWQ9XCIke3RhZy5faWR9XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJidXR0b24gdGFnQnV0dG9uICR7dGFnLmFjdGl2ZSA/IFwiYWN0aXZlXCIgOiBcIlwifVwiIGFjdGl2ZT1cIiR7dGFnLmFjdGl2ZX1cIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidGl0bGVcIj4ke3RhZy5uYW1lfTwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNsZWFyUGJCdXR0b24gYnV0dG9uXCI+XG4gICAgICAgICAgPGkgY2xhc3M9XCJmYXMgZmEtY3Jvd24gZmEtZndcIj48L2k+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiZWRpdEJ1dHRvbiBidXR0b25cIj5cbiAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS1wZW4gZmEtZndcIj48L2k+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwicmVtb3ZlQnV0dG9uIGJ1dHRvblwiPlxuICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLXRyYXNoIGZhLWZ3XCI+PC9pPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuXG4gICAgICBgKTtcbiAgICAgICAgfSk7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRhZ3NcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50YWdzXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHJlZnJlc2hQcmVzZXRzU2V0dGluZ3NTZWN0aW9uKCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyICE9PSBudWxsICYmIERCLmdldFNuYXBzaG90KCkgIT09IG51bGwpIHtcbiAgICAgICAgY29uc3QgcHJlc2V0c0VsID0gJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ucHJlc2V0cyAucHJlc2V0c0xpc3RcIikuZW1wdHkoKTtcbiAgICAgICAgKF9hID0gREIuZ2V0U25hcHNob3QoKS5wcmVzZXRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgocHJlc2V0KSA9PiB7XG4gICAgICAgICAgICBwcmVzZXRzRWwuYXBwZW5kKGBcbiAgICAgIDxkaXYgY2xhc3M9XCJidXR0b25zIHByZXNldFwiIGlkPVwiJHtwcmVzZXQuX2lkfVwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYnV0dG9uIHByZXNldEJ1dHRvblwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0aXRsZVwiPiR7cHJlc2V0Lm5hbWV9PC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiZWRpdEJ1dHRvbiBidXR0b25cIj5cbiAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS1wZW4gZmEtZndcIj48L2k+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwicmVtb3ZlQnV0dG9uIGJ1dHRvblwiPlxuICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLXRyYXNoIGZhLWZ3XCI+PC9pPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICAgXG4gICAgICBgKTtcbiAgICAgICAgfSk7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnByZXNldHNcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5wcmVzZXRzXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHNob3dBY2NvdW50U2VjdGlvbigpIHtcbiAgICAkKGAuc2VjdGlvbkdyb3VwVGl0bGVbZ3JvdXA9J2FjY291bnQnXWApLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICQoYC5zZXR0aW5nc0dyb3VwLmFjY291bnRgKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAkKGAucGFnZVNldHRpbmdzIC5zZWN0aW9uLm5lZWRzQWNjb3VudGApLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIHJlZnJlc2hUYWdzU2V0dGluZ3NTZWN0aW9uKCk7XG4gICAgcmVmcmVzaFByZXNldHNTZXR0aW5nc1NlY3Rpb24oKTtcbiAgICB1cGRhdGVEaXNjb3JkU2VjdGlvbigpO1xufVxuZXhwb3J0cy5zaG93QWNjb3VudFNlY3Rpb24gPSBzaG93QWNjb3VudFNlY3Rpb247XG5mdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgT2JqZWN0LmtleXMoZXhwb3J0cy5ncm91cHMpLmZvckVhY2goKGdyb3VwKSA9PiB7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW2dyb3VwXS51cGRhdGVJbnB1dCgpO1xuICAgIH0pO1xuICAgIHJlZnJlc2hUYWdzU2V0dGluZ3NTZWN0aW9uKCk7XG4gICAgcmVmcmVzaFByZXNldHNTZXR0aW5nc1NlY3Rpb24oKTtcbiAgICAvLyBMYW5ndWFnZVBpY2tlci5zZXRBY3RpdmVHcm91cCgpOyBTaGlmdGVkIGZyb20gZ3JvdXBlZCBidG5zIHRvIGNvbWJvLWJveFxuICAgIHNldEFjdGl2ZUZ1bmJveEJ1dHRvbigpO1xuICAgIFRoZW1lUGlja2VyLnVwZGF0ZUFjdGl2ZVRhYih0cnVlKTtcbiAgICBUaGVtZVBpY2tlci5zZXRDdXN0b21JbnB1dHModHJ1ZSk7XG4gICAgdXBkYXRlRGlzY29yZFNlY3Rpb24oKTtcbiAgICB1cGRhdGVBdXRoU2VjdGlvbnMoKTtcbiAgICAvLyBUaGVtZVBpY2tlci51cGRhdGVBY3RpdmVCdXR0b24oKTtcbiAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5wYWNlQ2FyZXQgaW5wdXQuY3VzdG9tUGFjZUNhcmV0U3BlZWRcIikudmFsKGNvbmZpZ18xLmRlZmF1bHQucGFjZUNhcmV0Q3VzdG9tU3BlZWQpO1xuICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLm1pbldwbSBpbnB1dC5jdXN0b21NaW5XcG1TcGVlZFwiKS52YWwoY29uZmlnXzEuZGVmYXVsdC5taW5XcG1DdXN0b21TcGVlZCk7XG4gICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubWluQWNjIGlucHV0LmN1c3RvbU1pbkFjY1wiKS52YWwoY29uZmlnXzEuZGVmYXVsdC5taW5BY2NDdXN0b20pO1xuICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLm1pbkJ1cnN0IGlucHV0LmN1c3RvbU1pbkJ1cnN0XCIpLnZhbChjb25maWdfMS5kZWZhdWx0Lm1pbkJ1cnN0Q3VzdG9tU3BlZWQpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmF1dG9Td2l0Y2hUaGVtZSkge1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5hdXRvU3dpdGNoVGhlbWVJbnB1dHNcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5hdXRvU3dpdGNoVGhlbWVJbnB1dHNcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmN1c3RvbUJhY2tncm91bmQgIT09IFwiXCIpIHtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlclwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxufVxuZXhwb3J0cy51cGRhdGUgPSB1cGRhdGU7XG5mdW5jdGlvbiB0b2dnbGVTZXR0aW5nc0dyb3VwKGdyb3VwTmFtZSkge1xuICAgICQoYC5wYWdlU2V0dGluZ3MgLnNldHRpbmdzR3JvdXAuJHtncm91cE5hbWV9YClcbiAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgLnNsaWRlVG9nZ2xlKDI1MClcbiAgICAgICAgLnRvZ2dsZUNsYXNzKFwic2xpZGV1cFwiKTtcbiAgICBpZiAoJChgLnBhZ2VTZXR0aW5ncyAuc2V0dGluZ3NHcm91cC4ke2dyb3VwTmFtZX1gKS5oYXNDbGFzcyhcInNsaWRldXBcIikpIHtcbiAgICAgICAgJChgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbkdyb3VwVGl0bGVbZ3JvdXA9JHtncm91cE5hbWV9XSAuZmFzYClcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBkZWc6IC05MCxcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgZHVyYXRpb246IDI1MCxcbiAgICAgICAgICAgIHN0ZXA6IGZ1bmN0aW9uIChub3cpIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogXCJyb3RhdGUoXCIgKyBub3cgKyBcImRlZylcIixcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbkdyb3VwVGl0bGVbZ3JvdXA9JHtncm91cE5hbWV9XSAuZmFzYClcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBkZWc6IDAsXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGR1cmF0aW9uOiAyNTAsXG4gICAgICAgICAgICBzdGVwOiBmdW5jdGlvbiAobm93KSB7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IFwicm90YXRlKFwiICsgbm93ICsgXCJkZWcpXCIsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9XG59XG4kKGRvY3VtZW50KS5vbihcImZvY3Vzb3V0XCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5wYWNlQ2FyZXQgaW5wdXQuY3VzdG9tUGFjZUNhcmV0U3BlZWRcIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWNlQ2FyZXRDdXN0b21TcGVlZChwYXJzZUludCgkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5wYWNlQ2FyZXQgaW5wdXQuY3VzdG9tUGFjZUNhcmV0U3BlZWRcIikudmFsKCkpKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ucGFjZUNhcmV0IC5idXR0b24uc2F2ZVwiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnNldFBhY2VDYXJldEN1c3RvbVNwZWVkKHBhcnNlSW50KCQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnBhY2VDYXJldCBpbnB1dC5jdXN0b21QYWNlQ2FyZXRTcGVlZFwiKS52YWwoKSkpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImZvY3Vzb3V0XCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5taW5XcG0gaW5wdXQuY3VzdG9tTWluV3BtU3BlZWRcIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRNaW5XcG1DdXN0b21TcGVlZChwYXJzZUludCgkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5taW5XcG0gaW5wdXQuY3VzdG9tTWluV3BtU3BlZWRcIikudmFsKCkpKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubWluV3BtIC5idXR0b24uc2F2ZVwiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnNldE1pbldwbUN1c3RvbVNwZWVkKHBhcnNlSW50KCQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLm1pbldwbSBpbnB1dC5jdXN0b21NaW5XcG1TcGVlZFwiKS52YWwoKSkpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImZvY3Vzb3V0XCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5taW5BY2MgaW5wdXQuY3VzdG9tTWluQWNjXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0TWluQWNjQ3VzdG9tKHBhcnNlSW50KCQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLm1pbkFjYyBpbnB1dC5jdXN0b21NaW5BY2NcIikudmFsKCkpKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubWluQWNjIC5idXR0b24uc2F2ZVwiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnNldE1pbkFjY0N1c3RvbShwYXJzZUludCgkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5taW5BY2MgaW5wdXQuY3VzdG9tTWluQWNjXCIpLnZhbCgpKSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiZm9jdXNvdXRcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLm1pbkJ1cnN0IGlucHV0LmN1c3RvbU1pbkJ1cnN0XCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0TWluQnVyc3RDdXN0b21TcGVlZChwYXJzZUludCgkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5taW5CdXJzdCBpbnB1dC5jdXN0b21NaW5CdXJzdFwiKS52YWwoKSkpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5taW5CdXJzdCAuYnV0dG9uLnNhdmVcIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRNaW5CdXJzdEN1c3RvbVNwZWVkKHBhcnNlSW50KCQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLm1pbkJ1cnN0IGlucHV0LmN1c3RvbU1pbkJ1cnN0XCIpLnZhbCgpKSk7XG59KTtcbi8vIENvbW1lbnRlZCBiZWNhdXNlIHN0YXJ0ZWQgdXNpbmcgY29tYm8tYm94IGZvciBjaG9vc2luZyBsYW5ndWFnZXMgaW5zdGVhZCBvZiBncm91cGVkIGJ1dHRvbnNcbi8vIGxhbmd1YWdlc1xuLy8gJChkb2N1bWVudCkub24oXG4vLyAgIFwiY2xpY2tcIixcbi8vICAgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmxhbmd1YWdlR3JvdXBzIC5idXR0b25cIixcbi8vICAgKGUpID0+IHtcbi8vICAgICBjb25zdCBncm91cCA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiZ3JvdXBcIik7XG4vLyAgICAgTGFuZ3VhZ2VQaWNrZXIuc2V0QWN0aXZlR3JvdXAoZ3JvdXAsIHRydWUpO1xuLy8gICB9XG4vLyApO1xuLy9mdW5ib3hcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmZ1bmJveCAuYnV0dG9uXCIsIChlKSA9PiB7XG4gICAgY29uc3QgZnVuYm94ID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJmdW5ib3hcIik7XG4gICAgY29uc3QgdHlwZSA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwidHlwZVwiKTtcbiAgICBGdW5ib3guc2V0RnVuYm94KGZ1bmJveCwgdHlwZSk7XG4gICAgc2V0QWN0aXZlRnVuYm94QnV0dG9uKCk7XG59KTtcbi8vdGFnc1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGFncyAudGFnc0xpc3QgLnRhZyAudGFnQnV0dG9uXCIsIChlKSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0O1xuICAgIGNvbnN0IHRhZ2lkID0gJCh0YXJnZXQpLnBhcmVudChcIi50YWdcIikuYXR0cihcImlkXCIpO1xuICAgIFRhZ0NvbnRyb2xsZXIudG9nZ2xlKHRhZ2lkKTtcbiAgICAkKHRhcmdldCkudG9nZ2xlQ2xhc3MoXCJhY3RpdmVcIik7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnByZXNldHMgLnByZXNldHNMaXN0IC5wcmVzZXQgLnByZXNldEJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIGNvbnN0IHRhcmdldCA9IGUuY3VycmVudFRhcmdldDtcbiAgICBjb25zdCBwcmVzZXRpZCA9ICQodGFyZ2V0KS5wYXJlbnQoXCIucHJlc2V0XCIpLmF0dHIoXCJpZFwiKTtcbiAgICBjb25zb2xlLmxvZyhcIkFwcGx5aW5nIFByZXNldFwiKTtcbiAgICBjb25maWdFdmVudERpc2FibGVkID0gdHJ1ZTtcbiAgICBQcmVzZXRDb250cm9sbGVyLmFwcGx5KHByZXNldGlkKTtcbiAgICBjb25maWdFdmVudERpc2FibGVkID0gZmFsc2U7XG4gICAgdXBkYXRlKCk7XG59KTtcbiQoXCIjaW1wb3J0U2V0dGluZ3NCdXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgSW1wb3J0RXhwb3J0U2V0dGluZ3NQb3B1cC5zaG93KFwiaW1wb3J0XCIpO1xufSk7XG4kKFwiI2V4cG9ydFNldHRpbmdzQnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGNvbmZpZ0pTT04gPSBKU09OLnN0cmluZ2lmeShjb25maWdfMS5kZWZhdWx0KTtcbiAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChjb25maWdKU09OKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJKU09OIENvcGllZCB0byBjbGlwYm9hcmRcIiwgMCk7XG4gICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICBJbXBvcnRFeHBvcnRTZXR0aW5nc1BvcHVwLnNob3coXCJleHBvcnRcIik7XG4gICAgfSk7XG59KTtcbiQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uR3JvdXBUaXRsZVwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgdG9nZ2xlU2V0dGluZ3NHcm91cCgkKGUuY3VycmVudFRhcmdldCkuYXR0cihcImdyb3VwXCIpKTtcbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uYXBlS2V5cyAjc2hvd0FwZUtleXNQb3B1cFwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBBcGVLZXlzUG9wdXAuc2hvdygpO1xufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kU2l6ZSAuaW5wdXRBbmRCdXR0b24gLnNhdmVcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbUJhY2tncm91bmQoJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZFNpemUgLmlucHV0QW5kQnV0dG9uIGlucHV0XCIpLnZhbCgpKTtcbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZFNpemUgLmlucHV0QW5kQnV0dG9uIGlucHV0XCIpLmtleXByZXNzKChlKSA9PiB7XG4gICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbUJhY2tncm91bmQoJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZFNpemUgLmlucHV0QW5kQnV0dG9uIGlucHV0XCIpLnZhbCgpKTtcbiAgICB9XG59KTtcbiQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmN1c3RvbUxheW91dGZsdWlkIC5pbnB1dEFuZEJ1dHRvbiAuc2F2ZVwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tTGF5b3V0Zmx1aWQoJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uY3VzdG9tTGF5b3V0Zmx1aWQgLmlucHV0QW5kQnV0dG9uIGlucHV0XCIpLnZhbCgpKS50aGVuKChib29sKSA9PiB7XG4gICAgICAgIGlmIChib29sKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkN1c3RvbSBsYXlvdXRmbHVpZCBzYXZlZFwiLCAxKTtcbiAgICAgICAgfVxuICAgIH0pO1xufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5jdXN0b21MYXlvdXRmbHVpZCAuaW5wdXRBbmRCdXR0b24gLmlucHV0XCIpLmtleXByZXNzKChlKSA9PiB7XG4gICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbUxheW91dGZsdWlkKCQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmN1c3RvbUxheW91dGZsdWlkIC5pbnB1dEFuZEJ1dHRvbiBpbnB1dFwiKS52YWwoKSkudGhlbigoYm9vbCkgPT4ge1xuICAgICAgICAgICAgaWYgKGJvb2wpIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkN1c3RvbSBsYXlvdXRmbHVpZCBzYXZlZFwiLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG4kKFwiLnF1aWNrTmF2IC5saW5rcyBhXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBjb25zdCBzZXR0aW5nc0dyb3VwID0gZS50YXJnZXQuaW5uZXJUZXh0O1xuICAgIGNvbnN0IGlzT3BlbiA9ICQoYC5wYWdlU2V0dGluZ3MgLnNldHRpbmdzR3JvdXAuJHtzZXR0aW5nc0dyb3VwfWApLmhhc0NsYXNzKFwic2xpZGV1cFwiKTtcbiAgICBpc09wZW4gJiYgdG9nZ2xlU2V0dGluZ3NHcm91cChzZXR0aW5nc0dyb3VwKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjaGFuZ2VcIiwgYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uYXV0b1N3aXRjaFRoZW1lSW5wdXRzIHNlbGVjdC5saWdodGAsIChlKSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0ID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgIGlmICh0YXJnZXQuaGFzQ2xhc3MoXCJkaXNhYmxlZFwiKSB8fCB0YXJnZXQuaGFzQ2xhc3MoXCJuby1hdXRvLWhhbmRsZVwiKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIFVwZGF0ZUNvbmZpZy5zZXRUaGVtZUxpZ2h0KHRhcmdldC52YWwoKSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2hhbmdlXCIsIGAucGFnZVNldHRpbmdzIC5zZWN0aW9uLmF1dG9Td2l0Y2hUaGVtZUlucHV0cyBzZWxlY3QuZGFya2AsIChlKSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0ID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgIGlmICh0YXJnZXQuaGFzQ2xhc3MoXCJkaXNhYmxlZFwiKSB8fCB0YXJnZXQuaGFzQ2xhc3MoXCJuby1hdXRvLWhhbmRsZVwiKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIFVwZGF0ZUNvbmZpZy5zZXRUaGVtZURhcmsodGFyZ2V0LnZhbCgpKTtcbn0pO1xubGV0IGNvbmZpZ0V2ZW50RGlzYWJsZWQgPSBmYWxzZTtcbmZ1bmN0aW9uIHNldEV2ZW50RGlzYWJsZWQodmFsdWUpIHtcbiAgICBjb25maWdFdmVudERpc2FibGVkID0gdmFsdWU7XG59XG5leHBvcnRzLnNldEV2ZW50RGlzYWJsZWQgPSBzZXRFdmVudERpc2FibGVkO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSkgPT4ge1xuICAgIGlmIChldmVudEtleSA9PT0gXCJmdWxsQ29uZmlnQ2hhbmdlXCIpXG4gICAgICAgIHNldEV2ZW50RGlzYWJsZWQodHJ1ZSk7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImZ1bGxDb25maWdDaGFuZ2VGaW5pc2hlZFwiKSB7XG4gICAgICAgIHNldEV2ZW50RGlzYWJsZWQoZmFsc2UpO1xuICAgIH1cbiAgICBpZiAoY29uZmlnRXZlbnREaXNhYmxlZCB8fCBldmVudEtleSA9PT0gXCJzYXZlVG9Mb2NhbFN0b3JhZ2VcIilcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09PSBcInNldHRpbmdzXCIgJiYgZXZlbnRLZXkgIT09IFwidGhlbWVcIikge1xuICAgICAgICB1cGRhdGUoKTtcbiAgICB9XG59KTtcbmV4cG9ydHMucGFnZSA9IG5ldyBwYWdlXzEuZGVmYXVsdChcInNldHRpbmdzXCIsICQoXCIucGFnZS5wYWdlU2V0dGluZ3NcIiksIFwiL3NldHRpbmdzXCIsICgpID0+IHtcbiAgICAvL1xufSwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgcmVzZXQoKTtcbn0pLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB5aWVsZCBmaWxsU2V0dGluZ3NQYWdlKCk7XG4gICAgdXBkYXRlKCk7XG59KSwgKCkgPT4ge1xuICAgIC8vXG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucGFnZSA9IHZvaWQgMDtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgVGVzdFN0YXRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3Qtc3RhdHNcIikpO1xuY29uc3QgVGVzdFVJID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtdWlcIikpO1xuY29uc3QgTWFudWFsUmVzdGFydCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9tYW51YWwtcmVzdGFydC10cmFja2VyXCIpKTtcbmNvbnN0IFRlc3RDb25maWcgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC1jb25maWdcIikpO1xuY29uc3QgVGVzdExvZ2ljID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtbG9naWNcIikpO1xuY29uc3QgRnVuYm94ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2Z1bmJveFwiKSk7XG5jb25zdCBwYWdlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vcGFnZVwiKSk7XG5leHBvcnRzLnBhZ2UgPSBuZXcgcGFnZV8xLmRlZmF1bHQoXCJ0ZXN0XCIsICQoXCIucGFnZS5wYWdlVGVzdFwiKSwgXCIvXCIsICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgRnVuYm94LmNsZWFyKCk7XG4gICAgVGVzdENvbmZpZy5oaWRlKCk7XG4gICAgJChcIiN3b3Jkc0lucHV0XCIpLmZvY3Vzb3V0KCk7XG59KSwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgLy9cbn0pLCAoKSA9PiB7XG4gICAgVGVzdENvbmZpZy5zaG93KCk7XG4gICAgVGVzdFN0YXRzLnJlc2V0SW5jb21wbGV0ZSgpO1xuICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgVGVzdExvZ2ljLnJlc3RhcnQodW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB0cnVlKTtcbiAgICBGdW5ib3guYWN0aXZhdGUoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3gpO1xufSwgKCkgPT4ge1xuICAgIFRlc3RVSS5mb2N1c1dvcmRzKCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2hvdyA9IGV4cG9ydHMuaGlkZSA9IHZvaWQgMDtcbmNvbnN0IGFwZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9hcGVcIikpO1xuY29uc3QgTG9hZGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sb2FkZXJcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBmb3JtYXRfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiZGF0ZS1mbnMvZm9ybWF0XCIpKTtcbmxldCBhcGVLZXlzID0ge307XG5mdW5jdGlvbiBnZXREYXRhKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5hcGVLZXlzLmdldCgpO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRXJyb3IgZ2V0dGluZyBhcGUga2V5czogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGFwZUtleXMgPSByZXNwb25zZS5kYXRhO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gcmVmcmVzaExpc3QoKSB7XG4gICAgY29uc3QgZGF0YSA9IGFwZUtleXM7XG4gICAgaWYgKCFkYXRhKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgdGFibGUgPSAkKFwiI2FwZUtleXNQb3B1cFdyYXBwZXIgdGFibGUgdGJvZHlcIik7XG4gICAgdGFibGUuZW1wdHkoKTtcbiAgICBjb25zdCBhcGVLZXlJZHMgPSBPYmplY3Qua2V5cyhkYXRhKTtcbiAgICBpZiAoYXBlS2V5SWRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB0YWJsZS5hcHBlbmQoXCI8dHI+PHRkIGNvbHNwYW49JzYnIHN0eWxlPSd0ZXh0LWFsaWduOiBjZW50ZXI7Jz5ObyBrZXlzIGZvdW5kPC90ZD48L3RyPlwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBhcGVLZXlJZHMuZm9yRWFjaCgoYXBlS2V5SWQpID0+IHtcbiAgICAgICAgY29uc3Qga2V5ID0gZGF0YVthcGVLZXlJZF07XG4gICAgICAgIHRhYmxlLmFwcGVuZChgXG4gICAgICA8dHIga2V5SWQ9XCIke2FwZUtleUlkfVwiPlxuICAgICAgICA8dGQ+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImljb24tYnV0dG9uXCI+XG4gICAgICAgICAgICAke2tleS5lbmFibGVkXG4gICAgICAgICAgICA/IGA8aSBjbGFzcz1cImZhcyBmYS1jaGVjay1zcXVhcmVcIj48L2k+YFxuICAgICAgICAgICAgOiBgPGkgY2xhc3M9XCJmYXIgZmEtZncgZmEtc3F1YXJlXCI+PC9pPmB9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvdGQ+XG4gICAgICAgIDx0ZD4ke2tleS5uYW1lfTwvdGQ+XG4gICAgICAgIDx0ZD4keygwLCBmb3JtYXRfMS5kZWZhdWx0KShuZXcgRGF0ZShrZXkuY3JlYXRlZE9uKSwgXCJkZCBNTU0geXl5eSBISDptbVwiKX08L3RkPlxuICAgICAgICA8dGQ+JHsoMCwgZm9ybWF0XzEuZGVmYXVsdCkobmV3IERhdGUoa2V5Lm1vZGlmaWVkT24pLCBcImRkIE1NTSB5eXl5IEhIOm1tXCIpfTwvdGQ+XG4gICAgICAgIDx0ZD4ke2tleS5sYXN0VXNlZE9uID09PSAtMVxuICAgICAgICAgICAgPyBcIi1cIlxuICAgICAgICAgICAgOiAoMCwgZm9ybWF0XzEuZGVmYXVsdCkobmV3IERhdGUoa2V5Lmxhc3RVc2VkT24pLCBcImRkIE1NTSB5eXl5IEhIOm1tXCIpfTwvdGQ+XG4gICAgICAgIDx0ZD5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwia2V5QnV0dG9uc1wiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImJ1dHRvbiBlZGl0XCI+XG4gICAgICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXBlblwiPjwvaT5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImJ1dHRvbiBkZWxldGVcIj5cbiAgICAgICAgICAgICAgPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtdHJhc2gtYWx0XCI+PC9pPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvdGQ+XG4gICAgICA8L3RyPlxuICAgIGApO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICBpZiAoISQoXCIjYXBlS2V5c1BvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI2FwZUtleXNQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI2FwZUtleXNQb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG4vL3Nob3cgdGhlIHBvcHVwXG5mdW5jdGlvbiBzaG93KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmICgkKFwiI2FwZUtleXNQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgICAgIHlpZWxkIGdldERhdGEoKTtcbiAgICAgICAgICAgIHJlZnJlc2hMaXN0KCk7XG4gICAgICAgICAgICAkKFwiI2FwZUtleXNQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICAgICAkKFwiI2FwZUtleXNQb3B1cCB0ZXh0YXJlYVwiKS50cmlnZ2VyKFwiZm9jdXNcIikuc2VsZWN0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbiQoXCIjYXBlS2V5c1BvcHVwV3JhcHBlclwiKS5vbihcIm1vdXNlZG93blwiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwiYXBlS2V5c1BvcHVwV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbiQoXCIjYXBlS2V5c1BvcHVwIC5nZW5lcmF0ZUFwZUtleVwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBoaWRlKCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjYXBlS2V5c1BvcHVwIHRhYmxlIC5rZXlCdXR0b25zIC5idXR0b25cIiwgKCkgPT4ge1xuICAgIGhpZGUoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNhcGVLZXlzUG9wdXAgdGFibGUgLmljb24tYnV0dG9uXCIsIChlKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBjb25zdCBrZXlJZCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoXCJ0clwiKS5hdHRyKFwia2V5SWRcIik7XG4gICAgY29uc3Qga2V5ID0gYXBlS2V5cyA9PT0gbnVsbCB8fCBhcGVLZXlzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhcGVLZXlzW2tleUlkXTtcbiAgICBpZiAoIWtleSB8fCAhYXBlS2V5cylcbiAgICAgICAgcmV0dXJuO1xuICAgIExvYWRlci5zaG93KCk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LmFwZUtleXMudXBkYXRlKGtleUlkLCB7IGVuYWJsZWQ6ICFrZXkuZW5hYmxlZCB9KTtcbiAgICBMb2FkZXIuaGlkZSgpO1xuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gdXBkYXRlIGtleTogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgfVxuICAgIGFwZUtleXNba2V5SWRdLmVuYWJsZWQgPSAha2V5LmVuYWJsZWQ7XG4gICAgcmVmcmVzaExpc3QoKTtcbiAgICBpZiAoa2V5LmVuYWJsZWQpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJLZXkgYWN0aXZlXCIsIDEpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJLZXkgaW5hY3RpdmVcIiwgMSk7XG4gICAgfVxufSkpO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIjY29udGFjdFBvcHVwQnV0dG9uXCIsICgpID0+IHtcbiAgICAkKFwiI2NvbnRhY3RQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMjUpO1xufSk7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIjY29udGFjdFBvcHVwV3JhcHBlclwiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwiY29udGFjdFBvcHVwV3JhcHBlclwiKSB7XG4gICAgICAgICQoXCIjY29udGFjdFBvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMCB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjY29udGFjdFBvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuY29uc3QgVXBkYXRlQ29uZmlnID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgTWFudWFsUmVzdGFydCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9tYW51YWwtcmVzdGFydC10cmFja2VyXCIpKTtcbmNvbnN0IFRlc3RMb2dpYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LWxvZ2ljXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuZnVuY3Rpb24gcGFyc2VJbnB1dChpbnB1dCkge1xuICAgIGNvbnN0IHJlID0gLygoLVxccyopP1xcZCsoXFwuXFxkKyk/XFxzKltobXNdPykvZztcbiAgICBjb25zdCBzZWNvbmRzID0gWy4uLmlucHV0LnRvTG93ZXJDYXNlKCkubWF0Y2hBbGwocmUpXVxuICAgICAgICAubWFwKChtYXRjaCkgPT4ge1xuICAgICAgICBjb25zdCBwYXJ0ID0gbWF0Y2hbMF07XG4gICAgICAgIGNvbnN0IGR1cmF0aW9uID0gcGFyc2VGbG9hdChwYXJ0LnJlcGxhY2UoL1xccysvZywgXCJcIikpO1xuICAgICAgICBpZiAocGFydC5pbmNsdWRlcyhcImhcIikpIHtcbiAgICAgICAgICAgIHJldHVybiAzNjAwICogZHVyYXRpb247XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocGFydC5pbmNsdWRlcyhcIm1cIikpIHtcbiAgICAgICAgICAgIHJldHVybiA2MCAqIGR1cmF0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGR1cmF0aW9uO1xuICAgICAgICB9XG4gICAgfSlcbiAgICAgICAgLnJlZHVjZSgodG90YWwsIGR1cikgPT4gdG90YWwgKyBkdXIsIDApO1xuICAgIHJldHVybiBNYXRoLmZsb29yKHNlY29uZHMpO1xufVxuZnVuY3Rpb24gZm9ybWF0KGR1cmF0aW9uKSB7XG4gICAgY29uc3QgaG91cnMgPSBNYXRoLmZsb29yKGR1cmF0aW9uIC8gMzYwMCk7XG4gICAgY29uc3QgbWludXRlcyA9IE1hdGguZmxvb3IoKGR1cmF0aW9uICUgMzYwMCkgLyA2MCk7XG4gICAgY29uc3Qgc2Vjb25kcyA9IChkdXJhdGlvbiAlIDM2MDApICUgNjA7XG4gICAgY29uc3QgdGltZSA9IFtdO1xuICAgIGlmIChob3VycyA+IDApIHtcbiAgICAgICAgdGltZS5wdXNoKGAke2hvdXJzfSBob3VyJHtob3VycyA9PT0gMSA/IFwiXCIgOiBcInNcIn1gKTtcbiAgICB9XG4gICAgaWYgKG1pbnV0ZXMgPiAwKSB7XG4gICAgICAgIHRpbWUucHVzaChgJHttaW51dGVzfSBtaW51dGUke21pbnV0ZXMgPT09IDEgPyBcIlwiIDogXCJzXCJ9YCk7XG4gICAgfVxuICAgIGlmIChzZWNvbmRzID4gMCkge1xuICAgICAgICB0aW1lLnB1c2goYCR7c2Vjb25kc30gc2Vjb25kJHtzZWNvbmRzID09PSAxID8gXCJcIiA6IFwic1wifWApO1xuICAgIH1cbiAgICBpZiAodGltZS5sZW5ndGggPT09IDMpIHtcbiAgICAgICAgcmV0dXJuIGAke3RpbWVbMF19LCAke3RpbWVbMV19IGFuZCAke3RpbWVbMl19YDtcbiAgICB9XG4gICAgZWxzZSBpZiAodGltZS5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgcmV0dXJuIGAke3RpbWVbMF19IGFuZCAke3RpbWVbMV19YDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBgJHt0aW1lWzBdfWA7XG4gICAgfVxufVxuZnVuY3Rpb24gcHJldmlld0R1cmF0aW9uKCkge1xuICAgIGNvbnN0IGlucHV0ID0gJChcIiNjdXN0b21UZXN0RHVyYXRpb25Qb3B1cCBpbnB1dFwiKS52YWwoKTtcbiAgICBjb25zdCBkdXJhdGlvbiA9IHBhcnNlSW5wdXQoaW5wdXQpO1xuICAgIGxldCBmb3JtYXR0ZWREdXJhdGlvbiA9IFwiXCI7XG4gICAgaWYgKGR1cmF0aW9uIDwgMCkge1xuICAgICAgICBmb3JtYXR0ZWREdXJhdGlvbiA9IFwiTkVHQVRJVkUgVElNRVwiO1xuICAgIH1cbiAgICBlbHNlIGlmIChkdXJhdGlvbiA9PSAwKSB7XG4gICAgICAgIGZvcm1hdHRlZER1cmF0aW9uID0gXCJJbmZpbml0ZSB0ZXN0XCI7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBmb3JtYXR0ZWREdXJhdGlvbiA9IFwiVG90YWwgdGltZTogXCIgKyBmb3JtYXQoZHVyYXRpb24pO1xuICAgIH1cbiAgICAkKFwiI2N1c3RvbVRlc3REdXJhdGlvblBvcHVwIC5wcmV2aWV3XCIpLnRleHQoZm9ybWF0dGVkRHVyYXRpb24pO1xufVxuZnVuY3Rpb24gc2hvdygpIHtcbiAgICBpZiAoJChcIiNjdXN0b21UZXN0RHVyYXRpb25Qb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNjdXN0b21UZXN0RHVyYXRpb25Qb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI2N1c3RvbVRlc3REdXJhdGlvblBvcHVwIGlucHV0XCIpLnRyaWdnZXIoXCJmb2N1c1wiKS5zZWxlY3QoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHByZXZpZXdEdXJhdGlvbigpO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgaWYgKCEkKFwiI2N1c3RvbVRlc3REdXJhdGlvblBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI2N1c3RvbVRlc3REdXJhdGlvblBvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjY3VzdG9tVGVzdER1cmF0aW9uUG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuZnVuY3Rpb24gYXBwbHkoKSB7XG4gICAgY29uc3QgdmFsID0gcGFyc2VJbnB1dCgkKFwiI2N1c3RvbVRlc3REdXJhdGlvblBvcHVwIGlucHV0XCIpLnZhbCgpKTtcbiAgICBpZiAodmFsICE9PSBudWxsICYmICFpc05hTih2YWwpICYmIHZhbCA+PSAwKSB7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lQ29uZmlnKHZhbCk7XG4gICAgICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgIGlmICh2YWwgPj0gMTgwMCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJTdGF5IHNhZmUgYW5kIHRha2UgYnJlYWtzIVwiLCAwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh2YWwgPT0gMCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJJbmZpbml0ZSB0aW1lISBNYWtlIHN1cmUgdG8gdXNlIEJhaWwgT3V0IGZyb20gdGhlIGNvbW1hbmQgbGluZSB0byBzYXZlIHlvdXIgcmVzdWx0LlwiLCAwLCA3KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDdXN0b20gdGltZSBtdXN0IGJlIGF0IGxlYXN0IDFcIiwgMCk7XG4gICAgfVxuICAgIGhpZGUoKTtcbn1cbiQoXCIjY3VzdG9tVGVzdER1cmF0aW9uUG9wdXBXcmFwcGVyXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcImN1c3RvbVRlc3REdXJhdGlvblBvcHVwV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbiQoXCIjY3VzdG9tVGVzdER1cmF0aW9uUG9wdXAgaW5wdXRcIikua2V5dXAoKGUpID0+IHtcbiAgICBwcmV2aWV3RHVyYXRpb24oKTtcbiAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICBhcHBseSgpO1xuICAgIH1cbn0pO1xuJChcIiNjdXN0b21UZXN0RHVyYXRpb25Qb3B1cCAuYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGFwcGx5KCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjdG9wIC5jb25maWcgLnRpbWUgLnRleHQtYnV0dG9uXCIsIChlKSA9PiB7XG4gICAgY29uc3QgbW9kZSA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwidGltZUNvbmZpZ1wiKTtcbiAgICBpZiAobW9kZSA9PSBcImN1c3RvbVwiKSB7XG4gICAgICAgIHNob3coKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwia2V5ZG93blwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiICYmXG4gICAgICAgICEkKFwiI2N1c3RvbVRlc3REdXJhdGlvblBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICBoaWRlKCk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5pc1Zpc2libGUgPSBleHBvcnRzLmhpZGUgPSBleHBvcnRzLnNob3cgPSB2b2lkIDA7XG5jb25zdCBDdXN0b21UZXh0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2N1c3RvbS10ZXh0XCIpKTtcbmNvbnN0IE1hbnVhbFJlc3RhcnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvbWFudWFsLXJlc3RhcnQtdHJhY2tlclwiKSk7XG5jb25zdCBUZXN0TG9naWMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC1sb2dpY1wiKSk7XG5jb25zdCBDaGFsbGVuZ2VDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9jaGFsbGVuZ2UtY29udHJvbGxlclwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IFdvcmRGaWx0ZXJQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi93b3JkLWZpbHRlci1wb3B1cFwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IFNhdmVkVGV4dHNQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9zYXZlZC10ZXh0cy1wb3B1cFwiKSk7XG5jb25zdCB3cmFwcGVyID0gXCIjY3VzdG9tVGV4dFBvcHVwV3JhcHBlclwiO1xuY29uc3QgcG9wdXAgPSBcIiNjdXN0b21UZXh0UG9wdXBcIjtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgaWYgKCQod3JhcHBlcikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgaWYgKCQoYCR7cG9wdXB9IC5jaGVja2JveCBpbnB1dGApLnByb3AoXCJjaGVja2VkXCIpKSB7XG4gICAgICAgICAgICAkKGAke3BvcHVwfSAuaW5wdXRzIC5yYW5kb21JbnB1dEZpZWxkc2ApLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChgJHtwb3B1cH0gLmlucHV0cyAucmFuZG9tSW5wdXRGaWVsZHNgKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICAkKHdyYXBwZXIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IG5ld3RleHQgPSBDdXN0b21UZXh0LnRleHQuam9pbihDdXN0b21UZXh0LmRlbGltaXRlcik7XG4gICAgICAgICAgICBuZXd0ZXh0ID0gbmV3dGV4dC5yZXBsYWNlKC9cXG4gL2csIFwiXFxuXCIpO1xuICAgICAgICAgICAgJChgJHtwb3B1cH0gdGV4dGFyZWFgKS52YWwobmV3dGV4dCk7XG4gICAgICAgICAgICAkKGAke3BvcHVwfSAud29yZGNvdW50IGlucHV0YCkudmFsKEN1c3RvbVRleHQud29yZCA9PT0gLTEgPyBcIlwiIDogQ3VzdG9tVGV4dC53b3JkKTtcbiAgICAgICAgICAgICQoYCR7cG9wdXB9IC50aW1lIGlucHV0YCkudmFsKEN1c3RvbVRleHQudGltZSA9PT0gLTEgPyBcIlwiIDogQ3VzdG9tVGV4dC50aW1lKTtcbiAgICAgICAgICAgICQoYCR7cG9wdXB9IHRleHRhcmVhYCkudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICQoYCR7cG9wdXB9IHRleHRhcmVhYCkudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgIH0sIDE1MCk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuJChgJHtwb3B1cH0gLmRlbGltaXRlckNoZWNrIGlucHV0YCkuY2hhbmdlKCgpID0+IHtcbiAgICBsZXQgZGVsaW1pdGVyO1xuICAgIGlmICgkKGAke3BvcHVwfSAuZGVsaW1pdGVyQ2hlY2sgaW5wdXRgKS5wcm9wKFwiY2hlY2tlZFwiKSkge1xuICAgICAgICBkZWxpbWl0ZXIgPSBcInxcIjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGRlbGltaXRlciA9IFwiIFwiO1xuICAgIH1cbiAgICBpZiAoJChgJHtwb3B1cH0gdGV4dGFyZWFgKS52YWwoKSAhPSBDdXN0b21UZXh0LnRleHQuam9pbihDdXN0b21UZXh0LmRlbGltaXRlcikpIHtcbiAgICAgICAgY29uc3QgY3VycmVudFRleHQgPSAkKGAke3BvcHVwfSB0ZXh0YXJlYWApLnZhbCgpO1xuICAgICAgICBjb25zdCBjdXJyZW50VGV4dFNwbGl0ID0gY3VycmVudFRleHQuc3BsaXQoQ3VzdG9tVGV4dC5kZWxpbWl0ZXIpO1xuICAgICAgICBsZXQgbmV3dGV4dCA9IGN1cnJlbnRUZXh0U3BsaXQuam9pbihkZWxpbWl0ZXIpO1xuICAgICAgICBuZXd0ZXh0ID0gbmV3dGV4dC5yZXBsYWNlKC9cXG4gL2csIFwiXFxuXCIpO1xuICAgICAgICAkKGAke3BvcHVwfSB0ZXh0YXJlYWApLnZhbChuZXd0ZXh0KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGxldCBuZXd0ZXh0ID0gQ3VzdG9tVGV4dC50ZXh0LmpvaW4oZGVsaW1pdGVyKTtcbiAgICAgICAgbmV3dGV4dCA9IG5ld3RleHQucmVwbGFjZSgvXFxuIC9nLCBcIlxcblwiKTtcbiAgICAgICAgJChgJHtwb3B1cH0gdGV4dGFyZWFgKS52YWwobmV3dGV4dCk7XG4gICAgfVxuICAgIEN1c3RvbVRleHQuc2V0RGVsaW1pdGVyKGRlbGltaXRlcik7XG59KTtcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgaWYgKCEkKHdyYXBwZXIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQod3JhcHBlcilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKHdyYXBwZXIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuZnVuY3Rpb24gaXNWaXNpYmxlKCkge1xuICAgIHJldHVybiAhJCh3cmFwcGVyKS5oYXNDbGFzcyhcImhpZGRlblwiKTtcbn1cbmV4cG9ydHMuaXNWaXNpYmxlID0gaXNWaXNpYmxlO1xuJCh3cmFwcGVyKS5tb3VzZWRvd24oKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcImN1c3RvbVRleHRQb3B1cFdyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4kKGAke3BvcHVwfSAuaW5wdXRzIC5jaGVja2JveCBpbnB1dGApLmNoYW5nZSgoKSA9PiB7XG4gICAgaWYgKCQoYCR7cG9wdXB9IC5jaGVja2JveCBpbnB1dGApLnByb3AoXCJjaGVja2VkXCIpKSB7XG4gICAgICAgICQoYCR7cG9wdXB9IC5pbnB1dHMgLnJhbmRvbUlucHV0RmllbGRzYCkucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKGAke3BvcHVwfSAuaW5wdXRzIC5yYW5kb21JbnB1dEZpZWxkc2ApLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbn0pO1xuJChgJHtwb3B1cH0gdGV4dGFyZWFgKS5vbihcImtleXByZXNzXCIsIChlKSA9PiB7XG4gICAgaWYgKGUuY29kZSA9PT0gXCJFbnRlclwiICYmIGUuY3RybEtleSkge1xuICAgICAgICAkKGAke3BvcHVwfSAuYnV0dG9uLmFwcGx5YCkuY2xpY2soKTtcbiAgICB9XG59KTtcbiQoYCR7cG9wdXB9IC5yYW5kb21JbnB1dEZpZWxkcyAud29yZGNvdW50IGlucHV0YCkub24oXCJrZXlwcmVzc1wiLCAoKSA9PiB7XG4gICAgJChgJHtwb3B1cH0gLnJhbmRvbUlucHV0RmllbGRzIC50aW1lIGlucHV0YCkudmFsKFwiXCIpO1xufSk7XG4kKGAke3BvcHVwfSAucmFuZG9tSW5wdXRGaWVsZHMgLnRpbWUgaW5wdXRgKS5vbihcImtleXByZXNzXCIsICgpID0+IHtcbiAgICAkKGAke3BvcHVwfSAucmFuZG9tSW5wdXRGaWVsZHMgLndvcmRjb3VudCBpbnB1dGApLnZhbChcIlwiKTtcbn0pO1xuJChgJHtwb3B1cH0gLmJ1dHRvbnNUb3AgLnNob3dTYXZlZFRleHRzYCkub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgU2F2ZWRUZXh0c1BvcHVwLnNob3coKTtcbn0pO1xuJChgJHtwb3B1cH0gLmJ1dHRvbnNUb3AgLnNhdmVDdXN0b21UZXh0YCkub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgaGlkZSgpO1xufSk7XG5mdW5jdGlvbiBhcHBseSgpIHtcbiAgICBsZXQgdGV4dCA9ICQoYCR7cG9wdXB9IHRleHRhcmVhYCkudmFsKCkubm9ybWFsaXplKCk7XG4gICAgdGV4dCA9IHRleHQudHJpbSgpO1xuICAgIC8vIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1tcXHJdL2dtLCBcIiBcIik7XG4gICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFxcXFxcXFx0L2dtLCBcIlxcdFwiKTtcbiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXFxcXFxcXG4vZ20sIFwiXFxuXCIpO1xuICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcXFx0L2dtLCBcIlxcdFwiKTtcbiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXFxcbi9nbSwgXCJcXG5cIik7XG4gICAgdGV4dCA9IHRleHQucmVwbGFjZSgvICsvZ20sIFwiIFwiKTtcbiAgICAvLyB0ZXh0ID0gdGV4dC5yZXBsYWNlKC8oXFxyXFxuKSsvZywgXCJcXHJcXG5cIik7XG4gICAgLy8gdGV4dCA9IHRleHQucmVwbGFjZSgvKFxcbikrL2csIFwiXFxuXCIpO1xuICAgIC8vIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyhcXHIpKy9nLCBcIlxcclwiKTtcbiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC8oICooXFxyXFxufFxccnxcXG4pICopL2csIFwiXFxuIFwiKTtcbiAgICBpZiAoJChgJHtwb3B1cH0gLnR5cG9ncmFwaHlDaGVjayBpbnB1dGApLnByb3AoXCJjaGVja2VkXCIpKSB7XG4gICAgICAgIHRleHQgPSBNaXNjLmNsZWFuVHlwb2dyYXBoeVN5bWJvbHModGV4dCk7XG4gICAgfVxuICAgIC8vIHRleHQgPSBNaXNjLnJlbW92ZV9ub25fYXNjaWkodGV4dCk7XG4gICAgdGV4dCA9IHRleHQucmVwbGFjZSgvW1xcdTIwNjBdL2csIFwiXCIpO1xuICAgIEN1c3RvbVRleHQuc2V0VGV4dCh0ZXh0LnNwbGl0KEN1c3RvbVRleHQuZGVsaW1pdGVyKSk7XG4gICAgQ3VzdG9tVGV4dC5zZXRXb3JkKHBhcnNlSW50KCQoYCR7cG9wdXB9IC53b3JkY291bnQgaW5wdXRgKS52YWwoKSkgfHwgLTEpO1xuICAgIEN1c3RvbVRleHQuc2V0VGltZShwYXJzZUludCgkKGAke3BvcHVwfSAudGltZSBpbnB1dGApLnZhbCgpKSB8fCAtMSk7XG4gICAgQ3VzdG9tVGV4dC5zZXRJc1dvcmRSYW5kb20oJChgJHtwb3B1cH0gLmNoZWNrYm94IGlucHV0YCkucHJvcChcImNoZWNrZWRcIikgJiYgQ3VzdG9tVGV4dC53b3JkID4gLTEpO1xuICAgIEN1c3RvbVRleHQuc2V0SXNUaW1lUmFuZG9tKCQoYCR7cG9wdXB9IC5jaGVja2JveCBpbnB1dGApLnByb3AoXCJjaGVja2VkXCIpICYmIEN1c3RvbVRleHQudGltZSA+IC0xKTtcbiAgICBpZiAoJChgJHtwb3B1cH0gLmNoZWNrYm94IGlucHV0YCkucHJvcChcImNoZWNrZWRcIikgJiZcbiAgICAgICAgIUN1c3RvbVRleHQuaXNUaW1lUmFuZG9tICYmXG4gICAgICAgICFDdXN0b21UZXh0LmlzV29yZFJhbmRvbSkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIllvdSBuZWVkIHRvIHNwZWNpZnkgd29yZCBjb3VudCBvciB0aW1lIGluIHNlY29uZHMgdG8gc3RhcnQgYSByYW5kb20gY3VzdG9tIHRlc3QuXCIsIDAsIDUpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICgkKGAke3BvcHVwfSAuY2hlY2tib3ggaW5wdXRgKS5wcm9wKFwiY2hlY2tlZFwiKSAmJlxuICAgICAgICBDdXN0b21UZXh0LmlzVGltZVJhbmRvbSAmJlxuICAgICAgICBDdXN0b21UZXh0LmlzV29yZFJhbmRvbSkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIllvdSBuZWVkIHRvIHBpY2sgYmV0d2VlbiB3b3JkIGNvdW50IG9yIHRpbWUgaW4gc2Vjb25kcyB0byBzdGFydCBhIHJhbmRvbSBjdXN0b20gdGVzdC5cIiwgMCwgNSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKChDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJiBDdXN0b21UZXh0LndvcmQgPT09IDApIHx8XG4gICAgICAgIChDdXN0b21UZXh0LmlzVGltZVJhbmRvbSAmJiBDdXN0b21UZXh0LnRpbWUgPT09IDApKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiSW5maW5pdGUgd29yZHMhIE1ha2Ugc3VyZSB0byB1c2UgQmFpbCBPdXQgZnJvbSB0aGUgY29tbWFuZCBsaW5lIHRvIHNhdmUgeW91ciByZXN1bHQuXCIsIDAsIDcpO1xuICAgIH1cbiAgICBDaGFsbGVuZ2VDb250cm9sbGVyLmNsZWFyQWN0aXZlKCk7XG4gICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9PSBcImN1c3RvbVwiKVxuICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcImN1c3RvbVwiKTtcbiAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgIGhpZGUoKTtcbn1cbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgYCR7cG9wdXB9IC5idXR0b24uYXBwbHlgLCAoKSA9PiB7XG4gICAgYXBwbHkoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBgJHtwb3B1cH0gLndvcmRmaWx0ZXJgLCAoKSA9PiB7XG4gICAgV29yZEZpbHRlclBvcHVwLnNob3coKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0b3AgLmNvbmZpZyAuY3VzdG9tVGV4dCAudGV4dC1idXR0b25cIiwgKCkgPT4ge1xuICAgIHNob3coKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJrZXlkb3duXCIsIChldmVudCkgPT4ge1xuICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIgJiZcbiAgICAgICAgISQoXCIjY3VzdG9tVGV4dFBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICBoaWRlKCk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbi8vIGltcG9ydCBDb25maWcsICogYXMgVXBkYXRlQ29uZmlnIGZyb20gXCIuL2NvbmZpZ1wiO1xuLy8gaW1wb3J0ICogYXMgTm90aWZpY2F0aW9ucyBmcm9tIFwiLi9ub3RpZmljYXRpb25zXCI7XG4vLyBpbXBvcnQgKiBhcyBUaGVtZVBpY2tlciBmcm9tIFwiLi90aGVtZS1waWNrZXJcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmZ1bmN0aW9uIHNob3codmFsdWUpIHtcbiAgICBpZiAoJChcIiNjdXN0b21UaGVtZVNoYXJlV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAvLyBsZXQgc2F2ZSA9IFtdO1xuICAgICAgICAvLyAkLmVhY2goXG4gICAgICAgIC8vICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uY3VzdG9tVGhlbWUgW3R5cGU9J2NvbG9yJ11cIiksXG4gICAgICAgIC8vICAgKGluZGV4LCBlbGVtZW50KSA9PiB7XG4gICAgICAgIC8vICAgICBzYXZlLnB1c2goJChlbGVtZW50KS5hdHRyKFwidmFsdWVcIikpO1xuICAgICAgICAvLyAgIH1cbiAgICAgICAgLy8gKTtcbiAgICAgICAgLy8gJChcIiNjdXN0b21UaGVtZVNoYXJlV3JhcHBlciBpbnB1dFwiKS52YWwoSlNPTi5zdHJpbmdpZnkoc2F2ZSkpO1xuICAgICAgICAkKFwiI2N1c3RvbVRoZW1lU2hhcmVXcmFwcGVyIGlucHV0XCIpLnZhbCh2YWx1ZSk7XG4gICAgICAgICQoXCIjY3VzdG9tVGhlbWVTaGFyZVdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI2N1c3RvbVRoZW1lU2hhcmUgaW5wdXRcIikudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgICAgICAgICAgJChcIiNjdXN0b21UaGVtZVNoYXJlIGlucHV0XCIpLnNlbGVjdCgpO1xuICAgICAgICAgICAgJChcIiNjdXN0b21UaGVtZVNoYXJlIGlucHV0XCIpLnRyaWdnZXIoXCJmb2N1c1wiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgaWYgKCEkKFwiI2N1c3RvbVRoZW1lU2hhcmVXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIC8vIHRyeSB7XG4gICAgICAgIC8vICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lQ29sb3JzKFxuICAgICAgICAvLyAgICAgSlNPTi5wYXJzZSgkKFwiI2N1c3RvbVRoZW1lU2hhcmVXcmFwcGVyIGlucHV0XCIpLnZhbCgpKVxuICAgICAgICAvLyAgICk7XG4gICAgICAgIC8vIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gICBOb3RpZmljYXRpb25zLmFkZChcbiAgICAgICAgLy8gICAgIFwiU29tZXRoaW5nIHdlbnQgd3JvbmcuIFJldmVydGluZyB0byBkZWZhdWx0IGN1c3RvbSBjb2xvcnMuXCIsXG4gICAgICAgIC8vICAgICAwLFxuICAgICAgICAvLyAgICAgNFxuICAgICAgICAvLyAgICk7XG4gICAgICAgIC8vICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lQ29sb3JzKENvbmZpZy5kZWZhdWx0Q29uZmlnLmN1c3RvbVRoZW1lQ29sb3JzKTtcbiAgICAgICAgLy8gfVxuICAgICAgICAvLyBUaGVtZVBpY2tlci5zZXRDdXN0b21JbnB1dHMoKTtcbiAgICAgICAgJChcIiNjdXN0b21UaGVtZVNoYXJlV3JhcHBlciBpbnB1dFwiKS52YWwoXCJcIik7XG4gICAgICAgICQoXCIjY3VzdG9tVGhlbWVTaGFyZVdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI2N1c3RvbVRoZW1lU2hhcmVXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4kKFwiI2N1c3RvbVRoZW1lU2hhcmVXcmFwcGVyXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcImN1c3RvbVRoZW1lU2hhcmVXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuJChcIiNjdXN0b21UaGVtZVNoYXJlIC5idXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgaGlkZSgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuY29uc3QgVXBkYXRlQ29uZmlnID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgTWFudWFsUmVzdGFydCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9tYW51YWwtcmVzdGFydC10cmFja2VyXCIpKTtcbmNvbnN0IFRlc3RMb2dpYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LWxvZ2ljXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuZnVuY3Rpb24gc2hvdygpIHtcbiAgICBpZiAoJChcIiNjdXN0b21Xb3JkQW1vdW50UG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjY3VzdG9tV29yZEFtb3VudFBvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjY3VzdG9tV29yZEFtb3VudFBvcHVwIGlucHV0XCIpLnRyaWdnZXIoXCJmb2N1c1wiKS5zZWxlY3QoKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgaWYgKCEkKFwiI2N1c3RvbVdvcmRBbW91bnRQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNjdXN0b21Xb3JkQW1vdW50UG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNjdXN0b21Xb3JkQW1vdW50UG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuZnVuY3Rpb24gYXBwbHkoKSB7XG4gICAgY29uc3QgdmFsID0gcGFyc2VJbnQoJChcIiNjdXN0b21Xb3JkQW1vdW50UG9wdXAgaW5wdXRcIikudmFsKCkpO1xuICAgIGlmICh2YWwgIT09IG51bGwgJiYgIWlzTmFOKHZhbCkgJiYgdmFsID49IDApIHtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldFdvcmRDb3VudCh2YWwpO1xuICAgICAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICBpZiAodmFsID4gMjAwMCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJTdGF5IHNhZmUgYW5kIHRha2UgYnJlYWtzIVwiLCAwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh2YWwgPT0gMCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJJbmZpbml0ZSB3b3JkcyEgTWFrZSBzdXJlIHRvIHVzZSBCYWlsIE91dCBmcm9tIHRoZSBjb21tYW5kIGxpbmUgdG8gc2F2ZSB5b3VyIHJlc3VsdC5cIiwgMCwgNyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ3VzdG9tIHdvcmQgYW1vdW50IG11c3QgYmUgYXQgbGVhc3QgMVwiLCAwKTtcbiAgICB9XG4gICAgaGlkZSgpO1xufVxuJChcIiNjdXN0b21Xb3JkQW1vdW50UG9wdXBXcmFwcGVyXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcImN1c3RvbVdvcmRBbW91bnRQb3B1cFdyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4kKFwiI2N1c3RvbVdvcmRBbW91bnRQb3B1cCBpbnB1dFwiKS5vbihcImtleXByZXNzXCIsIChlKSA9PiB7XG4gICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgYXBwbHkoKTtcbiAgICB9XG59KTtcbiQoXCIjY3VzdG9tV29yZEFtb3VudFBvcHVwIC5idXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgYXBwbHkoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0b3AgLmNvbmZpZyAud29yZENvdW50IC50ZXh0LWJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIGNvbnN0IHdyZCA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwid29yZENvdW50XCIpO1xuICAgIGlmICh3cmQgPT0gXCJjdXN0b21cIikge1xuICAgICAgICBzaG93KCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50KS5vbihcImtleWRvd25cIiwgKGV2ZW50KSA9PiB7XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFc2NhcGVcIiAmJlxuICAgICAgICAhJChcIiNjdXN0b21Xb3JkQW1vdW50UG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmNvbnN0IGFwZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9hcGVcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IENvbmZpZyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IExvYWRlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbG9hZGVyXCIpKTtcbmNvbnN0IFNldHRpbmdzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wYWdlcy9zZXR0aW5nc1wiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmZ1bmN0aW9uIHNob3coYWN0aW9uLCBpZCwgbmFtZSkge1xuICAgIGlmIChhY3Rpb24gPT09IFwiYWRkXCIpIHtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0XCIpLmF0dHIoXCJhY3Rpb25cIiwgXCJhZGRcIik7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCAudGl0bGVcIikuaHRtbChcIkNyZWF0ZSBuZXcgcHJlc2V0XCIpO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgLmJ1dHRvblwiKS5odG1sKGA8aSBjbGFzcz1cImZhcyBmYS1wbHVzXCI+PC9pPmApO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgaW5wdXQudGV4dFwiKS52YWwoXCJcIik7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCBpbnB1dC50ZXh0XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgbGFiZWxcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGFjdGlvbiA9PT0gXCJlZGl0XCIgJiYgaWQgJiYgbmFtZSkge1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXRcIikuYXR0cihcImFjdGlvblwiLCBcImVkaXRcIik7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdFwiKS5hdHRyKFwicHJlc2V0aWRcIiwgaWQpO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgLnRpdGxlXCIpLmh0bWwoXCJFZGl0IHByZXNldFwiKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IC5idXR0b25cIikuaHRtbChgPGkgY2xhc3M9XCJmYXMgZmEtcGVuXCI+PC9pPmApO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgaW5wdXQudGV4dFwiKS52YWwobmFtZSk7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCBpbnB1dC50ZXh0XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgbGFiZWwgaW5wdXRcIikucHJvcChcImNoZWNrZWRcIiwgZmFsc2UpO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgbGFiZWxcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGFjdGlvbiA9PT0gXCJyZW1vdmVcIiAmJiBpZCkge1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXRcIikuYXR0cihcImFjdGlvblwiLCBcInJlbW92ZVwiKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0XCIpLmF0dHIoXCJwcmVzZXRpZFwiLCBpZCk7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCAudGl0bGVcIikuaHRtbChcIlJlbW92ZSBwcmVzZXQgXCIgKyBuYW1lKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IC5idXR0b25cIikuaHRtbChgPGkgY2xhc3M9XCJmYXMgZmEtY2hlY2tcIj48L2k+YCk7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCBpbnB1dC50ZXh0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgbGFiZWxcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGlmICgkKFwiI3ByZXNldFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IGlucHV0XCIpLnRyaWdnZXIoXCJmb2N1c1wiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgaWYgKCEkKFwiI3ByZXNldFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0XCIpLmF0dHIoXCJhY3Rpb25cIiwgXCJcIik7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdFwiKS5hdHRyKFwidGFnaWRcIiwgXCJcIik7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjcHJlc2V0V3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZnVuY3Rpb24gYXBwbHkoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgYWN0aW9uID0gJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0XCIpLmF0dHIoXCJhY3Rpb25cIik7XG4gICAgICAgIGNvbnN0IHByZXNldE5hbWUgPSAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgaW5wdXRcIikudmFsKCk7XG4gICAgICAgIGNvbnN0IHByZXNldElkID0gJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0XCIpLmF0dHIoXCJwcmVzZXRJZFwiKTtcbiAgICAgICAgY29uc3QgdXBkYXRlQ29uZmlnID0gJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IGxhYmVsIGlucHV0XCIpLnByb3AoXCJjaGVja2VkXCIpO1xuICAgICAgICBsZXQgY29uZmlnQ2hhbmdlcyA9IHt9O1xuICAgICAgICBpZiAoKHVwZGF0ZUNvbmZpZyAmJiBhY3Rpb24gPT09IFwiZWRpdFwiKSB8fCBhY3Rpb24gPT09IFwiYWRkXCIpIHtcbiAgICAgICAgICAgIGNvbmZpZ0NoYW5nZXMgPSBDb25maWcuZ2V0Q29uZmlnQ2hhbmdlcygpO1xuICAgICAgICAgICAgY29uc3QgdGFncyA9IERCLmdldFNuYXBzaG90KCkudGFncyB8fCBbXTtcbiAgICAgICAgICAgIGNvbnN0IGFjdGl2ZVRhZ0lkcyA9IHRhZ3NcbiAgICAgICAgICAgICAgICAuZmlsdGVyKCh0YWcpID0+IHRhZy5hY3RpdmUpXG4gICAgICAgICAgICAgICAgLm1hcCgodGFnKSA9PiB0YWcuX2lkKTtcbiAgICAgICAgICAgIGNvbmZpZ0NoYW5nZXMudGFncyA9IGFjdGl2ZVRhZ0lkcztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzbmFwc2hvdFByZXNldHMgPSBEQi5nZXRTbmFwc2hvdCgpLnByZXNldHMgfHwgW107XG4gICAgICAgIGhpZGUoKTtcbiAgICAgICAgTG9hZGVyLnNob3coKTtcbiAgICAgICAgaWYgKGFjdGlvbiA9PT0gXCJhZGRcIikge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnByZXNldHMuYWRkKHByZXNldE5hbWUsIGNvbmZpZ0NoYW5nZXMpO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gYWRkIHByZXNldDogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlByZXNldCBhZGRlZFwiLCAxLCAyKTtcbiAgICAgICAgICAgICAgICBzbmFwc2hvdFByZXNldHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHByZXNldE5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZzogY29uZmlnQ2hhbmdlcyxcbiAgICAgICAgICAgICAgICAgICAgX2lkOiByZXNwb25zZS5kYXRhLnByZXNldElkLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGFjdGlvbiA9PT0gXCJlZGl0XCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5wcmVzZXRzLmVkaXQocHJlc2V0SWQsIHByZXNldE5hbWUsIGNvbmZpZ0NoYW5nZXMpO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gZWRpdCBwcmVzZXQ6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJQcmVzZXQgdXBkYXRlZFwiLCAxKTtcbiAgICAgICAgICAgICAgICBjb25zdCBwcmVzZXQgPSBzbmFwc2hvdFByZXNldHMuZmlsdGVyKChwcmVzZXQpID0+IHByZXNldC5faWQgPT09IHByZXNldElkKVswXTtcbiAgICAgICAgICAgICAgICBwcmVzZXQubmFtZSA9IHByZXNldE5hbWU7XG4gICAgICAgICAgICAgICAgaWYgKHVwZGF0ZUNvbmZpZykge1xuICAgICAgICAgICAgICAgICAgICBwcmVzZXQuY29uZmlnID0gY29uZmlnQ2hhbmdlcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYWN0aW9uID09PSBcInJlbW92ZVwiKSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucHJlc2V0cy5kZWxldGUocHJlc2V0SWQpO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gcmVtb3ZlIHByZXNldDogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlByZXNldCByZW1vdmVkXCIsIDEpO1xuICAgICAgICAgICAgICAgIHNuYXBzaG90UHJlc2V0cy5mb3JFYWNoKChwcmVzZXQsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwcmVzZXQuX2lkID09PSBwcmVzZXRJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc25hcHNob3RQcmVzZXRzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBTZXR0aW5ncy51cGRhdGUoKTtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICB9KTtcbn1cbiQoXCIjcHJlc2V0V3JhcHBlclwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJwcmVzZXRXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IC5idXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgYXBwbHkoKTtcbn0pO1xuJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IGlucHV0XCIpLm9uKFwia2V5cHJlc3NcIiwgKGUpID0+IHtcbiAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICBhcHBseSgpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ucHJlc2V0cyAuYWRkUHJlc2V0QnV0dG9uXCIsICgpID0+IHtcbiAgICBzaG93KFwiYWRkXCIpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5wcmVzZXRzIC5lZGl0QnV0dG9uXCIsIChlKSA9PiB7XG4gICAgY29uc3QgcHJlc2V0aWQgPSAkKGUuY3VycmVudFRhcmdldCkucGFyZW50KFwiLnByZXNldFwiKS5hdHRyKFwiaWRcIik7XG4gICAgY29uc3QgbmFtZSA9ICQoZS5jdXJyZW50VGFyZ2V0KS5zaWJsaW5ncyhcIi5idXR0b25cIikuY2hpbGRyZW4oXCIudGl0bGVcIikudGV4dCgpO1xuICAgIHNob3coXCJlZGl0XCIsIHByZXNldGlkLCBuYW1lKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ucHJlc2V0cyAucmVtb3ZlQnV0dG9uXCIsIChlKSA9PiB7XG4gICAgY29uc3QgcHJlc2V0aWQgPSAkKGUuY3VycmVudFRhcmdldCkucGFyZW50KFwiLnByZXNldFwiKS5hdHRyKFwiaWRcIik7XG4gICAgY29uc3QgbmFtZSA9ICQoZS5jdXJyZW50VGFyZ2V0KS5zaWJsaW5ncyhcIi5idXR0b25cIikuY2hpbGRyZW4oXCIudGl0bGVcIikudGV4dCgpO1xuICAgIHNob3coXCJyZW1vdmVcIiwgcHJlc2V0aWQsIG5hbWUpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNob3cgPSB2b2lkIDA7XG5jb25zdCBhcGVfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vYXBlXCIpKTtcbmNvbnN0IFJlc3VsdEZpbHRlcnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2FjY291bnQvcmVzdWx0LWZpbHRlcnNcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgTG9hZGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sb2FkZXJcIikpO1xuY29uc3QgU2V0dGluZ3MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BhZ2VzL3NldHRpbmdzXCIpKTtcbmNvbnN0IFJlc3VsdFRhZ3NQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9yZXN1bHQtdGFncy1wb3B1cFwiKSk7XG5mdW5jdGlvbiBzaG93KGFjdGlvbiwgaWQsIG5hbWUpIHtcbiAgICBpZiAoYWN0aW9uID09PSBcImFkZFwiKSB7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0XCIpLmF0dHIoXCJhY3Rpb25cIiwgXCJhZGRcIik7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IC50aXRsZVwiKS5odG1sKFwiQWRkIG5ldyB0YWdcIik7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IC5idXR0b25cIikuaHRtbChgPGkgY2xhc3M9XCJmYXMgZmEtcGx1c1wiPjwvaT5gKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgaW5wdXRcIikudmFsKFwiXCIpO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCBpbnB1dFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoYWN0aW9uID09PSBcImVkaXRcIiAmJiBpZCAmJiBuYW1lKSB7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0XCIpLmF0dHIoXCJhY3Rpb25cIiwgXCJlZGl0XCIpO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdFwiKS5hdHRyKFwidGFnaWRcIiwgaWQpO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCAudGl0bGVcIikuaHRtbChcIkVkaXQgdGFnIG5hbWVcIik7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IC5idXR0b25cIikuaHRtbChgPGkgY2xhc3M9XCJmYXMgZmEtcGVuXCI+PC9pPmApO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCBpbnB1dFwiKS52YWwobmFtZSk7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IGlucHV0XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChhY3Rpb24gPT09IFwicmVtb3ZlXCIgJiYgaWQgJiYgbmFtZSkge1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdFwiKS5hdHRyKFwiYWN0aW9uXCIsIFwicmVtb3ZlXCIpO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdFwiKS5hdHRyKFwidGFnaWRcIiwgaWQpO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCAudGl0bGVcIikuaHRtbChcIlJlbW92ZSB0YWcgXCIgKyBuYW1lKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgLmJ1dHRvblwiKS5odG1sKGA8aSBjbGFzcz1cImZhcyBmYS1jaGVja1wiPjwvaT5gKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgaW5wdXRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGFjdGlvbiA9PT0gXCJjbGVhclBiXCIgJiYgaWQgJiYgbmFtZSkge1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdFwiKS5hdHRyKFwiYWN0aW9uXCIsIFwiY2xlYXJQYlwiKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXRcIikuYXR0cihcInRhZ2lkXCIsIGlkKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgLnRpdGxlXCIpLmh0bWwoXCJDbGVhciBQQiBmb3IgdGFnIFwiICsgbmFtZSk7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IC5idXR0b25cIikuaHRtbChgPGkgY2xhc3M9XCJmYXMgZmEtY2hlY2tcIj48L2k+YCk7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IGlucHV0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBpZiAoJChcIiN0YWdzV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgaW5wdXRcIikudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICBpZiAoISQoXCIjdGFnc1dyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXRcIikuYXR0cihcImFjdGlvblwiLCBcIlwiKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXRcIikuYXR0cihcInRhZ2lkXCIsIFwiXCIpO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiN0YWdzV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZnVuY3Rpb24gYXBwbHkoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IGFjdGlvbiA9ICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0XCIpLmF0dHIoXCJhY3Rpb25cIik7XG4gICAgICAgIGNvbnN0IHRhZ05hbWUgPSAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCBpbnB1dFwiKS52YWwoKTtcbiAgICAgICAgY29uc3QgdGFnSWQgPSAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdFwiKS5hdHRyKFwidGFnaWRcIik7XG4gICAgICAgIGhpZGUoKTtcbiAgICAgICAgTG9hZGVyLnNob3coKTtcbiAgICAgICAgaWYgKGFjdGlvbiA9PT0gXCJhZGRcIikge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmNyZWF0ZVRhZyh0YWdOYW1lKTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGFkZCB0YWc6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJUYWcgYWRkZWRcIiwgMSk7XG4gICAgICAgICAgICAgICAgKF9hID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHJlc3BvbnNlLmRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgX2lkOiByZXNwb25zZS5kYXRhLl9pZCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBSZXN1bHRUYWdzUG9wdXAudXBkYXRlQnV0dG9ucygpO1xuICAgICAgICAgICAgICAgIFNldHRpbmdzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIFJlc3VsdEZpbHRlcnMudXBkYXRlVGFncygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGFjdGlvbiA9PT0gXCJlZGl0XCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5lZGl0VGFnKHRhZ0lkLCB0YWdOYW1lKTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGVkaXQgdGFnOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiVGFnIHVwZGF0ZWRcIiwgMSk7XG4gICAgICAgICAgICAgICAgKF9iID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YWcuX2lkID09PSB0YWdJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFnLm5hbWUgPSB0YWdOYW1lO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgUmVzdWx0VGFnc1BvcHVwLnVwZGF0ZUJ1dHRvbnMoKTtcbiAgICAgICAgICAgICAgICBTZXR0aW5ncy51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICBSZXN1bHRGaWx0ZXJzLnVwZGF0ZVRhZ3MoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChhY3Rpb24gPT09IFwicmVtb3ZlXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5kZWxldGVUYWcodGFnSWQpO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gcmVtb3ZlIHRhZzogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlRhZyByZW1vdmVkXCIsIDEpO1xuICAgICAgICAgICAgICAgIChfYyA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmZvckVhY2goKHRhZywgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGFnLl9pZCA9PT0gdGFnSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIChfYSA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBSZXN1bHRUYWdzUG9wdXAudXBkYXRlQnV0dG9ucygpO1xuICAgICAgICAgICAgICAgIFNldHRpbmdzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIFJlc3VsdEZpbHRlcnMudXBkYXRlVGFncygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGFjdGlvbiA9PT0gXCJjbGVhclBiXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5kZWxldGVUYWdQZXJzb25hbEJlc3QodGFnSWQpO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gY2xlYXIgdGFnIHBiOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiVGFnIFBCIGNsZWFyZWRcIiwgMSk7XG4gICAgICAgICAgICAgICAgKF9kID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YWcuX2lkID09PSB0YWdJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFnLnBlcnNvbmFsQmVzdHMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZToge30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd29yZHM6IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbTogeyBjdXN0b206IFtdIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgemVuOiB7IHplbjogW10gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdW90ZTogeyBjdXN0b206IFtdIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgUmVzdWx0VGFnc1BvcHVwLnVwZGF0ZUJ1dHRvbnMoKTtcbiAgICAgICAgICAgICAgICBTZXR0aW5ncy51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICBSZXN1bHRGaWx0ZXJzLnVwZGF0ZVRhZ3MoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgIH0pO1xufVxuJChcIiN0YWdzV3JhcHBlclwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJ0YWdzV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbiQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IC5idXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgYXBwbHkoKTtcbn0pO1xuJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgaW5wdXRcIikub24oXCJrZXlwcmVzc1wiLCAoZSkgPT4ge1xuICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIGFwcGx5KCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50YWdzIC5hZGRUYWdCdXR0b25cIiwgKCkgPT4ge1xuICAgIHNob3coXCJhZGRcIik7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRhZ3MgLnRhZ3NMaXN0IC50YWcgLmVkaXRCdXR0b25cIiwgKGUpID0+IHtcbiAgICBjb25zdCB0YWdpZCA9ICQoZS5jdXJyZW50VGFyZ2V0KS5wYXJlbnQoXCIudGFnXCIpLmF0dHIoXCJpZFwiKTtcbiAgICBjb25zdCBuYW1lID0gJChlLmN1cnJlbnRUYXJnZXQpXG4gICAgICAgIC5zaWJsaW5ncyhcIi50YWdCdXR0b25cIilcbiAgICAgICAgLmNoaWxkcmVuKFwiLnRpdGxlXCIpXG4gICAgICAgIC50ZXh0KCk7XG4gICAgc2hvdyhcImVkaXRcIiwgdGFnaWQsIG5hbWUpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50YWdzIC50YWdzTGlzdCAudGFnIC5jbGVhclBiQnV0dG9uXCIsIChlKSA9PiB7XG4gICAgY29uc3QgdGFnaWQgPSAkKGUuY3VycmVudFRhcmdldCkucGFyZW50KFwiLnRhZ1wiKS5hdHRyKFwiaWRcIik7XG4gICAgY29uc3QgbmFtZSA9ICQoZS5jdXJyZW50VGFyZ2V0KVxuICAgICAgICAuc2libGluZ3MoXCIudGFnQnV0dG9uXCIpXG4gICAgICAgIC5jaGlsZHJlbihcIi50aXRsZVwiKVxuICAgICAgICAudGV4dCgpO1xuICAgIHNob3coXCJjbGVhclBiXCIsIHRhZ2lkLCBuYW1lKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGFncyAudGFnc0xpc3QgLnRhZyAucmVtb3ZlQnV0dG9uXCIsIChlKSA9PiB7XG4gICAgY29uc3QgdGFnaWQgPSAkKGUuY3VycmVudFRhcmdldCkucGFyZW50KFwiLnRhZ1wiKS5hdHRyKFwiaWRcIik7XG4gICAgY29uc3QgbmFtZSA9ICQoZS5jdXJyZW50VGFyZ2V0KVxuICAgICAgICAuc2libGluZ3MoXCIudGFnQnV0dG9uXCIpXG4gICAgICAgIC5jaGlsZHJlbihcIi50aXRsZVwiKVxuICAgICAgICAudGV4dCgpO1xuICAgIHNob3coXCJyZW1vdmVcIiwgdGFnaWQsIG5hbWUpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuY29uc3QgVXBkYXRlQ29uZmlnID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5mdW5jdGlvbiBzaG93KG1vZGUsIGNvbmZpZykge1xuICAgIGlmICgkKFwiI3NldHRpbmdzSW1wb3J0V3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI3NldHRpbmdzSW1wb3J0V3JhcHBlclwiKS5hdHRyKFwibW9kZVwiLCBtb2RlKTtcbiAgICAgICAgaWYgKG1vZGUgPT09IFwiZXhwb3J0XCIpIHtcbiAgICAgICAgICAgICQoXCIjc2V0dGluZ3NJbXBvcnRXcmFwcGVyIC5idXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiI3NldHRpbmdzSW1wb3J0V3JhcHBlciBpbnB1dFwiKS52YWwoY29uZmlnICE9PSBudWxsICYmIGNvbmZpZyAhPT0gdm9pZCAwID8gY29uZmlnIDogXCJcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobW9kZSA9PT0gXCJpbXBvcnRcIikge1xuICAgICAgICAgICAgJChcIiNzZXR0aW5nc0ltcG9ydFdyYXBwZXIgLmJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiI3NldHRpbmdzSW1wb3J0V3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjc2V0dGluZ3NJbXBvcnRXcmFwcGVyIGlucHV0XCIpLnRyaWdnZXIoXCJmb2N1c1wiKTtcbiAgICAgICAgICAgICQoXCIjc2V0dGluZ3NJbXBvcnRXcmFwcGVyIGlucHV0XCIpLnNlbGVjdCgpO1xuICAgICAgICAgICAgJChcIiNzZXR0aW5nc0ltcG9ydFdyYXBwZXIgaW5wdXRcIikudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICBpZiAoISQoXCIjc2V0dGluZ3NJbXBvcnRXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIGlmICgkKFwiI3NldHRpbmdzSW1wb3J0V3JhcHBlciBpbnB1dFwiKS52YWwoKSAhPT0gXCJcIikge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuYXBwbHkoSlNPTi5wYXJzZSgkKFwiI3NldHRpbmdzSW1wb3J0V3JhcHBlciBpbnB1dFwiKS52YWwoKSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkFuIGVycm9yIG9jY3VyZWQgd2hpbGUgaW1wb3J0aW5nIHNldHRpbmdzOiBcIiArIGUsIC0xKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zYXZlRnVsbENvbmZpZ1RvTG9jYWxTdG9yYWdlKCk7XG4gICAgICAgIH1cbiAgICAgICAgJChcIiNzZXR0aW5nc0ltcG9ydFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAwIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNzZXR0aW5nc0ltcG9ydFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiQoXCIjc2V0dGluZ3NJbXBvcnQgLmJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBoaWRlKCk7XG59KTtcbiQoXCIjc2V0dGluZ3NJbXBvcnRXcmFwcGVyXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcInNldHRpbmdzSW1wb3J0V3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZSA9IHZvaWQgMDtcbmNvbnN0IFRlc3RMb2dpYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LWxvZ2ljXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgVXBkYXRlQ29uZmlnID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgTWFudWFsUmVzdGFydCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9tYW51YWwtcmVzdGFydC10cmFja2VyXCIpKTtcbmNvbnN0IEN1c3RvbVdvcmRBbW91bnRQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jdXN0b20td29yZC1hbW91bnQtcG9wdXBcIikpO1xuY29uc3QgQ3VzdG9tVGVzdER1cmF0aW9uUG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY3VzdG9tLXRlc3QtZHVyYXRpb24tcG9wdXBcIikpO1xuY29uc3QgUXVvdGVTZWFyY2hQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9xdW90ZS1zZWFyY2gtcG9wdXBcIikpO1xuY29uc3QgQ3VzdG9tVGV4dFBvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2N1c3RvbS10ZXh0LXBvcHVwXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuY29uc3QgZWwgPSAkKFwiI21vYmlsZVRlc3RDb25maWdQb3B1cFwiKTtcbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICBlbC5maW5kKFwiLmJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICBlbC5maW5kKGAubW9kZUdyb3VwIC5idXR0b25bbW9kZT0nJHtjb25maWdfMS5kZWZhdWx0Lm1vZGV9J11gKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICBlbC5maW5kKFwiLnRpbWVHcm91cFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICBlbC5maW5kKFwiLndvcmRzR3JvdXBcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgZWwuZmluZChcIi5xdW90ZUdyb3VwXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIGVsLmZpbmQoXCIuY3VzdG9tR3JvdXBcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgZWwuZmluZChgLiR7Y29uZmlnXzEuZGVmYXVsdC5tb2RlfUdyb3VwYCkucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucHVuY3R1YXRpb24pIHtcbiAgICAgICAgZWwuZmluZChcIi5wdW5jdHVhdGlvblwiKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGVsLmZpbmQoXCIucHVuY3R1YXRpb25cIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm51bWJlcnMpIHtcbiAgICAgICAgZWwuZmluZChcIi5udW1iZXJzXCIpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZWwuZmluZChcIi5udW1iZXJzXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInRpbWVcIikge1xuICAgICAgICBlbC5maW5kKGAudGltZUdyb3VwIC5idXR0b25bdGltZT0nJHtjb25maWdfMS5kZWZhdWx0LnRpbWV9J11gKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgZWwuZmluZChcIi5wdW5jdHVhdGlvblwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICBlbC5maW5kKFwiLm51bWJlcnNcIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIpIHtcbiAgICAgICAgZWwuZmluZChgLndvcmRzR3JvdXAgLmJ1dHRvblt3b3Jkcz0nJHtjb25maWdfMS5kZWZhdWx0LndvcmRzfSddYCkuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgIGVsLmZpbmQoXCIucHVuY3R1YXRpb25cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgZWwuZmluZChcIi5udW1iZXJzXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgIGVsLmZpbmQoYC5xdW90ZUdyb3VwIC5idXR0b25bcXVvdGU9JyR7Y29uZmlnXzEuZGVmYXVsdC5xdW90ZUxlbmd0aH0nXWApLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICBlbC5maW5kKFwiLnB1bmN0dWF0aW9uXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIGVsLmZpbmQoXCIubnVtYmVyc1wiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiemVuXCIpIHtcbiAgICAgICAgZWwuZmluZChcIi5wdW5jdHVhdGlvblwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICBlbC5maW5kKFwiLm51bWJlcnNcIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiKSB7XG4gICAgICAgIGVsLmZpbmQoXCIucHVuY3R1YXRpb25cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgZWwuZmluZChcIi5udW1iZXJzXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgfVxufVxuZXhwb3J0cy51cGRhdGUgPSB1cGRhdGU7XG5mdW5jdGlvbiBzaG93UG9wdXAoKSB7XG4gICAgaWYgKCQoXCIjbW9iaWxlVGVzdENvbmZpZ1BvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICB1cGRhdGUoKTtcbiAgICAgICAgJChcIiNtb2JpbGVUZXN0Q29uZmlnUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEwMCk7XG4gICAgfVxufVxuZnVuY3Rpb24gaGlkZVBvcHVwKCkge1xuICAgIGlmICghJChcIiNtb2JpbGVUZXN0Q29uZmlnUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjbW9iaWxlVGVzdENvbmZpZ1BvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjbW9iaWxlVGVzdENvbmZpZ1BvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuJChcIiNtb2JpbGVUZXN0Q29uZmlnUG9wdXBXcmFwcGVyXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcIm1vYmlsZVRlc3RDb25maWdQb3B1cFdyYXBwZXJcIikge1xuICAgICAgICBoaWRlUG9wdXAoKTtcbiAgICB9XG59KTtcbiQoXCIjdG9wIC5tb2JpbGVDb25maWdcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgc2hvd1BvcHVwKCk7XG59KTtcbmVsLmZpbmQoXCIud29yZHNHcm91cCAuYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBjb25zdCB3cmQgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcIndvcmRzXCIpO1xuICAgIGlmICh3cmQgPT0gXCJjdXN0b21cIikge1xuICAgICAgICBoaWRlUG9wdXAoKTtcbiAgICAgICAgQ3VzdG9tV29yZEFtb3VudFBvcHVwLnNob3coKTtcbiAgICB9XG4gICAgZWxzZSBpZiAod3JkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29uc3Qgd3JkTnVtID0gcGFyc2VJbnQod3JkKTtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldFdvcmRDb3VudCh3cmROdW0pO1xuICAgICAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgIH1cbn0pO1xuZWwuZmluZChcIi50aW1lR3JvdXAgLmJ1dHRvblwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgY29uc3QgdGltZSA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwidGltZVwiKTtcbiAgICBpZiAodGltZSA9PSBcImN1c3RvbVwiKSB7XG4gICAgICAgIGhpZGVQb3B1cCgpO1xuICAgICAgICBDdXN0b21UZXN0RHVyYXRpb25Qb3B1cC5zaG93KCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHRpbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb25zdCB0aW1lTnVtID0gcGFyc2VJbnQodGltZSk7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lQ29uZmlnKHRpbWVOdW0pO1xuICAgICAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgIH1cbn0pO1xuZWwuZmluZChcIi5xdW90ZUdyb3VwIC5idXR0b25cIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBsZXQgbGVuID0gKChfYSA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwicXVvdGVcIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDApO1xuICAgIGlmIChsZW4gPT0gLTIpIHtcbiAgICAgICAgLy8gVXBkYXRlQ29uZmlnLnNldFF1b3RlTGVuZ3RoKC0yLCBmYWxzZSwgZS5zaGlmdEtleSk7XG4gICAgICAgIGhpZGVQb3B1cCgpO1xuICAgICAgICBRdW90ZVNlYXJjaFBvcHVwLnNob3coKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChsZW4gPT0gLTEpIHtcbiAgICAgICAgICAgIGxlbiA9IFswLCAxLCAyLCAzXTtcbiAgICAgICAgfVxuICAgICAgICBVcGRhdGVDb25maWcuc2V0UXVvdGVMZW5ndGgobGVuLCBmYWxzZSwgZS5zaGlmdEtleSk7XG4gICAgICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgfVxufSk7XG5lbC5maW5kKFwiLmN1c3RvbUNoYW5nZVwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBoaWRlUG9wdXAoKTtcbiAgICBDdXN0b21UZXh0UG9wdXAuc2hvdygpO1xufSk7XG5lbC5maW5kKFwiLnB1bmN0dWF0aW9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRQdW5jdHVhdGlvbighY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbik7XG4gICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICBUZXN0TG9naWMucmVzdGFydCgpO1xufSk7XG5lbC5maW5kKFwiLm51bWJlcnNcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnNldE51bWJlcnMoIWNvbmZpZ18xLmRlZmF1bHQubnVtYmVycyk7XG4gICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICBUZXN0TG9naWMucmVzdGFydCgpO1xufSk7XG5lbC5maW5kKFwiLm1vZGVHcm91cCAuYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLmN1cnJlbnRUYXJnZXQpLmhhc0NsYXNzKFwiYWN0aXZlXCIpKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgbW9kZSA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwibW9kZVwiKTtcbiAgICBVcGRhdGVDb25maWcuc2V0TW9kZShtb2RlKTtcbiAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG59KTtcbiQoXCIjbW9iaWxlVGVzdENvbmZpZ1BvcHVwIC5idXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgLy8gaGlkZVBvcHVwKCk7XG4gICAgdXBkYXRlKCk7XG59KTtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXkpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwibW9kZVwiKVxuICAgICAgICB1cGRhdGUoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBmb3JtYXRfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiZGF0ZS1mbnMvZm9ybWF0XCIpKTtcbmZ1bmN0aW9uIHVwZGF0ZShtb2RlKSB7XG4gICAgJChcIiNwYlRhYmxlc1BvcHVwIHRhYmxlIHRib2R5XCIpLmVtcHR5KCk7XG4gICAgJCgkKFwiI3BiVGFibGVzUG9wdXAgdGFibGUgdGhlYWQgdHIgdGRcIilbMF0pLnRleHQobW9kZSk7XG4gICAgY29uc3Qgc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdCgpO1xuICAgIGNvbnN0IGFsbG1vZGUyID0gKHNuYXBzaG90LnBlcnNvbmFsQmVzdHMgPT09IHVuZGVmaW5lZFxuICAgICAgICA/IHVuZGVmaW5lZFxuICAgICAgICA6IHNuYXBzaG90LnBlcnNvbmFsQmVzdHNbbW9kZV0pO1xuICAgIGlmIChhbGxtb2RlMiA9PT0gdW5kZWZpbmVkKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgbGlzdCA9IFtdO1xuICAgIE9iamVjdC5rZXlzKGFsbG1vZGUyKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgbGV0IHBicyA9IGFsbG1vZGUyW2tleV07XG4gICAgICAgIHBicyA9IHBicy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gYi53cG0gLSBhLndwbTtcbiAgICAgICAgICAgIC8vIGlmIChhLmRpZmZpY3VsdHkgPT09IGIuZGlmZmljdWx0eSkge1xuICAgICAgICAgICAgLy8gICByZXR1cm4gKGEubGFuZ3VhZ2UgPCBiLmxhbmd1YWdlID8gLTEgOiAxKTtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIC8vIHJldHVybiAoYS5kaWZmaWN1bHR5IDwgYi5kaWZmaWN1bHR5ID8gLTEgOiAxKVxuICAgICAgICB9KTtcbiAgICAgICAgcGJzLmZvckVhY2goZnVuY3Rpb24gKHBiKSB7XG4gICAgICAgICAgICBwYi5tb2RlMiA9IGtleTtcbiAgICAgICAgICAgIGxpc3QucHVzaChwYik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGxldCBtb2RlMm1lbW9yeTtcbiAgICBsaXN0LmZvckVhY2goKHBiKSA9PiB7XG4gICAgICAgIGxldCBkYXRlVGV4dCA9IGAtPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj5gO1xuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUocGIudGltZXN0YW1wKTtcbiAgICAgICAgaWYgKHBiLnRpbWVzdGFtcCkge1xuICAgICAgICAgICAgZGF0ZVRleHQgPVxuICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcImRkIE1NTSB5eXl5XCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8YnI+PGRpdiBjbGFzcz0nc3ViJz5cIiArXG4gICAgICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcIkhIOm1tXCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8L2Rpdj5cIjtcbiAgICAgICAgfVxuICAgICAgICAkKFwiI3BiVGFibGVzUG9wdXAgdGFibGUgdGJvZHlcIikuYXBwZW5kKGBcbiAgICAgIDx0cj5cbiAgICAgICAgPHRkPiR7bW9kZTJtZW1vcnkgPT09IHBiLm1vZGUyID8gXCJcIiA6IHBiLm1vZGUyfTwvdGQ+XG4gICAgICAgIDx0ZD5cbiAgICAgICAgICAke3BiLndwbX1cbiAgICAgICAgICA8YnIgLz5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cInN1YlwiPiR7cGIuYWNjID8gcGIuYWNjICsgXCIlXCIgOiBcIi1cIn08L3NwYW4+XG4gICAgICAgIDwvdGQ+XG4gICAgICAgIDx0ZD5cbiAgICAgICAgICAke3BiLnJhdyA/IHBiLnJhdyA6IFwiLVwifVxuICAgICAgICAgIDxiciAvPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYi5jb25zaXN0ZW5jeSA/IHBiLmNvbnNpc3RlbmN5ICsgXCIlXCIgOiBcIi1cIn08L3NwYW4+XG4gICAgICAgIDwvdGQ+XG4gICAgICAgIDx0ZD4ke3BiLmRpZmZpY3VsdHl9PC90ZD5cbiAgICAgICAgPHRkPiR7cGIubGFuZ3VhZ2UgPyBwYi5sYW5ndWFnZS5yZXBsYWNlKC9fL2csIFwiIFwiKSA6IFwiLVwifTwvdGQ+XG4gICAgICAgIDx0ZD4ke3BiLnB1bmN0dWF0aW9uID8gJzxpIGNsYXNzPVwiZmFzIGZhLWNoZWNrXCI+PC9pPicgOiBcIlwifTwvdGQ+XG4gICAgICAgIDx0ZD4ke3BiLmxhenlNb2RlID8gJzxpIGNsYXNzPVwiZmFzIGZhLWNoZWNrXCI+PC9pPicgOiBcIlwifTwvdGQ+XG4gICAgICAgIDx0ZD4ke2RhdGVUZXh0fTwvdGQ+XG4gICAgICA8L3RyPlxuICAgIGApO1xuICAgICAgICBtb2RlMm1lbW9yeSA9IHBiLm1vZGUyO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gc2hvdyhtb2RlKSB7XG4gICAgaWYgKCQoXCIjcGJUYWJsZXNQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgdXBkYXRlKG1vZGUpO1xuICAgICAgICAkKFwiI3BiVGFibGVzUG9wdXAgLnRpdGxlXCIpLnRleHQoYEFsbCAke21vZGV9IHBlcnNvbmFsIGJlc3RzYCk7XG4gICAgICAgICQoXCIjcGJUYWJsZXNQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTAwKTtcbiAgICB9XG59XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmICghJChcIiNwYlRhYmxlc1BvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI3BiVGFibGVzUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNwYlRhYmxlc1BvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIjcGJUYWJsZXNQb3B1cCB0YWJsZSB0Ym9keVwiKS5lbXB0eSgpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4kKFwiI3BiVGFibGVzUG9wdXBXcmFwcGVyXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcInBiVGFibGVzUG9wdXBXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuJChcIi5wYWdlQWNjb3VudCAuYnV0dG9uLnNob3dBbGxUaW1lUGJzXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHNob3coXCJ0aW1lXCIpO1xufSk7XG4kKFwiLnBhZ2VBY2NvdW50IC5idXR0b24uc2hvd0FsbFdvcmRzUGJzXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHNob3coXCJ3b3Jkc1wiKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuY29uc3QgYXBlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2FwZVwiKSk7XG5jb25zdCBMb2FkZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2xvYWRlclwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IGZvcm1hdF8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJkYXRlLWZucy9mb3JtYXRcIikpO1xubGV0IHF1b3RlcyA9IFtdO1xuZnVuY3Rpb24gdXBkYXRlTGlzdCgpIHtcbiAgICAkKFwiI3F1b3RlQXBwcm92ZVBvcHVwV3JhcHBlciAucXVvdGVzXCIpLmVtcHR5KCk7XG4gICAgcXVvdGVzLmZvckVhY2goKHF1b3RlLCBpbmRleCkgPT4ge1xuICAgICAgICBjb25zdCBxdW90ZUVsID0gJChgXG4gICAgICA8ZGl2IGNsYXNzPVwicXVvdGVcIiBpZD1cIiR7aW5kZXh9XCIgZGJpZD1cIiR7cXVvdGUuX2lkfVwiPlxuICAgICAgICA8dGV4dGFyZWEgY2xhc3M9XCJ0ZXh0XCI+JHtxdW90ZS50ZXh0fTwvdGV4dGFyZWE+XG4gICAgICAgIDxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwic291cmNlXCIgcGxhY2Vob2xkZXI9XCJTb3VyY2VcIiB2YWx1ZT1cIiR7cXVvdGUuc291cmNlfVwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYnV0dG9uc1wiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJpY29uLWJ1dHRvbiBkaXNhYmxlZCB1bmRvXCIgYXJpYS1sYWJlbD1cIlVuZG8gY2hhbmdlc1wiIGRhdGEtYmFsbG9vbi1wb3M9XCJsZWZ0XCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtdW5kby1hbHRcIj48L2k+PC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImljb24tYnV0dG9uIHJlZnVzZVwiIGFyaWEtbGFiZWw9XCJSZWZ1c2UgcXVvdGVcIiBkYXRhLWJhbGxvb24tcG9zPVwibGVmdFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXRpbWVzXCI+PC9pPjwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJpY29uLWJ1dHRvbiBhcHByb3ZlXCIgYXJpYS1sYWJlbD1cIkFwcHJvdmUgcXVvdGVcIiBkYXRhLWJhbGxvb24tcG9zPVwibGVmdFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWNoZWNrXCI+PC9pPjwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJpY29uLWJ1dHRvbiBlZGl0IGhpZGRlblwiIGFyaWEtbGFiZWw9XCJFZGl0IGFuZCBhcHByb3ZlIHF1b3RlXCIgZGF0YS1iYWxsb29uLXBvcz1cImxlZnRcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1wZW5cIj48L2k+PC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYm90dG9tXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImxlbmd0aCAke3F1b3RlLnRleHQubGVuZ3RoIDwgNjAgPyBcInJlZFwiIDogXCJcIn1cIj5RdW90ZSBsZW5ndGg6ICR7cXVvdGUudGV4dC5sZW5ndGh9PC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImxhbmd1YWdlXCI+TGFuZ3VhZ2U6ICR7cXVvdGUubGFuZ3VhZ2V9PC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cInRpbWVzdGFtcFwiPlN1Ym1pdHRlZCBvbjogJHsoMCwgZm9ybWF0XzEuZGVmYXVsdCkobmV3IERhdGUocXVvdGUudGltZXN0YW1wKSwgXCJkZCBNTU0geXl5eSBISDptbVwiKX08L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICBgKTtcbiAgICAgICAgJChcIiNxdW90ZUFwcHJvdmVQb3B1cFdyYXBwZXIgLnF1b3Rlc1wiKS5hcHBlbmQocXVvdGVFbCk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiB1cGRhdGVRdW90ZUxlbmd0aChpbmRleCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBsZW4gPSAoX2EgPSAkKGAjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlW2lkPSR7aW5kZXh9XSAudGV4dGApLnZhbCgpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoO1xuICAgICQoYCNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGVbaWQ9JHtpbmRleH1dIC5sZW5ndGhgKS50ZXh0KFwiUXVvdGUgbGVuZ3RoOiBcIiArIGxlbik7XG4gICAgaWYgKGxlbiA8IDYwKSB7XG4gICAgICAgICQoYCNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGVbaWQ9JHtpbmRleH1dIC5sZW5ndGhgKS5hZGRDbGFzcyhcInJlZFwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoYCNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGVbaWQ9JHtpbmRleH1dIC5sZW5ndGhgKS5yZW1vdmVDbGFzcyhcInJlZFwiKTtcbiAgICB9XG59XG5mdW5jdGlvbiBnZXRRdW90ZXMoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgTG9hZGVyLnNob3coKTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnF1b3Rlcy5nZXQoKTtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gZ2V0IG5ldyBxdW90ZXM6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIHF1b3RlcyA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIHVwZGF0ZUxpc3QoKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHNob3cobm9BbmltID0gZmFsc2UpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoJChcIiNxdW90ZUFwcHJvdmVQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgICAgIHF1b3RlcyA9IFtdO1xuICAgICAgICAgICAgZ2V0UXVvdGVzKCk7XG4gICAgICAgICAgICAkKFwiI3F1b3RlQXBwcm92ZVBvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgbm9BbmltID8gMCA6IDEwMCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmICghJChcIiNxdW90ZUFwcHJvdmVQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNxdW90ZUFwcHJvdmVQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3F1b3RlQXBwcm92ZVBvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIjcXVvdGVBcHByb3ZlUG9wdXBXcmFwcGVyIC5xdW90ZXNcIikuZW1wdHkoKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbmZ1bmN0aW9uIHJlc2V0QnV0dG9ucyh0YXJnZXQpIHtcbiAgICAkKHRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5maW5kKFwiLmljb24tYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgaWYgKCQodGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmZpbmQoXCIuZWRpdFwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKHRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5maW5kKFwiLnVuZG9cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICB9XG59XG4kKFwiI3F1b3RlQXBwcm92ZVBvcHVwV3JhcHBlclwiKS5vbihcIm1vdXNlZG93blwiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwicXVvdGVBcHByb3ZlUG9wdXBXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuJChcIiNxdW90ZUFwcHJvdmVQb3B1cFdyYXBwZXIgLmJ1dHRvbi5yZWZyZXNoTGlzdFwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICAkKFwiI3F1b3RlQXBwcm92ZVBvcHVwV3JhcHBlciAucXVvdGVzXCIpLmVtcHR5KCk7XG4gICAgZ2V0UXVvdGVzKCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlIC51bmRvXCIsIChlKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBjb25zdCBpbmRleCA9IHBhcnNlSW50KCQoZS50YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuYXR0cihcImlkXCIpKTtcbiAgICAkKGAjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlW2lkPSR7aW5kZXh9XSAudGV4dGApLnZhbChxdW90ZXNbaW5kZXhdLnRleHQpO1xuICAgICQoYCNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGVbaWQ9JHtpbmRleH1dIC5zb3VyY2VgKS52YWwocXVvdGVzW2luZGV4XS5zb3VyY2UpO1xuICAgICQoYCNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGVbaWQ9JHtpbmRleH1dIC51bmRvYCkuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAkKGAjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlW2lkPSR7aW5kZXh9XSAuYXBwcm92ZWApLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICQoYCNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGVbaWQ9JHtpbmRleH1dIC5lZGl0YCkuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgdXBkYXRlUXVvdGVMZW5ndGgoaW5kZXgpO1xufSkpO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGUgLmFwcHJvdmVcIiwgKGUpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAoIWNvbmZpcm0oXCJBcmUgeW91IHN1cmU/XCIpKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgaW5kZXggPSBwYXJzZUludCgkKGUudGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmF0dHIoXCJpZFwiKSk7XG4gICAgY29uc3QgZGJpZCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuYXR0cihcImRiaWRcIik7XG4gICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgJCh0YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuZmluZChcIi5pY29uLWJ1dHRvblwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICQodGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmZpbmQoXCJ0ZXh0YXJlYSwgaW5wdXRcIikucHJvcChcImRpc2FibGVkXCIsIHRydWUpO1xuICAgIExvYWRlci5zaG93KCk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnF1b3Rlcy5hcHByb3ZlU3VibWlzc2lvbihkYmlkKTtcbiAgICBMb2FkZXIuaGlkZSgpO1xuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICByZXNldEJ1dHRvbnModGFyZ2V0KTtcbiAgICAgICAgJCh0YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuZmluZChcInRleHRhcmVhLCBpbnB1dFwiKS5wcm9wKFwiZGlzYWJsZWRcIiwgZmFsc2UpO1xuICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gYXBwcm92ZSBxdW90ZTogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgfVxuICAgIE5vdGlmaWNhdGlvbnMuYWRkKChfYSA9IFwiUXVvdGUgYXBwcm92ZWQuIFwiICsgcmVzcG9uc2UubWVzc2FnZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCJcIiwgMSk7XG4gICAgcXVvdGVzLnNwbGljZShpbmRleCwgMSk7XG4gICAgdXBkYXRlTGlzdCgpO1xufSkpO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGUgLnJlZnVzZVwiLCAoZSkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgaWYgKCFjb25maXJtKFwiQXJlIHlvdSBzdXJlP1wiKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IGluZGV4ID0gcGFyc2VJbnQoJChlLnRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5hdHRyKFwiaWRcIikpO1xuICAgIGNvbnN0IGRiaWQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmF0dHIoXCJkYmlkXCIpO1xuICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xuICAgICQodGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmZpbmQoXCIuaWNvbi1idXR0b25cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAkKHRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5maW5kKFwidGV4dGFyZWEsIGlucHV0XCIpLnByb3AoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICBMb2FkZXIuc2hvdygpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5xdW90ZXMucmVqZWN0U3VibWlzc2lvbihkYmlkKTtcbiAgICBMb2FkZXIuaGlkZSgpO1xuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICByZXNldEJ1dHRvbnModGFyZ2V0KTtcbiAgICAgICAgJCh0YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuZmluZChcInRleHRhcmVhLCBpbnB1dFwiKS5wcm9wKFwiZGlzYWJsZWRcIiwgZmFsc2UpO1xuICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gcmVmdXNlIHF1b3RlOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICB9XG4gICAgTm90aWZpY2F0aW9ucy5hZGQoXCJRdW90ZSByZWZ1c2VkLlwiLCAxKTtcbiAgICBxdW90ZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB1cGRhdGVMaXN0KCk7XG59KSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZSAuZWRpdFwiLCAoZSkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdmFyIF9iO1xuICAgIGlmICghY29uZmlybShcIkFyZSB5b3Ugc3VyZT9cIikpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBpbmRleCA9IHBhcnNlSW50KCQoZS50YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuYXR0cihcImlkXCIpKTtcbiAgICBjb25zdCBkYmlkID0gJChlLnRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5hdHRyKFwiZGJpZFwiKTtcbiAgICBjb25zdCBlZGl0VGV4dCA9ICQoYCNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGVbaWQ9JHtpbmRleH1dIC50ZXh0YCkudmFsKCk7XG4gICAgY29uc3QgZWRpdFNvdXJjZSA9ICQoYCNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGVbaWQ9JHtpbmRleH1dIC5zb3VyY2VgKS52YWwoKTtcbiAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldDtcbiAgICAkKHRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5maW5kKFwiLmljb24tYnV0dG9uXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgJCh0YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuZmluZChcInRleHRhcmVhLCBpbnB1dFwiKS5wcm9wKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgTG9hZGVyLnNob3coKTtcbiAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucXVvdGVzLmFwcHJvdmVTdWJtaXNzaW9uKGRiaWQsIGVkaXRUZXh0LCBlZGl0U291cmNlKTtcbiAgICBMb2FkZXIuaGlkZSgpO1xuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICByZXNldEJ1dHRvbnModGFyZ2V0KTtcbiAgICAgICAgJCh0YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuZmluZChcInRleHRhcmVhLCBpbnB1dFwiKS5wcm9wKFwiZGlzYWJsZWRcIiwgZmFsc2UpO1xuICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gYXBwcm92ZSBxdW90ZTogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgfVxuICAgIE5vdGlmaWNhdGlvbnMuYWRkKChfYiA9IFwiUXVvdGUgZWRpdGVkIGFuZCBhcHByb3ZlZC4gXCIgKyByZXNwb25zZS5tZXNzYWdlKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBcIlwiLCAxKTtcbiAgICBxdW90ZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB1cGRhdGVMaXN0KCk7XG59KSk7XG4kKGRvY3VtZW50KS5vbihcImlucHV0XCIsIFwiI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZSAudGV4dFwiLCAoZSkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgY29uc3QgaW5kZXggPSBwYXJzZUludCgkKGUudGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmF0dHIoXCJpZFwiKSk7XG4gICAgJChgI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZVtpZD0ke2luZGV4fV0gLnVuZG9gKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICQoYCNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGVbaWQ9JHtpbmRleH1dIC5hcHByb3ZlYCkuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgJChgI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZVtpZD0ke2luZGV4fV0gLmVkaXRgKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB1cGRhdGVRdW90ZUxlbmd0aChpbmRleCk7XG59KSk7XG4kKGRvY3VtZW50KS5vbihcImlucHV0XCIsIFwiI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZSAuc291cmNlXCIsIChlKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBjb25zdCBpbmRleCA9IHBhcnNlSW50KCQoZS50YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuYXR0cihcImlkXCIpKTtcbiAgICAkKGAjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlW2lkPSR7aW5kZXh9XSAudW5kb2ApLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgJChgI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZVtpZD0ke2luZGV4fV0gLmFwcHJvdmVgKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAkKGAjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlW2lkPSR7aW5kZXh9XSAuZWRpdGApLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xufSkpO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5jbGVhclF1b3RlU3RhdHMgPSBleHBvcnRzLnNob3cgPSBleHBvcnRzLmdldFF1b3RlU3RhdHMgPSB2b2lkIDA7XG5jb25zdCBhcGVfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vYXBlXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBUZXN0V29yZHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC13b3Jkc1wiKSk7XG5jb25zdCBMb2FkZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2xvYWRlclwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmxldCByYXRpbmcgPSAwO1xubGV0IHF1b3RlU3RhdHMgPSBudWxsO1xubGV0IGN1cnJlbnRRdW90ZSA9IG51bGw7XG5mdW5jdGlvbiByZXNldCgpIHtcbiAgICAkKGAjcXVvdGVSYXRlUG9wdXAgLnF1b3RlIC50ZXh0YCkudGV4dChcIi1cIik7XG4gICAgJChgI3F1b3RlUmF0ZVBvcHVwIC5xdW90ZSAuc291cmNlIC52YWxgKS50ZXh0KFwiLVwiKTtcbiAgICAkKGAjcXVvdGVSYXRlUG9wdXAgLnF1b3RlIC5pZCAudmFsYCkudGV4dChcIi1cIik7XG4gICAgJChgI3F1b3RlUmF0ZVBvcHVwIC5xdW90ZSAubGVuZ3RoIC52YWxgKS50ZXh0KFwiLVwiKTtcbiAgICAkKFwiI3F1b3RlUmF0ZVBvcHVwIC5yYXRpbmdDb3VudCAudmFsXCIpLnRleHQoXCItXCIpO1xuICAgICQoXCIjcXVvdGVSYXRlUG9wdXAgLnJhdGluZ0F2ZXJhZ2UgLnZhbFwiKS50ZXh0KFwiLVwiKTtcbn1cbmZ1bmN0aW9uIGdldFJhdGluZ0F2ZXJhZ2UocXVvdGVTdGF0cykge1xuICAgIGlmICghcXVvdGVTdGF0cy50b3RhbFJhdGluZyB8fCAhcXVvdGVTdGF0cy5yYXRpbmdzKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICByZXR1cm4gTWF0aC5yb3VuZCgocXVvdGVTdGF0cy50b3RhbFJhdGluZyAvIHF1b3RlU3RhdHMucmF0aW5ncykgKiAxMCkgLyAxMDtcbn1cbmZ1bmN0aW9uIGdldFF1b3RlU3RhdHMocXVvdGUpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoIXF1b3RlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY3VycmVudFF1b3RlID0gcXVvdGU7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5xdW90ZXMuZ2V0UmF0aW5nKGN1cnJlbnRRdW90ZSk7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gZ2V0IHF1b3RlIHJhdGluZ3M6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghcmVzcG9uc2UuZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICB9XG4gICAgICAgIHF1b3RlU3RhdHMgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICBpZiAocXVvdGVTdGF0cyAmJiAhcXVvdGVTdGF0cy5hdmVyYWdlKSB7XG4gICAgICAgICAgICBxdW90ZVN0YXRzLmF2ZXJhZ2UgPSBnZXRSYXRpbmdBdmVyYWdlKHF1b3RlU3RhdHMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBxdW90ZVN0YXRzO1xuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRRdW90ZVN0YXRzID0gZ2V0UXVvdGVTdGF0cztcbmZ1bmN0aW9uIHJlZnJlc2hTdGFycyhmb3JjZSkge1xuICAgIGNvbnN0IGxpbWl0ID0gZm9yY2UgPyBmb3JjZSA6IHJhdGluZztcbiAgICAkKGAjcXVvdGVSYXRlUG9wdXAgLnN0YXJgKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBsaW1pdDsgaSsrKSB7XG4gICAgICAgICQoYCNxdW90ZVJhdGVQb3B1cCAuc3RhcltyYXRpbmc9JHtpfV1gKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICB9XG59XG5mdW5jdGlvbiB1cGRhdGVSYXRpbmdTdGF0cygpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoIXF1b3RlU3RhdHMpXG4gICAgICAgICAgICB5aWVsZCBnZXRRdW90ZVN0YXRzKCk7XG4gICAgICAgICQoXCIjcXVvdGVSYXRlUG9wdXAgLnJhdGluZ0NvdW50IC52YWxcIikudGV4dCgoX2EgPSBxdW90ZVN0YXRzID09PSBudWxsIHx8IHF1b3RlU3RhdHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHF1b3RlU3RhdHMucmF0aW5ncykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCIwXCIpO1xuICAgICAgICAkKFwiI3F1b3RlUmF0ZVBvcHVwIC5yYXRpbmdBdmVyYWdlIC52YWxcIikudGV4dCgoX2MgPSAoX2IgPSBxdW90ZVN0YXRzID09PSBudWxsIHx8IHF1b3RlU3RhdHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHF1b3RlU3RhdHMuYXZlcmFnZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnRvRml4ZWQoMSkpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IFwiLVwiKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZURhdGEoKSB7XG4gICAgaWYgKCFjdXJyZW50UXVvdGUpXG4gICAgICAgIHJldHVybjtcbiAgICBsZXQgbGVuZ3RoRGVzYztcbiAgICBpZiAoY3VycmVudFF1b3RlLmdyb3VwID09IDApIHtcbiAgICAgICAgbGVuZ3RoRGVzYyA9IFwic2hvcnRcIjtcbiAgICB9XG4gICAgZWxzZSBpZiAoY3VycmVudFF1b3RlLmdyb3VwID09IDEpIHtcbiAgICAgICAgbGVuZ3RoRGVzYyA9IFwibWVkaXVtXCI7XG4gICAgfVxuICAgIGVsc2UgaWYgKGN1cnJlbnRRdW90ZS5ncm91cCA9PSAyKSB7XG4gICAgICAgIGxlbmd0aERlc2MgPSBcImxvbmdcIjtcbiAgICB9XG4gICAgZWxzZSBpZiAoY3VycmVudFF1b3RlLmdyb3VwID09IDMpIHtcbiAgICAgICAgbGVuZ3RoRGVzYyA9IFwidGhpY2NcIjtcbiAgICB9XG4gICAgJChgI3F1b3RlUmF0ZVBvcHVwIC5xdW90ZSAudGV4dGApLnRleHQoY3VycmVudFF1b3RlLnRleHQpO1xuICAgICQoYCNxdW90ZVJhdGVQb3B1cCAucXVvdGUgLnNvdXJjZSAudmFsYCkudGV4dChjdXJyZW50UXVvdGUuc291cmNlKTtcbiAgICAkKGAjcXVvdGVSYXRlUG9wdXAgLnF1b3RlIC5pZCAudmFsYCkudGV4dChjdXJyZW50UXVvdGUuaWQpO1xuICAgICQoYCNxdW90ZVJhdGVQb3B1cCAucXVvdGUgLmxlbmd0aCAudmFsYCkudGV4dChsZW5ndGhEZXNjKTtcbiAgICB1cGRhdGVSYXRpbmdTdGF0cygpO1xufVxuZnVuY3Rpb24gc2hvdyhxdW90ZSwgc2hvdWxkUmVzZXQgPSB0cnVlKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBpZiAoJChcIiNxdW90ZVJhdGVQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgaWYgKHNob3VsZFJlc2V0KSB7XG4gICAgICAgICAgICByZXNldCgpO1xuICAgICAgICB9XG4gICAgICAgIGN1cnJlbnRRdW90ZSA9IHF1b3RlO1xuICAgICAgICByYXRpbmcgPSAwO1xuICAgICAgICBjb25zdCBzbmFwc2hvdCA9IERCLmdldFNuYXBzaG90KCk7XG4gICAgICAgIGNvbnN0IGFscmVhZHlSYXRlZCA9IChfYiA9IChfYSA9IHNuYXBzaG90ID09PSBudWxsIHx8IHNuYXBzaG90ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzbmFwc2hvdC5xdW90ZVJhdGluZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVtjdXJyZW50UXVvdGUubGFuZ3VhZ2VdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2JbY3VycmVudFF1b3RlLmlkXTtcbiAgICAgICAgaWYgKGFscmVhZHlSYXRlZCkge1xuICAgICAgICAgICAgcmF0aW5nID0gYWxyZWFkeVJhdGVkO1xuICAgICAgICB9XG4gICAgICAgIHJlZnJlc2hTdGFycygpO1xuICAgICAgICB1cGRhdGVEYXRhKCk7XG4gICAgICAgICQoXCIjcXVvdGVSYXRlUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEyNSk7XG4gICAgfVxufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgaWYgKCEkKFwiI3F1b3RlUmF0ZVBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI3F1b3RlUmF0ZVBvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjcXVvdGVSYXRlUG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5mdW5jdGlvbiBjbGVhclF1b3RlU3RhdHMoKSB7XG4gICAgcXVvdGVTdGF0cyA9IG51bGw7XG59XG5leHBvcnRzLmNsZWFyUXVvdGVTdGF0cyA9IGNsZWFyUXVvdGVTdGF0cztcbmZ1bmN0aW9uIHN1Ym1pdCgpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAocmF0aW5nID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJQbGVhc2Ugc2VsZWN0IGEgcmF0aW5nXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY3VycmVudFF1b3RlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaGlkZSgpO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucXVvdGVzLmFkZFJhdGluZyhjdXJyZW50UXVvdGUsIHJhdGluZyk7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHN1Ym1pdCBxdW90ZSByYXRpbmc6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNuYXBzaG90ID0gREIuZ2V0U25hcHNob3QoKTtcbiAgICAgICAgY29uc3QgcXVvdGVSYXRpbmdzID0gKF9hID0gc25hcHNob3QucXVvdGVSYXRpbmdzKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiB7fTtcbiAgICAgICAgaWYgKChfYiA9IHF1b3RlUmF0aW5ncyA9PT0gbnVsbCB8fCBxdW90ZVJhdGluZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHF1b3RlUmF0aW5nc1tjdXJyZW50UXVvdGUubGFuZ3VhZ2VdKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2JbY3VycmVudFF1b3RlLmlkXSkge1xuICAgICAgICAgICAgY29uc3Qgb2xkUmF0aW5nID0gcXVvdGVSYXRpbmdzW2N1cnJlbnRRdW90ZS5sYW5ndWFnZV1bY3VycmVudFF1b3RlLmlkXTtcbiAgICAgICAgICAgIGNvbnN0IGRpZmYgPSByYXRpbmcgLSBvbGRSYXRpbmc7XG4gICAgICAgICAgICBxdW90ZVJhdGluZ3NbY3VycmVudFF1b3RlLmxhbmd1YWdlXVtjdXJyZW50UXVvdGUuaWRdID0gcmF0aW5nO1xuICAgICAgICAgICAgcXVvdGVTdGF0cyA9IHtcbiAgICAgICAgICAgICAgICByYXRpbmdzOiBxdW90ZVN0YXRzID09PSBudWxsIHx8IHF1b3RlU3RhdHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHF1b3RlU3RhdHMucmF0aW5ncyxcbiAgICAgICAgICAgICAgICB0b3RhbFJhdGluZzogaXNOYU4ocXVvdGVTdGF0cyA9PT0gbnVsbCB8fCBxdW90ZVN0YXRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBxdW90ZVN0YXRzLnRvdGFsUmF0aW5nKVxuICAgICAgICAgICAgICAgICAgICA/IDBcbiAgICAgICAgICAgICAgICAgICAgOiAocXVvdGVTdGF0cyA9PT0gbnVsbCB8fCBxdW90ZVN0YXRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBxdW90ZVN0YXRzLnRvdGFsUmF0aW5nKSArIGRpZmYsXG4gICAgICAgICAgICAgICAgcXVvdGVJZDogY3VycmVudFF1b3RlLmlkLFxuICAgICAgICAgICAgICAgIGxhbmd1YWdlOiBjdXJyZW50UXVvdGUubGFuZ3VhZ2UsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJSYXRpbmcgdXBkYXRlZFwiLCAxKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICghcXVvdGVSYXRpbmdzW2N1cnJlbnRRdW90ZS5sYW5ndWFnZV0pIHtcbiAgICAgICAgICAgICAgICBxdW90ZVJhdGluZ3NbY3VycmVudFF1b3RlLmxhbmd1YWdlXSA9IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcXVvdGVSYXRpbmdzW2N1cnJlbnRRdW90ZS5sYW5ndWFnZV1bY3VycmVudFF1b3RlLmlkXSA9IHJhdGluZztcbiAgICAgICAgICAgIGlmICgocXVvdGVTdGF0cyA9PT0gbnVsbCB8fCBxdW90ZVN0YXRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBxdW90ZVN0YXRzLnJhdGluZ3MpICYmIHF1b3RlU3RhdHMudG90YWxSYXRpbmcpIHtcbiAgICAgICAgICAgICAgICBxdW90ZVN0YXRzLnJhdGluZ3MrKztcbiAgICAgICAgICAgICAgICBxdW90ZVN0YXRzLnRvdGFsUmF0aW5nICs9IHJhdGluZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHF1b3RlU3RhdHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIHJhdGluZ3M6IDEsXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsUmF0aW5nOiByYXRpbmcsXG4gICAgICAgICAgICAgICAgICAgIHF1b3RlSWQ6IGN1cnJlbnRRdW90ZS5pZCxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IGN1cnJlbnRRdW90ZS5sYW5ndWFnZSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJSYXRpbmcgc3VibWl0dGVkXCIsIDEpO1xuICAgICAgICB9XG4gICAgICAgIHNuYXBzaG90LnF1b3RlUmF0aW5ncyA9IHF1b3RlUmF0aW5ncztcbiAgICAgICAgREIuc2V0U25hcHNob3Qoc25hcHNob3QpO1xuICAgICAgICBxdW90ZVN0YXRzLmF2ZXJhZ2UgPSBnZXRSYXRpbmdBdmVyYWdlKHF1b3RlU3RhdHMpO1xuICAgICAgICAkKFwiLnBhZ2VUZXN0ICNyZXN1bHQgI3JhdGVRdW90ZUJ1dHRvbiAucmF0aW5nXCIpLnRleHQoKF9jID0gcXVvdGVTdGF0cy5hdmVyYWdlKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MudG9GaXhlZCgxKSk7XG4gICAgICAgICQoXCIucGFnZVRlc3QgI3Jlc3VsdCAjcmF0ZVF1b3RlQnV0dG9uIC5pY29uXCIpLnJlbW92ZUNsYXNzKFwiZmFyXCIpO1xuICAgICAgICAkKFwiLnBhZ2VUZXN0ICNyZXN1bHQgI3JhdGVRdW90ZUJ1dHRvbiAuaWNvblwiKS5hZGRDbGFzcyhcImZhc1wiKTtcbiAgICB9KTtcbn1cbiQoXCIjcXVvdGVSYXRlUG9wdXBXcmFwcGVyXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcInF1b3RlUmF0ZVBvcHVwV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbiQoXCIjcXVvdGVSYXRlUG9wdXAgLnN0YXJzIC5zdGFyXCIpLmhvdmVyKChlKSA9PiB7XG4gICAgY29uc3QgcmF0aW5nSG92ZXIgPSBwYXJzZUludCgkKGUuY3VycmVudFRhcmdldCkuYXR0cihcInJhdGluZ1wiKSk7XG4gICAgcmVmcmVzaFN0YXJzKHJhdGluZ0hvdmVyKTtcbn0pO1xuJChcIiNxdW90ZVJhdGVQb3B1cCAuc3RhcnMgLnN0YXJcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGNvbnN0IHJhdGluZ0hvdmVyID0gcGFyc2VJbnQoJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJyYXRpbmdcIikpO1xuICAgIHJhdGluZyA9IHJhdGluZ0hvdmVyO1xufSk7XG4kKFwiI3F1b3RlUmF0ZVBvcHVwIC5zdGFycyAuc3RhclwiKS5tb3VzZW91dCgoKSA9PiB7XG4gICAgJChgI3F1b3RlUmF0ZVBvcHVwIC5zdGFyYCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgcmVmcmVzaFN0YXJzKCk7XG59KTtcbiQoXCIjcXVvdGVSYXRlUG9wdXAgLnN1Ym1pdEJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBzdWJtaXQoKTtcbn0pO1xuJChcIi5wYWdlVGVzdCAjcmF0ZVF1b3RlQnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgLy8gVE9ETyByZW1vdmUgdGhpcyB3aGVuIGRvbmUgd2l0aCBUZXN0V29yZHNcbiAgICBzaG93KFRlc3RXb3Jkcy5yYW5kb21RdW90ZSk7XG59KSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmhpZGUgPSBleHBvcnRzLnNob3cgPSB2b2lkIDA7XG5jb25zdCBhcGVfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vYXBlXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgVGVzdFdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3Qtd29yZHNcIikpO1xuY29uc3QgTG9hZGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sb2FkZXJcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBxdW90ZXNfY29udHJvbGxlcl8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9xdW90ZXMtY29udHJvbGxlclwiKSk7XG5jb25zdCBDQVBUQ0hBX0lEID0gMTtcbmNvbnN0IHN0YXRlID0ge1xuICAgIHByZXZpb3VzUG9wdXBTaG93Q2FsbGJhY2s6IHVuZGVmaW5lZCxcbiAgICBxdW90ZVRvUmVwb3J0OiB1bmRlZmluZWQsXG59O1xuY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgcXVvdGVJZDogLTEsXG4gICAgcHJldmlvdXNQb3B1cFNob3dDYWxsYmFjazogKCkgPT4ge1xuICAgICAgICAvL1xuICAgIH0sXG4gICAgbm9BbmltOiBmYWxzZSxcbn07XG5mdW5jdGlvbiBzaG93KG9wdGlvbnMgPSBkZWZhdWx0T3B0aW9ucykge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoJChcIiNxdW90ZVJlcG9ydFBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAgICAgY29uc3QgeyBxdW90ZUlkLCBwcmV2aW91c1BvcHVwU2hvd0NhbGxiYWNrLCBub0FuaW0gfSA9IG9wdGlvbnM7XG4gICAgICAgICAgICBzdGF0ZS5wcmV2aW91c1BvcHVwU2hvd0NhbGxiYWNrID0gcHJldmlvdXNQb3B1cFNob3dDYWxsYmFjaztcbiAgICAgICAgICAgIGNvbnN0IHsgcXVvdGVzIH0gPSB5aWVsZCBxdW90ZXNfY29udHJvbGxlcl8xLmRlZmF1bHQuZ2V0UXVvdGVzKGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UpO1xuICAgICAgICAgICAgc3RhdGUucXVvdGVUb1JlcG9ydCA9IHF1b3Rlcy5maW5kKChxdW90ZSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBxdW90ZS5pZCA9PT0gcXVvdGVJZDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJChcIiNxdW90ZVJlcG9ydFBvcHVwIC5xdW90ZVwiKS50ZXh0KChfYSA9IHN0YXRlLnF1b3RlVG9SZXBvcnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50ZXh0KTtcbiAgICAgICAgICAgICQoXCIjcXVvdGVSZXBvcnRQb3B1cCAucmVhc29uXCIpLnZhbChcIkdyYW1tYXRpY2FsIGVycm9yXCIpO1xuICAgICAgICAgICAgJChcIiNxdW90ZVJlcG9ydFBvcHVwIC5jb21tZW50XCIpLnZhbChcIlwiKTtcbiAgICAgICAgICAgICQoXCIjcXVvdGVSZXBvcnRQb3B1cCAuY2hhcmFjdGVyQ291bnRcIikudGV4dChcIi1cIik7XG4gICAgICAgICAgICAkKFwiI3F1b3RlUmVwb3J0UG9wdXAgLnJlYXNvblwiKS5zZWxlY3QyKHtcbiAgICAgICAgICAgICAgICBtaW5pbXVtUmVzdWx0c0ZvclNlYXJjaDogSW5maW5pdHksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICQoXCIjcXVvdGVSZXBvcnRQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIG5vQW5pbSA/IDAgOiAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICAgICAkKFwiI3F1b3RlUmVwb3J0UG9wdXAgdGV4dGFyZWFcIikudHJpZ2dlcihcImZvY3VzXCIpLnNlbGVjdCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmICghJChcIiNxdW90ZVJlcG9ydFBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAgICAgY29uc3Qgbm9BbmltID0gc3RhdGUucHJldmlvdXNQb3B1cFNob3dDYWxsYmFjayA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgICQoXCIjcXVvdGVSZXBvcnRQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICB9LCBub0FuaW0gPyAwIDogMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZ3JlY2FwdGNoYS5yZXNldChDQVBUQ0hBX0lEKTtcbiAgICAgICAgICAgICAgICAkKFwiI3F1b3RlUmVwb3J0UG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5wcmV2aW91c1BvcHVwU2hvd0NhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlLnByZXZpb3VzUG9wdXBTaG93Q2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbmZ1bmN0aW9uIHN1Ym1pdFJlcG9ydCgpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgY2FwdGNoYVJlc3BvbnNlID0gZ3JlY2FwdGNoYS5nZXRSZXNwb25zZShDQVBUQ0hBX0lEKTtcbiAgICAgICAgaWYgKCFjYXB0Y2hhUmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIlBsZWFzZSBjb21wbGV0ZSB0aGUgY2FwdGNoYS5cIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcXVvdGVJZCA9IChfYSA9IHN0YXRlLnF1b3RlVG9SZXBvcnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pZC50b1N0cmluZygpO1xuICAgICAgICBjb25zdCBxdW90ZUxhbmd1YWdlID0gY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZTtcbiAgICAgICAgY29uc3QgcmVhc29uID0gJChcIiNxdW90ZVJlcG9ydFBvcHVwIC5yZWFzb25cIikudmFsKCk7XG4gICAgICAgIGNvbnN0IGNvbW1lbnQgPSAkKFwiI3F1b3RlUmVwb3J0UG9wdXAgLmNvbW1lbnRcIikudmFsKCk7XG4gICAgICAgIGNvbnN0IGNhcHRjaGEgPSBjYXB0Y2hhUmVzcG9uc2U7XG4gICAgICAgIGlmICghcXVvdGVJZCkge1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiUGxlYXNlIHNlbGVjdCBhIHF1b3RlLlwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXJlYXNvbikge1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiUGxlYXNlIHNlbGVjdCBhIHZhbGlkIHJlcG9ydCByZWFzb24uXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNoYXJhY3RlckRpZmZlcmVuY2UgPSBjb21tZW50Lmxlbmd0aCAtIDI1MDtcbiAgICAgICAgaWYgKGNoYXJhY3RlckRpZmZlcmVuY2UgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoYFJlcG9ydCBjb21tZW50IGlzICR7Y2hhcmFjdGVyRGlmZmVyZW5jZX0gY2hhcmFjdGVyKHMpIHRvbyBsb25nLmApO1xuICAgICAgICB9XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5xdW90ZXMucmVwb3J0KHF1b3RlSWQsIHF1b3RlTGFuZ3VhZ2UsIHJlYXNvbiwgY29tbWVudCwgY2FwdGNoYSk7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHJlcG9ydCBxdW90ZTogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJSZXBvcnQgc3VibWl0dGVkLiBUaGFuayB5b3UhXCIsIDEpO1xuICAgICAgICBoaWRlKCk7XG4gICAgfSk7XG59XG4kKFwiI3F1b3RlUmVwb3J0UG9wdXBXcmFwcGVyXCIpLm9uKFwibW91c2Vkb3duXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJxdW90ZVJlcG9ydFBvcHVwV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbiQoXCIjcXVvdGVSZXBvcnRQb3B1cCAuY29tbWVudFwiKS5vbihcImlucHV0XCIsICgpID0+IHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgY29uc3QgbGVuID0gJChcIiNxdW90ZVJlcG9ydFBvcHVwIC5jb21tZW50XCIpLnZhbCgpLmxlbmd0aDtcbiAgICAgICAgJChcIiNxdW90ZVJlcG9ydFBvcHVwIC5jaGFyYWN0ZXJDb3VudFwiKS50ZXh0KGxlbik7XG4gICAgICAgIGlmIChsZW4gPiAyNTApIHtcbiAgICAgICAgICAgICQoXCIjcXVvdGVSZXBvcnRQb3B1cCAuY2hhcmFjdGVyQ291bnRcIikuYWRkQ2xhc3MoXCJyZWRcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiI3F1b3RlUmVwb3J0UG9wdXAgLmNoYXJhY3RlckNvdW50XCIpLnJlbW92ZUNsYXNzKFwicmVkXCIpO1xuICAgICAgICB9XG4gICAgfSwgMSk7XG59KTtcbiQoXCIjcXVvdGVSZXBvcnRQb3B1cCAuc3VibWl0XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgeWllbGQgc3VibWl0UmVwb3J0KCk7XG59KSk7XG4kKFwiLnBhZ2VUZXN0ICNyZXBvcnRRdW90ZUJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHZhciBfYTtcbiAgICBzaG93KHtcbiAgICAgICAgcXVvdGVJZDogKF9hID0gVGVzdFdvcmRzLnJhbmRvbVF1b3RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaWQsXG4gICAgICAgIG5vQW5pbTogZmFsc2UsXG4gICAgfSk7XG59KSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmFwcGx5ID0gZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5zaG93ID0gZXhwb3J0cy5zZXRTZWxlY3RlZElkID0gZXhwb3J0cy5zZWxlY3RlZElkID0gdm9pZCAwO1xuY29uc3QgVGVzdFVJID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtdWlcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IE1hbnVhbFJlc3RhcnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvbWFudWFsLXJlc3RhcnQtdHJhY2tlclwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IFF1b3RlU3VibWl0UG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vcXVvdGUtc3VibWl0LXBvcHVwXCIpKTtcbmNvbnN0IFF1b3RlQXBwcm92ZVBvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3F1b3RlLWFwcHJvdmUtcG9wdXBcIikpO1xuY29uc3QgUXVvdGVSZXBvcnRQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9xdW90ZS1yZXBvcnQtcG9wdXBcIikpO1xuY29uc3Qgc2VhcmNoX3NlcnZpY2VfMSA9IHJlcXVpcmUoXCIuLi91dGlscy9zZWFyY2gtc2VydmljZVwiKTtcbmNvbnN0IGRlYm91bmNlXzEgPSByZXF1aXJlKFwiLi4vdXRpbHMvZGVib3VuY2VcIik7XG5jb25zdCBzdHJpbmdzXzEgPSByZXF1aXJlKFwiLi4vdXRpbHMvc3RyaW5nc1wiKTtcbmNvbnN0IHF1b3Rlc19jb250cm9sbGVyXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL3F1b3Rlcy1jb250cm9sbGVyXCIpKTtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi4vZmlyZWJhc2VcIik7XG5leHBvcnRzLnNlbGVjdGVkSWQgPSAxO1xuZnVuY3Rpb24gc2V0U2VsZWN0ZWRJZCh2YWwpIHtcbiAgICBleHBvcnRzLnNlbGVjdGVkSWQgPSB2YWw7XG59XG5leHBvcnRzLnNldFNlbGVjdGVkSWQgPSBzZXRTZWxlY3RlZElkO1xuY29uc3Qgc2VhcmNoU2VydmljZUNhY2hlID0ge307XG5mdW5jdGlvbiBnZXRTZWFyY2hTZXJ2aWNlKGxhbmd1YWdlLCBkYXRhLCB0ZXh0RXh0cmFjdG9yKSB7XG4gICAgaWYgKGxhbmd1YWdlIGluIHNlYXJjaFNlcnZpY2VDYWNoZSkge1xuICAgICAgICByZXR1cm4gc2VhcmNoU2VydmljZUNhY2hlW2xhbmd1YWdlXTtcbiAgICB9XG4gICAgY29uc3QgbmV3U2VhcmNoU2VydmljZSA9ICgwLCBzZWFyY2hfc2VydmljZV8xLmJ1aWxkU2VhcmNoU2VydmljZSkoZGF0YSwgdGV4dEV4dHJhY3Rvcik7XG4gICAgc2VhcmNoU2VydmljZUNhY2hlW2xhbmd1YWdlXSA9IG5ld1NlYXJjaFNlcnZpY2U7XG4gICAgcmV0dXJuIG5ld1NlYXJjaFNlcnZpY2U7XG59XG5mdW5jdGlvbiBoaWdobGlnaHRNYXRjaGVzKHRleHQsIG1hdGNoZWRUZXh0KSB7XG4gICAgaWYgKG1hdGNoZWRUZXh0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gdGV4dDtcbiAgICB9XG4gICAgY29uc3Qgd29yZHMgPSAoMCwgc3RyaW5nc18xLnNwbGl0QnlBbmRLZWVwKSh0ZXh0LCBgLixcIi8jISQlXiYqOzp7fT0tX1xcYH4oKSBgLnNwbGl0KFwiXCIpKTtcbiAgICBjb25zdCBub3JtYWxpemVkV29yZHMgPSB3b3Jkcy5tYXAoKHdvcmQpID0+IHtcbiAgICAgICAgY29uc3Qgc2hvdWxkSGlnaGxpZ2h0ID0gbWF0Y2hlZFRleHQuZmluZCgobWF0Y2gpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB3b3JkLnN0YXJ0c1dpdGgobWF0Y2gpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHNob3VsZEhpZ2hsaWdodCA/IGA8c3BhbiBjbGFzcz1cImhpZ2hsaWdodFwiPiR7d29yZH08L3NwYW4+YCA6IHdvcmQ7XG4gICAgfSk7XG4gICAgcmV0dXJuIG5vcm1hbGl6ZWRXb3Jkcy5qb2luKFwiXCIpO1xufVxuZnVuY3Rpb24gYXBwbHlRdW90ZUxlbmd0aEZpbHRlcihxdW90ZXMpIHtcbiAgICBjb25zdCBxdW90ZUxlbmd0aEZpbHRlclZhbHVlID0gJChcIiNxdW90ZVNlYXJjaFBvcHVwIC5xdW90ZUxlbmd0aEZpbHRlclwiKS52YWwoKTtcbiAgICBpZiAocXVvdGVMZW5ndGhGaWx0ZXJWYWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHF1b3RlcztcbiAgICB9XG4gICAgY29uc3QgcXVvdGVMZW5ndGhGaWx0ZXIgPSBxdW90ZUxlbmd0aEZpbHRlclZhbHVlLm1hcCgoZmlsdGVyVmFsdWUpID0+IHBhcnNlSW50KGZpbHRlclZhbHVlLCAxMCkpO1xuICAgIGNvbnN0IGZpbHRlcmVkUXVvdGVzID0gcXVvdGVzLmZpbHRlcigocXVvdGUpID0+IHF1b3RlTGVuZ3RoRmlsdGVyLmluY2x1ZGVzKHF1b3RlLmdyb3VwKSk7XG4gICAgcmV0dXJuIGZpbHRlcmVkUXVvdGVzO1xufVxuZnVuY3Rpb24gYnVpbGRRdW90ZVNlYXJjaFJlc3VsdChxdW90ZSwgbWF0Y2hlZFNlYXJjaFRlcm1zKSB7XG4gICAgbGV0IGxlbmd0aERlc2M7XG4gICAgaWYgKHF1b3RlLmxlbmd0aCA8IDEwMSkge1xuICAgICAgICBsZW5ndGhEZXNjID0gXCJzaG9ydFwiO1xuICAgIH1cbiAgICBlbHNlIGlmIChxdW90ZS5sZW5ndGggPCAzMDEpIHtcbiAgICAgICAgbGVuZ3RoRGVzYyA9IFwibWVkaXVtXCI7XG4gICAgfVxuICAgIGVsc2UgaWYgKHF1b3RlLmxlbmd0aCA8IDYwMSkge1xuICAgICAgICBsZW5ndGhEZXNjID0gXCJsb25nXCI7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBsZW5ndGhEZXNjID0gXCJ0aGljY1wiO1xuICAgIH1cbiAgICBjb25zdCBpc05vdEF1dGhlZCA9ICFmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgcmV0dXJuIGBcbiAgPGRpdiBjbGFzcz1cInNlYXJjaFJlc3VsdFwiIGlkPVwiJHtxdW90ZS5pZH1cIj5cbiAgICA8ZGl2IGNsYXNzPVwidGV4dFwiPlxuICAgICAgJHtoaWdobGlnaHRNYXRjaGVzKHF1b3RlLnRleHQsIG1hdGNoZWRTZWFyY2hUZXJtcyl9XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImlkXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwic3ViXCI+aWQ8L2Rpdj5cbiAgICAgIDxzcGFuIGNsYXNzPVwicXVvdGUtaWRcIj5cbiAgICAgICAgJHtoaWdobGlnaHRNYXRjaGVzKHF1b3RlLmlkLnRvU3RyaW5nKCksIG1hdGNoZWRTZWFyY2hUZXJtcyl9XG4gICAgICA8L3NwYW4+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImxlbmd0aFwiPlxuICAgICAgPGRpdiBjbGFzcz1cInN1YlwiPmxlbmd0aDwvZGl2PlxuICAgICAgJHtsZW5ndGhEZXNjfVxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJzb3VyY2VcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJzdWJcIj5zb3VyY2U8L2Rpdj5cbiAgICAgICR7aGlnaGxpZ2h0TWF0Y2hlcyhxdW90ZS5zb3VyY2UsIG1hdGNoZWRTZWFyY2hUZXJtcyl9PC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImljb24tYnV0dG9uIHJlcG9ydCAke2lzTm90QXV0aGVkICYmIFwiaGlkZGVuXCJ9XCIgYXJpYS1sYWJlbD1cIlJlcG9ydCBxdW90ZVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJsZWZ0XCI+XG4gICAgICA8aSBjbGFzcz1cImZhcyBmYS1mbGFnIHJlcG9ydFwiPjwvaT5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG4gIGA7XG59XG5mdW5jdGlvbiB1cGRhdGVSZXN1bHRzKHNlYXJjaFRleHQpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCB7IHF1b3RlcyB9ID0geWllbGQgcXVvdGVzX2NvbnRyb2xsZXJfMS5kZWZhdWx0LmdldFF1b3Rlcyhjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKTtcbiAgICAgICAgY29uc3QgcXVvdGVTZWFyY2hTZXJ2aWNlID0gZ2V0U2VhcmNoU2VydmljZShjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlLCBxdW90ZXMsIChxdW90ZSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGAke3F1b3RlLnRleHR9ICR7cXVvdGUuaWR9ICR7cXVvdGUuc291cmNlfWA7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCB7IHJlc3VsdHM6IG1hdGNoZXMsIG1hdGNoZWRRdWVyeVRlcm1zIH0gPSBxdW90ZVNlYXJjaFNlcnZpY2UucXVlcnkoc2VhcmNoVGV4dCk7XG4gICAgICAgIGNvbnN0IHF1b3Rlc1RvU2hvdyA9IGFwcGx5UXVvdGVMZW5ndGhGaWx0ZXIoc2VhcmNoVGV4dCA9PT0gXCJcIiA/IHF1b3RlcyA6IG1hdGNoZXMpO1xuICAgICAgICBjb25zdCByZXN1bHRzTGlzdCA9ICQoXCIjcXVvdGVTZWFyY2hSZXN1bHRzXCIpO1xuICAgICAgICByZXN1bHRzTGlzdC5lbXB0eSgpO1xuICAgICAgICBxdW90ZXNUb1Nob3cuc2xpY2UoMCwgMTAwKS5mb3JFYWNoKChxdW90ZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcXVvdGVTZWFyY2hSZXN1bHQgPSBidWlsZFF1b3RlU2VhcmNoUmVzdWx0KHF1b3RlLCBtYXRjaGVkUXVlcnlUZXJtcyk7XG4gICAgICAgICAgICByZXN1bHRzTGlzdC5hcHBlbmQocXVvdGVTZWFyY2hSZXN1bHQpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgcmVzdWx0c0V4Y2VlZGVkVGV4dCA9IHF1b3Rlc1RvU2hvdy5sZW5ndGggPiAxMDBcbiAgICAgICAgICAgID8gXCI8c3BhbiBzdHlsZT0nb3BhY2l0eTogMC41Jz4ob25seSBzaG93aW5nIDEwMCk8L3NwYW4+XCJcbiAgICAgICAgICAgIDogXCJcIjtcbiAgICAgICAgJChcIiNleHRyYVJlc3VsdHNcIikuaHRtbChgJHtxdW90ZXNUb1Nob3cubGVuZ3RofSByZXN1bHRzICR7cmVzdWx0c0V4Y2VlZGVkVGV4dH1gKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHNob3coY2xlYXJUZXh0ID0gdHJ1ZSkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoJChcIiNxdW90ZVNlYXJjaFBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAgICAgaWYgKGNsZWFyVGV4dCkge1xuICAgICAgICAgICAgICAgICQoXCIjcXVvdGVTZWFyY2hQb3B1cCBpbnB1dFwiKS52YWwoXCJcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBxdW90ZVNlYXJjaElucHV0VmFsdWUgPSAkKFwiI3F1b3RlU2VhcmNoUG9wdXAgaW5wdXRcIikudmFsKCk7XG4gICAgICAgICAgICBpZiAoIWZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcikge1xuICAgICAgICAgICAgICAgICQoXCIjcXVvdGVTZWFyY2hQb3B1cCAjZ290b1N1Ym1pdFF1b3RlQnV0dG9uXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJChcIiNxdW90ZVNlYXJjaFBvcHVwICNnb3RvU3VibWl0UXVvdGVCdXR0b25cIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoKF9hID0gREIuZ2V0U25hcHNob3QoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnF1b3RlTW9kKSB7XG4gICAgICAgICAgICAgICAgJChcIiNxdW90ZVNlYXJjaFBvcHVwICNnb1RvQXBwcm92ZVF1b3Rlc1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICQoXCIjcXVvdGVTZWFyY2hQb3B1cCAjZ29Ub0FwcHJvdmVRdW90ZXNcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkKFwiI3F1b3RlU2VhcmNoUG9wdXAgLnF1b3RlTGVuZ3RoRmlsdGVyXCIpLnNlbGVjdDIoe1xuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBcIkZpbHRlciBieSBsZW5ndGhcIixcbiAgICAgICAgICAgICAgICBtYXhpbXVtU2VsZWN0aW9uTGVuZ3RoOiBJbmZpbml0eSxcbiAgICAgICAgICAgICAgICBtdWx0aXBsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB3aWR0aDogXCIxMDAlXCIsXG4gICAgICAgICAgICAgICAgZGF0YTogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IFwic2hvcnRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIm1lZGl1bVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogMixcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IFwibG9uZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogMyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IFwidGhpY2NcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkKFwiI3F1b3RlU2VhcmNoUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY2xlYXJUZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICQoXCIjcXVvdGVTZWFyY2hQb3B1cCBpbnB1dFwiKS50cmlnZ2VyKFwiZm9jdXNcIikuc2VsZWN0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHVwZGF0ZVJlc3VsdHMocXVvdGVTZWFyY2hJbnB1dFZhbHVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZShub0FuaW0gPSBmYWxzZSwgZm9jdXNXb3JkcyA9IHRydWUpIHtcbiAgICBpZiAoISQoXCIjcXVvdGVTZWFyY2hQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNxdW90ZVNlYXJjaFBvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCBub0FuaW0gPyAwIDogMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3F1b3RlU2VhcmNoUG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgaWYgKGZvY3VzV29yZHMpIHtcbiAgICAgICAgICAgICAgICBUZXN0VUkuZm9jdXNXb3JkcygpO1xuICAgICAgICAgICAgICAgICQoXCIjcXVvdGVTZWFyY2hQb3B1cCAucXVvdGVMZW5ndGhGaWx0ZXJcIikudmFsKFtdKTtcbiAgICAgICAgICAgICAgICAkKFwiI3F1b3RlU2VhcmNoUG9wdXAgLnF1b3RlTGVuZ3RoRmlsdGVyXCIpLnRyaWdnZXIoXCJjaGFuZ2VcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG5mdW5jdGlvbiBhcHBseSh2YWwpIHtcbiAgICBpZiAoaXNOYU4odmFsKSkge1xuICAgICAgICB2YWwgPSBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNlYXJjaEJveFwiKS52YWx1ZSk7XG4gICAgfVxuICAgIGxldCByZXQ7XG4gICAgaWYgKHZhbCAhPT0gbnVsbCAmJiAhaXNOYU4odmFsKSAmJiB2YWwgPj0gMCkge1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0UXVvdGVMZW5ndGgoLTIsIGZhbHNlKTtcbiAgICAgICAgZXhwb3J0cy5zZWxlY3RlZElkID0gdmFsO1xuICAgICAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgICAgICByZXQgPSB0cnVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJRdW90ZSBJRCBtdXN0IGJlIGF0IGxlYXN0IDFcIiwgMCk7XG4gICAgICAgIHJldCA9IGZhbHNlO1xuICAgIH1cbiAgICBoaWRlKCk7XG4gICAgcmV0dXJuIHJldDtcbn1cbmV4cG9ydHMuYXBwbHkgPSBhcHBseTtcbmNvbnN0IHNlYXJjaEZvclF1b3RlcyA9ICgwLCBkZWJvdW5jZV8xLmRlYm91bmNlKSgoKSA9PiB7XG4gICAgY29uc3Qgc2VhcmNoVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2VhcmNoQm94XCIpXG4gICAgICAgIC52YWx1ZTtcbiAgICB1cGRhdGVSZXN1bHRzKHNlYXJjaFRleHQpO1xufSk7XG4kKFwiI3F1b3RlU2VhcmNoUG9wdXAgLnNlYXJjaEJveFwiKS5vbihcImtleXVwXCIsIChlKSA9PiB7XG4gICAgaWYgKGUuY29kZSA9PT0gXCJFc2NhcGVcIilcbiAgICAgICAgcmV0dXJuO1xuICAgIHNlYXJjaEZvclF1b3RlcygpO1xufSk7XG4kKFwiI3F1b3RlU2VhcmNoUG9wdXAgLnF1b3RlTGVuZ3RoRmlsdGVyXCIpLm9uKFwiY2hhbmdlXCIsIHNlYXJjaEZvclF1b3Rlcyk7XG4kKFwiI3F1b3RlU2VhcmNoUG9wdXBXcmFwcGVyXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcInF1b3RlU2VhcmNoUG9wdXBXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNxdW90ZVNlYXJjaFBvcHVwICNnb3RvU3VibWl0UXVvdGVCdXR0b25cIiwgKCkgPT4ge1xuICAgIGhpZGUodHJ1ZSk7XG4gICAgUXVvdGVTdWJtaXRQb3B1cC5zaG93KHRydWUpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3F1b3RlU2VhcmNoUG9wdXAgI2dvVG9BcHByb3ZlUXVvdGVzXCIsICgpID0+IHtcbiAgICBoaWRlKHRydWUpO1xuICAgIFF1b3RlQXBwcm92ZVBvcHVwLnNob3codHJ1ZSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjcXVvdGVTZWFyY2hQb3B1cCAucmVwb3J0XCIsIChlKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBjb25zdCBxdW90ZUlkID0gZS50YXJnZXQuY2xvc2VzdChcIi5zZWFyY2hSZXN1bHRcIikuaWQ7XG4gICAgY29uc3QgcXVvdGVJZFNlbGVjdGVkRm9yUmVwb3J0ID0gcGFyc2VJbnQocXVvdGVJZCk7XG4gICAgaGlkZSh0cnVlLCBmYWxzZSk7XG4gICAgUXVvdGVSZXBvcnRQb3B1cC5zaG93KHtcbiAgICAgICAgcXVvdGVJZDogcXVvdGVJZFNlbGVjdGVkRm9yUmVwb3J0LFxuICAgICAgICBub0FuaW06IHRydWUsXG4gICAgICAgIHByZXZpb3VzUG9wdXBTaG93Q2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgICAgIHNob3coZmFsc2UpO1xuICAgICAgICB9LFxuICAgIH0pO1xufSkpO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0b3AgLmNvbmZpZyAucXVvdGVMZW5ndGggLnRleHQtYnV0dG9uXCIsIChlKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IGxlbiA9IChfYSA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwicXVvdGVMZW5ndGhcIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDA7XG4gICAgaWYgKGxlbiA9PSAtMikge1xuICAgICAgICBzaG93KCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50KS5vbihcImtleWRvd25cIiwgKGV2ZW50KSA9PiB7XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFc2NhcGVcIiAmJlxuICAgICAgICAhJChcIiNxdW90ZVNlYXJjaFBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICBoaWRlKCk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmhpZGUgPSBleHBvcnRzLnNob3cgPSB2b2lkIDA7XG5jb25zdCBhcGVfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vYXBlXCIpKTtcbmNvbnN0IExvYWRlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbG9hZGVyXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuLy8gaW1wb3J0IENvbmZpZyBmcm9tIFwiLi4vY29uZmlnXCI7XG4vLyBpbXBvcnQgKiBhcyBNaXNjIGZyb20gXCIuLi9taXNjXCI7XG4vLyBsZXQgZHJvcGRvd25SZWFkeSA9IGZhbHNlO1xuLy8gYXN5bmMgZnVuY3Rpb24gaW5pdERyb3Bkb3duKCk6IFByb21pc2U8dm9pZD4ge1xuLy8gICBpZiAoZHJvcGRvd25SZWFkeSkgcmV0dXJuO1xuLy8gICBjb25zdCBsYW5ndWFnZXMgPSBhd2FpdCBNaXNjLmdldExhbmd1YWdlTGlzdCgpO1xuLy8gICBsYW5ndWFnZXMuZm9yRWFjaCgobGFuZ3VhZ2UpID0+IHtcbi8vICAgICBpZiAoXG4vLyAgICAgICBsYW5ndWFnZSA9PT0gXCJlbmdsaXNoX2NvbW1vbmx5X21pc3NwZWxsZWRcIiB8fFxuLy8gICAgICAgbGFuZ3VhZ2UgPT09IFwiaHVuZ2FyaWFuXzIuNWtcIlxuLy8gICAgIClcbi8vICAgICAgIHJldHVybjtcbi8vICAgICBpZiAoIS9fXFxkKmskL2cudGVzdChsYW5ndWFnZSkpIHtcbi8vICAgICAgICQoXCIjcXVvdGVTdWJtaXRQb3B1cCAjc3VibWl0UXVvdGVMYW5ndWFnZVwiKS5hcHBlbmQoXG4vLyAgICAgICAgIGA8b3B0aW9uIHZhbHVlPVwiJHtsYW5ndWFnZX1cIj4ke2xhbmd1YWdlLnJlcGxhY2UoL18vZywgXCIgXCIpfTwvb3B0aW9uPmBcbi8vICAgICAgICk7XG4vLyAgICAgfVxuLy8gICB9KTtcbi8vICAgJChcIiNxdW90ZVN1Ym1pdFBvcHVwICNzdWJtaXRRdW90ZUxhbmd1YWdlXCIpLnNlbGVjdDIoKTtcbi8vICAgZHJvcGRvd25SZWFkeSA9IHRydWU7XG4vLyB9XG5mdW5jdGlvbiBzdWJtaXRRdW90ZSgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCB0ZXh0ID0gJChcIiNxdW90ZVN1Ym1pdFBvcHVwICNzdWJtaXRRdW90ZVRleHRcIikudmFsKCk7XG4gICAgICAgIGNvbnN0IHNvdXJjZSA9ICQoXCIjcXVvdGVTdWJtaXRQb3B1cCAjc3VibWl0UXVvdGVTb3VyY2VcIikudmFsKCk7XG4gICAgICAgIGNvbnN0IGxhbmd1YWdlID0gJChcIiNxdW90ZVN1Ym1pdFBvcHVwICNzdWJtaXRRdW90ZUxhbmd1YWdlXCIpLnZhbCgpO1xuICAgICAgICBjb25zdCBjYXB0Y2hhID0gJChcIiNxdW90ZVN1Ym1pdFBvcHVwICNnLXJlY2FwdGNoYS1yZXNwb25zZVwiKS52YWwoKTtcbiAgICAgICAgaWYgKCF0ZXh0IHx8ICFzb3VyY2UgfHwgIWxhbmd1YWdlKSB7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJQbGVhc2UgZmlsbCBpbiBhbGwgZmllbGRzXCIsIDApO1xuICAgICAgICB9XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5xdW90ZXMuc3VibWl0KHRleHQsIHNvdXJjZSwgbGFuZ3VhZ2UsIGNhcHRjaGEpO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBzdWJtaXQgcXVvdGU6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUXVvdGUgc3VibWl0dGVkLlwiLCAxKTtcbiAgICAgICAgJChcIiNxdW90ZVN1Ym1pdFBvcHVwICNzdWJtaXRRdW90ZVRleHRcIikudmFsKFwiXCIpO1xuICAgICAgICAkKFwiI3F1b3RlU3VibWl0UG9wdXAgI3N1Ym1pdFF1b3RlU291cmNlXCIpLnZhbChcIlwiKTtcbiAgICAgICAgJChcIiNxdW90ZVN1Ym1pdFBvcHVwIC5jaGFyYWN0ZXJDb3VudFwiKS5yZW1vdmVDbGFzcyhcInJlZFwiKTtcbiAgICAgICAgJChcIiNxdW90ZVN1Ym1pdFBvcHVwIC5jaGFyYWN0ZXJDb3VudFwiKS50ZXh0KFwiLVwiKTtcbiAgICAgICAgZ3JlY2FwdGNoYS5yZXNldCgpO1xuICAgIH0pO1xufVxuLy8gQHRzLWlnbm9yZVxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG5mdW5jdGlvbiBzaG93KG5vQW5pbSA9IGZhbHNlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJRdW90ZSBzdWJtaXNzaW9uIGlzIGRpc2FibGVkIHRlbXBvcmFyaWx5IGR1ZSB0byBhIGxhcmdlIHN1Ym1pc3Npb24gcXVldWUuXCIsIDAsIDUpO1xuICAgICAgICByZXR1cm47XG4gICAgICAgIC8vIGlmICgkKFwiI3F1b3RlU3VibWl0UG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIC8vICAgYXdhaXQgaW5pdERyb3Bkb3duKCk7XG4gICAgICAgIC8vICAgJChcIiNxdW90ZVN1Ym1pdFBvcHVwICNzdWJtaXRRdW90ZUxhbmd1YWdlXCIpLnZhbChcbiAgICAgICAgLy8gICAgIENvbmZpZy5sYW5ndWFnZS5yZXBsYWNlKC9fXFxkKmskL2csIFwiXCIpXG4gICAgICAgIC8vICAgKTtcbiAgICAgICAgLy8gICAkKFwiI3F1b3RlU3VibWl0UG9wdXAgI3N1Ym1pdFF1b3RlTGFuZ3VhZ2VcIikudHJpZ2dlcihcImNoYW5nZVwiKTtcbiAgICAgICAgLy8gICAkKFwiI3F1b3RlU3VibWl0UG9wdXAgaW5wdXRcIikudmFsKFwiXCIpO1xuICAgICAgICAvLyAgICQoXCIjcXVvdGVTdWJtaXRQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgLy8gICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgIC8vICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAvLyAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgIC8vICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgbm9BbmltID8gMCA6IDEwMCwgKCkgPT4ge1xuICAgICAgICAvLyAgICAgICAkKFwiI3F1b3RlU3VibWl0UG9wdXAgdGV4dGFyZWFcIikudHJpZ2dlcihcImZvY3VzXCIpLnNlbGVjdCgpO1xuICAgICAgICAvLyAgICAgfSk7XG4gICAgICAgIC8vIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmICghJChcIiNxdW90ZVN1Ym1pdFBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI3F1b3RlU3VibWl0UG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNxdW90ZVN1Ym1pdFBvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbiQoXCIjcXVvdGVTdWJtaXRQb3B1cFdyYXBwZXJcIikub24oXCJtb3VzZWRvd25cIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcInF1b3RlU3VibWl0UG9wdXBXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNxdW90ZVN1Ym1pdFBvcHVwICNzdWJtaXRRdW90ZUJ1dHRvblwiLCAoKSA9PiB7XG4gICAgc3VibWl0UXVvdGUoKTtcbn0pO1xuJChcIiNxdW90ZVN1Ym1pdFBvcHVwIHRleHRhcmVhXCIpLm9uKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IGxlbiA9IChfYSA9ICQoXCIjcXVvdGVTdWJtaXRQb3B1cCB0ZXh0YXJlYVwiKS52YWwoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aDtcbiAgICAgICAgJChcIiNxdW90ZVN1Ym1pdFBvcHVwIC5jaGFyYWN0ZXJDb3VudFwiKS50ZXh0KGxlbik7XG4gICAgICAgIGlmIChsZW4gPCA2MCkge1xuICAgICAgICAgICAgJChcIiNxdW90ZVN1Ym1pdFBvcHVwIC5jaGFyYWN0ZXJDb3VudFwiKS5hZGRDbGFzcyhcInJlZFwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIjcXVvdGVTdWJtaXRQb3B1cCAuY2hhcmFjdGVyQ291bnRcIikucmVtb3ZlQ2xhc3MoXCJyZWRcIik7XG4gICAgICAgIH1cbiAgICB9LCAxKTtcbn0pO1xuJChcIiNxdW90ZVN1Ym1pdFBvcHVwIGlucHV0XCIpLm9uKFwia2V5ZG93blwiLCAoZSkgPT4ge1xuICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIHN1Ym1pdFF1b3RlKCk7XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZUJ1dHRvbnMgPSB2b2lkIDA7XG5jb25zdCBhcGVfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vYXBlXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBMb2FkZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2xvYWRlclwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgaWYgKCQoXCIjcmVzdWx0RWRpdFRhZ3NQYW5lbFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNyZXN1bHRFZGl0VGFnc1BhbmVsV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMjUpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgaWYgKCEkKFwiI3Jlc3VsdEVkaXRUYWdzUGFuZWxXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjcmVzdWx0RWRpdFRhZ3NQYW5lbFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdEVkaXRUYWdzUGFuZWxXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5mdW5jdGlvbiB1cGRhdGVCdXR0b25zKCkge1xuICAgIHZhciBfYTtcbiAgICAkKFwiI3Jlc3VsdEVkaXRUYWdzUGFuZWwgLmJ1dHRvbnNcIikuZW1wdHkoKTtcbiAgICAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgJChcIiNyZXN1bHRFZGl0VGFnc1BhbmVsIC5idXR0b25zXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cImJ1dHRvbiB0YWdcIiB0YWdpZD1cIiR7dGFnLl9pZH1cIj4ke3RhZy5uYW1lfTwvZGl2PmApO1xuICAgIH0pO1xufVxuZXhwb3J0cy51cGRhdGVCdXR0b25zID0gdXBkYXRlQnV0dG9ucztcbmZ1bmN0aW9uIHVwZGF0ZUFjdGl2ZUJ1dHRvbnMoYWN0aXZlKSB7XG4gICAgaWYgKGFjdGl2ZSA9PT0gW10pXG4gICAgICAgIHJldHVybjtcbiAgICAkLmVhY2goJChcIiNyZXN1bHRFZGl0VGFnc1BhbmVsIC5idXR0b25zIC5idXR0b25cIiksIChfLCBvYmopID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB0YWdpZCA9IChfYSA9ICQob2JqKS5hdHRyKFwidGFnaWRcIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiXCI7XG4gICAgICAgIGlmIChhY3RpdmUuaW5jbHVkZXModGFnaWQpKSB7XG4gICAgICAgICAgICAkKG9iaikuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKG9iaikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZUFjY291bnQgLmdyb3VwLmhpc3RvcnkgI3Jlc3VsdEVkaXRUYWdzXCIsIChmKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGlmICgoKF9hID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSB8fCAwID4gMCkge1xuICAgICAgICBjb25zdCByZXN1bHRpZCA9ICQoZi50YXJnZXQpLnBhcmVudHMoXCJzcGFuXCIpLmF0dHIoXCJyZXN1bHRpZFwiKTtcbiAgICAgICAgY29uc3QgdGFncyA9ICQoZi50YXJnZXQpLnBhcmVudHMoXCJzcGFuXCIpLmF0dHIoXCJ0YWdzXCIpO1xuICAgICAgICAkKFwiI3Jlc3VsdEVkaXRUYWdzUGFuZWxcIikuYXR0cihcInJlc3VsdGlkXCIsIHJlc3VsdGlkKTtcbiAgICAgICAgJChcIiNyZXN1bHRFZGl0VGFnc1BhbmVsXCIpLmF0dHIoXCJ0YWdzXCIsIHRhZ3MpO1xuICAgICAgICB1cGRhdGVBY3RpdmVCdXR0b25zKEpTT04ucGFyc2UodGFncykpO1xuICAgICAgICBzaG93KCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3Jlc3VsdEVkaXRUYWdzUGFuZWxXcmFwcGVyIC5idXR0b24udGFnXCIsIChmKSA9PiB7XG4gICAgJChmLnRhcmdldCkudG9nZ2xlQ2xhc3MoXCJhY3RpdmVcIik7XG59KTtcbiQoXCIjcmVzdWx0RWRpdFRhZ3NQYW5lbFdyYXBwZXJcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwicmVzdWx0RWRpdFRhZ3NQYW5lbFdyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4kKFwiI3Jlc3VsdEVkaXRUYWdzUGFuZWwgLmNvbmZpcm1CdXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgcmVzdWx0SWQgPSAkKFwiI3Jlc3VsdEVkaXRUYWdzUGFuZWxcIikuYXR0cihcInJlc3VsdGlkXCIpO1xuICAgIC8vIGxldCBvbGR0YWdzID0gSlNPTi5wYXJzZSgkKFwiI3Jlc3VsdEVkaXRUYWdzUGFuZWxcIikuYXR0cihcInRhZ3NcIikpO1xuICAgIGNvbnN0IG5ld1RhZ3MgPSBbXTtcbiAgICAkLmVhY2goJChcIiNyZXN1bHRFZGl0VGFnc1BhbmVsIC5idXR0b25zIC5idXR0b25cIiksIChfLCBvYmopID0+IHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB0YWdpZCA9IChfYSA9ICQob2JqKS5hdHRyKFwidGFnaWRcIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiXCI7XG4gICAgICAgIGlmICgkKG9iaikuaGFzQ2xhc3MoXCJhY3RpdmVcIikpIHtcbiAgICAgICAgICAgIG5ld1RhZ3MucHVzaCh0YWdpZCk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBMb2FkZXIuc2hvdygpO1xuICAgIGhpZGUoKTtcbiAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucmVzdWx0cy51cGRhdGVUYWdzKHJlc3VsdElkLCBuZXdUYWdzKTtcbiAgICBMb2FkZXIuaGlkZSgpO1xuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gdXBkYXRlIHJlc3VsdCB0YWdzOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICB9XG4gICAgTm90aWZpY2F0aW9ucy5hZGQoXCJUYWdzIHVwZGF0ZWQuXCIsIDEsIDIpO1xuICAgIChfYSA9IERCLmdldFNuYXBzaG90KCkucmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHJlc3VsdCkgPT4ge1xuICAgICAgICBpZiAocmVzdWx0Ll9pZCA9PT0gcmVzdWx0SWQpIHtcbiAgICAgICAgICAgIHJlc3VsdC50YWdzID0gbmV3VGFncztcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGxldCB0YWdOYW1lcyA9IFwiXCI7XG4gICAgaWYgKG5ld1RhZ3MubGVuZ3RoID4gMCkge1xuICAgICAgICBuZXdUYWdzLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgKF9hID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgoc25hcHRhZykgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0YWcgPT09IHNuYXB0YWcuX2lkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhZ05hbWVzICs9IHNuYXB0YWcubmFtZSArIFwiLCBcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRhZ05hbWVzID0gdGFnTmFtZXMuc3Vic3RyaW5nKDAsIHRhZ05hbWVzLmxlbmd0aCAtIDIpO1xuICAgIH1cbiAgICBsZXQgcmVzdGFncztcbiAgICBpZiAobmV3VGFncyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJlc3RhZ3MgPSBcIltdXCI7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXN0YWdzID0gSlNPTi5zdHJpbmdpZnkobmV3VGFncyk7XG4gICAgfVxuICAgICQoYC5wYWdlQWNjb3VudCAjcmVzdWx0RWRpdFRhZ3NbcmVzdWx0aWQ9JyR7cmVzdWx0SWR9J11gKS5hdHRyKFwidGFnc1wiLCByZXN0YWdzKTtcbiAgICBpZiAobmV3VGFncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICQoYC5wYWdlQWNjb3VudCAjcmVzdWx0RWRpdFRhZ3NbcmVzdWx0aWQ9JyR7cmVzdWx0SWR9J11gKS5jc3MoXCJvcGFjaXR5XCIsIDEpO1xuICAgICAgICAkKGAucGFnZUFjY291bnQgI3Jlc3VsdEVkaXRUYWdzW3Jlc3VsdGlkPScke3Jlc3VsdElkfSddYCkuYXR0cihcImFyaWEtbGFiZWxcIiwgdGFnTmFtZXMpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChgLnBhZ2VBY2NvdW50ICNyZXN1bHRFZGl0VGFnc1tyZXN1bHRpZD0nJHtyZXN1bHRJZH0nXWApLmNzcyhcIm9wYWNpdHlcIiwgMC4yNSk7XG4gICAgICAgICQoYC5wYWdlQWNjb3VudCAjcmVzdWx0RWRpdFRhZ3NbcmVzdWx0aWQ9JyR7cmVzdWx0SWR9J11gKS5hdHRyKFwiYXJpYS1sYWJlbFwiLCBcIm5vIHRhZ3NcIik7XG4gICAgfVxufSkpO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuY29uc3QgQ3VzdG9tVGV4dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9jdXN0b20tdGV4dFwiKSk7XG5mdW5jdGlvbiBzaG93KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IG5hbWVzID0gQ3VzdG9tVGV4dC5nZXRDdXN0b21UZXh0TmFtZXMoKTtcbiAgICAgICAgY29uc3QgbGlzdEVsID0gJChgI3NhdmVkVGV4dHNQb3B1cCAubGlzdGApLmVtcHR5KCk7XG4gICAgICAgIGxldCBsaXN0ID0gXCJcIjtcbiAgICAgICAgaWYgKG5hbWVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgbGlzdCArPSBcIjxkaXY+Tm8gc2F2ZWQgY3VzdG9tIHRleHRzIGZvdW5kPC9kaXY+XCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgbmFtZXMpIHtcbiAgICAgICAgICAgICAgICBsaXN0ICs9IGA8ZGl2IGNsYXNzPVwic2F2ZWRUZXh0XCI+XG4gICAgICA8ZGl2IGNsYXNzPVwiYnV0dG9uIG5hbWVcIj4ke25hbWV9PC9kaXY+XG4gICAgICA8ZGl2IGNsYXNzPVwiYnV0dG9uIGRlbGV0ZVwiPlxuICAgICAgPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtdHJhc2hcIj48L2k+XG4gICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PmA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGlzdEVsLmh0bWwobGlzdCk7XG4gICAgICAgICQoXCIjc2F2ZWRUZXh0c1BvcHVwV3JhcHBlclwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiNjdXN0b21UZXh0UG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoZnVsbCA9IGZhbHNlKSB7XG4gICAgJChcIiNzYXZlZFRleHRzUG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIGlmICghZnVsbClcbiAgICAgICAgJChcIiNjdXN0b21UZXh0UG9wdXBXcmFwcGVyXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xufVxuZnVuY3Rpb24gYXBwbHlTYXZlZChuYW1lKSB7XG4gICAgY29uc3QgdGV4dCA9IEN1c3RvbVRleHQuZ2V0Q3VzdG9tVGV4dChuYW1lKTtcbiAgICAkKGAjY3VzdG9tVGV4dFBvcHVwV3JhcHBlciB0ZXh0YXJlYWApLnZhbCh0ZXh0LmpvaW4oQ3VzdG9tVGV4dC5kZWxpbWl0ZXIpKTtcbn1cbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgYCNzYXZlZFRleHRzUG9wdXBXcmFwcGVyIC5saXN0IC5zYXZlZFRleHQgLmJ1dHRvbi5uYW1lYCwgKGUpID0+IHtcbiAgICBjb25zdCBuYW1lID0gJChlLnRhcmdldCkudGV4dCgpO1xuICAgIGFwcGx5U2F2ZWQobmFtZSk7XG4gICAgaGlkZSgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIGAjc2F2ZWRUZXh0c1BvcHVwV3JhcHBlciAubGlzdCAuc2F2ZWRUZXh0IC5idXR0b24uZGVsZXRlYCwgKCkgPT4ge1xuICAgIGhpZGUodHJ1ZSk7XG59KTtcbiQoXCIjc2F2ZWRUZXh0c1BvcHVwV3JhcHBlclwiKS5tb3VzZWRvd24oKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcInNhdmVkVGV4dHNQb3B1cFdyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmhpZGUgPSBleHBvcnRzLmxpc3QgPSB2b2lkIDA7XG5jb25zdCBhcGVfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vYXBlXCIpKTtcbmNvbnN0IEFjY291bnRDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9hY2NvdW50LWNvbnRyb2xsZXJcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IFVwZGF0ZUNvbmZpZyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IExvYWRlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbG9hZGVyXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgU2V0dGluZ3MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BhZ2VzL3NldHRpbmdzXCIpKTtcbmNvbnN0IEFwZUtleXNQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcG9wdXBzL2FwZS1rZXlzLXBvcHVwXCIpKTtcbmNvbnN0IFRoZW1lUGlja2VyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zZXR0aW5ncy90aGVtZS1waWNrZXJcIikpO1xuY29uc3QgQ3VzdG9tVGV4dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9jdXN0b20tdGV4dFwiKSk7XG5jb25zdCBDdXN0b21UZXh0UG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BvcHVwcy9jdXN0b20tdGV4dC1wb3B1cFwiKSk7XG5jb25zdCBTYXZlZFRleHRzUG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vc2F2ZWQtdGV4dHMtcG9wdXBcIikpO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuLi9maXJlYmFzZVwiKTtcbmNvbnN0IGF1dGhfMSA9IHJlcXVpcmUoXCJmaXJlYmFzZS9hdXRoXCIpO1xubGV0IGFjdGl2ZVBvcHVwID0gbnVsbDtcbmV4cG9ydHMubGlzdCA9IHt9O1xuY2xhc3MgU2ltcGxlUG9wdXAge1xuICAgIGNvbnN0cnVjdG9yKGlkLCB0eXBlLCB0aXRsZSwgaW5wdXRzID0gW10sIHRleHQgPSBcIlwiLCBidXR0b25UZXh0ID0gXCJDb25maXJtXCIsIGV4ZWNGbiwgYmVmb3JlSW5pdEZuLCBiZWZvcmVTaG93Rm4pIHtcbiAgICAgICAgdGhpcy5wYXJhbWV0ZXJzID0gW107XG4gICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgdGhpcy5leGVjRm4gPSAodGhpc1BvcHVwLCAuLi52YWxzKSA9PiBleGVjRm4odGhpc1BvcHVwLCAuLi52YWxzKTtcbiAgICAgICAgdGhpcy50aXRsZSA9IHRpdGxlO1xuICAgICAgICB0aGlzLmlucHV0cyA9IGlucHV0cztcbiAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDtcbiAgICAgICAgdGhpcy53cmFwcGVyID0gJChcIiNzaW1wbGVQb3B1cFdyYXBwZXJcIik7XG4gICAgICAgIHRoaXMuZWxlbWVudCA9ICQoXCIjc2ltcGxlUG9wdXBcIik7XG4gICAgICAgIHRoaXMuYnV0dG9uVGV4dCA9IGJ1dHRvblRleHQ7XG4gICAgICAgIHRoaXMuYmVmb3JlSW5pdEZuID0gKHRoaXNQb3B1cCkgPT4gYmVmb3JlSW5pdEZuKHRoaXNQb3B1cCk7XG4gICAgICAgIHRoaXMuYmVmb3JlU2hvd0ZuID0gKHRoaXNQb3B1cCkgPT4gYmVmb3JlU2hvd0ZuKHRoaXNQb3B1cCk7XG4gICAgICAgIHRoaXMuY2FuQ2xvc2UgPSB0cnVlO1xuICAgIH1cbiAgICByZXNldCgpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50Lmh0bWwoYFxuICAgIDxkaXYgY2xhc3M9XCJ0aXRsZVwiPjwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJpbnB1dHNcIj48L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwidGV4dFwiPjwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJidXR0b25cIj48L2Rpdj5gKTtcbiAgICB9XG4gICAgaW5pdCgpIHtcbiAgICAgICAgY29uc3QgZWwgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgIGVsLmZpbmQoXCJpbnB1dFwiKS52YWwoXCJcIik7XG4gICAgICAgIC8vIGlmIChlbC5hdHRyKFwicG9wdXBJZFwiKSAhPT0gdGhpcy5pZCkge1xuICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgIGVsLmF0dHIoXCJwb3B1cElkXCIsIHRoaXMuaWQpO1xuICAgICAgICBlbC5maW5kKFwiLnRpdGxlXCIpLnRleHQodGhpcy50aXRsZSk7XG4gICAgICAgIGVsLmZpbmQoXCIudGV4dFwiKS50ZXh0KHRoaXMudGV4dCk7XG4gICAgICAgIHRoaXMuaW5pdElucHV0cygpO1xuICAgICAgICBpZiAodGhpcy5idXR0b25UZXh0ID09PSBcIlwiKSB7XG4gICAgICAgICAgICBlbC5maW5kKFwiLmJ1dHRvblwiKS5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGVsLmZpbmQoXCIuYnV0dG9uXCIpLnRleHQodGhpcy5idXR0b25UZXh0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50ZXh0ID09PSBcIlwiKSB7XG4gICAgICAgICAgICBlbC5maW5kKFwiLnRleHRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBlbC5maW5kKFwiLnRleHRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gfVxuICAgIH1cbiAgICBpbml0SW5wdXRzKCkge1xuICAgICAgICBjb25zdCBlbCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgaWYgKHRoaXMuaW5wdXRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnR5cGUgPT09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBlbC5maW5kKFwiLmlucHV0c1wiKS5hcHBlbmQoYFxuICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgIHR5cGU9XCJudW1iZXJcIlxuICAgICAgICAgICAgICBtaW49XCIxXCJcbiAgICAgICAgICAgICAgdmFsdWU9XCIke2lucHV0LmluaXRWYWx9XCJcbiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCIke2lucHV0LnBsYWNlaG9sZGVyfVwiXG4gICAgICAgICAgICAgIGNsYXNzPVwiJHtpbnB1dC5oaWRkZW4gPyBcImhpZGRlblwiIDogXCJcIn1cIlxuICAgICAgICAgICAgICAke2lucHV0LmhpZGRlbiA/IFwiXCIgOiBcInJlcXVpcmVkXCJ9XG4gICAgICAgICAgICAgIGF1dG9jb21wbGV0ZT1cIm9mZlwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgYCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLnR5cGUgPT09IFwidGV4dFwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0LnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dC50eXBlID09PSBcInRleHRhcmVhXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5maW5kKFwiLmlucHV0c1wiKS5hcHBlbmQoYFxuICAgICAgICAgICAgICAgIDx0ZXh0YXJlYVxuICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCIke2lucHV0LnBsYWNlaG9sZGVyfVwiXG4gICAgICAgICAgICAgICAgICBjbGFzcz1cIiR7aW5wdXQuaGlkZGVuID8gXCJoaWRkZW5cIiA6IFwiXCJ9XCJcbiAgICAgICAgICAgICAgICAgICR7aW5wdXQuaGlkZGVuID8gXCJcIiA6IFwicmVxdWlyZWRcIn1cbiAgICAgICAgICAgICAgICAgICR7aW5wdXQuZGlzYWJsZWQgPyBcImRpc2FibGVkXCIgOiBcIlwifVxuICAgICAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlPVwib2ZmXCJcbiAgICAgICAgICAgICAgICA+JHtpbnB1dC5pbml0VmFsfTwvdGV4dGFyZWE+XG4gICAgICAgICAgICAgIGApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaW5wdXQudHlwZSA9PT0gXCJjaGVja2JveFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuZmluZChcIi5pbnB1dHNcIikuYXBwZW5kKGBcbiAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9XCJjaGVja2JveFwiPlxuICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJjaGVja2JveFwiPlxuICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImN1c3RvbVRleHRDaGVja2JveFwiPjwvZGl2PlxuICAgICAgICAgICAgICAgICAgJHtpbnB1dC5sYWJlbH1cbiAgICAgICAgICAgICAgICA8L2xhYmVsPlxuICAgICAgICAgICAgICBgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLmZpbmQoXCIuaW5wdXRzXCIpLmFwcGVuZChgXG4gICAgICAgICAgICAgIDxpbnB1dFxuICAgICAgICAgICAgICB0eXBlPVwiJHtpbnB1dC50eXBlfVwiXG4gICAgICAgICAgICAgIHZhbHVlPVwiJHtpbnB1dC5pbml0VmFsfVwiXG4gICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiJHtpbnB1dC5wbGFjZWhvbGRlcn1cIlxuICAgICAgICAgICAgICBjbGFzcz1cIiR7aW5wdXQuaGlkZGVuID8gXCJoaWRkZW5cIiA6IFwiXCJ9XCJcbiAgICAgICAgICAgICAgJHtpbnB1dC5oaWRkZW4gPyBcIlwiIDogXCJyZXF1aXJlZFwifVxuICAgICAgICAgICAgICAke2lucHV0LmRpc2FibGVkID8gXCJkaXNhYmxlZFwiIDogXCJcIn1cbiAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlPVwib2ZmXCJcbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICBgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmZpbmQoXCIuaW5wdXRzXCIpLmFwcGVuZChgXG4gICAgICAgICAgICAgIDxpbnB1dFxuICAgICAgICAgICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICB2YWx1ZT1cIiR7aW5wdXQuaW5pdFZhbH1cIlxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiJHtpbnB1dC5wbGFjZWhvbGRlcn1cIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiJHtpbnB1dC5oaWRkZW4gPyBcImhpZGRlblwiIDogXCJcIn1cIlxuICAgICAgICAgICAgICAgICR7aW5wdXQuaGlkZGVuID8gXCJcIiA6IFwicmVxdWlyZWRcIn1cbiAgICAgICAgICAgICAgICAke2lucHV0LmRpc2FibGVkID8gXCJkaXNhYmxlZFwiIDogXCJcIn1cbiAgICAgICAgICAgICAgICBhdXRvY29tcGxldGU9XCJvZmZcIlxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICBgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWwuZmluZChcIi5pbnB1dHNcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBlbC5maW5kKFwiLmlucHV0c1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBleGVjKCkge1xuICAgICAgICBpZiAoIXRoaXMuY2FuQ2xvc2UpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IHZhbHMgPSBbXTtcbiAgICAgICAgJC5lYWNoKCQoXCIjc2ltcGxlUG9wdXAgaW5wdXRcIiksIChfLCBlbCkgPT4ge1xuICAgICAgICAgICAgaWYgKCQoZWwpLmlzKFwiOmNoZWNrYm94XCIpKSB7XG4gICAgICAgICAgICAgICAgdmFscy5wdXNoKCQoZWwpLmlzKFwiOmNoZWNrZWRcIikgPyBcInRydWVcIiA6IFwiZmFsc2VcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YWxzLnB1c2goJChlbCkudmFsKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5leGVjRm4odGhpcywgLi4udmFscyk7XG4gICAgICAgIHRoaXMuaGlkZSgpO1xuICAgIH1cbiAgICBzaG93KHBhcmFtZXRlcnMgPSBbXSkge1xuICAgICAgICBhY3RpdmVQb3B1cCA9IHRoaXM7XG4gICAgICAgIHRoaXMucGFyYW1ldGVycyA9IHBhcmFtZXRlcnM7XG4gICAgICAgIHRoaXMuYmVmb3JlSW5pdEZuKHRoaXMpO1xuICAgICAgICB0aGlzLmluaXQoKTtcbiAgICAgICAgdGhpcy5iZWZvcmVTaG93Rm4odGhpcyk7XG4gICAgICAgIHRoaXMud3JhcHBlclxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgICAgICQoJChcIiNzaW1wbGVQb3B1cFwiKS5maW5kKFwiaW5wdXRcIilbMF0pLnRyaWdnZXIoXCJmb2N1c1wiKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGhpZGUoKSB7XG4gICAgICAgIGlmICghdGhpcy5jYW5DbG9zZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgYWN0aXZlUG9wdXAgPSBudWxsO1xuICAgICAgICB0aGlzLndyYXBwZXJcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLndyYXBwZXIuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgaWYgKGFjdGl2ZVBvcHVwKVxuICAgICAgICByZXR1cm4gYWN0aXZlUG9wdXAuaGlkZSgpO1xuICAgICQoXCIjc2ltcGxlUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICQoXCIjc2ltcGxlUG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbiQoXCIjc2ltcGxlUG9wdXBXcmFwcGVyXCIpLm1vdXNlZG93bigoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwic2ltcGxlUG9wdXBXcmFwcGVyXCIpIHtcbiAgICAgICAgaWYgKGFjdGl2ZVBvcHVwKVxuICAgICAgICAgICAgcmV0dXJuIGFjdGl2ZVBvcHVwLmhpZGUoKTtcbiAgICAgICAgJChcIiNzaW1wbGVQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3NpbXBsZVBvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3NpbXBsZVBvcHVwV3JhcHBlciAuYnV0dG9uXCIsICgpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgaWQgPSAoX2EgPSAkKFwiI3NpbXBsZVBvcHVwXCIpLmF0dHIoXCJwb3B1cElkXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIlwiO1xuICAgIGV4cG9ydHMubGlzdFtpZF0uZXhlYygpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImtleXVwXCIsIFwiI3NpbXBsZVBvcHVwV3JhcHBlciBpbnB1dFwiLCAoZSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNvbnN0IGlkID0gKF9hID0gJChcIiNzaW1wbGVQb3B1cFwiKS5hdHRyKFwicG9wdXBJZFwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCJcIjtcbiAgICAgICAgZXhwb3J0cy5saXN0W2lkXS5leGVjKCk7XG4gICAgfVxufSk7XG5leHBvcnRzLmxpc3RbXCJ1cGRhdGVFbWFpbFwiXSA9IG5ldyBTaW1wbGVQb3B1cChcInVwZGF0ZUVtYWlsXCIsIFwidGV4dFwiLCBcIlVwZGF0ZSBFbWFpbFwiLCBbXG4gICAge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJQYXNzd29yZFwiLFxuICAgICAgICB0eXBlOiBcInBhc3N3b3JkXCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIk5ldyBlbWFpbFwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG4gICAge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJDb25maXJtIG5ldyBlbWFpbFwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG5dLCBcIlwiLCBcIlVwZGF0ZVwiLCAoX3RoaXNQb3B1cCwgcGFzc3dvcmQsIGVtYWlsLCBlbWFpbENvbmZpcm0pID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgICAgIGlmICh1c2VyID09PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAoZW1haWwgIT09IGVtYWlsQ29uZmlybSkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJFbWFpbHMgZG9uJ3QgbWF0Y2hcIiwgMCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHVzZXIucHJvdmlkZXJEYXRhWzBdLnByb3ZpZGVySWQgPT09IFwicGFzc3dvcmRcIikge1xuICAgICAgICAgICAgY29uc3QgY3JlZGVudGlhbCA9IGF1dGhfMS5FbWFpbEF1dGhQcm92aWRlci5jcmVkZW50aWFsKHVzZXIuZW1haWwsIHBhc3N3b3JkKTtcbiAgICAgICAgICAgIHlpZWxkICgwLCBhdXRoXzEucmVhdXRoZW50aWNhdGVXaXRoQ3JlZGVudGlhbCkodXNlciwgY3JlZGVudGlhbCk7XG4gICAgICAgIH1cbiAgICAgICAgTG9hZGVyLnNob3coKTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLnVwZGF0ZUVtYWlsKGVtYWlsLCB1c2VyLmVtYWlsKTtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gdXBkYXRlIGVtYWlsOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVtYWlsIHVwZGF0ZWRcIiwgMSk7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICB9LCAxMDAwKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc3QgdHlwZWRFcnJvciA9IGU7XG4gICAgICAgIGlmICh0eXBlZEVycm9yLmNvZGUgPT09IFwiYXV0aC93cm9uZy1wYXNzd29yZFwiKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkluY29ycmVjdCBwYXNzd29yZFwiLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlNvbWV0aGluZyB3ZW50IHdyb25nOiBcIiArIGUsIC0xKTtcbiAgICAgICAgfVxuICAgIH1cbn0pLCAodGhpc1BvcHVwKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICBpZiAodXNlciA9PT0gbnVsbClcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmICghdXNlci5wcm92aWRlckRhdGEuZmluZCgocCkgPT4gKHAgPT09IG51bGwgfHwgcCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcC5wcm92aWRlcklkKSA9PT0gXCJwYXNzd29yZFwiKSkge1xuICAgICAgICB0aGlzUG9wdXAuaW5wdXRzID0gW107XG4gICAgICAgIHRoaXNQb3B1cC5idXR0b25UZXh0ID0gXCJcIjtcbiAgICAgICAgdGhpc1BvcHVwLnRleHQgPSBcIlBhc3N3b3JkIGF1dGhlbnRpY2F0aW9uIGlzIG5vdCBlbmFibGVkXCI7XG4gICAgfVxufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSk7XG5leHBvcnRzLmxpc3RbXCJ1cGRhdGVOYW1lXCJdID0gbmV3IFNpbXBsZVBvcHVwKFwidXBkYXRlTmFtZVwiLCBcInRleHRcIiwgXCJVcGRhdGUgTmFtZVwiLCBbXG4gICAge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJQYXNzd29yZFwiLFxuICAgICAgICB0eXBlOiBcInBhc3N3b3JkXCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIk5ldyBuYW1lXCIsXG4gICAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG5dLCBcIlwiLCBcIlVwZGF0ZVwiLCAoX3RoaXNQb3B1cCwgcGFzcywgbmV3TmFtZSkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICAgICAgaWYgKHVzZXIgPT09IG51bGwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmICh1c2VyLnByb3ZpZGVyRGF0YVswXS5wcm92aWRlcklkID09PSBcInBhc3N3b3JkXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNyZWRlbnRpYWwgPSBhdXRoXzEuRW1haWxBdXRoUHJvdmlkZXIuY3JlZGVudGlhbCh1c2VyLmVtYWlsLCBwYXNzKTtcbiAgICAgICAgICAgIHlpZWxkICgwLCBhdXRoXzEucmVhdXRoZW50aWNhdGVXaXRoQ3JlZGVudGlhbCkodXNlciwgY3JlZGVudGlhbCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodXNlci5wcm92aWRlckRhdGFbMF0ucHJvdmlkZXJJZCA9PT0gXCJnb29nbGUuY29tXCIpIHtcbiAgICAgICAgICAgIHlpZWxkICgwLCBhdXRoXzEucmVhdXRoZW50aWNhdGVXaXRoUG9wdXApKHVzZXIsIEFjY291bnRDb250cm9sbGVyLmdtYWlsUHJvdmlkZXIpO1xuICAgICAgICB9XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIGNvbnN0IGNoZWNrTmFtZVJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5nZXROYW1lQXZhaWxhYmlsaXR5KG5ld05hbWUpO1xuICAgICAgICBpZiAoY2hlY2tOYW1lUmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gY2hlY2sgbmFtZTogXCIgKyBjaGVja05hbWVSZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdXBkYXRlTmFtZVJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy51cGRhdGVOYW1lKG5ld05hbWUpO1xuICAgICAgICBpZiAodXBkYXRlTmFtZVJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHVwZGF0ZSBuYW1lOiBcIiArIHVwZGF0ZU5hbWVSZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJOYW1lIHVwZGF0ZWRcIiwgMSk7XG4gICAgICAgIERCLmdldFNuYXBzaG90KCkubmFtZSA9IG5ld05hbWU7XG4gICAgICAgICQoXCIjbWVudSAuaWNvbi1idXR0b24uYWNjb3VudCAudGV4dFwiKS50ZXh0KG5ld05hbWUpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBjb25zdCB0eXBlZEVycm9yID0gZTtcbiAgICAgICAgaWYgKHR5cGVkRXJyb3IuY29kZSA9PT0gXCJhdXRoL3dyb25nLXBhc3N3b3JkXCIpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiSW5jb3JyZWN0IHBhc3N3b3JkXCIsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiU29tZXRoaW5nIHdlbnQgd3Jvbmc6IFwiICsgZSwgLTEpO1xuICAgICAgICB9XG4gICAgfVxuICAgIExvYWRlci5oaWRlKCk7XG59KSwgKHRoaXNQb3B1cCkgPT4ge1xuICAgIGNvbnN0IHVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgaWYgKHVzZXIgPT09IG51bGwpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAodXNlci5wcm92aWRlckRhdGFbMF0ucHJvdmlkZXJJZCA9PT0gXCJnb29nbGUuY29tXCIpIHtcbiAgICAgICAgdGhpc1BvcHVwLmlucHV0c1swXS5oaWRkZW4gPSB0cnVlO1xuICAgICAgICB0aGlzUG9wdXAuYnV0dG9uVGV4dCA9IFwiUmVhdXRoZW50aWNhdGUgdG8gdXBkYXRlXCI7XG4gICAgfVxufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSk7XG5leHBvcnRzLmxpc3RbXCJ1cGRhdGVQYXNzd29yZFwiXSA9IG5ldyBTaW1wbGVQb3B1cChcInVwZGF0ZVBhc3N3b3JkXCIsIFwidGV4dFwiLCBcIlVwZGF0ZSBQYXNzd29yZFwiLCBbXG4gICAge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJQYXNzd29yZFwiLFxuICAgICAgICB0eXBlOiBcInBhc3N3b3JkXCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIk5ldyBwYXNzd29yZFwiLFxuICAgICAgICB0eXBlOiBcInBhc3N3b3JkXCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIkNvbmZpcm0gbmV3IHBhc3N3b3JkXCIsXG4gICAgICAgIHR5cGU6IFwicGFzc3dvcmRcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuXSwgXCJcIiwgXCJVcGRhdGVcIiwgKF90aGlzUG9wdXAsIHByZXZpb3VzUGFzcywgbmV3UGFzcywgbmV3UGFzc0NvbmZpcm0pID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgICAgIGlmICh1c2VyID09PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBjcmVkZW50aWFsID0gYXV0aF8xLkVtYWlsQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwodXNlci5lbWFpbCwgcHJldmlvdXNQYXNzKTtcbiAgICAgICAgaWYgKG5ld1Bhc3MgIT09IG5ld1Bhc3NDb25maXJtKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIk5ldyBwYXNzd29yZHMgZG9uJ3QgbWF0Y2hcIiwgMCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgTG9hZGVyLnNob3coKTtcbiAgICAgICAgeWllbGQgKDAsIGF1dGhfMS5yZWF1dGhlbnRpY2F0ZVdpdGhDcmVkZW50aWFsKSh1c2VyLCBjcmVkZW50aWFsKTtcbiAgICAgICAgeWllbGQgKDAsIGF1dGhfMS51cGRhdGVQYXNzd29yZCkodXNlciwgbmV3UGFzcyk7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUGFzc3dvcmQgdXBkYXRlZFwiLCAxKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgIH0sIDEwMDApO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBjb25zdCB0eXBlZEVycm9yID0gZTtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgaWYgKHR5cGVkRXJyb3IuY29kZSA9PT0gXCJhdXRoL3dyb25nLXBhc3N3b3JkXCIpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiSW5jb3JyZWN0IHBhc3N3b3JkXCIsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiU29tZXRoaW5nIHdlbnQgd3Jvbmc6IFwiICsgZSwgLTEpO1xuICAgICAgICB9XG4gICAgfVxufSksICh0aGlzUG9wdXApID0+IHtcbiAgICBjb25zdCB1c2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgIGlmICh1c2VyID09PSBudWxsKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKCF1c2VyLnByb3ZpZGVyRGF0YS5maW5kKChwKSA9PiAocCA9PT0gbnVsbCB8fCBwID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwLnByb3ZpZGVySWQpID09PSBcInBhc3N3b3JkXCIpKSB7XG4gICAgICAgIHRoaXNQb3B1cC5pbnB1dHMgPSBbXTtcbiAgICAgICAgdGhpc1BvcHVwLmJ1dHRvblRleHQgPSBcIlwiO1xuICAgICAgICB0aGlzUG9wdXAudGV4dCA9IFwiUGFzc3dvcmQgYXV0aGVudGljYXRpb24gaXMgbm90IGVuYWJsZWRcIjtcbiAgICB9XG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59KTtcbmV4cG9ydHMubGlzdFtcImFkZFBhc3N3b3JkQXV0aFwiXSA9IG5ldyBTaW1wbGVQb3B1cChcImFkZFBhc3N3b3JkQXV0aFwiLCBcInRleHRcIiwgXCJBZGQgUGFzc3dvcmQgQXV0aGVudGljYXRpb25cIiwgW1xuICAgIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiZW1haWxcIixcbiAgICAgICAgdHlwZTogXCJlbWFpbFwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG4gICAge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJjb25maXJtIGVtYWlsXCIsXG4gICAgICAgIHR5cGU6IFwiZW1haWxcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuICAgIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwibmV3IHBhc3N3b3JkXCIsXG4gICAgICAgIHR5cGU6IFwicGFzc3dvcmRcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuICAgIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiY29uZmlybSBuZXcgcGFzc3dvcmRcIixcbiAgICAgICAgdHlwZTogXCJwYXNzd29yZFwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG5dLCBcIlwiLCBcIkFkZFwiLCAoX3RoaXNQb3B1cCwgZW1haWwsIGVtYWlsQ29uZmlybSwgcGFzcywgcGFzc0NvbmZpcm0pID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIGlmIChlbWFpbCAhPT0gZW1haWxDb25maXJtKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRW1haWxzIGRvbid0IG1hdGNoXCIsIDApO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChwYXNzICE9PSBwYXNzQ29uZmlybSkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlBhc3N3b3JkcyBkb24ndCBtYXRjaFwiLCAwKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB5aWVsZCBBY2NvdW50Q29udHJvbGxlci5hZGRQYXNzd29yZEF1dGgoZW1haWwsIHBhc3MpO1xufSksICgpID0+IHtcbiAgICAvL1xufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSk7XG5leHBvcnRzLmxpc3RbXCJkZWxldGVBY2NvdW50XCJdID0gbmV3IFNpbXBsZVBvcHVwKFwiZGVsZXRlQWNjb3VudFwiLCBcInRleHRcIiwgXCJEZWxldGUgQWNjb3VudFwiLCBbXG4gICAge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJQYXNzd29yZFwiLFxuICAgICAgICB0eXBlOiBcInBhc3N3b3JkXCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbl0sIFwiVGhpcyBpcyB0aGUgbGFzdCB0aW1lIHlvdSBjYW4gY2hhbmdlIHlvdXIgbWluZC4gQWZ0ZXIgcHJlc3NpbmcgdGhlIGJ1dHRvbiBldmVyeXRoaW5nIGlzIGdvbmUuXCIsIFwiRGVsZXRlXCIsIChfdGhpc1BvcHVwLCBwYXNzd29yZCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdmFyIF9hO1xuICAgIC8vXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICAgICAgaWYgKHVzZXIgPT09IG51bGwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmICh1c2VyLnByb3ZpZGVyRGF0YVswXS5wcm92aWRlcklkID09PSBcInBhc3N3b3JkXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNyZWRlbnRpYWwgPSBhdXRoXzEuRW1haWxBdXRoUHJvdmlkZXIuY3JlZGVudGlhbCh1c2VyLmVtYWlsLCBwYXNzd29yZCk7XG4gICAgICAgICAgICB5aWVsZCAoMCwgYXV0aF8xLnJlYXV0aGVudGljYXRlV2l0aENyZWRlbnRpYWwpKHVzZXIsIGNyZWRlbnRpYWwpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHVzZXIucHJvdmlkZXJEYXRhWzBdLnByb3ZpZGVySWQgPT09IFwiZ29vZ2xlLmNvbVwiKSB7XG4gICAgICAgICAgICB5aWVsZCAoMCwgYXV0aF8xLnJlYXV0aGVudGljYXRlV2l0aFBvcHVwKSh1c2VyLCBBY2NvdW50Q29udHJvbGxlci5nbWFpbFByb3ZpZGVyKTtcbiAgICAgICAgfVxuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkRlbGV0aW5nIHN0YXRzLi4uXCIsIDApO1xuICAgICAgICBjb25zdCB1c2Vyc1Jlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5kZWxldGUoKTtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgaWYgKHVzZXJzUmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBkZWxldGUgdXNlciBzdGF0czogXCIgKyB1c2Vyc1Jlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkRlbGV0aW5nIHJlc3VsdHMuLi5cIiwgMCk7XG4gICAgICAgIGNvbnN0IHJlc3VsdHNSZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucmVzdWx0cy5kZWxldGVBbGwoKTtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgaWYgKHJlc3VsdHNSZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGRlbGV0ZSB1c2VyIHJlc3VsdHM6IFwiICsgcmVzdWx0c1Jlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkRlbGV0aW5nIGxvZ2luIGluZm9ybWF0aW9uLi4uXCIsIDApO1xuICAgICAgICB5aWVsZCAoKF9hID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZGVsZXRlKCkpO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkdvb2RieWVcIiwgMSwgNSk7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgIH0sIDMwMDApO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBjb25zdCB0eXBlZEVycm9yID0gZTtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgaWYgKHR5cGVkRXJyb3IuY29kZSA9PT0gXCJhdXRoL3dyb25nLXBhc3N3b3JkXCIpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiSW5jb3JyZWN0IHBhc3N3b3JkXCIsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiU29tZXRoaW5nIHdlbnQgd3Jvbmc6IFwiICsgZSwgLTEpO1xuICAgICAgICB9XG4gICAgfVxufSksICh0aGlzUG9wdXApID0+IHtcbiAgICBjb25zdCB1c2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgIGlmICh1c2VyID09PSBudWxsKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKHVzZXIucHJvdmlkZXJEYXRhWzBdLnByb3ZpZGVySWQgPT09IFwiZ29vZ2xlLmNvbVwiKSB7XG4gICAgICAgIHRoaXNQb3B1cC5pbnB1dHMgPSBbXTtcbiAgICAgICAgdGhpc1BvcHVwLmJ1dHRvblRleHQgPSBcIlJlYXV0aGVudGljYXRlIHRvIGRlbGV0ZVwiO1xuICAgIH1cbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0pO1xuZXhwb3J0cy5saXN0W1wiY2xlYXJUYWdQYlwiXSA9IG5ldyBTaW1wbGVQb3B1cChcImNsZWFyVGFnUGJcIiwgXCJ0ZXh0XCIsIFwiQ2xlYXIgVGFnIFBCXCIsIFtdLCBgQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGNsZWFyIHRoaXMgdGFncyBQQj9gLCBcIkNsZWFyXCIsICh0aGlzUG9wdXApID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHZhciBfYjtcbiAgICBjb25zdCB0YWdJZCA9IHRoaXNQb3B1cC5wYXJhbWV0ZXJzWzBdO1xuICAgIExvYWRlci5zaG93KCk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmRlbGV0ZVRhZ1BlcnNvbmFsQmVzdCh0YWdJZCk7XG4gICAgTG9hZGVyLmhpZGUoKTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGRlbGV0ZSB0YWcncyBQQjogXCIgKyByZXNwb25zZS5tZXNzYWdlKTtcbiAgICB9XG4gICAgaWYgKHJlc3BvbnNlLmRhdGEucmVzdWx0Q29kZSA9PT0gMSkge1xuICAgICAgICBjb25zdCB0YWcgPSAoX2IgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5maWx0ZXIoKHQpID0+IHQuX2lkID09PSB0YWdJZClbMF07XG4gICAgICAgIGlmICh0YWcgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGFnLnBlcnNvbmFsQmVzdHMgPSB7XG4gICAgICAgICAgICB0aW1lOiB7fSxcbiAgICAgICAgICAgIHdvcmRzOiB7fSxcbiAgICAgICAgICAgIHplbjogeyB6ZW46IFtdIH0sXG4gICAgICAgICAgICBxdW90ZTogeyBjdXN0b206IFtdIH0sXG4gICAgICAgICAgICBjdXN0b206IHsgY3VzdG9tOiBbXSB9LFxuICAgICAgICB9O1xuICAgICAgICAkKGAucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRhZ3MgLnRhZ3NMaXN0IC50YWdbaWQ9XCIke3RhZ0lkfVwiXSAuY2xlYXJQYkJ1dHRvbmApLmF0dHIoXCJhcmlhLWxhYmVsXCIsIFwiTm8gUEIgZm91bmRcIik7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiVGFnIFBCIGNsZWFyZWQuXCIsIDApO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJTb21ldGhpbmcgd2VudCB3cm9uZzogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgfVxufSksICh0aGlzUG9wdXApID0+IHtcbiAgICB0aGlzUG9wdXAudGV4dCA9IGBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gY2xlYXIgUEIgZm9yIHRhZyAke3RoaXNQb3B1cC5wYXJhbWV0ZXJzWzFdfT9gO1xufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSk7XG5leHBvcnRzLmxpc3RbXCJhcHBseUN1c3RvbUZvbnRcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJhcHBseUN1c3RvbUZvbnRcIiwgXCJ0ZXh0XCIsIFwiQ3VzdG9tIGZvbnRcIiwgW3sgcGxhY2Vob2xkZXI6IFwiRm9udCBuYW1lXCIsIGluaXRWYWw6IFwiXCIgfV0sIFwiTWFrZSBzdXJlIHlvdSBoYXZlIHRoZSBmb250IGluc3RhbGxlZCBvbiB5b3VyIGNvbXB1dGVyIGJlZm9yZSBhcHBseWluZy5cIiwgXCJBcHBseVwiLCAoX3RoaXNQb3B1cCwgZm9udE5hbWUpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKGZvbnROYW1lID09PSBcIlwiKVxuICAgICAgICByZXR1cm47XG4gICAgKF9hID0gU2V0dGluZ3MuZ3JvdXBzW1wiZm9udEZhbWlseVwiXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldFZhbHVlKGZvbnROYW1lLnJlcGxhY2UoL1xccy9nLCBcIl9cIikpO1xufSwgKCkgPT4ge1xuICAgIC8vXG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59KTtcbmV4cG9ydHMubGlzdFtcInJlc2V0UGVyc29uYWxCZXN0c1wiXSA9IG5ldyBTaW1wbGVQb3B1cChcInJlc2V0UGVyc29uYWxCZXN0c1wiLCBcInRleHRcIiwgXCJSZXNldCBQZXJzb25hbCBCZXN0c1wiLCBbXG4gICAge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJQYXNzd29yZFwiLFxuICAgICAgICB0eXBlOiBcInBhc3N3b3JkXCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbl0sIFwiXCIsIFwiUmVzZXRcIiwgKF90aGlzUG9wdXAsIHBhc3N3b3JkKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB1c2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgICAgICBpZiAodXNlciA9PT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKHVzZXIucHJvdmlkZXJEYXRhWzBdLnByb3ZpZGVySWQgPT09IFwicGFzc3dvcmRcIikge1xuICAgICAgICAgICAgY29uc3QgY3JlZGVudGlhbCA9IGF1dGhfMS5FbWFpbEF1dGhQcm92aWRlci5jcmVkZW50aWFsKHVzZXIuZW1haWwsIHBhc3N3b3JkKTtcbiAgICAgICAgICAgIHlpZWxkICgwLCBhdXRoXzEucmVhdXRoZW50aWNhdGVXaXRoQ3JlZGVudGlhbCkodXNlciwgY3JlZGVudGlhbCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodXNlci5wcm92aWRlckRhdGFbMF0ucHJvdmlkZXJJZCA9PT0gXCJnb29nbGUuY29tXCIpIHtcbiAgICAgICAgICAgIHlpZWxkICgwLCBhdXRoXzEucmVhdXRoZW50aWNhdGVXaXRoUG9wdXApKHVzZXIsIEFjY291bnRDb250cm9sbGVyLmdtYWlsUHJvdmlkZXIpO1xuICAgICAgICB9XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5kZWxldGVQZXJzb25hbEJlc3RzKCk7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHJlc2V0IHBlcnNvbmFsIGJlc3RzOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlBlcnNvbmFsIGJlc3RzIGhhdmUgYmVlbiByZXNldFwiLCAxKTtcbiAgICAgICAgREIuZ2V0U25hcHNob3QoKS5wZXJzb25hbEJlc3RzID0ge1xuICAgICAgICAgICAgdGltZToge30sXG4gICAgICAgICAgICB3b3Jkczoge30sXG4gICAgICAgICAgICB6ZW46IHsgemVuOiBbXSB9LFxuICAgICAgICAgICAgcXVvdGU6IHsgY3VzdG9tOiBbXSB9LFxuICAgICAgICAgICAgY3VzdG9tOiB7IGN1c3RvbTogW10gfSxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoZSwgLTEpO1xuICAgIH1cbn0pLCAodGhpc1BvcHVwKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICBpZiAodXNlciA9PT0gbnVsbClcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmICh1c2VyLnByb3ZpZGVyRGF0YVswXS5wcm92aWRlcklkID09PSBcImdvb2dsZS5jb21cIikge1xuICAgICAgICB0aGlzUG9wdXAuaW5wdXRzID0gW107XG4gICAgICAgIHRoaXNQb3B1cC5idXR0b25UZXh0ID0gXCJSZWF1dGhlbnRpY2F0ZSB0byByZXNldFwiO1xuICAgIH1cbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0pO1xuZXhwb3J0cy5saXN0W1wicmVzZXRTZXR0aW5nc1wiXSA9IG5ldyBTaW1wbGVQb3B1cChcInJlc2V0U2V0dGluZ3NcIiwgXCJ0ZXh0XCIsIFwiUmVzZXQgU2V0dGluZ3NcIiwgW10sIFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHJlc2V0IGFsbCB5b3VyIHNldHRpbmdzP1wiLCBcIlJlc2V0XCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcucmVzZXQoKTtcbiAgICAvLyBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAvLyAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICAgIC8vIH0sIDEwMDApO1xufSwgKCkgPT4ge1xuICAgIC8vXG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59KTtcbmV4cG9ydHMubGlzdFtcInVubGlua0Rpc2NvcmRcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJ1bmxpbmtEaXNjb3JkXCIsIFwidGV4dFwiLCBcIlVubGluayBEaXNjb3JkXCIsIFtdLCBcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byB1bmxpbmsgeW91ciBEaXNjb3JkIGFjY291bnQ/XCIsIFwiVW5saW5rXCIsICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIExvYWRlci5zaG93KCk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLnVubGlua0Rpc2NvcmQoKTtcbiAgICBMb2FkZXIuaGlkZSgpO1xuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gdW5saW5rIERpc2NvcmQ6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgIH1cbiAgICBOb3RpZmljYXRpb25zLmFkZChcIkFjY291bnRzIHVubGlua2VkXCIsIDEpO1xuICAgIERCLmdldFNuYXBzaG90KCkuZGlzY29yZElkID0gdW5kZWZpbmVkO1xuICAgIFNldHRpbmdzLnVwZGF0ZURpc2NvcmRTZWN0aW9uKCk7XG59KSwgKCkgPT4ge1xuICAgIC8vXG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59KTtcbmV4cG9ydHMubGlzdFtcImdlbmVyYXRlQXBlS2V5XCJdID0gbmV3IFNpbXBsZVBvcHVwKFwiZ2VuZXJhdGVBcGVLZXlcIiwgXCJ0ZXh0XCIsIFwiR2VuZXJhdGUgbmV3IGtleVwiLCBbXG4gICAge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJOYW1lXCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbl0sIFwiXCIsIFwiR2VuZXJhdGVcIiwgKF90aGlzUG9wdXAsIG5hbWUpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIExvYWRlci5zaG93KCk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LmFwZUtleXMuZ2VuZXJhdGUobmFtZSwgZmFsc2UpO1xuICAgIExvYWRlci5oaWRlKCk7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBnZW5lcmF0ZSBrZXk6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIGV4cG9ydHMubGlzdFtcInZpZXdBcGVLZXlcIl0uc2hvdyhbZGF0YS5hcGVLZXldKTtcbiAgICB9XG59KSwgKCkgPT4ge1xuICAgIC8vXG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59KTtcbmV4cG9ydHMubGlzdFtcInZpZXdBcGVLZXlcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJ2aWV3QXBlS2V5XCIsIFwidGV4dFwiLCBcIkFwZSBLZXlcIiwgW1xuICAgIHtcbiAgICAgICAgdHlwZTogXCJ0ZXh0YXJlYVwiLFxuICAgICAgICBkaXNhYmxlZDogdHJ1ZSxcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiS2V5XCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbl0sIFwiVGhpcyBpcyB5b3VyIG5ldyBBcGUgS2V5LiBQbGVhc2Uga2VlcCBpdCBzYWZlLiBZb3Ugd2lsbCBvbmx5IHNlZSBpdCBvbmNlIVwiLCBcIkNsb3NlXCIsIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgQXBlS2V5c1BvcHVwLnNob3coKTtcbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgX3RoaXNQb3B1cC5pbnB1dHNbMF0uaW5pdFZhbCA9IF90aGlzUG9wdXAucGFyYW1ldGVyc1swXTtcbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgX3RoaXNQb3B1cC5jYW5DbG9zZSA9IGZhbHNlO1xuICAgICQoXCIjc2ltcGxlUG9wdXAgdGV4dGFyZWFcIikuY3NzKFwiaGVpZ2h0XCIsIFwiMTEwcHhcIik7XG4gICAgJChcIiNzaW1wbGVQb3B1cCAuYnV0dG9uXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBfdGhpc1BvcHVwLmNhbkNsb3NlID0gdHJ1ZTtcbiAgICAgICAgJChcIiNzaW1wbGVQb3B1cCAuYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0sIDMwMDApO1xufSk7XG5leHBvcnRzLmxpc3RbXCJkZWxldGVBcGVLZXlcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJkZWxldGVBcGVLZXlcIiwgXCJ0ZXh0XCIsIFwiRGVsZXRlIEFwZSBLZXlcIiwgW10sIFwiQXJlIHlvdSBzdXJlP1wiLCBcIkRlbGV0ZVwiLCAoX3RoaXNQb3B1cCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgTG9hZGVyLnNob3coKTtcbiAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQuYXBlS2V5cy5kZWxldGUoX3RoaXNQb3B1cC5wYXJhbWV0ZXJzWzBdKTtcbiAgICBMb2FkZXIuaGlkZSgpO1xuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gZGVsZXRlIGtleTogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgfVxuICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiS2V5IGRlbGV0ZWRcIiwgMSk7XG4gICAgQXBlS2V5c1BvcHVwLnNob3coKTtcbn0pLCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59KTtcbmV4cG9ydHMubGlzdFtcImVkaXRBcGVLZXlcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJlZGl0QXBlS2V5XCIsIFwidGV4dFwiLCBcIkVkaXQgQXBlIEtleVwiLCBbXG4gICAge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJOYW1lXCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbl0sIFwiXCIsIFwiRWRpdFwiLCAoX3RoaXNQb3B1cCwgaW5wdXQpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIExvYWRlci5zaG93KCk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LmFwZUtleXMudXBkYXRlKF90aGlzUG9wdXAucGFyYW1ldGVyc1swXSwge1xuICAgICAgICBuYW1lOiBpbnB1dCxcbiAgICB9KTtcbiAgICBMb2FkZXIuaGlkZSgpO1xuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gdXBkYXRlIGtleTogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgfVxuICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiS2V5IHVwZGF0ZWRcIiwgMSk7XG4gICAgQXBlS2V5c1BvcHVwLnNob3coKTtcbn0pLCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59KTtcbmV4cG9ydHMubGlzdFtcInNhdmVDdXN0b21UZXh0XCJdID0gbmV3IFNpbXBsZVBvcHVwKFwic2F2ZUN1c3RvbVRleHRcIiwgXCJ0ZXh0XCIsIFwiU2F2ZSBjdXN0b20gdGV4dFwiLCBbXG4gICAge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJOYW1lXCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbl0sIFwiXCIsIFwiU2F2ZVwiLCAoX3RoaXNQb3B1cCwgaW5wdXQpID0+IHtcbiAgICBjb25zdCB0ZXh0ID0gJChgI2N1c3RvbVRleHRQb3B1cCB0ZXh0YXJlYWApLnZhbCgpLm5vcm1hbGl6ZSgpO1xuICAgIEN1c3RvbVRleHQuc2V0Q3VzdG9tVGV4dChpbnB1dCwgdGV4dCk7XG4gICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDdXN0b20gdGV4dCBzYXZlZFwiLCAxKTtcbiAgICBDdXN0b21UZXh0UG9wdXAuc2hvdygpO1xufSwgKCkgPT4ge1xuICAgIC8vXG59LCAoKSA9PiB7XG4gICAgLy9cbn0pO1xuZXhwb3J0cy5saXN0W1wiZGVsZXRlQ3VzdG9tVGV4dFwiXSA9IG5ldyBTaW1wbGVQb3B1cChcImRlbGV0ZUN1c3RvbVRleHRcIiwgXCJ0ZXh0XCIsIFwiRGVsZXRlIGN1c3RvbSB0ZXh0XCIsIFtdLCBcIkFyZSB5b3Ugc3VyZT9cIiwgXCJEZWxldGVcIiwgKF90aGlzUG9wdXApID0+IHtcbiAgICBDdXN0b21UZXh0LmRlbGV0ZUN1c3RvbVRleHQoX3RoaXNQb3B1cC5wYXJhbWV0ZXJzWzBdKTtcbiAgICBOb3RpZmljYXRpb25zLmFkZChcIkN1c3RvbSB0ZXh0IGRlbGV0ZWRcIiwgMSk7XG4gICAgU2F2ZWRUZXh0c1BvcHVwLnNob3coKTtcbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgX3RoaXNQb3B1cC50ZXh0ID0gYEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgY3VzdG9tIHRleHQgJHtfdGhpc1BvcHVwLnBhcmFtZXRlcnNbMF19P2A7XG59LCAoKSA9PiB7XG4gICAgLy9cbn0pO1xuZXhwb3J0cy5saXN0W1widXBkYXRlQ3VzdG9tVGhlbWVcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJ1cGRhdGVDdXN0b21UaGVtZVwiLCBcInRleHRcIiwgXCJVcGRhdGUgQ3VzdG9tIFRoZW1lXCIsIFtcbiAgICB7XG4gICAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgICBwbGFjZWhvbGRlcjogXCJOYW1lXCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgICAgaW5pdFZhbDogXCJmYWxzZVwiLFxuICAgICAgICBsYWJlbDogXCJVcGRhdGUgY3VzdG9tIHRoZW1lIHRvIGN1cnJlbnQgY29sb3JzXCIsXG4gICAgfSxcbl0sIFwiXCIsIFwiVXBkYXRlXCIsIChfdGhpc1BvcHVwLCBuYW1lLCB1cGRhdGVDb2xvcnMpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIGNvbnN0IHNuYXBzaG90ID0gREIuZ2V0U25hcHNob3QoKTtcbiAgICBjb25zdCBjdXN0b21UaGVtZSA9IHNuYXBzaG90LmN1c3RvbVRoZW1lcy5maW5kKCh0KSA9PiB0Ll9pZCA9PT0gX3RoaXNQb3B1cC5wYXJhbWV0ZXJzWzBdKTtcbiAgICBpZiAoY3VzdG9tVGhlbWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkN1c3RvbSB0aGVtZSBkb2VzIG5vdCBleGlzdCFcIiwgLTEpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCBuZXdDb2xvcnMgPSBbXTtcbiAgICBpZiAodXBkYXRlQ29sb3JzID09PSBcInRydWVcIikge1xuICAgICAgICAkLmVhY2goJChcIi5wYWdlU2V0dGluZ3MgLmN1c3RvbVRoZW1lIC5jdXN0b21UaGVtZUVkaXQgW3R5cGU9J2NvbG9yJ11cIiksIChfaW5kZXgsIGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgIG5ld0NvbG9ycy5wdXNoKCQoZWxlbWVudCkuYXR0cihcInZhbHVlXCIpKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBuZXdDb2xvcnMgPSBjdXN0b21UaGVtZS5jb2xvcnM7XG4gICAgfVxuICAgIGNvbnN0IG5ld1RoZW1lID0ge1xuICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICBjb2xvcnM6IG5ld0NvbG9ycyxcbiAgICB9O1xuICAgIExvYWRlci5zaG93KCk7XG4gICAgeWllbGQgREIuZWRpdEN1c3RvbVRoZW1lKGN1c3RvbVRoZW1lLl9pZCwgbmV3VGhlbWUpO1xuICAgIExvYWRlci5oaWRlKCk7XG4gICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lQ29sb3JzKG5ld0NvbG9ycyk7XG4gICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDdXN0b20gdGhlbWUgdXBkYXRlZFwiLCAxKTtcbiAgICBUaGVtZVBpY2tlci5yZWZyZXNoQnV0dG9ucygpO1xufSksIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgY29uc3Qgc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdCgpO1xuICAgIGNvbnN0IGN1c3RvbVRoZW1lID0gc25hcHNob3QuY3VzdG9tVGhlbWVzLmZpbmQoKHQpID0+IHQuX2lkID09PSBfdGhpc1BvcHVwLnBhcmFtZXRlcnNbMF0pO1xuICAgIGlmICghY3VzdG9tVGhlbWUpXG4gICAgICAgIHJldHVybjtcbiAgICBfdGhpc1BvcHVwLmlucHV0c1swXS5pbml0VmFsID0gY3VzdG9tVGhlbWUubmFtZTtcbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0pO1xuZXhwb3J0cy5saXN0W1wiZGVsZXRlQ3VzdG9tVGhlbWVcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJkZWxldGVDdXN0b21UaGVtZVwiLCBcInRleHRcIiwgXCJEZWxldGUgQ3VzdG9tIFRoZW1lXCIsIFtdLCBcIkFyZSB5b3Ugc3VyZT9cIiwgXCJEZWxldGVcIiwgKF90aGlzUG9wdXApID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIExvYWRlci5zaG93KCk7XG4gICAgeWllbGQgREIuZGVsZXRlQ3VzdG9tVGhlbWUoX3RoaXNQb3B1cC5wYXJhbWV0ZXJzWzBdKTtcbiAgICBMb2FkZXIuaGlkZSgpO1xuICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ3VzdG9tIHRoZW1lIGRlbGV0ZWRcIiwgMSk7XG4gICAgVGhlbWVQaWNrZXIucmVmcmVzaEJ1dHRvbnMoKTtcbn0pLCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59KTtcbiQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmRpc2NvcmRJbnRlZ3JhdGlvbiAjdW5saW5rRGlzY29yZEJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBleHBvcnRzLmxpc3RbXCJ1bmxpbmtEaXNjb3JkXCJdLnNob3coKTtcbn0pO1xuJChcIiNyZXNldFNldHRpbmdzQnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGV4cG9ydHMubGlzdFtcInJlc2V0U2V0dGluZ3NcIl0uc2hvdygpO1xufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAjcmVzZXRQZXJzb25hbEJlc3RzQnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGV4cG9ydHMubGlzdFtcInJlc2V0UGVyc29uYWxCZXN0c1wiXS5zaG93KCk7XG59KTtcbiQoXCIucGFnZVNldHRpbmdzICN1cGRhdGVBY2NvdW50TmFtZVwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBleHBvcnRzLmxpc3RbXCJ1cGRhdGVOYW1lXCJdLnNob3coKTtcbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgI2FkZFBhc3N3b3JkQXV0aFwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBleHBvcnRzLmxpc3RbXCJhZGRQYXNzd29yZEF1dGhcIl0uc2hvdygpO1xufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAjZW1haWxQYXNzd29yZEF1dGhcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgZXhwb3J0cy5saXN0W1widXBkYXRlRW1haWxcIl0uc2hvdygpO1xufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAjcGFzc1Bhc3N3b3JkQXV0aFwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBleHBvcnRzLmxpc3RbXCJ1cGRhdGVQYXNzd29yZFwiXS5zaG93KCk7XG59KTtcbiQoXCIucGFnZVNldHRpbmdzICNkZWxldGVBY2NvdW50XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGV4cG9ydHMubGlzdFtcImRlbGV0ZUFjY291bnRcIl0uc2hvdygpO1xufSk7XG4kKFwiI2FwZUtleXNQb3B1cCAuZ2VuZXJhdGVBcGVLZXlcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgZXhwb3J0cy5saXN0W1wiZ2VuZXJhdGVBcGVLZXlcIl0uc2hvdygpO1xufSk7XG4kKGAjY3VzdG9tVGV4dFBvcHVwIC5idXR0b25zVG9wIC5zYXZlQ3VzdG9tVGV4dGApLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGV4cG9ydHMubGlzdFtcInNhdmVDdXN0b21UZXh0XCJdLnNob3coKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC5jdXN0b21UaGVtZSAuZGVsQnV0dG9uXCIsIChlKSA9PiB7XG4gICAgY29uc3QgJHBhcmVudEVsZW1lbnQgPSAkKGUuY3VycmVudFRhcmdldCkucGFyZW50KFwiLmN1c3RvbVRoZW1lLmJ1dHRvblwiKTtcbiAgICBjb25zdCBjdXN0b21UaGVtZUlkID0gJHBhcmVudEVsZW1lbnQuYXR0cihcImN1c3RvbVRoZW1lSWRcIik7XG4gICAgZXhwb3J0cy5saXN0W1wiZGVsZXRlQ3VzdG9tVGhlbWVcIl0uc2hvdyhbY3VzdG9tVGhlbWVJZF0pO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLmN1c3RvbVRoZW1lIC5lZGl0QnV0dG9uXCIsIChlKSA9PiB7XG4gICAgY29uc3QgJHBhcmVudEVsZW1lbnQgPSAkKGUuY3VycmVudFRhcmdldCkucGFyZW50KFwiLmN1c3RvbVRoZW1lLmJ1dHRvblwiKTtcbiAgICBjb25zdCBjdXN0b21UaGVtZUlkID0gJHBhcmVudEVsZW1lbnQuYXR0cihcImN1c3RvbVRoZW1lSWRcIik7XG4gICAgZXhwb3J0cy5saXN0W1widXBkYXRlQ3VzdG9tVGhlbWVcIl0uc2hvdyhbY3VzdG9tVGhlbWVJZF0pO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIGAjc2F2ZWRUZXh0c1BvcHVwV3JhcHBlciAubGlzdCAuc2F2ZWRUZXh0IC5idXR0b24uZGVsZXRlYCwgKGUpID0+IHtcbiAgICBjb25zdCBuYW1lID0gJChlLnRhcmdldCkuc2libGluZ3MoXCIuYnV0dG9uLm5hbWVcIikudGV4dCgpO1xuICAgIGV4cG9ydHMubGlzdFtcImRlbGV0ZUN1c3RvbVRleHRcIl0uc2hvdyhbbmFtZV0pO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI2FwZUtleXNQb3B1cCB0YWJsZSB0Ym9keSB0ciAuYnV0dG9uLmRlbGV0ZVwiLCAoZSkgPT4ge1xuICAgIGNvbnN0IGtleUlkID0gJChlLnRhcmdldCkuY2xvc2VzdChcInRyXCIpLmF0dHIoXCJrZXlJZFwiKTtcbiAgICBleHBvcnRzLmxpc3RbXCJkZWxldGVBcGVLZXlcIl0uc2hvdyhba2V5SWRdKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNhcGVLZXlzUG9wdXAgdGFibGUgdGJvZHkgdHIgLmJ1dHRvbi5lZGl0XCIsIChlKSA9PiB7XG4gICAgY29uc3Qga2V5SWQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KFwidHJcIikuYXR0cihcImtleUlkXCIpO1xuICAgIGV4cG9ydHMubGlzdFtcImVkaXRBcGVLZXlcIl0uc2hvdyhba2V5SWRdKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZm9udEZhbWlseSAuYnV0dG9uLmN1c3RvbVwiLCAoKSA9PiB7XG4gICAgZXhwb3J0cy5saXN0W1wiYXBwbHlDdXN0b21Gb250XCJdLnNob3coW10pO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImtleWRvd25cIiwgKGV2ZW50KSA9PiB7XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFc2NhcGVcIiAmJiAhJChcIiNzaW1wbGVQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IENvbW1hbmRsaW5lID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9jb21tYW5kbGluZVwiKSk7XG5jb25zdCBDb21tYW5kbGluZUxpc3RzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9jb21tYW5kbGluZS1saXN0c1wiKSk7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIjc3VwcG9ydE1lQnV0dG9uXCIsICgpID0+IHtcbiAgICAkKFwiI3N1cHBvcnRNZVdyYXBwZXJcIilcbiAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMjUpO1xufSk7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIjc3VwcG9ydE1lV3JhcHBlclwiLCAoKSA9PiB7XG4gICAgJChcIiNzdXBwb3J0TWVXcmFwcGVyXCIpXG4gICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMCB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgJChcIiNzdXBwb3J0TWVXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xufSk7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIjc3VwcG9ydE1lV3JhcHBlciAuYnV0dG9uLmFkc1wiLCAoKSA9PiB7XG4gICAgQ29tbWFuZGxpbmVMaXN0cy5wdXNoQ3VycmVudChDb21tYW5kbGluZUxpc3RzLmNvbW1hbmRzRW5hYmxlQWRzKTtcbiAgICBDb21tYW5kbGluZS5zaG93KCk7XG4gICAgJChcIiNzdXBwb3J0TWVXcmFwcGVyXCIpXG4gICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMCB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgJChcIiNzdXBwb3J0TWVXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xufSk7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIjc3VwcG9ydE1lV3JhcHBlciBhLmJ1dHRvblwiLCAoKSA9PiB7XG4gICAgJChcIiNzdXBwb3J0TWVXcmFwcGVyXCIpXG4gICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMCB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgJChcIiNzdXBwb3J0TWVXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgJChcIiN2ZXJzaW9uSGlzdG9yeVdyYXBwZXJcIilcbiAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMjUpO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbiQoZG9jdW1lbnQuYm9keSkub24oXCJjbGlja1wiLCBcIi52ZXJzaW9uXCIsIChlKSA9PiB7XG4gICAgaWYgKGUuc2hpZnRLZXkpXG4gICAgICAgIHJldHVybjtcbiAgICBzaG93KCk7XG59KTtcbiQoZG9jdW1lbnQuYm9keSkub24oXCJjbGlja1wiLCBcIiN2ZXJzaW9uSGlzdG9yeVdyYXBwZXJcIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcInZlcnNpb25IaXN0b3J5V3JhcHBlclwiKSB7XG4gICAgICAgICQoXCIjdmVyc2lvbkhpc3RvcnlXcmFwcGVyXCIpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAwIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiN2ZXJzaW9uSGlzdG9yeVdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBDdXN0b21UZXh0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2N1c3RvbS10ZXh0XCIpKTtcbmxldCBpbml0aWFsaXNlZCA9IGZhbHNlO1xuZnVuY3Rpb24gaW5pdCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoIWluaXRpYWxpc2VkKSB7XG4gICAgICAgICAgICAkKFwiI3dvcmRGaWx0ZXJQb3B1cCAubGFuZ3VhZ2VJbnB1dFwiKS5lbXB0eSgpO1xuICAgICAgICAgICAgY29uc3QgTGFuZ3VhZ2VMaXN0ID0geWllbGQgTWlzYy5nZXRMYW5ndWFnZUxpc3QoKTtcbiAgICAgICAgICAgIExhbmd1YWdlTGlzdC5mb3JFYWNoKChsYW5ndWFnZSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBwcmV0dHlMYW5nID0gbGFuZ3VhZ2U7XG4gICAgICAgICAgICAgICAgcHJldHR5TGFuZyA9IHByZXR0eUxhbmcucmVwbGFjZShcIl9cIiwgXCIgXCIpO1xuICAgICAgICAgICAgICAgICQoXCIjd29yZEZpbHRlclBvcHVwIC5sYW5ndWFnZUlucHV0XCIpLmFwcGVuZChgXG4gICAgICAgIDxvcHRpb24gdmFsdWU9JHtsYW5ndWFnZX0+JHtwcmV0dHlMYW5nfTwvb3B0aW9uPlxuICAgICAgYCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGluaXRpYWxpc2VkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZnVuY3Rpb24gc2hvdygpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICB5aWVsZCBpbml0KCk7XG4gICAgICAgICQoXCIjd29yZEZpbHRlclBvcHVwV3JhcHBlclwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiNjdXN0b21UZXh0UG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI3dvcmRGaWx0ZXJQb3B1cCAubGFuZ3VhZ2VJbnB1dFwiKS5zZWxlY3QyKHtcbiAgICAgICAgICAgIHdpZHRoOiBcIjEwMCVcIixcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAkKFwiI3dvcmRGaWx0ZXJQb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgJChcIiNjdXN0b21UZXh0UG9wdXBXcmFwcGVyXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xufVxuZnVuY3Rpb24gZmlsdGVyKGxhbmd1YWdlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgbGV0IGZpbHRlcmluID0gJChcIiN3b3JkRmlsdGVyUG9wdXAgLndvcmRJbmNsdWRlSW5wdXRcIikudmFsKCk7XG4gICAgICAgIGZpbHRlcmluID0gTWlzYy5lc2NhcGVSZWdFeHAoZmlsdGVyaW4gPT09IG51bGwgfHwgZmlsdGVyaW4gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpbHRlcmluLnRyaW0oKSk7XG4gICAgICAgIGZpbHRlcmluID0gZmlsdGVyaW4ucmVwbGFjZSgvXFxzKy9naSwgXCJ8XCIpO1xuICAgICAgICBjb25zdCByZWdpbmNsID0gbmV3IFJlZ0V4cChmaWx0ZXJpbiwgXCJpXCIpO1xuICAgICAgICBsZXQgZmlsdGVyb3V0ID0gJChcIiN3b3JkRmlsdGVyUG9wdXAgLndvcmRFeGNsdWRlSW5wdXRcIikudmFsKCk7XG4gICAgICAgIGZpbHRlcm91dCA9IE1pc2MuZXNjYXBlUmVnRXhwKGZpbHRlcm91dC50cmltKCkpO1xuICAgICAgICBmaWx0ZXJvdXQgPSBmaWx0ZXJvdXQucmVwbGFjZSgvXFxzKy9naSwgXCJ8XCIpO1xuICAgICAgICBjb25zdCByZWdleGNsID0gbmV3IFJlZ0V4cChmaWx0ZXJvdXQsIFwiaVwiKTtcbiAgICAgICAgY29uc3QgZmlsdGVyZWRXb3JkcyA9IFtdO1xuICAgICAgICBjb25zdCBsYW5ndWFnZVdvcmRMaXN0ID0geWllbGQgTWlzYy5nZXRMYW5ndWFnZShsYW5ndWFnZSk7XG4gICAgICAgIGNvbnN0IG1heExlbmd0aElucHV0ID0gJChcIiN3b3JkRmlsdGVyUG9wdXAgLndvcmRNYXhJbnB1dFwiKS52YWwoKTtcbiAgICAgICAgY29uc3QgbWluTGVuZ3RoSW5wdXQgPSAkKFwiI3dvcmRGaWx0ZXJQb3B1cCAud29yZE1pbklucHV0XCIpLnZhbCgpO1xuICAgICAgICBsZXQgbWF4TGVuZ3RoO1xuICAgICAgICBsZXQgbWluTGVuZ3RoO1xuICAgICAgICBpZiAobWF4TGVuZ3RoSW5wdXQgPT0gXCJcIikge1xuICAgICAgICAgICAgbWF4TGVuZ3RoID0gOTk5O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbWF4TGVuZ3RoID0gcGFyc2VJbnQobWF4TGVuZ3RoSW5wdXQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtaW5MZW5ndGhJbnB1dCA9PSBcIlwiKSB7XG4gICAgICAgICAgICBtaW5MZW5ndGggPSAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbWluTGVuZ3RoID0gcGFyc2VJbnQobWluTGVuZ3RoSW5wdXQpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGFuZ3VhZ2VXb3JkTGlzdC53b3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3Qgd29yZCA9IGxhbmd1YWdlV29yZExpc3Qud29yZHNbaV07XG4gICAgICAgICAgICBjb25zdCB0ZXN0MSA9IHJlZ2luY2wudGVzdCh3b3JkKTtcbiAgICAgICAgICAgIGNvbnN0IHRlc3QyID0gcmVnZXhjbC50ZXN0KHdvcmQpO1xuICAgICAgICAgICAgaWYgKCgodGVzdDEgJiYgIXRlc3QyKSB8fCAodGVzdDEgJiYgZmlsdGVyb3V0ID09IFwiXCIpKSAmJlxuICAgICAgICAgICAgICAgIHdvcmQubGVuZ3RoIDw9IG1heExlbmd0aCAmJlxuICAgICAgICAgICAgICAgIHdvcmQubGVuZ3RoID49IG1pbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGZpbHRlcmVkV29yZHMucHVzaCh3b3JkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmlsdGVyZWRXb3JkcztcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGFwcGx5KHNldCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IGxhbmd1YWdlID0gJChcIiN3b3JkRmlsdGVyUG9wdXAgLmxhbmd1YWdlSW5wdXRcIikudmFsKCk7XG4gICAgICAgIGNvbnN0IGZpbHRlcmVkV29yZHMgPSB5aWVsZCBmaWx0ZXIobGFuZ3VhZ2UpO1xuICAgICAgICBjb25zdCBjdXN0b21UZXh0ID0gZmlsdGVyZWRXb3Jkcy5qb2luKEN1c3RvbVRleHQuZGVsaW1pdGVyKTtcbiAgICAgICAgJChcIiNjdXN0b21UZXh0UG9wdXAgdGV4dGFyZWFcIikudmFsKChfLCB2YWwpID0+IChzZXQgPyBcIlwiIDogdmFsICsgXCIgXCIpICsgY3VzdG9tVGV4dCk7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9KTtcbn1cbiQoXCIjd29yZEZpbHRlclBvcHVwV3JhcHBlclwiKS5tb3VzZWRvd24oKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcIndvcmRGaWx0ZXJQb3B1cFdyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4kKFwiI3dvcmRGaWx0ZXJQb3B1cCAubGFuZ3VhZ2VJbnB1dFwiKS5vbmUoXCJzZWxlY3QyOm9wZW5cIiwgZnVuY3Rpb24gKCkge1xuICAgICQoXCJpbnB1dC5zZWxlY3QyLXNlYXJjaF9fZmllbGRcIikucHJvcChcInBsYWNlaG9sZGVyXCIsIFwic2VhcmNoXCIpO1xufSk7XG4kKFwiI3dvcmRGaWx0ZXJQb3B1cFdyYXBwZXIgLmJ1dHRvblwiKS5tb3VzZWRvd24oKGUpID0+IHtcbiAgICAkKFwiI3dvcmRGaWx0ZXJQb3B1cFdyYXBwZXIgLmxvYWRpbmdJbmRpY2F0b3JcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgJChcIiN3b3JkRmlsdGVyUG9wdXBXcmFwcGVyIC5idXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGFwcGx5KCQoZS50YXJnZXQpLmlzKFwiI3NldFwiKSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3dvcmRGaWx0ZXJQb3B1cFdyYXBwZXIgLmxvYWRpbmdJbmRpY2F0b3JcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiI3dvcmRGaWx0ZXJQb3B1cFdyYXBwZXIgLmJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfSwgMSk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBNYW51YWxSZXN0YXJ0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QvbWFudWFsLXJlc3RhcnQtdHJhY2tlclwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jb25maWdcIikpLCBVcGRhdGVDb25maWcgPSBjb25maWdfMTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBWZXJpZmljYXRpb25Db250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2NvbnRyb2xsZXJzL3ZlcmlmaWNhdGlvbi1jb250cm9sbGVyXCIpKTtcbmNvbnN0IFJvdXRlQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jb250cm9sbGVycy9yb3V0ZS1jb250cm9sbGVyXCIpKTtcbmNvbnN0IFBhZ2VDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2NvbnRyb2xsZXJzL3BhZ2UtY29udHJvbGxlclwiKSk7XG5jb25zdCBNb25rZXlQb3dlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9lbGVtZW50cy9tb25rZXktcG93ZXJcIikpO1xuY29uc3QgTmV3VmVyc2lvbk5vdGlmaWNhdGlvbiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9lbGVtZW50cy92ZXJzaW9uLWNoZWNrXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBGb2N1cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0L2ZvY3VzXCIpKTtcbk1hbnVhbFJlc3RhcnQuc2V0KCk7XG5VcGRhdGVDb25maWcubG9hZEZyb21Mb2NhbFN0b3JhZ2UoKTtcbmlmICh3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgPT09IFwibG9jYWxob3N0XCIpIHtcbiAgICAkKFwiI2JvdHRvbSAudmVyc2lvbiAudGV4dFwiKS50ZXh0KFwibG9jYWxob3N0XCIpO1xuICAgICQoXCIjYm90dG9tIC52ZXJzaW9uXCIpLmNzcyhcIm9wYWNpdHlcIiwgMSk7XG59XG5lbHNlIHtcbiAgICBNaXNjLmdldFJlbGVhc2VzRnJvbUdpdEh1YigpLnRoZW4oKHYpID0+IHtcbiAgICAgICAgTmV3VmVyc2lvbk5vdGlmaWNhdGlvbi5zaG93KHZbMF0ubmFtZSk7XG4gICAgfSk7XG59XG5Gb2N1cy5zZXQodHJ1ZSwgdHJ1ZSk7XG5Sb3V0ZUNvbnRyb2xsZXIuaGFuZGxlSW5pdGlhbFBhZ2VDbGFzc2VzKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSk7XG4kKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG4gICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gXCIvXCIpIHtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZ1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgJChcImJvZHlcIikuY3NzKFwidHJhbnNpdGlvblwiLCBcImFsbCAuMjVzLCB0cmFuc2Zvcm0gLjA1c1wiKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5xdWlja1RhYikge1xuICAgICAgICAkKFwiI3Jlc3RhcnRUZXN0QnV0dG9uXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBpZiAoIXdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcIm1lcmNoYmFubmVyY2xvc2VkXCIpKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkQmFubmVyKGBDaGVja291dCBvdXIgbWVyY2hhbmRpc2UsIGF2YWlsYWJsZSBhdCA8YSB0YXJnZXQ9XCJfYmxhbmtcIiBocmVmPVwiaHR0cHM6Ly9tb25rZXl0eXBlLnN0b3JlL1wiPm1vbmtleXR5cGUuc3RvcmU8L2E+YCwgMSwgXCJpbWFnZXMvbWVyY2hkcm9wd2Vic2l0ZTIucG5nXCIsIGZhbHNlLCAoKSA9PiB7XG4gICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJtZXJjaGJhbm5lcmNsb3NlZFwiLCBcInRydWVcIik7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAkKFwiI2NlbnRlckNvbnRlbnRcIilcbiAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgXCIwXCIpXG4gICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMjUwLCAoKSA9PiB7XG4gICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09IFwiL3ZlcmlmeVwiKSB7XG4gICAgICAgICAgICBjb25zdCBmcmFnbWVudCA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLmhhc2guc2xpY2UoMSkpO1xuICAgICAgICAgICAgaWYgKGZyYWdtZW50LmhhcyhcImFjY2Vzc190b2tlblwiKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gZnJhZ21lbnQuZ2V0KFwiYWNjZXNzX3Rva2VuXCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHRva2VuVHlwZSA9IGZyYWdtZW50LmdldChcInRva2VuX3R5cGVcIik7XG4gICAgICAgICAgICAgICAgVmVyaWZpY2F0aW9uQ29udHJvbGxlci5zZXQoe1xuICAgICAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbjogYWNjZXNzVG9rZW4sXG4gICAgICAgICAgICAgICAgICAgIHRva2VuVHlwZTogdG9rZW5UeXBlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKFwiL1wiLCBcIlwiLCBcIi9cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBwYWdlID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLnJlcGxhY2UoXCIvXCIsIFwiXCIpO1xuICAgICAgICAgICAgUGFnZUNvbnRyb2xsZXIuY2hhbmdlKHBhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gXCIvYWNjb3VudFwiKSB7XG4gICAgICAgICAgICAvLyBoaXN0b3J5LnJlcGxhY2VTdGF0ZShcIi9cIiwgbnVsbCwgXCIvXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKC9jaGFsbGVuZ2VfLisvZy50ZXN0KHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSkpIHtcbiAgICAgICAgICAgIC8vZG8gbm90aGluZ1xuICAgICAgICAgICAgLy8gfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSAhPT0gXCIvXCIpIHtcbiAgICAgICAgICAgIC8vIGxldCBwYWdlID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLnJlcGxhY2UoXCIvXCIsIFwiXCIpO1xuICAgICAgICAgICAgLy8gUGFnZUNvbnRyb2xsZXIuY2hhbmdlKHBhZ2UpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgLy8gU2V0dGluZ3Muc2V0dGluZ3NGaWxsUHJvbWlzZS50aGVuKFNldHRpbmdzLnVwZGF0ZSk7XG4gICAgTW9ua2V5UG93ZXIuaW5pdCgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY2xhc3MgU2V0dGluZ3NHcm91cCB7XG4gICAgY29uc3RydWN0b3IoY29uZmlnTmFtZSwgY29uZmlnRnVuY3Rpb24sIG1vZGUsIHNldENhbGxiYWNrLCB1cGRhdGVDYWxsYmFjaykge1xuICAgICAgICB0aGlzLmNvbmZpZ05hbWUgPSBjb25maWdOYW1lO1xuICAgICAgICB0aGlzLmNvbmZpZ1ZhbHVlID0gY29uZmlnXzEuZGVmYXVsdFtjb25maWdOYW1lXTtcbiAgICAgICAgdGhpcy5tb2RlID0gbW9kZTtcbiAgICAgICAgdGhpcy5jb25maWdGdW5jdGlvbiA9IGNvbmZpZ0Z1bmN0aW9uO1xuICAgICAgICB0aGlzLnNldENhbGxiYWNrID0gc2V0Q2FsbGJhY2s7XG4gICAgICAgIHRoaXMudXBkYXRlQ2FsbGJhY2sgPSB1cGRhdGVDYWxsYmFjaztcbiAgICAgICAgdGhpcy51cGRhdGVJbnB1dCgpO1xuICAgICAgICBpZiAodGhpcy5tb2RlID09PSBcInNlbGVjdFwiKSB7XG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vbihcImNoYW5nZVwiLCBgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi4ke3RoaXMuY29uZmlnTmFtZX0gc2VsZWN0YCwgKGUpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXQgPSAkKGUuY3VycmVudFRhcmdldCk7XG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldC5oYXNDbGFzcyhcImRpc2FibGVkXCIpIHx8XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldC5oYXNDbGFzcyhcIm5vLWF1dG8taGFuZGxlXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZSh0YXJnZXQudmFsKCkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5tb2RlID09PSBcImJ1dHRvblwiKSB7XG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIGAucGFnZVNldHRpbmdzIC5zZWN0aW9uLiR7dGhpcy5jb25maWdOYW1lfSAuYnV0dG9uYCwgKGUpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXQgPSAkKGUuY3VycmVudFRhcmdldCk7XG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldC5oYXNDbGFzcyhcImRpc2FibGVkXCIpIHx8XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldC5oYXNDbGFzcyhcIm5vLWF1dG8taGFuZGxlXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IHZhbHVlID0gdGFyZ2V0LmF0dHIoY29uZmlnTmFtZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgcGFyYW1zID0gdGFyZ2V0LmF0dHIoXCJwYXJhbXNcIik7XG4gICAgICAgICAgICAgICAgaWYgKCF2YWx1ZSAmJiAhcGFyYW1zKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSBcInRydWVcIilcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gXCJmYWxzZVwiKVxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0VmFsdWUodmFsdWUsIHBhcmFtcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXRWYWx1ZSh2YWx1ZSwgcGFyYW1zKSB7XG4gICAgICAgIGlmIChwYXJhbXMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5jb25maWdGdW5jdGlvbih2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZ0Z1bmN0aW9uKHZhbHVlLCAuLi5wYXJhbXMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudXBkYXRlSW5wdXQoKTtcbiAgICAgICAgaWYgKHRoaXMuc2V0Q2FsbGJhY2spXG4gICAgICAgICAgICB0aGlzLnNldENhbGxiYWNrKCk7XG4gICAgfVxuICAgIHVwZGF0ZUlucHV0KCkge1xuICAgICAgICB0aGlzLmNvbmZpZ1ZhbHVlID0gY29uZmlnXzEuZGVmYXVsdFt0aGlzLmNvbmZpZ05hbWVdO1xuICAgICAgICAkKGAucGFnZVNldHRpbmdzIC5zZWN0aW9uLiR7dGhpcy5jb25maWdOYW1lfSAuYnV0dG9uYCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgIGlmICh0aGlzLm1vZGUgPT09IFwic2VsZWN0XCIpIHtcbiAgICAgICAgICAgICQoYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uJHt0aGlzLmNvbmZpZ05hbWV9IHNlbGVjdGApXG4gICAgICAgICAgICAgICAgLnZhbCh0aGlzLmNvbmZpZ1ZhbHVlKVxuICAgICAgICAgICAgICAgIC50cmlnZ2VyKFwiY2hhbmdlLnNlbGVjdDJcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5tb2RlID09PSBcImJ1dHRvblwiKSB7XG4gICAgICAgICAgICAkKGAucGFnZVNldHRpbmdzIC5zZWN0aW9uLiR7dGhpcy5jb25maWdOYW1lfSAuYnV0dG9uWyR7dGhpcy5jb25maWdOYW1lfT0nJHt0aGlzLmNvbmZpZ1ZhbHVlfSddYCkuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudXBkYXRlQ2FsbGJhY2spXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUNhbGxiYWNrKCk7XG4gICAgfVxufVxuZXhwb3J0cy5kZWZhdWx0ID0gU2V0dGluZ3NHcm91cDtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudXBkYXRlQWN0aXZlVGFiID0gZXhwb3J0cy5zYXZlQ3VzdG9tVGhlbWVDb2xvcnMgPSBleHBvcnRzLnNldEN1c3RvbUlucHV0cyA9IGV4cG9ydHMucmVmcmVzaEJ1dHRvbnMgPSBleHBvcnRzLnVwZGF0ZUFjdGl2ZUJ1dHRvbiA9IHZvaWQgMDtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpLCBVcGRhdGVDb25maWcgPSBjb25maWdfMTtcbmNvbnN0IFRoZW1lQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvdGhlbWUtY29udHJvbGxlclwiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgVGhlbWVDb2xvcnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL3RoZW1lLWNvbG9yc1wiKSk7XG5jb25zdCBDaGFydENvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL2NoYXJ0LWNvbnRyb2xsZXJcIikpO1xuY29uc3QgQ3VzdG9tVGhlbWVQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcG9wdXBzL2N1c3RvbS10aGVtZS1wb3B1cFwiKSk7XG5jb25zdCBMb2FkZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2xvYWRlclwiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xuZnVuY3Rpb24gdXBkYXRlQWN0aXZlQnV0dG9uKCkge1xuICAgIGxldCBhY3RpdmVUaGVtZU5hbWUgPSBjb25maWdfMS5kZWZhdWx0LnRoZW1lO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnJhbmRvbVRoZW1lICE9PSBcIm9mZlwiICYmXG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQucmFuZG9tVGhlbWUgIT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgVGhlbWVDb250cm9sbGVyLnJhbmRvbVRoZW1lICE9PSBudWxsKSB7XG4gICAgICAgIGFjdGl2ZVRoZW1lTmFtZSA9IFRoZW1lQ29udHJvbGxlci5yYW5kb21UaGVtZTtcbiAgICB9XG4gICAgJChgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLnRoZW1lYCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgJChgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLnRoZW1lW3RoZW1lPSR7YWN0aXZlVGhlbWVOYW1lfV1gKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbn1cbmV4cG9ydHMudXBkYXRlQWN0aXZlQnV0dG9uID0gdXBkYXRlQWN0aXZlQnV0dG9uO1xuZnVuY3Rpb24gdXBkYXRlQ29sb3JzKGNvbG9yUGlja2VyLCBjb2xvciwgb25seVN0eWxlID0gZmFsc2UsIG5vVGhlbWVVcGRhdGUgPSBmYWxzZSkge1xuICAgIGlmIChvbmx5U3R5bGUpIHtcbiAgICAgICAgY29uc3QgY29sb3JJRCA9IGNvbG9yUGlja2VyLmZpbmQoXCJpbnB1dFt0eXBlPWNvbG9yXVwiKS5hdHRyKFwiaWRcIik7XG4gICAgICAgIGlmIChjb2xvcklEID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiQ291bGQgbm90IGZpbmQgY29sb3IgSUQhXCIpO1xuICAgICAgICBpZiAoIW5vVGhlbWVVcGRhdGUgJiYgY29sb3JJRCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoY29sb3JJRCwgY29sb3IpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBpY2tlckJ1dHRvbiA9IGNvbG9yUGlja2VyLmZpbmQoXCJsYWJlbFwiKTtcbiAgICAgICAgcGlja2VyQnV0dG9uLnZhbChjb2xvcik7XG4gICAgICAgIHBpY2tlckJ1dHRvbi5hdHRyKFwidmFsdWVcIiwgY29sb3IpO1xuICAgICAgICBpZiAocGlja2VyQnV0dG9uLmF0dHIoXCJmb3JcIikgIT09IFwiLS1iZy1jb2xvclwiKSB7XG4gICAgICAgICAgICBwaWNrZXJCdXR0b24uY3NzKFwiYmFja2dyb3VuZC1jb2xvclwiLCBjb2xvcik7XG4gICAgICAgIH1cbiAgICAgICAgY29sb3JQaWNrZXIuZmluZChcImlucHV0W3R5cGU9dGV4dF1cIikudmFsKGNvbG9yKTtcbiAgICAgICAgY29sb3JQaWNrZXIuZmluZChcImlucHV0W3R5cGU9Y29sb3JdXCIpLmF0dHIoXCJ2YWx1ZVwiLCBjb2xvcik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgY29sb3JSRUdFWCA9IFtcbiAgICAgICAge1xuICAgICAgICAgICAgcnVsZTogL1xcYlswLTldezEsM30sXFxzP1swLTldezEsM30sXFxzP1swLTldezEsM31cXHMqXFxiLyxcbiAgICAgICAgICAgIHN0YXJ0OiBcInJnYihcIixcbiAgICAgICAgICAgIGVuZDogXCIpXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIHJ1bGU6IC9cXGJbQS1aLCBhLXosIDAtOV17Nn1cXGIvLFxuICAgICAgICAgICAgc3RhcnQ6IFwiI1wiLFxuICAgICAgICAgICAgZW5kOiBcIlwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBydWxlOiAvXFxiWzAtOV17MSwzfSxcXHM/WzAtOV17MSwzfSUsXFxzP1swLTldezEsM30lP1xccypcXGIvLFxuICAgICAgICAgICAgc3RhcnQ6IFwiaHNsKFwiLFxuICAgICAgICAgICAgZW5kOiBcIilcIixcbiAgICAgICAgfSxcbiAgICBdO1xuICAgIGNvbG9yID0gY29sb3IucmVwbGFjZShcIsKwXCIsIFwiXCIpO1xuICAgIGZvciAoY29uc3QgcmVnZXggb2YgY29sb3JSRUdFWCkge1xuICAgICAgICBpZiAoY29sb3IubWF0Y2gocmVnZXgucnVsZSkpIHtcbiAgICAgICAgICAgIGNvbG9yID0gcmVnZXguc3RhcnQgKyBjb2xvciArIHJlZ2V4LmVuZDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgICQoXCIuY29sb3JDb252ZXJ0ZXJcIikuY3NzKFwiY29sb3JcIiwgY29sb3IpO1xuICAgIGNvbnN0IGhleENvbG9yID0gTWlzYy5jb252ZXJ0UkdCdG9IRVgoJChcIi5jb2xvckNvbnZlcnRlclwiKS5jc3MoXCJjb2xvclwiKSk7XG4gICAgaWYgKGhleENvbG9yID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb2xvciA9IGhleENvbG9yO1xuICAgIGNvbnN0IGNvbG9ySUQgPSBjb2xvclBpY2tlci5maW5kKFwiaW5wdXRbdHlwZT1jb2xvcl1cIikuYXR0cihcImlkXCIpO1xuICAgIGlmIChjb2xvcklEID09PSB1bmRlZmluZWQpXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDb3VsZCBub3QgZmluZCBjb2xvciBJRCFcIik7XG4gICAgaWYgKCFub1RoZW1lVXBkYXRlICYmIGNvbG9ySUQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoY29sb3JJRCwgY29sb3IpO1xuICAgIH1cbiAgICBjb25zdCBwaWNrZXJCdXR0b24gPSBjb2xvclBpY2tlci5maW5kKFwibGFiZWxcIik7XG4gICAgcGlja2VyQnV0dG9uLnZhbChjb2xvcik7XG4gICAgcGlja2VyQnV0dG9uLmF0dHIoXCJ2YWx1ZVwiLCBjb2xvcik7XG4gICAgaWYgKHBpY2tlckJ1dHRvbi5hdHRyKFwiZm9yXCIpICE9PSBcIi0tYmctY29sb3JcIikge1xuICAgICAgICBwaWNrZXJCdXR0b24uY3NzKFwiYmFja2dyb3VuZC1jb2xvclwiLCBjb2xvcik7XG4gICAgfVxuICAgIGNvbG9yUGlja2VyLmZpbmQoXCJpbnB1dFt0eXBlPXRleHRdXCIpLnZhbChjb2xvcik7XG4gICAgY29sb3JQaWNrZXIuZmluZChcImlucHV0W3R5cGU9Y29sb3JdXCIpLmF0dHIoXCJ2YWx1ZVwiLCBjb2xvcik7XG59XG5mdW5jdGlvbiByZWZyZXNoQnV0dG9ucygpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5jdXN0b21UaGVtZSkge1xuICAgICAgICAgICAgLy8gVXBkYXRlIGN1c3RvbSB0aGVtZSBidXR0b25zXG4gICAgICAgICAgICBjb25zdCBjdXN0b21UaGVtZXNFbCA9ICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAuYWxsQ3VzdG9tVGhlbWVzLmJ1dHRvbnNcIikuZW1wdHkoKTtcbiAgICAgICAgICAgIGNvbnN0IGFkZEJ1dHRvbiA9ICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAuYWRkQ3VzdG9tVGhlbWVCdXR0b25cIik7XG4gICAgICAgICAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC5jdXN0b21UaGVtZUVkaXQgLnNhdmVDdXN0b21UaGVtZUJ1dHRvblwiKS50ZXh0KFwic2F2ZVwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLmN1c3RvbVRoZW1lRWRpdCAuc2F2ZUN1c3RvbVRoZW1lQnV0dG9uXCIpLnRleHQoXCJzYXZlIGFzIG5ld1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFkZEJ1dHRvbi5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIGNvbnN0IGN1c3RvbVRoZW1lcyA9IERCLmdldFNuYXBzaG90KCkuY3VzdG9tVGhlbWVzO1xuICAgICAgICAgICAgY3VzdG9tVGhlbWVzLmZvckVhY2goKGN1c3RvbVRoZW1lKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gY29uc3QgYWN0aXZlVGhlbWUgPVxuICAgICAgICAgICAgICAgIC8vICAgQ29uZmlnLmN1c3RvbVRoZW1lSWQgPT09IGN1c3RvbVRoZW1lLl9pZCA/IFwiYWN0aXZlXCIgOiBcIlwiO1xuICAgICAgICAgICAgICAgIGNvbnN0IGJnQ29sb3IgPSBjdXN0b21UaGVtZS5jb2xvcnNbMF07XG4gICAgICAgICAgICAgICAgY29uc3QgbWFpbkNvbG9yID0gY3VzdG9tVGhlbWUuY29sb3JzWzFdO1xuICAgICAgICAgICAgICAgIGN1c3RvbVRoZW1lc0VsLmFwcGVuZChgPGRpdiBjbGFzcz1cImN1c3RvbVRoZW1lIGJ1dHRvblwiIGN1c3RvbVRoZW1lSWQ9JyR7Y3VzdG9tVGhlbWUuX2lkfScgXG4gICAgICAgIHN0eWxlPVwiY29sb3I6JHttYWluQ29sb3J9O2JhY2tncm91bmQ6JHtiZ0NvbG9yfVwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiZWRpdEJ1dHRvblwiPjxpIGNsYXNzPVwiZmFzIGZhLXBlblwiPjwvaT48L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInRleHRcIj4ke2N1c3RvbVRoZW1lLm5hbWUucmVwbGFjZSgvXy9nLCBcIiBcIil9PC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJkZWxCdXR0b25cIj48aSBjbGFzcz1cImZhcyBmYS10cmFzaCBmYS1md1wiPjwvaT48L2Rpdj5cbiAgICAgICAgPC9kaXY+YCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGVtZSBidXR0b25zXG4gICAgICAgICAgICBjb25zdCBmYXZUaGVtZXNFbCA9ICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAuZmF2VGhlbWVzLmJ1dHRvbnNcIikuZW1wdHkoKTtcbiAgICAgICAgICAgIGNvbnN0IHRoZW1lc0VsID0gJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC5hbGxUaGVtZXMuYnV0dG9uc1wiKS5lbXB0eSgpO1xuICAgICAgICAgICAgbGV0IGFjdGl2ZVRoZW1lTmFtZSA9IGNvbmZpZ18xLmRlZmF1bHQudGhlbWU7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5yYW5kb21UaGVtZSAhPT0gXCJvZmZcIiAmJlxuICAgICAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQucmFuZG9tVGhlbWUgIT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgICAgICBUaGVtZUNvbnRyb2xsZXIucmFuZG9tVGhlbWUgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBhY3RpdmVUaGVtZU5hbWUgPSBUaGVtZUNvbnRyb2xsZXIucmFuZG9tVGhlbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB0aGVtZXMgPSB5aWVsZCBNaXNjLmdldFNvcnRlZFRoZW1lc0xpc3QoKTtcbiAgICAgICAgICAgIC8vZmlyc3Qgc2hvdyBmYXZvdXJpdGVzXG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mYXZUaGVtZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGZhdlRoZW1lc0VsLmNzcyh7IHBhZGRpbmdCb3R0b206IFwiMXJlbVwiIH0pO1xuICAgICAgICAgICAgICAgIHRoZW1lcy5mb3JFYWNoKCh0aGVtZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mYXZUaGVtZXMuaW5jbHVkZXModGhlbWUubmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2ZVRoZW1lID0gYWN0aXZlVGhlbWVOYW1lID09PSB0aGVtZS5uYW1lID8gXCJhY3RpdmVcIiA6IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBmYXZUaGVtZXNFbC5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0aGVtZSBidXR0b24gJHthY3RpdmVUaGVtZX1cIiB0aGVtZT0nJHt0aGVtZS5uYW1lfScgXG4gICAgICAgICAgICBzdHlsZT1cImNvbG9yOiR7dGhlbWUubWFpbkNvbG9yfTtiYWNrZ3JvdW5kOiR7dGhlbWUuYmdDb2xvcn1cIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJhY3RpdmVJbmRpY2F0b3JcIj48aSBjbGFzcz1cImZhcyBmYS1jaXJjbGVcIj48L2k+PC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGV4dFwiPiR7dGhlbWUubmFtZS5yZXBsYWNlKC9fL2csIFwiIFwiKX08L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJmYXZCdXR0b24gYWN0aXZlXCI+PGkgY2xhc3M9XCJmYXMgZmEtc3RhclwiPjwvaT48L2Rpdj48L2Rpdj5gKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZmF2VGhlbWVzRWwuY3NzKHsgcGFkZGluZ0JvdHRvbTogXCIwXCIgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL3RoZW4gdGhlIHJlc3RcbiAgICAgICAgICAgIHRoZW1lcy5mb3JFYWNoKCh0aGVtZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZhdlRoZW1lcy5pbmNsdWRlcyh0aGVtZS5uYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2ZVRoZW1lID0gYWN0aXZlVGhlbWVOYW1lID09PSB0aGVtZS5uYW1lID8gXCJhY3RpdmVcIiA6IFwiXCI7XG4gICAgICAgICAgICAgICAgdGhlbWVzRWwuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGhlbWUgYnV0dG9uICR7YWN0aXZlVGhlbWV9XCIgdGhlbWU9JyR7dGhlbWUubmFtZX0nIHN0eWxlPVwiY29sb3I6JHt0aGVtZS5tYWluQ29sb3J9O2JhY2tncm91bmQ6JHt0aGVtZS5iZ0NvbG9yfVwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYWN0aXZlSW5kaWNhdG9yXCI+PGkgY2xhc3M9XCJmYXMgZmEtY2lyY2xlXCI+PC9pPjwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwidGV4dFwiPiR7dGhlbWUubmFtZS5yZXBsYWNlKC9fL2csIFwiIFwiKX08L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImZhdkJ1dHRvblwiPjxpIGNsYXNzPVwiZmFyIGZhLXN0YXJcIj48L2k+PC9kaXY+PC9kaXY+YCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVBY3RpdmVCdXR0b24oKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMucmVmcmVzaEJ1dHRvbnMgPSByZWZyZXNoQnV0dG9ucztcbmZ1bmN0aW9uIHNldEN1c3RvbUlucHV0cyhub1RoZW1lVXBkYXRlID0gZmFsc2UpIHtcbiAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLnRhYkNvbnRhaW5lciAuY3VzdG9tVGhlbWUgLmNvbG9yUGlja2VyXCIpLmVhY2goKF9pbmRleCwgZWxlbWVudCkgPT4ge1xuICAgICAgICBjb25zdCBjdXJyZW50Q29sb3IgPSBjb25maWdfMS5kZWZhdWx0LmN1c3RvbVRoZW1lQ29sb3JzW1RoZW1lQ29udHJvbGxlci5jb2xvclZhcnMuaW5kZXhPZigkKGVsZW1lbnQpLmZpbmQoXCJpbnB1dFt0eXBlPWNvbG9yXVwiKS5hdHRyKFwiaWRcIikpXTtcbiAgICAgICAgdXBkYXRlQ29sb3JzKCQoZWxlbWVudCksIGN1cnJlbnRDb2xvciwgZmFsc2UsIG5vVGhlbWVVcGRhdGUpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5zZXRDdXN0b21JbnB1dHMgPSBzZXRDdXN0b21JbnB1dHM7XG5mdW5jdGlvbiB0b2dnbGVGYXZvdXJpdGUodGhlbWVOYW1lKSB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZmF2VGhlbWVzLmluY2x1ZGVzKHRoZW1lTmFtZSkpIHtcbiAgICAgICAgLy8gYWxyZWFkeSBmYXZvdXJpdGUsIHJlbW92ZVxuICAgICAgICBVcGRhdGVDb25maWcuc2V0RmF2VGhlbWVzKGNvbmZpZ18xLmRlZmF1bHQuZmF2VGhlbWVzLmZpbHRlcigodCkgPT4gdCAhPT0gdGhlbWVOYW1lKSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBhZGQgdG8gZmF2b3VyaXRlc1xuICAgICAgICBjb25zdCBuZXdMaXN0ID0gY29uZmlnXzEuZGVmYXVsdC5mYXZUaGVtZXM7XG4gICAgICAgIG5ld0xpc3QucHVzaCh0aGVtZU5hbWUpO1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0RmF2VGhlbWVzKG5ld0xpc3QpO1xuICAgIH1cbiAgICBVcGRhdGVDb25maWcuc2F2ZUZ1bGxDb25maWdUb0xvY2FsU3RvcmFnZSgpO1xufVxuZnVuY3Rpb24gc2F2ZUN1c3RvbVRoZW1lQ29sb3JzKCkge1xuICAgIGNvbnN0IG5ld0NvbG9ycyA9IFtdO1xuICAgICQuZWFjaCgkKFwiLnBhZ2VTZXR0aW5ncyAuY3VzdG9tVGhlbWUgLmN1c3RvbVRoZW1lRWRpdCBbdHlwZT0nY29sb3InXVwiKSwgKF9pbmRleCwgZWxlbWVudCkgPT4ge1xuICAgICAgICBuZXdDb2xvcnMucHVzaCgkKGVsZW1lbnQpLmF0dHIoXCJ2YWx1ZVwiKSk7XG4gICAgfSk7XG4gICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lQ29sb3JzKG5ld0NvbG9ycyk7XG4gICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDdXN0b20gdGhlbWUgc2F2ZWRcIiwgMSk7XG59XG5leHBvcnRzLnNhdmVDdXN0b21UaGVtZUNvbG9ycyA9IHNhdmVDdXN0b21UaGVtZUNvbG9ycztcbmZ1bmN0aW9uIHVwZGF0ZUFjdGl2ZVRhYihmb3JjZWQgPSBmYWxzZSkge1xuICAgIC8vIFNldCBmb3JjZSB0byB0cnVlIG9ubHkgd2hlbiBzb21lIGNoYW5nZSBmb3IgdGhlIGFjdGl2ZSB0YWIgaGFzIHRha2VuIHBsYWNlXG4gICAgLy8gUHJldmVudCB0aGVtZSBidXR0b25zIGZyb20gYmVpbmcgYWRkZWQgdHdpY2UgYnkgZG9pbmcgYW4gdXBkYXRlIG9ubHkgd2hlbiB0aGUgc3RhdGUgaGFzIGNoYW5nZWRcbiAgICBjb25zdCAkcHJlc2V0VGFiQnV0dG9uID0gJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC50YWJzIC5idXR0b25bdGFiPSdwcmVzZXQnXVwiKTtcbiAgICBjb25zdCAkY3VzdG9tVGFiQnV0dG9uID0gJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC50YWJzIC5idXR0b25bdGFiPSdjdXN0b20nXVwiKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5jdXN0b21UaGVtZSkge1xuICAgICAgICAkcHJlc2V0VGFiQnV0dG9uLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICBpZiAoISRjdXN0b21UYWJCdXR0b24uaGFzQ2xhc3MoXCJhY3RpdmVcIikgfHwgZm9yY2VkKSB7XG4gICAgICAgICAgICAkY3VzdG9tVGFiQnV0dG9uLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgcmVmcmVzaEJ1dHRvbnMoKTtcbiAgICAgICAgfVxuICAgICAgICBNaXNjLnN3YXBFbGVtZW50cygkKCcucGFnZVNldHRpbmdzIFt0YWJDb250ZW50PVwicHJlc2V0XCJdJyksICQoJy5wYWdlU2V0dGluZ3MgW3RhYkNvbnRlbnQ9XCJjdXN0b21cIl0nKSwgMjUwKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICRjdXN0b21UYWJCdXR0b24ucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgIGlmICghJHByZXNldFRhYkJ1dHRvbi5oYXNDbGFzcyhcImFjdGl2ZVwiKSB8fCBmb3JjZWQpIHtcbiAgICAgICAgICAgICRwcmVzZXRUYWJCdXR0b24uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICByZWZyZXNoQnV0dG9ucygpO1xuICAgICAgICB9XG4gICAgICAgIE1pc2Muc3dhcEVsZW1lbnRzKCQoJy5wYWdlU2V0dGluZ3MgW3RhYkNvbnRlbnQ9XCJjdXN0b21cIl0nKSwgJCgnLnBhZ2VTZXR0aW5ncyBbdGFiQ29udGVudD1cInByZXNldFwiXScpLCAyNTApO1xuICAgIH1cbn1cbmV4cG9ydHMudXBkYXRlQWN0aXZlVGFiID0gdXBkYXRlQWN0aXZlVGFiO1xuLy8gQWRkIGV2ZW50cyB0byB0aGUgRE9NXG4vLyBIYW5kbGUgY2xpY2sgb24gdGhlbWU6IHByZXNldCBvciBjdXN0b20gdGFiXG4kKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLnRhYnMgLmJ1dHRvblwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC50YWJzIC5idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgY29uc3QgJHRhcmdldCA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICAkdGFyZ2V0LmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgIC8vIHNldEN1c3RvbUlucHV0cygpO1xuICAgIGlmICgkdGFyZ2V0LmF0dHIoXCJ0YWJcIikgPT0gXCJwcmVzZXRcIikge1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWUoZmFsc2UpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lKHRydWUpO1xuICAgIH1cbn0pO1xuLy8gSGFuZGxlIGNsaWNrIG9uIGN1c3RvbSB0aGVtZSBidXR0b25cbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAuY3VzdG9tVGhlbWUuYnV0dG9uXCIsIChlKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIC8vIERvIG5vdCBhcHBseSBpZiB1c2VyIHdhbnRlZCB0byBkZWxldGUgaXRcbiAgICBpZiAoJChlLnRhcmdldCkuaGFzQ2xhc3MoXCJkZWxCdXR0b25cIikpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoJChlLnRhcmdldCkuaGFzQ2xhc3MoXCJlZGl0QnV0dG9uXCIpKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgY3VzdG9tVGhlbWVJZCA9IChfYSA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiY3VzdG9tVGhlbWVJZFwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCJcIjtcbiAgICBUaGVtZUNvbnRyb2xsZXIuc2V0KGN1c3RvbVRoZW1lSWQsIHRydWUpO1xufSk7XG4vLyBIYW5kbGUgY2xpY2sgb24gZmF2b3JpdGUgcHJlc2V0IHRoZW1lIGJ1dHRvblxuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC50aGVtZSAuZmF2QnV0dG9uXCIsIChlKSA9PiB7XG4gICAgY29uc3QgdGhlbWUgPSAkKGUuY3VycmVudFRhcmdldCkucGFyZW50cyhcIi50aGVtZS5idXR0b25cIikuYXR0cihcInRoZW1lXCIpO1xuICAgIGlmICh0aGVtZSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICB0b2dnbGVGYXZvdXJpdGUodGhlbWUpO1xuICAgIGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ291bGQgbm90IGZpbmQgdGhlIHRoZW1lIGF0dHJpYnV0ZSBhdHRhY2hlZCB0byB0aGUgYnV0dG9uIGNsaWNrZWQhXCIpO1xuICAgIH1cbn0pO1xuLy8gSGFuZGxlIGNsaWNrIG9uIHByZXNldCB0aGVtZSBidXR0b25cbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAudGhlbWUuYnV0dG9uXCIsIChlKSA9PiB7XG4gICAgY29uc3QgdGhlbWUgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcInRoZW1lXCIpO1xuICAgIGlmICghJChlLnRhcmdldCkuaGFzQ2xhc3MoXCJmYXZCdXR0b25cIikgJiYgdGhlbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0VGhlbWUodGhlbWUpO1xuICAgICAgICB1cGRhdGVBY3RpdmVCdXR0b24oKTtcbiAgICB9XG59KTtcbiQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAudGFiQ29udGFpbmVyIC5jdXN0b21UaGVtZSBpbnB1dFt0eXBlPWNvbG9yXVwiKS5vbihcImlucHV0XCIsIChlKSA9PiB7XG4gICAgY29uc3QgJGNvbG9yVmFyID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJpZFwiKTtcbiAgICBjb25zdCAkcGlja2VkQ29sb3IgPSAkKGUuY3VycmVudFRhcmdldCkudmFsKCk7XG4gICAgdXBkYXRlQ29sb3JzKCQoXCIuY29sb3JQaWNrZXIgI1wiICsgJGNvbG9yVmFyKS5wYXJlbnQoKSwgJHBpY2tlZENvbG9yLCB0cnVlKTtcbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC50YWJDb250YWluZXIgLmN1c3RvbVRoZW1lIGlucHV0W3R5cGU9Y29sb3JdXCIpLm9uKFwiY2hhbmdlXCIsIChlKSA9PiB7XG4gICAgY29uc3QgJGNvbG9yVmFyID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJpZFwiKTtcbiAgICBjb25zdCAkcGlja2VkQ29sb3IgPSAkKGUuY3VycmVudFRhcmdldCkudmFsKCk7XG4gICAgdXBkYXRlQ29sb3JzKCQoXCIuY29sb3JQaWNrZXIgI1wiICsgJGNvbG9yVmFyKS5wYXJlbnQoKSwgJHBpY2tlZENvbG9yKTtcbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC50YWJDb250YWluZXIgLmN1c3RvbVRoZW1lIGlucHV0W3R5cGU9dGV4dF1cIilcbiAgICAub24oXCJibHVyXCIsIChlKSA9PiB7XG4gICAgaWYgKGUudGFyZ2V0LmlkID09PSBcIm5hbWVcIilcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0ICRjb2xvclZhciA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiaWRcIik7XG4gICAgY29uc3QgJHBpY2tlZENvbG9yID0gJChlLmN1cnJlbnRUYXJnZXQpLnZhbCgpO1xuICAgIHVwZGF0ZUNvbG9ycygkKFwiLmNvbG9yUGlja2VyICNcIiArICRjb2xvclZhcikucGFyZW50KCksICRwaWNrZWRDb2xvcik7XG59KVxuICAgIC5vbihcImtleXByZXNzXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmlkID09PSBcIm5hbWVcIilcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChlLmNvZGUgPT09IFwiRW50ZXJcIikge1xuICAgICAgICAkKHRoaXMpLmF0dHIoXCJkaXNhYmxlZFwiLCBcImRpc2FibGVkXCIpO1xuICAgICAgICBjb25zdCAkY29sb3JWYXIgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcImlkXCIpO1xuICAgICAgICBjb25zdCAkcGlja2VkQ29sb3IgPSAkKGUuY3VycmVudFRhcmdldCkudmFsKCk7XG4gICAgICAgIHVwZGF0ZUNvbG9ycygkKFwiLmNvbG9yUGlja2VyICNcIiArICRjb2xvclZhcikucGFyZW50KCksICRwaWNrZWRDb2xvcik7XG4gICAgICAgICQodGhpcykucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xuICAgIH1cbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgI2xvYWRDdXN0b21Db2xvcnNGcm9tUHJlc2V0XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIC8vIHByZXZpZXdUaGVtZShDb25maWcudGhlbWUpO1xuICAgICQoXCIjY3VycmVudFRoZW1lXCIpLmF0dHIoXCJocmVmXCIsIGB0aGVtZXMvJHtjb25maWdfMS5kZWZhdWx0LnRoZW1lfS5jc3NgKTtcbiAgICBUaGVtZUNvbnRyb2xsZXIuY29sb3JWYXJzLmZvckVhY2goKGUpID0+IHtcbiAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KGUsIFwiXCIpO1xuICAgIH0pO1xuICAgIHNldFRpbWVvdXQoKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIENoYXJ0Q29udHJvbGxlci51cGRhdGVBbGxDaGFydENvbG9ycygpO1xuICAgICAgICBjb25zdCB0aGVtZUNvbG9ycyA9IHlpZWxkIFRoZW1lQ29sb3JzLmdldEFsbCgpO1xuICAgICAgICBUaGVtZUNvbnRyb2xsZXIuY29sb3JWYXJzLmZvckVhY2goKGNvbG9yTmFtZSkgPT4ge1xuICAgICAgICAgICAgbGV0IGNvbG9yO1xuICAgICAgICAgICAgaWYgKGNvbG9yTmFtZSA9PT0gXCItLWJnLWNvbG9yXCIpIHtcbiAgICAgICAgICAgICAgICBjb2xvciA9IHRoZW1lQ29sb3JzLmJnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29sb3JOYW1lID09PSBcIi0tbWFpbi1jb2xvclwiKSB7XG4gICAgICAgICAgICAgICAgY29sb3IgPSB0aGVtZUNvbG9ycy5tYWluO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29sb3JOYW1lID09PSBcIi0tc3ViLWNvbG9yXCIpIHtcbiAgICAgICAgICAgICAgICBjb2xvciA9IHRoZW1lQ29sb3JzLnN1YjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNvbG9yTmFtZSA9PT0gXCItLWNhcmV0LWNvbG9yXCIpIHtcbiAgICAgICAgICAgICAgICBjb2xvciA9IHRoZW1lQ29sb3JzLmNhcmV0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29sb3JOYW1lID09PSBcIi0tdGV4dC1jb2xvclwiKSB7XG4gICAgICAgICAgICAgICAgY29sb3IgPSB0aGVtZUNvbG9ycy50ZXh0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29sb3JOYW1lID09PSBcIi0tZXJyb3ItY29sb3JcIikge1xuICAgICAgICAgICAgICAgIGNvbG9yID0gdGhlbWVDb2xvcnMuZXJyb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjb2xvck5hbWUgPT09IFwiLS1lcnJvci1leHRyYS1jb2xvclwiKSB7XG4gICAgICAgICAgICAgICAgY29sb3IgPSB0aGVtZUNvbG9ycy5lcnJvckV4dHJhO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29sb3JOYW1lID09PSBcIi0tY29sb3JmdWwtZXJyb3ItY29sb3JcIikge1xuICAgICAgICAgICAgICAgIGNvbG9yID0gdGhlbWVDb2xvcnMuY29sb3JmdWxFcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNvbG9yTmFtZSA9PT0gXCItLWNvbG9yZnVsLWVycm9yLWV4dHJhLWNvbG9yXCIpIHtcbiAgICAgICAgICAgICAgICBjb2xvciA9IHRoZW1lQ29sb3JzLmNvbG9yZnVsRXJyb3JFeHRyYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHVwZGF0ZUNvbG9ycygkKFwiLmNvbG9yUGlja2VyICNcIiArIGNvbG9yTmFtZSkucGFyZW50KCksIGNvbG9yKTtcbiAgICAgICAgfSk7XG4gICAgfSksIDI1MCk7XG59KTtcbi8vIEhhbmRsZXMgY2xpY2sgb24gc2hhcmUgY3VzdG9tIHRoZW1lIGJ1dHRvblxuJChcIiNzaGFyZUN1c3RvbVRoZW1lQnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNvbnN0IHNoYXJlID0gW107XG4gICAgJC5lYWNoKCQoXCIucGFnZVNldHRpbmdzIC5jdXN0b21UaGVtZSAuY3VzdG9tVGhlbWVFZGl0IFt0eXBlPSdjb2xvciddXCIpLCAoXywgZWxlbWVudCkgPT4ge1xuICAgICAgICBzaGFyZS5wdXNoKCQoZWxlbWVudCkuYXR0cihcInZhbHVlXCIpKTtcbiAgICB9KTtcbiAgICBjb25zdCB1cmwgPSBcImh0dHBzOi8vbW9ua2V5dHlwZS5jb20/Y3VzdG9tVGhlbWU9XCIgKyBidG9hKEpTT04uc3RyaW5naWZ5KHNoYXJlKSk7XG4gICAgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQodXJsKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJVUkwgQ29waWVkIHRvIGNsaXBib2FyZFwiLCAwKTtcbiAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIEN1c3RvbVRoZW1lUG9wdXAuc2hvdyh1cmwpO1xuICAgIH0pO1xufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAuc2F2ZUN1c3RvbVRoZW1lQnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgc2F2ZUN1c3RvbVRoZW1lQ29sb3JzKCk7XG4gICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcikge1xuICAgICAgICBjb25zdCBuZXdDdXN0b21UaGVtZSA9IHtcbiAgICAgICAgICAgIG5hbWU6IFwiY3VzdG9tXCIsXG4gICAgICAgICAgICBjb2xvcnM6IGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tVGhlbWVDb2xvcnMsXG4gICAgICAgIH07XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgREIuYWRkQ3VzdG9tVGhlbWUobmV3Q3VzdG9tVGhlbWUpO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBpZiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHVwZGF0ZUFjdGl2ZVRhYih0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdXBkYXRlQWN0aXZlVGFiKHRydWUpO1xuICAgIH1cbn0pKTtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXkpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiY3VzdG9tVGhlbWVJZFwiKVxuICAgICAgICByZWZyZXNoQnV0dG9ucygpO1xuICAgIC8vIGlmIChldmVudEtleSA9PT0gXCJjdXN0b21UaGVtZVwiKSB1cGRhdGVBY3RpdmVUYWIoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNldCA9IGV4cG9ydHMuZ2V0ID0gdm9pZCAwO1xubGV0IGFjdGl2ZVBhZ2UgPSBcImxvYWRpbmdcIjtcbmZ1bmN0aW9uIGdldCgpIHtcbiAgICByZXR1cm4gYWN0aXZlUGFnZTtcbn1cbmV4cG9ydHMuZ2V0ID0gZ2V0O1xuZnVuY3Rpb24gc2V0KGFjdGl2ZSkge1xuICAgIGFjdGl2ZVBhZ2UgPSBhY3RpdmU7XG59XG5leHBvcnRzLnNldCA9IHNldDtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5lbmFibGUgPSBleHBvcnRzLmdldCA9IHZvaWQgMDtcbmxldCBnbGFyc2VzTW9kZSA9IGZhbHNlO1xuZnVuY3Rpb24gZ2V0KCkge1xuICAgIHJldHVybiBnbGFyc2VzTW9kZTtcbn1cbmV4cG9ydHMuZ2V0ID0gZ2V0O1xuZnVuY3Rpb24gZW5hYmxlKCkge1xuICAgIGdsYXJzZXNNb2RlID0gdHJ1ZTtcbiAgICBjb25zb2xlLmxvZyhcIkdsYXJzZXMgTW9kZSBPbiAtIHRlc3QgcmVzdWx0IHdpbGwgYmUgaGlkZGVuLiBZb3UgY2FuIGNoZWNrIHRoZSBzdGF0cyBpbiB0aGUgY29uc29sZSAoaGVyZSlcIik7XG4gICAgY29uc29sZS5sb2coXCJUbyBkaXNhYmxlIEdsYXJzZXMgTW9kZSByZWZyZXNoIHRoZSBwYWdlLlwiKTtcbn1cbmV4cG9ydHMuZW5hYmxlID0gZW5hYmxlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmdldCA9IGV4cG9ydHMuc2V0ID0gdm9pZCAwO1xubGV0IHRyYW5zaXRpb24gPSB0cnVlO1xuZnVuY3Rpb24gc2V0KHZhbCkge1xuICAgIHRyYW5zaXRpb24gPSB2YWw7XG59XG5leHBvcnRzLnNldCA9IHNldDtcbmZ1bmN0aW9uIGdldCgpIHtcbiAgICByZXR1cm4gdHJhbnNpdGlvbjtcbn1cbmV4cG9ydHMuZ2V0ID0gZ2V0O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmdldCA9IGV4cG9ydHMuY2xlYXIgPSBleHBvcnRzLnNldCA9IHZvaWQgMDtcbmxldCBzbG93VGltZXIgPSBmYWxzZTtcbmZ1bmN0aW9uIHNldCgpIHtcbiAgICBpZiAoc2xvd1RpbWVyKVxuICAgICAgICByZXR1cm47XG4gICAgc2xvd1RpbWVyID0gdHJ1ZTtcbiAgICBjb25zb2xlLmVycm9yKFwiU2xvdyB0aW1lciwgZGlzYWJsaW5nIGFuaW1hdGlvbnNcIik7XG4gICAgLy8gTm90aWZpY2F0aW9ucy5hZGQoXCJTbG93IHRpbWVyIGRldGVjdGVkXCIsIC0xLCA1KTtcbn1cbmV4cG9ydHMuc2V0ID0gc2V0O1xuZnVuY3Rpb24gY2xlYXIoKSB7XG4gICAgc2xvd1RpbWVyID0gZmFsc2U7XG59XG5leHBvcnRzLmNsZWFyID0gY2xlYXI7XG5mdW5jdGlvbiBnZXQoKSB7XG4gICAgcmV0dXJuIHNsb3dUaW1lcjtcbn1cbmV4cG9ydHMuZ2V0ID0gZ2V0O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNldCA9IGV4cG9ydHMuZ2V0ID0gdm9pZCAwO1xubGV0IHRlc3RBY3RpdmUgPSBmYWxzZTtcbmZ1bmN0aW9uIGdldCgpIHtcbiAgICByZXR1cm4gdGVzdEFjdGl2ZTtcbn1cbmV4cG9ydHMuZ2V0ID0gZ2V0O1xuZnVuY3Rpb24gc2V0KGFjdGl2ZSkge1xuICAgIHRlc3RBY3RpdmUgPSBhY3RpdmU7XG59XG5leHBvcnRzLnNldCA9IHNldDtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5pbmNyZW1lbnQgPSBleHBvcnRzLnNldCA9IGV4cG9ydHMuZ2V0ID0gdm9pZCAwO1xubGV0IHRpbWUgPSAwO1xuZnVuY3Rpb24gZ2V0KCkge1xuICAgIHJldHVybiB0aW1lO1xufVxuZXhwb3J0cy5nZXQgPSBnZXQ7XG5mdW5jdGlvbiBzZXQoYWN0aXZlKSB7XG4gICAgdGltZSA9IGFjdGl2ZTtcbn1cbmV4cG9ydHMuc2V0ID0gc2V0O1xuZnVuY3Rpb24gaW5jcmVtZW50KCkge1xuICAgIHRpbWUrKztcbn1cbmV4cG9ydHMuaW5jcmVtZW50ID0gaW5jcmVtZW50O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucmVwbGFjZSA9IGV4cG9ydHMuZ2V0TGlzdCA9IHZvaWQgMDtcbmNvbnN0IG1pc2NfMSA9IHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpO1xubGV0IGxpc3QgPSBbXTtcbmZ1bmN0aW9uIGdldExpc3QoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKGxpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5nZXRKU09OKFwibGFuZ3VhZ2VzL2JyaXRpc2hlbmdsaXNoLmpzb25cIiwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBsaXN0ID0gZGF0YTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbGlzdDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGxpc3Q7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0TGlzdCA9IGdldExpc3Q7XG5mdW5jdGlvbiByZXBsYWNlKHdvcmQpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCBsaXN0ID0geWllbGQgZ2V0TGlzdCgpO1xuICAgICAgICBjb25zdCByZXBsYWNlbWVudCA9IGxpc3QuZmluZCgoYSkgPT4gd29yZC5tYXRjaChSZWdFeHAoYF4oW1xcXFxXXSoke2FbMF19W1xcXFxXXSopJGAsIFwiZ2lcIikpKTtcbiAgICAgICAgcmV0dXJuIHJlcGxhY2VtZW50XG4gICAgICAgICAgICA/IHdvcmQucmVwbGFjZShSZWdFeHAoYF4oPzooW1xcXFxXXSopKCR7cmVwbGFjZW1lbnRbMF19KShbXFxcXFddKikpJGAsIFwiZ2lcIiksIChfLCAkMSwgJDIsICQzKSA9PiAkMSArXG4gICAgICAgICAgICAgICAgKCQyLmNoYXJBdCgwKSA9PT0gJDIuY2hhckF0KDApLnRvVXBwZXJDYXNlKClcbiAgICAgICAgICAgICAgICAgICAgPyAkMiA9PT0gJDIudG9VcHBlckNhc2UoKVxuICAgICAgICAgICAgICAgICAgICAgICAgPyByZXBsYWNlbWVudFsxXS50b1VwcGVyQ2FzZSgpXG4gICAgICAgICAgICAgICAgICAgICAgICA6ICgwLCBtaXNjXzEuY2FwaXRhbGl6ZUZpcnN0TGV0dGVyT2ZFYWNoV29yZCkocmVwbGFjZW1lbnRbMV0pXG4gICAgICAgICAgICAgICAgICAgIDogcmVwbGFjZW1lbnRbMV0pICtcbiAgICAgICAgICAgICAgICAkMylcbiAgICAgICAgICAgIDogd29yZDtcbiAgICB9KTtcbn1cbmV4cG9ydHMucmVwbGFjZSA9IHJlcGxhY2U7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuY2Fwc1N0YXRlID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5leHBvcnRzLmNhcHNTdGF0ZSA9IGZhbHNlO1xuZnVuY3Rpb24gc2hvdygpIHtcbiAgICBpZiAoJChcIiNjYXBzV2FybmluZ1wiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI2NhcHNXYXJuaW5nXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgaWYgKCEkKFwiI2NhcHNXYXJuaW5nXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjY2Fwc1dhcm5pbmdcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxufVxuJChkb2N1bWVudCkua2V5ZG93bihmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGlmICgoKF9hID0gZXZlbnQgPT09IG51bGwgfHwgZXZlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV2ZW50Lm9yaWdpbmFsRXZlbnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZXRNb2RpZmllclN0YXRlKSAmJlxuICAgICAgICAoKF9iID0gZXZlbnQgPT09IG51bGwgfHwgZXZlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV2ZW50Lm9yaWdpbmFsRXZlbnQpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5nZXRNb2RpZmllclN0YXRlKFwiQ2Fwc0xvY2tcIikpKSB7XG4gICAgICAgIGV4cG9ydHMuY2Fwc1N0YXRlID0gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGV4cG9ydHMuY2Fwc1N0YXRlID0gZmFsc2U7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmNhcHNMb2NrV2FybmluZyAmJiBleHBvcnRzLmNhcHNTdGF0ZSkge1xuICAgICAgICAgICAgc2hvdygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaGlkZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChfYykgeyB9XG59KTtcbiQoZG9jdW1lbnQpLmtleXVwKGZ1bmN0aW9uIChldmVudCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgaWYgKCgoX2EgPSBldmVudCA9PT0gbnVsbCB8fCBldmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXZlbnQub3JpZ2luYWxFdmVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldE1vZGlmaWVyU3RhdGUpICYmXG4gICAgICAgICgoX2IgPSBldmVudCA9PT0gbnVsbCB8fCBldmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXZlbnQub3JpZ2luYWxFdmVudCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmdldE1vZGlmaWVyU3RhdGUoXCJDYXBzTG9ja1wiKSkpIHtcbiAgICAgICAgLy9maWx0aHkgZml4IGJ1dCBvcHRpb25hbCBjaGFpbmluZyByZWZ1ZXMgdG8gd29ya1xuICAgICAgICBleHBvcnRzLmNhcHNTdGF0ZSA9IHRydWU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBleHBvcnRzLmNhcHNTdGF0ZSA9IGZhbHNlO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5jYXBzTG9ja1dhcm5pbmcgJiYgZXhwb3J0cy5jYXBzU3RhdGUpIHtcbiAgICAgICAgICAgIHNob3coKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGhpZGUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoX2MpIHsgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNob3cgPSBleHBvcnRzLnVwZGF0ZVBvc2l0aW9uID0gZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5zdGFydEFuaW1hdGlvbiA9IGV4cG9ydHMuc3RvcEFuaW1hdGlvbiA9IGV4cG9ydHMuY2FyZXRBbmltYXRpbmcgPSB2b2lkIDA7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgVGVzdElucHV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QtaW5wdXRcIikpO1xuY29uc3QgU2xvd1RpbWVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvc2xvdy10aW1lclwiKSk7XG5jb25zdCBUZXN0QWN0aXZlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvdGVzdC1hY3RpdmVcIikpO1xuZXhwb3J0cy5jYXJldEFuaW1hdGluZyA9IHRydWU7XG5mdW5jdGlvbiBzdG9wQW5pbWF0aW9uKCkge1xuICAgIGlmIChleHBvcnRzLmNhcmV0QW5pbWF0aW5nID09PSB0cnVlKSB7XG4gICAgICAgICQoXCIjY2FyZXRcIikuY3NzKFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJub25lXCIpO1xuICAgICAgICAkKFwiI2NhcmV0XCIpLmNzcyhcIm9wYWNpdHlcIiwgXCIxXCIpO1xuICAgICAgICBleHBvcnRzLmNhcmV0QW5pbWF0aW5nID0gZmFsc2U7XG4gICAgfVxufVxuZXhwb3J0cy5zdG9wQW5pbWF0aW9uID0gc3RvcEFuaW1hdGlvbjtcbmZ1bmN0aW9uIHN0YXJ0QW5pbWF0aW9uKCkge1xuICAgIGlmIChleHBvcnRzLmNhcmV0QW5pbWF0aW5nID09PSBmYWxzZSkge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zbW9vdGhDYXJldCAmJiAhU2xvd1RpbWVyLmdldCgpKSB7XG4gICAgICAgICAgICAkKFwiI2NhcmV0XCIpLmNzcyhcImFuaW1hdGlvbi1uYW1lXCIsIFwiY2FyZXRGbGFzaFNtb290aFwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIjY2FyZXRcIikuY3NzKFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJjYXJldEZsYXNoSGFyZFwiKTtcbiAgICAgICAgfVxuICAgICAgICBleHBvcnRzLmNhcmV0QW5pbWF0aW5nID0gdHJ1ZTtcbiAgICB9XG59XG5leHBvcnRzLnN0YXJ0QW5pbWF0aW9uID0gc3RhcnRBbmltYXRpb247XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgICQoXCIjY2FyZXRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuZnVuY3Rpb24gdXBkYXRlUG9zaXRpb24oKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoJChcIiN3b3Jkc1dyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIC8vIGlmICgkKFwiI2NhcmV0XCIpLmhhc0NsYXNzKFwib2ZmXCIpKSB7XG4gICAgICAgIC8vICAgcmV0dXJuO1xuICAgICAgICAvLyB9XG4gICAgICAgIGNvbnN0IGNhcmV0ID0gJChcIiNjYXJldFwiKTtcbiAgICAgICAgbGV0IGlucHV0TGVuID0gVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoO1xuICAgICAgICBpbnB1dExlbiA9IE1pc2MudHJhaWxpbmdDb21wb3NlQ2hhcnMudGVzdChUZXN0SW5wdXQuaW5wdXQuY3VycmVudClcbiAgICAgICAgICAgID8gVGVzdElucHV0LmlucHV0LmN1cnJlbnQuc2VhcmNoKE1pc2MudHJhaWxpbmdDb21wb3NlQ2hhcnMpICsgMVxuICAgICAgICAgICAgOiBpbnB1dExlbjtcbiAgICAgICAgbGV0IGN1cnJlbnRMZXR0ZXJJbmRleCA9IGlucHV0TGVuIC0gMTtcbiAgICAgICAgaWYgKGN1cnJlbnRMZXR0ZXJJbmRleCA9PSAtMSkge1xuICAgICAgICAgICAgY3VycmVudExldHRlckluZGV4ID0gMDtcbiAgICAgICAgfVxuICAgICAgICAvL2luc2VydCB0ZW1wb3JhcnkgY2hhcmFjdGVyIHNvIHRoZSBjYXJldCB3aWxsIHdvcmsgaW4gemVuIG1vZGVcbiAgICAgICAgY29uc3QgYWN0aXZlV29yZEVtcHR5ID0gJChcIiN3b3JkcyAuYWN0aXZlXCIpLmNoaWxkcmVuKCkubGVuZ3RoID09IDA7XG4gICAgICAgIGlmIChhY3RpdmVXb3JkRW1wdHkpIHtcbiAgICAgICAgICAgICQoXCIjd29yZHMgLmFjdGl2ZVwiKS5hcHBlbmQoJzxsZXR0ZXIgc3R5bGU9XCJvcGFjaXR5OiAwO1wiPl88L2xldHRlcj4nKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjdXJyZW50V29yZE5vZGVMaXN0ID0gKF9hID0gZG9jdW1lbnQgPT09IG51bGwgfHwgZG9jdW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjd29yZHMgLmFjdGl2ZVwiKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnF1ZXJ5U2VsZWN0b3JBbGwoXCJsZXR0ZXJcIik7XG4gICAgICAgIGlmICghY3VycmVudFdvcmROb2RlTGlzdClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbGV0IGN1cnJlbnRMZXR0ZXIgPSBjdXJyZW50V29yZE5vZGVMaXN0W2N1cnJlbnRMZXR0ZXJJbmRleF07XG4gICAgICAgIGlmIChpbnB1dExlbiA+IGN1cnJlbnRXb3JkTm9kZUxpc3QubGVuZ3RoKSB7XG4gICAgICAgICAgICBjdXJyZW50TGV0dGVyID0gY3VycmVudFdvcmROb2RlTGlzdFtjdXJyZW50V29yZE5vZGVMaXN0Lmxlbmd0aCAtIDFdO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT0gXCJ6ZW5cIiAmJiAkKGN1cnJlbnRMZXR0ZXIpLmxlbmd0aCA9PSAwKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBjdXJyZW50TGFuZ3VhZ2UgPSB5aWVsZCBNaXNjLmdldEN1cnJlbnRMYW5ndWFnZShjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKTtcbiAgICAgICAgY29uc3QgaXNMYW5ndWFnZUxlZnRUb1JpZ2h0ID0gY3VycmVudExhbmd1YWdlLmxlZnRUb1JpZ2h0O1xuICAgICAgICBjb25zdCBjdXJyZW50TGV0dGVyUG9zTGVmdCA9IGlzTGFuZ3VhZ2VMZWZ0VG9SaWdodFxuICAgICAgICAgICAgPyBjdXJyZW50TGV0dGVyLm9mZnNldExlZnRcbiAgICAgICAgICAgIDogY3VycmVudExldHRlci5vZmZzZXRMZWZ0ICsgKChfYiA9ICQoY3VycmVudExldHRlcikud2lkdGgoKSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogMCk7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRMZXR0ZXJQb3NUb3AgPSBjdXJyZW50TGV0dGVyLm9mZnNldFRvcDtcbiAgICAgICAgY29uc3QgbGV0dGVySGVpZ2h0ID0gJChjdXJyZW50TGV0dGVyKS5oZWlnaHQoKTtcbiAgICAgICAgbGV0IG5ld1RvcCA9IDA7XG4gICAgICAgIGxldCBuZXdMZWZ0ID0gMDtcbiAgICAgICAgbmV3VG9wID0gY3VycmVudExldHRlclBvc1RvcCAtIE1hdGgucm91bmQobGV0dGVySGVpZ2h0IC8gNSk7XG4gICAgICAgIGlmIChpbnB1dExlbiA9PSAwKSB7XG4gICAgICAgICAgICBuZXdMZWZ0ID0gaXNMYW5ndWFnZUxlZnRUb1JpZ2h0XG4gICAgICAgICAgICAgICAgPyBjdXJyZW50TGV0dGVyUG9zTGVmdCAtIGNhcmV0LndpZHRoKCkgLyAyXG4gICAgICAgICAgICAgICAgOiBjdXJyZW50TGV0dGVyUG9zTGVmdCArIGNhcmV0LndpZHRoKCkgLyAyO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbmV3TGVmdCA9IGlzTGFuZ3VhZ2VMZWZ0VG9SaWdodFxuICAgICAgICAgICAgICAgID8gY3VycmVudExldHRlclBvc0xlZnQgK1xuICAgICAgICAgICAgICAgICAgICAkKGN1cnJlbnRMZXR0ZXIpLndpZHRoKCkgLVxuICAgICAgICAgICAgICAgICAgICBjYXJldC53aWR0aCgpIC8gMlxuICAgICAgICAgICAgICAgIDogY3VycmVudExldHRlclBvc0xlZnQgLVxuICAgICAgICAgICAgICAgICAgICAkKGN1cnJlbnRMZXR0ZXIpLndpZHRoKCkgK1xuICAgICAgICAgICAgICAgICAgICBjYXJldC53aWR0aCgpIC8gMjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgc21vb3RobGluZXNjcm9sbCA9ICQoXCIjd29yZHMgLnNtb290aFNjcm9sbGVyXCIpLmhlaWdodCgpO1xuICAgICAgICBpZiAoc21vb3RobGluZXNjcm9sbCA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgc21vb3RobGluZXNjcm9sbCA9IDA7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnNtb290aENhcmV0KSB7XG4gICAgICAgICAgICBjYXJldC5zdG9wKHRydWUsIGZhbHNlKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICB0b3A6IG5ld1RvcCAtIHNtb290aGxpbmVzY3JvbGwsXG4gICAgICAgICAgICAgICAgbGVmdDogbmV3TGVmdCxcbiAgICAgICAgICAgIH0sIFNsb3dUaW1lci5nZXQoKSA/IDAgOiAxMDApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY2FyZXQuc3RvcCh0cnVlLCB0cnVlKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICB0b3A6IG5ld1RvcCAtIHNtb290aGxpbmVzY3JvbGwsXG4gICAgICAgICAgICAgICAgbGVmdDogbmV3TGVmdCxcbiAgICAgICAgICAgIH0sIDApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnNob3dBbGxMaW5lcykge1xuICAgICAgICAgICAgY29uc3QgYnJvd3NlckhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICAgICAgICAgIGNvbnN0IG1pZGRsZVBvcyA9IGJyb3dzZXJIZWlnaHQgLyAyIC0gJChcIiNjYXJldFwiKS5vdXRlckhlaWdodCgpIC8gMjtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnRIZWlnaHQgPSBkb2N1bWVudC5ib2R5LnNjcm9sbEhlaWdodDtcbiAgICAgICAgICAgIGlmIChuZXdUb3AgPj0gbWlkZGxlUG9zICYmXG4gICAgICAgICAgICAgICAgY29udGVudEhlaWdodCA+IGJyb3dzZXJIZWlnaHQgJiZcbiAgICAgICAgICAgICAgICBUZXN0QWN0aXZlLmdldCgpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3c2Nyb2xsdG9wID0gbmV3VG9wIC0gbWlkZGxlUG9zIC8gMjtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnLS0tLS0tLS0tJyk7XG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cobmV3VG9wKTtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhtaWRkbGVQb3MpO1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGJyb3dzZXJIZWlnaHQpO1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGNvbnRlbnRIZWlnaHQpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbyh7XG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIHRvcDogbmV3c2Nyb2xsdG9wLFxuICAgICAgICAgICAgICAgICAgICBiZWhhdmlvcjogXCJzbW9vdGhcIixcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoYWN0aXZlV29yZEVtcHR5KSB7XG4gICAgICAgICAgICAkKFwiI3dvcmRzIC5hY3RpdmVcIikuY2hpbGRyZW4oKS5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy51cGRhdGVQb3NpdGlvbiA9IHVwZGF0ZVBvc2l0aW9uO1xuZnVuY3Rpb24gc2hvdygpIHtcbiAgICBpZiAoJChcIiNyZXN1bHRcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgdXBkYXRlUG9zaXRpb24oKTtcbiAgICAgICAgJChcIiNjYXJldFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgc3RhcnRBbmltYXRpb24oKTtcbiAgICB9XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmdldEN1c3RvbVRleHROYW1lcyA9IGV4cG9ydHMuZGVsZXRlQ3VzdG9tVGV4dCA9IGV4cG9ydHMuc2V0Q3VzdG9tVGV4dCA9IGV4cG9ydHMuZ2V0Q3VzdG9tVGV4dCA9IGV4cG9ydHMuc2V0RGVsaW1pdGVyID0gZXhwb3J0cy5zZXRXb3JkID0gZXhwb3J0cy5zZXRUaW1lID0gZXhwb3J0cy5zZXRJc1RpbWVSYW5kb20gPSBleHBvcnRzLnNldElzV29yZFJhbmRvbSA9IGV4cG9ydHMuc2V0VGV4dCA9IGV4cG9ydHMuZGVsaW1pdGVyID0gZXhwb3J0cy50aW1lID0gZXhwb3J0cy53b3JkID0gZXhwb3J0cy5pc1RpbWVSYW5kb20gPSBleHBvcnRzLmlzV29yZFJhbmRvbSA9IGV4cG9ydHMudGV4dCA9IHZvaWQgMDtcbmV4cG9ydHMudGV4dCA9IFtcbiAgICBcIlRoZVwiLFxuICAgIFwicXVpY2tcIixcbiAgICBcImJyb3duXCIsXG4gICAgXCJmb3hcIixcbiAgICBcImp1bXBzXCIsXG4gICAgXCJvdmVyXCIsXG4gICAgXCJ0aGVcIixcbiAgICBcImxhenlcIixcbiAgICBcImRvZ1wiLFxuXTtcbmV4cG9ydHMuaXNXb3JkUmFuZG9tID0gZmFsc2U7XG5leHBvcnRzLmlzVGltZVJhbmRvbSA9IGZhbHNlO1xuZXhwb3J0cy5kZWxpbWl0ZXIgPSBcIiBcIjtcbmZ1bmN0aW9uIHNldFRleHQodHh0KSB7XG4gICAgZXhwb3J0cy50ZXh0ID0gdHh0O1xufVxuZXhwb3J0cy5zZXRUZXh0ID0gc2V0VGV4dDtcbmZ1bmN0aW9uIHNldElzV29yZFJhbmRvbSh2YWwpIHtcbiAgICBleHBvcnRzLmlzV29yZFJhbmRvbSA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0SXNXb3JkUmFuZG9tID0gc2V0SXNXb3JkUmFuZG9tO1xuZnVuY3Rpb24gc2V0SXNUaW1lUmFuZG9tKHZhbCkge1xuICAgIGV4cG9ydHMuaXNUaW1lUmFuZG9tID0gdmFsO1xufVxuZXhwb3J0cy5zZXRJc1RpbWVSYW5kb20gPSBzZXRJc1RpbWVSYW5kb207XG5mdW5jdGlvbiBzZXRUaW1lKHZhbCkge1xuICAgIGV4cG9ydHMudGltZSA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0VGltZSA9IHNldFRpbWU7XG5mdW5jdGlvbiBzZXRXb3JkKHZhbCkge1xuICAgIGV4cG9ydHMud29yZCA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0V29yZCA9IHNldFdvcmQ7XG5mdW5jdGlvbiBzZXREZWxpbWl0ZXIodmFsKSB7XG4gICAgZXhwb3J0cy5kZWxpbWl0ZXIgPSB2YWw7XG59XG5leHBvcnRzLnNldERlbGltaXRlciA9IHNldERlbGltaXRlcjtcbmZ1bmN0aW9uIGdldEN1c3RvbVRleHQobmFtZSkge1xuICAgIGNvbnN0IGN1c3RvbVRleHQgPSBnZXRDdXN0b21UZXh0T2JqZWN0KCk7XG4gICAgcmV0dXJuIGN1c3RvbVRleHRbbmFtZV0uc3BsaXQoLyArLyk7XG59XG5leHBvcnRzLmdldEN1c3RvbVRleHQgPSBnZXRDdXN0b21UZXh0O1xuZnVuY3Rpb24gc2V0Q3VzdG9tVGV4dChuYW1lLCB0ZXh0KSB7XG4gICAgY29uc3QgY3VzdG9tVGV4dCA9IGdldEN1c3RvbVRleHRPYmplY3QoKTtcbiAgICBpZiAodHlwZW9mIHRleHQgPT09IFwic3RyaW5nXCIpXG4gICAgICAgIGN1c3RvbVRleHRbbmFtZV0gPSB0ZXh0O1xuICAgIGVsc2VcbiAgICAgICAgY3VzdG9tVGV4dFtuYW1lXSA9IHRleHQuam9pbihcIiBcIik7XG4gICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiY3VzdG9tVGV4dFwiLCBKU09OLnN0cmluZ2lmeShjdXN0b21UZXh0KSk7XG59XG5leHBvcnRzLnNldEN1c3RvbVRleHQgPSBzZXRDdXN0b21UZXh0O1xuZnVuY3Rpb24gZGVsZXRlQ3VzdG9tVGV4dChuYW1lKSB7XG4gICAgY29uc3QgY3VzdG9tVGV4dCA9IGdldEN1c3RvbVRleHRPYmplY3QoKTtcbiAgICBpZiAoY3VzdG9tVGV4dFtuYW1lXSlcbiAgICAgICAgZGVsZXRlIGN1c3RvbVRleHRbbmFtZV07XG4gICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiY3VzdG9tVGV4dFwiLCBKU09OLnN0cmluZ2lmeShjdXN0b21UZXh0KSk7XG59XG5leHBvcnRzLmRlbGV0ZUN1c3RvbVRleHQgPSBkZWxldGVDdXN0b21UZXh0O1xuZnVuY3Rpb24gZ2V0Q3VzdG9tVGV4dE9iamVjdCgpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UoKF9hID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiY3VzdG9tVGV4dFwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCJ7fVwiKTtcbn1cbmZ1bmN0aW9uIGdldEN1c3RvbVRleHROYW1lcygpIHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXMoZ2V0Q3VzdG9tVGV4dE9iamVjdCgpKTtcbn1cbmV4cG9ydHMuZ2V0Q3VzdG9tVGV4dE5hbWVzID0gZ2V0Q3VzdG9tVGV4dE5hbWVzO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2V0ID0gdm9pZCAwO1xuY29uc3QgQ2FyZXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY2FyZXRcIikpO1xuY29uc3QgQWN0aXZlUGFnZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL2FjdGl2ZS1wYWdlXCIpKTtcbmNvbnN0IHVuZm9jdXNQeCA9IDM7XG5sZXQgc3RhdGUgPSBmYWxzZTtcbmZ1bmN0aW9uIHNldChmb2MsIHdpdGhDdXJzb3IgPSBmYWxzZSkge1xuICAgIGlmIChmb2MgJiYgIXN0YXRlKSB7XG4gICAgICAgIHN0YXRlID0gdHJ1ZTtcbiAgICAgICAgQ2FyZXQuc3RvcEFuaW1hdGlvbigpO1xuICAgICAgICAkKFwiI3RvcFwiKS5hZGRDbGFzcyhcImZvY3VzXCIpO1xuICAgICAgICAkKFwiI2JvdHRvbVwiKS5hZGRDbGFzcyhcImZvY3VzXCIpO1xuICAgICAgICBpZiAoIXdpdGhDdXJzb3IpXG4gICAgICAgICAgICAkKFwiYm9keVwiKS5jc3MoXCJjdXJzb3JcIiwgXCJub25lXCIpO1xuICAgICAgICAkKFwiI21pZGRsZVwiKS5hZGRDbGFzcyhcImZvY3VzXCIpO1xuICAgICAgICAkKFwiI2Jhbm5lckNlbnRlclwiKS5hZGRDbGFzcyhcImZvY3VzXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmICghZm9jICYmIHN0YXRlKSB7XG4gICAgICAgIHN0YXRlID0gZmFsc2U7XG4gICAgICAgIENhcmV0LnN0YXJ0QW5pbWF0aW9uKCk7XG4gICAgICAgICQoXCIjdG9wXCIpLnJlbW92ZUNsYXNzKFwiZm9jdXNcIik7XG4gICAgICAgICQoXCIjYm90dG9tXCIpLnJlbW92ZUNsYXNzKFwiZm9jdXNcIik7XG4gICAgICAgICQoXCJib2R5XCIpLmNzcyhcImN1cnNvclwiLCBcImRlZmF1bHRcIik7XG4gICAgICAgICQoXCIjbWlkZGxlXCIpLnJlbW92ZUNsYXNzKFwiZm9jdXNcIik7XG4gICAgICAgICQoXCIjYmFubmVyQ2VudGVyXCIpLnJlbW92ZUNsYXNzKFwiZm9jdXNcIik7XG4gICAgfVxufVxuZXhwb3J0cy5zZXQgPSBzZXQ7XG4kKGRvY3VtZW50KS5tb3VzZW1vdmUoZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgaWYgKCFzdGF0ZSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09IFwibG9hZGluZ1wiKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT0gXCJhY2NvdW50XCIgJiYgc3RhdGUgPT0gdHJ1ZSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmICgkKFwiI3RvcFwiKS5oYXNDbGFzcyhcImZvY3VzXCIpICYmXG4gICAgICAgIGV2ZW50Lm9yaWdpbmFsRXZlbnQgJiZcbiAgICAgICAgLy8gVG8gYXZvaWQgbW91c2UvZGVzayB2aWJyYXRpb24gZnJvbSBjcmVhdGluZyBhIGZsYXNoeSBlZmZlY3QsIHdlJ2xsIHVuZm9jdXMgQCA+NXB4IGluc3RlYWQgb2YgPjBweFxuICAgICAgICAoZXZlbnQub3JpZ2luYWxFdmVudC5tb3ZlbWVudFggPiB1bmZvY3VzUHggfHxcbiAgICAgICAgICAgIGV2ZW50Lm9yaWdpbmFsRXZlbnQubW92ZW1lbnRZID4gdW5mb2N1c1B4KSkge1xuICAgICAgICBzZXQoZmFsc2UpO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5yZW1lbWJlclNldHRpbmdzID0gZXhwb3J0cy5hY3RpdmF0ZSA9IGV4cG9ydHMuY2xlYXIgPSBleHBvcnRzLnNldEZ1bmJveCA9IGV4cG9ydHMudG9nZ2xlU2NyaXB0ID0gZXhwb3J0cy5yZXNldCA9IGV4cG9ydHMuc3RhcnRNZW1vcnlUaW1lciA9IGV4cG9ydHMucmVzZXRNZW1vcnlUaW1lciA9IHZvaWQgMDtcbmNvbnN0IFRlc3RXb3JkcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXdvcmRzXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBNYW51YWxSZXN0YXJ0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL21hbnVhbC1yZXN0YXJ0LXRyYWNrZXJcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgVFRTID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3R0c1wiKSk7XG5jb25zdCBNb2Rlc05vdGljZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbW9kZXMtbm90aWNlXCIpKTtcbmxldCBtb2RlU2F2ZWQgPSBudWxsO1xubGV0IG1lbW9yeVRpbWVyID0gbnVsbDtcbmxldCBtZW1vcnlJbnRlcnZhbCA9IG51bGw7XG5sZXQgc2V0dGluZ3NNZW1vcnkgPSB7fTtcbmZ1bmN0aW9uIHJlbWVtYmVyU2V0dGluZyhzZXR0aW5nTmFtZSwgdmFsdWUsIHNldEZ1bmN0aW9uKSB7XG4gICAgdmFyIF9hO1xuICAgIChfYSA9IHNldHRpbmdzTWVtb3J5W3NldHRpbmdOYW1lXSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKHNldHRpbmdzTWVtb3J5W3NldHRpbmdOYW1lXSA9IHtcbiAgICAgICAgdmFsdWUsXG4gICAgICAgIHNldEZ1bmN0aW9uLFxuICAgIH0pO1xufVxuZnVuY3Rpb24gbG9hZE1lbW9yeSgpIHtcbiAgICBOb3RpZmljYXRpb25zLmFkZChcIlJldmVydGluZyBmdW5ib3ggc2V0dGluZ3NcIiwgMCk7XG4gICAgT2JqZWN0LmtleXMoc2V0dGluZ3NNZW1vcnkpLmZvckVhY2goKHNldHRpbmcpID0+IHtcbiAgICAgICAgc2V0dGluZ3NNZW1vcnlbc2V0dGluZ10uc2V0RnVuY3Rpb24oc2V0dGluZ3NNZW1vcnlbc2V0dGluZ10udmFsdWUsIHRydWUpO1xuICAgIH0pO1xuICAgIHNldHRpbmdzTWVtb3J5ID0ge307XG59XG5mdW5jdGlvbiBzaG93TWVtb3J5VGltZXIoKSB7XG4gICAgJChcIiN0eXBpbmdUZXN0ICNtZW1vcnlUaW1lclwiKS5zdG9wKHRydWUsIHRydWUpLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiAxLFxuICAgIH0sIDEyNSk7XG59XG5mdW5jdGlvbiBoaWRlTWVtb3J5VGltZXIoKSB7XG4gICAgJChcIiN0eXBpbmdUZXN0ICNtZW1vcnlUaW1lclwiKS5zdG9wKHRydWUsIHRydWUpLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiAwLFxuICAgIH0sIDEyNSk7XG59XG5mdW5jdGlvbiByZXNldE1lbW9yeVRpbWVyKCkge1xuICAgIGlmIChtZW1vcnlJbnRlcnZhbCAhPT0gbnVsbCkge1xuICAgICAgICBjbGVhckludGVydmFsKG1lbW9yeUludGVydmFsKTtcbiAgICAgICAgbWVtb3J5SW50ZXJ2YWwgPSBudWxsO1xuICAgIH1cbiAgICBtZW1vcnlUaW1lciA9IG51bGw7XG4gICAgaGlkZU1lbW9yeVRpbWVyKCk7XG59XG5leHBvcnRzLnJlc2V0TWVtb3J5VGltZXIgPSByZXNldE1lbW9yeVRpbWVyO1xuZnVuY3Rpb24gdXBkYXRlTWVtb3J5VGltZXIoc2VjKSB7XG4gICAgJChcIiN0eXBpbmdUZXN0ICNtZW1vcnlUaW1lclwiKS50ZXh0KGBUaW1lciBsZWZ0IHRvIG1lbW9yaXNlIGFsbCB3b3JkczogJHtzZWN9c2ApO1xufVxuZnVuY3Rpb24gc3RhcnRNZW1vcnlUaW1lcigpIHtcbiAgICByZXNldE1lbW9yeVRpbWVyKCk7XG4gICAgbWVtb3J5VGltZXIgPSBNYXRoLnJvdW5kKE1hdGgucG93KFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGgsIDEuMikpO1xuICAgIHVwZGF0ZU1lbW9yeVRpbWVyKG1lbW9yeVRpbWVyKTtcbiAgICBzaG93TWVtb3J5VGltZXIoKTtcbiAgICBtZW1vcnlJbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgaWYgKG1lbW9yeVRpbWVyID09PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBtZW1vcnlUaW1lciAtPSAxO1xuICAgICAgICBtZW1vcnlUaW1lciA9PSAwID8gaGlkZU1lbW9yeVRpbWVyKCkgOiB1cGRhdGVNZW1vcnlUaW1lcihtZW1vcnlUaW1lcik7XG4gICAgICAgIGlmIChtZW1vcnlUaW1lciA8PSAwKSB7XG4gICAgICAgICAgICByZXNldE1lbW9yeVRpbWVyKCk7XG4gICAgICAgICAgICAkKFwiI3dvcmRzV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgIH0sIDEwMDApO1xufVxuZXhwb3J0cy5zdGFydE1lbW9yeVRpbWVyID0gc3RhcnRNZW1vcnlUaW1lcjtcbmZ1bmN0aW9uIHJlc2V0KCkge1xuICAgIHJlc2V0TWVtb3J5VGltZXIoKTtcbn1cbmV4cG9ydHMucmVzZXQgPSByZXNldDtcbmZ1bmN0aW9uIHRvZ2dsZVNjcmlwdCguLi5wYXJhbXMpIHtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwidHRzXCIpIHtcbiAgICAgICAgVFRTLnNwZWFrKHBhcmFtc1swXSk7XG4gICAgfVxufVxuZXhwb3J0cy50b2dnbGVTY3JpcHQgPSB0b2dnbGVTY3JpcHQ7XG5mdW5jdGlvbiBzZXRGdW5ib3goZnVuYm94LCBtb2RlKSB7XG4gICAgbW9kZVNhdmVkID0gbW9kZTtcbiAgICBVcGRhdGVDb25maWcuc2V0RnVuYm94KGZ1bmJveCwgZmFsc2UpO1xuICAgIGlmIChmdW5ib3ggPT09IFwibm9uZVwiKVxuICAgICAgICBsb2FkTWVtb3J5KCk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEZ1bmJveCA9IHNldEZ1bmJveDtcbmZ1bmN0aW9uIGNsZWFyKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICQoXCIjZnVuQm94VGhlbWVcIikuYXR0cihcImhyZWZcIiwgYGApO1xuICAgICAgICAkKFwiI3dvcmRzXCIpLnJlbW92ZUNsYXNzKFwibm9zcGFjZVwiKTtcbiAgICAgICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcImFycm93c1wiKTtcbiAgICAgICAgcmVzZXQoKTtcbiAgICAgICAgJChcIiN3b3Jkc1dyYXBwZXJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgICAgIE1vZGVzTm90aWNlLnVwZGF0ZSgpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuY2xlYXIgPSBjbGVhcjtcbmZ1bmN0aW9uIGFjdGl2YXRlKGZ1bmJveCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGxldCBtb2RlID0gbW9kZVNhdmVkO1xuICAgICAgICBpZiAoZnVuYm94ID09PSB1bmRlZmluZWQgfHwgZnVuYm94ID09PSBudWxsKSB7XG4gICAgICAgICAgICBmdW5ib3ggPSBjb25maWdfMS5kZWZhdWx0LmZ1bmJveDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBmdW5ib3hJbmZvID0geWllbGQgTWlzYy5nZXRGdW5ib3goZnVuYm94KTtcbiAgICAgICAgJChcIiNmdW5Cb3hUaGVtZVwiKS5hdHRyKFwiaHJlZlwiLCBgYCk7XG4gICAgICAgICQoXCIjd29yZHNcIikucmVtb3ZlQ2xhc3MoXCJub3NwYWNlXCIpO1xuICAgICAgICAkKFwiI3dvcmRzXCIpLnJlbW92ZUNsYXNzKFwiYXJyb3dzXCIpO1xuICAgICAgICBpZiAoKHlpZWxkIE1pc2MuZ2V0Q3VycmVudExhbmd1YWdlKGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UpKS5saWdhdHVyZXMpIHtcbiAgICAgICAgICAgIGlmIChmdW5ib3ggPT0gXCJjaG9vX2Nob29cIiB8fCBmdW5ib3ggPT0gXCJlYXJ0aHF1YWtlXCIpIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkN1cnJlbnQgbGFuZ3VhZ2UgZG9lcyBub3Qgc3VwcG9ydCB0aGlzIGZ1bmJveCBtb2RlXCIsIDApO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGdW5ib3goXCJub25lXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIHlpZWxkIGNsZWFyKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChmdW5ib3ggIT09IFwibm9uZVwiICYmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiemVuXCIgfHwgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwicXVvdGVcIikpIHtcbiAgICAgICAgICAgIGlmICgoZnVuYm94SW5mbyA9PT0gbnVsbCB8fCBmdW5ib3hJbmZvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmdW5ib3hJbmZvLmFmZmVjdHNXb3JkR2VuZXJhdGlvbikgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgJHtNaXNjLmNhcGl0YWxpemVGaXJzdExldHRlck9mRWFjaFdvcmQoY29uZmlnXzEuZGVmYXVsdC5tb2RlKX0gbW9kZSBkb2VzIG5vdCBzdXBwb3J0IHRoZSAke2Z1bmJveH0gZnVuYm94YCwgMCk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZ1bmJveChcIm5vbmVcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgeWllbGQgY2xlYXIoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gaWYgKGZ1bmJveCA9PT0gXCJub25lXCIpIHtcbiAgICAgICAgcmVzZXQoKTtcbiAgICAgICAgJChcIiN3b3Jkc1dyYXBwZXJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIC8vIH1cbiAgICAgICAgaWYgKGZ1bmJveCA9PT0gXCJub25lXCIgJiYgbW9kZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBtb2RlID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICgoZnVuYm94ICE9PSBcIm5vbmVcIiAmJiBtb2RlID09PSB1bmRlZmluZWQpIHx8XG4gICAgICAgICAgICAoZnVuYm94ICE9PSBcIm5vbmVcIiAmJiBtb2RlID09PSBudWxsKSkge1xuICAgICAgICAgICAgY29uc3QgbGlzdCA9IHlpZWxkIE1pc2MuZ2V0RnVuYm94TGlzdCgpO1xuICAgICAgICAgICAgbW9kZSA9IGxpc3QuZmlsdGVyKChmKSA9PiBmLm5hbWUgPT09IGZ1bmJveClbMF0udHlwZTtcbiAgICAgICAgfVxuICAgICAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgICAgICBpZiAobW9kZSA9PT0gXCJzdHlsZVwiKSB7XG4gICAgICAgICAgICBpZiAoZnVuYm94ICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICQoXCIjZnVuQm94VGhlbWVcIikuYXR0cihcImhyZWZcIiwgYGZ1bmJveC8ke2Z1bmJveH0uY3NzYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZnVuYm94ID09PSBcInNpbW9uX3NheXNcIikge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBNb2RlKFwibmV4dFwiLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmdW5ib3ggPT09IFwicmVhZF9haGVhZFwiIHx8XG4gICAgICAgICAgICAgICAgZnVuYm94ID09PSBcInJlYWRfYWhlYWRfZWFzeVwiIHx8XG4gICAgICAgICAgICAgICAgZnVuYm94ID09PSBcInJlYWRfYWhlYWRfaGFyZFwiKSB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEhpZ2hsaWdodE1vZGUoXCJsZXR0ZXJcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobW9kZSA9PT0gXCJzY3JpcHRcIikge1xuICAgICAgICAgICAgaWYgKGZ1bmJveCA9PT0gXCJ0dHNcIikge1xuICAgICAgICAgICAgICAgICQoXCIjZnVuQm94VGhlbWVcIikuYXR0cihcImhyZWZcIiwgYGZ1bmJveC9zaW1vbl9zYXlzLmNzc2ApO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBNb2RlKFwib2ZmXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRIaWdobGlnaHRNb2RlKFwibGV0dGVyXCIsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZnVuYm94ID09PSBcImxheW91dGZsdWlkXCIpIHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TGF5b3V0KGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tTGF5b3V0Zmx1aWRcbiAgICAgICAgICAgICAgICAgICAgPyBjb25maWdfMS5kZWZhdWx0LmN1c3RvbUxheW91dGZsdWlkLnNwbGl0KFwiI1wiKVswXVxuICAgICAgICAgICAgICAgICAgICA6IFwicXdlcnR5XCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBMYXlvdXQoY29uZmlnXzEuZGVmYXVsdC5jdXN0b21MYXlvdXRmbHVpZFxuICAgICAgICAgICAgICAgICAgICA/IGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tTGF5b3V0Zmx1aWQuc3BsaXQoXCIjXCIpWzBdXG4gICAgICAgICAgICAgICAgICAgIDogXCJxd2VydHlcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmdW5ib3ggPT09IFwibWVtb3J5XCIpIHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcIndvcmRzXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaG93QWxsTGluZXModHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTW9kZSA9PT0gXCJuZXh0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcE1vZGUoXCJyZWFjdFwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmdW5ib3ggPT09IFwibm9zcGFjZVwiKSB7XG4gICAgICAgICAgICAgICAgJChcIiN3b3Jkc1wiKS5hZGRDbGFzcyhcIm5vc3BhY2VcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEhpZ2hsaWdodE1vZGUoXCJsZXR0ZXJcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmdW5ib3ggPT09IFwiYXJyb3dzXCIpIHtcbiAgICAgICAgICAgICAgICAkKFwiI3dvcmRzXCIpLmFkZENsYXNzKFwiYXJyb3dzXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRIaWdobGlnaHRNb2RlKFwibGV0dGVyXCIsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIE1vZGVzTm90aWNlLnVwZGF0ZSgpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuYWN0aXZhdGUgPSBhY3RpdmF0ZTtcbmZ1bmN0aW9uIHJlbWVtYmVyU2V0dGluZ3MoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgZnVuYm94ID0gY29uZmlnXzEuZGVmYXVsdC5mdW5ib3g7XG4gICAgICAgIGxldCBtb2RlID0gbW9kZVNhdmVkO1xuICAgICAgICBpZiAoZnVuYm94ID09PSBcIm5vbmVcIiAmJiBtb2RlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIG1vZGUgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKChmdW5ib3ggIT09IFwibm9uZVwiICYmIG1vZGUgPT09IHVuZGVmaW5lZCkgfHxcbiAgICAgICAgICAgIChmdW5ib3ggIT09IFwibm9uZVwiICYmIG1vZGUgPT09IG51bGwpKSB7XG4gICAgICAgICAgICBjb25zdCBsaXN0ID0geWllbGQgTWlzYy5nZXRGdW5ib3hMaXN0KCk7XG4gICAgICAgICAgICBtb2RlID0gbGlzdC5maWx0ZXIoKGYpID0+IGYubmFtZSA9PT0gZnVuYm94KVswXS50eXBlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtb2RlID09PSBcInN0eWxlXCIpIHtcbiAgICAgICAgICAgIGlmIChmdW5ib3ggPT09IFwic2ltb25fc2F5c1wiKSB7XG4gICAgICAgICAgICAgICAgcmVtZW1iZXJTZXR0aW5nKFwia2V5bWFwTW9kZVwiLCBjb25maWdfMS5kZWZhdWx0LmtleW1hcE1vZGUsIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBNb2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmdW5ib3ggPT09IFwicmVhZF9haGVhZFwiIHx8XG4gICAgICAgICAgICAgICAgZnVuYm94ID09PSBcInJlYWRfYWhlYWRfZWFzeVwiIHx8XG4gICAgICAgICAgICAgICAgZnVuYm94ID09PSBcInJlYWRfYWhlYWRfaGFyZFwiKSB7XG4gICAgICAgICAgICAgICAgcmVtZW1iZXJTZXR0aW5nKFwiaGlnaGxpZ2h0TW9kZVwiLCBjb25maWdfMS5kZWZhdWx0LmhpZ2hsaWdodE1vZGUsIFVwZGF0ZUNvbmZpZy5zZXRIaWdobGlnaHRNb2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChtb2RlID09PSBcInNjcmlwdFwiKSB7XG4gICAgICAgICAgICBpZiAoZnVuYm94ID09PSBcInR0c1wiKSB7XG4gICAgICAgICAgICAgICAgcmVtZW1iZXJTZXR0aW5nKFwia2V5bWFwTW9kZVwiLCBjb25maWdfMS5kZWZhdWx0LmtleW1hcE1vZGUsIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBNb2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZ1bmJveCA9PT0gXCJsYXlvdXRmbHVpZFwiKSB7XG4gICAgICAgICAgICAgICAgcmVtZW1iZXJTZXR0aW5nKFwia2V5bWFwTW9kZVwiLCBjb25maWdfMS5kZWZhdWx0LmtleW1hcE1vZGUsIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBNb2RlKTtcbiAgICAgICAgICAgICAgICByZW1lbWJlclNldHRpbmcoXCJsYXlvdXRcIiwgY29uZmlnXzEuZGVmYXVsdC5sYXlvdXQsIFVwZGF0ZUNvbmZpZy5zZXRMYXlvdXQpO1xuICAgICAgICAgICAgICAgIHJlbWVtYmVyU2V0dGluZyhcImtleW1hcExheW91dFwiLCBjb25maWdfMS5kZWZhdWx0LmtleW1hcExheW91dCwgVXBkYXRlQ29uZmlnLnNldEtleW1hcExheW91dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmdW5ib3ggPT09IFwibWVtb3J5XCIpIHtcbiAgICAgICAgICAgICAgICByZW1lbWJlclNldHRpbmcoXCJtb2RlXCIsIGNvbmZpZ18xLmRlZmF1bHQubW9kZSwgVXBkYXRlQ29uZmlnLnNldE1vZGUpO1xuICAgICAgICAgICAgICAgIHJlbWVtYmVyU2V0dGluZyhcInNob3dBbGxMaW5lc1wiLCBjb25maWdfMS5kZWZhdWx0LnNob3dBbGxMaW5lcywgVXBkYXRlQ29uZmlnLnNldFNob3dBbGxMaW5lcyk7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTW9kZSA9PT0gXCJuZXh0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVtZW1iZXJTZXR0aW5nKFwia2V5bWFwTW9kZVwiLCBjb25maWdfMS5kZWZhdWx0LmtleW1hcE1vZGUsIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBNb2RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmdW5ib3ggPT09IFwibm9zcGFjZVwiKSB7XG4gICAgICAgICAgICAgICAgcmVtZW1iZXJTZXR0aW5nKFwiaGlnaGxpZ2h0TW9kZVwiLCBjb25maWdfMS5kZWZhdWx0LmhpZ2hsaWdodE1vZGUsIFVwZGF0ZUNvbmZpZy5zZXRIaWdobGlnaHRNb2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICAgICAgICAgIHJlbWVtYmVyU2V0dGluZyhcImhpZ2hsaWdodE1vZGVcIiwgY29uZmlnXzEuZGVmYXVsdC5oaWdobGlnaHRNb2RlLCBVcGRhdGVDb25maWcuc2V0SGlnaGxpZ2h0TW9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmdW5ib3ggPT09IFwiNTgwMDhcIikge1xuICAgICAgICAgICAgICAgIHJlbWVtYmVyU2V0dGluZyhcIm51bWJlcnNcIiwgY29uZmlnXzEuZGVmYXVsdC5udW1iZXJzLCBVcGRhdGVDb25maWcuc2V0TnVtYmVycyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMucmVtZW1iZXJTZXR0aW5ncyA9IHJlbWVtYmVyU2V0dGluZ3M7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmdldENoYXJGcm9tRXZlbnQgPSB2b2lkIDA7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgY2Fwc193YXJuaW5nXzEgPSByZXF1aXJlKFwiLi9jYXBzLXdhcm5pbmdcIik7XG5mdW5jdGlvbiBnZXRDaGFyRnJvbUV2ZW50KGV2ZW50KSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgZnVuY3Rpb24gZW11bGF0ZWRMYXlvdXRTaG91bGRTaGlmdEtleShldmVudCwgbmV3S2V5UHJldmlldykge1xuICAgICAgICAgICAgaWYgKGNhcHNfd2FybmluZ18xLmNhcHNTdGF0ZSlcbiAgICAgICAgICAgICAgICByZXR1cm4gTWlzYy5pc0FTQ0lJTGV0dGVyKG5ld0tleVByZXZpZXcpICE9PSBldmVudC5zaGlmdEtleTtcbiAgICAgICAgICAgIHJldHVybiBldmVudC5zaGlmdEtleTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBsYXlvdXQgPSB5aWVsZCBNaXNjLmdldExheW91dChjb25maWdfMS5kZWZhdWx0LmxheW91dCk7XG4gICAgICAgIGxldCBrZXlFdmVudENvZGVzID0gW107XG4gICAgICAgIGlmIChsYXlvdXQudHlwZSA9PT0gXCJhbnNpXCIpIHtcbiAgICAgICAgICAgIGtleUV2ZW50Q29kZXMgPSBbXG4gICAgICAgICAgICAgICAgXCJCYWNrcXVvdGVcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0MVwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQyXCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDNcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0NFwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ1XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDZcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0N1wiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ4XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDlcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0MFwiLFxuICAgICAgICAgICAgICAgIFwiTWludXNcIixcbiAgICAgICAgICAgICAgICBcIkVxdWFsXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlRXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlXXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlFXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlSXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlUXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlZXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlVXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlJXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlPXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlQXCIsXG4gICAgICAgICAgICAgICAgXCJCcmFja2V0TGVmdFwiLFxuICAgICAgICAgICAgICAgIFwiQnJhY2tldFJpZ2h0XCIsXG4gICAgICAgICAgICAgICAgXCJCYWNrc2xhc2hcIixcbiAgICAgICAgICAgICAgICBcIktleUFcIixcbiAgICAgICAgICAgICAgICBcIktleVNcIixcbiAgICAgICAgICAgICAgICBcIktleURcIixcbiAgICAgICAgICAgICAgICBcIktleUZcIixcbiAgICAgICAgICAgICAgICBcIktleUdcIixcbiAgICAgICAgICAgICAgICBcIktleUhcIixcbiAgICAgICAgICAgICAgICBcIktleUpcIixcbiAgICAgICAgICAgICAgICBcIktleUtcIixcbiAgICAgICAgICAgICAgICBcIktleUxcIixcbiAgICAgICAgICAgICAgICBcIlNlbWljb2xvblwiLFxuICAgICAgICAgICAgICAgIFwiUXVvdGVcIixcbiAgICAgICAgICAgICAgICBcIktleVpcIixcbiAgICAgICAgICAgICAgICBcIktleVhcIixcbiAgICAgICAgICAgICAgICBcIktleUNcIixcbiAgICAgICAgICAgICAgICBcIktleVZcIixcbiAgICAgICAgICAgICAgICBcIktleUJcIixcbiAgICAgICAgICAgICAgICBcIktleU5cIixcbiAgICAgICAgICAgICAgICBcIktleU1cIixcbiAgICAgICAgICAgICAgICBcIkNvbW1hXCIsXG4gICAgICAgICAgICAgICAgXCJQZXJpb2RcIixcbiAgICAgICAgICAgICAgICBcIlNsYXNoXCIsXG4gICAgICAgICAgICAgICAgXCJTcGFjZVwiLFxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChsYXlvdXQudHlwZSA9PT0gXCJpc29cIikge1xuICAgICAgICAgICAga2V5RXZlbnRDb2RlcyA9IFtcbiAgICAgICAgICAgICAgICBcIkJhY2txdW90ZVwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQxXCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDJcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0M1wiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ0XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDVcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0NlwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ3XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDhcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0OVwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQwXCIsXG4gICAgICAgICAgICAgICAgXCJNaW51c1wiLFxuICAgICAgICAgICAgICAgIFwiRXF1YWxcIixcbiAgICAgICAgICAgICAgICBcIktleVFcIixcbiAgICAgICAgICAgICAgICBcIktleVdcIixcbiAgICAgICAgICAgICAgICBcIktleUVcIixcbiAgICAgICAgICAgICAgICBcIktleVJcIixcbiAgICAgICAgICAgICAgICBcIktleVRcIixcbiAgICAgICAgICAgICAgICBcIktleVlcIixcbiAgICAgICAgICAgICAgICBcIktleVVcIixcbiAgICAgICAgICAgICAgICBcIktleUlcIixcbiAgICAgICAgICAgICAgICBcIktleU9cIixcbiAgICAgICAgICAgICAgICBcIktleVBcIixcbiAgICAgICAgICAgICAgICBcIkJyYWNrZXRMZWZ0XCIsXG4gICAgICAgICAgICAgICAgXCJCcmFja2V0UmlnaHRcIixcbiAgICAgICAgICAgICAgICBcIktleUFcIixcbiAgICAgICAgICAgICAgICBcIktleVNcIixcbiAgICAgICAgICAgICAgICBcIktleURcIixcbiAgICAgICAgICAgICAgICBcIktleUZcIixcbiAgICAgICAgICAgICAgICBcIktleUdcIixcbiAgICAgICAgICAgICAgICBcIktleUhcIixcbiAgICAgICAgICAgICAgICBcIktleUpcIixcbiAgICAgICAgICAgICAgICBcIktleUtcIixcbiAgICAgICAgICAgICAgICBcIktleUxcIixcbiAgICAgICAgICAgICAgICBcIlNlbWljb2xvblwiLFxuICAgICAgICAgICAgICAgIFwiUXVvdGVcIixcbiAgICAgICAgICAgICAgICBcIkludGxCYWNrc2xhc2hcIixcbiAgICAgICAgICAgICAgICBcIkJhY2txdW90ZVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5WlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5WFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5Q1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5VlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5QlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5TlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5TVwiLFxuICAgICAgICAgICAgICAgIFwiQ29tbWFcIixcbiAgICAgICAgICAgICAgICBcIlBlcmlvZFwiLFxuICAgICAgICAgICAgICAgIFwiU2xhc2hcIixcbiAgICAgICAgICAgICAgICBcIlNwYWNlXCIsXG4gICAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGxheW91dC50eXBlID09PSBcIm1hdHJpeFwiKSB7XG4gICAgICAgICAgICBrZXlFdmVudENvZGVzID0gW1xuICAgICAgICAgICAgICAgIFwiQmFja3F1b3RlXCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDFcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0MlwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQzXCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDRcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0NVwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ2XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDdcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0OFwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ5XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDBcIixcbiAgICAgICAgICAgICAgICBcIk1pbnVzXCIsXG4gICAgICAgICAgICAgICAgXCJFcXVhbFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5UVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5V1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5RVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5UlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5VFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5WVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5VVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5SVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5T1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5UFwiLFxuICAgICAgICAgICAgICAgIFwiQnJhY2tldExlZnRcIixcbiAgICAgICAgICAgICAgICBcIkJyYWNrZXRSaWdodFwiLFxuICAgICAgICAgICAgICAgIFwiQmFja3NsYXNoXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlBXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlTXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlEXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlGXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlHXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlIXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlKXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlLXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlMXCIsXG4gICAgICAgICAgICAgICAgXCJTZW1pY29sb25cIixcbiAgICAgICAgICAgICAgICBcIlF1b3RlXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlaXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlYXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlDXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlWXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlCXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlOXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlNXCIsXG4gICAgICAgICAgICAgICAgXCJDb21tYVwiLFxuICAgICAgICAgICAgICAgIFwiUGVyaW9kXCIsXG4gICAgICAgICAgICAgICAgXCJTbGFzaFwiLFxuICAgICAgICAgICAgICAgIFwiU3BhY2VcIixcbiAgICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGF5b3V0S2V5cyA9IGxheW91dC5rZXlzO1xuICAgICAgICBjb25zdCBsYXlvdXRNYXAgPSBsYXlvdXRLZXlzW1wicm93MVwiXVxuICAgICAgICAgICAgLmNvbmNhdChsYXlvdXRLZXlzW1wicm93MlwiXSlcbiAgICAgICAgICAgIC5jb25jYXQobGF5b3V0S2V5c1tcInJvdzNcIl0pXG4gICAgICAgICAgICAuY29uY2F0KGxheW91dEtleXNbXCJyb3c0XCJdKVxuICAgICAgICAgICAgLmNvbmNhdChsYXlvdXRLZXlzW1wicm93NVwiXSk7XG4gICAgICAgIGxldCBtYXBJbmRleCA9IG51bGw7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5RXZlbnRDb2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGV2ZW50LmNvZGUgPT0ga2V5RXZlbnRDb2Rlc1tpXSkge1xuICAgICAgICAgICAgICAgIG1hcEluZGV4ID0gaTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIW1hcEluZGV4KSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQuY29kZS5pbmNsdWRlcyhcIk51bXBhZFwiKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBldmVudC5rZXk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuZXdLZXlQcmV2aWV3ID0gbGF5b3V0TWFwW21hcEluZGV4XVswXTtcbiAgICAgICAgY29uc3Qgc2hpZnQgPSBlbXVsYXRlZExheW91dFNob3VsZFNoaWZ0S2V5KGV2ZW50LCBuZXdLZXlQcmV2aWV3KSA/IDEgOiAwO1xuICAgICAgICBjb25zdCBjaGFyID0gbGF5b3V0TWFwW21hcEluZGV4XVtzaGlmdF07XG4gICAgICAgIGlmIChjaGFyKSB7XG4gICAgICAgICAgICByZXR1cm4gY2hhcjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBldmVudC5rZXk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0Q2hhckZyb21FdmVudCA9IGdldENoYXJGcm9tRXZlbnQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucmVwbGFjZUFjY2VudHMgPSB2b2lkIDA7XG5jb25zdCBhY2NlbnRzID0gW1xuICAgIFtcIsOhw6DDosOkw6XDo8SFxIXMgcSBxIXMhMSDXCIsIFwiYVwiXSxcbiAgICBbXCLDqcOow6rDq+G6vcSZxJnMgcSTxJnMhMSXxJtcIiwgXCJlXCJdLFxuICAgIFtcIsOtw6zDrsOvxKnEr8SvzIHEq8SvzIRcIiwgXCJpXCJdLFxuICAgIFtcIsOzw7LDtMO2w7jDtcOzxY3Hq8erzIHHrcWRXCIsIFwib1wiXSxcbiAgICBbXCLDusO5w7vDvMWtxanDusWrxa/FsVwiLCBcInVcIl0sXG4gICAgW1wixYTFiFwiLCBcIm5cIl0sXG4gICAgW1wiw6fEicSNxIdcIiwgXCJjXCJdLFxuICAgIFtcIsWZXCIsIFwiclwiXSxcbiAgICBbXCLEj1wiLCBcImRcIl0sXG4gICAgW1wixaXIm1wiLCBcInRcIl0sXG4gICAgW1wiw6ZcIiwgXCJhZVwiXSxcbiAgICBbXCLFk1wiLCBcIm9lXCJdLFxuICAgIFtcIuG6hVwiLCBcIndcIl0sXG4gICAgW1wixJ3En2fMg1wiLCBcImdcIl0sXG4gICAgW1wixKVcIiwgXCJoXCJdLFxuICAgIFtcIsS1XCIsIFwialwiXSxcbiAgICBbXCLFhFwiLCBcIm5cIl0sXG4gICAgW1wixZ3Fm8WhyJlcIiwgXCJzXCJdLFxuICAgIFtcIsW8xbrFvlwiLCBcInpcIl0sXG4gICAgW1wiw7/hu7nDvcO/xbdcIiwgXCJ5XCJdLFxuICAgIFtcIsWCxL5cIiwgXCJsXCJdLFxuICAgIFtcItij2KXYolwiLCBcItinXCJdLFxuICAgIFtcItmOXCIsIFwiXCJdLFxuICAgIFtcItmPXCIsIFwiXCJdLFxuICAgIFtcItmQXCIsIFwiXCJdLFxuICAgIFtcItmSXCIsIFwiXCJdLFxuICAgIFtcItmLXCIsIFwiXCJdLFxuICAgIFtcItmMXCIsIFwiXCJdLFxuICAgIFtcItmNXCIsIFwiXCJdLFxuICAgIFtcItmRXCIsIFwiXCJdLFxuXTtcbmZ1bmN0aW9uIHJlcGxhY2VBY2NlbnRzKHdvcmQsIGFjY2VudHNPdmVycmlkZSkge1xuICAgIGxldCBuZXdXb3JkID0gd29yZDtcbiAgICBpZiAoIWFjY2VudHMgJiYgIWFjY2VudHNPdmVycmlkZSlcbiAgICAgICAgcmV0dXJuIG5ld1dvcmQ7XG4gICAgbGV0IHJlZ2V4O1xuICAgIGNvbnN0IGxpc3QgPSBhY2NlbnRzT3ZlcnJpZGUgfHwgYWNjZW50cztcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgcmVnZXggPSBuZXcgUmVnRXhwKGBbJHtsaXN0W2ldWzBdfV1gLCBcImdpXCIpO1xuICAgICAgICBuZXdXb3JkID0gbmV3V29yZC5yZXBsYWNlKHJlZ2V4LCBsaXN0W2ldWzFdKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ld1dvcmQ7XG59XG5leHBvcnRzLnJlcGxhY2VBY2NlbnRzID0gcmVwbGFjZUFjY2VudHM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5zaG93ID0gZXhwb3J0cy51cGRhdGUgPSB2b2lkIDA7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IFRlc3RBY3RpdmUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy90ZXN0LWFjdGl2ZVwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmZ1bmN0aW9uIHVwZGF0ZShhY2MpIHtcbiAgICBsZXQgbnVtYmVyID0gTWF0aC5mbG9vcihhY2MpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSkge1xuICAgICAgICBudW1iZXIgPSAxMDA7XG4gICAgfVxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAuYWNjXCIpLmlubmVySFRNTCA9XG4gICAgICAgIG51bWJlciArIFwiJVwiO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbGl2ZUFjY1wiKS5pbm5lckhUTUwgPSBudW1iZXIgKyBcIiVcIjtcbn1cbmV4cG9ydHMudXBkYXRlID0gdXBkYXRlO1xuZnVuY3Rpb24gc2hvdygpIHtcbiAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuc2hvd0xpdmVBY2MpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoIVRlc3RBY3RpdmUuZ2V0KCkpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC50aW1lclN0eWxlID09PSBcIm1pbmlcIikge1xuICAgICAgICAvLyAkKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLndwbVwiKS5jc3MoXCJvcGFjaXR5XCIsIENvbmZpZy50aW1lck9wYWNpdHkpO1xuICAgICAgICBpZiAoISQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAuYWNjXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLmFjY1wiKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogY29uZmlnXzEuZGVmYXVsdC50aW1lck9wYWNpdHksXG4gICAgICAgIH0sIDEyNSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyAkKFwiI2xpdmVXcG1cIikuY3NzKFwib3BhY2l0eVwiLCBDb25maWcudGltZXJPcGFjaXR5KTtcbiAgICAgICAgaWYgKCEkKFwiI2xpdmVBY2NcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICQoXCIjbGl2ZUFjY1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKS5jc3MoXCJvcGFjaXR5XCIsIDApLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogY29uZmlnXzEuZGVmYXVsdC50aW1lck9wYWNpdHksXG4gICAgICAgIH0sIDEyNSk7XG4gICAgfVxufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgLy8gJChcIiNsaXZlV3BtXCIpLmNzcyhcIm9wYWNpdHlcIiwgMCk7XG4gICAgLy8gJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC53cG1cIikuY3NzKFwib3BhY2l0eVwiLCAwKTtcbiAgICAkKFwiI2xpdmVBY2NcIikuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IGNvbmZpZ18xLmRlZmF1bHQudGltZXJPcGFjaXR5LFxuICAgIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAkKFwiI2xpdmVBY2NcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfSk7XG4gICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC5hY2NcIikuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IGNvbmZpZ18xLmRlZmF1bHQudGltZXJPcGFjaXR5LFxuICAgIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLmFjY1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5LCBldmVudFZhbHVlKSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcInNob3dMaXZlQWNjXCIpXG4gICAgICAgIGV2ZW50VmFsdWUgPyBzaG93KCkgOiBoaWRlKCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGlkZSA9IGV4cG9ydHMuc2hvdyA9IGV4cG9ydHMudXBkYXRlID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBUZXN0QWN0aXZlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvdGVzdC1hY3RpdmVcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5mdW5jdGlvbiB1cGRhdGUoYnVyc3QpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuc2hvd0xpdmVCdXJzdClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbGV0IG51bWJlciA9IGJ1cnN0O1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUpIHtcbiAgICAgICAgICAgIG51bWJlciA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC5idXJzdFwiKS5pbm5lckhUTUwgPVxuICAgICAgICAgICAgbnVtYmVyLnRvU3RyaW5nKCk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbGl2ZUJ1cnN0XCIpLmlubmVySFRNTCA9XG4gICAgICAgICAgICBudW1iZXIudG9TdHJpbmcoKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMudXBkYXRlID0gdXBkYXRlO1xuZnVuY3Rpb24gc2hvdygpIHtcbiAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuc2hvd0xpdmVCdXJzdClcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmICghVGVzdEFjdGl2ZS5nZXQoKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnRpbWVyU3R5bGUgPT09IFwibWluaVwiKSB7XG4gICAgICAgIGlmICghJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC5idXJzdFwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC5idXJzdFwiKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogY29uZmlnXzEuZGVmYXVsdC50aW1lck9wYWNpdHksXG4gICAgICAgIH0sIDEyNSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoISQoXCIjbGl2ZUJ1cnN0XCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAkKFwiI2xpdmVCdXJzdFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKS5jc3MoXCJvcGFjaXR5XCIsIDApLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogY29uZmlnXzEuZGVmYXVsdC50aW1lck9wYWNpdHksXG4gICAgICAgIH0sIDEyNSk7XG4gICAgfVxufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgJChcIiNsaXZlQnVyc3RcIikuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IGNvbmZpZ18xLmRlZmF1bHQudGltZXJPcGFjaXR5LFxuICAgIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAkKFwiI2xpdmVCdXJzdFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbiAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLmJ1cnN0XCIpLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiBjb25maWdfMS5kZWZhdWx0LnRpbWVyT3BhY2l0eSxcbiAgICB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC5idXJzdFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5LCBldmVudFZhbHVlKSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcInNob3dMaXZlQnVyc3RcIilcbiAgICAgICAgZXZlbnRWYWx1ZSA/IHNob3coKSA6IGhpZGUoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGlkZSA9IGV4cG9ydHMuc2hvdyA9IGV4cG9ydHMudXBkYXRlID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBUZXN0QWN0aXZlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvdGVzdC1hY3RpdmVcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBsaXZlV3BtRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbGl2ZVdwbVwiKTtcbmNvbnN0IG1pbmlMaXZlV3BtRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAud3BtXCIpO1xuZnVuY3Rpb24gdXBkYXRlKHdwbSwgcmF3KSB7XG4gICAgLy8gaWYgKCFUZXN0QWN0aXZlLmdldCgpIHx8ICFDb25maWcuc2hvd0xpdmVXcG0pIHtcbiAgICAvLyAgIGhpZGVMaXZlV3BtKCk7XG4gICAgLy8gfSBlbHNlIHtcbiAgICAvLyAgIHNob3dMaXZlV3BtKCk7XG4gICAgLy8gfVxuICAgIGxldCBudW1iZXIgPSB3cG07XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlKSB7XG4gICAgICAgIG51bWJlciA9IHJhdztcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSkge1xuICAgICAgICBudW1iZXIgPSBNYXRoLnJvdW5kKG51bWJlciAqIDUpO1xuICAgIH1cbiAgICBtaW5pTGl2ZVdwbUVsZW1lbnQuaW5uZXJIVE1MID0gbnVtYmVyLnRvU3RyaW5nKCk7XG4gICAgbGl2ZVdwbUVsZW1lbnQuaW5uZXJIVE1MID0gbnVtYmVyLnRvU3RyaW5nKCk7XG59XG5leHBvcnRzLnVwZGF0ZSA9IHVwZGF0ZTtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LnNob3dMaXZlV3BtKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKCFUZXN0QWN0aXZlLmdldCgpKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQudGltZXJTdHlsZSA9PT0gXCJtaW5pXCIpIHtcbiAgICAgICAgLy8gJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC53cG1cIikuY3NzKFwib3BhY2l0eVwiLCBDb25maWcudGltZXJPcGFjaXR5KTtcbiAgICAgICAgaWYgKCEkKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLndwbVwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC53cG1cIilcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IGNvbmZpZ18xLmRlZmF1bHQudGltZXJPcGFjaXR5LFxuICAgICAgICB9LCAxMjUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gJChcIiNsaXZlV3BtXCIpLmNzcyhcIm9wYWNpdHlcIiwgQ29uZmlnLnRpbWVyT3BhY2l0eSk7XG4gICAgICAgIGlmICghJChcIiNsaXZlV3BtXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAkKFwiI2xpdmVXcG1cIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIikuY3NzKFwib3BhY2l0eVwiLCAwKS5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IGNvbmZpZ18xLmRlZmF1bHQudGltZXJPcGFjaXR5LFxuICAgICAgICB9LCAxMjUpO1xuICAgIH1cbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgICQoXCIjbGl2ZVdwbVwiKS5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogY29uZmlnXzEuZGVmYXVsdC50aW1lck9wYWNpdHksXG4gICAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICQoXCIjbGl2ZVdwbVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbiAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLndwbVwiKS5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogY29uZmlnXzEuZGVmYXVsdC50aW1lck9wYWNpdHksXG4gICAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAud3BtXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXksIGV2ZW50VmFsdWUpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwic2hvd0xpdmVXcG1cIilcbiAgICAgICAgZXZlbnRWYWx1ZSA/IHNob3coKSA6IGhpZGUoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmdldCA9IGV4cG9ydHMucmVzZXQgPSBleHBvcnRzLnNldCA9IHZvaWQgMDtcbmxldCBzdGF0ZSA9IGZhbHNlO1xuZnVuY3Rpb24gc2V0KCkge1xuICAgIHN0YXRlID0gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0ID0gc2V0O1xuZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgc3RhdGUgPSBmYWxzZTtcbn1cbmV4cG9ydHMucmVzZXQgPSByZXNldDtcbmZ1bmN0aW9uIGdldCgpIHtcbiAgICByZXR1cm4gc3RhdGU7XG59XG5leHBvcnRzLmdldCA9IGdldDtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmhpZGUgPSBleHBvcnRzLnNob3cgPSBleHBvcnRzLnN0b3AgPSBleHBvcnRzLnR5cGUgPSBleHBvcnRzLnVwZGF0ZUZhc3RPcGFjaXR5ID0gdm9pZCAwO1xuY29uc3QgbWlzY18xID0gcmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIik7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuY29uc3QgVGVzdEFjdGl2ZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3Rlc3QtYWN0aXZlXCIpKTtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXkpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwibW9ua2V5XCIgJiYgVGVzdEFjdGl2ZS5nZXQoKSkge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb25rZXkpIHtcbiAgICAgICAgICAgICQoXCIjbW9ua2V5XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIiNtb25rZXlcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICB9XG59KTtcbmxldCBsZWZ0ID0gZmFsc2U7XG5sZXQgcmlnaHQgPSBmYWxzZTtcbi8vIDAgaGFuZCB1cFxuLy8gMSBoYW5kIGRvd25cbi8vIDAwIGJvdGggaGFuZHMgdXBcbi8vIDAxIHJpZ2h0IGhhbmQgZG93blxuLy8gMTAgbGVmdCBoYW5kIGRvd25cbi8vIDExIGJvdGggaGFuZHMgZG93blxuY29uc3QgZWxlbWVudHMgPSB7XG4gICAgXCIwMFwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21vbmtleSAudXBcIiksXG4gICAgXCIwMVwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21vbmtleSAucmlnaHRcIiksXG4gICAgXCIxMFwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21vbmtleSAubGVmdFwiKSxcbiAgICBcIjExXCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbW9ua2V5IC5ib3RoXCIpLFxufTtcbmNvbnN0IGVsZW1lbnRzRmFzdCA9IHtcbiAgICBcIjAwXCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbW9ua2V5IC5mYXN0IC51cFwiKSxcbiAgICBcIjAxXCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbW9ua2V5IC5mYXN0IC5yaWdodFwiKSxcbiAgICBcIjEwXCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbW9ua2V5IC5mYXN0IC5sZWZ0XCIpLFxuICAgIFwiMTFcIjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtb25rZXkgLmZhc3QgLmJvdGhcIiksXG59O1xubGV0IGxhc3QgPSBcInJpZ2h0XCI7XG5mdW5jdGlvbiB0b0JpdChiKSB7XG4gICAgcmV0dXJuIGIgPyBcIjFcIiA6IFwiMFwiO1xufVxuZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5tb25rZXkpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoISgoX2EgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21vbmtleVwiKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNsYXNzTGlzdC5jb250YWlucyhcImhpZGRlblwiKSkpIHtcbiAgICAgICAgT2JqZWN0LmtleXMoZWxlbWVudHMpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgKF9hID0gZWxlbWVudHNba2V5XSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3Qua2V5cyhlbGVtZW50c0Zhc3QpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgKF9hID0gZWxlbWVudHNGYXN0W2tleV0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgaWQgPSBgJHt0b0JpdChsZWZ0KX0ke3RvQml0KHJpZ2h0KX1gO1xuICAgICAgICAoX2IgPSBlbGVtZW50c1tpZF0pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgICAgICAoX2MgPSBlbGVtZW50c0Zhc3RbaWRdKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgICB9XG59XG5mdW5jdGlvbiB1cGRhdGVGYXN0T3BhY2l0eShudW0pIHtcbiAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQubW9ua2V5KVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3Qgb3BhY2l0eSA9ICgwLCBtaXNjXzEubWFwUmFuZ2UpKG51bSwgMTMwLCAxODAsIDAsIDEpO1xuICAgICQoXCIjbW9ua2V5IC5mYXN0XCIpLmFuaW1hdGUoeyBvcGFjaXR5OiBvcGFjaXR5IH0sIDEwMDApO1xuICAgIGxldCBhbmltRHVyYXRpb24gPSAoMCwgbWlzY18xLm1hcFJhbmdlKShudW0sIDEzMCwgMTgwLCAwLjI1LCAwLjAxKTtcbiAgICBpZiAoYW5pbUR1cmF0aW9uID09IDAuMjUpXG4gICAgICAgIGFuaW1EdXJhdGlvbiA9IDA7XG4gICAgJChcIiNtb25rZXlcIikuY3NzKHsgYW5pbWF0aW9uRHVyYXRpb246IGFuaW1EdXJhdGlvbiArIFwic1wiIH0pO1xufVxuZXhwb3J0cy51cGRhdGVGYXN0T3BhY2l0eSA9IHVwZGF0ZUZhc3RPcGFjaXR5O1xuZnVuY3Rpb24gdHlwZSgpIHtcbiAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQubW9ua2V5KVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKCFsZWZ0ICYmIGxhc3QgPT0gXCJyaWdodFwiKSB7XG4gICAgICAgIGxlZnQgPSB0cnVlO1xuICAgICAgICBsYXN0ID0gXCJsZWZ0XCI7XG4gICAgfVxuICAgIGVsc2UgaWYgKCFyaWdodCkge1xuICAgICAgICByaWdodCA9IHRydWU7XG4gICAgICAgIGxhc3QgPSBcInJpZ2h0XCI7XG4gICAgfVxuICAgIHVwZGF0ZSgpO1xufVxuZXhwb3J0cy50eXBlID0gdHlwZTtcbmZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgaWYgKCFjb25maWdfMS5kZWZhdWx0Lm1vbmtleSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChsZWZ0KSB7XG4gICAgICAgIGxlZnQgPSBmYWxzZTtcbiAgICB9XG4gICAgZWxzZSBpZiAocmlnaHQpIHtcbiAgICAgICAgcmlnaHQgPSBmYWxzZTtcbiAgICB9XG4gICAgdXBkYXRlKCk7XG59XG5leHBvcnRzLnN0b3AgPSBzdG9wO1xuZnVuY3Rpb24gc2hvdygpIHtcbiAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQubW9ua2V5KVxuICAgICAgICByZXR1cm47XG4gICAgJChcIiNtb25rZXlcIilcbiAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMjUpO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgJChcIiNtb25rZXlcIilcbiAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAkKFwiI21vbmtleVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zaG93ID0gZXhwb3J0cy5oaWRlID0gdm9pZCAwO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBvdXRPZkZvY3VzVGltZW91dHMgPSBbXTtcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgJChcIiN3b3Jkc1wiKS5jc3MoXCJ0cmFuc2l0aW9uXCIsIFwibm9uZVwiKS5yZW1vdmVDbGFzcyhcImJsdXJyZWRcIik7XG4gICAgJChcIi5vdXRPZkZvY3VzV2FybmluZ1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICBNaXNjLmNsZWFyVGltZW91dHMob3V0T2ZGb2N1c1RpbWVvdXRzKTtcbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG5mdW5jdGlvbiBzaG93KCkge1xuICAgIG91dE9mRm9jdXNUaW1lb3V0cy5wdXNoKHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAkKFwiI3dvcmRzXCIpLmNzcyhcInRyYW5zaXRpb25cIiwgXCIwLjI1c1wiKS5hZGRDbGFzcyhcImJsdXJyZWRcIik7XG4gICAgICAgICQoXCIub3V0T2ZGb2N1c1dhcm5pbmdcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfSwgMTAwMCkpO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc3RhcnQgPSBleHBvcnRzLmhhbmRsZVNwYWNlID0gZXhwb3J0cy5yZXNldCA9IGV4cG9ydHMudXBkYXRlID0gZXhwb3J0cy5pbml0ID0gZXhwb3J0cy5zZXR0aW5ncyA9IHZvaWQgMDtcbmNvbnN0IFRlc3RTdGF0cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXN0YXRzXCIpKTtcbmNvbnN0IFRlc3RXb3JkcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXdvcmRzXCIpKTtcbmNvbnN0IFRlc3RVSSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXVpXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IFNsb3dUaW1lciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3Nsb3ctdGltZXJcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBUZXN0QWN0aXZlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvdGVzdC1hY3RpdmVcIikpO1xuY29uc3QgVGVzdFN0YXRlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtc3RhdGVcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5leHBvcnRzLnNldHRpbmdzID0gbnVsbDtcbmZ1bmN0aW9uIHJlc2V0Q2FyZXRQb3NpdGlvbigpIHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucGFjZUNhcmV0ID09PSBcIm9mZlwiICYmICFUZXN0U3RhdGUuaXNQYWNlUmVwZWF0KVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKCEkKFwiI3BhY2VDYXJldFwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI3BhY2VDYXJldFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ6ZW5cIilcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IGNhcmV0ID0gJChcIiNwYWNlQ2FyZXRcIik7XG4gICAgY29uc3QgZmlyc3RMZXR0ZXIgPSAoKF9hID0gZG9jdW1lbnQgPT09IG51bGwgfHwgZG9jdW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjd29yZHMgLndvcmRcIikpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5xdWVyeVNlbGVjdG9yKFwibGV0dGVyXCIpKTtcbiAgICBjb25zdCBmaXJzdExldHRlckhlaWdodCA9ICQoZmlyc3RMZXR0ZXIpLmhlaWdodCgpO1xuICAgIGlmIChmaXJzdExldHRlciA9PT0gdW5kZWZpbmVkIHx8IGZpcnN0TGV0dGVySGVpZ2h0ID09PSB1bmRlZmluZWQpXG4gICAgICAgIHJldHVybjtcbiAgICBjYXJldC5zdG9wKHRydWUsIHRydWUpLmFuaW1hdGUoe1xuICAgICAgICB0b3A6IGZpcnN0TGV0dGVyLm9mZnNldFRvcCAtIGZpcnN0TGV0dGVySGVpZ2h0IC8gNCxcbiAgICAgICAgbGVmdDogZmlyc3RMZXR0ZXIub2Zmc2V0TGVmdCxcbiAgICB9LCAwLCBcImxpbmVhclwiKTtcbn1cbmZ1bmN0aW9uIGluaXQoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgJChcIiNwYWNlQ2FyZXRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIGNvbnN0IG1vZGUyID0gTWlzYy5nZXRNb2RlMihjb25maWdfMS5kZWZhdWx0LCBUZXN0V29yZHMucmFuZG9tUXVvdGUpO1xuICAgICAgICBsZXQgd3BtO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5wYWNlQ2FyZXQgPT09IFwicGJcIikge1xuICAgICAgICAgICAgd3BtID0geWllbGQgREIuZ2V0TG9jYWxQQihjb25maWdfMS5kZWZhdWx0Lm1vZGUsIG1vZGUyLCBjb25maWdfMS5kZWZhdWx0LnB1bmN0dWF0aW9uLCBjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlLCBjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHksIGNvbmZpZ18xLmRlZmF1bHQubGF6eU1vZGUsIGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LnBhY2VDYXJldCA9PT0gXCJhdmVyYWdlXCIpIHtcbiAgICAgICAgICAgIFt3cG1dID0geWllbGQgREIuZ2V0VXNlckF2ZXJhZ2UxMChjb25maWdfMS5kZWZhdWx0Lm1vZGUsIG1vZGUyLCBjb25maWdfMS5kZWZhdWx0LnB1bmN0dWF0aW9uLCBjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlLCBjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHksIGNvbmZpZ18xLmRlZmF1bHQubGF6eU1vZGUpO1xuICAgICAgICAgICAgd3BtID0gTWF0aC5yb3VuZCh3cG0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQucGFjZUNhcmV0ID09PSBcImN1c3RvbVwiKSB7XG4gICAgICAgICAgICB3cG0gPSBjb25maWdfMS5kZWZhdWx0LnBhY2VDYXJldEN1c3RvbVNwZWVkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKFRlc3RTdGF0ZS5pc1BhY2VSZXBlYXQgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgd3BtID0gVGVzdFN0YXRzLmxhc3RUZXN0V3BtO1xuICAgICAgICB9XG4gICAgICAgIGlmICh3cG0gPT09IHVuZGVmaW5lZCB8fCB3cG0gPCAxIHx8IE51bWJlci5pc05hTih3cG0pKSB7XG4gICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzID0gbnVsbDtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjaGFyYWN0ZXJzID0gd3BtICogNTtcbiAgICAgICAgY29uc3QgY3BzID0gY2hhcmFjdGVycyAvIDYwOyAvL2NoYXJhY3RlcnMgcGVyIHN0ZXBcbiAgICAgICAgY29uc3Qgc3BjID0gNjAgLyBjaGFyYWN0ZXJzOyAvL3NlY29uZHMgcGVyIGNoYXJhY3RlclxuICAgICAgICBleHBvcnRzLnNldHRpbmdzID0ge1xuICAgICAgICAgICAgd3BtOiB3cG0sXG4gICAgICAgICAgICBjcHM6IGNwcyxcbiAgICAgICAgICAgIHNwYzogc3BjLFxuICAgICAgICAgICAgY29ycmVjdGlvbjogMCxcbiAgICAgICAgICAgIGN1cnJlbnRXb3JkSW5kZXg6IDAsXG4gICAgICAgICAgICBjdXJyZW50TGV0dGVySW5kZXg6IC0xLFxuICAgICAgICAgICAgd29yZHNTdGF0dXM6IHt9LFxuICAgICAgICAgICAgdGltZW91dDogbnVsbCxcbiAgICAgICAgfTtcbiAgICAgICAgcmVzZXRDYXJldFBvc2l0aW9uKCk7XG4gICAgfSk7XG59XG5leHBvcnRzLmluaXQgPSBpbml0O1xuZnVuY3Rpb24gdXBkYXRlKGV4cGVjdGVkU3RlcEVuZCkge1xuICAgIGlmIChleHBvcnRzLnNldHRpbmdzID09PSBudWxsIHx8ICFUZXN0QWN0aXZlLmdldCgpIHx8IFRlc3RVSS5yZXN1bHRWaXNpYmxlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gaWYgKCQoXCIjcGFjZUNhcmV0XCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgLy8gICAkKFwiI3BhY2VDYXJldFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAvLyB9XG4gICAgdHJ5IHtcbiAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50TGV0dGVySW5kZXgrKztcbiAgICAgICAgaWYgKGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudExldHRlckluZGV4ID49XG4gICAgICAgICAgICBUZXN0V29yZHMud29yZHMuZ2V0KGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudFdvcmRJbmRleCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAvL2dvIHRvIHRoZSBuZXh0IHdvcmRcbiAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudExldHRlckluZGV4ID0gLTE7XG4gICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRXb3JkSW5kZXgrKztcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlKSB7XG4gICAgICAgICAgICBpZiAoZXhwb3J0cy5zZXR0aW5ncy5jb3JyZWN0aW9uIDwgMCkge1xuICAgICAgICAgICAgICAgIHdoaWxlIChleHBvcnRzLnNldHRpbmdzLmNvcnJlY3Rpb24gPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudExldHRlckluZGV4LS07XG4gICAgICAgICAgICAgICAgICAgIGlmIChleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRMZXR0ZXJJbmRleCA8PSAtMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9nbyB0byB0aGUgcHJldmlvdXMgd29yZFxuICAgICAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50TGV0dGVySW5kZXggPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5nZXQoZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50V29yZEluZGV4IC0gMSkubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudFdvcmRJbmRleC0tO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3MuY29ycmVjdGlvbisrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGV4cG9ydHMuc2V0dGluZ3MuY29ycmVjdGlvbiA+IDApIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAoZXhwb3J0cy5zZXR0aW5ncy5jb3JyZWN0aW9uID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRMZXR0ZXJJbmRleCsrO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50TGV0dGVySW5kZXggPj1cbiAgICAgICAgICAgICAgICAgICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5nZXQoZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50V29yZEluZGV4KS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZ28gdG8gdGhlIG5leHQgd29yZFxuICAgICAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50TGV0dGVySW5kZXggPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudFdvcmRJbmRleCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3MuY29ycmVjdGlvbi0tO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICAvL291dCBvZiB3b3Jkc1xuICAgICAgICBleHBvcnRzLnNldHRpbmdzID0gbnVsbDtcbiAgICAgICAgJChcIiNwYWNlQ2FyZXRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY2FyZXQgPSAkKFwiI3BhY2VDYXJldFwiKTtcbiAgICAgICAgbGV0IGN1cnJlbnRMZXR0ZXI7XG4gICAgICAgIGxldCBuZXdUb3A7XG4gICAgICAgIGxldCBuZXdMZWZ0O1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgbmV3SW5kZXggPSBleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRXb3JkSW5kZXggLVxuICAgICAgICAgICAgICAgIChUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4IC0gVGVzdFVJLmN1cnJlbnRXb3JkRWxlbWVudEluZGV4KTtcbiAgICAgICAgICAgIGNvbnN0IHdvcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiI3dvcmRzIC53b3JkXCIpW25ld0luZGV4XTtcbiAgICAgICAgICAgIGlmIChleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRMZXR0ZXJJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50TGV0dGVyID0gd29yZC5xdWVyeVNlbGVjdG9yQWxsKFwibGV0dGVyXCIpWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY3VycmVudExldHRlciA9ICh3b3JkLnF1ZXJ5U2VsZWN0b3JBbGwoXCJsZXR0ZXJcIilbZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50TGV0dGVySW5kZXhdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRMZXR0ZXJIZWlnaHQgPSAkKGN1cnJlbnRMZXR0ZXIpLmhlaWdodCgpLCBjdXJyZW50TGV0dGVyV2lkdGggPSAkKGN1cnJlbnRMZXR0ZXIpLndpZHRoKCksIGNhcmV0V2lkdGggPSBjYXJldC53aWR0aCgpO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRMZXR0ZXJIZWlnaHQgPT09IHVuZGVmaW5lZCB8fFxuICAgICAgICAgICAgICAgIGN1cnJlbnRMZXR0ZXJXaWR0aCA9PT0gdW5kZWZpbmVkIHx8XG4gICAgICAgICAgICAgICAgY2FyZXRXaWR0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgYGA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBuZXdUb3AgPSBjdXJyZW50TGV0dGVyLm9mZnNldFRvcCAtIGN1cnJlbnRMZXR0ZXJIZWlnaHQgLyA1O1xuICAgICAgICAgICAgbmV3TGVmdDtcbiAgICAgICAgICAgIGlmIChleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRMZXR0ZXJJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICBuZXdMZWZ0ID0gY3VycmVudExldHRlci5vZmZzZXRMZWZ0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV3TGVmdCA9XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMZXR0ZXIub2Zmc2V0TGVmdCArIGN1cnJlbnRMZXR0ZXJXaWR0aCAtIGNhcmV0V2lkdGggLyAyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FyZXQucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNhcmV0LmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGR1cmF0aW9uID0gZXhwZWN0ZWRTdGVwRW5kIC0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgIGlmIChuZXdUb3AgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbGV0IHNtb290aGxpbmVzY3JvbGwgPSAkKFwiI3dvcmRzIC5zbW9vdGhTY3JvbGxlclwiKS5oZWlnaHQoKTtcbiAgICAgICAgICAgIGlmIChzbW9vdGhsaW5lc2Nyb2xsID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgc21vb3RobGluZXNjcm9sbCA9IDA7XG4gICAgICAgICAgICAkKFwiI3BhY2VDYXJldFwiKS5jc3Moe1xuICAgICAgICAgICAgICAgIHRvcDogbmV3VG9wIC0gc21vb3RobGluZXNjcm9sbCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc21vb3RoQ2FyZXQpIHtcbiAgICAgICAgICAgICAgICBjYXJldC5zdG9wKHRydWUsIHRydWUpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBsZWZ0OiBuZXdMZWZ0LFxuICAgICAgICAgICAgICAgIH0sIFNsb3dUaW1lci5nZXQoKSA/IDAgOiBkdXJhdGlvbiwgXCJsaW5lYXJcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYXJldC5zdG9wKHRydWUsIHRydWUpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBsZWZ0OiBuZXdMZWZ0LFxuICAgICAgICAgICAgICAgIH0sIDAsIFwibGluZWFyXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGV4cG9ydHMuc2V0dGluZ3MudGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB1cGRhdGUoZXhwZWN0ZWRTdGVwRW5kICsgKChfYSA9IGV4cG9ydHMuc2V0dGluZ3MgPT09IG51bGwgfHwgZXhwb3J0cy5zZXR0aW5ncyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXhwb3J0cy5zZXR0aW5ncy5zcGMpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDApICogMTAwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3MgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBkdXJhdGlvbik7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICQoXCIjcGFjZUNhcmV0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbn1cbmV4cG9ydHMudXBkYXRlID0gdXBkYXRlO1xuZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgaWYgKGV4cG9ydHMuc2V0dGluZ3MgIT09IG51bGwgJiYgZXhwb3J0cy5zZXR0aW5ncy50aW1lb3V0ICE9PSBudWxsKSB7XG4gICAgICAgIGNsZWFyVGltZW91dChleHBvcnRzLnNldHRpbmdzLnRpbWVvdXQpO1xuICAgIH1cbiAgICBleHBvcnRzLnNldHRpbmdzID0gbnVsbDtcbn1cbmV4cG9ydHMucmVzZXQgPSByZXNldDtcbmZ1bmN0aW9uIGhhbmRsZVNwYWNlKGNvcnJlY3QsIGN1cnJlbnRXb3JkKSB7XG4gICAgaWYgKGNvcnJlY3QpIHtcbiAgICAgICAgaWYgKGV4cG9ydHMuc2V0dGluZ3MgIT09IG51bGwgJiZcbiAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3Mud29yZHNTdGF0dXNbVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleF0gPT09IHRydWUgJiZcbiAgICAgICAgICAgICFjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSkge1xuICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy53b3Jkc1N0YXR1c1tUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4XSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3MuY29ycmVjdGlvbiAtPSBjdXJyZW50V29yZC5sZW5ndGggKyAxO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoZXhwb3J0cy5zZXR0aW5ncyAhPT0gbnVsbCAmJlxuICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy53b3Jkc1N0YXR1c1tUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4XSA9PT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICAhY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUpIHtcbiAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3Mud29yZHNTdGF0dXNbVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleF0gPSB0cnVlO1xuICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy5jb3JyZWN0aW9uICs9IGN1cnJlbnRXb3JkLmxlbmd0aCArIDE7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLmhhbmRsZVNwYWNlID0gaGFuZGxlU3BhY2U7XG5mdW5jdGlvbiBzdGFydCgpIHtcbiAgICB2YXIgX2E7XG4gICAgdXBkYXRlKHBlcmZvcm1hbmNlLm5vdygpICsgKChfYSA9IGV4cG9ydHMuc2V0dGluZ3MgPT09IG51bGwgfHwgZXhwb3J0cy5zZXR0aW5ncyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXhwb3J0cy5zZXR0aW5ncy5zcGMpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDApICogMTAwMCk7XG59XG5leHBvcnRzLnN0YXJ0ID0gc3RhcnQ7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5KSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcInBhY2VDYXJldFwiKVxuICAgICAgICBpbml0KCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zaG93ID0gZXhwb3J0cy5oaWRlID0gdm9pZCAwO1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAuY3Jvd25cIikuY3NzKFwib3BhY2l0eVwiLCAwKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG5mdW5jdGlvbiBzaG93KCkge1xuICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC5jcm93blwiKVxuICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgXCIwXCIpXG4gICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogMSxcbiAgICB9LCAyNTAsIFwiZWFzZU91dEN1YmljXCIpO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmdldFBvZW0gPSBleHBvcnRzLlBvZW0gPSB2b2lkIDA7XG5jb25zdCBheGlvc18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJheGlvc1wiKSk7XG5jb25zdCBiYW5uZWRDaGFycyA9IFtcIuKAlFwiLCBcIl9cIiwgXCIgXCJdO1xuY29uc3QgbWF4V29yZHMgPSAxMDA7XG5jb25zdCBhcGlVUkwgPSBcImh0dHBzOi8vcG9ldHJ5ZGIub3JnL3JhbmRvbVwiO1xuY2xhc3MgUG9lbSB7XG4gICAgY29uc3RydWN0b3IodGl0bGUsIGF1dGhvciwgd29yZHMpIHtcbiAgICAgICAgdGhpcy50aXRsZSA9IHRpdGxlO1xuICAgICAgICB0aGlzLmF1dGhvciA9IGF1dGhvcjtcbiAgICAgICAgdGhpcy53b3JkcyA9IHdvcmRzO1xuICAgICAgICB0aGlzLmNsZWFuVXBUZXh0KCk7XG4gICAgfVxuICAgIGNsZWFuVXBUZXh0KCkge1xuICAgICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgICBjb25zdCBzY3J1YmJlZFdvcmRzID0gW107XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy53b3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgbGV0IHNjcnViYmVkID0gXCJcIjtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy53b3Jkc1tpXS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIGlmICghYmFubmVkQ2hhcnMuaW5jbHVkZXModGhpcy53b3Jkc1tpXVtqXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NydWJiZWQgKz0gdGhpcy53b3Jkc1tpXVtqXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2NydWJiZWQgPT0gXCJcIilcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIHNjcnViYmVkV29yZHMucHVzaChzY3J1YmJlZCk7XG4gICAgICAgICAgICBjb3VudCsrO1xuICAgICAgICAgICAgaWYgKGNvdW50ID09IG1heFdvcmRzKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud29yZHMgPSBzY3J1YmJlZFdvcmRzO1xuICAgIH1cbn1cbmV4cG9ydHMuUG9lbSA9IFBvZW07XG5mdW5jdGlvbiBnZXRQb2VtKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiR2V0dGluZyBwb2VtXCIpO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGF4aW9zXzEuZGVmYXVsdC5nZXQoYXBpVVJMKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHBvZW1PYmogPSByZXNwb25zZS5kYXRhWzBdO1xuICAgICAgICAgICAgY29uc3Qgd29yZHMgPSBbXTtcbiAgICAgICAgICAgIHBvZW1PYmoubGluZXMuZm9yRWFjaCgobGluZSkgPT4ge1xuICAgICAgICAgICAgICAgIGxpbmUuc3BsaXQoLyArLykuZm9yRWFjaCgod29yZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB3b3Jkcy5wdXNoKHdvcmQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFBvZW0ocG9lbU9iai50aXRsZSwgcG9lbU9iai5hdXRob3IsIHdvcmRzKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRQb2VtID0gZ2V0UG9lbTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmhpZGVQb3B1cCA9IGV4cG9ydHMuc2hvd1BvcHVwID0gZXhwb3J0cy5yZXNldEJlZm9yZSA9IGV4cG9ydHMuaW5pdCA9IGV4cG9ydHMuYmVmb3JlID0gdm9pZCAwO1xuY29uc3QgVGVzdFdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtd29yZHNcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBDdXN0b21UZXh0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2N1c3RvbS10ZXh0XCIpKTtcbmNvbnN0IFRlc3RJbnB1dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LWlucHV0XCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuZXhwb3J0cy5iZWZvcmUgPSB7XG4gICAgbW9kZTogbnVsbCxcbiAgICBwdW5jdHVhdGlvbjogbnVsbCxcbiAgICBudW1iZXJzOiBudWxsLFxufTtcbmZ1bmN0aW9uIGluaXQobWlzc2VkLCBzbG93KSB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ6ZW5cIilcbiAgICAgICAgcmV0dXJuO1xuICAgIGxldCBsaW1pdDtcbiAgICBpZiAoKG1pc3NlZCAmJiAhc2xvdykgfHwgKCFtaXNzZWQgJiYgc2xvdykpIHtcbiAgICAgICAgbGltaXQgPSAyMDtcbiAgICB9XG4gICAgZWxzZSBpZiAobWlzc2VkICYmIHNsb3cpIHtcbiAgICAgICAgbGltaXQgPSAxMDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGxpbWl0ID0gMTA7XG4gICAgfVxuICAgIGxldCBzb3J0YWJsZU1pc3NlZFdvcmRzID0gW107XG4gICAgaWYgKG1pc3NlZCkge1xuICAgICAgICBPYmplY3Qua2V5cyhUZXN0SW5wdXQubWlzc2VkV29yZHMpLmZvckVhY2goKG1pc3NlZFdvcmQpID0+IHtcbiAgICAgICAgICAgIHNvcnRhYmxlTWlzc2VkV29yZHMucHVzaChbbWlzc2VkV29yZCwgVGVzdElucHV0Lm1pc3NlZFdvcmRzW21pc3NlZFdvcmRdXSk7XG4gICAgICAgIH0pO1xuICAgICAgICBzb3J0YWJsZU1pc3NlZFdvcmRzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBiWzFdIC0gYVsxXTtcbiAgICAgICAgfSk7XG4gICAgICAgIHNvcnRhYmxlTWlzc2VkV29yZHMgPSBzb3J0YWJsZU1pc3NlZFdvcmRzLnNsaWNlKDAsIGxpbWl0KTtcbiAgICB9XG4gICAgaWYgKG1pc3NlZCAmJiAhc2xvdyAmJiBzb3J0YWJsZU1pc3NlZFdvcmRzLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiWW91IGhhdmVuJ3QgbWlzc2VkIGFueSB3b3Jkc1wiLCAwKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgc29ydGFibGVTbG93V29yZHMgPSBbXTtcbiAgICBpZiAoc2xvdykge1xuICAgICAgICBzb3J0YWJsZVNsb3dXb3JkcyA9IFRlc3RXb3Jkcy53b3Jkcy5nZXQoKS5tYXAoKGUsIGkpID0+IFtcbiAgICAgICAgICAgIGUsXG4gICAgICAgICAgICBUZXN0SW5wdXQuYnVyc3RIaXN0b3J5W2ldLFxuICAgICAgICBdKTtcbiAgICAgICAgc29ydGFibGVTbG93V29yZHMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGFbMV0gLSBiWzFdO1xuICAgICAgICB9KTtcbiAgICAgICAgc29ydGFibGVTbG93V29yZHMgPSBzb3J0YWJsZVNsb3dXb3Jkcy5zbGljZSgwLCBNYXRoLm1pbihsaW1pdCwgTWF0aC5yb3VuZChUZXN0V29yZHMud29yZHMubGVuZ3RoICogMC4yKSkpO1xuICAgIH1cbiAgICAvLyBjb25zb2xlLmxvZyhzb3J0YWJsZU1pc3NlZFdvcmRzKTtcbiAgICAvLyBjb25zb2xlLmxvZyhzb3J0YWJsZVNsb3dXb3Jkcyk7XG4gICAgaWYgKHNvcnRhYmxlTWlzc2VkV29yZHMubGVuZ3RoID09IDAgJiYgc29ydGFibGVTbG93V29yZHMubGVuZ3RoID09IDApIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDb3VsZCBub3Qgc3RhcnQgYSBuZXcgY3VzdG9tIHRlc3RcIiwgMCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgbmV3Q3VzdG9tVGV4dCA9IFtdO1xuICAgIHNvcnRhYmxlTWlzc2VkV29yZHMuZm9yRWFjaCgobWlzc2VkKSA9PiB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWlzc2VkWzFdOyBpKyspIHtcbiAgICAgICAgICAgIG5ld0N1c3RvbVRleHQucHVzaChtaXNzZWRbMF0pO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgc29ydGFibGVTbG93V29yZHMuZm9yRWFjaCgoc2xvdywgaW5kZXgpID0+IHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzb3J0YWJsZVNsb3dXb3Jkcy5sZW5ndGggLSBpbmRleDsgaSsrKSB7XG4gICAgICAgICAgICBuZXdDdXN0b21UZXh0LnB1c2goc2xvd1swXSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICAvLyBjb25zb2xlLmxvZyhuZXdDdXN0b21UZXh0KTtcbiAgICBjb25zdCBtb2RlID0gZXhwb3J0cy5iZWZvcmUubW9kZSA9PT0gbnVsbCA/IGNvbmZpZ18xLmRlZmF1bHQubW9kZSA6IGV4cG9ydHMuYmVmb3JlLm1vZGU7XG4gICAgY29uc3QgcHVuY3R1YXRpb24gPSBleHBvcnRzLmJlZm9yZS5wdW5jdHVhdGlvbiA9PT0gbnVsbCA/IGNvbmZpZ18xLmRlZmF1bHQucHVuY3R1YXRpb24gOiBleHBvcnRzLmJlZm9yZS5wdW5jdHVhdGlvbjtcbiAgICBjb25zdCBudW1iZXJzID0gZXhwb3J0cy5iZWZvcmUubnVtYmVycyA9PT0gbnVsbCA/IGNvbmZpZ18xLmRlZmF1bHQubnVtYmVycyA6IGV4cG9ydHMuYmVmb3JlLm51bWJlcnM7XG4gICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJjdXN0b21cIik7XG4gICAgQ3VzdG9tVGV4dC5zZXRUZXh0KG5ld0N1c3RvbVRleHQpO1xuICAgIEN1c3RvbVRleHQuc2V0SXNXb3JkUmFuZG9tKHRydWUpO1xuICAgIEN1c3RvbVRleHQuc2V0V29yZCgoc29ydGFibGVTbG93V29yZHMubGVuZ3RoICsgc29ydGFibGVNaXNzZWRXb3Jkcy5sZW5ndGgpICogNSk7XG4gICAgQ3VzdG9tVGV4dC5zZXRUaW1lKC0xKTtcbiAgICBleHBvcnRzLmJlZm9yZS5tb2RlID0gbW9kZTtcbiAgICBleHBvcnRzLmJlZm9yZS5wdW5jdHVhdGlvbiA9IHB1bmN0dWF0aW9uO1xuICAgIGV4cG9ydHMuYmVmb3JlLm51bWJlcnMgPSBudW1iZXJzO1xufVxuZXhwb3J0cy5pbml0ID0gaW5pdDtcbmZ1bmN0aW9uIHJlc2V0QmVmb3JlKCkge1xuICAgIGV4cG9ydHMuYmVmb3JlLm1vZGUgPSBudWxsO1xuICAgIGV4cG9ydHMuYmVmb3JlLnB1bmN0dWF0aW9uID0gbnVsbDtcbiAgICBleHBvcnRzLmJlZm9yZS5udW1iZXJzID0gbnVsbDtcbn1cbmV4cG9ydHMucmVzZXRCZWZvcmUgPSByZXNldEJlZm9yZTtcbmZ1bmN0aW9uIHNob3dQb3B1cChmb2N1cyA9IGZhbHNlKSB7XG4gICAgaWYgKCQoXCIjcHJhY3Rpc2VXb3Jkc1BvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInplblwiKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlByYWN0aWNlIHdvcmRzIGlzIHVuc3VwcG9ydGVkIGluIHplbiBtb2RlXCIsIDApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgICQoXCIjcHJhY3Rpc2VXb3Jkc1BvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgIGlmIChmb2N1cykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZm9jdXNpbmdcIik7XG4gICAgICAgICAgICAgICAgJChcIiNwcmFjdGlzZVdvcmRzUG9wdXAgLm1pc3NlZFwiKS50cmlnZ2VyKFwiZm9jdXNcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuc2hvd1BvcHVwID0gc2hvd1BvcHVwO1xuZnVuY3Rpb24gaGlkZVBvcHVwKCkge1xuICAgIGlmICghJChcIiNwcmFjdGlzZVdvcmRzUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjcHJhY3Rpc2VXb3Jkc1BvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjcHJhY3Rpc2VXb3Jkc1BvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5oaWRlUG9wdXAgPSBoaWRlUG9wdXA7XG4kKFwiI3ByYWN0aXNlV29yZHNQb3B1cFdyYXBwZXJcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwicHJhY3Rpc2VXb3Jkc1BvcHVwV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGVQb3B1cCgpO1xuICAgIH1cbn0pO1xuJChcIiNwcmFjdGlzZVdvcmRzUG9wdXAgLmJ1dHRvblwiKS5vbihcImtleXByZXNzXCIsIChlKSA9PiB7XG4gICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgJChlLmN1cnJlbnRUYXJnZXQpLmNsaWNrKCk7XG4gICAgfVxufSk7XG4kKFwiI3ByYWN0aXNlV29yZHNQb3B1cCAuYnV0dG9uLmJvdGhcIikub24oXCJmb2N1c291dFwiLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAkKFwiI3ByYWN0aXNlV29yZHNQb3B1cCAubWlzc2VkXCIpLnRyaWdnZXIoXCJmb2N1c1wiKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJrZXlkb3duXCIsIChldmVudCkgPT4ge1xuICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIgJiZcbiAgICAgICAgISQoXCIjcHJhY3Rpc2VXb3Jkc1BvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICBoaWRlUG9wdXAoKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwia2V5cHJlc3NcIiwgXCIjcHJhY3Rpc2VXb3Jkc0J1dHRvblwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgc2hvd1BvcHVwKHRydWUpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiI3ByYWN0aXNlV29yZHNCdXR0b25cIiwgKCkgPT4ge1xuICAgIHNob3dQb3B1cCgpO1xufSk7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5KSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcIm1vZGVcIilcbiAgICAgICAgcmVzZXRCZWZvcmUoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbnZhciBfYTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZ2V0UmVwbGF5RXhwb3J0ID0gZXhwb3J0cy5yZXBsYXlHZXRXb3Jkc0xpc3QgPSBleHBvcnRzLmFkZFJlcGxheUV2ZW50ID0gZXhwb3J0cy5zdG9wUmVwbGF5UmVjb3JkaW5nID0gZXhwb3J0cy5zdGFydFJlcGxheVJlY29yZGluZyA9IGV4cG9ydHMucGF1c2VSZXBsYXkgPSB2b2lkIDA7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IFNvdW5kID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9zb3VuZC1jb250cm9sbGVyXCIpKTtcbmxldCB3b3Jkc0xpc3QgPSBbXTtcbmxldCByZXBsYXlEYXRhID0gW107XG5sZXQgcmVwbGF5U3RhcnRUaW1lID0gMDtcbmxldCByZXBsYXlSZWNvcmRpbmcgPSB0cnVlO1xubGV0IHdvcmRQb3MgPSAwO1xubGV0IGN1clBvcyA9IDA7XG5sZXQgdGFyZ2V0V29yZFBvcyA9IDA7XG5sZXQgdGFyZ2V0Q3VyUG9zID0gMDtcbmxldCB0aW1lb3V0TGlzdCA9IFtdO1xubGV0IHN0b3B3YXRjaExpc3QgPSBbXTtcbmNvbnN0IHRvZ2dsZUJ1dHRvbiA9IChfYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGxheXBhdXNlUmVwbGF5QnV0dG9uXCIpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2hpbGRyZW5bMF07XG5mdW5jdGlvbiByZXBsYXlHZXRXb3Jkc0xpc3Qod29yZHNMaXN0RnJvbVNjcmlwdCkge1xuICAgIHdvcmRzTGlzdCA9IHdvcmRzTGlzdEZyb21TY3JpcHQ7XG59XG5leHBvcnRzLnJlcGxheUdldFdvcmRzTGlzdCA9IHJlcGxheUdldFdvcmRzTGlzdDtcbmZ1bmN0aW9uIGluaXRpYWxpemVSZXBsYXlQcm9tcHQoKSB7XG4gICAgY29uc3QgcmVwbGF5V29yZHNFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXBsYXlXb3Jkc1wiKTtcbiAgICBpZiAocmVwbGF5V29yZHNFbGVtZW50ID09PSBudWxsKVxuICAgICAgICByZXR1cm47XG4gICAgcmVwbGF5V29yZHNFbGVtZW50LmlubmVySFRNTCA9IFwiXCI7XG4gICAgbGV0IHdvcmRDb3VudCA9IDA7XG4gICAgcmVwbGF5RGF0YS5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgIC8vdHJpbSB3b3Jkc0xpc3QgZm9yIHRpbWVkIHRlc3RzXG4gICAgICAgIGlmIChpdGVtLmFjdGlvbiA9PT0gXCJiYWNrV29yZFwiKSB7XG4gICAgICAgICAgICB3b3JkQ291bnQtLTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpdGVtLmFjdGlvbiA9PT0gXCJzdWJtaXRDb3JyZWN0V29yZFwiIHx8XG4gICAgICAgICAgICBpdGVtLmFjdGlvbiA9PT0gXCJzdWJtaXRFcnJvcldvcmRcIikge1xuICAgICAgICAgICAgd29yZENvdW50Kys7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICB3b3Jkc0xpc3QuZm9yRWFjaCgoaXRlbSwgaSkgPT4ge1xuICAgICAgICBpZiAoaSA+IHdvcmRDb3VudClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgeCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHguY2xhc3NOYW1lID0gXCJ3b3JkXCI7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBpdGVtLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBsZXR0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGV0dGVyXCIpO1xuICAgICAgICAgICAgbGV0dGVyLmlubmVySFRNTCA9IGl0ZW1baV07XG4gICAgICAgICAgICB4LmFwcGVuZENoaWxkKGxldHRlcik7XG4gICAgICAgIH1cbiAgICAgICAgcmVwbGF5V29yZHNFbGVtZW50LmFwcGVuZENoaWxkKHgpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gcGF1c2VSZXBsYXkoKSB7XG4gICAgdmFyIF9hO1xuICAgIHRpbWVvdXRMaXN0LmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KGl0ZW0pO1xuICAgIH0pO1xuICAgIHRpbWVvdXRMaXN0ID0gW107XG4gICAgc3RvcHdhdGNoTGlzdC5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgIGNsZWFyVGltZW91dChpdGVtKTtcbiAgICB9KTtcbiAgICBzdG9wd2F0Y2hMaXN0ID0gW107XG4gICAgdGFyZ2V0Q3VyUG9zID0gY3VyUG9zO1xuICAgIHRhcmdldFdvcmRQb3MgPSB3b3JkUG9zO1xuICAgIGlmICh0b2dnbGVCdXR0b24gPT09IHVuZGVmaW5lZClcbiAgICAgICAgcmV0dXJuO1xuICAgIHRvZ2dsZUJ1dHRvbi5jbGFzc05hbWUgPSBcImZhcyBmYS1wbGF5XCI7XG4gICAgKF9hID0gdG9nZ2xlQnV0dG9uLnBhcmVudE5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIFwiUmVzdW1lIHJlcGxheVwiKTtcbn1cbmV4cG9ydHMucGF1c2VSZXBsYXkgPSBwYXVzZVJlcGxheTtcbmZ1bmN0aW9uIHBsYXlTb3VuZChlcnJvciA9IGZhbHNlKSB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnBsYXlTb3VuZE9uRXJyb3IpIHtcbiAgICAgICAgICAgIFNvdW5kLnBsYXlFcnJvcigpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGhhbmRsZURpc3BsYXlMb2dpYyhpdGVtLCBub3NvdW5kID0gZmFsc2UpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBsZXQgYWN0aXZlV29yZCA9IChfYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVwbGF5V29yZHNcIikpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jaGlsZHJlblt3b3JkUG9zXTtcbiAgICBpZiAoYWN0aXZlV29yZCA9PT0gdW5kZWZpbmVkKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKGl0ZW0uYWN0aW9uID09PSBcImNvcnJlY3RMZXR0ZXJcIikge1xuICAgICAgICBpZiAoIW5vc291bmQpXG4gICAgICAgICAgICBwbGF5U291bmQoKTtcbiAgICAgICAgYWN0aXZlV29yZC5jaGlsZHJlbltjdXJQb3NdLmNsYXNzTGlzdC5hZGQoXCJjb3JyZWN0XCIpO1xuICAgICAgICBjdXJQb3MrKztcbiAgICB9XG4gICAgZWxzZSBpZiAoaXRlbS5hY3Rpb24gPT09IFwiaW5jb3JyZWN0TGV0dGVyXCIpIHtcbiAgICAgICAgaWYgKCFub3NvdW5kKVxuICAgICAgICAgICAgcGxheVNvdW5kKHRydWUpO1xuICAgICAgICBsZXQgbXlFbGVtZW50O1xuICAgICAgICBpZiAoY3VyUG9zID49IGFjdGl2ZVdvcmQuY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgICAgICAvL2lmIGxldHRlciBpcyBhbiBleHRyYVxuICAgICAgICAgICAgbXlFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxldHRlclwiKTtcbiAgICAgICAgICAgIG15RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZXh0cmFcIik7XG4gICAgICAgICAgICBteUVsZW1lbnQuaW5uZXJIVE1MID0gKF9jID0gKF9iID0gaXRlbS52YWx1ZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnRvU3RyaW5nKCkpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IFwiXCI7XG4gICAgICAgICAgICBhY3RpdmVXb3JkLmFwcGVuZENoaWxkKG15RWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgbXlFbGVtZW50ID0gYWN0aXZlV29yZC5jaGlsZHJlbltjdXJQb3NdO1xuICAgICAgICBteUVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImluY29ycmVjdFwiKTtcbiAgICAgICAgY3VyUG9zKys7XG4gICAgfVxuICAgIGVsc2UgaWYgKGl0ZW0uYWN0aW9uID09PSBcInNldExldHRlckluZGV4XCIgJiZcbiAgICAgICAgdHlwZW9mIGl0ZW0udmFsdWUgPT09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgaWYgKCFub3NvdW5kKVxuICAgICAgICAgICAgcGxheVNvdW5kKCk7XG4gICAgICAgIGN1clBvcyA9IGl0ZW0udmFsdWU7XG4gICAgICAgIC8vIHJlbW92ZSBhbGwgbGV0dGVycyBmcm9tIGN1cnNvciB0byBlbmQgb2Ygd29yZFxuICAgICAgICBmb3IgKGNvbnN0IG15RWxlbWVudCBvZiBbLi4uYWN0aXZlV29yZC5jaGlsZHJlbl0uc2xpY2UoY3VyUG9zKSkge1xuICAgICAgICAgICAgaWYgKG15RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJleHRyYVwiKSkge1xuICAgICAgICAgICAgICAgIG15RWxlbWVudC5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG15RWxlbWVudC5jbGFzc05hbWUgPSBcIlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKGl0ZW0uYWN0aW9uID09PSBcInN1Ym1pdENvcnJlY3RXb3JkXCIpIHtcbiAgICAgICAgaWYgKCFub3NvdW5kKVxuICAgICAgICAgICAgcGxheVNvdW5kKCk7XG4gICAgICAgIHdvcmRQb3MrKztcbiAgICAgICAgY3VyUG9zID0gMDtcbiAgICB9XG4gICAgZWxzZSBpZiAoaXRlbS5hY3Rpb24gPT09IFwic3VibWl0RXJyb3JXb3JkXCIpIHtcbiAgICAgICAgaWYgKCFub3NvdW5kKVxuICAgICAgICAgICAgcGxheVNvdW5kKHRydWUpO1xuICAgICAgICBhY3RpdmVXb3JkLmNsYXNzTGlzdC5hZGQoXCJlcnJvclwiKTtcbiAgICAgICAgd29yZFBvcysrO1xuICAgICAgICBjdXJQb3MgPSAwO1xuICAgIH1cbiAgICBlbHNlIGlmIChpdGVtLmFjdGlvbiA9PT0gXCJiYWNrV29yZFwiKSB7XG4gICAgICAgIGlmICghbm9zb3VuZClcbiAgICAgICAgICAgIHBsYXlTb3VuZCgpO1xuICAgICAgICB3b3JkUG9zLS07XG4gICAgICAgIGNvbnN0IHJlcGxheVdvcmRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXBsYXlXb3Jkc1wiKTtcbiAgICAgICAgaWYgKHJlcGxheVdvcmRzICE9PSBudWxsKVxuICAgICAgICAgICAgYWN0aXZlV29yZCA9IHJlcGxheVdvcmRzLmNoaWxkcmVuW3dvcmRQb3NdO1xuICAgICAgICBjdXJQb3MgPSBhY3RpdmVXb3JkLmNoaWxkcmVuLmxlbmd0aDtcbiAgICAgICAgd2hpbGUgKGFjdGl2ZVdvcmQuY2hpbGRyZW5bY3VyUG9zIC0gMV0uY2xhc3NOYW1lID09PSBcIlwiKVxuICAgICAgICAgICAgY3VyUG9zLS07XG4gICAgICAgIGFjdGl2ZVdvcmQuY2xhc3NMaXN0LnJlbW92ZShcImVycm9yXCIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGxvYWRPbGRSZXBsYXkoKSB7XG4gICAgbGV0IHN0YXJ0aW5nSW5kZXggPSAwO1xuICAgIGN1clBvcyA9IDA7XG4gICAgd29yZFBvcyA9IDA7XG4gICAgcmVwbGF5RGF0YS5mb3JFYWNoKChpdGVtLCBpKSA9PiB7XG4gICAgICAgIGlmICh3b3JkUG9zIDwgdGFyZ2V0V29yZFBvcyB8fFxuICAgICAgICAgICAgKHdvcmRQb3MgPT09IHRhcmdldFdvcmRQb3MgJiYgY3VyUG9zIDwgdGFyZ2V0Q3VyUG9zKSkge1xuICAgICAgICAgICAgLy9xdWlja2x5IGRpc3BsYXkgZXZlcnl0aGluZyB1cCB0byB0aGUgdGFyZ2V0XG4gICAgICAgICAgICBoYW5kbGVEaXNwbGF5TG9naWMoaXRlbSwgdHJ1ZSk7XG4gICAgICAgICAgICBzdGFydGluZ0luZGV4ID0gaSArIDE7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBjb25zdCB0aW1lID0gTWF0aC5mbG9vcihyZXBsYXlEYXRhW3N0YXJ0aW5nSW5kZXhdLnRpbWUgLyAxMDAwKTtcbiAgICAkKFwiI3JlcGxheVN0b3B3YXRjaFwiKS50ZXh0KHRpbWUgKyBcInNcIik7XG4gICAgcmV0dXJuIHN0YXJ0aW5nSW5kZXg7XG59XG5mdW5jdGlvbiB0b2dnbGVSZXBsYXlEaXNwbGF5KCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAoJChcIiNyZXN1bHRSZXBsYXlcIikuc3RvcCh0cnVlLCB0cnVlKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICBpbml0aWFsaXplUmVwbGF5UHJvbXB0KCk7XG4gICAgICAgIGxvYWRPbGRSZXBsYXkoKTtcbiAgICAgICAgLy9zaG93XG4gICAgICAgIGlmICghJChcIiN3YXRjaFJlcGxheUJ1dHRvblwiKS5oYXNDbGFzcyhcImxvYWRlZFwiKSkge1xuICAgICAgICAgICAgJChcIiN3b3Jkc1wiKS5odG1sKGA8ZGl2IGNsYXNzPVwicHJlbG9hZGVyXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtc3BpbiBmYS1jaXJjbGUtbm90Y2hcIj48L2k+PC9kaXY+YCk7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdFJlcGxheVwiKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgICAgIC5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKVxuICAgICAgICAgICAgICAgIC5zbGlkZURvd24oMjUwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0UmVwbGF5XCIpXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAgICAgLmNzcyhcImRpc3BsYXlcIiwgXCJub25lXCIpXG4gICAgICAgICAgICAgICAgLnNsaWRlRG93bigyNTApO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvL2hpZGVcbiAgICAgICAgaWYgKCgoX2EgPSB0b2dnbGVCdXR0b24gPT09IG51bGwgfHwgdG9nZ2xlQnV0dG9uID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0b2dnbGVCdXR0b24ucGFyZW50Tm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIikpICE9XG4gICAgICAgICAgICBcIlN0YXJ0IHJlcGxheVwiKSB7XG4gICAgICAgICAgICBwYXVzZVJlcGxheSgpO1xuICAgICAgICB9XG4gICAgICAgICQoXCIjcmVzdWx0UmVwbGF5XCIpLnNsaWRlVXAoMjUwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdFJlcGxheVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZnVuY3Rpb24gc3RhcnRSZXBsYXlSZWNvcmRpbmcoKSB7XG4gICAgaWYgKCEkKFwiI3Jlc3VsdFJlcGxheVwiKS5zdG9wKHRydWUsIHRydWUpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIC8vaGlkZSByZXBsYXkgZGlzcGxheSBpZiB1c2VyIGxlZnQgaXQgb3BlblxuICAgICAgICB0b2dnbGVSZXBsYXlEaXNwbGF5KCk7XG4gICAgfVxuICAgICQoXCIjcmVwbGF5U3RvcHdhdGNoXCIpLnRleHQoMCArIFwic1wiKTtcbiAgICByZXBsYXlEYXRhID0gW107XG4gICAgcmVwbGF5U3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgcmVwbGF5UmVjb3JkaW5nID0gdHJ1ZTtcbiAgICB0YXJnZXRDdXJQb3MgPSAwO1xuICAgIHRhcmdldFdvcmRQb3MgPSAwO1xufVxuZXhwb3J0cy5zdGFydFJlcGxheVJlY29yZGluZyA9IHN0YXJ0UmVwbGF5UmVjb3JkaW5nO1xuZnVuY3Rpb24gc3RvcFJlcGxheVJlY29yZGluZygpIHtcbiAgICByZXBsYXlSZWNvcmRpbmcgPSBmYWxzZTtcbn1cbmV4cG9ydHMuc3RvcFJlcGxheVJlY29yZGluZyA9IHN0b3BSZXBsYXlSZWNvcmRpbmc7XG5mdW5jdGlvbiBhZGRSZXBsYXlFdmVudChhY3Rpb24sIHZhbHVlKSB7XG4gICAgaWYgKCFyZXBsYXlSZWNvcmRpbmcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB0aW1lRGVsdGEgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHJlcGxheVN0YXJ0VGltZTtcbiAgICByZXBsYXlEYXRhLnB1c2goeyBhY3Rpb246IGFjdGlvbiwgdmFsdWU6IHZhbHVlLCB0aW1lOiB0aW1lRGVsdGEgfSk7XG59XG5leHBvcnRzLmFkZFJlcGxheUV2ZW50ID0gYWRkUmVwbGF5RXZlbnQ7XG5mdW5jdGlvbiBwbGF5UmVwbGF5KCkge1xuICAgIHZhciBfYTtcbiAgICBjdXJQb3MgPSAwO1xuICAgIHdvcmRQb3MgPSAwO1xuICAgIGlmICh0b2dnbGVCdXR0b24gPT09IHVuZGVmaW5lZClcbiAgICAgICAgcmV0dXJuO1xuICAgIHRvZ2dsZUJ1dHRvbi5jbGFzc05hbWUgPSBcImZhcyBmYS1wYXVzZVwiO1xuICAgIChfYSA9IHRvZ2dsZUJ1dHRvbi5wYXJlbnROb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCBcIlBhdXNlIHJlcGxheVwiKTtcbiAgICBpbml0aWFsaXplUmVwbGF5UHJvbXB0KCk7XG4gICAgY29uc3Qgc3RhcnRpbmdJbmRleCA9IGxvYWRPbGRSZXBsYXkoKTtcbiAgICBjb25zdCBsYXN0VGltZSA9IHJlcGxheURhdGFbc3RhcnRpbmdJbmRleF0udGltZTtcbiAgICBsZXQgc3dUaW1lID0gTWF0aC5yb3VuZChsYXN0VGltZSAvIDEwMDApOyAvL3N0YXJ0aW5nIHRpbWVcbiAgICBjb25zdCBzd0VuZFRpbWUgPSBNYXRoLnJvdW5kKHJlcGxheURhdGFbcmVwbGF5RGF0YS5sZW5ndGggLSAxXS50aW1lIC8gMTAwMCk7XG4gICAgd2hpbGUgKHN3VGltZSA8PSBzd0VuZFRpbWUpIHtcbiAgICAgICAgY29uc3QgdGltZSA9IHN3VGltZTtcbiAgICAgICAgc3RvcHdhdGNoTGlzdC5wdXNoKHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNyZXBsYXlTdG9wd2F0Y2hcIikudGV4dCh0aW1lICsgXCJzXCIpO1xuICAgICAgICB9LCB0aW1lICogMTAwMCAtIGxhc3RUaW1lKSk7XG4gICAgICAgIHN3VGltZSsrO1xuICAgIH1cbiAgICByZXBsYXlEYXRhLmZvckVhY2goKGl0ZW0sIGkpID0+IHtcbiAgICAgICAgaWYgKGkgPCBzdGFydGluZ0luZGV4KVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aW1lb3V0TGlzdC5wdXNoKHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgaGFuZGxlRGlzcGxheUxvZ2ljKGl0ZW0pO1xuICAgICAgICB9LCBpdGVtLnRpbWUgLSBsYXN0VGltZSkpO1xuICAgIH0pO1xuICAgIHRpbWVvdXRMaXN0LnB1c2goc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIC8vYWZ0ZXIgdGhlIHJlcGxheSBoYXMgZmluaXNoZWQsIHRoaXMgd2lsbCBydW5cbiAgICAgICAgdGFyZ2V0Q3VyUG9zID0gMDtcbiAgICAgICAgdGFyZ2V0V29yZFBvcyA9IDA7XG4gICAgICAgIHRvZ2dsZUJ1dHRvbi5jbGFzc05hbWUgPSBcImZhcyBmYS1wbGF5XCI7XG4gICAgICAgIHRvZ2dsZUJ1dHRvbi5wYXJlbnROb2RlLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgXCJTdGFydCByZXBsYXlcIik7XG4gICAgfSwgcmVwbGF5RGF0YVtyZXBsYXlEYXRhLmxlbmd0aCAtIDFdLnRpbWUgLSBsYXN0VGltZSkpO1xufVxuZnVuY3Rpb24gZ2V0UmVwbGF5RXhwb3J0KCkge1xuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIHJlcGxheURhdGE6IHJlcGxheURhdGEsXG4gICAgICAgIHdvcmRzTGlzdDogd29yZHNMaXN0LFxuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRSZXBsYXlFeHBvcnQgPSBnZXRSZXBsYXlFeHBvcnQ7XG4kKFwiLnBhZ2VUZXN0ICNwbGF5cGF1c2VSZXBsYXlCdXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgaWYgKCh0b2dnbGVCdXR0b24gPT09IG51bGwgfHwgdG9nZ2xlQnV0dG9uID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0b2dnbGVCdXR0b24uY2xhc3NOYW1lKSA9PT0gXCJmYXMgZmEtcGxheVwiKSB7XG4gICAgICAgIHBsYXlSZXBsYXkoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoKHRvZ2dsZUJ1dHRvbiA9PT0gbnVsbCB8fCB0b2dnbGVCdXR0b24gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRvZ2dsZUJ1dHRvbi5jbGFzc05hbWUpID09PSBcImZhcyBmYS1wYXVzZVwiKSB7XG4gICAgICAgIHBhdXNlUmVwbGF5KCk7XG4gICAgfVxufSk7XG4kKFwiI3JlcGxheVdvcmRzXCIpLm9uKFwiY2xpY2tcIiwgXCJsZXR0ZXJcIiwgKGV2ZW50KSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIC8vYWxsb3dzIHVzZXIgdG8gY2xpY2sgb24gdGhlIHBsYWNlIHRoZXkgd2FudCB0byBzdGFydCB0aGVpciByZXBsYXkgYXRcbiAgICBwYXVzZVJlcGxheSgpO1xuICAgIGNvbnN0IHJlcGxheVdvcmRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNyZXBsYXlXb3Jkc1wiKTtcbiAgICBjb25zdCB3b3JkcyA9IFsuLi4oKF9hID0gcmVwbGF5V29yZHMgPT09IG51bGwgfHwgcmVwbGF5V29yZHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlcGxheVdvcmRzLmNoaWxkcmVuKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBbXSldO1xuICAgIHRhcmdldFdvcmRQb3MgPSB3b3Jkcy5pbmRleE9mKGV2ZW50LnRhcmdldC5wYXJlbnROb2RlKTtcbiAgICBjb25zdCBsZXR0ZXJzID0gWy4uLndvcmRzW3RhcmdldFdvcmRQb3NdLmNoaWxkcmVuXTtcbiAgICB0YXJnZXRDdXJQb3MgPSBsZXR0ZXJzLmluZGV4T2YoZXZlbnQudGFyZ2V0KTtcbiAgICBpbml0aWFsaXplUmVwbGF5UHJvbXB0KCk7XG4gICAgbG9hZE9sZFJlcGxheSgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImtleXByZXNzXCIsIFwiI3dhdGNoUmVwbGF5QnV0dG9uXCIsIChldmVudCkgPT4ge1xuICAgIGlmIChldmVudC5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICB0b2dnbGVSZXBsYXlEaXNwbGF5KCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIjd2F0Y2hSZXBsYXlCdXR0b25cIiwgKCkgPT4ge1xuICAgIHRvZ2dsZVJlcGxheURpc3BsYXkoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51cGRhdGUgPSBleHBvcnRzLnVwZGF0ZVJhdGVRdW90ZSA9IGV4cG9ydHMudXBkYXRlQ3Jvd24gPSBleHBvcnRzLmhpZGVDcm93biA9IGV4cG9ydHMuc2hvd0Nyb3duID0gZXhwb3J0cy51cGRhdGVUb2RheVRyYWNrZXIgPSBleHBvcnRzLnVwZGF0ZUdyYXBoUEJMaW5lID0gZXhwb3J0cy50b2dnbGVVbnNtb290aGVkUmF3ID0gdm9pZCAwO1xuY29uc3QgVGVzdFVJID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QtdWlcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IFRlc3RTdGF0cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXN0YXRzXCIpKTtcbmNvbnN0IEtleW1hcCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMva2V5bWFwXCIpKTtcbmNvbnN0IENoYXJ0Q29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvY2hhcnQtY29udHJvbGxlclwiKSk7XG5jb25zdCBUaGVtZUNvbG9ycyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvdGhlbWUtY29sb3JzXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBUb2RheVRyYWNrZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdG9kYXktdHJhY2tlclwiKSk7XG5jb25zdCBQYkNyb3duID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3BiLWNyb3duXCIpKTtcbmNvbnN0IFF1b3RlUmF0ZVBvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wb3B1cHMvcXVvdGUtcmF0ZS1wb3B1cFwiKSk7XG5jb25zdCBHbGFyc2VzTW9kZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL2dsYXJzZXMtbW9kZVwiKSk7XG5jb25zdCBUZXN0SW5wdXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC1pbnB1dFwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IFJlc3VsdHNTaG93bkV2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9yZXN1bHRzLXNob3duLWV2ZW50XCIpKTtcbmNvbnN0IGNoYXJ0X2pzXzEgPSByZXF1aXJlKFwiY2hhcnQuanNcIik7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xubGV0IHJlc3VsdDtcbmxldCBtYXhDaGFydFZhbDtcbmxldCB1c2VVbnNtb290aGVkUmF3ID0gZmFsc2U7XG5mdW5jdGlvbiB0b2dnbGVVbnNtb290aGVkUmF3KCkge1xuICAgIHVzZVVuc21vb3RoZWRSYXcgPSAhdXNlVW5zbW9vdGhlZFJhdztcbiAgICBOb3RpZmljYXRpb25zLmFkZCh1c2VVbnNtb290aGVkUmF3ID8gXCJvblwiIDogXCJvZmZcIiwgMSk7XG59XG5leHBvcnRzLnRvZ2dsZVVuc21vb3RoZWRSYXcgPSB0b2dnbGVVbnNtb290aGVkUmF3O1xubGV0IHJlc3VsdEFubm90YXRpb24gPSBbXTtcbmxldCByZXN1bHRTY2FsZU9wdGlvbnMgPSBDaGFydENvbnRyb2xsZXIucmVzdWx0Lm9wdGlvbnMuc2NhbGVzO1xuZnVuY3Rpb24gdXBkYXRlR3JhcGgoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCBsYWJlbHMgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gVGVzdElucHV0LndwbUhpc3RvcnkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChUZXN0U3RhdHMubGFzdFNlY29uZE5vdFJvdW5kICYmIGkgPT09IFRlc3RJbnB1dC53cG1IaXN0b3J5Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGxhYmVscy5wdXNoKE1pc2Mucm91bmRUbzIocmVzdWx0LnRlc3REdXJhdGlvbikudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsYWJlbHMucHVzaChpLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIENoYXJ0Q29udHJvbGxlci5yZXN1bHQuZGF0YS5sYWJlbHMgPSBsYWJlbHM7XG4gICAgICAgIHJlc3VsdFNjYWxlT3B0aW9uc1tcIndwbVwiXS50aXRsZS50ZXh0ID0gY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNXG4gICAgICAgICAgICA/IFwiQ2hhcmFjdGVyIHBlciBNaW51dGVcIlxuICAgICAgICAgICAgOiBcIldvcmRzIHBlciBNaW51dGVcIjtcbiAgICAgICAgY29uc3QgY2hhcnREYXRhMSA9IGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTVxuICAgICAgICAgICAgPyBUZXN0SW5wdXQud3BtSGlzdG9yeS5tYXAoKGEpID0+IGEgKiA1KVxuICAgICAgICAgICAgOiBUZXN0SW5wdXQud3BtSGlzdG9yeTtcbiAgICAgICAgbGV0IGNoYXJ0RGF0YTI7XG4gICAgICAgIGlmIChyZXN1bHQuY2hhcnREYXRhID09PSBcInRvb2xvbmdcIilcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKHVzZVVuc21vb3RoZWRSYXcpIHtcbiAgICAgICAgICAgIGNoYXJ0RGF0YTIgPVxuICAgICAgICAgICAgICAgIChfYiA9IChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE1cbiAgICAgICAgICAgICAgICAgICAgPyAoX2EgPSByZXN1bHQuY2hhcnREYXRhLnVuc21vb3RoZWRSYXcpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tYXAoKGEpID0+IGEgKiA1KVxuICAgICAgICAgICAgICAgICAgICA6IHJlc3VsdC5jaGFydERhdGEudW5zbW9vdGhlZFJhdykpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IFtdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY2hhcnREYXRhMiA9IGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTVxuICAgICAgICAgICAgICAgID8gcmVzdWx0LmNoYXJ0RGF0YS5yYXcubWFwKChhKSA9PiBhICogNSlcbiAgICAgICAgICAgICAgICA6IHJlc3VsdC5jaGFydERhdGEucmF3O1xuICAgICAgICB9XG4gICAgICAgIENoYXJ0Q29udHJvbGxlci5yZXN1bHQuZGF0YS5kYXRhc2V0c1swXS5kYXRhID0gY2hhcnREYXRhMTtcbiAgICAgICAgQ2hhcnRDb250cm9sbGVyLnJlc3VsdC5kYXRhLmRhdGFzZXRzWzFdLmRhdGEgPSBjaGFydERhdGEyO1xuICAgICAgICBDaGFydENvbnRyb2xsZXIucmVzdWx0LmRhdGEuZGF0YXNldHNbMF0ubGFiZWwgPSBjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE1cbiAgICAgICAgICAgID8gXCJjcG1cIlxuICAgICAgICAgICAgOiBcIndwbVwiO1xuICAgICAgICBtYXhDaGFydFZhbCA9IE1hdGgubWF4KC4uLltNYXRoLm1heCguLi5jaGFydERhdGEyKSwgTWF0aC5tYXgoLi4uY2hhcnREYXRhMSldKTtcbiAgICAgICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LnN0YXJ0R3JhcGhzQXRaZXJvKSB7XG4gICAgICAgICAgICBjb25zdCBtaW5DaGFydFZhbCA9IE1hdGgubWluKC4uLltNYXRoLm1pbiguLi5jaGFydERhdGEyKSwgTWF0aC5taW4oLi4uY2hhcnREYXRhMSldKTtcbiAgICAgICAgICAgIHJlc3VsdFNjYWxlT3B0aW9uc1tcIndwbVwiXS5taW4gPSBtaW5DaGFydFZhbDtcbiAgICAgICAgICAgIHJlc3VsdFNjYWxlT3B0aW9uc1tcInJhd1wiXS5taW4gPSBtaW5DaGFydFZhbDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdFNjYWxlT3B0aW9uc1tcIndwbVwiXS5taW4gPSAwO1xuICAgICAgICAgICAgcmVzdWx0U2NhbGVPcHRpb25zW1wicmF3XCJdLm1pbiA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgQ2hhcnRDb250cm9sbGVyLnJlc3VsdC5kYXRhLmRhdGFzZXRzWzJdLmRhdGEgPSByZXN1bHQuY2hhcnREYXRhLmVycjtcbiAgICAgICAgY29uc3QgZmMgPSB5aWVsZCBUaGVtZUNvbG9ycy5nZXQoXCJzdWJcIik7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCAhPT0gXCJub25lXCIpIHtcbiAgICAgICAgICAgIGxldCBjb250ZW50ID0gY29uZmlnXzEuZGVmYXVsdC5mdW5ib3g7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwibGF5b3V0Zmx1aWRcIikge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQgKz0gXCIgXCIgKyBjb25maWdfMS5kZWZhdWx0LmN1c3RvbUxheW91dGZsdWlkLnJlcGxhY2UoLyMvZywgXCIgXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzdWx0QW5ub3RhdGlvbi5wdXNoKHtcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgIGlkOiBcImZ1bmJveC1sYWJlbFwiLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwibGluZVwiLFxuICAgICAgICAgICAgICAgIHNjYWxlSUQ6IFwid3BtXCIsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHJlc3VsdFNjYWxlT3B0aW9uc1tcIndwbVwiXS5taW4sXG4gICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IFwidHJhbnNwYXJlbnRcIixcbiAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMSxcbiAgICAgICAgICAgICAgICBib3JkZXJEYXNoOiBbMiwgMl0sXG4gICAgICAgICAgICAgICAgbGFiZWw6IHtcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBcInRyYW5zcGFyZW50XCIsXG4gICAgICAgICAgICAgICAgICAgIGZvbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhbWlseTogY29uZmlnXzEuZGVmYXVsdC5mb250RmFtaWx5LnJlcGxhY2UoL18vZywgXCIgXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogMTEsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogXCJub3JtYWxcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHdlaWdodDogY2hhcnRfanNfMS5DaGFydC5kZWZhdWx0cy5mb250LndlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6IGNoYXJ0X2pzXzEuQ2hhcnQuZGVmYXVsdHMuZm9udC5saW5lSGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBjb2xvcjogZmMsXG4gICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IDMsXG4gICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogMyxcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IFwic3RhcnRcIixcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogYCR7Y29udGVudH1gLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXN1bHRTY2FsZU9wdGlvbnNbXCJ3cG1cIl0ubWF4ID0gbWF4Q2hhcnRWYWw7XG4gICAgICAgIHJlc3VsdFNjYWxlT3B0aW9uc1tcInJhd1wiXS5tYXggPSBtYXhDaGFydFZhbDtcbiAgICAgICAgcmVzdWx0U2NhbGVPcHRpb25zW1wiZXJyb3JcIl0ubWF4ID0gTWF0aC5tYXgoLi4ucmVzdWx0LmNoYXJ0RGF0YS5lcnIpICsgMTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZUdyYXBoUEJMaW5lKCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IHRoZW1lY29sb3JzID0geWllbGQgVGhlbWVDb2xvcnMuZ2V0QWxsKCk7XG4gICAgICAgIGNvbnN0IGxwYiA9IHlpZWxkIERCLmdldExvY2FsUEIocmVzdWx0Lm1vZGUsIHJlc3VsdC5tb2RlMiwgKF9hID0gcmVzdWx0LnB1bmN0dWF0aW9uKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBmYWxzZSwgcmVzdWx0Lmxhbmd1YWdlLCByZXN1bHQuZGlmZmljdWx0eSwgKF9iID0gcmVzdWx0LmxhenlNb2RlKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBmYWxzZSwgKF9jID0gcmVzdWx0LmZ1bmJveCkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogXCJub25lXCIpO1xuICAgICAgICBpZiAobHBiID09IDApXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGNoYXJ0bHBiID0gTWlzYy5yb3VuZFRvMihjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0gPyBscGIgKiA1IDogbHBiKS50b0ZpeGVkKDIpO1xuICAgICAgICByZXN1bHRBbm5vdGF0aW9uLnB1c2goe1xuICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgIHR5cGU6IFwibGluZVwiLFxuICAgICAgICAgICAgaWQ6IFwibHBiXCIsXG4gICAgICAgICAgICBzY2FsZUlEOiBcIndwbVwiLFxuICAgICAgICAgICAgdmFsdWU6IGNoYXJ0bHBiLFxuICAgICAgICAgICAgYm9yZGVyQ29sb3I6IHRoZW1lY29sb3JzW1wic3ViXCJdLFxuICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDEsXG4gICAgICAgICAgICBib3JkZXJEYXNoOiBbMiwgMl0sXG4gICAgICAgICAgICBsYWJlbDoge1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogdGhlbWVjb2xvcnNbXCJzdWJcIl0sXG4gICAgICAgICAgICAgICAgZm9udDoge1xuICAgICAgICAgICAgICAgICAgICBmYW1pbHk6IGNvbmZpZ18xLmRlZmF1bHQuZm9udEZhbWlseS5yZXBsYWNlKC9fL2csIFwiIFwiKSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogMTEsXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlOiBcIm5vcm1hbFwiLFxuICAgICAgICAgICAgICAgICAgICB3ZWlnaHQ6IGNoYXJ0X2pzXzEuQ2hhcnQuZGVmYXVsdHMuZm9udC53ZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6IGNoYXJ0X2pzXzEuQ2hhcnQuZGVmYXVsdHMuZm9udC5saW5lSGVpZ2h0LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29sb3I6IHRoZW1lY29sb3JzW1wiYmdcIl0sXG4gICAgICAgICAgICAgICAgcGFkZGluZzogMyxcbiAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6IDMsXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjb250ZW50OiBgUEI6ICR7Y2hhcnRscGJ9YCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAobWF4Q2hhcnRWYWwgPj0gcGFyc2VGbG9hdChjaGFydGxwYikgLSAyMCAmJlxuICAgICAgICAgICAgbWF4Q2hhcnRWYWwgPD0gcGFyc2VGbG9hdChjaGFydGxwYikgKyAyMCkge1xuICAgICAgICAgICAgbWF4Q2hhcnRWYWwgPSBwYXJzZUZsb2F0KGNoYXJ0bHBiKSArIDE1O1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdFNjYWxlT3B0aW9uc1tcIndwbVwiXS5tYXggPSBNYXRoLnJvdW5kKG1heENoYXJ0VmFsICsgNSk7XG4gICAgICAgIHJlc3VsdFNjYWxlT3B0aW9uc1tcInJhd1wiXS5tYXggPSBNYXRoLnJvdW5kKG1heENoYXJ0VmFsICsgNSk7XG4gICAgfSk7XG59XG5leHBvcnRzLnVwZGF0ZUdyYXBoUEJMaW5lID0gdXBkYXRlR3JhcGhQQkxpbmU7XG5mdW5jdGlvbiB1cGRhdGVXcG1BbmRBY2MoKSB7XG4gICAgbGV0IGluZiA9IGZhbHNlO1xuICAgIGlmIChyZXN1bHQud3BtID49IDEwMDApIHtcbiAgICAgICAgaW5mID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0RlY2ltYWxQbGFjZXMpIHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLnRvcCAudGV4dFwiKS50ZXh0KFwid3BtXCIpO1xuICAgICAgICAgICAgaWYgKGluZikge1xuICAgICAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC5ib3R0b21cIikudGV4dChcIkluZmluaXRlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLmJvdHRvbVwiKS50ZXh0KE1pc2Mucm91bmRUbzIocmVzdWx0LndwbSkudG9GaXhlZCgyKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnJhdyAuYm90dG9tXCIpLnRleHQoTWlzYy5yb3VuZFRvMihyZXN1bHQucmF3V3BtKS50b0ZpeGVkKDIpKTtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC5ib3R0b21cIikuYXR0cihcImFyaWEtbGFiZWxcIiwgTWlzYy5yb3VuZFRvMihyZXN1bHQud3BtICogNSkudG9GaXhlZCgyKSArIFwiIGNwbVwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC50b3AgLnRleHRcIikudGV4dChcImNwbVwiKTtcbiAgICAgICAgICAgIGlmIChpbmYpIHtcbiAgICAgICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAuYm90dG9tXCIpLnRleHQoXCJJbmZpbml0ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC5ib3R0b21cIikudGV4dChNaXNjLnJvdW5kVG8yKHJlc3VsdC53cG0gKiA1KS50b0ZpeGVkKDIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAucmF3IC5ib3R0b21cIikudGV4dChNaXNjLnJvdW5kVG8yKHJlc3VsdC5yYXdXcG0gKiA1KS50b0ZpeGVkKDIpKTtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC5ib3R0b21cIikuYXR0cihcImFyaWEtbGFiZWxcIiwgTWlzYy5yb3VuZFRvMihyZXN1bHQud3BtKS50b0ZpeGVkKDIpICsgXCIgd3BtXCIpO1xuICAgICAgICB9XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAuYWNjIC5ib3R0b21cIikudGV4dChyZXN1bHQuYWNjID09IDEwMCA/IFwiMTAwJVwiIDogTWlzYy5yb3VuZFRvMihyZXN1bHQuYWNjKS50b0ZpeGVkKDIpICsgXCIlXCIpO1xuICAgICAgICBsZXQgdGltZSA9IE1pc2Mucm91bmRUbzIocmVzdWx0LnRlc3REdXJhdGlvbikudG9GaXhlZCgyKSArIFwic1wiO1xuICAgICAgICBpZiAocmVzdWx0LnRlc3REdXJhdGlvbiA+IDYxKSB7XG4gICAgICAgICAgICB0aW1lID0gTWlzYy5zZWNvbmRzVG9TdHJpbmcoTWlzYy5yb3VuZFRvMihyZXN1bHQudGVzdER1cmF0aW9uKSk7XG4gICAgICAgIH1cbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC50aW1lIC5ib3R0b20gLnRleHRcIikudGV4dCh0aW1lKTtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5yYXcgLmJvdHRvbVwiKS5yZW1vdmVBdHRyKFwiYXJpYS1sYWJlbFwiKTtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5hY2MgLmJvdHRvbVwiKS5yZW1vdmVBdHRyKFwiYXJpYS1sYWJlbFwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vbm90IHNob3dpbmcgZGVjaW1hbCBwbGFjZXNcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLnRvcCAudGV4dFwiKS50ZXh0KFwid3BtXCIpO1xuICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLmJvdHRvbVwiKS5hdHRyKFwiYXJpYS1sYWJlbFwiLCByZXN1bHQud3BtICsgYCAoJHtNaXNjLnJvdW5kVG8yKHJlc3VsdC53cG0gKiA1KX0gY3BtKWApO1xuICAgICAgICAgICAgaWYgKGluZikge1xuICAgICAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC5ib3R0b21cIikudGV4dChcIkluZmluaXRlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLmJvdHRvbVwiKS50ZXh0KE1hdGgucm91bmQocmVzdWx0LndwbSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5yYXcgLmJvdHRvbVwiKS50ZXh0KE1hdGgucm91bmQocmVzdWx0LnJhd1dwbSkpO1xuICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5yYXcgLmJvdHRvbVwiKS5hdHRyKFwiYXJpYS1sYWJlbFwiLCByZXN1bHQucmF3V3BtKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC50b3AgLnRleHRcIikudGV4dChcImNwbVwiKTtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC5ib3R0b21cIikuYXR0cihcImFyaWEtbGFiZWxcIiwgTWlzYy5yb3VuZFRvMihyZXN1bHQud3BtICogNSkgKyBgICgke01pc2Mucm91bmRUbzIocmVzdWx0LndwbSl9IHdwbSlgKTtcbiAgICAgICAgICAgIGlmIChpbmYpIHtcbiAgICAgICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAuYm90dG9tXCIpLnRleHQoXCJJbmZpbml0ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC5ib3R0b21cIikudGV4dChNYXRoLnJvdW5kKHJlc3VsdC53cG0gKiA1KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnJhdyAuYm90dG9tXCIpLnRleHQoTWF0aC5yb3VuZChyZXN1bHQucmF3V3BtICogNSkpO1xuICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5yYXcgLmJvdHRvbVwiKS5hdHRyKFwiYXJpYS1sYWJlbFwiLCByZXN1bHQucmF3V3BtICogNSk7XG4gICAgICAgIH1cbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5hY2MgLmJvdHRvbVwiKS50ZXh0KE1hdGguZmxvb3IocmVzdWx0LmFjYykgKyBcIiVcIik7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAuYWNjIC5ib3R0b21cIikuYXR0cihcImFyaWEtbGFiZWxcIiwgcmVzdWx0LmFjYyArIFwiJVwiKTtcbiAgICB9XG59XG5mdW5jdGlvbiB1cGRhdGVDb25zaXN0ZW5jeSgpIHtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93RGVjaW1hbFBsYWNlcykge1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLmNvbnNpc3RlbmN5IC5ib3R0b21cIikudGV4dChNaXNjLnJvdW5kVG8yKHJlc3VsdC5jb25zaXN0ZW5jeSkudG9GaXhlZCgyKSArIFwiJVwiKTtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5jb25zaXN0ZW5jeSAuYm90dG9tXCIpLmF0dHIoXCJhcmlhLWxhYmVsXCIsIGAke3Jlc3VsdC5rZXlDb25zaXN0ZW5jeS50b0ZpeGVkKDIpfSUga2V5YCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLmNvbnNpc3RlbmN5IC5ib3R0b21cIikudGV4dChNYXRoLnJvdW5kKHJlc3VsdC5jb25zaXN0ZW5jeSkgKyBcIiVcIik7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAuY29uc2lzdGVuY3kgLmJvdHRvbVwiKS5hdHRyKFwiYXJpYS1sYWJlbFwiLCBgJHtyZXN1bHQuY29uc2lzdGVuY3l9JSAoJHtyZXN1bHQua2V5Q29uc2lzdGVuY3l9JSBrZXkpYCk7XG4gICAgfVxufVxuZnVuY3Rpb24gdXBkYXRlVGltZSgpIHtcbiAgICBjb25zdCBhZmtTZWNvbmRzUGVyY2VudCA9IE1pc2Mucm91bmRUbzIoKHJlc3VsdC5hZmtEdXJhdGlvbiAvIHJlc3VsdC50ZXN0RHVyYXRpb24pICogMTAwKTtcbiAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnRpbWUgLmJvdHRvbSAuYWZrXCIpLnRleHQoXCJcIik7XG4gICAgaWYgKGFma1NlY29uZHNQZXJjZW50ID4gMCkge1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnRpbWUgLmJvdHRvbSAuYWZrXCIpLnRleHQoYWZrU2Vjb25kc1BlcmNlbnQgKyBcIiUgYWZrXCIpO1xuICAgIH1cbiAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnRpbWUgLmJvdHRvbVwiKS5hdHRyKFwiYXJpYS1sYWJlbFwiLCBgJHtyZXN1bHQuYWZrRHVyYXRpb259cyBhZmsgJHthZmtTZWNvbmRzUGVyY2VudH0lYCk7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0RlY2ltYWxQbGFjZXMpIHtcbiAgICAgICAgbGV0IHRpbWUgPSBNaXNjLnJvdW5kVG8yKHJlc3VsdC50ZXN0RHVyYXRpb24pLnRvRml4ZWQoMikgKyBcInNcIjtcbiAgICAgICAgaWYgKHJlc3VsdC50ZXN0RHVyYXRpb24gPiA2MSkge1xuICAgICAgICAgICAgdGltZSA9IE1pc2Muc2Vjb25kc1RvU3RyaW5nKE1pc2Mucm91bmRUbzIocmVzdWx0LnRlc3REdXJhdGlvbikpO1xuICAgICAgICB9XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAudGltZSAuYm90dG9tIC50ZXh0XCIpLnRleHQodGltZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBsZXQgdGltZSA9IE1hdGgucm91bmQocmVzdWx0LnRlc3REdXJhdGlvbikgKyBcInNcIjtcbiAgICAgICAgaWYgKHJlc3VsdC50ZXN0RHVyYXRpb24gPiA2MSkge1xuICAgICAgICAgICAgdGltZSA9IE1pc2Muc2Vjb25kc1RvU3RyaW5nKE1hdGgucm91bmQocmVzdWx0LnRlc3REdXJhdGlvbikpO1xuICAgICAgICB9XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAudGltZSAuYm90dG9tIC50ZXh0XCIpLnRleHQodGltZSk7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAudGltZSAuYm90dG9tXCIpLmF0dHIoXCJhcmlhLWxhYmVsXCIsIGAke01pc2Mucm91bmRUbzIocmVzdWx0LnRlc3REdXJhdGlvbil9cyAoJHtyZXN1bHQuYWZrRHVyYXRpb259cyBhZmsgJHthZmtTZWNvbmRzUGVyY2VudH0lKWApO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHVwZGF0ZVRvZGF5VHJhY2tlcigpIHtcbiAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnRpbWUgLmJvdHRvbSAudGltZVRvZGF5XCIpLnRleHQoVG9kYXlUcmFja2VyLmdldFN0cmluZygpKTtcbn1cbmV4cG9ydHMudXBkYXRlVG9kYXlUcmFja2VyID0gdXBkYXRlVG9kYXlUcmFja2VyO1xuZnVuY3Rpb24gdXBkYXRlS2V5KCkge1xuICAgICQoXCIjcmVzdWx0IC5zdGF0cyAua2V5IC5ib3R0b21cIikudGV4dChyZXN1bHQuY2hhclN0YXRzWzBdICtcbiAgICAgICAgXCIvXCIgK1xuICAgICAgICByZXN1bHQuY2hhclN0YXRzWzFdICtcbiAgICAgICAgXCIvXCIgK1xuICAgICAgICByZXN1bHQuY2hhclN0YXRzWzJdICtcbiAgICAgICAgXCIvXCIgK1xuICAgICAgICByZXN1bHQuY2hhclN0YXRzWzNdKTtcbn1cbmZ1bmN0aW9uIHNob3dDcm93bigpIHtcbiAgICBQYkNyb3duLnNob3coKTtcbn1cbmV4cG9ydHMuc2hvd0Nyb3duID0gc2hvd0Nyb3duO1xuZnVuY3Rpb24gaGlkZUNyb3duKCkge1xuICAgIFBiQ3Jvd24uaGlkZSgpO1xuICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC5jcm93blwiKS5hdHRyKFwiYXJpYS1sYWJlbFwiLCBcIlwiKTtcbn1cbmV4cG9ydHMuaGlkZUNyb3duID0gaGlkZUNyb3duO1xuZnVuY3Rpb24gdXBkYXRlQ3Jvd24oKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgbGV0IHBiRGlmZiA9IDA7XG4gICAgICAgIGNvbnN0IGxwYiA9IHlpZWxkIERCLmdldExvY2FsUEIoY29uZmlnXzEuZGVmYXVsdC5tb2RlLCByZXN1bHQubW9kZTIsIGNvbmZpZ18xLmRlZmF1bHQucHVuY3R1YXRpb24sIGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UsIGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSwgY29uZmlnXzEuZGVmYXVsdC5sYXp5TW9kZSwgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3gpO1xuICAgICAgICBwYkRpZmYgPSBNYXRoLmFicyhyZXN1bHQud3BtIC0gbHBiKTtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLmNyb3duXCIpLmF0dHIoXCJhcmlhLWxhYmVsXCIsIFwiK1wiICsgTWlzYy5yb3VuZFRvMihwYkRpZmYpKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMudXBkYXRlQ3Jvd24gPSB1cGRhdGVDcm93bjtcbmZ1bmN0aW9uIHVwZGF0ZVRhZ3MoZG9udFNhdmUpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgYWN0aXZlVGFncyA9IFtdO1xuICAgIHRyeSB7XG4gICAgICAgIChfYSA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgaWYgKHRhZy5hY3RpdmUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBhY3RpdmVUYWdzLnB1c2godGFnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7IH1cbiAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnRhZ3NcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgaWYgKGFjdGl2ZVRhZ3MubGVuZ3RoID09IDApIHtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC50YWdzXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC50YWdzXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnRhZ3MgLmJvdHRvbVwiKS50ZXh0KFwiXCIpO1xuICAgIGxldCBhbm5vdGF0aW9uU2lkZSA9IFwic3RhcnRcIjtcbiAgICBsZXQgbGFiZWxBZGp1c3QgPSAxNTtcbiAgICBhY3RpdmVUYWdzLmZvckVhY2goKHRhZykgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCB0cGIgPSB5aWVsZCBEQi5nZXRMb2NhbFRhZ1BCKHRhZy5faWQsIGNvbmZpZ18xLmRlZmF1bHQubW9kZSwgcmVzdWx0Lm1vZGUyLCBjb25maWdfMS5kZWZhdWx0LnB1bmN0dWF0aW9uLCBjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlLCBjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHksIGNvbmZpZ18xLmRlZmF1bHQubGF6eU1vZGUpO1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnRhZ3MgLmJvdHRvbVwiKS5hcHBlbmQoYFxuICAgICAgPGRpdiB0YWdpZD1cIiR7dGFnLl9pZH1cIiBhcmlhLWxhYmVsPVwiUEI6ICR7dHBifVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPiR7dGFnLm5hbWV9PGkgY2xhc3M9XCJmYXMgZmEtY3Jvd24gaGlkZGVuXCI+PC9pPjwvZGl2PlxuICAgIGApO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9IFwicXVvdGVcIiAmJiAhZG9udFNhdmUpIHtcbiAgICAgICAgICAgIGlmICh0cGIgPCByZXN1bHQud3BtKSB7XG4gICAgICAgICAgICAgICAgLy9uZXcgcGIgZm9yIHRoYXQgdGFnXG4gICAgICAgICAgICAgICAgREIuc2F2ZUxvY2FsVGFnUEIodGFnLl9pZCwgY29uZmlnXzEuZGVmYXVsdC5tb2RlLCByZXN1bHQubW9kZTIsIGNvbmZpZ18xLmRlZmF1bHQucHVuY3R1YXRpb24sIGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UsIGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSwgY29uZmlnXzEuZGVmYXVsdC5sYXp5TW9kZSwgcmVzdWx0LndwbSwgcmVzdWx0LmFjYywgcmVzdWx0LnJhd1dwbSwgcmVzdWx0LmNvbnNpc3RlbmN5KTtcbiAgICAgICAgICAgICAgICAkKGAjcmVzdWx0IC5zdGF0cyAudGFncyAuYm90dG9tIGRpdlt0YWdpZD1cIiR7dGFnLl9pZH1cIl0gLmZhc2ApLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICQoYCNyZXN1bHQgLnN0YXRzIC50YWdzIC5ib3R0b20gZGl2W3RhZ2lkPVwiJHt0YWcuX2lkfVwiXWApLmF0dHIoXCJhcmlhLWxhYmVsXCIsIFwiK1wiICsgTWlzYy5yb3VuZFRvMihyZXN1bHQud3BtIC0gdHBiKSk7XG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJuZXcgcGIgZm9yIHRhZyBcIiArIHRhZy5uYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRoZW1lY29sb3JzID0geWllbGQgVGhlbWVDb2xvcnMuZ2V0QWxsKCk7XG4gICAgICAgICAgICAgICAgcmVzdWx0QW5ub3RhdGlvbi5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJsaW5lXCIsXG4gICAgICAgICAgICAgICAgICAgIGlkOiBcInRwYlwiLFxuICAgICAgICAgICAgICAgICAgICBzY2FsZUlEOiBcIndwbVwiLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNID8gdHBiICogNSA6IHRwYixcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IHRoZW1lY29sb3JzW1wic3ViXCJdLFxuICAgICAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMSxcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyRGFzaDogWzIsIDJdLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiB0aGVtZWNvbG9yc1tcInN1YlwiXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW1pbHk6IGNvbmZpZ18xLmRlZmF1bHQuZm9udEZhbWlseS5yZXBsYWNlKC9fL2csIFwiIFwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplOiAxMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogXCJub3JtYWxcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ZWlnaHQ6IGNoYXJ0X2pzXzEuQ2hhcnQuZGVmYXVsdHMuZm9udC53ZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodDogY2hhcnRfanNfMS5DaGFydC5kZWZhdWx0cy5mb250LmxpbmVIZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IHRoZW1lY29sb3JzW1wiYmdcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAzLFxuICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAzLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGFubm90YXRpb25TaWRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgeEFkanVzdDogbGFiZWxBZGp1c3QsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogYCR7dGFnLm5hbWV9IFBCOiAke01pc2Mucm91bmRUbzIoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNID8gdHBiICogNSA6IHRwYikudG9GaXhlZCgyKX1gLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChhbm5vdGF0aW9uU2lkZSA9PT0gXCJzdGFydFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGFubm90YXRpb25TaWRlID0gXCJlbmRcIjtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWxBZGp1c3QgPSAtMTU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhbm5vdGF0aW9uU2lkZSA9IFwic3RhcnRcIjtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWxBZGp1c3QgPSAxNTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KSk7XG59XG5mdW5jdGlvbiB1cGRhdGVUZXN0VHlwZShyYW5kb21RdW90ZSkge1xuICAgIGxldCB0ZXN0VHlwZSA9IFwiXCI7XG4gICAgdGVzdFR5cGUgKz0gY29uZmlnXzEuZGVmYXVsdC5tb2RlO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwidGltZVwiKSB7XG4gICAgICAgIHRlc3RUeXBlICs9IFwiIFwiICsgY29uZmlnXzEuZGVmYXVsdC50aW1lO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIikge1xuICAgICAgICB0ZXN0VHlwZSArPSBcIiBcIiArIGNvbmZpZ18xLmRlZmF1bHQud29yZHM7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgIGlmIChyYW5kb21RdW90ZS5ncm91cCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0ZXN0VHlwZSArPSBcIiBcIiArIFtcInNob3J0XCIsIFwibWVkaXVtXCIsIFwibG9uZ1wiLCBcInRoaWNjXCJdW3JhbmRvbVF1b3RlLmdyb3VwXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggIT09IFwiZ2liYmVyaXNoXCIgJiZcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggIT09IFwiYXNjaWlcIiAmJlxuICAgICAgICBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCAhPT0gXCI1ODAwOFwiKSB7XG4gICAgICAgIHRlc3RUeXBlICs9IFwiPGJyPlwiICsgcmVzdWx0Lmxhbmd1YWdlLnJlcGxhY2UoL18vZywgXCIgXCIpO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbikge1xuICAgICAgICB0ZXN0VHlwZSArPSBcIjxicj5wdW5jdHVhdGlvblwiO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5udW1iZXJzKSB7XG4gICAgICAgIHRlc3RUeXBlICs9IFwiPGJyPm51bWJlcnNcIjtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlKSB7XG4gICAgICAgIHRlc3RUeXBlICs9IFwiPGJyPmJsaW5kXCI7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmxhenlNb2RlKSB7XG4gICAgICAgIHRlc3RUeXBlICs9IFwiPGJyPmxhenlcIjtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ICE9PSBcIm5vbmVcIikge1xuICAgICAgICB0ZXN0VHlwZSArPSBcIjxicj5cIiArIGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94LnJlcGxhY2UoL18vZywgXCIgXCIpO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ID09IFwiZXhwZXJ0XCIpIHtcbiAgICAgICAgdGVzdFR5cGUgKz0gXCI8YnI+ZXhwZXJ0XCI7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSA9PSBcIm1hc3RlclwiKSB7XG4gICAgICAgIHRlc3RUeXBlICs9IFwiPGJyPm1hc3RlclwiO1xuICAgIH1cbiAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnRlc3RUeXBlIC5ib3R0b21cIikuaHRtbCh0ZXN0VHlwZSk7XG59XG5mdW5jdGlvbiB1cGRhdGVPdGhlcihkaWZmaWN1bHR5RmFpbGVkLCBmYWlsUmVhc29uLCBhZmtEZXRlY3RlZCwgaXNSZXBlYXRlZCwgdG9vU2hvcnQpIHtcbiAgICBsZXQgb3RoZXJUZXh0ID0gXCJcIjtcbiAgICBpZiAoZGlmZmljdWx0eUZhaWxlZCkge1xuICAgICAgICBvdGhlclRleHQgKz0gYDxicj5mYWlsZWQgKCR7ZmFpbFJlYXNvbn0pYDtcbiAgICB9XG4gICAgaWYgKGFma0RldGVjdGVkKSB7XG4gICAgICAgIG90aGVyVGV4dCArPSBcIjxicj5hZmsgZGV0ZWN0ZWRcIjtcbiAgICB9XG4gICAgaWYgKFRlc3RTdGF0cy5pbnZhbGlkKSB7XG4gICAgICAgIG90aGVyVGV4dCArPSBcIjxicj5pbnZhbGlkXCI7XG4gICAgICAgIGxldCBleHRyYSA9IFwiXCI7XG4gICAgICAgIGlmIChyZXN1bHQud3BtIDwgMCB8fCByZXN1bHQud3BtID4gMzUwKSB7XG4gICAgICAgICAgICBleHRyYSArPSBcIndwbVwiO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXN1bHQuYWNjIDwgNzUgfHwgcmVzdWx0LmFjYyA+IDEwMCkge1xuICAgICAgICAgICAgaWYgKGV4dHJhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBleHRyYSArPSBcIiwgXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBleHRyYSArPSBcImFjY3VyYWN5XCI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGV4dHJhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIG90aGVyVGV4dCArPSBgICgke2V4dHJhfSlgO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChpc1JlcGVhdGVkKSB7XG4gICAgICAgIG90aGVyVGV4dCArPSBcIjxicj5yZXBlYXRlZFwiO1xuICAgIH1cbiAgICBpZiAocmVzdWx0LmJhaWxlZE91dCkge1xuICAgICAgICBvdGhlclRleHQgKz0gXCI8YnI+YmFpbGVkIG91dFwiO1xuICAgIH1cbiAgICBpZiAodG9vU2hvcnQpIHtcbiAgICAgICAgb3RoZXJUZXh0ICs9IFwiPGJyPnRvbyBzaG9ydFwiO1xuICAgIH1cbiAgICBpZiAob3RoZXJUZXh0ID09IFwiXCIpIHtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5pbmZvXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5pbmZvXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICBvdGhlclRleHQgPSBvdGhlclRleHQuc3Vic3RyaW5nKDQpO1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLmluZm8gLmJvdHRvbVwiKS5odG1sKG90aGVyVGV4dCk7XG4gICAgfVxufVxuZnVuY3Rpb24gdXBkYXRlUmF0ZVF1b3RlKHJhbmRvbVF1b3RlKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInF1b3RlXCIpIHtcbiAgICAgICAgY29uc3QgdXNlcnFyID0gKF9iID0gKF9hID0gREIuZ2V0U25hcHNob3QoKS5xdW90ZVJhdGluZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVtyYW5kb21RdW90ZS5sYW5ndWFnZV0pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYltyYW5kb21RdW90ZS5pZF07XG4gICAgICAgIGlmICh1c2VycXIpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Jlc3VsdCAjcmF0ZVF1b3RlQnV0dG9uIC5pY29uXCIpXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiZmFyXCIpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKFwiZmFzXCIpO1xuICAgICAgICB9XG4gICAgICAgIFF1b3RlUmF0ZVBvcHVwLmdldFF1b3RlU3RhdHMocmFuZG9tUXVvdGUpLnRoZW4oKHF1b3RlU3RhdHMpID0+IHtcbiAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICNyZXN1bHQgI3JhdGVRdW90ZUJ1dHRvbiAucmF0aW5nXCIpLnRleHQoKF9iID0gKF9hID0gcXVvdGVTdGF0cyA9PT0gbnVsbCB8fCBxdW90ZVN0YXRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBxdW90ZVN0YXRzLmF2ZXJhZ2UpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50b0ZpeGVkKDEpKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBcIlwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Jlc3VsdCAjcmF0ZVF1b3RlQnV0dG9uXCIpXG4gICAgICAgICAgICAgICAgLmNzcyh7IG9wYWNpdHk6IDAgfSlcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgICAgICAuY3NzKHsgb3BhY2l0eTogMSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy51cGRhdGVSYXRlUXVvdGUgPSB1cGRhdGVSYXRlUXVvdGU7XG5mdW5jdGlvbiB1cGRhdGVRdW90ZVNvdXJjZShyYW5kb21RdW90ZSkge1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnNvdXJjZVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5zb3VyY2UgLmJvdHRvbVwiKS5odG1sKHJhbmRvbVF1b3RlLnNvdXJjZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnNvdXJjZVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG59XG5mdW5jdGlvbiB1cGRhdGUocmVzLCBkaWZmaWN1bHR5RmFpbGVkLCBmYWlsUmVhc29uLCBhZmtEZXRlY3RlZCwgaXNSZXBlYXRlZCwgdG9vU2hvcnQsIHJhbmRvbVF1b3RlLCBkb250U2F2ZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHJlc3VsdFNjYWxlT3B0aW9ucyA9IENoYXJ0Q29udHJvbGxlci5yZXN1bHQub3B0aW9ucy5zY2FsZXM7XG4gICAgICAgIHJlc3VsdEFubm90YXRpb24gPSBbXTtcbiAgICAgICAgcmVzdWx0ID0gcmVzO1xuICAgICAgICAkKFwiI3Jlc3VsdCAjcmVzdWx0V29yZHNIaXN0b3J5XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI3JldHJ5U2F2aW5nUmVzdWx0QnV0dG9uXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiLnBhZ2VUZXN0ICNyZXN1bHQgI3JhdGVRdW90ZUJ1dHRvbiAuaWNvblwiKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiZmFzXCIpXG4gICAgICAgICAgICAuYWRkQ2xhc3MoXCJmYXJcIik7XG4gICAgICAgICQoXCIucGFnZVRlc3QgI3Jlc3VsdCAjcmF0ZVF1b3RlQnV0dG9uIC5yYXRpbmdcIikudGV4dChcIlwiKTtcbiAgICAgICAgJChcIi5wYWdlVGVzdCAjcmVzdWx0ICNyYXRlUXVvdGVCdXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjdGVzdE1vZGVzTm90aWNlXCIpLmNzcyhcIm9wYWNpdHlcIiwgMCk7XG4gICAgICAgICQoXCIjd29yZHNcIikucmVtb3ZlQ2xhc3MoXCJibHVycmVkXCIpO1xuICAgICAgICAkKFwiI3dvcmRzSW5wdXRcIikuYmx1cigpO1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnRpbWUgLmJvdHRvbSAuYWZrXCIpLnRleHQoXCJcIik7XG4gICAgICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgIT0gbnVsbCkge1xuICAgICAgICAgICAgJChcIiNyZXN1bHQgLmxvZ2luVGlwXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIiNyZXN1bHQgLmxvZ2luVGlwXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIHVwZGF0ZVdwbUFuZEFjYygpO1xuICAgICAgICB1cGRhdGVDb25zaXN0ZW5jeSgpO1xuICAgICAgICB1cGRhdGVUaW1lKCk7XG4gICAgICAgIHVwZGF0ZUtleSgpO1xuICAgICAgICB1cGRhdGVUZXN0VHlwZShyYW5kb21RdW90ZSk7XG4gICAgICAgIHVwZGF0ZVF1b3RlU291cmNlKHJhbmRvbVF1b3RlKTtcbiAgICAgICAgeWllbGQgdXBkYXRlR3JhcGgoKTtcbiAgICAgICAgeWllbGQgdXBkYXRlR3JhcGhQQkxpbmUoKTtcbiAgICAgICAgdXBkYXRlVGFncyhkb250U2F2ZSk7XG4gICAgICAgIHVwZGF0ZU90aGVyKGRpZmZpY3VsdHlGYWlsZWQsIGZhaWxSZWFzb24sIGFma0RldGVjdGVkLCBpc1JlcGVhdGVkLCB0b29TaG9ydCk7XG4gICAgICAgIENoYXJ0Q29udHJvbGxlci5yZXN1bHQub3B0aW9uc1xuICAgICAgICAgICAgLnBsdWdpbnMuYW5ub3RhdGlvbi5hbm5vdGF0aW9ucyA9XG4gICAgICAgICAgICByZXN1bHRBbm5vdGF0aW9uO1xuICAgICAgICBDaGFydENvbnRyb2xsZXIucmVzdWx0LnVwZGF0ZUNvbG9ycygpO1xuICAgICAgICBDaGFydENvbnRyb2xsZXIucmVzdWx0LnJlc2l6ZSgpO1xuICAgICAgICBpZiAoJChcIiNyZXN1bHQgLnN0YXRzIC50YWdzXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpICYmXG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLmluZm9cIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAuaW5mb0FuZFRhZ3NcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLmluZm9BbmRUYWdzXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChHbGFyc2VzTW9kZS5nZXQoKSkge1xuICAgICAgICAgICAgJChcIiNtaWRkbGUgI3Jlc3VsdCAubm9TdHJlc3NNZXNzYWdlXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgJChcIiNtaWRkbGUgI3Jlc3VsdFwiKS5wcmVwZW5kKGBcblxuICAgICAgPGRpdiBjbGFzcz0nbm9TdHJlc3NNZXNzYWdlJyBzdHlsZT1cIlxuICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICAgIGdyaWQtY29sdW1uOiAxLzM7XG4gICAgICAgIGZvbnQtc2l6ZTogMnJlbTtcbiAgICAgICAgcGFkZGluZy1ib3R0b206IDJyZW07XG4gICAgICBcIj5cbiAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLWNoZWNrXCI+PC9pPlxuICAgICAgPC9kaXY+XG5cbiAgICBgKTtcbiAgICAgICAgICAgICQoXCIjbWlkZGxlICNyZXN1bHQgLnN0YXRzXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIiNtaWRkbGUgI3Jlc3VsdCAuY2hhcnRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiI21pZGRsZSAjcmVzdWx0ICNyZXN1bHRXb3Jkc0hpc3RvcnlcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiI21pZGRsZSAjcmVzdWx0ICNyZXN1bHRSZXBsYXlcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiI21pZGRsZSAjcmVzdWx0IC5sb2dpblRpcFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIjbWlkZGxlICNyZXN1bHQgI3Nob3dXb3JkSGlzdG9yeUJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIjbWlkZGxlICNyZXN1bHQgI3dhdGNoUmVwbGF5QnV0dG9uXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIiNtaWRkbGUgI3Jlc3VsdCAjc2F2ZVNjcmVlbnNob3RCdXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgVGVzdCBDb21wbGV0ZWQ6ICR7cmVzdWx0LndwbX0gd3BtICR7cmVzdWx0LmFjY30lIGFjYyAke3Jlc3VsdC5yYXdXcG19IHJhdyAke3Jlc3VsdC5jb25zaXN0ZW5jeX0lIGNvbnNpc3RlbmN5YCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiI21pZGRsZSAjcmVzdWx0IC5zdGF0c1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIjbWlkZGxlICNyZXN1bHQgLmNoYXJ0XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgLy8gJChcIiNtaWRkbGUgI3Jlc3VsdCAjcmVzdWx0V29yZHNIaXN0b3J5XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgJChcIiNtaWRkbGUgI3Jlc3VsdCAubG9naW5UaXBcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkKFwiI21pZGRsZSAjcmVzdWx0ICNzaG93V29yZEhpc3RvcnlCdXR0b25cIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiI21pZGRsZSAjcmVzdWx0ICN3YXRjaFJlcGxheUJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIjbWlkZGxlICNyZXN1bHQgI3NhdmVTY3JlZW5zaG90QnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh3aW5kb3cuc2Nyb2xsWSA+IDApIHtcbiAgICAgICAgICAgICQoW2RvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgZG9jdW1lbnQuYm9keV0pXG4gICAgICAgICAgICAgICAgLnN0b3AoKVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHsgc2Nyb2xsVG9wOiAwIH0sIDI1MCk7XG4gICAgICAgIH1cbiAgICAgICAgTWlzYy5zd2FwRWxlbWVudHMoJChcIiN0eXBpbmdUZXN0XCIpLCAkKFwiI3Jlc3VsdFwiKSwgMjUwLCAoKSA9PiB7XG4gICAgICAgICAgICBUZXN0VUkuc2V0UmVzdWx0Q2FsY3VsYXRpbmcoZmFsc2UpO1xuICAgICAgICAgICAgJChcIiN3b3Jkc1wiKS5lbXB0eSgpO1xuICAgICAgICAgICAgQ2hhcnRDb250cm9sbGVyLnJlc3VsdC5yZXNpemUoKTtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dXb3Jkc0hpc3RvcnkgJiYgY29uZmlnXzEuZGVmYXVsdC5idXJzdEhlYXRtYXApIHtcbiAgICAgICAgICAgICAgICBUZXN0VUkuYXBwbHlCdXJzdEhlYXRtYXAoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQoXCIjcmVzdWx0XCIpLnRyaWdnZXIoXCJmb2N1c1wiKTtcbiAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbyh7IHRvcDogMCB9KTtcbiAgICAgICAgICAgICQoXCIjdGVzdE1vZGVzTm90aWNlXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9LCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdEV4dHJhQnV0dG9uc1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKS5jc3MoXCJvcGFjaXR5XCIsIDApLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICB9LCAxMjUpO1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd1dvcmRzSGlzdG9yeSAmJiAhR2xhcnNlc01vZGUuZ2V0KCkpIHtcbiAgICAgICAgICAgICAgICBUZXN0VUkudG9nZ2xlUmVzdWx0V29yZHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIEtleW1hcC5oaWRlKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBSZXN1bHRzU2hvd25FdmVudC5kaXNwYXRjaCh7XG4gICAgICAgICAgICByZXMsXG4gICAgICAgICAgICBkaWZmaWN1bHR5RmFpbGVkLFxuICAgICAgICAgICAgZmFpbFJlYXNvbixcbiAgICAgICAgICAgIGFma0RldGVjdGVkLFxuICAgICAgICAgICAgaXNSZXBlYXRlZCxcbiAgICAgICAgICAgIHRvb1Nob3J0LFxuICAgICAgICAgICAgcmFuZG9tUXVvdGUsXG4gICAgICAgICAgICBkb250U2F2ZSxcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5leHBvcnRzLnVwZGF0ZSA9IHVwZGF0ZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaXNVc2luZ09wcG9zaXRlU2hpZnQgPSBleHBvcnRzLnJlc2V0ID0gZXhwb3J0cy5yaWdodFN0YXRlID0gZXhwb3J0cy5sZWZ0U3RhdGUgPSB2b2lkIDA7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgY2Fwc193YXJuaW5nXzEgPSByZXF1aXJlKFwiLi9jYXBzLXdhcm5pbmdcIik7XG5leHBvcnRzLmxlZnRTdGF0ZSA9IGZhbHNlO1xuZXhwb3J0cy5yaWdodFN0YXRlID0gZmFsc2U7XG5sZXQgY2FzZVN0YXRlID0gZmFsc2U7XG5jb25zdCBrZXltYXBTdHJpbmdzID0ge1xuICAgIGxlZnQ6IG51bGwsXG4gICAgcmlnaHQ6IG51bGwsXG4gICAga2V5bWFwOiBudWxsLFxufTtcbmZ1bmN0aW9uIGR5bmFtaWNLZXltYXBMZWdlbmRTdHlsZSh1cHBlcmNhc2UpIHtcbiAgICBjb25zdCBrZXltYXBLZXlzID0gW1xuICAgICAgICAuLi5kb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwia2V5bWFwLWtleVwiKSxcbiAgICBdO1xuICAgIGNvbnN0IGxheW91dEtleXMgPSBrZXltYXBLZXlzLm1hcCgoZWwpID0+IGVsLmRhdGFzZXRbXCJrZXlcIl0pO1xuICAgIGNvbnN0IGtleXMgPSBrZXltYXBLZXlzLm1hcCgoZWwpID0+IGVsLmNoaWxkTm9kZXNbMV0pO1xuICAgIGlmIChjYXBzX3dhcm5pbmdfMS5jYXBzU3RhdGUpXG4gICAgICAgIHVwcGVyY2FzZSA9ICF1cHBlcmNhc2U7XG4gICAgaWYgKGxheW91dEtleXMuZmlsdGVyKCh2KSA9PiB2ID09PSB1bmRlZmluZWQpLmxlbmd0aCA+IDIpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoKHVwcGVyY2FzZSAmJiBjYXNlU3RhdGUpIHx8ICghdXBwZXJjYXNlICYmICFjYXNlU3RhdGUpKVxuICAgICAgICByZXR1cm47XG4gICAgY2FzZVN0YXRlID0gdXBwZXJjYXNlO1xuICAgIGNvbnN0IGluZGV4ID0gY2FzZVN0YXRlID8gMSA6IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsYXlvdXRLZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGxheW91dEtleSA9IGxheW91dEtleXNbaV0sIGtleSA9IGtleXNbaV07XG4gICAgICAgIGlmIChrZXkgPT09IHVuZGVmaW5lZCB8fCBsYXlvdXRLZXkgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICBrZXkudGV4dENvbnRlbnQgPSBsYXlvdXRLZXlbaW5kZXhdO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGJ1aWxkS2V5bWFwU3RyaW5ncygpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoa2V5bWFwU3RyaW5ncy5rZXltYXAgPT09IGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTGF5b3V0KVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBsYXlvdXQgPSB5aWVsZCBNaXNjLmdldExheW91dChjb25maWdfMS5kZWZhdWx0LmtleW1hcExheW91dCk7XG4gICAgICAgIGlmIChsYXlvdXQgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgbGF5b3V0S2V5cyA9IGxheW91dC5rZXlzO1xuICAgICAgICBjb25zdCBsYXlvdXRLZXlzRW50cmllcyA9IE9iamVjdC5lbnRyaWVzKGxheW91dEtleXMpO1xuICAgICAgICBrZXltYXBTdHJpbmdzLmtleW1hcCA9IGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTGF5b3V0O1xuICAgICAgICBpZiAoIWxheW91dCkge1xuICAgICAgICAgICAga2V5bWFwU3RyaW5ncy5sZWZ0ID0gbnVsbDtcbiAgICAgICAgICAgIGtleW1hcFN0cmluZ3MucmlnaHQgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAga2V5bWFwU3RyaW5ncy5sZWZ0ID0gbGF5b3V0S2V5c0VudHJpZXNcbiAgICAgICAgICAgICAgICAubWFwKChbcm93TmFtZSwgcm93XSkgPT4gcm93XG4gICAgICAgICAgICAgICAgLy8gaW5jbHVkZXMgXCI2XCIgYW5kIFwieVwiIChidXR0b25zIG9uIHF3ZXJ0eSkgaW50byB0aGUgbGVmdCBoYW5kXG4gICAgICAgICAgICAgICAgLnNsaWNlKDAsIFtcInJvdzFcIiwgXCJyb3cyXCJdLmluY2x1ZGVzKHJvd05hbWUpXG4gICAgICAgICAgICAgICAgPyByb3dOYW1lID09PSBcInJvdzFcIlxuICAgICAgICAgICAgICAgICAgICA/IDdcbiAgICAgICAgICAgICAgICAgICAgOiA2XG4gICAgICAgICAgICAgICAgOiA1KVxuICAgICAgICAgICAgICAgIC5tYXAoKGtleSkgPT4ga2V5LnNwbGl0KFwiXCIpKSlcbiAgICAgICAgICAgICAgICAuZmxhdCgyKTtcbiAgICAgICAgICAgIGtleW1hcFN0cmluZ3MucmlnaHQgPSBsYXlvdXRLZXlzRW50cmllc1xuICAgICAgICAgICAgICAgIC5tYXAoKFtyb3dOYW1lLCByb3ddKSA9PiByb3dcbiAgICAgICAgICAgICAgICAvLyBpbmNsdWRlcyBcImJcIiAoYnV0dG9ucyBvbiBxd2VydHkpIGludG8gdGhlIHJpZ2h0IGhhbmRcbiAgICAgICAgICAgICAgICAuc2xpY2UoW1wicm93MVwiLCBcInJvdzRcIl0uaW5jbHVkZXMocm93TmFtZSlcbiAgICAgICAgICAgICAgICA/IHJvd05hbWUgPT09IFwicm93MVwiXG4gICAgICAgICAgICAgICAgICAgID8gNlxuICAgICAgICAgICAgICAgICAgICA6IDRcbiAgICAgICAgICAgICAgICA6IDUpXG4gICAgICAgICAgICAgICAgLm1hcCgoa2V5KSA9PiBrZXkuc3BsaXQoXCJcIikpKVxuICAgICAgICAgICAgICAgIC5mbGF0KDIpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG4kKGRvY3VtZW50KS5vbihcImtleWRvd25cIiwgKGUpID0+IHtcbiAgICBpZiAoZS5jb2RlID09PSBcIlNoaWZ0TGVmdFwiKSB7XG4gICAgICAgIGV4cG9ydHMubGVmdFN0YXRlID0gdHJ1ZTtcbiAgICAgICAgZXhwb3J0cy5yaWdodFN0YXRlID0gZmFsc2U7XG4gICAgfVxuICAgIGVsc2UgaWYgKGUuY29kZSA9PT0gXCJTaGlmdFJpZ2h0XCIpIHtcbiAgICAgICAgZXhwb3J0cy5sZWZ0U3RhdGUgPSBmYWxzZTtcbiAgICAgICAgZXhwb3J0cy5yaWdodFN0YXRlID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTGVnZW5kU3R5bGUgPT09IFwiZHluYW1pY1wiKSB7XG4gICAgICAgIGR5bmFtaWNLZXltYXBMZWdlbmRTdHlsZShleHBvcnRzLmxlZnRTdGF0ZSB8fCBleHBvcnRzLnJpZ2h0U3RhdGUpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudCkua2V5dXAoKGUpID0+IHtcbiAgICBpZiAoZS5jb2RlID09PSBcIlNoaWZ0TGVmdFwiIHx8IGUuY29kZSA9PT0gXCJTaGlmdFJpZ2h0XCIpIHtcbiAgICAgICAgZXhwb3J0cy5sZWZ0U3RhdGUgPSBmYWxzZTtcbiAgICAgICAgZXhwb3J0cy5yaWdodFN0YXRlID0gZmFsc2U7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmtleW1hcExlZ2VuZFN0eWxlID09PSBcImR5bmFtaWNcIikge1xuICAgICAgICBkeW5hbWljS2V5bWFwTGVnZW5kU3R5bGUoZXhwb3J0cy5sZWZ0U3RhdGUgfHwgZXhwb3J0cy5yaWdodFN0YXRlKTtcbiAgICB9XG59KTtcbmZ1bmN0aW9uIHJlc2V0KCkge1xuICAgIGV4cG9ydHMubGVmdFN0YXRlID0gZmFsc2U7XG4gICAgZXhwb3J0cy5yaWdodFN0YXRlID0gZmFsc2U7XG59XG5leHBvcnRzLnJlc2V0ID0gcmVzZXQ7XG5jb25zdCBsZWZ0U2lkZUtleXMgPSBbXG4gICAgXCJLZXlRXCIsXG4gICAgXCJLZXlXXCIsXG4gICAgXCJLZXlFXCIsXG4gICAgXCJLZXlSXCIsXG4gICAgXCJLZXlUXCIsXG4gICAgXCJLZXlBXCIsXG4gICAgXCJLZXlTXCIsXG4gICAgXCJLZXlEXCIsXG4gICAgXCJLZXlGXCIsXG4gICAgXCJLZXlHXCIsXG4gICAgXCJLZXlaXCIsXG4gICAgXCJLZXlYXCIsXG4gICAgXCJLZXlDXCIsXG4gICAgXCJLZXlWXCIsXG4gICAgXCJCYWNrcXVvdGVcIixcbiAgICBcIkRpZ2l0MVwiLFxuICAgIFwiRGlnaXQyXCIsXG4gICAgXCJEaWdpdDNcIixcbiAgICBcIkRpZ2l0NFwiLFxuICAgIFwiRGlnaXQ1XCIsXG5dO1xuY29uc3QgcmlnaHRTaWRlS2V5cyA9IFtcbiAgICBcIktleVVcIixcbiAgICBcIktleUlcIixcbiAgICBcIktleU9cIixcbiAgICBcIktleVBcIixcbiAgICBcIktleUhcIixcbiAgICBcIktleUpcIixcbiAgICBcIktleUtcIixcbiAgICBcIktleUxcIixcbiAgICBcIktleU5cIixcbiAgICBcIktleU1cIixcbiAgICBcIkRpZ2l0N1wiLFxuICAgIFwiRGlnaXQ4XCIsXG4gICAgXCJEaWdpdDlcIixcbiAgICBcIkRpZ2l0MFwiLFxuICAgIFwiQmFja3NsYXNoXCIsXG4gICAgXCJCcmFja2V0TGVmdFwiLFxuICAgIFwiQnJhY2tldFJpZ2h0XCIsXG4gICAgXCJTZW1pY29sb25cIixcbiAgICBcIlF1b3RlXCIsXG4gICAgXCJDb21tYVwiLFxuICAgIFwiUGVyaW9kXCIsXG4gICAgXCJTbGFzaFwiLFxuXTtcbmZ1bmN0aW9uIGlzVXNpbmdPcHBvc2l0ZVNoaWZ0KGV2ZW50KSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCFleHBvcnRzLmxlZnRTdGF0ZSAmJiAhZXhwb3J0cy5yaWdodFN0YXRlKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm9wcG9zaXRlU2hpZnRNb2RlID09PSBcIm9uXCIpIHtcbiAgICAgICAgICAgIGlmICghcmlnaHRTaWRlS2V5cy5pbmNsdWRlcyhldmVudC5jb2RlKSAmJlxuICAgICAgICAgICAgICAgICFsZWZ0U2lkZUtleXMuaW5jbHVkZXMoZXZlbnQuY29kZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgoZXhwb3J0cy5sZWZ0U3RhdGUgJiYgcmlnaHRTaWRlS2V5cy5pbmNsdWRlcyhldmVudC5jb2RlKSkgfHxcbiAgICAgICAgICAgICAgICAoZXhwb3J0cy5yaWdodFN0YXRlICYmIGxlZnRTaWRlS2V5cy5pbmNsdWRlcyhldmVudC5jb2RlKSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm9wcG9zaXRlU2hpZnRNb2RlID09PSBcImtleW1hcFwiKSB7XG4gICAgICAgICAgICB5aWVsZCBidWlsZEtleW1hcFN0cmluZ3MoKTtcbiAgICAgICAgICAgIGlmICgha2V5bWFwU3RyaW5ncy5sZWZ0IHx8ICFrZXltYXBTdHJpbmdzLnJpZ2h0KVxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgaWYgKChleHBvcnRzLmxlZnRTdGF0ZSAmJiBrZXltYXBTdHJpbmdzLnJpZ2h0LmluY2x1ZGVzKGV2ZW50LmtleSkpIHx8XG4gICAgICAgICAgICAgICAgKGV4cG9ydHMucmlnaHRTdGF0ZSAmJiBrZXltYXBTdHJpbmdzLmxlZnQuaW5jbHVkZXMoZXZlbnQua2V5KSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuaXNVc2luZ09wcG9zaXRlU2hpZnQgPSBpc1VzaW5nT3Bwb3NpdGVTaGlmdDtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmdldFRiZE1vZGUgPSB2b2lkIDA7XG5jb25zdCB3b3Jkc2V0XzEgPSByZXF1aXJlKFwiLi93b3Jkc2V0XCIpO1xuY29uc3QgVGVzdElucHV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QtaW5wdXRcIikpO1xuY29uc3QgUGFnZUNoYW5nZUV2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9wYWdlLWNoYW5nZS1ldmVudFwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmNvbnN0IG1pc2NfMSA9IHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBDb25maWdTdHVmZiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IFJlc3VsdHNTaG93bkV2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9yZXN1bHRzLXNob3duLWV2ZW50XCIpKTtcbmNvbnN0IFdvcmRUeXBlZEV2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy93b3JkLXR5cGVkLWV2ZW50XCIpKTtcbmNvbnN0IFJlc2V0UmVxdWVzdGVkRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL3Jlc2V0LXJlcXVlc3RlZC1ldmVudFwiKSk7XG5jb25zdCBkZWJvdW5jZV8xID0gcmVxdWlyZShcIi4uL3V0aWxzL2RlYm91bmNlXCIpO1xuY2xhc3MgVGJkQ29uZmlnIHtcbiAgICBpbml0KCkge1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcInNvcnRlclNlbGVjdENoYW5nZWRcIiwgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0KFwic29ydGVyXCIsIGRhdGFbXCJ2YWx1ZVwiXSk7XG4gICAgICAgIH0pO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcImNvbmZpZ1VwZGF0ZVJlcXVlc3RlZFwiLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgc3dpdGNoIChkYXRhW1wiY29uZmlnU2V0dGluZ1wiXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJ0YXJnZXRTcGVlZFwiOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NUYXJnZXRTcGVlZFVwZGF0ZVJlcXVlc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImdyb3VwU2l6ZVwiOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NHcm91cFNpemVVcGRhdGVSZXF1ZXN0KCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJhbmltYXRpb25zXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvY2Vzc0FuaW1hdGlvblRvZ2dsZVJlcXVlc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcInVuYmVhdGVuV29yZFBlcmNlbnRhZ2VcIjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzVW5iZWF0ZW5Xb3JkUGVyY2VudGFnZVJlcXVlc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXQoa2V5LCBkZWZhdWx0VmFsdWUgPSBcIlwiKSB7XG4gICAgICAgIGNvbnN0IGNvbmZpZ0RhdGEgPSBUYmREYXRhLmdldEFsbCgpLmNvbmZpZztcbiAgICAgICAgcmV0dXJuIGNvbmZpZ0RhdGFba2V5XSB8fCBkZWZhdWx0VmFsdWU7XG4gICAgfVxuICAgIHNldChrZXksIHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IG9yaWdpbmFsID0gdGhpcy5nZXQoa2V5KTtcbiAgICAgICAgaWYgKG9yaWdpbmFsID09IHZhbHVlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGF0YSA9IFRiZERhdGEuZ2V0QWxsKCk7XG4gICAgICAgIGRhdGEuY29uZmlnW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgVGJkRGF0YS51cGRhdGVEYXRhKGRhdGEpO1xuICAgICAgICBUYmRFdmVudHMuZGlzcGF0Y2hFdmVudChgJHtrZXl9LWNoYW5nZWRgLCB7XG4gICAgICAgICAgICBvcmlnaW5hbDogb3JpZ2luYWwsXG4gICAgICAgICAgICBuZXdWYWx1ZTogdmFsdWUsXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBidW1wVGFyZ2V0U3BlZWQoKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLmdldFRhcmdldFNwZWVkKCk7XG4gICAgICAgIHRoaXMuc2V0KFwidGFyZ2V0U3BlZWRcIiwgKGN1cnJlbnQgKyA1KS50b1N0cmluZygpKTtcbiAgICB9XG4gICAgZ2V0U29ydGVyTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KFwic29ydGVyXCIsIFwiYWxwaGFiZXRpY2FsLWFzY1wiKTtcbiAgICB9XG4gICAgZ2V0U29ydGVyKCkge1xuICAgICAgICByZXR1cm4gVGJkU29ydGluZy5nZXRTb3J0ZXIodGhpcy5nZXRTb3J0ZXJOYW1lKCkpO1xuICAgIH1cbiAgICBnZXRUYXJnZXRTcGVlZCgpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KHRoaXMuZ2V0KFwidGFyZ2V0U3BlZWRcIiwgXCI3NVwiKSk7XG4gICAgfVxuICAgIGdldEdyb3VwU2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KHRoaXMuZ2V0KFwiZ3JvdXBTaXplXCIsIFwiMzBcIikpO1xuICAgIH1cbiAgICBnZXRVbmJlYXRlbldvcmRQZXJjZW50YWdlKCkge1xuICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5nZXQoXCJ1bmJlYXRlbldvcmRQZXJjZW50YWdlXCIsIFwiNjBcIikpO1xuICAgIH1cbiAgICBwcm9jZXNzVGFyZ2V0U3BlZWRVcGRhdGVSZXF1ZXN0KCkge1xuICAgICAgICBjb25zdCBuZXdTcGVlZCA9IHBhcnNlSW50KHByb21wdChcIk5ldyB0YXJnZXQgc3BlZWRcIiwgdGhpcy5nZXRUYXJnZXRTcGVlZCgpLnRvU3RyaW5nKCkpIHx8IFwiXCIpO1xuICAgICAgICBpZiAobmV3U3BlZWQgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLnNldChcInRhcmdldFNwZWVkXCIsIG5ld1NwZWVkLnRvU3RyaW5nKCkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByb2Nlc3NBbmltYXRpb25Ub2dnbGVSZXF1ZXN0KCkge1xuICAgICAgICBjb25zdCBlbmFibGVkID0gY29uZmlybShcIkNvbmZpcm0gdG8gZW5hYmxlLCBjYW5jZWwgdG8gZGlzYWJsZS5cIik7XG4gICAgICAgIGlmIChlbmFibGVkKSB7XG4gICAgICAgICAgICB0aGlzLnNldChcImFuaW1hdGlvbnNFbmFibGVkXCIsIFwiMVwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0KFwiYW5pbWF0aW9uc0VuYWJsZWRcIiwgXCIwXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFyZUFuaW1hdGlvbnNFbmFibGVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXQoXCJhbmltYXRpb25zRW5hYmxlZFwiLCBcIjFcIikgPT0gXCIxXCI7XG4gICAgfVxuICAgIHByb2Nlc3NHcm91cFNpemVVcGRhdGVSZXF1ZXN0KCkge1xuICAgICAgICBjb25zdCBuZXdTaXplID0gcGFyc2VJbnQocHJvbXB0KFwiTmV3IGdyb3VwIHNpemVcIiwgdGhpcy5nZXRHcm91cFNpemUoKS50b1N0cmluZygpKSB8fCBcIlwiKTtcbiAgICAgICAgaWYgKG5ld1NpemUgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLnNldChcImdyb3VwU2l6ZVwiLCBuZXdTaXplLnRvU3RyaW5nKCkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByb2Nlc3NVbmJlYXRlbldvcmRQZXJjZW50YWdlUmVxdWVzdCgpIHtcbiAgICAgICAgY29uc3QgbmV3UGVyY2VudGFnZSA9IHBhcnNlSW50KHByb21wdChgVGhlIG9kZHMgKHN0aWxsIHJhbmRvbSkgdGhhdCBhIHRlc3Qgd29yZCB3aWxsIGJlIG9uZSB0aGF0IGhhc24ndCBiZWVuIHR5cGVkIGZhc3RlciB0aGFuIHRoZSBjdXJyZW50IGdyb3VwIHRocmVzaG9sZC4gXG4gICAgICAgIFxuICAgICAgICBNdXN0IGJlIGJldHdlZW4gMTAtOTBgLCB0aGlzLmdldFVuYmVhdGVuV29yZFBlcmNlbnRhZ2UoKS50b1N0cmluZygpKSB8fCBcIlwiKTtcbiAgICAgICAgaWYgKGlzTmFOKG5ld1BlcmNlbnRhZ2UpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5ld1BlcmNlbnRhZ2UgPCAxMCB8fCBuZXdQZXJjZW50YWdlID4gOTApIHtcbiAgICAgICAgICAgIGFsZXJ0KGAke25ld1BlcmNlbnRhZ2V9IGlzbid0IGEgdmFsaWQgY2hvaWNlLmApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0KFwidW5iZWF0ZW5Xb3JkUGVyY2VudGFnZVwiLCBuZXdQZXJjZW50YWdlLnRvU3RyaW5nKCkpO1xuICAgIH1cbn1cbmNsYXNzIFRiZFNvcnRpbmcge1xuICAgIHN0YXRpYyBnZXRTb3J0ZXIobmFtZSkge1xuICAgICAgICBzd2l0Y2ggKG5hbWUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJhbHBoYWJldGljYWwtYXNjXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFRiZFNvcnRpbmcuYWxwaGFiZXRpY2FsQXNjZW5kaW5nU29ydGVyO1xuICAgICAgICAgICAgY2FzZSBcImFscGhhYmV0aWNhbC1kZXNjXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFRiZFNvcnRpbmcuYWxwaGFiZXRpY2FsRGVzY2VuZGluZ1NvcnRlcjtcbiAgICAgICAgICAgIGNhc2UgXCJzcGVlZC1hc2NcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gVGJkU29ydGluZy5zcGVlZEFzY2VuZGluZ1NvcnRlcjtcbiAgICAgICAgICAgIGNhc2UgXCJzcGVlZC1kZXNjXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFRiZFNvcnRpbmcuc3BlZWREZXNjZW5kaW5nU29ydGVyO1xuICAgICAgICAgICAgY2FzZSBcInR5cGVkQ291bnRcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gVGJkU29ydGluZy50eXBlZENvdW50U29ydGVyO1xuICAgICAgICAgICAgY2FzZSBcIm1pc3NlZENvdW50XCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFRiZFNvcnRpbmcubWlzc2VkQ291bnRTb3J0ZXI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFRiZFNvcnRpbmcuYWxwaGFiZXRpY2FsQXNjZW5kaW5nU29ydGVyO1xuICAgIH1cbiAgICBzdGF0aWMgcmFuZG9tU29ydGVyKCkge1xuICAgICAgICByZXR1cm4gTWF0aC5yYW5kb20oKSA8IDAuNSA/IC0xIDogMTtcbiAgICB9XG4gICAgc3RhdGljIGFscGhhYmV0aWNhbERlc2NlbmRpbmdTb3J0ZXIod29yZCwgd29yZDIpIHtcbiAgICAgICAgcmV0dXJuIHdvcmQudG9Mb3dlckNhc2UoKSA8IHdvcmQyLnRvTG93ZXJDYXNlKCkgPyAxIDogLTE7XG4gICAgfVxuICAgIHN0YXRpYyBhbHBoYWJldGljYWxBc2NlbmRpbmdTb3J0ZXIod29yZCwgd29yZDIpIHtcbiAgICAgICAgcmV0dXJuIHdvcmQudG9Mb3dlckNhc2UoKSA8IHdvcmQyLnRvTG93ZXJDYXNlKCkgPyAtMSA6IDE7XG4gICAgfVxuICAgIHN0YXRpYyBzcGVlZEFzY2VuZGluZ1NvcnRlcih3b3JkLCB3b3JkMikge1xuICAgICAgICBjb25zdCBzcGVlZDEgPSBUYmREYXRhLmdldE1lZGlhblNwZWVkRm9yV29yZCh3b3JkKTtcbiAgICAgICAgY29uc3Qgc3BlZWQyID0gVGJkRGF0YS5nZXRNZWRpYW5TcGVlZEZvcldvcmQod29yZDIpO1xuICAgICAgICByZXR1cm4gc3BlZWQxIC0gc3BlZWQyO1xuICAgIH1cbiAgICBzdGF0aWMgc3BlZWREZXNjZW5kaW5nU29ydGVyKHdvcmQsIHdvcmQyKSB7XG4gICAgICAgIGNvbnN0IHNwZWVkMSA9IFRiZERhdGEuZ2V0TWVkaWFuU3BlZWRGb3JXb3JkKHdvcmQpO1xuICAgICAgICBjb25zdCBzcGVlZDIgPSBUYmREYXRhLmdldE1lZGlhblNwZWVkRm9yV29yZCh3b3JkMik7XG4gICAgICAgIHJldHVybiBzcGVlZDIgLSBzcGVlZDE7XG4gICAgfVxuICAgIHN0YXRpYyB0eXBlZENvdW50U29ydGVyKHdvcmQsIHdvcmQyKSB7XG4gICAgICAgIGNvbnN0IHR5cGVkMSA9IFRiZERhdGEuZ2V0U3BlZWRzRm9yV29yZCh3b3JkKS5sZW5ndGg7XG4gICAgICAgIGNvbnN0IHR5cGVkMiA9IFRiZERhdGEuZ2V0U3BlZWRzRm9yV29yZCh3b3JkMikubGVuZ3RoO1xuICAgICAgICByZXR1cm4gdHlwZWQyIC0gdHlwZWQxO1xuICAgIH1cbiAgICBzdGF0aWMgbWlzc2VkQ291bnRTb3J0ZXIod29yZCwgd29yZDIpIHtcbiAgICAgICAgcmV0dXJuIChUYmREYXRhLmdldE1pc3R5cGVkQ291bnRGb3JXb3JkKHdvcmQyKSAtXG4gICAgICAgICAgICBUYmREYXRhLmdldE1pc3R5cGVkQ291bnRGb3JXb3JkKHdvcmQpKTtcbiAgICB9XG59XG5jbGFzcyBUYmRNb2RlIHtcbiAgICBjb25zdHJ1Y3Rvcihjb25maWcpIHtcbiAgICAgICAgdGhpcy5wcmV2aW91c1dvcmQgPSBcIlwiO1xuICAgICAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICAgICAgdGhpcy5tb25rZXlUeXBlV29yZHNldCA9IG5ldyB3b3Jkc2V0XzEuV29yZHNldChbXSk7XG4gICAgICAgIHRoaXMuY3VycmVudEdyb3VwID0gbmV3IFRiZEdyb3VwKHRoaXMubW9ua2V5VHlwZVdvcmRzZXQpO1xuICAgICAgICB0aGlzLmdyb3VwcyA9IG5ldyBUYmRHcm91cHMoKTtcbiAgICB9XG4gICAgaW5pdCgpIHtcbiAgICAgICAgV29yZFR5cGVkRXZlbnQuc3Vic2NyaWJlKHRoaXMuaGFuZGxlV29yZFR5cGVkLmJpbmQodGhpcykpO1xuICAgICAgICBSZXN1bHRzU2hvd25FdmVudC5zdWJzY3JpYmUodGhpcy5oYW5kbGVSZXN1bHRzU2hvd25FdmVudC5iaW5kKHRoaXMpKTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJyZXNldEJ1dHRvbkNsaWNrZWRcIiwgdGhpcy5yZXNldEN1cnJlbnRXb3Jkcy5iaW5kKHRoaXMpKTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJ3b3JkQ2xpY2tlZFwiLCB0aGlzLnJlc2V0V29yZC5iaW5kKHRoaXMpKTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJ0YXJnZXRTcGVlZC1jaGFuZ2VkXCIsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVnZW5lcmF0ZUdyb3Vwc0Zyb21Xb3Jkc2V0KHRoaXMubW9ua2V5VHlwZVdvcmRzZXQpO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJncm91cFNpemUtY2hhbmdlZFwiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJlZ2VuZXJhdGVHcm91cHNGcm9tV29yZHNldCh0aGlzLm1vbmtleVR5cGVXb3Jkc2V0KTtcbiAgICAgICAgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwid29yZHNSZXNldFwiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJlZ2VuZXJhdGVHcm91cHNGcm9tV29yZHNldCh0aGlzLm1vbmtleVR5cGVXb3Jkc2V0KTtcbiAgICAgICAgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwibmV4dEdyb3VwXCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRHcm91cCA9IGRhdGFbXCJncm91cFwiXTtcbiAgICAgICAgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwiZ3JvdXBzUmVnZW5lcmF0ZWRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgUmVzZXRSZXF1ZXN0ZWRFdmVudC5kaXNwYXRjaCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJhY3Rpb25CdXR0b25DbGlja2VkXCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKGRhdGFbXCJhY3Rpb25WYWx1ZVwiXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJyZXNldEN1cnJlbnRXb3Jkc1wiOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc2V0Q3VycmVudFdvcmRzUmVxdWVzdCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwicmVzZXRBbGxXb3Jkc1wiOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc2V0QWxsV29yZHNSZXF1ZXN0KCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJjb3B5QWxsRGF0YVwiOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUNvcHlEYXRhUmVxdWVzdCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiaW1wb3J0RGF0YVwiOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUltcG9ydERhdGFSZXF1ZXN0KCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgaGFuZGxlV29yZFR5cGVkKF93b3JkLCBpc0NvcnJlY3QsIGJ1cnN0LCBjdXJyZW50V29yZEVsZW1lbnQpIHtcbiAgICAgICAgaWYgKCFpc0NvcnJlY3QpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB3b3JkRWxlbWVudCA9IGN1cnJlbnRXb3JkRWxlbWVudDtcbiAgICAgICAgY29uc3QgdHlwZWRBYm92ZVRhcmdldCA9IGJ1cnN0ID4gdGhpcy5nZXRDb25maWcoKS5nZXRUYXJnZXRTcGVlZCgpO1xuICAgICAgICBpZiAodHlwZWRBYm92ZVRhcmdldCkge1xuICAgICAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJ3b3JkVHlwZWRDb3JyZWN0bHlcIiwgeyB3b3JkRWxlbWVudCB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIFRiZEV2ZW50cy5kaXNwYXRjaEV2ZW50KFwid29yZE1pc3NlZFwiLCB7IHdvcmRFbGVtZW50IH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZVJlc2V0Q3VycmVudFdvcmRzUmVxdWVzdCgpIHtcbiAgICAgICAgaWYgKGNvbmZpcm0oXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gcmVzZXQgZGF0YSBmb3IgdGhlIGN1cnJlbnQgd29yZHNldD8gVGhpcyBpbmNsdWRlcyBhbGxcIiArXG4gICAgICAgICAgICBcIiB3b3JkcyBpbiB0aGUgbGFuZ3VhZ2Ugb3IgY3VzdG9tIHdvcmQgc2V0IHlvdSBhcmUgdXNpbmcsIG5vdCBqdXN0IHRoZSBjdXJyZW50IGdyb3VwIVwiKSkge1xuICAgICAgICAgICAgVGJkRGF0YS5yZXNldERhdGFGb3JXb3Jkcyh0aGlzLm1vbmtleVR5cGVXb3Jkc2V0LndvcmRzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBoYW5kbGVDb3B5RGF0YVJlcXVlc3QoKSB7XG4gICAgICAgIG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KEpTT04uc3RyaW5naWZ5KFRiZERhdGEuZ2V0QWxsKCkpKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIGFsZXJ0KFwiSlNPTiBjb3BpZWQgdG8geW91ciBjbGlwYm9hcmRcIik7XG4gICAgICAgIH0sICgpID0+IHtcbiAgICAgICAgICAgIGFsZXJ0KFwiVGhlcmUgd2FzIGEgcHJvYmxlbSBjb3B5aW5nIHRoZSBkYXRhIHRvIHlvdXIgY2xpcGJvYXJkXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaGFuZGxlSW1wb3J0RGF0YVJlcXVlc3QoKSB7XG4gICAgICAgIGNvbnN0IGV4cG9ydEpzb24gPSBwcm9tcHQoXCJFbnRlciB0aGUgSlNPTiB5b3UgZ290IGZyb20gYW4gZXhwb3J0IGhlcmVcIikgfHwgXCJcIjtcbiAgICAgICAgaWYgKGV4cG9ydEpzb24gPT0gXCJcIikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UoZXhwb3J0SnNvbik7XG4gICAgICAgIGlmIChcIndvcmRzXCIgaW4gcGFyc2VkICYmIFwiY29uZmlnXCIgaW4gcGFyc2VkKSB7XG4gICAgICAgICAgICBUYmREYXRhLnVwZGF0ZURhdGEocGFyc2VkLCB0cnVlKTtcbiAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYWxlcnQoXCJUaGVyZSB3YXMgc29tZXRoaW5nIHdyb25nIHdpdGggeW91ciBKU09OLCBzb3JyeSFcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0Q29uZmlnKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25maWc7XG4gICAgfVxuICAgIGdldFdvcmQob3JpZ2luYWxXb3Jkc2V0KSB7XG4gICAgICAgIHRoaXMuaGFuZGxlV29yZHNldEZvck5leHRXb3JkKG9yaWdpbmFsV29yZHNldCk7XG4gICAgICAgIGNvbnN0IGdyb3VwID0gdGhpcy5nZXRDdXJyZW50R3JvdXAoKTtcbiAgICAgICAgY29uc3QgcmFuZG9tID0gTWF0aC5yYW5kb20oKSAqIDEwMDtcbiAgICAgICAgY29uc3QgdW5iZWF0ZW5Xb3Jkc2V0ID0gZ3JvdXAuZ2V0VW5iZWF0ZW5Xb3Jkc2V0KCk7XG4gICAgICAgIGNvbnN0IGlzVGhlcmVNb3JlVGhhbk9uZVdvcmQgPSBncm91cC5nZXRXb3Jkc2V0KCkubGVuZ3RoID4gMTtcbiAgICAgICAgbGV0IG5leHRXb3JkO1xuICAgICAgICBpZiAodW5iZWF0ZW5Xb3Jkc2V0Lmxlbmd0aCA+IDAgJiZcbiAgICAgICAgICAgIHJhbmRvbSA8PSB0aGlzLmdldENvbmZpZygpLmdldFVuYmVhdGVuV29yZFBlcmNlbnRhZ2UoKSkge1xuICAgICAgICAgICAgbmV4dFdvcmQgPSB1bmJlYXRlbldvcmRzZXQucmFuZG9tV29yZCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbmV4dFdvcmQgPSBncm91cC5nZXRXb3Jkc2V0KCkucmFuZG9tV29yZCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnByZXZpb3VzV29yZCA9PSBuZXh0V29yZCAmJiBpc1RoZXJlTW9yZVRoYW5PbmVXb3JkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRXb3JkKG9yaWdpbmFsV29yZHNldCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wcmV2aW91c1dvcmQgPSBuZXh0V29yZDtcbiAgICAgICAgcmV0dXJuIG5leHRXb3JkO1xuICAgIH1cbiAgICBnZXRDdXJyZW50R3JvdXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRHcm91cDtcbiAgICB9XG4gICAgZ2V0Rmlyc3RJbmNvbXBsZXRlR3JvdXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyb3Vwcy5nZXRGaXJzdEluY29tcGxldGVHcm91cCh0aGlzLmNvbmZpZy5nZXRUYXJnZXRTcGVlZCgpKTtcbiAgICB9XG4gICAgcmVjYWxjdWxhdGVDdXJyZW50R3JvdXAoKSB7XG4gICAgICAgIGlmICh0aGlzLmdldEN1cnJlbnRHcm91cCgpLmdldFVuYmVhdGVuV29yZHNldCgpLmxlbmd0aCA+IDAgJiZcbiAgICAgICAgICAgIHRoaXMuZ2V0Q3VycmVudEdyb3VwKCkuZ2V0VGhyZXNob2xkKCkgPD0gdGhpcy5nZXRDb25maWcoKS5nZXRUYXJnZXRTcGVlZCgpKSB7XG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuZ3JvdXBzLmdldEdyb3VwcygpLmluZGV4T2YodGhpcy5nZXRDdXJyZW50R3JvdXAoKSk7XG4gICAgICAgICAgICBUYmRFdmVudHMuZGlzcGF0Y2hFdmVudChcIm5leHRHcm91cFwiLCB7XG4gICAgICAgICAgICAgICAgZ3JvdXA6IHRoaXMuZ2V0Q3VycmVudEdyb3VwKCksXG4gICAgICAgICAgICAgICAgZ3JvdXBOdW1iZXI6IGluZGV4ICsgMSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGxldCBuZXh0ID0gdGhpcy5nZXRGaXJzdEluY29tcGxldGVHcm91cCgpO1xuICAgICAgICB3aGlsZSAobmV4dCA9PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLmdldENvbmZpZygpLmJ1bXBUYXJnZXRTcGVlZCgpOyAvLyBzaWRlIGVmZmVjdHMsIHJlZ2VuZXJhdGVzIGFsbCBncm91cHNcbiAgICAgICAgICAgIG5leHQgPSB0aGlzLmdldEZpcnN0SW5jb21wbGV0ZUdyb3VwKCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmdyb3Vwcy5nZXRHcm91cHMoKS5pbmRleE9mKHRoaXMuY3VycmVudEdyb3VwKTtcbiAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJuZXh0R3JvdXBcIiwge1xuICAgICAgICAgICAgZ3JvdXA6IG5leHQsXG4gICAgICAgICAgICBncm91cE51bWJlcjogaW5kZXggKyAxLFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0TW9ua2V5VHlwZVdvcmRzZXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1vbmtleVR5cGVXb3Jkc2V0O1xuICAgIH1cbiAgICBoYW5kbGVXb3Jkc2V0Rm9yTmV4dFdvcmQod29yZHNldCkge1xuICAgICAgICBpZiAodGhpcy5tb25rZXlUeXBlV29yZHNldC5sZW5ndGggIT0gd29yZHNldC5sZW5ndGggJiZcbiAgICAgICAgICAgIHdvcmRzZXQud29yZHMuam9pbihcIiRcIikgIT0gdGhpcy5tb25rZXlUeXBlV29yZHNldC53b3Jkcy5qb2luKFwiJFwiKSkge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVOZXdXb3Jkc2V0KHdvcmRzZXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZU5ld1dvcmRzZXQod29yZHNldCkge1xuICAgICAgICB0aGlzLm1vbmtleVR5cGVXb3Jkc2V0ID0gd29yZHNldDtcbiAgICAgICAgdGhpcy5yZWdlbmVyYXRlR3JvdXBzRnJvbVdvcmRzZXQod29yZHNldCk7XG4gICAgfVxuICAgIHJlZ2VuZXJhdGVHcm91cHNGcm9tV29yZHNldCh3b3Jkc2V0KSB7XG4gICAgICAgIGNvbnN0IG5vdEFib3ZlVGFyZ2V0U3BlZWQgPSB3b3Jkc2V0LndvcmRzLmZpbHRlcigod29yZCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuICFUYmREYXRhLmhhc1dvcmRCZWVuVHlwZWRGYXN0ZXJUaGFuKHdvcmQsIHRoaXMuY29uZmlnLmdldFRhcmdldFNwZWVkKCkpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgdW5pcXVlQmVsb3dUYXJnZXQgPSBuZXcgU2V0KG5vdEFib3ZlVGFyZ2V0U3BlZWQpO1xuICAgICAgICBpZiAodW5pcXVlQmVsb3dUYXJnZXQuc2l6ZSA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmdldENvbmZpZygpLmJ1bXBUYXJnZXRTcGVlZCgpO1xuICAgICAgICAgICAgLy8gQnVtcGluZyB0aGUgdGFyZ2V0IHRyaWdnZXJzIGEgcmVnZW5lcmF0aW9uIG9mIGdyb3VwcyBhbmQgaW5maW5pdGUgbG9vcHMgYXJlIG5vIGZ1blxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZ3JvdXBzLnJlZ2VuZXJhdGVHcm91cHMoQXJyYXkuZnJvbSh1bmlxdWVCZWxvd1RhcmdldCksIHRoaXMuY29uZmlnLmdldEdyb3VwU2l6ZSgpKTtcbiAgICB9XG4gICAgaGFuZGxlUmVzdWx0c1Nob3duRXZlbnQocmVzdWx0cykge1xuICAgICAgICBpZiAoIXJlc3VsdHMuZGlmZmljdWx0eUZhaWxlZCkge1xuICAgICAgICAgICAgdGhpcy5zYXZlQnVyc3RzRnJvbUxhdGVzdFJlc3VsdHMoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNhdmVNaXNzZXNGcm9tTGF0ZXN0UmVzdWx0KCk7XG4gICAgICAgIHRoaXMucmVjYWxjdWxhdGVDdXJyZW50R3JvdXAoKTtcbiAgICAgICAgdGhpcy5nZXRDdXJyZW50R3JvdXAoKS5pbmNyZWFzZVRocmVzaG9sZFVudGlsU29tZVdvcmRzQXJlVW5iZWF0ZW4oKTtcbiAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJyZXN1bHRzUHJvY2Vzc2VkXCIsIHtcbiAgICAgICAgICAgIGN1cnJlbnRHcm91cDogdGhpcy5nZXRDdXJyZW50R3JvdXAoKSxcbiAgICAgICAgICAgIG1vbmtleVR5cGVXb3Jkc2V0OiB0aGlzLm1vbmtleVR5cGVXb3Jkc2V0LFxuICAgICAgICAgICAgdGFyZ2V0U3BlZWQ6IHRoaXMuY29uZmlnLmdldFRhcmdldFNwZWVkKCksXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzYXZlQnVyc3RzRnJvbUxhdGVzdFJlc3VsdHMoKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdFdvcmRzID0gVGVzdElucHV0LmlucHV0Lmhpc3Rvcnk7XG4gICAgICAgIGNvbnN0IHJlc3VsdEJ1cnN0cyA9IFRlc3RJbnB1dC5idXJzdEhpc3Rvcnk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVzdWx0V29yZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHdvcmQgPSByZXN1bHRXb3Jkc1tpXTtcbiAgICAgICAgICAgIGNvbnN0IGJ1cnN0ID0gcmVzdWx0QnVyc3RzW2ldO1xuICAgICAgICAgICAgVGJkRGF0YS5hZGRCdXJzdCh3b3JkLCBidXJzdCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVzZXRDdXJyZW50V29yZHMoKSB7XG4gICAgICAgIGlmICghY29uZmlybShcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byByZXNldCB0aGUgc3RhdHMgZm9yIHRoZSBjdXJyZW50IHdvcmRzP1wiKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIFRiZERhdGEucmVzZXREYXRhRm9yV29yZHModGhpcy5tb25rZXlUeXBlV29yZHNldC53b3Jkcyk7XG4gICAgfVxuICAgIHJlc2V0V29yZChkYXRhKSB7XG4gICAgICAgIGNvbnN0IHdvcmQgPSBkYXRhW1wid29yZFwiXTtcbiAgICAgICAgaWYgKCFjb25maXJtKGBSZXNldCBhbGwgZGF0YSBmb3IgJHt3b3JkfT9gKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIFRiZERhdGEucmVzZXREYXRhRm9yV29yZCh3b3JkKTtcbiAgICB9XG4gICAgc2F2ZU1pc3Nlc0Zyb21MYXRlc3RSZXN1bHQoKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKFRlc3RJbnB1dC5taXNzZWRXb3JkcykuZm9yRWFjaCgod29yZCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbWlzc2VkQ291bnQgPSBUZXN0SW5wdXQubWlzc2VkV29yZHNbd29yZF07XG4gICAgICAgICAgICBUYmREYXRhLmFkZFRvTWlzc2VkQ291bnQod29yZCwgbWlzc2VkQ291bnQpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaGFuZGxlUmVzZXRBbGxXb3Jkc1JlcXVlc3QoKSB7XG4gICAgICAgIGxldCBjb25maXJtYXRpb25Xb3JkID0gXCJkZWxldGVcIjtcbiAgICAgICAgbGV0IHNsb3dlc3RTcGVlZCA9IDEwMDA7XG4gICAgICAgIGNvbnN0IGFsbERhdGEgPSBUYmREYXRhLmdldEFsbCgpO1xuICAgICAgICBPYmplY3Qua2V5cyhhbGxEYXRhLndvcmRzKVxuICAgICAgICAgICAgLmZpbHRlcigod29yZCkgPT4gVGJkRGF0YS5nZXRNZWRpYW5TcGVlZEZvcldvcmQod29yZCkgPiAwKVxuICAgICAgICAgICAgLmZvckVhY2goKHdvcmQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1lZGlhbiA9IFRiZERhdGEuZ2V0TWVkaWFuU3BlZWRGb3JXb3JkKHdvcmQpO1xuICAgICAgICAgICAgaWYgKG1lZGlhbiA+IDAgJiZcbiAgICAgICAgICAgICAgICBtZWRpYW4gPCBzbG93ZXN0U3BlZWQgJiZcbiAgICAgICAgICAgICAgICB3b3JkLmxlbmd0aCA+PSBjb25maXJtYXRpb25Xb3JkLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGNvbmZpcm1hdGlvbldvcmQgPSB3b3JkO1xuICAgICAgICAgICAgICAgIHNsb3dlc3RTcGVlZCA9IG1lZGlhbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGNvbmZpcm1hdGlvblN0cmluZyA9IGAke2NvbmZpcm1hdGlvbldvcmR9ICR7Y29uZmlybWF0aW9uV29yZH0gJHtjb25maXJtYXRpb25Xb3JkfWA7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gcHJvbXB0KGBUaGlzIHdpbGwgZGVsZXRlIEFMTCB5b3VyIHdvcmQgZGF0YS4gVG8gY29uZmlybSwgdHlwZTogJHtjb25maXJtYXRpb25TdHJpbmd9YCk7XG4gICAgICAgIGlmIChyZXNwb25zZSA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlc3BvbnNlID09IGNvbmZpcm1hdGlvblN0cmluZykge1xuICAgICAgICAgICAgYWxsRGF0YS53b3JkcyA9IHt9O1xuICAgICAgICAgICAgVGJkRGF0YS51cGRhdGVEYXRhKGFsbERhdGEsIHRydWUpO1xuICAgICAgICAgICAgYWxlcnQoXCJPayEgWW91ciBkYXRhIGhhcyBiZWVuIGRlbGV0ZWQgYW5kIHlvdSdyZSBzdGFydGluZyBvdmVyIGZyb20gc2NyYXRjaC5cIik7XG4gICAgICAgICAgICAvLyBMYXp5LCBJIGtub3dcbiAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYWxlcnQoYEdvb2QgZWZmb3J0LCBidXQgeW91IHR5cGVkIFxuICAgICAgICBcbiAgICAgICAgJyR7cmVzcG9uc2V9JyBcbiAgICAgICAgXG4gICAgICAgIGluc3RlYWQgb2YgXG4gICAgICAgIFxuICAgICAgICAnJHtjb25maXJtYXRpb25TdHJpbmd9JyBcbiAgICAgICAgXG4gICAgICAgIE5vIHJlc2V0IGZvciB5b3UhYCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5jbGFzcyBUYmRVSSB7XG4gICAgY29uc3RydWN0b3IodGJkTW9kZSkge1xuICAgICAgICB0aGlzLiRncm91cFRocmVzaG9sZCA9ICQoXCIjdGJkTW9kZUdyb3VwVGhyZXNob2xkXCIpO1xuICAgICAgICB0aGlzLiR0YmRNb2RlR3JvdXBDb3VudCA9ICQoXCIjdGJkTW9kZUdyb3VwQ291bnRcIik7XG4gICAgICAgIHRoaXMuJHdvcmRJbmZvID0gJChcIiN0YmRNb2RlV29yZEluZm9cIik7XG4gICAgICAgIHRoaXMuJHdvcmRzRGl2ID0gJChcIiN0YmRtb2RlSW5mbyAud29yZHNDb250YWluZXIgLndvcmRzXCIpO1xuICAgICAgICB0aGlzLiRwcm9ncmVzc01ldGVyVG90YWwgPSAkKFwiI3RiZG1vZGVJbmZvIC5wcm9ncmVzc01ldGVyVG90YWxcIik7XG4gICAgICAgIHRoaXMuJHRhcmdldFRocmVzaG9sZCA9ICQoXCIjdGJkTW9kZVRhcmdldFRocmVzaG9sZFwiKTtcbiAgICAgICAgdGhpcy4kcHJvZ3Jlc3NNZXRlckdyb3VwID0gJChcIiN0YmRtb2RlSW5mbyAucHJvZ3Jlc3NNZXRlckdyb3VwXCIpO1xuICAgICAgICB0aGlzLiR0YmRNb2RlSW5mbyA9ICQoXCIjdGJkbW9kZUluZm9cIik7XG4gICAgICAgIHRoaXMuJHRiZE1vZGVIZWxwQnV0dG9uID0gJChcIi50YmRNb2RlSGVscEJ1dHRvblwiKTtcbiAgICAgICAgdGhpcy4kdGJkTW9kZUhlbHAgPSAkKFwiI3RiZEhlbHBcIik7XG4gICAgICAgIHRoaXMuJHRiZEJlYXRlbkV4YW1wbGUgPSAkKFwiLnRiZEJlYXRlbkV4YW1wbGVcIik7XG4gICAgICAgIHRoaXMuJHRiZExvc3RFeGFtcGxlID0gJChcIi50YmRMb3N0RXhhbXBsZVwiKTtcbiAgICAgICAgdGhpcy4kdGJkTW9kZUFjdGlvbnNTZWxlY3QgPSAkKFwiI3RiZE1vZGVBY3Rpb25zU2VsZWN0XCIpO1xuICAgICAgICB0aGlzLiR0YmRNb2RlQWN0aW9uc0J1dHRvbiA9ICQoXCIjdGJkTW9kZUFjdGlvbkJ1dHRvblwiKTtcbiAgICAgICAgdGhpcy4kdGJkTW9kZUNvbmZpZ1NldHRpbmdzU2VsZWN0ID0gJChcIiN0YmRNb2RlQ29uZmlnU2V0dGluZ3NcIik7XG4gICAgICAgIHRoaXMuJHRiZE1vZGVDb25maWdTZXR0aW5nc1VwZGF0ZUJ1dHRvbiA9ICQoXCIjdGJkTW9kZVVwZGF0ZUNvbmZpZ1NldHRpbmdzVXBkYXRlQnV0dG9uXCIpO1xuICAgICAgICB0aGlzLiRzb3J0ZXJTZWxlY3QgPSAkKFwiI3RiZE1vZGVTb3J0ZXJTZWxlY3RcIik7XG4gICAgICAgIHRoaXMuY3VycmVudGx5QW5pbWF0aW5nID0gW107XG4gICAgICAgIHRoaXMuJHRiZE1vZGVHcm91cE51bWJlciA9ICQoXCIjdGJkTW9kZUN1cnJlbnRHcm91cE51bWJlclwiKTtcbiAgICAgICAgdGhpcy50YmRNb2RlID0gdGJkTW9kZTtcbiAgICAgICAgY29uc3Qgd29yZHNDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInRiZE1vZGVXb3Jkc0NvbnRhaW5lclwiKTtcbiAgICAgICAgaWYgKCEod29yZHNDb250YWluZXIgaW5zdGFuY2VvZiBIVE1MRGl2RWxlbWVudCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBsb2NhdGUgVEJEIHdvcmRzIGNvbnRhaW5lclwiKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLndvcmRzQ29udGFpbmVyID0gd29yZHNDb250YWluZXI7XG4gICAgICAgIHRoaXMuJHdvcmRJbmZvLmhpZGUoKTtcbiAgICAgICAgdGhpcy4kdGJkTW9kZUluZm8uaGlkZSgpO1xuICAgIH1cbiAgICBpbml0KCkge1xuICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoXCJ0YmRNb2RlXCIpO1xuICAgICAgICB0aGlzLiR0YmRNb2RlSW5mby5zaG93KDMwMCk7XG4gICAgICAgIFBhZ2VDaGFuZ2VFdmVudC5zdWJzY3JpYmUodGhpcy5wYWdlQ2hhbmdlSGFuZGxlci5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy53b3Jkc0NvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHRoaXMudXBkYXRlV29yZEluZm8uYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMud29yZHNDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuaGFuZGxlV29yZENsaWNrZWQuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMud29yZHNDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHdvcmRJbmZvLmhpZGUoMCk7XG4gICAgICAgIH0pO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcIndvcmRUeXBlZENvcnJlY3RseVwiLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgZGF0YVtcIndvcmRFbGVtZW50XCJdXG4gICAgICAgICAgICAgICAgLmNoaWxkcmVuKFwibGV0dGVyXCIpXG4gICAgICAgICAgICAgICAgLmVhY2goKF9pbmRleCwgZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYW5pbWF0ZShlbGVtZW50LCBcInRiZEJlYXRlblwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJ3b3JkTWlzc2VkXCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICBkYXRhW1wid29yZEVsZW1lbnRcIl0uYWRkQ2xhc3MoXCJ0YmRMb3dPcGFjaXR5XCIpO1xuICAgICAgICAgICAgdGhpcy5hbmltYXRlKGRhdGFbXCJ3b3JkRWxlbWVudFwiXVswXSwgXCJ0YmRMb3N0XCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJncm91cFRocmVzaG9sZENoYW5nZWRcIiwgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIHRoaXMuJGdyb3VwVGhyZXNob2xkLnRleHQoZGF0YVtcInRocmVzaG9sZFwiXSk7XG4gICAgICAgIH0pO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcInJlc3VsdHNQcm9jZXNzZWRcIiwgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGdyb3VwID0gZGF0YVtcImN1cnJlbnRHcm91cFwiXTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlVWlXb3Jkcyhncm91cC5nZXRXb3Jkc2V0KCkud29yZHMpO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJyZXN1bHRzUHJvY2Vzc2VkXCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVRvdGFsUHJvZ3Jlc3NNZXRlcihkYXRhW1wibW9ua2V5VHlwZVdvcmRzZXRcIl0sIGRhdGFbXCJ0YXJnZXRTcGVlZFwiXSk7XG4gICAgICAgIH0pO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcInJlc3VsdHNQcm9jZXNzZWRcIiwgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlR3JvdXBQcm9ncmVzc01ldGVyKGRhdGFbXCJjdXJyZW50R3JvdXBcIl0sIGRhdGFbXCJ0YXJnZXRTcGVlZFwiXSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLiRzb3J0ZXJTZWxlY3Qub24oXCJjaGFuZ2VcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBpZiAoIShldmVudC50YXJnZXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBUYmRFdmVudHMuZGlzcGF0Y2hFdmVudChcInNvcnRlclNlbGVjdENoYW5nZWRcIiwge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBldmVudC50YXJnZXQudmFsdWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwic29ydGVyLWNoYW5nZWRcIiwgdGhpcy5oYW5kbGVTb3J0ZXJDaGFuZ2UuYmluZCh0aGlzKSk7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwibmV4dEdyb3VwXCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBncm91cCA9IGRhdGFbXCJncm91cFwiXTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlVWlXb3Jkcyhncm91cC5nZXRXb3Jkc2V0KCkud29yZHMpO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJuZXh0R3JvdXBcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVHcm91cFByb2dyZXNzTWV0ZXIodGhpcy50YmRNb2RlLmdldEN1cnJlbnRHcm91cCgpLCB0aGlzLnRiZE1vZGUuZ2V0Q29uZmlnKCkuZ2V0VGFyZ2V0U3BlZWQoKSk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVRvdGFsUHJvZ3Jlc3NNZXRlcih0aGlzLnRiZE1vZGUuZ2V0TW9ua2V5VHlwZVdvcmRzZXQoKSwgdGhpcy50YmRNb2RlLmdldENvbmZpZygpLmdldFRhcmdldFNwZWVkKCkpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gQ2FuJ3QgdXNlIHRhcmdldFNwZWVkLWNoYW5nZWQgYmVjYXVzZSBvZiBzdHVwaWQgcmVjdXJzaXZlIHdheSBvZlxuICAgICAgICAvLyBhdXRvIGJ1bXBpbmcgdGhyZXNob2xkIHRvIGVuc3VyZSB0aGVyZSBhcmUgYWx3YXlzIGdyb3Vwc1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcIm5leHRHcm91cFwiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLiR0YXJnZXRUaHJlc2hvbGQudGV4dCh0aGlzLnRiZE1vZGUuZ2V0Q29uZmlnKCkuZ2V0VGFyZ2V0U3BlZWQoKS50b1N0cmluZygpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuJHRiZE1vZGVIZWxwQnV0dG9uLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy4kdGJkTW9kZUhlbHAudG9nZ2xlKDI1MCk7XG4gICAgICAgICAgICB0aGlzLiR3b3Jkc0Rpdi50b2dnbGUoMjUwKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuJHRiZEJlYXRlbkV4YW1wbGUub24oXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0ZShldmVudC50YXJnZXQsIFwidGJkQmVhdGVuXCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy4kdGJkTG9zdEV4YW1wbGUub24oXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0ZShldmVudC50YXJnZXQsIFwidGJkTG9zdFwiKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuJHRhcmdldFRocmVzaG9sZC50ZXh0KHRoaXMudGJkTW9kZS5nZXRDb25maWcoKS5nZXRUYXJnZXRTcGVlZCgpKTtcbiAgICAgICAgdGhpcy4kZ3JvdXBUaHJlc2hvbGQudGV4dCh0aGlzLnRiZE1vZGUuZ2V0Q3VycmVudEdyb3VwKCkuZ2V0VGhyZXNob2xkKCkpO1xuICAgICAgICB0aGlzLiR0YmRNb2RlQ29uZmlnU2V0dGluZ3NVcGRhdGVCdXR0b24ub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3RWYWx1ZSA9IHRoaXMuJHRiZE1vZGVDb25maWdTZXR0aW5nc1NlbGVjdC52YWwoKTtcbiAgICAgICAgICAgIGlmIChzZWxlY3RWYWx1ZSA9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoXCJTZWxlY3QgYW4gb3B0aW9uIGZyb20gdGhlIGRyb3Bkb3duIGZpcnN0XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJjb25maWdVcGRhdGVSZXF1ZXN0ZWRcIiwge1xuICAgICAgICAgICAgICAgICAgICBjb25maWdTZXR0aW5nOiBzZWxlY3RWYWx1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuJHRiZE1vZGVBY3Rpb25zQnV0dG9uLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0VmFsdWUgPSB0aGlzLiR0YmRNb2RlQWN0aW9uc1NlbGVjdC52YWwoKTtcbiAgICAgICAgICAgIGlmIChzZWxlY3RWYWx1ZSA9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoXCJTZWxlY3QgYW4gb3B0aW9uIGZyb20gdGhlIGRyb3Bkb3duIGZpcnN0XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJhY3Rpb25CdXR0b25DbGlja2VkXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uVmFsdWU6IHNlbGVjdFZhbHVlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJ3b3JkU2F2ZWRcIiwgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHdvcmQgPSBkYXRhW1wid29yZFwiXSB8fCBcIlwiO1xuICAgICAgICAgICAgaWYgKHdvcmQgPT0gXCJcIikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLmdldFdvcmRFbGVtZW50KHdvcmQpO1xuICAgICAgICAgICAgaWYgKCFlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy51cGRhdGVXb3JkKHdvcmQpO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJncm91cHNSZWdlbmVyYXRlZFwiLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgdGhpcy4kdGJkTW9kZUdyb3VwQ291bnQudGV4dChkYXRhW1wiZ3JvdXBzXCJdLmxlbmd0aCk7XG4gICAgICAgIH0pO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcIm5leHRHcm91cFwiLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgdGhpcy4kdGJkTW9kZUdyb3VwTnVtYmVyLnRleHQoZGF0YVtcImdyb3VwTnVtYmVyXCJdKTtcbiAgICAgICAgICAgIHRoaXMuJGdyb3VwVGhyZXNob2xkLnRleHQoZGF0YVtcImdyb3VwXCJdLmdldFRocmVzaG9sZCgpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuJHNvcnRlclNlbGVjdFxuICAgICAgICAgICAgLmZpbmQoYG9wdGlvblt2YWx1ZT1cIiR7dGhpcy50YmRNb2RlLmdldENvbmZpZygpLmdldFNvcnRlck5hbWUoKX1cIl1gKVxuICAgICAgICAgICAgLmF0dHIoXCJzZWxlY3RlZFwiLCBcIlwiKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGVsZW1lbnRcbiAgICAgKiBAcGFyYW0gYW5pbWF0aW9uIC0gYm90aCB0aGUga2V5ZnJhbWUgYW5pbWF0aW9uIGFuZCBjbGFzcyB3aXRoIHRoYXQgYW5pbWF0aW9uLiBGb3Igc2ltcGxpY2l0eVxuICAgICAqIHRoZXkgbXVzdCBiZSB0aGUgc2FtZS5cbiAgICAgKi9cbiAgICBhbmltYXRlKGVsZW1lbnQsIGFuaW1hdGlvbikge1xuICAgICAgICBpZiAoIXRoaXMudGJkTW9kZS5nZXRDb25maWcoKS5hcmVBbmltYXRpb25zRW5hYmxlZCgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY3VycmVudGx5QW5pbWF0aW5nLmluY2x1ZGVzKGVsZW1lbnQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2FsbGJhY2sgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGlmIChldmVudC5hbmltYXRpb25OYW1lICE9PSBhbmltYXRpb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuY3VycmVudGx5QW5pbWF0aW5nLmZpbmRJbmRleCgoYW5pbWF0aW5nRWxlbWVudCkgPT4gYW5pbWF0aW5nRWxlbWVudCA9PSBlbGVtZW50KTtcbiAgICAgICAgICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuY3VycmVudGx5QW5pbWF0aW5nW2luZGV4XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShhbmltYXRpb24pO1xuICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwiYW5pbWF0aW9uZW5kXCIsIGNhbGxiYWNrKTtcbiAgICAgICAgfTtcbiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiYW5pbWF0aW9uZW5kXCIsIGNhbGxiYWNrKTtcbiAgICAgICAgdGhpcy5jdXJyZW50bHlBbmltYXRpbmcucHVzaChlbGVtZW50KTtcbiAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKGFuaW1hdGlvbik7XG4gICAgfVxuICAgIGhhbmRsZVdvcmRDbGlja2VkKGV2ZW50KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICBpZiAoISh0YXJnZXQgaW5zdGFuY2VvZiBIVE1MRGl2RWxlbWVudCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJ0YmRXb3JkXCIpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgd29yZCA9ICgoX2EgPSB0YXJnZXQucGFyZW50RWxlbWVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmRhdGFzZXRbXCJ3b3JkXCJdKSB8fCBcIlwiO1xuICAgICAgICBpZiAod29yZCA9PSBcIlwiKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJ3b3JkQ2xpY2tlZFwiLCB7IHdvcmQ6IHdvcmQgfSk7XG4gICAgfVxuICAgIGhhbmRsZVNvcnRlckNoYW5nZShkYXRhKSB7XG4gICAgICAgIGNvbnN0IHNvcnRlciA9IFRiZFNvcnRpbmcuZ2V0U29ydGVyKGRhdGFbXCJuZXdWYWx1ZVwiXSB8fCBcIlwiKTtcbiAgICAgICAgdGhpcy5zb3J0V29yZHMoc29ydGVyKTtcbiAgICB9XG4gICAgc2VsZWN0U29ydGVyT3B0aW9uKHNvcnRlck5hbWUpIHtcbiAgICAgICAgWy4uLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIjdGJkTW9kZVNvcnRlclNlbGVjdCBvcHRpb25cIildLmZvckVhY2goKG9wdGlvbikgPT4ge1xuICAgICAgICAgICAgaWYgKCEob3B0aW9uIGluc3RhbmNlb2YgSFRNTE9wdGlvbkVsZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9wdGlvbltcInZhbHVlXCJdID09IHNvcnRlck5hbWUpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25bXCJzZWxlY3RlZFwiXSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICB1cGRhdGVUb3RhbFByb2dyZXNzTWV0ZXIobW9ua2V5VHlwZVdvcmRzZXQsIHRhcmdldFNwZWVkKSB7XG4gICAgICAgIGNvbnN0IGFsbFdvcmRzID0gbW9ua2V5VHlwZVdvcmRzZXQud29yZHM7XG4gICAgICAgIGNvbnN0IGNvdW50ID0gYWxsV29yZHMubGVuZ3RoO1xuICAgICAgICBjb25zdCBiZWF0ZW5BdFRhcmdldENvdW50ID0gYWxsV29yZHMuZmlsdGVyKCh3b3JkKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gVGJkRGF0YS5oYXNXb3JkQmVlblR5cGVkRmFzdGVyVGhhbih3b3JkLCB0YXJnZXRTcGVlZCk7XG4gICAgICAgIH0pLmxlbmd0aDtcbiAgICAgICAgY29uc3QgcGVyY2VudCA9IChiZWF0ZW5BdFRhcmdldENvdW50IC8gY291bnQpICogMTAwIHx8IDA7XG4gICAgICAgIHRoaXMuJHByb2dyZXNzTWV0ZXJUb3RhbC5jc3MoXCJ3aWR0aFwiLCBgJHtwZXJjZW50fSVgKTtcbiAgICAgICAgdGhpcy4kcHJvZ3Jlc3NNZXRlclRvdGFsLmF0dHIoXCJ0aXRsZVwiLCBgJHtiZWF0ZW5BdFRhcmdldENvdW50fSB3b3JkcyBvZiAke2NvdW50fSB0b3RhbCBoYXZlIGJlZW4gdHlwZWQgZmFzdGVyIHRoYW4gdGhlIHRhcmdldCBvZiAke3RhcmdldFNwZWVkfWApO1xuICAgIH1cbiAgICB1cGRhdGVHcm91cFByb2dyZXNzTWV0ZXIoY3VycmVudEdyb3VwLCB0YXJnZXRTcGVlZCkge1xuICAgICAgICBjb25zdCBncm91cFdvcmRzZXQgPSBjdXJyZW50R3JvdXAuZ2V0V29yZHNldCgpO1xuICAgICAgICBjb25zdCBiZWF0ZW5BdFRhcmdldENvdW50ID0gZ3JvdXBXb3Jkc2V0LndvcmRzLmZpbHRlcigod29yZCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIFRiZERhdGEuaGFzV29yZEJlZW5UeXBlZEZhc3RlclRoYW4od29yZCwgdGFyZ2V0U3BlZWQpO1xuICAgICAgICB9KS5sZW5ndGg7XG4gICAgICAgIGNvbnN0IHBlcmNlbnQgPSAoYmVhdGVuQXRUYXJnZXRDb3VudCAvIGdyb3VwV29yZHNldC5sZW5ndGgpICogMTAwIHx8IDA7XG4gICAgICAgIHRoaXMuJHByb2dyZXNzTWV0ZXJHcm91cC5jc3MoXCJ3aWR0aFwiLCBgJHtwZXJjZW50fSVgKTtcbiAgICAgICAgdGhpcy4kcHJvZ3Jlc3NNZXRlckdyb3VwLmF0dHIoXCJ0aXRsZVwiLCBgJHtiZWF0ZW5BdFRhcmdldENvdW50fSB3b3JkcyBvZiAke2dyb3VwV29yZHNldC5sZW5ndGh9IGluIHRoZSBjdXJyZW50IGdyb3VwIGhhdmUgYmVlbiB0eXBlZCBmYXN0ZXIgdGhhbiB0aGUgdGFyZ2V0IG9mICR7dGFyZ2V0U3BlZWR9YCk7XG4gICAgfVxuICAgIHBhZ2VDaGFuZ2VIYW5kbGVyKF9wcmV2aW91c1BhZ2UsIG5leHRQYWdlKSB7XG4gICAgICAgIGNvbnN0IHBhZ2VzVG9TaG93SW5mbyA9IFtcInRlc3RcIl07XG4gICAgICAgIGlmIChwYWdlc1RvU2hvd0luZm8uaW5jbHVkZXMobmV4dFBhZ2UubmFtZSkpIHtcbiAgICAgICAgICAgIHRoaXMuJHRiZE1vZGVJbmZvLnNob3coKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuJHRiZE1vZGVJbmZvLmhpZGUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB1cGRhdGVVaVdvcmRzKHdvcmRzVG9TaG93KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgLy8gUmVtb3ZlIHdvcmRzIHdlIGRvbid0IHdhbnQgdG8gc2hvd1xuICAgICAgICB0aGlzLiR3b3Jkc0Rpdi5oaWRlKCk7XG4gICAgICAgIChfYSA9IFsuLi5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLndvcmRzIC50YmRXb3JkQ29udGFpbmVyXCIpXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHdvcmRFbGVtZW50KSA9PiB7XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBjb25zdCB3b3JkID0gd29yZEVsZW1lbnQuZGF0YXNldFtcIndvcmRcIl07XG4gICAgICAgICAgICBpZiAoIXdvcmRzVG9TaG93LmluY2x1ZGVzKHdvcmQpKSB7XG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgIHdvcmRFbGVtZW50LnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQod29yZEVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgd29yZHNUb1Nob3cuZm9yRWFjaCgod29yZCkgPT4ge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVXb3JkKHdvcmQpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zb3J0V29yZHModGhpcy50YmRNb2RlLmdldENvbmZpZygpLmdldFNvcnRlcigpKTtcbiAgICAgICAgdGhpcy4kd29yZHNEaXYuc2hvdygpO1xuICAgIH1cbiAgICB1cGRhdGVXb3JkKHdvcmQpIHtcbiAgICAgICAgY29uc3Qgd29yZEVsZW1lbnQgPSB0aGlzLmdldE9yQ3JlYXRlV29yZEVsZW1lbnQod29yZCk7XG4gICAgICAgIGNvbnN0IHRhcmdldFNwZWVkID0gdGhpcy50YmRNb2RlLmdldENvbmZpZygpLmdldFRhcmdldFNwZWVkKCk7XG4gICAgICAgIGNvbnN0IGdyb3VwU3BlZWQgPSB0aGlzLnRiZE1vZGUuZ2V0Q3VycmVudEdyb3VwKCkuZ2V0VGhyZXNob2xkKCk7XG4gICAgICAgIC8vIFRpbWVvdXQgZW5zdXJlcyB0cmFuc2l0aW9ucyB3b3JrXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgd29yZEVsZW1lbnQuZGF0YXNldFtcImJlYXRlbkF0VGFyZ2V0XCJdID1cbiAgICAgICAgICAgICAgICBUYmREYXRhLmhhc1dvcmRCZWVuVHlwZWRGYXN0ZXJUaGFuKHdvcmQsIHRhcmdldFNwZWVkKSA/IFwiMVwiIDogXCIwXCI7XG4gICAgICAgICAgICB3b3JkRWxlbWVudC5kYXRhc2V0W1wiYmVhdGVuQXRHcm91cFwiXSA9IFRiZERhdGEuaGFzV29yZEJlZW5UeXBlZEZhc3RlclRoYW4od29yZCwgZ3JvdXBTcGVlZClcbiAgICAgICAgICAgICAgICA/IFwiMVwiXG4gICAgICAgICAgICAgICAgOiBcIjBcIjtcbiAgICAgICAgICAgIHdvcmRFbGVtZW50LmRhdGFzZXRbXCJ0eXBlZFwiXSA9XG4gICAgICAgICAgICAgICAgVGJkRGF0YS5nZXRTcGVlZHNGb3JXb3JkKHdvcmQpLmxlbmd0aCA9PSAwID8gXCIwXCIgOiBcIjFcIjtcbiAgICAgICAgICAgIHdvcmRFbGVtZW50LmRhdGFzZXRbXCJtaXNzZWRNb3JlXCJdID1cbiAgICAgICAgICAgICAgICBUYmREYXRhLmdldE1pc3R5cGVkQ291bnRGb3JXb3JkKHdvcmQpID5cbiAgICAgICAgICAgICAgICAgICAgVGJkRGF0YS5nZXRTcGVlZHNGb3JXb3JkKHdvcmQpLmxlbmd0aFxuICAgICAgICAgICAgICAgICAgICA/IFwiMVwiXG4gICAgICAgICAgICAgICAgICAgIDogXCIwXCI7XG4gICAgICAgICAgICBjb25zdCBwZXJjZW50Q29tcGxldGUgPSBUYmREYXRhLmdldE1lZGlhblNwZWVkRm9yV29yZCh3b3JkKSAvIHRhcmdldFNwZWVkO1xuICAgICAgICAgICAgY29uc3QgbW9kaWZpZXIgPSBNYXRoLm1pbihwZXJjZW50Q29tcGxldGUsIDEpO1xuICAgICAgICAgICAgY29uc3QgYmFzZVNjYWxlID0gMC43NTtcbiAgICAgICAgICAgIGNvbnN0IGFkZGl0aW9uYWwgPSAoMSAtIGJhc2VTY2FsZSkgKiBtb2RpZmllcjtcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIChfYSA9IHdvcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJkaXZcIikuc3R5bGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50cmFuc2Zvcm0gPSBgc2NhbGUoJHtiYXNlU2NhbGUgKyBhZGRpdGlvbmFsfSlgO1xuICAgICAgICB9LCAwKTtcbiAgICB9XG4gICAgc29ydFdvcmRzKHNvcnRlcikge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHdvcmRzID0gKF9hID0gWy4uLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudGJkV29yZENvbnRhaW5lclwiKV0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tYXAoKHdvcmRDb250YWluZXJFbGVtZW50KSA9PiB7XG4gICAgICAgICAgICBpZiAoISh3b3JkQ29udGFpbmVyRWxlbWVudCBpbnN0YW5jZW9mIEhUTUxEaXZFbGVtZW50KSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlJVSCBST0hcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gd29yZENvbnRhaW5lckVsZW1lbnQuZGF0YXNldFtcIndvcmRcIl0gfHwgXCJcIjtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHNvcnRlZCA9IHdvcmRzLnNvcnQoc29ydGVyKTtcbiAgICAgICAgc29ydGVkLmZvckVhY2goKHdvcmQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLmdldE9yQ3JlYXRlV29yZEVsZW1lbnQod29yZCk7XG4gICAgICAgICAgICB0aGlzLiR3b3Jkc0Rpdi5hcHBlbmQoZWxlbWVudCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXRXb3JkRWxlbWVudCh3b3JkKSB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gYC50YmRXb3JkQ29udGFpbmVyW2RhdGEtd29yZD1cIiR7d29yZH1cIl1gO1xuICAgICAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihxdWVyeSk7XG4gICAgfVxuICAgIGdldE9yQ3JlYXRlV29yZEVsZW1lbnQod29yZCkge1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5nZXRXb3JkRWxlbWVudCh3b3JkKTtcbiAgICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5ld0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIG5ld0Rpdi5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz1cInRiZFdvcmRcIj4ke3dvcmR9PC9kaXY+YDtcbiAgICAgICAgbmV3RGl2LmRhdGFzZXRbXCJ3b3JkXCJdID0gd29yZDtcbiAgICAgICAgbmV3RGl2LmNsYXNzTGlzdC5hZGQoXCJ0YmRXb3JkQ29udGFpbmVyXCIpO1xuICAgICAgICB0aGlzLiR3b3Jkc0Rpdi5hcHBlbmQobmV3RGl2KTtcbiAgICAgICAgcmV0dXJuIG5ld0RpdjtcbiAgICB9XG4gICAgdXBkYXRlV29yZEluZm8oZXZlbnQpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICAgIGlmICghKHRhcmdldCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInRiZFdvcmRcIikpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB3b3JkID0gKF9hID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5kYXRhc2V0W1wid29yZFwiXTtcbiAgICAgICAgaWYgKHdvcmQgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgd29yZERhdGEgPSBUYmREYXRhLmdldERhdGFGb3JXb3JkKHdvcmQpO1xuICAgICAgICBsZXQgd29yZEluZm9IdG1sID0gYFxuICAgICAgICA8aDM+XCIke3dvcmR9XCI8L2gzPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiaGVhZGluZ1wiPkNvdW50czwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwic3RhdENvbnRhaW5lclwiPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwibGFiZWxcIj5Db3JyZWN0OiA8L3NwYW4+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJzdGF0IGdvb2RcIj4ke3dvcmREYXRhLnNwZWVkcy5sZW5ndGh9PC9zcGFuLj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzdGF0Q29udGFpbmVyXCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJsYWJlbFwiPk1pc3NlZDogPC9zcGFuPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwic3RhdCBiYWRcIj4ke1RiZERhdGEuZ2V0TWlzdHlwZWRDb3VudEZvcldvcmQod29yZCl9PC9zcGFuPlxuICAgICAgICA8L2Rpdj5gO1xuICAgICAgICBpZiAod29yZERhdGEuc3BlZWRzLmxlbmd0aCkge1xuICAgICAgICAgICAgd29yZEluZm9IdG1sICs9IGBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJoZWFkaW5nXCI+U3BlZWRzPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzdGF0Q29udGFpbmVyXCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJsYWJlbFwiPldvcnN0OiA8L3NwYW4+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJzdGF0IGJhZFwiPiR7VGJkRGF0YS5nZXRTbG93ZXN0U3BlZWRGb3JXb3JkKHdvcmQpfTwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzdGF0Q29udGFpbmVyXCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJsYWJlbFwiPk1lYW46IDwvc3Bhbj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cInN0YXRcIj4ke1RiZERhdGEuZ2V0TWVhblNwZWVkRm9yV29yZCh3b3JkKX08L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwic3RhdENvbnRhaW5lclwiPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwibGFiZWxcIj5NZWRpYW46IDwvc3Bhbj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cInN0YXRcIj4ke1RiZERhdGEuZ2V0TWVkaWFuU3BlZWRGb3JXb3JkKHdvcmQpfTwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzdGF0Q29udGFpbmVyXCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJsYWJlbFwiPkJlc3Q6IDwvc3Bhbj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cInN0YXQgZ29vZFwiPiR7VGJkRGF0YS5nZXRGYXN0ZXN0U3BlZWRGb3JXb3JkKHdvcmQpfTwvc3Bhbj5cbiAgICAgICAgPC9kaXY+YDtcbiAgICAgICAgfVxuICAgICAgICB3b3JkSW5mb0h0bWwgKz0gYDxkaXYgY2xhc3M9XCJoZWxwVGV4dFwiPmNsaWNrIHRvIHJlc2V0IHdvcmQgZGF0YTwvZGl2PmA7XG4gICAgICAgIHRoaXMuJHdvcmRJbmZvLmh0bWwod29yZEluZm9IdG1sKTtcbiAgICAgICAgdGhpcy5nZXRPckNyZWF0ZVdvcmRFbGVtZW50KHdvcmQpLmFwcGVuZCh0aGlzLiR3b3JkSW5mb1swXSk7XG4gICAgICAgIHRoaXMuJHdvcmRJbmZvLnNob3coMjAwKTtcbiAgICB9XG59XG5jbGFzcyBUYmRFdmVudHMge1xuICAgIHN0YXRpYyBkaXNwYXRjaEV2ZW50KG5hbWUsIGRhdGEgPSB7fSkge1xuICAgICAgICBjb25zdCBzdWJzY3JpYmVycyA9IHRoaXMuc3Vic2NyaWJlcnNbbmFtZV0gfHwgW107XG4gICAgICAgIHN1YnNjcmliZXJzLmZvckVhY2goKHN1YnNjcmliZXIpID0+IHtcbiAgICAgICAgICAgIHN1YnNjcmliZXIoZGF0YSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzdGF0aWMgYWRkU3Vic2NyaWJlcihuYW1lLCBjYWxsYmFjaykge1xuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoVGJkRXZlbnRzLnN1YnNjcmliZXJzW25hbWVdKSkge1xuICAgICAgICAgICAgVGJkRXZlbnRzLnN1YnNjcmliZXJzW25hbWVdID0gW107XG4gICAgICAgIH1cbiAgICAgICAgVGJkRXZlbnRzLnN1YnNjcmliZXJzW25hbWVdLnB1c2goY2FsbGJhY2spO1xuICAgIH1cbn1cblRiZEV2ZW50cy5zdWJzY3JpYmVycyA9IHt9O1xuVGJkRXZlbnRzLmRlYm91bmNlZERpc3BhdGNoID0gKDAsIGRlYm91bmNlXzEuZGVib3VuY2UpKFRiZEV2ZW50cy5kaXNwYXRjaEV2ZW50LCA1MCk7XG5jbGFzcyBUYmREYXRhIHtcbiAgICBzdGF0aWMgZ2V0QWxsKCkge1xuICAgICAgICBpZiAoVGJkRGF0YS5kYXRhKSB7XG4gICAgICAgICAgICByZXR1cm4gVGJkRGF0YS5kYXRhO1xuICAgICAgICB9XG4gICAgICAgIFRiZERhdGEuZGF0YSA9IFRiZERhdGEuZ2V0RnJvbUxvY2FsU3RvcmFnZSgpO1xuICAgICAgICByZXR1cm4gVGJkRGF0YS5kYXRhO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0RnJvbUxvY2FsU3RvcmFnZSgpIHtcbiAgICAgICAgY29uc3QgZGVmYXVsdFZhbHVlID0geyB3b3Jkczoge30sIGNvbmZpZzoge30gfTtcbiAgICAgICAgY29uc3Qgc3RvcmVkRGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFRiZERhdGEubG9jYWxTdG9yYWdlS2V5KTtcbiAgICAgICAgaWYgKHN0b3JlZERhdGEgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBUcnkgcGFyc2luZyBsb2NhbCBzdG9yYWdlXG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2Uoc3RvcmVkRGF0YSk7XG4gICAgICAgIGlmICh0eXBlb2YgcGFyc2VkID09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJzZWQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgICB9XG4gICAgc3RhdGljIHVwZGF0ZURhdGEoZGF0YSwgaW1tZWRpYXRlbHkgPSBmYWxzZSkge1xuICAgICAgICBUYmREYXRhLmRhdGEgPSBkYXRhO1xuICAgICAgICBpZiAoaW1tZWRpYXRlbHkpIHtcbiAgICAgICAgICAgIFRiZERhdGEudXBkYXRlTG9jYWxTdG9yYWdlKGRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgVGJkRGF0YS5kZWJvdW5jZWRVcGRhdGVMb2NhbFN0b3JhZ2UoZGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3RhdGljIGdldERhdGFGb3JXb3JkKHdvcmQpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IFRiZERhdGEuZ2V0QWxsKCk7XG4gICAgICAgIGlmICghZGF0YS53b3Jkc1t3b3JkXSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3BlZWRzOiBbXSwgbWlzc2VkQ291bnQ6IDAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YS53b3Jkc1t3b3JkXTtcbiAgICB9XG4gICAgc3RhdGljIHJlc2V0RGF0YUZvcldvcmQod29yZCkge1xuICAgICAgICBUYmREYXRhLnNhdmVXb3JkRGF0YSh3b3JkLCB7IHNwZWVkczogW10sIG1pc3NlZENvdW50OiAwIH0pO1xuICAgICAgICBUYmRFdmVudHMuZGlzcGF0Y2hFdmVudChcIndvcmRSZXNldFwiLCB7IHdvcmQ6IHdvcmQgfSk7XG4gICAgfVxuICAgIHN0YXRpYyByZXNldERhdGFGb3JXb3Jkcyh3b3Jkcykge1xuICAgICAgICB3b3Jkcy5mb3JFYWNoKCh3b3JkKSA9PiBUYmREYXRhLnJlc2V0RGF0YUZvcldvcmQod29yZCkpO1xuICAgICAgICBUYmRFdmVudHMuZGlzcGF0Y2hFdmVudChcIndvcmRzUmVzZXRcIiwgeyB3b3Jkczogd29yZHMgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBoYXNXb3JkQmVlblR5cGVkRmFzdGVyVGhhbih3b3JkLCB0aHJlc2hvbGQpIHtcbiAgICAgICAgcmV0dXJuIFRiZERhdGEuZ2V0TWVkaWFuU3BlZWRGb3JXb3JkKHdvcmQpID4gdGhyZXNob2xkO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0U3BlZWRzRm9yV29yZCh3b3JkKSB7XG4gICAgICAgIHJldHVybiBUYmREYXRhLmdldERhdGFGb3JXb3JkKHdvcmQpLnNwZWVkcyB8fCBbXTtcbiAgICB9XG4gICAgc3RhdGljIGdldFNsb3dlc3RTcGVlZEZvcldvcmQod29yZCkge1xuICAgICAgICBjb25zdCBzcGVlZHMgPSBUYmREYXRhLmdldFNwZWVkc0ZvcldvcmQod29yZCk7XG4gICAgICAgIGlmIChzcGVlZHMubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBNYXRoLm1pbiguLi5zcGVlZHMpO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0RmFzdGVzdFNwZWVkRm9yV29yZCh3b3JkKSB7XG4gICAgICAgIGNvbnN0IHNwZWVkcyA9IFRiZERhdGEuZ2V0U3BlZWRzRm9yV29yZCh3b3JkKTtcbiAgICAgICAgaWYgKHNwZWVkcy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KC4uLnNwZWVkcyk7XG4gICAgfVxuICAgIHN0YXRpYyBnZXRNaXN0eXBlZENvdW50Rm9yV29yZCh3b3JkKSB7XG4gICAgICAgIHJldHVybiBUYmREYXRhLmdldERhdGFGb3JXb3JkKHdvcmQpLm1pc3NlZENvdW50O1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0TWVkaWFuU3BlZWRGb3JXb3JkKHdvcmQpIHtcbiAgICAgICAgY29uc3Qgd29yZFNwZWVkcyA9IFRiZERhdGEuZ2V0U3BlZWRzRm9yV29yZCh3b3JkKTtcbiAgICAgICAgaWYgKHdvcmRTcGVlZHMubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICgwLCBtaXNjXzEubWVkaWFuKSh3b3JkU3BlZWRzKTtcbiAgICB9XG4gICAgc3RhdGljIGdldE1lYW5TcGVlZEZvcldvcmQod29yZCkge1xuICAgICAgICBjb25zdCBzcGVlZHMgPSBUYmREYXRhLmdldFNwZWVkc0ZvcldvcmQod29yZCk7XG4gICAgICAgIGlmIChzcGVlZHMubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBNYXRoLnJvdW5kKCgwLCBtaXNjXzEubWVhbikoc3BlZWRzKSk7XG4gICAgfVxuICAgIHN0YXRpYyBzYXZlV29yZERhdGEod29yZCwgd29yZERhdGEpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IFRiZERhdGEuZ2V0QWxsKCk7XG4gICAgICAgIGRhdGEud29yZHNbd29yZF0gPSB3b3JkRGF0YTtcbiAgICAgICAgVGJkRGF0YS51cGRhdGVEYXRhKGRhdGEpO1xuICAgICAgICBUYmRFdmVudHMuZGlzcGF0Y2hFdmVudChcIndvcmRTYXZlZFwiLCB7IHdvcmQ6IHdvcmQsIGRhdGE6IHdvcmREYXRhIH0pO1xuICAgIH1cbiAgICBzdGF0aWMgYWRkQnVyc3Qod29yZCwgc3BlZWQpIHtcbiAgICAgICAgaWYgKHdvcmQgPT0gXCJcIikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHdvcmREYXRhID0gVGJkRGF0YS5nZXREYXRhRm9yV29yZCh3b3JkKTtcbiAgICAgICAgd29yZERhdGEuc3BlZWRzLnB1c2goc3BlZWQpO1xuICAgICAgICBUYmREYXRhLnNhdmVXb3JkRGF0YSh3b3JkLCB3b3JkRGF0YSk7XG4gICAgfVxuICAgIHN0YXRpYyBhZGRUb01pc3NlZENvdW50KHdvcmQsIG1pc3NlZENvdW50KSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBUYmREYXRhLmdldERhdGFGb3JXb3JkKHdvcmQpO1xuICAgICAgICBkYXRhLm1pc3NlZENvdW50ICs9IG1pc3NlZENvdW50O1xuICAgICAgICBUYmREYXRhLnNhdmVXb3JkRGF0YSh3b3JkLCBkYXRhKTtcbiAgICB9XG4gICAgc3RhdGljIHVwZGF0ZUxvY2FsU3RvcmFnZShkYXRhKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFRiZERhdGEubG9jYWxTdG9yYWdlS2V5LCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgfVxufVxuVGJkRGF0YS5sb2NhbFN0b3JhZ2VLZXkgPSBcInRiZE1vZGVEYXRhXCI7XG5UYmREYXRhLmRlYm91bmNlZFVwZGF0ZUxvY2FsU3RvcmFnZSA9ICgwLCBkZWJvdW5jZV8xLmRlYm91bmNlKShUYmREYXRhLnVwZGF0ZUxvY2FsU3RvcmFnZSwgMTAwMCk7XG5jbGFzcyBUYmRHcm91cHMge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmdyb3VwcyA9IFtdO1xuICAgIH1cbiAgICBzZXRHcm91cHMoZ3JvdXBzKSB7XG4gICAgICAgIHRoaXMuZ3JvdXBzID0gZ3JvdXBzO1xuICAgIH1cbiAgICBnZXRHcm91cHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyb3VwcztcbiAgICB9XG4gICAgZ2V0Rmlyc3RJbmNvbXBsZXRlR3JvdXAodGFyZ2V0U3BlZWQpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmdyb3Vwcy5maW5kKChncm91cCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGdyb3VwXG4gICAgICAgICAgICAgICAgLmdldFdvcmRzZXQoKVxuICAgICAgICAgICAgICAgIC53b3Jkcy5zb21lKCh3b3JkKSA9PiAhVGJkRGF0YS5oYXNXb3JkQmVlblR5cGVkRmFzdGVyVGhhbih3b3JkLCB0YXJnZXRTcGVlZCkpO1xuICAgICAgICB9KSB8fCBudWxsKTtcbiAgICB9XG4gICAgcmVnZW5lcmF0ZUdyb3Vwcyh3b3JkcywgZGVzaXJlZEdyb3VwU2l6ZSkge1xuICAgICAgICB0aGlzLmdyb3VwcyA9IFtdO1xuICAgICAgICBpZiAod29yZHMubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByYW5kb21seVNvcnRlZCA9IHdvcmRzLnNvcnQoVGJkU29ydGluZy5yYW5kb21Tb3J0ZXIpO1xuICAgICAgICAvLyBUaGlzIGlzIGFuIGVmZm9ydCB0byBlbnN1cmUgdGhlcmUgYXJlIG5vIHRpbnkgZ3JvdXAgc2l6ZXMsIGxpa2UgaWYgdGhlcmUgYXJlIDIwMFxuICAgICAgICAvLyB3b3JkcyBhbmQgYSBncm91cCBzaXplIG9mIDE4LiBDcmVhdGluZyBncm91cHMgb2Ygc2l6ZSAxOCB3b3VsZCBtZWFuIGdldHRpbmcgMTEgZ3JvdXBzXG4gICAgICAgIC8vIG9mIDE4IGFuZCAxIGdyb3VwIG9mIDIuIFRoaXMgbWV0aG9kIGVuZHMgdXAgY3JlYXRpbmcgOCBncm91cHMgb2YgMTcgKDEzNikgKyA0IGdyb3VwcyBvZlxuICAgICAgICAvLyAxNiAoNjQpLiBJJ20gc3VyZSB0aGVyZSBpcyBhIGJldHRlciB3YXkgdG8gY2FsY3VsYXRlIGl0IGJ1dCB0aGlzIHNlZW1zIHRvIHdvcmsgYW5kIEknbVxuICAgICAgICAvLyBsYXp5IHdoZW4gaXQgY29tZXMgdG8gbWF0aC5cbiAgICAgICAgY29uc3QgdG90YWwgPSB3b3Jkcy5sZW5ndGg7XG4gICAgICAgIGNvbnN0IGFjdHVhbEdyb3VwQ291bnQgPSBNYXRoLmNlaWwodG90YWwgLyBkZXNpcmVkR3JvdXBTaXplKTtcbiAgICAgICAgY29uc3QgbWF4R3JvdXBTaXplID0gTWF0aC5jZWlsKHRvdGFsIC8gYWN0dWFsR3JvdXBDb3VudCk7XG4gICAgICAgIGNvbnN0IHJlZHVjZWRHcm91cFNpemUgPSBtYXhHcm91cFNpemUgLSAxO1xuICAgICAgICBjb25zdCBzaXplc1RvQ3JlYXRlID0gW107XG4gICAgICAgIGxldCByZW1haW5pbmdXb3JkcyA9IHRvdGFsO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFjdHVhbEdyb3VwQ291bnQ7IGkrKykge1xuICAgICAgICAgICAgaWYgKHJlbWFpbmluZ1dvcmRzICUgbWF4R3JvdXBTaXplID09IDApIHtcbiAgICAgICAgICAgICAgICBzaXplc1RvQ3JlYXRlLnB1c2gobWF4R3JvdXBTaXplKTtcbiAgICAgICAgICAgICAgICByZW1haW5pbmdXb3JkcyAtPSBtYXhHcm91cFNpemU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzaXplc1RvQ3JlYXRlLnB1c2gocmVkdWNlZEdyb3VwU2l6ZSk7XG4gICAgICAgICAgICAgICAgcmVtYWluaW5nV29yZHMgLT0gcmVkdWNlZEdyb3VwU2l6ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBsZXQgc3RhcnQgPSAwO1xuICAgICAgICBzaXplc1RvQ3JlYXRlLmZvckVhY2goKHNpemUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHdvcmRzID0gcmFuZG9tbHlTb3J0ZWQuc2xpY2Uoc3RhcnQsIHN0YXJ0ICsgc2l6ZSk7XG4gICAgICAgICAgICBjb25zdCB3b3Jkc2V0ID0gbmV3IHdvcmRzZXRfMS5Xb3Jkc2V0KHdvcmRzKTtcbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzLnB1c2gobmV3IFRiZEdyb3VwKHdvcmRzZXQpKTtcbiAgICAgICAgICAgIHN0YXJ0ID0gc3RhcnQgKyBzaXplO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJncm91cHNSZWdlbmVyYXRlZFwiLCB7IGdyb3VwczogdGhpcy5ncm91cHMgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5kaXNwYXRjaEV2ZW50KFwibmV4dEdyb3VwXCIsIHtcbiAgICAgICAgICAgIGdyb3VwOiB0aGlzLmdldEdyb3VwcygpWzBdLFxuICAgICAgICAgICAgZ3JvdXBOdW1iZXI6IDEsXG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmNsYXNzIFRiZEdyb3VwIHtcbiAgICBjb25zdHJ1Y3Rvcih3b3Jkc2V0KSB7XG4gICAgICAgIHRoaXMudGhyZXNob2xkID0gMTtcbiAgICAgICAgdGhpcy53b3Jkc2V0ID0gd29yZHNldDtcbiAgICB9XG4gICAgZ2V0V29yZHNldCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud29yZHNldDtcbiAgICB9XG4gICAgZ2V0VGhyZXNob2xkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50aHJlc2hvbGQ7XG4gICAgfVxuICAgIGJ1bXBUaHJlc2hvbGQoKSB7XG4gICAgICAgIHRoaXMudGhyZXNob2xkICs9IDE7XG4gICAgICAgIFRiZEV2ZW50cy5kaXNwYXRjaEV2ZW50KFwiZ3JvdXBUaHJlc2hvbGRDaGFuZ2VkXCIsIHtcbiAgICAgICAgICAgIHRocmVzaG9sZDogdGhpcy50aHJlc2hvbGQsXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXRVbmJlYXRlbldvcmRzZXQoKSB7XG4gICAgICAgIGNvbnN0IHVuYmVhdGVuV29yZHMgPSB0aGlzLndvcmRzZXQud29yZHMuZmlsdGVyKCh3b3JkKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gIVRiZERhdGEuaGFzV29yZEJlZW5UeXBlZEZhc3RlclRoYW4od29yZCwgdGhpcy5nZXRUaHJlc2hvbGQoKSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbmV3IHdvcmRzZXRfMS5Xb3Jkc2V0KHVuYmVhdGVuV29yZHMpO1xuICAgIH1cbiAgICBpbmNyZWFzZVRocmVzaG9sZFVudGlsU29tZVdvcmRzQXJlVW5iZWF0ZW4oKSB7XG4gICAgICAgIGlmICh0aGlzLndvcmRzZXQubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB3aGlsZSAodGhpcy5nZXRVbmJlYXRlbldvcmRzZXQoKS5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5idW1wVGhyZXNob2xkKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5Db25maWdFdmVudC5zdWJzY3JpYmUoaGFuZGxlRnVuYm94Q2hhbmdlKTtcbmZ1bmN0aW9uIGlzVGJkTW9kZSgpIHtcbiAgICByZXR1cm4gY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT0gXCJ0YmRtb2RlXCI7XG59XG5mdW5jdGlvbiBoYW5kbGVGdW5ib3hDaGFuZ2Uoa2V5LCBfbmV3VmFsdWUsIF9ub3NhdmUsIF9wcmV2aW91c1ZhbHVlLCBfZnVsbENvbmZpZykge1xuICAgIGlmIChrZXkgIT0gXCJmdW5ib3hcIikge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChpc1RiZE1vZGUoKSAmJiAhZ2V0VGJkTW9kZSgpKSB7XG4gICAgICAgIGNvbnN0IHRiZENvbmZpZyA9IG5ldyBUYmRDb25maWcoKTtcbiAgICAgICAgdGJkQ29uZmlnLmluaXQoKTtcbiAgICAgICAgdGJkTW9kZSA9IG5ldyBUYmRNb2RlKHRiZENvbmZpZyk7XG4gICAgICAgIHRiZE1vZGUuaW5pdCgpO1xuICAgICAgICBjb25zdCB1aSA9IG5ldyBUYmRVSSh0YmRNb2RlKTtcbiAgICAgICAgdWkuaW5pdCgpO1xuICAgIH1cbiAgICBlbHNlIGlmICghaXNUYmRNb2RlKCkgJiYgZ2V0VGJkTW9kZSgpKSB7XG4gICAgICAgIC8vIFRoaXMgd2FzIHRoZSBlYXNpZXN0IHdheSBJIGNvdWxkIHRoaW5rIG9mIHRvIGVuc3VyZSB0aGVyZSdzIG5vdGhpbmcgbGVmdCBvdmVyXG4gICAgICAgIC8vIGFmdGVyIHN3aXRjaGluZyBmcm9tIFRCRCBNb2RlIHRvIHNvbWV0aGluZyBlbHNlLlxuICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgICB9XG59XG5sZXQgdGJkTW9kZTtcbmZ1bmN0aW9uIGdldFRiZE1vZGUoKSB7XG4gICAgcmV0dXJuIHRiZE1vZGU7XG59XG5leHBvcnRzLmdldFRiZE1vZGUgPSBnZXRUYmRNb2RlO1xuQ29uZmlnU3R1ZmYuc2V0RnVuYm94KFwidGJkbW9kZVwiKTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZSA9IGV4cG9ydHMuaGlkZSA9IGV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG4vLyBleHBvcnQgZnVuY3Rpb24gc2hvdygpIHtcbi8vICAgJChcIiN0b3AgLmNvbmZpZ1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKS5jc3MoXCJvcGFjaXR5XCIsIDEpO1xuLy8gfVxuLy8gZXhwb3J0IGZ1bmN0aW9uIGhpZGUoKSB7XG4vLyAgICQoXCIjdG9wIC5jb25maWdcIikuY3NzKFwib3BhY2l0eVwiLCAwKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbi8vIH1cbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgJChcIiN0b3AgLmNvbmZpZ1wiKVxuICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiAxLFxuICAgIH0sIDEyNSk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAkKFwiI3RvcCAuY29uZmlnXCIpXG4gICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogMCxcbiAgICB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgJChcIiN0b3AgLmNvbmZpZ1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG5mdW5jdGlvbiB1cGRhdGUocHJldmlvdXMsIGN1cnJlbnQpIHtcbiAgICBpZiAocHJldmlvdXMgPT09IGN1cnJlbnQpXG4gICAgICAgIHJldHVybjtcbiAgICAkKFwiI3RvcCAuY29uZmlnIC5tb2RlIC50ZXh0LWJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAkKFwiI3RvcCAuY29uZmlnIC5tb2RlIC50ZXh0LWJ1dHRvblttb2RlPSdcIiArIGN1cnJlbnQgKyBcIiddXCIpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgIGlmIChjdXJyZW50ID09IFwidGltZVwiKSB7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLndvcmRDb3VudFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAudGltZVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAuY3VzdG9tVGV4dFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiN0b3AgLmNvbmZpZyAucHVuY3R1YXRpb25Nb2RlXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICQoXCIjdG9wIC5jb25maWcgLm51bWJlcnNNb2RlXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLnB1bmNBbmROdW1cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAucHVuY3R1YXRpb25Nb2RlXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5udW1iZXJzTW9kZVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAucXVvdGVMZW5ndGhcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGN1cnJlbnQgPT0gXCJ3b3Jkc1wiKSB7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLndvcmRDb3VudFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAudGltZVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAuY3VzdG9tVGV4dFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiN0b3AgLmNvbmZpZyAucHVuY3R1YXRpb25Nb2RlXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICQoXCIjdG9wIC5jb25maWcgLm51bWJlcnNNb2RlXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLnB1bmNBbmROdW1cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAucHVuY3R1YXRpb25Nb2RlXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5udW1iZXJzTW9kZVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAucXVvdGVMZW5ndGhcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGN1cnJlbnQgPT0gXCJjdXN0b21cIikge1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC53b3JkQ291bnRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLnRpbWVcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLmN1c3RvbVRleHRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjdG9wIC5jb25maWcgLnB1bmN0dWF0aW9uTW9kZVwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAkKFwiI3RvcCAuY29uZmlnIC5udW1iZXJzTW9kZVwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5wdW5jQW5kTnVtXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLnB1bmN0dWF0aW9uTW9kZVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAubnVtYmVyc01vZGVcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLnF1b3RlTGVuZ3RoXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjdXJyZW50ID09IFwicXVvdGVcIikge1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC53b3JkQ291bnRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLnRpbWVcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLmN1c3RvbVRleHRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjdG9wIC5jb25maWcgLnB1bmN0dWF0aW9uTW9kZVwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAkKFwiI3RvcCAuY29uZmlnIC5udW1iZXJzTW9kZVwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5wdW5jQW5kTnVtXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLnB1bmN0dWF0aW9uTW9kZVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAubnVtYmVyc01vZGVcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIC8vICQoXCIjcmVzdWx0IC5zdGF0cyAuc291cmNlXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5xdW90ZUxlbmd0aFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY3VycmVudCA9PSBcInplblwiKSB7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLndvcmRDb3VudFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAudGltZVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAuY3VzdG9tVGV4dFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAucHVuY3R1YXRpb25Nb2RlXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5udW1iZXJzTW9kZVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAucXVvdGVMZW5ndGhcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGNvbnN0IHN1Ym1lbnUgPSB7XG4gICAgICAgIHRpbWU6IFwidGltZVwiLFxuICAgICAgICB3b3JkczogXCJ3b3JkQ291bnRcIixcbiAgICAgICAgY3VzdG9tOiBcImN1c3RvbVRleHRcIixcbiAgICAgICAgcXVvdGU6IFwicXVvdGVMZW5ndGhcIixcbiAgICAgICAgemVuOiBcIlwiLFxuICAgIH07XG4gICAgY29uc3QgYW5pbVRpbWUgPSAyNTA7XG4gICAgaWYgKGN1cnJlbnQgPT0gXCJ6ZW5cIikge1xuICAgICAgICAkKGAjdG9wIC5jb25maWcgLiR7c3VibWVudVtwcmV2aW91c119YCkuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCBhbmltVGltZSAvIDIsICgpID0+IHtcbiAgICAgICAgICAgICQoYCN0b3AgLmNvbmZpZyAuJHtzdWJtZW51W3ByZXZpb3VzXX1gKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgICAgICQoYCN0b3AgLmNvbmZpZyAucHVuY0FuZE51bWApLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgYW5pbVRpbWUgLyAyLCAoKSA9PiB7XG4gICAgICAgICAgICAkKGAjdG9wIC5jb25maWcgLnB1bmNBbmROdW1gKS5hZGRDbGFzcyhcImludmlzaWJsZVwiKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHByZXZpb3VzID09IFwiemVuXCIpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAkKGAjdG9wIC5jb25maWcgLiR7c3VibWVudVtjdXJyZW50XX1gKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoYCN0b3AgLmNvbmZpZyAuJHtzdWJtZW51W2N1cnJlbnRdfWApXG4gICAgICAgICAgICAgICAgLmNzcyh7IG9wYWNpdHk6IDAgfSlcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIH0sIGFuaW1UaW1lIC8gMik7XG4gICAgICAgICAgICAkKGAjdG9wIC5jb25maWcgLnB1bmNBbmROdW1gKS5yZW1vdmVDbGFzcyhcImludmlzaWJsZVwiKTtcbiAgICAgICAgICAgICQoYCN0b3AgLmNvbmZpZyAucHVuY0FuZE51bWApXG4gICAgICAgICAgICAgICAgLmNzcyh7IG9wYWNpdHk6IDAgfSlcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIH0sIGFuaW1UaW1lIC8gMik7XG4gICAgICAgIH0sIGFuaW1UaW1lIC8gMik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgTWlzYy5zd2FwRWxlbWVudHMoJChcIiN0b3AgLmNvbmZpZyAuXCIgKyBzdWJtZW51W3ByZXZpb3VzXSksICQoXCIjdG9wIC5jb25maWcgLlwiICsgc3VibWVudVtjdXJyZW50XSksIGFuaW1UaW1lKTtcbn1cbmV4cG9ydHMudXBkYXRlID0gdXBkYXRlO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSwgZXZlbnRWYWx1ZSwgX25vc2F2ZSwgZXZlbnRQcmV2aW91c1ZhbHVlKSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcIm1vZGVcIikge1xuICAgICAgICB1cGRhdGUoZXZlbnRQcmV2aW91c1ZhbHVlLCBldmVudFZhbHVlKTtcbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnJlc3RhcnQgPSBleHBvcnRzLnB1c2hCdXJzdFRvSGlzdG9yeSA9IGV4cG9ydHMucHVzaFRvUmF3SGlzdG9yeSA9IGV4cG9ydHMucHVzaFRvV3BtSGlzdG9yeSA9IGV4cG9ydHMucHVzaE1pc3NlZFdvcmQgPSBleHBvcnRzLnJlc2V0S2V5cHJlc3NUaW1pbmdzID0gZXhwb3J0cy5yZWNvcmRLZXlwcmVzc1NwYWNpbmcgPSBleHBvcnRzLnNldEtleXByZXNzRHVyYXRpb24gPSBleHBvcnRzLnB1c2hLZXlwcmVzc0R1cmF0aW9uID0gZXhwb3J0cy5zZXRLZXlwcmVzc1RpbWluZ3NUb29Mb25nID0gZXhwb3J0cy5pbmNyZW1lbnRBY2N1cmFjeSA9IGV4cG9ydHMucHVzaEtleXByZXNzZXNUb0hpc3RvcnkgPSBleHBvcnRzLnNldEJ1cnN0U3RhcnQgPSBleHBvcnRzLnB1c2hLZXlwcmVzc1dvcmQgPSBleHBvcnRzLmluY3JlbWVudEtleXByZXNzRXJyb3JzID0gZXhwb3J0cy5zZXRLZXlwcmVzc05vdEFmayA9IGV4cG9ydHMuaW5jcmVtZW50S2V5cHJlc3NDb3VudCA9IGV4cG9ydHMudXBkYXRlTGFzdEtleXByZXNzID0gZXhwb3J0cy5lbmFibGVTcGFjaW5nRGVidWcgPSBleHBvcnRzLnNwYWNpbmdEZWJ1ZyA9IGV4cG9ydHMuc2V0QmFpbG91dCA9IGV4cG9ydHMuYmFpbG91dCA9IGV4cG9ydHMuYnVyc3RIaXN0b3J5ID0gZXhwb3J0cy5yYXdIaXN0b3J5ID0gZXhwb3J0cy53cG1IaXN0b3J5ID0gZXhwb3J0cy5rZXlwcmVzc1RpbWluZ3MgPSBleHBvcnRzLmFjY3VyYWN5ID0gZXhwb3J0cy5taXNzZWRXb3JkcyA9IGV4cG9ydHMuY3VycmVudEJ1cnN0U3RhcnQgPSBleHBvcnRzLmxhc3RLZXlwcmVzcyA9IGV4cG9ydHMuY3VycmVudEtleXByZXNzID0gZXhwb3J0cy5rZXlwcmVzc1BlclNlY29uZCA9IGV4cG9ydHMuY29ycmVjdGVkID0gZXhwb3J0cy5pbnB1dCA9IHZvaWQgMDtcbmNvbnN0IFRlc3RXb3JkcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXdvcmRzXCIpKTtcbmNvbnN0IG1pc2NfMSA9IHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpO1xuY2xhc3MgSW5wdXQge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmN1cnJlbnQgPSBcIlwiO1xuICAgICAgICB0aGlzLmhpc3RvcnkgPSBbXTtcbiAgICAgICAgdGhpcy5oaXN0b3J5TGVuZ3RoID0gMDtcbiAgICAgICAgdGhpcy5sZW5ndGggPSAwO1xuICAgIH1cbiAgICByZXNldCgpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50ID0gXCJcIjtcbiAgICAgICAgdGhpcy5oaXN0b3J5ID0gW107XG4gICAgICAgIHRoaXMubGVuZ3RoID0gMDtcbiAgICB9XG4gICAgcmVzZXRIaXN0b3J5KCkge1xuICAgICAgICB0aGlzLmhpc3RvcnkgPSBbXTtcbiAgICAgICAgdGhpcy5sZW5ndGggPSAwO1xuICAgIH1cbiAgICBzZXRDdXJyZW50KHZhbCkge1xuICAgICAgICB0aGlzLmN1cnJlbnQgPSB2YWw7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gdGhpcy5jdXJyZW50Lmxlbmd0aDtcbiAgICB9XG4gICAgYXBwZW5kQ3VycmVudCh2YWwpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50ICs9IHZhbDtcbiAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLmN1cnJlbnQubGVuZ3RoO1xuICAgIH1cbiAgICByZXNldEN1cnJlbnQoKSB7XG4gICAgICAgIHRoaXMuY3VycmVudCA9IFwiXCI7XG4gICAgfVxuICAgIGdldEN1cnJlbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnQ7XG4gICAgfVxuICAgIHB1c2hIaXN0b3J5KCkge1xuICAgICAgICB0aGlzLmhpc3RvcnkucHVzaCh0aGlzLmN1cnJlbnQpO1xuICAgICAgICB0aGlzLmhpc3RvcnlMZW5ndGggPSB0aGlzLmhpc3RvcnkubGVuZ3RoO1xuICAgICAgICB0aGlzLnJlc2V0Q3VycmVudCgpO1xuICAgIH1cbiAgICBwb3BIaXN0b3J5KCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHJldCA9IChfYSA9IHRoaXMuaGlzdG9yeS5wb3AoKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCJcIjtcbiAgICAgICAgdGhpcy5oaXN0b3J5TGVuZ3RoID0gdGhpcy5oaXN0b3J5Lmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9XG4gICAgZ2V0SGlzdG9yeShpKSB7XG4gICAgICAgIGlmIChpID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmhpc3Rvcnk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5oaXN0b3J5W2ldO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldEhpc3RvcnlMYXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5oaXN0b3J5W3RoaXMuaGlzdG9yeS5sZW5ndGggLSAxXTtcbiAgICB9XG59XG5jbGFzcyBDb3JyZWN0ZWQge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmN1cnJlbnQgPSBcIlwiO1xuICAgICAgICB0aGlzLmhpc3RvcnkgPSBbXTtcbiAgICB9XG4gICAgc2V0Q3VycmVudCh2YWwpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50ID0gdmFsO1xuICAgIH1cbiAgICBhcHBlbmRDdXJyZW50KHZhbCkge1xuICAgICAgICB0aGlzLmN1cnJlbnQgKz0gdmFsO1xuICAgIH1cbiAgICByZXNldEN1cnJlbnQoKSB7XG4gICAgICAgIHRoaXMuY3VycmVudCA9IFwiXCI7XG4gICAgfVxuICAgIHJlc2V0SGlzdG9yeSgpIHtcbiAgICAgICAgdGhpcy5oaXN0b3J5ID0gW107XG4gICAgfVxuICAgIHJlc2V0KCkge1xuICAgICAgICB0aGlzLnJlc2V0Q3VycmVudCgpO1xuICAgICAgICB0aGlzLnJlc2V0SGlzdG9yeSgpO1xuICAgIH1cbiAgICBnZXRIaXN0b3J5KGkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGlzdG9yeVtpXTtcbiAgICB9XG4gICAgcG9wSGlzdG9yeSgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICByZXR1cm4gKF9hID0gdGhpcy5oaXN0b3J5LnBvcCgpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIlwiO1xuICAgIH1cbiAgICBwdXNoSGlzdG9yeSgpIHtcbiAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2godGhpcy5jdXJyZW50KTtcbiAgICAgICAgdGhpcy5jdXJyZW50ID0gXCJcIjtcbiAgICB9XG59XG5leHBvcnRzLmlucHV0ID0gbmV3IElucHV0KCk7XG5leHBvcnRzLmNvcnJlY3RlZCA9IG5ldyBDb3JyZWN0ZWQoKTtcbmV4cG9ydHMua2V5cHJlc3NQZXJTZWNvbmQgPSBbXTtcbmV4cG9ydHMuY3VycmVudEtleXByZXNzID0ge1xuICAgIGNvdW50OiAwLFxuICAgIGVycm9yczogMCxcbiAgICB3b3JkczogW10sXG4gICAgYWZrOiB0cnVlLFxufTtcbmV4cG9ydHMuY3VycmVudEJ1cnN0U3RhcnQgPSAwO1xuZXhwb3J0cy5taXNzZWRXb3JkcyA9IHt9O1xuZXhwb3J0cy5hY2N1cmFjeSA9IHtcbiAgICBjb3JyZWN0OiAwLFxuICAgIGluY29ycmVjdDogMCxcbn07XG5leHBvcnRzLmtleXByZXNzVGltaW5ncyA9IHtcbiAgICBzcGFjaW5nOiB7XG4gICAgICAgIGN1cnJlbnQ6IC0xLFxuICAgICAgICBhcnJheTogW10sXG4gICAgfSxcbiAgICBkdXJhdGlvbjoge1xuICAgICAgICBjdXJyZW50OiAtMSxcbiAgICAgICAgYXJyYXk6IFtdLFxuICAgIH0sXG59O1xuZXhwb3J0cy53cG1IaXN0b3J5ID0gW107XG5leHBvcnRzLnJhd0hpc3RvcnkgPSBbXTtcbmV4cG9ydHMuYnVyc3RIaXN0b3J5ID0gW107XG5leHBvcnRzLmJhaWxvdXQgPSBmYWxzZTtcbmZ1bmN0aW9uIHNldEJhaWxvdXQodGYpIHtcbiAgICBleHBvcnRzLmJhaWxvdXQgPSB0Zjtcbn1cbmV4cG9ydHMuc2V0QmFpbG91dCA9IHNldEJhaWxvdXQ7XG5leHBvcnRzLnNwYWNpbmdEZWJ1ZyA9IGZhbHNlO1xuZnVuY3Rpb24gZW5hYmxlU3BhY2luZ0RlYnVnKCkge1xuICAgIGV4cG9ydHMuc3BhY2luZ0RlYnVnID0gdHJ1ZTtcbiAgICBjb25zb2xlLmNsZWFyKCk7XG59XG5leHBvcnRzLmVuYWJsZVNwYWNpbmdEZWJ1ZyA9IGVuYWJsZVNwYWNpbmdEZWJ1ZztcbmZ1bmN0aW9uIHVwZGF0ZUxhc3RLZXlwcmVzcygpIHtcbiAgICBleHBvcnRzLmxhc3RLZXlwcmVzcyA9IHBlcmZvcm1hbmNlLm5vdygpO1xufVxuZXhwb3J0cy51cGRhdGVMYXN0S2V5cHJlc3MgPSB1cGRhdGVMYXN0S2V5cHJlc3M7XG5mdW5jdGlvbiBpbmNyZW1lbnRLZXlwcmVzc0NvdW50KCkge1xuICAgIGV4cG9ydHMuY3VycmVudEtleXByZXNzLmNvdW50Kys7XG59XG5leHBvcnRzLmluY3JlbWVudEtleXByZXNzQ291bnQgPSBpbmNyZW1lbnRLZXlwcmVzc0NvdW50O1xuZnVuY3Rpb24gc2V0S2V5cHJlc3NOb3RBZmsoKSB7XG4gICAgZXhwb3J0cy5jdXJyZW50S2V5cHJlc3MuYWZrID0gZmFsc2U7XG59XG5leHBvcnRzLnNldEtleXByZXNzTm90QWZrID0gc2V0S2V5cHJlc3NOb3RBZms7XG5mdW5jdGlvbiBpbmNyZW1lbnRLZXlwcmVzc0Vycm9ycygpIHtcbiAgICBleHBvcnRzLmN1cnJlbnRLZXlwcmVzcy5lcnJvcnMrKztcbn1cbmV4cG9ydHMuaW5jcmVtZW50S2V5cHJlc3NFcnJvcnMgPSBpbmNyZW1lbnRLZXlwcmVzc0Vycm9ycztcbmZ1bmN0aW9uIHB1c2hLZXlwcmVzc1dvcmQod29yZEluZGV4KSB7XG4gICAgZXhwb3J0cy5jdXJyZW50S2V5cHJlc3Mud29yZHMucHVzaCh3b3JkSW5kZXgpO1xufVxuZXhwb3J0cy5wdXNoS2V5cHJlc3NXb3JkID0gcHVzaEtleXByZXNzV29yZDtcbmZ1bmN0aW9uIHNldEJ1cnN0U3RhcnQodGltZSkge1xuICAgIGV4cG9ydHMuY3VycmVudEJ1cnN0U3RhcnQgPSB0aW1lO1xufVxuZXhwb3J0cy5zZXRCdXJzdFN0YXJ0ID0gc2V0QnVyc3RTdGFydDtcbmZ1bmN0aW9uIHB1c2hLZXlwcmVzc2VzVG9IaXN0b3J5KCkge1xuICAgIGV4cG9ydHMua2V5cHJlc3NQZXJTZWNvbmQucHVzaChleHBvcnRzLmN1cnJlbnRLZXlwcmVzcyk7XG4gICAgZXhwb3J0cy5jdXJyZW50S2V5cHJlc3MgPSB7XG4gICAgICAgIGNvdW50OiAwLFxuICAgICAgICBlcnJvcnM6IDAsXG4gICAgICAgIHdvcmRzOiBbXSxcbiAgICAgICAgYWZrOiB0cnVlLFxuICAgIH07XG59XG5leHBvcnRzLnB1c2hLZXlwcmVzc2VzVG9IaXN0b3J5ID0gcHVzaEtleXByZXNzZXNUb0hpc3Rvcnk7XG5mdW5jdGlvbiBpbmNyZW1lbnRBY2N1cmFjeShjb3JyZWN0aW5jb3JyZWN0KSB7XG4gICAgaWYgKGNvcnJlY3RpbmNvcnJlY3QpIHtcbiAgICAgICAgZXhwb3J0cy5hY2N1cmFjeS5jb3JyZWN0Kys7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBleHBvcnRzLmFjY3VyYWN5LmluY29ycmVjdCsrO1xuICAgIH1cbn1cbmV4cG9ydHMuaW5jcmVtZW50QWNjdXJhY3kgPSBpbmNyZW1lbnRBY2N1cmFjeTtcbmZ1bmN0aW9uIHNldEtleXByZXNzVGltaW5nc1Rvb0xvbmcoKSB7XG4gICAgZXhwb3J0cy5rZXlwcmVzc1RpbWluZ3Muc3BhY2luZy5hcnJheSA9IFwidG9vbG9uZ1wiO1xuICAgIGV4cG9ydHMua2V5cHJlc3NUaW1pbmdzLmR1cmF0aW9uLmFycmF5ID0gXCJ0b29sb25nXCI7XG59XG5leHBvcnRzLnNldEtleXByZXNzVGltaW5nc1Rvb0xvbmcgPSBzZXRLZXlwcmVzc1RpbWluZ3NUb29Mb25nO1xuZnVuY3Rpb24gcHVzaEtleXByZXNzRHVyYXRpb24odmFsKSB7XG4gICAgZXhwb3J0cy5rZXlwcmVzc1RpbWluZ3MuZHVyYXRpb24uYXJyYXkucHVzaCgoMCwgbWlzY18xLnJvdW5kVG8yKSh2YWwpKTtcbn1cbmV4cG9ydHMucHVzaEtleXByZXNzRHVyYXRpb24gPSBwdXNoS2V5cHJlc3NEdXJhdGlvbjtcbmZ1bmN0aW9uIHNldEtleXByZXNzRHVyYXRpb24odmFsKSB7XG4gICAgZXhwb3J0cy5rZXlwcmVzc1RpbWluZ3MuZHVyYXRpb24uY3VycmVudCA9ICgwLCBtaXNjXzEucm91bmRUbzIpKHZhbCk7XG59XG5leHBvcnRzLnNldEtleXByZXNzRHVyYXRpb24gPSBzZXRLZXlwcmVzc0R1cmF0aW9uO1xuZnVuY3Rpb24gcHVzaEtleXByZXNzU3BhY2luZyh2YWwpIHtcbiAgICBleHBvcnRzLmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmFycmF5LnB1c2goKDAsIG1pc2NfMS5yb3VuZFRvMikodmFsKSk7XG59XG5mdW5jdGlvbiBzZXRLZXlwcmVzc1NwYWNpbmcodmFsKSB7XG4gICAgZXhwb3J0cy5rZXlwcmVzc1RpbWluZ3Muc3BhY2luZy5jdXJyZW50ID0gKDAsIG1pc2NfMS5yb3VuZFRvMikodmFsKTtcbn1cbmZ1bmN0aW9uIHJlY29yZEtleXByZXNzU3BhY2luZygpIHtcbiAgICBjb25zdCBub3cgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICBjb25zdCBkaWZmID0gTWF0aC5hYnMoZXhwb3J0cy5rZXlwcmVzc1RpbWluZ3Muc3BhY2luZy5jdXJyZW50IC0gbm93KTtcbiAgICBpZiAoZXhwb3J0cy5rZXlwcmVzc1RpbWluZ3Muc3BhY2luZy5jdXJyZW50ICE9PSAtMSkge1xuICAgICAgICBwdXNoS2V5cHJlc3NTcGFjaW5nKGRpZmYpO1xuICAgICAgICBpZiAoZXhwb3J0cy5zcGFjaW5nRGVidWcpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic3BhY2luZyBkZWJ1Z1wiLCBcInB1c2hcIiwgZGlmZiwgXCJsZW5ndGhcIiwgZXhwb3J0cy5rZXlwcmVzc1RpbWluZ3Muc3BhY2luZy5hcnJheS5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNldEtleXByZXNzU3BhY2luZyhub3cpO1xuICAgIGlmIChleHBvcnRzLnNwYWNpbmdEZWJ1Zykge1xuICAgICAgICBjb25zb2xlLmxvZyhcInNwYWNpbmcgZGVidWdcIiwgXCJzZXRcIiwgbm93LCBcImxlbmd0aFwiLCBleHBvcnRzLmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmFycmF5Lmxlbmd0aCk7XG4gICAgfVxuICAgIGlmIChleHBvcnRzLnNwYWNpbmdEZWJ1Zykge1xuICAgICAgICBjb25zb2xlLmxvZyhcInNwYWNpbmcgZGVidWdcIiwgXCJyZWNvcmRlZFwiLCBcImxlbmd0aFwiLCBleHBvcnRzLmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmFycmF5Lmxlbmd0aCk7XG4gICAgfVxufVxuZXhwb3J0cy5yZWNvcmRLZXlwcmVzc1NwYWNpbmcgPSByZWNvcmRLZXlwcmVzc1NwYWNpbmc7XG5mdW5jdGlvbiByZXNldEtleXByZXNzVGltaW5ncygpIHtcbiAgICBleHBvcnRzLmtleXByZXNzVGltaW5ncyA9IHtcbiAgICAgICAgc3BhY2luZzoge1xuICAgICAgICAgICAgY3VycmVudDogcGVyZm9ybWFuY2Uubm93KCksXG4gICAgICAgICAgICBhcnJheTogW10sXG4gICAgICAgIH0sXG4gICAgICAgIGR1cmF0aW9uOiB7XG4gICAgICAgICAgICBjdXJyZW50OiBwZXJmb3JtYW5jZS5ub3coKSxcbiAgICAgICAgICAgIGFycmF5OiBbXSxcbiAgICAgICAgfSxcbiAgICB9O1xuICAgIGlmIChleHBvcnRzLnNwYWNpbmdEZWJ1ZylcbiAgICAgICAgY29uc29sZS5jbGVhcigpO1xufVxuZXhwb3J0cy5yZXNldEtleXByZXNzVGltaW5ncyA9IHJlc2V0S2V5cHJlc3NUaW1pbmdzO1xuZnVuY3Rpb24gcHVzaE1pc3NlZFdvcmQod29yZCkge1xuICAgIGlmICghT2JqZWN0LmtleXMoZXhwb3J0cy5taXNzZWRXb3JkcykuaW5jbHVkZXMod29yZCkpIHtcbiAgICAgICAgZXhwb3J0cy5taXNzZWRXb3Jkc1t3b3JkXSA9IDE7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBleHBvcnRzLm1pc3NlZFdvcmRzW3dvcmRdKys7XG4gICAgfVxufVxuZXhwb3J0cy5wdXNoTWlzc2VkV29yZCA9IHB1c2hNaXNzZWRXb3JkO1xuZnVuY3Rpb24gcHVzaFRvV3BtSGlzdG9yeSh3cG0pIHtcbiAgICBleHBvcnRzLndwbUhpc3RvcnkucHVzaCh3cG0pO1xufVxuZXhwb3J0cy5wdXNoVG9XcG1IaXN0b3J5ID0gcHVzaFRvV3BtSGlzdG9yeTtcbmZ1bmN0aW9uIHB1c2hUb1Jhd0hpc3RvcnkocmF3KSB7XG4gICAgZXhwb3J0cy5yYXdIaXN0b3J5LnB1c2gocmF3KTtcbn1cbmV4cG9ydHMucHVzaFRvUmF3SGlzdG9yeSA9IHB1c2hUb1Jhd0hpc3Rvcnk7XG5mdW5jdGlvbiBwdXNoQnVyc3RUb0hpc3Rvcnkoc3BlZWQpIHtcbiAgICBpZiAoZXhwb3J0cy5idXJzdEhpc3RvcnlbVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBleHBvcnRzLmJ1cnN0SGlzdG9yeS5wdXNoKHNwZWVkKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vcmVwZWF0ZWQgd29yZCAtIG92ZXJyaWRlXG4gICAgICAgIGV4cG9ydHMuYnVyc3RIaXN0b3J5W1Rlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXhdID0gc3BlZWQ7XG4gICAgfVxufVxuZXhwb3J0cy5wdXNoQnVyc3RUb0hpc3RvcnkgPSBwdXNoQnVyc3RUb0hpc3Rvcnk7XG5mdW5jdGlvbiByZXN0YXJ0KCkge1xuICAgIGV4cG9ydHMud3BtSGlzdG9yeSA9IFtdO1xuICAgIGV4cG9ydHMucmF3SGlzdG9yeSA9IFtdO1xuICAgIGV4cG9ydHMuYnVyc3RIaXN0b3J5ID0gW107XG4gICAgZXhwb3J0cy5rZXlwcmVzc1BlclNlY29uZCA9IFtdO1xuICAgIGV4cG9ydHMuY3VycmVudEtleXByZXNzID0ge1xuICAgICAgICBjb3VudDogMCxcbiAgICAgICAgZXJyb3JzOiAwLFxuICAgICAgICB3b3JkczogW10sXG4gICAgICAgIGFmazogdHJ1ZSxcbiAgICB9O1xuICAgIGV4cG9ydHMuY3VycmVudEJ1cnN0U3RhcnQgPSAwO1xuICAgIGV4cG9ydHMubWlzc2VkV29yZHMgPSB7fTtcbiAgICBleHBvcnRzLmFjY3VyYWN5ID0ge1xuICAgICAgICBjb3JyZWN0OiAwLFxuICAgICAgICBpbmNvcnJlY3Q6IDAsXG4gICAgfTtcbiAgICBleHBvcnRzLmtleXByZXNzVGltaW5ncyA9IHtcbiAgICAgICAgc3BhY2luZzoge1xuICAgICAgICAgICAgY3VycmVudDogLTEsXG4gICAgICAgICAgICBhcnJheTogW10sXG4gICAgICAgIH0sXG4gICAgICAgIGR1cmF0aW9uOiB7XG4gICAgICAgICAgICBjdXJyZW50OiAtMSxcbiAgICAgICAgICAgIGFycmF5OiBbXSxcbiAgICAgICAgfSxcbiAgICB9O1xufVxuZXhwb3J0cy5yZXN0YXJ0ID0gcmVzdGFydDtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZmFpbCA9IGV4cG9ydHMuZmluaXNoID0gZXhwb3J0cy5yZXRyeVNhdmluZ1Jlc3VsdCA9IGV4cG9ydHMuYWRkV29yZCA9IGV4cG9ydHMuaW5pdCA9IGV4cG9ydHMucmVzdGFydCA9IGV4cG9ydHMuc3RhcnRUZXN0ID0gZXhwb3J0cy5wdW5jdHVhdGVXb3JkID0gZXhwb3J0cy5zZXROb3RTaWduZWRJblVpZCA9IGV4cG9ydHMuY2xlYXJOb3RTaWduZWRJblJlc3VsdCA9IGV4cG9ydHMubm90U2lnbmVkSW5MYXN0UmVzdWx0ID0gdm9pZCAwO1xuY29uc3QgYXBlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2FwZVwiKSk7XG5jb25zdCBUZXN0VUkgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC11aVwiKSk7XG5jb25zdCBNYW51YWxSZXN0YXJ0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL21hbnVhbC1yZXN0YXJ0LXRyYWNrZXJcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBxdW90ZXNfY29udHJvbGxlcl8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9xdW90ZXMtY29udHJvbGxlclwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IEN1c3RvbVRleHQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY3VzdG9tLXRleHRcIikpO1xuY29uc3QgVGVzdFN0YXRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtc3RhdHNcIikpO1xuY29uc3QgUHJhY3Rpc2VXb3JkcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9wcmFjdGlzZS13b3Jkc1wiKSk7XG5jb25zdCBTaGlmdFRyYWNrZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vc2hpZnQtdHJhY2tlclwiKSk7XG5jb25zdCBGb2N1cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9mb2N1c1wiKSk7XG5jb25zdCBGdW5ib3ggPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vZnVuYm94XCIpKTtcbmNvbnN0IEtleW1hcCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMva2V5bWFwXCIpKTtcbmNvbnN0IFRoZW1lQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvdGhlbWUtY29udHJvbGxlclwiKSk7XG5jb25zdCBQYWNlQ2FyZXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vcGFjZS1jYXJldFwiKSk7XG5jb25zdCBDYXJldCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jYXJldFwiKSk7XG5jb25zdCBMaXZlV3BtID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2xpdmUtd3BtXCIpKTtcbmNvbnN0IExpdmVBY2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbGl2ZS1hY2NcIikpO1xuY29uc3QgTGl2ZUJ1cnN0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2xpdmUtYnVyc3RcIikpO1xuY29uc3QgVGltZXJQcm9ncmVzcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90aW1lci1wcm9ncmVzc1wiKSk7XG5jb25zdCBRdW90ZVNlYXJjaFBvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wb3B1cHMvcXVvdGUtc2VhcmNoLXBvcHVwXCIpKTtcbmNvbnN0IFF1b3RlU3VibWl0UG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BvcHVwcy9xdW90ZS1zdWJtaXQtcG9wdXBcIikpO1xuY29uc3QgUGJDcm93biA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9wYi1jcm93blwiKSk7XG5jb25zdCBUZXN0VGltZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC10aW1lclwiKSk7XG5jb25zdCBPdXRPZkZvY3VzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL291dC1vZi1mb2N1c1wiKSk7XG5jb25zdCBBY2NvdW50QnV0dG9uID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9hY2NvdW50LWJ1dHRvblwiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgUmVwbGF5ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3JlcGxheVwiKSk7XG5jb25zdCBQb2V0cnkgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vcG9ldHJ5XCIpKTtcbmNvbnN0IFdpa2lwZWRpYSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi93aWtpcGVkaWFcIikpO1xuY29uc3QgVG9kYXlUcmFja2VyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3RvZGF5LXRyYWNrZXJcIikpO1xuY29uc3QgV2Vha1Nwb3QgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vd2Vhay1zcG90XCIpKTtcbmNvbnN0IFdvcmRzZXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vd29yZHNldFwiKSk7XG5jb25zdCBDaGFsbGVuZ2VDb250b2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL2NoYWxsZW5nZS1jb250cm9sbGVyXCIpKTtcbmNvbnN0IFF1b3RlUmF0ZVBvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wb3B1cHMvcXVvdGUtcmF0ZS1wb3B1cFwiKSk7XG5jb25zdCBCcml0aXNoRW5nbGlzaCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9icml0aXNoLWVuZ2xpc2hcIikpO1xuY29uc3QgTGF6eU1vZGUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbGF6eS1tb2RlXCIpKTtcbmNvbnN0IFJlc3VsdCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9yZXN1bHRcIikpO1xuY29uc3QgTW9ua2V5UG93ZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL21vbmtleS1wb3dlclwiKSk7XG5jb25zdCBBY3RpdmVQYWdlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvYWN0aXZlLXBhZ2VcIikpO1xuY29uc3QgVGVzdEFjdGl2ZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3Rlc3QtYWN0aXZlXCIpKTtcbmNvbnN0IFRlc3RJbnB1dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LWlucHV0XCIpKTtcbmNvbnN0IFRlc3RXb3JkcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXdvcmRzXCIpKTtcbmNvbnN0IFRlc3RTdGF0ZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXN0YXRlXCIpKTtcbmNvbnN0IE1vZGVzTm90aWNlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9tb2Rlcy1ub3RpY2VcIikpO1xuY29uc3QgUGFnZVRyYW5zaXRpb24gPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9wYWdlLXRyYW5zaXRpb25cIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBUaW1lckV2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy90aW1lci1ldmVudFwiKSk7XG5jb25zdCBSZXNldFJlcXVlc3RlZEV2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9yZXNldC1yZXF1ZXN0ZWQtZXZlbnRcIikpO1xuY29uc3QgTGFzdDEwQXZlcmFnZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbGFzdC0xMC1hdmVyYWdlXCIpKTtcbmNvbnN0IE1vbmtleSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9tb25rZXlcIikpO1xuY29uc3QgdGJkX21vZGVfMSA9IHJlcXVpcmUoXCIuL3RiZC1tb2RlXCIpO1xuY29uc3Qgb2JqZWN0X2hhc2hfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwib2JqZWN0LWhhc2hcIikpO1xuY29uc3QgQW5hbHl0aWNzQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvYW5hbHl0aWNzLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuLi9maXJlYmFzZVwiKTtcbmxldCBmYWlsUmVhc29uID0gXCJcIjtcbmV4cG9ydHMubm90U2lnbmVkSW5MYXN0UmVzdWx0ID0gbnVsbDtcbmZ1bmN0aW9uIGNsZWFyTm90U2lnbmVkSW5SZXN1bHQoKSB7XG4gICAgZXhwb3J0cy5ub3RTaWduZWRJbkxhc3RSZXN1bHQgPSBudWxsO1xufVxuZXhwb3J0cy5jbGVhck5vdFNpZ25lZEluUmVzdWx0ID0gY2xlYXJOb3RTaWduZWRJblJlc3VsdDtcbmZ1bmN0aW9uIHNldE5vdFNpZ25lZEluVWlkKHVpZCkge1xuICAgIGlmIChleHBvcnRzLm5vdFNpZ25lZEluTGFzdFJlc3VsdCA9PT0gbnVsbClcbiAgICAgICAgcmV0dXJuO1xuICAgIGV4cG9ydHMubm90U2lnbmVkSW5MYXN0UmVzdWx0LnVpZCA9IHVpZDtcbiAgICBkZWxldGUgZXhwb3J0cy5ub3RTaWduZWRJbkxhc3RSZXN1bHQuaGFzaDtcbiAgICBleHBvcnRzLm5vdFNpZ25lZEluTGFzdFJlc3VsdC5oYXNoID0gKDAsIG9iamVjdF9oYXNoXzEuZGVmYXVsdCkoZXhwb3J0cy5ub3RTaWduZWRJbkxhc3RSZXN1bHQpO1xufVxuZXhwb3J0cy5zZXROb3RTaWduZWRJblVpZCA9IHNldE5vdFNpZ25lZEluVWlkO1xubGV0IHNwYW5pc2hTZW50ZW5jZVRyYWNrZXIgPSBcIlwiO1xuZnVuY3Rpb24gcHVuY3R1YXRlV29yZChwcmV2aW91c1dvcmQsIGN1cnJlbnRXb3JkLCBpbmRleCwgbWF4aW5kZXgpIHtcbiAgICBsZXQgd29yZCA9IGN1cnJlbnRXb3JkO1xuICAgIGNvbnN0IGN1cnJlbnRMYW5ndWFnZSA9IGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2Uuc3BsaXQoXCJfXCIpWzBdO1xuICAgIGNvbnN0IGxhc3RDaGFyID0gTWlzYy5nZXRMYXN0Q2hhcihwcmV2aW91c1dvcmQpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCI1ODAwOFwiKSB7XG4gICAgICAgIGlmIChjdXJyZW50V29yZC5sZW5ndGggPiAzKSB7XG4gICAgICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuNzUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzcGVjaWFsID0gW1wiL1wiLCBcIipcIiwgXCItXCIsIFwiK1wiXVtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0KV07XG4gICAgICAgICAgICAgICAgd29yZCA9IE1pc2Muc2V0Q2hhckF0KHdvcmQsIE1hdGguZmxvb3Iod29yZC5sZW5ndGggLyAyKSwgc3BlY2lhbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmICgoaW5kZXggPT0gMCB8fCBsYXN0Q2hhciA9PSBcIi5cIiB8fCBsYXN0Q2hhciA9PSBcIj9cIiB8fCBsYXN0Q2hhciA9PSBcIiFcIikgJiZcbiAgICAgICAgICAgIGN1cnJlbnRMYW5ndWFnZSAhPSBcImNvZGVcIikge1xuICAgICAgICAgICAgLy9hbHdheXMgY2FwaXRhbGlzZSB0aGUgZmlyc3Qgd29yZCBvciBpZiB0aGVyZSB3YXMgYSBkb3QgdW5sZXNzIHVzaW5nIGEgY29kZSBhbHBoYWJldFxuICAgICAgICAgICAgd29yZCA9IE1pc2MuY2FwaXRhbGl6ZUZpcnN0TGV0dGVyT2ZFYWNoV29yZCh3b3JkKTtcbiAgICAgICAgICAgIGlmIChjdXJyZW50TGFuZ3VhZ2UgPT0gXCJzcGFuaXNoXCIgfHwgY3VycmVudExhbmd1YWdlID09IFwiY2F0YWxhblwiKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmFuZCA9IE1hdGgucmFuZG9tKCk7XG4gICAgICAgICAgICAgICAgaWYgKHJhbmQgPiAwLjkpIHtcbiAgICAgICAgICAgICAgICAgICAgd29yZCA9IFwiwr9cIiArIHdvcmQ7XG4gICAgICAgICAgICAgICAgICAgIHNwYW5pc2hTZW50ZW5jZVRyYWNrZXIgPSBcIj9cIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocmFuZCA+IDAuOCkge1xuICAgICAgICAgICAgICAgICAgICB3b3JkID0gXCLCoVwiICsgd29yZDtcbiAgICAgICAgICAgICAgICAgICAgc3BhbmlzaFNlbnRlbmNlVHJhY2tlciA9IFwiIVwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICgoTWF0aC5yYW5kb20oKSA8IDAuMSAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCIuXCIgJiZcbiAgICAgICAgICAgIGxhc3RDaGFyICE9IFwiLFwiICYmXG4gICAgICAgICAgICBpbmRleCAhPSBtYXhpbmRleCAtIDIpIHx8XG4gICAgICAgICAgICBpbmRleCA9PSBtYXhpbmRleCAtIDEpIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50TGFuZ3VhZ2UgPT0gXCJzcGFuaXNoXCIgfHwgY3VycmVudExhbmd1YWdlID09IFwiY2F0YWxhblwiKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNwYW5pc2hTZW50ZW5jZVRyYWNrZXIgPT0gXCI/XCIgfHwgc3BhbmlzaFNlbnRlbmNlVHJhY2tlciA9PSBcIiFcIikge1xuICAgICAgICAgICAgICAgICAgICB3b3JkICs9IHNwYW5pc2hTZW50ZW5jZVRyYWNrZXI7XG4gICAgICAgICAgICAgICAgICAgIHNwYW5pc2hTZW50ZW5jZVRyYWNrZXIgPSBcIlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJhbmQgPSBNYXRoLnJhbmRvbSgpO1xuICAgICAgICAgICAgICAgIGlmIChyYW5kIDw9IDAuOCkge1xuICAgICAgICAgICAgICAgICAgICB3b3JkICs9IFwiLlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyYW5kID4gMC44ICYmIHJhbmQgPCAwLjkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcImZyZW5jaFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JkID0gXCI/XCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudExhbmd1YWdlID09IFwiYXJhYmljXCIgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMYW5ndWFnZSA9PSBcInBlcnNpYW5cIiB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExhbmd1YWdlID09IFwidXJkdVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JkICs9IFwi2J9cIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50TGFuZ3VhZ2UgPT0gXCJncmVla1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JkICs9IFwiO1wiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgd29yZCArPSBcIj9cIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcImZyZW5jaFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JkID0gXCIhXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JkICs9IFwiIVwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjAxICYmXG4gICAgICAgICAgICBsYXN0Q2hhciAhPSBcIixcIiAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCIuXCIgJiZcbiAgICAgICAgICAgIGN1cnJlbnRMYW5ndWFnZSAhPT0gXCJydXNzaWFuXCIpIHtcbiAgICAgICAgICAgIHdvcmQgPSBgXCIke3dvcmR9XCJgO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjAxMSAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCIsXCIgJiZcbiAgICAgICAgICAgIGxhc3RDaGFyICE9IFwiLlwiICYmXG4gICAgICAgICAgICBjdXJyZW50TGFuZ3VhZ2UgIT09IFwicnVzc2lhblwiICYmXG4gICAgICAgICAgICBjdXJyZW50TGFuZ3VhZ2UgIT09IFwidWtyYWluaWFuXCIpIHtcbiAgICAgICAgICAgIHdvcmQgPSBgJyR7d29yZH0nYDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChNYXRoLnJhbmRvbSgpIDwgMC4wMTIgJiYgbGFzdENoYXIgIT0gXCIsXCIgJiYgbGFzdENoYXIgIT0gXCIuXCIpIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50TGFuZ3VhZ2UgPT0gXCJjb2RlXCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gTWF0aC5yYW5kb20oKTtcbiAgICAgICAgICAgICAgICBpZiAociA8IDAuMjUpIHtcbiAgICAgICAgICAgICAgICAgICAgd29yZCA9IGAoJHt3b3JkfSlgO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyIDwgMC41KSB7XG4gICAgICAgICAgICAgICAgICAgIHdvcmQgPSBgeyR7d29yZH19YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAociA8IDAuNzUpIHtcbiAgICAgICAgICAgICAgICAgICAgd29yZCA9IGBbJHt3b3JkfV1gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgd29yZCA9IGA8JHt3b3JkfT5gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHdvcmQgPSBgKCR7d29yZH0pYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChNYXRoLnJhbmRvbSgpIDwgMC4wMTMgJiZcbiAgICAgICAgICAgIGxhc3RDaGFyICE9IFwiLFwiICYmXG4gICAgICAgICAgICBsYXN0Q2hhciAhPSBcIi5cIiAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCI7XCIgJiZcbiAgICAgICAgICAgIGxhc3RDaGFyICE9IFwi2JtcIiAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCI6XCIpIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50TGFuZ3VhZ2UgPT0gXCJmcmVuY2hcIikge1xuICAgICAgICAgICAgICAgIHdvcmQgPSBcIjpcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcImdyZWVrXCIpIHtcbiAgICAgICAgICAgICAgICB3b3JkID0gXCLCt1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgd29yZCArPSBcIjpcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChNYXRoLnJhbmRvbSgpIDwgMC4wMTQgJiZcbiAgICAgICAgICAgIGxhc3RDaGFyICE9IFwiLFwiICYmXG4gICAgICAgICAgICBsYXN0Q2hhciAhPSBcIi5cIiAmJlxuICAgICAgICAgICAgcHJldmlvdXNXb3JkICE9IFwiLVwiKSB7XG4gICAgICAgICAgICB3b3JkID0gXCItXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoTWF0aC5yYW5kb20oKSA8IDAuMDE1ICYmXG4gICAgICAgICAgICBsYXN0Q2hhciAhPSBcIixcIiAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCIuXCIgJiZcbiAgICAgICAgICAgIGxhc3RDaGFyICE9IFwiO1wiICYmXG4gICAgICAgICAgICBsYXN0Q2hhciAhPSBcItibXCIgJiZcbiAgICAgICAgICAgIGxhc3RDaGFyICE9IFwiOlwiKSB7XG4gICAgICAgICAgICBpZiAoY3VycmVudExhbmd1YWdlID09IFwiZnJlbmNoXCIpIHtcbiAgICAgICAgICAgICAgICB3b3JkID0gXCI7XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50TGFuZ3VhZ2UgPT0gXCJncmVla1wiKSB7XG4gICAgICAgICAgICAgICAgd29yZCA9IFwiwrdcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcImFyYWJpY1wiKSB7XG4gICAgICAgICAgICAgICAgd29yZCArPSBcItibXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB3b3JkICs9IFwiO1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjIgJiYgbGFzdENoYXIgIT0gXCIsXCIpIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50TGFuZ3VhZ2UgPT0gXCJhcmFiaWNcIiB8fFxuICAgICAgICAgICAgICAgIGN1cnJlbnRMYW5ndWFnZSA9PSBcInVyZHVcIiB8fFxuICAgICAgICAgICAgICAgIGN1cnJlbnRMYW5ndWFnZSA9PSBcInBlcnNpYW5cIikge1xuICAgICAgICAgICAgICAgIHdvcmQgKz0gXCLYjFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgd29yZCArPSBcIixcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChNYXRoLnJhbmRvbSgpIDwgMC4yNSAmJiBjdXJyZW50TGFuZ3VhZ2UgPT0gXCJjb2RlXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHNwZWNpYWxzID0gW1wie1wiLCBcIn1cIiwgXCJbXCIsIFwiXVwiLCBcIihcIiwgXCIpXCIsIFwiO1wiLCBcIj1cIiwgXCIrXCIsIFwiJVwiLCBcIi9cIl07XG4gICAgICAgICAgICB3b3JkID0gTWlzYy5yYW5kb21FbGVtZW50RnJvbUFycmF5KHNwZWNpYWxzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gd29yZDtcbn1cbmV4cG9ydHMucHVuY3R1YXRlV29yZCA9IHB1bmN0dWF0ZVdvcmQ7XG5mdW5jdGlvbiBzdGFydFRlc3QoKSB7XG4gICAgaWYgKFBhZ2VUcmFuc2l0aW9uLmdldCgpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKCFVcGRhdGVDb25maWcuZGJDb25maWdMb2FkZWQpIHtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldENoYW5nZWRCZWZvcmVEYih0cnVlKTtcbiAgICB9XG4gICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciAhPT0gbnVsbCkge1xuICAgICAgICBBbmFseXRpY3NDb250cm9sbGVyLmxvZyhcInRlc3RTdGFydGVkXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgQW5hbHl0aWNzQ29udHJvbGxlci5sb2coXCJ0ZXN0U3RhcnRlZE5vTG9naW5cIik7XG4gICAgfVxuICAgIFRlc3RBY3RpdmUuc2V0KHRydWUpO1xuICAgIFJlcGxheS5zdGFydFJlcGxheVJlY29yZGluZygpO1xuICAgIFJlcGxheS5yZXBsYXlHZXRXb3Jkc0xpc3QoVGVzdFdvcmRzLndvcmRzLmxpc3QpO1xuICAgIFRlc3RJbnB1dC5yZXNldEtleXByZXNzVGltaW5ncygpO1xuICAgIFRpbWVyUHJvZ3Jlc3MucmVzdGFydCgpO1xuICAgIFRpbWVyUHJvZ3Jlc3Muc2hvdygpO1xuICAgICQoXCIjbGl2ZVdwbVwiKS50ZXh0KFwiMFwiKTtcbiAgICBMaXZlV3BtLnNob3coKTtcbiAgICBMaXZlQWNjLnNob3coKTtcbiAgICBMaXZlQnVyc3Quc2hvdygpO1xuICAgIFRpbWVyUHJvZ3Jlc3MudXBkYXRlKCk7XG4gICAgVGVzdFRpbWVyLmNsZWFyKCk7XG4gICAgTW9ua2V5LnNob3coKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwibWVtb3J5XCIpIHtcbiAgICAgICAgRnVuYm94LnJlc2V0TWVtb3J5VGltZXIoKTtcbiAgICAgICAgJChcIiN3b3Jkc1dyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnBhY2VDYXJldCAhPT0gXCJvZmZcIiB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQucmVwZWF0ZWRQYWNlICYmIFRlc3RTdGF0ZS5pc1BhY2VSZXBlYXQpKSB7XG4gICAgICAgICAgICBQYWNlQ2FyZXQuc3RhcnQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoZSkgeyB9XG4gICAgLy91c2UgYSByZWN1cnNpdmUgc2VsZi1hZGp1c3RpbmcgdGltZXIgdG8gYXZvaWQgdGltZSBkcmlmdFxuICAgIFRlc3RTdGF0cy5zZXRTdGFydChwZXJmb3JtYW5jZS5ub3coKSk7XG4gICAgVGVzdFRpbWVyLnN0YXJ0KCk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnN0YXJ0VGVzdCA9IHN0YXJ0VGVzdDtcbmZ1bmN0aW9uIHJlc3RhcnQod2l0aFNhbWVXb3Jkc2V0ID0gZmFsc2UsIF8sIC8vIHRoaXMgaXMgbm9zYXZlIGFuZCBzaG91bGQgYmUgcmVuYW1lZCB0byBub3NhdmUgd2hlbiBuZWVkZWRcbmV2ZW50LCBwcmFjdGlzZU1pc3NlZCA9IGZhbHNlLCBub0FuaW0gPSBmYWxzZSkge1xuICAgIGlmIChUZXN0VUkudGVzdFJlc3RhcnRpbmcgfHwgVGVzdFVJLnJlc3VsdENhbGN1bGF0aW5nKSB7XG4gICAgICAgIGV2ZW50ID09PSBudWxsIHx8IGV2ZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09IFwidGVzdFwiICYmICFUZXN0VUkucmVzdWx0VmlzaWJsZSkge1xuICAgICAgICBpZiAoIU1hbnVhbFJlc3RhcnQuZ2V0KCkpIHtcbiAgICAgICAgICAgIGlmIChUZXN0V29yZHMuaGFzVGFiKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEoZXZlbnQgPT09IG51bGwgfHwgZXZlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV2ZW50LnNoaWZ0S2V5KSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJ6ZW5cIilcbiAgICAgICAgICAgICAgICBldmVudCA9PT0gbnVsbCB8fCBldmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGlmICghTWlzYy5jYW5RdWlja1Jlc3RhcnQoY29uZmlnXzEuZGVmYXVsdC5tb2RlLCBjb25maWdfMS5kZWZhdWx0LndvcmRzLCBjb25maWdfMS5kZWZhdWx0LnRpbWUsIEN1c3RvbVRleHQpKSB7XG4gICAgICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSBcIlVzZSB5b3VyIG1vdXNlIHRvIGNvbmZpcm0uXCI7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucXVpY2tUYWIpIHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IFwiUHJlc3Mgc2hpZnQgKyB0YWIgb3IgdXNlIHlvdXIgbW91c2UgdG8gY29uZmlybS5cIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJRdWljayByZXN0YXJ0IGRpc2FibGVkLiBcIiArIG1lc3NhZ2UsIDAsIDMpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIH1lbHNle1xuICAgICAgICAgICAgLy8gICByZXR1cm47XG4gICAgICAgICAgICAvLyB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKFRlc3RBY3RpdmUuZ2V0KCkpIHtcbiAgICAgICAgVGVzdElucHV0LnB1c2hLZXlwcmVzc2VzVG9IaXN0b3J5KCk7XG4gICAgICAgIGNvbnN0IHRlc3RTZWNvbmRzID0gVGVzdFN0YXRzLmNhbGN1bGF0ZVRlc3RTZWNvbmRzKHBlcmZvcm1hbmNlLm5vdygpKTtcbiAgICAgICAgY29uc3QgYWZrc2Vjb25kcyA9IFRlc3RTdGF0cy5jYWxjdWxhdGVBZmtTZWNvbmRzKHRlc3RTZWNvbmRzKTtcbiAgICAgICAgLy8gaW5jb21wbGV0ZVRlc3RTZWNvbmRzICs9IDtcbiAgICAgICAgbGV0IHR0ID0gdGVzdFNlY29uZHMgLSBhZmtzZWNvbmRzO1xuICAgICAgICBpZiAodHQgPCAwKVxuICAgICAgICAgICAgdHQgPSAwO1xuICAgICAgICBjb25zb2xlLmxvZyhgaW5jcmVhc2luZyBpbmNvbXBsZXRlIHRpbWUgYnkgJHt0dH1zICgke3Rlc3RTZWNvbmRzfXMgLSAke2Fma3NlY29uZHN9cyBhZmspYCk7XG4gICAgICAgIFRlc3RTdGF0cy5pbmNyZW1lbnRJbmNvbXBsZXRlU2Vjb25kcyh0dCk7XG4gICAgICAgIFRlc3RTdGF0cy5pbmNyZW1lbnRSZXN0YXJ0Q291bnQoKTtcbiAgICAgICAgaWYgKHR0ID4gNjAwKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgWW91ciB0aW1lIHR5cGluZyBqdXN0IGluY3JlYXNlZCBieSAke01pc2Mucm91bmRUbzIodHQgLyA2MCl9IG1pbnV0ZXMuIElmIHlvdSB0aGluayB0aGlzIGlzIGluY29ycmVjdCBwbGVhc2UgY29udGFjdCBNaW9kZWMgYW5kIGRvbnQgcmVmcmVzaCB0aGUgd2Vic2l0ZS5gLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gcmVzdGFydENvdW50Kys7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIikge1xuICAgICAgICAkKFwiI3dvcmRzXCIpLmVtcHR5KCk7XG4gICAgfVxuICAgIGlmIChQcmFjdGlzZVdvcmRzLmJlZm9yZS5tb2RlICE9PSBudWxsICYmXG4gICAgICAgICF3aXRoU2FtZVdvcmRzZXQgJiZcbiAgICAgICAgIXByYWN0aXNlTWlzc2VkKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUmV2ZXJ0aW5nIHRvIHByZXZpb3VzIHNldHRpbmdzLlwiLCAwKTtcbiAgICAgICAgaWYgKFByYWN0aXNlV29yZHMuYmVmb3JlLnB1bmN0dWF0aW9uICE9PSBudWxsKSB7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UHVuY3R1YXRpb24oUHJhY3Rpc2VXb3Jkcy5iZWZvcmUucHVuY3R1YXRpb24pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChQcmFjdGlzZVdvcmRzLmJlZm9yZS5udW1iZXJzICE9PSBudWxsKSB7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TnVtYmVycyhQcmFjdGlzZVdvcmRzLmJlZm9yZS5udW1iZXJzKTtcbiAgICAgICAgfVxuICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShQcmFjdGlzZVdvcmRzLmJlZm9yZS5tb2RlKTtcbiAgICAgICAgUHJhY3Rpc2VXb3Jkcy5yZXNldEJlZm9yZSgpO1xuICAgIH1cbiAgICBsZXQgcmVwZWF0V2l0aFBhY2UgPSBmYWxzZTtcbiAgICBpZiAoVGVzdFVJLnJlc3VsdFZpc2libGUgJiYgY29uZmlnXzEuZGVmYXVsdC5yZXBlYXRlZFBhY2UgJiYgd2l0aFNhbWVXb3Jkc2V0KSB7XG4gICAgICAgIHJlcGVhdFdpdGhQYWNlID0gdHJ1ZTtcbiAgICB9XG4gICAgTWFudWFsUmVzdGFydC5yZXNldCgpO1xuICAgIFRlc3RUaW1lci5jbGVhcigpO1xuICAgIFRlc3RTdGF0cy5yZXN0YXJ0KCk7XG4gICAgVGVzdElucHV0LnJlc3RhcnQoKTtcbiAgICBUZXN0SW5wdXQuY29ycmVjdGVkLnJlc2V0KCk7XG4gICAgU2hpZnRUcmFja2VyLnJlc2V0KCk7XG4gICAgQ2FyZXQuaGlkZSgpO1xuICAgIFRlc3RBY3RpdmUuc2V0KGZhbHNlKTtcbiAgICBSZXBsYXkuc3RvcFJlcGxheVJlY29yZGluZygpO1xuICAgIExpdmVXcG0uaGlkZSgpO1xuICAgIExpdmVBY2MuaGlkZSgpO1xuICAgIExpdmVCdXJzdC5oaWRlKCk7XG4gICAgVGltZXJQcm9ncmVzcy5oaWRlKCk7XG4gICAgUmVwbGF5LnBhdXNlUmVwbGF5KCk7XG4gICAgVGVzdElucHV0LnNldEJhaWxvdXQoZmFsc2UpO1xuICAgIFBhY2VDYXJldC5yZXNldCgpO1xuICAgIE1vbmtleS5oaWRlKCk7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc2hvd0F2ZXJhZ2UpXG4gICAgICAgIExhc3QxMEF2ZXJhZ2UudXBkYXRlKCk7XG4gICAgJChcIiNzaG93V29yZEhpc3RvcnlCdXR0b25cIikucmVtb3ZlQ2xhc3MoXCJsb2FkZWRcIik7XG4gICAgJChcIiNyZXN0YXJ0VGVzdEJ1dHRvblwiKS5ibHVyKCk7XG4gICAgRnVuYm94LnJlc2V0TWVtb3J5VGltZXIoKTtcbiAgICBRdW90ZVJhdGVQb3B1cC5jbGVhclF1b3RlU3RhdHMoKTtcbiAgICBpZiAoQWN0aXZlUGFnZS5nZXQoKSA9PSBcInRlc3RcIiAmJiB3aW5kb3cuc2Nyb2xsWSA+IDApIHtcbiAgICAgICAgd2luZG93LnNjcm9sbFRvKHsgdG9wOiAwLCBiZWhhdmlvcjogXCJzbW9vdGhcIiB9KTtcbiAgICB9XG4gICAgJChcIiN3b3Jkc0lucHV0XCIpLnZhbChcIiBcIik7XG4gICAgVGVzdFVJLnJlc2V0KCk7XG4gICAgJChcIiN0aW1lck51bWJlclwiKS5jc3MoXCJvcGFjaXR5XCIsIDApO1xuICAgIGxldCBlbCA9IG51bGw7XG4gICAgaWYgKFRlc3RVSS5yZXN1bHRWaXNpYmxlKSB7XG4gICAgICAgIC8vcmVzdWx0cyBhcmUgYmVpbmcgZGlzcGxheWVkXG4gICAgICAgIGVsID0gJChcIiNyZXN1bHRcIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvL3dvcmRzIGFyZSBiZWluZyBkaXNwbGF5ZWRcbiAgICAgICAgZWwgPSAkKFwiI3R5cGluZ1Rlc3RcIik7XG4gICAgfVxuICAgIGlmIChUZXN0VUkucmVzdWx0VmlzaWJsZSkge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5yYW5kb21UaGVtZSAhPT0gXCJvZmZcIiAmJlxuICAgICAgICAgICAgIVBhZ2VUcmFuc2l0aW9uLmdldCgpXG4gICAgICAgIC8vICYmIENvbmZpZy5jdXN0b21UaGVtZUlkID09PSBcIlwiXG4gICAgICAgICkge1xuICAgICAgICAgICAgVGhlbWVDb250cm9sbGVyLnJhbmRvbWl6ZVRoZW1lKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgVGVzdFVJLnNldFJlc3VsdFZpc2libGUoZmFsc2UpO1xuICAgIFBhZ2VUcmFuc2l0aW9uLnNldCh0cnVlKTtcbiAgICBUZXN0VUkuc2V0VGVzdFJlc3RhcnRpbmcodHJ1ZSk7XG4gICAgZWwuc3RvcCh0cnVlLCB0cnVlKS5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogMCxcbiAgICB9LCBub0FuaW0gPyAwIDogMTI1LCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09IFwidGVzdFwiKVxuICAgICAgICAgICAgRm9jdXMuc2V0KGZhbHNlKTtcbiAgICAgICAgVGVzdFVJLmZvY3VzV29yZHMoKTtcbiAgICAgICAgJChcIiNtb25rZXkgLmZhc3RcIikuc3RvcCh0cnVlLCB0cnVlKS5jc3MoXCJvcGFjaXR5XCIsIDApO1xuICAgICAgICAkKFwiI21vbmtleVwiKS5zdG9wKHRydWUsIHRydWUpLmNzcyh7IGFuaW1hdGlvbkR1cmF0aW9uOiBcIjBzXCIgfSk7XG4gICAgICAgICQoXCIjdHlwaW5nVGVzdFwiKS5jc3MoXCJvcGFjaXR5XCIsIDApLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI3dvcmRzSW5wdXRcIikudmFsKFwiIFwiKTtcbiAgICAgICAgbGV0IHNob3VsZFF1b3RlUmVwZWF0ID0gZmFsc2U7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIiAmJlxuICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5yZXBlYXRRdW90ZXMgPT09IFwidHlwaW5nXCIgJiZcbiAgICAgICAgICAgIGZhaWxSZWFzb24gIT09IFwiXCIpIHtcbiAgICAgICAgICAgIHNob3VsZFF1b3RlUmVwZWF0ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB5aWVsZCBGdW5ib3gucmVtZW1iZXJTZXR0aW5ncygpO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwiYXJyb3dzXCIpIHtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQdW5jdHVhdGlvbihmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TnVtYmVycyhmYWxzZSwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwiNTgwMDhcIikge1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE51bWJlcnMoZmFsc2UsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcInNwZWNpYWxzXCIpIHtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQdW5jdHVhdGlvbihmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TnVtYmVycyhmYWxzZSwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwiYXNjaWlcIikge1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFB1bmN0dWF0aW9uKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXROdW1iZXJzKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAod2l0aFNhbWVXb3Jkc2V0ICYmXG4gICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwicGx1c19vbmVcIiB8fCBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJwbHVzX3R3b1wiKSkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJTb3JyeSwgdGhpcyBmdW5ib3ggd29uJ3Qgd29yayB3aXRoIHJlcGVhdGVkIHRlc3RzLlwiLCAwLCA0KTtcbiAgICAgICAgICAgIHdpdGhTYW1lV29yZHNldCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghd2l0aFNhbWVXb3Jkc2V0ICYmICFzaG91bGRRdW90ZVJlcGVhdCkge1xuICAgICAgICAgICAgVGVzdFN0YXRlLnNldFJlcGVhdGVkKGZhbHNlKTtcbiAgICAgICAgICAgIFRlc3RTdGF0ZS5zZXRQYWNlUmVwZWF0KHJlcGVhdFdpdGhQYWNlKTtcbiAgICAgICAgICAgIFRlc3RXb3Jkcy5zZXRIYXNUYWIoZmFsc2UpO1xuICAgICAgICAgICAgeWllbGQgaW5pdCgpO1xuICAgICAgICAgICAgeWllbGQgUGFjZUNhcmV0LmluaXQoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIFRlc3RTdGF0ZS5zZXRSZXBlYXRlZCh0cnVlKTtcbiAgICAgICAgICAgIFRlc3RTdGF0ZS5zZXRQYWNlUmVwZWF0KHJlcGVhdFdpdGhQYWNlKTtcbiAgICAgICAgICAgIFRlc3RBY3RpdmUuc2V0KGZhbHNlKTtcbiAgICAgICAgICAgIFJlcGxheS5zdG9wUmVwbGF5UmVjb3JkaW5nKCk7XG4gICAgICAgICAgICBUZXN0V29yZHMud29yZHMucmVzZXRDdXJyZW50SW5kZXgoKTtcbiAgICAgICAgICAgIFRlc3RJbnB1dC5pbnB1dC5yZXNldCgpO1xuICAgICAgICAgICAgVGVzdFVJLnNob3dXb3JkcygpO1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTW9kZSA9PT0gXCJuZXh0XCIgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9PSBcInplblwiKSB7XG4gICAgICAgICAgICAgICAgS2V5bWFwLmhpZ2hsaWdodEtleShUZXN0V29yZHMud29yZHNcbiAgICAgICAgICAgICAgICAgICAgLmdldEN1cnJlbnQoKVxuICAgICAgICAgICAgICAgICAgICAuc3Vic3RyaW5nKFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCwgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoICsgMSlcbiAgICAgICAgICAgICAgICAgICAgLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgLnRvVXBwZXJDYXNlKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgRnVuYm94LnRvZ2dsZVNjcmlwdChUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpKTtcbiAgICAgICAgICAgIHlpZWxkIFBhY2VDYXJldC5pbml0KCk7XG4gICAgICAgIH1cbiAgICAgICAgZmFpbFJlYXNvbiA9IFwiXCI7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICAgICAgVGVzdFN0YXRlLnNldFJlcGVhdGVkKGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBNb2RlICE9PSBcIm9mZlwiKSB7XG4gICAgICAgICAgICBLZXltYXAuc2hvdygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgS2V5bWFwLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgICAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC53cG1cIikpLmlubmVySFRNTCA9IFwiMFwiO1xuICAgICAgICAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC5hY2NcIikpLmlubmVySFRNTCA9IFwiMTAwJVwiO1xuICAgICAgICAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC5idXJzdFwiKSkuaW5uZXJIVE1MID0gXCIwXCI7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbGl2ZVdwbVwiKS5pbm5lckhUTUwgPSBcIjBcIjtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNsaXZlQWNjXCIpLmlubmVySFRNTCA9IFwiMTAwJVwiO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xpdmVCdXJzdFwiKS5pbm5lckhUTUwgPSBcIjBcIjtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcIm1lbW9yeVwiKSB7XG4gICAgICAgICAgICBGdW5ib3guc3RhcnRNZW1vcnlUaW1lcigpO1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTW9kZSA9PT0gXCJuZXh0XCIpIHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTW9kZShcInJlYWN0XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1vZGUyID0gTWlzYy5nZXRNb2RlMihjb25maWdfMS5kZWZhdWx0LCBUZXN0V29yZHMucmFuZG9tUXVvdGUpO1xuICAgICAgICBsZXQgZmJ0ZXh0ID0gXCJcIjtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ICE9PSBcIm5vbmVcIikge1xuICAgICAgICAgICAgZmJ0ZXh0ID0gXCIgXCIgKyBjb25maWdfMS5kZWZhdWx0LmZ1bmJveDtcbiAgICAgICAgfVxuICAgICAgICAkKFwiLnBhZ2VUZXN0ICNwcmVtaWRUZXN0TW9kZVwiKS50ZXh0KGAke2NvbmZpZ18xLmRlZmF1bHQubW9kZX0gJHttb2RlMn0gJHtjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlLnJlcGxhY2UoL18vZywgXCIgXCIpfSR7ZmJ0ZXh0fWApO1xuICAgICAgICAkKFwiLnBhZ2VUZXN0ICNwcmVtaWRTZWNvbmRzTGVmdFwiKS50ZXh0KGNvbmZpZ18xLmRlZmF1bHQudGltZSk7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJsYXlvdXRmbHVpZFwiKSB7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TGF5b3V0KGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tTGF5b3V0Zmx1aWRcbiAgICAgICAgICAgICAgICA/IGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tTGF5b3V0Zmx1aWQuc3BsaXQoXCIjXCIpWzBdXG4gICAgICAgICAgICAgICAgOiBcInF3ZXJ0eVwiLCB0cnVlKTtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBMYXlvdXQoY29uZmlnXzEuZGVmYXVsdC5jdXN0b21MYXlvdXRmbHVpZFxuICAgICAgICAgICAgICAgID8gY29uZmlnXzEuZGVmYXVsdC5jdXN0b21MYXlvdXRmbHVpZC5zcGxpdChcIiNcIilbMF1cbiAgICAgICAgICAgICAgICA6IFwicXdlcnR5XCIsIHRydWUpO1xuICAgICAgICAgICAgS2V5bWFwLmhpZ2hsaWdodEtleShUZXN0V29yZHMud29yZHNcbiAgICAgICAgICAgICAgICAuZ2V0Q3VycmVudCgpXG4gICAgICAgICAgICAgICAgLnN1YnN0cmluZyhUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGgsIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCArIDEpXG4gICAgICAgICAgICAgICAgLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICAudG9VcHBlckNhc2UoKSk7XG4gICAgICAgIH1cbiAgICAgICAgJChcIiNyZXN1bHRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjdGVzdE1vZGVzTm90aWNlXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpLmNzcyh7XG4gICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICB9KTtcbiAgICAgICAgLy8gcmVzZXRQYWNlQ2FyZXQoKTtcbiAgICAgICAgTW9kZXNOb3RpY2UudXBkYXRlKCk7XG4gICAgICAgICQoXCIjdHlwaW5nVGVzdFwiKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgIH0sIG5vQW5pbSA/IDAgOiAxMjUsICgpID0+IHtcbiAgICAgICAgICAgIFRlc3RVSS5zZXRUZXN0UmVzdGFydGluZyhmYWxzZSk7XG4gICAgICAgICAgICAvLyByZXNldFBhY2VDYXJldCgpO1xuICAgICAgICAgICAgUGJDcm93bi5oaWRlKCk7XG4gICAgICAgICAgICBUZXN0VGltZXIuY2xlYXIoKTtcbiAgICAgICAgICAgIGlmICgkKFwiI2NvbW1hbmRMaW5lV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAgICAgICAgIFRlc3RVSS5mb2N1c1dvcmRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBDaGFydENvbnRyb2xsZXIucmVzdWx0LnVwZGF0ZSgpO1xuICAgICAgICAgICAgUGFnZVRyYW5zaXRpb24uc2V0KGZhbHNlKTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFRlc3RTdGF0cy5pbmNvbXBsZXRlU2Vjb25kcyk7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhUZXN0U3RhdHMucmVzdGFydENvdW50KTtcbiAgICAgICAgfSk7XG4gICAgfSkpO1xufVxuZXhwb3J0cy5yZXN0YXJ0ID0gcmVzdGFydDtcbmZ1bmN0aW9uIGFwcGx5RnVuYm94ZXNUb1dvcmQod29yZCwgd29yZHNldCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwickFuRG9NY0FzRVwiKSB7XG4gICAgICAgIGxldCByYW5kb21jYXNld29yZCA9IFwiXCI7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd29yZC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGkgJSAyICE9IDApIHtcbiAgICAgICAgICAgICAgICByYW5kb21jYXNld29yZCArPSB3b3JkW2ldLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByYW5kb21jYXNld29yZCArPSB3b3JkW2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHdvcmQgPSByYW5kb21jYXNld29yZDtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwiY2FwaXRhbHNcIikge1xuICAgICAgICB3b3JkID0gTWlzYy5jYXBpdGFsaXplRmlyc3RMZXR0ZXJPZkVhY2hXb3JkKHdvcmQpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJnaWJiZXJpc2hcIikge1xuICAgICAgICB3b3JkID0gTWlzYy5nZXRHaWJiZXJpc2goKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwiYXJyb3dzXCIpIHtcbiAgICAgICAgd29yZCA9IE1pc2MuZ2V0QXJyb3dzKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcIjU4MDA4XCIpIHtcbiAgICAgICAgd29yZCA9IE1pc2MuZ2V0TnVtYmVycyg3KTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwic3BlY2lhbHNcIikge1xuICAgICAgICB3b3JkID0gTWlzYy5nZXRTcGVjaWFscygpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhc2NpaVwiKSB7XG4gICAgICAgIHdvcmQgPSBNaXNjLmdldEFTQ0lJKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHdvcmRzZXQgIT09IHVuZGVmaW5lZCAmJiBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJ3ZWFrc3BvdFwiKSB7XG4gICAgICAgIHdvcmQgPSBXZWFrU3BvdC5nZXRXb3JkKHdvcmRzZXQpO1xuICAgIH1cbiAgICBlbHNlIGlmICh3b3Jkc2V0ICE9PSB1bmRlZmluZWQgJiYgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwidGJkbW9kZVwiKSB7XG4gICAgICAgIHdvcmQgPSAoKF9hID0gKDAsIHRiZF9tb2RlXzEuZ2V0VGJkTW9kZSkoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldFdvcmQod29yZHNldCkpIHx8IHdvcmQ7XG4gICAgfVxuICAgIHJldHVybiB3b3JkO1xufVxuZnVuY3Rpb24gYXBwbHlCcml0aXNoRW5nbGlzaFRvV29yZCh3b3JkKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYnJpdGlzaEVuZ2xpc2ggJiYgL2VuZ2xpc2gvLnRlc3QoY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSkpIHtcbiAgICAgICAgICAgIHdvcmQgPSB5aWVsZCBCcml0aXNoRW5nbGlzaC5yZXBsYWNlKHdvcmQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB3b3JkO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gYXBwbHlMYXp5TW9kZVRvV29yZCh3b3JkLCBsYW5ndWFnZSkge1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmxhenlNb2RlID09PSB0cnVlICYmICFsYW5ndWFnZS5ub0xhenlNb2RlKSB7XG4gICAgICAgIHdvcmQgPSBMYXp5TW9kZS5yZXBsYWNlQWNjZW50cyh3b3JkLCBsYW5ndWFnZS5hY2NlbnRzKTtcbiAgICB9XG4gICAgcmV0dXJuIHdvcmQ7XG59XG5mdW5jdGlvbiBnZXROZXh0V29yZCh3b3Jkc2V0LCBsYW5ndWFnZSwgd29yZHNCb3VuZCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgbGV0IHJhbmRvbVdvcmQgPSB3b3Jkc2V0LnJhbmRvbVdvcmQoKTtcbiAgICAgICAgY29uc3QgcHJldmlvdXNXb3JkID0gVGVzdFdvcmRzLndvcmRzLmdldChUZXN0V29yZHMud29yZHMubGVuZ3RoIC0gMSwgdHJ1ZSk7XG4gICAgICAgIGNvbnN0IHByZXZpb3VzV29yZDIgPSBUZXN0V29yZHMud29yZHMuZ2V0KFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGggLSAyLCB0cnVlKTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgICAgICByYW5kb21Xb3JkID1cbiAgICAgICAgICAgICAgICAoX2IgPSAoX2EgPSBUZXN0V29yZHMucmFuZG9tUXVvdGUudGV4dFNwbGl0KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbVGVzdFdvcmRzLndvcmRzLmxlbmd0aF0pICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IFwiXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgICFDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgIUN1c3RvbVRleHQuaXNUaW1lUmFuZG9tKSB7XG4gICAgICAgICAgICByYW5kb21Xb3JkID0gQ3VzdG9tVGV4dC50ZXh0W1Rlc3RXb3Jkcy53b3Jkcy5sZW5ndGhdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICAoQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gfHwgQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20pICYmXG4gICAgICAgICAgICAod29yZHNldC5sZW5ndGggPCA0IHx8IFByYWN0aXNlV29yZHMuYmVmb3JlLm1vZGUgIT09IG51bGwpKSB7XG4gICAgICAgICAgICByYW5kb21Xb3JkID0gd29yZHNldC5yYW5kb21Xb3JkKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBsZXQgcmVnZW5hcmF0aW9uQ291bnQgPSAwOyAvL2luZmluaXRlIGxvb3AgZW1lcmdlbmN5IHN0b3AgYnV0dG9uXG4gICAgICAgICAgICB3aGlsZSAocmVnZW5hcmF0aW9uQ291bnQgPCAxMDAgJiZcbiAgICAgICAgICAgICAgICAocHJldmlvdXNXb3JkID09IHJhbmRvbVdvcmQgfHxcbiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNXb3JkMiA9PSByYW5kb21Xb3JkIHx8XG4gICAgICAgICAgICAgICAgICAgICghY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbiAmJiByYW5kb21Xb3JkID09IFwiSVwiKSkpIHtcbiAgICAgICAgICAgICAgICByZWdlbmFyYXRpb25Db3VudCsrO1xuICAgICAgICAgICAgICAgIHJhbmRvbVdvcmQgPSB3b3Jkc2V0LnJhbmRvbVdvcmQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAocmFuZG9tV29yZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByYW5kb21Xb3JkID0gd29yZHNldC5yYW5kb21Xb3JkKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmFuZG9tV29yZCA9IHJhbmRvbVdvcmQucmVwbGFjZSgvICsvZ20sIFwiIFwiKTtcbiAgICAgICAgcmFuZG9tV29yZCA9IHJhbmRvbVdvcmQucmVwbGFjZSgvXiB8ICQvZ20sIFwiXCIpO1xuICAgICAgICByYW5kb21Xb3JkID0gYXBwbHlMYXp5TW9kZVRvV29yZChyYW5kb21Xb3JkLCBsYW5ndWFnZSk7XG4gICAgICAgIHJhbmRvbVdvcmQgPSB5aWVsZCBhcHBseUJyaXRpc2hFbmdsaXNoVG9Xb3JkKHJhbmRvbVdvcmQpO1xuICAgICAgICByYW5kb21Xb3JkID0gYXBwbHlGdW5ib3hlc1RvV29yZChyYW5kb21Xb3JkLCB3b3Jkc2V0KTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucHVuY3R1YXRpb24pIHtcbiAgICAgICAgICAgIHJhbmRvbVdvcmQgPSBwdW5jdHVhdGVXb3JkKFRlc3RXb3Jkcy53b3Jkcy5nZXQoVGVzdFdvcmRzLndvcmRzLmxlbmd0aCAtIDEpLCByYW5kb21Xb3JkLCBUZXN0V29yZHMud29yZHMubGVuZ3RoLCB3b3Jkc0JvdW5kKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5udW1iZXJzKSB7XG4gICAgICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuMSkge1xuICAgICAgICAgICAgICAgIHJhbmRvbVdvcmQgPSBNaXNjLmdldE51bWJlcnMoNCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJhbmRvbVdvcmQ7XG4gICAgfSk7XG59XG5sZXQgcmVtZW1iZXJMYXp5TW9kZTtcbmZ1bmN0aW9uIGluaXQoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgVGVzdEFjdGl2ZS5zZXQoZmFsc2UpO1xuICAgICAgICBNb25rZXlQb3dlci5yZXNldCgpO1xuICAgICAgICBSZXBsYXkuc3RvcFJlcGxheVJlY29yZGluZygpO1xuICAgICAgICBUZXN0V29yZHMud29yZHMucmVzZXQoKTtcbiAgICAgICAgVGVzdFVJLnNldEN1cnJlbnRXb3JkRWxlbWVudEluZGV4KDApO1xuICAgICAgICAvLyBhY2N1cmFjeSA9IHtcbiAgICAgICAgLy8gICBjb3JyZWN0OiAwLFxuICAgICAgICAvLyAgIGluY29ycmVjdDogMCxcbiAgICAgICAgLy8gfTtcbiAgICAgICAgVGVzdElucHV0LmlucHV0LnJlc2V0SGlzdG9yeSgpO1xuICAgICAgICBUZXN0SW5wdXQuaW5wdXQucmVzZXRDdXJyZW50KCk7XG4gICAgICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09IFwidGVzdFwiKSB7XG4gICAgICAgICAgICB5aWVsZCBGdW5ib3guYWN0aXZhdGUoKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgbGFuZ3VhZ2UgPSB5aWVsZCBNaXNjLmdldExhbmd1YWdlKGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UpO1xuICAgICAgICBpZiAobGFuZ3VhZ2UgJiYgbGFuZ3VhZ2UubmFtZSAhPT0gY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSkge1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldExhbmd1YWdlKFwiZW5nbGlzaFwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWxhbmd1YWdlKSB7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TGFuZ3VhZ2UoXCJlbmdsaXNoXCIpO1xuICAgICAgICAgICAgbGFuZ3VhZ2UgPSB5aWVsZCBNaXNjLmdldExhbmd1YWdlKGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmxhenlNb2RlID09PSB0cnVlICYmIGxhbmd1YWdlLm5vTGF6eU1vZGUpIHtcbiAgICAgICAgICAgIHJlbWVtYmVyTGF6eU1vZGUgPSB0cnVlO1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJUaGlzIGxhbmd1YWdlIGRvZXMgbm90IHN1cHBvcnQgbGF6eSBtb2RlLlwiLCAwKTtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRMYXp5TW9kZShmYWxzZSwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVtZW1iZXJMYXp5TW9kZSA9PT0gdHJ1ZSAmJiAhbGFuZ3VhZ2Uubm9MYXp5TW9kZSkge1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldExhenlNb2RlKHRydWUsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmxhenlNb2RlID09PSBmYWxzZSAmJiAhbGFuZ3VhZ2Uubm9MYXp5TW9kZSkge1xuICAgICAgICAgICAgcmVtZW1iZXJMYXp5TW9kZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGxldCB3b3Jkc0JvdW5kID0gMTAwO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zaG93QWxsTGluZXMpIHtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICAgICAgICAgIHdvcmRzQm91bmQgPSAxMDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAoQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20pIHtcbiAgICAgICAgICAgICAgICAgICAgd29yZHNCb3VuZCA9IEN1c3RvbVRleHQud29yZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20pIHtcbiAgICAgICAgICAgICAgICAgICAgd29yZHNCb3VuZCA9IDEwMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHdvcmRzQm91bmQgPSBDdXN0b21UZXh0LnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPSBcInRpbWVcIikge1xuICAgICAgICAgICAgICAgIHdvcmRzQm91bmQgPSBjb25maWdfMS5kZWZhdWx0LndvcmRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ3b3Jkc1wiICYmIGNvbmZpZ18xLmRlZmF1bHQud29yZHMgPCB3b3Jkc0JvdW5kKSB7XG4gICAgICAgICAgICAgICAgd29yZHNCb3VuZCA9IGNvbmZpZ18xLmRlZmF1bHQud29yZHM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgICAgICBDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQud29yZCA8IHdvcmRzQm91bmQpIHtcbiAgICAgICAgICAgICAgICB3b3Jkc0JvdW5kID0gQ3VzdG9tVGV4dC53b3JkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcImN1c3RvbVwiICYmIEN1c3RvbVRleHQuaXNUaW1lUmFuZG9tKSB7XG4gICAgICAgICAgICAgICAgd29yZHNCb3VuZCA9IDEwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgICAgICFDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgICAgICFDdXN0b21UZXh0LmlzVGltZVJhbmRvbSAmJlxuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQudGV4dC5sZW5ndGggPCB3b3Jkc0JvdW5kKSB7XG4gICAgICAgICAgICAgICAgd29yZHNCb3VuZCA9IEN1c3RvbVRleHQudGV4dC5sZW5ndGg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgIEN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmXG4gICAgICAgICAgICBDdXN0b21UZXh0LndvcmQgPT0gMCkgfHxcbiAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgICAgICBDdXN0b21UZXh0LmlzVGltZVJhbmRvbSAmJlxuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQudGltZSA9PSAwKSkge1xuICAgICAgICAgICAgd29yZHNCb3VuZCA9IDEwMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIgJiYgY29uZmlnXzEuZGVmYXVsdC53b3JkcyA9PT0gMCkge1xuICAgICAgICAgICAgd29yZHNCb3VuZCA9IDEwMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwicGx1c19vbmVcIikge1xuICAgICAgICAgICAgd29yZHNCb3VuZCA9IDI7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIgJiYgY29uZmlnXzEuZGVmYXVsdC53b3JkcyA8IHdvcmRzQm91bmQpIHtcbiAgICAgICAgICAgICAgICB3b3Jkc0JvdW5kID0gY29uZmlnXzEuZGVmYXVsdC53b3JkcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwicGx1c190d29cIikge1xuICAgICAgICAgICAgd29yZHNCb3VuZCA9IDM7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIgJiYgY29uZmlnXzEuZGVmYXVsdC53b3JkcyA8IHdvcmRzQm91bmQpIHtcbiAgICAgICAgICAgICAgICB3b3Jkc0JvdW5kID0gY29uZmlnXzEuZGVmYXVsdC53b3JkcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwidGltZVwiIHx8XG4gICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ3b3Jkc1wiIHx8XG4gICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJjdXN0b21cIikge1xuICAgICAgICAgICAgbGV0IHdvcmRMaXN0ID0gbGFuZ3VhZ2Uud29yZHM7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgICAgICAgICB3b3JkTGlzdCA9IEN1c3RvbVRleHQudGV4dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHdvcmRzZXQgPSBXb3Jkc2V0LndpdGhXb3Jkcyh3b3JkTGlzdCwgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3gpO1xuICAgICAgICAgICAgaWYgKChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PSBcIndpa2lwZWRpYVwiIHx8IGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09IFwicG9ldHJ5XCIpICYmXG4gICAgICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgICAgICAgICBsZXQgd29yZENvdW50ID0gMDtcbiAgICAgICAgICAgICAgICAvLyBJZiBtb2RlIGlzIHdvcmRzLCBnZXQgYXMgbWFueSBzZWN0aW9ucyBhcyB5b3UgbmVlZCB1bnRpbCB0aGUgd29yZENvdW50IGlzIGZ1bGxmaWxsZWRcbiAgICAgICAgICAgICAgICB3aGlsZSAoKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcIndvcmRzXCIgJiYgY29uZmlnXzEuZGVmYXVsdC53b3JkcyA+PSB3b3JkQ291bnQpIHx8XG4gICAgICAgICAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwidGltZVwiICYmIHdvcmRDb3VudCA8IDEwMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VjdGlvbiA9IGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09IFwid2lraXBlZGlhXCJcbiAgICAgICAgICAgICAgICAgICAgICAgID8geWllbGQgV2lraXBlZGlhLmdldFNlY3Rpb24oY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIDogeWllbGQgUG9ldHJ5LmdldFBvZW0oKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlY3Rpb24gPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHdvcmQgb2Ygc2VjdGlvbi53b3Jkcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdvcmRDb3VudCA+PSBjb25maWdfMS5kZWZhdWx0LndvcmRzICYmIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcIndvcmRzXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JkQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgVGVzdFdvcmRzLndvcmRzLnB1c2god29yZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmRzQm91bmQ7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByYW5kb21Xb3JkID0geWllbGQgZ2V0TmV4dFdvcmQod29yZHNldCwgbGFuZ3VhZ2UsIHdvcmRzQm91bmQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoL1xcdC9nLnRlc3QocmFuZG9tV29yZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFRlc3RXb3Jkcy5zZXRIYXNUYWIodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKC8gKy8udGVzdChyYW5kb21Xb3JkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmFuZG9tTGlzdCA9IHJhbmRvbVdvcmQuc3BsaXQoXCIgXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGlkID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChpZCA8IHJhbmRvbUxpc3QubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVGVzdFdvcmRzLndvcmRzLnB1c2gocmFuZG9tTGlzdFtpZF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkKys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGggPT0gd29yZHNCb3VuZCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDdXN0b21UZXh0LmlzV29yZFJhbmRvbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaSA9IFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGggLSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgVGVzdFdvcmRzLndvcmRzLnB1c2gocmFuZG9tV29yZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInF1b3RlXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHF1b3Rlc0NvbGxlY3Rpb24gPSB5aWVsZCBxdW90ZXNfY29udHJvbGxlcl8xLmRlZmF1bHQuZ2V0UXVvdGVzKGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UsIGNvbmZpZ18xLmRlZmF1bHQucXVvdGVMZW5ndGgpO1xuICAgICAgICAgICAgaWYgKHF1b3Rlc0NvbGxlY3Rpb24ubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgVGVzdFVJLnNldFRlc3RSZXN0YXJ0aW5nKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgTm8gJHtjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlLnJlcGxhY2UoL19cXGQqayQvZywgXCJcIil9IHF1b3RlcyBmb3VuZGAsIDApO1xuICAgICAgICAgICAgICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgUXVvdGVTdWJtaXRQb3B1cC5zaG93KGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ3b3Jkc1wiKTtcbiAgICAgICAgICAgICAgICByZXN0YXJ0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHJxID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucXVvdGVMZW5ndGguaW5jbHVkZXMoLTIpICYmIGNvbmZpZ18xLmRlZmF1bHQucXVvdGVMZW5ndGgubGVuZ3RoID09IDEpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRRdW90ZSA9IHF1b3Rlc19jb250cm9sbGVyXzEuZGVmYXVsdC5nZXRRdW90ZUJ5SWQoUXVvdGVTZWFyY2hQb3B1cC5zZWxlY3RlZElkKTtcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0UXVvdGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBycSA9IHF1b3Rlc0NvbGxlY3Rpb24uZ3JvdXBzWzBdWzBdO1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlF1b3RlIElkIERvZXMgTm90IEV4aXN0XCIsIDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcnEgPSB0YXJnZXRRdW90ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCByYW5kb21RdW90ZSA9IHF1b3Rlc19jb250cm9sbGVyXzEuZGVmYXVsdC5nZXRSYW5kb21RdW90ZSgpO1xuICAgICAgICAgICAgICAgIGlmIChyYW5kb21RdW90ZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIk5vIHF1b3RlcyBmb3VuZCBmb3Igc2VsZWN0ZWQgcXVvdGUgbGVuZ3RoXCIsIDApO1xuICAgICAgICAgICAgICAgICAgICBUZXN0VUkuc2V0VGVzdFJlc3RhcnRpbmcoZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJxID0gcmFuZG9tUXVvdGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocnEgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBycS50ZXh0ID0gcnEudGV4dC5yZXBsYWNlKC8gKy9nbSwgXCIgXCIpO1xuICAgICAgICAgICAgcnEudGV4dCA9IHJxLnRleHQucmVwbGFjZSgvXFxcXFxcXFx0L2dtLCBcIlxcdFwiKTtcbiAgICAgICAgICAgIHJxLnRleHQgPSBycS50ZXh0LnJlcGxhY2UoL1xcXFxcXFxcbi9nbSwgXCJcXG5cIik7XG4gICAgICAgICAgICBycS50ZXh0ID0gcnEudGV4dC5yZXBsYWNlKC9cXFxcdC9nbSwgXCJcXHRcIik7XG4gICAgICAgICAgICBycS50ZXh0ID0gcnEudGV4dC5yZXBsYWNlKC9cXFxcbi9nbSwgXCJcXG5cIik7XG4gICAgICAgICAgICBycS50ZXh0ID0gcnEudGV4dC5yZXBsYWNlKC8oICooXFxyXFxufFxccnxcXG4pICopL2csIFwiXFxuIFwiKTtcbiAgICAgICAgICAgIHJxLnRleHQgPSBycS50ZXh0LnJlcGxhY2UoL+KApi9nLCBcIi4uLlwiKTtcbiAgICAgICAgICAgIHJxLnRleHQgPSBycS50ZXh0LnRyaW0oKTtcbiAgICAgICAgICAgIHJxLnRleHRTcGxpdCA9IHJxLnRleHQuc3BsaXQoXCIgXCIpO1xuICAgICAgICAgICAgcnEubGFuZ3VhZ2UgPSBjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlLnJlcGxhY2UoL19cXGQqayQvZywgXCJcIik7XG4gICAgICAgICAgICBUZXN0V29yZHMuc2V0UmFuZG9tUXVvdGUocnEpO1xuICAgICAgICAgICAgY29uc3QgdyA9IFRlc3RXb3Jkcy5yYW5kb21RdW90ZS50ZXh0U3BsaXQ7XG4gICAgICAgICAgICBpZiAodyA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnNob3dBbGxMaW5lcykge1xuICAgICAgICAgICAgICAgIHdvcmRzQm91bmQgPSB3Lmxlbmd0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHdvcmRzQm91bmQgPSBNYXRoLm1pbih3b3Jkc0JvdW5kLCB3Lmxlbmd0aCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmRzQm91bmQ7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmICgvXFx0L2cudGVzdCh3W2ldKSkge1xuICAgICAgICAgICAgICAgICAgICBUZXN0V29yZHMuc2V0SGFzVGFiKHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB3W2ldID0gYXBwbHlMYXp5TW9kZVRvV29yZCh3W2ldLCBsYW5ndWFnZSk7XG4gICAgICAgICAgICAgICAgd1tpXSA9IHlpZWxkIGFwcGx5QnJpdGlzaEVuZ2xpc2hUb1dvcmQod1tpXSk7XG4gICAgICAgICAgICAgICAgd1tpXSA9IGFwcGx5RnVuYm94ZXNUb1dvcmQod1tpXSk7XG4gICAgICAgICAgICAgICAgVGVzdFdvcmRzLndvcmRzLnB1c2god1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy9oYW5kbGUgcmlnaHQtdG8tbGVmdCBsYW5ndWFnZXNcbiAgICAgICAgaWYgKGxhbmd1YWdlLmxlZnRUb1JpZ2h0KSB7XG4gICAgICAgICAgICBUZXN0VUkuYXJyYW5nZUNoYXJhY3RlcnNMZWZ0VG9SaWdodCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgVGVzdFVJLmFycmFuZ2VDaGFyYWN0ZXJzUmlnaHRUb0xlZnQoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobGFuZ3VhZ2UubGlnYXR1cmVzKSB7XG4gICAgICAgICAgICAkKFwiI3dvcmRzXCIpLmFkZENsYXNzKFwid2l0aExpZ2F0dXJlc1wiKTtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0V29yZHNIaXN0b3J5IC53b3Jkc1wiKS5hZGRDbGFzcyhcIndpdGhMaWdhdHVyZXNcIik7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdFJlcGxheSAud29yZHNcIikuYWRkQ2xhc3MoXCJ3aXRoTGlnYXR1cmVzXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcIndpdGhMaWdhdHVyZXNcIik7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeSAud29yZHNcIikucmVtb3ZlQ2xhc3MoXCJ3aXRoTGlnYXR1cmVzXCIpO1xuICAgICAgICAgICAgJChcIiNyZXN1bHRSZXBsYXkgLndvcmRzXCIpLnJlbW92ZUNsYXNzKFwid2l0aExpZ2F0dXJlc1wiKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBpZiAoQ29uZmlnLm1vZGUgPT0gXCJ6ZW5cIikge1xuICAgICAgICAvLyAgIC8vIENyZWF0aW5nIGFuIGVtcHR5IGFjdGl2ZSB3b3JkIGVsZW1lbnQgZm9yIHplbiBtb2RlXG4gICAgICAgIC8vICAgJChcIiN3b3Jkc1wiKS5hcHBlbmQoJzxkaXYgY2xhc3M9XCJ3b3JkIGFjdGl2ZVwiPjwvZGl2PicpO1xuICAgICAgICAvLyAgICQoXCIjd29yZHNcIikuY3NzKFwiaGVpZ2h0XCIsIFwiYXV0b1wiKTtcbiAgICAgICAgLy8gICAkKFwiI3dvcmRzV3JhcHBlclwiKS5jc3MoXCJoZWlnaHRcIiwgXCJhdXRvXCIpO1xuICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICBUZXN0VUkuc2hvd1dvcmRzKCk7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmtleW1hcE1vZGUgPT09IFwibmV4dFwiICYmIGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJ6ZW5cIikge1xuICAgICAgICAgICAgS2V5bWFwLmhpZ2hsaWdodEtleShUZXN0V29yZHMud29yZHNcbiAgICAgICAgICAgICAgICAuZ2V0Q3VycmVudCgpXG4gICAgICAgICAgICAgICAgLnN1YnN0cmluZyhUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGgsIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCArIDEpXG4gICAgICAgICAgICAgICAgLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICAudG9VcHBlckNhc2UoKSk7XG4gICAgICAgIH1cbiAgICAgICAgRnVuYm94LnRvZ2dsZVNjcmlwdChUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpKTtcbiAgICAgICAgLy8gfVxuICAgIH0pO1xufVxuZXhwb3J0cy5pbml0ID0gaW5pdDtcbmZ1bmN0aW9uIGFkZFdvcmQoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBsZXQgYm91bmQgPSAxMDA7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJwbHVzX29uZVwiKVxuICAgICAgICAgICAgYm91bmQgPSAxO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwicGx1c190d29cIilcbiAgICAgICAgICAgIGJvdW5kID0gMjtcbiAgICAgICAgaWYgKFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGggLSBUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGggPiBib3VuZCB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ3b3Jkc1wiICYmXG4gICAgICAgICAgICAgICAgVGVzdFdvcmRzLndvcmRzLmxlbmd0aCA+PSBjb25maWdfMS5kZWZhdWx0LndvcmRzICYmXG4gICAgICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC53b3JkcyA+IDApIHx8XG4gICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gJiZcbiAgICAgICAgICAgICAgICBUZXN0V29yZHMud29yZHMubGVuZ3RoID49IEN1c3RvbVRleHQud29yZCAmJlxuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQud29yZCAhPSAwKSB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgICAgICFDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgICAgICFDdXN0b21UZXh0LmlzVGltZVJhbmRvbSAmJlxuICAgICAgICAgICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGggPj0gQ3VzdG9tVGV4dC50ZXh0Lmxlbmd0aCkgfHxcbiAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIiAmJlxuICAgICAgICAgICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGggPj0gKChfYiA9IChfYSA9IFRlc3RXb3Jkcy5yYW5kb21RdW90ZS50ZXh0U3BsaXQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IDApKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJ3aWtpcGVkaWFcIiB8fCBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PSBcInBvZXRyeVwiKSB7XG4gICAgICAgICAgICBpZiAoVGVzdFdvcmRzLndvcmRzLmxlbmd0aCAtIFRlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXggPCAyMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlY3Rpb24gPSBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PSBcIndpa2lwZWRpYVwiXG4gICAgICAgICAgICAgICAgICAgID8geWllbGQgV2lraXBlZGlhLmdldFNlY3Rpb24oY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSlcbiAgICAgICAgICAgICAgICAgICAgOiB5aWVsZCBQb2V0cnkuZ2V0UG9lbSgpO1xuICAgICAgICAgICAgICAgIGlmIChzZWN0aW9uID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBsZXQgd29yZENvdW50ID0gMDtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHdvcmQgb2Ygc2VjdGlvbi53b3Jkcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAod29yZENvdW50ID49IGNvbmZpZ18xLmRlZmF1bHQud29yZHMgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwid29yZHNcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgd29yZENvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5wdXNoKHdvcmQpO1xuICAgICAgICAgICAgICAgICAgICBUZXN0VUkuYWRkV29yZCh3b3JkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGFuZ3VhZ2UgPSBjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT09IFwiY3VzdG9tXCJcbiAgICAgICAgICAgID8geWllbGQgTWlzYy5nZXRDdXJyZW50TGFuZ3VhZ2UoY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSlcbiAgICAgICAgICAgIDogT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCAoeWllbGQgTWlzYy5nZXRDdXJyZW50TGFuZ3VhZ2UoY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSkpKSwgeyB3b3JkczogQ3VzdG9tVGV4dC50ZXh0IH0pO1xuICAgICAgICBjb25zdCB3b3Jkc2V0ID0gV29yZHNldC53aXRoV29yZHMobGFuZ3VhZ2Uud29yZHMsIGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94KTtcbiAgICAgICAgY29uc3QgcmFuZG9tV29yZCA9IHlpZWxkIGdldE5leHRXb3JkKHdvcmRzZXQsIGxhbmd1YWdlLCBib3VuZCk7XG4gICAgICAgIGNvbnN0IHNwbGl0ID0gcmFuZG9tV29yZC5zcGxpdChcIiBcIik7XG4gICAgICAgIGlmIChzcGxpdC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICBzcGxpdC5mb3JFYWNoKCh3b3JkKSA9PiB7XG4gICAgICAgICAgICAgICAgVGVzdFdvcmRzLndvcmRzLnB1c2god29yZCk7XG4gICAgICAgICAgICAgICAgVGVzdFVJLmFkZFdvcmQod29yZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5wdXNoKHJhbmRvbVdvcmQpO1xuICAgICAgICAgICAgVGVzdFVJLmFkZFdvcmQocmFuZG9tV29yZCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuYWRkV29yZCA9IGFkZFdvcmQ7XG5jb25zdCByZXRyeVNhdmluZyA9IHtcbiAgICBjb21wbGV0ZWRFdmVudDogbnVsbCxcbiAgICBjYW5SZXRyeTogZmFsc2UsXG59O1xuZnVuY3Rpb24gcmV0cnlTYXZpbmdSZXN1bHQoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgeyBjb21wbGV0ZWRFdmVudCB9ID0gcmV0cnlTYXZpbmc7XG4gICAgICAgIGlmIChjb21wbGV0ZWRFdmVudCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDb3VsZCBub3QgcmV0cnkgc2F2aW5nIHRoZSByZXN1bHQgYXMgdGhlIHJlc3VsdCBubyBsb25nZXIgZXhpc3RzLlwiLCAwLCAtMSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFyZXRyeVNhdmluZy5jYW5SZXRyeSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHJldHJ5U2F2aW5nLmNhblJldHJ5ID0gZmFsc2U7XG4gICAgICAgICQoXCIjcmV0cnlTYXZpbmdSZXN1bHRCdXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIEFjY291bnRCdXR0b24ubG9hZGluZyh0cnVlKTtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJSZXRyeWluZyB0byBzYXZlLi4uXCIpO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucmVzdWx0cy5zYXZlKGNvbXBsZXRlZEV2ZW50KTtcbiAgICAgICAgQWNjb3VudEJ1dHRvbi5sb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgUmVzdWx0LmhpZGVDcm93bigpO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIHJldHJ5U2F2aW5nLmNhblJldHJ5ID0gdHJ1ZTtcbiAgICAgICAgICAgICQoXCIjcmV0cnlTYXZpbmdSZXN1bHRCdXR0b25cIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJSZXN1bHQgbm90IHNhdmVkLiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBjb21wbGV0ZWRFdmVudC5faWQgPSByZXNwb25zZS5kYXRhLmluc2VydGVkSWQ7XG4gICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmlzUGIpIHtcbiAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50LmlzUGIgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIERCLnNhdmVMb2NhbFJlc3VsdChjb21wbGV0ZWRFdmVudCk7XG4gICAgICAgIERCLnVwZGF0ZUxvY2FsU3RhdHMoe1xuICAgICAgICAgICAgdGltZTogY29tcGxldGVkRXZlbnQudGVzdER1cmF0aW9uICtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZWRFdmVudC5pbmNvbXBsZXRlVGVzdFNlY29uZHMgLVxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50LmFma0R1cmF0aW9uLFxuICAgICAgICAgICAgc3RhcnRlZDogVGVzdFN0YXRzLnJlc3RhcnRDb3VudCArIDEsXG4gICAgICAgIH0pO1xuICAgICAgICBBbmFseXRpY3NDb250cm9sbGVyLmxvZyhcInRlc3RDb21wbGV0ZWRcIik7XG4gICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmlzUGIpIHtcbiAgICAgICAgICAgIC8vbmV3IHBiXG4gICAgICAgICAgICBSZXN1bHQuc2hvd0Nyb3duKCk7XG4gICAgICAgICAgICBSZXN1bHQudXBkYXRlQ3Jvd24oKTtcbiAgICAgICAgICAgIERCLnNhdmVMb2NhbFBCKGNvbmZpZ18xLmRlZmF1bHQubW9kZSwgY29tcGxldGVkRXZlbnQubW9kZTIsIGNvbmZpZ18xLmRlZmF1bHQucHVuY3R1YXRpb24sIGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UsIGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSwgY29uZmlnXzEuZGVmYXVsdC5sYXp5TW9kZSwgY29tcGxldGVkRXZlbnQud3BtLCBjb21wbGV0ZWRFdmVudC5hY2MsIGNvbXBsZXRlZEV2ZW50LnJhd1dwbSwgY29tcGxldGVkRXZlbnQuY29uc2lzdGVuY3kpO1xuICAgICAgICB9XG4gICAgICAgICQoXCIjcmV0cnlTYXZpbmdSZXN1bHRCdXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUmVzdWx0IHNhdmVkXCIsIDEpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5yZXRyeVNhdmluZ1Jlc3VsdCA9IHJldHJ5U2F2aW5nUmVzdWx0O1xuZnVuY3Rpb24gYnVpbGRDb21wbGV0ZWRFdmVudChkaWZmaWN1bHR5RmFpbGVkKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgLy9idWlsZCBjb21wbGV0ZWQgZXZlbnQgb2JqZWN0XG4gICAgY29uc3QgY29tcGxldGVkRXZlbnQgPSB7XG4gICAgICAgIHdwbTogdW5kZWZpbmVkLFxuICAgICAgICByYXdXcG06IHVuZGVmaW5lZCxcbiAgICAgICAgY2hhclN0YXRzOiB1bmRlZmluZWQsXG4gICAgICAgIGFjYzogdW5kZWZpbmVkLFxuICAgICAgICBtb2RlOiBjb25maWdfMS5kZWZhdWx0Lm1vZGUsXG4gICAgICAgIG1vZGUyOiB1bmRlZmluZWQsXG4gICAgICAgIHF1b3RlTGVuZ3RoOiAtMSxcbiAgICAgICAgcHVuY3R1YXRpb246IGNvbmZpZ18xLmRlZmF1bHQucHVuY3R1YXRpb24sXG4gICAgICAgIG51bWJlcnM6IGNvbmZpZ18xLmRlZmF1bHQubnVtYmVycyxcbiAgICAgICAgbGF6eU1vZGU6IGNvbmZpZ18xLmRlZmF1bHQubGF6eU1vZGUsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgbGFuZ3VhZ2U6IGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UsXG4gICAgICAgIHJlc3RhcnRDb3VudDogVGVzdFN0YXRzLnJlc3RhcnRDb3VudCxcbiAgICAgICAgaW5jb21wbGV0ZVRlc3RTZWNvbmRzOiBUZXN0U3RhdHMuaW5jb21wbGV0ZVNlY29uZHMgPCAwXG4gICAgICAgICAgICA/IDBcbiAgICAgICAgICAgIDogTWlzYy5yb3VuZFRvMihUZXN0U3RhdHMuaW5jb21wbGV0ZVNlY29uZHMpLFxuICAgICAgICBkaWZmaWN1bHR5OiBjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHksXG4gICAgICAgIGJsaW5kTW9kZTogY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUsXG4gICAgICAgIHRhZ3M6IHVuZGVmaW5lZCxcbiAgICAgICAga2V5U3BhY2luZzogVGVzdElucHV0LmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmFycmF5LFxuICAgICAgICBrZXlEdXJhdGlvbjogVGVzdElucHV0LmtleXByZXNzVGltaW5ncy5kdXJhdGlvbi5hcnJheSxcbiAgICAgICAgY29uc2lzdGVuY3k6IHVuZGVmaW5lZCxcbiAgICAgICAga2V5Q29uc2lzdGVuY3k6IHVuZGVmaW5lZCxcbiAgICAgICAgZnVuYm94OiBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCxcbiAgICAgICAgYmFpbGVkT3V0OiBUZXN0SW5wdXQuYmFpbG91dCxcbiAgICAgICAgY2hhcnREYXRhOiB7XG4gICAgICAgICAgICB3cG06IFRlc3RJbnB1dC53cG1IaXN0b3J5LFxuICAgICAgICAgICAgcmF3OiB1bmRlZmluZWQsXG4gICAgICAgICAgICBlcnI6IHVuZGVmaW5lZCxcbiAgICAgICAgfSxcbiAgICAgICAgY3VzdG9tVGV4dDogdW5kZWZpbmVkLFxuICAgICAgICB0ZXN0RHVyYXRpb246IHVuZGVmaW5lZCxcbiAgICAgICAgYWZrRHVyYXRpb246IHVuZGVmaW5lZCxcbiAgICB9O1xuICAgIC8vIHN0YXRzXG4gICAgY29uc3Qgc3RhdHMgPSBUZXN0U3RhdHMuY2FsY3VsYXRlU3RhdHMoKTtcbiAgICBpZiAoc3RhdHMudGltZSAlIDEgIT0gMCAmJiBjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT09IFwidGltZVwiKSB7XG4gICAgICAgIFRlc3RTdGF0cy5zZXRMYXN0U2Vjb25kTm90Um91bmQoKTtcbiAgICB9XG4gICAgVGVzdFN0YXRzLnNldExhc3RUZXN0V3BtKHN0YXRzLndwbSk7XG4gICAgY29tcGxldGVkRXZlbnQud3BtID0gc3RhdHMud3BtO1xuICAgIGNvbXBsZXRlZEV2ZW50LnJhd1dwbSA9IHN0YXRzLndwbVJhdztcbiAgICBjb21wbGV0ZWRFdmVudC5jaGFyU3RhdHMgPSBbXG4gICAgICAgIHN0YXRzLmNvcnJlY3RDaGFycyArIHN0YXRzLmNvcnJlY3RTcGFjZXMsXG4gICAgICAgIHN0YXRzLmluY29ycmVjdENoYXJzLFxuICAgICAgICBzdGF0cy5leHRyYUNoYXJzLFxuICAgICAgICBzdGF0cy5taXNzZWRDaGFycyxcbiAgICBdO1xuICAgIGNvbXBsZXRlZEV2ZW50LmFjYyA9IHN0YXRzLmFjYztcbiAgICAvLyBpZiB0aGUgbGFzdCBzZWNvbmQgd2FzIG5vdCByb3VuZGVkLCBhZGQgYW5vdGhlciBkYXRhIHBvaW50IHRvIHRoZSBoaXN0b3J5XG4gICAgaWYgKFRlc3RTdGF0cy5sYXN0U2Vjb25kTm90Um91bmQgJiYgIWRpZmZpY3VsdHlGYWlsZWQpIHtcbiAgICAgICAgY29uc3Qgd3BtQW5kUmF3ID0gVGVzdFN0YXRzLmNhbGN1bGF0ZVdwbUFuZFJhdygpO1xuICAgICAgICBUZXN0SW5wdXQucHVzaFRvV3BtSGlzdG9yeSh3cG1BbmRSYXcud3BtKTtcbiAgICAgICAgVGVzdElucHV0LnB1c2hUb1Jhd0hpc3Rvcnkod3BtQW5kUmF3LnJhdyk7XG4gICAgICAgIFRlc3RJbnB1dC5wdXNoS2V5cHJlc3Nlc1RvSGlzdG9yeSgpO1xuICAgIH1cbiAgICAvL2NvbnNpc3RlbmN5XG4gICAgY29uc3QgcmF3UGVyU2Vjb25kID0gVGVzdElucHV0LmtleXByZXNzUGVyU2Vjb25kLm1hcCgoZikgPT4gTWF0aC5yb3VuZCgoZi5jb3VudCAvIDUpICogNjApKTtcbiAgICBjb25zdCBzdGRkZXYgPSBNaXNjLnN0ZERldihyYXdQZXJTZWNvbmQpO1xuICAgIGNvbnN0IGF2ZyA9IE1pc2MubWVhbihyYXdQZXJTZWNvbmQpO1xuICAgIGxldCBjb25zaXN0ZW5jeSA9IE1pc2Mucm91bmRUbzIoTWlzYy5rb2dhc2Eoc3RkZGV2IC8gYXZnKSk7XG4gICAgbGV0IGtleUNvbnNpc3RlbmN5QXJyYXkgPSBUZXN0SW5wdXQua2V5cHJlc3NUaW1pbmdzLnNwYWNpbmcuYXJyYXkgPT09IFwidG9vbG9uZ1wiXG4gICAgICAgID8gW11cbiAgICAgICAgOiBUZXN0SW5wdXQua2V5cHJlc3NUaW1pbmdzLnNwYWNpbmcuYXJyYXkuc2xpY2UoKTtcbiAgICBpZiAoa2V5Q29uc2lzdGVuY3lBcnJheS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGtleUNvbnNpc3RlbmN5QXJyYXkgPSBrZXlDb25zaXN0ZW5jeUFycmF5LnNsaWNlKDAsIGtleUNvbnNpc3RlbmN5QXJyYXkubGVuZ3RoIC0gMSk7XG4gICAgfVxuICAgIGxldCBrZXlDb25zaXN0ZW5jeSA9IE1pc2Mucm91bmRUbzIoTWlzYy5rb2dhc2EoTWlzYy5zdGREZXYoa2V5Q29uc2lzdGVuY3lBcnJheSkgLyBNaXNjLm1lYW4oa2V5Q29uc2lzdGVuY3lBcnJheSkpKTtcbiAgICBpZiAoIWNvbnNpc3RlbmN5IHx8IGlzTmFOKGNvbnNpc3RlbmN5KSkge1xuICAgICAgICBjb25zaXN0ZW5jeSA9IDA7XG4gICAgfVxuICAgIGlmICgha2V5Q29uc2lzdGVuY3kgfHwgaXNOYU4oa2V5Q29uc2lzdGVuY3kpKSB7XG4gICAgICAgIGtleUNvbnNpc3RlbmN5ID0gMDtcbiAgICB9XG4gICAgY29tcGxldGVkRXZlbnQua2V5Q29uc2lzdGVuY3kgPSBrZXlDb25zaXN0ZW5jeTtcbiAgICBjb21wbGV0ZWRFdmVudC5jb25zaXN0ZW5jeSA9IGNvbnNpc3RlbmN5O1xuICAgIGNvbnN0IHNtb290aGVkcmF3ID0gTWlzYy5zbW9vdGgocmF3UGVyU2Vjb25kLCAxKTtcbiAgICBjb21wbGV0ZWRFdmVudC5jaGFydERhdGEucmF3ID0gc21vb3RoZWRyYXc7XG4gICAgY29tcGxldGVkRXZlbnQuY2hhcnREYXRhLnVuc21vb3RoZWRSYXcgPSByYXdQZXJTZWNvbmQ7XG4gICAgLy9zbW9vdGhlZCBjb25zaXN0ZW5jeVxuICAgIGNvbnN0IHN0ZGRldjIgPSBNaXNjLnN0ZERldihzbW9vdGhlZHJhdyk7XG4gICAgY29uc3QgYXZnMiA9IE1pc2MubWVhbihzbW9vdGhlZHJhdyk7XG4gICAgY29uc3Qgc21vb3RoQ29uc2lzdGVuY3kgPSBNaXNjLnJvdW5kVG8yKE1pc2Mua29nYXNhKHN0ZGRldjIgLyBhdmcyKSk7XG4gICAgY29tcGxldGVkRXZlbnQuc21vb3RoQ29uc2lzdGVuY3kgPSBzbW9vdGhDb25zaXN0ZW5jeTtcbiAgICAvL3dwbSBjb25zaXN0ZW5jeVxuICAgIGNvbnN0IHN0ZGRldjMgPSBNaXNjLnN0ZERldigoX2EgPSBjb21wbGV0ZWRFdmVudC5jaGFydERhdGEud3BtKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBbXSk7XG4gICAgY29uc3QgYXZnMyA9IE1pc2MubWVhbigoX2IgPSBjb21wbGV0ZWRFdmVudC5jaGFydERhdGEud3BtKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBbXSk7XG4gICAgY29uc3Qgd3BtQ29uc2lzdGVuY3kgPSBNaXNjLnJvdW5kVG8yKE1pc2Mua29nYXNhKHN0ZGRldjMgLyBhdmczKSk7XG4gICAgY29tcGxldGVkRXZlbnQud3BtQ29uc2lzdGVuY3kgPSB3cG1Db25zaXN0ZW5jeTtcbiAgICBjb21wbGV0ZWRFdmVudC50ZXN0RHVyYXRpb24gPSBwYXJzZUZsb2F0KHN0YXRzLnRpbWUudG9TdHJpbmcoKSk7XG4gICAgY29tcGxldGVkRXZlbnQuYWZrRHVyYXRpb24gPSBUZXN0U3RhdHMuY2FsY3VsYXRlQWZrU2Vjb25kcyhjb21wbGV0ZWRFdmVudC50ZXN0RHVyYXRpb24pO1xuICAgIGNvbXBsZXRlZEV2ZW50LmNoYXJ0RGF0YS5lcnIgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IFRlc3RJbnB1dC5rZXlwcmVzc1BlclNlY29uZC5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb21wbGV0ZWRFdmVudC5jaGFydERhdGEuZXJyLnB1c2goVGVzdElucHV0LmtleXByZXNzUGVyU2Vjb25kW2ldLmVycm9ycyk7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICBjb21wbGV0ZWRFdmVudC5xdW90ZUxlbmd0aCA9IFRlc3RXb3Jkcy5yYW5kb21RdW90ZS5ncm91cDtcbiAgICAgICAgY29tcGxldGVkRXZlbnQubGFuZyA9IGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UucmVwbGFjZSgvX1xcZCprJC9nLCBcIlwiKTtcbiAgICB9XG4gICAgLy8gQHRzLWlnbm9yZSBUT0RPIGZpeCB0aGlzXG4gICAgY29tcGxldGVkRXZlbnQubW9kZTIgPSBNaXNjLmdldE1vZGUyKGNvbmZpZ18xLmRlZmF1bHQsIFRlc3RXb3Jkcy5yYW5kb21RdW90ZSk7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICBjb21wbGV0ZWRFdmVudC5jdXN0b21UZXh0ID0ge307XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50LmN1c3RvbVRleHQudGV4dExlbiA9IEN1c3RvbVRleHQudGV4dC5sZW5ndGg7XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50LmN1c3RvbVRleHQuaXNXb3JkUmFuZG9tID0gQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb207XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50LmN1c3RvbVRleHQuaXNUaW1lUmFuZG9tID0gQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb207XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50LmN1c3RvbVRleHQud29yZCA9IEN1c3RvbVRleHQud29yZDtcbiAgICAgICAgY29tcGxldGVkRXZlbnQuY3VzdG9tVGV4dC50aW1lID0gQ3VzdG9tVGV4dC50aW1lO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZGVsZXRlIGNvbXBsZXRlZEV2ZW50LmN1c3RvbVRleHQ7XG4gICAgfVxuICAgIC8vdGFnc1xuICAgIGNvbnN0IGFjdGl2ZVRhZ3NJZHMgPSBbXTtcbiAgICB0cnkge1xuICAgICAgICAoX2MgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgIGlmICh0YWcuYWN0aXZlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgYWN0aXZlVGFnc0lkcy5wdXNoKHRhZy5faWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHsgfVxuICAgIGNvbXBsZXRlZEV2ZW50LnRhZ3MgPSBhY3RpdmVUYWdzSWRzO1xuICAgIGlmIChjb21wbGV0ZWRFdmVudC5tb2RlICE9IFwiY3VzdG9tXCIpXG4gICAgICAgIGRlbGV0ZSBjb21wbGV0ZWRFdmVudC5jdXN0b21UZXh0O1xuICAgIHJldHVybiBjb21wbGV0ZWRFdmVudDtcbn1cbmZ1bmN0aW9uIGZpbmlzaChkaWZmaWN1bHR5RmFpbGVkID0gZmFsc2UpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCFUZXN0QWN0aXZlLmdldCgpKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIgJiYgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoICE9IDApIHtcbiAgICAgICAgICAgIFRlc3RJbnB1dC5pbnB1dC5wdXNoSGlzdG9yeSgpO1xuICAgICAgICAgICAgVGVzdElucHV0LmNvcnJlY3RlZC5wdXNoSGlzdG9yeSgpO1xuICAgICAgICAgICAgUmVwbGF5LnJlcGxheUdldFdvcmRzTGlzdChUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeSk7XG4gICAgICAgIH1cbiAgICAgICAgVGVzdElucHV0LnJlY29yZEtleXByZXNzU3BhY2luZygpOyAvL3RoaXMgaXMgbmVlZGVkIGluIGNhc2UgdGhlcmUgaXMgYWZrIHRpbWUgYXQgdGhlIGVuZCAtIHRvIG1ha2Ugc3VyZSB0ZXN0IGR1cmF0aW9uIG1ha2VzIHNlbnNlXG4gICAgICAgIFRlc3RVSS5zZXRSZXN1bHRDYWxjdWxhdGluZyh0cnVlKTtcbiAgICAgICAgVGVzdFVJLnNldFJlc3VsdFZpc2libGUodHJ1ZSk7XG4gICAgICAgIFRlc3RTdGF0cy5zZXRFbmQocGVyZm9ybWFuY2Uubm93KCkpO1xuICAgICAgICBUZXN0QWN0aXZlLnNldChmYWxzZSk7XG4gICAgICAgIFJlcGxheS5zdG9wUmVwbGF5UmVjb3JkaW5nKCk7XG4gICAgICAgIEZvY3VzLnNldChmYWxzZSk7XG4gICAgICAgIENhcmV0LmhpZGUoKTtcbiAgICAgICAgTGl2ZVdwbS5oaWRlKCk7XG4gICAgICAgIFBiQ3Jvd24uaGlkZSgpO1xuICAgICAgICBMaXZlQWNjLmhpZGUoKTtcbiAgICAgICAgTGl2ZUJ1cnN0LmhpZGUoKTtcbiAgICAgICAgVGltZXJQcm9ncmVzcy5oaWRlKCk7XG4gICAgICAgIE91dE9mRm9jdXMuaGlkZSgpO1xuICAgICAgICBUZXN0VGltZXIuY2xlYXIoKTtcbiAgICAgICAgRnVuYm94LmNsZWFyKCk7XG4gICAgICAgIE1vbmtleS5oaWRlKCk7XG4gICAgICAgIC8vbmVlZCBvbmUgbW9yZSBjYWxjdWxhdGlvbiBmb3IgdGhlIGxhc3Qgd29yZCBpZiB0ZXN0IGF1dG8gZW5kZWRcbiAgICAgICAgaWYgKFRlc3RJbnB1dC5idXJzdEhpc3RvcnkubGVuZ3RoICE9PSBUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeSgpLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgYnVyc3QgPSBUZXN0U3RhdHMuY2FsY3VsYXRlQnVyc3QoKTtcbiAgICAgICAgICAgIFRlc3RJbnB1dC5wdXNoQnVyc3RUb0hpc3RvcnkoYnVyc3QpO1xuICAgICAgICB9XG4gICAgICAgIC8vcmVtb3ZlIGFmayBmcm9tIHplblxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIgfHwgVGVzdElucHV0LmJhaWxvdXQpIHtcbiAgICAgICAgICAgIFRlc3RTdGF0cy5yZW1vdmVBZmtEYXRhKCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29tcGxldGVkRXZlbnQgPSBidWlsZENvbXBsZXRlZEV2ZW50KGRpZmZpY3VsdHlGYWlsZWQpO1xuICAgICAgICAvL3RvZG8gY2hlY2sgaWYgYW55IGZpZWxkcyBhcmUgdW5kZWZpbmVkXG4gICAgICAgIC8vLy8vLy8vLyBjb21wbGV0ZWQgZXZlbnQgcmVhZHlcbiAgICAgICAgLy9hZmsgY2hlY2tcbiAgICAgICAgY29uc3Qga3BzID0gVGVzdElucHV0LmtleXByZXNzUGVyU2Vjb25kLnNsaWNlKC01KTtcbiAgICAgICAgbGV0IGFma0RldGVjdGVkID0ga3BzLmV2ZXJ5KChzZWNvbmQpID0+IHNlY29uZC5hZmspO1xuICAgICAgICBpZiAoVGVzdElucHV0LmJhaWxvdXQpXG4gICAgICAgICAgICBhZmtEZXRlY3RlZCA9IGZhbHNlO1xuICAgICAgICBsZXQgdG9vU2hvcnQgPSBmYWxzZTtcbiAgICAgICAgbGV0IGRvbnRTYXZlID0gZmFsc2U7XG4gICAgICAgIC8vZmFpbCBjaGVja3NcbiAgICAgICAgaWYgKGRpZmZpY3VsdHlGYWlsZWQpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGBUZXN0IGZhaWxlZCAtICR7ZmFpbFJlYXNvbn1gLCAwLCAxKTtcbiAgICAgICAgICAgIGRvbnRTYXZlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChhZmtEZXRlY3RlZCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJUZXN0IGludmFsaWQgLSBBRksgZGV0ZWN0ZWRcIiwgMCk7XG4gICAgICAgICAgICBkb250U2F2ZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoVGVzdFN0YXRlLmlzUmVwZWF0ZWQpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiVGVzdCBpbnZhbGlkIC0gcmVwZWF0ZWRcIiwgMCk7XG4gICAgICAgICAgICBkb250U2F2ZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ0aW1lXCIgJiZcbiAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50Lm1vZGUyIDwgMTUgJiZcbiAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50Lm1vZGUyID4gMCkgfHxcbiAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwidGltZVwiICYmXG4gICAgICAgICAgICAgICAgY29tcGxldGVkRXZlbnQubW9kZTIgPT0gMCAmJlxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50LnRlc3REdXJhdGlvbiA8IDE1KSB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ3b3Jkc1wiICYmXG4gICAgICAgICAgICAgICAgY29tcGxldGVkRXZlbnQubW9kZTIgPCAxMCAmJlxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50Lm1vZGUyID4gMCkgfHxcbiAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIiAmJlxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50Lm1vZGUyID09IDAgJiZcbiAgICAgICAgICAgICAgICBjb21wbGV0ZWRFdmVudC50ZXN0RHVyYXRpb24gPCAxNSkgfHxcbiAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgICAgICAhQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gJiZcbiAgICAgICAgICAgICAgICAhQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20gJiZcbiAgICAgICAgICAgICAgICBDdXN0b21UZXh0LnRleHQubGVuZ3RoIDwgMTApIHx8XG4gICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gJiZcbiAgICAgICAgICAgICAgICAhQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20gJiZcbiAgICAgICAgICAgICAgICBDdXN0b21UZXh0LndvcmQgPCAxMCkgfHxcbiAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgICAgICAhQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gJiZcbiAgICAgICAgICAgICAgICBDdXN0b21UZXh0LmlzVGltZVJhbmRvbSAmJlxuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQudGltZSA8IDE1KSB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ6ZW5cIiAmJiBjb21wbGV0ZWRFdmVudC50ZXN0RHVyYXRpb24gPCAxNSkpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiVGVzdCBpbnZhbGlkIC0gdG9vIHNob3J0XCIsIDApO1xuICAgICAgICAgICAgdG9vU2hvcnQgPSB0cnVlO1xuICAgICAgICAgICAgZG9udFNhdmUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbXBsZXRlZEV2ZW50LndwbSA8IDAgfHwgY29tcGxldGVkRXZlbnQud3BtID4gMzUwKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlRlc3QgaW52YWxpZCAtIHdwbVwiLCAwKTtcbiAgICAgICAgICAgIFRlc3RTdGF0cy5zZXRJbnZhbGlkKCk7XG4gICAgICAgICAgICBkb250U2F2ZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29tcGxldGVkRXZlbnQuYWNjIDwgNzUgfHwgY29tcGxldGVkRXZlbnQuYWNjID4gMTAwKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlRlc3QgaW52YWxpZCAtIGFjY3VyYWN5XCIsIDApO1xuICAgICAgICAgICAgVGVzdFN0YXRzLnNldEludmFsaWQoKTtcbiAgICAgICAgICAgIGRvbnRTYXZlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICAvLyB0ZXN0IGlzIHZhbGlkXG4gICAgICAgIGlmICghZG9udFNhdmUpIHtcbiAgICAgICAgICAgIFRvZGF5VHJhY2tlci5hZGRTZWNvbmRzKGNvbXBsZXRlZEV2ZW50LnRlc3REdXJhdGlvbiArXG4gICAgICAgICAgICAgICAgKFRlc3RTdGF0cy5pbmNvbXBsZXRlU2Vjb25kcyA8IDBcbiAgICAgICAgICAgICAgICAgICAgPyAwXG4gICAgICAgICAgICAgICAgICAgIDogTWlzYy5yb3VuZFRvMihUZXN0U3RhdHMuaW5jb21wbGV0ZVNlY29uZHMpKSAtXG4gICAgICAgICAgICAgICAgY29tcGxldGVkRXZlbnQuYWZrRHVyYXRpb24pO1xuICAgICAgICAgICAgUmVzdWx0LnVwZGF0ZVRvZGF5VHJhY2tlcigpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgPT0gbnVsbCkge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjcmVzdWx0ICNyYXRlUXVvdGVCdXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICNyZXN1bHQgI3JlcG9ydFF1b3RlQnV0dG9uXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgQW5hbHl0aWNzQ29udHJvbGxlci5sb2coXCJ0ZXN0Q29tcGxldGVkTm9Mb2dpblwiKTtcbiAgICAgICAgICAgIGlmICghZG9udFNhdmUpXG4gICAgICAgICAgICAgICAgZXhwb3J0cy5ub3RTaWduZWRJbkxhc3RSZXN1bHQgPSBjb21wbGV0ZWRFdmVudDtcbiAgICAgICAgICAgIGRvbnRTYXZlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Jlc3VsdCAjcmVwb3J0UXVvdGVCdXR0b25cIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgeWllbGQgUmVzdWx0LnVwZGF0ZShjb21wbGV0ZWRFdmVudCwgZGlmZmljdWx0eUZhaWxlZCwgZmFpbFJlYXNvbiwgYWZrRGV0ZWN0ZWQsIFRlc3RTdGF0ZS5pc1JlcGVhdGVkLCB0b29TaG9ydCwgVGVzdFdvcmRzLnJhbmRvbVF1b3RlLCBkb250U2F2ZSk7XG4gICAgICAgIGlmIChjb21wbGV0ZWRFdmVudC5jaGFydERhdGEgIT09IFwidG9vbG9uZ1wiKSB7XG4gICAgICAgICAgICBkZWxldGUgY29tcGxldGVkRXZlbnQuY2hhcnREYXRhLnVuc21vb3RoZWRSYXc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbXBsZXRlZEV2ZW50LnRlc3REdXJhdGlvbiA+IDEyMikge1xuICAgICAgICAgICAgY29tcGxldGVkRXZlbnQuY2hhcnREYXRhID0gXCJ0b29sb25nXCI7XG4gICAgICAgICAgICBjb21wbGV0ZWRFdmVudC5rZXlTcGFjaW5nID0gXCJ0b29sb25nXCI7XG4gICAgICAgICAgICBjb21wbGV0ZWRFdmVudC5rZXlEdXJhdGlvbiA9IFwidG9vbG9uZ1wiO1xuICAgICAgICAgICAgVGVzdElucHV0LnNldEtleXByZXNzVGltaW5nc1Rvb0xvbmcoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZG9udFNhdmUpIHtcbiAgICAgICAgICAgIEFuYWx5dGljc0NvbnRyb2xsZXIubG9nKFwidGVzdENvbXBsZXRlZEludmFsaWRcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gdXNlciBpcyBsb2dnZWQgaW5cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSA9PSBcIm5vcm1hbFwiIHx8XG4gICAgICAgICAgICAoKGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSA9PSBcIm1hc3RlclwiIHx8IGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSA9PSBcImV4cGVydFwiKSAmJlxuICAgICAgICAgICAgICAgICFkaWZmaWN1bHR5RmFpbGVkKSkge1xuICAgICAgICAgICAgVGVzdFN0YXRzLnJlc2V0SW5jb21wbGV0ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50LnVpZCA9IChfYSA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnVpZDtcbiAgICAgICAgUmVzdWx0LnVwZGF0ZVJhdGVRdW90ZShUZXN0V29yZHMucmFuZG9tUXVvdGUpO1xuICAgICAgICBBY2NvdW50QnV0dG9uLmxvYWRpbmcodHJ1ZSk7XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50LmNoYWxsZW5nZSA9IENoYWxsZW5nZUNvbnRvbGxlci52ZXJpZnkoY29tcGxldGVkRXZlbnQpO1xuICAgICAgICBpZiAoY29tcGxldGVkRXZlbnQuY2hhbGxlbmdlID09PSBudWxsKVxuICAgICAgICAgICAgY29tcGxldGVkRXZlbnQgPT09IG51bGwgfHwgY29tcGxldGVkRXZlbnQgPT09IHZvaWQgMCA/IHRydWUgOiBkZWxldGUgY29tcGxldGVkRXZlbnQuY2hhbGxlbmdlO1xuICAgICAgICBjb21wbGV0ZWRFdmVudC5oYXNoID0gKDAsIG9iamVjdF9oYXNoXzEuZGVmYXVsdCkoY29tcGxldGVkRXZlbnQpO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucmVzdWx0cy5zYXZlKGNvbXBsZXRlZEV2ZW50KTtcbiAgICAgICAgQWNjb3VudEJ1dHRvbi5sb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yIHNhdmluZyByZXN1bHRcIiwgY29tcGxldGVkRXZlbnQpO1xuICAgICAgICAgICAgJChcIiNyZXRyeVNhdmluZ1Jlc3VsdEJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5tZXNzYWdlID09PSBcIkluY29ycmVjdCByZXN1bHQgaGFzaFwiKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coY29tcGxldGVkRXZlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0cnlTYXZpbmcuY29tcGxldGVkRXZlbnQgPSBjb21wbGV0ZWRFdmVudDtcbiAgICAgICAgICAgIHJldHJ5U2F2aW5nLmNhblJldHJ5ID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBzYXZlIHJlc3VsdDogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgUmVzdWx0LmhpZGVDcm93bigpO1xuICAgICAgICBjb21wbGV0ZWRFdmVudC5faWQgPSByZXNwb25zZS5kYXRhLmluc2VydGVkSWQ7XG4gICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmlzUGIpIHtcbiAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50LmlzUGIgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIERCLnNhdmVMb2NhbFJlc3VsdChjb21wbGV0ZWRFdmVudCk7XG4gICAgICAgIERCLnVwZGF0ZUxvY2FsU3RhdHMoe1xuICAgICAgICAgICAgdGltZTogY29tcGxldGVkRXZlbnQudGVzdER1cmF0aW9uICtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZWRFdmVudC5pbmNvbXBsZXRlVGVzdFNlY29uZHMgLVxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50LmFma0R1cmF0aW9uLFxuICAgICAgICAgICAgc3RhcnRlZDogVGVzdFN0YXRzLnJlc3RhcnRDb3VudCArIDEsXG4gICAgICAgIH0pO1xuICAgICAgICBBbmFseXRpY3NDb250cm9sbGVyLmxvZyhcInRlc3RDb21wbGV0ZWRcIik7XG4gICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmlzUGIpIHtcbiAgICAgICAgICAgIC8vbmV3IHBiXG4gICAgICAgICAgICBSZXN1bHQuc2hvd0Nyb3duKCk7XG4gICAgICAgICAgICBSZXN1bHQudXBkYXRlQ3Jvd24oKTtcbiAgICAgICAgICAgIERCLnNhdmVMb2NhbFBCKGNvbmZpZ18xLmRlZmF1bHQubW9kZSwgY29tcGxldGVkRXZlbnQubW9kZTIsIGNvbmZpZ18xLmRlZmF1bHQucHVuY3R1YXRpb24sIGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UsIGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSwgY29uZmlnXzEuZGVmYXVsdC5sYXp5TW9kZSwgY29tcGxldGVkRXZlbnQud3BtLCBjb21wbGV0ZWRFdmVudC5hY2MsIGNvbXBsZXRlZEV2ZW50LnJhd1dwbSwgY29tcGxldGVkRXZlbnQuY29uc2lzdGVuY3kpO1xuICAgICAgICB9XG4gICAgICAgICQoXCIjcmV0cnlTYXZpbmdSZXN1bHRCdXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfSk7XG59XG5leHBvcnRzLmZpbmlzaCA9IGZpbmlzaDtcbmZ1bmN0aW9uIGZhaWwocmVhc29uKSB7XG4gICAgZmFpbFJlYXNvbiA9IHJlYXNvbjtcbiAgICAvLyBpbnB1dC5wdXNoSGlzdG9yeSgpO1xuICAgIC8vIGNvcnJlY3RlZC5wdXNoSGlzdG9yeSgpO1xuICAgIFRlc3RJbnB1dC5wdXNoS2V5cHJlc3Nlc1RvSGlzdG9yeSgpO1xuICAgIGZpbmlzaCh0cnVlKTtcbiAgICBjb25zdCB0ZXN0U2Vjb25kcyA9IFRlc3RTdGF0cy5jYWxjdWxhdGVUZXN0U2Vjb25kcyhwZXJmb3JtYW5jZS5ub3coKSk7XG4gICAgY29uc3QgYWZrc2Vjb25kcyA9IFRlc3RTdGF0cy5jYWxjdWxhdGVBZmtTZWNvbmRzKHRlc3RTZWNvbmRzKTtcbiAgICBsZXQgdHQgPSB0ZXN0U2Vjb25kcyAtIGFma3NlY29uZHM7XG4gICAgaWYgKHR0IDwgMClcbiAgICAgICAgdHQgPSAwO1xuICAgIFRlc3RTdGF0cy5pbmNyZW1lbnRJbmNvbXBsZXRlU2Vjb25kcyh0dCk7XG4gICAgVGVzdFN0YXRzLmluY3JlbWVudFJlc3RhcnRDb3VudCgpO1xufVxuZXhwb3J0cy5mYWlsID0gZmFpbDtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjdGVzdE1vZGVzTm90aWNlIC50ZXh0LWJ1dHRvbi5yZXN0YXJ0XCIsICgpID0+IHtcbiAgICByZXN0YXJ0KCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwia2V5cHJlc3NcIiwgXCIjcmVzdGFydFRlc3RCdXR0b25cIiwgKGV2ZW50KSA9PiB7XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIE1hbnVhbFJlc3RhcnQucmVzZXQoKTtcbiAgICAgICAgaWYgKFRlc3RBY3RpdmUuZ2V0KCkgJiZcbiAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQucmVwZWF0UXVvdGVzID09PSBcInR5cGluZ1wiICYmXG4gICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICAgICAgcmVzdGFydCh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlc3RhcnQoKTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiI3Jlc3RhcnRUZXN0QnV0dG9uXCIsICgpID0+IHtcbiAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgIGlmIChUZXN0VUkucmVzdWx0Q2FsY3VsYXRpbmcpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoVGVzdEFjdGl2ZS5nZXQoKSAmJlxuICAgICAgICBjb25maWdfMS5kZWZhdWx0LnJlcGVhdFF1b3RlcyA9PT0gXCJ0eXBpbmdcIiAmJlxuICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICByZXN0YXJ0KHRydWUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmVzdGFydCgpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiI3JldHJ5U2F2aW5nUmVzdWx0QnV0dG9uXCIsIHJldHJ5U2F2aW5nUmVzdWx0KTtcbiQoZG9jdW1lbnQpLm9uKFwia2V5cHJlc3NcIiwgXCIjbmV4dFRlc3RCdXR0b25cIiwgKGV2ZW50KSA9PiB7XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIHJlc3RhcnQoKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQuYm9keSkub24oXCJjbGlja1wiLCBcIiNuZXh0VGVzdEJ1dHRvblwiLCAoKSA9PiB7XG4gICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICByZXN0YXJ0KCk7XG59KTtcbiQoZG9jdW1lbnQuYm9keSkub24oXCJjbGlja1wiLCBcIiNyZXN0YXJ0VGVzdEJ1dHRvbldpdGhTYW1lV29yZHNldFwiLCAoKSA9PiB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUmVwZWF0IHRlc3QgZGlzYWJsZWQgaW4gemVuIG1vZGVcIik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICByZXN0YXJ0KHRydWUpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImtleXByZXNzXCIsIFwiI3Jlc3RhcnRUZXN0QnV0dG9uV2l0aFNhbWVXb3Jkc2V0XCIsIChldmVudCkgPT4ge1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIikge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlJlcGVhdCB0ZXN0IGRpc2FibGVkIGluIHplbiBtb2RlXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChldmVudC5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICByZXN0YXJ0KHRydWUpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0b3AgLmNvbmZpZyAud29yZENvdW50IC50ZXh0LWJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCB3cmQgPSAoX2EgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcIndvcmRDb3VudFwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCIxNVwiO1xuICAgIGlmICh3cmQgIT0gXCJjdXN0b21cIikge1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0V29yZENvdW50KHBhcnNlSW50KHdyZCkpO1xuICAgICAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgICAgICByZXN0YXJ0KCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3RvcCAuY29uZmlnIC50aW1lIC50ZXh0LWJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBtb2RlID0gKF9hID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJ0aW1lQ29uZmlnXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIjEwXCI7XG4gICAgaWYgKG1vZGUgIT0gXCJjdXN0b21cIikge1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZUNvbmZpZyhwYXJzZUludChtb2RlKSk7XG4gICAgICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgICAgIHJlc3RhcnQoKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjdG9wIC5jb25maWcgLnF1b3RlTGVuZ3RoIC50ZXh0LWJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBsZXQgbGVuID0gcGFyc2VJbnQoKF9hID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJxdW90ZUxlbmd0aFwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCIxXCIpO1xuICAgIGlmIChsZW4gIT0gLTIpIHtcbiAgICAgICAgaWYgKGxlbiA9PSAtMSkge1xuICAgICAgICAgICAgbGVuID0gWzAsIDEsIDIsIDNdO1xuICAgICAgICB9XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRRdW90ZUxlbmd0aChsZW4sIGZhbHNlLCBlLnNoaWZ0S2V5KTtcbiAgICAgICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICAgICAgcmVzdGFydCgpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0b3AgLmNvbmZpZyAucHVuY3R1YXRpb25Nb2RlIC50ZXh0LWJ1dHRvblwiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnNldFB1bmN0dWF0aW9uKCFjb25maWdfMS5kZWZhdWx0LnB1bmN0dWF0aW9uKTtcbiAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgIHJlc3RhcnQoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0b3AgLmNvbmZpZyAubnVtYmVyc01vZGUgLnRleHQtYnV0dG9uXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0TnVtYmVycyghY29uZmlnXzEuZGVmYXVsdC5udW1iZXJzKTtcbiAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgIHJlc3RhcnQoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0b3AgLmNvbmZpZyAubW9kZSAudGV4dC1idXR0b25cIiwgKGUpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKCQoZS5jdXJyZW50VGFyZ2V0KS5oYXNDbGFzcyhcImFjdGl2ZVwiKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IG1vZGUgPSAoKF9hID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJtb2RlXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcInRpbWVcIik7XG4gICAgaWYgKG1vZGUgPT09IHVuZGVmaW5lZClcbiAgICAgICAgcmV0dXJuO1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKG1vZGUpO1xuICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgcmVzdGFydCgpO1xufSk7XG4kKFwiI3ByYWN0aXNlV29yZHNQb3B1cCAuYnV0dG9uLm1pc3NlZFwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBQcmFjdGlzZVdvcmRzLmhpZGVQb3B1cCgpO1xuICAgIFByYWN0aXNlV29yZHMuaW5pdCh0cnVlLCBmYWxzZSk7XG4gICAgcmVzdGFydChmYWxzZSwgZmFsc2UsIHVuZGVmaW5lZCwgdHJ1ZSk7XG59KTtcbiQoXCIjcHJhY3Rpc2VXb3Jkc1BvcHVwIC5idXR0b24uc2xvd1wiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBQcmFjdGlzZVdvcmRzLmhpZGVQb3B1cCgpO1xuICAgIFByYWN0aXNlV29yZHMuaW5pdChmYWxzZSwgdHJ1ZSk7XG4gICAgcmVzdGFydChmYWxzZSwgZmFsc2UsIHVuZGVmaW5lZCwgdHJ1ZSk7XG59KTtcbiQoXCIjcHJhY3Rpc2VXb3Jkc1BvcHVwIC5idXR0b24uYm90aFwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBQcmFjdGlzZVdvcmRzLmhpZGVQb3B1cCgpO1xuICAgIFByYWN0aXNlV29yZHMuaW5pdCh0cnVlLCB0cnVlKTtcbiAgICByZXN0YXJ0KGZhbHNlLCBmYWxzZSwgdW5kZWZpbmVkLCB0cnVlKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNxdW90ZVNlYXJjaFBvcHVwICNxdW90ZVNlYXJjaFJlc3VsdHMgLnNlYXJjaFJlc3VsdFwiLCAoZSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicmVwb3J0XCIpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qgc2lkID0gcGFyc2VJbnQoKF9hID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJpZFwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCJcIik7XG4gICAgUXVvdGVTZWFyY2hQb3B1cC5zZXRTZWxlY3RlZElkKHNpZCk7XG4gICAgaWYgKFF1b3RlU2VhcmNoUG9wdXAuYXBwbHkoc2lkKSA9PT0gdHJ1ZSlcbiAgICAgICAgcmVzdGFydCgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3RvcCAjbWVudSAjc3RhcnRUZXN0QnV0dG9uLCAjdG9wIC5sb2dvXCIsICgpID0+IHtcbiAgICBpZiAoQWN0aXZlUGFnZS5nZXQoKSA9PT0gXCJ0ZXN0XCIpXG4gICAgICAgIHJlc3RhcnQoKTtcbn0pO1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSwgZXZlbnRWYWx1ZSwgbm9zYXZlKSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImRpZmZpY3VsdHlcIiAmJiAhbm9zYXZlKVxuICAgICAgICByZXN0YXJ0KGZhbHNlLCBub3NhdmUpO1xuICAgIGlmIChldmVudEtleSA9PT0gXCJzaG93QWxsTGluZXNcIiAmJiAhbm9zYXZlKVxuICAgICAgICByZXN0YXJ0KCk7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImtleW1hcE1vZGVcIiAmJiAhbm9zYXZlKVxuICAgICAgICByZXN0YXJ0KGZhbHNlLCBub3NhdmUpO1xuICAgIGlmIChldmVudEtleSA9PT0gXCJsYXp5TW9kZVwiICYmIGV2ZW50VmFsdWUgPT09IGZhbHNlICYmICFub3NhdmUpIHtcbiAgICAgICAgcmVtZW1iZXJMYXp5TW9kZSA9IGZhbHNlO1xuICAgIH1cbn0pO1xuVGltZXJFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5LCBldmVudFZhbHVlKSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImZhaWxcIiAmJiBldmVudFZhbHVlICE9PSB1bmRlZmluZWQpXG4gICAgICAgIGZhaWwoZXZlbnRWYWx1ZSk7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImZpbmlzaFwiKVxuICAgICAgICBmaW5pc2goKTtcbn0pO1xuUmVzZXRSZXF1ZXN0ZWRFdmVudC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgIHJlc3RhcnQoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNldEFjdGl2ZUNoYWxsZW5nZSA9IGV4cG9ydHMuc2V0UGFjZVJlcGVhdCA9IGV4cG9ydHMuc2V0UmVwZWF0ZWQgPSBleHBvcnRzLmFjdGl2ZUNoYWxsZW5nZSA9IGV4cG9ydHMuaXNQYWNlUmVwZWF0ID0gZXhwb3J0cy5pc1JlcGVhdGVkID0gdm9pZCAwO1xuZXhwb3J0cy5pc1JlcGVhdGVkID0gZmFsc2U7XG5leHBvcnRzLmlzUGFjZVJlcGVhdCA9IGZhbHNlO1xuZXhwb3J0cy5hY3RpdmVDaGFsbGVuZ2UgPSBudWxsO1xuZnVuY3Rpb24gc2V0UmVwZWF0ZWQodGYpIHtcbiAgICBleHBvcnRzLmlzUmVwZWF0ZWQgPSB0Zjtcbn1cbmV4cG9ydHMuc2V0UmVwZWF0ZWQgPSBzZXRSZXBlYXRlZDtcbmZ1bmN0aW9uIHNldFBhY2VSZXBlYXQodGYpIHtcbiAgICBleHBvcnRzLmlzUGFjZVJlcGVhdCA9IHRmO1xufVxuZXhwb3J0cy5zZXRQYWNlUmVwZWF0ID0gc2V0UGFjZVJlcGVhdDtcbmZ1bmN0aW9uIHNldEFjdGl2ZUNoYWxsZW5nZSh2YWwpIHtcbiAgICBleHBvcnRzLmFjdGl2ZUNoYWxsZW5nZSA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0QWN0aXZlQ2hhbGxlbmdlID0gc2V0QWN0aXZlQ2hhbGxlbmdlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuY2FsY3VsYXRlU3RhdHMgPSBleHBvcnRzLnJlbW92ZUFma0RhdGEgPSBleHBvcnRzLmNhbGN1bGF0ZUFjY3VyYWN5ID0gZXhwb3J0cy5jYWxjdWxhdGVCdXJzdCA9IGV4cG9ydHMuc2V0TGFzdFNlY29uZE5vdFJvdW5kID0gZXhwb3J0cy5jYWxjdWxhdGVBZmtTZWNvbmRzID0gZXhwb3J0cy5zZXRTdGFydCA9IGV4cG9ydHMuc2V0RW5kID0gZXhwb3J0cy5jYWxjdWxhdGVXcG1BbmRSYXcgPSBleHBvcnRzLmNhbGN1bGF0ZVRlc3RTZWNvbmRzID0gZXhwb3J0cy5zZXRJbnZhbGlkID0gZXhwb3J0cy5yZXNldEluY29tcGxldGUgPSBleHBvcnRzLmluY3JlbWVudEluY29tcGxldGVTZWNvbmRzID0gZXhwb3J0cy5pbmNyZW1lbnRSZXN0YXJ0Q291bnQgPSBleHBvcnRzLmluY29tcGxldGVTZWNvbmRzID0gZXhwb3J0cy5yZXN0YXJ0Q291bnQgPSBleHBvcnRzLnJlc3RhcnQgPSBleHBvcnRzLmdldFN0YXRzID0gZXhwb3J0cy5zZXRMYXN0VGVzdFdwbSA9IGV4cG9ydHMubGFzdFRlc3RXcG0gPSBleHBvcnRzLmxhc3RTZWNvbmROb3RSb3VuZCA9IGV4cG9ydHMuZW5kMiA9IGV4cG9ydHMuc3RhcnQyID0gZXhwb3J0cy5lbmQgPSBleHBvcnRzLnN0YXJ0ID0gZXhwb3J0cy5pbnZhbGlkID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IFRlc3RJbnB1dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LWlucHV0XCIpKTtcbmNvbnN0IFRlc3RXb3JkcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXdvcmRzXCIpKTtcbmV4cG9ydHMuaW52YWxpZCA9IGZhbHNlO1xuZXhwb3J0cy5sYXN0U2Vjb25kTm90Um91bmQgPSBmYWxzZTtcbmV4cG9ydHMubGFzdFRlc3RXcG0gPSAwO1xuZnVuY3Rpb24gc2V0TGFzdFRlc3RXcG0od3BtKSB7XG4gICAgZXhwb3J0cy5sYXN0VGVzdFdwbSA9IHdwbTtcbn1cbmV4cG9ydHMuc2V0TGFzdFRlc3RXcG0gPSBzZXRMYXN0VGVzdFdwbTtcbmZ1bmN0aW9uIGdldFN0YXRzKCkge1xuICAgIGNvbnN0IHJldCA9IHtcbiAgICAgICAgc3RhcnQ6IGV4cG9ydHMuc3RhcnQsXG4gICAgICAgIGVuZDogZXhwb3J0cy5lbmQsXG4gICAgICAgIHdwbUhpc3Rvcnk6IFRlc3RJbnB1dC53cG1IaXN0b3J5LFxuICAgICAgICByYXdIaXN0b3J5OiBUZXN0SW5wdXQud3BtSGlzdG9yeSxcbiAgICAgICAgYnVyc3RIaXN0b3J5OiBUZXN0SW5wdXQuYnVyc3RIaXN0b3J5LFxuICAgICAgICBrZXlwcmVzc1BlclNlY29uZDogVGVzdElucHV0LmtleXByZXNzUGVyU2Vjb25kLFxuICAgICAgICBjdXJyZW50S2V5cHJlc3M6IFRlc3RJbnB1dC5jdXJyZW50S2V5cHJlc3MsXG4gICAgICAgIGxhc3RLZXlwcmVzczogVGVzdElucHV0Lmxhc3RLZXlwcmVzcyxcbiAgICAgICAgY3VycmVudEJ1cnN0U3RhcnQ6IFRlc3RJbnB1dC5jdXJyZW50QnVyc3RTdGFydCxcbiAgICAgICAgbGFzdFNlY29uZE5vdFJvdW5kOiBleHBvcnRzLmxhc3RTZWNvbmROb3RSb3VuZCxcbiAgICAgICAgbWlzc2VkV29yZHM6IFRlc3RJbnB1dC5taXNzZWRXb3JkcyxcbiAgICAgICAgYWNjdXJhY3k6IFRlc3RJbnB1dC5hY2N1cmFjeSxcbiAgICAgICAga2V5cHJlc3NUaW1pbmdzOiBUZXN0SW5wdXQua2V5cHJlc3NUaW1pbmdzLFxuICAgIH07XG4gICAgdHJ5IHtcbiAgICAgICAgcmV0LmtleVNwYWNpbmdTdGF0cyA9IHtcbiAgICAgICAgICAgIGF2ZXJhZ2U6IFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3Muc3BhY2luZy5hcnJheS5yZWR1Y2UoKHByZXZpb3VzLCBjdXJyZW50KSA9PiAoY3VycmVudCArPSBwcmV2aW91cykpIC8gVGVzdElucHV0LmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmFycmF5Lmxlbmd0aCxcbiAgICAgICAgICAgIHNkOiBNaXNjLnN0ZERldihUZXN0SW5wdXQua2V5cHJlc3NUaW1pbmdzLnNwYWNpbmcuYXJyYXkpLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICAvL1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICByZXQua2V5RHVyYXRpb25TdGF0cyA9IHtcbiAgICAgICAgICAgIGF2ZXJhZ2U6IFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3MuZHVyYXRpb24uYXJyYXkucmVkdWNlKChwcmV2aW91cywgY3VycmVudCkgPT4gKGN1cnJlbnQgKz0gcHJldmlvdXMpKSAvIFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3MuZHVyYXRpb24uYXJyYXkubGVuZ3RoLFxuICAgICAgICAgICAgc2Q6IE1pc2Muc3RkRGV2KFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3MuZHVyYXRpb24uYXJyYXkpLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICAvL1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufVxuZXhwb3J0cy5nZXRTdGF0cyA9IGdldFN0YXRzO1xuZnVuY3Rpb24gcmVzdGFydCgpIHtcbiAgICBleHBvcnRzLnN0YXJ0ID0gMDtcbiAgICBleHBvcnRzLmVuZCA9IDA7XG4gICAgZXhwb3J0cy5pbnZhbGlkID0gZmFsc2U7XG4gICAgZXhwb3J0cy5sYXN0U2Vjb25kTm90Um91bmQgPSBmYWxzZTtcbn1cbmV4cG9ydHMucmVzdGFydCA9IHJlc3RhcnQ7XG5leHBvcnRzLnJlc3RhcnRDb3VudCA9IDA7XG5leHBvcnRzLmluY29tcGxldGVTZWNvbmRzID0gMDtcbmZ1bmN0aW9uIGluY3JlbWVudFJlc3RhcnRDb3VudCgpIHtcbiAgICBleHBvcnRzLnJlc3RhcnRDb3VudCsrO1xufVxuZXhwb3J0cy5pbmNyZW1lbnRSZXN0YXJ0Q291bnQgPSBpbmNyZW1lbnRSZXN0YXJ0Q291bnQ7XG5mdW5jdGlvbiBpbmNyZW1lbnRJbmNvbXBsZXRlU2Vjb25kcyh2YWwpIHtcbiAgICBleHBvcnRzLmluY29tcGxldGVTZWNvbmRzICs9IHZhbDtcbn1cbmV4cG9ydHMuaW5jcmVtZW50SW5jb21wbGV0ZVNlY29uZHMgPSBpbmNyZW1lbnRJbmNvbXBsZXRlU2Vjb25kcztcbmZ1bmN0aW9uIHJlc2V0SW5jb21wbGV0ZSgpIHtcbiAgICBleHBvcnRzLnJlc3RhcnRDb3VudCA9IDA7XG4gICAgZXhwb3J0cy5pbmNvbXBsZXRlU2Vjb25kcyA9IDA7XG59XG5leHBvcnRzLnJlc2V0SW5jb21wbGV0ZSA9IHJlc2V0SW5jb21wbGV0ZTtcbmZ1bmN0aW9uIHNldEludmFsaWQoKSB7XG4gICAgZXhwb3J0cy5pbnZhbGlkID0gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0SW52YWxpZCA9IHNldEludmFsaWQ7XG5mdW5jdGlvbiBjYWxjdWxhdGVUZXN0U2Vjb25kcyhub3cpIHtcbiAgICBpZiAobm93ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29uc3QgZW5kQWZrU2Vjb25kcyA9IChleHBvcnRzLmVuZCAtIFRlc3RJbnB1dC5sYXN0S2V5cHJlc3MpIC8gMTAwMDtcbiAgICAgICAgaWYgKChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIiB8fCBUZXN0SW5wdXQuYmFpbG91dCkgJiYgZW5kQWZrU2Vjb25kcyA8IDcpIHtcbiAgICAgICAgICAgIHJldHVybiAoVGVzdElucHV0Lmxhc3RLZXlwcmVzcyAtIGV4cG9ydHMuc3RhcnQpIC8gMTAwMDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiAoZXhwb3J0cy5lbmQgLSBleHBvcnRzLnN0YXJ0KSAvIDEwMDA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiAobm93IC0gZXhwb3J0cy5zdGFydCkgLyAxMDAwO1xuICAgIH1cbn1cbmV4cG9ydHMuY2FsY3VsYXRlVGVzdFNlY29uZHMgPSBjYWxjdWxhdGVUZXN0U2Vjb25kcztcbmZ1bmN0aW9uIGNhbGN1bGF0ZVdwbUFuZFJhdygpIHtcbiAgICBsZXQgY2hhcnMgPSAwO1xuICAgIGxldCBjb3JyZWN0V29yZENoYXJzID0gMDtcbiAgICBsZXQgc3BhY2VzID0gMDtcbiAgICAvL2NoZWNrIGlucHV0IGhpc3RvcnlcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHdvcmQgPSBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIlxuICAgICAgICAgICAgPyBUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKVxuICAgICAgICAgICAgOiBUZXN0V29yZHMud29yZHMuZ2V0KGkpO1xuICAgICAgICBpZiAoVGVzdElucHV0LmlucHV0LmdldEhpc3RvcnkoaSkgPT0gd29yZCkge1xuICAgICAgICAgICAgLy90aGUgd29yZCBpcyBjb3JyZWN0XG4gICAgICAgICAgICAvLysxIGZvciBzcGFjZVxuICAgICAgICAgICAgY29ycmVjdFdvcmRDaGFycyArPSB3b3JkLmxlbmd0aDtcbiAgICAgICAgICAgIGlmIChpIDwgVGVzdElucHV0LmlucHV0Lmhpc3RvcnkubGVuZ3RoIC0gMSAmJlxuICAgICAgICAgICAgICAgIE1pc2MuZ2V0TGFzdENoYXIoVGVzdElucHV0LmlucHV0LmdldEhpc3RvcnkoaSkpICE9PSBcIlxcblwiKSB7XG4gICAgICAgICAgICAgICAgc3BhY2VzKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2hhcnMgKz0gVGVzdElucHV0LmlucHV0LmdldEhpc3RvcnkoaSkubGVuZ3RoO1xuICAgIH1cbiAgICBpZiAoVGVzdElucHV0LmlucHV0LmN1cnJlbnQgIT09IFwiXCIpIHtcbiAgICAgICAgY29uc3Qgd29yZCA9IGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiXG4gICAgICAgICAgICA/IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50XG4gICAgICAgICAgICA6IFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KCk7XG4gICAgICAgIC8vY2hlY2sgd2hhdHMgY3VycmVudGx5IHR5cGVkXG4gICAgICAgIGNvbnN0IHRvQWRkID0ge1xuICAgICAgICAgICAgY29ycmVjdDogMCxcbiAgICAgICAgICAgIGluY29ycmVjdDogMCxcbiAgICAgICAgICAgIG1pc3NlZDogMCxcbiAgICAgICAgfTtcbiAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCB3b3JkLmxlbmd0aDsgYysrKSB7XG4gICAgICAgICAgICBpZiAoYyA8IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIC8vb24gY2hhciB0aGF0IHN0aWxsIGhhcyBhIHdvcmQgbGlzdCBwYWlyXG4gICAgICAgICAgICAgICAgaWYgKFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50W2NdID09IHdvcmRbY10pIHtcbiAgICAgICAgICAgICAgICAgICAgdG9BZGQuY29ycmVjdCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9BZGQuaW5jb3JyZWN0Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy9vbiBjaGFyIHRoYXQgaXMgZXh0cmFcbiAgICAgICAgICAgICAgICB0b0FkZC5taXNzZWQrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjaGFycyArPSB0b0FkZC5jb3JyZWN0O1xuICAgICAgICBjaGFycyArPSB0b0FkZC5pbmNvcnJlY3Q7XG4gICAgICAgIGNoYXJzICs9IHRvQWRkLm1pc3NlZDtcbiAgICAgICAgaWYgKHRvQWRkLmluY29ycmVjdCA9PSAwKSB7XG4gICAgICAgICAgICAvL3dvcmQgaXMgY29ycmVjdCBzbyBmYXIsIGFkZCBjaGFyc1xuICAgICAgICAgICAgY29ycmVjdFdvcmRDaGFycyArPSB0b0FkZC5jb3JyZWN0O1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJub3NwYWNlXCIgfHwgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwiYXJyb3dzXCIpIHtcbiAgICAgICAgc3BhY2VzID0gMDtcbiAgICB9XG4gICAgY2hhcnMgKz0gVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoO1xuICAgIGNvbnN0IHRlc3RTZWNvbmRzID0gY2FsY3VsYXRlVGVzdFNlY29uZHMocGVyZm9ybWFuY2Uubm93KCkpO1xuICAgIGNvbnN0IHdwbSA9IE1hdGgucm91bmQoKChjb3JyZWN0V29yZENoYXJzICsgc3BhY2VzKSAqICg2MCAvIHRlc3RTZWNvbmRzKSkgLyA1KTtcbiAgICBjb25zdCByYXcgPSBNYXRoLnJvdW5kKCgoY2hhcnMgKyBzcGFjZXMpICogKDYwIC8gdGVzdFNlY29uZHMpKSAvIDUpO1xuICAgIHJldHVybiB7XG4gICAgICAgIHdwbTogd3BtLFxuICAgICAgICByYXc6IHJhdyxcbiAgICB9O1xufVxuZXhwb3J0cy5jYWxjdWxhdGVXcG1BbmRSYXcgPSBjYWxjdWxhdGVXcG1BbmRSYXc7XG5mdW5jdGlvbiBzZXRFbmQoZSkge1xuICAgIGV4cG9ydHMuZW5kID0gZTtcbiAgICBleHBvcnRzLmVuZDIgPSBEYXRlLm5vdygpO1xufVxuZXhwb3J0cy5zZXRFbmQgPSBzZXRFbmQ7XG5mdW5jdGlvbiBzZXRTdGFydChzKSB7XG4gICAgZXhwb3J0cy5zdGFydCA9IHM7XG4gICAgZXhwb3J0cy5zdGFydDIgPSBEYXRlLm5vdygpO1xufVxuZXhwb3J0cy5zZXRTdGFydCA9IHNldFN0YXJ0O1xuZnVuY3Rpb24gY2FsY3VsYXRlQWZrU2Vjb25kcyh0ZXN0U2Vjb25kcykge1xuICAgIGxldCBleHRyYUFmayA9IDA7XG4gICAgaWYgKHRlc3RTZWNvbmRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgICAgIGV4dHJhQWZrID0gTWF0aC5yb3VuZCh0ZXN0U2Vjb25kcykgLSBUZXN0SW5wdXQua2V5cHJlc3NQZXJTZWNvbmQubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZXh0cmFBZmsgPSBNYXRoLmNlaWwodGVzdFNlY29uZHMpIC0gVGVzdElucHV0LmtleXByZXNzUGVyU2Vjb25kLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXh0cmFBZmsgPCAwKVxuICAgICAgICAgICAgZXh0cmFBZmsgPSAwO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIi0tIGV4dHJhIGFmayBkZWJ1Z1wiKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJzaG91bGQgYmUgXCIgKyBNYXRoLmNlaWwodGVzdFNlY29uZHMpKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coa2V5cHJlc3NQZXJTZWNvbmQubGVuZ3RoKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXG4gICAgICAgIC8vICAgYGdvbm5hIGFkZCBleHRyYSAke2V4dHJhQWZrfSBzZWNvbmRzIG9mIGFmayBiZWNhdXNlIG9mIG5vIGtleXByZXNzIGRhdGFgXG4gICAgICAgIC8vICk7XG4gICAgfVxuICAgIGNvbnN0IHJldCA9IFRlc3RJbnB1dC5rZXlwcmVzc1BlclNlY29uZC5maWx0ZXIoKHgpID0+IHguYWZrKS5sZW5ndGg7XG4gICAgcmV0dXJuIHJldCArIGV4dHJhQWZrO1xufVxuZXhwb3J0cy5jYWxjdWxhdGVBZmtTZWNvbmRzID0gY2FsY3VsYXRlQWZrU2Vjb25kcztcbmZ1bmN0aW9uIHNldExhc3RTZWNvbmROb3RSb3VuZCgpIHtcbiAgICBleHBvcnRzLmxhc3RTZWNvbmROb3RSb3VuZCA9IHRydWU7XG59XG5leHBvcnRzLnNldExhc3RTZWNvbmROb3RSb3VuZCA9IHNldExhc3RTZWNvbmROb3RSb3VuZDtcbmZ1bmN0aW9uIGNhbGN1bGF0ZUJ1cnN0KCkge1xuICAgIGNvbnN0IHRpbWVUb1dyaXRlID0gKHBlcmZvcm1hbmNlLm5vdygpIC0gVGVzdElucHV0LmN1cnJlbnRCdXJzdFN0YXJ0KSAvIDEwMDA7XG4gICAgbGV0IHdvcmRMZW5ndGg7XG4gICAgd29yZExlbmd0aCA9IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aDtcbiAgICBpZiAod29yZExlbmd0aCA9PSAwKSB7XG4gICAgICAgIHdvcmRMZW5ndGggPSBUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeUxhc3QoKS5sZW5ndGg7XG4gICAgfVxuICAgIGNvbnN0IHNwZWVkID0gTWlzYy5yb3VuZFRvMigod29yZExlbmd0aCAqICg2MCAvIHRpbWVUb1dyaXRlKSkgLyA1KTtcbiAgICByZXR1cm4gTWF0aC5yb3VuZChzcGVlZCk7XG59XG5leHBvcnRzLmNhbGN1bGF0ZUJ1cnN0ID0gY2FsY3VsYXRlQnVyc3Q7XG5mdW5jdGlvbiBjYWxjdWxhdGVBY2N1cmFjeSgpIHtcbiAgICBjb25zdCBhY2MgPSAoVGVzdElucHV0LmFjY3VyYWN5LmNvcnJlY3QgL1xuICAgICAgICAoVGVzdElucHV0LmFjY3VyYWN5LmNvcnJlY3QgKyBUZXN0SW5wdXQuYWNjdXJhY3kuaW5jb3JyZWN0KSkgKlxuICAgICAgICAxMDA7XG4gICAgcmV0dXJuIGlzTmFOKGFjYykgPyAxMDAgOiBhY2M7XG59XG5leHBvcnRzLmNhbGN1bGF0ZUFjY3VyYWN5ID0gY2FsY3VsYXRlQWNjdXJhY3k7XG5mdW5jdGlvbiByZW1vdmVBZmtEYXRhKCkge1xuICAgIGNvbnN0IHRlc3RTZWNvbmRzID0gY2FsY3VsYXRlVGVzdFNlY29uZHMoKTtcbiAgICBUZXN0SW5wdXQua2V5cHJlc3NQZXJTZWNvbmQuc3BsaWNlKHRlc3RTZWNvbmRzKTtcbiAgICBUZXN0SW5wdXQua2V5cHJlc3NUaW1pbmdzLmR1cmF0aW9uLmFycmF5LnNwbGljZSh0ZXN0U2Vjb25kcyk7XG4gICAgVGVzdElucHV0LmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmFycmF5LnNwbGljZSh0ZXN0U2Vjb25kcyk7XG4gICAgVGVzdElucHV0LndwbUhpc3Rvcnkuc3BsaWNlKHRlc3RTZWNvbmRzKTtcbn1cbmV4cG9ydHMucmVtb3ZlQWZrRGF0YSA9IHJlbW92ZUFma0RhdGE7XG5mdW5jdGlvbiBjb3VudENoYXJzKCkge1xuICAgIGxldCBjb3JyZWN0V29yZENoYXJzID0gMDtcbiAgICBsZXQgY29ycmVjdENoYXJzID0gMDtcbiAgICBsZXQgaW5jb3JyZWN0Q2hhcnMgPSAwO1xuICAgIGxldCBleHRyYUNoYXJzID0gMDtcbiAgICBsZXQgbWlzc2VkQ2hhcnMgPSAwO1xuICAgIGxldCBzcGFjZXMgPSAwO1xuICAgIGxldCBjb3JyZWN0c3BhY2VzID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHdvcmQgPSBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIlxuICAgICAgICAgICAgPyBUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKVxuICAgICAgICAgICAgOiBUZXN0V29yZHMud29yZHMuZ2V0KGkpO1xuICAgICAgICBpZiAoVGVzdElucHV0LmlucHV0LmdldEhpc3RvcnkoaSkgPT09IFwiXCIpIHtcbiAgICAgICAgICAgIC8vbGFzdCB3b3JkIHRoYXQgd2FzIG5vdCBzdGFydGVkXG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoVGVzdElucHV0LmlucHV0LmdldEhpc3RvcnkoaSkgPT0gd29yZCkge1xuICAgICAgICAgICAgLy90aGUgd29yZCBpcyBjb3JyZWN0XG4gICAgICAgICAgICBjb3JyZWN0V29yZENoYXJzICs9IHdvcmQubGVuZ3RoO1xuICAgICAgICAgICAgY29ycmVjdENoYXJzICs9IHdvcmQubGVuZ3RoO1xuICAgICAgICAgICAgaWYgKGkgPCBUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGggLSAxICYmXG4gICAgICAgICAgICAgICAgTWlzYy5nZXRMYXN0Q2hhcihUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKSkgIT09IFwiXFxuXCIpIHtcbiAgICAgICAgICAgICAgICBjb3JyZWN0c3BhY2VzKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoVGVzdElucHV0LmlucHV0LmdldEhpc3RvcnkoaSkubGVuZ3RoID49IHdvcmQubGVuZ3RoKSB7XG4gICAgICAgICAgICAvL3RvbyBtYW55IGNoYXJzXG4gICAgICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IFRlc3RJbnB1dC5pbnB1dC5nZXRIaXN0b3J5KGkpLmxlbmd0aDsgYysrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGMgPCB3b3JkLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAvL29uIGNoYXIgdGhhdCBzdGlsbCBoYXMgYSB3b3JkIGxpc3QgcGFpclxuICAgICAgICAgICAgICAgICAgICBpZiAoVGVzdElucHV0LmlucHV0LmdldEhpc3RvcnkoaSlbY10gPT0gd29yZFtjXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdENoYXJzKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmNvcnJlY3RDaGFycysrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL29uIGNoYXIgdGhhdCBpcyBleHRyYVxuICAgICAgICAgICAgICAgICAgICBleHRyYUNoYXJzKys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy9ub3QgZW5vdWdoIGNoYXJzXG4gICAgICAgICAgICBjb25zdCB0b0FkZCA9IHtcbiAgICAgICAgICAgICAgICBjb3JyZWN0OiAwLFxuICAgICAgICAgICAgICAgIGluY29ycmVjdDogMCxcbiAgICAgICAgICAgICAgICBtaXNzZWQ6IDAsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCB3b3JkLmxlbmd0aDsgYysrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGMgPCBUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9vbiBjaGFyIHRoYXQgc3RpbGwgaGFzIGEgd29yZCBsaXN0IHBhaXJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFRlc3RJbnB1dC5pbnB1dC5nZXRIaXN0b3J5KGkpW2NdID09IHdvcmRbY10pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvQWRkLmNvcnJlY3QrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvQWRkLmluY29ycmVjdCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL29uIGNoYXIgdGhhdCBpcyBleHRyYVxuICAgICAgICAgICAgICAgICAgICB0b0FkZC5taXNzZWQrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb3JyZWN0Q2hhcnMgKz0gdG9BZGQuY29ycmVjdDtcbiAgICAgICAgICAgIGluY29ycmVjdENoYXJzICs9IHRvQWRkLmluY29ycmVjdDtcbiAgICAgICAgICAgIGlmIChpID09PSBUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGggLSAxICYmIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInRpbWVcIikge1xuICAgICAgICAgICAgICAgIC8vbGFzdCB3b3JkIC0gY2hlY2sgaWYgaXQgd2FzIGFsbCBjb3JyZWN0IC0gYWRkIHRvIGNvcnJlY3Qgd29yZCBjaGFyc1xuICAgICAgICAgICAgICAgIGlmICh0b0FkZC5pbmNvcnJlY3QgPT09IDApXG4gICAgICAgICAgICAgICAgICAgIGNvcnJlY3RXb3JkQ2hhcnMgKz0gdG9BZGQuY29ycmVjdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1pc3NlZENoYXJzICs9IHRvQWRkLm1pc3NlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoaSA8IFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgIHNwYWNlcysrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJub3NwYWNlXCIgfHwgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwiYXJyb3dzXCIpIHtcbiAgICAgICAgc3BhY2VzID0gMDtcbiAgICAgICAgY29ycmVjdHNwYWNlcyA9IDA7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIHNwYWNlczogc3BhY2VzLFxuICAgICAgICBjb3JyZWN0V29yZENoYXJzOiBjb3JyZWN0V29yZENoYXJzLFxuICAgICAgICBhbGxDb3JyZWN0Q2hhcnM6IGNvcnJlY3RDaGFycyxcbiAgICAgICAgaW5jb3JyZWN0Q2hhcnM6IGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiID8gVGVzdElucHV0LmFjY3VyYWN5LmluY29ycmVjdCA6IGluY29ycmVjdENoYXJzLFxuICAgICAgICBleHRyYUNoYXJzOiBleHRyYUNoYXJzLFxuICAgICAgICBtaXNzZWRDaGFyczogbWlzc2VkQ2hhcnMsXG4gICAgICAgIGNvcnJlY3RTcGFjZXM6IGNvcnJlY3RzcGFjZXMsXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGNhbGN1bGF0ZVN0YXRzKCkge1xuICAgIGxldCB0ZXN0U2Vjb25kcyA9IGNhbGN1bGF0ZVRlc3RTZWNvbmRzKCk7XG4gICAgLy8gY29uc29sZS5sb2coKGVuZDIgLSBzdGFydDIpIC8gMTAwMCk7XG4gICAgLy8gY29uc29sZS5sb2codGVzdFNlY29uZHMpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT0gXCJjdXN0b21cIikge1xuICAgICAgICB0ZXN0U2Vjb25kcyA9IE1pc2Mucm91bmRUbzIodGVzdFNlY29uZHMpO1xuICAgIH1cbiAgICBjb25zdCBjaGFycyA9IGNvdW50Q2hhcnMoKTtcbiAgICBjb25zdCB3cG0gPSBNaXNjLnJvdW5kVG8yKCgoY2hhcnMuY29ycmVjdFdvcmRDaGFycyArIGNoYXJzLmNvcnJlY3RTcGFjZXMpICogKDYwIC8gdGVzdFNlY29uZHMpKSAvIDUpO1xuICAgIGNvbnN0IHdwbXJhdyA9IE1pc2Mucm91bmRUbzIoKChjaGFycy5hbGxDb3JyZWN0Q2hhcnMgK1xuICAgICAgICBjaGFycy5zcGFjZXMgK1xuICAgICAgICBjaGFycy5pbmNvcnJlY3RDaGFycyArXG4gICAgICAgIGNoYXJzLmV4dHJhQ2hhcnMpICpcbiAgICAgICAgKDYwIC8gdGVzdFNlY29uZHMpKSAvXG4gICAgICAgIDUpO1xuICAgIGNvbnN0IGFjYyA9IE1pc2Mucm91bmRUbzIoY2FsY3VsYXRlQWNjdXJhY3koKSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgd3BtOiBpc05hTih3cG0pID8gMCA6IHdwbSxcbiAgICAgICAgd3BtUmF3OiBpc05hTih3cG1yYXcpID8gMCA6IHdwbXJhdyxcbiAgICAgICAgYWNjOiBhY2MsXG4gICAgICAgIGNvcnJlY3RDaGFyczogY2hhcnMuY29ycmVjdFdvcmRDaGFycyxcbiAgICAgICAgaW5jb3JyZWN0Q2hhcnM6IGNoYXJzLmluY29ycmVjdENoYXJzLFxuICAgICAgICBtaXNzZWRDaGFyczogY2hhcnMubWlzc2VkQ2hhcnMsXG4gICAgICAgIGV4dHJhQ2hhcnM6IGNoYXJzLmV4dHJhQ2hhcnMsXG4gICAgICAgIGFsbENoYXJzOiBjaGFycy5hbGxDb3JyZWN0Q2hhcnMgK1xuICAgICAgICAgICAgY2hhcnMuc3BhY2VzICtcbiAgICAgICAgICAgIGNoYXJzLmluY29ycmVjdENoYXJzICtcbiAgICAgICAgICAgIGNoYXJzLmV4dHJhQ2hhcnMsXG4gICAgICAgIHRpbWU6IE1pc2Mucm91bmRUbzIodGVzdFNlY29uZHMpLFxuICAgICAgICBzcGFjZXM6IGNoYXJzLnNwYWNlcyxcbiAgICAgICAgY29ycmVjdFNwYWNlczogY2hhcnMuY29ycmVjdFNwYWNlcyxcbiAgICB9O1xufVxuZXhwb3J0cy5jYWxjdWxhdGVTdGF0cyA9IGNhbGN1bGF0ZVN0YXRzO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG4vL21vc3Qgb2YgdGhlIGNvZGUgaXMgdGhhbmtzIHRvXG4vL2h0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzI5OTcxODk4L2hvdy10by1jcmVhdGUtYW4tYWNjdXJhdGUtdGltZXItaW4tamF2YXNjcmlwdFxudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc3RhcnQgPSBleHBvcnRzLmdldFRpbWVyU3RhdHMgPSBleHBvcnRzLmNsZWFyID0gZXhwb3J0cy5lbmFibGVUaW1lckRlYnVnID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgQ3VzdG9tVGV4dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jdXN0b20tdGV4dFwiKSk7XG5jb25zdCBUaW1lclByb2dyZXNzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3RpbWVyLXByb2dyZXNzXCIpKTtcbmNvbnN0IExpdmVXcG0gPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbGl2ZS13cG1cIikpO1xuY29uc3QgVGVzdFN0YXRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtc3RhdHNcIikpO1xuY29uc3QgVGVzdElucHV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QtaW5wdXRcIikpO1xuY29uc3QgVGVzdFdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtd29yZHNcIikpO1xuY29uc3QgTW9ua2V5ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL21vbmtleVwiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgQ2FyZXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY2FyZXRcIikpO1xuY29uc3QgU2xvd1RpbWVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvc2xvdy10aW1lclwiKSk7XG5jb25zdCBUZXN0QWN0aXZlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvdGVzdC1hY3RpdmVcIikpO1xuY29uc3QgVGltZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3RpbWVcIikpO1xuY29uc3QgVGltZXJFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvdGltZXItZXZlbnRcIikpO1xubGV0IHNsb3dUaW1lckNvdW50ID0gMDtcbmxldCB0aW1lciA9IG51bGw7XG5jb25zdCBpbnRlcnZhbCA9IDEwMDA7XG5sZXQgZXhwZWN0ZWQgPSAwO1xubGV0IHRpbWVyRGVidWcgPSBmYWxzZTtcbmZ1bmN0aW9uIGVuYWJsZVRpbWVyRGVidWcoKSB7XG4gICAgdGltZXJEZWJ1ZyA9IHRydWU7XG59XG5leHBvcnRzLmVuYWJsZVRpbWVyRGVidWcgPSBlbmFibGVUaW1lckRlYnVnO1xuZnVuY3Rpb24gY2xlYXIoKSB7XG4gICAgVGltZS5zZXQoMCk7XG4gICAgaWYgKHRpbWVyICE9PSBudWxsKVxuICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xufVxuZXhwb3J0cy5jbGVhciA9IGNsZWFyO1xuZnVuY3Rpb24gcHJlbWlkKCkge1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWUoXCJwcmVtaWRcIik7XG4gICAgY29uc3QgcHJlbWlkU2Vjb25kc0xlZnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ByZW1pZFNlY29uZHNMZWZ0XCIpO1xuICAgIGlmIChwcmVtaWRTZWNvbmRzTGVmdCAhPT0gbnVsbCkge1xuICAgICAgICBwcmVtaWRTZWNvbmRzTGVmdC5pbm5lckhUTUwgPSAoY29uZmlnXzEuZGVmYXVsdC50aW1lIC0gVGltZS5nZXQoKSkudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZUVuZChcInByZW1pZFwiKTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZVRpbWVyKCkge1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWUoXCJ0aW1lciBwcm9ncmVzcyB1cGRhdGVcIik7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ0aW1lXCIgfHxcbiAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJiBDdXN0b21UZXh0LmlzVGltZVJhbmRvbSkpIHtcbiAgICAgICAgVGltZXJQcm9ncmVzcy51cGRhdGUoKTtcbiAgICB9XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZUVuZChcInRpbWVyIHByb2dyZXNzIHVwZGF0ZVwiKTtcbn1cbmZ1bmN0aW9uIGNhbGN1bGF0ZVdwbVJhdygpIHtcbiAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgY29uc29sZS50aW1lKFwiY2FsY3VsYXRlIHdwbSBhbmQgcmF3XCIpO1xuICAgIGNvbnN0IHdwbUFuZFJhdyA9IFRlc3RTdGF0cy5jYWxjdWxhdGVXcG1BbmRSYXcoKTtcbiAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgY29uc29sZS50aW1lRW5kKFwiY2FsY3VsYXRlIHdwbSBhbmQgcmF3XCIpO1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWUoXCJ1cGRhdGUgbGl2ZSB3cG1cIik7XG4gICAgTGl2ZVdwbS51cGRhdGUod3BtQW5kUmF3LndwbSwgd3BtQW5kUmF3LnJhdyk7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZUVuZChcInVwZGF0ZSBsaXZlIHdwbVwiKTtcbiAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgY29uc29sZS50aW1lKFwicHVzaCB0byBoaXN0b3J5XCIpO1xuICAgIFRlc3RJbnB1dC5wdXNoVG9XcG1IaXN0b3J5KHdwbUFuZFJhdy53cG0pO1xuICAgIFRlc3RJbnB1dC5wdXNoVG9SYXdIaXN0b3J5KHdwbUFuZFJhdy5yYXcpO1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWVFbmQoXCJwdXNoIHRvIGhpc3RvcnlcIik7XG4gICAgcmV0dXJuIHdwbUFuZFJhdztcbn1cbmZ1bmN0aW9uIG1vbmtleSh3cG1BbmRSYXcpIHtcbiAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgY29uc29sZS50aW1lKFwidXBkYXRlIG1vbmtleVwiKTtcbiAgICBjb25zdCBudW0gPSBjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSA/IHdwbUFuZFJhdy5yYXcgOiB3cG1BbmRSYXcud3BtO1xuICAgIE1vbmtleS51cGRhdGVGYXN0T3BhY2l0eShudW0pO1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWVFbmQoXCJ1cGRhdGUgbW9ua2V5XCIpO1xufVxuZnVuY3Rpb24gY2FsY3VsYXRlQWNjKCkge1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWUoXCJjYWxjdWxhdGUgYWNjXCIpO1xuICAgIGNvbnN0IGFjYyA9IE1pc2Mucm91bmRUbzIoVGVzdFN0YXRzLmNhbGN1bGF0ZUFjY3VyYWN5KCkpO1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWVFbmQoXCJjYWxjdWxhdGUgYWNjXCIpO1xuICAgIHJldHVybiBhY2M7XG59XG5mdW5jdGlvbiBsYXlvdXRmbHVpZCgpIHtcbiAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgY29uc29sZS50aW1lKFwibGF5b3V0Zmx1aWRcIik7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcImxheW91dGZsdWlkXCIgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInRpbWVcIikge1xuICAgICAgICBjb25zdCBsYXlvdXRzID0gY29uZmlnXzEuZGVmYXVsdC5jdXN0b21MYXlvdXRmbHVpZFxuICAgICAgICAgICAgPyBjb25maWdfMS5kZWZhdWx0LmN1c3RvbUxheW91dGZsdWlkLnNwbGl0KFwiI1wiKVxuICAgICAgICAgICAgOiBbXCJxd2VydHlcIiwgXCJkdm9yYWtcIiwgXCJjb2xlbWFrXCJdO1xuICAgICAgICBjb25zdCBzd2l0Y2hUaW1lID0gY29uZmlnXzEuZGVmYXVsdC50aW1lIC8gbGF5b3V0cy5sZW5ndGg7XG4gICAgICAgIGNvbnN0IHRpbWUgPSBUaW1lLmdldCgpO1xuICAgICAgICBjb25zdCBpbmRleCA9IE1hdGguZmxvb3IodGltZSAvIHN3aXRjaFRpbWUpO1xuICAgICAgICBjb25zdCBsYXlvdXQgPSBsYXlvdXRzW2luZGV4XTtcbiAgICAgICAgY29uc3QgZmxvb3JlZFN3aXRjaFRpbWVzID0gW107XG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgbGF5b3V0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgZmxvb3JlZFN3aXRjaFRpbWVzLnB1c2goTWF0aC5mbG9vcihzd2l0Y2hUaW1lICogaSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmbG9vcmVkU3dpdGNoVGltZXMuaW5jbHVkZXModGltZSArIDMpKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIjNcIiwgMCwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZmxvb3JlZFN3aXRjaFRpbWVzLmluY2x1ZGVzKHRpbWUgKyAyKSkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCIyXCIsIDAsIDEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGZsb29yZWRTd2l0Y2hUaW1lcy5pbmNsdWRlcyh0aW1lICsgMSkpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiMVwiLCAwLCAxKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5sYXlvdXQgIT09IGxheW91dCAmJiBsYXlvdXQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoYC0tLSAhISEgJHtsYXlvdXR9ICEhISAtLS1gLCAwKTtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRMYXlvdXQobGF5b3V0LCB0cnVlKTtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBMYXlvdXQobGF5b3V0LCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgY29uc29sZS50aW1lRW5kKFwibGF5b3V0Zmx1aWRcIik7XG59XG5mdW5jdGlvbiBjaGVja0lmRmFpbGVkKHdwbUFuZFJhdywgYWNjKSB7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZShcImZhaWwgY29uZGl0aW9uc1wiKTtcbiAgICBUZXN0SW5wdXQucHVzaEtleXByZXNzZXNUb0hpc3RvcnkoKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5taW5XcG0gPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgd3BtQW5kUmF3LndwbSA8IGNvbmZpZ18xLmRlZmF1bHQubWluV3BtQ3VzdG9tU3BlZWQgJiZcbiAgICAgICAgVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleCA+IDMpIHtcbiAgICAgICAgaWYgKHRpbWVyICE9PSBudWxsKVxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgICAgU2xvd1RpbWVyLmNsZWFyKCk7XG4gICAgICAgIHNsb3dUaW1lckNvdW50ID0gMDtcbiAgICAgICAgVGltZXJFdmVudC5kaXNwYXRjaChcImZhaWxcIiwgXCJtaW4gd3BtXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1pbkFjYyA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICBhY2MgPCBjb25maWdfMS5kZWZhdWx0Lm1pbkFjY0N1c3RvbSAmJlxuICAgICAgICBUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4ID4gMykge1xuICAgICAgICBpZiAodGltZXIgIT09IG51bGwpXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgICBTbG93VGltZXIuY2xlYXIoKTtcbiAgICAgICAgc2xvd1RpbWVyQ291bnQgPSAwO1xuICAgICAgICBUaW1lckV2ZW50LmRpc3BhdGNoKFwiZmFpbFwiLCBcIm1pbiBhY2N1cmFjeVwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgY29uc29sZS50aW1lRW5kKFwiZmFpbCBjb25kaXRpb25zXCIpO1xufVxuZnVuY3Rpb24gY2hlY2tJZlRpbWVJc1VwKCkge1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWUoXCJ0aW1lcyB1cCBjaGVja1wiKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwidGltZVwiIHx8XG4gICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgJiYgQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20pKSB7XG4gICAgICAgIGlmICgoVGltZS5nZXQoKSA+PSBjb25maWdfMS5kZWZhdWx0LnRpbWUgJiZcbiAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQudGltZSAhPT0gMCAmJlxuICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInRpbWVcIikgfHxcbiAgICAgICAgICAgIChUaW1lLmdldCgpID49IEN1c3RvbVRleHQudGltZSAmJlxuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQudGltZSAhPT0gMCAmJlxuICAgICAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIikpIHtcbiAgICAgICAgICAgIC8vdGltZXMgdXBcbiAgICAgICAgICAgIGlmICh0aW1lciAhPT0gbnVsbClcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgICAgICAgQ2FyZXQuaGlkZSgpO1xuICAgICAgICAgICAgVGVzdElucHV0LmlucHV0LnB1c2hIaXN0b3J5KCk7XG4gICAgICAgICAgICBUZXN0SW5wdXQuY29ycmVjdGVkLnB1c2hIaXN0b3J5KCk7XG4gICAgICAgICAgICBTbG93VGltZXIuY2xlYXIoKTtcbiAgICAgICAgICAgIHNsb3dUaW1lckNvdW50ID0gMDtcbiAgICAgICAgICAgIFRpbWVyRXZlbnQuZGlzcGF0Y2goXCJmaW5pc2hcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZUVuZChcInRpbWVzIHVwIGNoZWNrXCIpO1xufVxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5sZXQgdGltZXJTdGF0cyA9IFtdO1xuZnVuY3Rpb24gZ2V0VGltZXJTdGF0cygpIHtcbiAgICByZXR1cm4gdGltZXJTdGF0cztcbn1cbmV4cG9ydHMuZ2V0VGltZXJTdGF0cyA9IGdldFRpbWVyU3RhdHM7XG5mdW5jdGlvbiB0aW1lclN0ZXAoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgICAgICBjb25zb2xlLnRpbWUoXCJ0aW1lciBzdGVwIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXCIpO1xuICAgICAgICBUaW1lLmluY3JlbWVudCgpO1xuICAgICAgICBwcmVtaWQoKTtcbiAgICAgICAgdXBkYXRlVGltZXIoKTtcbiAgICAgICAgY29uc3Qgd3BtQW5kUmF3ID0gY2FsY3VsYXRlV3BtUmF3KCk7XG4gICAgICAgIGNvbnN0IGFjYyA9IGNhbGN1bGF0ZUFjYygpO1xuICAgICAgICBtb25rZXkod3BtQW5kUmF3KTtcbiAgICAgICAgbGF5b3V0Zmx1aWQoKTtcbiAgICAgICAgY2hlY2tJZkZhaWxlZCh3cG1BbmRSYXcsIGFjYyk7XG4gICAgICAgIGNoZWNrSWZUaW1lSXNVcCgpO1xuICAgICAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgICAgIGNvbnNvbGUudGltZUVuZChcInRpbWVyIHN0ZXAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cIik7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBzdGFydCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBTbG93VGltZXIuY2xlYXIoKTtcbiAgICAgICAgc2xvd1RpbWVyQ291bnQgPSAwO1xuICAgICAgICB0aW1lclN0YXRzID0gW107XG4gICAgICAgIGV4cGVjdGVkID0gVGVzdFN0YXRzLnN0YXJ0ICsgaW50ZXJ2YWw7XG4gICAgICAgIChmdW5jdGlvbiBsb29wKCkge1xuICAgICAgICAgICAgY29uc3QgZGVsYXkgPSBleHBlY3RlZCAtIHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgICAgICAgdGltZXJTdGF0cy5wdXNoKHtcbiAgICAgICAgICAgICAgICBkYXRlTm93OiBEYXRlLm5vdygpLFxuICAgICAgICAgICAgICAgIG5vdzogcGVyZm9ybWFuY2Uubm93KCksXG4gICAgICAgICAgICAgICAgZXhwZWN0ZWQ6IGV4cGVjdGVkLFxuICAgICAgICAgICAgICAgIG5leHREZWxheTogZGVsYXksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICgoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInRpbWVcIiAmJiBjb25maWdfMS5kZWZhdWx0LnRpbWUgPCAxMzAgJiYgY29uZmlnXzEuZGVmYXVsdC50aW1lID4gMCkgfHxcbiAgICAgICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIgJiYgY29uZmlnXzEuZGVmYXVsdC53b3JkcyA8IDI1MCAmJiBjb25maWdfMS5kZWZhdWx0LndvcmRzID4gMCkpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGVsYXkgPCBpbnRlcnZhbCAvIDIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9zbG93IHRpbWVyXG4gICAgICAgICAgICAgICAgICAgIFNsb3dUaW1lci5zZXQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGRlbGF5IDwgaW50ZXJ2YWwgLyAxMCkge1xuICAgICAgICAgICAgICAgICAgICBzbG93VGltZXJDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2xvd1RpbWVyQ291bnQgPiA1KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3Nsb3cgdGltZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmNsdWRlcyhcIkVkZ1wiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKCdUaGlzIGJhZCBwZXJmb3JtYW5jZSBjb3VsZCBiZSBjYXVzZWQgYnkgXCJlZmZpY2llbmN5IG1vZGVcIiBvbiBNaWNyb3NvZnQgRWRnZS4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiU3RvcHBpbmcgdGhlIHRlc3QgZHVlIHRvIGJhZCBwZXJmb3JtYW5jZS4gVGhpcyB3b3VsZCBjYXVzZSB0ZXN0IGNhbGN1bGF0aW9ucyB0byBiZSBpbmNvcnJlY3QuIElmIHRoaXMgaGFwcGVucyBhIGxvdCwgcGxlYXNlIHJlcG9ydCB0aGlzLlwiLCAtMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBUaW1lckV2ZW50LmRpc3BhdGNoKFwiZmFpbFwiLCBcInNsb3cgdGltZXJcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vIHRpbWUrKztcbiAgICAgICAgICAgICAgICBpZiAoIVRlc3RBY3RpdmUuZ2V0KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWVyICE9PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgU2xvd1RpbWVyLmNsZWFyKCk7XG4gICAgICAgICAgICAgICAgICAgIHNsb3dUaW1lckNvdW50ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aW1lclN0ZXAoKTtcbiAgICAgICAgICAgICAgICBleHBlY3RlZCArPSBpbnRlcnZhbDtcbiAgICAgICAgICAgICAgICBsb29wKCk7XG4gICAgICAgICAgICB9LCBkZWxheSk7XG4gICAgICAgIH0pKCk7XG4gICAgfSk7XG59XG5leHBvcnRzLnN0YXJ0ID0gc3RhcnQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmhpZ2hsaWdodEJhZFdvcmQgPSBleHBvcnRzLmFwcGx5QnVyc3RIZWF0bWFwID0gZXhwb3J0cy50b2dnbGVSZXN1bHRXb3JkcyA9IGV4cG9ydHMuYXJyYW5nZUNoYXJhY3RlcnNMZWZ0VG9SaWdodCA9IGV4cG9ydHMuYXJyYW5nZUNoYXJhY3RlcnNSaWdodFRvTGVmdCA9IGV4cG9ydHMubGluZUp1bXAgPSBleHBvcnRzLnVwZGF0ZVdvcmRFbGVtZW50ID0gZXhwb3J0cy5zY3JlZW5zaG90ID0gZXhwb3J0cy5jb2xvcmZ1bCA9IGV4cG9ydHMuZmxpcENvbG9ycyA9IGV4cG9ydHMuYWRkV29yZCA9IGV4cG9ydHMuc2hvd1dvcmRzID0gZXhwb3J0cy51cGRhdGVBY3RpdmVFbGVtZW50ID0gZXhwb3J0cy5mb2N1c1dvcmRzID0gZXhwb3J0cy5yZXNldCA9IGV4cG9ydHMuc2V0UmVzdWx0Q2FsY3VsYXRpbmcgPSBleHBvcnRzLnNldFRlc3RSZXN0YXJ0aW5nID0gZXhwb3J0cy5zZXRBY3RpdmVXb3JkVG9wID0gZXhwb3J0cy5zZXRDdXJyZW50V29yZEVsZW1lbnRJbmRleCA9IGV4cG9ydHMuc2V0UmVzdWx0VmlzaWJsZSA9IGV4cG9ydHMucmVzdWx0Q2FsY3VsYXRpbmcgPSBleHBvcnRzLmN1cnJlbnRUZXN0TGluZSA9IGV4cG9ydHMubGluZVRyYW5zaXRpb24gPSBleHBvcnRzLnRlc3RSZXN0YXJ0aW5nUHJvbWlzZSA9IGV4cG9ydHMudGVzdFJlc3RhcnRpbmcgPSBleHBvcnRzLmFjdGl2ZVdvcmRUb3AgPSBleHBvcnRzLnJlc3VsdFZpc2libGUgPSBleHBvcnRzLmN1cnJlbnRXb3JkRWxlbWVudEluZGV4ID0gdm9pZCAwO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBUaGVtZUNvbG9ycyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvdGhlbWUtY29sb3JzXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpLCBVcGRhdGVDb25maWcgPSBjb25maWdfMTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBUZXN0V29yZHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC13b3Jkc1wiKSk7XG5jb25zdCBUZXN0SW5wdXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC1pbnB1dFwiKSk7XG5jb25zdCBDdXN0b21UZXh0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2N1c3RvbS10ZXh0XCIpKTtcbmNvbnN0IENhcmV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2NhcmV0XCIpKTtcbmNvbnN0IE91dE9mRm9jdXMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vb3V0LW9mLWZvY3VzXCIpKTtcbmNvbnN0IFJlcGxheSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9yZXBsYXlcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBTbG93VGltZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9zbG93LXRpbWVyXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuY29uc3QgZm9ybWF0XzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImRhdGUtZm5zL2Zvcm1hdFwiKSk7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSwgZXZlbnRWYWx1ZSkgPT4ge1xuICAgIGlmIChldmVudFZhbHVlID09PSB1bmRlZmluZWQgfHwgdHlwZW9mIGV2ZW50VmFsdWUgIT09IFwiYm9vbGVhblwiKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImZsaXBUZXN0Q29sb3JzXCIpXG4gICAgICAgIGZsaXBDb2xvcnMoZXZlbnRWYWx1ZSk7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImNvbG9yZnVsTW9kZVwiKVxuICAgICAgICBjb2xvcmZ1bChldmVudFZhbHVlKTtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiaGlnaGxpZ2h0TW9kZVwiKVxuICAgICAgICB1cGRhdGVXb3JkRWxlbWVudChldmVudFZhbHVlKTtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiYnVyc3RIZWF0bWFwXCIpXG4gICAgICAgIGFwcGx5QnVyc3RIZWF0bWFwKCk7XG59KTtcbmV4cG9ydHMuY3VycmVudFdvcmRFbGVtZW50SW5kZXggPSAwO1xuZXhwb3J0cy5yZXN1bHRWaXNpYmxlID0gZmFsc2U7XG5leHBvcnRzLmFjdGl2ZVdvcmRUb3AgPSAwO1xuZXhwb3J0cy50ZXN0UmVzdGFydGluZyA9IGZhbHNlO1xuZXhwb3J0cy5saW5lVHJhbnNpdGlvbiA9IGZhbHNlO1xuZXhwb3J0cy5jdXJyZW50VGVzdExpbmUgPSAwO1xuZXhwb3J0cy5yZXN1bHRDYWxjdWxhdGluZyA9IGZhbHNlO1xuZnVuY3Rpb24gc2V0UmVzdWx0VmlzaWJsZSh2YWwpIHtcbiAgICBleHBvcnRzLnJlc3VsdFZpc2libGUgPSB2YWw7XG59XG5leHBvcnRzLnNldFJlc3VsdFZpc2libGUgPSBzZXRSZXN1bHRWaXNpYmxlO1xuZnVuY3Rpb24gc2V0Q3VycmVudFdvcmRFbGVtZW50SW5kZXgodmFsKSB7XG4gICAgZXhwb3J0cy5jdXJyZW50V29yZEVsZW1lbnRJbmRleCA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0Q3VycmVudFdvcmRFbGVtZW50SW5kZXggPSBzZXRDdXJyZW50V29yZEVsZW1lbnRJbmRleDtcbmZ1bmN0aW9uIHNldEFjdGl2ZVdvcmRUb3AodmFsKSB7XG4gICAgZXhwb3J0cy5hY3RpdmVXb3JkVG9wID0gdmFsO1xufVxuZXhwb3J0cy5zZXRBY3RpdmVXb3JkVG9wID0gc2V0QWN0aXZlV29yZFRvcDtcbmxldCByZXN0YXJ0aW5nUmVzb2x2ZTtcbmZ1bmN0aW9uIHNldFRlc3RSZXN0YXJ0aW5nKHZhbCkge1xuICAgIGV4cG9ydHMudGVzdFJlc3RhcnRpbmcgPSB2YWw7XG4gICAgaWYgKHZhbCA9PT0gdHJ1ZSkge1xuICAgICAgICBleHBvcnRzLnRlc3RSZXN0YXJ0aW5nUHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICByZXN0YXJ0aW5nUmVzb2x2ZSA9IHJlc29sdmU7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKHJlc3RhcnRpbmdSZXNvbHZlKVxuICAgICAgICAgICAgcmVzdGFydGluZ1Jlc29sdmUoKTtcbiAgICAgICAgcmVzdGFydGluZ1Jlc29sdmUgPSBudWxsO1xuICAgIH1cbn1cbmV4cG9ydHMuc2V0VGVzdFJlc3RhcnRpbmcgPSBzZXRUZXN0UmVzdGFydGluZztcbmZ1bmN0aW9uIHNldFJlc3VsdENhbGN1bGF0aW5nKHZhbCkge1xuICAgIGV4cG9ydHMucmVzdWx0Q2FsY3VsYXRpbmcgPSB2YWw7XG59XG5leHBvcnRzLnNldFJlc3VsdENhbGN1bGF0aW5nID0gc2V0UmVzdWx0Q2FsY3VsYXRpbmc7XG5mdW5jdGlvbiByZXNldCgpIHtcbiAgICBleHBvcnRzLmN1cnJlbnRUZXN0TGluZSA9IDA7XG4gICAgZXhwb3J0cy5jdXJyZW50V29yZEVsZW1lbnRJbmRleCA9IDA7XG59XG5leHBvcnRzLnJlc2V0ID0gcmVzZXQ7XG5mdW5jdGlvbiBmb2N1c1dvcmRzKCkge1xuICAgIGlmICghJChcIiN3b3Jkc1dyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiN3b3Jkc0lucHV0XCIpLnRyaWdnZXIoXCJmb2N1c1wiKTtcbiAgICB9XG59XG5leHBvcnRzLmZvY3VzV29yZHMgPSBmb2N1c1dvcmRzO1xuZnVuY3Rpb24gdXBkYXRlQWN0aXZlRWxlbWVudChiYWNrc3BhY2UpIHtcbiAgICBjb25zdCBhY3RpdmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3dvcmRzIC5hY3RpdmVcIik7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiICYmIGJhY2tzcGFjZSkge1xuICAgICAgICBhY3RpdmUgPT09IG51bGwgfHwgYWN0aXZlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhY3RpdmUucmVtb3ZlKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGFjdGl2ZSAhPT0gbnVsbCkge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5oaWdobGlnaHRNb2RlID09IFwid29yZFwiKSB7XG4gICAgICAgICAgICBhY3RpdmUucXVlcnlTZWxlY3RvckFsbChcImxldHRlclwiKS5mb3JFYWNoKChlKSA9PiB7XG4gICAgICAgICAgICAgICAgZS5jbGFzc0xpc3QucmVtb3ZlKFwiY29ycmVjdFwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGFjdGl2ZS5jbGFzc0xpc3QucmVtb3ZlKFwiYWN0aXZlXCIpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhY3RpdmVXb3JkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIiN3b3JkcyAud29yZFwiKVtleHBvcnRzLmN1cnJlbnRXb3JkRWxlbWVudEluZGV4XTtcbiAgICAgICAgYWN0aXZlV29yZC5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuICAgICAgICBhY3RpdmVXb3JkLmNsYXNzTGlzdC5yZW1vdmUoXCJlcnJvclwiKTtcbiAgICAgICAgZXhwb3J0cy5hY3RpdmVXb3JkVG9wID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN3b3JkcyAuYWN0aXZlXCIpXG4gICAgICAgICAgICAub2Zmc2V0VG9wO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5oaWdobGlnaHRNb2RlID09IFwid29yZFwiKSB7XG4gICAgICAgICAgICBhY3RpdmVXb3JkLnF1ZXJ5U2VsZWN0b3JBbGwoXCJsZXR0ZXJcIikuZm9yRWFjaCgoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGUuY2xhc3NMaXN0LmFkZChcImNvcnJlY3RcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoZSkgeyB9XG59XG5leHBvcnRzLnVwZGF0ZUFjdGl2ZUVsZW1lbnQgPSB1cGRhdGVBY3RpdmVFbGVtZW50O1xuZnVuY3Rpb24gZ2V0V29yZEhUTUwod29yZCkge1xuICAgIGxldCBuZXdsaW5lYWZ0ZXIgPSBmYWxzZTtcbiAgICBsZXQgcmV0dmFsID0gYDxkaXYgY2xhc3M9J3dvcmQnPmA7XG4gICAgZm9yIChsZXQgYyA9IDA7IGMgPCB3b3JkLmxlbmd0aDsgYysrKSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICAgICAgaWYgKHdvcmQuY2hhckF0KGMpID09PSBcIuKGkVwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dmFsICs9IGA8bGV0dGVyPjxpIGNsYXNzPVwiZmFzIGZhLWFycm93LXVwXCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAod29yZC5jaGFyQXQoYykgPT09IFwi4oaTXCIpIHtcbiAgICAgICAgICAgICAgICByZXR2YWwgKz0gYDxsZXR0ZXI+PGkgY2xhc3M9XCJmYXMgZmEtYXJyb3ctZG93blwiPjwvaT48L2xldHRlcj5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHdvcmQuY2hhckF0KGMpID09PSBcIuKGkFwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dmFsICs9IGA8bGV0dGVyPjxpIGNsYXNzPVwiZmFzIGZhLWFycm93LWxlZnRcIj48L2k+PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh3b3JkLmNoYXJBdChjKSA9PT0gXCLihpJcIikge1xuICAgICAgICAgICAgICAgIHJldHZhbCArPSBgPGxldHRlcj48aSBjbGFzcz1cImZhcyBmYS1hcnJvdy1yaWdodFwiPjwvaT48L2xldHRlcj5gO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHdvcmQuY2hhckF0KGMpID09PSBcIlxcdFwiKSB7XG4gICAgICAgICAgICByZXR2YWwgKz0gYDxsZXR0ZXIgY2xhc3M9J3RhYkNoYXInPjxpIGNsYXNzPVwiZmFzIGZhLWxvbmctYXJyb3ctYWx0LXJpZ2h0XCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAod29yZC5jaGFyQXQoYykgPT09IFwiXFxuXCIpIHtcbiAgICAgICAgICAgIG5ld2xpbmVhZnRlciA9IHRydWU7XG4gICAgICAgICAgICByZXR2YWwgKz0gYDxsZXR0ZXIgY2xhc3M9J25sQ2hhcic+PGkgY2xhc3M9XCJmYXMgZmEtYW5nbGUtZG93blwiPjwvaT48L2xldHRlcj5gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dmFsICs9IFwiPGxldHRlcj5cIiArIHdvcmQuY2hhckF0KGMpICsgXCI8L2xldHRlcj5cIjtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR2YWwgKz0gXCI8L2Rpdj5cIjtcbiAgICBpZiAobmV3bGluZWFmdGVyKVxuICAgICAgICByZXR2YWwgKz0gXCI8ZGl2IGNsYXNzPSduZXdsaW5lJz48L2Rpdj5cIjtcbiAgICByZXR1cm4gcmV0dmFsO1xufVxuZnVuY3Rpb24gc2hvd1dvcmRzKCkge1xuICAgICQoXCIjd29yZHNcIikuZW1wdHkoKTtcbiAgICBsZXQgd29yZHNIVE1MID0gXCJcIjtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9PSBcInplblwiKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgVGVzdFdvcmRzLndvcmRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB3b3Jkc0hUTUwgKz0gZ2V0V29yZEhUTUwoVGVzdFdvcmRzLndvcmRzLmdldChpKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHdvcmRzSFRNTCA9XG4gICAgICAgICAgICAnPGRpdiBjbGFzcz1cIndvcmRcIj53b3JkIGhlaWdodDwvZGl2PjxkaXYgY2xhc3M9XCJ3b3JkIGFjdGl2ZVwiPjwvZGl2Pic7XG4gICAgfVxuICAgICQoXCIjd29yZHNcIikuaHRtbCh3b3Jkc0hUTUwpO1xuICAgICQoXCIjd29yZHNXcmFwcGVyXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIGNvbnN0IHdvcmRIZWlnaHQgPSAoJChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLndvcmRcIikpLm91dGVySGVpZ2h0KHRydWUpKTtcbiAgICBjb25zdCB3b3Jkc0hlaWdodCA9ICgkKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjd29yZHNcIikpLm91dGVySGVpZ2h0KHRydWUpKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zaG93QWxsTGluZXMgJiZcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9IFwidGltZVwiICYmXG4gICAgICAgICEoQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gJiYgQ3VzdG9tVGV4dC53b3JkID09IDApICYmXG4gICAgICAgICFDdXN0b21UZXh0LmlzVGltZVJhbmRvbSkge1xuICAgICAgICAkKFwiI3dvcmRzXCIpLmNzcyhcImhlaWdodFwiLCBcImF1dG9cIik7XG4gICAgICAgICQoXCIjd29yZHNXcmFwcGVyXCIpLmNzcyhcImhlaWdodFwiLCBcImF1dG9cIik7XG4gICAgICAgIGxldCBuaCA9IHdvcmRIZWlnaHQgKiAzO1xuICAgICAgICBpZiAobmggPiB3b3Jkc0hlaWdodCkge1xuICAgICAgICAgICAgbmggPSB3b3Jkc0hlaWdodDtcbiAgICAgICAgfVxuICAgICAgICAkKFwiLm91dE9mRm9jdXNXYXJuaW5nXCIpLmNzcyhcImxpbmUtaGVpZ2h0XCIsIG5oICsgXCJweFwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIjd29yZHNcIilcbiAgICAgICAgICAgIC5jc3MoXCJoZWlnaHRcIiwgd29yZEhlaWdodCAqIDQgKyBcInB4XCIpXG4gICAgICAgICAgICAuY3NzKFwib3ZlcmZsb3dcIiwgXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjd29yZHNXcmFwcGVyXCIpXG4gICAgICAgICAgICAuY3NzKFwiaGVpZ2h0XCIsIHdvcmRIZWlnaHQgKiAzICsgXCJweFwiKVxuICAgICAgICAgICAgLmNzcyhcIm92ZXJmbG93XCIsIFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiLm91dE9mRm9jdXNXYXJuaW5nXCIpLmNzcyhcImxpbmUtaGVpZ2h0XCIsIHdvcmRIZWlnaHQgKiAzICsgXCJweFwiKTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ6ZW5cIikge1xuICAgICAgICAkKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIud29yZFwiKSkucmVtb3ZlKCk7XG4gICAgfVxuICAgIHVwZGF0ZUFjdGl2ZUVsZW1lbnQoKTtcbiAgICBDYXJldC51cGRhdGVQb3NpdGlvbigpO1xufVxuZXhwb3J0cy5zaG93V29yZHMgPSBzaG93V29yZHM7XG5mdW5jdGlvbiBhZGRXb3JkKHdvcmQpIHtcbiAgICAkKFwiI3dvcmRzXCIpLmFwcGVuZChnZXRXb3JkSFRNTCh3b3JkKSk7XG59XG5leHBvcnRzLmFkZFdvcmQgPSBhZGRXb3JkO1xuZnVuY3Rpb24gZmxpcENvbG9ycyh0Zikge1xuICAgIGlmICh0Zikge1xuICAgICAgICAkKFwiI3dvcmRzXCIpLmFkZENsYXNzKFwiZmxpcHBlZFwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIjd29yZHNcIikucmVtb3ZlQ2xhc3MoXCJmbGlwcGVkXCIpO1xuICAgIH1cbn1cbmV4cG9ydHMuZmxpcENvbG9ycyA9IGZsaXBDb2xvcnM7XG5mdW5jdGlvbiBjb2xvcmZ1bCh0Yykge1xuICAgIGlmICh0Yykge1xuICAgICAgICAkKFwiI3dvcmRzXCIpLmFkZENsYXNzKFwiY29sb3JmdWxNb2RlXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcImNvbG9yZnVsTW9kZVwiKTtcbiAgICB9XG59XG5leHBvcnRzLmNvbG9yZnVsID0gY29sb3JmdWw7XG5mdW5jdGlvbiBzY3JlZW5zaG90KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGxldCByZXZlYWxSZXBsYXkgPSBmYWxzZTtcbiAgICAgICAgZnVuY3Rpb24gcmV2ZXJ0U2NyZWVuc2hvdCgpIHtcbiAgICAgICAgICAgICQoXCIjbm90aWZpY2F0aW9uQ2VudGVyXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIiNjb21tYW5kTGluZU1vYmlsZUJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgLnNzV2F0ZXJtYXJrXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAuc3NXYXRlcm1hcmtcIikudGV4dChcIm1vbmtleXR5cGUuY29tXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAuYnV0dG9uc1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIGlmIChyZXZlYWxSZXBsYXkpXG4gICAgICAgICAgICAgICAgJChcIiNyZXN1bHRSZXBsYXlcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAkKFwiLnBhZ2VUZXN0IC5sb2dpblRpcFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoISQoXCIjcmVzdWx0UmVwbGF5XCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICAgICByZXZlYWxSZXBsYXkgPSB0cnVlO1xuICAgICAgICAgICAgUmVwbGF5LnBhdXNlUmVwbGF5KCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGF0ZU5vdyA9IG5ldyBEYXRlKERhdGUubm93KCkpO1xuICAgICAgICAkKFwiI3Jlc3VsdFJlcGxheVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIi5wYWdlVGVzdCAuc3NXYXRlcm1hcmtcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIucGFnZVRlc3QgLnNzV2F0ZXJtYXJrXCIpLnRleHQoKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGVOb3csIFwiZGQgTU1NIHl5eXkgSEg6bW1cIikgKyBcIiB8IG1vbmtleXR5cGUuY29tIFwiKTtcbiAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciAhPSBudWxsKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0IC5zc1dhdGVybWFya1wiKS50ZXh0KERCLmdldFNuYXBzaG90KCkubmFtZSArXG4gICAgICAgICAgICAgICAgXCIgfCBcIiArXG4gICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGVOb3csIFwiZGQgTU1NIHl5eXkgSEg6bW1cIikgK1xuICAgICAgICAgICAgICAgIFwiIHwgbW9ua2V5dHlwZS5jb20gIFwiKTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiLnBhZ2VUZXN0IC5idXR0b25zXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICBjb25zdCBzcmMgPSAkKFwiI21pZGRsZVwiKTtcbiAgICAgICAgY29uc3Qgc291cmNlWCA9IHNyYy5wb3NpdGlvbigpLmxlZnQ7IC8qWCBwb3NpdGlvbiBmcm9tIGRpdiN0YXJnZXQqL1xuICAgICAgICBjb25zdCBzb3VyY2VZID0gc3JjLnBvc2l0aW9uKCkudG9wOyAvKlkgcG9zaXRpb24gZnJvbSBkaXYjdGFyZ2V0Ki9cbiAgICAgICAgY29uc3Qgc291cmNlV2lkdGggPSAoc3JjLm91dGVyV2lkdGgodHJ1ZSkpOyAvKmNsaWVudFdpZHRoL29mZnNldFdpZHRoIGZyb20gZGl2I3RhcmdldCovXG4gICAgICAgIGNvbnN0IHNvdXJjZUhlaWdodCA9IChzcmMub3V0ZXJIZWlnaHQodHJ1ZSkpOyAvKmNsaWVudEhlaWdodC9vZmZzZXRIZWlnaHQgZnJvbSBkaXYjdGFyZ2V0Ki9cbiAgICAgICAgJChcIiNub3RpZmljYXRpb25DZW50ZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjY29tbWFuZExpbmVNb2JpbGVCdXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIucGFnZVRlc3QgLmxvZ2luVGlwXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcGFkZGluZ1ggPSA1MDtcbiAgICAgICAgICAgIGNvbnN0IHBhZGRpbmdZID0gMjU7XG4gICAgICAgICAgICBodG1sMmNhbnZhcyhkb2N1bWVudC5ib2R5LCB7XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiB5aWVsZCBUaGVtZUNvbG9ycy5nZXQoXCJiZ1wiKSxcbiAgICAgICAgICAgICAgICB3aWR0aDogc291cmNlV2lkdGggKyBwYWRkaW5nWCAqIDIsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBzb3VyY2VIZWlnaHQgKyBwYWRkaW5nWSAqIDIsXG4gICAgICAgICAgICAgICAgeDogc291cmNlWCAtIHBhZGRpbmdYLFxuICAgICAgICAgICAgICAgIHk6IHNvdXJjZVkgLSBwYWRkaW5nWSxcbiAgICAgICAgICAgIH0pLnRoZW4oKGNhbnZhcykgPT4ge1xuICAgICAgICAgICAgICAgIGNhbnZhcy50b0Jsb2IoKGJsb2IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9iID09PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcImZpcmVmb3hcIikgPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW4oVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2ZXJ0U2NyZWVuc2hvdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2aWdhdG9yLmNsaXBib2FyZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAud3JpdGUoW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgQ2xpcGJvYXJkSXRlbShPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sIGJsb2IudHlwZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGJsb2IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkNvcGllZCB0byBjbGlwYm9hcmRcIiwgMSwgMik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldmVydFNjcmVlbnNob3QoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJFcnJvciBzYXZpbmcgaW1hZ2UgdG8gY2xpcGJvYXJkOiBcIiArIGUubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV2ZXJ0U2NyZWVuc2hvdCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJFcnJvciBjcmVhdGluZyBpbWFnZTogXCIgKyBlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgIHJldmVydFNjcmVlbnNob3QoKTtcbiAgICAgICAgfVxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHJldmVydFNjcmVlbnNob3QoKTtcbiAgICAgICAgfSwgMzAwMCk7XG4gICAgfSk7XG59XG5leHBvcnRzLnNjcmVlbnNob3QgPSBzY3JlZW5zaG90O1xuZnVuY3Rpb24gdXBkYXRlV29yZEVsZW1lbnQoc2hvd0Vycm9yID0gIWNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlKSB7XG4gICAgY29uc3QgaW5wdXQgPSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudDtcbiAgICBjb25zdCB3b3JkQXRJbmRleCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjd29yZHMgLndvcmQuYWN0aXZlXCIpO1xuICAgIGNvbnN0IGN1cnJlbnRXb3JkID0gVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKTtcbiAgICBpZiAoIWN1cnJlbnRXb3JkICYmIGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJ6ZW5cIilcbiAgICAgICAgcmV0dXJuO1xuICAgIGxldCByZXQgPSBcIlwiO1xuICAgIGxldCBuZXdsaW5lYWZ0ZXIgPSBmYWxzZTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInplblwiKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChUZXN0SW5wdXQuaW5wdXQuY3VycmVudFtpXSA9PT0gXCJcXHRcIikge1xuICAgICAgICAgICAgICAgIHJldCArPSBgPGxldHRlciBjbGFzcz0ndGFiQ2hhciBjb3JyZWN0JyBzdHlsZT1cIm9wYWNpdHk6IDBcIj48aSBjbGFzcz1cImZhcyBmYS1sb25nLWFycm93LWFsdC1yaWdodFwiPjwvaT48L2xldHRlcj5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoVGVzdElucHV0LmlucHV0LmN1cnJlbnRbaV0gPT09IFwiXFxuXCIpIHtcbiAgICAgICAgICAgICAgICBuZXdsaW5lYWZ0ZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHJldCArPSBgPGxldHRlciBjbGFzcz0nbmxDaGFyIGNvcnJlY3QnIHN0eWxlPVwib3BhY2l0eTogMFwiPjxpIGNsYXNzPVwiZmFzIGZhLWFuZ2xlLWRvd25cIj48L2k+PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldCArPSBgPGxldHRlciBjbGFzcz1cImNvcnJlY3RcIj4ke1Rlc3RJbnB1dC5pbnB1dC5jdXJyZW50W2ldfTwvbGV0dGVyPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGxldCBjb3JyZWN0U29GYXIgPSBmYWxzZTtcbiAgICAgICAgLy8gc2xpY2UgZWFybGllciBpZiBpbnB1dCBoYXMgdHJhaWxpbmcgY29tcG9zZSBjaGFyYWN0ZXJzXG4gICAgICAgIGNvbnN0IGlucHV0V2l0aG91dENvbXBvc2VMZW5ndGggPSBNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzLnRlc3QoaW5wdXQpXG4gICAgICAgICAgICA/IGlucHV0LnNlYXJjaChNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzKVxuICAgICAgICAgICAgOiBpbnB1dC5sZW5ndGg7XG4gICAgICAgIGlmIChpbnB1dC5zZWFyY2goTWlzYy50cmFpbGluZ0NvbXBvc2VDaGFycykgPCBjdXJyZW50V29yZC5sZW5ndGggJiZcbiAgICAgICAgICAgIGN1cnJlbnRXb3JkLnNsaWNlKDAsIGlucHV0V2l0aG91dENvbXBvc2VMZW5ndGgpID09PVxuICAgICAgICAgICAgICAgIGlucHV0LnNsaWNlKDAsIGlucHV0V2l0aG91dENvbXBvc2VMZW5ndGgpKSB7XG4gICAgICAgICAgICBjb3JyZWN0U29GYXIgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGxldCB3b3JkSGlnaGxpZ2h0Q2xhc3NTdHJpbmcgPSBjb3JyZWN0U29GYXIgPyBcImNvcnJlY3RcIiA6IFwiaW5jb3JyZWN0XCI7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSkge1xuICAgICAgICAgICAgd29yZEhpZ2hsaWdodENsYXNzU3RyaW5nID0gXCJjb3JyZWN0XCI7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgY2hhckNvcnJlY3QgPSBjdXJyZW50V29yZFtpXSA9PSBpbnB1dFtpXTtcbiAgICAgICAgICAgIGxldCBjb3JyZWN0Q2xhc3MgPSBcImNvcnJlY3RcIjtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmhpZ2hsaWdodE1vZGUgPT0gXCJvZmZcIikge1xuICAgICAgICAgICAgICAgIGNvcnJlY3RDbGFzcyA9IFwiXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgY3VycmVudExldHRlciA9IGN1cnJlbnRXb3JkW2ldO1xuICAgICAgICAgICAgbGV0IHRhYkNoYXIgPSBcIlwiO1xuICAgICAgICAgICAgbGV0IG5sQ2hhciA9IFwiXCI7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwiYXJyb3dzXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudExldHRlciA9PT0gXCLihpFcIikge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGV0dGVyID0gYDxpIGNsYXNzPVwiZmFzIGZhLWFycm93LXVwXCI+PC9pPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50TGV0dGVyID09PSBcIuKGk1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMZXR0ZXIgPSBgPGkgY2xhc3M9XCJmYXMgZmEtYXJyb3ctZG93blwiPjwvaT5gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudExldHRlciA9PT0gXCLihpBcIikge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGV0dGVyID0gYDxpIGNsYXNzPVwiZmFzIGZhLWFycm93LWxlZnRcIj48L2k+YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRMZXR0ZXIgPT09IFwi4oaSXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudExldHRlciA9IGA8aSBjbGFzcz1cImZhcyBmYS1hcnJvdy1yaWdodFwiPjwvaT5gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRMZXR0ZXIgPT09IFwiXFx0XCIpIHtcbiAgICAgICAgICAgICAgICB0YWJDaGFyID0gXCJ0YWJDaGFyXCI7XG4gICAgICAgICAgICAgICAgY3VycmVudExldHRlciA9IGA8aSBjbGFzcz1cImZhcyBmYS1sb25nLWFycm93LWFsdC1yaWdodFwiPjwvaT5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudExldHRlciA9PT0gXCJcXG5cIikge1xuICAgICAgICAgICAgICAgIG5sQ2hhciA9IFwibmxDaGFyXCI7XG4gICAgICAgICAgICAgICAgY3VycmVudExldHRlciA9IGA8aSBjbGFzcz1cImZhcyBmYS1hbmdsZS1kb3duXCI+PC9pPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoTWlzYy50cmFpbGluZ0NvbXBvc2VDaGFycy50ZXN0KGlucHV0KSAmJlxuICAgICAgICAgICAgICAgIGkgPiBpbnB1dC5zZWFyY2goTWlzYy50cmFpbGluZ0NvbXBvc2VDaGFycykpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjaGFyQ29ycmVjdCkge1xuICAgICAgICAgICAgICAgIHJldCArPSBgPGxldHRlciBjbGFzcz1cIiR7Y29uZmlnXzEuZGVmYXVsdC5oaWdobGlnaHRNb2RlID09IFwid29yZFwiXG4gICAgICAgICAgICAgICAgICAgID8gd29yZEhpZ2hsaWdodENsYXNzU3RyaW5nXG4gICAgICAgICAgICAgICAgICAgIDogY29ycmVjdENsYXNzfSAke3RhYkNoYXJ9JHtubENoYXJ9XCI+JHtjdXJyZW50TGV0dGVyfTwvbGV0dGVyPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50TGV0dGVyICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgICAgICBNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzLnRlc3QoaW5wdXQpICYmXG4gICAgICAgICAgICAgICAgaSA9PT0gaW5wdXQuc2VhcmNoKE1pc2MudHJhaWxpbmdDb21wb3NlQ2hhcnMpKSB7XG4gICAgICAgICAgICAgICAgcmV0ICs9IGA8bGV0dGVyIGNsYXNzPVwiJHtjb25maWdfMS5kZWZhdWx0LmhpZ2hsaWdodE1vZGUgPT0gXCJ3b3JkXCIgPyB3b3JkSGlnaGxpZ2h0Q2xhc3NTdHJpbmcgOiBcIlwifSBkZWFkXCI+JHtjdXJyZW50TGV0dGVyfTwvbGV0dGVyPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghc2hvd0Vycm9yKSB7XG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRMZXR0ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICByZXQgKz0gYDxsZXR0ZXIgY2xhc3M9XCIke2NvbmZpZ18xLmRlZmF1bHQuaGlnaGxpZ2h0TW9kZSA9PSBcIndvcmRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgPyB3b3JkSGlnaGxpZ2h0Q2xhc3NTdHJpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgIDogY29ycmVjdENsYXNzfSAke3RhYkNoYXJ9JHtubENoYXJ9XCI+JHtjdXJyZW50TGV0dGVyfTwvbGV0dGVyPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudExldHRlciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LmhpZGVFeHRyYUxldHRlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGxldHRlciA9IGlucHV0W2ldO1xuICAgICAgICAgICAgICAgICAgICBpZiAobGV0dGVyID09IFwiIFwiIHx8IGxldHRlciA9PSBcIlxcdFwiIHx8IGxldHRlciA9PSBcIlxcblwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXR0ZXIgPSBcIl9cIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXQgKz0gYDxsZXR0ZXIgY2xhc3M9XCIke2NvbmZpZ18xLmRlZmF1bHQuaGlnaGxpZ2h0TW9kZSA9PSBcIndvcmRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgPyB3b3JkSGlnaGxpZ2h0Q2xhc3NTdHJpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgIDogXCJpbmNvcnJlY3RcIn0gZXh0cmEgJHt0YWJDaGFyfSR7bmxDaGFyfVwiPiR7bGV0dGVyfTwvbGV0dGVyPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0ICs9XG4gICAgICAgICAgICAgICAgICAgIGA8bGV0dGVyIGNsYXNzPVwiJHtjb25maWdfMS5kZWZhdWx0LmhpZ2hsaWdodE1vZGUgPT0gXCJ3b3JkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgID8gd29yZEhpZ2hsaWdodENsYXNzU3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICA6IFwiaW5jb3JyZWN0XCJ9ICR7dGFiQ2hhcn0ke25sQ2hhcn1cIj5gICtcbiAgICAgICAgICAgICAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0LmluZGljYXRlVHlwb3MgPT09IFwicmVwbGFjZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBpbnB1dFtpXSA9PSBcIiBcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IFwiX1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogaW5wdXRbaV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGN1cnJlbnRMZXR0ZXIpICtcbiAgICAgICAgICAgICAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0LmluZGljYXRlVHlwb3MgPT09IFwiYmVsb3dcIiA/IGA8aGludD4ke2lucHV0W2ldfTwvaGludD5gIDogXCJcIikgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCI8L2xldHRlcj5cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpbnB1dFdpdGhTaW5nbGVDb21wb3NlTGVuZ3RoID0gTWlzYy50cmFpbGluZ0NvbXBvc2VDaGFycy50ZXN0KGlucHV0KVxuICAgICAgICAgICAgPyBpbnB1dC5zZWFyY2goTWlzYy50cmFpbGluZ0NvbXBvc2VDaGFycykgKyAxXG4gICAgICAgICAgICA6IGlucHV0Lmxlbmd0aDtcbiAgICAgICAgaWYgKGlucHV0V2l0aFNpbmdsZUNvbXBvc2VMZW5ndGggPCBjdXJyZW50V29yZC5sZW5ndGgpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSBpbnB1dFdpdGhTaW5nbGVDb21wb3NlTGVuZ3RoOyBpIDwgY3VycmVudFdvcmQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwiYXJyb3dzXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRXb3JkW2ldID09PSBcIuKGkVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXQgKz0gYDxsZXR0ZXI+PGkgY2xhc3M9XCJmYXMgZmEtYXJyb3ctdXBcIj48L2k+PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFdvcmRbaV0gPT09IFwi4oaTXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldCArPSBgPGxldHRlcj48aSBjbGFzcz1cImZhcyBmYS1hcnJvdy1kb3duXCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRXb3JkW2ldID09PSBcIuKGkFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXQgKz0gYDxsZXR0ZXI+PGkgY2xhc3M9XCJmYXMgZmEtYXJyb3ctbGVmdFwiPjwvaT48L2xldHRlcj5gO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50V29yZFtpXSA9PT0gXCLihpJcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0ICs9IGA8bGV0dGVyPjxpIGNsYXNzPVwiZmFzIGZhLWFycm93LXJpZ2h0XCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudFdvcmRbaV0gPT09IFwiXFx0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0ICs9IGA8bGV0dGVyIGNsYXNzPSd0YWJDaGFyJz48aSBjbGFzcz1cImZhcyBmYS1sb25nLWFycm93LWFsdC1yaWdodFwiPjwvaT48L2xldHRlcj5gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50V29yZFtpXSA9PT0gXCJcXG5cIikge1xuICAgICAgICAgICAgICAgICAgICByZXQgKz0gYDxsZXR0ZXIgY2xhc3M9J25sQ2hhcic+PGkgY2xhc3M9XCJmYXMgZmEtYW5nbGUtZG93blwiPjwvaT48L2xldHRlcj5gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0ICs9XG4gICAgICAgICAgICAgICAgICAgICAgICBgPGxldHRlciBjbGFzcz1cIiR7Y29uZmlnXzEuZGVmYXVsdC5oaWdobGlnaHRNb2RlID09IFwid29yZFwiID8gd29yZEhpZ2hsaWdodENsYXNzU3RyaW5nIDogXCJcIn1cIj5gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50V29yZFtpXSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCI8L2xldHRlcj5cIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuaGlnaGxpZ2h0TW9kZSA9PT0gXCJsZXR0ZXJcIiAmJiBjb25maWdfMS5kZWZhdWx0LmhpZGVFeHRyYUxldHRlcnMpIHtcbiAgICAgICAgICAgIGlmIChpbnB1dC5sZW5ndGggPiBjdXJyZW50V29yZC5sZW5ndGggJiYgIWNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlKSB7XG4gICAgICAgICAgICAgICAgJCh3b3JkQXRJbmRleCkuYWRkQ2xhc3MoXCJlcnJvclwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGlucHV0Lmxlbmd0aCA9PSBjdXJyZW50V29yZC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAkKHdvcmRBdEluZGV4KS5yZW1vdmVDbGFzcyhcImVycm9yXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHdvcmRBdEluZGV4LmlubmVySFRNTCA9IHJldDtcbiAgICBpZiAobmV3bGluZWFmdGVyKVxuICAgICAgICAkKFwiI3dvcmRzXCIpLmFwcGVuZChcIjxkaXYgY2xhc3M9J25ld2xpbmUnPjwvZGl2PlwiKTtcbn1cbmV4cG9ydHMudXBkYXRlV29yZEVsZW1lbnQgPSB1cGRhdGVXb3JkRWxlbWVudDtcbmZ1bmN0aW9uIGxpbmVKdW1wKGN1cnJlbnRUb3ApIHtcbiAgICB2YXIgX2E7XG4gICAgLy9sYXN0IHdvcmQgb2YgdGhlIGxpbmVcbiAgICBpZiAoZXhwb3J0cy5jdXJyZW50VGVzdExpbmUgPiAwKSB7XG4gICAgICAgIGNvbnN0IGhpZGVCb3VuZCA9IGN1cnJlbnRUb3A7XG4gICAgICAgIGNvbnN0IHRvSGlkZSA9IFtdO1xuICAgICAgICBjb25zdCB3b3JkRWxlbWVudHMgPSAkKFwiI3dvcmRzIC53b3JkXCIpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV4cG9ydHMuY3VycmVudFdvcmRFbGVtZW50SW5kZXg7IGkrKykge1xuICAgICAgICAgICAgaWYgKCQod29yZEVsZW1lbnRzW2ldKS5oYXNDbGFzcyhcImhpZGRlblwiKSlcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIGNvbnN0IGZvcldvcmRUb3AgPSBNYXRoLmZsb29yKHdvcmRFbGVtZW50c1tpXS5vZmZzZXRUb3ApO1xuICAgICAgICAgICAgaWYgKGZvcldvcmRUb3AgPCBoaWRlQm91bmQgLSAxMCkge1xuICAgICAgICAgICAgICAgIHRvSGlkZS5wdXNoKCQoJChcIiN3b3JkcyAud29yZFwiKVtpXSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHdvcmRIZWlnaHQgPSAoJChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLndvcmRcIikpLm91dGVySGVpZ2h0KHRydWUpKTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc21vb3RoTGluZVNjcm9sbCAmJiB0b0hpZGUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZXhwb3J0cy5saW5lVHJhbnNpdGlvbiA9IHRydWU7XG4gICAgICAgICAgICAkKFwiI3dvcmRzXCIpLnByZXBlbmQoYDxkaXYgY2xhc3M9XCJzbW9vdGhTY3JvbGxlclwiIHN0eWxlPVwicG9zaXRpb246IGZpeGVkO2hlaWdodDoke3dvcmRIZWlnaHR9cHg7d2lkdGg6MTAwJVwiPjwvZGl2PmApO1xuICAgICAgICAgICAgJChcIiN3b3JkcyAuc21vb3RoU2Nyb2xsZXJcIikuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAwLFxuICAgICAgICAgICAgfSwgU2xvd1RpbWVyLmdldCgpID8gMCA6IDEyNSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICQoXCIjd29yZHMgLnNtb290aFNjcm9sbGVyXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkKFwiI3BhY2VDYXJldFwiKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICB0b3A6ICgoX2EgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BhY2VDYXJldFwiKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm9mZnNldFRvcCkgLVxuICAgICAgICAgICAgICAgICAgICB3b3JkSGVpZ2h0LFxuICAgICAgICAgICAgfSwgU2xvd1RpbWVyLmdldCgpID8gMCA6IDEyNSk7XG4gICAgICAgICAgICAkKFwiI3dvcmRzXCIpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIG1hcmdpblRvcDogYC0ke3dvcmRIZWlnaHR9cHhgLFxuICAgICAgICAgICAgfSwgU2xvd1RpbWVyLmdldCgpID8gMCA6IDEyNSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGV4cG9ydHMuYWN0aXZlV29yZFRvcCA9IChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3dvcmRzIC5hY3RpdmVcIikpLm9mZnNldFRvcDtcbiAgICAgICAgICAgICAgICBleHBvcnRzLmN1cnJlbnRXb3JkRWxlbWVudEluZGV4IC09IHRvSGlkZS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgZXhwb3J0cy5saW5lVHJhbnNpdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRvSGlkZS5mb3JFYWNoKChlbCkgPT4gZWwucmVtb3ZlKCkpO1xuICAgICAgICAgICAgICAgICQoXCIjd29yZHNcIikuY3NzKFwibWFyZ2luVG9wXCIsIFwiMFwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdG9IaWRlLmZvckVhY2goKGVsKSA9PiBlbC5yZW1vdmUoKSk7XG4gICAgICAgICAgICBleHBvcnRzLmN1cnJlbnRXb3JkRWxlbWVudEluZGV4IC09IHRvSGlkZS5sZW5ndGg7XG4gICAgICAgICAgICAkKFwiI3BhY2VDYXJldFwiKS5jc3Moe1xuICAgICAgICAgICAgICAgIHRvcDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwYWNlQ2FyZXRcIikub2Zmc2V0VG9wIC1cbiAgICAgICAgICAgICAgICAgICAgd29yZEhlaWdodCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGV4cG9ydHMuY3VycmVudFRlc3RMaW5lKys7XG59XG5leHBvcnRzLmxpbmVKdW1wID0gbGluZUp1bXA7XG5mdW5jdGlvbiBhcnJhbmdlQ2hhcmFjdGVyc1JpZ2h0VG9MZWZ0KCkge1xuICAgICQoXCIjd29yZHNcIikuYWRkQ2xhc3MoXCJyaWdodFRvTGVmdFRlc3RcIik7XG4gICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLndvcmRzXCIpLmFkZENsYXNzKFwicmlnaHRUb0xlZnRUZXN0XCIpO1xuICAgICQoXCIjcmVzdWx0UmVwbGF5IC53b3Jkc1wiKS5hZGRDbGFzcyhcInJpZ2h0VG9MZWZ0VGVzdFwiKTtcbn1cbmV4cG9ydHMuYXJyYW5nZUNoYXJhY3RlcnNSaWdodFRvTGVmdCA9IGFycmFuZ2VDaGFyYWN0ZXJzUmlnaHRUb0xlZnQ7XG5mdW5jdGlvbiBhcnJhbmdlQ2hhcmFjdGVyc0xlZnRUb1JpZ2h0KCkge1xuICAgICQoXCIjd29yZHNcIikucmVtb3ZlQ2xhc3MoXCJyaWdodFRvTGVmdFRlc3RcIik7XG4gICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLndvcmRzXCIpLnJlbW92ZUNsYXNzKFwicmlnaHRUb0xlZnRUZXN0XCIpO1xuICAgICQoXCIjcmVzdWx0UmVwbGF5IC53b3Jkc1wiKS5yZW1vdmVDbGFzcyhcInJpZ2h0VG9MZWZ0VGVzdFwiKTtcbn1cbmV4cG9ydHMuYXJyYW5nZUNoYXJhY3RlcnNMZWZ0VG9SaWdodCA9IGFycmFuZ2VDaGFyYWN0ZXJzTGVmdFRvUmlnaHQ7XG5mdW5jdGlvbiBsb2FkV29yZHNIaXN0b3J5KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICQoXCIjcmVzdWx0V29yZHNIaXN0b3J5IC53b3Jkc1wiKS5lbXB0eSgpO1xuICAgICAgICBsZXQgd29yZHNIVE1MID0gXCJcIjtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGggKyAyOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gVGVzdElucHV0LmlucHV0LmdldEhpc3RvcnkoaSk7XG4gICAgICAgICAgICBjb25zdCB3b3JkID0gVGVzdFdvcmRzLndvcmRzLmdldChpKTtcbiAgICAgICAgICAgIGxldCB3b3JkRWwgPSBcIlwiO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAoaW5wdXQgPT09IFwiXCIpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImVtcHR5IGlucHV0IHdvcmRcIik7XG4gICAgICAgICAgICAgICAgaWYgKFRlc3RJbnB1dC5jb3JyZWN0ZWQuZ2V0SGlzdG9yeShpKSAhPT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICAgICAgICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQuZ2V0SGlzdG9yeShpKSAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICB3b3JkRWwgPSBgPGRpdiBjbGFzcz0nd29yZCcgYnVyc3Q9XCIke1Rlc3RJbnB1dC5idXJzdEhpc3RvcnlbaV19XCIgaW5wdXQ9XCIke1Rlc3RJbnB1dC5jb3JyZWN0ZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRIaXN0b3J5KGkpXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXCIvZywgXCImcXVvdDtcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8gL2csIFwiX1wiKX1cIj5gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgd29yZEVsID0gYDxkaXYgY2xhc3M9J3dvcmQnIGJ1cnN0PVwiJHtUZXN0SW5wdXQuYnVyc3RIaXN0b3J5W2ldfVwiIGlucHV0PVwiJHtpbnB1dC5yZXBsYWNlKC9cIi9nLCBcIiZxdW90O1wiKS5yZXBsYWNlKC8gL2csIFwiX1wiKX1cIj5gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaSA9PT0gVGVzdElucHV0LmlucHV0Lmhpc3RvcnkubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICAvL2xhc3Qgd29yZFxuICAgICAgICAgICAgICAgICAgICBjb25zdCB3b3Jkc3RhdHMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW5jb3JyZWN0OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWlzc2VkOiAwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBsZW5ndGggPSBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIiA/IGlucHV0Lmxlbmd0aCA6IHdvcmQubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IGxlbmd0aDsgYysrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyA8IGlucHV0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vb24gY2hhciB0aGF0IHN0aWxsIGhhcyBhIHdvcmQgbGlzdCBwYWlyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiIHx8IGlucHV0W2NdID09IHdvcmRbY10pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29yZHN0YXRzLmNvcnJlY3QrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRzdGF0cy5pbmNvcnJlY3QrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL29uIGNoYXIgdGhhdCBpcyBleHRyYVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRzdGF0cy5taXNzZWQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAod29yZHN0YXRzLmluY29ycmVjdCAhPT0gMCB8fCBjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT09IFwidGltZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9IFwiemVuXCIgJiYgaW5wdXQgIT09IHdvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JkRWwgPSBgPGRpdiBjbGFzcz0nd29yZCBlcnJvcicgYnVyc3Q9XCIke1Rlc3RJbnB1dC5idXJzdEhpc3RvcnlbaV19XCIgaW5wdXQ9XCIke2lucHV0LnJlcGxhY2UoL1wiL2csIFwiJnF1b3Q7XCIpLnJlcGxhY2UoLyAvZywgXCJfXCIpfVwiPmA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT0gXCJ6ZW5cIiAmJiBpbnB1dCAhPT0gd29yZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd29yZEVsID0gYDxkaXYgY2xhc3M9J3dvcmQgZXJyb3InIGJ1cnN0PVwiJHtUZXN0SW5wdXQuYnVyc3RIaXN0b3J5W2ldfVwiIGlucHV0PVwiJHtpbnB1dC5yZXBsYWNlKC9cIi9nLCBcIiZxdW90O1wiKS5yZXBsYWNlKC8gL2csIFwiX1wiKX1cIj5gO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxldCBsb29wO1xuICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIiB8fCBpbnB1dC5sZW5ndGggPiB3b3JkLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAvL2lucHV0IGlzIGxvbmdlciAtIGV4dHJhIGNoYXJhY3RlcnMgcG9zc2libGUgKGxvb3Agb3ZlciBpbnB1dClcbiAgICAgICAgICAgICAgICAgICAgbG9vcCA9IGlucHV0Lmxlbmd0aDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vaW5wdXQgaXMgc2hvcnRlciBvciBlcXVhbCAobG9vcCBvdmVyIHdvcmQgbGlzdClcbiAgICAgICAgICAgICAgICAgICAgbG9vcCA9IHdvcmQubGVuZ3RoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IGxvb3A7IGMrKykge1xuICAgICAgICAgICAgICAgICAgICBsZXQgY29ycmVjdGVkQ2hhcjtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3RlZENoYXIgPSBUZXN0SW5wdXQuY29ycmVjdGVkLmdldEhpc3RvcnkoaSlbY107XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3RlZENoYXIgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbGV0IGV4dHJhQ29ycmVjdGVkID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGMgKyAxID09PSBsb29wICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBUZXN0SW5wdXQuY29ycmVjdGVkLmdldEhpc3RvcnkoaSkgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgVGVzdElucHV0LmNvcnJlY3RlZC5nZXRIaXN0b3J5KGkpLmxlbmd0aCA+IGlucHV0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFDb3JyZWN0ZWQgPSBcImV4dHJhQ29ycmVjdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiIHx8IHdvcmRbY10gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiIHx8IGlucHV0W2NdID09PSB3b3JkW2NdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvcnJlY3RlZENoYXIgPT09IGlucHV0W2NdIHx8IGNvcnJlY3RlZENoYXIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JkRWwgKz0gYDxsZXR0ZXIgY2xhc3M9XCJjb3JyZWN0ICR7ZXh0cmFDb3JyZWN0ZWR9XCI+JHtpbnB1dFtjXX08L2xldHRlcj5gO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29yZEVsICs9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgPGxldHRlciBjbGFzcz1cImNvcnJlY3RlZCAke2V4dHJhQ29ycmVjdGVkfVwiPmAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0W2NdICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIjwvbGV0dGVyPlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dFtjXSA9PT0gVGVzdElucHV0LmlucHV0LmN1cnJlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29yZEVsICs9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgPGxldHRlciBjbGFzcz0nY29ycmVjdCAke2V4dHJhQ29ycmVjdGVkfSc+YCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29yZFtjXSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCI8L2xldHRlcj5cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaW5wdXRbY10gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JkRWwgKz0gXCI8bGV0dGVyPlwiICsgd29yZFtjXSArIFwiPC9sZXR0ZXI+XCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JkRWwgKz1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA8bGV0dGVyIGNsYXNzPVwiaW5jb3JyZWN0ICR7ZXh0cmFDb3JyZWN0ZWR9XCI+YCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29yZFtjXSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCI8L2xldHRlcj5cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JkRWwgKz0gJzxsZXR0ZXIgY2xhc3M9XCJpbmNvcnJlY3QgZXh0cmFcIj4nICsgaW5wdXRbY10gKyBcIjwvbGV0dGVyPlwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHdvcmRFbCArPSBcIjwvZGl2PlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICB3b3JkRWwgPSBcIjxkaXYgY2xhc3M9J3dvcmQnPlwiO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IHdvcmQubGVuZ3RoOyBjKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRFbCArPSBcIjxsZXR0ZXI+XCIgKyB3b3JkW2NdICsgXCI8L2xldHRlcj5cIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB3b3JkRWwgKz0gXCI8L2Rpdj5cIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKF9hKSB7IH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHdvcmRzSFRNTCArPSB3b3JkRWw7XG4gICAgICAgIH1cbiAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLndvcmRzXCIpLmh0bWwod29yZHNIVE1MKTtcbiAgICAgICAgJChcIiNzaG93V29yZEhpc3RvcnlCdXR0b25cIikuYWRkQ2xhc3MoXCJsb2FkZWRcIik7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gdG9nZ2xlUmVzdWx0V29yZHMoKSB7XG4gICAgaWYgKGV4cG9ydHMucmVzdWx0VmlzaWJsZSkge1xuICAgICAgICBpZiAoJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnlcIikuc3RvcCh0cnVlLCB0cnVlKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAgICAgLy9zaG93XG4gICAgICAgICAgICBpZiAoISQoXCIjc2hvd1dvcmRIaXN0b3J5QnV0dG9uXCIpLmhhc0NsYXNzKFwibG9hZGVkXCIpKSB7XG4gICAgICAgICAgICAgICAgJChcIiN3b3Jkc1wiKS5odG1sKGA8ZGl2IGNsYXNzPVwicHJlbG9hZGVyXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtc3BpbiBmYS1jaXJjbGUtbm90Y2hcIj48L2k+PC9kaXY+YCk7XG4gICAgICAgICAgICAgICAgbG9hZFdvcmRzSGlzdG9yeSgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5idXJzdEhlYXRtYXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGx5QnVyc3RIZWF0bWFwKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnlcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNzcyhcImRpc3BsYXlcIiwgXCJub25lXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2xpZGVEb3duKDI1MCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYnVyc3RIZWF0bWFwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwbHlCdXJzdEhlYXRtYXAoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5idXJzdEhlYXRtYXApIHtcbiAgICAgICAgICAgICAgICAgICAgYXBwbHlCdXJzdEhlYXRtYXAoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnlcIilcbiAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAgICAgICAgIC5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKVxuICAgICAgICAgICAgICAgICAgICAuc2xpZGVEb3duKDI1MCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvL2hpZGVcbiAgICAgICAgICAgICQoXCIjcmVzdWx0V29yZHNIaXN0b3J5XCIpLnNsaWRlVXAoMjUwLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnlcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMudG9nZ2xlUmVzdWx0V29yZHMgPSB0b2dnbGVSZXN1bHRXb3JkcztcbmZ1bmN0aW9uIGFwcGx5QnVyc3RIZWF0bWFwKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYnVyc3RIZWF0bWFwKSB7XG4gICAgICAgICQoXCIjcmVzdWx0V29yZHNIaXN0b3J5IC5oZWF0bWFwTGVnZW5kXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICBsZXQgYnVyc3RsaXN0ID0gWy4uLlRlc3RJbnB1dC5idXJzdEhpc3RvcnldO1xuICAgICAgICBidXJzdGxpc3QgPSBidXJzdGxpc3QuZmlsdGVyKCh4KSA9PiB4ICE9PSBJbmZpbml0eSk7XG4gICAgICAgIGJ1cnN0bGlzdCA9IGJ1cnN0bGlzdC5maWx0ZXIoKHgpID0+IHggPCAzNTApO1xuICAgICAgICBpZiAoKChfYSA9IFRlc3RJbnB1dC5pbnB1dC5nZXRIaXN0b3J5KFRlc3RJbnB1dC5pbnB1dC5nZXRIaXN0b3J5KCkubGVuZ3RoIC0gMSkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpICE9PSAoKF9iID0gVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmxlbmd0aCkpIHtcbiAgICAgICAgICAgIGJ1cnN0bGlzdCA9IGJ1cnN0bGlzdC5zcGxpY2UoMCwgYnVyc3RsaXN0Lmxlbmd0aCAtIDEpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lZGlhbiA9IE1pc2MubWVkaWFuKGJ1cnN0bGlzdCk7XG4gICAgICAgIGNvbnN0IGFkYXRtID0gW107XG4gICAgICAgIGJ1cnN0bGlzdC5mb3JFYWNoKChidXJzdCkgPT4ge1xuICAgICAgICAgICAgYWRhdG0ucHVzaChNYXRoLmFicyhtZWRpYW4gLSBidXJzdCkpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3Qgc3RlcCA9IE1pc2MubWVhbihhZGF0bSk7XG4gICAgICAgIGNvbnN0IHN0ZXBzID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhbDogMCxcbiAgICAgICAgICAgICAgICBjbGFzczogXCJoZWF0bWFwLTBcIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsOiBtZWRpYW4gLSBzdGVwICogMS41LFxuICAgICAgICAgICAgICAgIGNsYXNzOiBcImhlYXRtYXAtMVwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWw6IG1lZGlhbiAtIHN0ZXAgKiAwLjUsXG4gICAgICAgICAgICAgICAgY2xhc3M6IFwiaGVhdG1hcC0yXCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhbDogbWVkaWFuICsgc3RlcCAqIDAuNSxcbiAgICAgICAgICAgICAgICBjbGFzczogXCJoZWF0bWFwLTNcIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsOiBtZWRpYW4gKyBzdGVwICogMS41LFxuICAgICAgICAgICAgICAgIGNsYXNzOiBcImhlYXRtYXAtNFwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXTtcbiAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLndvcmRzIC53b3JkXCIpLmVhY2goKF8sIHdvcmQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHdvcmRCdXJzdFZhbCA9IHBhcnNlSW50KCQod29yZCkuYXR0cihcImJ1cnN0XCIpKTtcbiAgICAgICAgICAgIGxldCBjbHMgPSBcIlwiO1xuICAgICAgICAgICAgc3RlcHMuZm9yRWFjaCgoc3RlcCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh3b3JkQnVyc3RWYWwgPiBzdGVwLnZhbClcbiAgICAgICAgICAgICAgICAgICAgY2xzID0gc3RlcC5jbGFzcztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJCh3b3JkKS5hZGRDbGFzcyhjbHMpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIjcmVzdWx0V29yZHNIaXN0b3J5IC5oZWF0bWFwTGVnZW5kXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeSAud29yZHMgLndvcmRcIikucmVtb3ZlQ2xhc3MoXCJoZWF0bWFwLTBcIik7XG4gICAgICAgICQoXCIjcmVzdWx0V29yZHNIaXN0b3J5IC53b3JkcyAud29yZFwiKS5yZW1vdmVDbGFzcyhcImhlYXRtYXAtMVwiKTtcbiAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLndvcmRzIC53b3JkXCIpLnJlbW92ZUNsYXNzKFwiaGVhdG1hcC0yXCIpO1xuICAgICAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeSAud29yZHMgLndvcmRcIikucmVtb3ZlQ2xhc3MoXCJoZWF0bWFwLTNcIik7XG4gICAgICAgICQoXCIjcmVzdWx0V29yZHNIaXN0b3J5IC53b3JkcyAud29yZFwiKS5yZW1vdmVDbGFzcyhcImhlYXRtYXAtNFwiKTtcbiAgICB9XG59XG5leHBvcnRzLmFwcGx5QnVyc3RIZWF0bWFwID0gYXBwbHlCdXJzdEhlYXRtYXA7XG5mdW5jdGlvbiBoaWdobGlnaHRCYWRXb3JkKGluZGV4LCBzaG93RXJyb3IpIHtcbiAgICBpZiAoIXNob3dFcnJvcilcbiAgICAgICAgcmV0dXJuO1xuICAgICQoJChcIiN3b3JkcyAud29yZFwiKVtpbmRleF0pLmFkZENsYXNzKFwiZXJyb3JcIik7XG59XG5leHBvcnRzLmhpZ2hsaWdodEJhZFdvcmQgPSBoaWdobGlnaHRCYWRXb3JkO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiI3NhdmVTY3JlZW5zaG90QnV0dG9uXCIsICgpID0+IHtcbiAgICBzY3JlZW5zaG90KCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjdGVzdE1vZGVzTm90aWNlIC50ZXh0LWJ1dHRvbi5ibGluZFwiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnNldEJsaW5kTW9kZSghY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUpO1xufSk7XG4kKFwiLnBhZ2VUZXN0ICNjb3B5V29yZHNMaXN0QnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IHdvcmRzO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIpIHtcbiAgICAgICAgICAgIHdvcmRzID0gVGVzdElucHV0LmlucHV0Lmhpc3Rvcnkuam9pbihcIiBcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB3b3JkcyA9IFRlc3RXb3Jkcy53b3Jkcy5nZXQoKVxuICAgICAgICAgICAgICAgIC5zbGljZSgwLCBUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgLmpvaW4oXCIgXCIpO1xuICAgICAgICB9XG4gICAgICAgIHlpZWxkIG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KHdvcmRzKTtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDb3BpZWQgdG8gY2xpcGJvYXJkXCIsIDAsIDIpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkNvdWxkIG5vdCBjb3B5IHRvIGNsaXBib2FyZDogXCIgKyBlLCAtMSk7XG4gICAgfVxufSkpO1xuJChcIi5wYWdlVGVzdCAjdG9nZ2xlQnVyc3RIZWF0bWFwXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgVXBkYXRlQ29uZmlnLnNldEJ1cnN0SGVhdG1hcCghY29uZmlnXzEuZGVmYXVsdC5idXJzdEhlYXRtYXApO1xufSkpO1xuJChkb2N1bWVudCkub24oXCJtb3VzZWxlYXZlXCIsIFwiI3Jlc3VsdFdvcmRzSGlzdG9yeSAud29yZHMgLndvcmRcIiwgKCkgPT4ge1xuICAgICQoXCIud29yZElucHV0QWZ0ZXJcIikucmVtb3ZlKCk7XG59KTtcbiQoXCIjd3BtQ2hhcnRcIikub24oXCJtb3VzZWxlYXZlXCIsICgpID0+IHtcbiAgICAkKFwiLndvcmRJbnB1dEFmdGVyXCIpLnJlbW92ZSgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcIm1vdXNlZW50ZXJcIiwgXCIjcmVzdWx0V29yZHNIaXN0b3J5IC53b3JkcyAud29yZFwiLCAoZSkgPT4ge1xuICAgIGlmIChleHBvcnRzLnJlc3VsdFZpc2libGUpIHtcbiAgICAgICAgY29uc3QgaW5wdXQgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcImlucHV0XCIpO1xuICAgICAgICBjb25zdCBidXJzdCA9IHBhcnNlSW50KCQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiYnVyc3RcIikpO1xuICAgICAgICBpZiAoaW5wdXQgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAkKGUuY3VycmVudFRhcmdldCkuYXBwZW5kKGA8ZGl2IGNsYXNzPVwid29yZElucHV0QWZ0ZXJcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidGV4dFwiPlxuICAgICAgICAgICR7aW5wdXRcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFx0L2csIFwiX1wiKVxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXG4vZywgXCJfXCIpXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoLzwvZywgXCImbHRcIilcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgvPi9nLCBcIiZndFwiKX1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwic3BlZWRcIj5cbiAgICAgICAgICAke01hdGgucm91bmQoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNID8gYnVyc3QgKiA1IDogYnVyc3QpfSR7Y29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNID8gXCJjcG1cIiA6IFwid3BtXCJ9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcbiQoXCIjd29yZHNJbnB1dFwiKS5vbihcImZvY3VzXCIsICgpID0+IHtcbiAgICBpZiAoIWV4cG9ydHMucmVzdWx0VmlzaWJsZSAmJiBjb25maWdfMS5kZWZhdWx0LnNob3dPdXRPZkZvY3VzV2FybmluZykge1xuICAgICAgICBPdXRPZkZvY3VzLmhpZGUoKTtcbiAgICB9XG4gICAgQ2FyZXQuc2hvdygpO1xufSk7XG4kKFwiI3dvcmRzSW5wdXRcIikub24oXCJmb2N1c291dFwiLCAoKSA9PiB7XG4gICAgaWYgKCFleHBvcnRzLnJlc3VsdFZpc2libGUgJiYgY29uZmlnXzEuZGVmYXVsdC5zaG93T3V0T2ZGb2N1c1dhcm5pbmcpIHtcbiAgICAgICAgT3V0T2ZGb2N1cy5zaG93KCk7XG4gICAgfVxuICAgIENhcmV0LmhpZGUoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJrZXlwcmVzc1wiLCBcIiNzaG93V29yZEhpc3RvcnlCdXR0b25cIiwgKGV2ZW50KSA9PiB7XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIHRvZ2dsZVJlc3VsdFdvcmRzKCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIjc2hvd1dvcmRIaXN0b3J5QnV0dG9uXCIsICgpID0+IHtcbiAgICB0b2dnbGVSZXN1bHRXb3JkcygpO1xufSk7XG4kKFwiI3dvcmRzV3JhcHBlclwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBmb2N1c1dvcmRzKCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zZXRIYXNUYWIgPSBleHBvcnRzLnNldFJhbmRvbVF1b3RlID0gZXhwb3J0cy5yYW5kb21RdW90ZSA9IGV4cG9ydHMuaGFzVGFiID0gZXhwb3J0cy53b3JkcyA9IHZvaWQgMDtcbmNsYXNzIFdvcmRzIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5saXN0ID0gW107XG4gICAgICAgIHRoaXMubGVuZ3RoID0gMDtcbiAgICAgICAgdGhpcy5jdXJyZW50SW5kZXggPSAwO1xuICAgIH1cbiAgICBnZXQoaSwgcmF3ID0gZmFsc2UpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgaWYgKGkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGlzdDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChyYXcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKF9iID0gKF9hID0gdGhpcy5saXN0W2ldKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVwbGFjZSgvWy4/IVwiOlxcLSxdL2csIFwiXCIpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmxpc3RbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0Q3VycmVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdFt0aGlzLmN1cnJlbnRJbmRleF07XG4gICAgfVxuICAgIGdldExhc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RbdGhpcy5saXN0Lmxlbmd0aCAtIDFdO1xuICAgIH1cbiAgICBwdXNoKHdvcmQpIHtcbiAgICAgICAgdGhpcy5saXN0LnB1c2god29yZCk7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gdGhpcy5saXN0Lmxlbmd0aDtcbiAgICB9XG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMubGlzdCA9IFtdO1xuICAgICAgICB0aGlzLmN1cnJlbnRJbmRleCA9IDA7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gdGhpcy5saXN0Lmxlbmd0aDtcbiAgICB9XG4gICAgcmVzZXRDdXJyZW50SW5kZXgoKSB7XG4gICAgICAgIHRoaXMuY3VycmVudEluZGV4ID0gMDtcbiAgICB9XG4gICAgZGVjcmVhc2VDdXJyZW50SW5kZXgoKSB7XG4gICAgICAgIHRoaXMuY3VycmVudEluZGV4LS07XG4gICAgfVxuICAgIGluY3JlYXNlQ3VycmVudEluZGV4KCkge1xuICAgICAgICB0aGlzLmN1cnJlbnRJbmRleCsrO1xuICAgIH1cbiAgICBjbGVhbigpIHtcbiAgICAgICAgZm9yIChjb25zdCBzIG9mIHRoaXMubGlzdCkge1xuICAgICAgICAgICAgaWYgKC8gKy8udGVzdChzKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gdGhpcy5saXN0LmluZGV4T2Yocyk7XG4gICAgICAgICAgICAgICAgY29uc3QgdGVtcExpc3QgPSBzLnNwbGl0KFwiIFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxpc3Quc3BsaWNlKGlkLCAxKTtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRlbXBMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGlzdC5zcGxpY2UoaWQgKyBpLCAwLCB0ZW1wTGlzdFtpXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy53b3JkcyA9IG5ldyBXb3JkcygpO1xuZXhwb3J0cy5oYXNUYWIgPSBmYWxzZTtcbmV4cG9ydHMucmFuZG9tUXVvdGUgPSBudWxsO1xuZnVuY3Rpb24gc2V0UmFuZG9tUXVvdGUocnEpIHtcbiAgICBleHBvcnRzLnJhbmRvbVF1b3RlID0gcnE7XG59XG5leHBvcnRzLnNldFJhbmRvbVF1b3RlID0gc2V0UmFuZG9tUXVvdGU7XG5mdW5jdGlvbiBzZXRIYXNUYWIodGYpIHtcbiAgICBleHBvcnRzLmhhc1RhYiA9IHRmO1xufVxuZXhwb3J0cy5zZXRIYXNUYWIgPSBzZXRIYXNUYWI7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51cGRhdGVTdHlsZSA9IGV4cG9ydHMudXBkYXRlID0gZXhwb3J0cy5yZXN0YXJ0ID0gZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBDdXN0b21UZXh0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2N1c3RvbS10ZXh0XCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgVGVzdFdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtd29yZHNcIikpO1xuY29uc3QgVGVzdElucHV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QtaW5wdXRcIikpO1xuY29uc3QgVGltZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3RpbWVcIikpO1xuY29uc3QgU2xvd1RpbWVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvc2xvdy10aW1lclwiKSk7XG5jb25zdCBUZXN0QWN0aXZlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvdGVzdC1hY3RpdmVcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5mdW5jdGlvbiBzaG93KCkge1xuICAgIGNvbnN0IG9wID0gY29uZmlnXzEuZGVmYXVsdC5zaG93VGltZXJQcm9ncmVzcyA/IGNvbmZpZ18xLmRlZmF1bHQudGltZXJPcGFjaXR5IDogMDtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9IFwiemVuXCIgJiYgY29uZmlnXzEuZGVmYXVsdC50aW1lclN0eWxlID09PSBcImJhclwiKSB7XG4gICAgICAgICQoXCIjdGltZXJXcmFwcGVyXCIpLnN0b3AodHJ1ZSwgdHJ1ZSkucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIikuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiBvcCxcbiAgICAgICAgfSwgMTI1KTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC50aW1lclN0eWxlID09PSBcInRleHRcIikge1xuICAgICAgICAkKFwiI3RpbWVyTnVtYmVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogb3AsXG4gICAgICAgIH0sIDEyNSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiIHx8IGNvbmZpZ18xLmRlZmF1bHQudGltZXJTdHlsZSA9PT0gXCJtaW5pXCIpIHtcbiAgICAgICAgaWYgKG9wID4gMCkge1xuICAgICAgICAgICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC50aW1lXCIpXG4gICAgICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgb3BhY2l0eTogb3AsXG4gICAgICAgICAgICB9LCAxMjUpO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgJChcIiN0aW1lcldyYXBwZXJcIikuc3RvcCh0cnVlLCB0cnVlKS5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogMCxcbiAgICB9LCAxMjUpO1xuICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAudGltZVwiKVxuICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IDAsXG4gICAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAudGltZVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbiAgICAkKFwiI3RpbWVyTnVtYmVyXCIpLnN0b3AodHJ1ZSwgdHJ1ZSkuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IDAsXG4gICAgfSwgMTI1KTtcbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG5mdW5jdGlvbiByZXN0YXJ0KCkge1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnRpbWVyU3R5bGUgPT09IFwiYmFyXCIpIHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgICAgICQoXCIjdGltZXJcIikuc3RvcCh0cnVlLCB0cnVlKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICB3aWR0aDogXCIxMDB2d1wiLFxuICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIgfHwgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiKSB7XG4gICAgICAgICAgICAkKFwiI3RpbWVyXCIpLnN0b3AodHJ1ZSwgdHJ1ZSkuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgd2lkdGg6IFwiMHZ3XCIsXG4gICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMucmVzdGFydCA9IHJlc3RhcnQ7XG5jb25zdCB0aW1lck51bWJlckVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3RpbWVyTnVtYmVyXCIpO1xuY29uc3QgbWluaVRpbWVyTnVtYmVyRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAudGltZVwiKTtcbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBjb25zdCB0aW1lID0gVGltZS5nZXQoKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInRpbWVcIiB8fFxuICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiICYmIEN1c3RvbVRleHQuaXNUaW1lUmFuZG9tKSkge1xuICAgICAgICBsZXQgbWF4dGltZSA9IGNvbmZpZ18xLmRlZmF1bHQudGltZTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJiBDdXN0b21UZXh0LmlzVGltZVJhbmRvbSkge1xuICAgICAgICAgICAgbWF4dGltZSA9IEN1c3RvbVRleHQudGltZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC50aW1lclN0eWxlID09PSBcImJhclwiKSB7XG4gICAgICAgICAgICBjb25zdCBwZXJjZW50ID0gMTAwIC0gKCh0aW1lICsgMSkgLyBtYXh0aW1lKSAqIDEwMDtcbiAgICAgICAgICAgICQoXCIjdGltZXJcIilcbiAgICAgICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICB3aWR0aDogcGVyY2VudCArIFwidndcIixcbiAgICAgICAgICAgIH0sIFNsb3dUaW1lci5nZXQoKSA/IDAgOiAxMDAwLCBcImxpbmVhclwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LnRpbWVyU3R5bGUgPT09IFwidGV4dFwiKSB7XG4gICAgICAgICAgICBsZXQgZGlzcGxheVRpbWUgPSBNaXNjLnNlY29uZHNUb1N0cmluZyhtYXh0aW1lIC0gdGltZSk7XG4gICAgICAgICAgICBpZiAobWF4dGltZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGRpc3BsYXlUaW1lID0gTWlzYy5zZWNvbmRzVG9TdHJpbmcodGltZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGltZXJOdW1iZXJFbGVtZW50ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGltZXJOdW1iZXJFbGVtZW50LmlubmVySFRNTCA9IFwiPGRpdj5cIiArIGRpc3BsYXlUaW1lICsgXCI8L2Rpdj5cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LnRpbWVyU3R5bGUgPT09IFwibWluaVwiKSB7XG4gICAgICAgICAgICBsZXQgZGlzcGxheVRpbWUgPSBNaXNjLnNlY29uZHNUb1N0cmluZyhtYXh0aW1lIC0gdGltZSk7XG4gICAgICAgICAgICBpZiAobWF4dGltZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGRpc3BsYXlUaW1lID0gTWlzYy5zZWNvbmRzVG9TdHJpbmcodGltZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobWluaVRpbWVyTnVtYmVyRWxlbWVudCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIG1pbmlUaW1lck51bWJlckVsZW1lbnQuaW5uZXJIVE1MID0gZGlzcGxheVRpbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIgfHxcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiIHx8XG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgIGxldCBvdXRvZiA9IFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGg7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIikge1xuICAgICAgICAgICAgb3V0b2YgPSBjb25maWdfMS5kZWZhdWx0LndvcmRzO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgICAgIGlmIChDdXN0b21UZXh0LmlzV29yZFJhbmRvbSkge1xuICAgICAgICAgICAgICAgIG91dG9mID0gQ3VzdG9tVGV4dC53b3JkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgb3V0b2YgPSBDdXN0b21UZXh0LnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICAgICAgb3V0b2YgPSAoX2MgPSAoX2IgPSAoX2EgPSBUZXN0V29yZHMucmFuZG9tUXVvdGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50ZXh0U3BsaXQpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5sZW5ndGgpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQudGltZXJTdHlsZSA9PT0gXCJiYXJcIikge1xuICAgICAgICAgICAgY29uc3QgcGVyY2VudCA9IE1hdGguZmxvb3IoKChUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4ICsgMSkgLyBvdXRvZikgKiAxMDApO1xuICAgICAgICAgICAgJChcIiN0aW1lclwiKVxuICAgICAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIHdpZHRoOiBwZXJjZW50ICsgXCJ2d1wiLFxuICAgICAgICAgICAgfSwgU2xvd1RpbWVyLmdldCgpID8gMCA6IDI1MCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC50aW1lclN0eWxlID09PSBcInRleHRcIikge1xuICAgICAgICAgICAgaWYgKG91dG9mID09PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRpbWVyTnVtYmVyRWxlbWVudCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICB0aW1lck51bWJlckVsZW1lbnQuaW5uZXJIVE1MID1cbiAgICAgICAgICAgICAgICAgICAgICAgIFwiPGRpdj5cIiArIGAke1Rlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aH1gICsgXCI8L2Rpdj5cIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGltZXJOdW1iZXJFbGVtZW50ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVyTnVtYmVyRWxlbWVudC5pbm5lckhUTUwgPVxuICAgICAgICAgICAgICAgICAgICAgICAgXCI8ZGl2PlwiICsgYCR7VGVzdElucHV0LmlucHV0Lmhpc3RvcnkubGVuZ3RofS8ke291dG9mfWAgKyBcIjwvZGl2PlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LnRpbWVyU3R5bGUgPT09IFwibWluaVwiKSB7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC53b3JkcyA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGlmIChtaW5pVGltZXJOdW1iZXJFbGVtZW50ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIG1pbmlUaW1lck51bWJlckVsZW1lbnQuaW5uZXJIVE1MID0gYCR7VGVzdElucHV0LmlucHV0Lmhpc3RvcnkubGVuZ3RofWA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKG1pbmlUaW1lck51bWJlckVsZW1lbnQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgbWluaVRpbWVyTnVtYmVyRWxlbWVudC5pbm5lckhUTUwgPSBgJHtUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGh9LyR7b3V0b2Z9YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIpIHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQudGltZXJTdHlsZSA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgICAgIGlmICh0aW1lck51bWJlckVsZW1lbnQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aW1lck51bWJlckVsZW1lbnQuaW5uZXJIVE1MID1cbiAgICAgICAgICAgICAgICAgICAgXCI8ZGl2PlwiICsgYCR7VGVzdElucHV0LmlucHV0Lmhpc3RvcnkubGVuZ3RofWAgKyBcIjwvZGl2PlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKG1pbmlUaW1lck51bWJlckVsZW1lbnQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBtaW5pVGltZXJOdW1iZXJFbGVtZW50LmlubmVySFRNTCA9IGAke1Rlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aH1gO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy51cGRhdGUgPSB1cGRhdGU7XG5mdW5jdGlvbiB1cGRhdGVTdHlsZSgpIHtcbiAgICBpZiAoIVRlc3RBY3RpdmUuZ2V0KCkpXG4gICAgICAgIHJldHVybjtcbiAgICBoaWRlKCk7XG4gICAgdXBkYXRlKCk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHNob3coKTtcbiAgICB9LCAxMjUpO1xufVxuZXhwb3J0cy51cGRhdGVTdHlsZSA9IHVwZGF0ZVN0eWxlO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSwgZXZlbnRWYWx1ZSkgPT4ge1xuICAgIGlmIChldmVudEtleSA9PT0gXCJzaG93VGltZXJQcm9ncmVzc1wiKSB7XG4gICAgICAgIGlmIChldmVudFZhbHVlID09PSB0cnVlICYmIFRlc3RBY3RpdmUuZ2V0KCkpIHtcbiAgICAgICAgICAgIHNob3coKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGhpZGUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoZXZlbnRLZXkgPT09IFwidGltZXJTdHlsZVwiKVxuICAgICAgICB1cGRhdGVTdHlsZSgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5hZGRBbGxGcm9tVG9kYXkgPSBleHBvcnRzLmdldFN0cmluZyA9IGV4cG9ydHMuYWRkU2Vjb25kcyA9IHZvaWQgMDtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmxldCBzZWNvbmRzID0gMDtcbmxldCBhZGRlZEFsbFRvZGF5ID0gZmFsc2U7XG5sZXQgZGF5VG9kYXk7XG5mdW5jdGlvbiBhZGRTZWNvbmRzKHMpIHtcbiAgICBpZiAoYWRkZWRBbGxUb2RheSkge1xuICAgICAgICBjb25zdCBub3dEYXRlID0gbmV3IERhdGUoKS5nZXREYXRlKCk7XG4gICAgICAgIGlmIChub3dEYXRlID4gZGF5VG9kYXkpIHtcbiAgICAgICAgICAgIHNlY29uZHMgPSBzO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNlY29uZHMgKz0gcztcbn1cbmV4cG9ydHMuYWRkU2Vjb25kcyA9IGFkZFNlY29uZHM7XG5mdW5jdGlvbiBnZXRTdHJpbmcoKSB7XG4gICAgY29uc3Qgc2VjU3RyaW5nID0gTWlzYy5zZWNvbmRzVG9TdHJpbmcoTWF0aC5yb3VuZChzZWNvbmRzKSwgdHJ1ZSwgdHJ1ZSk7XG4gICAgcmV0dXJuIHNlY1N0cmluZyArIChhZGRlZEFsbFRvZGF5ID09PSB0cnVlID8gXCIgdG9kYXlcIiA6IFwiIHNlc3Npb25cIik7XG59XG5leHBvcnRzLmdldFN0cmluZyA9IGdldFN0cmluZztcbmZ1bmN0aW9uIGFkZEFsbEZyb21Ub2RheSgpIHtcbiAgICBjb25zdCB0b2RheURhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIHRvZGF5RGF0ZS5zZXRTZWNvbmRzKDApO1xuICAgIHRvZGF5RGF0ZS5zZXRNaW51dGVzKDApO1xuICAgIHRvZGF5RGF0ZS5zZXRIb3VycygwKTtcbiAgICB0b2RheURhdGUuc2V0TWlsbGlzZWNvbmRzKDApO1xuICAgIGRheVRvZGF5ID0gdG9kYXlEYXRlLmdldERhdGUoKTtcbiAgICBjb25zdCB0b2RheURhdGVNUyA9IHRvZGF5RGF0ZS5nZXRUaW1lKCk7XG4gICAgc2Vjb25kcyA9IDA7XG4gICAgY29uc3QgcmVzdWx0cyA9IERCLmdldFNuYXBzaG90KCkucmVzdWx0cztcbiAgICByZXN1bHRzID09PSBudWxsIHx8IHJlc3VsdHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3VsdHMuZm9yRWFjaCgocmVzdWx0KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdERhdGUgPSBuZXcgRGF0ZShyZXN1bHQudGltZXN0YW1wKTtcbiAgICAgICAgcmVzdWx0RGF0ZS5zZXRTZWNvbmRzKDApO1xuICAgICAgICByZXN1bHREYXRlLnNldE1pbnV0ZXMoMCk7XG4gICAgICAgIHJlc3VsdERhdGUuc2V0SG91cnMoMCk7XG4gICAgICAgIHJlc3VsdERhdGUuc2V0TWlsbGlzZWNvbmRzKDApO1xuICAgICAgICBjb25zdCByZXN1bHREYXRlTVMgPSByZXN1bHREYXRlLmdldFRpbWUoKTtcbiAgICAgICAgaWYgKHJlc3VsdERhdGVNUyA+PSB0b2RheURhdGVNUykge1xuICAgICAgICAgICAgc2Vjb25kcyArPVxuICAgICAgICAgICAgICAgIHJlc3VsdC50ZXN0RHVyYXRpb24gKyByZXN1bHQuaW5jb21wbGV0ZVRlc3RTZWNvbmRzIC0gcmVzdWx0LmFma0R1cmF0aW9uO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgYWRkZWRBbGxUb2RheSA9IHRydWU7XG59XG5leHBvcnRzLmFkZEFsbEZyb21Ub2RheSA9IGFkZEFsbEZyb21Ub2RheTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc3BlYWsgPSBleHBvcnRzLmNsZWFyID0gZXhwb3J0cy5pbml0ID0gZXhwb3J0cy5zZXRMYW5ndWFnZSA9IHZvaWQgMDtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmxldCB2b2ljZTtcbmZ1bmN0aW9uIHNldExhbmd1YWdlKGxhbmcgPSBjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCF2b2ljZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgbGFuZ3VhZ2UgPSB5aWVsZCBNaXNjLmdldExhbmd1YWdlKGxhbmcpO1xuICAgICAgICBjb25zdCBiY3AgPSBsYW5ndWFnZS5iY3A0NyA/IGxhbmd1YWdlLmJjcDQ3IDogXCJlbi1VU1wiO1xuICAgICAgICB2b2ljZS5sYW5nID0gYmNwO1xuICAgIH0pO1xufVxuZXhwb3J0cy5zZXRMYW5ndWFnZSA9IHNldExhbmd1YWdlO1xuZnVuY3Rpb24gaW5pdCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICB2b2ljZSA9IG5ldyBTcGVlY2hTeW50aGVzaXNVdHRlcmFuY2UoKTtcbiAgICAgICAgc2V0TGFuZ3VhZ2UoKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuaW5pdCA9IGluaXQ7XG5mdW5jdGlvbiBjbGVhcigpIHtcbiAgICB2b2ljZSA9IHVuZGVmaW5lZDtcbn1cbmV4cG9ydHMuY2xlYXIgPSBjbGVhcjtcbmZ1bmN0aW9uIHNwZWFrKHRleHQpIHtcbiAgICB3aW5kb3cuc3BlZWNoU3ludGhlc2lzLmNhbmNlbCgpO1xuICAgIGlmICh2b2ljZSA9PT0gdW5kZWZpbmVkKVxuICAgICAgICBpbml0KCk7XG4gICAgaWYgKHZvaWNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdm9pY2UudGV4dCA9IHRleHQ7XG4gICAgICAgIHdpbmRvdy5zcGVlY2hTeW50aGVzaXMuc3BlYWsodm9pY2UpO1xuICAgIH1cbn1cbmV4cG9ydHMuc3BlYWsgPSBzcGVhaztcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXksIGV2ZW50VmFsdWUpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiZnVuYm94XCIpIHtcbiAgICAgICAgaWYgKGV2ZW50VmFsdWUgPT09IFwibm9uZVwiKSB7XG4gICAgICAgICAgICBjbGVhcigpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGV2ZW50VmFsdWUgPT09IFwidHRzXCIpIHtcbiAgICAgICAgICAgIGluaXQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoZXZlbnRLZXkgPT09IFwibGFuZ3VhZ2VcIiAmJiBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJ0dHNcIilcbiAgICAgICAgc2V0TGFuZ3VhZ2UoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZ2V0V29yZCA9IGV4cG9ydHMudXBkYXRlU2NvcmUgPSB2b2lkIDA7XG5jb25zdCBUZXN0SW5wdXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC1pbnB1dFwiKSk7XG4vLyBDaGFuZ2VzIGhvdyBxdWlja2x5IGl0ICdsZWFybnMnIHNjb3JlcyAtIHZlcnkgcm91Z2hseSB0aGUgc2NvcmUgZm9yIGEgY2hhclxuLy8gaXMgYmFzZWQgb24gbGFzdCBwZXJDaGFyQ291bnQgb2NjdXJyZW5jZXMuIE1ha2UgaXQgc21hbGxlciB0byBhZGp1c3QgZmFzdGVyLlxuY29uc3QgcGVyQ2hhckNvdW50ID0gNTA7XG4vLyBDaG9vc2UgdGhlIGhpZ2hlc3Qgc2NvcmluZyB3b3JkIGZyb20gdGhpcyBtYW55IHJhbmRvbSB3b3Jkcy4gSGlnaGVyIHZhbHVlc1xuLy8gd2lsbCBjaG9vc2Ugd29yZHMgd2l0aCBtb3JlIHdlYWsgbGV0dGVycyBvbiBhdmVyYWdlLlxuY29uc3Qgd29yZFNhbXBsZXMgPSAyMDtcbi8vIFNjb3JlIHBlbmF0bHkgKGluIG1pbGxpc2Vjb25kcykgZm9yIGdldHRpbmcgYSBsZXR0ZXIgd3JvbmcuXG5jb25zdCBpbmNvcnJlY3RQZW5hbHR5ID0gNTAwMDtcbmNvbnN0IHNjb3JlcyA9IHt9O1xuY2xhc3MgU2NvcmUge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmF2ZXJhZ2UgPSAwLjA7XG4gICAgICAgIHRoaXMuY291bnQgPSAwO1xuICAgIH1cbiAgICB1cGRhdGUoc2NvcmUpIHtcbiAgICAgICAgaWYgKHRoaXMuY291bnQgPCBwZXJDaGFyQ291bnQpIHtcbiAgICAgICAgICAgIHRoaXMuY291bnQrKztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhZGp1c3RSYXRlID0gMS4wIC8gdGhpcy5jb3VudDtcbiAgICAgICAgLy8gS2VlcCBhbiBleHBvbmVudGlhbCBtb3ZpbmcgYXZlcmFnZSBvZiB0aGUgc2NvcmUgb3ZlciB0aW1lLlxuICAgICAgICB0aGlzLmF2ZXJhZ2UgPSBzY29yZSAqIGFkanVzdFJhdGUgKyB0aGlzLmF2ZXJhZ2UgKiAoMSAtIGFkanVzdFJhdGUpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHVwZGF0ZVNjb3JlKGNoYXIsIGlzQ29ycmVjdCkge1xuICAgIGNvbnN0IHRpbWluZ3MgPSBUZXN0SW5wdXQua2V5cHJlc3NUaW1pbmdzLnNwYWNpbmcuYXJyYXk7XG4gICAgaWYgKHRpbWluZ3MubGVuZ3RoID09PSAwIHx8IHR5cGVvZiB0aW1pbmdzID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IHNjb3JlID0gdGltaW5nc1t0aW1pbmdzLmxlbmd0aCAtIDFdO1xuICAgIGlmICghaXNDb3JyZWN0KSB7XG4gICAgICAgIHNjb3JlICs9IGluY29ycmVjdFBlbmFsdHk7XG4gICAgfVxuICAgIGlmICghKGNoYXIgaW4gc2NvcmVzKSkge1xuICAgICAgICBzY29yZXNbY2hhcl0gPSBuZXcgU2NvcmUoKTtcbiAgICB9XG4gICAgc2NvcmVzW2NoYXJdLnVwZGF0ZShzY29yZSk7XG59XG5leHBvcnRzLnVwZGF0ZVNjb3JlID0gdXBkYXRlU2NvcmU7XG5mdW5jdGlvbiBzY29yZSh3b3JkKSB7XG4gICAgbGV0IHRvdGFsID0gMC4wO1xuICAgIGxldCBudW1DaGFycyA9IDA7XG4gICAgZm9yIChjb25zdCBjIG9mIHdvcmQpIHtcbiAgICAgICAgaWYgKGMgaW4gc2NvcmVzKSB7XG4gICAgICAgICAgICB0b3RhbCArPSBzY29yZXNbY10uYXZlcmFnZTtcbiAgICAgICAgICAgIG51bUNoYXJzKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bUNoYXJzID09IDAgPyAwLjAgOiB0b3RhbCAvIG51bUNoYXJzO1xufVxuZnVuY3Rpb24gZ2V0V29yZCh3b3Jkc2V0KSB7XG4gICAgbGV0IGhpZ2hTY29yZTtcbiAgICBsZXQgcmFuZG9tV29yZCA9IFwiXCI7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JkU2FtcGxlczsgaSsrKSB7XG4gICAgICAgIGNvbnN0IG5ld1dvcmQgPSB3b3Jkc2V0LnJhbmRvbVdvcmQoKTtcbiAgICAgICAgY29uc3QgbmV3U2NvcmUgPSBzY29yZShuZXdXb3JkKTtcbiAgICAgICAgaWYgKGkgPT0gMCB8fCBoaWdoU2NvcmUgPT09IHVuZGVmaW5lZCB8fCBuZXdTY29yZSA+IGhpZ2hTY29yZSkge1xuICAgICAgICAgICAgcmFuZG9tV29yZCA9IG5ld1dvcmQ7XG4gICAgICAgICAgICBoaWdoU2NvcmUgPSBuZXdTY29yZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmFuZG9tV29yZDtcbn1cbmV4cG9ydHMuZ2V0V29yZCA9IGdldFdvcmQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmdldFNlY3Rpb24gPSBleHBvcnRzLmdldFRMRCA9IGV4cG9ydHMuU2VjdGlvbiA9IHZvaWQgMDtcbmNvbnN0IExvYWRlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbG9hZGVyXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY2xhc3MgU2VjdGlvbiB7XG4gICAgY29uc3RydWN0b3IodGl0bGUsIGF1dGhvciwgd29yZHMpIHtcbiAgICAgICAgdGhpcy50aXRsZSA9IHRpdGxlO1xuICAgICAgICB0aGlzLmF1dGhvciA9IGF1dGhvcjtcbiAgICAgICAgdGhpcy53b3JkcyA9IHdvcmRzO1xuICAgIH1cbn1cbmV4cG9ydHMuU2VjdGlvbiA9IFNlY3Rpb247XG5mdW5jdGlvbiBnZXRUTEQobGFuZ3VhZ2VHcm91cCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIC8vIGxhbmd1YWdlIGdyb3VwIHRvIHRsZFxuICAgICAgICBzd2l0Y2ggKGxhbmd1YWdlR3JvdXAubmFtZSkge1xuICAgICAgICAgICAgY2FzZSBcImVuZ2xpc2hcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJlblwiO1xuICAgICAgICAgICAgY2FzZSBcInNwYW5pc2hcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJlc1wiO1xuICAgICAgICAgICAgY2FzZSBcImZyZW5jaFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImZyXCI7XG4gICAgICAgICAgICBjYXNlIFwiZ2VybWFuXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiZGVcIjtcbiAgICAgICAgICAgIGNhc2UgXCJwb3J0dWd1ZXNlXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwicHRcIjtcbiAgICAgICAgICAgIGNhc2UgXCJpdGFsaWFuXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiaXRcIjtcbiAgICAgICAgICAgIGNhc2UgXCJkdXRjaFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIm5sXCI7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBcImVuXCI7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0VExEID0gZ2V0VExEO1xuZnVuY3Rpb24gZ2V0U2VjdGlvbihsYW5ndWFnZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiR2V0dGluZyBzZWN0aW9uXCIpO1xuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICAvLyBnZXQgVExEIGZvciB3aWtpcGVkaWEgYWNjb3JkaW5nIHRvIGxhbmd1YWdlIGdyb3VwXG4gICAgICAgIGxldCB1cmxUTEQgPSBcImVuXCI7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRMYW5ndWFnZUdyb3VwID0geWllbGQgTWlzYy5maW5kQ3VycmVudEdyb3VwKGxhbmd1YWdlKTtcbiAgICAgICAgaWYgKGN1cnJlbnRMYW5ndWFnZUdyb3VwICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHVybFRMRCA9IHlpZWxkIGdldFRMRChjdXJyZW50TGFuZ3VhZ2VHcm91cCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmFuZG9tUG9zdFVSTCA9IGBodHRwczovLyR7dXJsVExEfS53aWtpcGVkaWEub3JnL2FwaS9yZXN0X3YxL3BhZ2UvcmFuZG9tL3N1bW1hcnlgO1xuICAgICAgICBjb25zdCBzZWN0aW9uT2JqID0geyB0aXRsZTogXCJcIiwgYXV0aG9yOiBcIlwiIH07XG4gICAgICAgIGNvbnN0IHJhbmRvbVBvc3RSZXEgPSB5aWVsZCBmZXRjaChyYW5kb21Qb3N0VVJMKTtcbiAgICAgICAgbGV0IHBhZ2VpZCA9IDA7XG4gICAgICAgIGlmIChyYW5kb21Qb3N0UmVxLnN0YXR1cyA9PSAyMDApIHtcbiAgICAgICAgICAgIGNvbnN0IHBvc3RPYmogPSB5aWVsZCByYW5kb21Qb3N0UmVxLmpzb24oKTtcbiAgICAgICAgICAgIHNlY3Rpb25PYmoudGl0bGUgPSBwb3N0T2JqLnRpdGxlO1xuICAgICAgICAgICAgc2VjdGlvbk9iai5hdXRob3IgPSBwb3N0T2JqLmF1dGhvcjtcbiAgICAgICAgICAgIHBhZ2VpZCA9IHBvc3RPYmoucGFnZWlkO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzLCByZWopID0+IHtcbiAgICAgICAgICAgIGlmIChyYW5kb21Qb3N0UmVxLnN0YXR1cyAhPSAyMDApIHtcbiAgICAgICAgICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICAgICAgICAgIHJlaihyYW5kb21Qb3N0UmVxLnN0YXR1cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBzZWN0aW9uVVJMID0gYGh0dHBzOi8vJHt1cmxUTER9Lndpa2lwZWRpYS5vcmcvdy9hcGkucGhwP2FjdGlvbj1xdWVyeSZmb3JtYXQ9anNvbiZwYWdlaWRzPSR7cGFnZWlkfSZwcm9wPWV4dHJhY3RzJmV4aW50cm89dHJ1ZSZvcmlnaW49KmA7XG4gICAgICAgICAgICBjb25zdCBzZWN0aW9uUmVxID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgICAgICBzZWN0aW9uUmVxLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoc2VjdGlvblJlcS5yZWFkeVN0YXRlID09IDQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlY3Rpb25SZXEuc3RhdHVzID09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNlY3Rpb25UZXh0ID0gSlNPTi5wYXJzZShzZWN0aW9uUmVxLnJlc3BvbnNlVGV4dCkucXVlcnlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucGFnZXNbcGFnZWlkLnRvU3RyaW5nKCldLmV4dHJhY3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB3b3JkcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGRvdWJsZSB3aGl0ZXNwYWNlcyBhbmQgZmluYWxseSB0cmFpbGluZyB3aGl0ZXNwYWNlcy5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNlY3Rpb25UZXh0ID0gc2VjdGlvblRleHQucmVwbGFjZSgvPFxcL3A+PHA+Ky9nLCBcIiBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVGV4dCA9ICQoXCI8ZGl2Lz5cIikuaHRtbChzZWN0aW9uVGV4dCkudGV4dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VjdGlvblRleHQgPSBzZWN0aW9uVGV4dC5yZXBsYWNlKC9cXHMrL2csIFwiIFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlY3Rpb25UZXh0ID0gc2VjdGlvblRleHQudHJpbSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gLy8gQWRkIHNwYWNlc1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VjdGlvblRleHQgPSBzZWN0aW9uVGV4dC5yZXBsYWNlKC9bYS16QS1aMC05XXszLH1cXC5bYS16QS1aXS9nLCAoeCkgPT5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgeC5yZXBsYWNlKC9cXC4vLCBcIi4gXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VjdGlvblRleHQuc3BsaXQoXCIgXCIpLmZvckVhY2goKHdvcmQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3Jkcy5wdXNoKHdvcmQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWN0aW9uID0gbmV3IFNlY3Rpb24oc2VjdGlvbk9iai50aXRsZSwgc2VjdGlvbk9iai5hdXRob3IsIHdvcmRzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXMoc2VjdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqKHNlY3Rpb25SZXEuc3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBzZWN0aW9uUmVxLm9wZW4oXCJHRVRcIiwgc2VjdGlvblVSTCk7XG4gICAgICAgICAgICBzZWN0aW9uUmVxLnNlbmQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5leHBvcnRzLmdldFNlY3Rpb24gPSBnZXRTZWN0aW9uO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLndpdGhXb3JkcyA9IGV4cG9ydHMuV29yZHNldCA9IHZvaWQgMDtcbmNvbnN0IG1pc2NfMSA9IHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpO1xubGV0IGN1cnJlbnRXb3Jkc2V0ID0gbnVsbDtcbmxldCBjdXJyZW50V29yZEdlbmVyYXRvciA9IG51bGw7XG5jbGFzcyBXb3Jkc2V0IHtcbiAgICBjb25zdHJ1Y3Rvcih3b3Jkcykge1xuICAgICAgICB0aGlzLndvcmRzID0gd29yZHM7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gdGhpcy53b3Jkcy5sZW5ndGg7XG4gICAgfVxuICAgIHJhbmRvbVdvcmQoKSB7XG4gICAgICAgIHJldHVybiAoMCwgbWlzY18xLnJhbmRvbUVsZW1lbnRGcm9tQXJyYXkpKHRoaXMud29yZHMpO1xuICAgIH1cbn1cbmV4cG9ydHMuV29yZHNldCA9IFdvcmRzZXQ7XG5jb25zdCBwcmVmaXhTaXplID0gMjtcbmNsYXNzIENoYXJEaXN0cmlidXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmNoYXJzID0ge307XG4gICAgICAgIHRoaXMuY291bnQgPSAwO1xuICAgIH1cbiAgICBhZGRDaGFyKGNoYXIpIHtcbiAgICAgICAgdGhpcy5jb3VudCsrO1xuICAgICAgICBpZiAoY2hhciBpbiB0aGlzLmNoYXJzKSB7XG4gICAgICAgICAgICB0aGlzLmNoYXJzW2NoYXJdKys7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNoYXJzW2NoYXJdID0gMTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByYW5kb21DaGFyKCkge1xuICAgICAgICBjb25zdCByYW5kb21JbmRleCA9ICgwLCBtaXNjXzEucmFuZG9tSW50RnJvbVJhbmdlKSgwLCB0aGlzLmNvdW50IC0gMSk7XG4gICAgICAgIGxldCBydW5uaW5nQ291bnQgPSAwO1xuICAgICAgICBmb3IgKGNvbnN0IFtjaGFyLCBjaGFyQ291bnRdIG9mIE9iamVjdC5lbnRyaWVzKHRoaXMuY2hhcnMpKSB7XG4gICAgICAgICAgICBydW5uaW5nQ291bnQgKz0gY2hhckNvdW50O1xuICAgICAgICAgICAgaWYgKHJ1bm5pbmdDb3VudCA+IHJhbmRvbUluZGV4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNoYXI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMuY2hhcnMpWzBdO1xuICAgIH1cbn1cbmNsYXNzIFdvcmRHZW5lcmF0b3IgZXh0ZW5kcyBXb3Jkc2V0IHtcbiAgICBjb25zdHJ1Y3Rvcih3b3Jkcykge1xuICAgICAgICBzdXBlcih3b3Jkcyk7XG4gICAgICAgIHRoaXMubmdyYW1zID0ge307XG4gICAgICAgIC8vIENhbiBnZW5lcmF0ZSBhbiB1bmJvdW5kZWQgbnVtYmVyIG9mIHdvcmRzIGluIHRoZW9yeS5cbiAgICAgICAgdGhpcy5sZW5ndGggPSBJbmZpbml0eTtcbiAgICAgICAgZm9yIChsZXQgd29yZCBvZiB3b3Jkcykge1xuICAgICAgICAgICAgLy8gTWFyayB0aGUgZW5kIG9mIGVhY2ggd29yZCB3aXRoIGEgc3BhY2UuXG4gICAgICAgICAgICB3b3JkICs9IFwiIFwiO1xuICAgICAgICAgICAgbGV0IHByZWZpeCA9IFwiXCI7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGMgb2Ygd29yZCkge1xuICAgICAgICAgICAgICAgIC8vIEFkZCBgY2AgdG8gdGhlIGRpc3RyaWJ1dGlvbiBvZiBjaGFycyB0aGF0IGNhbiBjb21lIGFmdGVyIGBwcmVmaXhgLlxuICAgICAgICAgICAgICAgIGlmICghKHByZWZpeCBpbiB0aGlzLm5ncmFtcykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZ3JhbXNbcHJlZml4XSA9IG5ldyBDaGFyRGlzdHJpYnV0aW9uKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMubmdyYW1zW3ByZWZpeF0uYWRkQ2hhcihjKTtcbiAgICAgICAgICAgICAgICBwcmVmaXggPSAocHJlZml4ICsgYykuc3Vic3RyKC1wcmVmaXhTaXplKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByYW5kb21Xb3JkKCkge1xuICAgICAgICBsZXQgd29yZCA9IFwiXCI7XG4gICAgICAgIGZvciAoOzspIHtcbiAgICAgICAgICAgIGNvbnN0IHByZWZpeCA9IHdvcmQuc3Vic3RyKC1wcmVmaXhTaXplKTtcbiAgICAgICAgICAgIGNvbnN0IGNoYXJEaXN0cmlidXRpb24gPSB0aGlzLm5ncmFtc1twcmVmaXhdO1xuICAgICAgICAgICAgaWYgKCFjaGFyRGlzdHJpYnV0aW9uKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBzaG91bGRuJ3QgaGFwcGVuIGlmIHRoaXMubmdyYW1zIGlzIGNvbXBsZXRlLiBJZiBpdCBkb2VzXG4gICAgICAgICAgICAgICAgLy8gc29tZWhvdywgc3RhcnQgZ2VuZXJhdGluZyBhIG5ldyB3b3JkLlxuICAgICAgICAgICAgICAgIHdvcmQgPSBcIlwiO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gUGljayBhIHJhbmRvbSBjaGFyIGZyb20gdGhlIGRpc3RyaWJ1dGlvbiB0aGF0IGNvbWVzIGFmdGVyIGBwcmVmaXhgLlxuICAgICAgICAgICAgY29uc3QgbmV4dENoYXIgPSBjaGFyRGlzdHJpYnV0aW9uLnJhbmRvbUNoYXIoKTtcbiAgICAgICAgICAgIGlmIChuZXh0Q2hhciA9PSBcIiBcIikge1xuICAgICAgICAgICAgICAgIC8vIEEgc3BhY2UgbWFya3MgdGhlIGVuZCBvZiB0aGUgd29yZCwgc28gc3RvcCBnZW5lcmF0aW5nIGFuZCByZXR1cm4uXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3b3JkICs9IG5leHRDaGFyO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB3b3JkO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHdpdGhXb3Jkcyh3b3JkcywgZnVuYm94KSB7XG4gICAgaWYgKGZ1bmJveCA9PSBcInBzZXVkb2xhbmdcIikge1xuICAgICAgICBpZiAoY3VycmVudFdvcmRHZW5lcmF0b3IgPT0gbnVsbCB8fCB3b3JkcyAhPT0gY3VycmVudFdvcmRHZW5lcmF0b3Iud29yZHMpIHtcbiAgICAgICAgICAgIGN1cnJlbnRXb3JkR2VuZXJhdG9yID0gbmV3IFdvcmRHZW5lcmF0b3Iod29yZHMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjdXJyZW50V29yZEdlbmVyYXRvcjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChjdXJyZW50V29yZHNldCA9PSBudWxsIHx8IHdvcmRzICE9PSBjdXJyZW50V29yZHNldC53b3Jkcykge1xuICAgICAgICAgICAgY3VycmVudFdvcmRzZXQgPSBuZXcgV29yZHNldCh3b3Jkcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGN1cnJlbnRXb3Jkc2V0O1xuICAgIH1cbn1cbmV4cG9ydHMud2l0aFdvcmRzID0gd2l0aFdvcmRzO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudXBkYXRlS2V5dGlwcyA9IHZvaWQgMDtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL2NvbmZpZ1wiKSk7XG5jb25zdCBDYXJldCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0L2NhcmV0XCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBDdXN0b21UZXh0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QvY3VzdG9tLXRleHRcIikpO1xuY29uc3QgVGVzdEFjdGl2ZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9zdGF0ZXMvdGVzdC1hY3RpdmVcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmZ1bmN0aW9uIHVwZGF0ZUtleXRpcHMoKSB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc3dhcEVzY0FuZFRhYikge1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAudGlwXCIpLmh0bWwoYFxuICAgIHRpcDogWW91IGNhbiBhbHNvIGNoYW5nZSBhbGwgdGhlc2Ugc2V0dGluZ3MgcXVpY2tseSB1c2luZyB0aGVcbiAgICBjb21tYW5kIGxpbmUgKFxuICAgIDxrZXk+dGFiPC9rZXk+XG4gICAgKWApO1xuICAgICAgICAkKFwiI2JvdHRvbSAua2V5VGlwc1wiKS5odG1sKGBcbiAgICA8a2V5PmVzYzwva2V5PiAtIHJlc3RhcnQgdGVzdDxicj5cbiAgICAgIDxrZXk+dGFiPC9rZXk+IC0gY29tbWFuZCBsaW5lYCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAudGlwXCIpLmh0bWwoYFxuICAgIHRpcDogWW91IGNhbiBhbHNvIGNoYW5nZSBhbGwgdGhlc2Ugc2V0dGluZ3MgcXVpY2tseSB1c2luZyB0aGVcbiAgICBjb21tYW5kIGxpbmUgKFxuICAgIDxrZXk+ZXNjPC9rZXk+XG4gICAgKWApO1xuICAgICAgICAkKFwiI2JvdHRvbSAua2V5VGlwc1wiKS5odG1sKGBcbiAgICA8a2V5PnRhYjwva2V5PiAtIHJlc3RhcnQgdGVzdDxicj5cbiAgICAgIDxrZXk+ZXNjPC9rZXk+IG9yIDxrZXk+Y3RybC9jbWQ8L2tleT4rPGtleT5zaGlmdDwva2V5Pis8a2V5PnA8L2tleT4gLSBjb21tYW5kIGxpbmVgKTtcbiAgICB9XG59XG5leHBvcnRzLnVwZGF0ZUtleXRpcHMgPSB1cGRhdGVLZXl0aXBzO1xuaWYgKHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSA9PT0gXCJsb2NhbGhvc3RcIikge1xuICAgIHdpbmRvdy5vbmVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGVycm9yLnRvU3RyaW5nKCksIC0xKTtcbiAgICB9O1xuICAgICQoXCIjdG9wIC5sb2dvIC50b3BcIikudGV4dChcImxvY2FsaG9zdFwiKTtcbiAgICAkKFwiaGVhZCB0aXRsZVwiKS50ZXh0KCQoXCJoZWFkIHRpdGxlXCIpLnRleHQoKSArIFwiIChsb2NhbGhvc3QpXCIpO1xuICAgICQoXCJib2R5XCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cImRldkluZGljYXRvciB0bFwiPmxvY2FsPC9kaXY+PGRpdiBjbGFzcz1cImRldkluZGljYXRvciBiclwiPmxvY2FsPC9kaXY+YCk7XG4gICAgJChcIi5wYWdlU2V0dGluZ3MgLmRpc2NvcmRJbnRlZ3JhdGlvbiAuYnV0dG9ucyBhXCIpLmF0dHIoXCJocmVmXCIsIFwiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvb2F1dGgyL2F1dGhvcml6ZT9jbGllbnRfaWQ9Nzk4MjcyMzM1MDM1NDk4NTU3JnJlZGlyZWN0X3VyaT1odHRwJTNBJTJGJTJGbG9jYWxob3N0JTNBNTAwMCUyRnZlcmlmeSZyZXNwb25zZV90eXBlPXRva2VuJnNjb3BlPWlkZW50aWZ5XCIpO1xufVxuLy9zdG9wIHNwYWNlIHNjcm9sbGluZ1xud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKGUuY29kZSA9PT0gXCJTcGFjZVwiICYmIGUudGFyZ2V0ID09PSBkb2N1bWVudC5ib2R5KSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG59KTtcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiYmVmb3JldW5sb2FkXCIsIChldmVudCkgPT4ge1xuICAgIC8vIENhbmNlbCB0aGUgZXZlbnQgYXMgc3RhdGVkIGJ5IHRoZSBzdGFuZGFyZC5cbiAgICBpZiAoKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ3b3Jkc1wiICYmIGNvbmZpZ18xLmRlZmF1bHQud29yZHMgPCAxMDAwKSB8fFxuICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInRpbWVcIiAmJiBjb25maWdfMS5kZWZhdWx0LnRpbWUgPCAzNjAwKSB8fFxuICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIiB8fFxuICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICBDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgQ3VzdG9tVGV4dC53b3JkIDwgMTAwMCkgfHxcbiAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20gJiZcbiAgICAgICAgICAgIEN1c3RvbVRleHQudGltZSA8IDEwMDApIHx8XG4gICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgICFDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgQ3VzdG9tVGV4dC50ZXh0Lmxlbmd0aCA8IDEwMDApKSB7XG4gICAgICAgIC8vaWdub3JlXG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoVGVzdEFjdGl2ZS5nZXQoKSkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIC8vIENocm9tZSByZXF1aXJlcyByZXR1cm5WYWx1ZSB0byBiZSBzZXQuXG4gICAgICAgICAgICBldmVudC5yZXR1cm5WYWx1ZSA9IFwiXCI7XG4gICAgICAgIH1cbiAgICB9XG59KTtcbiQod2luZG93KS5vbihcInJlc2l6ZVwiLCAoKSA9PiB7XG4gICAgY29uc29sZS5sb2coXCJVcGRhdGluZyBjYXJldCBwb3NpdGlvblwiKTtcbiAgICBDYXJldC51cGRhdGVQb3NpdGlvbigpO1xufSk7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5KSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcInN3YXBFc2NBbmRUYWJcIilcbiAgICAgICAgdXBkYXRlS2V5dGlwcygpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZGVib3VuY2UgPSB2b2lkIDA7XG5mdW5jdGlvbiBkZWJvdW5jZShmbiwgbXMgPSAyNTApIHtcbiAgICBsZXQgdGltZW91dElkO1xuICAgIHJldHVybiBmdW5jdGlvbiAoLi4uYXJncykge1xuICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICAgICAgdGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiBmbi5hcHBseSh0aGlzLCBhcmdzKSwgbXMpO1xuICAgIH07XG59XG5leHBvcnRzLmRlYm91bmNlID0gZGVib3VuY2U7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnJlZ2V4SW5kZXhPZiA9IGV4cG9ydHMuc2V0Q2hhckF0ID0gZXhwb3J0cy5jbGVhclRpbWVvdXRzID0gZXhwb3J0cy5jYW5RdWlja1Jlc3RhcnQgPSBleHBvcnRzLm1hcFJhbmdlID0gZXhwb3J0cy5pc1VzZXJuYW1lVmFsaWQgPSBleHBvcnRzLmNsZWFuVHlwb2dyYXBoeVN5bWJvbHMgPSBleHBvcnRzLmVzY2FwZVJlZ0V4cCA9IGV4cG9ydHMucmVtb3ZlX25vbl9hc2NpaSA9IGV4cG9ydHMuZ2V0V29yZHMgPSBleHBvcnRzLnRvZ2dsZUZ1bGxzY3JlZW4gPSBleHBvcnRzLm9iamVjdFRvUXVlcnlTdHJpbmcgPSBleHBvcnRzLmZpbmRHZXRQYXJhbWV0ZXIgPSBleHBvcnRzLmdldFBvc2l0aW9uU3RyaW5nID0gZXhwb3J0cy5nZXRBcnJvd3MgPSBleHBvcnRzLmdldEFTQ0lJID0gZXhwb3J0cy5nZXRTcGVjaWFscyA9IGV4cG9ydHMuZ2V0TnVtYmVycyA9IGV4cG9ydHMuc2Vjb25kc1RvU3RyaW5nID0gZXhwb3J0cy5nZXRHaWJiZXJpc2ggPSBleHBvcnRzLmZpbmRMaW5lQnlMZWFzdFNxdWFyZXMgPSBleHBvcnRzLnJvdW5kVG8yID0gZXhwb3J0cy53aG9yZiA9IGV4cG9ydHMua29nYXNhID0gZXhwb3J0cy5pc0FTQ0lJTGV0dGVyID0gZXhwb3J0cy5jYXBpdGFsaXplRmlyc3RMZXR0ZXJPZkVhY2hXb3JkID0gZXhwb3J0cy5nZXRMYXN0Q2hhciA9IGV4cG9ydHMuZ2V0UmVsZWFzZXNGcm9tR2l0SHViID0gZXhwb3J0cy5tZWRpYW4gPSBleHBvcnRzLm1lYW4gPSBleHBvcnRzLnN0ZERldiA9IGV4cG9ydHMuc21vb3RoID0gZXhwb3J0cy5nZXRDaGFsbGVuZ2VMaXN0ID0gZXhwb3J0cy5maW5kQ3VycmVudEdyb3VwID0gZXhwb3J0cy5nZXRDdXJyZW50TGFuZ3VhZ2UgPSBleHBvcnRzLmdldExhbmd1YWdlID0gZXhwb3J0cy5nZXRMYW5ndWFnZUdyb3VwcyA9IGV4cG9ydHMuZ2V0TGFuZ3VhZ2VMaXN0ID0gZXhwb3J0cy5nZXRDb250cmlidXRvcnNMaXN0ID0gZXhwb3J0cy5nZXRTdXBwb3J0ZXJzTGlzdCA9IGV4cG9ydHMuZ2V0Rm9udHNMaXN0ID0gZXhwb3J0cy5nZXRMYXlvdXQgPSBleHBvcnRzLmdldExheW91dHNMaXN0ID0gZXhwb3J0cy5nZXRGdW5ib3ggPSBleHBvcnRzLmdldEZ1bmJveExpc3QgPSBleHBvcnRzLmdldFNvcnRlZFRoZW1lc0xpc3QgPSBleHBvcnRzLmdldFRoZW1lc0xpc3QgPSBleHBvcnRzLmlzQ29sb3JEYXJrID0gZXhwb3J0cy5pc0NvbG9yTGlnaHQgPSBleHBvcnRzLmdldHVpZCA9IHZvaWQgMDtcbmV4cG9ydHMuY3JlYXRlRXJyb3JNZXNzYWdlID0gZXhwb3J0cy5yYW5kb21FbGVtZW50RnJvbU9iamVjdCA9IGV4cG9ydHMucmFuZG9tRWxlbWVudEZyb21BcnJheSA9IGV4cG9ydHMuc2h1ZmZsZSA9IGV4cG9ydHMucmFuZG9tSW50RnJvbVJhbmdlID0gZXhwb3J0cy5kb3dubG9hZFJlc3VsdHNDU1YgPSBleHBvcnRzLmdldE1vZGUyID0gZXhwb3J0cy5zd2FwRWxlbWVudHMgPSBleHBvcnRzLmNvbnZlcnRSZW1Ub1BpeGVscyA9IGV4cG9ydHMudHJhaWxpbmdDb21wb3NlQ2hhcnMgPSBleHBvcnRzLmNvbnZlcnRSR0J0b0hFWCA9IHZvaWQgMDtcbmNvbnN0IExvYWRlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbG9hZGVyXCIpKTtcbmNvbnN0IGZvcm1hdF8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJkYXRlLWZucy9mb3JtYXRcIikpO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuLi9maXJlYmFzZVwiKTtcbmZ1bmN0aW9uIGdldHVpZCgpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc29sZS5lcnJvcihcIk9ubHkgc2hhcmUgdGhpcyB1aWQgd2l0aCBNaW9kZWMgYW5kIG5vYm9keSBlbHNlIVwiKTtcbiAgICBjb25zb2xlLmxvZygoX2EgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS51aWQpO1xuICAgIGNvbnNvbGUuZXJyb3IoXCJPbmx5IHNoYXJlIHRoaXMgdWlkIHdpdGggTWlvZGVjIGFuZCBub2JvZHkgZWxzZSFcIik7XG59XG5leHBvcnRzLmdldHVpZCA9IGdldHVpZDtcbmZ1bmN0aW9uIGhleFRvSFNMKGhleCkge1xuICAgIC8vIENvbnZlcnQgaGV4IHRvIFJHQiBmaXJzdFxuICAgIGxldCByO1xuICAgIGxldCBnO1xuICAgIGxldCBiO1xuICAgIGlmIChoZXgubGVuZ3RoID09IDQpIHtcbiAgICAgICAgciA9IChcIjB4XCIgKyBoZXhbMV0gKyBoZXhbMV0pO1xuICAgICAgICBnID0gKFwiMHhcIiArIGhleFsyXSArIGhleFsyXSk7XG4gICAgICAgIGIgPSAoXCIweFwiICsgaGV4WzNdICsgaGV4WzNdKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoaGV4Lmxlbmd0aCA9PSA3KSB7XG4gICAgICAgIHIgPSAoXCIweFwiICsgaGV4WzFdICsgaGV4WzJdKTtcbiAgICAgICAgZyA9IChcIjB4XCIgKyBoZXhbM10gKyBoZXhbNF0pO1xuICAgICAgICBiID0gKFwiMHhcIiArIGhleFs1XSArIGhleFs2XSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByID0gMHgwMDtcbiAgICAgICAgZyA9IDB4MDA7XG4gICAgICAgIGIgPSAweDAwO1xuICAgIH1cbiAgICAvLyBUaGVuIHRvIEhTTFxuICAgIHIgLz0gMjU1O1xuICAgIGcgLz0gMjU1O1xuICAgIGIgLz0gMjU1O1xuICAgIGNvbnN0IGNtaW4gPSBNYXRoLm1pbihyLCBnLCBiKTtcbiAgICBjb25zdCBjbWF4ID0gTWF0aC5tYXgociwgZywgYik7XG4gICAgY29uc3QgZGVsdGEgPSBjbWF4IC0gY21pbjtcbiAgICBsZXQgaCA9IDA7XG4gICAgbGV0IHMgPSAwO1xuICAgIGxldCBsID0gMDtcbiAgICBpZiAoZGVsdGEgPT0gMClcbiAgICAgICAgaCA9IDA7XG4gICAgZWxzZSBpZiAoY21heCA9PSByKVxuICAgICAgICBoID0gKChnIC0gYikgLyBkZWx0YSkgJSA2O1xuICAgIGVsc2UgaWYgKGNtYXggPT0gZylcbiAgICAgICAgaCA9IChiIC0gcikgLyBkZWx0YSArIDI7XG4gICAgZWxzZVxuICAgICAgICBoID0gKHIgLSBnKSAvIGRlbHRhICsgNDtcbiAgICBoID0gTWF0aC5yb3VuZChoICogNjApO1xuICAgIGlmIChoIDwgMClcbiAgICAgICAgaCArPSAzNjA7XG4gICAgbCA9IChjbWF4ICsgY21pbikgLyAyO1xuICAgIHMgPSBkZWx0YSA9PSAwID8gMCA6IGRlbHRhIC8gKDEgLSBNYXRoLmFicygyICogbCAtIDEpKTtcbiAgICBzID0gKyhzICogMTAwKS50b0ZpeGVkKDEpO1xuICAgIGwgPSArKGwgKiAxMDApLnRvRml4ZWQoMSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaHVlOiBoLFxuICAgICAgICBzYXQ6IHMsXG4gICAgICAgIGxndDogbCxcbiAgICAgICAgc3RyaW5nOiBcImhzbChcIiArIGggKyBcIixcIiArIHMgKyBcIiUsXCIgKyBsICsgXCIlKVwiLFxuICAgIH07XG59XG5mdW5jdGlvbiBpc0NvbG9yTGlnaHQoaGV4KSB7XG4gICAgY29uc3QgaHNsID0gaGV4VG9IU0woaGV4KTtcbiAgICByZXR1cm4gaHNsLmxndCA+PSA1MDtcbn1cbmV4cG9ydHMuaXNDb2xvckxpZ2h0ID0gaXNDb2xvckxpZ2h0O1xuZnVuY3Rpb24gaXNDb2xvckRhcmsoaGV4KSB7XG4gICAgY29uc3QgaHNsID0gaGV4VG9IU0woaGV4KTtcbiAgICByZXR1cm4gaHNsLmxndCA8IDUwO1xufVxuZXhwb3J0cy5pc0NvbG9yRGFyayA9IGlzQ29sb3JEYXJrO1xubGV0IHRoZW1lc0xpc3QgPSBbXTtcbmZ1bmN0aW9uIGdldFRoZW1lc0xpc3QoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKHRoZW1lc0xpc3QubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHJldHVybiAkLmdldEpTT04oXCJ0aGVtZXMvX2xpc3QuanNvblwiLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGxpc3QgPSBkYXRhLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZUEgPSBhLm5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZUIgPSBiLm5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWVBIDwgbmFtZUIpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuYW1lQSA+IG5hbWVCKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoZW1lc0xpc3QgPSBsaXN0O1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGVtZXNMaXN0O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhlbWVzTGlzdDtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRUaGVtZXNMaXN0ID0gZ2V0VGhlbWVzTGlzdDtcbmxldCBzb3J0ZWRUaGVtZXNMaXN0ID0gW107XG5mdW5jdGlvbiBnZXRTb3J0ZWRUaGVtZXNMaXN0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChzb3J0ZWRUaGVtZXNMaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoZW1lc0xpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgeWllbGQgZ2V0VGhlbWVzTGlzdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHNvcnRlZCA9IFsuLi50aGVtZXNMaXN0XTtcbiAgICAgICAgICAgIHNvcnRlZCA9IHNvcnRlZC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgYjEgPSBoZXhUb0hTTChhLmJnQ29sb3IpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGIyID0gaGV4VG9IU0woYi5iZ0NvbG9yKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYjIubGd0IC0gYjEubGd0O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzb3J0ZWRUaGVtZXNMaXN0ID0gc29ydGVkO1xuICAgICAgICAgICAgcmV0dXJuIHNvcnRlZFRoZW1lc0xpc3Q7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc29ydGVkVGhlbWVzTGlzdDtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRTb3J0ZWRUaGVtZXNMaXN0ID0gZ2V0U29ydGVkVGhlbWVzTGlzdDtcbmxldCBmdW5ib3hMaXN0ID0gW107XG5mdW5jdGlvbiBnZXRGdW5ib3hMaXN0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChmdW5ib3hMaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuICQuZ2V0SlNPTihcImZ1bmJveC9fbGlzdC5qc29uXCIsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgZnVuYm94TGlzdCA9IGRhdGEuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lQSA9IGEubmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lQiA9IGIubmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobmFtZUEgPCBuYW1lQilcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWVBID4gbmFtZUIpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmJveExpc3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5ib3hMaXN0O1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmdldEZ1bmJveExpc3QgPSBnZXRGdW5ib3hMaXN0O1xuZnVuY3Rpb24gZ2V0RnVuYm94KGZ1bmJveCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IGxpc3QgPSB5aWVsZCBnZXRGdW5ib3hMaXN0KCk7XG4gICAgICAgIHJldHVybiBsaXN0LmZpbmQoZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50Lm5hbWUgPT0gZnVuYm94O1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0RnVuYm94ID0gZ2V0RnVuYm94O1xubGV0IGxheW91dHNMaXN0ID0ge307XG5mdW5jdGlvbiBnZXRMYXlvdXRzTGlzdCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoT2JqZWN0LmtleXMobGF5b3V0c0xpc3QpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuICQuZ2V0SlNPTihcImxheW91dHMvX2xpc3QuanNvblwiLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGxheW91dHNMaXN0ID0gZGF0YTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbGF5b3V0c0xpc3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBsYXlvdXRzTGlzdDtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRMYXlvdXRzTGlzdCA9IGdldExheW91dHNMaXN0O1xuZnVuY3Rpb24gZ2V0TGF5b3V0KGxheW91dE5hbWUpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoT2JqZWN0LmtleXMobGF5b3V0c0xpc3QpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgeWllbGQgZ2V0TGF5b3V0c0xpc3QoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGF5b3V0c0xpc3RbbGF5b3V0TmFtZV07XG4gICAgfSk7XG59XG5leHBvcnRzLmdldExheW91dCA9IGdldExheW91dDtcbmxldCBmb250c0xpc3QgPSBbXTtcbmZ1bmN0aW9uIGdldEZvbnRzTGlzdCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoZm9udHNMaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuICQuZ2V0SlNPTihcImZvbnRzL19saXN0Lmpzb25cIiwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBmb250c0xpc3QgPSBkYXRhLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZUEgPSBhLm5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZUIgPSBiLm5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWVBIDwgbmFtZUIpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuYW1lQSA+IG5hbWVCKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBmb250c0xpc3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmb250c0xpc3Q7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0Rm9udHNMaXN0ID0gZ2V0Rm9udHNMaXN0O1xubGV0IHN1cHBvcnRlcnNMaXN0ID0gW107XG5mdW5jdGlvbiBnZXRTdXBwb3J0ZXJzTGlzdCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoc3VwcG9ydGVyc0xpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5nZXRKU09OKFwiYWJvdXQvc3VwcG9ydGVycy5qc29uXCIsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgc3VwcG9ydGVyc0xpc3QgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0ZXJzTGlzdDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRlcnNMaXN0O1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmdldFN1cHBvcnRlcnNMaXN0ID0gZ2V0U3VwcG9ydGVyc0xpc3Q7XG5sZXQgY29udHJpYnV0b3JzTGlzdCA9IFtdO1xuZnVuY3Rpb24gZ2V0Q29udHJpYnV0b3JzTGlzdCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoY29udHJpYnV0b3JzTGlzdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiAkLmdldEpTT04oXCJhYm91dC9jb250cmlidXRvcnMuanNvblwiLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGNvbnRyaWJ1dG9yc0xpc3QgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb250cmlidXRvcnNMaXN0O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gY29udHJpYnV0b3JzTGlzdDtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRDb250cmlidXRvcnNMaXN0ID0gZ2V0Q29udHJpYnV0b3JzTGlzdDtcbmxldCBsYW5ndWFnZUxpc3QgPSBbXTtcbmZ1bmN0aW9uIGdldExhbmd1YWdlTGlzdCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAobGFuZ3VhZ2VMaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuICQuZ2V0SlNPTihcImxhbmd1YWdlcy9fbGlzdC5qc29uXCIsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgbGFuZ3VhZ2VMaXN0ID0gZGF0YTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbGFuZ3VhZ2VMaXN0O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbGFuZ3VhZ2VMaXN0O1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmdldExhbmd1YWdlTGlzdCA9IGdldExhbmd1YWdlTGlzdDtcbmxldCBsYW5ndWFnZUdyb3VwTGlzdCA9IFtdO1xuZnVuY3Rpb24gZ2V0TGFuZ3VhZ2VHcm91cHMoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKGxhbmd1YWdlR3JvdXBMaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuICQuZ2V0SlNPTihcImxhbmd1YWdlcy9fZ3JvdXBzLmpzb25cIiwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBsYW5ndWFnZUdyb3VwTGlzdCA9IGRhdGE7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxhbmd1YWdlR3JvdXBMaXN0O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbGFuZ3VhZ2VHcm91cExpc3Q7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0TGFuZ3VhZ2VHcm91cHMgPSBnZXRMYW5ndWFnZUdyb3VwcztcbmxldCBjdXJyZW50TGFuZ3VhZ2U7XG5mdW5jdGlvbiBnZXRMYW5ndWFnZShsYW5nKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50TGFuZ3VhZ2UgPT0gdW5kZWZpbmVkIHx8IGN1cnJlbnRMYW5ndWFnZS5uYW1lICE9PSBsYW5nKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJnZXR0aW5nIGxhbmd1YWdlIGpzb25cIik7XG4gICAgICAgICAgICAgICAgeWllbGQgJC5nZXRKU09OKGBsYW5ndWFnZXMvJHtsYW5nfS5qc29uYCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudExhbmd1YWdlID0gZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50TGFuZ3VhZ2U7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYGVycm9yIGdldHRpbmcgbGFuZ3VhZ2VgKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgICB5aWVsZCAkLmdldEpTT04oYGxhbmd1YWdlcy9lbmdsaXNoLmpzb25gLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRMYW5ndWFnZSA9IGRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50TGFuZ3VhZ2U7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0TGFuZ3VhZ2UgPSBnZXRMYW5ndWFnZTtcbmZ1bmN0aW9uIGdldEN1cnJlbnRMYW5ndWFnZShsYW5ndWFnZU5hbWUpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICByZXR1cm4geWllbGQgZ2V0TGFuZ3VhZ2UobGFuZ3VhZ2VOYW1lKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0Q3VycmVudExhbmd1YWdlID0gZ2V0Q3VycmVudExhbmd1YWdlO1xuZnVuY3Rpb24gZmluZEN1cnJlbnRHcm91cChsYW5ndWFnZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGxldCByZXRncm91cDtcbiAgICAgICAgY29uc3QgZ3JvdXBzID0geWllbGQgZ2V0TGFuZ3VhZ2VHcm91cHMoKTtcbiAgICAgICAgZ3JvdXBzLmZvckVhY2goKGdyb3VwKSA9PiB7XG4gICAgICAgICAgICBpZiAocmV0Z3JvdXAgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGlmIChncm91cC5sYW5ndWFnZXMuaW5jbHVkZXMobGFuZ3VhZ2UpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldGdyb3VwID0gZ3JvdXA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJldGdyb3VwO1xuICAgIH0pO1xufVxuZXhwb3J0cy5maW5kQ3VycmVudEdyb3VwID0gZmluZEN1cnJlbnRHcm91cDtcbmxldCBjaGFsbGVuZ2VMaXN0ID0gW107XG5mdW5jdGlvbiBnZXRDaGFsbGVuZ2VMaXN0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChjaGFsbGVuZ2VMaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuICQuZ2V0SlNPTihcImNoYWxsZW5nZXMvX2xpc3QuanNvblwiLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGNoYWxsZW5nZUxpc3QgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHJldHVybiBjaGFsbGVuZ2VMaXN0O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gY2hhbGxlbmdlTGlzdDtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRDaGFsbGVuZ2VMaXN0ID0gZ2V0Q2hhbGxlbmdlTGlzdDtcbmZ1bmN0aW9uIHNtb290aChhcnIsIHdpbmRvd1NpemUsIGdldHRlciA9ICh2YWx1ZSkgPT4gdmFsdWUpIHtcbiAgICBjb25zdCBnZXQgPSBnZXR0ZXI7XG4gICAgY29uc3QgcmVzdWx0ID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgY29uc3QgbGVmdE9mZmVzZXQgPSBpIC0gd2luZG93U2l6ZTtcbiAgICAgICAgY29uc3QgZnJvbSA9IGxlZnRPZmZlc2V0ID49IDAgPyBsZWZ0T2ZmZXNldCA6IDA7XG4gICAgICAgIGNvbnN0IHRvID0gaSArIHdpbmRvd1NpemUgKyAxO1xuICAgICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgICBsZXQgc3VtID0gMDtcbiAgICAgICAgZm9yIChsZXQgaiA9IGZyb207IGogPCB0byAmJiBqIDwgYXJyLmxlbmd0aDsgaiArPSAxKSB7XG4gICAgICAgICAgICBzdW0gKz0gZ2V0KGFycltqXSk7XG4gICAgICAgICAgICBjb3VudCArPSAxO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdFtpXSA9IHN1bSAvIGNvdW50O1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuZXhwb3J0cy5zbW9vdGggPSBzbW9vdGg7XG5mdW5jdGlvbiBzdGREZXYoYXJyYXkpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBuID0gYXJyYXkubGVuZ3RoO1xuICAgICAgICBjb25zdCBtZWFuID0gYXJyYXkucmVkdWNlKChhLCBiKSA9PiBhICsgYikgLyBuO1xuICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KGFycmF5Lm1hcCgoeCkgPT4gTWF0aC5wb3coeCAtIG1lYW4sIDIpKS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiKSAvIG4pO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG59XG5leHBvcnRzLnN0ZERldiA9IHN0ZERldjtcbmZ1bmN0aW9uIG1lYW4oYXJyYXkpIHtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gKGFycmF5LnJlZHVjZSgocHJldmlvdXMsIGN1cnJlbnQpID0+IChjdXJyZW50ICs9IHByZXZpb3VzKSkgLyBhcnJheS5sZW5ndGgpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG59XG5leHBvcnRzLm1lYW4gPSBtZWFuO1xuLy9odHRwczovL3d3dy53M3Jlc291cmNlLmNvbS9qYXZhc2NyaXB0LWV4ZXJjaXNlcy9mdW5kYW1lbnRhbC9qYXZhc2NyaXB0LWZ1bmRhbWVudGFsLWV4ZXJjaXNlLTg4LnBocFxuZnVuY3Rpb24gbWVkaWFuKGFycikge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG1pZCA9IE1hdGguZmxvb3IoYXJyLmxlbmd0aCAvIDIpLCBudW1zID0gWy4uLmFycl0uc29ydCgoYSwgYikgPT4gYSAtIGIpO1xuICAgICAgICByZXR1cm4gYXJyLmxlbmd0aCAlIDIgIT09IDAgPyBudW1zW21pZF0gOiAobnVtc1ttaWQgLSAxXSArIG51bXNbbWlkXSkgLyAyO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG59XG5leHBvcnRzLm1lZGlhbiA9IG1lZGlhbjtcbmZ1bmN0aW9uIGdldFJlbGVhc2VzRnJvbUdpdEh1YigpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICByZXR1cm4gJC5nZXRKU09OKFwiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS9yZXBvcy9NaW9kZWMvbW9ua2V5dHlwZS9yZWxlYXNlc1wiLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgJChcIiNib3R0b20gLnZlcnNpb24gLnRleHRcIikudGV4dChkYXRhWzBdLm5hbWUpO1xuICAgICAgICAgICAgJChcIiNib3R0b20gLnZlcnNpb25cIikuY3NzKFwib3BhY2l0eVwiLCAxKTtcbiAgICAgICAgICAgICQoXCIjdmVyc2lvbkhpc3RvcnkgLnJlbGVhc2VzXCIpLmVtcHR5KCk7XG4gICAgICAgICAgICBkYXRhLmZvckVhY2goKHJlbGVhc2UpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIXJlbGVhc2UuZHJhZnQgJiYgIXJlbGVhc2UucHJlcmVsZWFzZSkge1xuICAgICAgICAgICAgICAgICAgICAkKFwiI3ZlcnNpb25IaXN0b3J5IC5yZWxlYXNlc1wiKS5hcHBlbmQoYFxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJyZWxlYXNlXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGl0bGVcIj4ke3JlbGVhc2UubmFtZX08L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkYXRlXCI+JHsoMCwgZm9ybWF0XzEuZGVmYXVsdCkobmV3IERhdGUocmVsZWFzZS5wdWJsaXNoZWRfYXQpLCBcImRkIE1NTSB5eXl5XCIpfTwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImJvZHlcIj4ke3JlbGVhc2UuYm9keS5yZXBsYWNlKC9cXHJcXG4vZywgXCI8YnI+XCIpfTwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICBgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5leHBvcnRzLmdldFJlbGVhc2VzRnJvbUdpdEh1YiA9IGdldFJlbGVhc2VzRnJvbUdpdEh1Yjtcbi8vIGZ1bmN0aW9uIGdldFBhdHJlb25OYW1lcygpIHtcbi8vICAgbGV0IG5hbWVzZWwgPSAkKFwiLnBhZ2VBYm91dCAuc2VjdGlvbiAuc3VwcG9ydGVyc1wiKTtcbi8vICAgZmlyZWJhc2Vcbi8vICAgICAuZnVuY3Rpb25zKClcbi8vICAgICAuaHR0cHNDYWxsYWJsZShcImdldFBhdHJlb25zXCIpKClcbi8vICAgICAudGhlbigoZGF0YSkgPT4ge1xuLy8gICAgICAgbGV0IG5hbWVzID0gZGF0YS5kYXRhO1xuLy8gICAgICAgbmFtZXMuZm9yRWFjaCgobmFtZSkgPT4ge1xuLy8gICAgICAgICBuYW1lc2VsLmFwcGVuZChgPGRpdj4ke25hbWV9PC9kaXY+YCk7XG4vLyAgICAgICB9KTtcbi8vICAgICB9KTtcbi8vIH1cbmZ1bmN0aW9uIGdldExhc3RDaGFyKHdvcmQpIHtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gd29yZC5jaGFyQXQod29yZC5sZW5ndGggLSAxKTtcbiAgICB9XG4gICAgY2F0Y2ggKF9hKSB7XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbn1cbmV4cG9ydHMuZ2V0TGFzdENoYXIgPSBnZXRMYXN0Q2hhcjtcbmZ1bmN0aW9uIGNhcGl0YWxpemVGaXJzdExldHRlck9mRWFjaFdvcmQoc3RyKSB7XG4gICAgcmV0dXJuIHN0clxuICAgICAgICAuc3BsaXQoLyArLylcbiAgICAgICAgLm1hcCgocykgPT4gcy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHMuc2xpY2UoMSkpXG4gICAgICAgIC5qb2luKFwiIFwiKTtcbn1cbmV4cG9ydHMuY2FwaXRhbGl6ZUZpcnN0TGV0dGVyT2ZFYWNoV29yZCA9IGNhcGl0YWxpemVGaXJzdExldHRlck9mRWFjaFdvcmQ7XG5mdW5jdGlvbiBpc0FTQ0lJTGV0dGVyKGMpIHtcbiAgICByZXR1cm4gYy5sZW5ndGggPT09IDEgJiYgL1thLXpdL2kudGVzdChjKTtcbn1cbmV4cG9ydHMuaXNBU0NJSUxldHRlciA9IGlzQVNDSUlMZXR0ZXI7XG5mdW5jdGlvbiBrb2dhc2EoY292KSB7XG4gICAgcmV0dXJuICgxMDAgKiAoMSAtIE1hdGgudGFuaChjb3YgKyBNYXRoLnBvdyhjb3YsIDMpIC8gMyArIE1hdGgucG93KGNvdiwgNSkgLyA1KSkpO1xufVxuZXhwb3J0cy5rb2dhc2EgPSBrb2dhc2E7XG5mdW5jdGlvbiB3aG9yZihzcGVlZCwgd29yZGxlbikge1xuICAgIHJldHVybiBNYXRoLm1pbihzcGVlZCwgTWF0aC5mbG9vcihzcGVlZCAqIE1hdGgucG93KDEuMDMsIC0yICogKHdvcmRsZW4gLSAzKSkpKTtcbn1cbmV4cG9ydHMud2hvcmYgPSB3aG9yZjtcbmZ1bmN0aW9uIHJvdW5kVG8yKG51bSkge1xuICAgIHJldHVybiBNYXRoLnJvdW5kKChudW0gKyBOdW1iZXIuRVBTSUxPTikgKiAxMDApIC8gMTAwO1xufVxuZXhwb3J0cy5yb3VuZFRvMiA9IHJvdW5kVG8yO1xuZnVuY3Rpb24gZmluZExpbmVCeUxlYXN0U3F1YXJlcyh2YWx1ZXNfeSkge1xuICAgIGxldCBzdW1feCA9IDA7XG4gICAgbGV0IHN1bV95ID0gMDtcbiAgICBsZXQgc3VtX3h5ID0gMDtcbiAgICBsZXQgc3VtX3h4ID0gMDtcbiAgICBsZXQgY291bnQgPSAwO1xuICAgIC8qXG4gICAgICogV2UnbGwgdXNlIHRob3NlIGxldGlhYmxlcyBmb3IgZmFzdGVyIHJlYWQvd3JpdGUgYWNjZXNzLlxuICAgICAqL1xuICAgIGxldCB4ID0gMDtcbiAgICBsZXQgeSA9IDA7XG4gICAgY29uc3QgdmFsdWVzX2xlbmd0aCA9IHZhbHVlc195Lmxlbmd0aDtcbiAgICAvKlxuICAgICAqIE5vdGhpbmcgdG8gZG8uXG4gICAgICovXG4gICAgaWYgKHZhbHVlc19sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIFtbXSwgW11dO1xuICAgIH1cbiAgICAvKlxuICAgICAqIENhbGN1bGF0ZSB0aGUgc3VtIGZvciBlYWNoIG9mIHRoZSBwYXJ0cyBuZWNlc3NhcnkuXG4gICAgICovXG4gICAgZm9yIChsZXQgdiA9IDA7IHYgPCB2YWx1ZXNfbGVuZ3RoOyB2KyspIHtcbiAgICAgICAgeCA9IHYgKyAxO1xuICAgICAgICB5ID0gdmFsdWVzX3lbdl07XG4gICAgICAgIHN1bV94ICs9IHg7XG4gICAgICAgIHN1bV95ICs9IHk7XG4gICAgICAgIHN1bV94eCArPSB4ICogeDtcbiAgICAgICAgc3VtX3h5ICs9IHggKiB5O1xuICAgICAgICBjb3VudCsrO1xuICAgIH1cbiAgICAvKlxuICAgICAqIENhbGN1bGF0ZSBtIGFuZCBiIGZvciB0aGUgZm9ybXVsYXI6XG4gICAgICogeSA9IHggKiBtICsgYlxuICAgICAqL1xuICAgIGNvbnN0IG0gPSAoY291bnQgKiBzdW1feHkgLSBzdW1feCAqIHN1bV95KSAvIChjb3VudCAqIHN1bV94eCAtIHN1bV94ICogc3VtX3gpO1xuICAgIGNvbnN0IGIgPSBzdW1feSAvIGNvdW50IC0gKG0gKiBzdW1feCkgLyBjb3VudDtcbiAgICBjb25zdCByZXR1cm5wb2ludDEgPSBbMSwgMSAqIG0gKyBiXTtcbiAgICBjb25zdCByZXR1cm5wb2ludDIgPSBbdmFsdWVzX2xlbmd0aCwgdmFsdWVzX2xlbmd0aCAqIG0gKyBiXTtcbiAgICByZXR1cm4gW3JldHVybnBvaW50MSwgcmV0dXJucG9pbnQyXTtcbn1cbmV4cG9ydHMuZmluZExpbmVCeUxlYXN0U3F1YXJlcyA9IGZpbmRMaW5lQnlMZWFzdFNxdWFyZXM7XG5mdW5jdGlvbiBnZXRHaWJiZXJpc2goKSB7XG4gICAgY29uc3QgcmFuZExlbiA9IHJhbmRvbUludEZyb21SYW5nZSgxLCA3KTtcbiAgICBsZXQgcmV0ID0gXCJcIjtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJhbmRMZW47IGkrKykge1xuICAgICAgICByZXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSg5NyArIHJhbmRvbUludEZyb21SYW5nZSgwLCAyNSkpO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufVxuZXhwb3J0cy5nZXRHaWJiZXJpc2ggPSBnZXRHaWJiZXJpc2g7XG5mdW5jdGlvbiBzZWNvbmRzVG9TdHJpbmcoc2VjLCBhbHdheXNTaG93TWludXRlcyA9IGZhbHNlLCBhbHdheXNTaG93SG91cnMgPSBmYWxzZSwgZGVsaW1pdGVyID0gXCI6XCIsIHNob3dTZWNvbmRzID0gdHJ1ZSwgc2hvd0RheXMgPSBmYWxzZSkge1xuICAgIHNlYyA9IE1hdGguYWJzKHNlYyk7XG4gICAgbGV0IGRheXMgPSAwO1xuICAgIGxldCBob3VycztcbiAgICBpZiAoc2hvd0RheXMpIHtcbiAgICAgICAgZGF5cyA9IE1hdGguZmxvb3Ioc2VjIC8gODY0MDApO1xuICAgICAgICBob3VycyA9IE1hdGguZmxvb3IoKHNlYyAlIDg2NDAwKSAvIDM2MDApO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaG91cnMgPSBNYXRoLmZsb29yKHNlYyAvIDM2MDApO1xuICAgIH1cbiAgICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcigoc2VjICUgMzYwMCkgLyA2MCk7XG4gICAgY29uc3Qgc2Vjb25kcyA9IHJvdW5kVG8yKChzZWMgJSAzNjAwKSAlIDYwKTtcbiAgICBsZXQgZGF5c1N0cmluZztcbiAgICBsZXQgaG91cnNTdHJpbmc7XG4gICAgbGV0IG1pbnV0ZXNTdHJpbmc7XG4gICAgbGV0IHNlY29uZHNTdHJpbmc7XG4gICAgaWYgKHNob3dEYXlzKSB7XG4gICAgICAgIGRheXMgPCAxMCAmJiBkZWxpbWl0ZXIgIT09IFwidGV4dFwiXG4gICAgICAgICAgICA/IChkYXlzU3RyaW5nID0gXCIwXCIgKyBkYXlzKVxuICAgICAgICAgICAgOiAoZGF5c1N0cmluZyA9IGRheXMpO1xuICAgIH1cbiAgICBob3VycyA8IDEwICYmIGRlbGltaXRlciAhPT0gXCJ0ZXh0XCJcbiAgICAgICAgPyAoaG91cnNTdHJpbmcgPSBcIjBcIiArIGhvdXJzKVxuICAgICAgICA6IChob3Vyc1N0cmluZyA9IGhvdXJzKTtcbiAgICBtaW51dGVzIDwgMTAgJiYgZGVsaW1pdGVyICE9PSBcInRleHRcIlxuICAgICAgICA/IChtaW51dGVzU3RyaW5nID0gXCIwXCIgKyBtaW51dGVzKVxuICAgICAgICA6IChtaW51dGVzU3RyaW5nID0gbWludXRlcyk7XG4gICAgc2Vjb25kcyA8IDEwICYmXG4gICAgICAgIChtaW51dGVzID4gMCB8fCBob3VycyA+IDAgfHwgYWx3YXlzU2hvd01pbnV0ZXMpICYmXG4gICAgICAgIGRlbGltaXRlciAhPT0gXCJ0ZXh0XCJcbiAgICAgICAgPyAoc2Vjb25kc1N0cmluZyA9IFwiMFwiICsgc2Vjb25kcylcbiAgICAgICAgOiAoc2Vjb25kc1N0cmluZyA9IHNlY29uZHMpO1xuICAgIGxldCByZXQgPSBcIlwiO1xuICAgIGlmIChkYXlzID4gMCAmJiBzaG93RGF5cykge1xuICAgICAgICByZXQgKz0gZGF5c1N0cmluZztcbiAgICAgICAgaWYgKGRlbGltaXRlciA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgICAgIGlmIChkYXlzID09IDEpIHtcbiAgICAgICAgICAgICAgICByZXQgKz0gXCIgZGF5IFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0ICs9IFwiIGRheXMgXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXQgKz0gZGVsaW1pdGVyO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChob3VycyA+IDAgfHwgYWx3YXlzU2hvd0hvdXJzKSB7XG4gICAgICAgIHJldCArPSBob3Vyc1N0cmluZztcbiAgICAgICAgaWYgKGRlbGltaXRlciA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgICAgIGlmIChob3VycyA9PSAxKSB7XG4gICAgICAgICAgICAgICAgcmV0ICs9IFwiIGhvdXIgXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXQgKz0gXCIgaG91cnMgXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXQgKz0gZGVsaW1pdGVyO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChtaW51dGVzID4gMCB8fCBob3VycyA+IDAgfHwgYWx3YXlzU2hvd01pbnV0ZXMpIHtcbiAgICAgICAgcmV0ICs9IG1pbnV0ZXNTdHJpbmc7XG4gICAgICAgIGlmIChkZWxpbWl0ZXIgPT09IFwidGV4dFwiKSB7XG4gICAgICAgICAgICBpZiAobWludXRlcyA9PSAxKSB7XG4gICAgICAgICAgICAgICAgcmV0ICs9IFwiIG1pbnV0ZSBcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldCArPSBcIiBtaW51dGVzIFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHNob3dTZWNvbmRzKSB7XG4gICAgICAgICAgICByZXQgKz0gZGVsaW1pdGVyO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChzaG93U2Vjb25kcykge1xuICAgICAgICByZXQgKz0gc2Vjb25kc1N0cmluZztcbiAgICAgICAgaWYgKGRlbGltaXRlciA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgICAgIGlmIChzZWNvbmRzID09IDEpIHtcbiAgICAgICAgICAgICAgICByZXQgKz0gXCIgc2Vjb25kXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXQgKz0gXCIgc2Vjb25kc1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChob3VycyA9PT0gMCAmJiBtaW51dGVzID09PSAwICYmICFzaG93U2Vjb25kcyAmJiBkZWxpbWl0ZXIgPT09IFwidGV4dFwiKSB7XG4gICAgICAgIHJldCA9IFwibGVzcyB0aGFuIDEgbWludXRlXCI7XG4gICAgfVxuICAgIHJldHVybiByZXQudHJpbSgpO1xufVxuZXhwb3J0cy5zZWNvbmRzVG9TdHJpbmcgPSBzZWNvbmRzVG9TdHJpbmc7XG5mdW5jdGlvbiBnZXROdW1iZXJzKGxlbikge1xuICAgIGNvbnN0IHJhbmRMZW4gPSByYW5kb21JbnRGcm9tUmFuZ2UoMSwgbGVuKTtcbiAgICBsZXQgcmV0ID0gXCJcIjtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJhbmRMZW47IGkrKykge1xuICAgICAgICBjb25zdCByYW5kb21OdW0gPSByYW5kb21JbnRGcm9tUmFuZ2UoMCwgOSk7XG4gICAgICAgIHJldCArPSByYW5kb21OdW0udG9TdHJpbmcoKTtcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn1cbmV4cG9ydHMuZ2V0TnVtYmVycyA9IGdldE51bWJlcnM7XG5mdW5jdGlvbiBnZXRTcGVjaWFscygpIHtcbiAgICBjb25zdCByYW5kTGVuID0gcmFuZG9tSW50RnJvbVJhbmdlKDEsIDcpO1xuICAgIGxldCByZXQgPSBcIlwiO1xuICAgIGNvbnN0IHNwZWNpYWxzID0gW1xuICAgICAgICBcIiFcIixcbiAgICAgICAgXCJAXCIsXG4gICAgICAgIFwiI1wiLFxuICAgICAgICBcIiRcIixcbiAgICAgICAgXCIlXCIsXG4gICAgICAgIFwiXlwiLFxuICAgICAgICBcIiZcIixcbiAgICAgICAgXCIqXCIsXG4gICAgICAgIFwiKFwiLFxuICAgICAgICBcIilcIixcbiAgICAgICAgXCItXCIsXG4gICAgICAgIFwiX1wiLFxuICAgICAgICBcIj1cIixcbiAgICAgICAgXCIrXCIsXG4gICAgICAgIFwie1wiLFxuICAgICAgICBcIn1cIixcbiAgICAgICAgXCJbXCIsXG4gICAgICAgIFwiXVwiLFxuICAgICAgICBcIidcIixcbiAgICAgICAgJ1wiJyxcbiAgICAgICAgXCIvXCIsXG4gICAgICAgIFwiXFxcXFwiLFxuICAgICAgICBcInxcIixcbiAgICBdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmFuZExlbjsgaSsrKSB7XG4gICAgICAgIHJldCArPSByYW5kb21FbGVtZW50RnJvbUFycmF5KHNwZWNpYWxzKTtcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn1cbmV4cG9ydHMuZ2V0U3BlY2lhbHMgPSBnZXRTcGVjaWFscztcbmZ1bmN0aW9uIGdldEFTQ0lJKCkge1xuICAgIGNvbnN0IHJhbmRMZW4gPSByYW5kb21JbnRGcm9tUmFuZ2UoMSwgMTApO1xuICAgIGxldCByZXQgPSBcIlwiO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmFuZExlbjsgaSsrKSB7XG4gICAgICAgIGxldCByYW4gPSAzMyArIHJhbmRvbUludEZyb21SYW5nZSgwLCA5Myk7XG4gICAgICAgIHdoaWxlIChyYW4gPT0gOTYgfHwgcmFuID09IDk0KVxuICAgICAgICAgICAgcmFuID0gMzMgKyByYW5kb21JbnRGcm9tUmFuZ2UoMCwgOTMpOyAvL3RvZG8gcmVtb3ZlIHdoZW4gaW5wdXQgcmV3cml0ZSBpcyBmaXhlZFxuICAgICAgICByZXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShyYW4pO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufVxuZXhwb3J0cy5nZXRBU0NJSSA9IGdldEFTQ0lJO1xuZnVuY3Rpb24gZ2V0QXJyb3dzKCkge1xuICAgIGNvbnN0IGFycm93QXJyYXkgPSBbXCLihpBcIiwgXCLihpFcIiwgXCLihpJcIiwgXCLihpNcIl07XG4gICAgbGV0IGFycm93V29yZCA9IFwiXCI7XG4gICAgbGV0IGxhc3RjaGFyO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7XG4gICAgICAgIGxldCByYW5kb20gPSByYW5kb21FbGVtZW50RnJvbUFycmF5KGFycm93QXJyYXkpO1xuICAgICAgICB3aGlsZSAocmFuZG9tID09PSBsYXN0Y2hhcikge1xuICAgICAgICAgICAgcmFuZG9tID0gcmFuZG9tRWxlbWVudEZyb21BcnJheShhcnJvd0FycmF5KTtcbiAgICAgICAgfVxuICAgICAgICBsYXN0Y2hhciA9IHJhbmRvbTtcbiAgICAgICAgYXJyb3dXb3JkICs9IHJhbmRvbTtcbiAgICB9XG4gICAgcmV0dXJuIGFycm93V29yZDtcbn1cbmV4cG9ydHMuZ2V0QXJyb3dzID0gZ2V0QXJyb3dzO1xuZnVuY3Rpb24gZ2V0UG9zaXRpb25TdHJpbmcobnVtYmVyKSB7XG4gICAgbGV0IG51bWVuZCA9IFwidGhcIjtcbiAgICBjb25zdCB0ID0gbnVtYmVyICUgMTA7XG4gICAgY29uc3QgaCA9IG51bWJlciAlIDEwMDtcbiAgICBpZiAodCA9PSAxICYmIGggIT0gMTEpIHtcbiAgICAgICAgbnVtZW5kID0gXCJzdFwiO1xuICAgIH1cbiAgICBpZiAodCA9PSAyICYmIGggIT0gMTIpIHtcbiAgICAgICAgbnVtZW5kID0gXCJuZFwiO1xuICAgIH1cbiAgICBpZiAodCA9PSAzICYmIGggIT0gMTMpIHtcbiAgICAgICAgbnVtZW5kID0gXCJyZFwiO1xuICAgIH1cbiAgICByZXR1cm4gbnVtYmVyICsgbnVtZW5kO1xufVxuZXhwb3J0cy5nZXRQb3NpdGlvblN0cmluZyA9IGdldFBvc2l0aW9uU3RyaW5nO1xuZnVuY3Rpb24gZmluZEdldFBhcmFtZXRlcihwYXJhbWV0ZXJOYW1lKSB7XG4gICAgbGV0IHJlc3VsdCA9IG51bGw7XG4gICAgbGV0IHRtcCA9IFtdO1xuICAgIGxvY2F0aW9uLnNlYXJjaFxuICAgICAgICAuc3Vic3RyKDEpXG4gICAgICAgIC5zcGxpdChcIiZcIilcbiAgICAgICAgLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgdG1wID0gaXRlbS5zcGxpdChcIj1cIik7XG4gICAgICAgIGlmICh0bXBbMF0gPT09IHBhcmFtZXRlck5hbWUpXG4gICAgICAgICAgICByZXN1bHQgPSBkZWNvZGVVUklDb21wb25lbnQodG1wWzFdKTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xufVxuZXhwb3J0cy5maW5kR2V0UGFyYW1ldGVyID0gZmluZEdldFBhcmFtZXRlcjtcbmZ1bmN0aW9uIG9iamVjdFRvUXVlcnlTdHJpbmcob2JqKSB7XG4gICAgY29uc3Qgc3RyID0gW107XG4gICAgZm9yIChjb25zdCBwIGluIG9iaikge1xuICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcCkpIHtcbiAgICAgICAgICAgIC8vIEFycmF5cyBnZXQgZW5jb2RlZCBhcyBhIGNvbW1hKCUyQyktc2VwYXJhdGVkIGxpc3RcbiAgICAgICAgICAgIHN0ci5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChwKSArIFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KG9ialtwXSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBzdHIuam9pbihcIiZcIik7XG59XG5leHBvcnRzLm9iamVjdFRvUXVlcnlTdHJpbmcgPSBvYmplY3RUb1F1ZXJ5U3RyaW5nO1xuZnVuY3Rpb24gdG9nZ2xlRnVsbHNjcmVlbigpIHtcbiAgICBjb25zdCBlbGVtID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICAgIGlmICghZG9jdW1lbnQuZnVsbHNjcmVlbkVsZW1lbnQgJiZcbiAgICAgICAgIWRvY3VtZW50Lm1vekZ1bGxTY3JlZW5FbGVtZW50ICYmXG4gICAgICAgICFkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRWxlbWVudCAmJlxuICAgICAgICAhZG9jdW1lbnQubXNGdWxsc2NyZWVuRWxlbWVudCkge1xuICAgICAgICBpZiAoZWxlbS5yZXF1ZXN0RnVsbHNjcmVlbikge1xuICAgICAgICAgICAgZWxlbS5yZXF1ZXN0RnVsbHNjcmVlbigpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGVsZW0ubXNSZXF1ZXN0RnVsbHNjcmVlbikge1xuICAgICAgICAgICAgZWxlbS5tc1JlcXVlc3RGdWxsc2NyZWVuKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZWxlbS5tb3pSZXF1ZXN0RnVsbFNjcmVlbikge1xuICAgICAgICAgICAgZWxlbS5tb3pSZXF1ZXN0RnVsbFNjcmVlbigpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGVsZW0ud2Via2l0UmVxdWVzdEZ1bGxzY3JlZW4pIHtcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIGVsZW0ud2Via2l0UmVxdWVzdEZ1bGxzY3JlZW4oRWxlbWVudC5BTExPV19LRVlCT0FSRF9JTlBVVCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChkb2N1bWVudC5leGl0RnVsbHNjcmVlbikge1xuICAgICAgICAgICAgZG9jdW1lbnQuZXhpdEZ1bGxzY3JlZW4oKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChkb2N1bWVudC5tc0V4aXRGdWxsc2NyZWVuKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5tc0V4aXRGdWxsc2NyZWVuKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZG9jdW1lbnQubW96Q2FuY2VsRnVsbFNjcmVlbikge1xuICAgICAgICAgICAgZG9jdW1lbnQubW96Q2FuY2VsRnVsbFNjcmVlbigpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGRvY3VtZW50LndlYmtpdEV4aXRGdWxsc2NyZWVuKSB7XG4gICAgICAgICAgICBkb2N1bWVudC53ZWJraXRFeGl0RnVsbHNjcmVlbigpO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy50b2dnbGVGdWxsc2NyZWVuID0gdG9nZ2xlRnVsbHNjcmVlbjtcbmZ1bmN0aW9uIGdldFdvcmRzKCkge1xuICAgIGNvbnN0IHdvcmRzID0gWy4uLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIjd29yZHMgLndvcmRcIildXG4gICAgICAgIC5tYXAoKHdvcmQpID0+IHtcbiAgICAgICAgcmV0dXJuIFsuLi53b3JkLnF1ZXJ5U2VsZWN0b3JBbGwoXCJsZXR0ZXJcIildXG4gICAgICAgICAgICAubWFwKChsZXR0ZXIpID0+IGxldHRlci50ZXh0Q29udGVudClcbiAgICAgICAgICAgIC5qb2luKFwiXCIpO1xuICAgIH0pXG4gICAgICAgIC5qb2luKFwiIFwiKTtcbiAgICByZXR1cm4gd29yZHM7XG59XG5leHBvcnRzLmdldFdvcmRzID0gZ2V0V29yZHM7XG4vL2NyZWRpdDogaHR0cHM6Ly93d3cudzNyZXNvdXJjZS5jb20vamF2YXNjcmlwdC1leGVyY2lzZXMvamF2YXNjcmlwdC1zdHJpbmctZXhlcmNpc2UtMzIucGhwXG5mdW5jdGlvbiByZW1vdmVfbm9uX2FzY2lpKHN0cikge1xuICAgIGlmIChzdHIgPT09IG51bGwgfHwgc3RyID09PSBcIlwiKVxuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICBlbHNlXG4gICAgICAgIHN0ciA9IHN0ci50b1N0cmluZygpO1xuICAgIHJldHVybiBzdHIucmVwbGFjZSgvW15cXHgyMC1cXHg3RV0vZywgXCJcIik7XG59XG5leHBvcnRzLnJlbW92ZV9ub25fYXNjaWkgPSByZW1vdmVfbm9uX2FzY2lpO1xuZnVuY3Rpb24gZXNjYXBlUmVnRXhwKHN0cikge1xuICAgIHJldHVybiBzdHIucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xcXVxcXFxdL2csIFwiXFxcXCQmXCIpO1xufVxuZXhwb3J0cy5lc2NhcGVSZWdFeHAgPSBlc2NhcGVSZWdFeHA7XG5mdW5jdGlvbiBjbGVhblR5cG9ncmFwaHlTeW1ib2xzKHRleHRUb0NsZWFuKSB7XG4gICAgY29uc3Qgc3BlY2lhbHMgPSB7XG4gICAgICAgIFwi4oCcXCI6ICdcIicsXG4gICAgICAgIFwi4oCdXCI6ICdcIicsXG4gICAgICAgIFwi4oCZXCI6IFwiJ1wiLFxuICAgICAgICBcIuKAmFwiOiBcIidcIixcbiAgICAgICAgXCIsXCI6IFwiLFwiLFxuICAgICAgICBcIuKAlFwiOiBcIi1cIixcbiAgICAgICAgXCLigKZcIjogXCIuLi5cIixcbiAgICAgICAgXCLCq1wiOiBcIjw8XCIsXG4gICAgICAgIFwiwrtcIjogXCI+PlwiLFxuICAgICAgICBcIuKAk1wiOiBcIi1cIixcbiAgICAgICAgXCLigIdcIjogXCIgXCIsXG4gICAgICAgIFwi4oCvXCI6IFwiIFwiLFxuICAgICAgICBcIsKgXCI6IFwiIFwiLFxuICAgIH07XG4gICAgcmV0dXJuIHRleHRUb0NsZWFuLnJlcGxhY2UoL1vigJzigJ3igJnigJjigJQs4oCmwqvCu+KAk1xcdTIwMDdcXHUyMDJGXFx1MDBBMF0vZywgKGNoYXIpID0+IHNwZWNpYWxzW2NoYXJdIHx8IFwiXCIpO1xufVxuZXhwb3J0cy5jbGVhblR5cG9ncmFwaHlTeW1ib2xzID0gY2xlYW5UeXBvZ3JhcGh5U3ltYm9scztcbmZ1bmN0aW9uIGlzVXNlcm5hbWVWYWxpZChuYW1lKSB7XG4gICAgaWYgKG5hbWUgPT09IG51bGwgfHwgbmFtZSA9PT0gdW5kZWZpbmVkIHx8IG5hbWUgPT09IFwiXCIpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAoL21pb2RlYy8udGVzdChuYW1lLnRvTG93ZXJDYXNlKCkpKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgaWYgKC9iaXRseS8udGVzdChuYW1lLnRvTG93ZXJDYXNlKCkpKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgaWYgKG5hbWUubGVuZ3RoID4gMTQpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAoL15cXC4uKi8udGVzdChuYW1lLnRvTG93ZXJDYXNlKCkpKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIC9eWzAtOWEtekEtWl8uLV0rJC8udGVzdChuYW1lKTtcbn1cbmV4cG9ydHMuaXNVc2VybmFtZVZhbGlkID0gaXNVc2VybmFtZVZhbGlkO1xuZnVuY3Rpb24gbWFwUmFuZ2UoeCwgaW5fbWluLCBpbl9tYXgsIG91dF9taW4sIG91dF9tYXgpIHtcbiAgICBsZXQgbnVtID0gKCh4IC0gaW5fbWluKSAqIChvdXRfbWF4IC0gb3V0X21pbikpIC8gKGluX21heCAtIGluX21pbikgKyBvdXRfbWluO1xuICAgIGlmIChvdXRfbWluID4gb3V0X21heCkge1xuICAgICAgICBpZiAobnVtID4gb3V0X21pbikge1xuICAgICAgICAgICAgbnVtID0gb3V0X21pbjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChudW0gPCBvdXRfbWF4KSB7XG4gICAgICAgICAgICBudW0gPSBvdXRfbWF4O1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAobnVtIDwgb3V0X21pbikge1xuICAgICAgICAgICAgbnVtID0gb3V0X21pbjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChudW0gPiBvdXRfbWF4KSB7XG4gICAgICAgICAgICBudW0gPSBvdXRfbWF4O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudW07XG59XG5leHBvcnRzLm1hcFJhbmdlID0gbWFwUmFuZ2U7XG5mdW5jdGlvbiBjYW5RdWlja1Jlc3RhcnQobW9kZSwgd29yZHMsIHRpbWUsIEN1c3RvbVRleHQpIHtcbiAgICBpZiAoKG1vZGUgPT09IFwid29yZHNcIiAmJiB3b3JkcyA8IDEwMDApIHx8XG4gICAgICAgIChtb2RlID09PSBcInRpbWVcIiAmJiB0aW1lIDwgMzYwMCkgfHxcbiAgICAgICAgbW9kZSA9PT0gXCJxdW90ZVwiIHx8XG4gICAgICAgIChtb2RlID09PSBcImN1c3RvbVwiICYmIEN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmIEN1c3RvbVRleHQud29yZCA8IDEwMDApIHx8XG4gICAgICAgIChtb2RlID09PSBcImN1c3RvbVwiICYmIEN1c3RvbVRleHQuaXNUaW1lUmFuZG9tICYmIEN1c3RvbVRleHQudGltZSA8IDM2MDApIHx8XG4gICAgICAgIChtb2RlID09PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICAhQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gJiZcbiAgICAgICAgICAgIEN1c3RvbVRleHQudGV4dC5sZW5ndGggPCAxMDAwKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG5leHBvcnRzLmNhblF1aWNrUmVzdGFydCA9IGNhblF1aWNrUmVzdGFydDtcbmZ1bmN0aW9uIGNsZWFyVGltZW91dHModGltZW91dHMpIHtcbiAgICB0aW1lb3V0cy5mb3JFYWNoKCh0bykgPT4ge1xuICAgICAgICBpZiAodHlwZW9mIHRvID09PSBcIm51bWJlclwiKVxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRvKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRvKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuY2xlYXJUaW1lb3V0cyA9IGNsZWFyVGltZW91dHM7XG4vL2h0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE0MzEwOTQvaG93LWRvLWktcmVwbGFjZS1hLWNoYXJhY3Rlci1hdC1hLXBhcnRpY3VsYXItaW5kZXgtaW4tamF2YXNjcmlwdFxuZnVuY3Rpb24gc2V0Q2hhckF0KHN0ciwgaW5kZXgsIGNocikge1xuICAgIGlmIChpbmRleCA+IHN0ci5sZW5ndGggLSAxKVxuICAgICAgICByZXR1cm4gc3RyO1xuICAgIHJldHVybiBzdHIuc3Vic3RyaW5nKDAsIGluZGV4KSArIGNociArIHN0ci5zdWJzdHJpbmcoaW5kZXggKyAxKTtcbn1cbmV4cG9ydHMuc2V0Q2hhckF0ID0gc2V0Q2hhckF0O1xuLy9odHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yNzM3ODkvaXMtdGhlcmUtYS12ZXJzaW9uLW9mLWphdmFzY3JpcHRzLXN0cmluZy1pbmRleG9mLXRoYXQtYWxsb3dzLWZvci1yZWd1bGFyLWV4cHJcbmZ1bmN0aW9uIHJlZ2V4SW5kZXhPZihzdHJpbmcsIHJlZ2V4LCBzdGFydHBvcykge1xuICAgIGNvbnN0IGluZGV4T2YgPSBzdHJpbmcuc3Vic3RyaW5nKHN0YXJ0cG9zIHx8IDApLnNlYXJjaChyZWdleCk7XG4gICAgcmV0dXJuIGluZGV4T2YgPj0gMCA/IGluZGV4T2YgKyAoc3RhcnRwb3MgfHwgMCkgOiBpbmRleE9mO1xufVxuZXhwb3J0cy5yZWdleEluZGV4T2YgPSByZWdleEluZGV4T2Y7XG5mdW5jdGlvbiBjb252ZXJ0UkdCdG9IRVgocmdiKSB7XG4gICAgY29uc3QgbWF0Y2ggPSByZ2IubWF0Y2goL15yZ2JcXCgoXFxkKyksIFxccyooXFxkKyksIFxccyooXFxkKylcXCkkLyk7XG4gICAgaWYgKG1hdGNoID09PSBudWxsKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKG1hdGNoLmxlbmd0aCA8IDMpXG4gICAgICAgIHJldHVybjtcbiAgICBmdW5jdGlvbiBoZXhDb2RlKGkpIHtcbiAgICAgICAgLy8gVGFrZSB0aGUgbGFzdCAyIGNoYXJhY3RlcnMgYW5kIGNvbnZlcnRcbiAgICAgICAgLy8gdGhlbSB0byBIZXhhZGVjaW1hbC5cbiAgICAgICAgcmV0dXJuIChcIjBcIiArIHBhcnNlSW50KGkpLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpO1xuICAgIH1cbiAgICByZXR1cm4gXCIjXCIgKyBoZXhDb2RlKG1hdGNoWzFdKSArIGhleENvZGUobWF0Y2hbMl0pICsgaGV4Q29kZShtYXRjaFszXSk7XG59XG5leHBvcnRzLmNvbnZlcnRSR0J0b0hFWCA9IGNvbnZlcnRSR0J0b0hFWDtcblN0cmluZy5wcm90b3R5cGUubGFzdEluZGV4T2ZSZWdleCA9IGZ1bmN0aW9uIChyZWdleCkge1xuICAgIGNvbnN0IG1hdGNoID0gdGhpcy5tYXRjaChyZWdleCk7XG4gICAgcmV0dXJuIG1hdGNoID8gdGhpcy5sYXN0SW5kZXhPZihtYXRjaFttYXRjaC5sZW5ndGggLSAxXSkgOiAtMTtcbn07XG5leHBvcnRzLnRyYWlsaW5nQ29tcG9zZUNoYXJzID0gL1tcXHUwMkIwLVxcdTAyRkZgwrRewqh+XSskfOKOhC4qJC87XG4vL2h0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzM2NTMyMzA3L3JlbS1weC1pbi1qYXZhc2NyaXB0XG5mdW5jdGlvbiBjb252ZXJ0UmVtVG9QaXhlbHMocmVtKSB7XG4gICAgcmV0dXJuIHJlbSAqIHBhcnNlRmxvYXQoZ2V0Q29tcHV0ZWRTdHlsZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpLmZvbnRTaXplKTtcbn1cbmV4cG9ydHMuY29udmVydFJlbVRvUGl4ZWxzID0gY29udmVydFJlbVRvUGl4ZWxzO1xuZnVuY3Rpb24gc3dhcEVsZW1lbnRzKGVsMSwgZWwyLCB0b3RhbER1cmF0aW9uLCBjYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm47XG59LCBtaWRkbGVDYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm47XG59KSB7XG4gICAgaWYgKChlbDEuaGFzQ2xhc3MoXCJoaWRkZW5cIikgJiYgIWVsMi5oYXNDbGFzcyhcImhpZGRlblwiKSkgfHxcbiAgICAgICAgKCFlbDEuaGFzQ2xhc3MoXCJoaWRkZW5cIikgJiYgZWwyLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSkge1xuICAgICAgICAvL29uZSBvZiB0aGVtIGlzIGhpZGRlbiBhbmQgdGhlIG90aGVyIGlzIHZpc2libGVcbiAgICAgICAgaWYgKGVsMS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAkKGVsMSlcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIHRvdGFsRHVyYXRpb24gLyAyLCAoKSA9PiB7XG4gICAgICAgICAgICBtaWRkbGVDYWxsYmFjaygpO1xuICAgICAgICAgICAgJChlbDEpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChlbDIpXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIH0sIHRvdGFsRHVyYXRpb24gLyAyLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZWwxLmhhc0NsYXNzKFwiaGlkZGVuXCIpICYmIGVsMi5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAvL2JvdGggYXJlIGhpZGRlbiwgb25seSBmYWRlIGluIHRoZSBzZWNvbmRcbiAgICAgICAgJChlbDIpXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICB9LCB0b3RhbER1cmF0aW9uLCAoKSA9PiB7XG4gICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgfVxuICAgIHJldHVybjtcbn1cbmV4cG9ydHMuc3dhcEVsZW1lbnRzID0gc3dhcEVsZW1lbnRzO1xuZnVuY3Rpb24gZ2V0TW9kZTIoY29uZmlnLCByYW5kb21RdW90ZSkge1xuICAgIGNvbnN0IG1vZGUgPSBjb25maWcubW9kZTtcbiAgICBpZiAobW9kZSA9PT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgcmV0dXJuIGNvbmZpZy50aW1lLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKG1vZGUgPT09IFwid29yZHNcIikge1xuICAgICAgICByZXR1cm4gY29uZmlnLndvcmRzLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKG1vZGUgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgcmV0dXJuIFwiY3VzdG9tXCI7XG4gICAgfVxuICAgIGVsc2UgaWYgKG1vZGUgPT09IFwiemVuXCIpIHtcbiAgICAgICAgcmV0dXJuIFwiemVuXCI7XG4gICAgfVxuICAgIGVsc2UgaWYgKG1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICByZXR1cm4gcmFuZG9tUXVvdGUuaWQudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgcmV0dXJuIFwiXCI7XG59XG5leHBvcnRzLmdldE1vZGUyID0gZ2V0TW9kZTI7XG5mdW5jdGlvbiBkb3dubG9hZFJlc3VsdHNDU1YoYXJyYXkpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICBjb25zdCBjc3ZTdHJpbmcgPSBbXG4gICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgXCJfaWRcIixcbiAgICAgICAgICAgICAgICBcImlzUGJcIixcbiAgICAgICAgICAgICAgICBcIndwbVwiLFxuICAgICAgICAgICAgICAgIFwiYWNjXCIsXG4gICAgICAgICAgICAgICAgXCJyYXdXcG1cIixcbiAgICAgICAgICAgICAgICBcImNvbnNpc3RlbmN5XCIsXG4gICAgICAgICAgICAgICAgXCJjaGFyU3RhdHNcIixcbiAgICAgICAgICAgICAgICBcIm1vZGVcIixcbiAgICAgICAgICAgICAgICBcIm1vZGUyXCIsXG4gICAgICAgICAgICAgICAgXCJxdW90ZUxlbmd0aFwiLFxuICAgICAgICAgICAgICAgIFwicmVzdGFydENvdW50XCIsXG4gICAgICAgICAgICAgICAgXCJ0ZXN0RHVyYXRpb25cIixcbiAgICAgICAgICAgICAgICBcImFma0R1cmF0aW9uXCIsXG4gICAgICAgICAgICAgICAgXCJpbmNvbXBsZXRlVGVzdFNlY29uZHNcIixcbiAgICAgICAgICAgICAgICBcInB1bmN0dWF0aW9uXCIsXG4gICAgICAgICAgICAgICAgXCJudW1iZXJzXCIsXG4gICAgICAgICAgICAgICAgXCJsYW5ndWFnZVwiLFxuICAgICAgICAgICAgICAgIFwiZnVuYm94XCIsXG4gICAgICAgICAgICAgICAgXCJkaWZmaWN1bHR5XCIsXG4gICAgICAgICAgICAgICAgXCJsYXp5TW9kZVwiLFxuICAgICAgICAgICAgICAgIFwiYmxpbmRNb2RlXCIsXG4gICAgICAgICAgICAgICAgXCJiYWlsZWRPdXRcIixcbiAgICAgICAgICAgICAgICBcInRhZ3NcIixcbiAgICAgICAgICAgICAgICBcInRpbWVzdGFtcFwiLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIC4uLmFycmF5Lm1hcCgoaXRlbSkgPT4gW1xuICAgICAgICAgICAgICAgIGl0ZW0uX2lkLFxuICAgICAgICAgICAgICAgIGl0ZW0uaXNQYixcbiAgICAgICAgICAgICAgICBpdGVtLndwbSxcbiAgICAgICAgICAgICAgICBpdGVtLmFjYyxcbiAgICAgICAgICAgICAgICBpdGVtLnJhd1dwbSxcbiAgICAgICAgICAgICAgICBpdGVtLmNvbnNpc3RlbmN5LFxuICAgICAgICAgICAgICAgIGl0ZW0uY2hhclN0YXRzLmpvaW4oXCIsXCIpLFxuICAgICAgICAgICAgICAgIGl0ZW0ubW9kZSxcbiAgICAgICAgICAgICAgICBpdGVtLm1vZGUyLFxuICAgICAgICAgICAgICAgIGl0ZW0ucXVvdGVMZW5ndGgsXG4gICAgICAgICAgICAgICAgaXRlbS5yZXN0YXJ0Q291bnQsXG4gICAgICAgICAgICAgICAgaXRlbS50ZXN0RHVyYXRpb24sXG4gICAgICAgICAgICAgICAgaXRlbS5hZmtEdXJhdGlvbixcbiAgICAgICAgICAgICAgICBpdGVtLmluY29tcGxldGVUZXN0U2Vjb25kcyxcbiAgICAgICAgICAgICAgICBpdGVtLnB1bmN0dWF0aW9uLFxuICAgICAgICAgICAgICAgIGl0ZW0ubnVtYmVycyxcbiAgICAgICAgICAgICAgICBpdGVtLmxhbmd1YWdlLFxuICAgICAgICAgICAgICAgIGl0ZW0uZnVuYm94LFxuICAgICAgICAgICAgICAgIGl0ZW0uZGlmZmljdWx0eSxcbiAgICAgICAgICAgICAgICBpdGVtLmxhenlNb2RlLFxuICAgICAgICAgICAgICAgIGl0ZW0uYmxpbmRNb2RlLFxuICAgICAgICAgICAgICAgIGl0ZW0uYmFpbGVkT3V0LFxuICAgICAgICAgICAgICAgIGl0ZW0udGFncy5qb2luKFwiLFwiKSxcbiAgICAgICAgICAgICAgICBpdGVtLnRpbWVzdGFtcCxcbiAgICAgICAgICAgIF0pLFxuICAgICAgICBdXG4gICAgICAgICAgICAubWFwKChlKSA9PiBlLmpvaW4oXCJ8XCIpKVxuICAgICAgICAgICAgLmpvaW4oXCJcXG5cIik7XG4gICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbY3N2U3RyaW5nXSwgeyB0eXBlOiBcInRleHQvY3N2XCIgfSk7XG4gICAgICAgIGNvbnN0IGhyZWYgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xuICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZShcImhyZWZcIiwgaHJlZik7XG4gICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKFwiZG93bmxvYWRcIiwgXCJyZXN1bHRzLmNzdlwiKTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTsgLy8gUmVxdWlyZWQgZm9yIEZGXG4gICAgICAgIGxpbmsuY2xpY2soKTtcbiAgICAgICAgbGluay5yZW1vdmUoKTtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZG93bmxvYWRSZXN1bHRzQ1NWID0gZG93bmxvYWRSZXN1bHRzQ1NWO1xuLyoqXG4gKiBHZXRzIGFuIGludGVnZXIgYmV0d2VlbiBtaW4gYW5kIG1heCwgYm90aCBhcmUgaW5jbHVzaXZlLlxuICogQHBhcmFtIG1pblxuICogQHBhcmFtIG1heFxuICogQHJldHVybnMgUmFuZG9tIGludGVnZXIgYmV0d2VuIG1pbiBhbmQgbWF4LlxuICovXG5mdW5jdGlvbiByYW5kb21JbnRGcm9tUmFuZ2UobWluLCBtYXgpIHtcbiAgICBjb25zdCBtaW5Ob3JtID0gTWF0aC5jZWlsKG1pbik7XG4gICAgY29uc3QgbWF4Tm9ybSA9IE1hdGguZmxvb3IobWF4KTtcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heE5vcm0gLSBtaW5Ob3JtICsgMSkgKyBtaW5Ob3JtKTtcbn1cbmV4cG9ydHMucmFuZG9tSW50RnJvbVJhbmdlID0gcmFuZG9tSW50RnJvbVJhbmdlO1xuLyoqXG4gKiBTaHVmZmxlIGFuIGFycmF5IG9mIGVsZW1lbnRzIHVzaW5nIHRoZSBGaXNoZXLigJNZYXRlcyBhbGdvcml0aG0uXG4gKiBUaGlzIGZ1bmN0aW9uIG11dGF0ZXMgdGhlIGlucHV0IGFycmF5LlxuICogQHBhcmFtIGVsZW1lbnRzXG4gKi9cbmZ1bmN0aW9uIHNodWZmbGUoZWxlbWVudHMpIHtcbiAgICBmb3IgKGxldCBpID0gZWxlbWVudHMubGVuZ3RoIC0gMTsgaSA+IDA7IC0taSkge1xuICAgICAgICBjb25zdCBqID0gcmFuZG9tSW50RnJvbVJhbmdlKDAsIGkpO1xuICAgICAgICBjb25zdCB0ZW1wID0gZWxlbWVudHNbal07XG4gICAgICAgIGVsZW1lbnRzW2pdID0gZWxlbWVudHNbaV07XG4gICAgICAgIGVsZW1lbnRzW2ldID0gdGVtcDtcbiAgICB9XG59XG5leHBvcnRzLnNodWZmbGUgPSBzaHVmZmxlO1xuZnVuY3Rpb24gcmFuZG9tRWxlbWVudEZyb21BcnJheShhcnJheSkge1xuICAgIHJldHVybiBhcnJheVtyYW5kb21JbnRGcm9tUmFuZ2UoMCwgYXJyYXkubGVuZ3RoIC0gMSldO1xufVxuZXhwb3J0cy5yYW5kb21FbGVtZW50RnJvbUFycmF5ID0gcmFuZG9tRWxlbWVudEZyb21BcnJheTtcbmZ1bmN0aW9uIHJhbmRvbUVsZW1lbnRGcm9tT2JqZWN0KG9iamVjdCkge1xuICAgIHJldHVybiByYW5kb21FbGVtZW50RnJvbUFycmF5KE9iamVjdC52YWx1ZXMob2JqZWN0KSk7XG59XG5leHBvcnRzLnJhbmRvbUVsZW1lbnRGcm9tT2JqZWN0ID0gcmFuZG9tRWxlbWVudEZyb21PYmplY3Q7XG5mdW5jdGlvbiBjcmVhdGVFcnJvck1lc3NhZ2UoZXJyb3IsIG1lc3NhZ2UpIHtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcilcbiAgICAgICAgcmV0dXJuIGAke21lc3NhZ2V9OiAke2Vycm9yLm1lc3NhZ2V9YDtcbiAgICByZXR1cm4gYCR7bWVzc2FnZX1gO1xufVxuZXhwb3J0cy5jcmVhdGVFcnJvck1lc3NhZ2UgPSBjcmVhdGVFcnJvck1lc3NhZ2U7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuYnVpbGRTZWFyY2hTZXJ2aWNlID0gdm9pZCAwO1xuY29uc3Qgc3RlbW1lcl8xID0gcmVxdWlyZShcInN0ZW1tZXJcIik7XG5jb25zdCBkYW1lcmF1X2xldmVuc2h0ZWluXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImRhbWVyYXUtbGV2ZW5zaHRlaW5cIikpO1xuY29uc3QgREVGQVVMVF9PUFRJT05TID0ge1xuICAgIGZ1enp5TWF0Y2hTZW5zaXRpdml0eTogMC4yLFxuICAgIHNjb3JlRm9yU2ltaWxhck1hdGNoOiAwLjUsXG4gICAgc2NvcmVGb3JFeGFjdE1hdGNoOiAxLCAvLyBXaGVuIHJhbmtpbmcgcmVzdWx0cywgdGhlIHNjb3JlIGEgbWF0Y2ggZ2V0cyBmb3IgaGF2aW5nIGFuIGV4YWN0IG1hdGNoIHdpdGggYSB0b2tlbiBpbiB0aGUgc2VhcmNoIHF1ZXJ5LlxufTtcbmZ1bmN0aW9uIGludmVyc2VEb2N1bWVudEZyZXF1ZW5jeShudW1iZXJPZkRvY3VtZW50cywgbnVtYmVyT2ZEb2N1bWVudHNXaXRoVGVybSkge1xuICAgIGlmIChudW1iZXJPZkRvY3VtZW50c1dpdGhUZXJtID09PSAwKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICByZXR1cm4gTWF0aC5sb2cxMChudW1iZXJPZkRvY3VtZW50cyAvIG51bWJlck9mRG9jdW1lbnRzV2l0aFRlcm0pO1xufVxuZnVuY3Rpb24gdG9rZW5pemUodGV4dCkge1xuICAgIHJldHVybiB0ZXh0Lm1hdGNoKC9bXlxcXFxcXF1bLixcIi8jIT8kJV4mKjs6e309XFwtX2B+KClcXHNdKy9nKSB8fCBbXTtcbn1cbmNvbnN0IGJ1aWxkU2VhcmNoU2VydmljZSA9IChkb2N1bWVudHMsIGdldFNlYXJjaGFibGVUZXh0LCBvcHRpb25zID0gREVGQVVMVF9PUFRJT05TKSA9PiB7XG4gICAgY29uc3QgcmV2ZXJzZUluZGV4ID0ge307XG4gICAgY29uc3Qgbm9ybWFsaXplZFRva2VuVG9PcmlnaW5hbCA9IHt9O1xuICAgIGRvY3VtZW50cy5mb3JFYWNoKChkb2N1bWVudCwgZG9jdW1lbnRJbmRleCkgPT4ge1xuICAgICAgICBjb25zdCByYXdUb2tlbnMgPSB0b2tlbml6ZShnZXRTZWFyY2hhYmxlVGV4dChkb2N1bWVudCkpO1xuICAgICAgICBjb25zdCBpbnRlcm5hbERvY3VtZW50ID0ge1xuICAgICAgICAgICAgaWQ6IGRvY3VtZW50SW5kZXgsXG4gICAgICAgIH07XG4gICAgICAgIHJhd1Rva2Vucy5mb3JFYWNoKCh0b2tlbikgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3RlbW1lZFRva2VuID0gKDAsIHN0ZW1tZXJfMS5zdGVtbWVyKSh0b2tlbik7XG4gICAgICAgICAgICBpZiAoIShzdGVtbWVkVG9rZW4gaW4gbm9ybWFsaXplZFRva2VuVG9PcmlnaW5hbCkpIHtcbiAgICAgICAgICAgICAgICBub3JtYWxpemVkVG9rZW5Ub09yaWdpbmFsW3N0ZW1tZWRUb2tlbl0gPSBuZXcgU2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBub3JtYWxpemVkVG9rZW5Ub09yaWdpbmFsW3N0ZW1tZWRUb2tlbl0uYWRkKHRva2VuKTtcbiAgICAgICAgICAgIGlmICghKHN0ZW1tZWRUb2tlbiBpbiByZXZlcnNlSW5kZXgpKSB7XG4gICAgICAgICAgICAgICAgcmV2ZXJzZUluZGV4W3N0ZW1tZWRUb2tlbl0gPSBuZXcgU2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXZlcnNlSW5kZXhbc3RlbW1lZFRva2VuXS5hZGQoaW50ZXJuYWxEb2N1bWVudCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGNvbnN0IHRva2VuU2V0ID0gT2JqZWN0LmtleXMocmV2ZXJzZUluZGV4KTtcbiAgICBjb25zdCBxdWVyeSA9IChzZWFyY2hRdWVyeSkgPT4ge1xuICAgICAgICBjb25zdCBzZWFyY2hSZXN1bHQgPSB7XG4gICAgICAgICAgICByZXN1bHRzOiBbXSxcbiAgICAgICAgICAgIG1hdGNoZWRRdWVyeVRlcm1zOiBbXSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3Qgbm9ybWFsaXplZFNlYXJjaFF1ZXJ5ID0gbmV3IFNldCh0b2tlbml6ZShzZWFyY2hRdWVyeSkubWFwKCh0b2tlbikgPT4gKDAsIHN0ZW1tZXJfMS5zdGVtbWVyKSh0b2tlbikpKTtcbiAgICAgICAgaWYgKG5vcm1hbGl6ZWRTZWFyY2hRdWVyeS5zaXplID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gc2VhcmNoUmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSBuZXcgTWFwKCk7XG4gICAgICAgIGNvbnN0IG1hdGNoZWRUb2tlbnMgPSBuZXcgU2V0KCk7XG4gICAgICAgIG5vcm1hbGl6ZWRTZWFyY2hRdWVyeS5mb3JFYWNoKChzZWFyY2hUb2tlbikgPT4ge1xuICAgICAgICAgICAgdG9rZW5TZXQuZm9yRWFjaCgodG9rZW4pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IHNpbWlsYXJpdHkgfSA9ICgwLCBkYW1lcmF1X2xldmVuc2h0ZWluXzEuZGVmYXVsdCkoc2VhcmNoVG9rZW4sIHRva2VuKTtcbiAgICAgICAgICAgICAgICBjb25zdCBtYXRjaGVzU2VhcmNoVG9rZW4gPSB0b2tlbiA9PT0gc2VhcmNoVG9rZW47XG4gICAgICAgICAgICAgICAgY29uc3QgaXNTaW1pbGFyID0gc2ltaWxhcml0eSA+PSAxIC0gb3B0aW9ucy5mdXp6eU1hdGNoU2Vuc2l0aXZpdHk7XG4gICAgICAgICAgICAgICAgaWYgKG1hdGNoZXNTZWFyY2hUb2tlbiB8fCBpc1NpbWlsYXIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZG9jdW1lbnRNYXRjaGVzID0gcmV2ZXJzZUluZGV4W3Rva2VuXTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaWRmID0gaW52ZXJzZURvY3VtZW50RnJlcXVlbmN5KGRvY3VtZW50cy5sZW5ndGgsIGRvY3VtZW50TWF0Y2hlcy5zaXplKTtcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnRNYXRjaGVzLmZvckVhY2goKGRvY3VtZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50U2NvcmUgPSAoX2EgPSByZXN1bHRzLmdldChkb2N1bWVudC5pZCkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzY29yZUZvckV4YWN0TWF0Y2ggPSBtYXRjaGVzU2VhcmNoVG9rZW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IG9wdGlvbnMuc2NvcmVGb3JFeGFjdE1hdGNoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2NvcmVGb3JTaW1pbGFyaXR5ID0gaXNTaW1pbGFyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBvcHRpb25zLnNjb3JlRm9yU2ltaWxhck1hdGNoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2NvcmUgPSBzY29yZUZvckV4YWN0TWF0Y2ggKyBzY29yZUZvclNpbWlsYXJpdHk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzY29yZUZvclRva2VuID0gc2NvcmUgKiBpZGY7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnNldChkb2N1bWVudC5pZCwgY3VycmVudFNjb3JlICsgc2NvcmVGb3JUb2tlbik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBub3JtYWxpemVkVG9rZW5Ub09yaWdpbmFsW3Rva2VuXS5mb3JFYWNoKChvcmlnaW5hbFRva2VuKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVkVG9rZW5zLmFkZChvcmlnaW5hbFRva2VuKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBvcmRlcmVkUmVzdWx0cyA9IFsuLi5yZXN1bHRzXVxuICAgICAgICAgICAgLnNvcnQoKG1hdGNoMSwgbWF0Y2gyKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gbWF0Y2gyWzFdIC0gbWF0Y2gxWzFdO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLm1hcCgobWF0Y2gpID0+IGRvY3VtZW50c1ttYXRjaFswXV0pO1xuICAgICAgICBzZWFyY2hSZXN1bHQucmVzdWx0cyA9IG9yZGVyZWRSZXN1bHRzO1xuICAgICAgICBzZWFyY2hSZXN1bHQubWF0Y2hlZFF1ZXJ5VGVybXMgPSBbLi4ubWF0Y2hlZFRva2Vuc107XG4gICAgICAgIHJldHVybiBzZWFyY2hSZXN1bHQ7XG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgICBxdWVyeSxcbiAgICB9O1xufTtcbmV4cG9ydHMuYnVpbGRTZWFyY2hTZXJ2aWNlID0gYnVpbGRTZWFyY2hTZXJ2aWNlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNwbGl0QnlBbmRLZWVwID0gdm9pZCAwO1xuLyoqXG4gKlxuICogQHBhcmFtIHRleHQgU3RyaW5nIHRvIHNwbGl0XG4gKiBAcGFyYW0gZGVsaW1pdGVycyBTaW5nbGUgY2hhcmFjdGVyIGRlbGltaXRlcnMuXG4gKi9cbmZ1bmN0aW9uIHNwbGl0QnlBbmRLZWVwKHRleHQsIGRlbGltaXRlcnMpIHtcbiAgICBjb25zdCBzcGxpdFN0cmluZyA9IFtdO1xuICAgIGxldCBjdXJyZW50VG9rZW4gPSBbXTtcbiAgICBjb25zdCBkZWxpbWl0ZXJTZXQgPSBuZXcgU2V0KGRlbGltaXRlcnMpO1xuICAgIGZvciAoY29uc3QgY2hhciBvZiB0ZXh0KSB7XG4gICAgICAgIGlmIChkZWxpbWl0ZXJTZXQuaGFzKGNoYXIpKSB7XG4gICAgICAgICAgICBpZiAoY3VycmVudFRva2VuLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBzcGxpdFN0cmluZy5wdXNoKGN1cnJlbnRUb2tlbi5qb2luKFwiXCIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNwbGl0U3RyaW5nLnB1c2goY2hhcik7XG4gICAgICAgICAgICBjdXJyZW50VG9rZW4gPSBbXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGN1cnJlbnRUb2tlbi5wdXNoKGNoYXIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChjdXJyZW50VG9rZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICBzcGxpdFN0cmluZy5wdXNoKGN1cnJlbnRUb2tlbi5qb2luKFwiXCIpKTtcbiAgICB9XG4gICAgcmV0dXJuIHNwbGl0U3RyaW5nO1xufVxuZXhwb3J0cy5zcGxpdEJ5QW5kS2VlcCA9IHNwbGl0QnlBbmRLZWVwO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMubG9hZEN1c3RvbVRoZW1lRnJvbVVybCA9IHZvaWQgMDtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbWlzY1wiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmZ1bmN0aW9uIGxvYWRDdXN0b21UaGVtZUZyb21VcmwoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IGdldFZhbHVlID0gTWlzYy5maW5kR2V0UGFyYW1ldGVyKFwiY3VzdG9tVGhlbWVcIik7XG4gICAgaWYgKGdldFZhbHVlID09PSBudWxsKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgdXJsRW5jb2RlZCA9IGdldFZhbHVlLnNwbGl0KFwiLFwiKTtcbiAgICBsZXQgYmFzZTY0ZGVjb2RlZCA9IG51bGw7XG4gICAgdHJ5IHtcbiAgICAgICAgYmFzZTY0ZGVjb2RlZCA9IEpTT04ucGFyc2UoKF9hID0gYXRvYihnZXRWYWx1ZSkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiXCIpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICAvL1xuICAgIH1cbiAgICBsZXQgY29sb3JBcnJheSA9IFtdO1xuICAgIGlmIChBcnJheS5pc0FycmF5KHVybEVuY29kZWQpICYmIHVybEVuY29kZWQubGVuZ3RoID09PSA5KSB7XG4gICAgICAgIGNvbG9yQXJyYXkgPSB1cmxFbmNvZGVkO1xuICAgIH1cbiAgICBlbHNlIGlmIChBcnJheS5pc0FycmF5KGJhc2U2NGRlY29kZWQpICYmIGJhc2U2NGRlY29kZWQubGVuZ3RoID09PSA5KSB7XG4gICAgICAgIGNvbG9yQXJyYXkgPSBiYXNlNjRkZWNvZGVkO1xuICAgIH1cbiAgICBpZiAoY29sb3JBcnJheS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiSW52YWxpZCBjdXN0b20gdGhlbWUgXCIsIDApO1xuICAgIH1cbiAgICBjb25zdCBvbGRDdXN0b21UaGVtZSA9IGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tVGhlbWU7XG4gICAgY29uc3Qgb2xkQ3VzdG9tVGhlbWVDb2xvcnMgPSBjb25maWdfMS5kZWZhdWx0LmN1c3RvbVRoZW1lQ29sb3JzO1xuICAgIHRyeSB7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZUNvbG9ycyhjb2xvckFycmF5KTtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDdXN0b20gdGhlbWUgYXBwbGllZFwiLCAxKTtcbiAgICAgICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LmN1c3RvbVRoZW1lKVxuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lKHRydWUpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlNvbWV0aGluZyB3ZW50IHdyb25nLiBSZXZlcnRpbmcgdG8gcHJldmlvdXMgc3RhdGUuXCIsIDApO1xuICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWUob2xkQ3VzdG9tVGhlbWUpO1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWVDb2xvcnMob2xkQ3VzdG9tVGhlbWVDb2xvcnMpO1xuICAgIH1cbn1cbmV4cG9ydHMubG9hZEN1c3RvbVRoZW1lRnJvbVVybCA9IGxvYWRDdXN0b21UaGVtZUZyb21Vcmw7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ0xJRU5UX1ZFUlNJT04gPSB2b2lkIDA7XG5leHBvcnRzLkNMSUVOVF9WRVJTSU9OID0gXCJERVZFTE9QTUVOVC1DTElFTlRcIjtcbiQoZG9jdW1lbnQuYm9keSkub24oXCJjbGlja1wiLCBcIi52ZXJzaW9uXCIsIChlKSA9PiB7XG4gICAgaWYgKGUuc2hpZnRLZXkpIHtcbiAgICAgICAgYWxlcnQoZXhwb3J0cy5DTElFTlRfVkVSU0lPTik7XG4gICAgfVxufSk7XG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuLy8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbl9fd2VicGFja19yZXF1aXJlX18ubSA9IF9fd2VicGFja19tb2R1bGVzX187XG5cbiIsInZhciBkZWZlcnJlZCA9IFtdO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5PID0gKHJlc3VsdCwgY2h1bmtJZHMsIGZuLCBwcmlvcml0eSkgPT4ge1xuXHRpZihjaHVua0lkcykge1xuXHRcdHByaW9yaXR5ID0gcHJpb3JpdHkgfHwgMDtcblx0XHRmb3IodmFyIGkgPSBkZWZlcnJlZC5sZW5ndGg7IGkgPiAwICYmIGRlZmVycmVkW2kgLSAxXVsyXSA+IHByaW9yaXR5OyBpLS0pIGRlZmVycmVkW2ldID0gZGVmZXJyZWRbaSAtIDFdO1xuXHRcdGRlZmVycmVkW2ldID0gW2NodW5rSWRzLCBmbiwgcHJpb3JpdHldO1xuXHRcdHJldHVybjtcblx0fVxuXHR2YXIgbm90RnVsZmlsbGVkID0gSW5maW5pdHk7XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgZGVmZXJyZWQubGVuZ3RoOyBpKyspIHtcblx0XHR2YXIgW2NodW5rSWRzLCBmbiwgcHJpb3JpdHldID0gZGVmZXJyZWRbaV07XG5cdFx0dmFyIGZ1bGZpbGxlZCA9IHRydWU7XG5cdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBjaHVua0lkcy5sZW5ndGg7IGorKykge1xuXHRcdFx0aWYgKChwcmlvcml0eSAmIDEgPT09IDAgfHwgbm90RnVsZmlsbGVkID49IHByaW9yaXR5KSAmJiBPYmplY3Qua2V5cyhfX3dlYnBhY2tfcmVxdWlyZV9fLk8pLmV2ZXJ5KChrZXkpID0+IChfX3dlYnBhY2tfcmVxdWlyZV9fLk9ba2V5XShjaHVua0lkc1tqXSkpKSkge1xuXHRcdFx0XHRjaHVua0lkcy5zcGxpY2Uoai0tLCAxKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGZ1bGZpbGxlZCA9IGZhbHNlO1xuXHRcdFx0XHRpZihwcmlvcml0eSA8IG5vdEZ1bGZpbGxlZCkgbm90RnVsZmlsbGVkID0gcHJpb3JpdHk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmKGZ1bGZpbGxlZCkge1xuXHRcdFx0ZGVmZXJyZWQuc3BsaWNlKGktLSwgMSlcblx0XHRcdHZhciByID0gZm4oKTtcblx0XHRcdGlmIChyICE9PSB1bmRlZmluZWQpIHJlc3VsdCA9IHI7XG5cdFx0fVxuXHR9XG5cdHJldHVybiByZXN1bHQ7XG59OyIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uZyA9IChmdW5jdGlvbigpIHtcblx0aWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAnb2JqZWN0JykgcmV0dXJuIGdsb2JhbFRoaXM7XG5cdHRyeSB7XG5cdFx0cmV0dXJuIHRoaXMgfHwgbmV3IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHRpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcpIHJldHVybiB3aW5kb3c7XG5cdH1cbn0pKCk7IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsIi8vIG5vIGJhc2VVUklcblxuLy8gb2JqZWN0IHRvIHN0b3JlIGxvYWRlZCBhbmQgbG9hZGluZyBjaHVua3Ncbi8vIHVuZGVmaW5lZCA9IGNodW5rIG5vdCBsb2FkZWQsIG51bGwgPSBjaHVuayBwcmVsb2FkZWQvcHJlZmV0Y2hlZFxuLy8gW3Jlc29sdmUsIHJlamVjdCwgUHJvbWlzZV0gPSBjaHVuayBsb2FkaW5nLCAwID0gY2h1bmsgbG9hZGVkXG52YXIgaW5zdGFsbGVkQ2h1bmtzID0ge1xuXHRcIm1vbmtleXR5cGVcIjogMFxufTtcblxuLy8gbm8gY2h1bmsgb24gZGVtYW5kIGxvYWRpbmdcblxuLy8gbm8gcHJlZmV0Y2hpbmdcblxuLy8gbm8gcHJlbG9hZGVkXG5cbi8vIG5vIEhNUlxuXG4vLyBubyBITVIgbWFuaWZlc3RcblxuX193ZWJwYWNrX3JlcXVpcmVfXy5PLmogPSAoY2h1bmtJZCkgPT4gKGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9PT0gMCk7XG5cbi8vIGluc3RhbGwgYSBKU09OUCBjYWxsYmFjayBmb3IgY2h1bmsgbG9hZGluZ1xudmFyIHdlYnBhY2tKc29ucENhbGxiYWNrID0gKHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uLCBkYXRhKSA9PiB7XG5cdHZhciBbY2h1bmtJZHMsIG1vcmVNb2R1bGVzLCBydW50aW1lXSA9IGRhdGE7XG5cdC8vIGFkZCBcIm1vcmVNb2R1bGVzXCIgdG8gdGhlIG1vZHVsZXMgb2JqZWN0LFxuXHQvLyB0aGVuIGZsYWcgYWxsIFwiY2h1bmtJZHNcIiBhcyBsb2FkZWQgYW5kIGZpcmUgY2FsbGJhY2tcblx0dmFyIG1vZHVsZUlkLCBjaHVua0lkLCBpID0gMDtcblx0aWYoY2h1bmtJZHMuc29tZSgoaWQpID0+IChpbnN0YWxsZWRDaHVua3NbaWRdICE9PSAwKSkpIHtcblx0XHRmb3IobW9kdWxlSWQgaW4gbW9yZU1vZHVsZXMpIHtcblx0XHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhtb3JlTW9kdWxlcywgbW9kdWxlSWQpKSB7XG5cdFx0XHRcdF9fd2VicGFja19yZXF1aXJlX18ubVttb2R1bGVJZF0gPSBtb3JlTW9kdWxlc1ttb2R1bGVJZF07XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmKHJ1bnRpbWUpIHZhciByZXN1bHQgPSBydW50aW1lKF9fd2VicGFja19yZXF1aXJlX18pO1xuXHR9XG5cdGlmKHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uKSBwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbihkYXRhKTtcblx0Zm9yKDtpIDwgY2h1bmtJZHMubGVuZ3RoOyBpKyspIHtcblx0XHRjaHVua0lkID0gY2h1bmtJZHNbaV07XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGluc3RhbGxlZENodW5rcywgY2h1bmtJZCkgJiYgaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdKSB7XG5cdFx0XHRpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF1bMF0oKTtcblx0XHR9XG5cdFx0aW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID0gMDtcblx0fVxuXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXy5PKHJlc3VsdCk7XG59XG5cbnZhciBjaHVua0xvYWRpbmdHbG9iYWwgPSBzZWxmW1wid2VicGFja0NodW5rbW9ua2V5dHlwZV9mcm9udGVuZFwiXSA9IHNlbGZbXCJ3ZWJwYWNrQ2h1bmttb25rZXl0eXBlX2Zyb250ZW5kXCJdIHx8IFtdO1xuY2h1bmtMb2FkaW5nR2xvYmFsLmZvckVhY2god2VicGFja0pzb25wQ2FsbGJhY2suYmluZChudWxsLCAwKSk7XG5jaHVua0xvYWRpbmdHbG9iYWwucHVzaCA9IHdlYnBhY2tKc29ucENhbGxiYWNrLmJpbmQobnVsbCwgY2h1bmtMb2FkaW5nR2xvYmFsLnB1c2guYmluZChjaHVua0xvYWRpbmdHbG9iYWwpKTsiLCIiLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGRlcGVuZHMgb24gb3RoZXIgbG9hZGVkIGNodW5rcyBhbmQgZXhlY3V0aW9uIG5lZWQgdG8gYmUgZGVsYXllZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fLk8odW5kZWZpbmVkLCBbXCJ2ZW5kb3JcIl0sICgpID0+IChfX3dlYnBhY2tfcmVxdWlyZV9fKFwiLi9zcmMvc2NyaXB0cy9pbmRleC50c1wiKSkpXG5fX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXy5PKF9fd2VicGFja19leHBvcnRzX18pO1xuIiwiIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9
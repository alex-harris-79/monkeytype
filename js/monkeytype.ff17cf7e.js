/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/styles/index.scss":
/*!*******************************!*\
  !*** ./src/styles/index.scss ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/scripts/account/all-time-stats.ts":
/*!***********************************************!*\
  !*** ./src/scripts/account/all-time-stats.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = exports.clear = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
function clear() {
    $(".pageAccount .globalTimeTyping .val").text(`-`);
    $(".pageAccount .globalTestsStarted .val").text(`-`);
    $(".pageAccount .globalTestsCompleted .val").text(`-`);
}
exports.clear = clear;
function update() {
    var _a, _b;
    const snapshot = DB.getSnapshot();
    if (snapshot.globalStats !== undefined) {
        // let th = Math.floor(DB.getSnapshot().globalStats.time / 3600);
        // let tm = Math.floor((DB.getSnapshot().globalStats.time % 3600) / 60);
        // let ts = Math.floor((DB.getSnapshot().globalStats.time % 3600) % 60);
        const seconds = (_b = (_a = snapshot === null || snapshot === void 0 ? void 0 : snapshot.globalStats) === null || _a === void 0 ? void 0 : _a.time) !== null && _b !== void 0 ? _b : 0;
        let string = "";
        if (seconds === 0) {
            string = "-";
        }
        else {
            string = Misc.secondsToString(Math.round(seconds), true, true);
        }
        $(".pageAccount .globalTimeTyping .val").text(string);
    }
    if (snapshot.globalStats !== undefined) {
        $(".pageAccount .globalTestsStarted .val").text(snapshot.globalStats.started);
    }
    if (snapshot.globalStats !== undefined) {
        $(".pageAccount .globalTestsCompleted .val").text(snapshot.globalStats.completed);
    }
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/account/mini-result-chart.ts":
/*!**************************************************!*\
  !*** ./src/scripts/account/mini-result-chart.ts ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateData = exports.show = exports.updatePosition = void 0;
const ChartController = __importStar(__webpack_require__(/*! ../controllers/chart-controller */ "./src/scripts/controllers/chart-controller.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const miniResultScaleOptions = ChartController.result.options.scales;
function updatePosition(x, y) {
    $(".pageAccount .miniResultChartWrapper").css({ top: y, left: x });
}
exports.updatePosition = updatePosition;
function show() {
    $(".pageAccount .miniResultChartWrapper").stop(true, true).fadeIn(125);
    $(".pageAccount .miniResultChartBg").stop(true, true).fadeIn(125);
}
exports.show = show;
function hide() {
    $(".pageAccount .miniResultChartWrapper").stop(true, true).fadeOut(125);
    $(".pageAccount .miniResultChartBg").stop(true, true).fadeOut(125);
}
function updateData(data) {
    // let data = filteredResults[filteredId].chartData;
    const labels = [];
    for (let i = 1; i <= data.wpm.length; i++) {
        labels.push(i.toString());
    }
    ChartController.miniResult.data.labels = labels;
    ChartController.miniResult.data.datasets[0].data = data.wpm;
    ChartController.miniResult.data.datasets[1].data = data.raw;
    ChartController.miniResult.data.datasets[2].data = data.err;
    const maxChartVal = Math.max(...[Math.max(...data.wpm), Math.max(...data.raw)]);
    const minChartVal = Math.min(...[Math.min(...data.wpm), Math.min(...data.raw)]);
    miniResultScaleOptions["wpm"].max = Math.round(maxChartVal);
    miniResultScaleOptions["raw"].max = Math.round(maxChartVal);
    if (!config_1.default.startGraphsAtZero) {
        miniResultScaleOptions["wpm"].min = Math.round(minChartVal);
        miniResultScaleOptions["raw"].min = Math.round(minChartVal);
    }
    else {
        miniResultScaleOptions["wpm"].min = 0;
        miniResultScaleOptions["raw"].min = 0;
    }
    ChartController.miniResult.updateColors();
}
exports.updateData = updateData;
$(document).on("click", ".pageAccount .miniResultChartBg", () => {
    hide();
});


/***/ }),

/***/ "./src/scripts/account/pb-tables.ts":
/*!******************************************!*\
  !*** ./src/scripts/account/pb-tables.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
function update() {
    $(".pageAccount .timePbTable tbody").html(`
  <tr>
    <td>15</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>30</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>60</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>120</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  `);
    $(".pageAccount .wordsPbTable tbody").html(`
  <tr>
    <td>10</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>25</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>50</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>100</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
    <td>-</td>
  </tr>
  `);
    if (config_1.default.alwaysShowCPM) {
        $(".pageAccount .timePbTable thead tr td:nth-child(2), .pageAccount .wordsPbTable thead tr td:nth-child(2)").html('cpm<br><span class="sub">accuracy</span>');
    }
    else {
        $(".pageAccount .timePbTable thead tr td:nth-child(2), .pageAccount .wordsPbTable thead tr td:nth-child(2)").html('wpm<br><span class="sub">accuracy</span>');
    }
    const pb = DB.getSnapshot().personalBests;
    if (pb === undefined)
        return;
    let pbData;
    let text;
    let dateText = `-<br><span class="sub">-</span>`;
    const multiplier = config_1.default.alwaysShowCPM ? 5 : 1;
    text = "";
    try {
        pbData = pb.time[15].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>15</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>15</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.time[30].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
    <td>30</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>30</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.time[60].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>60</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>60</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.time[120].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>120</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>120</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    $(".pageAccount .timePbTable tbody").html(text);
    text = "";
    try {
        pbData = pb.words[10].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>10</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>10</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.words[25].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>25</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>25</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.words[50].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>50</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>50</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    try {
        pbData = pb.words[100].sort((a, b) => b.wpm - a.wpm)[0];
        dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pbData.timestamp);
        if (pbData.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        text += `<tr>
      <td>100</td>
      <td>${Misc.roundTo2(pbData.wpm * multiplier)}<br><span class="sub">${pbData.acc === undefined ? "-" : pbData.acc + "%"}</span></td>
      <td>${Misc.roundTo2(pbData.raw * multiplier)}<br><span class="sub">${pbData.consistency === undefined ? "-" : pbData.consistency + "%"}</span></td>
      <td>${dateText}</td>
    </tr>`;
    }
    catch (e) {
        text += `<tr>
      <td>100</td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
      <td>-<br><span class="sub">-</span></td>
    </tr>`;
    }
    $(".pageAccount .wordsPbTable tbody").html(text);
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/account/result-filters.ts":
/*!***********************************************!*\
  !*** ./src/scripts/account/result-filters.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateTags = exports.toggle = exports.updateActive = exports.reset = exports.loadTags = exports.getFilter = exports.getGroup = exports.getFilters = exports.load = exports.filters = exports.defaultResultFilters = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
exports.defaultResultFilters = {
    difficulty: {
        normal: true,
        expert: true,
        master: true,
    },
    mode: {
        words: true,
        time: true,
        quote: true,
        zen: true,
        custom: true,
    },
    words: {
        10: true,
        25: true,
        50: true,
        100: true,
        custom: true,
    },
    time: {
        15: true,
        30: true,
        60: true,
        120: true,
        custom: true,
    },
    quoteLength: {
        short: true,
        medium: true,
        long: true,
        thicc: true,
    },
    punctuation: {
        on: true,
        off: true,
    },
    numbers: {
        on: true,
        off: true,
    },
    date: {
        last_day: false,
        last_week: false,
        last_month: false,
        last_3months: false,
        all: true,
    },
    tags: {
        none: true,
    },
    language: {},
    funbox: {
        none: true,
    },
};
exports.filters = exports.defaultResultFilters;
function save() {
    window.localStorage.setItem("resultFilters", JSON.stringify(exports.filters));
}
function load() {
    console.log("loading filters");
    try {
        const newResultFilters = window.localStorage.getItem("resultFilters");
        if (newResultFilters != undefined &&
            newResultFilters !== "" &&
            Object.keys(JSON.parse(newResultFilters)).length >=
                Object.keys(exports.defaultResultFilters).length) {
            exports.filters = JSON.parse(newResultFilters);
            // save();
        }
        else {
            exports.filters = exports.defaultResultFilters;
            // save();
        }
        const newTags = { none: false };
        Object.keys(exports.defaultResultFilters.tags).forEach((tag) => {
            if (exports.filters.tags[tag] !== undefined) {
                newTags[tag] = exports.filters.tags[tag];
            }
            else {
                newTags[tag] = true;
            }
        });
        exports.filters.tags = newTags;
        save();
    }
    catch (_a) {
        console.log("error in loading result filters");
        exports.filters = exports.defaultResultFilters;
        save();
    }
}
exports.load = load;
function getFilters() {
    return exports.filters;
}
exports.getFilters = getFilters;
function getGroup(group) {
    return exports.filters[group];
}
exports.getGroup = getGroup;
// export function setFilter(group, filter, value) {
//   filters[group][filter] = value;
// }
function getFilter(group, filter) {
    return exports.filters[group][filter];
}
exports.getFilter = getFilter;
// export function toggleFilter(group, filter) {
//   filters[group][filter] = !filters[group][filter];
// }
function loadTags(tags) {
    console.log("loading tags");
    tags.forEach((tag) => {
        exports.defaultResultFilters.tags[tag._id] = true;
    });
}
exports.loadTags = loadTags;
function reset() {
    exports.filters = exports.defaultResultFilters;
    save();
}
exports.reset = reset;
function updateActive() {
    var _a, _b, _c, _d;
    const aboveChartDisplay = {};
    Object.keys(getFilters()).forEach((group) => {
        aboveChartDisplay[group] = {
            all: true,
            array: [],
        };
        Object.keys(getGroup(group)).forEach((filter) => {
            var _a;
            const groupAboveChartDisplay = aboveChartDisplay[group];
            if (groupAboveChartDisplay === undefined)
                return;
            if (getFilter(group, filter)) {
                (_a = groupAboveChartDisplay["array"]) === null || _a === void 0 ? void 0 : _a.push(filter);
            }
            else {
                if (groupAboveChartDisplay["all"] !== undefined) {
                    groupAboveChartDisplay["all"] = false;
                }
            }
            let buttonEl;
            if (group === "date") {
                buttonEl = $(`.pageAccount .group.topFilters .filterGroup[group="${group}"] .button[filter="${filter}"]`);
            }
            else {
                buttonEl = $(`.pageAccount .group.filterButtons .filterGroup[group="${group}"] .button[filter="${filter}"]`);
            }
            if (getFilter(group, filter)) {
                buttonEl.addClass("active");
            }
            else {
                buttonEl.removeClass("active");
            }
        });
    });
    function addText(group) {
        var _a, _b, _c, _d, _e;
        let ret = "";
        ret += "<div class='group'>";
        if (group == "difficulty") {
            ret += `<span aria-label="Difficulty" data-balloon-pos="up"><i class="fas fa-fw fa-star"></i>`;
        }
        else if (group == "mode") {
            ret += `<span aria-label="Mode" data-balloon-pos="up"><i class="fas fa-fw fa-bars"></i>`;
        }
        else if (group == "punctuation") {
            ret += `<span aria-label="Punctuation" data-balloon-pos="up"><span class="punc" style="font-weight: 900;
      width: 1.25rem;
      text-align: center;
      display: inline-block;
      letter-spacing: -.1rem;">!?</span>`;
        }
        else if (group == "numbers") {
            ret += `<span aria-label="Numbers" data-balloon-pos="up"><span class="numbers" style="font-weight: 900;
        width: 1.25rem;
        text-align: center;
        margin-right: .1rem;
        display: inline-block;
        letter-spacing: -.1rem;">15</span>`;
        }
        else if (group == "words") {
            ret += `<span aria-label="Words" data-balloon-pos="up"><i class="fas fa-fw fa-font"></i>`;
        }
        else if (group == "time") {
            ret += `<span aria-label="Time" data-balloon-pos="up"><i class="fas fa-fw fa-clock"></i>`;
        }
        else if (group == "date") {
            ret += `<span aria-label="Date" data-balloon-pos="up"><i class="fas fa-fw fa-calendar"></i>`;
        }
        else if (group == "tags") {
            ret += `<span aria-label="Tags" data-balloon-pos="up"><i class="fas fa-fw fa-tags"></i>`;
        }
        else if (group == "language") {
            ret += `<span aria-label="Language" data-balloon-pos="up"><i class="fas fa-fw fa-globe-americas"></i>`;
        }
        else if (group == "funbox") {
            ret += `<span aria-label="Funbox" data-balloon-pos="up"><i class="fas fa-fw fa-gamepad"></i>`;
        }
        if ((_a = aboveChartDisplay[group]) === null || _a === void 0 ? void 0 : _a.all) {
            ret += "all";
        }
        else {
            if (group === "tags") {
                ret += (_c = (_b = aboveChartDisplay.tags) === null || _b === void 0 ? void 0 : _b.array) === null || _c === void 0 ? void 0 : _c.map((id) => {
                    var _a, _b;
                    if (id == "none")
                        return id;
                    const snapshot = DB.getSnapshot();
                    const name = (_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.filter((t) => t._id == id)[0];
                    if (name !== undefined) {
                        return (_b = snapshot.tags) === null || _b === void 0 ? void 0 : _b.filter((t) => t._id == id)[0].name;
                    }
                    return name;
                }).join(", ");
            }
            else {
                ret += (_e = (_d = aboveChartDisplay[group]) === null || _d === void 0 ? void 0 : _d.array) === null || _e === void 0 ? void 0 : _e.join(", ").replace(/_/g, " ");
            }
        }
        ret += "</span></div>";
        return ret;
    }
    let chartString = "";
    //date
    chartString += addText("date");
    chartString += `<div class="spacer"></div>`;
    //mode
    chartString += addText("mode");
    chartString += `<div class="spacer"></div>`;
    //time
    if ((_b = (_a = aboveChartDisplay.mode) === null || _a === void 0 ? void 0 : _a.array) === null || _b === void 0 ? void 0 : _b.includes("time")) {
        chartString += addText("time");
        chartString += `<div class="spacer"></div>`;
    }
    //words
    if ((_d = (_c = aboveChartDisplay.mode) === null || _c === void 0 ? void 0 : _c.array) === null || _d === void 0 ? void 0 : _d.includes("words")) {
        chartString += addText("words");
        chartString += `<div class="spacer"></div>`;
    }
    //diff
    chartString += addText("difficulty");
    chartString += `<div class="spacer"></div>`;
    //punc
    chartString += addText("punctuation");
    chartString += `<div class="spacer"></div>`;
    //numbers
    chartString += addText("numbers");
    chartString += `<div class="spacer"></div>`;
    //language
    chartString += addText("language");
    chartString += `<div class="spacer"></div>`;
    //funbox
    chartString += addText("funbox");
    chartString += `<div class="spacer"></div>`;
    //tags
    chartString += addText("tags");
    setTimeout(() => {
        $(".pageAccount .group.chart .above").html(chartString);
    }, 0);
}
exports.updateActive = updateActive;
function toggle(group, filter) {
    try {
        if (group === "date") {
            Object.keys(getGroup("date")).forEach((date) => {
                exports.filters["date"][date] = false;
            });
        }
        exports.filters[group][filter] = !exports.filters[group][filter];
        save();
    }
    catch (e) {
        Notifications.add("Something went wrong toggling filter. Reverting to defaults.", 0);
        console.log("toggling filter error");
        console.error(e);
        reset();
        updateActive();
    }
}
exports.toggle = toggle;
function updateTags() {
    var _a, _b;
    $(".pageAccount .content .filterButtons .buttonsAndTitle.tags .buttons").empty();
    const snapshot = DB.getSnapshot();
    if (((_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.length) || 0 > 0) {
        $(".pageAccount .content .filterButtons .buttonsAndTitle.tags").removeClass("hidden");
        $(".pageAccount .content .filterButtons .buttonsAndTitle.tags .buttons").append(`<div class="button" filter="none">no tag</div>`);
        (_b = snapshot.tags) === null || _b === void 0 ? void 0 : _b.forEach((tag) => {
            $(".pageAccount .content .filterButtons .buttonsAndTitle.tags .buttons").append(`<div class="button" filter="${tag._id}">${tag.name}</div>`);
        });
    }
    else {
        $(".pageAccount .content .filterButtons .buttonsAndTitle.tags").addClass("hidden");
    }
}
exports.updateTags = updateTags;
$(".pageAccount .filterButtons .buttonsAndTitle .buttons, .pageAccount .group.topFilters .buttonsAndTitle.testDate .buttons").on("click", ".button", (e) => {
    const group = $(e.target)
        .parents(".buttons")
        .attr("group");
    const filter = $(e.target).attr("filter");
    if ($(e.target).hasClass("allFilters")) {
        Object.keys(getFilters()).forEach((group) => {
            Object.keys(getGroup(group)).forEach((filter) => {
                if (group === "date") {
                    // TODO figure out why "filter" is never
                    // @ts-ignore
                    exports.filters[group][filter] = false;
                }
                else if (exports.filters[group] !== undefined) {
                    // @ts-ignore
                    exports.filters[group][filter] = true;
                }
            });
        });
        exports.filters.date.all = true;
    }
    else if ($(e.target).hasClass("noFilters")) {
        Object.keys(getFilters()).forEach((group) => {
            if (group !== "date") {
                Object.keys(getGroup(group)).forEach((filter) => {
                    // TODO figure out why "filter" is never
                    // @ts-ignore
                    exports.filters[group][filter] = false;
                });
            }
        });
    }
    else if ($(e.target).hasClass("button")) {
        if (e.shiftKey) {
            Object.keys(getGroup(group)).forEach((filter) => {
                // TODO figure out why "filter" is never
                // @ts-ignore
                exports.filters[group][filter] = false;
            });
            // TODO figure out why "filter" is never
            // @ts-ignore
            exports.filters[group][filter] = true;
        }
        else {
            toggle(group, filter);
            // filters[group][filter] = !filters[group][filter];
        }
    }
    updateActive();
    save();
});
$(".pageAccount .topFilters .button.allFilters").on("click", () => {
    Object.keys(getFilters()).forEach((group) => {
        Object.keys(getGroup(group)).forEach((filter) => {
            if (group === "date") {
                // TODO figure out why "filter" is never
                // @ts-ignore
                exports.filters[group][filter] = false;
            }
            else {
                // TODO figure out why "filter" is never
                // @ts-ignore
                exports.filters[group][filter] = true;
            }
        });
    });
    exports.filters.date.all = true;
    updateActive();
    save();
});
$(".pageAccount .topFilters .button.currentConfigFilter").on("click", () => {
    var _a;
    Object.keys(getFilters()).forEach((group) => {
        Object.keys(getGroup(group)).forEach((filter) => {
            // TODO figure out why "filter" is never
            // @ts-ignore
            exports.filters[group][filter] = false;
        });
    });
    exports.filters["difficulty"][config_1.default.difficulty] = true;
    exports.filters["mode"][config_1.default.mode] = true;
    if (config_1.default.mode === "time") {
        if ([15, 30, 60, 120].includes(config_1.default.time)) {
            const configTime = config_1.default.time;
            exports.filters["time"][configTime] = true;
        }
        else {
            exports.filters.time.custom = true;
        }
    }
    else if (config_1.default.mode === "words") {
        if ([10, 25, 50, 100, 200].includes(config_1.default.words)) {
            const configWords = config_1.default.words;
            exports.filters["words"][configWords] = true;
        }
        else {
            exports.filters.words.custom = true;
        }
    }
    else if (config_1.default.mode === "quote") {
        const filterName = [
            "short",
            "medium",
            "long",
            "thicc",
        ];
        filterName.forEach((ql, index) => {
            if (config_1.default.quoteLength.includes(index)) {
                exports.filters["quoteLength"][ql] = true;
            }
            else {
                exports.filters["quoteLength"][ql] = false;
            }
        });
    }
    if (config_1.default.punctuation) {
        exports.filters.punctuation.on = true;
    }
    else {
        exports.filters.punctuation.off = true;
    }
    if (config_1.default.numbers) {
        exports.filters.numbers.on = true;
    }
    else {
        exports.filters.numbers.off = true;
    }
    if (config_1.default.mode === "quote" && /english.*/.test(config_1.default.language)) {
        exports.filters.language.english = true;
    }
    else {
        exports.filters["language"][config_1.default.language] = true;
    }
    if (config_1.default.funbox === "none") {
        exports.filters.funbox.none = true;
    }
    else {
        exports.filters.funbox[config_1.default.funbox] = true;
    }
    exports.filters.tags.none = true;
    (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
        if (tag.active === true) {
            exports.filters.tags.none = false;
            exports.filters["tags"][tag._id] = true;
        }
    });
    exports.filters.date.all = true;
    updateActive();
    save();
});
$(".pageAccount .topFilters .button.toggleAdvancedFilters").on("click", () => {
    $(".pageAccount .filterButtons").slideToggle(250);
    $(".pageAccount .topFilters .button.toggleAdvancedFilters").toggleClass("active");
});
Misc.getLanguageList().then((languages) => {
    languages.forEach((language) => {
        $(".pageAccount .content .filterButtons .buttonsAndTitle.languages .buttons").append(`<div class="button" filter="${language}">${language.replace("_", " ")}</div>`);
    });
});
$(".pageAccount .content .filterButtons .buttonsAndTitle.funbox .buttons").append(`<div class="button" filter="none">none</div>`);
Misc.getFunboxList().then((funboxModes) => {
    funboxModes.forEach((funbox) => {
        $(".pageAccount .content .filterButtons .buttonsAndTitle.funbox .buttons").append(`<div class="button" filter="${funbox.name}">${funbox.name.replace(/_/g, " ")}</div>`);
    });
});


/***/ }),

/***/ "./src/scripts/account/sign-out-button.ts":
/*!************************************************!*\
  !*** ./src/scripts/account/sign-out-button.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
function show() {
    // $(".signOut").removeClass("hidden").css("opacity", 1);
    $(".signOut")
        .stop(true, true)
        .removeClass("hidden")
        .css({
        opacity: 0,
        transition: "0s",
    })
        .animate({
        opacity: 1,
    }, 125, () => {
        $(".signOut").css({ transition: "0.25s" });
    });
}
exports.show = show;
function hide() {
    $(".signOut")
        .stop(true, true)
        .css({
        opacity: 1,
        transition: "0s",
    })
        .animate({
        opacity: 0,
    }, 125, () => {
        $(".signOut").css({ transition: "0.25s" });
        $(".signOut").addClass("hidden");
    });
    // $(".signOut").css("opacity", 0).addClass("hidden");
}
exports.hide = hide;
// $("#liveWpm").removeClass("hidden").css("opacity", 0).animate(
//   {
//     opacity: Config.timerOpacity,
//   },
//   125
// );


/***/ }),

/***/ "./src/scripts/ape/endpoints/ape-keys.ts":
/*!***********************************************!*\
  !*** ./src/scripts/ape/endpoints/ape-keys.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/ape-keys";
function getApeKeysEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function generate(name, enabled) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = { name, enabled };
            return yield apeClient.post(BASE_PATH, { payload });
        });
    }
    function update(apeKeyId, updates) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = Object.assign({}, updates);
            return yield apeClient.patch(`${BASE_PATH}/${apeKeyId}`, { payload });
        });
    }
    function _delete(apeKeyId) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(`${BASE_PATH}/${apeKeyId}`);
        });
    }
    return {
        get,
        generate,
        update,
        delete: _delete,
    };
}
exports["default"] = getApeKeysEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/configs.ts":
/*!**********************************************!*\
  !*** ./src/scripts/ape/endpoints/configs.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/configs";
function getConfigsEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function save(config) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.patch(BASE_PATH, { payload: { config } });
        });
    }
    return {
        get,
        save,
    };
}
exports["default"] = getConfigsEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/index.ts":
/*!********************************************!*\
  !*** ./src/scripts/ape/endpoints/index.ts ***!
  \********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const configs_1 = __importDefault(__webpack_require__(/*! ./configs */ "./src/scripts/ape/endpoints/configs.ts"));
const leaderboards_1 = __importDefault(__webpack_require__(/*! ./leaderboards */ "./src/scripts/ape/endpoints/leaderboards.ts"));
const presets_1 = __importDefault(__webpack_require__(/*! ./presets */ "./src/scripts/ape/endpoints/presets.ts"));
const psas_1 = __importDefault(__webpack_require__(/*! ./psas */ "./src/scripts/ape/endpoints/psas.ts"));
const quotes_1 = __importDefault(__webpack_require__(/*! ./quotes */ "./src/scripts/ape/endpoints/quotes.ts"));
const results_1 = __importDefault(__webpack_require__(/*! ./results */ "./src/scripts/ape/endpoints/results.ts"));
const users_1 = __importDefault(__webpack_require__(/*! ./users */ "./src/scripts/ape/endpoints/users.ts"));
const ape_keys_1 = __importDefault(__webpack_require__(/*! ./ape-keys */ "./src/scripts/ape/endpoints/ape-keys.ts"));
exports["default"] = {
    getConfigsEndpoints: configs_1.default,
    getLeaderboardsEndpoints: leaderboards_1.default,
    getPresetsEndpoints: presets_1.default,
    getPsasEndpoints: psas_1.default,
    getQuotesEndpoints: quotes_1.default,
    getResultsEndpoints: results_1.default,
    getUsersEndpoints: users_1.default,
    getApeKeysEndpoints: ape_keys_1.default,
};


/***/ }),

/***/ "./src/scripts/ape/endpoints/leaderboards.ts":
/*!***************************************************!*\
  !*** ./src/scripts/ape/endpoints/leaderboards.ts ***!
  \***************************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/leaderboards";
function getLeaderboardsEndpoints(apeClient) {
    function get(language, mode, mode2, skip = 0, limit = 50) {
        return __awaiter(this, void 0, void 0, function* () {
            const searchQuery = {
                language,
                mode,
                mode2,
                skip,
                limit: Math.max(Math.min(limit, 50), 0),
            };
            return yield apeClient.get(BASE_PATH, { searchQuery });
        });
    }
    function getRank(language, mode, mode2) {
        return __awaiter(this, void 0, void 0, function* () {
            const searchQuery = {
                language,
                mode,
                mode2,
            };
            return yield apeClient.get(`${BASE_PATH}/rank`, { searchQuery });
        });
    }
    return { get, getRank };
}
exports["default"] = getLeaderboardsEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/presets.ts":
/*!**********************************************!*\
  !*** ./src/scripts/ape/endpoints/presets.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/presets";
function getPresetsEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function add(presetName, configChanges) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                name: presetName,
                config: configChanges,
            };
            return yield apeClient.post(BASE_PATH, { payload });
        });
    }
    function edit(presetId, presetName, configChanges) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                _id: presetId,
                name: presetName,
                config: configChanges,
            };
            return yield apeClient.patch(BASE_PATH, { payload });
        });
    }
    function _delete(presetId) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(`${BASE_PATH}/${presetId}`);
        });
    }
    return { get, add, edit, delete: _delete };
}
exports["default"] = getPresetsEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/psas.ts":
/*!*******************************************!*\
  !*** ./src/scripts/ape/endpoints/psas.ts ***!
  \*******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const version_1 = __webpack_require__(/*! ../../version */ "./src/scripts/version.ts");
const BASE_PATH = "/psas";
function getPsasEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH, {
                headers: {
                    "Client-Version": version_1.CLIENT_VERSION,
                },
            });
        });
    }
    return { get };
}
exports["default"] = getPsasEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/quotes.ts":
/*!*********************************************!*\
  !*** ./src/scripts/ape/endpoints/quotes.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/quotes";
function getQuotesEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function submit(text, source, language, captcha) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                text,
                source,
                language,
                captcha,
            };
            return yield apeClient.post(BASE_PATH, { payload });
        });
    }
    function approveSubmission(quoteSubmissionId, editText, editSource) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                quoteId: quoteSubmissionId,
                editText,
                editSource,
            };
            return yield apeClient.post(`${BASE_PATH}/approve`, { payload });
        });
    }
    function rejectSubmission(quoteSubmissionId) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.post(`${BASE_PATH}/reject`, {
                payload: { quoteId: quoteSubmissionId },
            });
        });
    }
    function getRating(quote) {
        return __awaiter(this, void 0, void 0, function* () {
            const searchQuery = {
                quoteId: quote.id,
                language: quote.language,
            };
            return yield apeClient.get(`${BASE_PATH}/rating`, { searchQuery });
        });
    }
    function addRating(quote, rating) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                quoteId: quote.id,
                rating,
                language: quote.language,
            };
            return yield apeClient.post(`${BASE_PATH}/rating`, { payload });
        });
    }
    function report(quoteId, quoteLanguage, reason, comment, captcha) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                quoteId,
                quoteLanguage,
                reason,
                comment,
                captcha,
            };
            return yield apeClient.post(`${BASE_PATH}/report`, { payload });
        });
    }
    return {
        get,
        submit,
        approveSubmission,
        rejectSubmission,
        getRating,
        addRating,
        report,
    };
}
exports["default"] = getQuotesEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/results.ts":
/*!**********************************************!*\
  !*** ./src/scripts/ape/endpoints/results.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const version_1 = __webpack_require__(/*! ../../version */ "./src/scripts/version.ts");
const BASE_PATH = "/results";
function getResultsEndpoints(apeClient) {
    function get() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function save(result) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.post(BASE_PATH, {
                payload: { result },
                headers: { "Client-Version": version_1.CLIENT_VERSION },
            });
        });
    }
    function updateTags(resultId, tagIds) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.patch(`${BASE_PATH}/tags`, {
                payload: { resultId, tagIds },
            });
        });
    }
    function deleteAll() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(BASE_PATH);
        });
    }
    return { get, save, updateTags, deleteAll };
}
exports["default"] = getResultsEndpoints;


/***/ }),

/***/ "./src/scripts/ape/endpoints/users.ts":
/*!********************************************!*\
  !*** ./src/scripts/ape/endpoints/users.ts ***!
  \********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const BASE_PATH = "/users";
function getUsersEndpoints(apeClient) {
    function getData() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(BASE_PATH);
        });
    }
    function create(name, email, uid) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                email,
                name,
                uid,
            };
            return yield apeClient.post(`${BASE_PATH}/signup`, { payload });
        });
    }
    function getNameAvailability(name) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(`${BASE_PATH}/checkName/${name}`);
        });
    }
    function _delete() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(BASE_PATH);
        });
    }
    function updateName(name) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.patch(`${BASE_PATH}/name`, { payload: { name } });
        });
    }
    function updateLeaderboardMemory(mode, mode2, language, rank) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                mode,
                mode2,
                language,
                rank,
            };
            return yield apeClient.patch(`${BASE_PATH}/leaderboardMemory`, { payload });
        });
    }
    function updateEmail(newEmail, previousEmail) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                newEmail,
                previousEmail,
            };
            return yield apeClient.patch(`${BASE_PATH}/email`, { payload });
        });
    }
    function deletePersonalBests() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(`${BASE_PATH}/personalBests`);
        });
    }
    function getTags() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(`${BASE_PATH}/tags`);
        });
    }
    function createTag(tagName) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.post(`${BASE_PATH}/tags`, { payload: { tagName } });
        });
    }
    function editTag(tagId, newName) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                tagId,
                newName,
            };
            return yield apeClient.patch(`${BASE_PATH}/tags`, { payload });
        });
    }
    function deleteTag(tagId) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(`${BASE_PATH}/tags/${tagId}`);
        });
    }
    function deleteTagPersonalBest(tagId) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.delete(`${BASE_PATH}/tags/${tagId}/personalBest`);
        });
    }
    function getCustomThemes() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.get(`${BASE_PATH}/customThemes`);
        });
    }
    function editCustomTheme(themeId, newTheme) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                themeId: themeId,
                theme: {
                    name: newTheme.name,
                    colors: newTheme.colors,
                },
            };
            return yield apeClient.patch(`${BASE_PATH}/customThemes`, { payload });
        });
    }
    function deleteCustomTheme(themeId) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = {
                themeId: themeId,
            };
            return yield apeClient.delete(`${BASE_PATH}/customThemes`, { payload });
        });
    }
    function addCustomTheme(newTheme) {
        return __awaiter(this, void 0, void 0, function* () {
            const payload = { name: newTheme.name, colors: newTheme.colors };
            return yield apeClient.post(`${BASE_PATH}/customThemes`, { payload });
        });
    }
    function linkDiscord(data) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.post(`${BASE_PATH}/discord/link`, {
                payload: { data },
            });
        });
    }
    function unlinkDiscord() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield apeClient.post(`${BASE_PATH}/discord/unlink`);
        });
    }
    return {
        getData,
        create,
        getNameAvailability,
        delete: _delete,
        updateName,
        updateLeaderboardMemory,
        updateEmail,
        deletePersonalBests,
        getTags,
        createTag,
        editTag,
        deleteTag,
        deleteTagPersonalBest,
        linkDiscord,
        unlinkDiscord,
        getCustomThemes,
        addCustomTheme,
        editCustomTheme,
        deleteCustomTheme,
    };
}
exports["default"] = getUsersEndpoints;


/***/ }),

/***/ "./src/scripts/ape/index.ts":
/*!**********************************!*\
  !*** ./src/scripts/ape/index.ts ***!
  \**********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const axios_1 = __importDefault(__webpack_require__(/*! axios */ "./node_modules/axios/index.js"));
const endpoints_1 = __importDefault(__webpack_require__(/*! ./endpoints */ "./src/scripts/ape/endpoints/index.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const auth_1 = __webpack_require__(/*! firebase/auth */ "./node_modules/firebase/auth/dist/index.esm.js");
const DEV_SERVER_HOST = "http://localhost:5005";
const PROD_SERVER_HOST = "https://api.monkeytype.com";
const API_PATH = "";
const BASE_URL = window.location.hostname === "localhost" ? DEV_SERVER_HOST : PROD_SERVER_HOST;
const API_URL = `${BASE_URL}${API_PATH}`;
// Adapts the ape client's view of request options to the underlying HTTP client.
function adaptRequestOptions(options) {
    return __awaiter(this, void 0, void 0, function* () {
        const currentUser = firebase_1.Auth.currentUser;
        const idToken = currentUser && (yield (0, auth_1.getIdToken)(currentUser));
        return {
            params: options.searchQuery,
            data: options.payload,
            headers: Object.assign(Object.assign(Object.assign({}, options.headers), { Accept: "application/json", "Content-Type": "application/json" }), (idToken && { Authorization: `Bearer ${idToken}` })),
        };
    });
}
// Wrap the underlying HTTP client's method with our own.
function apeifyClientMethod(clientMethod, methodType) {
    return (endpoint, options = {}) => __awaiter(this, void 0, void 0, function* () {
        var _a, _b, _c;
        let errorMessage = "";
        try {
            const requestOptions = yield adaptRequestOptions(options);
            let response;
            if (methodType === "get" || methodType === "delete") {
                response = yield clientMethod(endpoint, requestOptions);
            }
            else {
                response = yield clientMethod(endpoint, requestOptions.data, requestOptions);
            }
            const { message, data } = response.data;
            return {
                status: response.status,
                message,
                data,
            };
        }
        catch (error) {
            console.error(error);
            const typedError = error;
            errorMessage = typedError.message;
            if (axios_1.default.isAxiosError(typedError)) {
                return Object.assign({ status: (_b = (_a = typedError.response) === null || _a === void 0 ? void 0 : _a.status) !== null && _b !== void 0 ? _b : 500, message: typedError.message }, (_c = typedError.response) === null || _c === void 0 ? void 0 : _c.data);
            }
        }
        return {
            status: 500,
            message: errorMessage,
        };
    });
}
const axiosClient = axios_1.default.create({
    baseURL: API_URL,
    timeout: 10000,
});
const apeClient = {
    get: apeifyClientMethod(axiosClient.get, "get"),
    post: apeifyClientMethod(axiosClient.post, "post"),
    put: apeifyClientMethod(axiosClient.put, "put"),
    patch: apeifyClientMethod(axiosClient.patch, "patch"),
    delete: apeifyClientMethod(axiosClient.delete, "delete"),
};
// API Endpoints
const Ape = {
    users: endpoints_1.default.getUsersEndpoints(apeClient),
    configs: endpoints_1.default.getConfigsEndpoints(apeClient),
    results: endpoints_1.default.getResultsEndpoints(apeClient),
    psas: endpoints_1.default.getPsasEndpoints(apeClient),
    quotes: endpoints_1.default.getQuotesEndpoints(apeClient),
    leaderboards: endpoints_1.default.getLeaderboardsEndpoints(apeClient),
    presets: endpoints_1.default.getPresetsEndpoints(apeClient),
    apeKeys: endpoints_1.default.getApeKeysEndpoints(apeClient),
};
exports["default"] = Ape;


/***/ }),

/***/ "./src/scripts/config-validation.ts":
/*!******************************************!*\
  !*** ./src/scripts/config-validation.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.isConfigValueValidAsync = exports.isConfigValueValid = exports.isConfigKeyValid = void 0;
const Misc = __importStar(__webpack_require__(/*! ./utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./elements/notifications */ "./src/scripts/elements/notifications.ts"));
function isConfigKeyValid(name) {
    if (name === null || name === undefined || name === "")
        return false;
    if (name.length > 30)
        return false;
    return /^[0-9a-zA-Z_.\-#+]+$/.test(name);
}
exports.isConfigKeyValid = isConfigKeyValid;
function invalid(key, val, customMessage) {
    if (customMessage === undefined) {
        Notifications.add(`Invalid value for ${key} (${val}). Please try to change this setting again.`, -1);
    }
    else {
        Notifications.add(`Invalid value for ${key} (${val}). ${customMessage}`, -1);
    }
    console.error(`Invalid value key ${key} value ${val} type ${typeof val}`);
}
function isArray(val) {
    return val instanceof Array;
}
function isConfigValueValid(key, val, possibleTypes) {
    let isValid = false;
    // might be used in the future
    // eslint-disable-next-line
    let customMessage = undefined;
    for (const possibleType of possibleTypes) {
        switch (possibleType) {
            case "boolean":
                if (typeof val === "boolean")
                    isValid = true;
                break;
            case "null":
                if (val === null)
                    isValid = true;
                break;
            case "number":
                if (typeof val === "number")
                    isValid = true;
                break;
            case "numberArray":
                if (isArray(val) && val.every((v) => typeof v === "number")) {
                    isValid = true;
                }
                break;
            case "string":
                if (typeof val === "string")
                    isValid = true;
                break;
            case "stringArray":
                if (isArray(val) && val.every((v) => typeof v === "string")) {
                    isValid = true;
                }
                break;
            case "undefined":
                if (typeof val === "undefined" || val === undefined)
                    isValid = true;
                break;
            default:
                if (isArray(possibleType)) {
                    if (possibleType.includes(val))
                        isValid = true;
                }
                break;
        }
    }
    if (!isValid)
        invalid(key, val, customMessage);
    return isValid;
}
exports.isConfigValueValid = isConfigValueValid;
function isConfigValueValidAsync(key, val, possibleTypes) {
    return __awaiter(this, void 0, void 0, function* () {
        let isValid = false;
        let customMessage = undefined;
        for (const possibleType of possibleTypes) {
            switch (possibleType) {
                case "layoutfluid": {
                    if (typeof val !== "string")
                        break;
                    const layoutNames = val.split(/[# ]+/);
                    if (layoutNames.length < 2 || layoutNames.length > 5)
                        break;
                    // convert the layout names to layouts
                    const layouts = yield Promise.all(layoutNames.map((layoutName) => Misc.getLayout(layoutName)));
                    // check if all layouts exist
                    if (!layouts.every((layout) => layout !== undefined)) {
                        const invalidLayoutNames = layoutNames.map((layoutName, index) => [
                            layoutName,
                            layouts[index],
                        ]);
                        const invalidLayouts = invalidLayoutNames
                            .filter(([_, layout]) => layout === undefined)
                            .map(([layoutName]) => layoutName);
                        customMessage = `The following inputted layouts do not exist: ${invalidLayouts.join(", ")}`;
                        break;
                    }
                    isValid = true;
                    break;
                }
            }
        }
        if (!isValid)
            invalid(key, val, customMessage);
        return isValid;
    });
}
exports.isConfigValueValidAsync = isConfigValueValidAsync;


/***/ }),

/***/ "./src/scripts/config.ts":
/*!*******************************!*\
  !*** ./src/scripts/config.ts ***!
  \*******************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.setShowLiveAcc = exports.setShowLiveWpm = exports.setShowTimerProgress = exports.setPaceCaretStyle = exports.setCaretStyle = exports.setPageWidth = exports.setOppositeShiftMode = exports.setStrictSpace = exports.setColorfulMode = exports.setFlipTestColors = exports.setRepeatQuotes = exports.setEnableAds = exports.setQuickEnd = exports.setShowAllLines = exports.setCapsLockWarning = exports.setSingleListCommandLine = exports.setAlwaysShowWordsHistory = exports.setMinBurstCustomSpeed = exports.setMinBurst = exports.setMinAccCustom = exports.setMinAcc = exports.setMinWpmCustomSpeed = exports.setMinWpm = exports.setRepeatedPace = exports.setPaceCaretCustomSpeed = exports.setPaceCaret = exports.setSwapEscAndTab = exports.setShowOutOfFocusWarning = exports.setAlwaysShowCPM = exports.setAlwaysShowDecimalPlaces = exports.setStopOnError = exports.setChartStyle = exports.setChartAccuracy = exports.setBlindMode = exports.setFunbox = exports.setFavThemes = exports.setDifficulty = exports.setSoundVolume = exports.setPlaySoundOnClick = exports.setPlaySoundOnError = exports.setMode = exports.setPunctuation = exports.setNumbers = exports.saveFullConfigToLocalStorage = exports.setChangedBeforeDb = exports.setDbConfigLoaded = exports.setLocalStorageConfig = exports.changedBeforeDb = exports.dbConfigLoaded = exports.localStorageConfig = void 0;
exports.loadPromise = exports.setConfig = exports.getConfigChanges = exports.loadFromLocalStorage = exports.reset = exports.apply = exports.setBurstHeatmap = exports.setMonkeyPowerLevel = exports.setCustomBackgroundFilter = exports.setCustomBackgroundSize = exports.setCustomLayoutfluid = exports.setCustomBackground = exports.setFontSize = exports.setLayout = exports.setKeymapLayout = exports.setKeymapStyle = exports.setKeymapLegendStyle = exports.setKeymapMode = exports.setMonkey = exports.setLanguage = exports.setCustomThemeColors = exports.setLazyMode = exports.setBritishEnglish = exports.setRandomTheme = exports.setThemeDark = exports.setThemeLight = exports.setTheme = exports.setCustomTheme = exports.setAutoSwitchTheme = exports.setIndicateTypos = exports.setConfidenceMode = exports.setFreedomMode = exports.setFontFamily = exports.previewFontFamily = exports.setQuickTabMode = exports.setSmoothLineScroll = exports.setStartGraphsAtZero = exports.setSmoothCaret = exports.setWordCount = exports.setQuoteLength = exports.setTimeConfig = exports.setKeyTips = exports.setTimerOpacity = exports.setTimerColor = exports.setTimerStyle = exports.setHideExtraLetters = exports.setHighlightMode = exports.setShowAverage = exports.setShowLiveBurst = void 0;
const DB = __importStar(__webpack_require__(/*! ./db */ "./src/scripts/db.ts"));
const OutOfFocus = __importStar(__webpack_require__(/*! ./test/out-of-focus */ "./src/scripts/test/out-of-focus.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./elements/notifications */ "./src/scripts/elements/notifications.ts"));
const config_validation_1 = __webpack_require__(/*! ./config-validation */ "./src/scripts/config-validation.ts");
const ConfigEvent = __importStar(__webpack_require__(/*! ./observables/config-event */ "./src/scripts/observables/config-event.ts"));
const default_config_1 = __importDefault(__webpack_require__(/*! ./constants/default-config */ "./src/scripts/constants/default-config.ts"));
const firebase_1 = __webpack_require__(/*! ./firebase */ "./src/scripts/firebase.ts");
const AnalyticsController = __importStar(__webpack_require__(/*! ./controllers/analytics-controller */ "./src/scripts/controllers/analytics-controller.ts"));
exports.dbConfigLoaded = false;
exports.changedBeforeDb = false;
function setLocalStorageConfig(val) {
    exports.localStorageConfig = val;
}
exports.setLocalStorageConfig = setLocalStorageConfig;
function setDbConfigLoaded(val) {
    exports.dbConfigLoaded = val;
}
exports.setDbConfigLoaded = setDbConfigLoaded;
function setChangedBeforeDb(val) {
    exports.changedBeforeDb = val;
}
exports.setChangedBeforeDb = setChangedBeforeDb;
let loadDone;
let config = Object.assign({}, default_config_1.default);
function saveToLocalStorage(key, nosave = false, noDbCheck = false) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!exports.dbConfigLoaded && !noDbCheck && !nosave) {
            setChangedBeforeDb(true);
        }
        if (nosave)
            return;
        const localToSave = config;
        delete localToSave.resultFilters;
        const localToSaveStringified = JSON.stringify(localToSave);
        window.localStorage.setItem("config", localToSaveStringified);
        if (!noDbCheck) {
            // await DB.saveConfig(dbToSave);
            yield saveToDatabase(key);
        }
        ConfigEvent.dispatch("saveToLocalStorage", localToSaveStringified);
    });
}
let configToSend = {};
let saveTimeout = null;
function saveToDatabase(key) {
    return __awaiter(this, void 0, void 0, function* () {
        configToSend[key] = config[key];
        if (saveTimeout === null) {
            saveTimeout = setTimeout(() => __awaiter(this, void 0, void 0, function* () {
                delete configToSend.resultFilters;
                if (Object.keys(configToSend).length > 0)
                    DB.saveConfig(configToSend);
                configToSend = {};
                clearTimeout(saveTimeout);
                saveTimeout = null;
            }), window.location.hostname === "localhost" ? 0 : 1000);
        }
    });
}
function saveFullConfigToLocalStorage(noDbCheck = false) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!exports.dbConfigLoaded && !noDbCheck) {
            setChangedBeforeDb(true);
        }
        const save = config;
        delete save.resultFilters;
        const stringified = JSON.stringify(save);
        window.localStorage.setItem("config", stringified);
        if (!noDbCheck)
            yield DB.saveConfig(save);
        ConfigEvent.dispatch("saveToLocalStorage", stringified);
    });
}
exports.saveFullConfigToLocalStorage = saveFullConfigToLocalStorage;
//numbers
function setNumbers(numb, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("numbers", numb, ["boolean"]))
        return false;
    if (config.mode === "quote") {
        numb = false;
    }
    config.numbers = numb;
    if (!config.numbers) {
        $("#top .config .numbersMode .text-button").removeClass("active");
    }
    else {
        $("#top .config .numbersMode .text-button").addClass("active");
    }
    saveToLocalStorage("numbers", nosave);
    ConfigEvent.dispatch("numbers", config.numbers);
    return true;
}
exports.setNumbers = setNumbers;
//punctuation
function setPunctuation(punc, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("punctuation", punc, ["boolean"]))
        return false;
    if (config.mode === "quote") {
        punc = false;
    }
    config.punctuation = punc;
    if (!config.punctuation) {
        $("#top .config .punctuationMode .text-button").removeClass("active");
    }
    else {
        $("#top .config .punctuationMode .text-button").addClass("active");
    }
    saveToLocalStorage("punctuation", nosave);
    ConfigEvent.dispatch("punctuation", config.punctuation);
    return true;
}
exports.setPunctuation = setPunctuation;
function setMode(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("mode", mode, [
        ["time", "words", "quote", "zen", "custom"],
    ])) {
        return false;
    }
    if (mode !== "words" && config.funbox === "memory") {
        Notifications.add("Memory funbox can only be used with words mode.", 0);
        return false;
    }
    const previous = config.mode;
    config.mode = mode;
    if (config.mode == "custom") {
        setPunctuation(false, true);
        setNumbers(false, true);
    }
    else if (config.mode == "quote") {
        setPunctuation(false, true);
        setNumbers(false, true);
    }
    else if (config.mode == "zen") {
        if (config.paceCaret != "off") {
            Notifications.add(`Pace caret will not work with zen mode.`, 0);
        }
    }
    saveToLocalStorage("mode", nosave);
    ConfigEvent.dispatch("mode", config.mode, nosave, previous);
    return true;
}
exports.setMode = setMode;
function setPlaySoundOnError(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("play sound on error", val, ["boolean"])) {
        return false;
    }
    config.playSoundOnError = val;
    saveToLocalStorage("playSoundOnError", nosave);
    ConfigEvent.dispatch("playSoundOnError", config.playSoundOnError);
    return true;
}
exports.setPlaySoundOnError = setPlaySoundOnError;
function setPlaySoundOnClick(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("play sound on click", val, [
        ["off", "1", "2", "3", "4", "5", "6", "7"],
    ])) {
        return false;
    }
    config.playSoundOnClick = val;
    saveToLocalStorage("playSoundOnClick", nosave);
    ConfigEvent.dispatch("playSoundOnClick", config.playSoundOnClick);
    return true;
}
exports.setPlaySoundOnClick = setPlaySoundOnClick;
function setSoundVolume(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("sound volume", val, [["0.1", "0.5", "1.0"]])) {
        return false;
    }
    config.soundVolume = val;
    saveToLocalStorage("soundVolume", nosave);
    ConfigEvent.dispatch("soundVolume", config.soundVolume);
    return true;
}
exports.setSoundVolume = setSoundVolume;
//difficulty
function setDifficulty(diff, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("difficulty", diff, [["normal", "expert", "master"]])) {
        return false;
    }
    config.difficulty = diff;
    saveToLocalStorage("difficulty", nosave);
    ConfigEvent.dispatch("difficulty", config.difficulty, nosave);
    return true;
}
exports.setDifficulty = setDifficulty;
//set fav themes
function setFavThemes(themes, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("favorite themes", themes, ["stringArray"])) {
        return false;
    }
    config.favThemes = themes;
    saveToLocalStorage("favThemes", nosave);
    ConfigEvent.dispatch("favThemes", config.favThemes);
    return true;
}
exports.setFavThemes = setFavThemes;
function setFunbox(funbox, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("funbox", funbox, ["string"]))
        return false;
    const val = funbox ? funbox : "none";
    config.funbox = val;
    saveToLocalStorage("funbox", nosave);
    ConfigEvent.dispatch("funbox", config.funbox);
    return true;
}
exports.setFunbox = setFunbox;
function setBlindMode(blind, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("blind mode", blind, ["boolean"]))
        return false;
    config.blindMode = blind;
    saveToLocalStorage("blindMode", nosave);
    ConfigEvent.dispatch("blindMode", config.blindMode, nosave);
    return true;
}
exports.setBlindMode = setBlindMode;
function setChartAccuracy(chartAccuracy, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("chart accuracy", chartAccuracy, ["boolean"])) {
        return false;
    }
    config.chartAccuracy = chartAccuracy;
    saveToLocalStorage("chartAccuracy", nosave);
    ConfigEvent.dispatch("chartAccuracy", config.chartAccuracy);
    return true;
}
exports.setChartAccuracy = setChartAccuracy;
function setChartStyle(chartStyle, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("chart style", chartStyle, [["line", "scatter"]])) {
        return false;
    }
    config.chartStyle = chartStyle;
    saveToLocalStorage("chartStyle", nosave);
    ConfigEvent.dispatch("chartStyle", config.chartStyle);
    return true;
}
exports.setChartStyle = setChartStyle;
function setStopOnError(soe, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("stop on error", soe, [["off", "word", "letter"]])) {
        return false;
    }
    config.stopOnError = soe;
    if (config.stopOnError !== "off") {
        config.confidenceMode = "off";
    }
    saveToLocalStorage("stopOnError", nosave);
    ConfigEvent.dispatch("stopOnError", config.stopOnError, nosave);
    return true;
}
exports.setStopOnError = setStopOnError;
function setAlwaysShowDecimalPlaces(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("always show decimal places", val, ["boolean"])) {
        return false;
    }
    config.alwaysShowDecimalPlaces = val;
    saveToLocalStorage("alwaysShowDecimalPlaces", nosave);
    ConfigEvent.dispatch("alwaysShowDecimalPlaces", config.alwaysShowDecimalPlaces);
    return true;
}
exports.setAlwaysShowDecimalPlaces = setAlwaysShowDecimalPlaces;
function setAlwaysShowCPM(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("always show CPM", val, ["boolean"]))
        return false;
    config.alwaysShowCPM = val;
    saveToLocalStorage("alwaysShowCPM", nosave);
    ConfigEvent.dispatch("alwaysShowCPM", config.alwaysShowCPM);
    return true;
}
exports.setAlwaysShowCPM = setAlwaysShowCPM;
function setShowOutOfFocusWarning(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show out of focus warning", val, ["boolean"])) {
        return false;
    }
    config.showOutOfFocusWarning = val;
    if (!config.showOutOfFocusWarning) {
        OutOfFocus.hide();
    }
    saveToLocalStorage("showOutOfFocusWarning", nosave);
    ConfigEvent.dispatch("showOutOfFocusWarning", config.showOutOfFocusWarning);
    return true;
}
exports.setShowOutOfFocusWarning = setShowOutOfFocusWarning;
function setSwapEscAndTab(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("swap esc and tab", val, ["boolean"]))
        return false;
    config.swapEscAndTab = val;
    saveToLocalStorage("swapEscAndTab", nosave);
    ConfigEvent.dispatch("swapEscAndTab", config.swapEscAndTab);
    return true;
}
exports.setSwapEscAndTab = setSwapEscAndTab;
//pace caret
function setPaceCaret(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("pace caret", val, [["custom", "off", "average", "pb"]])) {
        return false;
    }
    if (document.readyState === "complete") {
        if (val == "pb" && firebase_1.Auth.currentUser === null) {
            Notifications.add("PB pace caret is unavailable without an account", 0);
            return false;
        }
    }
    // if (config.mode === "zen" && val != "off") {
    //   Notifications.add(`Can't use pace caret with zen mode.`, 0);
    //   val = "off";
    // }
    config.paceCaret = val;
    saveToLocalStorage("paceCaret", nosave);
    ConfigEvent.dispatch("paceCaret", config.paceCaret, nosave);
    return true;
}
exports.setPaceCaret = setPaceCaret;
function setPaceCaretCustomSpeed(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("pace caret custom speed", val, ["number"])) {
        return false;
    }
    config.paceCaretCustomSpeed = val;
    saveToLocalStorage("paceCaretCustomSpeed", nosave);
    ConfigEvent.dispatch("paceCaretCustomSpeed", config.paceCaretCustomSpeed);
    return true;
}
exports.setPaceCaretCustomSpeed = setPaceCaretCustomSpeed;
function setRepeatedPace(pace, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("repeated pace", pace, ["boolean"]))
        return false;
    config.repeatedPace = pace;
    saveToLocalStorage("repeatedPace", nosave);
    ConfigEvent.dispatch("repeatedPace", config.repeatedPace);
    return true;
}
exports.setRepeatedPace = setRepeatedPace;
//min wpm
function setMinWpm(minwpm, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min WPM", minwpm, [["off", "custom"]]))
        return false;
    config.minWpm = minwpm;
    saveToLocalStorage("minWpm", nosave);
    ConfigEvent.dispatch("minWpm", config.minWpm, nosave);
    return true;
}
exports.setMinWpm = setMinWpm;
function setMinWpmCustomSpeed(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min WPM custom speed", val, ["number"])) {
        return false;
    }
    config.minWpmCustomSpeed = val;
    saveToLocalStorage("minWpmCustomSpeed", nosave);
    ConfigEvent.dispatch("minWpmCustomSpeed", config.minWpmCustomSpeed);
    return true;
}
exports.setMinWpmCustomSpeed = setMinWpmCustomSpeed;
//min acc
function setMinAcc(min, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min acc", min, [["off", "custom"]]))
        return false;
    config.minAcc = min;
    saveToLocalStorage("minAcc", nosave);
    ConfigEvent.dispatch("minAcc", config.minAcc, nosave);
    return true;
}
exports.setMinAcc = setMinAcc;
function setMinAccCustom(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min acc custom", val, ["number"]))
        return false;
    config.minAccCustom = val;
    saveToLocalStorage("minAccCustom", nosave);
    ConfigEvent.dispatch("minAccCustom", config.minAccCustom);
    return true;
}
exports.setMinAccCustom = setMinAccCustom;
//min burst
function setMinBurst(min, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min burst", min, [["off", "fixed", "flex"]])) {
        return false;
    }
    config.minBurst = min;
    saveToLocalStorage("minBurst", nosave);
    ConfigEvent.dispatch("minBurst", config.minBurst, nosave);
    return true;
}
exports.setMinBurst = setMinBurst;
function setMinBurstCustomSpeed(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("min burst custom speed", val, ["number"])) {
        return false;
    }
    config.minBurstCustomSpeed = val;
    saveToLocalStorage("minBurstCustomSpeed", nosave);
    ConfigEvent.dispatch("minBurstCustomSpeed", config.minBurstCustomSpeed);
    return true;
}
exports.setMinBurstCustomSpeed = setMinBurstCustomSpeed;
//always show words history
function setAlwaysShowWordsHistory(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("always show words history", val, ["boolean"])) {
        return false;
    }
    config.alwaysShowWordsHistory = val;
    saveToLocalStorage("alwaysShowWordsHistory", nosave);
    ConfigEvent.dispatch("alwaysShowWordsHistory", config.alwaysShowWordsHistory);
    return true;
}
exports.setAlwaysShowWordsHistory = setAlwaysShowWordsHistory;
//single list command line
function setSingleListCommandLine(option, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("single list command line", option, [["manual", "on"]])) {
        return false;
    }
    config.singleListCommandLine = option;
    saveToLocalStorage("singleListCommandLine", nosave);
    ConfigEvent.dispatch("singleListCommandLine", config.singleListCommandLine);
    return true;
}
exports.setSingleListCommandLine = setSingleListCommandLine;
//caps lock warning
function setCapsLockWarning(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("caps lock warning", val, ["boolean"]))
        return false;
    config.capsLockWarning = val;
    saveToLocalStorage("capsLockWarning", nosave);
    ConfigEvent.dispatch("capsLockWarning", config.capsLockWarning);
    return true;
}
exports.setCapsLockWarning = setCapsLockWarning;
function setShowAllLines(sal, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show all lines", sal, ["boolean"]))
        return false;
    config.showAllLines = sal;
    saveToLocalStorage("showAllLines", nosave);
    ConfigEvent.dispatch("showAllLines", config.showAllLines, nosave);
    return true;
}
exports.setShowAllLines = setShowAllLines;
function setQuickEnd(qe, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("quick end", qe, ["boolean"]))
        return false;
    config.quickEnd = qe;
    saveToLocalStorage("quickEnd", nosave);
    ConfigEvent.dispatch("quickEnd", config.quickEnd);
    return true;
}
exports.setQuickEnd = setQuickEnd;
function setEnableAds(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("enable ads", val, [["on", "off", "max"]])) {
        return false;
    }
    config.enableAds = val;
    if (!nosave) {
        saveToLocalStorage("enableAds", nosave);
        setTimeout(() => {
            location.reload();
        }, 3000);
        Notifications.add("Ad settings changed. Refreshing...", 0);
    }
    return true;
}
exports.setEnableAds = setEnableAds;
function setRepeatQuotes(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("repeat quotes", val, [["off", "typing"]])) {
        return false;
    }
    config.repeatQuotes = val;
    saveToLocalStorage("repeatQuotes", nosave);
    ConfigEvent.dispatch("repeatQuotes", config.repeatQuotes);
    return true;
}
exports.setRepeatQuotes = setRepeatQuotes;
//flip colors
function setFlipTestColors(flip, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("flip test colors", flip, ["boolean"]))
        return false;
    config.flipTestColors = flip;
    saveToLocalStorage("flipTestColors", nosave);
    ConfigEvent.dispatch("flipTestColors", config.flipTestColors);
    return true;
}
exports.setFlipTestColors = setFlipTestColors;
//extra color
function setColorfulMode(extra, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("colorful mode", extra, ["boolean"]))
        return false;
    config.colorfulMode = extra;
    saveToLocalStorage("colorfulMode", nosave);
    ConfigEvent.dispatch("colorfulMode", config.colorfulMode);
    return true;
}
exports.setColorfulMode = setColorfulMode;
//strict space
function setStrictSpace(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("strict space", val, ["boolean"]))
        return false;
    config.strictSpace = val;
    saveToLocalStorage("strictSpace", nosave);
    ConfigEvent.dispatch("strictSpace", config.strictSpace);
    return true;
}
exports.setStrictSpace = setStrictSpace;
//opposite shift space
function setOppositeShiftMode(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("opposite shift mode", val, [["off", "on", "keymap"]])) {
        return false;
    }
    config.oppositeShiftMode = val;
    saveToLocalStorage("oppositeShiftMode", nosave);
    ConfigEvent.dispatch("oppositeShiftMode", config.oppositeShiftMode);
    return true;
}
exports.setOppositeShiftMode = setOppositeShiftMode;
function setPageWidth(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("page width", val, [
        ["max", "100", "125", "150", "200"],
    ])) {
        return false;
    }
    config.pageWidth = val;
    $("#centerContent").removeClass("wide125");
    $("#centerContent").removeClass("wide150");
    $("#centerContent").removeClass("wide200");
    $("#centerContent").removeClass("widemax");
    if (val !== "100") {
        $("#centerContent").addClass("wide" + val);
    }
    saveToLocalStorage("pageWidth", nosave);
    ConfigEvent.dispatch("pageWidth", config.pageWidth);
    return true;
}
exports.setPageWidth = setPageWidth;
function setCaretStyle(caretStyle, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("caret style", caretStyle, [
        ["off", "default", "block", "outline", "underline", "carrot", "banana"],
    ])) {
        return false;
    }
    config.caretStyle = caretStyle;
    $("#caret").removeClass("off");
    $("#caret").removeClass("default");
    $("#caret").removeClass("underline");
    $("#caret").removeClass("outline");
    $("#caret").removeClass("block");
    $("#caret").removeClass("carrot");
    $("#caret").removeClass("banana");
    if (caretStyle == "off") {
        $("#caret").addClass("off");
    }
    else if (caretStyle == "default") {
        $("#caret").addClass("default");
    }
    else if (caretStyle == "block") {
        $("#caret").addClass("block");
    }
    else if (caretStyle == "outline") {
        $("#caret").addClass("outline");
    }
    else if (caretStyle == "underline") {
        $("#caret").addClass("underline");
    }
    else if (caretStyle == "carrot") {
        $("#caret").addClass("carrot");
    }
    else if (caretStyle == "banana") {
        $("#caret").addClass("banana");
    }
    saveToLocalStorage("caretStyle", nosave);
    ConfigEvent.dispatch("caretStyle", config.caretStyle);
    return true;
}
exports.setCaretStyle = setCaretStyle;
function setPaceCaretStyle(caretStyle, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("pace caret style", caretStyle, [
        ["off", "default", "block", "outline", "underline", "carrot", "banana"],
    ])) {
        return false;
    }
    config.paceCaretStyle = caretStyle;
    $("#paceCaret").removeClass("off");
    $("#paceCaret").removeClass("default");
    $("#paceCaret").removeClass("underline");
    $("#paceCaret").removeClass("outline");
    $("#paceCaret").removeClass("block");
    $("#paceCaret").removeClass("carrot");
    $("#paceCaret").removeClass("banana");
    if (caretStyle == "default") {
        $("#paceCaret").addClass("default");
    }
    else if (caretStyle == "block") {
        $("#paceCaret").addClass("block");
    }
    else if (caretStyle == "outline") {
        $("#paceCaret").addClass("outline");
    }
    else if (caretStyle == "underline") {
        $("#paceCaret").addClass("underline");
    }
    else if (caretStyle == "carrot") {
        $("#paceCaret").addClass("carrot");
    }
    else if (caretStyle == "banana") {
        $("#paceCaret").addClass("banana");
    }
    saveToLocalStorage("paceCaretStyle", nosave);
    ConfigEvent.dispatch("paceCaretStyle", config.paceCaretStyle);
    return true;
}
exports.setPaceCaretStyle = setPaceCaretStyle;
function setShowTimerProgress(timer, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show timer progress", timer, ["boolean"])) {
        return false;
    }
    config.showTimerProgress = timer;
    saveToLocalStorage("showTimerProgress", nosave);
    ConfigEvent.dispatch("showTimerProgress", config.showTimerProgress);
    return true;
}
exports.setShowTimerProgress = setShowTimerProgress;
function setShowLiveWpm(live, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show live WPM", live, ["boolean"]))
        return false;
    config.showLiveWpm = live;
    saveToLocalStorage("showLiveWpm", nosave);
    ConfigEvent.dispatch("showLiveWpm", config.showLiveWpm);
    return true;
}
exports.setShowLiveWpm = setShowLiveWpm;
function setShowLiveAcc(live, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show live acc", live, ["boolean"]))
        return false;
    config.showLiveAcc = live;
    saveToLocalStorage("showLiveAcc", nosave);
    ConfigEvent.dispatch("showLiveAcc", config.showLiveAcc);
    return true;
}
exports.setShowLiveAcc = setShowLiveAcc;
function setShowLiveBurst(live, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show live burst", live, ["boolean"]))
        return false;
    config.showLiveBurst = live;
    saveToLocalStorage("showLiveBurst", nosave);
    ConfigEvent.dispatch("showLiveBurst", config.showLiveBurst);
    return true;
}
exports.setShowLiveBurst = setShowLiveBurst;
function setShowAverage(value, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("show average", value, [["off", "wpm", "acc", "both"]])) {
        return false;
    }
    config.showAverage = value;
    saveToLocalStorage("showAverage", nosave);
    ConfigEvent.dispatch("showAverage", config.showAverage, nosave);
    return true;
}
exports.setShowAverage = setShowAverage;
function setHighlightMode(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("highlight mode", mode, [["off", "letter", "word"]])) {
        return false;
    }
    if (mode === "word" &&
        (config.funbox === "nospace" ||
            config.funbox === "read_ahead" ||
            config.funbox === "read_ahead_easy" ||
            config.funbox === "read_ahead_hard" ||
            config.funbox === "tts" ||
            config.funbox === "arrows")) {
        Notifications.add("Can't use word highlight with this funbox", 0);
        return false;
    }
    config.highlightMode = mode;
    saveToLocalStorage("highlightMode", nosave);
    ConfigEvent.dispatch("highlightMode", config.highlightMode);
    return true;
}
exports.setHighlightMode = setHighlightMode;
function setHideExtraLetters(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("hide extra letters", val, ["boolean"]))
        return false;
    config.hideExtraLetters = val;
    saveToLocalStorage("hideExtraLetters", nosave);
    ConfigEvent.dispatch("hideExtraLetters", config.hideExtraLetters);
    return true;
}
exports.setHideExtraLetters = setHideExtraLetters;
function setTimerStyle(style, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("timer style", style, [["bar", "text", "mini"]])) {
        return false;
    }
    config.timerStyle = style;
    saveToLocalStorage("timerStyle", nosave);
    ConfigEvent.dispatch("timerStyle", config.timerStyle);
    return true;
}
exports.setTimerStyle = setTimerStyle;
function setTimerColor(color, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("timer color", color, [
        ["black", "sub", "text", "main"],
    ])) {
        return false;
    }
    config.timerColor = color;
    $("#timer").removeClass("timerSub");
    $("#timer").removeClass("timerText");
    $("#timer").removeClass("timerMain");
    $("#timerNumber").removeClass("timerSub");
    $("#timerNumber").removeClass("timerText");
    $("#timerNumber").removeClass("timerMain");
    $("#largeLiveWpmAndAcc").removeClass("timerSub");
    $("#largeLiveWpmAndAcc").removeClass("timerText");
    $("#largeLiveWpmAndAcc").removeClass("timerMain");
    $("#miniTimerAndLiveWpm").removeClass("timerSub");
    $("#miniTimerAndLiveWpm").removeClass("timerText");
    $("#miniTimerAndLiveWpm").removeClass("timerMain");
    if (color === "main") {
        $("#timer").addClass("timerMain");
        $("#timerNumber").addClass("timerMain");
        $("#largeLiveWpmAndAcc").addClass("timerMain");
        $("#miniTimerAndLiveWpm").addClass("timerMain");
    }
    else if (color === "sub") {
        $("#timer").addClass("timerSub");
        $("#timerNumber").addClass("timerSub");
        $("#largeLiveWpmAndAcc").addClass("timerSub");
        $("#miniTimerAndLiveWpm").addClass("timerSub");
    }
    else if (color === "text") {
        $("#timer").addClass("timerText");
        $("#timerNumber").addClass("timerText");
        $("#largeLiveWpmAndAcc").addClass("timerText");
        $("#miniTimerAndLiveWpm").addClass("timerText");
    }
    saveToLocalStorage("timerColor", nosave);
    ConfigEvent.dispatch("timerColor", config.timerColor);
    return true;
}
exports.setTimerColor = setTimerColor;
function setTimerOpacity(opacity, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("timer opacity", opacity, [
        ["0.25", "0.5", "0.75", "1"],
    ])) {
        return false;
    }
    config.timerOpacity = opacity;
    saveToLocalStorage("timerOpacity", nosave);
    ConfigEvent.dispatch("timerOpacity", config.timerOpacity);
    return true;
}
exports.setTimerOpacity = setTimerOpacity;
//key tips
function setKeyTips(keyTips, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("key tips", keyTips, ["boolean"]))
        return false;
    config.showKeyTips = keyTips;
    if (config.showKeyTips) {
        $("#bottom .keyTips").removeClass("hidden");
    }
    else {
        $("#bottom .keyTips").addClass("hidden");
    }
    saveToLocalStorage("showKeyTips", nosave);
    ConfigEvent.dispatch("showKeyTips", config.showKeyTips);
    return true;
}
exports.setKeyTips = setKeyTips;
//mode
function setTimeConfig(time, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("time", time, ["number"]))
        return false;
    const newTime = isNaN(time) || time < 0 ? default_config_1.default.time : time;
    $("#top .config .time .text-button").removeClass("active");
    const timeCustom = ![15, 30, 60, 120].includes(newTime) ? "custom" : newTime;
    config.time = newTime;
    $("#top .config .time .text-button[timeConfig='" + timeCustom + "']").addClass("active");
    saveToLocalStorage("time", nosave);
    ConfigEvent.dispatch("time", config.time);
    return true;
}
exports.setTimeConfig = setTimeConfig;
//quote length
function setQuoteLength(len, nosave, multipleMode) {
    if (!(0, config_validation_1.isConfigValueValid)("quote length", len, [
        [-2, -1, 0, 1, 2, 3],
        "numberArray",
    ])) {
        return false;
    }
    if (Array.isArray(len)) {
        //config load
        if (len.length === 1 && len[0] === -1)
            len = [1];
        config.quoteLength = len;
    }
    else {
        if (!Array.isArray(config.quoteLength))
            config.quoteLength = [];
        if (len === null || isNaN(len) || len < -2 || len > 3) {
            len = 1;
        }
        len = parseInt(len.toString());
        if (multipleMode) {
            if (!config.quoteLength.includes(len)) {
                config.quoteLength.push(len);
            }
            else {
                if (config.quoteLength.length > 1) {
                    config.quoteLength = config.quoteLength.filter((ql) => ql !== len);
                }
            }
        }
        else {
            config.quoteLength = [len];
        }
    }
    // if (!nosave) setMode("quote", nosave);
    $("#top .config .quoteLength .text-button").removeClass("active");
    config.quoteLength.forEach((ql) => {
        $("#top .config .quoteLength .text-button[quoteLength='" + ql + "']").addClass("active");
    });
    saveToLocalStorage("quoteLength", nosave);
    ConfigEvent.dispatch("quoteLength", config.quoteLength);
    return true;
}
exports.setQuoteLength = setQuoteLength;
function setWordCount(wordCount, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("words", wordCount, ["number"]))
        return false;
    const newWordCount = wordCount < 0 || wordCount > 100000 ? default_config_1.default.words : wordCount;
    $("#top .config .wordCount .text-button").removeClass("active");
    const wordCustom = ![10, 25, 50, 100, 200].includes(newWordCount)
        ? "custom"
        : newWordCount;
    config.words = newWordCount;
    $("#top .config .wordCount .text-button[wordCount='" + wordCustom + "']").addClass("active");
    saveToLocalStorage("words", nosave);
    ConfigEvent.dispatch("words", config.words);
    return true;
}
exports.setWordCount = setWordCount;
//caret
function setSmoothCaret(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("smooth caret", mode, ["boolean"]))
        return false;
    config.smoothCaret = mode;
    if (mode) {
        $("#caret").css("animation-name", "caretFlashSmooth");
    }
    else {
        $("#caret").css("animation-name", "caretFlashHard");
    }
    saveToLocalStorage("smoothCaret", nosave);
    ConfigEvent.dispatch("smoothCaret", config.smoothCaret);
    return true;
}
exports.setSmoothCaret = setSmoothCaret;
function setStartGraphsAtZero(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("start graphs at zero", mode, ["boolean"])) {
        return false;
    }
    config.startGraphsAtZero = mode;
    saveToLocalStorage("startGraphsAtZero", nosave);
    ConfigEvent.dispatch("startGraphsAtZero", config.startGraphsAtZero);
    return true;
}
exports.setStartGraphsAtZero = setStartGraphsAtZero;
//linescroll
function setSmoothLineScroll(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("smooth line scroll", mode, ["boolean"])) {
        return false;
    }
    config.smoothLineScroll = mode;
    saveToLocalStorage("smoothLineScroll", nosave);
    ConfigEvent.dispatch("smoothLineScroll", config.smoothLineScroll);
    return true;
}
exports.setSmoothLineScroll = setSmoothLineScroll;
//quick tab
function setQuickTabMode(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("quick tab mode", mode, ["boolean"]))
        return false;
    config.quickTab = mode;
    if (!config.quickTab) {
        $("#restartTestButton").removeClass("hidden");
        $("#restartTestButton").css("opacity", 1);
        $("#bottom .keyTips")
            .html(`<key>tab</key> and <key>enter</key> / <key>space</key> - restart test<br>
      <key>ctrl/cmd</key>+<key>shift</key>+<key>p</key> or <key>esc</key> - command line`);
    }
    else {
        $("#restartTestButton").addClass("hidden");
        $("#bottom .keyTips").html(`<key>tab</key> - restart test<br>
    <key>ctrl/cmd</key>+<key>shift</key>+<key>p</key> or <key>esc</key> - command line`);
    }
    saveToLocalStorage("quickTab", nosave);
    ConfigEvent.dispatch("quickTab", config.quickTab);
    return true;
}
exports.setQuickTabMode = setQuickTabMode;
function previewFontFamily(font) {
    if (!(0, config_validation_1.isConfigValueValid)("preview font family", font, ["string"])) {
        return false;
    }
    document.documentElement.style.setProperty("--font", '"' + font.replace(/_/g, " ") + '", "Roboto Mono"');
    return true;
}
exports.previewFontFamily = previewFontFamily;
//font family
function setFontFamily(font, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("font family", font, ["string"]))
        return false;
    if (font === "") {
        font = "roboto_mono";
        Notifications.add("Empty input received, reverted to the default font.", 0, 3, "Custom font");
    }
    if (!(0, config_validation_1.isConfigKeyValid)(font)) {
        Notifications.add(`Invalid font name value: "${font}".`, -1, 3, "Custom font");
        return false;
    }
    config.fontFamily = font;
    document.documentElement.style.setProperty("--font", `"${font.replace(/_/g, " ")}", "Roboto Mono"`);
    saveToLocalStorage("fontFamily", nosave);
    ConfigEvent.dispatch("fontFamily", config.fontFamily);
    return true;
}
exports.setFontFamily = setFontFamily;
//freedom
function setFreedomMode(freedom, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("freedom mode", freedom, ["boolean"]))
        return false;
    if (freedom == null) {
        freedom = false;
    }
    config.freedomMode = freedom;
    if (config.freedomMode && config.confidenceMode !== "off") {
        config.confidenceMode = "off";
    }
    saveToLocalStorage("freedomMode", nosave);
    ConfigEvent.dispatch("freedomMode", config.freedomMode);
    return true;
}
exports.setFreedomMode = setFreedomMode;
function setConfidenceMode(cm, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("confidence mode", cm, [["off", "on", "max"]])) {
        return false;
    }
    config.confidenceMode = cm;
    if (config.confidenceMode !== "off") {
        config.freedomMode = false;
        config.stopOnError = "off";
    }
    saveToLocalStorage("confidenceMode", nosave);
    ConfigEvent.dispatch("confidenceMode", config.confidenceMode, nosave);
    return true;
}
exports.setConfidenceMode = setConfidenceMode;
function setIndicateTypos(value, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("indicate typos", value, [["off", "below", "replace"]])) {
        return false;
    }
    config.indicateTypos = value;
    saveToLocalStorage("indicateTypos", nosave);
    ConfigEvent.dispatch("indicateTypos", config.indicateTypos);
    return true;
}
exports.setIndicateTypos = setIndicateTypos;
function setAutoSwitchTheme(boolean, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("auto switch theme", boolean, ["boolean"])) {
        return false;
    }
    boolean = boolean !== null && boolean !== void 0 ? boolean : default_config_1.default.autoSwitchTheme;
    config.autoSwitchTheme = boolean;
    saveToLocalStorage("autoSwitchTheme", nosave);
    ConfigEvent.dispatch("autoSwitchTheme", config.autoSwitchTheme);
    return true;
}
exports.setAutoSwitchTheme = setAutoSwitchTheme;
function setCustomTheme(boolean, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("custom theme", boolean, ["boolean"]))
        return false;
    config.customTheme = boolean;
    saveToLocalStorage("customTheme", nosave);
    ConfigEvent.dispatch("customTheme", config.customTheme);
    return true;
}
exports.setCustomTheme = setCustomTheme;
function setTheme(name, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("theme", name, ["string"]))
        return false;
    config.theme = name;
    setCustomTheme(false);
    saveToLocalStorage("theme", nosave);
    ConfigEvent.dispatch("theme", config.theme);
    return true;
}
exports.setTheme = setTheme;
function setThemeLight(name, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("theme light", name, ["string"]))
        return false;
    config.themeLight = name;
    saveToLocalStorage("themeLight", nosave);
    ConfigEvent.dispatch("themeLight", config.themeLight, nosave);
    return true;
}
exports.setThemeLight = setThemeLight;
function setThemeDark(name, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("theme dark", name, ["string"]))
        return false;
    config.themeDark = name;
    saveToLocalStorage("themeDark", nosave);
    ConfigEvent.dispatch("themeDark", config.themeDark, nosave);
    return true;
}
exports.setThemeDark = setThemeDark;
function setThemes(theme, customState, customThemeColors, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("themes", theme, ["string"]))
        return false;
    config.customThemeColors = customThemeColors;
    config.theme = theme;
    config.customTheme = customState;
    saveToLocalStorage("theme", nosave);
    ConfigEvent.dispatch("setThemes", customState);
    return true;
}
function setRandomTheme(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("random theme", val, [
        ["off", "on", "fav", "light", "dark", "custom"],
    ])) {
        return false;
    }
    if (val === "custom") {
        if (firebase_1.Auth.currentUser === null) {
            config.randomTheme = val;
            return false;
        }
        if (!DB.getSnapshot())
            return true;
        if (DB.getSnapshot().customThemes.length === 0) {
            Notifications.add("You need to create a custom theme first", 0);
            config.randomTheme = "off";
            return false;
        }
    }
    config.randomTheme = val;
    saveToLocalStorage("randomTheme", nosave);
    ConfigEvent.dispatch("randomTheme", config.randomTheme);
    return true;
}
exports.setRandomTheme = setRandomTheme;
function setBritishEnglish(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("british english", val, ["boolean"]))
        return false;
    if (!val) {
        val = false;
    }
    config.britishEnglish = val;
    saveToLocalStorage("britishEnglish", nosave);
    ConfigEvent.dispatch("britishEnglish", config.britishEnglish);
    return true;
}
exports.setBritishEnglish = setBritishEnglish;
function setLazyMode(val, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("lazy mode", val, ["boolean"]))
        return false;
    if (!val) {
        val = false;
    }
    config.lazyMode = val;
    saveToLocalStorage("lazyMode", nosave);
    ConfigEvent.dispatch("lazyMode", config.lazyMode, nosave);
    return true;
}
exports.setLazyMode = setLazyMode;
function setCustomThemeColors(colors, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("custom theme colors", colors, ["stringArray"])) {
        return false;
    }
    if (colors !== undefined) {
        config.customThemeColors = colors;
        // ThemeController.set("custom");
        // applyCustomThemeColors();
    }
    saveToLocalStorage("customThemeColors", nosave);
    ConfigEvent.dispatch("customThemeColors", config.customThemeColors, nosave);
    return true;
}
exports.setCustomThemeColors = setCustomThemeColors;
function setLanguage(language, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("language", language, ["string"]))
        return false;
    config.language = language;
    AnalyticsController.log("changedLanguage", { language });
    saveToLocalStorage("language", nosave);
    ConfigEvent.dispatch("language", config.language);
    return true;
}
exports.setLanguage = setLanguage;
function setMonkey(monkey, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("monkey", monkey, ["boolean"]))
        return false;
    config.monkey = monkey;
    saveToLocalStorage("monkey", nosave);
    ConfigEvent.dispatch("monkey", config.monkey);
    return true;
}
exports.setMonkey = setMonkey;
function setKeymapMode(mode, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("keymap mode", mode, [
        ["off", "static", "react", "next"],
    ])) {
        return false;
    }
    $(".active-key").removeClass("active-key");
    $(".keymap-key").attr("style", "");
    config.keymapMode = mode;
    saveToLocalStorage("keymapMode", nosave);
    ConfigEvent.dispatch("keymapMode", config.keymapMode, nosave);
    return true;
}
exports.setKeymapMode = setKeymapMode;
function setKeymapLegendStyle(style, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("keymap legend style", style, [
        ["lowercase", "uppercase", "blank", "dynamic"],
    ])) {
        return false;
    }
    // Remove existing styles
    const keymapLegendStyles = ["lowercase", "uppercase", "blank", "dynamic"];
    keymapLegendStyles.forEach((name) => {
        $(".keymapLegendStyle").removeClass(name);
    });
    style = style || "lowercase";
    // Mutate the keymap in the DOM, if it exists.
    // 1. Remove everything
    $(".keymap-key > .letter").css("display", "");
    $(".keymap-key > .letter").css("text-transform", "");
    // 2. Append special styles onto the DOM elements
    if (style === "uppercase") {
        $(".keymap-key > .letter").css("text-transform", "capitalize");
    }
    if (style === "blank") {
        $(".keymap-key > .letter").css("display", "none");
    }
    // Update and save to cookie for persistence
    $(".keymapLegendStyle").addClass(style);
    config.keymapLegendStyle = style;
    saveToLocalStorage("keymapLegendStyle", nosave);
    ConfigEvent.dispatch("keymapLegendStyle", config.keymapLegendStyle);
    return true;
}
exports.setKeymapLegendStyle = setKeymapLegendStyle;
function setKeymapStyle(style, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("keymap style", style, [
        ["staggered", "alice", "matrix", "split", "split_matrix"],
    ])) {
        return false;
    }
    style = style || "staggered";
    config.keymapStyle = style;
    saveToLocalStorage("keymapStyle", nosave);
    ConfigEvent.dispatch("keymapStyle", config.keymapStyle);
    return true;
}
exports.setKeymapStyle = setKeymapStyle;
function setKeymapLayout(layout, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("keymap layout", layout, ["string"]))
        return false;
    config.keymapLayout = layout;
    saveToLocalStorage("keymapLayout", nosave);
    ConfigEvent.dispatch("keymapLayout", config.keymapLayout);
    return true;
}
exports.setKeymapLayout = setKeymapLayout;
function setLayout(layout, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("layout", layout, ["string"]))
        return false;
    config.layout = layout;
    saveToLocalStorage("layout", nosave);
    ConfigEvent.dispatch("layout", config.layout, nosave);
    return true;
}
exports.setLayout = setLayout;
// export function setSavedLayout(layout: string, nosave?: boolean): boolean {
//   if (layout == null || layout == undefined) {
//     layout = "qwerty";
//   }
//   config.savedLayout = layout;
//   setLayout(layout, nosave);
//   return true;
// }
function setFontSize(fontSize, nosave) {
    fontSize = fontSize.toString(); //todo remove after around a week
    if (!(0, config_validation_1.isConfigValueValid)("font size", fontSize, [
        ["1", "125", "15", "2", "3", "4"],
    ])) {
        return false;
    }
    config.fontSize = fontSize;
    $("#words").removeClass("size125");
    $("#caret, #paceCaret").removeClass("size125");
    $("#words").removeClass("size15");
    $("#caret, #paceCaret").removeClass("size15");
    $("#words").removeClass("size2");
    $("#caret, #paceCaret").removeClass("size2");
    $("#words").removeClass("size3");
    $("#caret, #paceCaret").removeClass("size3");
    $("#words").removeClass("size35");
    $("#caret, #paceCaret").removeClass("size35");
    $("#words").removeClass("size4");
    $("#caret, #paceCaret").removeClass("size4");
    $("#miniTimerAndLiveWpm").removeClass("size125");
    $("#miniTimerAndLiveWpm").removeClass("size15");
    $("#miniTimerAndLiveWpm").removeClass("size2");
    $("#miniTimerAndLiveWpm").removeClass("size3");
    $("#miniTimerAndLiveWpm").removeClass("size35");
    $("#miniTimerAndLiveWpm").removeClass("size4");
    if (fontSize == "125") {
        $("#words").addClass("size125");
        $("#caret, #paceCaret").addClass("size125");
        $("#miniTimerAndLiveWpm").addClass("size125");
    }
    else if (fontSize == "15") {
        $("#words").addClass("size15");
        $("#caret, #paceCaret").addClass("size15");
        $("#miniTimerAndLiveWpm").addClass("size15");
    }
    else if (fontSize == "2") {
        $("#words").addClass("size2");
        $("#caret, #paceCaret").addClass("size2");
        $("#miniTimerAndLiveWpm").addClass("size2");
    }
    else if (fontSize == "3") {
        $("#words").addClass("size3");
        $("#caret, #paceCaret").addClass("size3");
        $("#miniTimerAndLiveWpm").addClass("size3");
    }
    else if (fontSize == "4") {
        $("#words").addClass("size4");
        $("#caret, #paceCaret").addClass("size4");
        $("#miniTimerAndLiveWpm").addClass("size4");
    }
    saveToLocalStorage("fontSize", nosave);
    ConfigEvent.dispatch("fontSize", config.fontSize);
    return true;
}
exports.setFontSize = setFontSize;
function setCustomBackground(value, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("custom background", value, ["string"]))
        return false;
    value = value.trim();
    if ((/(https|http):\/\/(www\.|).+\..+\/.+(\.png|\.gif|\.jpeg|\.jpg)/gi.test(value) &&
        !/[<>]/.test(value)) ||
        value == "") {
        config.customBackground = value;
        saveToLocalStorage("customBackground", nosave);
        ConfigEvent.dispatch("customBackground", config.customBackground);
    }
    else {
        Notifications.add("Invalid custom background URL", 0);
    }
    return true;
}
exports.setCustomBackground = setCustomBackground;
function setCustomLayoutfluid(value, nosave) {
    return __awaiter(this, void 0, void 0, function* () {
        const trimmed = value.trim();
        if (!(yield (0, config_validation_1.isConfigValueValidAsync)("layoutfluid", trimmed, ["layoutfluid"]))) {
            return false;
        }
        const customLayoutfluid = trimmed.replace(/ /g, "#");
        config.customLayoutfluid = customLayoutfluid;
        $(".pageSettings .section.customLayoutfluid input").val(customLayoutfluid.replace(/#/g, " "));
        saveToLocalStorage("customLayoutfluid", nosave);
        ConfigEvent.dispatch("customLayoutFluid", config.customLayoutfluid);
        return true;
    });
}
exports.setCustomLayoutfluid = setCustomLayoutfluid;
function setCustomBackgroundSize(value, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("custom background size", value, [
        ["max", "cover", "contain"],
    ])) {
        return false;
    }
    if (value != "cover" && value != "contain" && value != "max") {
        value = "cover";
    }
    config.customBackgroundSize = value;
    saveToLocalStorage("customBackgroundSize", nosave);
    ConfigEvent.dispatch("customBackgroundSize", config.customBackgroundSize);
    return true;
}
exports.setCustomBackgroundSize = setCustomBackgroundSize;
function setCustomBackgroundFilter(array, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("custom background filter", array, ["numberArray"])) {
        return false;
    }
    config.customBackgroundFilter = array;
    saveToLocalStorage("customBackgroundFilter", nosave);
    ConfigEvent.dispatch("customBackgroundFilter", config.customBackgroundFilter);
    return true;
}
exports.setCustomBackgroundFilter = setCustomBackgroundFilter;
function setMonkeyPowerLevel(level, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("monkey power level", level, [
        ["off", "1", "2", "3", "4"],
    ])) {
        return false;
    }
    if (!["off", "1", "2", "3", "4"].includes(level))
        level = "off";
    config.monkeyPowerLevel = level;
    saveToLocalStorage("monkeyPowerLevel", nosave);
    ConfigEvent.dispatch("monkeyPowerLevel", config.monkeyPowerLevel);
    return true;
}
exports.setMonkeyPowerLevel = setMonkeyPowerLevel;
function setBurstHeatmap(value, nosave) {
    if (!(0, config_validation_1.isConfigValueValid)("burst heatmap", value, ["boolean"]))
        return false;
    if (!value) {
        value = false;
    }
    config.burstHeatmap = value;
    saveToLocalStorage("burstHeatmap", nosave);
    ConfigEvent.dispatch("burstHeatmap", config.burstHeatmap);
    return true;
}
exports.setBurstHeatmap = setBurstHeatmap;
function apply(configToApply) {
    if (!configToApply)
        return;
    const configObj = configToApply;
    Object.keys(default_config_1.default).forEach((configKey) => {
        if (configObj[configKey] === undefined) {
            const newValue = default_config_1.default[configKey];
            configObj[configKey] = newValue;
        }
    });
    if (configObj !== undefined && configObj !== null) {
        setThemeLight(configObj.themeLight, true);
        setThemeDark(configObj.themeDark, true);
        setAutoSwitchTheme(configObj.autoSwitchTheme, true);
        setThemes(configObj.theme, configObj.customTheme, configObj.customThemeColors, true);
        setCustomLayoutfluid(configObj.customLayoutfluid, true);
        setCustomBackground(configObj.customBackground, true);
        setCustomBackgroundSize(configObj.customBackgroundSize, true);
        setCustomBackgroundFilter(configObj.customBackgroundFilter, true);
        setQuickTabMode(configObj.quickTab, true);
        setKeyTips(configObj.showKeyTips, true);
        setTimeConfig(configObj.time, true);
        setQuoteLength(configObj.quoteLength, true);
        setWordCount(configObj.words, true);
        setLanguage(configObj.language, true);
        setLayout(configObj.layout, true);
        setFontSize(configObj.fontSize, true);
        setFreedomMode(configObj.freedomMode, true);
        setCaretStyle(configObj.caretStyle, true);
        setPaceCaretStyle(configObj.paceCaretStyle, true);
        setDifficulty(configObj.difficulty, true);
        setBlindMode(configObj.blindMode, true);
        setQuickEnd(configObj.quickEnd, true);
        setFlipTestColors(configObj.flipTestColors, true);
        setColorfulMode(configObj.colorfulMode, true);
        setConfidenceMode(configObj.confidenceMode, true);
        setIndicateTypos(configObj.indicateTypos, true);
        setTimerStyle(configObj.timerStyle, true);
        setTimerColor(configObj.timerColor, true);
        setTimerOpacity(configObj.timerOpacity, true);
        setKeymapMode(configObj.keymapMode, true);
        setKeymapStyle(configObj.keymapStyle, true);
        setKeymapLegendStyle(configObj.keymapLegendStyle, true);
        setKeymapLayout(configObj.keymapLayout, true);
        setFontFamily(configObj.fontFamily, true);
        setSmoothCaret(configObj.smoothCaret, true);
        setSmoothLineScroll(configObj.smoothLineScroll, true);
        setShowLiveWpm(configObj.showLiveWpm, true);
        setShowLiveAcc(configObj.showLiveAcc, true);
        setShowLiveBurst(configObj.showLiveBurst, true);
        setShowTimerProgress(configObj.showTimerProgress, true);
        setAlwaysShowDecimalPlaces(configObj.alwaysShowDecimalPlaces, true);
        setAlwaysShowWordsHistory(configObj.alwaysShowWordsHistory, true);
        setSingleListCommandLine(configObj.singleListCommandLine, true);
        setCapsLockWarning(configObj.capsLockWarning, true);
        setPlaySoundOnError(configObj.playSoundOnError, true);
        setPlaySoundOnClick(configObj.playSoundOnClick, true);
        setSoundVolume(configObj.soundVolume, true);
        setStopOnError(configObj.stopOnError, true);
        setFavThemes(configObj.favThemes, true);
        setFunbox(configObj.funbox, true);
        setRandomTheme(configObj.randomTheme, true);
        setShowAllLines(configObj.showAllLines, true);
        setSwapEscAndTab(configObj.swapEscAndTab, true);
        setShowOutOfFocusWarning(configObj.showOutOfFocusWarning, true);
        setPaceCaret(configObj.paceCaret, true);
        setPaceCaretCustomSpeed(configObj.paceCaretCustomSpeed, true);
        setRepeatedPace(configObj.repeatedPace, true);
        setPageWidth(configObj.pageWidth, true);
        setChartAccuracy(configObj.chartAccuracy, true);
        setChartStyle(configObj.chartStyle, true);
        setMinBurst(configObj.minBurst, true);
        setMinBurstCustomSpeed(configObj.minBurstCustomSpeed, true);
        setMinWpm(configObj.minWpm, true);
        setMinWpmCustomSpeed(configObj.minWpmCustomSpeed, true);
        setMinAcc(configObj.minAcc, true);
        setMinAccCustom(configObj.minAccCustom, true);
        setNumbers(configObj.numbers, true);
        setPunctuation(configObj.punctuation, true);
        setHighlightMode(configObj.highlightMode, true);
        setAlwaysShowCPM(configObj.alwaysShowCPM, true);
        setHideExtraLetters(configObj.hideExtraLetters, true);
        setStartGraphsAtZero(configObj.startGraphsAtZero, true);
        setStrictSpace(configObj.strictSpace, true);
        setOppositeShiftMode(configObj.oppositeShiftMode, true);
        setMode(configObj.mode, true);
        setMonkey(configObj.monkey, true);
        setRepeatQuotes(configObj.repeatQuotes, true);
        setMonkeyPowerLevel(configObj.monkeyPowerLevel, true);
        setBurstHeatmap(configObj.burstHeatmap, true);
        setBritishEnglish(configObj.britishEnglish, true);
        setLazyMode(configObj.lazyMode, true);
        setShowAverage(configObj.showAverage, true);
        try {
            setEnableAds(configObj.enableAds, true);
            if (config.enableAds === "max" || config.enableAds === "on") {
                $("head").append(`
          <script
          src="https://hb.vntsm.com/v3/live/ad-manager.min.js"
          type="text/javascript"
          data-site-id="60b78af12119122b8958910f"
          data-mode="scan"
          id="adScript"
          async
          ></script>
        `);
                if (config.enableAds === "max") {
                    //
                    $("#ad_rich_media").removeClass("hidden");
                    $("#ad_rich_media").html(`<div class="vm-placement" data-id="60bf737ee04cb761c88aafb1" style="display:none"></div>`);
                }
                else {
                    $("#ad_rich_media").remove();
                }
                //<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>
                $("#ad_footer").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_footer").removeClass("hidden");
                // $("#ad_footer2").html(`<div class="vm-placement" data-id="60bf73e9e04cb761c88aafb7"></div>`);
                // $("#ad_footer2").removeClass("hidden");
                $("#ad_about1").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_about1").removeClass("hidden");
                $("#ad_about2").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_about2").removeClass("hidden");
                $("#ad_settings0").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_settings0").removeClass("hidden");
                $("#ad_settings1").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_settings1").removeClass("hidden");
                $("#ad_settings2").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_settings2").removeClass("hidden");
                $("#ad_settings3").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_settings3").removeClass("hidden");
                $("#ad_account").html(`<div class="vm-placement" data-id="60bf73dae04cb761c88aafb5"></div>`);
                $("#ad_account").removeClass("hidden");
                $(".footerads").removeClass("hidden");
            }
            else {
                $("#adScript").remove();
                $(".footerads").remove();
                $("#ad_left").remove();
                $("#ad_right").remove();
                $("#ad_footer").remove();
                $("#ad_footer2").remove();
                $("#ad_footer3").remove();
                $("#ad_settings0").remove();
                $("#ad_settings1").remove();
                $("#ad_settings2").remove();
                $("#ad_settings3").remove();
                $("#ad_account").remove();
                $("#ad_about1").remove();
                $("#ad_about2").remove();
            }
        }
        catch (e) {
            Notifications.add("Error initialising ads: " + e.message);
            console.log("error initialising ads " + e.message);
            $(".footerads").remove();
            $("#ad_left").remove();
            $("#ad_right").remove();
            $("#ad_footer").remove();
            $("#ad_footer2").remove();
            $("#ad_footer3").remove();
            $("#ad_settings0").remove();
            $("#ad_settings1").remove();
            $("#ad_settings2").remove();
            $("#ad_settings3").remove();
            $("#ad_account").remove();
            $("#ad_about1").remove();
            $("#ad_about2").remove();
        }
        ConfigEvent.dispatch("configApplied", undefined, undefined, undefined, config);
    }
}
exports.apply = apply;
function reset() {
    ConfigEvent.dispatch("fullConfigChange");
    apply(default_config_1.default);
    saveFullConfigToLocalStorage();
}
exports.reset = reset;
function loadFromLocalStorage() {
    console.log("loading localStorage config");
    const newConfigString = window.localStorage.getItem("config");
    let newConfig;
    if (newConfigString !== undefined &&
        newConfigString !== null &&
        newConfigString !== "") {
        try {
            newConfig = JSON.parse(newConfigString);
        }
        catch (e) {
            newConfig = {};
        }
        apply(newConfig);
        console.log("applying localStorage config");
        exports.localStorageConfig = newConfig;
        saveFullConfigToLocalStorage(true);
        console.log("saving localStorage config");
    }
    // TestLogic.restart(false, true);
    loadDone();
}
exports.loadFromLocalStorage = loadFromLocalStorage;
function getConfigChanges() {
    const configChanges = {};
    Object.keys(config)
        .filter((key) => {
        return config[key] != default_config_1.default[key];
    })
        .forEach((key) => {
        configChanges[key] = config[key];
    });
    return configChanges;
}
exports.getConfigChanges = getConfigChanges;
function setConfig(newConfig) {
    config = newConfig;
}
exports.setConfig = setConfig;
exports.loadPromise = new Promise((v) => {
    loadDone = v;
});
exports["default"] = config;


/***/ }),

/***/ "./src/scripts/constants/default-config.ts":
/*!*************************************************!*\
  !*** ./src/scripts/constants/default-config.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports["default"] = {
    theme: "serika_dark",
    themeLight: "serika",
    themeDark: "serika_dark",
    autoSwitchTheme: false,
    customTheme: false,
    customThemeColors: [
        "#323437",
        "#e2b714",
        "#e2b714",
        "#646669",
        "#d1d0c5",
        "#ca4754",
        "#7e2a33",
        "#ca4754",
        "#7e2a33",
    ],
    favThemes: [],
    showKeyTips: true,
    showLiveWpm: false,
    showTimerProgress: true,
    smoothCaret: true,
    quickTab: false,
    punctuation: false,
    numbers: false,
    words: 50,
    time: 30,
    mode: "time",
    quoteLength: [1],
    language: "english",
    fontSize: "15",
    freedomMode: false,
    resultFilters: null,
    difficulty: "normal",
    blindMode: false,
    quickEnd: false,
    caretStyle: "default",
    paceCaretStyle: "default",
    flipTestColors: false,
    layout: "default",
    funbox: "none",
    confidenceMode: "off",
    indicateTypos: "off",
    timerStyle: "mini",
    colorfulMode: false,
    randomTheme: "off",
    timerColor: "main",
    timerOpacity: "1",
    stopOnError: "off",
    showAllLines: false,
    keymapMode: "off",
    keymapStyle: "staggered",
    keymapLegendStyle: "lowercase",
    keymapLayout: "overrideSync",
    fontFamily: "Roboto_Mono",
    smoothLineScroll: false,
    alwaysShowDecimalPlaces: false,
    alwaysShowWordsHistory: false,
    singleListCommandLine: "manual",
    capsLockWarning: true,
    playSoundOnError: false,
    playSoundOnClick: "off",
    soundVolume: "0.5",
    startGraphsAtZero: true,
    swapEscAndTab: false,
    showOutOfFocusWarning: true,
    paceCaret: "off",
    paceCaretCustomSpeed: 100,
    repeatedPace: true,
    pageWidth: "100",
    chartAccuracy: true,
    chartStyle: "line",
    minWpm: "off",
    minWpmCustomSpeed: 100,
    highlightMode: "letter",
    alwaysShowCPM: false,
    enableAds: "off",
    hideExtraLetters: false,
    strictSpace: false,
    minAcc: "off",
    minAccCustom: 90,
    showLiveAcc: false,
    showLiveBurst: false,
    monkey: false,
    repeatQuotes: "off",
    oppositeShiftMode: "off",
    customBackground: "",
    customBackgroundSize: "cover",
    customBackgroundFilter: [0, 1, 1, 1, 1],
    customLayoutfluid: "qwerty#dvorak#colemak",
    monkeyPowerLevel: "off",
    minBurst: "off",
    minBurstCustomSpeed: 100,
    burstHeatmap: false,
    britishEnglish: false,
    lazyMode: false,
    showAverage: "off",
};


/***/ }),

/***/ "./src/scripts/constants/default-snapshot.ts":
/*!***************************************************!*\
  !*** ./src/scripts/constants/default-snapshot.ts ***!
  \***************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.defaultSnap = void 0;
exports.defaultSnap = {
    results: undefined,
    personalBests: {
        time: {},
        words: {},
        zen: { zen: [] },
        quote: { custom: [] },
        custom: { custom: [] },
    },
    name: "",
    customThemes: [],
    presets: [],
    tags: [],
    favouriteThemes: [],
    banned: undefined,
    verified: undefined,
    emailVerified: undefined,
    lbMemory: { time: { 15: { english: 0 }, 60: { english: 0 } } },
    globalStats: {
        time: 0,
        started: 0,
        completed: 0,
    },
    quoteRatings: undefined,
    quoteMod: false,
};


/***/ }),

/***/ "./src/scripts/constants/firebase-config.ts":
/*!**************************************************!*\
  !*** ./src/scripts/constants/firebase-config.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, exports) => {


// To find your config, go to https://console.firebase.google.com/ and select your project
// Go to (top left) Settings > Project Settings > General
// scroll down to Your apps > Web Apps (if it doesnt exist, create one) > SDK setup and configuration > select npm
// your config should be visible there
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.firebaseConfig = void 0;
exports.firebaseConfig = {
    apiKey: "AIzaSyC8ZGlCnaYJYsz5bsMtmJGbu8QqtCVpM4g",
    authDomain: "monkeytype-d440a.firebaseapp.com",
    projectId: "monkeytype-d440a",
    storageBucket: "monkeytype-d440a.appspot.com",
    messagingSenderId: "409798745430",
    appId: "1:409798745430:web:6843557b36a25156370af7"
};


/***/ }),

/***/ "./src/scripts/controllers/account-controller.ts":
/*!*******************************************************!*\
  !*** ./src/scripts/controllers/account-controller.ts ***!
  \*******************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.signOut = exports.addPasswordAuth = exports.removeGoogleAuth = exports.addGoogleAuth = exports.signInWithGoogle = exports.signIn = exports.getDataAndInit = exports.sendVerificationEmail = exports.gmailProvider = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const AccountButton = __importStar(__webpack_require__(/*! ../elements/account-button */ "./src/scripts/elements/account-button.ts"));
const Account = __importStar(__webpack_require__(/*! ../pages/account */ "./src/scripts/pages/account.ts"));
const VerificationController = __importStar(__webpack_require__(/*! ./verification-controller */ "./src/scripts/controllers/verification-controller.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const AllTimeStats = __importStar(__webpack_require__(/*! ../account/all-time-stats */ "./src/scripts/account/all-time-stats.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const PageController = __importStar(__webpack_require__(/*! ./page-controller */ "./src/scripts/controllers/page-controller.ts"));
const PSA = __importStar(__webpack_require__(/*! ../elements/psa */ "./src/scripts/elements/psa.ts"));
const Focus = __importStar(__webpack_require__(/*! ../test/focus */ "./src/scripts/test/focus.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const PageTransition = __importStar(__webpack_require__(/*! ../states/page-transition */ "./src/scripts/states/page-transition.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const LoadingPage = __importStar(__webpack_require__(/*! ../pages/loading */ "./src/scripts/pages/loading.ts"));
const ResultFilters = __importStar(__webpack_require__(/*! ../account/result-filters */ "./src/scripts/account/result-filters.ts"));
const PaceCaret = __importStar(__webpack_require__(/*! ../test/pace-caret */ "./src/scripts/test/pace-caret.ts"));
const CommandlineLists = __importStar(__webpack_require__(/*! ../elements/commandline-lists */ "./src/scripts/elements/commandline-lists.ts"));
const TagController = __importStar(__webpack_require__(/*! ./tag-controller */ "./src/scripts/controllers/tag-controller.ts"));
const ResultTagsPopup = __importStar(__webpack_require__(/*! ../popups/result-tags-popup */ "./src/scripts/popups/result-tags-popup.ts"));
const URLHandler = __importStar(__webpack_require__(/*! ../utils/url-handler */ "./src/scripts/utils/url-handler.ts"));
const auth_1 = __webpack_require__(/*! firebase/auth */ "./node_modules/firebase/auth/dist/index.esm.js");
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const differenceInDays_1 = __importDefault(__webpack_require__(/*! date-fns/differenceInDays */ "./node_modules/date-fns/esm/differenceInDays/index.js"));
const default_snapshot_1 = __webpack_require__(/*! ../constants/default-snapshot */ "./src/scripts/constants/default-snapshot.ts");
exports.gmailProvider = new auth_1.GoogleAuthProvider();
function sendVerificationEmail() {
    Loader.show();
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    (0, auth_1.sendEmailVerification)(user)
        .then(() => {
        Loader.hide();
        Notifications.add("Email sent to " + user.email, 4000);
    })
        .catch((e) => {
        Loader.hide();
        Notifications.add("Error: " + e.message, 3000);
        console.error(e.message);
    });
}
exports.sendVerificationEmail = sendVerificationEmail;
function getDataAndInit() {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        try {
            console.log("getting account data");
            if (ActivePage.get() === "loading") {
                LoadingPage.updateBar(90);
            }
            else {
                LoadingPage.updateBar(45);
            }
            LoadingPage.updateText("Downloading user data...");
            yield LoadingPage.showBar();
            yield DB.initSnapshot();
        }
        catch (error) {
            const e = error;
            AccountButton.loading(false);
            if (e.responseCode === 429) {
                Notifications.add("Doing so will save you bandwidth, make the next test be ready faster and will not sign you out (which could mean your new personal best would not save to your account).", 0, 0);
                Notifications.add("You will run into this error if you refresh the website to restart the test. It is NOT recommended to do that. Instead, use tab + enter or just tab (with quick tab mode enabled) to restart the test.", 0, 0);
            }
            const msg = e.message || e;
            Notifications.add("Failed to get user data: " + msg, -1);
            $("#top #menu .account").css("opacity", 1);
            if (ActivePage.get() === "loading")
                PageController.change("");
            return false;
        }
        if (ActivePage.get() == "loading") {
            LoadingPage.updateBar(100);
        }
        else {
            LoadingPage.updateBar(45);
        }
        LoadingPage.updateText("Applying settings...");
        const snapshot = DB.getSnapshot();
        $("#menu .icon-button.account .text").text(snapshot.name);
        ResultFilters.loadTags(snapshot.tags);
        Promise.all([Misc.getLanguageList(), Misc.getFunboxList()]).then((values) => {
            const [languages, funboxes] = values;
            languages.forEach((language) => {
                ResultFilters.defaultResultFilters.language[language] = true;
            });
            funboxes.forEach((funbox) => {
                ResultFilters.defaultResultFilters.funbox[funbox.name] = true;
            });
            // filters = defaultResultFilters;
            ResultFilters.load();
        });
        if (!snapshot.name) {
            //verify username
            //invalid, get new
            let nameGood = false;
            let name = "";
            while (!nameGood) {
                name =
                    (_a = prompt("Please provide a new username (cannot be longer than 16 characters, can only contain letters, numbers, underscores, dots and dashes):")) !== null && _a !== void 0 ? _a : "";
                if (!name) {
                    return false;
                }
                const response = yield ape_1.default.users.updateName(name);
                if (response.status !== 200) {
                    Notifications.add("Failed to update name: " + response.message, -1);
                    return false;
                }
                nameGood = true;
                Notifications.add("Name updated", 1);
                snapshot.name = name;
                DB.setSnapshot(snapshot);
                $("#menu .icon-button.account .text").text(name);
            }
        }
        if (!UpdateConfig.changedBeforeDb) {
            //config didnt change before db loaded
            if (UpdateConfig.localStorageConfig === null && snapshot.config) {
                console.log("no local config, applying db");
                AccountButton.loading(false);
                UpdateConfig.apply(snapshot.config);
                Settings.update();
                UpdateConfig.saveFullConfigToLocalStorage(true);
                TestLogic.restart(false, true);
            }
            else if (snapshot.config !== undefined) {
                //loading db config, keep for now
                let configsDifferent = false;
                Object.keys(config_1.default).forEach((ke) => {
                    var _a, _b;
                    const key = ke;
                    if (configsDifferent)
                        return;
                    try {
                        if (key !== "resultFilters") {
                            if (Array.isArray(config_1.default[key])) {
                                config_1.default[key].forEach((arrval, index) => {
                                    var _a;
                                    const arrayValue = ((_a = snapshot === null || snapshot === void 0 ? void 0 : snapshot.config) === null || _a === void 0 ? void 0 : _a[key])[index];
                                    if (arrval != arrayValue) {
                                        configsDifferent = true;
                                        console.log(`.config is different: ${arrval} != ${arrayValue}`);
                                    }
                                });
                            }
                            else {
                                if (config_1.default[key] != ((_a = snapshot === null || snapshot === void 0 ? void 0 : snapshot.config) === null || _a === void 0 ? void 0 : _a[key])) {
                                    configsDifferent = true;
                                    console.log(`..config is different ${key}: ${config_1.default[key]} != ${(_b = snapshot === null || snapshot === void 0 ? void 0 : snapshot.config) === null || _b === void 0 ? void 0 : _b[key]}`);
                                }
                            }
                        }
                    }
                    catch (e) {
                        console.log(e);
                        configsDifferent = true;
                        console.log(`...config is different`);
                    }
                });
                if (configsDifferent) {
                    console.log("configs are different, applying config from db");
                    AccountButton.loading(false);
                    UpdateConfig.apply(snapshot.config);
                    Settings.update();
                    UpdateConfig.saveFullConfigToLocalStorage(true);
                    if (ActivePage.get() == "test") {
                        TestLogic.restart(false, true);
                    }
                    DB.saveConfig(config_1.default);
                }
            }
            UpdateConfig.setDbConfigLoaded(true);
        }
        else {
            console.log("config changed before db");
            AccountButton.loading(false);
        }
        if (config_1.default.paceCaret === "pb" || config_1.default.paceCaret === "average") {
            if (!TestActive.get()) {
                PaceCaret.init();
            }
        }
        AccountButton.loading(false);
        ResultFilters.updateTags();
        CommandlineLists.updateTagCommands();
        TagController.loadActiveFromLocalStorage();
        ResultTagsPopup.updateButtons();
        Settings.showAccountSection();
        PageTransition.set(false);
        console.log("account loading finished");
        return true;
    });
}
exports.getDataAndInit = getDataAndInit;
function loadUser(user) {
    return __awaiter(this, void 0, void 0, function* () {
        // User is signed in.
        $(".pageAccount .content p.accountVerificatinNotice").remove();
        if (user.emailVerified === false) {
            $(".pageAccount .content").prepend(`<p class="accountVerificatinNotice" style="text-align:center">Your account is not verified. <a class="sendVerificationEmail">Send the verification email again</a>.`);
        }
        PageTransition.set(false);
        AccountButton.update();
        AccountButton.loading(true);
        if ((yield getDataAndInit()) === false) {
            signOut();
        }
        // var displayName = user.displayName;
        // var email = user.email;
        // var emailVerified = user.emailVerified;
        // var photoURL = user.photoURL;
        // var isAnonymous = user.isAnonymous;
        // var uid = user.uid;
        // var providerData = user.providerData;
        $(".pageLogin .preloader").addClass("hidden");
        // showFavouriteThemesAtTheTop();
        let text = "Account created on " + user.metadata.creationTime;
        const creationDate = new Date(user.metadata.creationTime);
        const diffDays = (0, differenceInDays_1.default)(new Date(), creationDate);
        text += ` (${diffDays} day${diffDays != 1 ? "s" : ""} ago)`;
        $(".pageAccount .group.createdDate").text(text);
        if (VerificationController.data !== null) {
            VerificationController.verify(user.uid);
        }
    });
}
const authListener = firebase_1.Auth.onAuthStateChanged(function (user) {
    return __awaiter(this, void 0, void 0, function* () {
        // await UpdateConfig.loadPromise;
        console.log(`auth state changed, user ${user ? true : false}`);
        if (user) {
            yield loadUser(user);
        }
        else {
            if (window.location.pathname == "/account") {
                window.history.replaceState("", "", "/login");
            }
            PageTransition.set(false);
        }
        if (user) {
            if (window.location.pathname == "/login") {
                PageController.change("account");
            }
            else if (window.location.pathname != "/account") {
                PageController.change();
                setTimeout(() => {
                    Focus.set(false);
                }, 125 / 2);
            }
            else {
                Account.update();
                // SignOutButton.show();
            }
        }
        else {
            PageController.change();
            setTimeout(() => {
                Focus.set(false);
            }, 125 / 2);
        }
        URLHandler.loadCustomThemeFromUrl();
        if (/challenge_.+/g.test(window.location.pathname)) {
            Notifications.add("Challenge links temporarily disabled. Please use the command line to load the challenge manually", 0, 7);
            return;
            // Notifications.add("Loading challenge", 0);
            // let challengeName = window.location.pathname.split("_")[1];
            // setTimeout(() => {
            //   ChallengeController.setup(challengeName);
            // }, 1000);
        }
        PSA.show();
    });
});
function signIn() {
    UpdateConfig.setChangedBeforeDb(false);
    authListener();
    $(".pageLogin .preloader").removeClass("hidden");
    $(".pageLogin .button").addClass("disabled");
    const email = $(".pageLogin .login input")[0].value;
    const password = $(".pageLogin .login input")[1].value;
    const persistence = $(".pageLogin .login #rememberMe input").prop("checked")
        ? auth_1.browserLocalPersistence
        : auth_1.browserSessionPersistence;
    (0, auth_1.setPersistence)(firebase_1.Auth, persistence).then(function () {
        return (0, auth_1.signInWithEmailAndPassword)(firebase_1.Auth, email, password)
            .then((e) => __awaiter(this, void 0, void 0, function* () {
            yield loadUser(e.user);
            PageController.change("account");
            if (TestLogic.notSignedInLastResult !== null) {
                TestLogic.setNotSignedInUid(e.user.uid);
                const response = yield ape_1.default.results.save(TestLogic.notSignedInLastResult);
                if (response.status !== 200) {
                    return Notifications.add("Failed to save last result: " + response.message, -1);
                }
                TestLogic.clearNotSignedInResult();
                Notifications.add("Last test result saved", 1);
            }
            //TODO: redirect user to relevant page
        }))
            .catch(function (error) {
            let message = error.message;
            if (error.code === "auth/wrong-password") {
                message = "Incorrect password.";
            }
            else if (error.code === "auth/user-not-found") {
                message = "User not found.";
            }
            Notifications.add(message, -1);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
        });
    });
}
exports.signIn = signIn;
function signInWithGoogle() {
    var _a, _b;
    return __awaiter(this, void 0, void 0, function* () {
        UpdateConfig.setChangedBeforeDb(false);
        $(".pageLogin .preloader").removeClass("hidden");
        $(".pageLogin .button").addClass("disabled");
        authListener();
        let signedInUser;
        try {
            const persistence = $(".pageLogin .login #rememberMe input").prop("checked")
                ? auth_1.browserLocalPersistence
                : auth_1.browserSessionPersistence;
            yield (0, auth_1.setPersistence)(firebase_1.Auth, persistence);
            signedInUser = yield (0, auth_1.signInWithPopup)(firebase_1.Auth, exports.gmailProvider);
            if ((_a = (0, auth_1.getAdditionalUserInfo)(signedInUser)) === null || _a === void 0 ? void 0 : _a.isNewUser) {
                //ask for username
                let nameGood = false;
                let name = "";
                while (!nameGood) {
                    name =
                        prompt("Please provide a new username (cannot be longer than 16 characters, can only contain letters, numbers, underscores, dots and dashes):") || "";
                    if (!name) {
                        signOut();
                        $(".pageLogin .preloader").addClass("hidden");
                        return;
                    }
                    const response = yield ape_1.default.users.getNameAvailability(name);
                    if (response.status !== 200) {
                        return Notifications.add("Failed to check name: " + response.message, -1);
                    }
                    nameGood = true;
                }
                //create database object for the new user
                // try {
                const response = yield ape_1.default.users.create(name);
                if (response.status !== 200) {
                    throw response;
                }
                // } catch (e) {
                //   let msg = e?.response?.data?.message ?? e.message;
                //   Notifications.add("Failed to create account: " + msg, -1);
                //   return;
                // }
                if (response.status === 200) {
                    yield (0, auth_1.updateProfile)(signedInUser.user, { displayName: name });
                    yield (0, auth_1.sendEmailVerification)(signedInUser.user);
                    AllTimeStats.clear();
                    Notifications.add("Account created", 1, 3);
                    $("#menu .icon-button.account .text").text(name);
                    $(".pageLogin .button").removeClass("disabled");
                    $(".pageLogin .preloader").addClass("hidden");
                    yield loadUser(signedInUser.user);
                    PageController.change("account");
                    if (TestLogic.notSignedInLastResult !== null) {
                        TestLogic.setNotSignedInUid(signedInUser.user.uid);
                        const resultsSaveResponse = yield ape_1.default.results.save(TestLogic.notSignedInLastResult);
                        if (resultsSaveResponse.status === 200) {
                            const result = TestLogic.notSignedInLastResult;
                            DB.saveLocalResult(result);
                            DB.updateLocalStats({
                                time: result.testDuration +
                                    result.incompleteTestSeconds -
                                    result.afkDuration,
                                started: 1,
                            });
                        }
                    }
                }
            }
            else {
                yield loadUser(signedInUser.user);
                PageController.change("account");
            }
        }
        catch (e) {
            console.log(e);
            const message = Misc.createErrorMessage(e, "Failed to sign in with Google");
            Notifications.add(message, -1);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
            if (signedInUser && ((_b = (0, auth_1.getAdditionalUserInfo)(signedInUser)) === null || _b === void 0 ? void 0 : _b.isNewUser)) {
                yield ape_1.default.users.delete();
                yield signedInUser.user.delete();
            }
            signOut();
            return;
        }
    });
}
exports.signInWithGoogle = signInWithGoogle;
function addGoogleAuth() {
    return __awaiter(this, void 0, void 0, function* () {
        Loader.show();
        if (firebase_1.Auth.currentUser === null)
            return;
        (0, auth_1.linkWithPopup)(firebase_1.Auth.currentUser, exports.gmailProvider)
            .then(function () {
            Loader.hide();
            Notifications.add("Google authentication added", 1);
            Settings.updateAuthSections();
        })
            .catch(function (error) {
            Loader.hide();
            Notifications.add("Failed to add Google authenication: " + error.message, -1);
        });
    });
}
exports.addGoogleAuth = addGoogleAuth;
function removeGoogleAuth() {
    return __awaiter(this, void 0, void 0, function* () {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (user.providerData.find((provider) => provider.providerId === "password")) {
            Loader.show();
            try {
                yield (0, auth_1.reauthenticateWithPopup)(user, exports.gmailProvider);
            }
            catch (e) {
                Loader.hide();
                const message = Misc.createErrorMessage(e, "Failed to reauthenticate");
                return Notifications.add(message, -1);
            }
            (0, auth_1.unlink)(user, "google.com")
                .then(() => {
                Notifications.add("Google authentication removed", 1);
                Loader.hide();
                Settings.updateAuthSections();
            })
                .catch((error) => {
                Loader.hide();
                Notifications.add("Failed to remove Google authentication: " + error.message, -1);
            });
        }
        else {
            Notifications.add("Password authentication needs to be enabled to remove Google authentication", -1);
        }
    });
}
exports.removeGoogleAuth = removeGoogleAuth;
function addPasswordAuth(email, password) {
    return __awaiter(this, void 0, void 0, function* () {
        Loader.show();
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (user.providerData.find((provider) => provider.providerId === "google.com")) {
            try {
                yield (0, auth_1.reauthenticateWithPopup)(user, exports.gmailProvider);
            }
            catch (e) {
                Loader.hide();
                const message = Misc.createErrorMessage(e, "Failed to reauthenticate");
                return Notifications.add(message, -1);
            }
        }
        const credential = auth_1.EmailAuthProvider.credential(email, password);
        (0, auth_1.linkWithCredential)(user, credential)
            .then(function () {
            Loader.hide();
            Notifications.add("Password authenication added", 1);
            Settings.updateAuthSections();
        })
            .catch(function (error) {
            Loader.hide();
            Notifications.add("Failed to add password authenication: " + error.message, -1);
        });
    });
}
exports.addPasswordAuth = addPasswordAuth;
function signOut() {
    firebase_1.Auth.signOut()
        .then(function () {
        Notifications.add("Signed out", 0, 2);
        AllTimeStats.clear();
        Settings.hideAccountSection();
        AccountButton.update();
        PageController.change("login");
        DB.setSnapshot(default_snapshot_1.defaultSnap);
        $(".pageLogin .button").removeClass("disabled");
    })
        .catch(function (error) {
        Notifications.add(error.message, -1);
    });
}
exports.signOut = signOut;
function signUp() {
    return __awaiter(this, void 0, void 0, function* () {
        $(".pageLogin .button").addClass("disabled");
        $(".pageLogin .preloader").removeClass("hidden");
        const nname = $(".pageLogin .register input")[0].value;
        const email = $(".pageLogin .register input")[1].value;
        const emailVerify = $(".pageLogin .register input")[2]
            .value;
        const password = $(".pageLogin .register input")[3]
            .value;
        const passwordVerify = $(".pageLogin .register input")[4].value;
        if (email !== emailVerify) {
            Notifications.add("Emails do not match", 0, 3);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
            return;
        }
        if (password !== passwordVerify) {
            Notifications.add("Passwords do not match", 0, 3);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
            return;
        }
        const response = yield ape_1.default.users.getNameAvailability(nname);
        if (response.status !== 200) {
            Notifications.add(response.message, -1);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
            return;
        }
        authListener();
        let createdAuthUser;
        try {
            createdAuthUser = yield (0, auth_1.createUserWithEmailAndPassword)(firebase_1.Auth, email, password);
            const signInResponse = yield ape_1.default.users.create(nname, email, createdAuthUser.user.uid);
            if (signInResponse.status !== 200) {
                throw signInResponse;
            }
            yield (0, auth_1.updateProfile)(createdAuthUser.user, { displayName: nname });
            yield (0, auth_1.sendEmailVerification)(createdAuthUser.user);
            AllTimeStats.clear();
            $("#menu .icon-button.account .text").text(nname);
            $(".pageLogin .button").removeClass("disabled");
            $(".pageLogin .preloader").addClass("hidden");
            yield loadUser(createdAuthUser.user);
            if (TestLogic.notSignedInLastResult !== null) {
                TestLogic.setNotSignedInUid(createdAuthUser.user.uid);
                const response = yield ape_1.default.results.save(TestLogic.notSignedInLastResult);
                if (response.status === 200) {
                    const result = TestLogic.notSignedInLastResult;
                    DB.saveLocalResult(result);
                    DB.updateLocalStats({
                        time: result.testDuration +
                            result.incompleteTestSeconds -
                            result.afkDuration,
                        started: 1,
                    });
                }
            }
            PageController.change("account");
            Notifications.add("Account created", 1, 3);
        }
        catch (e) {
            //make sure to do clean up here
            if (createdAuthUser) {
                yield ape_1.default.users.delete();
                yield createdAuthUser.user.delete();
            }
            console.log(e);
            const message = Misc.createErrorMessage(e, "Failed to create account");
            Notifications.add(message, -1);
            $(".pageLogin .preloader").addClass("hidden");
            $(".pageLogin .button").removeClass("disabled");
            signOut();
            return;
        }
    });
}
$(".pageLogin #forgotPasswordButton").on("click", () => {
    const emailField = $(".pageLogin .login input")[0].value || "";
    const email = prompt("Email address", emailField);
    if (email) {
        (0, auth_1.sendPasswordResetEmail)(firebase_1.Auth, email)
            .then(function () {
            // Email sent.
            Notifications.add("Email sent", 1, 2);
        })
            .catch(function (error) {
            // An error happened.
            Notifications.add(error.message, -1);
        });
    }
});
$(".pageLogin .login input").keyup((e) => {
    if (e.key === "Enter") {
        UpdateConfig.setChangedBeforeDb(false);
        signIn();
    }
});
$(".pageLogin .login .button.signIn").on("click", () => {
    UpdateConfig.setChangedBeforeDb(false);
    signIn();
});
$(".pageLogin .login .button.signInWithGoogle").on("click", () => {
    UpdateConfig.setChangedBeforeDb(false);
    signInWithGoogle();
});
// $(".pageLogin .login .button.signInWithGitHub").on("click",(e) => {
// UpdateConfig.setChangedBeforeDb(false);
// signInWithGitHub();
// });
$(".signOut").on("click", () => {
    signOut();
});
$(".pageLogin .register input").keyup((e) => {
    if ($(".pageLogin .register .button").hasClass("disabled"))
        return;
    if (e.key === "Enter") {
        signUp();
    }
});
$(".pageLogin .register .button").on("click", () => {
    if ($(".pageLogin .register .button").hasClass("disabled"))
        return;
    signUp();
});
$(".pageSettings #addGoogleAuth").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    addGoogleAuth();
}));
$(".pageSettings #removeGoogleAuth").on("click", () => {
    removeGoogleAuth();
});
$(document).on("click", ".pageAccount .sendVerificationEmail", () => {
    sendVerificationEmail();
});


/***/ }),

/***/ "./src/scripts/controllers/analytics-controller.ts":
/*!*********************************************************!*\
  !*** ./src/scripts/controllers/analytics-controller.ts ***!
  \*********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.log = void 0;
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const analytics_1 = __webpack_require__(/*! firebase/analytics */ "./node_modules/firebase/analytics/dist/index.esm.js");
function log(eventName, params) {
    return __awaiter(this, void 0, void 0, function* () {
        try {
            (0, analytics_1.logEvent)(firebase_1.Analytics, eventName, params);
        }
        catch (e) {
            console.log("Analytics unavailable");
        }
    });
}
exports.log = log;


/***/ }),

/***/ "./src/scripts/controllers/challenge-controller.ts":
/*!*********************************************************!*\
  !*** ./src/scripts/controllers/challenge-controller.ts ***!
  \*********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.setup = exports.verify = exports.clearActive = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
const Funbox = __importStar(__webpack_require__(/*! ../test/funbox */ "./src/scripts/test/funbox.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const TestState = __importStar(__webpack_require__(/*! ../test/test-state */ "./src/scripts/test/test-state.ts"));
let challengeLoading = false;
function clearActive() {
    if (TestState.activeChallenge &&
        !challengeLoading &&
        !TestUI.testRestarting) {
        Notifications.add("Challenge cleared", 0);
        TestState.setActiveChallenge(null);
    }
}
exports.clearActive = clearActive;
function verify(result) {
    try {
        if (TestState.activeChallenge) {
            const afk = (result.afkDuration / result.testDuration) * 100;
            if (afk > 10) {
                Notifications.add(`Challenge failed: AFK time is greater than 10%`, 0);
                return null;
            }
            if (!TestState.activeChallenge.requirements) {
                Notifications.add(`${TestState.activeChallenge.display} challenge passed!`, 1);
                return TestState.activeChallenge.name;
            }
            else {
                let requirementsMet = true;
                const failReasons = [];
                for (const requirementType in TestState.activeChallenge.requirements) {
                    if (requirementsMet == false)
                        return null;
                    const requirementValue = TestState.activeChallenge.requirements[requirementType];
                    if (requirementType == "wpm") {
                        const wpmMode = Object.keys(requirementValue)[0];
                        if (wpmMode == "exact") {
                            if (Math.round(result.wpm) != requirementValue["exact"]) {
                                requirementsMet = false;
                                failReasons.push(`WPM not ${requirementValue["exact"]}`);
                            }
                        }
                        else if (wpmMode == "min") {
                            if (result.wpm < requirementValue["min"]) {
                                requirementsMet = false;
                                failReasons.push(`WPM below ${requirementValue["min"]}`);
                            }
                        }
                    }
                    else if (requirementType == "acc") {
                        const accMode = Object.keys(requirementValue)[0];
                        if (accMode == "exact") {
                            if (result.acc != requirementValue["exact"]) {
                                requirementsMet = false;
                                failReasons.push(`Accuracy not ${requirementValue["exact"]}`);
                            }
                        }
                        else if (accMode == "min") {
                            if (result.acc < requirementValue["min"]) {
                                requirementsMet = false;
                                failReasons.push(`Accuracy below ${requirementValue["min"]}`);
                            }
                        }
                    }
                    else if (requirementType == "afk") {
                        const afkMode = Object.keys(requirementValue)[0];
                        if (afkMode == "max") {
                            if (Math.round(afk) > requirementValue["max"]) {
                                requirementsMet = false;
                                failReasons.push(`AFK percentage above ${requirementValue["max"]}`);
                            }
                        }
                    }
                    else if (requirementType == "time") {
                        const timeMode = Object.keys(requirementValue)[0];
                        if (timeMode == "min") {
                            if (Math.round(result.testDuration) < requirementValue["min"]) {
                                requirementsMet = false;
                                failReasons.push(`Test time below ${requirementValue["min"]}`);
                            }
                        }
                    }
                    else if (requirementType == "funbox") {
                        const funboxMode = requirementValue["exact"];
                        if (funboxMode != result.funbox) {
                            requirementsMet = false;
                            failReasons.push(`${funboxMode} funbox not active`);
                        }
                    }
                    else if (requirementType == "raw") {
                        const rawMode = Object.keys(requirementValue)[0];
                        if (rawMode == "exact") {
                            if (Math.round(result.rawWpm) != requirementValue["exact"]) {
                                requirementsMet = false;
                                failReasons.push(`Raw WPM not ${requirementValue["exact"]}`);
                            }
                        }
                    }
                    else if (requirementType == "con") {
                        const conMode = Object.keys(requirementValue)[0];
                        if (conMode == "exact") {
                            if (Math.round(result.consistency) != requirementValue["exact"]) {
                                requirementsMet = false;
                                failReasons.push(`Consistency not ${requirementValue["exact"]}`);
                            }
                        }
                    }
                    else if (requirementType == "config") {
                        for (const configKey in requirementValue) {
                            const configValue = requirementValue[configKey];
                            if (config_1.default[configKey] != configValue) {
                                requirementsMet = false;
                                failReasons.push(`${configKey} not set to ${configValue}`);
                            }
                        }
                    }
                }
                if (requirementsMet) {
                    if (TestState.activeChallenge.autoRole) {
                        Notifications.add("You will receive a role shortly. Please don't post a screenshot in challenge submissions.", 1, 5);
                    }
                    Notifications.add(`${TestState.activeChallenge.display} challenge passed!`, 1);
                    return TestState.activeChallenge.name;
                }
                else {
                    Notifications.add(`${TestState.activeChallenge.display} challenge failed: ${failReasons.join(", ")}`, 0);
                    return null;
                }
            }
        }
        else {
            return null;
        }
    }
    catch (e) {
        console.error(e);
        Notifications.add(`Something went wrong when verifying challenge: ${e.message}`, 0);
        return null;
    }
}
exports.verify = verify;
function setup(challengeName) {
    return __awaiter(this, void 0, void 0, function* () {
        challengeLoading = true;
        UpdateConfig.setFunbox("none");
        const list = yield Misc.getChallengeList();
        const challenge = list.filter((c) => c.name === challengeName)[0];
        let notitext;
        try {
            if (challenge === undefined) {
                Notifications.add("Challenge not found", 0);
                ManualRestart.set();
                setTimeout(() => {
                    $("#top .config").removeClass("hidden");
                    $(".page.pageTest").removeClass("hidden");
                }, 250);
                return false;
            }
            if (challenge.type === "customTime") {
                UpdateConfig.setTimeConfig(challenge.parameters[0], true);
                UpdateConfig.setMode("time", true);
                UpdateConfig.setDifficulty("normal", true);
                if (challenge.name === "englishMaster") {
                    UpdateConfig.setLanguage("english_10k", true);
                    UpdateConfig.setNumbers(true, true);
                    UpdateConfig.setPunctuation(true, true);
                }
            }
            else if (challenge.type === "customWords") {
                UpdateConfig.setWordCount(challenge.parameters[0], true);
                UpdateConfig.setMode("words", true);
                UpdateConfig.setDifficulty("normal", true);
            }
            else if (challenge.type === "customText") {
                CustomText.setText(challenge.parameters[0].split(" "));
                CustomText.setIsTimeRandom(false);
                CustomText.setIsWordRandom(challenge.parameters[1]);
                CustomText.setWord(challenge.parameters[2]);
                CustomText.setTime(-1);
                UpdateConfig.setMode("custom", true);
                UpdateConfig.setDifficulty("normal", true);
            }
            else if (challenge.type === "script") {
                const response = yield fetch("/challenges/" + challenge.parameters[0]);
                const scriptdata = yield response.text();
                let text = scriptdata.trim();
                text = text.replace(/[\n\r\t ]/gm, " ");
                text = text.replace(/ +/gm, " ");
                CustomText.setText(text.split(" "));
                CustomText.setIsWordRandom(false);
                UpdateConfig.setMode("custom", true);
                UpdateConfig.setDifficulty("normal", true);
                if (challenge.parameters[1] != null) {
                    UpdateConfig.setTheme(challenge.parameters[1]);
                }
                if (challenge.parameters[2] != null) {
                    Funbox.activate(challenge.parameters[2]);
                }
            }
            else if (challenge.type === "accuracy") {
                UpdateConfig.setTimeConfig(0, true);
                UpdateConfig.setMode("time", true);
                UpdateConfig.setDifficulty("master", true);
            }
            else if (challenge.type === "funbox") {
                UpdateConfig.setFunbox(challenge.parameters[0], true);
                UpdateConfig.setDifficulty("normal", true);
                if (challenge.parameters[1] === "words") {
                    UpdateConfig.setWordCount(challenge.parameters[2], true);
                }
                else if (challenge.parameters[1] === "time") {
                    UpdateConfig.setTimeConfig(challenge.parameters[2], true);
                }
                UpdateConfig.setMode(challenge.parameters[1], true);
                if (challenge.parameters[3] !== undefined) {
                    UpdateConfig.setDifficulty(challenge.parameters[3], true);
                }
            }
            else if (challenge.type === "special") {
                if (challenge.name === "semimak") {
                    // so can you make a link that sets up 120s, 10k, punct, stop on word, and semimak as the layout?
                    UpdateConfig.setMode("time", true);
                    UpdateConfig.setTimeConfig(120, true);
                    UpdateConfig.setLanguage("english_10k", true);
                    UpdateConfig.setPunctuation(true, true);
                    UpdateConfig.setStopOnError("word", true);
                    UpdateConfig.setLayout("semimak", true);
                    UpdateConfig.setKeymapLayout("overrideSync", true);
                    UpdateConfig.setKeymapMode("static", true);
                }
            }
            ManualRestart.set();
            notitext = challenge.message;
            $("#top .config").removeClass("hidden");
            $(".page.pageTest").removeClass("hidden");
            if (notitext === undefined) {
                Notifications.add(`Challenge '${challenge.display}' loaded.`, 0);
            }
            else {
                Notifications.add("Challenge loaded. " + notitext, 0);
            }
            TestState.setActiveChallenge(challenge);
            challengeLoading = false;
            return true;
        }
        catch (e) {
            Notifications.add("Something went wrong: " + e, -1);
            return false;
        }
    });
}
exports.setup = setup;
ConfigEvent.subscribe((eventKey) => {
    if ([
        "difficulty",
        "numbers",
        "punctuation",
        "mode",
        "funbox",
        "paceCaret",
        "showAllLines",
        "showLiveWpm",
        "highlightMode",
        "time",
        "words",
        "keymapMode",
        "keymapLayout",
        "layout",
    ].includes(eventKey)) {
        clearActive();
    }
});


/***/ }),

/***/ "./src/scripts/controllers/chart-controller.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/controllers/chart-controller.ts ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateAllChartColors = exports.setDefaultFontFamily = exports.updateColors = exports.miniResult = exports.accountActivity = exports.accountHistory = exports.accountHistoryActiveIndex = exports.result = void 0;
const chart_js_1 = __webpack_require__(/*! chart.js */ "./node_modules/chart.js/dist/chart.esm.js");
const chartjs_plugin_trendline_1 = __importDefault(__webpack_require__(/*! chartjs-plugin-trendline */ "./node_modules/chartjs-plugin-trendline/src/chartjs-plugin-trendline.js"));
const chartjs_plugin_annotation_1 = __importDefault(__webpack_require__(/*! chartjs-plugin-annotation */ "./node_modules/chartjs-plugin-annotation/dist/chartjs-plugin-annotation.esm.js"));
chart_js_1.Chart.register(chart_js_1.BarController, chart_js_1.BarElement, chart_js_1.CategoryScale, chart_js_1.Filler, chart_js_1.LinearScale, chart_js_1.LineController, chart_js_1.LineElement, chart_js_1.PointElement, chart_js_1.ScatterController, chart_js_1.TimeScale, chart_js_1.TimeSeriesScale, chart_js_1.Tooltip, chartjs_plugin_trendline_1.default, chartjs_plugin_annotation_1.default);
chart_js_1.Chart.defaults.animation.duration = 0;
chart_js_1.Chart.defaults.elements.line.tension = 0.3;
chart_js_1.Chart.defaults.elements.line.fill = "origin";
const TestInput = __importStar(__webpack_require__(/*! ../test/test-input */ "./src/scripts/test/test-input.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
__webpack_require__(/*! chartjs-adapter-date-fns */ "./node_modules/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.esm.js");
class ChartWithUpdateColors extends chart_js_1.Chart {
    constructor(item, config) {
        super(item, config);
    }
    updateColors() {
        updateColors(this);
    }
}
exports.result = new ChartWithUpdateColors($("#wpmChart"), {
    type: "line",
    data: {
        labels: [],
        datasets: [
            {
                label: "wpm",
                data: [],
                borderColor: "rgba(125, 125, 125, 1)",
                borderWidth: 2,
                yAxisID: "wpm",
                order: 2,
                pointRadius: 2,
            },
            {
                label: "raw",
                data: [],
                borderColor: "rgba(125, 125, 125, 1)",
                borderWidth: 2,
                yAxisID: "raw",
                order: 3,
                pointRadius: 2,
            },
            {
                label: "errors",
                data: [],
                borderColor: "rgba(255, 125, 125, 1)",
                pointBackgroundColor: "rgba(255, 125, 125, 1)",
                borderWidth: 2,
                order: 1,
                yAxisID: "error",
                type: "scatter",
                pointStyle: "crossRot",
                pointRadius: function (context) {
                    const index = context.dataIndex;
                    const value = context.dataset.data[index];
                    return (value !== null && value !== void 0 ? value : 0) <= 0 ? 0 : 3;
                },
                pointHoverRadius: function (context) {
                    const index = context.dataIndex;
                    const value = context.dataset.data[index];
                    return (value !== null && value !== void 0 ? value : 0) <= 0 ? 0 : 5;
                },
            },
        ],
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            x: {
                axis: "x",
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                display: true,
                title: {
                    display: false,
                    text: "Seconds",
                },
            },
            wpm: {
                axis: "y",
                display: true,
                title: {
                    display: true,
                    text: "Words per Minute",
                },
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: true,
                },
            },
            raw: {
                axis: "y",
                display: false,
                title: {
                    display: true,
                    text: "Raw Words per Minute",
                },
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: false,
                },
            },
            error: {
                axis: "y",
                display: true,
                position: "right",
                title: {
                    display: true,
                    text: "Errors",
                },
                beginAtZero: true,
                ticks: {
                    precision: 0,
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: false,
                },
            },
        },
        plugins: {
            annotation: {
                annotations: [],
            },
            tooltip: {
                animation: { duration: 250 },
                mode: "index",
                intersect: false,
                callbacks: {
                    afterLabel: function (ti) {
                        try {
                            $(".wordInputAfter").remove();
                            const wordsToHighlight = TestInput.keypressPerSecond[parseInt(ti.label) - 1].words;
                            const unique = [...new Set(wordsToHighlight)];
                            unique.forEach((wordIndex) => {
                                const wordEl = $($("#resultWordsHistory .words .word")[wordIndex]);
                                const input = wordEl.attr("input");
                                if (input != undefined) {
                                    wordEl.append(`<div class="wordInputAfter">${input
                                        .replace(/\t/g, "_")
                                        .replace(/\n/g, "_")
                                        .replace(/</g, "&lt")
                                        .replace(/>/g, "&gt")}</div>`);
                                }
                            });
                        }
                        catch (_a) { }
                        return "";
                    },
                },
            },
        },
    },
});
exports.accountHistory = new ChartWithUpdateColors($(".pageAccount #accountHistoryChart"), {
    type: "line",
    data: {
        labels: [],
        datasets: [
            {
                yAxisID: "wpm",
                label: "wpm",
                fill: false,
                data: [],
                borderColor: "#f44336",
                borderWidth: 2,
                trendlineLinear: {
                    style: "rgba(255,105,180, .8)",
                    lineStyle: "dotted",
                    width: 4,
                },
            },
            {
                yAxisID: "acc",
                label: "acc",
                fill: false,
                data: [],
                borderColor: "#cccccc",
                borderWidth: 2,
            },
        ],
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        hover: {
            mode: "nearest",
            intersect: false,
        },
        scales: {
            x: {
                axis: "x",
                type: "timeseries",
                bounds: "ticks",
                display: false,
                offset: true,
                title: {
                    display: false,
                    text: "Date",
                },
            },
            wpm: {
                axis: "y",
                beginAtZero: true,
                min: 0,
                ticks: {
                    stepSize: 10,
                },
                display: true,
                title: {
                    display: true,
                    text: "Words per Minute",
                },
            },
            acc: {
                axis: "y",
                beginAtZero: true,
                max: 100,
                display: true,
                position: "right",
                title: {
                    display: true,
                    text: "Error rate (100 - accuracy)",
                },
                grid: {
                    display: false,
                },
            },
        },
        plugins: {
            annotation: {
                annotations: [],
            },
            tooltip: {
                animation: { duration: 250 },
                // Disable the on-canvas tooltip
                enabled: true,
                intersect: false,
                external: function (ctx) {
                    if (!ctx)
                        return;
                    ctx.tooltip.options.displayColors = false;
                },
                callbacks: {
                    title: function () {
                        return "";
                    },
                    beforeLabel: function (tooltipItem) {
                        if (tooltipItem.datasetIndex !== 0) {
                            const resultData = tooltipItem.dataset.data[tooltipItem.dataIndex];
                            return `error rate: ${Misc.roundTo2(resultData.errorRate)}%\nacc: ${Misc.roundTo2(100 - resultData.errorRate)}%`;
                        }
                        const resultData = tooltipItem.dataset.data[tooltipItem.dataIndex];
                        let label = `${config_1.default.alwaysShowCPM ? "cpm" : "wpm"}: ${resultData.wpm}` +
                            "\n" +
                            `raw: ${resultData.raw}` +
                            "\n" +
                            `acc: ${resultData.acc}` +
                            "\n\n" +
                            `mode: ${resultData.mode} `;
                        if (resultData.mode == "time") {
                            label += resultData.mode2;
                        }
                        else if (resultData.mode == "words") {
                            label += resultData.mode2;
                        }
                        let diff = resultData.difficulty;
                        if (diff == undefined) {
                            diff = "normal";
                        }
                        label += "\n" + `difficulty: ${diff}`;
                        label +=
                            "\n" +
                                `punctuation: ${resultData.punctuation}` +
                                "\n" +
                                `language: ${resultData.language}` +
                                "\n\n" +
                                `date: ${(0, format_1.default)(new Date(resultData.timestamp), "dd MMM yyyy HH:mm")}`;
                        return label;
                    },
                    label: function () {
                        return "";
                    },
                    afterLabel: function (tooltip) {
                        exports.accountHistoryActiveIndex = tooltip.dataIndex;
                        return "";
                    },
                },
            },
        },
    },
});
exports.accountActivity = new ChartWithUpdateColors($(".pageAccount #accountActivityChart"), {
    type: "bar",
    data: {
        labels: [],
        datasets: [
            {
                yAxisID: "count",
                label: "Seconds",
                data: [],
                trendlineLinear: {
                    style: "rgba(255,105,180, .8)",
                    lineStyle: "dotted",
                    width: 2,
                },
                order: 3,
            },
            {
                yAxisID: "avgWpm",
                label: "Average Wpm",
                data: [],
                type: "line",
                order: 2,
                tension: 0,
                fill: false,
            },
        ],
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        hover: {
            mode: "nearest",
            intersect: false,
        },
        scales: {
            x: {
                axis: "x",
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                type: "time",
                time: {
                    unit: "day",
                    displayFormats: {
                        day: "d MMM",
                    },
                },
                bounds: "ticks",
                display: true,
                title: {
                    display: false,
                    text: "Date",
                },
                offset: true,
            },
            count: {
                axis: "y",
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                    stepSize: 10,
                },
                display: true,
                title: {
                    display: true,
                    text: "Time Typing",
                },
            },
            avgWpm: {
                axis: "y",
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                    stepSize: 10,
                },
                display: true,
                position: "right",
                title: {
                    display: true,
                    text: "Average Wpm",
                },
                grid: {
                    display: false,
                },
            },
        },
        plugins: {
            annotation: {
                annotations: [],
            },
            tooltip: {
                animation: { duration: 250 },
                callbacks: {
                    title: function (tooltipItem) {
                        const resultData = tooltipItem[0].dataset.data[tooltipItem[0].dataIndex];
                        return (0, format_1.default)(new Date(resultData.x), "dd MMM yyyy");
                    },
                    beforeLabel: function (tooltipItem) {
                        const resultData = tooltipItem.dataset.data[tooltipItem.dataIndex];
                        switch (tooltipItem.datasetIndex) {
                            case 0:
                                return `Time Typing: ${Misc.secondsToString(Math.round(resultData.y), true, true)}\nTests Completed: ${resultData.amount}`;
                            case 1:
                                return `Average ${config_1.default.alwaysShowCPM ? "Cpm" : "Wpm"}: ${Misc.roundTo2(resultData.y)}`;
                            default:
                                return "";
                        }
                    },
                    label: function () {
                        return "";
                    },
                },
            },
        },
    },
});
exports.miniResult = new ChartWithUpdateColors($(".pageAccount #miniResultChart"), {
    type: "line",
    data: {
        labels: [],
        datasets: [
            {
                label: "wpm",
                data: [],
                borderColor: "rgba(125, 125, 125, 1)",
                borderWidth: 2,
                yAxisID: "wpm",
                order: 2,
                pointRadius: 2,
            },
            {
                label: "raw",
                data: [],
                borderColor: "rgba(125, 125, 125, 1)",
                borderWidth: 2,
                yAxisID: "raw",
                order: 3,
                pointRadius: 2,
            },
            {
                label: "errors",
                data: [],
                borderColor: "rgba(255, 125, 125, 1)",
                pointBackgroundColor: "rgba(255, 125, 125, 1)",
                borderWidth: 2,
                order: 1,
                yAxisID: "error",
                type: "scatter",
                pointStyle: "crossRot",
                pointRadius: function (context) {
                    const index = context.dataIndex;
                    const value = context.dataset.data[index];
                    return (value !== null && value !== void 0 ? value : 0) <= 0 ? 0 : 3;
                },
                pointHoverRadius: function (context) {
                    const index = context.dataIndex;
                    const value = context.dataset.data[index];
                    return (value !== null && value !== void 0 ? value : 0) <= 0 ? 0 : 5;
                },
            },
        ],
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            x: {
                axis: "x",
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                display: true,
                title: {
                    display: false,
                    text: "Seconds",
                },
            },
            wpm: {
                axis: "y",
                display: true,
                title: {
                    display: true,
                    text: "Words per Minute",
                },
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: true,
                },
            },
            raw: {
                axis: "y",
                display: false,
                title: {
                    display: true,
                    text: "Raw Words per Minute",
                },
                beginAtZero: true,
                min: 0,
                ticks: {
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: false,
                },
            },
            error: {
                display: true,
                position: "right",
                title: {
                    display: true,
                    text: "Errors",
                },
                beginAtZero: true,
                ticks: {
                    precision: 0,
                    autoSkip: true,
                    autoSkipPadding: 20,
                },
                grid: {
                    display: false,
                },
            },
        },
        plugins: {
            annotation: {
                annotations: [],
            },
            tooltip: {
                animation: { duration: 250 },
                mode: "index",
                intersect: false,
            },
        },
    },
});
function updateAccuracy() {
    exports.accountHistory.data.datasets[1].hidden = !config_1.default.chartAccuracy;
    exports.accountHistory.options.scales.acc.display =
        config_1.default.chartAccuracy;
    exports.accountHistory.update();
}
function updateStyle() {
    if (config_1.default.chartStyle == "scatter") {
        exports.accountHistory.data.datasets[0].showLine = false;
        exports.accountHistory.data.datasets[1].showLine = false;
    }
    else {
        exports.accountHistory.data.datasets[0].showLine = true;
        exports.accountHistory.data.datasets[1].showLine = true;
    }
    exports.accountHistory.updateColors();
}
function updateColors(chart) {
    return __awaiter(this, void 0, void 0, function* () {
        const bgcolor = yield ThemeColors.get("bg");
        const subcolor = yield ThemeColors.get("sub");
        const maincolor = yield ThemeColors.get("main");
        const errorcolor = yield ThemeColors.get("error");
        if (chart.data.datasets.every((dataset) => dataset.data.length === 0)) {
            return;
        }
        chart.data.datasets[0].borderColor = maincolor;
        chart.data.datasets[1].borderColor = subcolor;
        if (chart.data.datasets[2]) {
            chart.data.datasets[2].borderColor = errorcolor;
        }
        if (chart.data.datasets[0].type === undefined) {
            if (chart.config.type === "line") {
                chart.data.datasets[0].pointBackgroundColor = maincolor;
            }
            else if (chart.config.type === "bar") {
                chart.data.datasets[0].backgroundColor = maincolor;
            }
        }
        else if (chart.data.datasets[0].type === "bar") {
            chart.data.datasets[0].backgroundColor = maincolor;
        }
        else if (chart.data.datasets[0].type === "line") {
            chart.data.datasets[0].pointBackgroundColor = maincolor;
        }
        if (chart.data.datasets[1].type === undefined) {
            if (chart.config.type === "line") {
                chart.data.datasets[1].pointBackgroundColor = subcolor;
            }
            else if (chart.config.type === "bar") {
                chart.data.datasets[1].backgroundColor = subcolor;
            }
        }
        else if (chart.data.datasets[1].type === "bar") {
            chart.data.datasets[1].backgroundColor = subcolor;
        }
        else if (chart.data.datasets[1].type === "line") {
            chart.data.datasets[1].pointBackgroundColor = subcolor;
        }
        const chartScaleOptions = chart.options;
        Object.keys(chartScaleOptions.scales).forEach((scaleID) => {
            const axis = chartScaleOptions.scales[scaleID];
            axis.ticks.color = subcolor;
            axis.title.color = subcolor;
        });
        try {
            chart.data.datasets[0]
                .trendlineLinear.style = subcolor;
            chart.data.datasets[1]
                .trendlineLinear.style = subcolor;
        }
        catch (_a) { }
        chart.options.plugins.annotation
            .annotations.forEach((annotation) => {
            if (annotation.id !== "funbox-label") {
                annotation.borderColor = subcolor;
            }
            annotation.label.backgroundColor = subcolor;
            annotation.label.color = bgcolor;
        });
        chart.update("none");
    });
}
exports.updateColors = updateColors;
function setDefaultFontFamily(font) {
    chart_js_1.Chart.defaults.font.family = font.replace(/_/g, " ");
}
exports.setDefaultFontFamily = setDefaultFontFamily;
function updateAllChartColors() {
    ThemeColors.update();
    exports.accountHistory.updateColors();
    exports.result.updateColors();
    exports.accountActivity.updateColors();
    exports.miniResult.updateColors();
}
exports.updateAllChartColors = updateAllChartColors;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "chartAccuracy")
        updateAccuracy();
    if (eventKey === "chartStyle")
        updateStyle();
    if (eventKey === "fontFamily")
        setDefaultFontFamily(eventValue);
});


/***/ }),

/***/ "./src/scripts/controllers/input-controller.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/controllers/input-controller.ts ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const TestStats = __importStar(__webpack_require__(/*! ../test/test-stats */ "./src/scripts/test/test-stats.ts"));
const Monkey = __importStar(__webpack_require__(/*! ../test/monkey */ "./src/scripts/test/monkey.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Keymap = __importStar(__webpack_require__(/*! ../elements/keymap */ "./src/scripts/elements/keymap.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const LiveAcc = __importStar(__webpack_require__(/*! ../test/live-acc */ "./src/scripts/test/live-acc.ts"));
const LiveBurst = __importStar(__webpack_require__(/*! ../test/live-burst */ "./src/scripts/test/live-burst.ts"));
const Funbox = __importStar(__webpack_require__(/*! ../test/funbox */ "./src/scripts/test/funbox.ts"));
const Sound = __importStar(__webpack_require__(/*! ./sound-controller */ "./src/scripts/controllers/sound-controller.ts"));
const Caret = __importStar(__webpack_require__(/*! ../test/caret */ "./src/scripts/test/caret.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
const PageController = __importStar(__webpack_require__(/*! ./page-controller */ "./src/scripts/controllers/page-controller.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const LayoutEmulator = __importStar(__webpack_require__(/*! ../test/layout-emulator */ "./src/scripts/test/layout-emulator.ts"));
const PaceCaret = __importStar(__webpack_require__(/*! ../test/pace-caret */ "./src/scripts/test/pace-caret.ts"));
const TimerProgress = __importStar(__webpack_require__(/*! ../test/timer-progress */ "./src/scripts/test/timer-progress.ts"));
const Focus = __importStar(__webpack_require__(/*! ../test/focus */ "./src/scripts/test/focus.ts"));
const ShiftTracker = __importStar(__webpack_require__(/*! ../test/shift-tracker */ "./src/scripts/test/shift-tracker.ts"));
const Replay = __importStar(__webpack_require__(/*! ../test/replay */ "./src/scripts/test/replay.ts"));
const MonkeyPower = __importStar(__webpack_require__(/*! ../elements/monkey-power */ "./src/scripts/elements/monkey-power.ts"));
const WeakSpot = __importStar(__webpack_require__(/*! ../test/weak-spot */ "./src/scripts/test/weak-spot.ts"));
const Leaderboards = __importStar(__webpack_require__(/*! ../elements/leaderboards */ "./src/scripts/elements/leaderboards.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const TestInput = __importStar(__webpack_require__(/*! ../test/test-input */ "./src/scripts/test/test-input.ts"));
const TestWords = __importStar(__webpack_require__(/*! ../test/test-words */ "./src/scripts/test/test-words.ts"));
const WordTypedEvent = __importStar(__webpack_require__(/*! ../observables/word-typed-event */ "./src/scripts/observables/word-typed-event.ts"));
let dontInsertSpace = false;
let correctShiftUsed = true;
const wordsInput = document.getElementById("wordsInput");
function setWordsInput(value) {
    // Only change #wordsInput if it's not already the wanted value
    // Avoids Safari triggering unneeded events, causing issues with
    // dead keys.
    // console.log("settings words input to " + value);
    if (value !== wordsInput.value) {
        wordsInput.value = value;
    }
}
function updateUI() {
    const acc = Misc.roundTo2(TestStats.calculateAccuracy());
    if (!isNaN(acc))
        LiveAcc.update(acc);
    if (config_1.default.keymapMode === "next" && config_1.default.mode !== "zen") {
        Keymap.highlightKey(TestWords.words
            .getCurrent()
            .charAt(TestInput.input.current.length)
            .toString()
            .toUpperCase());
    }
}
function backspaceToPrevious() {
    if (!TestActive.get())
        return;
    if (TestInput.input.history.length == 0 ||
        TestUI.currentWordElementIndex == 0) {
        return;
    }
    if ((TestInput.input.history[TestWords.words.currentIndex - 1] ==
        TestWords.words.get(TestWords.words.currentIndex - 1) &&
        !config_1.default.freedomMode) ||
        $($(".word")[TestWords.words.currentIndex - 1]).hasClass("hidden")) {
        return;
    }
    if (config_1.default.confidenceMode === "on" || config_1.default.confidenceMode === "max") {
        return;
    }
    TestInput.input.current = TestInput.input.popHistory();
    TestInput.corrected.popHistory();
    if (config_1.default.funbox === "nospace" || config_1.default.funbox === "arrows") {
        TestInput.input.current = TestInput.input.current.slice(0, -1);
    }
    TestWords.words.decreaseCurrentIndex();
    TestUI.setCurrentWordElementIndex(TestUI.currentWordElementIndex - 1);
    TestUI.updateActiveElement(true);
    Funbox.toggleScript(TestWords.words.getCurrent());
    TestUI.updateWordElement();
    Caret.updatePosition();
    Replay.addReplayEvent("backWord");
}
function handleSpace() {
    var _a;
    if (!TestActive.get())
        return;
    if (TestInput.input.current === "")
        return;
    if (config_1.default.mode == "zen") {
        $("#words .word.active").removeClass("active");
        $("#words").append("<div class='word active'></div>");
    }
    const currentWord = TestWords.words.getCurrent();
    if (config_1.default.funbox === "layoutfluid" && config_1.default.mode !== "time") {
        // here I need to check if Config.customLayoutFluid exists because of my scuffed solution of returning whenever value is undefined in the setCustomLayoutfluid function
        const layouts = config_1.default.customLayoutfluid
            ? config_1.default.customLayoutfluid.split("#")
            : ["qwerty", "dvorak", "colemak"];
        let index = 0;
        const outof = TestWords.words.length;
        index = Math.floor((TestInput.input.history.length + 1) / (outof / layouts.length));
        if (config_1.default.layout !== layouts[index] && layouts[index] !== undefined) {
            Notifications.add(`--- !!! ${layouts[index]} !!! ---`, 0);
        }
        UpdateConfig.setLayout(layouts[index]);
        UpdateConfig.setKeymapLayout(layouts[index]);
        Keymap.highlightKey(TestWords.words
            .getCurrent()
            .charAt(TestInput.input.current.length)
            .toString()
            .toUpperCase());
        (_a = Settings.groups["layout"]) === null || _a === void 0 ? void 0 : _a.updateInput();
    }
    dontInsertSpace = true;
    const burst = TestStats.calculateBurst();
    LiveBurst.update(Math.round(burst));
    TestInput.pushBurstToHistory(burst);
    //correct word or in zen mode
    const isWordCorrect = currentWord == TestInput.input.current || config_1.default.mode == "zen";
    // This will probably break if letter mode is on or something
    const $currentTestWord = $(`#words .word.active`);
    WordTypedEvent.dispatch(currentWord, isWordCorrect, burst, $currentTestWord);
    MonkeyPower.addPower(isWordCorrect, true);
    TestInput.incrementAccuracy(isWordCorrect);
    if (isWordCorrect) {
        PaceCaret.handleSpace(true, currentWord);
        TestInput.input.pushHistory();
        TestWords.words.increaseCurrentIndex();
        TestUI.setCurrentWordElementIndex(TestUI.currentWordElementIndex + 1);
        TestUI.updateActiveElement();
        Funbox.toggleScript(TestWords.words.getCurrent());
        Caret.updatePosition();
        TestInput.incrementKeypressCount();
        TestInput.pushKeypressWord(TestWords.words.currentIndex);
        if (config_1.default.funbox !== "nospace" && config_1.default.funbox !== "arrows") {
            Sound.playClick();
        }
        Replay.addReplayEvent("submitCorrectWord");
    }
    else {
        if (config_1.default.funbox !== "nospace" && config_1.default.funbox !== "arrows") {
            if (!config_1.default.playSoundOnError || config_1.default.blindMode) {
                Sound.playClick();
            }
            else {
                Sound.playError();
            }
        }
        TestInput.pushMissedWord(TestWords.words.getCurrent());
        TestInput.incrementKeypressErrors();
        const cil = TestInput.input.current.length;
        if (cil <= TestWords.words.getCurrent().length) {
            if (cil >= TestInput.corrected.current.length) {
                TestInput.corrected.current += "_";
            }
            else {
                TestInput.corrected.current =
                    TestInput.corrected.current.substring(0, cil) +
                        "_" +
                        TestInput.corrected.current.substring(cil + 1);
            }
        }
        if (config_1.default.stopOnError != "off") {
            if (config_1.default.difficulty == "expert" || config_1.default.difficulty == "master") {
                //failed due to diff when pressing space
                TestLogic.fail("difficulty");
                return;
            }
            if (config_1.default.stopOnError == "word") {
                dontInsertSpace = false;
                Replay.addReplayEvent("incorrectLetter", "_");
                TestUI.updateWordElement(true);
                Caret.updatePosition();
            }
            return;
        }
        PaceCaret.handleSpace(false, currentWord);
        if (config_1.default.blindMode && config_1.default.highlightMode !== "off") {
            $("#words .word.active letter").addClass("correct");
        }
        TestInput.input.pushHistory();
        TestUI.highlightBadWord(TestUI.currentWordElementIndex, !config_1.default.blindMode);
        TestWords.words.increaseCurrentIndex();
        TestUI.setCurrentWordElementIndex(TestUI.currentWordElementIndex + 1);
        TestUI.updateActiveElement();
        Funbox.toggleScript(TestWords.words.getCurrent());
        Caret.updatePosition();
        TestInput.incrementKeypressCount();
        TestInput.pushKeypressWord(TestWords.words.currentIndex);
        TestInput.updateLastKeypress();
        if (config_1.default.difficulty == "expert" || config_1.default.difficulty == "master") {
            TestLogic.fail("difficulty");
            return;
        }
        else if (TestWords.words.currentIndex == TestWords.words.length) {
            //submitted last word that is incorrect
            TestLogic.finish();
            return;
        }
        Replay.addReplayEvent("submitErrorWord");
    }
    let wordLength;
    if (config_1.default.mode === "zen") {
        wordLength = TestInput.input.current.length;
    }
    else {
        wordLength = TestWords.words.getCurrent().length;
    }
    const flex = Misc.whorf(config_1.default.minBurstCustomSpeed, wordLength);
    if ((config_1.default.minBurst === "fixed" && burst < config_1.default.minBurstCustomSpeed) ||
        (config_1.default.minBurst === "flex" && burst < flex)) {
        TestLogic.fail("min burst");
        return;
    }
    TestInput.corrected.pushHistory();
    if (!config_1.default.showAllLines ||
        config_1.default.mode == "time" ||
        (CustomText.isWordRandom && CustomText.word == 0) ||
        CustomText.isTimeRandom) {
        const currentTop = Math.floor(document.querySelectorAll("#words .word")[TestUI.currentWordElementIndex - 1].offsetTop);
        let nextTop;
        try {
            nextTop = Math.floor(document.querySelectorAll("#words .word")[TestUI.currentWordElementIndex].offsetTop);
        }
        catch (e) {
            nextTop = 0;
        }
        if (nextTop > currentTop && !TestUI.lineTransition) {
            TestUI.lineJump(currentTop);
        }
    } //end of line wrap
    if (config_1.default.keymapMode === "react") {
        Keymap.flashKey(" ", true);
    }
    if (config_1.default.mode === "words" ||
        config_1.default.mode === "custom" ||
        config_1.default.mode === "quote" ||
        config_1.default.mode === "zen") {
        TimerProgress.update();
    }
    if (config_1.default.mode == "time" ||
        config_1.default.mode == "words" ||
        config_1.default.mode == "custom" ||
        config_1.default.mode == "quote") {
        TestLogic.addWord();
    }
}
function isCharCorrect(char, charIndex) {
    if (!correctShiftUsed)
        return false;
    if (config_1.default.mode == "zen") {
        return true;
    }
    const originalChar = TestWords.words.getCurrent()[charIndex];
    if (originalChar == char) {
        return true;
    }
    if (config_1.default.language.split("_")[0] == "russian") {
        if ((char === "" || char === "e") && originalChar == "") {
            return true;
        }
        if (char === "" && (originalChar == "" || originalChar === "e")) {
            return true;
        }
    }
    if (config_1.default.funbox === "arrows") {
        if ((char === "w" || char === "ArrowUp") && originalChar == "") {
            return true;
        }
        if ((char === "s" || char === "ArrowDown") && originalChar == "") {
            return true;
        }
        if ((char === "a" || char === "ArrowLeft") && originalChar == "") {
            return true;
        }
        if ((char === "d" || char === "ArrowRight") && originalChar == "") {
            return true;
        }
    }
    if ((char === `` || char === "" || char === "'") &&
        (originalChar == `` || originalChar === "" || originalChar === "'")) {
        return true;
    }
    if ((char === `"` || char === "" || char == "" || char === "") &&
        (originalChar == `"` ||
            originalChar === "" ||
            originalChar === "" ||
            originalChar === "")) {
        return true;
    }
    if ((char === "" || char === "" || char == "-") &&
        (originalChar == "-" || originalChar === "" || originalChar === "")) {
        return true;
    }
    return false;
}
function handleChar(char, charIndex) {
    var _a, _b, _c, _d;
    if (TestUI.resultCalculating || TestUI.resultVisible) {
        return;
    }
    if (char === "") {
        for (let i = 0; i < 3; i++) {
            handleChar(".", charIndex + i);
        }
        return;
    }
    if (char === "\n" && config_1.default.funbox === "58008") {
        char = " ";
    }
    if (char !== "\n" && char !== "\t" && /\s/.test(char)) {
        if (config_1.default.funbox === "nospace" || config_1.default.funbox === "arrows")
            return;
        handleSpace();
        //insert space for expert and master or strict space,
        //or for stop on error set to word,
        //otherwise dont do anything
        if (config_1.default.difficulty !== "normal" ||
            (config_1.default.strictSpace && config_1.default.mode !== "zen") ||
            config_1.default.stopOnError === "word") {
            if (dontInsertSpace) {
                dontInsertSpace = false;
                return;
            }
        }
        else {
            return;
        }
    }
    if (config_1.default.mode !== "zen" &&
        TestWords.words.getCurrent()[charIndex] !== "\n" &&
        char === "\n") {
        return;
    }
    //start the test
    if (!TestActive.get() && !TestLogic.startTest()) {
        return;
    }
    Focus.set(true);
    Caret.stopAnimation();
    const thisCharCorrect = isCharCorrect(char, charIndex);
    if (thisCharCorrect && config_1.default.mode !== "zen") {
        char = TestWords.words.getCurrent().charAt(charIndex);
    }
    if (!thisCharCorrect && char === "\n") {
        if (TestInput.input.current === "")
            return;
        char = " ";
    }
    if (TestInput.input.current === "") {
        TestInput.setBurstStart(performance.now());
    }
    const resultingWord = TestInput.input.current.substring(0, charIndex) +
        char +
        TestInput.input.current.substring(charIndex + 1);
    if (!thisCharCorrect && Misc.trailingComposeChars.test(resultingWord)) {
        TestInput.input.current = resultingWord;
        TestUI.updateWordElement();
        Caret.updatePosition();
        return;
    }
    MonkeyPower.addPower(thisCharCorrect);
    TestInput.incrementAccuracy(thisCharCorrect);
    if (!thisCharCorrect) {
        TestInput.incrementKeypressErrors();
        TestInput.pushMissedWord(TestWords.words.getCurrent());
    }
    WeakSpot.updateScore(config_1.default.mode === "zen" ? char : TestWords.words.getCurrent()[charIndex], thisCharCorrect);
    if (thisCharCorrect) {
        Sound.playClick();
    }
    else {
        if (!config_1.default.playSoundOnError || config_1.default.blindMode) {
            Sound.playClick();
        }
        else {
            Sound.playError();
        }
    }
    if (!correctShiftUsed && config_1.default.difficulty != "master")
        return;
    //update current corrected version. if its empty then add the current char. if its not then replace the last character with the currently pressed one / add it
    if (TestInput.corrected.current === "") {
        TestInput.corrected.current += resultingWord;
    }
    else {
        if (charIndex >= TestInput.corrected.current.length) {
            TestInput.corrected.current += char;
        }
        else if (!thisCharCorrect) {
            TestInput.corrected.current =
                TestInput.corrected.current.substring(0, charIndex) +
                    char +
                    TestInput.corrected.current.substring(charIndex + 1);
        }
    }
    TestInput.incrementKeypressCount();
    TestInput.updateLastKeypress();
    TestInput.pushKeypressWord(TestWords.words.currentIndex);
    if (config_1.default.difficulty !== "master" &&
        config_1.default.stopOnError == "letter" &&
        !thisCharCorrect) {
        return;
    }
    Replay.addReplayEvent(thisCharCorrect ? "correctLetter" : "incorrectLetter", char);
    //update the active word top, but only once
    if (TestInput.input.current.length === 1 &&
        TestWords.words.currentIndex === 0) {
        TestUI.setActiveWordTop((_a = document.querySelector("#words .active")) === null || _a === void 0 ? void 0 : _a.offsetTop);
    }
    //max length of the input is 20 unless in zen mode then its 30
    if ((config_1.default.mode === "zen" && charIndex < 30) ||
        (config_1.default.mode !== "zen" &&
            charIndex < TestWords.words.getCurrent().length + 20)) {
        TestInput.input.current = resultingWord;
    }
    if (!thisCharCorrect && config_1.default.difficulty == "master") {
        TestInput.input.pushHistory();
        TestInput.corrected.pushHistory();
        TestLogic.fail("difficulty");
        return;
    }
    //keymap
    if (config_1.default.keymapMode === "react") {
        Keymap.flashKey(char, thisCharCorrect);
    }
    if (config_1.default.mode != "zen") {
        //not applicable to zen mode
        //auto stop the test if the last word is correct
        const currentWord = TestWords.words.getCurrent();
        const lastindex = TestWords.words.currentIndex;
        if ((currentWord == TestInput.input.current ||
            (config_1.default.quickEnd &&
                currentWord.length == TestInput.input.current.length &&
                config_1.default.stopOnError == "off")) &&
            lastindex == TestWords.words.length - 1) {
            TestInput.input.pushHistory();
            TestInput.corrected.pushHistory();
            TestLogic.finish();
            return;
        }
    }
    const activeWordTopBeforeJump = (_b = document.querySelector("#words .word.active")) === null || _b === void 0 ? void 0 : _b.offsetTop;
    TestUI.updateWordElement();
    if (!config_1.default.hideExtraLetters) {
        const newActiveTop = (_c = document.querySelector("#words .word.active")) === null || _c === void 0 ? void 0 : _c.offsetTop;
        //stop the word jump by slicing off the last character, update word again
        if (activeWordTopBeforeJump < newActiveTop &&
            !TestUI.lineTransition &&
            TestInput.input.current.length > 1) {
            if (config_1.default.mode == "zen") {
                const currentTop = Math.floor((_d = document.querySelectorAll("#words .word")[TestUI.currentWordElementIndex - 1]) === null || _d === void 0 ? void 0 : _d.offsetTop);
                if (!config_1.default.showAllLines)
                    TestUI.lineJump(currentTop);
            }
            else {
                TestInput.input.current = TestInput.input.current.slice(0, -1);
                TestUI.updateWordElement();
            }
        }
    }
    //simulate space press in nospace funbox
    if (((config_1.default.funbox === "nospace" || config_1.default.funbox === "arrows") &&
        TestInput.input.current.length === TestWords.words.getCurrent().length) ||
        (char === "\n" && thisCharCorrect)) {
        handleSpace();
    }
    if (char !== "\n") {
        Caret.updatePosition();
    }
}
function handleTab(event, popupVisible) {
    //todo refactor this mess
    if (TestUI.resultCalculating) {
        event.preventDefault();
    }
    if (ActivePage.get() !== "test" && popupVisible) {
        // event.preventDefault();
        return;
    }
    if ($("#customTextPopup .textarea").is(":focus")) {
        event.preventDefault();
        const area = $("#customTextPopup .textarea")[0];
        const start = area.selectionStart;
        const end = area.selectionEnd;
        // set textarea value to: text before caret + tab + text after caret
        area.value =
            area.value.substring(0, start) + "\t" + area.value.substring(end);
        // put caret at right position again
        area.selectionStart = area.selectionEnd = start + 1;
        return;
    }
    else if (!TestUI.resultCalculating &&
        $("#commandLineWrapper").hasClass("hidden") &&
        $("#simplePopupWrapper").hasClass("hidden") &&
        $("#quoteSubmitPopupWrapper").hasClass("hidden") &&
        ActivePage.get() != "login") {
        if (ActivePage.get() == "test") {
            if (config_1.default.quickTab) {
                if (!$("#leaderboardsWrapper").hasClass("hidden")) {
                    Leaderboards.hide();
                }
                if (popupVisible) {
                    event.preventDefault();
                    return;
                }
                if (TestUI.resultVisible ||
                    !((config_1.default.mode == "zen" && !event.shiftKey) ||
                        (TestWords.hasTab && !event.shiftKey))) {
                    if (event.shiftKey) {
                        ManualRestart.set();
                    }
                    else {
                        ManualRestart.reset();
                    }
                    event.preventDefault();
                    if (TestActive.get() &&
                        config_1.default.repeatQuotes === "typing" &&
                        config_1.default.mode === "quote") {
                        TestLogic.restart(true, false, event);
                    }
                    else {
                        TestLogic.restart(false, false, event);
                    }
                }
                else {
                    event.preventDefault();
                    handleChar("\t", TestInput.input.current.length);
                    setWordsInput(" " + TestInput.input.current);
                }
            }
            else if (!TestUI.resultVisible) {
                if ((TestWords.hasTab && event.shiftKey) ||
                    (!TestWords.hasTab && config_1.default.mode !== "zen") ||
                    (config_1.default.mode === "zen" && event.shiftKey)) {
                    event.preventDefault();
                    $("#restartTestButton").trigger("focus");
                }
                else {
                    event.preventDefault();
                    handleChar("\t", TestInput.input.current.length);
                    setWordsInput(" " + TestInput.input.current);
                }
            }
        }
        else if (config_1.default.quickTab) {
            event.preventDefault();
            PageController.change("test");
        }
    }
}
$(document).keydown((event) => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    if (ActivePage.get() == "loading")
        return event.preventDefault();
    //autofocus
    const wordsFocused = $("#wordsInput").is(":focus");
    const pageTestActive = ActivePage.get() === "test";
    const commandLineVisible = !$("#commandLineWrapper").hasClass("hidden");
    const leaderboardsVisible = !$("#leaderboardsWrapper").hasClass("hidden");
    const popups = document.querySelectorAll(".popupWrapper");
    let popupVisible = false;
    for (const popup of popups) {
        if (!popup.classList.contains("hidden") === true) {
            popupVisible = true;
            break;
        }
    }
    const allowTyping = pageTestActive &&
        !commandLineVisible &&
        !leaderboardsVisible &&
        !popupVisible &&
        !TestUI.resultVisible &&
        (wordsFocused || event.key !== "Enter");
    if (allowTyping && !wordsFocused && event.key !== "Enter") {
        TestUI.focusWords();
        if (config_1.default.showOutOfFocusWarning) {
            event.preventDefault();
        }
    }
    //tab
    if ((event.key == "Tab" && !config_1.default.swapEscAndTab) ||
        (event.key == "Escape" && config_1.default.swapEscAndTab)) {
        handleTab(event, popupVisible);
    }
    if (!allowTyping)
        return;
    if (!((_a = event.originalEvent) === null || _a === void 0 ? void 0 : _a.isTrusted) || TestUI.testRestarting) {
        event.preventDefault();
        return;
    }
    if (TestInput.spacingDebug) {
        console.log("spacing debug", "keypress", event.key, "length", TestInput.keypressTimings.spacing.array.length);
    }
    TestInput.recordKeypressSpacing();
    TestInput.setKeypressDuration(performance.now());
    TestInput.setKeypressNotAfk();
    //blocking firefox from going back in history with backspace
    if (event.key === "Backspace") {
        Sound.playClick();
        const t = /INPUT|SELECT|TEXTAREA/i;
        if (!t.test(event.target.tagName)
        // if this breaks in the future, call mio and tell him to stop being lazy
        // (event.target as unknown as KeyboardEvent).disabled ||
        // (event.target as unknown as Element).readOnly
        ) {
            event.preventDefault();
        }
        if (config_1.default.confidenceMode === "max") {
            event.preventDefault();
            return;
        }
    }
    if (config_1.default.funbox !== "arrows" && /Arrow/i.test(event.key)) {
        event.preventDefault();
        return;
    }
    Monkey.type();
    if (event.key === "Backspace" && TestInput.input.current.length === 0) {
        backspaceToPrevious();
        if (TestInput.input.current) {
            setWordsInput(" " + TestInput.input.current + " ");
        }
    }
    if (event.key === "Enter") {
        if (event.shiftKey && config_1.default.mode == "zen") {
            TestLogic.finish();
        }
        else if (event.shiftKey &&
            ((config_1.default.mode == "time" && config_1.default.time === 0) ||
                (config_1.default.mode == "words" && config_1.default.words === 0))) {
            TestInput.setBailout(true);
            TestLogic.finish();
        }
        else {
            handleChar("\n", TestInput.input.current.length);
            setWordsInput(" " + TestInput.input.current);
        }
    }
    //show dead keys
    if (event.key === "Dead" &&
        !Misc.trailingComposeChars.test(TestInput.input.current)) {
        Sound.playClick();
        const word = document.querySelector("#words .word.active");
        const len = TestInput.input.current.length; // have to do this because prettier wraps the line and causes an error
        word === null || word === void 0 ? void 0 : word.querySelectorAll("letter")[len].classList.toggle("dead");
    }
    if (config_1.default.oppositeShiftMode !== "off") {
        correctShiftUsed =
            (yield ShiftTracker.isUsingOppositeShift(event)) !== false;
    }
    if (config_1.default.funbox === "arrows") {
        let char = event.key;
        if (["ArrowLeft", "ArrowUp", "ArrowRight", "ArrowDown"].includes(char)) {
            if (char === "ArrowLeft")
                char = "a";
            if (char === "ArrowRight")
                char = "d";
            if (char === "ArrowDown")
                char = "s";
            if (char === "ArrowUp")
                char = "w";
            event.preventDefault();
            handleChar(char, TestInput.input.current.length);
            updateUI();
            setWordsInput(" " + TestInput.input.current);
        }
    }
    else if (config_1.default.layout !== "default" &&
        !(event.ctrlKey ||
            (event.altKey && window.navigator.platform.search("Linux") > -1))) {
        const char = yield LayoutEmulator.getCharFromEvent(event);
        if (char !== null) {
            event.preventDefault();
            handleChar(char, TestInput.input.current.length);
            updateUI();
            setWordsInput(" " + TestInput.input.current);
        }
    }
}));
$("#wordsInput").keyup((event) => {
    var _a;
    if (!((_a = event.originalEvent) === null || _a === void 0 ? void 0 : _a.isTrusted) || TestUI.testRestarting) {
        event.preventDefault();
        return;
    }
    if (TestUI.resultVisible)
        return;
    const now = performance.now();
    if (TestInput.keypressTimings.duration.current !== -1) {
        const diff = Math.abs(TestInput.keypressTimings.duration.current - now);
        TestInput.pushKeypressDuration(diff);
    }
    TestInput.setKeypressDuration(now);
    Monkey.stop();
});
$("#wordsInput").on("beforeinput", (event) => {
    var _a;
    if (!((_a = event.originalEvent) === null || _a === void 0 ? void 0 : _a.isTrusted))
        return;
    if (event.target.value === "") {
        event.target.value = " ";
    }
});
$("#wordsInput").on("input", (event) => {
    var _a;
    if (!((_a = event.originalEvent) === null || _a === void 0 ? void 0 : _a.isTrusted) || TestUI.testRestarting) {
        event.target.value = " ";
        return;
    }
    TestInput.setKeypressNotAfk();
    const realInputValue = event.target.value.normalize();
    const inputValue = realInputValue.slice(1);
    // input will be modified even with the preventDefault() in
    // beforeinput/keydown if it's part of a compose sequence. this undoes
    // the effects of that and takes the input out of compose mode.
    if (config_1.default.layout !== "default" &&
        inputValue.length >= TestInput.input.current.length) {
        setWordsInput(" " + TestInput.input.current);
        return;
    }
    if (realInputValue.length === 0 && TestInput.input.current.length === 0) {
        // fallback for when no Backspace keydown event (mobile)
        backspaceToPrevious();
    }
    else if (inputValue.length < TestInput.input.current.length) {
        TestInput.input.current = inputValue;
        TestUI.updateWordElement();
        Caret.updatePosition();
        if (!Misc.trailingComposeChars.test(TestInput.input.current)) {
            Replay.addReplayEvent("setLetterIndex", TestInput.input.current.length);
        }
    }
    else if (inputValue !== TestInput.input.current) {
        let diffStart = 0;
        while (inputValue[diffStart] === TestInput.input.current[diffStart]) {
            diffStart++;
        }
        for (let i = diffStart; i < inputValue.length; i++) {
            handleChar(inputValue[i], i);
        }
    }
    setWordsInput(" " + TestInput.input.current);
    updateUI();
    // force caret at end of input
    // doing it on next cycle because Chromium on Android won't let me edit
    // the selection inside the input event
    setTimeout(() => {
        var _a;
        if (event.target.selectionStart !==
            event.target.value.length &&
            (!Misc.trailingComposeChars.test(event.target.value) ||
                ((_a = event.target.selectionStart) !== null && _a !== void 0 ? _a : 0) <
                    event.target.value.search(Misc.trailingComposeChars))) {
            event.target.selectionStart = event.target.selectionEnd = event.target.value.length;
        }
    }, 0);
});
$("#wordsInput").on("focus", (event) => {
    event.target.selectionStart = event.target.selectionEnd = event.target.value.length;
});
$("#wordsInput").on("copy paste", (event) => {
    event.preventDefault();
});


/***/ }),

/***/ "./src/scripts/controllers/page-controller.ts":
/*!****************************************************!*\
  !*** ./src/scripts/controllers/page-controller.ts ***!
  \****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.change = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const Account = __importStar(__webpack_require__(/*! ../pages/account */ "./src/scripts/pages/account.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const PageTest = __importStar(__webpack_require__(/*! ../pages/test */ "./src/scripts/pages/test.ts"));
const PageAbout = __importStar(__webpack_require__(/*! ../pages/about */ "./src/scripts/pages/about.ts"));
const PageChangeEvent = __importStar(__webpack_require__(/*! ../observables/page-change-event */ "./src/scripts/observables/page-change-event.ts"));
const PageLogin = __importStar(__webpack_require__(/*! ../pages/login */ "./src/scripts/pages/login.ts"));
const PageLoading = __importStar(__webpack_require__(/*! ../pages/loading */ "./src/scripts/pages/loading.ts"));
const PageTransition = __importStar(__webpack_require__(/*! ../states/page-transition */ "./src/scripts/states/page-transition.ts"));
function change(page) {
    if (PageTransition.get()) {
        console.log(`change page ${page} stopped`);
        return;
    }
    console.log(`change page ${page}`);
    if (page === "")
        page = "test";
    if (page == undefined) {
        //use window loacation
        const pages = {
            "/": "test",
            "/login": "login",
            "/settings": "settings",
            "/about": "about",
            "/account": "account",
        };
        let path = pages[window.location.pathname];
        if (!path) {
            path = "test";
        }
        page = path;
    }
    if (ActivePage.get() === page) {
        console.log(`page ${page} already active`);
        return;
    }
    const pages = {
        loading: PageLoading.page,
        test: PageTest.page,
        settings: Settings.page,
        about: PageAbout.page,
        account: Account.page,
        login: PageLogin.page,
    };
    const previousPage = pages[ActivePage.get()];
    const nextPage = pages[page];
    previousPage === null || previousPage === void 0 ? void 0 : previousPage.beforeHide();
    PageTransition.set(true);
    ActivePage.set(undefined);
    $(".page").removeClass("active");
    Misc.swapElements(previousPage.element, nextPage.element, 250, () => {
        PageTransition.set(false);
        ActivePage.set(nextPage.name);
        previousPage === null || previousPage === void 0 ? void 0 : previousPage.afterHide();
        nextPage.element.addClass("active");
        history.pushState(nextPage.pathname, "", nextPage.pathname);
        nextPage === null || nextPage === void 0 ? void 0 : nextPage.afterShow();
    }, () => __awaiter(this, void 0, void 0, function* () {
        yield (nextPage === null || nextPage === void 0 ? void 0 : nextPage.beforeShow());
    }));
    PageChangeEvent.dispatch(previousPage, nextPage);
}
exports.change = change;
$(document).on("click", "#top .logo", () => {
    change("test");
});
$(document).on("click", "#top #menu .icon-button", (e) => {
    if (!$(e.currentTarget).hasClass("leaderboards")) {
        const href = $(e.currentTarget).attr("href");
        ManualRestart.set();
        change(href.replace("/", ""));
    }
    return false;
});
$(".pageTest .loginTip .link").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    change("login");
}));


/***/ }),

/***/ "./src/scripts/controllers/preset-controller.ts":
/*!******************************************************!*\
  !*** ./src/scripts/controllers/preset-controller.ts ***!
  \******************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.apply = void 0;
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const TagController = __importStar(__webpack_require__(/*! ./tag-controller */ "./src/scripts/controllers/tag-controller.ts"));
function apply(_id) {
    var _a;
    // console.log(DB.getSnapshot().presets);
    const snapshot = DB.getSnapshot();
    (_a = snapshot.presets) === null || _a === void 0 ? void 0 : _a.forEach((preset) => {
        if (preset._id == _id) {
            UpdateConfig.apply(preset.config);
            TagController.clear(true);
            if (preset.config.tags) {
                preset.config.tags.forEach((tagid) => {
                    TagController.set(tagid, true, false);
                });
            }
            TestLogic.restart();
            Notifications.add("Preset applied", 1, 2);
            UpdateConfig.saveFullConfigToLocalStorage();
        }
    });
}
exports.apply = apply;


/***/ }),

/***/ "./src/scripts/controllers/quotes-controller.ts":
/*!******************************************************!*\
  !*** ./src/scripts/controllers/quotes-controller.ts ***!
  \******************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
const config_event_1 = __webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts");
const defaultQuoteCollection = {
    quotes: [],
    length: 0,
    language: null,
    groups: [],
};
class QuotesController {
    constructor() {
        this.quoteCollection = defaultQuoteCollection;
        this.quoteQueue = [];
        this.queueIndex = 0;
    }
    getQuotes(language, quoteLengths) {
        return __awaiter(this, void 0, void 0, function* () {
            const normalizedLanguage = language.replace(/_\d*k$/g, "");
            if (this.quoteCollection.language !== normalizedLanguage) {
                try {
                    const data = yield $.getJSON(`quotes/${normalizedLanguage}.json`);
                    if (data.quotes === undefined || data.quotes.length === 0) {
                        return defaultQuoteCollection;
                    }
                    this.quoteCollection = {
                        quotes: [],
                        length: data.quotes.length,
                        groups: [],
                        language: data.language,
                    };
                    // Transform JSON Quote schema to MonkeyTypes Quote schema
                    data.quotes.forEach((quote) => {
                        const monkeyTypeQuote = {
                            text: quote.text,
                            source: quote.source,
                            length: quote.length,
                            id: quote.id,
                            language: data.language,
                            group: 0,
                        };
                        this.quoteCollection.quotes.push(monkeyTypeQuote);
                    });
                    data.groups.forEach((quoteGroup, groupIndex) => {
                        const lower = quoteGroup[0];
                        const upper = quoteGroup[1];
                        this.quoteCollection.groups[groupIndex] =
                            this.quoteCollection.quotes.filter((quote) => {
                                if (quote.length >= lower && quote.length <= upper) {
                                    quote.group = groupIndex;
                                    return true;
                                }
                                return false;
                            });
                    });
                    if (quoteLengths !== undefined) {
                        this.updateQuoteQueue(quoteLengths);
                    }
                }
                catch (_a) {
                    return defaultQuoteCollection;
                }
            }
            return this.quoteCollection;
        });
    }
    getQuoteById(id) {
        const targetQuote = this.quoteCollection.quotes.find((quote) => {
            return quote.id === id;
        });
        return targetQuote;
    }
    updateQuoteQueue(quoteGroups) {
        this.quoteQueue = [];
        quoteGroups.forEach((group) => {
            var _a;
            if (group < 0) {
                return;
            }
            (_a = this.quoteCollection.groups[group]) === null || _a === void 0 ? void 0 : _a.forEach((quote) => {
                this.quoteQueue.push(quote);
            });
        });
        (0, misc_1.shuffle)(this.quoteQueue);
        this.queueIndex = 0;
    }
    getRandomQuote() {
        if (this.quoteQueue.length === 0) {
            return null;
        }
        if (this.queueIndex >= this.quoteQueue.length) {
            this.queueIndex = 0;
            (0, misc_1.shuffle)(this.quoteQueue);
        }
        const randomQuote = this.quoteQueue[this.queueIndex];
        this.queueIndex += 1;
        return randomQuote;
    }
    getCurrentQuote() {
        if (this.quoteQueue.length === 0) {
            return null;
        }
        return this.quoteQueue[this.queueIndex];
    }
}
const quoteController = new QuotesController();
(0, config_event_1.subscribe)((key, newValue) => {
    if (key === "quoteLength") {
        quoteController.updateQuoteQueue(newValue);
    }
});
exports["default"] = quoteController;


/***/ }),

/***/ "./src/scripts/controllers/route-controller.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/controllers/route-controller.ts ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.handleInitialPageClasses = void 0;
// import * as Funbox from "../test/funbox";
const PageController = __importStar(__webpack_require__(/*! ./page-controller */ "./src/scripts/controllers/page-controller.ts"));
// import Config from "../config";
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const mappedRoutes = {
    "/": "pageLoading",
    "/login": "pageLoading",
    "/settings": "pageLoading",
    "/about": "pageLoading",
    "/account": "pageAccount",
    "/verify": "pageLoading",
};
function handleInitialPageClasses(pathname) {
    if (!mappedRoutes[pathname]) {
        pathname = "/";
    }
    const el = $(".page." + mappedRoutes[pathname]);
    $(el).removeClass("hidden");
    $(el).addClass("active");
    let pageName = "loading";
    if (pathname === "/account")
        pageName = "account";
    ActivePage.set(pageName);
}
exports.handleInitialPageClasses = handleInitialPageClasses;
// honestly im not sure what this does
// (function (history): void {
//   const pushState = history.pushState;
//   history.pushState = function (state): void {
//     if (Config.funbox === "memory" && state !== "/") {
//       Funbox.resetMemoryTimer();
//     }
//     // @ts-ignore
//     return pushState.apply(history, arguments);
//   };
// })(window.history);
$(window).on("popstate", (e) => {
    const state = e.originalEvent.state;
    if (state == "" || state == "/") {
        // show test
        PageController.change("test");
    }
    else if (state == "about") {
        // show about
        PageController.change("about");
    }
    else if (state == "account" || state == "login") {
        if (firebase_1.Auth.currentUser) {
            PageController.change("account");
        }
        else {
            PageController.change("login");
        }
    }
});


/***/ }),

/***/ "./src/scripts/controllers/sound-controller.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/controllers/sound-controller.ts ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.setVolume = exports.playError = exports.playClick = exports.previewClick = exports.init = exports.initErrorSound = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const howler_1 = __importStar(__webpack_require__(/*! howler */ "./node_modules/howler/dist/howler.js"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
let errorSound = null;
let clickSounds = null;
function initErrorSound() {
    if (errorSound !== null)
        return;
    errorSound = new howler_1.Howl({ src: ["../sound/error.wav"] });
}
exports.initErrorSound = initErrorSound;
function init() {
    if (clickSounds !== null)
        return;
    clickSounds = {
        1: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click1/click1_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click1/click1_1.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click1/click1_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click1/click1_2.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click1/click1_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click1/click1_3.wav" }),
                ],
                counter: 0,
            },
        ],
        2: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click2/click2_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click2/click2_1.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click2/click2_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click2/click2_2.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click2/click2_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click2/click2_3.wav" }),
                ],
                counter: 0,
            },
        ],
        3: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click3/click3_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click3/click3_1.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click3/click3_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click3/click3_2.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click3/click3_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click3/click3_3.wav" }),
                ],
                counter: 0,
            },
        ],
        4: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_11.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_22.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_33.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_4.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_44.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_5.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_55.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click4/click4_6.wav" }),
                    new howler_1.Howl({ src: "../sound/click4/click4_66.wav" }),
                ],
                counter: 0,
            },
        ],
        5: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_11.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_22.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_33.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_4.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_44.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_5.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_55.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click5/click5_6.wav" }),
                    new howler_1.Howl({ src: "../sound/click5/click5_66.wav" }),
                ],
                counter: 0,
            },
        ],
        6: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click6/click6_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click6/click6_11.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click6/click6_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click6/click6_22.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click6/click6_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click6/click6_33.wav" }),
                ],
                counter: 0,
            },
        ],
        7: [
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click7/click7_1.wav" }),
                    new howler_1.Howl({ src: "../sound/click7/click7_11.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click7/click7_2.wav" }),
                    new howler_1.Howl({ src: "../sound/click7/click7_22.wav" }),
                ],
                counter: 0,
            },
            {
                sounds: [
                    new howler_1.Howl({ src: "../sound/click7/click7_3.wav" }),
                    new howler_1.Howl({ src: "../sound/click7/click7_33.wav" }),
                ],
                counter: 0,
            },
        ],
    };
}
exports.init = init;
function previewClick(val) {
    if (clickSounds === null)
        init();
    clickSounds[val][0].sounds[0].seek(0);
    clickSounds[val][0].sounds[0].play();
}
exports.previewClick = previewClick;
function playClick() {
    if (config_1.default.playSoundOnClick === "off")
        return;
    if (clickSounds === null)
        init();
    const randomSound = (0, misc_1.randomElementFromArray)(clickSounds[config_1.default.playSoundOnClick]);
    randomSound.counter++;
    if (randomSound.counter === 2)
        randomSound.counter = 0;
    randomSound.sounds[randomSound.counter].seek(0);
    randomSound.sounds[randomSound.counter].play();
}
exports.playClick = playClick;
function playError() {
    if (!config_1.default.playSoundOnError)
        return;
    if (errorSound === null)
        initErrorSound();
    errorSound.seek(0);
    errorSound.play();
}
exports.playError = playError;
function setVolume(val) {
    // not sure why it complains but it works
    // @ts-ignore
    howler_1.default.Howler.volume(val);
}
exports.setVolume = setVolume;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "playSoundOnClick" && eventValue !== "off")
        init();
    if (eventKey === "soundVolume")
        setVolume(eventValue);
});


/***/ }),

/***/ "./src/scripts/controllers/tag-controller.ts":
/*!***************************************************!*\
  !*** ./src/scripts/controllers/tag-controller.ts ***!
  \***************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.loadActiveFromLocalStorage = exports.toggle = exports.set = exports.clear = exports.saveActiveToLocalStorage = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const ModesNotice = __importStar(__webpack_require__(/*! ../elements/modes-notice */ "./src/scripts/elements/modes-notice.ts"));
function saveActiveToLocalStorage() {
    var _a;
    const tags = [];
    try {
        (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
            if (tag.active === true) {
                tags.push(tag._id);
            }
        });
        window.localStorage.setItem("activeTags", JSON.stringify(tags));
    }
    catch (e) { }
}
exports.saveActiveToLocalStorage = saveActiveToLocalStorage;
function clear(nosave = false) {
    var _a;
    const snapshot = DB.getSnapshot();
    snapshot.tags = (_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.map((tag) => {
        tag.active = false;
        return tag;
    });
    DB.setSnapshot(snapshot);
    ModesNotice.update();
    if (!nosave)
        saveActiveToLocalStorage();
}
exports.clear = clear;
function set(tagid, state, nosave = false) {
    var _a;
    const snapshot = DB.getSnapshot();
    snapshot.tags = (_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.map((tag) => {
        if (tag._id === tagid) {
            tag.active = state;
        }
        return tag;
    });
    DB.setSnapshot(snapshot);
    ModesNotice.update();
    if (!nosave)
        saveActiveToLocalStorage();
}
exports.set = set;
function toggle(tagid, nosave = false) {
    var _a;
    (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
        if (tag._id === tagid) {
            if (tag.active === undefined) {
                tag.active = true;
            }
            else {
                tag.active = !tag.active;
            }
        }
    });
    ModesNotice.update();
    if (!nosave)
        saveActiveToLocalStorage();
}
exports.toggle = toggle;
function loadActiveFromLocalStorage() {
    var _a;
    let newTags = window.localStorage.getItem("activeTags");
    if (newTags != undefined && newTags !== "") {
        try {
            newTags = (_a = JSON.parse(newTags)) !== null && _a !== void 0 ? _a : [];
        }
        catch (e) {
            newTags = [];
        }
        newTags.forEach((ntag) => {
            toggle(ntag, true);
        });
        saveActiveToLocalStorage();
    }
}
exports.loadActiveFromLocalStorage = loadActiveFromLocalStorage;


/***/ }),

/***/ "./src/scripts/controllers/theme-controller.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/controllers/theme-controller.ts ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.applyCustomBackground = exports.applyCustomBackgroundSize = exports.clearRandom = exports.randomizeTheme = exports.clearPreview = exports.set = exports.preview = exports.colorVars = exports.randomTheme = void 0;
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const ChartController = __importStar(__webpack_require__(/*! ./chart-controller */ "./src/scripts/controllers/chart-controller.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const BackgroundFilter = __importStar(__webpack_require__(/*! ../elements/custom-background-filter */ "./src/scripts/elements/custom-background-filter.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const AnalyticsController = __importStar(__webpack_require__(/*! ../controllers/analytics-controller */ "./src/scripts/controllers/analytics-controller.ts"));
let isPreviewingTheme = false;
exports.randomTheme = null;
exports.colorVars = [
    "--bg-color",
    "--main-color",
    "--caret-color",
    "--sub-color",
    "--text-color",
    "--error-color",
    "--error-extra-color",
    "--colorful-error-color",
    "--colorful-error-extra-color",
];
function updateFavicon(size, curveSize) {
    return __awaiter(this, void 0, void 0, function* () {
        setTimeout(() => __awaiter(this, void 0, void 0, function* () {
            let maincolor, bgcolor;
            bgcolor = yield ThemeColors.get("bg");
            maincolor = yield ThemeColors.get("main");
            if (window.location.hostname === "localhost") {
                const swap = maincolor;
                maincolor = bgcolor;
                bgcolor = swap;
            }
            if (bgcolor == maincolor) {
                bgcolor = "#111";
                maincolor = "#eee";
            }
            const canvas = document.createElement("canvas");
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext("2d");
            ctx.beginPath();
            ctx.moveTo(0, curveSize);
            //top left
            ctx.quadraticCurveTo(0, 0, curveSize, 0);
            ctx.lineTo(size - curveSize, 0);
            //top right
            ctx.quadraticCurveTo(size, 0, size, curveSize);
            ctx.lineTo(size, size - curveSize);
            ctx.quadraticCurveTo(size, size, size - curveSize, size);
            ctx.lineTo(curveSize, size);
            ctx.quadraticCurveTo(0, size, 0, size - curveSize);
            ctx.fillStyle = bgcolor;
            ctx.fill();
            ctx.font = "900 " + (size / 2) * 1.2 + "px Lexend Deca";
            ctx.textAlign = "center";
            ctx.fillStyle = maincolor;
            ctx.fillText("mt", size / 2 + 1, (size / 3) * 2.1);
            // $("body").prepend(canvas);
            $("#favicon").attr("href", canvas.toDataURL("image/png"));
        }), 125);
    });
}
function clearCustomTheme() {
    exports.colorVars.forEach((e) => {
        document.documentElement.style.setProperty(e, "");
    });
}
const loadStyle = function (name) {
    return __awaiter(this, void 0, void 0, function* () {
        return new Promise((resolve) => {
            const link = document.createElement("link");
            link.type = "text/css";
            link.rel = "stylesheet";
            link.id = "currentTheme";
            link.onload = () => {
                resolve();
            };
            if (name === "custom") {
                link.href = `themes/serika_dark.css`;
            }
            else {
                link.href = `themes/${name}.css`;
            }
            const headScript = document.querySelector("#currentTheme");
            headScript.replaceWith(link);
        });
    });
};
// export function changeCustomTheme(themeId: string, nosave = false): void {
//   const customThemes = DB.getSnapshot().customThemes;
//   const colors = customThemes.find((e) => e._id === themeId)
//     ?.colors as string[];
//   UpdateConfig.setCustomThemeColors(colors, nosave);
// }
function apply(themeName, isCustom, isPreview = false) {
    clearCustomTheme();
    let name = "serika_dark";
    if (!isCustom) {
        name = themeName;
    }
    else {
        name = "custom";
    }
    ThemeColors.reset();
    $(".keymap-key").attr("style", "");
    // $("#currentTheme").attr("href", `themes/${name}.css`);
    loadStyle(name).then(() => {
        var _a, _b;
        ThemeColors.update();
        if (isCustom) {
            let colorValues = config_1.default.customThemeColors;
            const snapshot = DB.getSnapshot();
            if (isCustom && !isPreview && snapshot) {
                const customColors = (_b = (_a = snapshot.customThemes.find((e) => e._id === themeName)) === null || _a === void 0 ? void 0 : _a.colors) !== null && _b !== void 0 ? _b : [];
                if (customColors.length > 0) {
                    UpdateConfig.setCustomThemeColors(customColors);
                }
            }
            if (themeName !== "custom" && snapshot) {
                const customThemes = snapshot.customThemes;
                const customThemeById = customThemes.find((e) => e._id === themeName);
                colorValues = customThemeById === null || customThemeById === void 0 ? void 0 : customThemeById.colors;
            }
            exports.colorVars.forEach((e, index) => {
                document.documentElement.style.setProperty(e, colorValues[index]);
            });
        }
        AnalyticsController.log("changedTheme", { theme: themeName });
        if (!isPreview) {
            ThemeColors.getAll().then((colors) => {
                $(".keymap-key").attr("style", "");
                ChartController.updateAllChartColors();
                updateFavicon(128, 32);
                $("#metaThemeColor").attr("content", colors.bg);
            });
        }
        $(".current-theme .text").text(isCustom ? "custom" : themeName.replace(/_/g, " "));
    });
}
function preview(themeIdentifier, isCustom, randomTheme = false) {
    isPreviewingTheme = true;
    apply(themeIdentifier, isCustom, !randomTheme);
}
exports.preview = preview;
function set(themeIdentifier, isCustom) {
    apply(themeIdentifier, isCustom);
}
exports.set = set;
function clearPreview() {
    if (isPreviewingTheme) {
        isPreviewingTheme = false;
        exports.randomTheme = null;
        if (config_1.default.customTheme) {
            apply("custom", true);
        }
        else {
            apply(config_1.default.theme, false);
        }
    }
}
exports.clearPreview = clearPreview;
function randomizeTheme() {
    let randomList;
    Misc.getThemesList().then((themes) => {
        var _a, _b;
        if (config_1.default.randomTheme === "fav" && config_1.default.favThemes.length > 0) {
            randomList = config_1.default.favThemes;
        }
        else if (config_1.default.randomTheme === "light") {
            randomList = themes
                .filter((t) => Misc.isColorLight(t.bgColor))
                .map((t) => t.name);
        }
        else if (config_1.default.randomTheme === "dark") {
            randomList = themes
                .filter((t) => Misc.isColorDark(t.bgColor))
                .map((t) => t.name);
        }
        else if (config_1.default.randomTheme === "on") {
            randomList = themes.map((t) => {
                return t.name;
            });
        }
        else {
            randomList = DB.getSnapshot().customThemes.map((ct) => ct._id);
        }
        const previousTheme = exports.randomTheme;
        exports.randomTheme = Misc.randomElementFromArray(randomList);
        // if (Config.randomTheme === "custom") {
        // changeCustomTheme(randomTheme, true);
        // } else {
        preview(exports.randomTheme, config_1.default.randomTheme === "custom");
        // }
        if (previousTheme != exports.randomTheme) {
            let name = exports.randomTheme.replace(/_/g, " ");
            if (config_1.default.randomTheme === "custom") {
                name = ((_b = (_a = DB.getSnapshot().customThemes.find((ct) => ct._id === exports.randomTheme)) === null || _a === void 0 ? void 0 : _a.name) !== null && _b !== void 0 ? _b : "custom").replace(/_/g, " ");
            }
            Notifications.add(name, 0);
        }
    });
}
exports.randomizeTheme = randomizeTheme;
function clearRandom() {
    if (exports.randomTheme === null)
        return;
    exports.randomTheme = null;
    if (config_1.default.customTheme) {
        apply("custom", true);
    }
    else {
        apply(config_1.default.theme, false);
    }
}
exports.clearRandom = clearRandom;
function applyCustomBackgroundSize() {
    if (config_1.default.customBackgroundSize == "max") {
        $(".customBackground img").css({
            // width: "calc(100%)",
            // height: "calc(100%)",
            objectFit: "",
        });
    }
    else {
        $(".customBackground img").css({
            objectFit: config_1.default.customBackgroundSize,
        });
    }
}
exports.applyCustomBackgroundSize = applyCustomBackgroundSize;
function applyCustomBackground() {
    // $(".customBackground").css({
    //   backgroundImage: `url(${Config.customBackground})`,
    //   backgroundAttachment: "fixed",
    // });
    if (config_1.default.customBackground === "") {
        $("#words").removeClass("noErrorBorder");
        $("#resultWordsHistory").removeClass("noErrorBorder");
        $(".customBackground img").remove();
    }
    else {
        $("#words").addClass("noErrorBorder");
        $("#resultWordsHistory").addClass("noErrorBorder");
        $(".customBackground").html(`<img src="${config_1.default.customBackground}" />`);
        BackgroundFilter.apply();
        applyCustomBackgroundSize();
    }
}
exports.applyCustomBackground = applyCustomBackground;
(_b = (_a = window
    .matchMedia) === null || _a === void 0 ? void 0 : _a.call(window, "(prefers-color-scheme: dark)")) === null || _b === void 0 ? void 0 : _b.addEventListener("change", (event) => {
    if (!config_1.default.autoSwitchTheme || config_1.default.customTheme)
        return;
    if (event.matches) {
        set(config_1.default.themeDark, false);
    }
    else {
        set(config_1.default.themeLight, false);
    }
});
ConfigEvent.subscribe((eventKey, eventValue, nosave) => {
    if (eventKey === "customTheme") {
        eventValue ? set("custom", true) : set(config_1.default.theme, false);
    }
    if (eventKey === "customThemeColors") {
        nosave ? preview("custom", true) : set("custom", true);
    }
    if (eventKey === "theme") {
        clearPreview();
        set(eventValue, false);
    }
    if (eventKey === "setThemes") {
        clearPreview();
        if (eventValue) {
            set("custom", true);
        }
        else {
            if (config_1.default.autoSwitchTheme) {
                if (window.matchMedia &&
                    window.matchMedia("(prefers-color-scheme: dark)").matches) {
                    set(config_1.default.themeDark, false);
                }
                else {
                    set(config_1.default.themeLight, false);
                }
            }
            else {
                set(config_1.default.theme, false);
            }
        }
    }
    if (eventKey === "randomTheme" && eventValue === "off")
        clearRandom();
    if (eventKey === "customBackground")
        applyCustomBackground();
    if (eventKey === "customBackgroundSize")
        applyCustomBackgroundSize();
    if (eventKey === "autoSwitchTheme") {
        if (eventValue) {
            if (window.matchMedia &&
                window.matchMedia("(prefers-color-scheme: dark)").matches) {
                set(config_1.default.themeDark, false);
            }
            else {
                set(config_1.default.themeLight, false);
            }
        }
        else {
            set(config_1.default.theme, false);
        }
    }
    if (eventKey === "themeLight" &&
        config_1.default.autoSwitchTheme &&
        !(window.matchMedia &&
            window.matchMedia("(prefers-color-scheme: dark)").matches) &&
        !nosave) {
        set(config_1.default.themeLight, false);
    }
    if (eventKey === "themeDark" &&
        config_1.default.autoSwitchTheme &&
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches &&
        !nosave) {
        set(config_1.default.themeDark, false);
    }
});


/***/ }),

/***/ "./src/scripts/controllers/verification-controller.ts":
/*!************************************************************!*\
  !*** ./src/scripts/controllers/verification-controller.ts ***!
  \************************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.verify = exports.set = exports.data = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
exports.data = null;
function set(val) {
    exports.data = val;
}
exports.set = set;
function verify(uid) {
    return __awaiter(this, void 0, void 0, function* () {
        if (exports.data === null)
            return;
        Notifications.add("Linking Discord account", 0, 3);
        Loader.show();
        exports.data.uid = uid;
        const response = yield ape_1.default.users.linkDiscord(exports.data);
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to link Discord: " + response.message, -1);
        }
        Notifications.add("Accounts linked", 1);
        const snapshot = DB.getSnapshot();
        snapshot.discordId = response.data.did;
        DB.setSnapshot(snapshot);
        Settings.updateDiscordSection();
    });
}
exports.verify = verify;


/***/ }),

/***/ "./src/scripts/db.ts":
/*!***************************!*\
  !*** ./src/scripts/db.ts ***!
  \***************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateLocalStats = exports.saveLocalResult = exports.saveConfig = exports.updateLbMemory = exports.saveLocalTagPB = exports.getLocalTagPB = exports.saveLocalPB = exports.getLocalPB = exports.getUserAverage10 = exports.getUserHighestWpm = exports.deleteCustomTheme = exports.editCustomTheme = exports.addCustomTheme = exports.getCustomThemeById = exports.getUserResults = exports.initSnapshot = exports.setSnapshot = exports.getSnapshot = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ./ape */ "./src/scripts/ape/index.ts"));
const AccountButton = __importStar(__webpack_require__(/*! ./elements/account-button */ "./src/scripts/elements/account-button.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./elements/notifications */ "./src/scripts/elements/notifications.ts"));
const LoadingPage = __importStar(__webpack_require__(/*! ./pages/loading */ "./src/scripts/pages/loading.ts"));
const default_config_1 = __importDefault(__webpack_require__(/*! ./constants/default-config */ "./src/scripts/constants/default-config.ts"));
const firebase_1 = __webpack_require__(/*! ./firebase */ "./src/scripts/firebase.ts");
const default_snapshot_1 = __webpack_require__(/*! ./constants/default-snapshot */ "./src/scripts/constants/default-snapshot.ts");
let dbSnapshot;
function getSnapshot() {
    return dbSnapshot;
}
exports.getSnapshot = getSnapshot;
function setSnapshot(newSnapshot) {
    try {
        delete newSnapshot.banned;
    }
    catch (_a) { }
    try {
        delete newSnapshot.verified;
    }
    catch (_b) { }
    dbSnapshot = newSnapshot;
}
exports.setSnapshot = setSnapshot;
function initSnapshot() {
    var _a, _b, _c, _d, _e;
    return __awaiter(this, void 0, void 0, function* () {
        //send api request with token that returns tags, presets, and data needed for snap
        const snap = default_snapshot_1.defaultSnap;
        try {
            if (firebase_1.Auth.currentUser == null)
                return false;
            // if (ActivePage.get() == "loading") {
            //   LoadingPage.updateBar(22.5);
            // } else {
            //   LoadingPage.updateBar(16);
            // }
            // LoadingPage.updateText("Downloading user...");
            const [userResponse, configResponse, tagsResponse, presetsResponse] = yield Promise.all([
                ape_1.default.users.getData(),
                ape_1.default.configs.get(),
                ape_1.default.users.getTags(),
                ape_1.default.presets.get(),
            ]);
            if (userResponse.status !== 200) {
                throw {
                    message: `${userResponse.message} (user)`,
                    responseCode: userResponse.status,
                };
            }
            if (configResponse.status !== 200) {
                throw {
                    message: `${configResponse.message} (config)`,
                    responseCode: configResponse.status,
                };
            }
            if (tagsResponse.status !== 200) {
                throw {
                    message: `${tagsResponse.message} (tags)`,
                    responseCode: tagsResponse.status,
                };
            }
            if (presetsResponse.status !== 200) {
                throw {
                    message: `${presetsResponse.message} (presets)`,
                    responseCode: presetsResponse.status,
                };
            }
            const [userData, configData, tagsData, presetsData] = [
                userResponse,
                configResponse,
                tagsResponse,
                presetsResponse,
            ].map((response) => response.data);
            snap.name = userData.name;
            snap.personalBests = userData.personalBests;
            snap.banned = userData.banned;
            snap.verified = userData.verified;
            snap.discordId = userData.discordId;
            snap.globalStats = {
                time: userData.timeTyping,
                started: userData.startedTests,
                completed: userData.completedTests,
            };
            if (userData.quoteMod === true)
                snap.quoteMod = true;
            snap.quoteRatings = userData.quoteRatings;
            snap.favouriteThemes =
                userData.favouriteThemes === undefined ? [] : userData.favouriteThemes;
            if (((_a = userData.lbMemory) === null || _a === void 0 ? void 0 : _a.time15) || ((_b = userData.lbMemory) === null || _b === void 0 ? void 0 : _b.time60)) {
                //old memory format
                snap.lbMemory = {};
            }
            else if (userData.lbMemory) {
                snap.lbMemory = userData.lbMemory;
            }
            // if (ActivePage.get() == "loading") {
            //   LoadingPage.updateBar(45);
            // } else {
            //   LoadingPage.updateBar(32);
            // }
            // LoadingPage.updateText("Downloading config...");
            if (configData) {
                const newConfig = Object.assign({}, default_config_1.default);
                for (const key in configData.config) {
                    const value = configData.config[key];
                    newConfig[key] = value;
                }
                snap.config = newConfig;
            }
            // if (ActivePage.get() == "loading") {
            //   LoadingPage.updateBar(67.5);
            // } else {
            //   LoadingPage.updateBar(48);
            // }
            // LoadingPage.updateText("Downloading tags...");
            snap.customThemes = (_c = userData.customThemes) !== null && _c !== void 0 ? _c : [];
            snap.tags = tagsData;
            snap.tags = (_d = snap.tags) === null || _d === void 0 ? void 0 : _d.sort((a, b) => {
                if (a.name > b.name) {
                    return 1;
                }
                else if (a.name < b.name) {
                    return -1;
                }
                else {
                    return 0;
                }
            });
            // if (ActivePage.get() == "loading") {
            //   LoadingPage.updateBar(90);
            // } else {
            //   LoadingPage.updateBar(64);
            // }
            // LoadingPage.updateText("Downloading presets...");
            snap.presets = presetsData;
            snap.presets = (_e = snap.presets) === null || _e === void 0 ? void 0 : _e.sort((a, b) => {
                if (a.name > b.name) {
                    return 1;
                }
                else if (a.name < b.name) {
                    return -1;
                }
                else {
                    return 0;
                }
            });
            dbSnapshot = snap;
            return dbSnapshot;
        }
        catch (e) {
            dbSnapshot = default_snapshot_1.defaultSnap;
            throw e;
        }
    });
}
exports.initSnapshot = initSnapshot;
function getUserResults() {
    return __awaiter(this, void 0, void 0, function* () {
        const user = firebase_1.Auth.currentUser;
        if (user == null)
            return false;
        if (dbSnapshot === null)
            return false;
        if (dbSnapshot.results !== undefined) {
            return true;
        }
        else {
            LoadingPage.updateText("Downloading results...");
            LoadingPage.updateBar(90);
            const response = yield ape_1.default.results.get();
            if (response.status !== 200) {
                Notifications.add("Error getting results: " + response.message, -1);
                return false;
            }
            const results = response.data;
            results.forEach((result) => {
                if (result.bailedOut === undefined)
                    result.bailedOut = false;
                if (result.blindMode === undefined)
                    result.blindMode = false;
                if (result.lazyMode === undefined)
                    result.lazyMode = false;
                if (result.difficulty === undefined)
                    result.difficulty = "normal";
                if (result.funbox === undefined)
                    result.funbox = "none";
                if (result.language === undefined || result.language === null) {
                    result.language = "english";
                }
                if (result.numbers === undefined)
                    result.numbers = false;
                if (result.punctuation === undefined)
                    result.punctuation = false;
            });
            dbSnapshot.results = results === null || results === void 0 ? void 0 : results.sort((a, b) => b.timestamp - a.timestamp);
            return true;
        }
    });
}
exports.getUserResults = getUserResults;
function getCustomThemeById(themeID) {
    return dbSnapshot.customThemes.find((t) => t._id === themeID);
}
exports.getCustomThemeById = getCustomThemeById;
function addCustomTheme(theme) {
    return __awaiter(this, void 0, void 0, function* () {
        if (dbSnapshot === null)
            return false;
        if (dbSnapshot.customThemes.length >= 10) {
            Notifications.add("Too many custom themes!", 0);
            return false;
        }
        const response = yield ape_1.default.users.addCustomTheme(theme);
        if (response.status !== 200) {
            Notifications.add("Error adding custom theme: " + response.message, -1);
            return false;
        }
        const newCustomTheme = Object.assign(Object.assign({}, theme), { _id: response.data.theme._id });
        dbSnapshot.customThemes.push(newCustomTheme);
        return true;
    });
}
exports.addCustomTheme = addCustomTheme;
function editCustomTheme(themeId, newTheme) {
    return __awaiter(this, void 0, void 0, function* () {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return false;
        if (dbSnapshot === null)
            return false;
        const customTheme = dbSnapshot.customThemes.find((t) => t._id === themeId);
        if (!customTheme) {
            Notifications.add("Editing failed: Custom theme with id: " + themeId + " does not exist", -1);
            return false;
        }
        const response = yield ape_1.default.users.editCustomTheme(themeId, newTheme);
        if (response.status !== 200) {
            Notifications.add("Error editing custom theme: " + response.message, -1);
            return false;
        }
        const newCustomTheme = Object.assign(Object.assign({}, newTheme), { _id: themeId });
        dbSnapshot.customThemes[dbSnapshot.customThemes.indexOf(customTheme)] =
            newCustomTheme;
        return true;
    });
}
exports.editCustomTheme = editCustomTheme;
function deleteCustomTheme(themeId) {
    return __awaiter(this, void 0, void 0, function* () {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return false;
        if (dbSnapshot === null)
            return false;
        const customTheme = dbSnapshot.customThemes.find((t) => t._id === themeId);
        if (!customTheme)
            return false;
        const response = yield ape_1.default.users.deleteCustomTheme(themeId);
        if (response.status !== 200) {
            Notifications.add("Error deleting custom theme: " + response.message, -1);
            return false;
        }
        dbSnapshot.customThemes = dbSnapshot.customThemes.filter((t) => t._id !== themeId);
        return true;
    });
}
exports.deleteCustomTheme = deleteCustomTheme;
function getUserHighestWpm(mode, mode2, punctuation, language, difficulty, lazyMode) {
    return __awaiter(this, void 0, void 0, function* () {
        function cont() {
            var _a;
            let topWpm = 0;
            (_a = dbSnapshot.results) === null || _a === void 0 ? void 0 : _a.forEach((result) => {
                if (result.mode == mode &&
                    result.mode2 == mode2 &&
                    result.punctuation == punctuation &&
                    result.language == language &&
                    result.difficulty == difficulty &&
                    (result.lazyMode === lazyMode ||
                        (result.lazyMode === undefined && lazyMode === false))) {
                    if (result.wpm > topWpm) {
                        topWpm = result.wpm;
                    }
                }
            });
            return topWpm;
        }
        const retval = dbSnapshot === null || dbSnapshot.results === undefined ? 0 : cont();
        return retval;
    });
}
exports.getUserHighestWpm = getUserHighestWpm;
function getUserAverage10(mode, mode2, punctuation, language, difficulty, lazyMode) {
    return __awaiter(this, void 0, void 0, function* () {
        const snapshot = getSnapshot();
        if (!snapshot)
            return [0, 0];
        function cont() {
            var _a;
            const activeTagIds = [];
            (_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
                if (tag.active === true) {
                    activeTagIds.push(tag._id);
                }
            });
            let wpmSum = 0;
            let accSum = 0;
            let last10Wpm = 0;
            let last10Acc = 0;
            let count = 0;
            let last10Count = 0;
            if (snapshot.results !== undefined) {
                for (const result of snapshot.results) {
                    if (result.mode === mode &&
                        result.punctuation === punctuation &&
                        result.language === language &&
                        result.difficulty === difficulty &&
                        (result.lazyMode === lazyMode ||
                            (result.lazyMode === undefined && lazyMode === false)) &&
                        (activeTagIds.length === 0 ||
                            activeTagIds.some((tagId) => result.tags.includes(tagId)))) {
                        // Continue if the mode2 doesn't match and it's not a quote
                        if (result.mode2 !== mode2 && mode !== "quote") {
                            continue;
                        }
                        // Grab the most recent results from the current mode
                        if (last10Count < 10) {
                            last10Wpm += result.wpm;
                            last10Acc += result.acc;
                            last10Count++;
                        }
                        // Check if the mode2 matches and if it does, add it to the sum, for quotes, this is the quote id
                        if (result.mode2 === mode2) {
                            wpmSum += result.wpm;
                            accSum += result.acc;
                            count++;
                            if (count >= 10)
                                break;
                        }
                    }
                }
            }
            // Return the last 10 average wpm & acc for quote
            // if the current quote id has never been completed before by the user
            if (count === 0 && mode === "quote") {
                return [last10Wpm / last10Count, last10Acc / last10Count];
            }
            return [wpmSum / count, accSum / count];
        }
        const retval = snapshot === null || (yield getUserResults()) === null ? [0, 0] : cont();
        return retval;
    });
}
exports.getUserAverage10 = getUserAverage10;
function getLocalPB(mode, mode2, punctuation, language, difficulty, lazyMode, funbox) {
    return __awaiter(this, void 0, void 0, function* () {
        if (funbox !== "none" && funbox !== "plus_one" && funbox !== "plus_two") {
            return 0;
        }
        function cont() {
            let ret = 0;
            try {
                if (!dbSnapshot.personalBests)
                    return ret;
                dbSnapshot.personalBests[mode][mode2].forEach((pb) => {
                    if (pb.punctuation == punctuation &&
                        pb.difficulty == difficulty &&
                        pb.language == language &&
                        (pb.lazyMode === lazyMode ||
                            (pb.lazyMode === undefined && lazyMode === false))) {
                        ret = pb.wpm;
                    }
                });
                return ret;
            }
            catch (e) {
                return ret;
            }
        }
        const retval = dbSnapshot === null ? 0 : cont();
        return retval;
    });
}
exports.getLocalPB = getLocalPB;
function saveLocalPB(mode, mode2, punctuation, language, difficulty, lazyMode, wpm, acc, raw, consistency) {
    return __awaiter(this, void 0, void 0, function* () {
        if (mode == "quote")
            return;
        function cont() {
            let found = false;
            if (dbSnapshot.personalBests === undefined) {
                dbSnapshot.personalBests = {
                    time: {},
                    words: {},
                    zen: { zen: [] },
                    quote: { custom: [] },
                    custom: { custom: [] },
                };
            }
            if (dbSnapshot.personalBests[mode] === undefined) {
                if (mode === "zen") {
                    dbSnapshot.personalBests["zen"] = { zen: [] };
                }
                else {
                    dbSnapshot.personalBests[mode] = {
                        custom: [],
                    };
                }
            }
            if (dbSnapshot.personalBests[mode][mode2] === undefined) {
                dbSnapshot.personalBests[mode][mode2] =
                    [];
            }
            dbSnapshot.personalBests[mode][mode2].forEach((pb) => {
                if (pb.punctuation == punctuation &&
                    pb.difficulty == difficulty &&
                    pb.language == language &&
                    (pb.lazyMode === lazyMode ||
                        (pb.lazyMode === undefined && lazyMode === false))) {
                    found = true;
                    pb.wpm = wpm;
                    pb.acc = acc;
                    pb.raw = raw;
                    pb.timestamp = Date.now();
                    pb.consistency = consistency;
                    pb.lazyMode = lazyMode;
                }
            });
            if (!found) {
                //nothing found
                dbSnapshot.personalBests[mode][mode2].push({
                    language: language,
                    difficulty: difficulty,
                    lazyMode: lazyMode,
                    punctuation: punctuation,
                    wpm: wpm,
                    acc: acc,
                    raw: raw,
                    timestamp: Date.now(),
                    consistency: consistency,
                });
            }
        }
        if (dbSnapshot != null) {
            cont();
        }
    });
}
exports.saveLocalPB = saveLocalPB;
function getLocalTagPB(tagId, mode, mode2, punctuation, language, difficulty, lazyMode) {
    return __awaiter(this, void 0, void 0, function* () {
        function cont() {
            var _a, _b;
            let ret = 0;
            const filteredtag = ((_a = getSnapshot().tags) !== null && _a !== void 0 ? _a : []).filter((t) => t._id === tagId)[0];
            if (filteredtag === undefined)
                return ret;
            if (filteredtag.personalBests === undefined) {
                filteredtag.personalBests = {
                    time: {},
                    words: {},
                    zen: { zen: [] },
                    quote: { custom: [] },
                    custom: { custom: [] },
                };
            }
            try {
                const personalBests = ((_b = filteredtag.personalBests[mode][mode2]) !== null && _b !== void 0 ? _b : []);
                personalBests.forEach((pb) => {
                    if (pb.punctuation == punctuation &&
                        pb.difficulty == difficulty &&
                        pb.language == language &&
                        (pb.lazyMode === lazyMode ||
                            (pb.lazyMode === undefined && lazyMode === false))) {
                        ret = pb.wpm;
                    }
                });
            }
            catch (e) {
                console.log(e);
            }
            return ret;
        }
        const retval = dbSnapshot === null ? 0 : cont();
        return retval;
    });
}
exports.getLocalTagPB = getLocalTagPB;
function saveLocalTagPB(tagId, mode, mode2, punctuation, language, difficulty, lazyMode, wpm, acc, raw, consistency) {
    return __awaiter(this, void 0, void 0, function* () {
        if (mode == "quote")
            return;
        function cont() {
            var _a;
            const filteredtag = (_a = dbSnapshot.tags) === null || _a === void 0 ? void 0 : _a.filter((t) => t._id === tagId)[0];
            if (!filteredtag.personalBests) {
                filteredtag.personalBests = {
                    time: {},
                    words: {},
                    zen: { zen: [] },
                    quote: { custom: [] },
                    custom: { custom: [] },
                };
            }
            try {
                let found = false;
                if (filteredtag.personalBests[mode][mode2] === undefined) {
                    filteredtag.personalBests[mode][mode2] =
                        [];
                }
                filteredtag.personalBests[mode][mode2].forEach((pb) => {
                    if (pb.punctuation == punctuation &&
                        pb.difficulty == difficulty &&
                        pb.language == language &&
                        (pb.lazyMode === lazyMode ||
                            (pb.lazyMode === undefined && lazyMode === false))) {
                        found = true;
                        pb.wpm = wpm;
                        pb.acc = acc;
                        pb.raw = raw;
                        pb.timestamp = Date.now();
                        pb.consistency = consistency;
                        pb.lazyMode = lazyMode;
                    }
                });
                if (!found) {
                    //nothing found
                    filteredtag.personalBests[mode][mode2].push({
                        language: language,
                        difficulty: difficulty,
                        lazyMode: lazyMode,
                        punctuation: punctuation,
                        wpm: wpm,
                        acc: acc,
                        raw: raw,
                        timestamp: Date.now(),
                        consistency: consistency,
                    });
                }
            }
            catch (e) {
                //that mode or mode2 is not found
                filteredtag.personalBests = {
                    time: {},
                    words: {},
                    zen: { zen: [] },
                    quote: { custom: [] },
                    custom: { custom: [] },
                };
                if (mode === "zen") {
                    filteredtag.personalBests["zen"] = { zen: [] };
                }
                else {
                    filteredtag.personalBests[mode] = {
                        custom: [],
                    };
                }
                filteredtag.personalBests[mode][mode2] = [
                    {
                        language: language,
                        difficulty: difficulty,
                        lazyMode: lazyMode,
                        punctuation: punctuation,
                        wpm: wpm,
                        acc: acc,
                        raw: raw,
                        timestamp: Date.now(),
                        consistency: consistency,
                    },
                ];
            }
        }
        if (dbSnapshot != null) {
            cont();
        }
        return;
    });
}
exports.saveLocalTagPB = saveLocalTagPB;
function updateLbMemory(mode, mode2, language, rank, api = false) {
    return __awaiter(this, void 0, void 0, function* () {
        //could dbSnapshot just be used here instead of getSnapshot()
        if (mode === "time") {
            const timeMode = mode, timeMode2 = mode2;
            const snapshot = getSnapshot();
            if (snapshot.lbMemory === undefined) {
                snapshot.lbMemory = { time: { 15: { english: 0 }, 60: { english: 0 } } };
            }
            if (snapshot.lbMemory[timeMode] === undefined) {
                snapshot.lbMemory[timeMode] = {
                    15: { english: 0 },
                    60: { english: 0 },
                };
            }
            if (snapshot.lbMemory[timeMode][timeMode2] === undefined) {
                snapshot.lbMemory[timeMode][timeMode2] = {};
            }
            const current = snapshot.lbMemory[timeMode][timeMode2][language];
            snapshot.lbMemory[timeMode][timeMode2][language] = rank;
            if (api && current != rank) {
                yield ape_1.default.users.updateLeaderboardMemory(mode, mode2, language, rank);
            }
            setSnapshot(snapshot);
        }
    });
}
exports.updateLbMemory = updateLbMemory;
function saveConfig(config) {
    return __awaiter(this, void 0, void 0, function* () {
        if (firebase_1.Auth.currentUser !== null) {
            AccountButton.loading(true);
            const response = yield ape_1.default.configs.save(config);
            if (response.status !== 200) {
                Notifications.add("Failed to save config: " + response.message, -1);
            }
            AccountButton.loading(false);
        }
    });
}
exports.saveConfig = saveConfig;
function saveLocalResult(result) {
    const snapshot = getSnapshot();
    if (snapshot !== null && snapshot.results !== undefined) {
        snapshot.results.unshift(result);
        setSnapshot(snapshot);
    }
}
exports.saveLocalResult = saveLocalResult;
function updateLocalStats(stats) {
    const snapshot = getSnapshot();
    if (snapshot.globalStats === undefined) {
        snapshot.globalStats = {};
    }
    if (snapshot !== null && snapshot.globalStats !== undefined) {
        if (snapshot.globalStats.time == undefined) {
            snapshot.globalStats.time = stats.time;
        }
        else {
            snapshot.globalStats.time += stats.time;
        }
        if (snapshot.globalStats.started == undefined) {
            snapshot.globalStats.started = stats.started;
        }
        else {
            snapshot.globalStats.started += stats.started;
        }
        if (snapshot.globalStats.completed == undefined) {
            snapshot.globalStats.completed = 1;
        }
        else {
            snapshot.globalStats.completed += 1;
        }
    }
    setSnapshot(snapshot);
}
exports.updateLocalStats = updateLocalStats;
// export async function DB.getLocalTagPB(tagId) {
//   function cont() {
//     let ret = 0;
//     try {
//       ret = dbSnapshot.tags.filter((t) => t.id === tagId)[0].pb;
//       if (ret == undefined) {
//         ret = 0;
//       }
//       return ret;
//     } catch (e) {
//       return ret;
//     }
//   }
//   const retval = dbSnapshot !== null ? cont() : undefined;
//   return retval;
// }
// export async functio(tagId, wpm) {
//   function cont() {
//     dbSnapshot.tags.forEach((tag) => {
//       if (tag._id === tagId) {
//         tag.pb = wpm;
//       }
//     });
//   }
//   if (dbSnapshot != null) {
//     cont();
//   }
// }


/***/ }),

/***/ "./src/scripts/elements/account-button.ts":
/*!************************************************!*\
  !*** ./src/scripts/elements/account-button.ts ***!
  \************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = exports.loading = void 0;
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
function loading(truefalse) {
    if (truefalse) {
        $("#top #menu .account .icon").html('<i class="fas fa-fw fa-spin fa-circle-notch"></i>');
        $("#top #menu .account").css("opacity", 1).css("pointer-events", "none");
    }
    else {
        $("#top #menu .account .icon").html('<i class="fas fa-fw fa-user"></i>');
        $("#top #menu .account").css("opacity", 1).css("pointer-events", "auto");
    }
}
exports.loading = loading;
function update() {
    if (firebase_1.Auth.currentUser != null) {
        Misc.swapElements($("#menu .icon-button.login"), $("#menu .icon-button.account"), 250);
    }
    else {
        Misc.swapElements($("#menu .icon-button.account"), $("#menu .icon-button.login"), 250);
    }
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/elements/commandline-lists.ts":
/*!***************************************************!*\
  !*** ./src/scripts/elements/commandline-lists.ts ***!
  \***************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getList = exports.pushCurrent = exports.setCurrent = exports.defaultCommands = exports.updateThemeCommands = exports.commandsChallenges = exports.themeCommands = exports.updateCustomThemeListCommands = exports.customThemeListCommands = exports.customThemeCommands = exports.commandsEnableAds = exports.updatePresetCommands = exports.updateTagCommands = exports.commandsKeymapLayouts = exports.current = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./notifications */ "./src/scripts/elements/notifications.ts"));
const Sound = __importStar(__webpack_require__(/*! ../controllers/sound-controller */ "./src/scripts/controllers/sound-controller.ts"));
const ThemeController = __importStar(__webpack_require__(/*! ../controllers/theme-controller */ "./src/scripts/controllers/theme-controller.ts"));
const CustomTextPopup = __importStar(__webpack_require__(/*! ../popups/custom-text-popup */ "./src/scripts/popups/custom-text-popup.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const PractiseWords = __importStar(__webpack_require__(/*! ../test/practise-words */ "./src/scripts/test/practise-words.ts"));
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const Funbox = __importStar(__webpack_require__(/*! ../test/funbox */ "./src/scripts/test/funbox.ts"));
const TagController = __importStar(__webpack_require__(/*! ../controllers/tag-controller */ "./src/scripts/controllers/tag-controller.ts"));
const PresetController = __importStar(__webpack_require__(/*! ../controllers/preset-controller */ "./src/scripts/controllers/preset-controller.ts"));
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const ChallengeController = __importStar(__webpack_require__(/*! ../controllers/challenge-controller */ "./src/scripts/controllers/challenge-controller.ts"));
const PaceCaret = __importStar(__webpack_require__(/*! ../test/pace-caret */ "./src/scripts/test/pace-caret.ts"));
const TestInput = __importStar(__webpack_require__(/*! ../test/test-input */ "./src/scripts/test/test-input.ts"));
const ModesNotice = __importStar(__webpack_require__(/*! ../elements/modes-notice */ "./src/scripts/elements/modes-notice.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
exports.current = [];
function canBailOut() {
    return ((config_1.default.mode === "custom" &&
        CustomText.isWordRandom &&
        (CustomText.word >= 5000 || CustomText.word == 0)) ||
        (config_1.default.mode === "custom" &&
            !CustomText.isWordRandom &&
            !CustomText.isTimeRandom &&
            CustomText.text.length >= 5000) ||
        (config_1.default.mode === "custom" &&
            CustomText.isTimeRandom &&
            (CustomText.time >= 3600 || CustomText.time == 0)) ||
        (config_1.default.mode === "words" && config_1.default.words >= 5000) ||
        config_1.default.words === 0 ||
        (config_1.default.mode === "time" && (config_1.default.time >= 3600 || config_1.default.time === 0)) ||
        config_1.default.mode == "zen");
}
const commandsLayouts = {
    title: "Layout emulator...",
    configKey: "layout",
    list: [
        {
            id: "couldnotload",
            display: "Could not load the layouts list :(",
        },
    ],
};
Misc.getLayoutsList().then((layouts) => {
    commandsLayouts.list = [];
    commandsLayouts.list.push({
        id: "changeLayoutDefault",
        display: "off",
        configValue: "default",
        exec: () => {
            UpdateConfig.setLayout("default");
            TestLogic.restart();
        },
    });
    Object.keys(layouts).forEach((layout) => {
        commandsLayouts.list.push({
            id: "changeLayout" + Misc.capitalizeFirstLetterOfEachWord(layout),
            display: layout === "default" ? "off" : layout.replace(/_/g, " "),
            configValue: layout,
            exec: () => {
                // UpdateConfig.setSavedLayout(layout);
                UpdateConfig.setLayout(layout);
                TestLogic.restart();
            },
        });
    });
});
exports.commandsKeymapLayouts = {
    title: "Change keymap layout...",
    configKey: "keymapLayout",
    list: [
        {
            id: "couldnotload",
            display: "Could not load the layouts list :(",
        },
    ],
};
Misc.getLayoutsList().then((layouts) => {
    exports.commandsKeymapLayouts.list = [];
    exports.commandsKeymapLayouts.list.push({
        id: "changeKeymapLayoutOverrideSync",
        display: "emulator sync",
        configValue: "overrideSync",
        exec: () => {
            UpdateConfig.setKeymapLayout("overrideSync");
            TestLogic.restart();
        },
    });
    Object.keys(layouts).forEach((layout) => {
        if (layout.toString() != "default") {
            exports.commandsKeymapLayouts.list.push({
                id: "changeKeymapLayout" + Misc.capitalizeFirstLetterOfEachWord(layout),
                display: layout.replace(/_/g, " "),
                configValue: layout,
                exec: () => {
                    UpdateConfig.setKeymapLayout(layout);
                    TestLogic.restart();
                },
            });
        }
    });
});
const commandsLanguages = {
    title: "Language...",
    configKey: "language",
    list: [
        {
            id: "couldnotload",
            display: "Could not load the languages list :(",
        },
    ],
};
commandsLanguages.list = [];
Misc.getLanguageList().then((languages) => {
    languages.forEach((language) => {
        commandsLanguages.list.push({
            id: "changeLanguage" + Misc.capitalizeFirstLetterOfEachWord(language),
            display: language.replace(/_/g, " "),
            configValue: language,
            exec: () => {
                UpdateConfig.setLanguage(language);
                TestLogic.restart();
            },
        });
    });
});
const commandsFunbox = {
    title: "Funbox...",
    configKey: "funbox",
    list: [
        {
            id: "changeFunboxNone",
            display: "none",
            configValue: "none",
            alias: "off",
            exec: () => {
                if (Funbox.setFunbox("none", null)) {
                    TestLogic.restart();
                }
            },
        },
    ],
};
Misc.getFunboxList().then((funboxes) => {
    funboxes.forEach((funbox) => {
        commandsFunbox.list.push({
            id: "changeFunbox" + funbox.name,
            display: funbox.name.replace(/_/g, " "),
            configValue: funbox.name,
            exec: () => {
                if (Funbox.setFunbox(funbox.name, funbox.type)) {
                    TestLogic.restart();
                }
            },
        });
    });
});
const commandsFonts = {
    title: "Font family...",
    configKey: "fontFamily",
    list: [],
};
Misc.getFontsList().then((fonts) => {
    fonts.forEach((font) => {
        commandsFonts.list.push({
            id: "changeFont" + font.name.replace(/ /g, "_"),
            display: font.display !== undefined ? font.display : font.name,
            configValue: font.name,
            hover: () => {
                UpdateConfig.previewFontFamily(font.name);
            },
            exec: () => {
                UpdateConfig.setFontFamily(font.name.replace(/ /g, "_"));
            },
        });
    });
    commandsFonts.list.push({
        id: "setFontFamilyCustom",
        display: "custom...",
        input: true,
        hover: () => {
            UpdateConfig.previewFontFamily(config_1.default.fontFamily);
        },
        exec: (name) => {
            if (!name)
                return;
            UpdateConfig.setFontFamily(name.replace(/\s/g, "_"));
            // Settings.groups.fontFamily.updateInput();
        },
    });
});
const commandsTags = {
    title: "Change tags...",
    list: [],
};
function updateTagCommands() {
    var _a, _b, _c, _d;
    if ((_c = (_b = (_a = DB.getSnapshot()) === null || _a === void 0 ? void 0 : _a.tags) === null || _b === void 0 ? void 0 : _b.length) !== null && _c !== void 0 ? _c : 0 > 0) {
        commandsTags.list = [];
        commandsTags.list.push({
            id: "clearTags",
            display: `Clear tags`,
            icon: "fa-times",
            exec: () => {
                var _a;
                const snapshot = DB.getSnapshot();
                snapshot.tags = (_a = snapshot.tags) === null || _a === void 0 ? void 0 : _a.map((tag) => {
                    tag.active = false;
                    return tag;
                });
                DB.setSnapshot(snapshot);
                ModesNotice.update();
                TagController.saveActiveToLocalStorage();
            },
        });
        (_d = DB.getSnapshot().tags) === null || _d === void 0 ? void 0 : _d.forEach((tag) => {
            let dis = tag.name;
            if (tag.active === true) {
                dis = '<i class="fas fa-fw fa-check"></i>' + dis;
            }
            else {
                dis = '<i class="fas fa-fw"></i>' + dis;
            }
            commandsTags.list.push({
                id: "toggleTag" + tag._id,
                noIcon: true,
                display: dis,
                sticky: true,
                exec: () => {
                    TagController.toggle(tag._id);
                    ModesNotice.update();
                    if (config_1.default.paceCaret === "average") {
                        PaceCaret.init();
                        ModesNotice.update();
                    }
                    let txt = tag.name;
                    if (tag.active === true) {
                        txt = '<i class="fas fa-fw fa-check"></i>' + txt;
                    }
                    else {
                        txt = '<i class="fas fa-fw"></i>' + txt;
                    }
                    if ($("#commandLine").hasClass("allCommands")) {
                        $(`#commandLine .suggestions .entry[command='toggleTag${tag._id}']`).html(`<div class="icon"><i class="fas fa-fw fa-tag"></i></div><div>Tags  > ` +
                            txt);
                    }
                    else {
                        $(`#commandLine .suggestions .entry[command='toggleTag${tag._id}']`).html(txt);
                    }
                },
            });
        });
        // defaultCommands.list[4].visible = true;
    }
}
exports.updateTagCommands = updateTagCommands;
const commandsPresets = {
    title: "Presets...",
    list: [],
};
function updatePresetCommands() {
    const snapshot = DB.getSnapshot();
    if (!snapshot || !snapshot.presets || snapshot.presets.length === 0)
        return;
    commandsPresets.list = [];
    snapshot.presets.forEach((preset) => {
        const dis = preset.name;
        commandsPresets.list.push({
            id: "applyPreset" + preset._id,
            display: dis,
            exec: () => {
                Settings.setEventDisabled(true);
                PresetController.apply(preset._id);
                Settings.setEventDisabled(false);
                Settings.update();
                ModesNotice.update();
            },
        });
    });
}
exports.updatePresetCommands = updatePresetCommands;
const commandsRepeatQuotes = {
    title: "Repeat quotes...",
    configKey: "repeatQuotes",
    list: [
        {
            id: "setRepeatQuotesOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setRepeatQuotes("off");
            },
        },
        {
            id: "setRepeatQuotesTyping",
            display: "typing",
            configValue: "typing",
            exec: () => {
                UpdateConfig.setRepeatQuotes("typing");
            },
        },
    ],
};
const commandsLiveWpm = {
    title: "Live WPM...",
    configKey: "showLiveWpm",
    list: [
        {
            id: "setLiveWpmOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowLiveWpm(false);
            },
        },
        {
            id: "setLiveWpmOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowLiveWpm(true);
            },
        },
    ],
};
const commandsShowAverage = {
    title: "Show average...",
    configKey: "showAverage",
    list: [
        {
            id: "setShowAverageOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setShowAverage("off");
            },
        },
        {
            id: "setShowAverageSpeed",
            display: "wpm",
            configValue: "wpm",
            exec: () => {
                UpdateConfig.setShowAverage("wpm");
            },
        },
        {
            id: "setShowAverageAcc",
            display: "accuracy",
            configValue: "acc",
            exec: () => {
                UpdateConfig.setShowAverage("acc");
            },
        },
        {
            id: "setShowAverageBoth",
            display: "both",
            configValue: "both",
            exec: () => {
                UpdateConfig.setShowAverage("both");
            },
        },
    ],
};
const commandsLiveAcc = {
    title: "Live accuracy...",
    configKey: "showLiveAcc",
    list: [
        {
            id: "setLiveAccOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowLiveAcc(false);
            },
        },
        {
            id: "setLiveAccOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowLiveAcc(true);
            },
        },
    ],
};
const commandsLiveBurst = {
    title: "Live burst...",
    configKey: "showLiveBurst",
    list: [
        {
            id: "setLiveBurstOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowLiveBurst(false);
            },
        },
        {
            id: "setLiveBurstOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowLiveBurst(true);
            },
        },
    ],
};
const commandsShowTimer = {
    title: "Timer/progress...",
    configKey: "showTimerProgress",
    list: [
        {
            id: "setTimerProgressOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowTimerProgress(false);
            },
        },
        {
            id: "setTimerProgressOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowTimerProgress(true);
            },
        },
    ],
};
const commandsKeyTips = {
    title: "Key tips...",
    configKey: "showKeyTips",
    list: [
        {
            id: "setKeyTipsOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setKeyTips(false);
            },
        },
        {
            id: "setKeyTipsOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setKeyTips(true);
            },
        },
    ],
};
const commandsFreedomMode = {
    title: "Freedom mode...",
    configKey: "freedomMode",
    list: [
        {
            id: "setfreedomModeOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setFreedomMode(false);
            },
        },
        {
            id: "setfreedomModeOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setFreedomMode(true);
            },
        },
    ],
};
const commandsStrictSpace = {
    title: "Strict space...",
    configKey: "strictSpace",
    list: [
        {
            id: "setStrictSpaceOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setStrictSpace(false);
            },
        },
        {
            id: "setStrictSpaceOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setStrictSpace(true);
            },
        },
    ],
};
const commandsBlindMode = {
    title: "Blind mode...",
    configKey: "blindMode",
    list: [
        {
            id: "setBlindModeOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setBlindMode(false);
            },
        },
        {
            id: "setBlindModeOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setBlindMode(true);
            },
        },
    ],
};
const commandsShowWordsHistory = {
    title: "Always show words history...",
    configKey: "alwaysShowWordsHistory",
    list: [
        {
            id: "setAlwaysShowWordsHistoryOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setAlwaysShowWordsHistory(false);
            },
        },
        {
            id: "setAlwaysShowWordsHistoryOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setAlwaysShowWordsHistory(true);
            },
        },
    ],
};
const commandsIndicateTypos = {
    title: "Indicate typos...",
    configKey: "indicateTypos",
    list: [
        {
            id: "setIndicateTyposOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setIndicateTypos("off");
            },
        },
        {
            id: "setIndicateTyposBelow",
            display: "below",
            configValue: "below",
            exec: () => {
                UpdateConfig.setIndicateTypos("below");
            },
        },
        {
            id: "setIndicateTyposReplace",
            display: "replace",
            configValue: "replace",
            exec: () => {
                UpdateConfig.setIndicateTypos("replace");
            },
        },
    ],
};
const commandsHideExtraLetters = {
    title: "Hide extra letters...",
    configKey: "hideExtraLetters",
    list: [
        {
            id: "setHideExtraLettersOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setHideExtraLetters(false);
            },
        },
        {
            id: "setHideExtraLettersOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setHideExtraLetters(true);
            },
        },
    ],
};
const commandsQuickEnd = {
    title: "Quick end...",
    configKey: "quickEnd",
    list: [
        {
            id: "setQuickEndOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setQuickEnd(false);
            },
        },
        {
            id: "setQuickEndOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setQuickEnd(true);
            },
        },
    ],
};
const commandsOppositeShiftMode = {
    title: "Change opposite shift mode...",
    configKey: "oppositeShiftMode",
    list: [
        {
            id: "setOppositeShiftModeOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setOppositeShiftMode("off");
                ModesNotice.update();
            },
        },
        {
            id: "setOppositeShiftModeOn",
            display: "on",
            configValue: "on",
            exec: () => {
                UpdateConfig.setOppositeShiftMode("on");
                ModesNotice.update();
            },
        },
        {
            id: "setOppositeShiftModeKeymap",
            display: "keymap",
            configValue: "keymap",
            exec: () => {
                UpdateConfig.setOppositeShiftMode("keymap");
                ModesNotice.update();
            },
        },
    ],
};
const commandsSoundOnError = {
    title: "Sound on error...",
    configKey: "playSoundOnError",
    list: [
        {
            id: "setPlaySoundOnErrorOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setPlaySoundOnError(false);
            },
        },
        {
            id: "setPlaySoundOnErrorOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setPlaySoundOnError(true);
                Sound.playError();
            },
        },
    ],
};
const commandsSoundVolume = {
    title: "Sound volume...",
    configKey: "soundVolume",
    list: [
        {
            id: "setSoundVolume0.1",
            display: "quiet",
            configValue: "0.1",
            exec: () => {
                UpdateConfig.setSoundVolume("0.1");
                Sound.playClick();
            },
        },
        {
            id: "setSoundVolume0.5",
            display: "medium",
            configValue: "0.5",
            exec: () => {
                UpdateConfig.setSoundVolume("0.5");
                Sound.playClick();
            },
        },
        {
            id: "setSoundVolume1.0",
            display: "loud",
            configValue: "1.0",
            exec: () => {
                UpdateConfig.setSoundVolume("1.0");
                Sound.playClick();
            },
        },
    ],
};
const commandsFlipTestColors = {
    title: "Flip test colors...",
    configKey: "flipTestColors",
    list: [
        {
            id: "setFlipTestColorsOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setFlipTestColors(false);
            },
        },
        {
            id: "setFlipTestColorsOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setFlipTestColors(true);
            },
        },
    ],
};
const commandsSmoothLineScroll = {
    title: "Smooth line scroll...",
    configKey: "smoothLineScroll",
    list: [
        {
            id: "setSmoothLineScrollOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setSmoothLineScroll(false);
            },
        },
        {
            id: "setSmoothLineScrollOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setSmoothLineScroll(true);
            },
        },
    ],
};
const commandsAlwaysShowDecimal = {
    title: "Always show decimal places...",
    configKey: "alwaysShowDecimalPlaces",
    list: [
        {
            id: "setAlwaysShowDecimalPlacesOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setAlwaysShowDecimalPlaces(false);
            },
        },
        {
            id: "setAlwaysShowDecimalPlacesOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setAlwaysShowDecimalPlaces(true);
            },
        },
    ],
};
const commandsAlwaysShowCPM = {
    title: "Always show CPM...",
    configKey: "alwaysShowCPM",
    list: [
        {
            id: "setAlwaysShowCPMOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setAlwaysShowCPM(false);
            },
        },
        {
            id: "setAlwaysShowCPMOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setAlwaysShowCPM(true);
            },
        },
    ],
};
const commandsStartGraphsAtZero = {
    title: "Start graphs at zero...",
    configKey: "startGraphsAtZero",
    list: [
        {
            id: "setStartGraphsAtZeroOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setStartGraphsAtZero(false);
            },
        },
        {
            id: "setStartGraphsAtZeroOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setStartGraphsAtZero(true);
            },
        },
    ],
};
const commandsLazyMode = {
    title: "Lazy mode...",
    configKey: "lazyMode",
    list: [
        {
            id: "setLazyModeOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setLazyMode(false);
                TestLogic.restart();
            },
        },
        {
            id: "setLazyModeOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setLazyMode(true);
                TestLogic.restart();
            },
        },
    ],
};
const commandsSwapEscAndTab = {
    title: "Swap esc and tab...",
    configKey: "swapEscAndTab",
    list: [
        {
            id: "setSwapEscAndTabOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setSwapEscAndTab(false);
            },
        },
        {
            id: "setSwapEscAndTabOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setSwapEscAndTab(true);
            },
        },
    ],
};
const commandsShowAllLines = {
    title: "Show all lines...",
    configKey: "showAllLines",
    list: [
        {
            id: "setShowAllLinesOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowAllLines(false);
            },
        },
        {
            id: "setShowAllLinesOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowAllLines(true);
            },
        },
    ],
};
const commandsColorfulMode = {
    title: "Colorful mode...",
    configKey: "colorfulMode",
    list: [
        {
            id: "setColorfulModeOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setColorfulMode(false);
            },
        },
        {
            id: "setColorfulModeOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setColorfulMode(true);
            },
        },
    ],
};
const commandsOutOfFocusWarning = {
    title: "Colorful mode...",
    configKey: "showOutOfFocusWarning",
    list: [
        {
            id: "setShowOutOfFocusWarningOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setShowOutOfFocusWarning(false);
            },
        },
        {
            id: "setShowOutOfFocusWarningOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setShowOutOfFocusWarning(true);
            },
        },
    ],
};
const commandsKeymapMode = {
    title: "Keymap mode...",
    configKey: "keymapMode",
    list: [
        {
            id: "setKeymapModeOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setKeymapMode("off");
            },
        },
        {
            id: "setKeymapModeStatic",
            display: "static",
            configValue: "static",
            exec: () => {
                UpdateConfig.setKeymapMode("static");
            },
        },
        {
            id: "setKeymapModeNext",
            display: "next",
            configValue: "next",
            exec: () => {
                UpdateConfig.setKeymapMode("next");
            },
        },
        {
            id: "setKeymapModeReact",
            display: "react",
            alias: "flash",
            configValue: "react",
            exec: () => {
                UpdateConfig.setKeymapMode("react");
            },
        },
    ],
};
const commandsSoundOnClick = {
    title: "Sound on click...",
    configKey: "playSoundOnClick",
    list: [
        {
            id: "setSoundOnClickOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("off");
            },
        },
        {
            id: "setSoundOnClick1",
            display: "click",
            configValue: "1",
            hover: () => {
                Sound.previewClick("1");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("1");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick2",
            display: "beep",
            configValue: "2",
            hover: () => {
                Sound.previewClick("2");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("2");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick3",
            display: "pop",
            configValue: "3",
            hover: () => {
                Sound.previewClick("3");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("3");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick4",
            display: "nk creams",
            configValue: "4",
            hover: () => {
                Sound.previewClick("4");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("4");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick5",
            display: "typewriter",
            configValue: "5",
            hover: () => {
                Sound.previewClick("5");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("5");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick6",
            display: "osu",
            configValue: "6",
            hover: () => {
                Sound.previewClick("6");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("6");
                Sound.playClick();
            },
        },
        {
            id: "setSoundOnClick7",
            display: "hitmarker",
            configValue: "7",
            hover: () => {
                Sound.previewClick("7");
            },
            exec: () => {
                UpdateConfig.setPlaySoundOnClick("7");
                Sound.playClick();
            },
        },
    ],
};
const commandsRandomTheme = {
    title: "Random theme...",
    configKey: "randomTheme",
    list: [
        {
            id: "setRandomOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setRandomTheme("off");
            },
        },
        {
            id: "setRandomOn",
            display: "on",
            configValue: "on",
            exec: () => {
                UpdateConfig.setRandomTheme("on");
            },
        },
        {
            id: "setRandomFav",
            display: "fav",
            configValue: "fav",
            exec: () => {
                UpdateConfig.setRandomTheme("fav");
            },
        },
        {
            id: "setRandomLight",
            display: "light",
            configValue: "light",
            exec: () => {
                UpdateConfig.setRandomTheme("light");
            },
        },
        {
            id: "setRandomDark",
            display: "dark",
            configValue: "dark",
            exec: () => {
                UpdateConfig.setRandomTheme("dark");
            },
        },
        {
            id: "setRandomCustom",
            display: "custom",
            configValue: "custom",
            exec: () => {
                if (firebase_1.Auth.currentUser === null) {
                    Notifications.add("Multiple custom themes are available to logged in users only", 0);
                    return;
                }
                UpdateConfig.setRandomTheme("custom");
            },
        },
    ],
};
const commandsDifficulty = {
    title: "Difficulty...",
    configKey: "difficulty",
    list: [
        {
            id: "setDifficultyNormal",
            display: "normal",
            configValue: "normal",
            exec: () => {
                UpdateConfig.setDifficulty("normal");
            },
        },
        {
            id: "setDifficultyExpert",
            display: "expert",
            configValue: "expert",
            exec: () => {
                UpdateConfig.setDifficulty("expert");
            },
        },
        {
            id: "setDifficultyMaster",
            display: "master",
            configValue: "master",
            exec: () => {
                UpdateConfig.setDifficulty("master");
            },
        },
    ],
};
exports.commandsEnableAds = {
    title: "Set enable ads...",
    configKey: "enableAds",
    list: [
        {
            id: "setEnableAdsOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setEnableAds("off");
            },
        },
        {
            id: "setEnableAdsOn",
            display: "on",
            configValue: "on",
            exec: () => {
                UpdateConfig.setEnableAds("on");
            },
        },
        {
            id: "setEnableMax",
            display: "sellout",
            configValue: "max",
            exec: () => {
                UpdateConfig.setEnableAds("max");
            },
        },
    ],
};
exports.customThemeCommands = {
    title: "Custom theme",
    configKey: "customTheme",
    list: [
        {
            id: "setCustomThemeOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setCustomTheme(false);
            },
        },
        {
            id: "setCustomThemeOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setCustomTheme(true);
            },
        },
    ],
};
exports.customThemeListCommands = {
    title: "Custom themes list...",
    // configKey: "customThemeId",
    list: [],
};
function updateCustomThemeListCommands() {
    if (firebase_1.Auth.currentUser === null) {
        return;
    }
    exports.customThemeListCommands.list = [];
    const snapshot = DB.getSnapshot();
    if (!snapshot)
        return;
    if (DB.getSnapshot().customThemes.length < 0) {
        Notifications.add("You need to create a custom theme first", 0);
        return;
    }
    DB.getSnapshot().customThemes.forEach((theme) => {
        exports.customThemeListCommands.list.push({
            id: "setCustomThemeId" + theme._id,
            display: theme.name,
            configValue: theme._id,
            hover: () => {
                ThemeController.preview(theme._id, true);
            },
            exec: () => {
                // UpdateConfig.setCustomThemeId(theme._id);
                UpdateConfig.setCustomTheme(true);
                ThemeController.set(theme._id, true);
            },
        });
    });
    return;
}
exports.updateCustomThemeListCommands = updateCustomThemeListCommands;
const commandsCaretStyle = {
    title: "Change caret style...",
    configKey: "caretStyle",
    list: [
        {
            id: "setCaretStyleOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setCaretStyle("off");
            },
        },
        {
            id: "setCaretStyleDefault",
            display: "line",
            configValue: "default",
            exec: () => {
                UpdateConfig.setCaretStyle("default");
            },
        },
        {
            id: "setCaretStyleBlock",
            display: "block",
            configValue: "block",
            exec: () => {
                UpdateConfig.setCaretStyle("block");
            },
        },
        {
            id: "setCaretStyleOutline",
            display: "outline-block",
            configValue: "outline",
            exec: () => {
                UpdateConfig.setCaretStyle("outline");
            },
        },
        {
            id: "setCaretStyleUnderline",
            display: "underline",
            configValue: "underline",
            exec: () => {
                UpdateConfig.setCaretStyle("underline");
            },
        },
        {
            id: "setCaretStyleCarrot",
            display: "carrot",
            configValue: "carrot",
            visible: false,
            exec: () => {
                UpdateConfig.setCaretStyle("carrot");
            },
        },
        {
            id: "setCaretStyleBanana",
            display: "banana",
            configValue: "banana",
            visible: false,
            exec: () => {
                UpdateConfig.setCaretStyle("banana");
            },
        },
    ],
};
const commandsPaceCaretStyle = {
    title: "Change pace caret style...",
    configKey: "paceCaretStyle",
    list: [
        {
            id: "setPaceCaretStyleDefault",
            display: "line",
            configValue: "default",
            exec: () => {
                UpdateConfig.setPaceCaretStyle("default");
            },
        },
        {
            id: "setPaceCaretStyleBlock",
            display: "block",
            configValue: "block",
            exec: () => {
                UpdateConfig.setPaceCaretStyle("block");
            },
        },
        {
            id: "setPaceCaretStyleOutline",
            display: "outline-block",
            configValue: "outline",
            exec: () => {
                UpdateConfig.setPaceCaretStyle("outline");
            },
        },
        {
            id: "setPaceCaretStyleUnderline",
            display: "underline",
            configValue: "underline",
            exec: () => {
                UpdateConfig.setPaceCaretStyle("underline");
            },
        },
        {
            id: "setPaceCaretStyleCarrot",
            display: "carrot",
            configValue: "carrot",
            visible: false,
            exec: () => {
                UpdateConfig.setPaceCaretStyle("carrot");
            },
        },
        {
            id: "setPaceCaretStyleBanana",
            display: "banana",
            configValue: "banana",
            visible: false,
            exec: () => {
                UpdateConfig.setPaceCaretStyle("banana");
            },
        },
    ],
};
const commandsRepeatedPace = {
    title: "Repeated pace...",
    configKey: "repeatedPace",
    list: [
        {
            id: "setRepeatedPaceOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setRepeatedPace(false);
            },
        },
        {
            id: "setRepeatedPaceOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setRepeatedPace(true);
            },
        },
    ],
};
const commandsPaceCaret = {
    title: "Pace caret mode...",
    configKey: "paceCaret",
    list: [
        {
            id: "setPaceCaretOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setPaceCaret("off");
                TestLogic.restart();
            },
        },
        {
            id: "setPaceCaretPb",
            display: "pb",
            configValue: "pb",
            exec: () => {
                UpdateConfig.setPaceCaret("pb");
                TestLogic.restart();
            },
        },
        {
            id: "setPaceCaretAverage",
            display: "average",
            configValue: "average",
            exec: () => {
                UpdateConfig.setPaceCaret("average");
                TestLogic.restart();
            },
        },
        {
            id: "setPaceCaretCustom",
            display: "custom...",
            configValue: "custom",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setPaceCaretCustomSpeed(parseInt(input));
                UpdateConfig.setPaceCaret("custom");
                TestLogic.restart();
            },
        },
    ],
};
const commandsMinWpm = {
    title: "Change min wpm mode...",
    configKey: "minWpm",
    list: [
        {
            id: "setMinWpmOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setMinWpm("off");
            },
        },
        {
            id: "setMinWpmCustom",
            display: "custom...",
            configValue: "custom",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMinWpmCustomSpeed(parseInt(input));
                UpdateConfig.setMinWpm("custom");
            },
        },
    ],
};
const commandsMinAcc = {
    title: "Change min accuracy mode...",
    configKey: "minAcc",
    list: [
        {
            id: "setMinAccOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setMinAcc("off");
            },
        },
        {
            id: "setMinAccCustom",
            display: "custom...",
            configValue: "custom",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMinAccCustom(parseInt(input));
                UpdateConfig.setMinAcc("custom");
            },
        },
    ],
};
const commandsMinBurst = {
    title: "Change min burst mode...",
    configKey: "minBurst",
    list: [
        {
            id: "setMinBurstOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setMinBurst("off");
            },
        },
        {
            id: "setMinBurstFixed",
            display: "fixed...",
            configValue: "fixed",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMinBurst("fixed");
                UpdateConfig.setMinBurstCustomSpeed(parseInt(input));
            },
        },
        {
            id: "setMinBurstFlex",
            display: "flex...",
            configValue: "flex",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMinBurst("flex");
                UpdateConfig.setMinBurstCustomSpeed(parseInt(input));
            },
        },
    ],
};
const commandsKeymapStyle = {
    title: "Keymap style...",
    configKey: "keymapStyle",
    list: [
        {
            id: "setKeymapStyleStaggered",
            display: "staggered",
            configValue: "staggered",
            exec: () => {
                UpdateConfig.setKeymapStyle("staggered");
            },
        },
        {
            id: "setKeymapStyleAlice",
            display: "alice",
            configValue: "alice",
            exec: () => {
                UpdateConfig.setKeymapStyle("alice");
            },
        },
        {
            id: "setKeymapStyleMatrix",
            display: "matrix",
            configValue: "matrix",
            exec: () => {
                UpdateConfig.setKeymapStyle("matrix");
            },
        },
        {
            id: "setKeymapStyleSplit",
            display: "split",
            configValue: "split",
            exec: () => {
                UpdateConfig.setKeymapStyle("split");
            },
        },
        {
            id: "setKeymapStyleSplitMatrix",
            display: "split matrix",
            configValue: "split_matrix",
            exec: () => {
                UpdateConfig.setKeymapStyle("split_matrix");
            },
        },
    ],
};
const commandsKeymapLegendStyle = {
    title: "Keymap legend style...",
    configKey: "keymapLegendStyle",
    list: [
        {
            id: "setKeymapLegendStyleLowercase",
            display: "lowercase",
            configValue: "lowercase",
            exec: () => {
                UpdateConfig.setKeymapLegendStyle("lowercase");
            },
        },
        {
            id: "setKeymapLegendStyleUppercase",
            display: "uppercase",
            configValue: "uppercase",
            exec: () => {
                UpdateConfig.setKeymapLegendStyle("uppercase");
            },
        },
        {
            id: "setKeymapLegendStyleBlank",
            display: "blank",
            configValue: "blank",
            exec: () => {
                UpdateConfig.setKeymapLegendStyle("blank");
            },
        },
        {
            id: "setKeymapLegendStyleDynamic",
            display: "dynamic",
            configValue: "dynamic",
            exec: () => {
                UpdateConfig.setKeymapLegendStyle("dynamic");
            },
        },
    ],
};
const commandsBritishEnglish = {
    title: "British english...",
    configKey: "britishEnglish",
    list: [
        {
            id: "setBritishEnglishOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setBritishEnglish(false);
                TestLogic.restart();
            },
        },
        {
            id: "setBritishEnglishOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setBritishEnglish(true);
                TestLogic.restart();
            },
        },
    ],
};
const commandsHighlightMode = {
    title: "Highlight mode...",
    configKey: "highlightMode",
    list: [
        {
            id: "setHighlightModeOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setHighlightMode("off");
            },
        },
        {
            id: "setHighlightModeLetter",
            display: "letter",
            configValue: "letter",
            exec: () => {
                UpdateConfig.setHighlightMode("letter");
            },
        },
        {
            id: "setHighlightModeWord",
            display: "word",
            configValue: "word",
            exec: () => {
                UpdateConfig.setHighlightMode("word");
            },
        },
    ],
};
const commandsTimerStyle = {
    title: "Timer/progress style...",
    configKey: "timerStyle",
    list: [
        {
            id: "setTimerStyleBar",
            display: "bar",
            configValue: "bar",
            exec: () => {
                UpdateConfig.setTimerStyle("bar");
            },
        },
        {
            id: "setTimerStyleText",
            display: "text",
            configValue: "text",
            exec: () => {
                UpdateConfig.setTimerStyle("text");
            },
        },
        {
            id: "setTimerStyleMini",
            display: "mini",
            configValue: "mini",
            exec: () => {
                UpdateConfig.setTimerStyle("mini");
            },
        },
    ],
};
const commandsTimerColor = {
    title: "Timer/progress color...",
    configKey: "timerColor",
    list: [
        {
            id: "setTimerColorBlack",
            display: "black",
            configValue: "black",
            exec: () => {
                UpdateConfig.setTimerColor("black");
            },
        },
        {
            id: "setTimerColorSub",
            display: "sub",
            configValue: "sub",
            exec: () => {
                UpdateConfig.setTimerColor("sub");
            },
        },
        {
            id: "setTimerColorText",
            display: "text",
            configValue: "text",
            exec: () => {
                UpdateConfig.setTimerColor("text");
            },
        },
        {
            id: "setTimerColorMain",
            display: "main",
            configValue: "main",
            exec: () => {
                UpdateConfig.setTimerColor("main");
            },
        },
    ],
};
const commandsSingleListCommandLine = {
    title: "Single list command line...",
    configKey: "singleListCommandLine",
    list: [
        {
            id: "singleListCommandLineManual",
            display: "manual",
            configValue: "manual",
            exec: () => {
                UpdateConfig.setSingleListCommandLine("manual");
            },
        },
        {
            id: "singleListCommandLineOn",
            display: "on",
            configValue: "on",
            exec: () => {
                UpdateConfig.setSingleListCommandLine("on");
            },
        },
    ],
};
const commandsCapsLockWarning = {
    title: "Caps lock warning...",
    configKey: "capsLockWarning",
    list: [
        {
            id: "capsLockWarningOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setCapsLockWarning(true);
            },
        },
        {
            id: "capsLockWarningOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setCapsLockWarning(false);
            },
        },
    ],
};
const commandsTimerOpacity = {
    title: "Timer/progress opacity...",
    configKey: "timerOpacity",
    list: [
        {
            id: "setTimerOpacity.25",
            display: ".25",
            configValue: 0.25,
            exec: () => {
                UpdateConfig.setTimerOpacity("0.25");
            },
        },
        {
            id: "setTimerOpacity.5",
            display: ".5",
            configValue: 0.5,
            exec: () => {
                UpdateConfig.setTimerOpacity("0.5");
            },
        },
        {
            id: "setTimerOpacity.75",
            display: ".75",
            configValue: 0.75,
            exec: () => {
                UpdateConfig.setTimerOpacity("0.75");
            },
        },
        {
            id: "setTimerOpacity1",
            display: "1",
            configValue: 1,
            exec: () => {
                UpdateConfig.setTimerOpacity("1");
            },
        },
    ],
};
const commandsWordCount = {
    title: "Change word count...",
    configKey: "words",
    list: [
        {
            id: "changeWordCount10",
            display: "10",
            configValue: 10,
            exec: () => {
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(10);
                TestLogic.restart();
            },
        },
        {
            id: "changeWordCount25",
            display: "25",
            configValue: 25,
            exec: () => {
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(25);
                TestLogic.restart();
            },
        },
        {
            id: "changeWordCount50",
            display: "50",
            configValue: 50,
            exec: () => {
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(50);
                TestLogic.restart();
            },
        },
        {
            id: "changeWordCount100",
            display: "100",
            configValue: 100,
            exec: () => {
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(100);
                TestLogic.restart();
            },
        },
        {
            id: "changeWordCount200",
            display: "200",
            configValue: 200,
            exec: () => {
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(200);
                TestLogic.restart();
            },
        },
        {
            id: "changeWordCountCustom",
            display: "custom...",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMode("words");
                UpdateConfig.setWordCount(parseInt(input));
                TestLogic.restart();
            },
        },
    ],
};
const commandsQuoteLengthConfig = {
    title: "Change quote length...",
    configKey: "quoteLength",
    list: [
        {
            id: "changeQuoteLengthAll",
            display: "all",
            configValue: [0, 1, 2, 3],
            exec: () => {
                UpdateConfig.setMode("quote");
                UpdateConfig.setQuoteLength([0, 1, 2, 3]);
                TestLogic.restart();
            },
        },
        {
            id: "changeQuoteLengthShort",
            display: "short",
            configValue: 0,
            configValueMode: "include",
            exec: () => {
                UpdateConfig.setMode("quote");
                UpdateConfig.setQuoteLength(0);
                TestLogic.restart();
            },
        },
        {
            id: "changeQuoteLengthMedium",
            display: "medium",
            configValue: 1,
            configValueMode: "include",
            exec: () => {
                UpdateConfig.setMode("quote");
                UpdateConfig.setQuoteLength(1);
                TestLogic.restart();
            },
        },
        {
            id: "changeQuoteLengthLong",
            display: "long",
            configValue: 2,
            configValueMode: "include",
            exec: () => {
                UpdateConfig.setMode("quote");
                UpdateConfig.setQuoteLength(2);
                TestLogic.restart();
            },
        },
        {
            id: "changeQuoteLengthThicc",
            display: "thicc",
            configValue: 3,
            configValueMode: "include",
            exec: () => {
                UpdateConfig.setMode("quote");
                UpdateConfig.setQuoteLength(3);
                TestLogic.restart();
            },
        },
    ],
};
const commandsPunctuation = {
    title: "Change punctuation...",
    configKey: "punctuation",
    list: [
        {
            id: "changePunctuationOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setPunctuation(true);
                TestLogic.restart();
            },
        },
        {
            id: "changePunctuationOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setPunctuation(false);
                TestLogic.restart();
            },
        },
    ],
};
const commandsNumbers = {
    title: "Numbers...",
    configKey: "numbers",
    list: [
        {
            id: "changeNumbersOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setNumbers(true);
                TestLogic.restart();
            },
        },
        {
            id: "changeNumbersOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setNumbers(false);
                TestLogic.restart();
            },
        },
    ],
};
const commandsSmoothCaret = {
    title: "Smooth caret...",
    configKey: "smoothCaret",
    list: [
        {
            id: "changeSmoothCaretOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setSmoothCaret(true);
            },
        },
        {
            id: "changeSmoothCaretOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setSmoothCaret(false);
            },
        },
    ],
};
const commandsQuickTab = {
    title: "Quick tab...",
    configKey: "quickTab",
    list: [
        {
            id: "changeQuickTabOn",
            display: "on",
            configValue: true,
            exec: () => {
                UpdateConfig.setQuickTabMode(true);
            },
        },
        {
            id: "changeQuickTabOff",
            display: "off",
            configValue: false,
            exec: () => {
                UpdateConfig.setQuickTabMode(false);
            },
        },
    ],
};
const commandsMode = {
    title: "Change mode...",
    configKey: "mode",
    list: [
        {
            id: "changeModeTime",
            display: "time",
            configValue: "time",
            exec: () => {
                UpdateConfig.setMode("time");
                TestLogic.restart();
            },
        },
        {
            id: "changeModeWords",
            display: "words",
            configValue: "words",
            exec: () => {
                UpdateConfig.setMode("words");
                TestLogic.restart();
            },
        },
        {
            id: "changeModeQuote",
            display: "quote",
            configValue: "quote",
            exec: () => {
                UpdateConfig.setMode("quote");
                TestLogic.restart();
            },
        },
        {
            id: "changeModeCustom",
            display: "custom",
            configValue: "custom",
            exec: () => {
                UpdateConfig.setMode("custom");
                TestLogic.restart();
            },
        },
        {
            id: "changeModeZen",
            display: "zen",
            configValue: "zen",
            exec: () => {
                UpdateConfig.setMode("zen");
                ManualRestart.set();
                TestLogic.restart();
            },
        },
    ],
};
const commandsTimeConfig = {
    title: "Change time config...",
    configKey: "time",
    list: [
        {
            id: "changeTimeConfig15",
            display: "15",
            configValue: 15,
            exec: () => {
                UpdateConfig.setMode("time");
                UpdateConfig.setTimeConfig(15);
                TestLogic.restart();
            },
        },
        {
            id: "changeTimeConfig30",
            display: "30",
            configValue: 30,
            exec: () => {
                UpdateConfig.setMode("time");
                UpdateConfig.setTimeConfig(30);
                TestLogic.restart();
            },
        },
        {
            id: "changeTimeConfig60",
            display: "60",
            configValue: 60,
            exec: () => {
                UpdateConfig.setMode("time");
                UpdateConfig.setTimeConfig(60);
                TestLogic.restart();
            },
        },
        {
            id: "changeTimeConfig120",
            display: "120",
            configValue: 120,
            exec: () => {
                UpdateConfig.setMode("time");
                UpdateConfig.setTimeConfig(120);
                TestLogic.restart();
            },
        },
        {
            id: "changeTimeConfigCustom",
            display: "custom...",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setMode("time");
                UpdateConfig.setTimeConfig(parseInt(input));
                TestLogic.restart();
            },
        },
    ],
};
const commandsConfidenceMode = {
    title: "Confidence mode...",
    configKey: "confidenceMode",
    list: [
        {
            id: "changeConfidenceModeOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setConfidenceMode("off");
            },
        },
        {
            id: "changeConfidenceModeOn",
            display: "on",
            configValue: "on",
            exec: () => {
                UpdateConfig.setConfidenceMode("on");
            },
        },
        {
            id: "changeConfidenceModeMax",
            display: "max",
            configValue: "max",
            exec: () => {
                UpdateConfig.setConfidenceMode("max");
            },
        },
    ],
};
const commandsStopOnError = {
    title: "Stop on error...",
    configKey: "stopOnError",
    list: [
        {
            id: "changeStopOnErrorOff",
            display: "off",
            configValue: "off",
            exec: () => {
                UpdateConfig.setStopOnError("off");
            },
        },
        {
            id: "changeStopOnErrorLetter",
            display: "letter",
            configValue: "letter",
            exec: () => {
                UpdateConfig.setStopOnError("letter");
            },
        },
        {
            id: "changeStopOnErrorWord",
            display: "word",
            configValue: "word",
            exec: () => {
                UpdateConfig.setStopOnError("word");
            },
        },
    ],
};
const commandsFontSize = {
    title: "Font size...",
    configKey: "fontSize",
    list: [
        {
            id: "changeFontSize1",
            display: "1x",
            configValue: 1,
            exec: () => {
                UpdateConfig.setFontSize("1");
                TestLogic.restart();
            },
        },
        {
            id: "changeFontSize125",
            display: "1.25x",
            configValue: 125,
            exec: () => {
                UpdateConfig.setFontSize("125");
                TestLogic.restart();
            },
        },
        {
            id: "changeFontSize15",
            display: "1.5x",
            configValue: 15,
            exec: () => {
                UpdateConfig.setFontSize("15");
                TestLogic.restart();
            },
        },
        {
            id: "changeFontSize2",
            display: "2x",
            configValue: 2,
            exec: () => {
                UpdateConfig.setFontSize("2");
                TestLogic.restart();
            },
        },
        {
            id: "changeFontSize3",
            display: "3x",
            configValue: 3,
            exec: () => {
                UpdateConfig.setFontSize("3");
                TestLogic.restart();
            },
        },
        {
            id: "changeFontSize4",
            display: "4x",
            configValue: 4,
            exec: () => {
                UpdateConfig.setFontSize("4");
                TestLogic.restart();
            },
        },
    ],
};
const commandsPageWidth = {
    title: "Page width...",
    configKey: "pageWidth",
    list: [
        {
            id: "setPageWidth100",
            display: "100",
            configValue: "100",
            exec: () => {
                UpdateConfig.setPageWidth("100");
            },
        },
        {
            id: "setPageWidth125",
            display: "125",
            configValue: "125",
            exec: () => {
                UpdateConfig.setPageWidth("125");
            },
        },
        {
            id: "setPageWidth150",
            display: "150",
            configValue: "150",
            exec: () => {
                UpdateConfig.setPageWidth("150");
            },
        },
        {
            id: "setPageWidth200",
            display: "200",
            configValue: "200",
            exec: () => {
                UpdateConfig.setPageWidth("200");
            },
        },
        {
            id: "setPageWidthMax",
            display: "max",
            configValue: "max",
            exec: () => {
                UpdateConfig.setPageWidth("max");
            },
        },
    ],
};
const commandsPractiseWords = {
    title: "Practice words...",
    list: [
        {
            id: "practiseWordsMissed",
            display: "missed",
            noIcon: true,
            exec: () => {
                PractiseWords.init(true, false);
                TestLogic.restart(false, false, undefined, true);
            },
        },
        {
            id: "practiseWordsSlow",
            display: "slow",
            noIcon: true,
            exec: () => {
                PractiseWords.init(false, true);
                TestLogic.restart(false, false, undefined, true);
            },
        },
        {
            id: "practiseWordsBoth",
            display: "both",
            noIcon: true,
            exec: () => {
                PractiseWords.init(true, true);
                TestLogic.restart(false, false, undefined, true);
            },
        },
    ],
};
exports.themeCommands = {
    title: "Theme...",
    configKey: "theme",
    list: [],
};
Misc.getThemesList().then((themes) => {
    themes.forEach((theme) => {
        exports.themeCommands.list.push({
            id: "changeTheme" + Misc.capitalizeFirstLetterOfEachWord(theme.name),
            display: theme.name.replace(/_/g, " "),
            configValue: theme.name,
            hover: () => {
                // previewTheme(theme.name);
                ThemeController.preview(theme.name, false);
            },
            exec: () => {
                UpdateConfig.setTheme(theme.name);
            },
        });
    });
});
exports.commandsChallenges = {
    title: "Load challenge...",
    list: [],
};
Misc.getChallengeList().then((challenges) => {
    challenges.forEach((challenge) => {
        exports.commandsChallenges.list.push({
            id: "loadChallenge" + Misc.capitalizeFirstLetterOfEachWord(challenge.name),
            noIcon: true,
            display: challenge.display,
            exec: () => {
                ChallengeController.setup(challenge.name);
                TestLogic.restart(false, true);
            },
        });
    });
});
// export function showFavouriteThemesAtTheTop() {
function updateThemeCommands() {
    if (config_1.default.favThemes.length > 0) {
        exports.themeCommands.list = [];
        config_1.default.favThemes.forEach((theme) => {
            exports.themeCommands.list.push({
                id: "changeTheme" + Misc.capitalizeFirstLetterOfEachWord(theme),
                display: theme.replace(/_/g, " "),
                hover: () => {
                    // previewTheme(theme);
                    ThemeController.preview(theme, false);
                },
                exec: () => {
                    UpdateConfig.setTheme(theme);
                },
            });
        });
        Misc.getThemesList().then((themes) => {
            themes.forEach((theme) => {
                if (config_1.default.favThemes.includes(theme.name))
                    return;
                exports.themeCommands.list.push({
                    id: "changeTheme" + Misc.capitalizeFirstLetterOfEachWord(theme.name),
                    display: theme.name.replace(/_/g, " "),
                    hover: () => {
                        // previewTheme(theme.name);
                        ThemeController.preview(theme.name, false);
                    },
                    exec: () => {
                        UpdateConfig.setTheme(theme.name);
                    },
                });
            });
        });
    }
}
exports.updateThemeCommands = updateThemeCommands;
const commandsCopyWordsToClipboard = {
    title: "Are you sure...",
    list: [
        {
            id: "copyNo",
            display: "Nevermind",
        },
        {
            id: "copyYes",
            display: "Yes, I am sure",
            exec: () => {
                const words = Misc.getWords();
                navigator.clipboard.writeText(words).then(() => {
                    Notifications.add("Copied to clipboard", 1);
                }, () => {
                    Notifications.add("Failed to copy!", -1);
                });
            },
        },
    ],
};
const commandsMonkeyPowerLevel = {
    title: "Power mode...",
    configKey: "monkeyPowerLevel",
    list: [
        {
            id: "monkeyPowerLevelOff",
            display: "off",
            configValue: "off",
            exec: () => UpdateConfig.setMonkeyPowerLevel("off"),
        },
        {
            id: "monkeyPowerLevel1",
            display: "mellow",
            configValue: "1",
            exec: () => UpdateConfig.setMonkeyPowerLevel("1"),
        },
        {
            id: "monkeyPowerLevel2",
            display: "high",
            configValue: "2",
            exec: () => UpdateConfig.setMonkeyPowerLevel("2"),
        },
        {
            id: "monkeyPowerLevel3",
            display: "ultra",
            configValue: "3",
            exec: () => UpdateConfig.setMonkeyPowerLevel("3"),
        },
        {
            id: "monkeyPowerLevel4",
            display: "over 9000",
            configValue: "4",
            exec: () => UpdateConfig.setMonkeyPowerLevel("4"),
        },
    ],
};
exports.defaultCommands = {
    title: "",
    list: [
        {
            id: "changePunctuation",
            display: "Punctuation...",
            icon: "!?",
            subgroup: commandsPunctuation,
        },
        {
            id: "changeMode",
            display: "Mode...",
            icon: "fa-bars",
            subgroup: commandsMode,
        },
        {
            id: "changeTimeConfig",
            display: "Time...",
            icon: "fa-clock",
            subgroup: commandsTimeConfig,
        },
        {
            id: "changeWordCount",
            display: "Words...",
            alias: "words",
            icon: "fa-font",
            subgroup: commandsWordCount,
        },
        {
            id: "changeQuoteLength",
            display: "Quote length...",
            icon: "fa-quote-right",
            alias: "quotes",
            subgroup: commandsQuoteLengthConfig,
        },
        {
            visible: false,
            id: "changeTags",
            display: "Tags...",
            icon: "fa-tag",
            subgroup: commandsTags,
            beforeSubgroup: () => {
                updateTagCommands();
            },
            // exec: (): void => {
            //   updateTagCommands();
            //   current.push();
            //   Commandline.show();
            // },
        },
        {
            visible: false,
            id: "applyPreset",
            display: "Presets...",
            icon: "fa-sliders-h",
            subgroup: commandsPresets,
            beforeSubgroup: () => {
                updatePresetCommands();
            },
            // exec: (): void => {
            //   updatePresetCommands();
            //   current.push(commandsPresets);
            //   Commandline.show();
            // },
        },
        {
            id: "changeConfidenceMode",
            display: "Confidence mode...",
            icon: "fa-backspace",
            subgroup: commandsConfidenceMode,
        },
        {
            id: "changeStopOnError",
            display: "Stop on error...",
            icon: "fa-hand-paper",
            subgroup: commandsStopOnError,
        },
        {
            id: "changeNumbers",
            display: "Numbers...",
            icon: "15",
            subgroup: commandsNumbers,
        },
        {
            id: "changeSmoothCaret",
            display: "Smooth caret...",
            icon: "fa-i-cursor",
            subgroup: commandsSmoothCaret,
        },
        {
            id: "changeQuickTab",
            display: "Quick tab...",
            icon: "fa-redo-alt",
            subgroup: commandsQuickTab,
        },
        {
            id: "changeRepeatQuotes",
            display: "Repeat quotes...",
            icon: "fa-sync-alt",
            subgroup: commandsRepeatQuotes,
        },
        {
            id: "changeLiveWpm",
            display: "Live WPM...",
            icon: "fa-tachometer-alt",
            subgroup: commandsLiveWpm,
        },
        {
            id: "changeLiveAcc",
            display: "Live accuracy...",
            icon: "fa-percentage",
            subgroup: commandsLiveAcc,
        },
        {
            id: "changeLiveBurst",
            display: "Live burst...",
            icon: "fa-fire-alt",
            subgroup: commandsLiveBurst,
        },
        {
            id: "changeShowTimer",
            display: "Timer/progress...",
            icon: "fa-clock",
            subgroup: commandsShowTimer,
        },
        {
            id: "changeKeyTips",
            display: "Key tips...",
            icon: "fa-question",
            subgroup: commandsKeyTips,
        },
        {
            id: "changeFreedomMode",
            display: "Freedom mode...",
            subgroup: commandsFreedomMode,
        },
        {
            id: "changeStrictSpace",
            display: "Strict space...",
            icon: "fa-minus",
            subgroup: commandsStrictSpace,
        },
        {
            id: "changeBlindMode",
            display: "Blind mode...",
            icon: "fa-eye-slash",
            subgroup: commandsBlindMode,
        },
        {
            id: "changeShowWordsHistory",
            display: "Always show words history...",
            icon: "fa-align-left",
            subgroup: commandsShowWordsHistory,
        },
        {
            id: "changeIndicateTypos",
            display: "Indicate typos...",
            icon: "fa-exclamation",
            subgroup: commandsIndicateTypos,
        },
        {
            id: "changeHideExtraLetters",
            display: "Hide extra letters...",
            icon: "fa-eye-slash",
            subgroup: commandsHideExtraLetters,
        },
        {
            id: "changeQuickEnd",
            display: "Quick end...",
            icon: "fa-step-forward",
            subgroup: commandsQuickEnd,
        },
        {
            id: "singleListCommandLine",
            display: "Single list command line...",
            icon: "fa-list",
            subgroup: commandsSingleListCommandLine,
        },
        {
            id: "capsLockWarning",
            display: "Caps lock warning...",
            icon: "fa-exclamation-triangle",
            subgroup: commandsCapsLockWarning,
        },
        {
            id: "changeMinWpm",
            display: "Minimum wpm...",
            alias: "minimum",
            icon: "fa-bomb",
            subgroup: commandsMinWpm,
        },
        {
            id: "changeMinAcc",
            display: "Minimum accuracy...",
            alias: "minimum",
            icon: "fa-bomb",
            subgroup: commandsMinAcc,
        },
        {
            id: "changeMinBurst",
            display: "Minimum burst...",
            alias: "minimum",
            icon: "fa-bomb",
            subgroup: commandsMinBurst,
        },
        {
            id: "changeOppositeShiftMode",
            display: "Change opposite shift mode...",
            icon: "fa-exchange-alt",
            subgroup: commandsOppositeShiftMode,
        },
        {
            id: "changeSoundOnClick",
            display: "Sound on click...",
            icon: "fa-volume-up",
            subgroup: commandsSoundOnClick,
        },
        {
            id: "changeSoundOnError",
            display: "Sound on error...",
            icon: "fa-volume-mute",
            subgroup: commandsSoundOnError,
        },
        {
            id: "changeSoundVolume",
            display: "Sound volume...",
            icon: "fa-volume-down",
            subgroup: commandsSoundVolume,
        },
        {
            id: "changeFlipTestColors",
            display: "Flip test colors...",
            icon: "fa-adjust",
            subgroup: commandsFlipTestColors,
        },
        {
            id: "changeSmoothLineScroll",
            display: "Smooth line scroll...",
            icon: "fa-align-left",
            subgroup: commandsSmoothLineScroll,
        },
        {
            id: "changeAlwaysShowDecimal",
            display: "Always show decimal places...",
            icon: "00",
            subgroup: commandsAlwaysShowDecimal,
        },
        {
            id: "changeAlwaysShowCPM",
            display: "Always show CPM...",
            icon: "fa-tachometer-alt",
            subgroup: commandsAlwaysShowCPM,
        },
        {
            id: "changeStartGraphsAtZero",
            display: "Start graphs at zero...",
            icon: "fa-chart-line",
            subgroup: commandsStartGraphsAtZero,
        },
        {
            id: "changeSwapEscAndTab",
            display: "Swap esc and tab...",
            icon: "fa-exchange-alt",
            subgroup: commandsSwapEscAndTab,
        },
        {
            id: "changeLazyMode",
            display: "Lazy mode...",
            icon: "fa-couch",
            subgroup: commandsLazyMode,
        },
        {
            id: "changeShowAllLines",
            display: "Show all lines...",
            icon: "fa-align-left",
            subgroup: commandsShowAllLines,
        },
        {
            id: "changeColorfulMode",
            display: "Colorful mode...",
            icon: "fa-fill-drip",
            subgroup: commandsColorfulMode,
        },
        {
            id: "changeOutOfFocusWarning",
            display: "Out of focus warning...",
            icon: "fa-exclamation",
            subgroup: commandsOutOfFocusWarning,
        },
        {
            id: "setEnableAds",
            display: "Enable ads...",
            icon: "fa-ad",
            subgroup: exports.commandsEnableAds,
        },
        {
            id: "changeTheme",
            display: "Theme...",
            icon: "fa-palette",
            subgroup: exports.themeCommands,
        },
        {
            id: "setCustomTheme",
            display: "Custom theme...",
            icon: "fa-palette",
            subgroup: exports.customThemeCommands,
        },
        {
            id: "setCustomThemeId",
            display: "Custom themes...",
            icon: "fa-palette",
            subgroup: exports.customThemeListCommands,
            beforeSubgroup: () => updateCustomThemeListCommands(),
            available: () => {
                return firebase_1.Auth.currentUser !== null;
            },
        },
        {
            id: "changeRandomTheme",
            display: "Random theme...",
            icon: "fa-random",
            subgroup: commandsRandomTheme,
        },
        {
            id: "randomizeTheme",
            display: "Next random theme",
            icon: "fa-random",
            exec: () => ThemeController.randomizeTheme(),
        },
        {
            id: "changeDifficulty",
            display: "Difficulty...",
            icon: "fa-star",
            subgroup: commandsDifficulty,
        },
        {
            id: "changeCaretStyle",
            display: "Caret style...",
            icon: "fa-i-cursor",
            subgroup: commandsCaretStyle,
        },
        {
            id: "changePaceCaret",
            display: "Pace caret mode...",
            icon: "fa-i-cursor",
            subgroup: commandsPaceCaret,
        },
        {
            id: "changePaceCaretStyle",
            display: "Pace caret style...",
            icon: "fa-i-cursor",
            subgroup: commandsPaceCaretStyle,
        },
        {
            id: "changeRepeatedPace",
            display: "Repeated pace...",
            icon: "fa-i-cursor",
            subgroup: commandsRepeatedPace,
        },
        {
            id: "changeTimerStyle",
            display: "Timer/progress style...",
            icon: "fa-clock",
            subgroup: commandsTimerStyle,
        },
        {
            id: "changeTimerColor",
            display: "Timer/progress color...",
            icon: "fa-clock",
            subgroup: commandsTimerColor,
        },
        {
            id: "changeTimerOpacity",
            display: "Timer/progress opacity...",
            icon: "fa-clock",
            subgroup: commandsTimerOpacity,
        },
        {
            id: "changeHighlightMode",
            display: "Highlight mode...",
            icon: "fa-highlighter",
            subgroup: commandsHighlightMode,
        },
        {
            id: "changeShowAverage",
            display: "Show average...",
            icon: "fa-chart-bar",
            subgroup: commandsShowAverage,
        },
        {
            id: "changeCustomBackground",
            display: "Custom background...",
            icon: "fa-image",
            defaultValue: "",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                UpdateConfig.setCustomBackground(input);
            },
        },
        {
            id: "changeLanguage",
            display: "Language...",
            icon: "fa-language",
            subgroup: commandsLanguages,
        },
        {
            id: "changeBritishEnglish",
            display: "British english...",
            icon: "fa-language",
            subgroup: commandsBritishEnglish,
        },
        {
            id: "changeFunbox",
            display: "Funbox...",
            alias: "fun box",
            icon: "fa-gamepad",
            subgroup: commandsFunbox,
        },
        {
            id: "changeLayout",
            display: "Layout emulator...",
            icon: "fa-keyboard",
            subgroup: commandsLayouts,
        },
        {
            id: "toggleKeymap",
            display: "Keymap mode...",
            icon: "fa-keyboard",
            alias: "keyboard",
            subgroup: commandsKeymapMode,
        },
        {
            id: "changeKeymapStyle",
            display: "Keymap style...",
            alias: "keyboard",
            icon: "fa-keyboard",
            subgroup: commandsKeymapStyle,
        },
        {
            id: "changeKeymapLegendStyle",
            display: "Keymap legend style...",
            alias: "keyboard",
            icon: "fa-keyboard",
            subgroup: commandsKeymapLegendStyle,
        },
        {
            id: "changeKeymapLayout",
            display: "Keymap layout...",
            alias: "keyboard",
            icon: "fa-keyboard",
            subgroup: exports.commandsKeymapLayouts,
        },
        {
            id: "changeCustomLayoutfluid",
            display: "Custom layoutfluid...",
            defaultValue: "qwerty dvorak colemak",
            input: true,
            icon: "fa-tint",
            exec: (input) => {
                if (input === undefined)
                    return;
                UpdateConfig.setCustomLayoutfluid(input);
                if (config_1.default.funbox === "layoutfluid")
                    TestLogic.restart();
                // UpdateConfig.setLayout(
                //   Config.customLayoutfluid
                //     ? Config.customLayoutfluid.split("_")[0]
                //     : "qwerty"
                // );
                // UpdateConfig.setKeymapLayout(
                //   Config.customLayoutfluid
                //     ? Config.customLayoutfluid.split("_")[0]
                //     : "qwerty"
                // );
            },
        },
        {
            id: "changeFontSize",
            display: "Font size...",
            icon: "fa-font",
            subgroup: commandsFontSize,
        },
        {
            id: "changeFontFamily",
            display: "Font family...",
            icon: "fa-font",
            subgroup: commandsFonts,
        },
        {
            id: "changePageWidth",
            display: "Page width...",
            icon: "fa-arrows-alt-h",
            subgroup: commandsPageWidth,
        },
        {
            id: "viewTypingPage",
            display: "View Typing Page",
            alias: "start begin type test",
            icon: "fa-keyboard",
            exec: () => {
                $("#top #menu .icon-button.view-start").trigger("click");
            },
        },
        {
            id: "viewLeaderboards",
            display: "View Leaderboards Page",
            icon: "fa-crown",
            exec: () => {
                $("#top #menu .icon-button.view-leaderboards").trigger("click");
            },
        },
        {
            id: "viewAbout",
            display: "View About Page",
            icon: "fa-info",
            exec: () => {
                $("#top #menu .icon-button.view-about").trigger("click");
            },
        },
        {
            id: "viewSettings",
            display: "View Settings Page",
            icon: "fa-cog",
            exec: () => {
                $("#top #menu .icon-button.view-settings").trigger("click");
            },
        },
        {
            id: "viewQuoteSearchPopup",
            display: "Search for quotes",
            icon: "fa-search",
            exec: () => {
                UpdateConfig.setMode("quote");
                $("#quote-search-button").trigger("click");
            },
            shouldFocusTestUI: false,
        },
        {
            id: "viewAccount",
            display: "View Account Page",
            icon: "fa-user",
            alias: "stats",
            exec: () => {
                $("#top #menu .icon-button.view-account").hasClass("hidden")
                    ? $("#top #menu .icon-button.view-login").trigger("click")
                    : $("#top #menu .icon-button.view-account").trigger("click");
            },
        },
        {
            id: "toggleFullscreen",
            display: "Toggle Fullscreen",
            icon: "fa-expand",
            exec: () => {
                Misc.toggleFullscreen();
            },
        },
        {
            id: "bailOut",
            display: "Bail out...",
            icon: "fa-running",
            subgroup: {
                title: "Are you sure...",
                list: [
                    {
                        id: "bailOutNo",
                        display: "Nevermind",
                        available: () => {
                            return canBailOut();
                        },
                    },
                    {
                        id: "bailOutForSure",
                        display: "Yes, I am sure",
                        exec: () => {
                            TestInput.setBailout(true);
                            TestLogic.finish();
                        },
                        available: () => {
                            return canBailOut();
                        },
                    },
                ],
            },
            visible: false,
            available: () => {
                return canBailOut();
            },
        },
        {
            id: "loadChallenge",
            display: "Load challenge...",
            icon: "fa-award",
            subgroup: exports.commandsChallenges,
        },
        {
            id: "joinDiscord",
            display: "Join the Discord server",
            icon: "fa-users",
            exec: () => {
                window.open("https://discord.gg/monkeytype");
            },
        },
        {
            id: "repeatTest",
            display: "Repeat test",
            icon: "fa-sync-alt",
            exec: () => {
                TestLogic.restart(true);
            },
            available: () => {
                return TestUI.resultVisible;
            },
        },
        {
            id: "practiseWords",
            display: "Practice words...",
            icon: "fa-exclamation-triangle",
            subgroup: commandsPractiseWords,
            available: () => {
                return TestUI.resultVisible;
            },
        },
        {
            id: "toggleWordHistory",
            display: "Toggle word history",
            icon: "fa-align-left",
            exec: () => {
                TestUI.toggleResultWords();
            },
            available: () => {
                return TestUI.resultVisible;
            },
        },
        {
            id: "saveScreenshot",
            display: "Save screenshot",
            icon: "fa-image",
            alias: "ss picture",
            exec: () => {
                setTimeout(() => {
                    TestUI.screenshot();
                }, 500);
            },
            available: () => {
                return TestUI.resultVisible;
            },
        },
        {
            id: "changeCustomModeText",
            display: "Change custom text",
            icon: "fa-align-left",
            exec: () => {
                CustomTextPopup.show();
            },
        },
        {
            id: "toggleMonkey",
            display: "Toggle Monkey",
            icon: "fa-egg",
            visible: false,
            exec: () => {
                UpdateConfig.setMonkey(!config_1.default.monkey);
            },
        },
        {
            id: "copyWordsToClipboard",
            display: "Copy words to clipboard",
            icon: "fa-copy",
            subgroup: true,
            exec: () => {
                exports.current.push(commandsCopyWordsToClipboard);
            },
        },
        {
            id: "importSettingsJSON",
            display: "Import settings JSON",
            icon: "fa-cog",
            input: true,
            exec: (input) => {
                if (!input)
                    return;
                try {
                    UpdateConfig.apply(JSON.parse(input));
                    UpdateConfig.saveFullConfigToLocalStorage();
                    Settings.update();
                    Notifications.add("Done", 1);
                }
                catch (e) {
                    Notifications.add("An error occured while importing settings: " + e, -1);
                }
            },
        },
        {
            id: "exportSettingsJSON",
            display: "Export settings JSON",
            icon: "fa-cog",
            input: true,
            defaultValue: "",
        },
        {
            id: "monkeyPower",
            display: "Power mode...",
            alias: "powermode",
            icon: "fa-egg",
            visible: false,
            subgroup: commandsMonkeyPowerLevel,
        },
        {
            id: "clearSwCache",
            display: "Clear SW cache",
            icon: "fa-cog",
            exec: () => __awaiter(void 0, void 0, void 0, function* () {
                const clist = yield caches.keys();
                for (const name of clist) {
                    yield caches.delete(name);
                }
                window.location.reload();
            }),
        },
        {
            id: "getSwCache",
            display: "Get SW cache",
            icon: "fa-cog",
            exec: () => __awaiter(void 0, void 0, void 0, function* () {
                alert(yield caches.keys());
            }),
        },
    ],
};
exports.current = [exports.defaultCommands];
function setCurrent(val) {
    exports.current = val;
}
exports.setCurrent = setCurrent;
function pushCurrent(val) {
    exports.current.push(val);
}
exports.pushCurrent = pushCurrent;
const listsObject = {
    commandsChallenges: exports.commandsChallenges,
    commandsLanguages,
    commandsDifficulty,
    commandsLazyMode,
    commandsPaceCaret,
    commandsShowAverage,
    commandsMinWpm,
    commandsMinAcc,
    commandsMinBurst,
    commandsFunbox,
    commandsConfidenceMode,
    commandsStopOnError,
    commandsLayouts,
    commandsOppositeShiftMode,
    commandsTags,
};
function getList(list) {
    return listsObject[list];
}
exports.getList = getList;
ConfigEvent.subscribe((eventKey, eventValue) => {
    var _a;
    if (eventKey === "saveToLocalStorage") {
        exports.defaultCommands.list.filter((command) => command.id == "exportSettingsJSON")[0].defaultValue = eventValue;
    }
    if (eventKey === "customBackground") {
        exports.defaultCommands.list.filter((command) => command.id == "changeCustomBackground")[0].defaultValue = eventValue;
    }
    if (eventKey === "customLayoutFluid") {
        exports.defaultCommands.list.filter((command) => command.id == "changeCustomLayoutfluid")[0].defaultValue = (_a = eventValue) === null || _a === void 0 ? void 0 : _a.replace(/#/g, " ");
    }
});


/***/ }),

/***/ "./src/scripts/elements/commandline.ts":
/*!*********************************************!*\
  !*** ./src/scripts/elements/commandline.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.isSingleListCommandLineActive = void 0;
const ThemeController = __importStar(__webpack_require__(/*! ../controllers/theme-controller */ "./src/scripts/controllers/theme-controller.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Focus = __importStar(__webpack_require__(/*! ../test/focus */ "./src/scripts/test/focus.ts"));
const CommandlineLists = __importStar(__webpack_require__(/*! ./commandline-lists */ "./src/scripts/elements/commandline-lists.ts"));
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const AnalyticsController = __importStar(__webpack_require__(/*! ../controllers/analytics-controller */ "./src/scripts/controllers/analytics-controller.ts"));
const PageTransition = __importStar(__webpack_require__(/*! ../states/page-transition */ "./src/scripts/states/page-transition.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
let commandLineMouseMode = false;
function showInput(command, placeholder, defaultValue = "") {
    $("#commandLineWrapper").removeClass("hidden");
    $("#commandLine").addClass("hidden");
    $("#commandInput").removeClass("hidden");
    $("#commandInput input").attr("placeholder", placeholder);
    $("#commandInput input").val(defaultValue);
    $("#commandInput input").trigger("focus");
    $("#commandInput input").attr("command", "");
    $("#commandInput input").attr("command", command);
    if (defaultValue != "") {
        $("#commandInput input").select();
    }
}
function isSingleListCommandLineActive() {
    return $("#commandLine").hasClass("allCommands");
}
exports.isSingleListCommandLineActive = isSingleListCommandLineActive;
function showFound() {
    $("#commandLine .suggestions").empty();
    let commandsHTML = "";
    const list = CommandlineLists.current[CommandlineLists.current.length - 1];
    $.each(list.list, (_index, obj) => {
        var _a;
        if (obj.found && (obj.available !== undefined ? obj.available() : true)) {
            let icon = (_a = obj.icon) !== null && _a !== void 0 ? _a : "fa-chevron-right";
            const faIcon = /^fa-/g.test(icon);
            if (!faIcon) {
                icon = `<div class="textIcon">${icon}</div>`;
            }
            else {
                icon = `<i class="fas fa-fw ${icon}"></i>`;
            }
            if (list.configKey) {
                if ((obj.configValueMode &&
                    obj.configValueMode === "include" &&
                    // todo figure this out without using any
                    config_1.default[list.configKey].includes(obj.configValue)) ||
                    config_1.default[list.configKey] === obj.configValue) {
                    icon = `<i class="fas fa-fw fa-check"></i>`;
                }
                else {
                    icon = `<i class="fas fa-fw"></i>`;
                }
            }
            let iconHTML = `<div class="icon">${icon}</div>`;
            if (obj.noIcon && !isSingleListCommandLineActive()) {
                iconHTML = "";
            }
            commandsHTML += `<div class="entry" command="${obj.id}">${iconHTML}<div>${obj.display}</div></div>`;
        }
    });
    $("#commandLine .suggestions").html(commandsHTML);
    if ($("#commandLine .suggestions .entry").length == 0) {
        $("#commandLine .separator").css({ height: 0, margin: 0 });
    }
    else {
        $("#commandLine .separator").css({
            height: "1px",
            "margin-bottom": ".5rem",
        });
    }
    const entries = $("#commandLine .suggestions .entry");
    if (entries.length > 0) {
        $(entries[0]).addClass("activeKeyboard");
        try {
            $.each(list.list, (_index, obj) => {
                if (obj.found) {
                    if ((!/theme/gi.test(obj.id) || obj.id === "toggleCustomTheme") &&
                        !ThemeController.randomTheme) {
                        ThemeController.clearPreview();
                    }
                    if (!/font/gi.test(obj.id)) {
                        UpdateConfig.previewFontFamily(config_1.default.fontFamily);
                    }
                    if (obj.hover)
                        obj.hover();
                    return false;
                }
                else {
                    return true;
                }
            });
        }
        catch (e) { }
    }
    $("#commandLine .listTitle").remove();
}
function updateSuggested() {
    const inputVal = $("#commandLine input").val()
        .toLowerCase()
        .split(" ")
        .filter((s, i) => s || i == 0); //remove empty entries after first
    const list = CommandlineLists.current[CommandlineLists.current.length - 1];
    if (inputVal[0] === "" &&
        config_1.default.singleListCommandLine === "on" &&
        CommandlineLists.current.length === 1) {
        $.each(list.list, (_index, obj) => {
            obj.found = false;
        });
        showFound();
        return;
    }
    //ignore the preceeding ">"s in the command line input
    if (inputVal[0] && inputVal[0][0] == ">") {
        inputVal[0] = inputVal[0].replace(/^>+/, "");
    }
    if (inputVal[0] == "" && inputVal.length == 1) {
        $.each(list.list, (_index, obj) => {
            if (obj.visible !== false)
                obj.found = true;
        });
    }
    else {
        $.each(list.list, (_index, obj) => {
            let foundcount = 0;
            $.each(inputVal, (_index2, obj2) => {
                if (obj2 == "")
                    return;
                const escaped = obj2.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&");
                const re = new RegExp("\\b" + escaped, "g");
                const res = obj.display.toLowerCase().match(re);
                const res2 = obj.alias !== undefined ? obj.alias.toLowerCase().match(re) : null;
                if ((res != null && res.length > 0) ||
                    (res2 != null && res2.length > 0)) {
                    foundcount++;
                }
                else {
                    foundcount--;
                }
            });
            if (foundcount > inputVal.length - 1) {
                obj.found = true;
            }
            else {
                obj.found = false;
            }
        });
    }
    showFound();
}
let show = () => {
    if (!$(".page.pageLoading").hasClass("hidden"))
        return;
    Focus.set(false);
    $("#commandLine").removeClass("hidden");
    $("#commandInput").addClass("hidden");
    if ($("#commandLineWrapper").hasClass("hidden")) {
        $("#commandLineWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({
            opacity: 1,
        }, 100);
    }
    $("#commandLine input").val("");
    CommandlineLists.updateThemeCommands();
    updateSuggested();
    $("#commandLine input").trigger("focus");
};
exports.show = show;
function hide(shouldFocusTestUI = true) {
    UpdateConfig.previewFontFamily(config_1.default.fontFamily);
    // applyCustomThemeColors();
    if (!ThemeController.randomTheme) {
        ThemeController.clearPreview();
    }
    $("#commandLineWrapper")
        .stop(true, true)
        .css("opacity", 1)
        .animate({
        opacity: 0,
    }, 100, () => {
        $("#commandLineWrapper").addClass("hidden");
        $("#commandLine").removeClass("allCommands");
        if (shouldFocusTestUI) {
            TestUI.focusWords();
        }
    });
    if (shouldFocusTestUI) {
        TestUI.focusWords();
    }
}
function trigger(command) {
    let subgroup = false;
    let input = false;
    let shouldFocusTestUI = true;
    const list = CommandlineLists.current[CommandlineLists.current.length - 1];
    let sticky = false;
    $.each(list.list, (_index, obj) => {
        var _a;
        if (obj.id == command) {
            if (obj.shouldFocusTestUI !== undefined) {
                shouldFocusTestUI = obj.shouldFocusTestUI;
            }
            if (obj.input) {
                input = true;
                const escaped = (_a = obj.display.split("</i>")[1]) !== null && _a !== void 0 ? _a : obj.display;
                showInput(obj.id, escaped, obj.defaultValue);
            }
            else if (obj.subgroup) {
                subgroup = true;
                if (obj.beforeSubgroup) {
                    obj.beforeSubgroup();
                }
                CommandlineLists.current.push(obj.subgroup);
                (0, exports.show)();
            }
            else {
                if (obj.exec)
                    obj.exec();
                if (obj.sticky === true) {
                    sticky = true;
                }
            }
        }
    });
    if (!subgroup && !input && !sticky) {
        AnalyticsController.log("usedCommandLine", { command });
        hide(shouldFocusTestUI);
    }
}
//todo rewrite this mess
function addChildCommands(unifiedCommands, commandItem, parentCommandDisplay = "", parentCommand) {
    var _a, _b;
    let commandItemDisplay = commandItem.display.replace(/\s?\.\.\.$/g, "");
    let icon = `<i class="fas fa-fw"></i>`;
    if (commandItem.configValue !== undefined &&
        config_1.default[parentCommand === null || parentCommand === void 0 ? void 0 : parentCommand.configKey] ===
            commandItem.configValue) {
        icon = `<i class="fas fa-fw fa-check"></i>`;
    }
    if (commandItem.noIcon) {
        icon = "";
    }
    if (parentCommandDisplay) {
        commandItemDisplay =
            parentCommandDisplay + " > " + icon + commandItemDisplay;
    }
    if (commandItem.subgroup) {
        const command = commandItem;
        if (command.beforeSubgroup)
            command.beforeSubgroup();
        try {
            (_b = ((_a = commandItem) === null || _a === void 0 ? void 0 : _a.subgroup).list) === null || _b === void 0 ? void 0 : _b.forEach((cmd) => {
                commandItem.configKey = commandItem
                    .subgroup.configKey;
                addChildCommands(unifiedCommands, cmd, commandItemDisplay, commandItem);
            });
            // commandItem.exec();
            // const currentCommandsIndex = CommandlineLists.current.length - 1;
            // CommandlineLists.current[currentCommandsIndex].list.forEach((cmd) => {
            //   if (cmd.alias === undefined) cmd.alias = commandItem.alias;
            //   addChildCommands(unifiedCommands, cmd, commandItemDisplay);
            // });
            // CommandlineLists.current.pop();
        }
        catch (e) { }
    }
    else {
        const tempCommandItem = Object.assign({}, commandItem);
        if (parentCommand) {
            tempCommandItem.icon = parentCommand.icon;
        }
        if (parentCommandDisplay)
            tempCommandItem.display = commandItemDisplay;
        unifiedCommands.push(tempCommandItem);
    }
}
function generateSingleListOfCommands() {
    const allCommands = [];
    const oldShowCommandLine = exports.show;
    exports.show = () => {
        //
    };
    CommandlineLists.defaultCommands.list.forEach((c) => addChildCommands(allCommands, c));
    exports.show = oldShowCommandLine;
    return {
        title: "All Commands",
        list: allCommands,
    };
}
function useSingleListCommandLine(sshow = true) {
    const allCommands = generateSingleListOfCommands();
    // if (Config.singleListCommandLine == "manual") {
    // CommandlineLists.pushCurrent(allCommands);
    // } else if (Config.singleListCommandLine == "on") {
    CommandlineLists.setCurrent([allCommands]);
    // }
    if (config_1.default.singleListCommandLine != "manual") {
        $("#commandLine").addClass("allCommands");
    }
    if (sshow)
        (0, exports.show)();
}
function restoreOldCommandLine(sshow = true) {
    if (isSingleListCommandLineActive()) {
        $("#commandLine").removeClass("allCommands");
        CommandlineLists.setCurrent(CommandlineLists.current.filter((l) => l.title != "All Commands"));
        if (CommandlineLists.current.length < 1) {
            CommandlineLists.setCurrent([CommandlineLists.defaultCommands]);
        }
    }
    if (sshow)
        (0, exports.show)();
}
$("#commandLine input").keyup((e) => {
    commandLineMouseMode = false;
    $("#commandLineWrapper #commandLine .suggestions .entry").removeClass("activeMouse");
    if (e.key === "ArrowUp" ||
        e.key === "ArrowDown" ||
        e.key === "Enter" ||
        e.key === "Tab" ||
        e.code == "AltLeft" ||
        (e.key.length > 1 && e.key !== "Backspace" && e.key !== "Delete")) {
        return;
    }
    updateSuggested();
});
$(document).ready(() => {
    $(document).on("keydown", (event) => {
        if (PageTransition.get())
            return event.preventDefault();
        // opens command line if escape, ctrl/cmd + shift + p, or tab is pressed if the setting swapEscAndTab is enabled
        if (event.key === "Escape" ||
            (event.key &&
                event.key.toLowerCase() === "p" &&
                (event.metaKey || event.ctrlKey) &&
                event.shiftKey) ||
            (event.key === "Tab" && config_1.default.swapEscAndTab)) {
            event.preventDefault();
            const popups = document.querySelectorAll(".popupWrapper");
            let popupVisible = false;
            for (const popup of popups) {
                if (!popup.classList.contains("hidden") === true) {
                    popupVisible = true;
                    break;
                }
            }
            if (popupVisible)
                return;
            if (!$("#commandLineWrapper").hasClass("hidden")) {
                if (CommandlineLists.current.length > 1) {
                    CommandlineLists.current.pop();
                    $("#commandLine").removeClass("allCommands");
                    (0, exports.show)();
                }
                else {
                    hide();
                }
                UpdateConfig.setFontFamily(config_1.default.fontFamily, true);
            }
            else if (event.key === "Tab" || !config_1.default.swapEscAndTab) {
                if (config_1.default.singleListCommandLine == "on") {
                    useSingleListCommandLine(false);
                }
                else {
                    CommandlineLists.setCurrent([CommandlineLists.defaultCommands]);
                }
                (0, exports.show)();
            }
        }
    });
});
$("#commandInput input").on("keydown", (e) => {
    if (e.key === "Enter") {
        //enter
        e.preventDefault();
        const command = $("#commandInput input").attr("command");
        const value = $("#commandInput input").val();
        const list = CommandlineLists.current[CommandlineLists.current.length - 1];
        $.each(list.list, (_index, obj) => {
            if (obj.id == command) {
                if (obj.exec)
                    obj.exec(value);
                if (obj.subgroup !== null && obj.subgroup !== undefined) {
                    //TODO: what is this for?
                    // subgroup = obj.subgroup;
                }
            }
        });
        AnalyticsController.log("usedCommandLine", { command: command !== null && command !== void 0 ? command : "" });
        hide();
    }
    return;
});
$(document).on("mousemove", () => {
    if (!commandLineMouseMode)
        commandLineMouseMode = true;
});
$(document).on("mouseenter", "#commandLineWrapper #commandLine .suggestions .entry", (e) => {
    if (!commandLineMouseMode)
        return;
    $(e.target).addClass("activeMouse");
});
$(document).on("mouseleave", "#commandLineWrapper #commandLine .suggestions .entry", (e) => {
    if (!commandLineMouseMode)
        return;
    $(e.target).removeClass("activeMouse");
});
$("#commandLineWrapper #commandLine .suggestions").on("mouseover", (e) => {
    if (!commandLineMouseMode)
        return;
    // console.log("clearing keyboard active");
    $("#commandLineWrapper #commandLine .suggestions .entry").removeClass("activeKeyboard");
    const hoverId = $(e.target).attr("command");
    try {
        const list = CommandlineLists.current[CommandlineLists.current.length - 1];
        $.each(list.list, (_index, obj) => {
            if (obj.id == hoverId) {
                if ((!/theme/gi.test(obj.id) || obj.id === "toggleCustomTheme") &&
                    !ThemeController.randomTheme) {
                    ThemeController.clearPreview();
                }
                if (!/font/gi.test(obj.id)) {
                    UpdateConfig.previewFontFamily(config_1.default.fontFamily);
                }
                if (obj.hover)
                    obj.hover();
            }
        });
    }
    catch (e) { }
});
$(document).on("click", "#commandLineWrapper #commandLine .suggestions .entry", (e) => {
    $(".suggestions .entry").removeClass("activeKeyboard");
    trigger($(e.currentTarget).attr("command"));
});
$("#commandLineWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "commandLineWrapper") {
        hide();
        UpdateConfig.setFontFamily(config_1.default.fontFamily, true);
        // if (Config.customTheme === true) {
        //   applyCustomThemeColors();
        // } else {
        //   setTheme(Config.theme, true);
        // }
    }
});
//might come back to it later
// function shiftCommand(){
//   let activeEntries = $("#commandLineWrapper #commandLine .suggestions .entry.activeKeyboard, #commandLineWrapper #commandLine .suggestions .entry.activeMouse");
//   activeEntries.each((_index, activeEntry) => {
//     let commandId = activeEntry.getAttribute('command');
//     let foundCommand = null;
//     CommandlineLists.defaultCommands.list.forEach(command => {
//       if(foundCommand === null && command.id === commandId){
//         foundCommand = command;
//       }
//     })
//     if(foundCommand.shift){
//       $(activeEntry).find('div').text(foundCommand.shift.display);
//     }
//   })
// }
// let shiftedCommands = false;
// $(document).on("keydown", (e) => {
//   if (e.key === "Shift") {
//     if(shiftedCommands === false){
//       shiftedCommands = true;
//       shiftCommand();
//     }
//   }
// });
// $(document).keyup((e) => {
//   if (e.key === "Shift") {
//     shiftedCommands = false;
//   }
// });
$(document).on("keydown", (e) => {
    var _a, _b;
    // if (isPreviewingTheme) {
    // console.log("applying theme");
    // applyCustomThemeColors();
    // previewTheme(Config.theme, false);
    // }
    if (!$("#commandLineWrapper").hasClass("hidden")) {
        $("#commandLine input").trigger("focus");
        if (e.key == ">" && config_1.default.singleListCommandLine == "manual") {
            if (!isSingleListCommandLineActive()) {
                useSingleListCommandLine(false);
                return;
            }
            else if ($("#commandLine input").val() == ">") {
                //so that it will ignore succeeding ">" when input is already ">"
                e.preventDefault();
                return;
            }
        }
        if (e.key === "Backspace" || e.key === "Delete") {
            setTimeout(() => {
                const inputVal = $("#commandLine input").val();
                if (config_1.default.singleListCommandLine == "manual" &&
                    isSingleListCommandLineActive() &&
                    inputVal[0] !== ">") {
                    restoreOldCommandLine(false);
                }
            }, 1);
        }
        if (e.key === "Enter") {
            //enter
            e.preventDefault();
            const command = $(".suggestions .entry.activeKeyboard").attr("command");
            trigger(command);
            return;
        }
        if (e.key === "ArrowUp" || e.key === "ArrowDown" || e.key === "Tab") {
            e.preventDefault();
            $("#commandLineWrapper #commandLine .suggestions .entry").unbind("mouseenter mouseleave");
            const entries = $(".suggestions .entry");
            let activenum = -1;
            let hoverId;
            $.each(entries, (index, obj) => {
                if ($(obj).hasClass("activeKeyboard"))
                    activenum = index;
            });
            if (e.key === "ArrowUp" || (e.key === "Tab" && e.shiftKey)) {
                entries.removeClass("activeKeyboard");
                if (activenum == 0) {
                    $(entries[entries.length - 1]).addClass("activeKeyboard");
                    hoverId = $(entries[entries.length - 1]).attr("command");
                }
                else {
                    $(entries[--activenum]).addClass("activeKeyboard");
                    hoverId = $(entries[activenum]).attr("command");
                }
            }
            if (e.key === "ArrowDown" || (e.key === "Tab" && !e.shiftKey)) {
                entries.removeClass("activeKeyboard");
                if (activenum + 1 == entries.length) {
                    $(entries[0]).addClass("activeKeyboard");
                    hoverId = $(entries[0]).attr("command");
                }
                else {
                    $(entries[++activenum]).addClass("activeKeyboard");
                    hoverId = $(entries[activenum]).attr("command");
                }
            }
            try {
                const scroll = Math.abs(((_a = $(".suggestions").offset()) === null || _a === void 0 ? void 0 : _a.top) -
                    ((_b = $(".entry.activeKeyboard").offset()) === null || _b === void 0 ? void 0 : _b.top) -
                    $(".suggestions").scrollTop()) -
                    $(".suggestions").outerHeight() / 2 +
                    $($(".entry")[0]).outerHeight();
                $(".suggestions").scrollTop(scroll);
            }
            catch (e) {
                if (e instanceof Error) {
                    console.log("could not scroll suggestions: " + e.message);
                }
            }
            // console.log(`scrolling to ${scroll}`);
            try {
                const list = CommandlineLists.current[CommandlineLists.current.length - 1];
                $.each(list.list, (_index, obj) => {
                    if (obj.id == hoverId) {
                        if ((!/theme/gi.test(obj.id) || obj.id === "toggleCustomTheme") &&
                            !ThemeController.randomTheme) {
                            ThemeController.clearPreview();
                        }
                        if (!/font/gi.test(obj.id)) {
                            UpdateConfig.previewFontFamily(config_1.default.fontFamily);
                        }
                        if (obj.hover)
                            obj.hover();
                    }
                });
            }
            catch (e) { }
            return false;
        }
    }
    return;
});
$(document).on("click", "#commandLineMobileButton", () => {
    if (config_1.default.singleListCommandLine == "on") {
        useSingleListCommandLine(false);
    }
    else {
        CommandlineLists.setCurrent([CommandlineLists.defaultCommands]);
    }
    (0, exports.show)();
});
$(document).on("click", "#keymap .r5 .key-space", () => {
    CommandlineLists.setCurrent([CommandlineLists.commandsKeymapLayouts]);
    (0, exports.show)();
});
$(document).on("click", "#testModesNotice .text-button", (event) => {
    const commands = CommandlineLists.getList($(event.currentTarget).attr("commands"));
    if (commands !== undefined) {
        if ($(event.currentTarget).attr("commands") === "commandsTags") {
            CommandlineLists.updateTagCommands();
        }
        CommandlineLists.pushCurrent(commands);
        (0, exports.show)();
    }
});
$(document).on("click", "#bottom .leftright .right .current-theme", (e) => {
    if (e.shiftKey) {
        if (!config_1.default.customTheme) {
            if (firebase_1.Auth.currentUser !== null) {
                if (DB.getSnapshot().customThemes.length < 1) {
                    Notifications.add("No custom themes!", 0);
                    UpdateConfig.setCustomTheme(false);
                    // UpdateConfig.setCustomThemeId("");
                    return;
                }
                // if (!DB.getCustomThemeById(Config.customThemeId)) {
                //   // Turn on the first custom theme
                //   const firstCustomThemeId = DB.getSnapshot().customThemes[0]._id;
                //   UpdateConfig.setCustomThemeId(firstCustomThemeId);
                // }
            }
            UpdateConfig.setCustomTheme(true);
        }
        else
            UpdateConfig.setCustomTheme(false);
    }
    else {
        if (config_1.default.customTheme)
            CommandlineLists.updateCustomThemeListCommands();
        CommandlineLists.pushCurrent(config_1.default.customTheme
            ? CommandlineLists.customThemeListCommands
            : CommandlineLists.themeCommands);
        (0, exports.show)();
    }
});
$(document.body).on("click", ".pageAbout .aboutEnableAds", () => {
    CommandlineLists.pushCurrent(CommandlineLists.commandsEnableAds);
    (0, exports.show)();
});
$(".supportButtons .button.ads").on("click", () => {
    CommandlineLists.pushCurrent(CommandlineLists.commandsEnableAds);
    (0, exports.show)();
});


/***/ }),

/***/ "./src/scripts/elements/custom-background-filter.ts":
/*!**********************************************************!*\
  !*** ./src/scripts/elements/custom-background-filter.ts ***!
  \**********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.loadConfig = exports.apply = exports.getCSS = void 0;
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./notifications */ "./src/scripts/elements/notifications.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const filters = {
    blur: {
        value: 0,
        default: 0,
    },
    brightness: {
        value: 1,
        default: 1,
    },
    saturate: {
        value: 1,
        default: 1,
    },
    opacity: {
        value: 1,
        default: 1,
    },
};
function getCSS() {
    let ret = "";
    Object.keys(filters).forEach((filterKey) => {
        const key = filterKey;
        if (filters[key].value != filters[key].default) {
            ret += `${filterKey}(${filters[key].value}${filterKey == "blur" ? "rem" : ""}) `;
        }
    });
    return ret;
}
exports.getCSS = getCSS;
function apply() {
    const filterCSS = getCSS();
    const css = {
        filter: filterCSS,
        width: `calc(100% + ${filters.blur.value * 4}rem)`,
        height: `calc(100% + ${filters.blur.value * 4}rem)`,
        left: `-${filters.blur.value * 2}rem`,
        top: `-${filters.blur.value * 2}rem`,
        position: "absolute",
    };
    $(".customBackground img").css(css);
}
exports.apply = apply;
function syncSliders() {
    $(".section.customBackgroundFilter .blur input").val(filters["blur"].value);
    $(".section.customBackgroundFilter .brightness input").val(filters["brightness"].value);
    $(".section.customBackgroundFilter .saturate input").val(filters["saturate"].value);
    $(".section.customBackgroundFilter .opacity input").val(filters["opacity"].value);
}
function updateNumbers() {
    $(".section.customBackgroundFilter .blur .value").html(filters.blur.value.toFixed(1));
    $(".section.customBackgroundFilter .brightness .value").html(filters.brightness.value.toFixed(1));
    $(".section.customBackgroundFilter .saturate .value").html(filters.saturate.value.toFixed(1));
    $(".section.customBackgroundFilter .opacity .value").html(filters.opacity.value.toFixed(1));
}
function loadConfig(config) {
    filters.blur.value = config[0];
    filters.brightness.value = config[1];
    filters.saturate.value = config[2];
    filters.opacity.value = config[3];
    updateNumbers();
    syncSliders();
}
exports.loadConfig = loadConfig;
$(".section.customBackgroundFilter .blur input").on("input", () => {
    filters["blur"].value = parseFloat($(".section.customBackgroundFilter .blur input").val());
    updateNumbers();
    apply();
});
$(".section.customBackgroundFilter .brightness input").on("input", () => {
    filters["brightness"].value = parseFloat($(".section.customBackgroundFilter .brightness input").val());
    updateNumbers();
    apply();
});
$(".section.customBackgroundFilter .saturate input").on("input", () => {
    filters["saturate"].value = parseFloat($(".section.customBackgroundFilter .saturate input").val());
    updateNumbers();
    apply();
});
$(".section.customBackgroundFilter .opacity input").on("input", () => {
    filters["opacity"].value = parseFloat($(".section.customBackgroundFilter .opacity input").val());
    updateNumbers();
    apply();
});
$(".section.customBackgroundFilter  .save.button").on("click", () => {
    const arr = Object.keys(filters).map((filterKey) => filters[filterKey].value);
    UpdateConfig.setCustomBackgroundFilter(arr, false);
    Notifications.add("Custom background filters saved", 1);
});
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "customBackgroundFilter") {
        loadConfig(eventValue.map((ev) => parseFloat(ev)));
        apply();
    }
});


/***/ }),

/***/ "./src/scripts/elements/keymap.ts":
/*!****************************************!*\
  !*** ./src/scripts/elements/keymap.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.refresh = exports.show = exports.hide = exports.flashKey = exports.highlightKey = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ./theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
function highlightKey(currentKey) {
    if (config_1.default.mode === "zen")
        return;
    if (currentKey === "")
        currentKey = " ";
    try {
        if ($(".active-key") != undefined) {
            $(".active-key").removeClass("active-key");
        }
        let highlightKey;
        if (currentKey == " ") {
            highlightKey = "#keymap .key-space, #keymap .key-split-space";
        }
        else if (currentKey == '"') {
            highlightKey = `#keymap .keymap-key[data-key*='${currentKey}']`;
        }
        else {
            highlightKey = `#keymap .keymap-key[data-key*="${currentKey}"]`;
        }
        console.log("highlighting", highlightKey);
        $(highlightKey).addClass("active-key");
    }
    catch (e) {
        if (e instanceof Error) {
            console.log("could not update highlighted keymap key: " + e.message);
        }
    }
}
exports.highlightKey = highlightKey;
function flashKey(key, correct) {
    return __awaiter(this, void 0, void 0, function* () {
        if (key == undefined)
            return;
        if (key == " ") {
            key = "#keymap .key-space, #keymap .key-split-space";
        }
        else if (key == '"') {
            key = `#keymap .keymap-key[data-key*='${key}']`;
        }
        else {
            key = `#keymap .keymap-key[data-key*="${key}"]`;
        }
        const themecolors = yield ThemeColors.getAll();
        try {
            if (correct || config_1.default.blindMode) {
                $(key)
                    .stop(true, true)
                    .css({
                    color: themecolors.bg,
                    backgroundColor: themecolors.main,
                    borderColor: themecolors.main,
                })
                    .animate({
                    color: themecolors.sub,
                    backgroundColor: "transparent",
                    borderColor: themecolors.sub,
                }, SlowTimer.get() ? 0 : 500, "easeOutExpo");
            }
            else {
                $(key)
                    .stop(true, true)
                    .css({
                    color: themecolors.bg,
                    backgroundColor: themecolors.error,
                    borderColor: themecolors.error,
                })
                    .animate({
                    color: themecolors.sub,
                    backgroundColor: "transparent",
                    borderColor: themecolors.sub,
                }, SlowTimer.get() ? 0 : 500, "easeOutExpo");
            }
        }
        catch (e) { }
    });
}
exports.flashKey = flashKey;
function hide() {
    $("#keymap").addClass("hidden");
}
exports.hide = hide;
function show() {
    $("#keymap").removeClass("hidden");
}
exports.show = show;
function refresh(layoutName = config_1.default.layout) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!layoutName)
            return;
        try {
            const layouts = yield Misc.getLayoutsList();
            let lts = layouts[layoutName]; //layout to show
            let layoutString = layoutName;
            if (config_1.default.keymapLayout === "overrideSync") {
                if (config_1.default.layout === "default") {
                    lts = layouts["qwerty"];
                    layoutString = "default";
                }
                else {
                    lts = layouts[config_1.default.layout];
                    layoutString = config_1.default.layout;
                }
            }
            else {
                lts = layouts[config_1.default.keymapLayout];
                layoutString = config_1.default.keymapLayout;
            }
            const showTopRow = lts.keymapShowTopRow;
            const isMatrix = config_1.default.keymapStyle === "matrix" || config_1.default.keymapStyle === "split_matrix";
            let keymapElement = "";
            Object.keys(lts.keys).forEach((row, index) => {
                const rowKeys = lts.keys[row];
                let rowElement = "";
                if (row === "row1" && !showTopRow) {
                    return;
                }
                if ((row === "row2" || row === "row3" || row === "row4") && !isMatrix) {
                    rowElement += "<div></div>";
                }
                if (row === "row4" && lts.type !== "iso" && !isMatrix) {
                    rowElement += "<div></div>";
                }
                if (row === "row5") {
                    let layoutDisplay = layoutString.replace(/_/g, " ");
                    if (config_1.default.keymapLegendStyle === "blank") {
                        layoutDisplay = "";
                    }
                    rowElement += "<div></div>";
                    rowElement += `<div class="keymap-key key-space">
          <div class="letter">${layoutDisplay}</div>
        </div>`;
                    rowElement += `<div class="keymap-split-spacer"></div>`;
                    rowElement += `<div class="keymap-key key-split-space">
          <div class="letter"></div>
        </div>`;
                }
                else {
                    for (let i = 0; i < rowKeys.length; i++) {
                        if (row === "row2" && i === 12)
                            continue;
                        if ((config_1.default.keymapStyle === "matrix" ||
                            config_1.default.keymapStyle === "split_matrix") &&
                            i >= 10) {
                            continue;
                        }
                        const key = rowKeys[i];
                        const bump = row === "row3" && (i === 3 || i === 6) ? true : false;
                        let keyDisplay = key[0];
                        if (config_1.default.keymapLegendStyle === "blank") {
                            keyDisplay = "";
                        }
                        else if (config_1.default.keymapLegendStyle === "uppercase") {
                            keyDisplay = keyDisplay.toUpperCase();
                        }
                        const keyElement = `<div class="keymap-key" data-key="${key.replace('"', "&quot;")}">
              <span class="letter">${keyDisplay}</span>
              ${bump ? "<div class='bump'></div>" : ""}
          </div>`;
                        let splitSpacer = "";
                        if (config_1.default.keymapStyle === "split" ||
                            config_1.default.keymapStyle === "split_matrix" ||
                            config_1.default.keymapStyle === "alice") {
                            if (row === "row4" &&
                                (config_1.default.keymapStyle === "split" ||
                                    config_1.default.keymapStyle === "alice") &&
                                lts.type === "iso") {
                                if (i === 6) {
                                    splitSpacer += `<div class="keymap-split-spacer"></div>`;
                                }
                            }
                            else {
                                if (i === 5) {
                                    splitSpacer += `<div class="keymap-split-spacer"></div>`;
                                }
                            }
                        }
                        if (config_1.default.keymapStyle === "alice" && row === "row4") {
                            if ((lts.type === "iso" && i === 6) ||
                                (lts.type !== "iso" && i === 5)) {
                                splitSpacer += `<div class="extra-key"><span class="letter"></span></div>`;
                            }
                        }
                        rowElement += splitSpacer + keyElement;
                    }
                }
                keymapElement += `<div class="row r${index + 1}">${rowElement}</div>`;
            });
            $("#keymap").html(keymapElement);
            $("#keymap").removeClass("staggered");
            $("#keymap").removeClass("matrix");
            $("#keymap").removeClass("split");
            $("#keymap").removeClass("split_matrix");
            $("#keymap").removeClass("alice");
            $("#keymap").addClass(config_1.default.keymapStyle);
        }
        catch (e) {
            if (e instanceof Error) {
                console.log("something went wrong when changing layout, resettings: " + e.message);
                // UpdateConfig.setKeymapLayout("qwerty", true);
            }
        }
    });
}
exports.refresh = refresh;
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "layout" && config_1.default.keymapLayout === "overrideSync") {
        refresh(config_1.default.keymapLayout);
    }
    if (eventKey === "keymapLayout" || eventKey === "keymapStyle")
        refresh();
});


/***/ }),

/***/ "./src/scripts/elements/last-10-average.ts":
/*!*************************************************!*\
  !*** ./src/scripts/elements/last-10-average.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getAcc = exports.getWPM = exports.update = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestWords = __importStar(__webpack_require__(/*! ../test/test-words */ "./src/scripts/test/test-words.ts"));
let averageWPM = 0;
let averageAcc = 0;
function update() {
    return __awaiter(this, void 0, void 0, function* () {
        const mode2 = Misc.getMode2(config_1.default, TestWords.randomQuote);
        const [wpm, acc] = (yield DB.getUserAverage10(config_1.default.mode, mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode))
            .map(Misc.roundTo2)
            .map((num) => (config_1.default.alwaysShowDecimalPlaces ? Math.round(num) : num));
        averageWPM = wpm;
        averageAcc = acc;
    });
}
exports.update = update;
function getWPM() {
    return averageWPM;
}
exports.getWPM = getWPM;
function getAcc() {
    return averageAcc;
}
exports.getAcc = getAcc;


/***/ }),

/***/ "./src/scripts/elements/leaderboards.ts":
/*!**********************************************!*\
  !*** ./src/scripts/elements/leaderboards.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.hide = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./notifications */ "./src/scripts/elements/notifications.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const currentLeaderboard = "time_15";
let currentData = {
    15: [],
    60: [],
};
let currentRank = {
    15: {},
    60: {},
};
const requesting = {
    15: false,
    60: false,
};
const leaderboardSingleLimit = 50;
let updateTimer;
function clearTable(lb) {
    if (lb === 15) {
        $("#leaderboardsWrapper table.left tbody").empty();
        $("#leaderboardsWrapper table.left tfoot").empty();
    }
    else if (lb === 60) {
        $("#leaderboardsWrapper table.right tbody").empty();
        $("#leaderboardsWrapper table.right tfoot").empty();
    }
}
function reset() {
    currentData = {
        15: [],
        60: [],
    };
    currentRank = {
        15: {},
        60: {},
    };
}
function stopTimer() {
    clearInterval(updateTimer);
    updateTimer = undefined;
    $("#leaderboards .subTitle").text("Next update in: --:--");
}
function updateTimerElement() {
    const date = new Date();
    const minutesToNextUpdate = 14 - (date.getMinutes() % 15);
    const secondsToNextUpdate = 60 - date.getSeconds();
    const totalSeconds = minutesToNextUpdate * 60 + secondsToNextUpdate;
    $("#leaderboards .subTitle").text("Next update in: " + Misc.secondsToString(totalSeconds, true));
}
function startTimer() {
    updateTimerElement();
    updateTimer = setInterval(() => {
        updateTimerElement();
    }, 1000);
}
function showLoader(lb) {
    if (lb === 15) {
        $(`#leaderboardsWrapper .leftTableLoader`).removeClass("hidden");
    }
    else if (lb === 60) {
        $(`#leaderboardsWrapper .rightTableLoader`).removeClass("hidden");
    }
}
function hideLoader(lb) {
    if (lb === 15) {
        $(`#leaderboardsWrapper .leftTableLoader`).addClass("hidden");
    }
    else if (lb === 60) {
        $(`#leaderboardsWrapper .rightTableLoader`).addClass("hidden");
    }
}
function updateFooter(lb) {
    let side;
    if (lb === 15) {
        side = "left";
    }
    else {
        side = "right";
    }
    $(`#leaderboardsWrapper table.${side} tfoot`).html(`
    <tr>
      <td><br><br></td>
      <td colspan="4" style="text-align:center;">Not qualified</>
      <td><br><br></td>
    </tr>
    `);
    let toppercent;
    if (currentRank[lb]) {
        let num = Misc.roundTo2((currentRank[lb]["rank"] / currentRank[lb].count) * 100);
        if (num == 0) {
            num = 0.01;
        }
        toppercent = `Top ${num}%`;
    }
    if (currentRank[lb]) {
        const entry = currentRank[lb];
        const date = new Date(entry.timestamp);
        $(`#leaderboardsWrapper table.${side} tfoot`).html(`
    <tr>
    <td>${entry.rank}</td>
    <td><span class="top">You</span><br><span class="sub">${toppercent}</span></td>
    <td class="alignRight">${(config_1.default.alwaysShowCPM
            ? entry.wpm * 5
            : entry.wpm).toFixed(2)}<br><div class="sub">${entry.acc.toFixed(2)}%</div></td>
    <td class="alignRight">${(config_1.default.alwaysShowCPM
            ? entry.raw * 5
            : entry.raw).toFixed(2)}<br><div class="sub">${!entry.consistency || entry.consistency === "-"
            ? "-"
            : entry.consistency.toFixed(2) + "%"}</div></td>
    <td class="alignRight">time<br><div class="sub">${lb}</div></td>
    <td class="alignRight">${(0, format_1.default)(date, "dd MMM yyyy")}<br>
    <div class='sub'>${(0, format_1.default)(date, "HH:mm")}</div></td>
  </tr>
  `);
    }
}
function checkLbMemory(lb) {
    var _a, _b, _c, _d, _e;
    let side;
    if (lb === 15) {
        side = "left";
    }
    else {
        side = "right";
    }
    const memory = (_e = (_d = (_c = (_b = (_a = DB.getSnapshot()) === null || _a === void 0 ? void 0 : _a.lbMemory) === null || _b === void 0 ? void 0 : _b.time) === null || _c === void 0 ? void 0 : _c[lb]) === null || _d === void 0 ? void 0 : _d["english"]) !== null && _e !== void 0 ? _e : 0;
    if (currentRank[lb]) {
        const difference = memory - currentRank[lb].rank;
        if (difference > 0) {
            DB.updateLbMemory("time", lb, "english", currentRank[lb].rank, true);
            if (memory !== 0) {
                $(`#leaderboardsWrapper table.${side} tfoot tr td .top`).append(` (<i class="fas fa-fw fa-angle-up"></i>${Math.abs(difference)} since you last checked)`);
            }
        }
        else if (difference < 0) {
            DB.updateLbMemory("time", lb, "english", currentRank[lb].rank, true);
            if (memory !== 0) {
                $(`#leaderboardsWrapper table.${side} tfoot tr td .top`).append(` (<i class="fas fa-fw fa-angle-down"></i>${Math.abs(difference)} since you last checked)`);
            }
        }
        else {
            if (memory !== 0) {
                $(`#leaderboardsWrapper table.${side} tfoot tr td .top`).append(` ( = since you last checked)`);
            }
        }
    }
}
function fillTable(lb, prepend) {
    var _a;
    if (!currentData[lb]) {
        return;
    }
    let side;
    if (lb === 15) {
        side = "left";
    }
    else {
        side = "right";
    }
    const loggedInUserName = (_a = DB.getSnapshot()) === null || _a === void 0 ? void 0 : _a.name;
    let a = currentData[lb].length - leaderboardSingleLimit;
    let b = currentData[lb].length;
    if (a < 0)
        a = 0;
    if (prepend) {
        a = 0;
        b = prepend;
    }
    let html = "";
    for (let i = a; i < b; i++) {
        const entry = currentData[lb][i];
        if (!entry) {
            break;
        }
        if (entry.hidden)
            return;
        let meClassString = "";
        if (entry.name == loggedInUserName) {
            meClassString = ' class="me"';
        }
        const date = new Date(entry.timestamp);
        html += `
    <tr ${meClassString}>
    <td>${entry.rank === 1 ? '<i class="fas fa-fw fa-crown"></i>' : entry.rank}</td>
    <td>${entry.name}</td>
    <td class="alignRight">${(config_1.default.alwaysShowCPM
            ? entry.wpm * 5
            : entry.wpm).toFixed(2)}<br><div class="sub">${entry.acc.toFixed(2)}%</div></td>
    <td class="alignRight">${(config_1.default.alwaysShowCPM
            ? entry.raw * 5
            : entry.raw).toFixed(2)}<br><div class="sub">${!entry.consistency || entry.consistency === "-"
            ? "-"
            : entry.consistency.toFixed(2) + "%"}</div></td>
    <td class="alignRight">time<br><div class="sub">${lb}</div></td>
    <td class="alignRight">${(0, format_1.default)(date, "dd MMM yyyy")}<br>
    <div class='sub'>${(0, format_1.default)(date, "HH:mm")}</div></td>
  </tr>
  `;
    }
    if (!prepend) {
        $(`#leaderboardsWrapper table.${side} tbody`).append(html);
    }
    else {
        $(`#leaderboardsWrapper table.${side} tbody`).prepend(html);
    }
}
function hide() {
    $("#leaderboardsWrapper")
        .stop(true, true)
        .css("opacity", 1)
        .animate({
        opacity: 0,
    }, 100, () => {
        clearTable(15);
        clearTable(60);
        reset();
        stopTimer();
        $("#leaderboardsWrapper").addClass("hidden");
    });
}
exports.hide = hide;
function update() {
    return __awaiter(this, void 0, void 0, function* () {
        $("#leaderboardsWrapper .buttons .button").removeClass("active");
        $(`#leaderboardsWrapper .buttons .button[board=${currentLeaderboard}]`).addClass("active");
        showLoader(15);
        showLoader(60);
        const leaderboardRequests = [
            ape_1.default.leaderboards.get("english", "time", "15", 0),
            ape_1.default.leaderboards.get("english", "time", "60", 0),
        ];
        if (firebase_1.Auth.currentUser) {
            leaderboardRequests.push(ape_1.default.leaderboards.getRank("english", "time", "15"), ape_1.default.leaderboards.getRank("english", "time", "60"));
        }
        const responses = yield Promise.all(leaderboardRequests);
        const failedResponse = responses.find((response) => response.status !== 200);
        if (failedResponse) {
            return Notifications.add("Failed to load leaderboards: " + failedResponse.message, -1);
        }
        const [lb15Data, lb60Data, lb15Rank, lb60Rank] = responses.map((response) => response.data);
        currentData[15] = lb15Data;
        currentData[60] = lb60Data;
        currentRank[15] = lb15Rank;
        currentRank[60] = lb60Rank;
        const leaderboardKeys = [15, 60];
        leaderboardKeys.forEach((leaderboardTime) => {
            hideLoader(leaderboardTime);
            clearTable(leaderboardTime);
            updateFooter(leaderboardTime);
            checkLbMemory(leaderboardTime);
            fillTable(leaderboardTime);
        });
        $("#leaderboardsWrapper .leftTableWrapper").removeClass("invisible");
        $("#leaderboardsWrapper .rightTableWrapper").removeClass("invisible");
    });
}
function requestMore(lb, prepend = false) {
    return __awaiter(this, void 0, void 0, function* () {
        if (prepend && currentData[lb][0].rank === 1)
            return;
        if (requesting[lb])
            return;
        requesting[lb] = true;
        showLoader(lb);
        let skipVal = currentData[lb][currentData[lb].length - 1].rank;
        if (prepend) {
            skipVal = currentData[lb][0].rank - leaderboardSingleLimit;
        }
        let limitVal;
        if (skipVal < 0) {
            limitVal = Math.abs(skipVal) - 1;
            skipVal = 0;
        }
        const response = yield ape_1.default.leaderboards.get("english", "time", lb, skipVal, limitVal);
        const data = response.data;
        if (response.status !== 200 || data.length === 0) {
            hideLoader(lb);
            return;
        }
        if (prepend) {
            currentData[lb].unshift(...data);
        }
        else {
            currentData[lb].push(...data);
        }
        if (prepend && !limitVal) {
            limitVal = leaderboardSingleLimit - 1;
        }
        fillTable(lb, limitVal);
        hideLoader(lb);
        requesting[lb] = false;
    });
}
function requestNew(lb, skip) {
    return __awaiter(this, void 0, void 0, function* () {
        showLoader(lb);
        const response = yield ape_1.default.leaderboards.get("english", "time", lb, skip);
        const data = response.data;
        clearTable(lb);
        currentData[lb] = [];
        if (response.status !== 200 || data.length === 0) {
            hideLoader(lb);
            return;
        }
        currentData[lb] = data;
        fillTable(lb);
        hideLoader(lb);
    });
}
function show() {
    if ($("#leaderboardsWrapper").hasClass("hidden")) {
        if (firebase_1.Auth.currentUser) {
            $("#leaderboardsWrapper #leaderboards .rightTableJumpToMe").removeClass("disabled");
            $("#leaderboardsWrapper #leaderboards .leftTableJumpToMe").removeClass("disabled");
        }
        else {
            $("#leaderboardsWrapper #leaderboards .rightTableJumpToMe").addClass("disabled");
            $("#leaderboardsWrapper #leaderboards .leftTableJumpToMe").addClass("disabled");
        }
        if (config_1.default.alwaysShowCPM) {
            $("#leaderboards table thead tr td:nth-child(3)").html('cpm<br><div class="sub">accuracy</div>');
        }
        else {
            $("#leaderboards table thead tr td:nth-child(3)").html('wpm<br><div class="sub">accuracy</div>');
        }
        $("#leaderboardsWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({
            opacity: 1,
        }, 125, () => {
            update();
            startTimer();
        });
    }
}
exports.show = show;
$("#leaderboardsWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "leaderboardsWrapper") {
        hide();
    }
});
// $("#leaderboardsWrapper .buttons .button").on("click",(e) => {
//   currentLeaderboard = $(e.target).attr("board");
//   update();
// });
let leftScrollEnabled = true;
$("#leaderboardsWrapper #leaderboards .leftTableWrapper").scroll((e) => {
    if (!leftScrollEnabled)
        return;
    const elem = $(e.currentTarget);
    if (Math.round(elem.scrollTop()) <= 50) {
        requestMore(15, true);
    }
});
$("#leaderboardsWrapper #leaderboards .leftTableWrapper").scroll((e) => {
    if (!leftScrollEnabled)
        return;
    const elem = $(e.currentTarget);
    if (Math.round(elem[0].scrollHeight - elem.scrollTop()) <=
        Math.round(elem.outerHeight()) + 50) {
        requestMore(15);
    }
});
let rightScrollEnabled = true;
$("#leaderboardsWrapper #leaderboards .rightTableWrapper").scroll((e) => {
    if (!rightScrollEnabled)
        return;
    const elem = $(e.currentTarget);
    if (Math.round(elem.scrollTop()) <= 50) {
        requestMore(60, true);
    }
});
$("#leaderboardsWrapper #leaderboards .rightTableWrapper").scroll((e) => {
    const elem = $(e.currentTarget);
    if (Math.round(elem[0].scrollHeight - elem.scrollTop()) <=
        Math.round(elem.outerHeight() + 50)) {
        requestMore(60);
    }
});
$("#leaderboardsWrapper #leaderboards .leftTableJumpToTop").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    leftScrollEnabled = false;
    $("#leaderboardsWrapper #leaderboards .leftTableWrapper").scrollTop(0);
    yield requestNew(15, 0);
    leftScrollEnabled = true;
}));
$("#leaderboardsWrapper #leaderboards .leftTableJumpToMe").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    if (currentRank[15].rank === undefined)
        return;
    leftScrollEnabled = false;
    yield requestNew(15, currentRank[15].rank - leaderboardSingleLimit / 2);
    const rowHeight = $("#leaderboardsWrapper #leaderboards .leftTableWrapper table tbody td").outerHeight();
    $("#leaderboardsWrapper #leaderboards .leftTableWrapper").animate({
        scrollTop: rowHeight *
            Math.min(currentRank[15].rank, leaderboardSingleLimit / 2) -
            $("#leaderboardsWrapper #leaderboards .leftTableWrapper").outerHeight() /
                2.25,
    }, 0, () => {
        leftScrollEnabled = true;
    });
}));
$("#leaderboardsWrapper #leaderboards .rightTableJumpToTop").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    rightScrollEnabled = false;
    $("#leaderboardsWrapper #leaderboards .rightTableWrapper").scrollTop(0);
    yield requestNew(60, 0);
    rightScrollEnabled = true;
}));
$("#leaderboardsWrapper #leaderboards .rightTableJumpToMe").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    if (currentRank[60].rank === undefined)
        return;
    leftScrollEnabled = false;
    yield requestNew(60, currentRank[60].rank - leaderboardSingleLimit / 2);
    const rowHeight = $("#leaderboardsWrapper #leaderboards .rightTableWrapper table tbody td").outerHeight();
    $("#leaderboardsWrapper #leaderboards .rightTableWrapper").animate({
        scrollTop: rowHeight *
            Math.min(currentRank[60].rank, leaderboardSingleLimit / 2) -
            $("#leaderboardsWrapper #leaderboards .rightTableWrapper").outerHeight() /
                2.25,
    }, 0, () => {
        leftScrollEnabled = true;
    });
}));
$(document).on("click", "#top #menu .icon-button", (e) => {
    if ($(e.currentTarget).hasClass("leaderboards")) {
        show();
    }
    return false;
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" && !$("#leaderboardsWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/elements/loader.ts":
/*!****************************************!*\
  !*** ./src/scripts/elements/loader.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
function show() {
    $("#backgroundLoader").stop(true, true).fadeIn(125);
}
exports.show = show;
function hide() {
    $("#backgroundLoader").stop(true, true).fadeOut(125);
}
exports.hide = hide;


/***/ }),

/***/ "./src/scripts/elements/modes-notice.ts":
/*!**********************************************!*\
  !*** ./src/scripts/elements/modes-notice.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = void 0;
const PaceCaret = __importStar(__webpack_require__(/*! ../test/pace-caret */ "./src/scripts/test/pace-caret.ts"));
const TestState = __importStar(__webpack_require__(/*! ../test/test-state */ "./src/scripts/test/test-state.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Last10Average = __importStar(__webpack_require__(/*! ../elements/last-10-average */ "./src/scripts/elements/last-10-average.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestWords = __importStar(__webpack_require__(/*! ../test/test-words */ "./src/scripts/test/test-words.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
ConfigEvent.subscribe((eventKey) => {
    if ([
        "difficulty",
        "blindMode",
        "stopOnError",
        "paceCaret",
        "minWpm",
        "minAcc",
        "minBurst",
        "confidenceMode",
        "layout",
        "showAverage",
        "alwaysShowCPM",
    ].includes(eventKey)) {
        update();
    }
});
function update() {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        let anim = false;
        if ($(".pageTest #testModesNotice").text() === "")
            anim = true;
        $(".pageTest #testModesNotice").empty();
        if (TestState.isRepeated && config_1.default.mode !== "quote") {
            $(".pageTest #testModesNotice").append(`<div class="text-button restart" style="color:var(--error-color);"><i class="fas fa-sync-alt"></i>repeated</div>`);
        }
        if (TestWords.hasTab) {
            $(".pageTest #testModesNotice").append(`<div class="text-button"><i class="fas fa-long-arrow-alt-right"></i>shift + tab to restart</div>`);
        }
        if (TestState.activeChallenge) {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsChallenges"><i class="fas fa-award"></i>${TestState.activeChallenge.display}</div>`);
        }
        if (config_1.default.mode === "zen") {
            $(".pageTest #testModesNotice").append(`<div class="text-button"><i class="fas fa-poll"></i>shift + enter to finish zen </div>`);
        }
        $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsLanguages"><i class="fas fa-globe-americas"></i>${config_1.default.language.replace(/_/g, " ")}</div>`);
        if (config_1.default.difficulty === "expert") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsDifficulty"><i class="fas fa-star-half-alt"></i>expert</div>`);
        }
        else if (config_1.default.difficulty === "master") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsDifficulty"><i class="fas fa-star"></i>master</div>`);
        }
        if (config_1.default.blindMode) {
            $(".pageTest #testModesNotice").append(`<div class="text-button blind"><i class="fas fa-eye-slash"></i>blind</div>`);
        }
        if (config_1.default.lazyMode) {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsLazyMode"><i class="fas fa-couch"></i>lazy</div>`);
        }
        if (config_1.default.paceCaret !== "off" ||
            (config_1.default.repeatedPace && TestState.isPaceRepeat)) {
            let speed = "";
            try {
                speed = ` (${Math.round(PaceCaret.settings.wpm)} wpm)`;
            }
            catch (_b) { }
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsPaceCaret"><i class="fas fa-tachometer-alt"></i>${config_1.default.paceCaret === "average"
                ? "average"
                : config_1.default.paceCaret === "pb"
                    ? "pb"
                    : "custom"} pace${speed}</div>`);
        }
        if (config_1.default.showAverage !== "off") {
            let avgWPM = Last10Average.getWPM();
            let avgAcc = Last10Average.getAcc();
            if (!config_1.default.alwaysShowDecimalPlaces) {
                avgWPM = Math.round(avgWPM);
                avgAcc = Math.round(avgAcc);
            }
            if (firebase_1.Auth.currentUser && avgWPM > 0) {
                const avgWPMText = ["wpm", "both"].includes(config_1.default.showAverage)
                    ? config_1.default.alwaysShowCPM
                        ? `${Math.round(avgWPM * 5)} cpm`
                        : `${avgWPM} wpm`
                    : "";
                const avgAccText = ["acc", "both"].includes(config_1.default.showAverage)
                    ? `${avgAcc}% acc`
                    : "";
                const text = `${avgWPMText} ${avgAccText}`.trim();
                $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsShowAverage"><i class="fas fa-chart-bar"></i>avg: ${text}</div>`);
            }
        }
        if (config_1.default.minWpm !== "off") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsMinWpm"><i class="fas fa-bomb"></i>min ${config_1.default.minWpmCustomSpeed} wpm</div>`);
        }
        if (config_1.default.minAcc !== "off") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsMinAcc"><i class="fas fa-bomb"></i>min ${config_1.default.minAccCustom}% acc</div>`);
        }
        if (config_1.default.minBurst !== "off") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsMinBurst"><i class="fas fa-bomb"></i>min ${config_1.default.minBurstCustomSpeed} burst ${config_1.default.minBurst === "flex" ? "(flex)" : ""}</div>`);
        }
        if (config_1.default.funbox !== "none") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsFunbox"><i class="fas fa-gamepad"></i>${config_1.default.funbox.replace(/_/g, " ")}</div>`);
        }
        if (config_1.default.confidenceMode === "on") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsConfidenceMode"><i class="fas fa-backspace"></i>confidence</div>`);
        }
        if (config_1.default.confidenceMode === "max") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsConfidenceMode"><i class="fas fa-backspace"></i>max confidence</div>`);
        }
        if (config_1.default.stopOnError != "off") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsStopOnError"><i class="fas fa-hand-paper"></i>stop on ${config_1.default.stopOnError}</div>`);
        }
        if (config_1.default.layout !== "default") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsLayouts"><i class="fas fa-keyboard"></i>emulating ${config_1.default.layout.replace(/_/g, " ")}</div>`);
        }
        if (config_1.default.oppositeShiftMode !== "off") {
            $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsOppositeShiftMode"><i class="fas fa-exchange-alt"></i>opposite shift${config_1.default.oppositeShiftMode === "keymap" ? " (keymap)" : ""}</div>`);
        }
        let tagsString = "";
        try {
            (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
                if (tag.active === true) {
                    tagsString += tag.name + ", ";
                }
            });
            if (tagsString !== "") {
                $(".pageTest #testModesNotice").append(`<div class="text-button" commands="commandsTags"><i class="fas fa-tag"></i>${tagsString.substring(0, tagsString.length - 2)}</div>`);
            }
        }
        catch (_c) { }
        if (anim) {
            $(".pageTest #testModesNotice")
                .css("transition", "none")
                .css("opacity", 0)
                .animate({
                opacity: 1,
            }, 125, () => {
                $(".pageTest #testModesNotice").css("transition", ".125s");
            });
        }
    });
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/elements/monkey-power.ts":
/*!**********************************************!*\
  !*** ./src/scripts/elements/monkey-power.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.addPower = exports.reset = exports.init = void 0;
const ThemeColors = __importStar(__webpack_require__(/*! ./theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
/**
 * @typedef {{ x: number, y: number }} vec2
 * @typedef {vec2 & { prev: vec2, vel: vec2, alpha: number, color: string }} Particle
 * @typedef {{ particles: Particle[], caret: any, canvas: HTMLCanvasElement, context2d: CanvasRenderingContext2D, rendering: boolean, lastFrame: number, deltaTime: number, resetTimeOut: number }} CTX
 */
/**
 * @type {CTX} ctx
 */
const ctx = {
    particles: [],
    rendering: false,
};
const gravity = 1000;
const drag = 0.05;
const particleSize = 4;
const particleFade = 0.6;
const particleInitVel = 1500;
const particleBounceMod = 0.3;
const particleCreateCount = [6, 3];
const shakeAmount = 10;
function createCanvas() {
    const canvas = document.createElement("canvas");
    canvas.style.cssText =
        "position:fixed;top:0;left:0;pointer-events:none;z-index:999999";
    canvas.height = window.innerHeight;
    canvas.width = window.innerWidth;
    window.addEventListener("resize", () => {
        canvas.height = window.innerHeight;
        canvas.width = window.innerWidth;
    });
    document.body.appendChild(canvas);
    return canvas;
}
/**
 * @param {number} x
 * @param {number} y
 * @param {string} color
 * @returns {Particle}
 */
function createParticle(x, y, color) {
    return {
        x,
        y,
        color,
        alpha: 1,
        prev: { x, y },
        vel: {
            x: particleInitVel - Math.random() * particleInitVel * 2,
            y: particleInitVel - Math.random() * particleInitVel * 2,
        },
    };
}
/**
 * @param {Particle} particle
 */
function updateParticle(particle) {
    if (!ctx.canvas || !ctx.deltaTime)
        return;
    particle.prev.x = particle.x;
    particle.prev.y = particle.y;
    // Update pos
    particle.x += particle.vel.x * ctx.deltaTime;
    particle.y += particle.vel.y * ctx.deltaTime;
    if (particle.x > ctx.canvas.width) {
        particle.vel.x *= -particleBounceMod;
        particle.x =
            ctx.canvas.width - (particle.x - ctx.canvas.width) * particleBounceMod;
    }
    else if (particle.x < 0) {
        particle.vel.x *= -particleBounceMod;
        particle.x *= -particleBounceMod;
    }
    if (particle.y > ctx.canvas.height) {
        particle.vel.y *= -particleBounceMod;
        particle.y =
            ctx.canvas.height - (particle.y - ctx.canvas.height) * particleBounceMod;
    }
    else if (particle.y < 0) {
        particle.vel.y *= -1;
        particle.y *= -1;
    }
    particle.vel.y += gravity * ctx.deltaTime;
    particle.vel.x *= 1 - drag * ctx.deltaTime;
    particle.alpha *= 1 - particleFade * ctx.deltaTime;
}
function init() {
    ctx.caret = $("#caret");
    ctx.canvas = createCanvas();
    ctx.context2d = ctx.canvas.getContext("2d");
}
exports.init = init;
function render() {
    if (!ctx.lastFrame || !ctx.context2d || !ctx.canvas)
        return;
    ctx.rendering = true;
    const time = Date.now();
    ctx.deltaTime = (time - ctx.lastFrame) / 1000;
    ctx.lastFrame = time;
    ctx.context2d.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
    const keep = [];
    for (let i = 0; i < ctx.particles.length; i++) {
        const particle = ctx.particles[i];
        if (particle.alpha < 0.1)
            continue;
        updateParticle(particle);
        ctx.context2d.globalAlpha = particle.alpha;
        ctx.context2d.strokeStyle = particle.color;
        ctx.context2d.lineWidth = particleSize;
        ctx.context2d.beginPath();
        ctx.context2d.moveTo(Math.round(particle.prev.x), Math.round(particle.prev.y));
        ctx.context2d.lineTo(Math.round(particle.x), Math.round(particle.y));
        ctx.context2d.stroke();
        keep.push(particle);
    }
    ctx.particles = keep;
    if (ctx.particles.length && !SlowTimer.get()) {
        requestAnimationFrame(render);
    }
    else {
        ctx.context2d.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
        ctx.rendering = false;
    }
}
function reset(immediate = false) {
    if (!ctx.resetTimeOut)
        return;
    delete ctx.resetTimeOut;
    clearTimeout(ctx.resetTimeOut);
    const body = $(document.body);
    body.css("transition", "all .25s, transform 0.8s");
    body.css("transform", `translate(0,0)`);
    setTimeout(() => {
        body.css("transition", "all .25s, transform .05s");
        $("html").css("overflow", "inherit");
        $("html").css("overflow-y", "scroll");
    }, immediate ? 0 : 1000);
}
exports.reset = reset;
function startRender() {
    if (!ctx.rendering) {
        ctx.lastFrame = Date.now();
        render();
    }
}
function randomColor() {
    const r = Math.floor(Math.random() * 256).toString(16);
    const g = Math.floor(Math.random() * 256).toString(16);
    const b = Math.floor(Math.random() * 256).toString(16);
    return `#${r}${g}${b}`;
}
/**
 * @param {boolean} good Good power or not?
 */
function addPower(good = true, extra = false) {
    var _a, _b, _c, _d, _e;
    return __awaiter(this, void 0, void 0, function* () {
        if (config_1.default.monkeyPowerLevel === "off" || SlowTimer.get())
            return;
        // Shake
        if (["3", "4"].includes(config_1.default.monkeyPowerLevel)) {
            $("html").css("overflow", "hidden");
            const shake = [
                Math.round(shakeAmount - Math.random() * shakeAmount),
                Math.round(shakeAmount - Math.random() * shakeAmount),
            ];
            $(document.body).css("transform", `translate(${shake[0]}px, ${shake[1]}px)`);
            if (ctx.resetTimeOut)
                clearTimeout(ctx.resetTimeOut);
            ctx.resetTimeOut = setTimeout(reset, 2000);
        }
        // Sparks
        const offset = (_a = ctx.caret) === null || _a === void 0 ? void 0 : _a.offset();
        const coords = [
            (_b = offset === null || offset === void 0 ? void 0 : offset.left) !== null && _b !== void 0 ? _b : 0,
            ((_c = offset === null || offset === void 0 ? void 0 : offset.top) !== null && _c !== void 0 ? _c : 0) + ((_e = (_d = ctx.caret) === null || _d === void 0 ? void 0 : _d.height()) !== null && _e !== void 0 ? _e : 0),
        ];
        for (let i = Math.round((particleCreateCount[0] + Math.random() * particleCreateCount[1]) *
            (extra ? 2 : 1)); i > 0; i--) {
            const color = ["2", "4"].includes(config_1.default.monkeyPowerLevel)
                ? randomColor()
                : good
                    ? yield ThemeColors.get("caret")
                    : yield ThemeColors.get("error");
            ctx.particles.push(createParticle(...coords, color));
        }
        startRender();
    });
}
exports.addPower = addPower;


/***/ }),

/***/ "./src/scripts/elements/notifications.ts":
/*!***********************************************!*\
  !*** ./src/scripts/elements/notifications.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.addBanner = exports.add = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
let id = 0;
class Notification {
    constructor(type, message, level, duration, customTitle, customIcon, closeCallback = () => {
        //
    }) {
        this.type = type;
        this.message = message;
        this.level = level;
        if (type === "banner") {
            this.duration = duration;
        }
        else {
            if (duration == undefined) {
                if (level === -1) {
                    this.duration = 0;
                }
                else {
                    this.duration = 3000;
                }
            }
            else {
                this.duration = duration * 1000;
            }
        }
        this.customTitle = customTitle;
        this.customIcon = customIcon;
        this.id = id++;
        this.closeCallback = closeCallback;
    }
    //level
    //0 - notice
    //1 - good
    //-1 - bad
    show() {
        let cls = "notice";
        let icon = `<i class="fas fa-fw fa-exclamation"></i>`;
        let title = "Notice";
        if (this.level === 1) {
            cls = "good";
            icon = `<i class="fas fa-fw fa-check"></i>`;
            title = "Success";
        }
        else if (this.level === -1) {
            cls = "bad";
            icon = `<i class="fas fa-fw fa-times"></i>`;
            title = "Error";
            console.error(this.message);
        }
        if (this.customTitle != undefined) {
            title = this.customTitle;
        }
        if (this.type === "banner") {
            icon = `<i class="fas fa-fw fa-bullhorn"></i>`;
        }
        if (this.customIcon != undefined) {
            icon = `<i class="fas fa-fw fa-${this.customIcon}"></i>`;
        }
        if (this.type === "notification") {
            // moveCurrentToHistory();
            const oldHeight = $("#notificationCenter .history").height();
            $("#notificationCenter .history").prepend(`
          
          <div class="notif ${cls}" id=${this.id}>
              <div class="icon">${icon}</div>
              <div class="message"><div class="title">${title}</div>${this.message}</div>
          </div>     

          `);
            const newHeight = $("#notificationCenter .history").height();
            $(`#notificationCenter .notif[id='${this.id}']`).remove();
            $("#notificationCenter .history")
                .css("margin-top", 0)
                .animate({
                marginTop: newHeight - oldHeight,
            }, 125, () => {
                $("#notificationCenter .history").css("margin-top", 0);
                $("#notificationCenter .history").prepend(`
          
                  <div class="notif ${cls}" id=${this.id}>
                      <div class="icon">${icon}</div>
                      <div class="message"><div class="title">${title}</div>${this.message}</div>
                  </div>     

              `);
                $(`#notificationCenter .notif[id='${this.id}']`)
                    .css("opacity", 0)
                    .animate({
                    opacity: 1,
                }, 125, () => {
                    $(`#notificationCenter .notif[id='${this.id}']`).css("opacity", "");
                });
                $(`#notificationCenter .notif[id='${this.id}']`).on("click", () => {
                    this.hide();
                    this.closeCallback();
                });
            });
            $(`#notificationCenter .notif[id='${this.id}']`).hover(() => {
                $(`#notificationCenter .notif[id='${this.id}']`).toggleClass("hover");
            });
        }
        else if (this.type === "banner") {
            let leftside = `<div class="icon lefticon">${icon}</div>`;
            if (/^images\/.*/.test(this.customIcon)) {
                leftside = `<div class="image" style="background-image: url(${this.customIcon})"></div>`;
            }
            $("#bannerCenter").prepend(`
        <div class="banner ${cls}" id="${this.id}">
        <div class="container">
          ${leftside}
          <div class="text">
            ${this.message}
          </div>
          ${this.duration >= 0
                ? `
          <div class="closeButton">
            <i class="fas fa-fw fa-times"></i>
          </div>
          `
                : `<div class="righticon">${icon}</div>`}
        </div>
      </div>
      `);
            const height = $("#bannerCenter").height();
            $("#centerContent").css("padding-top", height + Misc.convertRemToPixels(2) + "px");
            $("#notificationCenter").css("margin-top", height + "px");
            if (this.duration >= 0) {
                $(`#bannerCenter .banner[id='${this.id}'] .closeButton`).on("click", () => {
                    this.hide();
                    this.closeCallback();
                });
            }
        }
        if (this.duration > 0) {
            setTimeout(() => {
                this.hide();
            }, this.duration + 250);
        }
    }
    hide() {
        if (this.type === "notification") {
            $(`#notificationCenter .notif[id='${this.id}']`)
                .css("opacity", 1)
                .animate({
                opacity: 0,
            }, 125, () => {
                $(`#notificationCenter .notif[id='${this.id}']`).animate({
                    height: 0,
                }, 125, () => {
                    $(`#notificationCenter .notif[id='${this.id}']`).remove();
                });
            });
        }
        else if (this.type === "banner") {
            $(`#bannerCenter .banner[id='${this.id}']`).remove();
            const height = $("#bannerCenter").height();
            $("#centerContent").css("padding-top", height + Misc.convertRemToPixels(2) + "px");
            $("#notificationCenter").css("margin-top", height + "px");
        }
    }
}
function add(message, level = 0, duration, customTitle, customIcon, closeCallback) {
    // notificationHistory.push(
    new Notification("notification", message, level, duration, customTitle, customIcon, closeCallback).show();
    // );
}
exports.add = add;
function addBanner(message, level = -1, customIcon = "bullhorn", sticky = false, closeCallback) {
    // notificationHistory.push(
    new Notification("banner", message, level, sticky ? -1 : 0, undefined, customIcon, closeCallback).show();
    // );
}
exports.addBanner = addBanner;


/***/ }),

/***/ "./src/scripts/elements/psa.ts":
/*!*************************************!*\
  !*** ./src/scripts/elements/psa.ts ***!
  \*************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
const Notifications = __importStar(__webpack_require__(/*! ./notifications */ "./src/scripts/elements/notifications.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
function clearMemory() {
    window.localStorage.setItem("confirmedPSAs", JSON.stringify([]));
}
function getMemory() {
    var _a, _b;
    return (_b = JSON.parse((_a = window.localStorage.getItem("confirmedPSAs")) !== null && _a !== void 0 ? _a : "[]")) !== null && _b !== void 0 ? _b : [];
}
function setMemory(id) {
    const list = getMemory();
    list.push(id);
    window.localStorage.setItem("confirmedPSAs", JSON.stringify(list));
}
function getLatest() {
    return __awaiter(this, void 0, void 0, function* () {
        const response = yield ape_1.default.psas.get();
        if (response.message === "Server is down for maintenance") {
            Notifications.addBanner("Server is currently under maintenance. <a target= '_blank' href='https://monkeytype.instatus.com/'>Click here</a> for more info.", -1, "bullhorn", true);
            return [];
        }
        return response.data;
    });
}
function show() {
    return __awaiter(this, void 0, void 0, function* () {
        const latest = yield getLatest();
        if (latest == null || latest.length == 0) {
            clearMemory();
            return;
        }
        const localmemory = getMemory();
        latest.forEach((psa) => {
            var _a;
            if (localmemory.includes(psa._id) && ((_a = psa.sticky) !== null && _a !== void 0 ? _a : false) === false) {
                return;
            }
            if (psa.date) {
                const dateObj = new Date(psa.date);
                const diff = psa.date - Date.now();
                const string = (0, misc_1.secondsToString)(diff / 1000, false, false, "text", false, true);
                psa.message = psa.message.replace("{dateDifference}", string);
                psa.message = psa.message.replace("{dateNoTime}", (0, format_1.default)(dateObj, "dd MMM yyyy"));
                psa.message = psa.message.replace("{date}", (0, format_1.default)(dateObj, "dd MMM yyyy HH:mm"));
            }
            Notifications.addBanner(psa.message, psa.level, "bullhorn", psa.sticky, () => {
                setMemory(psa._id);
            });
        });
    });
}
exports.show = show;


/***/ }),

/***/ "./src/scripts/elements/scroll-to-top.ts":
/*!***********************************************!*\
  !*** ./src/scripts/elements/scroll-to-top.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
let visible = false;
$(".scrollToTopButton").on("click", () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
});
$(window).scroll(() => {
    const page = ActivePage.get();
    if (page == "test")
        return;
    if (page == "about" || page == "settings" || page == "account") {
        const scroll = window.scrollY;
        if (!visible && scroll > 100) {
            $(".scrollToTopButton").removeClass("invisible");
            visible = true;
        }
        else if (visible && scroll < 100) {
            $(".scrollToTopButton").addClass("invisible");
            visible = false;
        }
    }
});


/***/ }),

/***/ "./src/scripts/elements/theme-colors.ts":
/*!**********************************************!*\
  !*** ./src/scripts/elements/theme-colors.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = exports.reset = exports.getAll = exports.get = void 0;
let colors = {
    bg: "#323437",
    main: "#e2b714",
    caret: "#e2b714",
    sub: "#646669",
    text: "#d1d0c5",
    error: "#ca4754",
    errorExtra: "#7e2a33",
    colorfulError: "#ca4754",
    colorfulErrorExtra: "#7e2a33",
};
function get(color) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!colors[color])
            update();
        return colors[color];
    });
}
exports.get = get;
function getAll() {
    return __awaiter(this, void 0, void 0, function* () {
        if (!colors.bg)
            update();
        return colors;
    });
}
exports.getAll = getAll;
function reset() {
    colors = {
        bg: "",
        main: "",
        caret: "",
        sub: "",
        text: "",
        error: "",
        errorExtra: "",
        colorfulError: "",
        colorfulErrorExtra: "",
    };
}
exports.reset = reset;
function update() {
    const st = getComputedStyle(document.body);
    colors.bg = st.getPropertyValue("--bg-color").replace(" ", "");
    colors.main = st.getPropertyValue("--main-color").replace(" ", "");
    colors.caret = st.getPropertyValue("--caret-color").replace(" ", "");
    colors.sub = st.getPropertyValue("--sub-color").replace(" ", "");
    colors.text = st.getPropertyValue("--text-color").replace(" ", "");
    colors.error = st.getPropertyValue("--error-color").replace(" ", "");
    colors.errorExtra = st
        .getPropertyValue("--error-extra-color")
        .replace(" ", "");
    colors.colorfulError = st
        .getPropertyValue("--colorful-error-color")
        .replace(" ", "");
    colors.colorfulErrorExtra = st
        .getPropertyValue("--colorful-error-extra-color")
        .replace(" ", "");
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/elements/version-check.ts":
/*!***********************************************!*\
  !*** ./src/scripts/elements/version-check.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const Notifications = __importStar(__webpack_require__(/*! ./notifications */ "./src/scripts/elements/notifications.ts"));
// import * as VersionPopup from "./version-popup";
function setMemory(v) {
    window.localStorage.setItem("lastSeenVersion", v);
}
function getMemory() {
    var _a;
    return (_a = window.localStorage.getItem("lastSeenVersion")) !== null && _a !== void 0 ? _a : "";
}
function show(version) {
    return __awaiter(this, void 0, void 0, function* () {
        const memory = yield getMemory();
        if (memory === "") {
            setMemory(version);
            return;
        }
        if (window.location.hostname === "localhost" ||
            window.location.hostname === "127.0.0.1") {
            caches.keys().then(function (names) {
                for (const name of names)
                    caches.delete(name);
            });
        }
        if (memory === version)
            return;
        caches.keys().then(function (names) {
            for (const name of names)
                caches.delete(name);
        });
        Notifications.addBanner(`Version ${version} has been released. Click the version number in the bottom right to view the changelog.`, 1, "code-branch", false);
        setMemory(version);
    });
}
exports.show = show;


/***/ }),

/***/ "./src/scripts/firebase.ts":
/*!*********************************!*\
  !*** ./src/scripts/firebase.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.Analytics = exports.Auth = void 0;
// Import the functions you need from the SDKs you need
const app_1 = __webpack_require__(/*! firebase/app */ "./node_modules/firebase/app/dist/index.esm.js");
const auth_1 = __webpack_require__(/*! firebase/auth */ "./node_modules/firebase/auth/dist/index.esm.js");
const firebase_config_1 = __webpack_require__(/*! ./constants/firebase-config */ "./src/scripts/constants/firebase-config.ts"); // eslint-disable-line require-path-exists/exists
const analytics_1 = __webpack_require__(/*! firebase/analytics */ "./node_modules/firebase/analytics/dist/index.esm.js");
// Initialize Firebase
let app;
try {
    app = (0, app_1.initializeApp)(firebase_config_1.firebaseConfig);
    exports.Auth = (0, auth_1.getAuth)(app);
    exports.Analytics = (0, analytics_1.getAnalytics)(app);
}
catch (e) {
    console.error(e);
    $("body").text("Failed to initialize Firebase. Are you sure you have the correct config in the firebase-config.ts file?");
}


/***/ }),

/***/ "./src/scripts/index.ts":
/*!******************************!*\
  !*** ./src/scripts/index.ts ***!
  \******************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


// this file should be concatenated at the top of the legacy js files
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__webpack_require__(/*! ../styles/index.scss */ "./src/styles/index.scss");
__webpack_require__(/*! ./firebase */ "./src/scripts/firebase.ts");
const DB = __importStar(__webpack_require__(/*! ./db */ "./src/scripts/db.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ./config */ "./src/scripts/config.ts"));
const TestStats = __importStar(__webpack_require__(/*! ./test/test-stats */ "./src/scripts/test/test-stats.ts"));
const Replay = __importStar(__webpack_require__(/*! ./test/replay */ "./src/scripts/test/replay.ts"));
const TestTimer = __importStar(__webpack_require__(/*! ./test/test-timer */ "./src/scripts/test/test-timer.ts"));
const Result = __importStar(__webpack_require__(/*! ./test/result */ "./src/scripts/test/result.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test/test-input */ "./src/scripts/test/test-input.ts"));
__webpack_require__(/*! ./controllers/account-controller */ "./src/scripts/controllers/account-controller.ts");
const glarses_mode_1 = __webpack_require__(/*! ./states/glarses-mode */ "./src/scripts/states/glarses-mode.ts");
__webpack_require__(/*! ./test/caps-warning */ "./src/scripts/test/caps-warning.ts");
__webpack_require__(/*! ./popups/support-popup */ "./src/scripts/popups/support-popup.ts");
__webpack_require__(/*! ./popups/contact-popup */ "./src/scripts/popups/contact-popup.ts");
__webpack_require__(/*! ./popups/version-popup */ "./src/scripts/popups/version-popup.ts");
__webpack_require__(/*! ./popups/edit-preset-popup */ "./src/scripts/popups/edit-preset-popup.ts");
__webpack_require__(/*! ./popups/simple-popups */ "./src/scripts/popups/simple-popups.ts");
__webpack_require__(/*! ./controllers/input-controller */ "./src/scripts/controllers/input-controller.ts");
__webpack_require__(/*! ./ready */ "./src/scripts/ready.ts");
__webpack_require__(/*! ./ui */ "./src/scripts/ui.ts");
__webpack_require__(/*! ./pages/about */ "./src/scripts/pages/about.ts");
__webpack_require__(/*! ./popups/pb-tables-popup */ "./src/scripts/popups/pb-tables-popup.ts");
__webpack_require__(/*! ./elements/scroll-to-top */ "./src/scripts/elements/scroll-to-top.ts");
__webpack_require__(/*! ./popups/mobile-test-config-popup */ "./src/scripts/popups/mobile-test-config-popup.ts");
__webpack_require__(/*! ./popups/edit-tags-popup */ "./src/scripts/popups/edit-tags-popup.ts");
const Account = __importStar(__webpack_require__(/*! ./pages/account */ "./src/scripts/pages/account.ts"));
const extendedGlobal = __webpack_require__.g;
extendedGlobal.snapshot = DB.getSnapshot;
extendedGlobal.config = config_1.default;
extendedGlobal.toggleFilterDebug = Account.toggleFilterDebug;
extendedGlobal.glarsesMode = glarses_mode_1.enable;
extendedGlobal.stats = TestStats.getStats;
extendedGlobal.replay = Replay.getReplayExport;
extendedGlobal.enableTimerDebug = TestTimer.enableTimerDebug;
extendedGlobal.getTimerStats = TestTimer.getTimerStats;
extendedGlobal.toggleUnsmoothedRaw = Result.toggleUnsmoothedRaw;
extendedGlobal.enableSpacingDebug = TestInput.enableSpacingDebug;


/***/ }),

/***/ "./src/scripts/observables/config-event.ts":
/*!*************************************************!*\
  !*** ./src/scripts/observables/config-event.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch(key, newValue, nosave, previousValue, fullConfig) {
    subscribers.forEach((fn) => {
        try {
            fn(key, newValue, nosave, previousValue, fullConfig);
        }
        catch (e) {
            console.error("Config event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/observables/page-change-event.ts":
/*!******************************************************!*\
  !*** ./src/scripts/observables/page-change-event.ts ***!
  \******************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch(previousPage, newPage) {
    subscribers.forEach((fn) => {
        try {
            fn(previousPage, newPage);
        }
        catch (e) {
            console.error("Page change event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/observables/reset-requested-event.ts":
/*!**********************************************************!*\
  !*** ./src/scripts/observables/reset-requested-event.ts ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch() {
    subscribers.forEach((fn) => {
        try {
            fn();
        }
        catch (e) {
            console.error("Reset requested event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/observables/results-shown-event.ts":
/*!********************************************************!*\
  !*** ./src/scripts/observables/results-shown-event.ts ***!
  \********************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch(results) {
    subscribers.forEach((fn) => {
        try {
            fn(results);
        }
        catch (e) {
            console.error("Page change event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/observables/timer-event.ts":
/*!************************************************!*\
  !*** ./src/scripts/observables/timer-event.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch(key, value, value2) {
    subscribers.forEach((fn) => {
        try {
            fn(key, value, value2);
        }
        catch (e) {
            console.error("Timer event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/observables/word-typed-event.ts":
/*!*****************************************************!*\
  !*** ./src/scripts/observables/word-typed-event.ts ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.dispatch = exports.subscribe = void 0;
const subscribers = [];
function subscribe(fn) {
    subscribers.push(fn);
}
exports.subscribe = subscribe;
function dispatch(word, typedCorrectly, burst, currentTestWord) {
    subscribers.forEach((fn) => {
        try {
            fn(word, typedCorrectly, burst, currentTestWord);
        }
        catch (e) {
            console.error("Word Typed event subscriber threw an error");
            console.error(e);
        }
    });
}
exports.dispatch = dispatch;


/***/ }),

/***/ "./src/scripts/pages/about.ts":
/*!************************************!*\
  !*** ./src/scripts/pages/about.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = exports.fill = exports.reset = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
function reset() {
    $(".pageAbout .contributors").empty();
    $(".pageAbout .supporters").empty();
}
exports.reset = reset;
function fill() {
    return __awaiter(this, void 0, void 0, function* () {
        const supporters = yield Misc.getSupportersList();
        const contributors = yield Misc.getContributorsList();
        supporters.forEach((supporter) => {
            $(".pageAbout .supporters").append(`
      <div>${supporter}</div>
    `);
        });
        contributors.forEach((contributor) => {
            $(".pageAbout .contributors").append(`
      <div>${contributor}</div>
    `);
        });
    });
}
exports.fill = fill;
exports.page = new page_1.default("about", $(".page.pageAbout"), "/about", () => {
    //
}, () => __awaiter(void 0, void 0, void 0, function* () {
    reset();
}), () => {
    fill();
}, () => {
    //
});


/***/ }),

/***/ "./src/scripts/pages/account.ts":
/*!**************************************!*\
  !*** ./src/scripts/pages/account.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = exports.update = exports.smoothHistory = exports.reset = exports.toggleFilterDebug = void 0;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const ResultFilters = __importStar(__webpack_require__(/*! ../account/result-filters */ "./src/scripts/account/result-filters.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const ChartController = __importStar(__webpack_require__(/*! ../controllers/chart-controller */ "./src/scripts/controllers/chart-controller.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const MiniResultChart = __importStar(__webpack_require__(/*! ../account/mini-result-chart */ "./src/scripts/account/mini-result-chart.ts"));
const AllTimeStats = __importStar(__webpack_require__(/*! ../account/all-time-stats */ "./src/scripts/account/all-time-stats.ts"));
const PbTables = __importStar(__webpack_require__(/*! ../account/pb-tables */ "./src/scripts/account/pb-tables.ts"));
const LoadingPage = __importStar(__webpack_require__(/*! ./loading */ "./src/scripts/pages/loading.ts"));
const Focus = __importStar(__webpack_require__(/*! ../test/focus */ "./src/scripts/test/focus.ts"));
const SignOutButton = __importStar(__webpack_require__(/*! ../account/sign-out-button */ "./src/scripts/account/sign-out-button.ts"));
const TodayTracker = __importStar(__webpack_require__(/*! ../test/today-tracker */ "./src/scripts/test/today-tracker.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
let filterDebug = false;
//toggle filterdebug
function toggleFilterDebug() {
    filterDebug = !filterDebug;
    if (filterDebug) {
        console.log("filterDebug is on");
    }
}
exports.toggleFilterDebug = toggleFilterDebug;
let filteredResults = [];
let visibleTableLines = 0;
function loadMoreLines(lineIndex) {
    var _a, _b;
    if (filteredResults == [] || filteredResults.length == 0)
        return;
    let newVisibleLines;
    if (lineIndex && lineIndex > visibleTableLines) {
        newVisibleLines = Math.ceil(lineIndex / 10) * 10;
    }
    else {
        newVisibleLines = visibleTableLines + 10;
    }
    for (let i = visibleTableLines; i < newVisibleLines; i++) {
        const result = filteredResults[i];
        if (!result)
            continue;
        let diff = result.difficulty;
        if (diff == undefined) {
            diff = "normal";
        }
        let raw;
        try {
            raw = config_1.default.alwaysShowCPM
                ? (result.rawWpm * 5).toFixed(2)
                : result.rawWpm.toFixed(2);
            if (raw == undefined) {
                raw = "-";
            }
        }
        catch (e) {
            raw = "-";
        }
        let icons = `<span aria-label="${(_a = result.language) === null || _a === void 0 ? void 0 : _a.replace("_", " ")}" data-balloon-pos="up"><i class="fas fa-fw fa-globe-americas"></i></span>`;
        if (diff === "normal") {
            icons += `<span aria-label="${result.difficulty}" data-balloon-pos="up"><i class="far fa-fw fa-star"></i></span>`;
        }
        else if (diff === "expert") {
            icons += `<span aria-label="${result.difficulty}" data-balloon-pos="up"><i class="fas fa-fw fa-star-half-alt"></i></span>`;
        }
        else if (diff === "master") {
            icons += `<span aria-label="${result.difficulty}" data-balloon-pos="up"><i class="fas fa-fw fa-star"></i></span>`;
        }
        if (result.punctuation) {
            icons += `<span aria-label="punctuation" data-balloon-pos="up" style="font-weight:900">!?</span>`;
        }
        if (result.numbers) {
            icons += `<span aria-label="numbers" data-balloon-pos="up" style="font-weight:900">15</span>`;
        }
        if (result.blindMode) {
            icons += `<span aria-label="blind mode" data-balloon-pos="up"><i class="fas fa-fw fa-eye-slash"></i></span>`;
        }
        if (result.lazyMode) {
            icons += `<span aria-label="lazy mode" data-balloon-pos="up"><i class="fas fa-fw fa-couch"></i></span>`;
        }
        if (result.funbox !== "none" && result.funbox !== undefined) {
            icons += `<span aria-label="${result.funbox.replace(/_/g, " ")}" data-balloon-pos="up"><i class="fas fa-gamepad"></i></span>`;
        }
        if (result.chartData === undefined) {
            icons += `<span class="miniResultChartButton" aria-label="No chart data found" data-balloon-pos="up"><i class="fas fa-chart-line"></i></span>`;
        }
        else if (result.chartData === "toolong") {
            icons += `<span class="miniResultChartButton" aria-label="Chart history is not available for long tests" data-balloon-pos="up"><i class="fas fa-chart-line"></i></span>`;
        }
        else {
            icons += `<span class="miniResultChartButton" aria-label="View graph" data-balloon-pos="up" filteredResultsId="${i}" style="opacity: 1"><i class="fas fa-chart-line"></i></span>`;
        }
        let tagNames = "";
        if (result.tags !== undefined && result.tags.length > 0) {
            result.tags.forEach((tag) => {
                var _a;
                (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((snaptag) => {
                    if (tag === snaptag._id) {
                        tagNames += snaptag.name + ", ";
                    }
                });
            });
            tagNames = tagNames.substring(0, tagNames.length - 2);
        }
        let restags;
        if (result.tags === undefined) {
            restags = "[]";
        }
        else {
            restags = JSON.stringify(result.tags);
        }
        let tagIcons = `<span id="resultEditTags" resultId="${result._id}" tags='${restags}' aria-label="no tags" data-balloon-pos="up" style="opacity: .25"><i class="fas fa-fw fa-tag"></i></span>`;
        if (tagNames !== "") {
            if (result.tags !== undefined && result.tags.length > 1) {
                tagIcons = `<span id="resultEditTags" resultId="${result._id}" tags='${restags}' aria-label="${tagNames}" data-balloon-pos="up"><i class="fas fa-fw fa-tags"></i></span>`;
            }
            else {
                tagIcons = `<span id="resultEditTags" resultId="${result._id}" tags='${restags}' aria-label="${tagNames}" data-balloon-pos="up"><i class="fas fa-fw fa-tag"></i></span>`;
            }
        }
        let consistency = "-";
        if (result.consistency) {
            consistency = result.consistency.toFixed(2) + "%";
        }
        let pb = (_b = result.isPb) === null || _b === void 0 ? void 0 : _b.toString();
        if (pb) {
            pb = '<i class="fas fa-fw fa-crown"></i>';
        }
        else {
            pb = "";
        }
        let charStats = "-";
        if (result.charStats) {
            charStats = result.charStats.join("/");
        }
        else {
            charStats = result.correctChars + "/" + result.incorrectChars + "/-/-";
        }
        const date = new Date(result.timestamp);
        $(".pageAccount .history table tbody").append(`
    <tr class="resultRow" id="result-${i}">
    <td>${pb}</td>
    <td>${(config_1.default.alwaysShowCPM ? result.wpm * 5 : result.wpm).toFixed(2)}</td>
    <td>${raw}</td>
    <td>${result.acc.toFixed(2)}%</td>
    <td>${consistency}</td>
    <td>${charStats}</td>
    <td>${result.mode} ${result.mode2}</td>
    <td class="infoIcons">${icons}</td>
    <td>${tagIcons}</td>
    <td>${(0, format_1.default)(date, "dd MMM yyyy")}<br>
    ${(0, format_1.default)(date, "HH:mm")}
    </td>
    </tr>`);
    }
    visibleTableLines = newVisibleLines;
    if (visibleTableLines >= filteredResults.length) {
        $(".pageAccount .loadMoreButton").addClass("hidden");
    }
    else {
        $(".pageAccount .loadMoreButton").removeClass("hidden");
    }
}
function reset() {
    $(".pageAccount .history table tbody").empty();
    ChartController.accountActivity.data.datasets[0].data = [];
    ChartController.accountActivity.data.datasets[1].data = [];
    ChartController.accountHistory.data.datasets[0].data = [];
    ChartController.accountHistory.data.datasets[1].data = [];
    ChartController.accountActivity.updateColors();
    ChartController.accountHistory.updateColors();
}
exports.reset = reset;
let totalSecondsFiltered = 0;
let chartData = [];
let accChartData = [];
function smoothHistory(factor) {
    const smoothedWpmData = Misc.smooth(chartData.map((a) => a.y), factor);
    const smoothedAccData = Misc.smooth(accChartData.map((a) => a.y), factor);
    const chartData2 = chartData.map((a, i) => {
        const ret = Object.assign({}, a);
        ret.y = smoothedWpmData[i];
        return ret;
    });
    const accChartData2 = accChartData.map((a, i) => {
        const ret = Object.assign({}, a);
        ret.y = smoothedAccData[i];
        return ret;
    });
    ChartController.accountHistory.data.datasets[0].data = chartData2;
    ChartController.accountHistory.data.datasets[1].data = accChartData2;
    if (chartData2.length || accChartData2.length) {
        ChartController.accountHistory.update();
    }
}
exports.smoothHistory = smoothHistory;
function applyHistorySmoothing() {
    const smoothing = $(".pageAccount .content .below .smoothing input").val();
    $(".pageAccount .content .below .smoothing .value").text(smoothing);
    smoothHistory(parseInt(smoothing));
}
function update() {
    function cont() {
        var _a;
        LoadingPage.updateText("Displaying stats...");
        LoadingPage.updateBar(100);
        console.log("updating account page");
        ThemeColors.update();
        ChartController.accountHistory.updateColors();
        ChartController.accountActivity.updateColors();
        AllTimeStats.update();
        PbTables.update();
        chartData = [];
        accChartData = [];
        const wpmChartData = [];
        visibleTableLines = 0;
        let topWpm = 0;
        let topMode = "";
        let testRestarts = 0;
        let totalWpm = 0;
        let testCount = 0;
        let last10 = 0;
        let wpmLast10total = 0;
        let topAcc = 0;
        let totalAcc = 0;
        let totalAcc10 = 0;
        const rawWpm = {
            total: 0,
            count: 0,
            last10Total: 0,
            last10Count: 0,
            max: 0,
        };
        // let totalSeconds = 0;
        totalSecondsFiltered = 0;
        let topCons = 0;
        let totalCons = 0;
        let totalCons10 = 0;
        let consCount = 0;
        const activityChartData = {};
        filteredResults = [];
        $(".pageAccount .history table tbody").empty();
        (_a = DB.getSnapshot().results) === null || _a === void 0 ? void 0 : _a.forEach((result) => {
            // totalSeconds += tt;
            var _a, _b, _c, _d, _e;
            //apply filters
            try {
                let resdiff = result.difficulty;
                if (resdiff == undefined) {
                    resdiff = "normal";
                }
                if (!ResultFilters.getFilter("difficulty", resdiff)) {
                    if (filterDebug) {
                        console.log(`skipping result due to difficulty filter`, result);
                    }
                    return;
                }
                if (!ResultFilters.getFilter("mode", result.mode)) {
                    if (filterDebug) {
                        console.log(`skipping result due to mode filter`, result);
                    }
                    return;
                }
                if (result.mode == "time") {
                    let timefilter = "custom";
                    if ([15, 30, 60, 120].includes(parseInt(result.mode2))) {
                        timefilter = result.mode2;
                    }
                    if (!ResultFilters.getFilter("time", timefilter)) {
                        if (filterDebug) {
                            console.log(`skipping result due to time filter`, result);
                        }
                        return;
                    }
                }
                else if (result.mode == "words") {
                    let wordfilter = "custom";
                    if ([10, 25, 50, 100, 200].includes(parseInt(result.mode2))) {
                        wordfilter = result.mode2;
                    }
                    if (!ResultFilters.getFilter("words", wordfilter)) {
                        if (filterDebug) {
                            console.log(`skipping result due to word filter`, result);
                        }
                        return;
                    }
                }
                if (result.quoteLength != null) {
                    let filter = undefined;
                    if (result.quoteLength === 0) {
                        filter = "short";
                    }
                    else if (result.quoteLength === 1) {
                        filter = "medium";
                    }
                    else if (result.quoteLength === 2) {
                        filter = "long";
                    }
                    else if (result.quoteLength === 3) {
                        filter = "thicc";
                    }
                    if (filter !== undefined &&
                        !ResultFilters.getFilter("quoteLength", filter)) {
                        if (filterDebug) {
                            console.log(`skipping result due to quoteLength filter`, result);
                        }
                        return;
                    }
                }
                let langFilter = ResultFilters.getFilter("language", (_a = result.language) !== null && _a !== void 0 ? _a : "english");
                if (result.language === "english_expanded" &&
                    ResultFilters.getFilter("language", "english_1k")) {
                    langFilter = true;
                }
                if (!langFilter) {
                    if (filterDebug) {
                        console.log(`skipping result due to language filter`, result);
                    }
                    return;
                }
                let puncfilter = "off";
                if (result.punctuation) {
                    puncfilter = "on";
                }
                if (!ResultFilters.getFilter("punctuation", puncfilter)) {
                    if (filterDebug) {
                        console.log(`skipping result due to punctuation filter`, result);
                    }
                    return;
                }
                let numfilter = "off";
                if (result.numbers) {
                    numfilter = "on";
                }
                if (!ResultFilters.getFilter("numbers", numfilter)) {
                    if (filterDebug) {
                        console.log(`skipping result due to numbers filter`, result);
                    }
                    return;
                }
                if (result.funbox === "none" || result.funbox === undefined) {
                    if (!ResultFilters.getFilter("funbox", "none")) {
                        if (filterDebug) {
                            console.log(`skipping result due to funbox filter`, result);
                        }
                        return;
                    }
                }
                else {
                    if (!ResultFilters.getFilter("funbox", result.funbox)) {
                        if (filterDebug) {
                            console.log(`skipping result due to funbox filter`, result);
                        }
                        return;
                    }
                }
                let tagHide = true;
                if (result.tags === undefined || result.tags.length === 0) {
                    //no tags, show when no tag is enabled
                    if (((_b = DB.getSnapshot().tags) === null || _b === void 0 ? void 0 : _b.length) || 0 > 0) {
                        if (ResultFilters.getFilter("tags", "none"))
                            tagHide = false;
                    }
                    else {
                        tagHide = false;
                    }
                }
                else {
                    //tags exist
                    const validTags = (_c = DB.getSnapshot().tags) === null || _c === void 0 ? void 0 : _c.map((t) => t._id);
                    if (validTags === undefined)
                        return;
                    result.tags.forEach((tag) => {
                        //check if i even need to check tags anymore
                        if (!tagHide)
                            return;
                        //check if tag is valid
                        if (validTags === null || validTags === void 0 ? void 0 : validTags.includes(tag)) {
                            //tag valid, check if filter is on
                            if (ResultFilters.getFilter("tags", tag))
                                tagHide = false;
                        }
                        else {
                            //tag not found in valid tags, meaning probably deleted
                            if (ResultFilters.getFilter("tags", "none"))
                                tagHide = false;
                        }
                    });
                }
                if (tagHide) {
                    if (filterDebug) {
                        console.log(`skipping result due to tag filter`, result);
                    }
                    return;
                }
                const timeSinceTest = Math.abs(result.timestamp - Date.now()) / 1000;
                let datehide = true;
                if (ResultFilters.getFilter("date", "all") ||
                    (ResultFilters.getFilter("date", "last_day") &&
                        timeSinceTest <= 86400) ||
                    (ResultFilters.getFilter("date", "last_week") &&
                        timeSinceTest <= 604800) ||
                    (ResultFilters.getFilter("date", "last_month") &&
                        timeSinceTest <= 2592000) ||
                    (ResultFilters.getFilter("date", "last_3months") &&
                        timeSinceTest <= 7776000)) {
                    datehide = false;
                }
                if (datehide) {
                    if (filterDebug) {
                        console.log(`skipping result due to date filter`, result);
                    }
                    return;
                }
                filteredResults.push(result);
            }
            catch (e) {
                Notifications.add("Something went wrong when filtering. Resetting filters.", 0);
                console.log(result);
                console.error(e);
                ResultFilters.reset();
                ResultFilters.updateActive();
                update();
            }
            //filters done
            //=======================================
            const resultDate = new Date(result.timestamp);
            resultDate.setSeconds(0);
            resultDate.setMinutes(0);
            resultDate.setHours(0);
            resultDate.setMilliseconds(0);
            const resultTimestamp = resultDate.getTime();
            if (Object.keys(activityChartData).includes(String(resultTimestamp))) {
                activityChartData[resultTimestamp].amount++;
                activityChartData[resultTimestamp].time +=
                    result.testDuration +
                        result.incompleteTestSeconds -
                        ((_d = result.afkDuration) !== null && _d !== void 0 ? _d : 0);
                activityChartData[resultTimestamp].totalWpm += result.wpm;
            }
            else {
                activityChartData[resultTimestamp] = {
                    amount: 1,
                    time: result.testDuration +
                        result.incompleteTestSeconds -
                        ((_e = result.afkDuration) !== null && _e !== void 0 ? _e : 0),
                    totalWpm: result.wpm,
                };
            }
            let tt = 0;
            if (result.testDuration == undefined &&
                result.mode2 !== "custom" &&
                result.mode2 !== "zen") {
                //test finished before testDuration field was introduced - estimate
                if (result.mode == "time") {
                    tt = result.mode2;
                }
                else if (result.mode == "words") {
                    tt = (result.mode2 / result.wpm) * 60;
                }
            }
            else {
                tt = parseFloat(result.testDuration); //legacy results could have a string here
            }
            if (result.incompleteTestSeconds != undefined) {
                tt += result.incompleteTestSeconds;
            }
            else if (result.restartCount != undefined &&
                result.restartCount > 0) {
                tt += (tt / 4) * result.restartCount;
            }
            // if (result.incompleteTestSeconds != undefined) {
            //   tt += result.incompleteTestSeconds;
            // } else if (result.restartCount != undefined && result.restartCount > 0) {
            //   tt += (tt / 4) * result.restartCount;
            // }
            totalSecondsFiltered += tt;
            if (last10 < 10) {
                last10++;
                wpmLast10total += result.wpm;
                totalAcc10 += result.acc;
                result.consistency !== undefined
                    ? (totalCons10 += result.consistency)
                    : 0;
            }
            testCount++;
            if (result.consistency !== undefined) {
                consCount++;
                totalCons += result.consistency;
                if (result.consistency > topCons) {
                    topCons = result.consistency;
                }
            }
            if (result.rawWpm != null) {
                if (rawWpm.last10Count < 10) {
                    rawWpm.last10Count++;
                    rawWpm.last10Total += result.rawWpm;
                }
                rawWpm.total += result.rawWpm;
                rawWpm.count++;
                if (result.rawWpm > rawWpm.max) {
                    rawWpm.max = result.rawWpm;
                }
            }
            if (result.acc > topAcc) {
                topAcc = result.acc;
            }
            totalAcc += result.acc;
            if (result.restartCount != undefined) {
                testRestarts += result.restartCount;
            }
            chartData.push({
                x: result.timestamp,
                y: config_1.default.alwaysShowCPM ? Misc.roundTo2(result.wpm * 5) : result.wpm,
                wpm: config_1.default.alwaysShowCPM
                    ? Misc.roundTo2(result.wpm * 5)
                    : result.wpm,
                acc: result.acc,
                mode: result.mode,
                mode2: result.mode2,
                punctuation: result.punctuation,
                language: result.language,
                timestamp: result.timestamp,
                difficulty: result.difficulty,
                raw: config_1.default.alwaysShowCPM
                    ? Misc.roundTo2(result.rawWpm * 5)
                    : result.rawWpm,
            });
            wpmChartData.push(result.wpm);
            accChartData.push({
                x: result.timestamp,
                y: 100 - result.acc,
                errorRate: 100 - result.acc,
            });
            if (result.wpm > topWpm) {
                const puncsctring = result.punctuation ? ",<br>with punctuation" : "";
                const numbsctring = result.numbers
                    ? ",<br> " + (result.punctuation ? "&" : "") + "with numbers"
                    : "";
                topWpm = result.wpm;
                if (result.mode == "custom")
                    topMode = result.mode;
                else {
                    topMode =
                        result.mode + " " + result.mode2 + puncsctring + numbsctring;
                }
            }
            totalWpm += result.wpm;
        });
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .group.history table thead tr td:nth-child(2)").text("cpm");
        }
        else {
            $(".pageAccount .group.history table thead tr td:nth-child(2)").text("wpm");
        }
        loadMoreLines();
        ////////
        const activityChartData_amount = [];
        const activityChartData_time = [];
        const activityChartData_avgWpm = [];
        // let lastTimestamp = 0;
        Object.keys(activityChartData).forEach((date) => {
            const dateInt = parseInt(date);
            activityChartData_amount.push({
                x: dateInt,
                y: activityChartData[dateInt].amount,
            });
            activityChartData_time.push({
                x: dateInt,
                y: Misc.roundTo2(activityChartData[dateInt].time),
                amount: activityChartData[dateInt].amount,
            });
            activityChartData_avgWpm.push({
                x: dateInt,
                y: Misc.roundTo2((config_1.default.alwaysShowCPM
                    ? activityChartData[dateInt].totalWpm * 5
                    : activityChartData[dateInt].totalWpm) /
                    activityChartData[dateInt].amount),
            });
            // lastTimestamp = date;
        });
        const accountActivityScaleOptions = ChartController.accountActivity.options.scales;
        if (config_1.default.alwaysShowCPM) {
            accountActivityScaleOptions["avgWpm"].title.text = "Average Cpm";
        }
        else {
            accountActivityScaleOptions["avgWpm"].title.text = "Average Wpm";
        }
        ChartController.accountActivity.data.datasets[0].data =
            activityChartData_time;
        ChartController.accountActivity.data.datasets[1].data =
            activityChartData_avgWpm;
        const accountHistoryScaleOptions = ChartController.accountHistory.options.scales;
        if (config_1.default.alwaysShowCPM) {
            accountHistoryScaleOptions["wpm"].title.text = "Characters per Minute";
        }
        else {
            accountHistoryScaleOptions["wpm"].title.text = "Words per Minute";
        }
        ChartController.accountHistory.data.datasets[0].data = chartData;
        ChartController.accountHistory.data.datasets[1].data = accChartData;
        const wpms = chartData.map((r) => r.y);
        const minWpmChartVal = Math.min(...wpms);
        const maxWpmChartVal = Math.max(...wpms);
        // let accuracies = accChartData.map((r) => r.y);
        accountHistoryScaleOptions["wpm"].max =
            Math.floor(maxWpmChartVal) + (10 - (Math.floor(maxWpmChartVal) % 10));
        if (!config_1.default.startGraphsAtZero) {
            accountHistoryScaleOptions["wpm"].min = Math.floor(minWpmChartVal);
        }
        else {
            accountHistoryScaleOptions["wpm"].min = 0;
        }
        if (chartData == [] || chartData.length == 0) {
            $(".pageAccount .group.noDataError").removeClass("hidden");
            $(".pageAccount .group.chart").addClass("hidden");
            $(".pageAccount .group.dailyActivityChart").addClass("hidden");
            $(".pageAccount .group.history").addClass("hidden");
            $(".pageAccount .triplegroup.stats").addClass("hidden");
        }
        else {
            $(".pageAccount .group.noDataError").addClass("hidden");
            $(".pageAccount .group.chart").removeClass("hidden");
            $(".pageAccount .group.dailyActivityChart").removeClass("hidden");
            $(".pageAccount .group.history").removeClass("hidden");
            $(".pageAccount .triplegroup.stats").removeClass("hidden");
        }
        $(".pageAccount .timeTotalFiltered .val").text(Misc.secondsToString(Math.round(totalSecondsFiltered), true, true));
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .highestWpm .title").text("highest cpm");
            $(".pageAccount .highestWpm .val").text(Misc.roundTo2(topWpm * 5));
        }
        else {
            $(".pageAccount .highestWpm .title").text("highest wpm");
            $(".pageAccount .highestWpm .val").text(Misc.roundTo2(topWpm));
        }
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .averageWpm .title").text("average cpm");
            $(".pageAccount .averageWpm .val").text(Math.round((totalWpm * 5) / testCount));
        }
        else {
            $(".pageAccount .averageWpm .title").text("average wpm");
            $(".pageAccount .averageWpm .val").text(Math.round(totalWpm / testCount));
        }
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .averageWpm10 .title").text("average cpm (last 10 tests)");
            $(".pageAccount .averageWpm10 .val").text(Math.round((wpmLast10total * 5) / last10));
        }
        else {
            $(".pageAccount .averageWpm10 .title").text("average wpm (last 10 tests)");
            $(".pageAccount .averageWpm10 .val").text(Math.round(wpmLast10total / last10));
        }
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .highestRaw .title").text("highest raw cpm");
            $(".pageAccount .highestRaw .val").text(Misc.roundTo2(rawWpm.max * 5));
        }
        else {
            $(".pageAccount .highestRaw .title").text("highest raw wpm");
            $(".pageAccount .highestRaw .val").text(Misc.roundTo2(rawWpm.max));
        }
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .averageRaw .title").text("average raw cpm");
            $(".pageAccount .averageRaw .val").text(Math.round((rawWpm.total * 5) / rawWpm.count));
        }
        else {
            $(".pageAccount .averageRaw .title").text("average raw wpm");
            $(".pageAccount .averageRaw .val").text(Math.round(rawWpm.total / rawWpm.count));
        }
        if (config_1.default.alwaysShowCPM) {
            $(".pageAccount .averageRaw10 .title").text("average raw cpm (last 10 tests)");
            $(".pageAccount .averageRaw10 .val").text(Math.round((rawWpm.last10Total * 5) / rawWpm.last10Count));
        }
        else {
            $(".pageAccount .averageRaw10 .title").text("average raw wpm (last 10 tests)");
            $(".pageAccount .averageRaw10 .val").text(Math.round(rawWpm.last10Total / rawWpm.last10Count));
        }
        $(".pageAccount .highestWpm .mode").html(topMode);
        $(".pageAccount .testsTaken .val").text(testCount);
        $(".pageAccount .highestAcc .val").text(topAcc + "%");
        $(".pageAccount .avgAcc .val").text(Math.round(totalAcc / testCount) + "%");
        $(".pageAccount .avgAcc10 .val").text(Math.round(totalAcc10 / last10) + "%");
        if (totalCons == 0 || totalCons == undefined) {
            $(".pageAccount .avgCons .val").text("-");
            $(".pageAccount .avgCons10 .val").text("-");
        }
        else {
            $(".pageAccount .highestCons .val").text(topCons + "%");
            $(".pageAccount .avgCons .val").text(Math.round(totalCons / consCount) + "%");
            $(".pageAccount .avgCons10 .val").text(Math.round(totalCons10 / Math.min(last10, consCount)) + "%");
        }
        $(".pageAccount .testsStarted .val").text(`${testCount + testRestarts}`);
        $(".pageAccount .testsCompleted .val").text(`${testCount}(${Math.floor((testCount / (testCount + testRestarts)) * 100)}%)`);
        $(".pageAccount .testsCompleted .avgres").text(`
      ${(testRestarts / testCount).toFixed(1)} restarts per completed test
    `);
        const wpmPoints = filteredResults.map((r) => r.wpm).reverse();
        const trend = Misc.findLineByLeastSquares(wpmPoints);
        const wpmChange = trend[1][1] - trend[0][1];
        const wpmChangePerHour = wpmChange * (3600 / totalSecondsFiltered);
        const plus = wpmChangePerHour > 0 ? "+" : "";
        $(".pageAccount .group.chart .below .text").text(`Speed change per hour spent typing: ${plus +
            Misc.roundTo2(config_1.default.alwaysShowCPM ? wpmChangePerHour * 5 : wpmChangePerHour)} ${config_1.default.alwaysShowCPM ? "cpm" : "wpm"}.`);
        applyHistorySmoothing();
        ChartController.accountActivity.updateColors();
        LoadingPage.updateBar(100, true);
        setTimeout(() => {
            if (ActivePage.get() == "account")
                SignOutButton.show();
        }, 125);
        Focus.set(false);
        Misc.swapElements($(".pageAccount .preloader"), $(".pageAccount .content"), 250);
    }
    if (DB.getSnapshot() === null) {
        Notifications.add(`Missing account data. Please refresh.`, -1);
        $(".pageAccount .preloader").html("Missing account data. Please refresh.");
    }
    else if (DB.getSnapshot().results === undefined) {
        LoadingPage.updateBar(45, true);
        DB.getUserResults().then((d) => {
            TodayTracker.addAllFromToday();
            if (d) {
                ResultFilters.updateActive();
                update();
            }
        });
    }
    else {
        console.log("using db snap");
        try {
            cont();
        }
        catch (e) {
            console.error(e);
            Notifications.add(`Something went wrong: ${e}`, -1);
        }
    }
}
exports.update = update;
function sortAndRefreshHistory(keyString, headerClass, forceDescending = null) {
    // Removes styling from previous sorting requests:
    $("td").removeClass("header-sorted");
    $("td").children("i").remove();
    $(headerClass).addClass("header-sorted");
    if (filteredResults.length < 2)
        return;
    const key = keyString;
    // This allows to reverse the sorting order when clicking multiple times on the table header
    let descending = true;
    if (forceDescending !== null) {
        if (forceDescending == true) {
            $(headerClass).append('<i class="fas fa-sort-down" aria-hidden="true"></i>');
        }
        else {
            descending = false;
            $(headerClass).append('<i class="fas fa-sort-up" aria-hidden="true"></i>');
        }
    }
    else if (parseInt(filteredResults[0][key]) <=
        parseInt(filteredResults[filteredResults.length - 1][key])) {
        descending = true;
        $(headerClass).append('<i class="fas fa-sort-down" aria-hidden="true"></i>');
    }
    else {
        descending = false;
        $(headerClass).append('<i class="fas fa-sort-up", aria-hidden="true"></i>');
    }
    const temp = [];
    const parsedIndexes = [];
    while (temp.length < filteredResults.length) {
        let lowest = Number.MAX_VALUE;
        let highest = -1;
        let idx = -1;
        for (let i = 0; i < filteredResults.length; i++) {
            //find the lowest wpm with index not already parsed
            if (!descending) {
                if (filteredResults[i][key] <= lowest &&
                    !parsedIndexes.includes(i)) {
                    lowest = filteredResults[i][key];
                    idx = i;
                }
            }
            else {
                if (filteredResults[i][key] >= highest &&
                    !parsedIndexes.includes(i)) {
                    highest = filteredResults[i][key];
                    idx = i;
                }
            }
        }
        temp.push(filteredResults[idx]);
        parsedIndexes.push(idx);
    }
    filteredResults = temp;
    $(".pageAccount .history table tbody").empty();
    visibleTableLines = 0;
    loadMoreLines();
}
$(".pageAccount .toggleAccuracyOnChart").on("click", () => {
    UpdateConfig.setChartAccuracy(!config_1.default.chartAccuracy);
});
$(".pageAccount .toggleChartStyle").on("click", () => {
    if (config_1.default.chartStyle == "line") {
        UpdateConfig.setChartStyle("scatter");
    }
    else {
        UpdateConfig.setChartStyle("line");
    }
});
$(".pageAccount .loadMoreButton").on("click", () => {
    loadMoreLines();
});
$(".pageAccount #accountHistoryChart").on("click", () => {
    var _a, _b, _c;
    const index = ChartController.accountHistoryActiveIndex;
    loadMoreLines(index);
    if (!window)
        return;
    const windowHeight = (_a = $(window).height()) !== null && _a !== void 0 ? _a : 0;
    const offset = (_c = (_b = $(`#result-${index}`).offset()) === null || _b === void 0 ? void 0 : _b.top) !== null && _c !== void 0 ? _c : 0;
    const scrollTo = offset - windowHeight / 2;
    $([document.documentElement, document.body]).animate({
        scrollTop: scrollTo,
    }, 500);
    $(".resultRow").removeClass("active");
    $(`#result-${index}`).addClass("active");
});
$(document).on("click", ".pageAccount .miniResultChartButton", (event) => {
    var _a;
    console.log("updating");
    const filteredId = $(event.currentTarget).attr("filteredResultsId");
    if (filteredId === undefined)
        return;
    MiniResultChart.updateData(filteredResults[parseInt(filteredId)].chartData);
    MiniResultChart.show();
    MiniResultChart.updatePosition(event.pageX - ((_a = $(".pageAccount .miniResultChartWrapper").outerWidth()) !== null && _a !== void 0 ? _a : 0), event.pageY + 30);
});
$(document).on("click", ".history-wpm-header", () => {
    sortAndRefreshHistory("wpm", ".history-wpm-header");
});
$(document).on("click", ".history-raw-header", () => {
    sortAndRefreshHistory("rawWpm", ".history-raw-header");
});
$(document).on("click", ".history-acc-header", () => {
    sortAndRefreshHistory("acc", ".history-acc-header");
});
$(document).on("click", ".history-correct-chars-header", () => {
    sortAndRefreshHistory("correctChars", ".history-correct-chars-header");
});
$(document).on("click", ".history-incorrect-chars-header", () => {
    sortAndRefreshHistory("incorrectChars", ".history-incorrect-chars-header");
});
$(document).on("click", ".history-consistency-header", () => {
    sortAndRefreshHistory("consistency", ".history-consistency-header");
});
$(document).on("click", ".history-date-header", () => {
    sortAndRefreshHistory("timestamp", ".history-date-header");
});
// Resets sorting to by date' when applying filers (normal or advanced)
$(document).on("click", ".buttonsAndTitle .buttons .button", () => {
    // We want to 'force' descending sort:
    sortAndRefreshHistory("timestamp", ".history-date-header", true);
});
$(".pageAccount .topFilters .button, .pageAccount .filterButtons .button ").click(() => {
    setTimeout(() => {
        update();
    }, 0);
});
$(".pageAccount .content .below .smoothing input").on("input", () => {
    applyHistorySmoothing();
});
$(".pageAccount .content .group.aboveHistory .exportCSV").on("click", () => {
    Misc.downloadResultsCSV(filteredResults);
});
exports.page = new page_1.default("account", $(".page.pageAccount"), "/account", () => {
    SignOutButton.hide();
}, () => __awaiter(void 0, void 0, void 0, function* () {
    reset();
}), () => {
    update();
    // SignOutButton.show();
}, () => {
    //
});


/***/ }),

/***/ "./src/scripts/pages/loading.ts":
/*!**************************************!*\
  !*** ./src/scripts/pages/loading.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = exports.showBar = exports.updateText = exports.updateBar = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
function updateBar(percentage, fast) {
    const speed = fast ? 100 : 1000;
    $(".pageLoading .fill, .pageAccount .fill")
        .stop(true, true)
        .animate({
        width: percentage + "%",
    }, speed);
}
exports.updateBar = updateBar;
function updateText(text) {
    $(".pageLoading .text, .pageAccount .text").text(text);
}
exports.updateText = updateText;
function showBar() {
    return new Promise((resolve) => {
        Misc.swapElements($(".pageLoading .icon"), $(".pageLoading .barWrapper"), 125, () => {
            resolve();
        });
        Misc.swapElements($(".pageAccount .icon"), $(".pageAccount .barWrapper"), 125, () => {
            resolve();
        });
    });
}
exports.showBar = showBar;
exports.page = new page_1.default("loading", $(".page.pageLoading"), "/", () => __awaiter(void 0, void 0, void 0, function* () {
    //
}), () => __awaiter(void 0, void 0, void 0, function* () {
    //
}), () => {
    //
}, () => {
    //
});


/***/ }),

/***/ "./src/scripts/pages/login.ts":
/*!************************************!*\
  !*** ./src/scripts/pages/login.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = void 0;
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
exports.page = new page_1.default("login", $(".page.pageLogin"), "/login", () => {
    //
}, () => {
    //
}, () => {
    //
}, () => {
    //
});


/***/ }),

/***/ "./src/scripts/pages/page.ts":
/*!***********************************!*\
  !*** ./src/scripts/pages/page.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
class Page {
    constructor(name, element, pathname, beforeHide, afterHide, beforeShow, afterShow) {
        this.name = name;
        this.element = element;
        this.pathname = pathname;
        this.beforeHide = beforeHide;
        this.afterHide = afterHide;
        this.beforeShow = beforeShow;
        this.afterShow = afterShow;
    }
}
exports["default"] = Page;


/***/ }),

/***/ "./src/scripts/pages/settings.ts":
/*!***************************************!*\
  !*** ./src/scripts/pages/settings.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = exports.setEventDisabled = exports.update = exports.showAccountSection = exports.updateAuthSections = exports.updateDiscordSection = exports.hideAccountSection = exports.fillSettingsPage = exports.reset = exports.groups = void 0;
const settings_group_1 = __importDefault(__webpack_require__(/*! ../settings/settings-group */ "./src/scripts/settings/settings-group.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Sound = __importStar(__webpack_require__(/*! ../controllers/sound-controller */ "./src/scripts/controllers/sound-controller.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Funbox = __importStar(__webpack_require__(/*! ../test/funbox */ "./src/scripts/test/funbox.ts"));
const TagController = __importStar(__webpack_require__(/*! ../controllers/tag-controller */ "./src/scripts/controllers/tag-controller.ts"));
const PresetController = __importStar(__webpack_require__(/*! ../controllers/preset-controller */ "./src/scripts/controllers/preset-controller.ts"));
const ThemePicker = __importStar(__webpack_require__(/*! ../settings/theme-picker */ "./src/scripts/settings/theme-picker.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const ImportExportSettingsPopup = __importStar(__webpack_require__(/*! ../popups/import-export-settings-popup */ "./src/scripts/popups/import-export-settings-popup.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const ApeKeysPopup = __importStar(__webpack_require__(/*! ../popups/ape-keys-popup */ "./src/scripts/popups/ape-keys-popup.ts"));
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
exports.groups = {};
function initGroups() {
    return __awaiter(this, void 0, void 0, function* () {
        yield UpdateConfig.loadPromise;
        exports.groups.smoothCaret = new settings_group_1.default("smoothCaret", UpdateConfig.setSmoothCaret, "button");
        exports.groups.difficulty = new settings_group_1.default("difficulty", UpdateConfig.setDifficulty, "button");
        exports.groups.quickTab = new settings_group_1.default("quickTab", UpdateConfig.setQuickTabMode, "button");
        exports.groups.showLiveWpm = new settings_group_1.default("showLiveWpm", UpdateConfig.setShowLiveWpm, "button", () => {
            exports.groups["keymapMode"].updateInput();
        });
        exports.groups.showLiveAcc = new settings_group_1.default("showLiveAcc", UpdateConfig.setShowLiveAcc, "button");
        exports.groups.showLiveBurst = new settings_group_1.default("showLiveBurst", UpdateConfig.setShowLiveBurst, "button");
        exports.groups.showTimerProgress = new settings_group_1.default("showTimerProgress", UpdateConfig.setShowTimerProgress, "button");
        exports.groups.showAverage = new settings_group_1.default("showAverage", UpdateConfig.setShowAverage, "button");
        exports.groups.keymapMode = new settings_group_1.default("keymapMode", UpdateConfig.setKeymapMode, "button", () => {
            exports.groups["showLiveWpm"].updateInput();
        }, () => {
            if (config_1.default.keymapMode === "off") {
                $(".pageSettings .section.keymapStyle").addClass("hidden");
                $(".pageSettings .section.keymapLayout").addClass("hidden");
                $(".pageSettings .section.keymapLegendStyle").addClass("hidden");
            }
            else {
                $(".pageSettings .section.keymapStyle").removeClass("hidden");
                $(".pageSettings .section.keymapLayout").removeClass("hidden");
                $(".pageSettings .section.keymapLegendStyle").removeClass("hidden");
            }
        });
        exports.groups.keymapMatrix = new settings_group_1.default("keymapStyle", UpdateConfig.setKeymapStyle, "button");
        exports.groups.keymapLayout = new settings_group_1.default("keymapLayout", UpdateConfig.setKeymapLayout, "select");
        exports.groups.keymapLegendStyle = new settings_group_1.default("keymapLegendStyle", UpdateConfig.setKeymapLegendStyle, "button");
        exports.groups.showKeyTips = new settings_group_1.default("showKeyTips", UpdateConfig.setKeyTips, "button", undefined, () => {
            if (config_1.default.showKeyTips) {
                $(".pageSettings .tip").removeClass("hidden");
            }
            else {
                $(".pageSettings .tip").addClass("hidden");
            }
        });
        exports.groups.freedomMode = new settings_group_1.default("freedomMode", UpdateConfig.setFreedomMode, "button", () => {
            exports.groups["confidenceMode"].updateInput();
        });
        exports.groups.strictSpace = new settings_group_1.default("strictSpace", UpdateConfig.setStrictSpace, "button");
        exports.groups.oppositeShiftMode = new settings_group_1.default("oppositeShiftMode", UpdateConfig.setOppositeShiftMode, "button");
        exports.groups.confidenceMode = new settings_group_1.default("confidenceMode", UpdateConfig.setConfidenceMode, "button", () => {
            exports.groups["freedomMode"].updateInput();
            exports.groups["stopOnError"].updateInput();
        });
        exports.groups.indicateTypos = new settings_group_1.default("indicateTypos", UpdateConfig.setIndicateTypos, "button");
        exports.groups.hideExtraLetters = new settings_group_1.default("hideExtraLetters", UpdateConfig.setHideExtraLetters, "button");
        exports.groups.blindMode = new settings_group_1.default("blindMode", UpdateConfig.setBlindMode, "button");
        exports.groups.quickEnd = new settings_group_1.default("quickEnd", UpdateConfig.setQuickEnd, "button");
        exports.groups.repeatQuotes = new settings_group_1.default("repeatQuotes", UpdateConfig.setRepeatQuotes, "button");
        exports.groups.enableAds = new settings_group_1.default("enableAds", UpdateConfig.setEnableAds, "button");
        exports.groups.alwaysShowWordsHistory = new settings_group_1.default("alwaysShowWordsHistory", UpdateConfig.setAlwaysShowWordsHistory, "button");
        exports.groups.britishEnglish = new settings_group_1.default("britishEnglish", UpdateConfig.setBritishEnglish, "button");
        exports.groups.singleListCommandLine = new settings_group_1.default("singleListCommandLine", UpdateConfig.setSingleListCommandLine, "button");
        exports.groups.capsLockWarning = new settings_group_1.default("capsLockWarning", UpdateConfig.setCapsLockWarning, "button");
        exports.groups.flipTestColors = new settings_group_1.default("flipTestColors", UpdateConfig.setFlipTestColors, "button");
        exports.groups.swapEscAndTab = new settings_group_1.default("swapEscAndTab", UpdateConfig.setSwapEscAndTab, "button");
        exports.groups.showOutOfFocusWarning = new settings_group_1.default("showOutOfFocusWarning", UpdateConfig.setShowOutOfFocusWarning, "button");
        exports.groups.colorfulMode = new settings_group_1.default("colorfulMode", UpdateConfig.setColorfulMode, "button");
        exports.groups.startGraphsAtZero = new settings_group_1.default("startGraphsAtZero", UpdateConfig.setStartGraphsAtZero, "button");
        exports.groups.autoSwitchTheme = new settings_group_1.default("autoSwitchTheme", UpdateConfig.setAutoSwitchTheme, "button");
        exports.groups.randomTheme = new settings_group_1.default("randomTheme", UpdateConfig.setRandomTheme, "button");
        exports.groups.stopOnError = new settings_group_1.default("stopOnError", UpdateConfig.setStopOnError, "button", () => {
            exports.groups["confidenceMode"].updateInput();
        });
        exports.groups.soundVolume = new settings_group_1.default("soundVolume", UpdateConfig.setSoundVolume, "button");
        exports.groups.playSoundOnError = new settings_group_1.default("playSoundOnError", UpdateConfig.setPlaySoundOnError, "button", () => {
            if (config_1.default.playSoundOnError)
                Sound.playError();
        });
        exports.groups.playSoundOnClick = new settings_group_1.default("playSoundOnClick", UpdateConfig.setPlaySoundOnClick, "button", () => {
            if (config_1.default.playSoundOnClick !== "off")
                Sound.playClick();
        });
        exports.groups.showAllLines = new settings_group_1.default("showAllLines", UpdateConfig.setShowAllLines, "button");
        exports.groups.paceCaret = new settings_group_1.default("paceCaret", UpdateConfig.setPaceCaret, "button");
        exports.groups.repeatedPace = new settings_group_1.default("repeatedPace", UpdateConfig.setRepeatedPace, "button");
        exports.groups.minWpm = new settings_group_1.default("minWpm", UpdateConfig.setMinWpm, "button");
        exports.groups.minAcc = new settings_group_1.default("minAcc", UpdateConfig.setMinAcc, "button");
        exports.groups.minBurst = new settings_group_1.default("minBurst", UpdateConfig.setMinBurst, "button");
        exports.groups.smoothLineScroll = new settings_group_1.default("smoothLineScroll", UpdateConfig.setSmoothLineScroll, "button");
        exports.groups.lazyMode = new settings_group_1.default("lazyMode", UpdateConfig.setLazyMode, "button");
        exports.groups.layout = new settings_group_1.default("layout", UpdateConfig.setLayout, "select");
        exports.groups.language = new settings_group_1.default("language", UpdateConfig.setLanguage, "select");
        exports.groups.fontSize = new settings_group_1.default("fontSize", UpdateConfig.setFontSize, "button");
        exports.groups.pageWidth = new settings_group_1.default("pageWidth", UpdateConfig.setPageWidth, "button");
        exports.groups.caretStyle = new settings_group_1.default("caretStyle", UpdateConfig.setCaretStyle, "button");
        exports.groups.paceCaretStyle = new settings_group_1.default("paceCaretStyle", UpdateConfig.setPaceCaretStyle, "button");
        exports.groups.timerStyle = new settings_group_1.default("timerStyle", UpdateConfig.setTimerStyle, "button");
        exports.groups.highlightMode = new settings_group_1.default("highlightMode", UpdateConfig.setHighlightMode, "button");
        exports.groups.timerOpacity = new settings_group_1.default("timerOpacity", UpdateConfig.setTimerOpacity, "button");
        exports.groups.timerColor = new settings_group_1.default("timerColor", UpdateConfig.setTimerColor, "button");
        exports.groups.fontFamily = new settings_group_1.default("fontFamily", UpdateConfig.setFontFamily, "button", undefined, () => {
            const customButton = $(".pageSettings .section.fontFamily .buttons .custom");
            if ($(".pageSettings .section.fontFamily .buttons .active").length === 0) {
                customButton.addClass("active");
                customButton.text(`Custom (${config_1.default.fontFamily.replace(/_/g, " ")})`);
            }
            else {
                customButton.text("Custom");
            }
        });
        exports.groups.alwaysShowDecimalPlaces = new settings_group_1.default("alwaysShowDecimalPlaces", UpdateConfig.setAlwaysShowDecimalPlaces, "button");
        exports.groups.alwaysShowCPM = new settings_group_1.default("alwaysShowCPM", UpdateConfig.setAlwaysShowCPM, "button");
        exports.groups.customBackgroundSize = new settings_group_1.default("customBackgroundSize", UpdateConfig.setCustomBackgroundSize, "button");
        // groups.customLayoutfluid = new SettingsGroup(
        //   "customLayoutfluid",
        //   UpdateConfig.setCustomLayoutfluid
        // );
    });
}
function reset() {
    $(".pageSettings .section.themes .favThemes.buttons").empty();
    $(".pageSettings .section.themes .allThemes.buttons").empty();
    $(".pageSettings .section.themes .allCustomThemes.buttons").empty();
    $(".pageSettings .section.languageGroups .buttons").empty();
    $(".pageSettings select").empty().select2("destroy");
    $(".pageSettings .section.funbox .buttons").empty();
    $(".pageSettings .section.fontFamily .buttons").empty();
}
exports.reset = reset;
let groupsInitialized = false;
function fillSettingsPage() {
    return __awaiter(this, void 0, void 0, function* () {
        if (config_1.default.showKeyTips) {
            $(".pageSettings .tip").removeClass("hidden");
        }
        else {
            $(".pageSettings .tip").addClass("hidden");
        }
        // Language Selection Combobox
        const languageEl = $(".pageSettings .section.language select").empty();
        const languageGroups = yield Misc.getLanguageGroups();
        languageGroups.forEach((group) => {
            let langComboBox = `<optgroup label="${group.name}">`;
            group.languages.forEach((language) => {
                langComboBox += `<option value="${language}">
        ${language.replace(/_/g, " ")}
      </option>`;
            });
            langComboBox += `</optgroup>`;
            languageEl.append(langComboBox);
        });
        languageEl.select2({
            width: "100%",
        });
        const layoutEl = $(".pageSettings .section.layout select").empty();
        layoutEl.append(`<option value='default'>off</option>`);
        Object.keys(yield Misc.getLayoutsList()).forEach((layout) => {
            layoutEl.append(`<option value='${layout}'>${layout.replace(/_/g, " ")}</option>`);
        });
        layoutEl.select2({
            width: "100%",
        });
        const keymapEl = $(".pageSettings .section.keymapLayout select").empty();
        keymapEl.append(`<option value='overrideSync'>emulator sync</option>`);
        Object.keys(yield Misc.getLayoutsList()).forEach((layout) => {
            if (layout.toString() != "default") {
                keymapEl.append(`<option value='${layout}'>${layout.replace(/_/g, " ")}</option>`);
            }
        });
        keymapEl.select2({
            width: "100%",
        });
        const themeEl1 = $(".pageSettings .section.autoSwitchThemeInputs select.light").empty();
        const themeEl2 = $(".pageSettings .section.autoSwitchThemeInputs select.dark").empty();
        for (const theme of yield Misc.getThemesList()) {
            themeEl1.append(`<option value='${theme.name}'>${theme.name.replace(/_/g, " ")}</option>`);
            themeEl2.append(`<option value='${theme.name}'>${theme.name.replace(/_/g, " ")}</option>`);
        }
        themeEl1.select2({
            width: "100%",
        });
        themeEl2.select2({
            width: "100%",
        });
        $(`.pageSettings .section.autoSwitchThemeInputs select.light`)
            .val(config_1.default.themeLight)
            .trigger("change.select2");
        $(`.pageSettings .section.autoSwitchThemeInputs select.dark`)
            .val(config_1.default.themeDark)
            .trigger("change.select2");
        const funboxEl = $(".pageSettings .section.funbox .buttons").empty();
        funboxEl.append(`<div class="funbox button" funbox='none'>none</div>`);
        Misc.getFunboxList().then((funboxModes) => {
            funboxModes.forEach((funbox) => {
                if (funbox.name === "mirror") {
                    funboxEl.append(`<div class="funbox button" funbox='${funbox.name}' aria-label="${funbox.info}" data-balloon-pos="up" data-balloon-length="fit" type="${funbox.type}" style="transform:scaleX(-1);">${funbox.name.replace(/_/g, " ")}</div>`);
                }
                else {
                    funboxEl.append(`<div class="funbox button" funbox='${funbox.name}' aria-label="${funbox.info}" data-balloon-pos="up" data-balloon-length="fit" type="${funbox.type}">${funbox.name.replace(/_/g, " ")}</div>`);
                }
            });
        });
        let isCustomFont = true;
        const fontsEl = $(".pageSettings .section.fontFamily .buttons").empty();
        Misc.getFontsList().then((fonts) => {
            fonts.forEach((font) => {
                if (config_1.default.fontFamily === font.name)
                    isCustomFont = false;
                fontsEl.append(`<div class="button${config_1.default.fontFamily === font.name ? " active" : ""}" style="font-family:${font.display !== undefined ? font.display : font.name}" fontFamily="${font.name.replace(/ /g, "_")}" tabindex="0"
        onclick="this.blur();">${font.display !== undefined ? font.display : font.name}</div>`);
            });
            fontsEl.append(isCustomFont
                ? `<div class="button no-auto-handle custom active" onclick="this.blur();">Custom (${config_1.default.fontFamily.replace(/_/g, " ")})</div>`
                : '<div class="button no-auto-handle custom" onclick="this.blur();">Custom</div>');
        });
        $(".pageSettings .section.customBackgroundSize input").val(config_1.default.customBackground);
        $(".pageSettings .section.customLayoutfluid input").val(config_1.default.customLayoutfluid.replace(/#/g, " "));
        setEventDisabled(true);
        if (!groupsInitialized) {
            yield initGroups();
            groupsInitialized = true;
        }
        else {
            Object.keys(exports.groups).forEach((groupKey) => {
                exports.groups[groupKey].updateInput();
            });
        }
        setEventDisabled(false);
        yield ThemePicker.refreshButtons();
        yield UpdateConfig.loadPromise;
    });
}
exports.fillSettingsPage = fillSettingsPage;
// export let settingsFillPromise = fillSettingsPage();
function hideAccountSection() {
    $(`.sectionGroupTitle[group='account']`).addClass("hidden");
    $(`.settingsGroup.account`).addClass("hidden");
    $(`.pageSettings .section.needsAccount`).addClass("hidden");
}
exports.hideAccountSection = hideAccountSection;
function updateDiscordSection() {
    //no code and no discord
    if (firebase_1.Auth.currentUser == null) {
        $(".pageSettings .section.discordIntegration").addClass("hidden");
    }
    else {
        if (DB.getSnapshot() == null)
            return;
        $(".pageSettings .section.discordIntegration").removeClass("hidden");
        if (DB.getSnapshot().discordId == undefined) {
            //show button
            $(".pageSettings .section.discordIntegration .buttons").removeClass("hidden");
            $(".pageSettings .section.discordIntegration .info").addClass("hidden");
        }
        else {
            $(".pageSettings .section.discordIntegration .buttons").addClass("hidden");
            $(".pageSettings .section.discordIntegration .info").removeClass("hidden");
        }
    }
}
exports.updateDiscordSection = updateDiscordSection;
function updateAuthSections() {
    $(".pageSettings .section.passwordAuthSettings .button").addClass("hidden");
    $(".pageSettings .section.googleAuthSettings .button").addClass("hidden");
    const user = firebase_1.Auth.currentUser;
    if (!user)
        return;
    const passwordProvider = user.providerData.find((provider) => provider.providerId === "password");
    const googleProvider = user.providerData.find((provider) => provider.providerId === "google.com");
    if (passwordProvider) {
        $(".pageSettings .section.passwordAuthSettings #emailPasswordAuth").removeClass("hidden");
        $(".pageSettings .section.passwordAuthSettings #passPasswordAuth").removeClass("hidden");
    }
    else {
        $(".pageSettings .section.passwordAuthSettings #addPasswordAuth").removeClass("hidden");
    }
    if (googleProvider) {
        $(".pageSettings .section.googleAuthSettings #removeGoogleAuth").removeClass("hidden");
        if (passwordProvider) {
            $(".pageSettings .section.googleAuthSettings #removeGoogleAuth").removeClass("disabled");
        }
        else {
            $(".pageSettings .section.googleAuthSettings #removeGoogleAuth").addClass("disabled");
        }
    }
    else {
        $(".pageSettings .section.googleAuthSettings #addGoogleAuth").removeClass("hidden");
    }
}
exports.updateAuthSections = updateAuthSections;
function setActiveFunboxButton() {
    $(`.pageSettings .section.funbox .button`).removeClass("active");
    $(`.pageSettings .section.funbox .button[funbox='${config_1.default.funbox}']`).addClass("active");
}
function refreshTagsSettingsSection() {
    var _a;
    if (firebase_1.Auth.currentUser !== null && DB.getSnapshot() !== null) {
        const tagsEl = $(".pageSettings .section.tags .tagsList").empty();
        (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
            // let tagPbString = "No PB found";
            // if (tag.pb != undefined && tag.pb > 0) {
            //   tagPbString = `PB: ${tag.pb}`;
            // }
            tagsEl.append(`

      <div class="buttons tag" id="${tag._id}">
        <div class="button tagButton ${tag.active ? "active" : ""}" active="${tag.active}">
          <div class="title">${tag.name}</div>
        </div>
        <div class="clearPbButton button">
          <i class="fas fa-crown fa-fw"></i>
        </div>
        <div class="editButton button">
          <i class="fas fa-pen fa-fw"></i>
        </div>
        <div class="removeButton button">
          <i class="fas fa-trash fa-fw"></i>
        </div>
      </div>

      `);
        });
        $(".pageSettings .section.tags").removeClass("hidden");
    }
    else {
        $(".pageSettings .section.tags").addClass("hidden");
    }
}
function refreshPresetsSettingsSection() {
    var _a;
    if (firebase_1.Auth.currentUser !== null && DB.getSnapshot() !== null) {
        const presetsEl = $(".pageSettings .section.presets .presetsList").empty();
        (_a = DB.getSnapshot().presets) === null || _a === void 0 ? void 0 : _a.forEach((preset) => {
            presetsEl.append(`
      <div class="buttons preset" id="${preset._id}">
        <div class="button presetButton">
          <div class="title">${preset.name}</div>
        </div>
        <div class="editButton button">
          <i class="fas fa-pen fa-fw"></i>
        </div>
        <div class="removeButton button">
          <i class="fas fa-trash fa-fw"></i>
        </div>
      </div>
      
      `);
        });
        $(".pageSettings .section.presets").removeClass("hidden");
    }
    else {
        $(".pageSettings .section.presets").addClass("hidden");
    }
}
function showAccountSection() {
    $(`.sectionGroupTitle[group='account']`).removeClass("hidden");
    $(`.settingsGroup.account`).removeClass("hidden");
    $(`.pageSettings .section.needsAccount`).removeClass("hidden");
    refreshTagsSettingsSection();
    refreshPresetsSettingsSection();
    updateDiscordSection();
}
exports.showAccountSection = showAccountSection;
function update() {
    Object.keys(exports.groups).forEach((group) => {
        exports.groups[group].updateInput();
    });
    refreshTagsSettingsSection();
    refreshPresetsSettingsSection();
    // LanguagePicker.setActiveGroup(); Shifted from grouped btns to combo-box
    setActiveFunboxButton();
    ThemePicker.updateActiveTab(true);
    ThemePicker.setCustomInputs(true);
    updateDiscordSection();
    updateAuthSections();
    // ThemePicker.updateActiveButton();
    $(".pageSettings .section.paceCaret input.customPaceCaretSpeed").val(config_1.default.paceCaretCustomSpeed);
    $(".pageSettings .section.minWpm input.customMinWpmSpeed").val(config_1.default.minWpmCustomSpeed);
    $(".pageSettings .section.minAcc input.customMinAcc").val(config_1.default.minAccCustom);
    $(".pageSettings .section.minBurst input.customMinBurst").val(config_1.default.minBurstCustomSpeed);
    if (config_1.default.autoSwitchTheme) {
        $(".pageSettings .section.autoSwitchThemeInputs").removeClass("hidden");
    }
    else {
        $(".pageSettings .section.autoSwitchThemeInputs").addClass("hidden");
    }
    if (config_1.default.customBackground !== "") {
        $(".pageSettings .section.customBackgroundFilter").removeClass("hidden");
    }
    else {
        $(".pageSettings .section.customBackgroundFilter").addClass("hidden");
    }
}
exports.update = update;
function toggleSettingsGroup(groupName) {
    $(`.pageSettings .settingsGroup.${groupName}`)
        .stop(true, true)
        .slideToggle(250)
        .toggleClass("slideup");
    if ($(`.pageSettings .settingsGroup.${groupName}`).hasClass("slideup")) {
        $(`.pageSettings .sectionGroupTitle[group=${groupName}] .fas`)
            .stop(true, true)
            .animate({
            deg: -90,
        }, {
            duration: 250,
            step: function (now) {
                $(this).css({
                    transform: "rotate(" + now + "deg)",
                });
            },
        });
    }
    else {
        $(`.pageSettings .sectionGroupTitle[group=${groupName}] .fas`)
            .stop(true, true)
            .animate({
            deg: 0,
        }, {
            duration: 250,
            step: function (now) {
                $(this).css({
                    transform: "rotate(" + now + "deg)",
                });
            },
        });
    }
}
$(document).on("focusout", ".pageSettings .section.paceCaret input.customPaceCaretSpeed", () => {
    UpdateConfig.setPaceCaretCustomSpeed(parseInt($(".pageSettings .section.paceCaret input.customPaceCaretSpeed").val()));
});
$(document).on("click", ".pageSettings .section.paceCaret .button.save", () => {
    UpdateConfig.setPaceCaretCustomSpeed(parseInt($(".pageSettings .section.paceCaret input.customPaceCaretSpeed").val()));
});
$(document).on("focusout", ".pageSettings .section.minWpm input.customMinWpmSpeed", () => {
    UpdateConfig.setMinWpmCustomSpeed(parseInt($(".pageSettings .section.minWpm input.customMinWpmSpeed").val()));
});
$(document).on("click", ".pageSettings .section.minWpm .button.save", () => {
    UpdateConfig.setMinWpmCustomSpeed(parseInt($(".pageSettings .section.minWpm input.customMinWpmSpeed").val()));
});
$(document).on("focusout", ".pageSettings .section.minAcc input.customMinAcc", () => {
    UpdateConfig.setMinAccCustom(parseInt($(".pageSettings .section.minAcc input.customMinAcc").val()));
});
$(document).on("click", ".pageSettings .section.minAcc .button.save", () => {
    UpdateConfig.setMinAccCustom(parseInt($(".pageSettings .section.minAcc input.customMinAcc").val()));
});
$(document).on("focusout", ".pageSettings .section.minBurst input.customMinBurst", () => {
    UpdateConfig.setMinBurstCustomSpeed(parseInt($(".pageSettings .section.minBurst input.customMinBurst").val()));
});
$(document).on("click", ".pageSettings .section.minBurst .button.save", () => {
    UpdateConfig.setMinBurstCustomSpeed(parseInt($(".pageSettings .section.minBurst input.customMinBurst").val()));
});
// Commented because started using combo-box for choosing languages instead of grouped buttons
// languages
// $(document).on(
//   "click",
//   ".pageSettings .section.languageGroups .button",
//   (e) => {
//     const group = $(e.currentTarget).attr("group");
//     LanguagePicker.setActiveGroup(group, true);
//   }
// );
//funbox
$(document).on("click", ".pageSettings .section.funbox .button", (e) => {
    const funbox = $(e.currentTarget).attr("funbox");
    const type = $(e.currentTarget).attr("type");
    Funbox.setFunbox(funbox, type);
    setActiveFunboxButton();
});
//tags
$(document).on("click", ".pageSettings .section.tags .tagsList .tag .tagButton", (e) => {
    const target = e.currentTarget;
    const tagid = $(target).parent(".tag").attr("id");
    TagController.toggle(tagid);
    $(target).toggleClass("active");
});
$(document).on("click", ".pageSettings .section.presets .presetsList .preset .presetButton", (e) => {
    const target = e.currentTarget;
    const presetid = $(target).parent(".preset").attr("id");
    console.log("Applying Preset");
    configEventDisabled = true;
    PresetController.apply(presetid);
    configEventDisabled = false;
    update();
});
$("#importSettingsButton").on("click", () => {
    ImportExportSettingsPopup.show("import");
});
$("#exportSettingsButton").on("click", () => {
    const configJSON = JSON.stringify(config_1.default);
    navigator.clipboard.writeText(configJSON).then(function () {
        Notifications.add("JSON Copied to clipboard", 0);
    }, function () {
        ImportExportSettingsPopup.show("export");
    });
});
$(".pageSettings .sectionGroupTitle").on("click", (e) => {
    toggleSettingsGroup($(e.currentTarget).attr("group"));
});
$(".pageSettings .section.apeKeys #showApeKeysPopup").on("click", () => {
    ApeKeysPopup.show();
});
$(".pageSettings .section.customBackgroundSize .inputAndButton .save").on("click", () => {
    UpdateConfig.setCustomBackground($(".pageSettings .section.customBackgroundSize .inputAndButton input").val());
});
$(".pageSettings .section.customBackgroundSize .inputAndButton input").keypress((e) => {
    if (e.key === "Enter") {
        UpdateConfig.setCustomBackground($(".pageSettings .section.customBackgroundSize .inputAndButton input").val());
    }
});
$(".pageSettings .section.customLayoutfluid .inputAndButton .save").on("click", () => {
    UpdateConfig.setCustomLayoutfluid($(".pageSettings .section.customLayoutfluid .inputAndButton input").val()).then((bool) => {
        if (bool) {
            Notifications.add("Custom layoutfluid saved", 1);
        }
    });
});
$(".pageSettings .section.customLayoutfluid .inputAndButton .input").keypress((e) => {
    if (e.key === "Enter") {
        UpdateConfig.setCustomLayoutfluid($(".pageSettings .section.customLayoutfluid .inputAndButton input").val()).then((bool) => {
            if (bool) {
                Notifications.add("Custom layoutfluid saved", 1);
            }
        });
    }
});
$(".quickNav .links a").on("click", (e) => {
    const settingsGroup = e.target.innerText;
    const isOpen = $(`.pageSettings .settingsGroup.${settingsGroup}`).hasClass("slideup");
    isOpen && toggleSettingsGroup(settingsGroup);
});
$(document).on("change", `.pageSettings .section.autoSwitchThemeInputs select.light`, (e) => {
    const target = $(e.currentTarget);
    if (target.hasClass("disabled") || target.hasClass("no-auto-handle")) {
        return;
    }
    UpdateConfig.setThemeLight(target.val());
});
$(document).on("change", `.pageSettings .section.autoSwitchThemeInputs select.dark`, (e) => {
    const target = $(e.currentTarget);
    if (target.hasClass("disabled") || target.hasClass("no-auto-handle")) {
        return;
    }
    UpdateConfig.setThemeDark(target.val());
});
let configEventDisabled = false;
function setEventDisabled(value) {
    configEventDisabled = value;
}
exports.setEventDisabled = setEventDisabled;
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "fullConfigChange")
        setEventDisabled(true);
    if (eventKey === "fullConfigChangeFinished") {
        setEventDisabled(false);
    }
    if (configEventDisabled || eventKey === "saveToLocalStorage")
        return;
    if (ActivePage.get() === "settings" && eventKey !== "theme") {
        update();
    }
});
exports.page = new page_1.default("settings", $(".page.pageSettings"), "/settings", () => {
    //
}, () => __awaiter(void 0, void 0, void 0, function* () {
    reset();
}), () => __awaiter(void 0, void 0, void 0, function* () {
    yield fillSettingsPage();
    update();
}), () => {
    //
});


/***/ }),

/***/ "./src/scripts/pages/test.ts":
/*!***********************************!*\
  !*** ./src/scripts/pages/test.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.page = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestStats = __importStar(__webpack_require__(/*! ../test/test-stats */ "./src/scripts/test/test-stats.ts"));
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const TestConfig = __importStar(__webpack_require__(/*! ../test/test-config */ "./src/scripts/test/test-config.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const Funbox = __importStar(__webpack_require__(/*! ../test/funbox */ "./src/scripts/test/funbox.ts"));
const page_1 = __importDefault(__webpack_require__(/*! ./page */ "./src/scripts/pages/page.ts"));
exports.page = new page_1.default("test", $(".page.pageTest"), "/", () => __awaiter(void 0, void 0, void 0, function* () {
    TestLogic.restart();
    Funbox.clear();
    TestConfig.hide();
    $("#wordsInput").focusout();
}), () => __awaiter(void 0, void 0, void 0, function* () {
    //
}), () => {
    TestConfig.show();
    TestStats.resetIncomplete();
    ManualRestart.set();
    TestLogic.restart(undefined, undefined, undefined, undefined, true);
    Funbox.activate(config_1.default.funbox);
}, () => {
    TestUI.focusWords();
});


/***/ }),

/***/ "./src/scripts/popups/ape-keys-popup.ts":
/*!**********************************************!*\
  !*** ./src/scripts/popups/ape-keys-popup.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.hide = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
let apeKeys = {};
function getData() {
    return __awaiter(this, void 0, void 0, function* () {
        Loader.show();
        const response = yield ape_1.default.apeKeys.get();
        Loader.hide();
        if (response.status !== 200) {
            Notifications.add("Error getting ape keys: " + response.message, -1);
            return undefined;
        }
        apeKeys = response.data;
    });
}
function refreshList() {
    const data = apeKeys;
    if (!data)
        return;
    const table = $("#apeKeysPopupWrapper table tbody");
    table.empty();
    const apeKeyIds = Object.keys(data);
    if (apeKeyIds.length === 0) {
        table.append("<tr><td colspan='6' style='text-align: center;'>No keys found</td></tr>");
        return;
    }
    apeKeyIds.forEach((apeKeyId) => {
        const key = data[apeKeyId];
        table.append(`
      <tr keyId="${apeKeyId}">
        <td>
          <div class="icon-button">
            ${key.enabled
            ? `<i class="fas fa-check-square"></i>`
            : `<i class="far fa-fw fa-square"></i>`}
          </div>
        </td>
        <td>${key.name}</td>
        <td>${(0, format_1.default)(new Date(key.createdOn), "dd MMM yyyy HH:mm")}</td>
        <td>${(0, format_1.default)(new Date(key.modifiedOn), "dd MMM yyyy HH:mm")}</td>
        <td>${key.lastUsedOn === -1
            ? "-"
            : (0, format_1.default)(new Date(key.lastUsedOn), "dd MMM yyyy HH:mm")}</td>
        <td>
          <div class="keyButtons">
            <div class="button edit">
              <i class="fas fa-fw fa-pen"></i>
            </div>
            <div class="button delete">
              <i class="fas fa-fw fa-trash-alt"></i>
            </div>
          </div>
        </td>
      </tr>
    `);
    });
}
function hide() {
    if (!$("#apeKeysPopupWrapper").hasClass("hidden")) {
        $("#apeKeysPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#apeKeysPopupWrapper").addClass("hidden");
        });
    }
}
exports.hide = hide;
//show the popup
function show() {
    return __awaiter(this, void 0, void 0, function* () {
        if ($("#apeKeysPopupWrapper").hasClass("hidden")) {
            yield getData();
            refreshList();
            $("#apeKeysPopupWrapper")
                .stop(true, true)
                .css("opacity", 0)
                .removeClass("hidden")
                .animate({
                opacity: 1,
            }, 100, () => {
                $("#apeKeysPopup textarea").trigger("focus").select();
            });
        }
    });
}
exports.show = show;
$("#apeKeysPopupWrapper").on("mousedown", (e) => {
    if ($(e.target).attr("id") === "apeKeysPopupWrapper") {
        hide();
    }
});
$("#apeKeysPopup .generateApeKey").on("click", () => {
    hide();
});
$(document).on("click", "#apeKeysPopup table .keyButtons .button", () => {
    hide();
});
$(document).on("click", "#apeKeysPopup table .icon-button", (e) => __awaiter(void 0, void 0, void 0, function* () {
    const keyId = $(e.target).closest("tr").attr("keyId");
    const key = apeKeys === null || apeKeys === void 0 ? void 0 : apeKeys[keyId];
    if (!key || !apeKeys)
        return;
    Loader.show();
    const response = yield ape_1.default.apeKeys.update(keyId, { enabled: !key.enabled });
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to update key: " + response.message, -1);
    }
    apeKeys[keyId].enabled = !key.enabled;
    refreshList();
    if (key.enabled) {
        Notifications.add("Key active", 1);
    }
    else {
        Notifications.add("Key inactive", 1);
    }
}));


/***/ }),

/***/ "./src/scripts/popups/contact-popup.ts":
/*!*********************************************!*\
  !*** ./src/scripts/popups/contact-popup.ts ***!
  \*********************************************/
/***/ (() => {


$(document.body).on("click", "#contactPopupButton", () => {
    $("#contactPopupWrapper")
        .css("opacity", 0)
        .removeClass("hidden")
        .animate({ opacity: 1 }, 125);
});
$(document.body).on("click", "#contactPopupWrapper", (e) => {
    if ($(e.target).attr("id") === "contactPopupWrapper") {
        $("#contactPopupWrapper")
            .css("opacity", 1)
            .animate({ opacity: 0 }, 125, () => {
            $("#contactPopupWrapper").addClass("hidden");
        });
    }
});


/***/ }),

/***/ "./src/scripts/popups/custom-test-duration-popup.ts":
/*!**********************************************************!*\
  !*** ./src/scripts/popups/custom-test-duration-popup.ts ***!
  \**********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function parseInput(input) {
    const re = /((-\s*)?\d+(\.\d+)?\s*[hms]?)/g;
    const seconds = [...input.toLowerCase().matchAll(re)]
        .map((match) => {
        const part = match[0];
        const duration = parseFloat(part.replace(/\s+/g, ""));
        if (part.includes("h")) {
            return 3600 * duration;
        }
        else if (part.includes("m")) {
            return 60 * duration;
        }
        else {
            return duration;
        }
    })
        .reduce((total, dur) => total + dur, 0);
    return Math.floor(seconds);
}
function format(duration) {
    const hours = Math.floor(duration / 3600);
    const minutes = Math.floor((duration % 3600) / 60);
    const seconds = (duration % 3600) % 60;
    const time = [];
    if (hours > 0) {
        time.push(`${hours} hour${hours === 1 ? "" : "s"}`);
    }
    if (minutes > 0) {
        time.push(`${minutes} minute${minutes === 1 ? "" : "s"}`);
    }
    if (seconds > 0) {
        time.push(`${seconds} second${seconds === 1 ? "" : "s"}`);
    }
    if (time.length === 3) {
        return `${time[0]}, ${time[1]} and ${time[2]}`;
    }
    else if (time.length === 2) {
        return `${time[0]} and ${time[1]}`;
    }
    else {
        return `${time[0]}`;
    }
}
function previewDuration() {
    const input = $("#customTestDurationPopup input").val();
    const duration = parseInput(input);
    let formattedDuration = "";
    if (duration < 0) {
        formattedDuration = "NEGATIVE TIME";
    }
    else if (duration == 0) {
        formattedDuration = "Infinite test";
    }
    else {
        formattedDuration = "Total time: " + format(duration);
    }
    $("#customTestDurationPopup .preview").text(formattedDuration);
}
function show() {
    if ($("#customTestDurationPopupWrapper").hasClass("hidden")) {
        $("#customTestDurationPopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#customTestDurationPopup input").trigger("focus").select();
        });
    }
    previewDuration();
}
exports.show = show;
function hide() {
    if (!$("#customTestDurationPopupWrapper").hasClass("hidden")) {
        $("#customTestDurationPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#customTestDurationPopupWrapper").addClass("hidden");
        });
    }
}
exports.hide = hide;
function apply() {
    const val = parseInput($("#customTestDurationPopup input").val());
    if (val !== null && !isNaN(val) && val >= 0) {
        UpdateConfig.setTimeConfig(val);
        ManualRestart.set();
        TestLogic.restart();
        if (val >= 1800) {
            Notifications.add("Stay safe and take breaks!", 0);
        }
        else if (val == 0) {
            Notifications.add("Infinite time! Make sure to use Bail Out from the command line to save your result.", 0, 7);
        }
    }
    else {
        Notifications.add("Custom time must be at least 1", 0);
    }
    hide();
}
$("#customTestDurationPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "customTestDurationPopupWrapper") {
        hide();
    }
});
$("#customTestDurationPopup input").keyup((e) => {
    previewDuration();
    if (e.key === "Enter") {
        apply();
    }
});
$("#customTestDurationPopup .button").on("click", () => {
    apply();
});
$(document).on("click", "#top .config .time .text-button", (e) => {
    const mode = $(e.currentTarget).attr("timeConfig");
    if (mode == "custom") {
        show();
    }
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" &&
        !$("#customTestDurationPopupWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/popups/custom-text-popup.ts":
/*!*************************************************!*\
  !*** ./src/scripts/popups/custom-text-popup.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.isVisible = exports.hide = exports.show = void 0;
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const ChallengeController = __importStar(__webpack_require__(/*! ../controllers/challenge-controller */ "./src/scripts/controllers/challenge-controller.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const WordFilterPopup = __importStar(__webpack_require__(/*! ./word-filter-popup */ "./src/scripts/popups/word-filter-popup.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const SavedTextsPopup = __importStar(__webpack_require__(/*! ./saved-texts-popup */ "./src/scripts/popups/saved-texts-popup.ts"));
const wrapper = "#customTextPopupWrapper";
const popup = "#customTextPopup";
function show() {
    if ($(wrapper).hasClass("hidden")) {
        if ($(`${popup} .checkbox input`).prop("checked")) {
            $(`${popup} .inputs .randomInputFields`).removeClass("hidden");
        }
        else {
            $(`${popup} .inputs .randomInputFields`).addClass("hidden");
        }
        $(wrapper)
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            let newtext = CustomText.text.join(CustomText.delimiter);
            newtext = newtext.replace(/\n /g, "\n");
            $(`${popup} textarea`).val(newtext);
            $(`${popup} .wordcount input`).val(CustomText.word === -1 ? "" : CustomText.word);
            $(`${popup} .time input`).val(CustomText.time === -1 ? "" : CustomText.time);
            $(`${popup} textarea`).trigger("focus");
        });
    }
    setTimeout(() => {
        $(`${popup} textarea`).trigger("focus");
    }, 150);
}
exports.show = show;
$(`${popup} .delimiterCheck input`).change(() => {
    let delimiter;
    if ($(`${popup} .delimiterCheck input`).prop("checked")) {
        delimiter = "|";
    }
    else {
        delimiter = " ";
    }
    if ($(`${popup} textarea`).val() != CustomText.text.join(CustomText.delimiter)) {
        const currentText = $(`${popup} textarea`).val();
        const currentTextSplit = currentText.split(CustomText.delimiter);
        let newtext = currentTextSplit.join(delimiter);
        newtext = newtext.replace(/\n /g, "\n");
        $(`${popup} textarea`).val(newtext);
    }
    else {
        let newtext = CustomText.text.join(delimiter);
        newtext = newtext.replace(/\n /g, "\n");
        $(`${popup} textarea`).val(newtext);
    }
    CustomText.setDelimiter(delimiter);
});
function hide() {
    if (!$(wrapper).hasClass("hidden")) {
        $(wrapper)
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $(wrapper).addClass("hidden");
        });
    }
}
exports.hide = hide;
function isVisible() {
    return !$(wrapper).hasClass("hidden");
}
exports.isVisible = isVisible;
$(wrapper).mousedown((e) => {
    if ($(e.target).attr("id") === "customTextPopupWrapper") {
        hide();
    }
});
$(`${popup} .inputs .checkbox input`).change(() => {
    if ($(`${popup} .checkbox input`).prop("checked")) {
        $(`${popup} .inputs .randomInputFields`).removeClass("hidden");
    }
    else {
        $(`${popup} .inputs .randomInputFields`).addClass("hidden");
    }
});
$(`${popup} textarea`).on("keypress", (e) => {
    if (e.code === "Enter" && e.ctrlKey) {
        $(`${popup} .button.apply`).click();
    }
});
$(`${popup} .randomInputFields .wordcount input`).on("keypress", () => {
    $(`${popup} .randomInputFields .time input`).val("");
});
$(`${popup} .randomInputFields .time input`).on("keypress", () => {
    $(`${popup} .randomInputFields .wordcount input`).val("");
});
$(`${popup} .buttonsTop .showSavedTexts`).on("click", () => {
    SavedTextsPopup.show();
});
$(`${popup} .buttonsTop .saveCustomText`).on("click", () => {
    hide();
});
function apply() {
    let text = $(`${popup} textarea`).val().normalize();
    text = text.trim();
    // text = text.replace(/[\r]/gm, " ");
    text = text.replace(/\\\\t/gm, "\t");
    text = text.replace(/\\\\n/gm, "\n");
    text = text.replace(/\\t/gm, "\t");
    text = text.replace(/\\n/gm, "\n");
    text = text.replace(/ +/gm, " ");
    // text = text.replace(/(\r\n)+/g, "\r\n");
    // text = text.replace(/(\n)+/g, "\n");
    // text = text.replace(/(\r)+/g, "\r");
    text = text.replace(/( *(\r\n|\r|\n) *)/g, "\n ");
    if ($(`${popup} .typographyCheck input`).prop("checked")) {
        text = Misc.cleanTypographySymbols(text);
    }
    // text = Misc.remove_non_ascii(text);
    text = text.replace(/[\u2060]/g, "");
    CustomText.setText(text.split(CustomText.delimiter));
    CustomText.setWord(parseInt($(`${popup} .wordcount input`).val()) || -1);
    CustomText.setTime(parseInt($(`${popup} .time input`).val()) || -1);
    CustomText.setIsWordRandom($(`${popup} .checkbox input`).prop("checked") && CustomText.word > -1);
    CustomText.setIsTimeRandom($(`${popup} .checkbox input`).prop("checked") && CustomText.time > -1);
    if ($(`${popup} .checkbox input`).prop("checked") &&
        !CustomText.isTimeRandom &&
        !CustomText.isWordRandom) {
        Notifications.add("You need to specify word count or time in seconds to start a random custom test.", 0, 5);
        return;
    }
    if ($(`${popup} .checkbox input`).prop("checked") &&
        CustomText.isTimeRandom &&
        CustomText.isWordRandom) {
        Notifications.add("You need to pick between word count or time in seconds to start a random custom test.", 0, 5);
        return;
    }
    if ((CustomText.isWordRandom && CustomText.word === 0) ||
        (CustomText.isTimeRandom && CustomText.time === 0)) {
        Notifications.add("Infinite words! Make sure to use Bail Out from the command line to save your result.", 0, 7);
    }
    ChallengeController.clearActive();
    ManualRestart.set();
    if (config_1.default.mode !== "custom")
        UpdateConfig.setMode("custom");
    TestLogic.restart();
    hide();
}
$(document).on("click", `${popup} .button.apply`, () => {
    apply();
});
$(document).on("click", `${popup} .wordfilter`, () => {
    WordFilterPopup.show();
});
$(document).on("click", "#top .config .customText .text-button", () => {
    show();
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" &&
        !$("#customTextPopupWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/popups/custom-theme-popup.ts":
/*!**************************************************!*\
  !*** ./src/scripts/popups/custom-theme-popup.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, exports) => {


// import Config, * as UpdateConfig from "./config";
// import * as Notifications from "./notifications";
// import * as ThemePicker from "./theme-picker";
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
function show(value) {
    if ($("#customThemeShareWrapper").hasClass("hidden")) {
        // let save = [];
        // $.each(
        //   $(".pageSettings .section.customTheme [type='color']"),
        //   (index, element) => {
        //     save.push($(element).attr("value"));
        //   }
        // );
        // $("#customThemeShareWrapper input").val(JSON.stringify(save));
        $("#customThemeShareWrapper input").val(value);
        $("#customThemeShareWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#customThemeShare input").trigger("focus");
            $("#customThemeShare input").select();
            $("#customThemeShare input").trigger("focus");
        });
    }
}
exports.show = show;
function hide() {
    if (!$("#customThemeShareWrapper").hasClass("hidden")) {
        // try {
        //   UpdateConfig.setCustomThemeColors(
        //     JSON.parse($("#customThemeShareWrapper input").val())
        //   );
        // } catch (e) {
        //   Notifications.add(
        //     "Something went wrong. Reverting to default custom colors.",
        //     0,
        //     4
        //   );
        //   UpdateConfig.setCustomThemeColors(Config.defaultConfig.customThemeColors);
        // }
        // ThemePicker.setCustomInputs();
        $("#customThemeShareWrapper input").val("");
        $("#customThemeShareWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#customThemeShareWrapper").addClass("hidden");
        });
    }
}
$("#customThemeShareWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "customThemeShareWrapper") {
        hide();
    }
});
$("#customThemeShare .button").on("click", () => {
    hide();
});


/***/ }),

/***/ "./src/scripts/popups/custom-word-amount-popup.ts":
/*!********************************************************!*\
  !*** ./src/scripts/popups/custom-word-amount-popup.ts ***!
  \********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function show() {
    if ($("#customWordAmountPopupWrapper").hasClass("hidden")) {
        $("#customWordAmountPopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#customWordAmountPopup input").trigger("focus").select();
        });
    }
}
exports.show = show;
function hide() {
    if (!$("#customWordAmountPopupWrapper").hasClass("hidden")) {
        $("#customWordAmountPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#customWordAmountPopupWrapper").addClass("hidden");
        });
    }
}
exports.hide = hide;
function apply() {
    const val = parseInt($("#customWordAmountPopup input").val());
    if (val !== null && !isNaN(val) && val >= 0) {
        UpdateConfig.setWordCount(val);
        ManualRestart.set();
        TestLogic.restart();
        if (val > 2000) {
            Notifications.add("Stay safe and take breaks!", 0);
        }
        else if (val == 0) {
            Notifications.add("Infinite words! Make sure to use Bail Out from the command line to save your result.", 0, 7);
        }
    }
    else {
        Notifications.add("Custom word amount must be at least 1", 0);
    }
    hide();
}
$("#customWordAmountPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "customWordAmountPopupWrapper") {
        hide();
    }
});
$("#customWordAmountPopup input").on("keypress", (e) => {
    if (e.key === "Enter") {
        apply();
    }
});
$("#customWordAmountPopup .button").on("click", () => {
    apply();
});
$(document).on("click", "#top .config .wordCount .text-button", (e) => {
    const wrd = $(e.currentTarget).attr("wordCount");
    if (wrd == "custom") {
        show();
    }
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" &&
        !$("#customWordAmountPopupWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/popups/edit-preset-popup.ts":
/*!*************************************************!*\
  !*** ./src/scripts/popups/edit-preset-popup.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Config = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function show(action, id, name) {
    if (action === "add") {
        $("#presetWrapper #presetEdit").attr("action", "add");
        $("#presetWrapper #presetEdit .title").html("Create new preset");
        $("#presetWrapper #presetEdit .button").html(`<i class="fas fa-plus"></i>`);
        $("#presetWrapper #presetEdit input.text").val("");
        $("#presetWrapper #presetEdit input.text").removeClass("hidden");
        $("#presetWrapper #presetEdit label").addClass("hidden");
    }
    else if (action === "edit" && id && name) {
        $("#presetWrapper #presetEdit").attr("action", "edit");
        $("#presetWrapper #presetEdit").attr("presetid", id);
        $("#presetWrapper #presetEdit .title").html("Edit preset");
        $("#presetWrapper #presetEdit .button").html(`<i class="fas fa-pen"></i>`);
        $("#presetWrapper #presetEdit input.text").val(name);
        $("#presetWrapper #presetEdit input.text").removeClass("hidden");
        $("#presetWrapper #presetEdit label input").prop("checked", false);
        $("#presetWrapper #presetEdit label").removeClass("hidden");
    }
    else if (action === "remove" && id) {
        $("#presetWrapper #presetEdit").attr("action", "remove");
        $("#presetWrapper #presetEdit").attr("presetid", id);
        $("#presetWrapper #presetEdit .title").html("Remove preset " + name);
        $("#presetWrapper #presetEdit .button").html(`<i class="fas fa-check"></i>`);
        $("#presetWrapper #presetEdit input.text").addClass("hidden");
        $("#presetWrapper #presetEdit label").addClass("hidden");
    }
    if ($("#presetWrapper").hasClass("hidden")) {
        $("#presetWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#presetWrapper #presetEdit input").trigger("focus");
        });
    }
}
exports.show = show;
function hide() {
    if (!$("#presetWrapper").hasClass("hidden")) {
        $("#presetWrapper #presetEdit").attr("action", "");
        $("#presetWrapper #presetEdit").attr("tagid", "");
        $("#presetWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#presetWrapper").addClass("hidden");
        });
    }
}
function apply() {
    return __awaiter(this, void 0, void 0, function* () {
        const action = $("#presetWrapper #presetEdit").attr("action");
        const presetName = $("#presetWrapper #presetEdit input").val();
        const presetId = $("#presetWrapper #presetEdit").attr("presetId");
        const updateConfig = $("#presetWrapper #presetEdit label input").prop("checked");
        let configChanges = {};
        if ((updateConfig && action === "edit") || action === "add") {
            configChanges = Config.getConfigChanges();
            const tags = DB.getSnapshot().tags || [];
            const activeTagIds = tags
                .filter((tag) => tag.active)
                .map((tag) => tag._id);
            configChanges.tags = activeTagIds;
        }
        const snapshotPresets = DB.getSnapshot().presets || [];
        hide();
        Loader.show();
        if (action === "add") {
            const response = yield ape_1.default.presets.add(presetName, configChanges);
            if (response.status !== 200) {
                Notifications.add("Failed to add preset: " + response.message, -1);
            }
            else {
                Notifications.add("Preset added", 1, 2);
                snapshotPresets.push({
                    name: presetName,
                    config: configChanges,
                    _id: response.data.presetId,
                });
            }
        }
        else if (action === "edit") {
            const response = yield ape_1.default.presets.edit(presetId, presetName, configChanges);
            if (response.status !== 200) {
                Notifications.add("Failed to edit preset: " + response.message, -1);
            }
            else {
                Notifications.add("Preset updated", 1);
                const preset = snapshotPresets.filter((preset) => preset._id === presetId)[0];
                preset.name = presetName;
                if (updateConfig) {
                    preset.config = configChanges;
                }
            }
        }
        else if (action === "remove") {
            const response = yield ape_1.default.presets.delete(presetId);
            if (response.status !== 200) {
                Notifications.add("Failed to remove preset: " + response.message, -1);
            }
            else {
                Notifications.add("Preset removed", 1);
                snapshotPresets.forEach((preset, index) => {
                    if (preset._id === presetId) {
                        snapshotPresets.splice(index, 1);
                    }
                });
            }
        }
        Settings.update();
        Loader.hide();
    });
}
$("#presetWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "presetWrapper") {
        hide();
    }
});
$("#presetWrapper #presetEdit .button").on("click", () => {
    apply();
});
$("#presetWrapper #presetEdit input").on("keypress", (e) => {
    if (e.key === "Enter") {
        apply();
    }
});
$(document).on("click", ".pageSettings .section.presets .addPresetButton", () => {
    show("add");
});
$(document).on("click", ".pageSettings .section.presets .editButton", (e) => {
    const presetid = $(e.currentTarget).parent(".preset").attr("id");
    const name = $(e.currentTarget).siblings(".button").children(".title").text();
    show("edit", presetid, name);
});
$(document).on("click", ".pageSettings .section.presets .removeButton", (e) => {
    const presetid = $(e.currentTarget).parent(".preset").attr("id");
    const name = $(e.currentTarget).siblings(".button").children(".title").text();
    show("remove", presetid, name);
});


/***/ }),

/***/ "./src/scripts/popups/edit-tags-popup.ts":
/*!***********************************************!*\
  !*** ./src/scripts/popups/edit-tags-popup.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const ResultFilters = __importStar(__webpack_require__(/*! ../account/result-filters */ "./src/scripts/account/result-filters.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const ResultTagsPopup = __importStar(__webpack_require__(/*! ./result-tags-popup */ "./src/scripts/popups/result-tags-popup.ts"));
function show(action, id, name) {
    if (action === "add") {
        $("#tagsWrapper #tagsEdit").attr("action", "add");
        $("#tagsWrapper #tagsEdit .title").html("Add new tag");
        $("#tagsWrapper #tagsEdit .button").html(`<i class="fas fa-plus"></i>`);
        $("#tagsWrapper #tagsEdit input").val("");
        $("#tagsWrapper #tagsEdit input").removeClass("hidden");
    }
    else if (action === "edit" && id && name) {
        $("#tagsWrapper #tagsEdit").attr("action", "edit");
        $("#tagsWrapper #tagsEdit").attr("tagid", id);
        $("#tagsWrapper #tagsEdit .title").html("Edit tag name");
        $("#tagsWrapper #tagsEdit .button").html(`<i class="fas fa-pen"></i>`);
        $("#tagsWrapper #tagsEdit input").val(name);
        $("#tagsWrapper #tagsEdit input").removeClass("hidden");
    }
    else if (action === "remove" && id && name) {
        $("#tagsWrapper #tagsEdit").attr("action", "remove");
        $("#tagsWrapper #tagsEdit").attr("tagid", id);
        $("#tagsWrapper #tagsEdit .title").html("Remove tag " + name);
        $("#tagsWrapper #tagsEdit .button").html(`<i class="fas fa-check"></i>`);
        $("#tagsWrapper #tagsEdit input").addClass("hidden");
    }
    else if (action === "clearPb" && id && name) {
        $("#tagsWrapper #tagsEdit").attr("action", "clearPb");
        $("#tagsWrapper #tagsEdit").attr("tagid", id);
        $("#tagsWrapper #tagsEdit .title").html("Clear PB for tag " + name);
        $("#tagsWrapper #tagsEdit .button").html(`<i class="fas fa-check"></i>`);
        $("#tagsWrapper #tagsEdit input").addClass("hidden");
    }
    if ($("#tagsWrapper").hasClass("hidden")) {
        $("#tagsWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#tagsWrapper #tagsEdit input").trigger("focus");
        });
    }
}
exports.show = show;
function hide() {
    if (!$("#tagsWrapper").hasClass("hidden")) {
        $("#tagsWrapper #tagsEdit").attr("action", "");
        $("#tagsWrapper #tagsEdit").attr("tagid", "");
        $("#tagsWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#tagsWrapper").addClass("hidden");
        });
    }
}
function apply() {
    var _a, _b, _c, _d;
    return __awaiter(this, void 0, void 0, function* () {
        const action = $("#tagsWrapper #tagsEdit").attr("action");
        const tagName = $("#tagsWrapper #tagsEdit input").val();
        const tagId = $("#tagsWrapper #tagsEdit").attr("tagid");
        hide();
        Loader.show();
        if (action === "add") {
            const response = yield ape_1.default.users.createTag(tagName);
            if (response.status !== 200) {
                Notifications.add("Failed to add tag: " + response.message, -1);
            }
            else {
                Notifications.add("Tag added", 1);
                (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.push({
                    name: response.data.name,
                    _id: response.data._id,
                });
                ResultTagsPopup.updateButtons();
                Settings.update();
                ResultFilters.updateTags();
            }
        }
        else if (action === "edit") {
            const response = yield ape_1.default.users.editTag(tagId, tagName);
            if (response.status !== 200) {
                Notifications.add("Failed to edit tag: " + response.message, -1);
            }
            else {
                Notifications.add("Tag updated", 1);
                (_b = DB.getSnapshot().tags) === null || _b === void 0 ? void 0 : _b.forEach((tag) => {
                    if (tag._id === tagId) {
                        tag.name = tagName;
                    }
                });
                ResultTagsPopup.updateButtons();
                Settings.update();
                ResultFilters.updateTags();
            }
        }
        else if (action === "remove") {
            const response = yield ape_1.default.users.deleteTag(tagId);
            if (response.status !== 200) {
                Notifications.add("Failed to remove tag: " + response.message, -1);
            }
            else {
                Notifications.add("Tag removed", 1);
                (_c = DB.getSnapshot().tags) === null || _c === void 0 ? void 0 : _c.forEach((tag, index) => {
                    var _a;
                    if (tag._id === tagId) {
                        (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.splice(index, 1);
                    }
                });
                ResultTagsPopup.updateButtons();
                Settings.update();
                ResultFilters.updateTags();
            }
        }
        else if (action === "clearPb") {
            const response = yield ape_1.default.users.deleteTagPersonalBest(tagId);
            if (response.status !== 200) {
                Notifications.add("Failed to clear tag pb: " + response.message, -1);
            }
            else {
                Notifications.add("Tag PB cleared", 1);
                (_d = DB.getSnapshot().tags) === null || _d === void 0 ? void 0 : _d.forEach((tag) => {
                    if (tag._id === tagId) {
                        tag.personalBests = {
                            time: {},
                            words: {},
                            custom: { custom: [] },
                            zen: { zen: [] },
                            quote: { custom: [] },
                        };
                    }
                });
                ResultTagsPopup.updateButtons();
                Settings.update();
                ResultFilters.updateTags();
            }
        }
        Loader.hide();
    });
}
$("#tagsWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "tagsWrapper") {
        hide();
    }
});
$("#tagsWrapper #tagsEdit .button").on("click", () => {
    apply();
});
$("#tagsWrapper #tagsEdit input").on("keypress", (e) => {
    if (e.key === "Enter") {
        apply();
    }
});
$(document).on("click", ".pageSettings .section.tags .addTagButton", () => {
    show("add");
});
$(document).on("click", ".pageSettings .section.tags .tagsList .tag .editButton", (e) => {
    const tagid = $(e.currentTarget).parent(".tag").attr("id");
    const name = $(e.currentTarget)
        .siblings(".tagButton")
        .children(".title")
        .text();
    show("edit", tagid, name);
});
$(document).on("click", ".pageSettings .section.tags .tagsList .tag .clearPbButton", (e) => {
    const tagid = $(e.currentTarget).parent(".tag").attr("id");
    const name = $(e.currentTarget)
        .siblings(".tagButton")
        .children(".title")
        .text();
    show("clearPb", tagid, name);
});
$(document).on("click", ".pageSettings .section.tags .tagsList .tag .removeButton", (e) => {
    const tagid = $(e.currentTarget).parent(".tag").attr("id");
    const name = $(e.currentTarget)
        .siblings(".tagButton")
        .children(".title")
        .text();
    show("remove", tagid, name);
});


/***/ }),

/***/ "./src/scripts/popups/import-export-settings-popup.ts":
/*!************************************************************!*\
  !*** ./src/scripts/popups/import-export-settings-popup.ts ***!
  \************************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function show(mode, config) {
    if ($("#settingsImportWrapper").hasClass("hidden")) {
        $("#settingsImportWrapper").attr("mode", mode);
        if (mode === "export") {
            $("#settingsImportWrapper .button").addClass("hidden");
            $("#settingsImportWrapper input").val(config !== null && config !== void 0 ? config : "");
        }
        else if (mode === "import") {
            $("#settingsImportWrapper .button").removeClass("hidden");
        }
        $("#settingsImportWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            $("#settingsImportWrapper input").trigger("focus");
            $("#settingsImportWrapper input").select();
            $("#settingsImportWrapper input").trigger("focus");
        });
    }
}
exports.show = show;
function hide() {
    if (!$("#settingsImportWrapper").hasClass("hidden")) {
        if ($("#settingsImportWrapper input").val() !== "") {
            try {
                UpdateConfig.apply(JSON.parse($("#settingsImportWrapper input").val()));
            }
            catch (e) {
                Notifications.add("An error occured while importing settings: " + e, -1);
            }
            UpdateConfig.saveFullConfigToLocalStorage();
        }
        $("#settingsImportWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({ opacity: 0 }, 100, () => {
            $("#settingsImportWrapper").addClass("hidden");
        });
    }
}
$("#settingsImport .button").on("click", () => {
    hide();
});
$("#settingsImportWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "settingsImportWrapper") {
        hide();
    }
});


/***/ }),

/***/ "./src/scripts/popups/mobile-test-config-popup.ts":
/*!********************************************************!*\
  !*** ./src/scripts/popups/mobile-test-config-popup.ts ***!
  \********************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = void 0;
const TestLogic = __importStar(__webpack_require__(/*! ../test/test-logic */ "./src/scripts/test/test-logic.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const CustomWordAmountPopup = __importStar(__webpack_require__(/*! ./custom-word-amount-popup */ "./src/scripts/popups/custom-word-amount-popup.ts"));
const CustomTestDurationPopup = __importStar(__webpack_require__(/*! ./custom-test-duration-popup */ "./src/scripts/popups/custom-test-duration-popup.ts"));
const QuoteSearchPopup = __importStar(__webpack_require__(/*! ./quote-search-popup */ "./src/scripts/popups/quote-search-popup.ts"));
const CustomTextPopup = __importStar(__webpack_require__(/*! ./custom-text-popup */ "./src/scripts/popups/custom-text-popup.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const el = $("#mobileTestConfigPopup");
function update() {
    el.find(".button").removeClass("active");
    el.find(`.modeGroup .button[mode='${config_1.default.mode}']`).addClass("active");
    el.find(".timeGroup").addClass("hidden");
    el.find(".wordsGroup").addClass("hidden");
    el.find(".quoteGroup").addClass("hidden");
    el.find(".customGroup").addClass("hidden");
    el.find(`.${config_1.default.mode}Group`).removeClass("hidden");
    if (config_1.default.punctuation) {
        el.find(".punctuation").addClass("active");
    }
    else {
        el.find(".punctuation").removeClass("active");
    }
    if (config_1.default.numbers) {
        el.find(".numbers").addClass("active");
    }
    else {
        el.find(".numbers").removeClass("active");
    }
    if (config_1.default.mode === "time") {
        el.find(`.timeGroup .button[time='${config_1.default.time}']`).addClass("active");
        el.find(".punctuation").removeClass("disabled");
        el.find(".numbers").removeClass("disabled");
    }
    else if (config_1.default.mode === "words") {
        el.find(`.wordsGroup .button[words='${config_1.default.words}']`).addClass("active");
        el.find(".punctuation").removeClass("disabled");
        el.find(".numbers").removeClass("disabled");
    }
    else if (config_1.default.mode === "quote") {
        el.find(`.quoteGroup .button[quote='${config_1.default.quoteLength}']`).addClass("active");
        el.find(".punctuation").addClass("disabled");
        el.find(".numbers").addClass("disabled");
    }
    else if (config_1.default.mode === "zen") {
        el.find(".punctuation").addClass("disabled");
        el.find(".numbers").addClass("disabled");
    }
    else if (config_1.default.mode === "custom") {
        el.find(".punctuation").removeClass("disabled");
        el.find(".numbers").removeClass("disabled");
    }
}
exports.update = update;
function showPopup() {
    if ($("#mobileTestConfigPopupWrapper").hasClass("hidden")) {
        update();
        $("#mobileTestConfigPopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100);
    }
}
function hidePopup() {
    if (!$("#mobileTestConfigPopupWrapper").hasClass("hidden")) {
        $("#mobileTestConfigPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#mobileTestConfigPopupWrapper").addClass("hidden");
        });
    }
}
$("#mobileTestConfigPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "mobileTestConfigPopupWrapper") {
        hidePopup();
    }
});
$("#top .mobileConfig").on("click", () => {
    showPopup();
});
el.find(".wordsGroup .button").on("click", (e) => {
    const wrd = $(e.currentTarget).attr("words");
    if (wrd == "custom") {
        hidePopup();
        CustomWordAmountPopup.show();
    }
    else if (wrd !== undefined) {
        const wrdNum = parseInt(wrd);
        UpdateConfig.setWordCount(wrdNum);
        ManualRestart.set();
        TestLogic.restart();
    }
});
el.find(".timeGroup .button").on("click", (e) => {
    const time = $(e.currentTarget).attr("time");
    if (time == "custom") {
        hidePopup();
        CustomTestDurationPopup.show();
    }
    else if (time !== undefined) {
        const timeNum = parseInt(time);
        UpdateConfig.setTimeConfig(timeNum);
        ManualRestart.set();
        TestLogic.restart();
    }
});
el.find(".quoteGroup .button").on("click", (e) => {
    var _a;
    let len = ((_a = $(e.currentTarget).attr("quote")) !== null && _a !== void 0 ? _a : 0);
    if (len == -2) {
        // UpdateConfig.setQuoteLength(-2, false, e.shiftKey);
        hidePopup();
        QuoteSearchPopup.show();
    }
    else {
        if (len == -1) {
            len = [0, 1, 2, 3];
        }
        UpdateConfig.setQuoteLength(len, false, e.shiftKey);
        ManualRestart.set();
        TestLogic.restart();
    }
});
el.find(".customChange").on("click", () => {
    hidePopup();
    CustomTextPopup.show();
});
el.find(".punctuation").on("click", () => {
    UpdateConfig.setPunctuation(!config_1.default.punctuation);
    ManualRestart.set();
    TestLogic.restart();
});
el.find(".numbers").on("click", () => {
    UpdateConfig.setNumbers(!config_1.default.numbers);
    ManualRestart.set();
    TestLogic.restart();
});
el.find(".modeGroup .button").on("click", (e) => {
    if ($(e.currentTarget).hasClass("active"))
        return;
    const mode = $(e.currentTarget).attr("mode");
    UpdateConfig.setMode(mode);
    ManualRestart.set();
    TestLogic.restart();
});
$("#mobileTestConfigPopup .button").on("click", () => {
    // hidePopup();
    update();
});
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "mode")
        update();
});


/***/ }),

/***/ "./src/scripts/popups/pb-tables-popup.ts":
/*!***********************************************!*\
  !*** ./src/scripts/popups/pb-tables-popup.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
function update(mode) {
    $("#pbTablesPopup table tbody").empty();
    $($("#pbTablesPopup table thead tr td")[0]).text(mode);
    const snapshot = DB.getSnapshot();
    const allmode2 = (snapshot.personalBests === undefined
        ? undefined
        : snapshot.personalBests[mode]);
    if (allmode2 === undefined)
        return;
    const list = [];
    Object.keys(allmode2).forEach(function (key) {
        let pbs = allmode2[key];
        pbs = pbs.sort(function (a, b) {
            return b.wpm - a.wpm;
            // if (a.difficulty === b.difficulty) {
            //   return (a.language < b.language ? -1 : 1);
            // }
            // return (a.difficulty < b.difficulty ? -1 : 1)
        });
        pbs.forEach(function (pb) {
            pb.mode2 = key;
            list.push(pb);
        });
    });
    let mode2memory;
    list.forEach((pb) => {
        let dateText = `-<br><span class="sub">-</span>`;
        const date = new Date(pb.timestamp);
        if (pb.timestamp) {
            dateText =
                (0, format_1.default)(date, "dd MMM yyyy") +
                    "<br><div class='sub'>" +
                    (0, format_1.default)(date, "HH:mm") +
                    "</div>";
        }
        $("#pbTablesPopup table tbody").append(`
      <tr>
        <td>${mode2memory === pb.mode2 ? "" : pb.mode2}</td>
        <td>
          ${pb.wpm}
          <br />
          <span class="sub">${pb.acc ? pb.acc + "%" : "-"}</span>
        </td>
        <td>
          ${pb.raw ? pb.raw : "-"}
          <br />
          <span class="sub">${pb.consistency ? pb.consistency + "%" : "-"}</span>
        </td>
        <td>${pb.difficulty}</td>
        <td>${pb.language ? pb.language.replace(/_/g, " ") : "-"}</td>
        <td>${pb.punctuation ? '<i class="fas fa-check"></i>' : ""}</td>
        <td>${pb.lazyMode ? '<i class="fas fa-check"></i>' : ""}</td>
        <td>${dateText}</td>
      </tr>
    `);
        mode2memory = pb.mode2;
    });
}
function show(mode) {
    if ($("#pbTablesPopupWrapper").hasClass("hidden")) {
        update(mode);
        $("#pbTablesPopup .title").text(`All ${mode} personal bests`);
        $("#pbTablesPopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100);
    }
}
function hide() {
    if (!$("#pbTablesPopupWrapper").hasClass("hidden")) {
        $("#pbTablesPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#pbTablesPopupWrapper").addClass("hidden");
            $("#pbTablesPopup table tbody").empty();
        });
    }
}
$("#pbTablesPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "pbTablesPopupWrapper") {
        hide();
    }
});
$(".pageAccount .button.showAllTimePbs").on("click", () => {
    show("time");
});
$(".pageAccount .button.showAllWordsPbs").on("click", () => {
    show("words");
});


/***/ }),

/***/ "./src/scripts/popups/quote-approve-popup.ts":
/*!***************************************************!*\
  !*** ./src/scripts/popups/quote-approve-popup.ts ***!
  \***************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
let quotes = [];
function updateList() {
    $("#quoteApprovePopupWrapper .quotes").empty();
    quotes.forEach((quote, index) => {
        const quoteEl = $(`
      <div class="quote" id="${index}" dbid="${quote._id}">
        <textarea class="text">${quote.text}</textarea>
        <input type="text" class="source" placeholder="Source" value="${quote.source}">
        <div class="buttons">
          <div class="icon-button disabled undo" aria-label="Undo changes" data-balloon-pos="left"><i class="fas fa-fw fa-undo-alt"></i></div>
          <div class="icon-button refuse" aria-label="Refuse quote" data-balloon-pos="left"><i class="fas fa-fw fa-times"></i></div>
          <div class="icon-button approve" aria-label="Approve quote" data-balloon-pos="left"><i class="fas fa-fw fa-check"></i></div>
          <div class="icon-button edit hidden" aria-label="Edit and approve quote" data-balloon-pos="left"><i class="fas fa-fw fa-pen"></i></div>
        </div>
        <div class="bottom">
          <div class="length ${quote.text.length < 60 ? "red" : ""}">Quote length: ${quote.text.length}</div>
          <div class="language">Language: ${quote.language}</div>
          <div class="timestamp">Submitted on: ${(0, format_1.default)(new Date(quote.timestamp), "dd MMM yyyy HH:mm")}</div>
        </div>
      </div>
    `);
        $("#quoteApprovePopupWrapper .quotes").append(quoteEl);
    });
}
function updateQuoteLength(index) {
    var _a;
    const len = (_a = $(`#quoteApprovePopup .quote[id=${index}] .text`).val()) === null || _a === void 0 ? void 0 : _a.length;
    $(`#quoteApprovePopup .quote[id=${index}] .length`).text("Quote length: " + len);
    if (len < 60) {
        $(`#quoteApprovePopup .quote[id=${index}] .length`).addClass("red");
    }
    else {
        $(`#quoteApprovePopup .quote[id=${index}] .length`).removeClass("red");
    }
}
function getQuotes() {
    return __awaiter(this, void 0, void 0, function* () {
        Loader.show();
        const response = yield ape_1.default.quotes.get();
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to get new quotes: " + response.message, -1);
        }
        quotes = response.data;
        updateList();
    });
}
function show(noAnim = false) {
    return __awaiter(this, void 0, void 0, function* () {
        if ($("#quoteApprovePopupWrapper").hasClass("hidden")) {
            quotes = [];
            getQuotes();
            $("#quoteApprovePopupWrapper")
                .stop(true, true)
                .css("opacity", 0)
                .removeClass("hidden")
                .animate({ opacity: 1 }, noAnim ? 0 : 100);
        }
    });
}
exports.show = show;
function hide() {
    if (!$("#quoteApprovePopupWrapper").hasClass("hidden")) {
        $("#quoteApprovePopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#quoteApprovePopupWrapper").addClass("hidden");
            $("#quoteApprovePopupWrapper .quotes").empty();
        });
    }
}
exports.hide = hide;
function resetButtons(target) {
    $(target).closest(".quote").find(".icon-button").removeClass("disabled");
    if ($(target).closest(".quote").find(".edit").hasClass("hidden")) {
        $(target).closest(".quote").find(".undo").addClass("disabled");
    }
}
$("#quoteApprovePopupWrapper").on("mousedown", (e) => {
    if ($(e.target).attr("id") === "quoteApprovePopupWrapper") {
        hide();
    }
});
$("#quoteApprovePopupWrapper .button.refreshList").on("click", () => {
    $("#quoteApprovePopupWrapper .quotes").empty();
    getQuotes();
});
$(document).on("click", "#quoteApprovePopup .quote .undo", (e) => __awaiter(void 0, void 0, void 0, function* () {
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    $(`#quoteApprovePopup .quote[id=${index}] .text`).val(quotes[index].text);
    $(`#quoteApprovePopup .quote[id=${index}] .source`).val(quotes[index].source);
    $(`#quoteApprovePopup .quote[id=${index}] .undo`).addClass("disabled");
    $(`#quoteApprovePopup .quote[id=${index}] .approve`).removeClass("hidden");
    $(`#quoteApprovePopup .quote[id=${index}] .edit`).addClass("hidden");
    updateQuoteLength(index);
}));
$(document).on("click", "#quoteApprovePopup .quote .approve", (e) => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    if (!confirm("Are you sure?"))
        return;
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    const dbid = $(e.target).closest(".quote").attr("dbid");
    const target = e.target;
    $(target).closest(".quote").find(".icon-button").addClass("disabled");
    $(target).closest(".quote").find("textarea, input").prop("disabled", true);
    Loader.show();
    const response = yield ape_1.default.quotes.approveSubmission(dbid);
    Loader.hide();
    if (response.status !== 200) {
        resetButtons(target);
        $(target).closest(".quote").find("textarea, input").prop("disabled", false);
        return Notifications.add("Failed to approve quote: " + response.message, -1);
    }
    Notifications.add((_a = "Quote approved. " + response.message) !== null && _a !== void 0 ? _a : "", 1);
    quotes.splice(index, 1);
    updateList();
}));
$(document).on("click", "#quoteApprovePopup .quote .refuse", (e) => __awaiter(void 0, void 0, void 0, function* () {
    if (!confirm("Are you sure?"))
        return;
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    const dbid = $(e.target).closest(".quote").attr("dbid");
    const target = e.target;
    $(target).closest(".quote").find(".icon-button").addClass("disabled");
    $(target).closest(".quote").find("textarea, input").prop("disabled", true);
    Loader.show();
    const response = yield ape_1.default.quotes.rejectSubmission(dbid);
    Loader.hide();
    if (response.status !== 200) {
        resetButtons(target);
        $(target).closest(".quote").find("textarea, input").prop("disabled", false);
        return Notifications.add("Failed to refuse quote: " + response.message, -1);
    }
    Notifications.add("Quote refused.", 1);
    quotes.splice(index, 1);
    updateList();
}));
$(document).on("click", "#quoteApprovePopup .quote .edit", (e) => __awaiter(void 0, void 0, void 0, function* () {
    var _b;
    if (!confirm("Are you sure?"))
        return;
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    const dbid = $(e.target).closest(".quote").attr("dbid");
    const editText = $(`#quoteApprovePopup .quote[id=${index}] .text`).val();
    const editSource = $(`#quoteApprovePopup .quote[id=${index}] .source`).val();
    const target = e.target;
    $(target).closest(".quote").find(".icon-button").addClass("disabled");
    $(target).closest(".quote").find("textarea, input").prop("disabled", true);
    Loader.show();
    const response = yield ape_1.default.quotes.approveSubmission(dbid, editText, editSource);
    Loader.hide();
    if (response.status !== 200) {
        resetButtons(target);
        $(target).closest(".quote").find("textarea, input").prop("disabled", false);
        return Notifications.add("Failed to approve quote: " + response.message, -1);
    }
    Notifications.add((_b = "Quote edited and approved. " + response.message) !== null && _b !== void 0 ? _b : "", 1);
    quotes.splice(index, 1);
    updateList();
}));
$(document).on("input", "#quoteApprovePopup .quote .text", (e) => __awaiter(void 0, void 0, void 0, function* () {
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    $(`#quoteApprovePopup .quote[id=${index}] .undo`).removeClass("disabled");
    $(`#quoteApprovePopup .quote[id=${index}] .approve`).addClass("hidden");
    $(`#quoteApprovePopup .quote[id=${index}] .edit`).removeClass("hidden");
    updateQuoteLength(index);
}));
$(document).on("input", "#quoteApprovePopup .quote .source", (e) => __awaiter(void 0, void 0, void 0, function* () {
    const index = parseInt($(e.target).closest(".quote").attr("id"));
    $(`#quoteApprovePopup .quote[id=${index}] .undo`).removeClass("disabled");
    $(`#quoteApprovePopup .quote[id=${index}] .approve`).addClass("hidden");
    $(`#quoteApprovePopup .quote[id=${index}] .edit`).removeClass("hidden");
}));


/***/ }),

/***/ "./src/scripts/popups/quote-rate-popup.ts":
/*!************************************************!*\
  !*** ./src/scripts/popups/quote-rate-popup.ts ***!
  \************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.clearQuoteStats = exports.show = exports.getQuoteStats = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const TestWords = __importStar(__webpack_require__(/*! ../test/test-words */ "./src/scripts/test/test-words.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
let rating = 0;
let quoteStats = null;
let currentQuote = null;
function reset() {
    $(`#quoteRatePopup .quote .text`).text("-");
    $(`#quoteRatePopup .quote .source .val`).text("-");
    $(`#quoteRatePopup .quote .id .val`).text("-");
    $(`#quoteRatePopup .quote .length .val`).text("-");
    $("#quoteRatePopup .ratingCount .val").text("-");
    $("#quoteRatePopup .ratingAverage .val").text("-");
}
function getRatingAverage(quoteStats) {
    if (!quoteStats.totalRating || !quoteStats.ratings) {
        return 0;
    }
    return Math.round((quoteStats.totalRating / quoteStats.ratings) * 10) / 10;
}
function getQuoteStats(quote) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!quote) {
            return;
        }
        currentQuote = quote;
        const response = yield ape_1.default.quotes.getRating(currentQuote);
        Loader.hide();
        if (response.status !== 200) {
            Notifications.add("Failed to get quote ratings: " + response.message, -1);
            return;
        }
        if (!response.data) {
            return {};
        }
        quoteStats = response.data;
        if (quoteStats && !quoteStats.average) {
            quoteStats.average = getRatingAverage(quoteStats);
        }
        return quoteStats;
    });
}
exports.getQuoteStats = getQuoteStats;
function refreshStars(force) {
    const limit = force ? force : rating;
    $(`#quoteRatePopup .star`).removeClass("active");
    for (let i = 1; i <= limit; i++) {
        $(`#quoteRatePopup .star[rating=${i}]`).addClass("active");
    }
}
function updateRatingStats() {
    var _a, _b, _c;
    return __awaiter(this, void 0, void 0, function* () {
        if (!quoteStats)
            yield getQuoteStats();
        $("#quoteRatePopup .ratingCount .val").text((_a = quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.ratings) !== null && _a !== void 0 ? _a : "0");
        $("#quoteRatePopup .ratingAverage .val").text((_c = (_b = quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.average) === null || _b === void 0 ? void 0 : _b.toFixed(1)) !== null && _c !== void 0 ? _c : "-");
    });
}
function updateData() {
    if (!currentQuote)
        return;
    let lengthDesc;
    if (currentQuote.group == 0) {
        lengthDesc = "short";
    }
    else if (currentQuote.group == 1) {
        lengthDesc = "medium";
    }
    else if (currentQuote.group == 2) {
        lengthDesc = "long";
    }
    else if (currentQuote.group == 3) {
        lengthDesc = "thicc";
    }
    $(`#quoteRatePopup .quote .text`).text(currentQuote.text);
    $(`#quoteRatePopup .quote .source .val`).text(currentQuote.source);
    $(`#quoteRatePopup .quote .id .val`).text(currentQuote.id);
    $(`#quoteRatePopup .quote .length .val`).text(lengthDesc);
    updateRatingStats();
}
function show(quote, shouldReset = true) {
    var _a, _b;
    if ($("#quoteRatePopupWrapper").hasClass("hidden")) {
        if (shouldReset) {
            reset();
        }
        currentQuote = quote;
        rating = 0;
        const snapshot = DB.getSnapshot();
        const alreadyRated = (_b = (_a = snapshot === null || snapshot === void 0 ? void 0 : snapshot.quoteRatings) === null || _a === void 0 ? void 0 : _a[currentQuote.language]) === null || _b === void 0 ? void 0 : _b[currentQuote.id];
        if (alreadyRated) {
            rating = alreadyRated;
        }
        refreshStars();
        updateData();
        $("#quoteRatePopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 125);
    }
}
exports.show = show;
function hide() {
    if (!$("#quoteRatePopupWrapper").hasClass("hidden")) {
        $("#quoteRatePopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#quoteRatePopupWrapper").addClass("hidden");
        });
    }
}
function clearQuoteStats() {
    quoteStats = null;
}
exports.clearQuoteStats = clearQuoteStats;
function submit() {
    var _a, _b, _c;
    return __awaiter(this, void 0, void 0, function* () {
        if (rating === 0) {
            return Notifications.add("Please select a rating");
        }
        if (!currentQuote) {
            return;
        }
        hide();
        const response = yield ape_1.default.quotes.addRating(currentQuote, rating);
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to submit quote rating: " + response.message, -1);
        }
        const snapshot = DB.getSnapshot();
        const quoteRatings = (_a = snapshot.quoteRatings) !== null && _a !== void 0 ? _a : {};
        if ((_b = quoteRatings === null || quoteRatings === void 0 ? void 0 : quoteRatings[currentQuote.language]) === null || _b === void 0 ? void 0 : _b[currentQuote.id]) {
            const oldRating = quoteRatings[currentQuote.language][currentQuote.id];
            const diff = rating - oldRating;
            quoteRatings[currentQuote.language][currentQuote.id] = rating;
            quoteStats = {
                ratings: quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.ratings,
                totalRating: isNaN(quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.totalRating)
                    ? 0
                    : (quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.totalRating) + diff,
                quoteId: currentQuote.id,
                language: currentQuote.language,
            };
            Notifications.add("Rating updated", 1);
        }
        else {
            if (!quoteRatings[currentQuote.language]) {
                quoteRatings[currentQuote.language] = {};
            }
            quoteRatings[currentQuote.language][currentQuote.id] = rating;
            if ((quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.ratings) && quoteStats.totalRating) {
                quoteStats.ratings++;
                quoteStats.totalRating += rating;
            }
            else {
                quoteStats = {
                    ratings: 1,
                    totalRating: rating,
                    quoteId: currentQuote.id,
                    language: currentQuote.language,
                };
            }
            Notifications.add("Rating submitted", 1);
        }
        snapshot.quoteRatings = quoteRatings;
        DB.setSnapshot(snapshot);
        quoteStats.average = getRatingAverage(quoteStats);
        $(".pageTest #result #rateQuoteButton .rating").text((_c = quoteStats.average) === null || _c === void 0 ? void 0 : _c.toFixed(1));
        $(".pageTest #result #rateQuoteButton .icon").removeClass("far");
        $(".pageTest #result #rateQuoteButton .icon").addClass("fas");
    });
}
$("#quoteRatePopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "quoteRatePopupWrapper") {
        hide();
    }
});
$("#quoteRatePopup .stars .star").hover((e) => {
    const ratingHover = parseInt($(e.currentTarget).attr("rating"));
    refreshStars(ratingHover);
});
$("#quoteRatePopup .stars .star").on("click", (e) => {
    const ratingHover = parseInt($(e.currentTarget).attr("rating"));
    rating = ratingHover;
});
$("#quoteRatePopup .stars .star").mouseout(() => {
    $(`#quoteRatePopup .star`).removeClass("active");
    refreshStars();
});
$("#quoteRatePopup .submitButton").on("click", () => {
    submit();
});
$(".pageTest #rateQuoteButton").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    // TODO remove this when done with TestWords
    show(TestWords.randomQuote);
}));


/***/ }),

/***/ "./src/scripts/popups/quote-report-popup.ts":
/*!**************************************************!*\
  !*** ./src/scripts/popups/quote-report-popup.ts ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestWords = __importStar(__webpack_require__(/*! ../test/test-words */ "./src/scripts/test/test-words.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const quotes_controller_1 = __importDefault(__webpack_require__(/*! ../controllers/quotes-controller */ "./src/scripts/controllers/quotes-controller.ts"));
const CAPTCHA_ID = 1;
const state = {
    previousPopupShowCallback: undefined,
    quoteToReport: undefined,
};
const defaultOptions = {
    quoteId: -1,
    previousPopupShowCallback: () => {
        //
    },
    noAnim: false,
};
function show(options = defaultOptions) {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        if ($("#quoteReportPopupWrapper").hasClass("hidden")) {
            const { quoteId, previousPopupShowCallback, noAnim } = options;
            state.previousPopupShowCallback = previousPopupShowCallback;
            const { quotes } = yield quotes_controller_1.default.getQuotes(config_1.default.language);
            state.quoteToReport = quotes.find((quote) => {
                return quote.id === quoteId;
            });
            $("#quoteReportPopup .quote").text((_a = state.quoteToReport) === null || _a === void 0 ? void 0 : _a.text);
            $("#quoteReportPopup .reason").val("Grammatical error");
            $("#quoteReportPopup .comment").val("");
            $("#quoteReportPopup .characterCount").text("-");
            $("#quoteReportPopup .reason").select2({
                minimumResultsForSearch: Infinity,
            });
            $("#quoteReportPopupWrapper")
                .stop(true, true)
                .css("opacity", 0)
                .removeClass("hidden")
                .animate({ opacity: 1 }, noAnim ? 0 : 100, () => {
                $("#quoteReportPopup textarea").trigger("focus").select();
            });
        }
    });
}
exports.show = show;
function hide() {
    return __awaiter(this, void 0, void 0, function* () {
        if (!$("#quoteReportPopupWrapper").hasClass("hidden")) {
            const noAnim = state.previousPopupShowCallback ? true : false;
            $("#quoteReportPopupWrapper")
                .stop(true, true)
                .css("opacity", 1)
                .animate({
                opacity: 0,
            }, noAnim ? 0 : 100, () => {
                grecaptcha.reset(CAPTCHA_ID);
                $("#quoteReportPopupWrapper").addClass("hidden");
                if (state.previousPopupShowCallback) {
                    state.previousPopupShowCallback();
                }
            });
        }
    });
}
exports.hide = hide;
function submitReport() {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        const captchaResponse = grecaptcha.getResponse(CAPTCHA_ID);
        if (!captchaResponse) {
            return Notifications.add("Please complete the captcha.");
        }
        const quoteId = (_a = state.quoteToReport) === null || _a === void 0 ? void 0 : _a.id.toString();
        const quoteLanguage = config_1.default.language;
        const reason = $("#quoteReportPopup .reason").val();
        const comment = $("#quoteReportPopup .comment").val();
        const captcha = captchaResponse;
        if (!quoteId) {
            return Notifications.add("Please select a quote.");
        }
        if (!reason) {
            return Notifications.add("Please select a valid report reason.");
        }
        const characterDifference = comment.length - 250;
        if (characterDifference > 0) {
            return Notifications.add(`Report comment is ${characterDifference} character(s) too long.`);
        }
        Loader.show();
        const response = yield ape_1.default.quotes.report(quoteId, quoteLanguage, reason, comment, captcha);
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to report quote: " + response.message, -1);
        }
        Notifications.add("Report submitted. Thank you!", 1);
        hide();
    });
}
$("#quoteReportPopupWrapper").on("mousedown", (e) => {
    if ($(e.target).attr("id") === "quoteReportPopupWrapper") {
        hide();
    }
});
$("#quoteReportPopup .comment").on("input", () => {
    setTimeout(() => {
        const len = $("#quoteReportPopup .comment").val().length;
        $("#quoteReportPopup .characterCount").text(len);
        if (len > 250) {
            $("#quoteReportPopup .characterCount").addClass("red");
        }
        else {
            $("#quoteReportPopup .characterCount").removeClass("red");
        }
    }, 1);
});
$("#quoteReportPopup .submit").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    yield submitReport();
}));
$(".pageTest #reportQuoteButton").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    show({
        quoteId: (_a = TestWords.randomQuote) === null || _a === void 0 ? void 0 : _a.id,
        noAnim: false,
    });
}));


/***/ }),

/***/ "./src/scripts/popups/quote-search-popup.ts":
/*!**************************************************!*\
  !*** ./src/scripts/popups/quote-search-popup.ts ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.apply = exports.hide = exports.show = exports.setSelectedId = exports.selectedId = void 0;
const TestUI = __importStar(__webpack_require__(/*! ../test/test-ui */ "./src/scripts/test/test-ui.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ../test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const QuoteSubmitPopup = __importStar(__webpack_require__(/*! ./quote-submit-popup */ "./src/scripts/popups/quote-submit-popup.ts"));
const QuoteApprovePopup = __importStar(__webpack_require__(/*! ./quote-approve-popup */ "./src/scripts/popups/quote-approve-popup.ts"));
const QuoteReportPopup = __importStar(__webpack_require__(/*! ./quote-report-popup */ "./src/scripts/popups/quote-report-popup.ts"));
const search_service_1 = __webpack_require__(/*! ../utils/search-service */ "./src/scripts/utils/search-service.ts");
const debounce_1 = __webpack_require__(/*! ../utils/debounce */ "./src/scripts/utils/debounce.ts");
const strings_1 = __webpack_require__(/*! ../utils/strings */ "./src/scripts/utils/strings.ts");
const quotes_controller_1 = __importDefault(__webpack_require__(/*! ../controllers/quotes-controller */ "./src/scripts/controllers/quotes-controller.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
exports.selectedId = 1;
function setSelectedId(val) {
    exports.selectedId = val;
}
exports.setSelectedId = setSelectedId;
const searchServiceCache = {};
function getSearchService(language, data, textExtractor) {
    if (language in searchServiceCache) {
        return searchServiceCache[language];
    }
    const newSearchService = (0, search_service_1.buildSearchService)(data, textExtractor);
    searchServiceCache[language] = newSearchService;
    return newSearchService;
}
function highlightMatches(text, matchedText) {
    if (matchedText.length === 0) {
        return text;
    }
    const words = (0, strings_1.splitByAndKeep)(text, `.,"/#!$%^&*;:{}=-_\`~() `.split(""));
    const normalizedWords = words.map((word) => {
        const shouldHighlight = matchedText.find((match) => {
            return word.startsWith(match);
        });
        return shouldHighlight ? `<span class="highlight">${word}</span>` : word;
    });
    return normalizedWords.join("");
}
function applyQuoteLengthFilter(quotes) {
    const quoteLengthFilterValue = $("#quoteSearchPopup .quoteLengthFilter").val();
    if (quoteLengthFilterValue.length === 0) {
        return quotes;
    }
    const quoteLengthFilter = quoteLengthFilterValue.map((filterValue) => parseInt(filterValue, 10));
    const filteredQuotes = quotes.filter((quote) => quoteLengthFilter.includes(quote.group));
    return filteredQuotes;
}
function buildQuoteSearchResult(quote, matchedSearchTerms) {
    let lengthDesc;
    if (quote.length < 101) {
        lengthDesc = "short";
    }
    else if (quote.length < 301) {
        lengthDesc = "medium";
    }
    else if (quote.length < 601) {
        lengthDesc = "long";
    }
    else {
        lengthDesc = "thicc";
    }
    const isNotAuthed = !firebase_1.Auth.currentUser;
    return `
  <div class="searchResult" id="${quote.id}">
    <div class="text">
      ${highlightMatches(quote.text, matchedSearchTerms)}
    </div>
    <div class="id">
      <div class="sub">id</div>
      <span class="quote-id">
        ${highlightMatches(quote.id.toString(), matchedSearchTerms)}
      </span>
    </div>
    <div class="length">
      <div class="sub">length</div>
      ${lengthDesc}
    </div>
    <div class="source">
      <div class="sub">source</div>
      ${highlightMatches(quote.source, matchedSearchTerms)}</div>
    <div class="icon-button report ${isNotAuthed && "hidden"}" aria-label="Report quote" data-balloon-pos="left">
      <i class="fas fa-flag report"></i>
    </div>
  </div>
  `;
}
function updateResults(searchText) {
    return __awaiter(this, void 0, void 0, function* () {
        const { quotes } = yield quotes_controller_1.default.getQuotes(config_1.default.language);
        const quoteSearchService = getSearchService(config_1.default.language, quotes, (quote) => {
            return `${quote.text} ${quote.id} ${quote.source}`;
        });
        const { results: matches, matchedQueryTerms } = quoteSearchService.query(searchText);
        const quotesToShow = applyQuoteLengthFilter(searchText === "" ? quotes : matches);
        const resultsList = $("#quoteSearchResults");
        resultsList.empty();
        quotesToShow.slice(0, 100).forEach((quote) => {
            const quoteSearchResult = buildQuoteSearchResult(quote, matchedQueryTerms);
            resultsList.append(quoteSearchResult);
        });
        const resultsExceededText = quotesToShow.length > 100
            ? "<span style='opacity: 0.5'>(only showing 100)</span>"
            : "";
        $("#extraResults").html(`${quotesToShow.length} results ${resultsExceededText}`);
    });
}
function show(clearText = true) {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        if ($("#quoteSearchPopupWrapper").hasClass("hidden")) {
            if (clearText) {
                $("#quoteSearchPopup input").val("");
            }
            const quoteSearchInputValue = $("#quoteSearchPopup input").val();
            if (!firebase_1.Auth.currentUser) {
                $("#quoteSearchPopup #gotoSubmitQuoteButton").addClass("hidden");
            }
            else {
                $("#quoteSearchPopup #gotoSubmitQuoteButton").removeClass("hidden");
            }
            if ((_a = DB.getSnapshot()) === null || _a === void 0 ? void 0 : _a.quoteMod) {
                $("#quoteSearchPopup #goToApproveQuotes").removeClass("hidden");
            }
            else {
                $("#quoteSearchPopup #goToApproveQuotes").addClass("hidden");
            }
            $("#quoteSearchPopup .quoteLengthFilter").select2({
                placeholder: "Filter by length",
                maximumSelectionLength: Infinity,
                multiple: true,
                width: "100%",
                data: [
                    {
                        id: 0,
                        text: "short",
                        selected: false,
                    },
                    {
                        id: 1,
                        text: "medium",
                        selected: false,
                    },
                    {
                        id: 2,
                        text: "long",
                        selected: false,
                    },
                    {
                        id: 3,
                        text: "thicc",
                        selected: false,
                    },
                ],
            });
            $("#quoteSearchPopupWrapper")
                .stop(true, true)
                .css("opacity", 0)
                .removeClass("hidden")
                .animate({ opacity: 1 }, 100, () => {
                if (clearText) {
                    $("#quoteSearchPopup input").trigger("focus").select();
                }
                updateResults(quoteSearchInputValue);
            });
        }
    });
}
exports.show = show;
function hide(noAnim = false, focusWords = true) {
    if (!$("#quoteSearchPopupWrapper").hasClass("hidden")) {
        $("#quoteSearchPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, noAnim ? 0 : 100, () => {
            $("#quoteSearchPopupWrapper").addClass("hidden");
            if (focusWords) {
                TestUI.focusWords();
                $("#quoteSearchPopup .quoteLengthFilter").val([]);
                $("#quoteSearchPopup .quoteLengthFilter").trigger("change");
            }
        });
    }
}
exports.hide = hide;
function apply(val) {
    if (isNaN(val)) {
        val = parseInt(document.getElementById("searchBox").value);
    }
    let ret;
    if (val !== null && !isNaN(val) && val >= 0) {
        UpdateConfig.setQuoteLength(-2, false);
        exports.selectedId = val;
        ManualRestart.set();
        ret = true;
    }
    else {
        Notifications.add("Quote ID must be at least 1", 0);
        ret = false;
    }
    hide();
    return ret;
}
exports.apply = apply;
const searchForQuotes = (0, debounce_1.debounce)(() => {
    const searchText = document.getElementById("searchBox")
        .value;
    updateResults(searchText);
});
$("#quoteSearchPopup .searchBox").on("keyup", (e) => {
    if (e.code === "Escape")
        return;
    searchForQuotes();
});
$("#quoteSearchPopup .quoteLengthFilter").on("change", searchForQuotes);
$("#quoteSearchPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "quoteSearchPopupWrapper") {
        hide();
    }
});
$(document).on("click", "#quoteSearchPopup #gotoSubmitQuoteButton", () => {
    hide(true);
    QuoteSubmitPopup.show(true);
});
$(document).on("click", "#quoteSearchPopup #goToApproveQuotes", () => {
    hide(true);
    QuoteApprovePopup.show(true);
});
$(document).on("click", "#quoteSearchPopup .report", (e) => __awaiter(void 0, void 0, void 0, function* () {
    const quoteId = e.target.closest(".searchResult").id;
    const quoteIdSelectedForReport = parseInt(quoteId);
    hide(true, false);
    QuoteReportPopup.show({
        quoteId: quoteIdSelectedForReport,
        noAnim: true,
        previousPopupShowCallback: () => {
            show(false);
        },
    });
}));
$(document).on("click", "#top .config .quoteLength .text-button", (e) => {
    var _a;
    const len = (_a = $(e.currentTarget).attr("quoteLength")) !== null && _a !== void 0 ? _a : 0;
    if (len == -2) {
        show();
    }
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" &&
        !$("#quoteSearchPopupWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/popups/quote-submit-popup.ts":
/*!**************************************************!*\
  !*** ./src/scripts/popups/quote-submit-popup.ts ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
// import Config from "../config";
// import * as Misc from "../misc";
// let dropdownReady = false;
// async function initDropdown(): Promise<void> {
//   if (dropdownReady) return;
//   const languages = await Misc.getLanguageList();
//   languages.forEach((language) => {
//     if (
//       language === "english_commonly_misspelled" ||
//       language === "hungarian_2.5k"
//     )
//       return;
//     if (!/_\d*k$/g.test(language)) {
//       $("#quoteSubmitPopup #submitQuoteLanguage").append(
//         `<option value="${language}">${language.replace(/_/g, " ")}</option>`
//       );
//     }
//   });
//   $("#quoteSubmitPopup #submitQuoteLanguage").select2();
//   dropdownReady = true;
// }
function submitQuote() {
    return __awaiter(this, void 0, void 0, function* () {
        const text = $("#quoteSubmitPopup #submitQuoteText").val();
        const source = $("#quoteSubmitPopup #submitQuoteSource").val();
        const language = $("#quoteSubmitPopup #submitQuoteLanguage").val();
        const captcha = $("#quoteSubmitPopup #g-recaptcha-response").val();
        if (!text || !source || !language) {
            return Notifications.add("Please fill in all fields", 0);
        }
        Loader.show();
        const response = yield ape_1.default.quotes.submit(text, source, language, captcha);
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to submit quote: " + response.message, -1);
        }
        Notifications.add("Quote submitted.", 1);
        $("#quoteSubmitPopup #submitQuoteText").val("");
        $("#quoteSubmitPopup #submitQuoteSource").val("");
        $("#quoteSubmitPopup .characterCount").removeClass("red");
        $("#quoteSubmitPopup .characterCount").text("-");
        grecaptcha.reset();
    });
}
// @ts-ignore
// eslint-disable-next-line
function show(noAnim = false) {
    return __awaiter(this, void 0, void 0, function* () {
        Notifications.add("Quote submission is disabled temporarily due to a large submission queue.", 0, 5);
        return;
        // if ($("#quoteSubmitPopupWrapper").hasClass("hidden")) {
        //   await initDropdown();
        //   $("#quoteSubmitPopup #submitQuoteLanguage").val(
        //     Config.language.replace(/_\d*k$/g, "")
        //   );
        //   $("#quoteSubmitPopup #submitQuoteLanguage").trigger("change");
        //   $("#quoteSubmitPopup input").val("");
        //   $("#quoteSubmitPopupWrapper")
        //     .stop(true, true)
        //     .css("opacity", 0)
        //     .removeClass("hidden")
        //     .animate({ opacity: 1 }, noAnim ? 0 : 100, () => {
        //       $("#quoteSubmitPopup textarea").trigger("focus").select();
        //     });
        // }
    });
}
exports.show = show;
function hide() {
    if (!$("#quoteSubmitPopupWrapper").hasClass("hidden")) {
        $("#quoteSubmitPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#quoteSubmitPopupWrapper").addClass("hidden");
        });
    }
}
exports.hide = hide;
$("#quoteSubmitPopupWrapper").on("mousedown", (e) => {
    if ($(e.target).attr("id") === "quoteSubmitPopupWrapper") {
        hide();
    }
});
$(document).on("click", "#quoteSubmitPopup #submitQuoteButton", () => {
    submitQuote();
});
$("#quoteSubmitPopup textarea").on("input", () => {
    setTimeout(() => {
        var _a;
        const len = (_a = $("#quoteSubmitPopup textarea").val()) === null || _a === void 0 ? void 0 : _a.length;
        $("#quoteSubmitPopup .characterCount").text(len);
        if (len < 60) {
            $("#quoteSubmitPopup .characterCount").addClass("red");
        }
        else {
            $("#quoteSubmitPopup .characterCount").removeClass("red");
        }
    }, 1);
});
$("#quoteSubmitPopup input").on("keydown", (e) => {
    if (e.key === "Enter") {
        submitQuote();
    }
});


/***/ }),

/***/ "./src/scripts/popups/result-tags-popup.ts":
/*!*************************************************!*\
  !*** ./src/scripts/popups/result-tags-popup.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateButtons = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function show() {
    if ($("#resultEditTagsPanelWrapper").hasClass("hidden")) {
        $("#resultEditTagsPanelWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 125);
    }
}
function hide() {
    if (!$("#resultEditTagsPanelWrapper").hasClass("hidden")) {
        $("#resultEditTagsPanelWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#resultEditTagsPanelWrapper").addClass("hidden");
        });
    }
}
function updateButtons() {
    var _a;
    $("#resultEditTagsPanel .buttons").empty();
    (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
        $("#resultEditTagsPanel .buttons").append(`<div class="button tag" tagid="${tag._id}">${tag.name}</div>`);
    });
}
exports.updateButtons = updateButtons;
function updateActiveButtons(active) {
    if (active === [])
        return;
    $.each($("#resultEditTagsPanel .buttons .button"), (_, obj) => {
        var _a;
        const tagid = (_a = $(obj).attr("tagid")) !== null && _a !== void 0 ? _a : "";
        if (active.includes(tagid)) {
            $(obj).addClass("active");
        }
        else {
            $(obj).removeClass("active");
        }
    });
}
$(document).on("click", ".pageAccount .group.history #resultEditTags", (f) => {
    var _a;
    if (((_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.length) || 0 > 0) {
        const resultid = $(f.target).parents("span").attr("resultid");
        const tags = $(f.target).parents("span").attr("tags");
        $("#resultEditTagsPanel").attr("resultid", resultid);
        $("#resultEditTagsPanel").attr("tags", tags);
        updateActiveButtons(JSON.parse(tags));
        show();
    }
});
$(document).on("click", "#resultEditTagsPanelWrapper .button.tag", (f) => {
    $(f.target).toggleClass("active");
});
$("#resultEditTagsPanelWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "resultEditTagsPanelWrapper") {
        hide();
    }
});
$("#resultEditTagsPanel .confirmButton").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    const resultId = $("#resultEditTagsPanel").attr("resultid");
    // let oldtags = JSON.parse($("#resultEditTagsPanel").attr("tags"));
    const newTags = [];
    $.each($("#resultEditTagsPanel .buttons .button"), (_, obj) => {
        var _a;
        const tagid = (_a = $(obj).attr("tagid")) !== null && _a !== void 0 ? _a : "";
        if ($(obj).hasClass("active")) {
            newTags.push(tagid);
        }
    });
    Loader.show();
    hide();
    const response = yield ape_1.default.results.updateTags(resultId, newTags);
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to update result tags: " + response.message, -1);
    }
    Notifications.add("Tags updated.", 1, 2);
    (_a = DB.getSnapshot().results) === null || _a === void 0 ? void 0 : _a.forEach((result) => {
        if (result._id === resultId) {
            result.tags = newTags;
        }
    });
    let tagNames = "";
    if (newTags.length > 0) {
        newTags.forEach((tag) => {
            var _a;
            (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((snaptag) => {
                if (tag === snaptag._id) {
                    tagNames += snaptag.name + ", ";
                }
            });
        });
        tagNames = tagNames.substring(0, tagNames.length - 2);
    }
    let restags;
    if (newTags === undefined) {
        restags = "[]";
    }
    else {
        restags = JSON.stringify(newTags);
    }
    $(`.pageAccount #resultEditTags[resultid='${resultId}']`).attr("tags", restags);
    if (newTags.length > 0) {
        $(`.pageAccount #resultEditTags[resultid='${resultId}']`).css("opacity", 1);
        $(`.pageAccount #resultEditTags[resultid='${resultId}']`).attr("aria-label", tagNames);
    }
    else {
        $(`.pageAccount #resultEditTags[resultid='${resultId}']`).css("opacity", 0.25);
        $(`.pageAccount #resultEditTags[resultid='${resultId}']`).attr("aria-label", "no tags");
    }
}));


/***/ }),

/***/ "./src/scripts/popups/saved-texts-popup.ts":
/*!*************************************************!*\
  !*** ./src/scripts/popups/saved-texts-popup.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
function show() {
    return __awaiter(this, void 0, void 0, function* () {
        const names = CustomText.getCustomTextNames();
        const listEl = $(`#savedTextsPopup .list`).empty();
        let list = "";
        if (names.length === 0) {
            list += "<div>No saved custom texts found</div>";
        }
        else {
            for (const name of names) {
                list += `<div class="savedText">
      <div class="button name">${name}</div>
      <div class="button delete">
      <i class="fas fa-fw fa-trash"></i>
      </div>
      </div>`;
            }
        }
        listEl.html(list);
        $("#savedTextsPopupWrapper").removeClass("hidden");
        $("#customTextPopupWrapper").addClass("hidden");
    });
}
exports.show = show;
function hide(full = false) {
    $("#savedTextsPopupWrapper").addClass("hidden");
    if (!full)
        $("#customTextPopupWrapper").removeClass("hidden");
}
function applySaved(name) {
    const text = CustomText.getCustomText(name);
    $(`#customTextPopupWrapper textarea`).val(text.join(CustomText.delimiter));
}
$(document).on("click", `#savedTextsPopupWrapper .list .savedText .button.name`, (e) => {
    const name = $(e.target).text();
    applySaved(name);
    hide();
});
$(document).on("click", `#savedTextsPopupWrapper .list .savedText .button.delete`, () => {
    hide(true);
});
$("#savedTextsPopupWrapper").mousedown((e) => {
    if ($(e.target).attr("id") === "savedTextsPopupWrapper") {
        hide();
    }
});


/***/ }),

/***/ "./src/scripts/popups/simple-popups.ts":
/*!*********************************************!*\
  !*** ./src/scripts/popups/simple-popups.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.list = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const AccountController = __importStar(__webpack_require__(/*! ../controllers/account-controller */ "./src/scripts/controllers/account-controller.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const UpdateConfig = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Settings = __importStar(__webpack_require__(/*! ../pages/settings */ "./src/scripts/pages/settings.ts"));
const ApeKeysPopup = __importStar(__webpack_require__(/*! ../popups/ape-keys-popup */ "./src/scripts/popups/ape-keys-popup.ts"));
const ThemePicker = __importStar(__webpack_require__(/*! ../settings/theme-picker */ "./src/scripts/settings/theme-picker.ts"));
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
const CustomTextPopup = __importStar(__webpack_require__(/*! ../popups/custom-text-popup */ "./src/scripts/popups/custom-text-popup.ts"));
const SavedTextsPopup = __importStar(__webpack_require__(/*! ./saved-texts-popup */ "./src/scripts/popups/saved-texts-popup.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
const auth_1 = __webpack_require__(/*! firebase/auth */ "./node_modules/firebase/auth/dist/index.esm.js");
let activePopup = null;
exports.list = {};
class SimplePopup {
    constructor(id, type, title, inputs = [], text = "", buttonText = "Confirm", execFn, beforeInitFn, beforeShowFn) {
        this.parameters = [];
        this.id = id;
        this.type = type;
        this.execFn = (thisPopup, ...vals) => execFn(thisPopup, ...vals);
        this.title = title;
        this.inputs = inputs;
        this.text = text;
        this.wrapper = $("#simplePopupWrapper");
        this.element = $("#simplePopup");
        this.buttonText = buttonText;
        this.beforeInitFn = (thisPopup) => beforeInitFn(thisPopup);
        this.beforeShowFn = (thisPopup) => beforeShowFn(thisPopup);
        this.canClose = true;
    }
    reset() {
        this.element.html(`
    <div class="title"></div>
    <div class="inputs"></div>
    <div class="text"></div>
    <div class="button"></div>`);
    }
    init() {
        const el = this.element;
        el.find("input").val("");
        // if (el.attr("popupId") !== this.id) {
        this.reset();
        el.attr("popupId", this.id);
        el.find(".title").text(this.title);
        el.find(".text").text(this.text);
        this.initInputs();
        if (this.buttonText === "") {
            el.find(".button").remove();
        }
        else {
            el.find(".button").text(this.buttonText);
        }
        if (this.text === "") {
            el.find(".text").addClass("hidden");
        }
        else {
            el.find(".text").removeClass("hidden");
        }
        // }
    }
    initInputs() {
        const el = this.element;
        if (this.inputs.length > 0) {
            if (this.type === "number") {
                this.inputs.forEach((input) => {
                    el.find(".inputs").append(`
            <input
              type="number"
              min="1"
              value="${input.initVal}"
              placeholder="${input.placeholder}"
              class="${input.hidden ? "hidden" : ""}"
              ${input.hidden ? "" : "required"}
              autocomplete="off"
            >
          `);
                });
            }
            else if (this.type === "text") {
                this.inputs.forEach((input) => {
                    if (input.type) {
                        if (input.type === "textarea") {
                            el.find(".inputs").append(`
                <textarea
                  placeholder="${input.placeholder}"
                  class="${input.hidden ? "hidden" : ""}"
                  ${input.hidden ? "" : "required"}
                  ${input.disabled ? "disabled" : ""}
                  autocomplete="off"
                >${input.initVal}</textarea>
              `);
                        }
                        else if (input.type === "checkbox") {
                            el.find(".inputs").append(`
                <label class="checkbox">
                  <input type="checkbox">
                  <div class="customTextCheckbox"></div>
                  ${input.label}
                </label>
              `);
                        }
                        else {
                            el.find(".inputs").append(`
              <input
              type="${input.type}"
              value="${input.initVal}"
              placeholder="${input.placeholder}"
              class="${input.hidden ? "hidden" : ""}"
              ${input.hidden ? "" : "required"}
              ${input.disabled ? "disabled" : ""}
              autocomplete="off"
              >
              `);
                        }
                    }
                    else {
                        el.find(".inputs").append(`
              <input
                type="text"
                value="${input.initVal}"
                placeholder="${input.placeholder}"
                class="${input.hidden ? "hidden" : ""}"
                ${input.hidden ? "" : "required"}
                ${input.disabled ? "disabled" : ""}
                autocomplete="off"
              >
            `);
                    }
                });
            }
            el.find(".inputs").removeClass("hidden");
        }
        else {
            el.find(".inputs").addClass("hidden");
        }
    }
    exec() {
        if (!this.canClose)
            return;
        const vals = [];
        $.each($("#simplePopup input"), (_, el) => {
            if ($(el).is(":checkbox")) {
                vals.push($(el).is(":checked") ? "true" : "false");
            }
            else {
                vals.push($(el).val());
            }
        });
        this.execFn(this, ...vals);
        this.hide();
    }
    show(parameters = []) {
        activePopup = this;
        this.parameters = parameters;
        this.beforeInitFn(this);
        this.init();
        this.beforeShowFn(this);
        this.wrapper
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 125, () => {
            $($("#simplePopup").find("input")[0]).trigger("focus");
        });
    }
    hide() {
        if (!this.canClose)
            return;
        activePopup = null;
        this.wrapper
            .stop(true, true)
            .css("opacity", 1)
            .removeClass("hidden")
            .animate({ opacity: 0 }, 125, () => {
            this.wrapper.addClass("hidden");
        });
    }
}
function hide() {
    if (activePopup)
        return activePopup.hide();
    $("#simplePopupWrapper")
        .stop(true, true)
        .css("opacity", 1)
        .removeClass("hidden")
        .animate({ opacity: 0 }, 125, () => {
        $("#simplePopupWrapper").addClass("hidden");
    });
}
exports.hide = hide;
$("#simplePopupWrapper").mousedown((e) => {
    if ($(e.target).attr("id") === "simplePopupWrapper") {
        if (activePopup)
            return activePopup.hide();
        $("#simplePopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .removeClass("hidden")
            .animate({ opacity: 0 }, 125, () => {
            $("#simplePopupWrapper").addClass("hidden");
        });
    }
});
$(document).on("click", "#simplePopupWrapper .button", () => {
    var _a;
    const id = (_a = $("#simplePopup").attr("popupId")) !== null && _a !== void 0 ? _a : "";
    exports.list[id].exec();
});
$(document).on("keyup", "#simplePopupWrapper input", (e) => {
    var _a;
    if (e.key === "Enter") {
        e.preventDefault();
        const id = (_a = $("#simplePopup").attr("popupId")) !== null && _a !== void 0 ? _a : "";
        exports.list[id].exec();
    }
});
exports.list.updateEmail = new SimplePopup("updateEmail", "text", "Update Email", [
    {
        placeholder: "Password",
        type: "password",
        initVal: "",
    },
    {
        placeholder: "New email",
        initVal: "",
    },
    {
        placeholder: "Confirm new email",
        initVal: "",
    },
], "", "Update", (_thisPopup, password, email, emailConfirm) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (email !== emailConfirm) {
            Notifications.add("Emails don't match", 0);
            return;
        }
        if (user.providerData[0].providerId === "password") {
            const credential = auth_1.EmailAuthProvider.credential(user.email, password);
            yield (0, auth_1.reauthenticateWithCredential)(user, credential);
        }
        Loader.show();
        const response = yield ape_1.default.users.updateEmail(email, user.email);
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to update email: " + response.message, -1);
        }
        Notifications.add("Email updated", 1);
        setTimeout(() => {
            window.location.reload();
        }, 1000);
    }
    catch (e) {
        const typedError = e;
        if (typedError.code === "auth/wrong-password") {
            Notifications.add("Incorrect password", -1);
        }
        else {
            Notifications.add("Something went wrong: " + e, -1);
        }
    }
}), (thisPopup) => {
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    if (!user.providerData.find((p) => (p === null || p === void 0 ? void 0 : p.providerId) === "password")) {
        thisPopup.inputs = [];
        thisPopup.buttonText = "";
        thisPopup.text = "Password authentication is not enabled";
    }
}, (_thisPopup) => {
    //
});
exports.list.updateName = new SimplePopup("updateName", "text", "Update Name", [
    {
        placeholder: "Password",
        type: "password",
        initVal: "",
    },
    {
        placeholder: "New name",
        type: "text",
        initVal: "",
    },
], "", "Update", (_thisPopup, pass, newName) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (user.providerData[0].providerId === "password") {
            const credential = auth_1.EmailAuthProvider.credential(user.email, pass);
            yield (0, auth_1.reauthenticateWithCredential)(user, credential);
        }
        else if (user.providerData[0].providerId === "google.com") {
            yield (0, auth_1.reauthenticateWithPopup)(user, AccountController.gmailProvider);
        }
        Loader.show();
        const checkNameResponse = yield ape_1.default.users.getNameAvailability(newName);
        if (checkNameResponse.status !== 200) {
            Loader.hide();
            return Notifications.add("Failed to check name: " + checkNameResponse.message, -1);
        }
        const updateNameResponse = yield ape_1.default.users.updateName(newName);
        if (updateNameResponse.status !== 200) {
            Loader.hide();
            return Notifications.add("Failed to update name: " + updateNameResponse.message, -1);
        }
        Notifications.add("Name updated", 1);
        DB.getSnapshot().name = newName;
        $("#menu .icon-button.account .text").text(newName);
    }
    catch (e) {
        const typedError = e;
        if (typedError.code === "auth/wrong-password") {
            Notifications.add("Incorrect password", -1);
        }
        else {
            Notifications.add("Something went wrong: " + e, -1);
        }
    }
    Loader.hide();
}), (thisPopup) => {
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    if (user.providerData[0].providerId === "google.com") {
        thisPopup.inputs[0].hidden = true;
        thisPopup.buttonText = "Reauthenticate to update";
    }
}, (_thisPopup) => {
    //
});
exports.list.updatePassword = new SimplePopup("updatePassword", "text", "Update Password", [
    {
        placeholder: "Password",
        type: "password",
        initVal: "",
    },
    {
        placeholder: "New password",
        type: "password",
        initVal: "",
    },
    {
        placeholder: "Confirm new password",
        type: "password",
        initVal: "",
    },
], "", "Update", (_thisPopup, previousPass, newPass, newPassConfirm) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        const credential = auth_1.EmailAuthProvider.credential(user.email, previousPass);
        if (newPass !== newPassConfirm) {
            Notifications.add("New passwords don't match", 0);
            return;
        }
        Loader.show();
        yield (0, auth_1.reauthenticateWithCredential)(user, credential);
        yield (0, auth_1.updatePassword)(user, newPass);
        Loader.hide();
        Notifications.add("Password updated", 1);
        setTimeout(() => {
            window.location.reload();
        }, 1000);
    }
    catch (e) {
        const typedError = e;
        Loader.hide();
        if (typedError.code === "auth/wrong-password") {
            Notifications.add("Incorrect password", -1);
        }
        else {
            Notifications.add("Something went wrong: " + e, -1);
        }
    }
}), (thisPopup) => {
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    if (!user.providerData.find((p) => (p === null || p === void 0 ? void 0 : p.providerId) === "password")) {
        thisPopup.inputs = [];
        thisPopup.buttonText = "";
        thisPopup.text = "Password authentication is not enabled";
    }
}, (_thisPopup) => {
    //
});
exports.list.addPasswordAuth = new SimplePopup("addPasswordAuth", "text", "Add Password Authentication", [
    {
        placeholder: "email",
        type: "email",
        initVal: "",
    },
    {
        placeholder: "confirm email",
        type: "email",
        initVal: "",
    },
    {
        placeholder: "new password",
        type: "password",
        initVal: "",
    },
    {
        placeholder: "confirm new password",
        type: "password",
        initVal: "",
    },
], "", "Add", (_thisPopup, email, emailConfirm, pass, passConfirm) => __awaiter(void 0, void 0, void 0, function* () {
    if (email !== emailConfirm) {
        Notifications.add("Emails don't match", 0);
        return;
    }
    if (pass !== passConfirm) {
        Notifications.add("Passwords don't match", 0);
        return;
    }
    yield AccountController.addPasswordAuth(email, pass);
}), () => {
    //
}, (_thisPopup) => {
    //
});
exports.list.deleteAccount = new SimplePopup("deleteAccount", "text", "Delete Account", [
    {
        placeholder: "Password",
        type: "password",
        initVal: "",
    },
], "This is the last time you can change your mind. After pressing the button everything is gone.", "Delete", (_thisPopup, password) => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    //
    try {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (user.providerData[0].providerId === "password") {
            const credential = auth_1.EmailAuthProvider.credential(user.email, password);
            yield (0, auth_1.reauthenticateWithCredential)(user, credential);
        }
        else if (user.providerData[0].providerId === "google.com") {
            yield (0, auth_1.reauthenticateWithPopup)(user, AccountController.gmailProvider);
        }
        Loader.show();
        Notifications.add("Deleting stats...", 0);
        const usersResponse = yield ape_1.default.users.delete();
        Loader.hide();
        if (usersResponse.status !== 200) {
            return Notifications.add("Failed to delete user stats: " + usersResponse.message, -1);
        }
        Loader.show();
        Notifications.add("Deleting results...", 0);
        const resultsResponse = yield ape_1.default.results.deleteAll();
        Loader.hide();
        if (resultsResponse.status !== 200) {
            return Notifications.add("Failed to delete user results: " + resultsResponse.message, -1);
        }
        Notifications.add("Deleting login information...", 0);
        yield ((_a = firebase_1.Auth.currentUser) === null || _a === void 0 ? void 0 : _a.delete());
        Notifications.add("Goodbye", 1, 5);
        setTimeout(() => {
            location.reload();
        }, 3000);
    }
    catch (e) {
        const typedError = e;
        Loader.hide();
        if (typedError.code === "auth/wrong-password") {
            Notifications.add("Incorrect password", -1);
        }
        else {
            Notifications.add("Something went wrong: " + e, -1);
        }
    }
}), (thisPopup) => {
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    if (user.providerData[0].providerId === "google.com") {
        thisPopup.inputs = [];
        thisPopup.buttonText = "Reauthenticate to delete";
    }
}, (_thisPopup) => {
    //
});
exports.list.clearTagPb = new SimplePopup("clearTagPb", "text", "Clear Tag PB", [], `Are you sure you want to clear this tags PB?`, "Clear", (thisPopup) => __awaiter(void 0, void 0, void 0, function* () {
    var _b;
    const tagId = thisPopup.parameters[0];
    Loader.show();
    const response = yield ape_1.default.users.deleteTagPersonalBest(tagId);
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to delete tag's PB: " + response.message);
    }
    if (response.data.resultCode === 1) {
        const tag = (_b = DB.getSnapshot().tags) === null || _b === void 0 ? void 0 : _b.filter((t) => t._id === tagId)[0];
        if (tag === undefined)
            return;
        tag.personalBests = {
            time: {},
            words: {},
            zen: { zen: [] },
            quote: { custom: [] },
            custom: { custom: [] },
        };
        $(`.pageSettings .section.tags .tagsList .tag[id="${tagId}"] .clearPbButton`).attr("aria-label", "No PB found");
        Notifications.add("Tag PB cleared.", 0);
    }
    else {
        Notifications.add("Something went wrong: " + response.message, -1);
    }
}), (thisPopup) => {
    thisPopup.text = `Are you sure you want to clear PB for tag ${thisPopup.parameters[1]}?`;
}, (_thisPopup) => {
    //
});
exports.list.applyCustomFont = new SimplePopup("applyCustomFont", "text", "Custom font", [{ placeholder: "Font name", initVal: "" }], "Make sure you have the font installed on your computer before applying.", "Apply", (_thisPopup, fontName) => {
    var _a;
    if (fontName === "")
        return;
    (_a = Settings.groups["fontFamily"]) === null || _a === void 0 ? void 0 : _a.setValue(fontName.replace(/\s/g, "_"));
}, () => {
    //
}, (_thisPopup) => {
    //
});
exports.list.resetPersonalBests = new SimplePopup("resetPersonalBests", "text", "Reset Personal Bests", [
    {
        placeholder: "Password",
        type: "password",
        initVal: "",
    },
], "", "Reset", (_thisPopup, password) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const user = firebase_1.Auth.currentUser;
        if (user === null)
            return;
        if (user.providerData[0].providerId === "password") {
            const credential = auth_1.EmailAuthProvider.credential(user.email, password);
            yield (0, auth_1.reauthenticateWithCredential)(user, credential);
        }
        else if (user.providerData[0].providerId === "google.com") {
            yield (0, auth_1.reauthenticateWithPopup)(user, AccountController.gmailProvider);
        }
        Loader.show();
        const response = yield ape_1.default.users.deletePersonalBests();
        Loader.hide();
        if (response.status !== 200) {
            return Notifications.add("Failed to reset personal bests: " + response.message, -1);
        }
        Notifications.add("Personal bests have been reset", 1);
        DB.getSnapshot().personalBests = {
            time: {},
            words: {},
            zen: { zen: [] },
            quote: { custom: [] },
            custom: { custom: [] },
        };
    }
    catch (e) {
        Loader.hide();
        Notifications.add(e, -1);
    }
}), (thisPopup) => {
    const user = firebase_1.Auth.currentUser;
    if (user === null)
        return;
    if (user.providerData[0].providerId === "google.com") {
        thisPopup.inputs = [];
        thisPopup.buttonText = "Reauthenticate to reset";
    }
}, (_thisPopup) => {
    //
});
exports.list.resetSettings = new SimplePopup("resetSettings", "text", "Reset Settings", [], "Are you sure you want to reset all your settings?", "Reset", () => {
    UpdateConfig.reset();
    // setTimeout(() => {
    //   location.reload();
    // }, 1000);
}, () => {
    //
}, (_thisPopup) => {
    //
});
exports.list.unlinkDiscord = new SimplePopup("unlinkDiscord", "text", "Unlink Discord", [], "Are you sure you want to unlink your Discord account?", "Unlink", () => __awaiter(void 0, void 0, void 0, function* () {
    Loader.show();
    const response = yield ape_1.default.users.unlinkDiscord();
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to unlink Discord: " + response.message, -1);
    }
    Notifications.add("Accounts unlinked", 1);
    DB.getSnapshot().discordId = undefined;
    Settings.updateDiscordSection();
}), () => {
    //
}, (_thisPopup) => {
    //
});
exports.list.generateApeKey = new SimplePopup("generateApeKey", "text", "Generate new key", [
    {
        placeholder: "Name",
        initVal: "",
    },
], "", "Generate", (_thisPopup, name) => __awaiter(void 0, void 0, void 0, function* () {
    Loader.show();
    const response = yield ape_1.default.apeKeys.generate(name, false);
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to generate key: " + response.message, -1);
    }
    else {
        const data = response.data;
        exports.list["viewApeKey"].show([data.apeKey]);
    }
}), () => {
    //
}, (_thisPopup) => {
    //
});
exports.list.viewApeKey = new SimplePopup("viewApeKey", "text", "Ape Key", [
    {
        type: "textarea",
        disabled: true,
        placeholder: "Key",
        initVal: "",
    },
], "This is your new Ape Key. Please keep it safe. You will only see it once!", "Close", (_thisPopup) => {
    ApeKeysPopup.show();
}, (_thisPopup) => {
    _thisPopup.inputs[0].initVal = _thisPopup.parameters[0];
}, (_thisPopup) => {
    _thisPopup.canClose = false;
    $("#simplePopup textarea").css("height", "110px");
    $("#simplePopup .button").addClass("hidden");
    setTimeout(() => {
        _thisPopup.canClose = true;
        $("#simplePopup .button").removeClass("hidden");
    }, 3000);
});
exports.list.deleteApeKey = new SimplePopup("deleteApeKey", "text", "Delete Ape Key", [], "Are you sure?", "Delete", (_thisPopup) => __awaiter(void 0, void 0, void 0, function* () {
    Loader.show();
    const response = yield ape_1.default.apeKeys.delete(_thisPopup.parameters[0]);
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to delete key: " + response.message, -1);
    }
    Notifications.add("Key deleted", 1);
    ApeKeysPopup.show();
}), (_thisPopup) => {
    //
}, (_thisPopup) => {
    //
});
exports.list.editApeKey = new SimplePopup("editApeKey", "text", "Edit Ape Key", [
    {
        placeholder: "Name",
        initVal: "",
    },
], "", "Edit", (_thisPopup, input) => __awaiter(void 0, void 0, void 0, function* () {
    Loader.show();
    const response = yield ape_1.default.apeKeys.update(_thisPopup.parameters[0], {
        name: input,
    });
    Loader.hide();
    if (response.status !== 200) {
        return Notifications.add("Failed to update key: " + response.message, -1);
    }
    Notifications.add("Key updated", 1);
    ApeKeysPopup.show();
}), (_thisPopup) => {
    //
}, (_thisPopup) => {
    //
});
exports.list.saveCustomText = new SimplePopup("saveCustomText", "text", "Save custom text", [
    {
        placeholder: "Name",
        initVal: "",
    },
], "", "Save", (_thisPopup, input) => {
    const text = $(`#customTextPopup textarea`).val().normalize();
    CustomText.setCustomText(input, text);
    Notifications.add("Custom text saved", 1);
    CustomTextPopup.show();
}, () => {
    //
}, () => {
    //
});
exports.list.deleteCustomText = new SimplePopup("deleteCustomText", "text", "Delete custom text", [], "Are you sure?", "Delete", (_thisPopup) => {
    CustomText.deleteCustomText(_thisPopup.parameters[0]);
    Notifications.add("Custom text deleted", 1);
    SavedTextsPopup.show();
}, (_thisPopup) => {
    _thisPopup.text = `Are you sure you want to delete custom text ${_thisPopup.parameters[0]}?`;
}, () => {
    //
});
exports.list.updateCustomTheme = new SimplePopup("updateCustomTheme", "text", "Update Custom Theme", [
    {
        type: "text",
        placeholder: "Name",
        initVal: "",
    },
    {
        type: "checkbox",
        initVal: "false",
        label: "Update custom theme to current colors",
    },
], "", "Update", (_thisPopup, name, updateColors) => __awaiter(void 0, void 0, void 0, function* () {
    const snapshot = DB.getSnapshot();
    const customTheme = snapshot.customThemes.find((t) => t._id === _thisPopup.parameters[0]);
    if (customTheme === undefined) {
        Notifications.add("Custom theme does not exist!", -1);
        return;
    }
    let newColors = [];
    if (updateColors === "true") {
        $.each($(".pageSettings .customTheme .customThemeEdit [type='color']"), (_index, element) => {
            newColors.push($(element).attr("value"));
        });
    }
    else {
        newColors = customTheme.colors;
    }
    const newTheme = {
        name: name,
        colors: newColors,
    };
    Loader.show();
    yield DB.editCustomTheme(customTheme._id, newTheme);
    Loader.hide();
    UpdateConfig.setCustomThemeColors(newColors);
    Notifications.add("Custom theme updated", 1);
    ThemePicker.refreshButtons();
}), (_thisPopup) => {
    const snapshot = DB.getSnapshot();
    const customTheme = snapshot.customThemes.find((t) => t._id === _thisPopup.parameters[0]);
    if (!customTheme)
        return;
    _thisPopup.inputs[0].initVal = customTheme.name;
}, (_thisPopup) => {
    //
});
exports.list.deleteCustomTheme = new SimplePopup("deleteCustomTheme", "text", "Delete Custom Theme", [], "Are you sure?", "Delete", (_thisPopup) => __awaiter(void 0, void 0, void 0, function* () {
    Loader.show();
    yield DB.deleteCustomTheme(_thisPopup.parameters[0]);
    Loader.hide();
    Notifications.add("Custom theme deleted", 1);
    ThemePicker.refreshButtons();
}), (_thisPopup) => {
    //
}, (_thisPopup) => {
    //
});
$(".pageSettings .section.discordIntegration #unlinkDiscordButton").on("click", () => {
    exports.list["unlinkDiscord"].show();
});
$("#resetSettingsButton").on("click", () => {
    exports.list["resetSettings"].show();
});
$(".pageSettings #resetPersonalBestsButton").on("click", () => {
    exports.list["resetPersonalBests"].show();
});
$(".pageSettings #updateAccountName").on("click", () => {
    exports.list["updateName"].show();
});
$(".pageSettings #addPasswordAuth").on("click", () => {
    exports.list["addPasswordAuth"].show();
});
$(".pageSettings #emailPasswordAuth").on("click", () => {
    exports.list["updateEmail"].show();
});
$(".pageSettings #passPasswordAuth").on("click", () => {
    exports.list["updatePassword"].show();
});
$(".pageSettings #deleteAccount").on("click", () => {
    exports.list["deleteAccount"].show();
});
$("#apeKeysPopup .generateApeKey").on("click", () => {
    exports.list["generateApeKey"].show();
});
$(`#customTextPopup .buttonsTop .saveCustomText`).on("click", () => {
    exports.list["saveCustomText"].show();
});
$(document).on("click", ".pageSettings .section.themes .customTheme .delButton", (e) => {
    const $parentElement = $(e.currentTarget).parent(".customTheme.button");
    const customThemeId = $parentElement.attr("customThemeId");
    exports.list["deleteCustomTheme"].show([customThemeId]);
});
$(document).on("click", ".pageSettings .section.themes .customTheme .editButton", (e) => {
    const $parentElement = $(e.currentTarget).parent(".customTheme.button");
    const customThemeId = $parentElement.attr("customThemeId");
    exports.list["updateCustomTheme"].show([customThemeId]);
});
$(document).on("click", `#savedTextsPopupWrapper .list .savedText .button.delete`, (e) => {
    const name = $(e.target).siblings(".button.name").text();
    exports.list["deleteCustomText"].show([name]);
});
$(document).on("click", "#apeKeysPopup table tbody tr .button.delete", (e) => {
    const keyId = $(e.target).closest("tr").attr("keyId");
    exports.list["deleteApeKey"].show([keyId]);
});
$(document).on("click", "#apeKeysPopup table tbody tr .button.edit", (e) => {
    const keyId = $(e.target).closest("tr").attr("keyId");
    exports.list["editApeKey"].show([keyId]);
});
$(document).on("click", ".pageSettings .section.fontFamily .button.custom", () => {
    exports.list["applyCustomFont"].show([]);
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" && !$("#simplePopupWrapper").hasClass("hidden")) {
        hide();
        event.preventDefault();
    }
});


/***/ }),

/***/ "./src/scripts/popups/support-popup.ts":
/*!*********************************************!*\
  !*** ./src/scripts/popups/support-popup.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const Commandline = __importStar(__webpack_require__(/*! ../elements/commandline */ "./src/scripts/elements/commandline.ts"));
const CommandlineLists = __importStar(__webpack_require__(/*! ../elements/commandline-lists */ "./src/scripts/elements/commandline-lists.ts"));
$(document.body).on("click", "#supportMeButton", () => {
    $("#supportMeWrapper")
        .css("opacity", 0)
        .removeClass("hidden")
        .animate({ opacity: 1 }, 125);
});
$(document.body).on("click", "#supportMeWrapper", () => {
    $("#supportMeWrapper")
        .css("opacity", 1)
        .animate({ opacity: 0 }, 125, () => {
        $("#supportMeWrapper").addClass("hidden");
    });
});
$(document.body).on("click", "#supportMeWrapper .button.ads", () => {
    CommandlineLists.pushCurrent(CommandlineLists.commandsEnableAds);
    Commandline.show();
    $("#supportMeWrapper")
        .css("opacity", 1)
        .animate({ opacity: 0 }, 125, () => {
        $("#supportMeWrapper").addClass("hidden");
    });
});
$(document.body).on("click", "#supportMeWrapper a.button", () => {
    $("#supportMeWrapper")
        .css("opacity", 1)
        .animate({ opacity: 0 }, 125, () => {
        $("#supportMeWrapper").addClass("hidden");
    });
});


/***/ }),

/***/ "./src/scripts/popups/version-popup.ts":
/*!*********************************************!*\
  !*** ./src/scripts/popups/version-popup.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
function show() {
    $("#versionHistoryWrapper")
        .css("opacity", 0)
        .removeClass("hidden")
        .animate({ opacity: 1 }, 125);
}
exports.show = show;
$(document.body).on("click", ".version", (e) => {
    if (e.shiftKey)
        return;
    show();
});
$(document.body).on("click", "#versionHistoryWrapper", (e) => {
    if ($(e.target).attr("id") === "versionHistoryWrapper") {
        $("#versionHistoryWrapper")
            .css("opacity", 1)
            .animate({ opacity: 0 }, 125, () => {
            $("#versionHistoryWrapper").addClass("hidden");
        });
    }
});


/***/ }),

/***/ "./src/scripts/popups/word-filter-popup.ts":
/*!*************************************************!*\
  !*** ./src/scripts/popups/word-filter-popup.ts ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const CustomText = __importStar(__webpack_require__(/*! ../test/custom-text */ "./src/scripts/test/custom-text.ts"));
let initialised = false;
function init() {
    return __awaiter(this, void 0, void 0, function* () {
        if (!initialised) {
            $("#wordFilterPopup .languageInput").empty();
            const LanguageList = yield Misc.getLanguageList();
            LanguageList.forEach((language) => {
                let prettyLang = language;
                prettyLang = prettyLang.replace("_", " ");
                $("#wordFilterPopup .languageInput").append(`
        <option value=${language}>${prettyLang}</option>
      `);
            });
            initialised = true;
        }
    });
}
function show() {
    return __awaiter(this, void 0, void 0, function* () {
        yield init();
        $("#wordFilterPopupWrapper").removeClass("hidden");
        $("#customTextPopupWrapper").addClass("hidden");
        $("#wordFilterPopup .languageInput").select2({
            width: "100%",
        });
    });
}
exports.show = show;
function hide() {
    $("#wordFilterPopupWrapper").addClass("hidden");
    $("#customTextPopupWrapper").removeClass("hidden");
}
function filter(language) {
    return __awaiter(this, void 0, void 0, function* () {
        let filterin = $("#wordFilterPopup .wordIncludeInput").val();
        filterin = Misc.escapeRegExp(filterin === null || filterin === void 0 ? void 0 : filterin.trim());
        filterin = filterin.replace(/\s+/gi, "|");
        const regincl = new RegExp(filterin, "i");
        let filterout = $("#wordFilterPopup .wordExcludeInput").val();
        filterout = Misc.escapeRegExp(filterout.trim());
        filterout = filterout.replace(/\s+/gi, "|");
        const regexcl = new RegExp(filterout, "i");
        const filteredWords = [];
        const languageWordList = yield Misc.getLanguage(language);
        const maxLengthInput = $("#wordFilterPopup .wordMaxInput").val();
        const minLengthInput = $("#wordFilterPopup .wordMinInput").val();
        let maxLength;
        let minLength;
        if (maxLengthInput == "") {
            maxLength = 999;
        }
        else {
            maxLength = parseInt(maxLengthInput);
        }
        if (minLengthInput == "") {
            minLength = 1;
        }
        else {
            minLength = parseInt(minLengthInput);
        }
        for (let i = 0; i < languageWordList.words.length; i++) {
            const word = languageWordList.words[i];
            const test1 = regincl.test(word);
            const test2 = regexcl.test(word);
            if (((test1 && !test2) || (test1 && filterout == "")) &&
                word.length <= maxLength &&
                word.length >= minLength) {
                filteredWords.push(word);
            }
        }
        return filteredWords;
    });
}
function apply(set) {
    return __awaiter(this, void 0, void 0, function* () {
        const language = $("#wordFilterPopup .languageInput").val();
        const filteredWords = yield filter(language);
        const customText = filteredWords.join(CustomText.delimiter);
        $("#customTextPopup textarea").val((_, val) => (set ? "" : val + " ") + customText);
        hide();
    });
}
$("#wordFilterPopupWrapper").mousedown((e) => {
    if ($(e.target).attr("id") === "wordFilterPopupWrapper") {
        hide();
    }
});
$("#wordFilterPopup .languageInput").one("select2:open", function () {
    $("input.select2-search__field").prop("placeholder", "search");
});
$("#wordFilterPopupWrapper .button").mousedown((e) => {
    $("#wordFilterPopupWrapper .loadingIndicator").removeClass("hidden");
    $("#wordFilterPopupWrapper .button").addClass("hidden");
    setTimeout(() => {
        apply($(e.target).is("#set")).then(() => {
            $("#wordFilterPopupWrapper .loadingIndicator").addClass("hidden");
            $("#wordFilterPopupWrapper .button").removeClass("hidden");
        });
    }, 1);
});


/***/ }),

/***/ "./src/scripts/ready.ts":
/*!******************************!*\
  !*** ./src/scripts/ready.ts ***!
  \******************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const ManualRestart = __importStar(__webpack_require__(/*! ./test/manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const config_1 = __importStar(__webpack_require__(/*! ./config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Misc = __importStar(__webpack_require__(/*! ./utils/misc */ "./src/scripts/utils/misc.ts"));
const VerificationController = __importStar(__webpack_require__(/*! ./controllers/verification-controller */ "./src/scripts/controllers/verification-controller.ts"));
const RouteController = __importStar(__webpack_require__(/*! ./controllers/route-controller */ "./src/scripts/controllers/route-controller.ts"));
const PageController = __importStar(__webpack_require__(/*! ./controllers/page-controller */ "./src/scripts/controllers/page-controller.ts"));
const MonkeyPower = __importStar(__webpack_require__(/*! ./elements/monkey-power */ "./src/scripts/elements/monkey-power.ts"));
const NewVersionNotification = __importStar(__webpack_require__(/*! ./elements/version-check */ "./src/scripts/elements/version-check.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Focus = __importStar(__webpack_require__(/*! ./test/focus */ "./src/scripts/test/focus.ts"));
ManualRestart.set();
UpdateConfig.loadFromLocalStorage();
if (window.location.hostname === "localhost") {
    $("#bottom .version .text").text("localhost");
    $("#bottom .version").css("opacity", 1);
}
else {
    Misc.getReleasesFromGitHub().then((v) => {
        NewVersionNotification.show(v[0].name);
    });
}
Focus.set(true, true);
RouteController.handleInitialPageClasses(window.location.pathname);
$(document).ready(() => {
    if (window.location.pathname === "/") {
        // $("#top .config").removeClass("hidden");
    }
    $("body").css("transition", "all .25s, transform .05s");
    if (config_1.default.quickTab) {
        $("#restartTestButton").addClass("hidden");
    }
    if (!window.localStorage.getItem("merchbannerclosed")) {
        Notifications.addBanner(`Checkout our merchandise, available at <a target="_blank" href="https://monkeytype.store/">monkeytype.store</a>`, 1, "images/merchdropwebsite2.png", false, () => {
            window.localStorage.setItem("merchbannerclosed", "true");
        });
    }
    $("#centerContent")
        .css("opacity", "0")
        .removeClass("hidden")
        .stop(true, true)
        .animate({ opacity: 1 }, 250, () => {
        if (window.location.pathname === "/verify") {
            const fragment = new URLSearchParams(window.location.hash.slice(1));
            if (fragment.has("access_token")) {
                const accessToken = fragment.get("access_token");
                const tokenType = fragment.get("token_type");
                VerificationController.set({
                    accessToken: accessToken,
                    tokenType: tokenType,
                });
                history.replaceState("/", "", "/");
            }
            const page = window.location.pathname.replace("/", "");
            PageController.change(page);
        }
        else if (window.location.pathname === "/account") {
            // history.replaceState("/", null, "/");
        }
        else if (/challenge_.+/g.test(window.location.pathname)) {
            //do nothing
            // }
        }
        else if (window.location.pathname !== "/") {
            // let page = window.location.pathname.replace("/", "");
            // PageController.change(page);
        }
    });
    // Settings.settingsFillPromise.then(Settings.update);
    MonkeyPower.init();
});


/***/ }),

/***/ "./src/scripts/settings/settings-group.ts":
/*!************************************************!*\
  !*** ./src/scripts/settings/settings-group.ts ***!
  \************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
class SettingsGroup {
    constructor(configName, configFunction, mode, setCallback, updateCallback) {
        this.configName = configName;
        this.configValue = config_1.default[configName];
        this.mode = mode;
        this.configFunction = configFunction;
        this.setCallback = setCallback;
        this.updateCallback = updateCallback;
        this.updateInput();
        if (this.mode === "select") {
            $(document).on("change", `.pageSettings .section.${this.configName} select`, (e) => {
                const target = $(e.currentTarget);
                if (target.hasClass("disabled") ||
                    target.hasClass("no-auto-handle")) {
                    return;
                }
                this.setValue(target.val());
            });
        }
        else if (this.mode === "button") {
            $(document).on("click", `.pageSettings .section.${this.configName} .button`, (e) => {
                const target = $(e.currentTarget);
                if (target.hasClass("disabled") ||
                    target.hasClass("no-auto-handle")) {
                    return;
                }
                let value = target.attr(configName);
                const params = target.attr("params");
                if (!value && !params)
                    return;
                if (value === "true")
                    value = true;
                if (value === "false")
                    value = false;
                this.setValue(value, params);
            });
        }
    }
    setValue(value, params) {
        if (params === undefined) {
            this.configFunction(value);
        }
        else {
            this.configFunction(value, ...params);
        }
        this.updateInput();
        if (this.setCallback)
            this.setCallback();
    }
    updateInput() {
        this.configValue = config_1.default[this.configName];
        $(`.pageSettings .section.${this.configName} .button`).removeClass("active");
        if (this.mode === "select") {
            $(`.pageSettings .section.${this.configName} select`)
                .val(this.configValue)
                .trigger("change.select2");
        }
        else if (this.mode === "button") {
            $(`.pageSettings .section.${this.configName} .button[${this.configName}='${this.configValue}']`).addClass("active");
        }
        if (this.updateCallback)
            this.updateCallback();
    }
}
exports["default"] = SettingsGroup;


/***/ }),

/***/ "./src/scripts/settings/theme-picker.ts":
/*!**********************************************!*\
  !*** ./src/scripts/settings/theme-picker.ts ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateActiveTab = exports.saveCustomThemeColors = exports.setCustomInputs = exports.refreshButtons = exports.updateActiveButton = void 0;
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const ThemeController = __importStar(__webpack_require__(/*! ../controllers/theme-controller */ "./src/scripts/controllers/theme-controller.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const ChartController = __importStar(__webpack_require__(/*! ../controllers/chart-controller */ "./src/scripts/controllers/chart-controller.ts"));
const CustomThemePopup = __importStar(__webpack_require__(/*! ../popups/custom-theme-popup */ "./src/scripts/popups/custom-theme-popup.ts"));
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
function updateActiveButton() {
    let activeThemeName = config_1.default.theme;
    if (config_1.default.randomTheme !== "off" &&
        config_1.default.randomTheme !== "custom" &&
        ThemeController.randomTheme !== null) {
        activeThemeName = ThemeController.randomTheme;
    }
    $(`.pageSettings .section.themes .theme`).removeClass("active");
    $(`.pageSettings .section.themes .theme[theme=${activeThemeName}]`).addClass("active");
}
exports.updateActiveButton = updateActiveButton;
function updateColors(colorPicker, color, onlyStyle = false, noThemeUpdate = false) {
    if (onlyStyle) {
        const colorID = colorPicker.find("input[type=color]").attr("id");
        if (colorID === undefined)
            console.error("Could not find color ID!");
        if (!noThemeUpdate && colorID !== undefined) {
            document.documentElement.style.setProperty(colorID, color);
        }
        const pickerButton = colorPicker.find("label");
        pickerButton.val(color);
        pickerButton.attr("value", color);
        if (pickerButton.attr("for") !== "--bg-color") {
            pickerButton.css("background-color", color);
        }
        colorPicker.find("input[type=text]").val(color);
        colorPicker.find("input[type=color]").attr("value", color);
        return;
    }
    const colorREGEX = [
        {
            rule: /\b[0-9]{1,3},\s?[0-9]{1,3},\s?[0-9]{1,3}\s*\b/,
            start: "rgb(",
            end: ")",
        },
        {
            rule: /\b[A-Z, a-z, 0-9]{6}\b/,
            start: "#",
            end: "",
        },
        {
            rule: /\b[0-9]{1,3},\s?[0-9]{1,3}%,\s?[0-9]{1,3}%?\s*\b/,
            start: "hsl(",
            end: ")",
        },
    ];
    color = color.replace("", "");
    for (const regex of colorREGEX) {
        if (color.match(regex.rule)) {
            color = regex.start + color + regex.end;
            break;
        }
    }
    $(".colorConverter").css("color", color);
    const hexColor = Misc.convertRGBtoHEX($(".colorConverter").css("color"));
    if (hexColor === undefined) {
        return;
    }
    color = hexColor;
    const colorID = colorPicker.find("input[type=color]").attr("id");
    if (colorID === undefined)
        console.error("Could not find color ID!");
    if (!noThemeUpdate && colorID !== undefined) {
        document.documentElement.style.setProperty(colorID, color);
    }
    const pickerButton = colorPicker.find("label");
    pickerButton.val(color);
    pickerButton.attr("value", color);
    if (pickerButton.attr("for") !== "--bg-color") {
        pickerButton.css("background-color", color);
    }
    colorPicker.find("input[type=text]").val(color);
    colorPicker.find("input[type=color]").attr("value", color);
}
function refreshButtons() {
    return __awaiter(this, void 0, void 0, function* () {
        if (config_1.default.customTheme) {
            // Update custom theme buttons
            const customThemesEl = $(".pageSettings .section.themes .allCustomThemes.buttons").empty();
            const addButton = $(".pageSettings .section.themes .addCustomThemeButton");
            if (firebase_1.Auth.currentUser === null) {
                $(".pageSettings .section.themes .customThemeEdit .saveCustomThemeButton").text("save");
                return;
            }
            else {
                $(".pageSettings .section.themes .customThemeEdit .saveCustomThemeButton").text("save as new");
            }
            addButton.removeClass("hidden");
            const customThemes = DB.getSnapshot().customThemes;
            customThemes.forEach((customTheme) => {
                // const activeTheme =
                //   Config.customThemeId === customTheme._id ? "active" : "";
                const bgColor = customTheme.colors[0];
                const mainColor = customTheme.colors[1];
                customThemesEl.append(`<div class="customTheme button" customThemeId='${customTheme._id}' 
        style="color:${mainColor};background:${bgColor}">
        <div class="editButton"><i class="fas fa-pen"></i></div>
        <div class="text">${customTheme.name.replace(/_/g, " ")}</div>
        <div class="delButton"><i class="fas fa-trash fa-fw"></i></div>
        </div>`);
            });
        }
        else {
            // Update theme buttons
            const favThemesEl = $(".pageSettings .section.themes .favThemes.buttons").empty();
            const themesEl = $(".pageSettings .section.themes .allThemes.buttons").empty();
            let activeThemeName = config_1.default.theme;
            if (config_1.default.randomTheme !== "off" &&
                config_1.default.randomTheme !== "custom" &&
                ThemeController.randomTheme !== null) {
                activeThemeName = ThemeController.randomTheme;
            }
            const themes = yield Misc.getSortedThemesList();
            //first show favourites
            if (config_1.default.favThemes.length > 0) {
                favThemesEl.css({ paddingBottom: "1rem" });
                themes.forEach((theme) => {
                    if (config_1.default.favThemes.includes(theme.name)) {
                        const activeTheme = activeThemeName === theme.name ? "active" : "";
                        favThemesEl.append(`<div class="theme button ${activeTheme}" theme='${theme.name}' 
            style="color:${theme.mainColor};background:${theme.bgColor}">
            <div class="activeIndicator"><i class="fas fa-circle"></i></div>
            <div class="text">${theme.name.replace(/_/g, " ")}</div>
            <div class="favButton active"><i class="fas fa-star"></i></div></div>`);
                    }
                });
            }
            else {
                favThemesEl.css({ paddingBottom: "0" });
            }
            //then the rest
            themes.forEach((theme) => {
                if (config_1.default.favThemes.includes(theme.name)) {
                    return;
                }
                const activeTheme = activeThemeName === theme.name ? "active" : "";
                themesEl.append(`<div class="theme button ${activeTheme}" theme='${theme.name}' style="color:${theme.mainColor};background:${theme.bgColor}">
        <div class="activeIndicator"><i class="fas fa-circle"></i></div>
        <div class="text">${theme.name.replace(/_/g, " ")}</div>
        <div class="favButton"><i class="far fa-star"></i></div></div>`);
            });
        }
        updateActiveButton();
    });
}
exports.refreshButtons = refreshButtons;
function setCustomInputs(noThemeUpdate = false) {
    $(".pageSettings .section.themes .tabContainer .customTheme .colorPicker").each((_index, element) => {
        const currentColor = config_1.default.customThemeColors[ThemeController.colorVars.indexOf($(element).find("input[type=color]").attr("id"))];
        updateColors($(element), currentColor, false, noThemeUpdate);
    });
}
exports.setCustomInputs = setCustomInputs;
function toggleFavourite(themeName) {
    if (config_1.default.favThemes.includes(themeName)) {
        // already favourite, remove
        UpdateConfig.setFavThemes(config_1.default.favThemes.filter((t) => t !== themeName));
    }
    else {
        // add to favourites
        const newList = config_1.default.favThemes;
        newList.push(themeName);
        UpdateConfig.setFavThemes(newList);
    }
    UpdateConfig.saveFullConfigToLocalStorage();
}
function saveCustomThemeColors() {
    const newColors = [];
    $.each($(".pageSettings .customTheme .customThemeEdit [type='color']"), (_index, element) => {
        newColors.push($(element).attr("value"));
    });
    UpdateConfig.setCustomThemeColors(newColors);
    Notifications.add("Custom theme saved", 1);
}
exports.saveCustomThemeColors = saveCustomThemeColors;
function updateActiveTab(forced = false) {
    // Set force to true only when some change for the active tab has taken place
    // Prevent theme buttons from being added twice by doing an update only when the state has changed
    const $presetTabButton = $(".pageSettings .section.themes .tabs .button[tab='preset']");
    const $customTabButton = $(".pageSettings .section.themes .tabs .button[tab='custom']");
    if (config_1.default.customTheme) {
        $presetTabButton.removeClass("active");
        if (!$customTabButton.hasClass("active") || forced) {
            $customTabButton.addClass("active");
            refreshButtons();
        }
        Misc.swapElements($('.pageSettings [tabContent="preset"]'), $('.pageSettings [tabContent="custom"]'), 250);
    }
    else {
        $customTabButton.removeClass("active");
        if (!$presetTabButton.hasClass("active") || forced) {
            $presetTabButton.addClass("active");
            refreshButtons();
        }
        Misc.swapElements($('.pageSettings [tabContent="custom"]'), $('.pageSettings [tabContent="preset"]'), 250);
    }
}
exports.updateActiveTab = updateActiveTab;
// Add events to the DOM
// Handle click on theme: preset or custom tab
$(".pageSettings .section.themes .tabs .button").on("click", (e) => {
    $(".pageSettings .section.themes .tabs .button").removeClass("active");
    const $target = $(e.currentTarget);
    $target.addClass("active");
    // setCustomInputs();
    if ($target.attr("tab") == "preset") {
        UpdateConfig.setCustomTheme(false);
    }
    else {
        UpdateConfig.setCustomTheme(true);
    }
});
// Handle click on custom theme button
$(document).on("click", ".pageSettings .section.themes .customTheme.button", (e) => {
    var _a;
    // Do not apply if user wanted to delete it
    if ($(e.target).hasClass("delButton"))
        return;
    if ($(e.target).hasClass("editButton"))
        return;
    const customThemeId = (_a = $(e.currentTarget).attr("customThemeId")) !== null && _a !== void 0 ? _a : "";
    ThemeController.set(customThemeId, true);
});
// Handle click on favorite preset theme button
$(document).on("click", ".pageSettings .section.themes .theme .favButton", (e) => {
    const theme = $(e.currentTarget).parents(".theme.button").attr("theme");
    if (theme !== undefined)
        toggleFavourite(theme);
    else {
        console.error("Could not find the theme attribute attached to the button clicked!");
    }
});
// Handle click on preset theme button
$(document).on("click", ".pageSettings .section.themes .theme.button", (e) => {
    const theme = $(e.currentTarget).attr("theme");
    if (!$(e.target).hasClass("favButton") && theme !== undefined) {
        UpdateConfig.setTheme(theme);
        updateActiveButton();
    }
});
$(".pageSettings .section.themes .tabContainer .customTheme input[type=color]").on("input", (e) => {
    const $colorVar = $(e.currentTarget).attr("id");
    const $pickedColor = $(e.currentTarget).val();
    updateColors($(".colorPicker #" + $colorVar).parent(), $pickedColor, true);
});
$(".pageSettings .section.themes .tabContainer .customTheme input[type=color]").on("change", (e) => {
    const $colorVar = $(e.currentTarget).attr("id");
    const $pickedColor = $(e.currentTarget).val();
    updateColors($(".colorPicker #" + $colorVar).parent(), $pickedColor);
});
$(".pageSettings .section.themes .tabContainer .customTheme input[type=text]")
    .on("blur", (e) => {
    if (e.target.id === "name")
        return;
    const $colorVar = $(e.currentTarget).attr("id");
    const $pickedColor = $(e.currentTarget).val();
    updateColors($(".colorPicker #" + $colorVar).parent(), $pickedColor);
})
    .on("keypress", function (e) {
    if (e.target.id === "name")
        return;
    if (e.code === "Enter") {
        $(this).attr("disabled", "disabled");
        const $colorVar = $(e.currentTarget).attr("id");
        const $pickedColor = $(e.currentTarget).val();
        updateColors($(".colorPicker #" + $colorVar).parent(), $pickedColor);
        $(this).removeAttr("disabled");
    }
});
$(".pageSettings #loadCustomColorsFromPreset").on("click", () => {
    // previewTheme(Config.theme);
    $("#currentTheme").attr("href", `themes/${config_1.default.theme}.css`);
    ThemeController.colorVars.forEach((e) => {
        document.documentElement.style.setProperty(e, "");
    });
    setTimeout(() => __awaiter(void 0, void 0, void 0, function* () {
        ChartController.updateAllChartColors();
        const themeColors = yield ThemeColors.getAll();
        ThemeController.colorVars.forEach((colorName) => {
            let color;
            if (colorName === "--bg-color") {
                color = themeColors.bg;
            }
            else if (colorName === "--main-color") {
                color = themeColors.main;
            }
            else if (colorName === "--sub-color") {
                color = themeColors.sub;
            }
            else if (colorName === "--caret-color") {
                color = themeColors.caret;
            }
            else if (colorName === "--text-color") {
                color = themeColors.text;
            }
            else if (colorName === "--error-color") {
                color = themeColors.error;
            }
            else if (colorName === "--error-extra-color") {
                color = themeColors.errorExtra;
            }
            else if (colorName === "--colorful-error-color") {
                color = themeColors.colorfulError;
            }
            else if (colorName === "--colorful-error-extra-color") {
                color = themeColors.colorfulErrorExtra;
            }
            updateColors($(".colorPicker #" + colorName).parent(), color);
        });
    }), 250);
});
// Handles click on share custom theme button
$("#shareCustomThemeButton").on("click", () => {
    const share = [];
    $.each($(".pageSettings .customTheme .customThemeEdit [type='color']"), (_, element) => {
        share.push($(element).attr("value"));
    });
    const url = "https://monkeytype.com?customTheme=" + btoa(JSON.stringify(share));
    navigator.clipboard.writeText(url).then(function () {
        Notifications.add("URL Copied to clipboard", 0);
    }, function () {
        CustomThemePopup.show(url);
    });
});
$(".pageSettings .saveCustomThemeButton").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    saveCustomThemeColors();
    if (firebase_1.Auth.currentUser) {
        const newCustomTheme = {
            name: "custom",
            colors: config_1.default.customThemeColors,
        };
        Loader.show();
        const response = yield DB.addCustomTheme(newCustomTheme);
        Loader.hide();
        if (response) {
            updateActiveTab(true);
        }
    }
    else {
        updateActiveTab(true);
    }
}));
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "customThemeId")
        refreshButtons();
    // if (eventKey === "customTheme") updateActiveTab();
});


/***/ }),

/***/ "./src/scripts/states/active-page.ts":
/*!*******************************************!*\
  !*** ./src/scripts/states/active-page.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.set = exports.get = void 0;
let activePage = "loading";
function get() {
    return activePage;
}
exports.get = get;
function set(active) {
    activePage = active;
}
exports.set = set;


/***/ }),

/***/ "./src/scripts/states/glarses-mode.ts":
/*!********************************************!*\
  !*** ./src/scripts/states/glarses-mode.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.enable = exports.get = void 0;
let glarsesMode = false;
function get() {
    return glarsesMode;
}
exports.get = get;
function enable() {
    glarsesMode = true;
    console.log("Glarses Mode On - test result will be hidden. You can check the stats in the console (here)");
    console.log("To disable Glarses Mode refresh the page.");
}
exports.enable = enable;


/***/ }),

/***/ "./src/scripts/states/page-transition.ts":
/*!***********************************************!*\
  !*** ./src/scripts/states/page-transition.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.get = exports.set = void 0;
let transition = true;
function set(val) {
    transition = val;
}
exports.set = set;
function get() {
    return transition;
}
exports.get = get;


/***/ }),

/***/ "./src/scripts/states/slow-timer.ts":
/*!******************************************!*\
  !*** ./src/scripts/states/slow-timer.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.get = exports.clear = exports.set = void 0;
let slowTimer = false;
function set() {
    if (slowTimer)
        return;
    slowTimer = true;
    console.error("Slow timer, disabling animations");
    // Notifications.add("Slow timer detected", -1, 5);
}
exports.set = set;
function clear() {
    slowTimer = false;
}
exports.clear = clear;
function get() {
    return slowTimer;
}
exports.get = get;


/***/ }),

/***/ "./src/scripts/states/test-active.ts":
/*!*******************************************!*\
  !*** ./src/scripts/states/test-active.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.set = exports.get = void 0;
let testActive = false;
function get() {
    return testActive;
}
exports.get = get;
function set(active) {
    testActive = active;
}
exports.set = set;


/***/ }),

/***/ "./src/scripts/states/time.ts":
/*!************************************!*\
  !*** ./src/scripts/states/time.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.increment = exports.set = exports.get = void 0;
let time = 0;
function get() {
    return time;
}
exports.get = get;
function set(active) {
    time = active;
}
exports.set = set;
function increment() {
    time++;
}
exports.increment = increment;


/***/ }),

/***/ "./src/scripts/test/british-english.ts":
/*!*********************************************!*\
  !*** ./src/scripts/test/british-english.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.replace = exports.getList = void 0;
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
let list = [];
function getList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (list.length === 0) {
            return $.getJSON("languages/britishenglish.json", function (data) {
                list = data;
                return list;
            });
        }
        else {
            return list;
        }
    });
}
exports.getList = getList;
function replace(word) {
    return __awaiter(this, void 0, void 0, function* () {
        const list = yield getList();
        const replacement = list.find((a) => word.match(RegExp(`^([\\W]*${a[0]}[\\W]*)$`, "gi")));
        return replacement
            ? word.replace(RegExp(`^(?:([\\W]*)(${replacement[0]})([\\W]*))$`, "gi"), (_, $1, $2, $3) => $1 +
                ($2.charAt(0) === $2.charAt(0).toUpperCase()
                    ? $2 === $2.toUpperCase()
                        ? replacement[1].toUpperCase()
                        : (0, misc_1.capitalizeFirstLetterOfEachWord)(replacement[1])
                    : replacement[1]) +
                $3)
            : word;
    });
}
exports.replace = replace;


/***/ }),

/***/ "./src/scripts/test/caps-warning.ts":
/*!******************************************!*\
  !*** ./src/scripts/test/caps-warning.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.capsState = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
exports.capsState = false;
function show() {
    if ($("#capsWarning").hasClass("hidden")) {
        $("#capsWarning").removeClass("hidden");
    }
}
function hide() {
    if (!$("#capsWarning").hasClass("hidden")) {
        $("#capsWarning").addClass("hidden");
    }
}
$(document).keydown(function (event) {
    var _a, _b;
    if (((_a = event === null || event === void 0 ? void 0 : event.originalEvent) === null || _a === void 0 ? void 0 : _a.getModifierState) &&
        ((_b = event === null || event === void 0 ? void 0 : event.originalEvent) === null || _b === void 0 ? void 0 : _b.getModifierState("CapsLock"))) {
        exports.capsState = true;
    }
    else {
        exports.capsState = false;
    }
    try {
        if (config_1.default.capsLockWarning && exports.capsState) {
            show();
        }
        else {
            hide();
        }
    }
    catch (_c) { }
});
$(document).keyup(function (event) {
    var _a, _b;
    if (((_a = event === null || event === void 0 ? void 0 : event.originalEvent) === null || _a === void 0 ? void 0 : _a.getModifierState) &&
        ((_b = event === null || event === void 0 ? void 0 : event.originalEvent) === null || _b === void 0 ? void 0 : _b.getModifierState("CapsLock"))) {
        //filthy fix but optional chaining refues to work
        exports.capsState = true;
    }
    else {
        exports.capsState = false;
    }
    try {
        if (config_1.default.capsLockWarning && exports.capsState) {
            show();
        }
        else {
            hide();
        }
    }
    catch (_c) { }
});


/***/ }),

/***/ "./src/scripts/test/caret.ts":
/*!***********************************!*\
  !*** ./src/scripts/test/caret.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.updatePosition = exports.hide = exports.startAnimation = exports.stopAnimation = exports.caretAnimating = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
exports.caretAnimating = true;
function stopAnimation() {
    if (exports.caretAnimating === true) {
        $("#caret").css("animation-name", "none");
        $("#caret").css("opacity", "1");
        exports.caretAnimating = false;
    }
}
exports.stopAnimation = stopAnimation;
function startAnimation() {
    if (exports.caretAnimating === false) {
        if (config_1.default.smoothCaret && !SlowTimer.get()) {
            $("#caret").css("animation-name", "caretFlashSmooth");
        }
        else {
            $("#caret").css("animation-name", "caretFlashHard");
        }
        exports.caretAnimating = true;
    }
}
exports.startAnimation = startAnimation;
function hide() {
    $("#caret").addClass("hidden");
}
exports.hide = hide;
function updatePosition() {
    var _a, _b;
    return __awaiter(this, void 0, void 0, function* () {
        if ($("#wordsWrapper").hasClass("hidden"))
            return;
        // if ($("#caret").hasClass("off")) {
        //   return;
        // }
        const caret = $("#caret");
        let inputLen = TestInput.input.current.length;
        inputLen = Misc.trailingComposeChars.test(TestInput.input.current)
            ? TestInput.input.current.search(Misc.trailingComposeChars) + 1
            : inputLen;
        let currentLetterIndex = inputLen - 1;
        if (currentLetterIndex == -1) {
            currentLetterIndex = 0;
        }
        //insert temporary character so the caret will work in zen mode
        const activeWordEmpty = $("#words .active").children().length == 0;
        if (activeWordEmpty) {
            $("#words .active").append('<letter style="opacity: 0;">_</letter>');
        }
        const currentWordNodeList = (_a = document === null || document === void 0 ? void 0 : document.querySelector("#words .active")) === null || _a === void 0 ? void 0 : _a.querySelectorAll("letter");
        if (!currentWordNodeList)
            return;
        let currentLetter = currentWordNodeList[currentLetterIndex];
        if (inputLen > currentWordNodeList.length) {
            currentLetter = currentWordNodeList[currentWordNodeList.length - 1];
        }
        if (config_1.default.mode != "zen" && $(currentLetter).length == 0)
            return;
        const currentLanguage = yield Misc.getCurrentLanguage(config_1.default.language);
        const isLanguageLeftToRight = currentLanguage.leftToRight;
        const currentLetterPosLeft = isLanguageLeftToRight
            ? currentLetter.offsetLeft
            : currentLetter.offsetLeft + ((_b = $(currentLetter).width()) !== null && _b !== void 0 ? _b : 0);
        const currentLetterPosTop = currentLetter.offsetTop;
        const letterHeight = $(currentLetter).height();
        let newTop = 0;
        let newLeft = 0;
        newTop = currentLetterPosTop - Math.round(letterHeight / 5);
        if (inputLen == 0) {
            newLeft = isLanguageLeftToRight
                ? currentLetterPosLeft - caret.width() / 2
                : currentLetterPosLeft + caret.width() / 2;
        }
        else {
            newLeft = isLanguageLeftToRight
                ? currentLetterPosLeft +
                    $(currentLetter).width() -
                    caret.width() / 2
                : currentLetterPosLeft -
                    $(currentLetter).width() +
                    caret.width() / 2;
        }
        let smoothlinescroll = $("#words .smoothScroller").height();
        if (smoothlinescroll === undefined)
            smoothlinescroll = 0;
        if (config_1.default.smoothCaret) {
            caret.stop(true, false).animate({
                top: newTop - smoothlinescroll,
                left: newLeft,
            }, SlowTimer.get() ? 0 : 100);
        }
        else {
            caret.stop(true, true).animate({
                top: newTop - smoothlinescroll,
                left: newLeft,
            }, 0);
        }
        if (config_1.default.showAllLines) {
            const browserHeight = window.innerHeight;
            const middlePos = browserHeight / 2 - $("#caret").outerHeight() / 2;
            const contentHeight = document.body.scrollHeight;
            if (newTop >= middlePos &&
                contentHeight > browserHeight &&
                TestActive.get()) {
                const newscrolltop = newTop - middlePos / 2;
                // console.log('---------');
                // console.log(newTop);
                // console.log(middlePos);
                // console.log(browserHeight);
                // console.log(contentHeight);
                window.scrollTo({
                    left: 0,
                    top: newscrolltop,
                    behavior: "smooth",
                });
            }
        }
        if (activeWordEmpty) {
            $("#words .active").children().remove();
        }
    });
}
exports.updatePosition = updatePosition;
function show() {
    if ($("#result").hasClass("hidden")) {
        updatePosition();
        $("#caret").removeClass("hidden");
        startAnimation();
    }
}
exports.show = show;


/***/ }),

/***/ "./src/scripts/test/custom-text.ts":
/*!*****************************************!*\
  !*** ./src/scripts/test/custom-text.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getCustomTextNames = exports.deleteCustomText = exports.setCustomText = exports.getCustomText = exports.setDelimiter = exports.setWord = exports.setTime = exports.setIsTimeRandom = exports.setIsWordRandom = exports.setText = exports.delimiter = exports.time = exports.word = exports.isTimeRandom = exports.isWordRandom = exports.text = void 0;
exports.text = [
    "The",
    "quick",
    "brown",
    "fox",
    "jumps",
    "over",
    "the",
    "lazy",
    "dog",
];
exports.isWordRandom = false;
exports.isTimeRandom = false;
exports.delimiter = " ";
function setText(txt) {
    exports.text = txt;
}
exports.setText = setText;
function setIsWordRandom(val) {
    exports.isWordRandom = val;
}
exports.setIsWordRandom = setIsWordRandom;
function setIsTimeRandom(val) {
    exports.isTimeRandom = val;
}
exports.setIsTimeRandom = setIsTimeRandom;
function setTime(val) {
    exports.time = val;
}
exports.setTime = setTime;
function setWord(val) {
    exports.word = val;
}
exports.setWord = setWord;
function setDelimiter(val) {
    exports.delimiter = val;
}
exports.setDelimiter = setDelimiter;
function getCustomText(name) {
    const customText = getCustomTextObject();
    return customText[name].split(/ +/);
}
exports.getCustomText = getCustomText;
function setCustomText(name, text) {
    const customText = getCustomTextObject();
    if (typeof text === "string")
        customText[name] = text;
    else
        customText[name] = text.join(" ");
    window.localStorage.setItem("customText", JSON.stringify(customText));
}
exports.setCustomText = setCustomText;
function deleteCustomText(name) {
    const customText = getCustomTextObject();
    if (customText[name])
        delete customText[name];
    window.localStorage.setItem("customText", JSON.stringify(customText));
}
exports.deleteCustomText = deleteCustomText;
function getCustomTextObject() {
    var _a;
    return JSON.parse((_a = window.localStorage.getItem("customText")) !== null && _a !== void 0 ? _a : "{}");
}
function getCustomTextNames() {
    return Object.keys(getCustomTextObject());
}
exports.getCustomTextNames = getCustomTextNames;


/***/ }),

/***/ "./src/scripts/test/focus.ts":
/*!***********************************!*\
  !*** ./src/scripts/test/focus.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.set = void 0;
const Caret = __importStar(__webpack_require__(/*! ./caret */ "./src/scripts/test/caret.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const unfocusPx = 3;
let state = false;
function set(foc, withCursor = false) {
    if (foc && !state) {
        state = true;
        Caret.stopAnimation();
        $("#top").addClass("focus");
        $("#bottom").addClass("focus");
        if (!withCursor)
            $("body").css("cursor", "none");
        $("#middle").addClass("focus");
        $("#bannerCenter").addClass("focus");
    }
    else if (!foc && state) {
        state = false;
        Caret.startAnimation();
        $("#top").removeClass("focus");
        $("#bottom").removeClass("focus");
        $("body").css("cursor", "default");
        $("#middle").removeClass("focus");
        $("#bannerCenter").removeClass("focus");
    }
}
exports.set = set;
$(document).mousemove(function (event) {
    if (!state)
        return;
    if (ActivePage.get() == "loading")
        return;
    if (ActivePage.get() == "account" && state == true)
        return;
    if ($("#top").hasClass("focus") &&
        event.originalEvent &&
        // To avoid mouse/desk vibration from creating a flashy effect, we'll unfocus @ >5px instead of >0px
        (event.originalEvent.movementX > unfocusPx ||
            event.originalEvent.movementY > unfocusPx)) {
        set(false);
    }
});


/***/ }),

/***/ "./src/scripts/test/funbox.ts":
/*!************************************!*\
  !*** ./src/scripts/test/funbox.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.rememberSettings = exports.activate = exports.clear = exports.setFunbox = exports.toggleScript = exports.reset = exports.startMemoryTimer = exports.resetMemoryTimer = void 0;
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ./manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const TTS = __importStar(__webpack_require__(/*! ./tts */ "./src/scripts/test/tts.ts"));
const ModesNotice = __importStar(__webpack_require__(/*! ../elements/modes-notice */ "./src/scripts/elements/modes-notice.ts"));
let modeSaved = null;
let memoryTimer = null;
let memoryInterval = null;
let settingsMemory = {};
function rememberSetting(settingName, value, setFunction) {
    var _a;
    (_a = settingsMemory[settingName]) !== null && _a !== void 0 ? _a : (settingsMemory[settingName] = {
        value,
        setFunction,
    });
}
function loadMemory() {
    Notifications.add("Reverting funbox settings", 0);
    Object.keys(settingsMemory).forEach((setting) => {
        settingsMemory[setting].setFunction(settingsMemory[setting].value, true);
    });
    settingsMemory = {};
}
function showMemoryTimer() {
    $("#typingTest #memoryTimer").stop(true, true).animate({
        opacity: 1,
    }, 125);
}
function hideMemoryTimer() {
    $("#typingTest #memoryTimer").stop(true, true).animate({
        opacity: 0,
    }, 125);
}
function resetMemoryTimer() {
    if (memoryInterval !== null) {
        clearInterval(memoryInterval);
        memoryInterval = null;
    }
    memoryTimer = null;
    hideMemoryTimer();
}
exports.resetMemoryTimer = resetMemoryTimer;
function updateMemoryTimer(sec) {
    $("#typingTest #memoryTimer").text(`Timer left to memorise all words: ${sec}s`);
}
function startMemoryTimer() {
    resetMemoryTimer();
    memoryTimer = Math.round(Math.pow(TestWords.words.length, 1.2));
    updateMemoryTimer(memoryTimer);
    showMemoryTimer();
    memoryInterval = setInterval(() => {
        if (memoryTimer === null)
            return;
        memoryTimer -= 1;
        memoryTimer == 0 ? hideMemoryTimer() : updateMemoryTimer(memoryTimer);
        if (memoryTimer <= 0) {
            resetMemoryTimer();
            $("#wordsWrapper").addClass("hidden");
        }
    }, 1000);
}
exports.startMemoryTimer = startMemoryTimer;
function reset() {
    resetMemoryTimer();
}
exports.reset = reset;
function toggleScript(...params) {
    if (config_1.default.funbox === "tts") {
        TTS.speak(params[0]);
    }
}
exports.toggleScript = toggleScript;
function setFunbox(funbox, mode) {
    modeSaved = mode;
    UpdateConfig.setFunbox(funbox, false);
    if (funbox === "none")
        loadMemory();
    return true;
}
exports.setFunbox = setFunbox;
function clear() {
    return __awaiter(this, void 0, void 0, function* () {
        $("#funBoxTheme").attr("href", ``);
        $("#words").removeClass("nospace");
        $("#words").removeClass("arrows");
        reset();
        $("#wordsWrapper").removeClass("hidden");
        ManualRestart.set();
        ModesNotice.update();
        return true;
    });
}
exports.clear = clear;
function activate(funbox) {
    return __awaiter(this, void 0, void 0, function* () {
        let mode = modeSaved;
        if (funbox === undefined || funbox === null) {
            funbox = config_1.default.funbox;
        }
        const funboxInfo = yield Misc.getFunbox(funbox);
        $("#funBoxTheme").attr("href", ``);
        $("#words").removeClass("nospace");
        $("#words").removeClass("arrows");
        if ((yield Misc.getCurrentLanguage(config_1.default.language)).ligatures) {
            if (funbox == "choo_choo" || funbox == "earthquake") {
                Notifications.add("Current language does not support this funbox mode", 0);
                UpdateConfig.setFunbox("none", true);
                yield clear();
                return;
            }
        }
        if (funbox !== "none" && (config_1.default.mode === "zen" || config_1.default.mode == "quote")) {
            if ((funboxInfo === null || funboxInfo === void 0 ? void 0 : funboxInfo.affectsWordGeneration) === true) {
                Notifications.add(`${Misc.capitalizeFirstLetterOfEachWord(config_1.default.mode)} mode does not support the ${funbox} funbox`, 0);
                UpdateConfig.setFunbox("none", true);
                yield clear();
                return;
            }
        }
        // if (funbox === "none") {
        reset();
        $("#wordsWrapper").removeClass("hidden");
        // }
        if (funbox === "none" && mode === undefined) {
            mode = null;
        }
        else if ((funbox !== "none" && mode === undefined) ||
            (funbox !== "none" && mode === null)) {
            const list = yield Misc.getFunboxList();
            mode = list.filter((f) => f.name === funbox)[0].type;
        }
        ManualRestart.set();
        if (mode === "style") {
            if (funbox != undefined) {
                $("#funBoxTheme").attr("href", `funbox/${funbox}.css`);
            }
            if (funbox === "simon_says") {
                UpdateConfig.setKeymapMode("next", true);
            }
            if (funbox === "read_ahead" ||
                funbox === "read_ahead_easy" ||
                funbox === "read_ahead_hard") {
                UpdateConfig.setHighlightMode("letter", true);
            }
        }
        else if (mode === "script") {
            if (funbox === "tts") {
                $("#funBoxTheme").attr("href", `funbox/simon_says.css`);
                UpdateConfig.setKeymapMode("off", true);
                UpdateConfig.setHighlightMode("letter", true);
            }
            else if (funbox === "layoutfluid") {
                UpdateConfig.setLayout(config_1.default.customLayoutfluid
                    ? config_1.default.customLayoutfluid.split("#")[0]
                    : "qwerty", true);
                UpdateConfig.setKeymapLayout(config_1.default.customLayoutfluid
                    ? config_1.default.customLayoutfluid.split("#")[0]
                    : "qwerty", true);
            }
            else if (funbox === "memory") {
                UpdateConfig.setMode("words", true);
                UpdateConfig.setShowAllLines(true, true);
                if (config_1.default.keymapMode === "next") {
                    UpdateConfig.setKeymapMode("react", true);
                }
            }
            else if (funbox === "nospace") {
                $("#words").addClass("nospace");
                UpdateConfig.setHighlightMode("letter", true);
            }
            else if (funbox === "arrows") {
                $("#words").addClass("arrows");
                UpdateConfig.setHighlightMode("letter", true);
            }
        }
        // ModesNotice.update();
        return true;
    });
}
exports.activate = activate;
function rememberSettings() {
    return __awaiter(this, void 0, void 0, function* () {
        const funbox = config_1.default.funbox;
        let mode = modeSaved;
        if (funbox === "none" && mode === undefined) {
            mode = null;
        }
        else if ((funbox !== "none" && mode === undefined) ||
            (funbox !== "none" && mode === null)) {
            const list = yield Misc.getFunboxList();
            mode = list.filter((f) => f.name === funbox)[0].type;
        }
        if (mode === "style") {
            if (funbox === "simon_says") {
                rememberSetting("keymapMode", config_1.default.keymapMode, UpdateConfig.setKeymapMode);
            }
            if (funbox === "read_ahead" ||
                funbox === "read_ahead_easy" ||
                funbox === "read_ahead_hard") {
                rememberSetting("highlightMode", config_1.default.highlightMode, UpdateConfig.setHighlightMode);
            }
        }
        else if (mode === "script") {
            if (funbox === "tts") {
                rememberSetting("keymapMode", config_1.default.keymapMode, UpdateConfig.setKeymapMode);
            }
            else if (funbox === "layoutfluid") {
                rememberSetting("keymapMode", config_1.default.keymapMode, UpdateConfig.setKeymapMode);
                rememberSetting("layout", config_1.default.layout, UpdateConfig.setLayout);
                rememberSetting("keymapLayout", config_1.default.keymapLayout, UpdateConfig.setKeymapLayout);
            }
            else if (funbox === "memory") {
                rememberSetting("mode", config_1.default.mode, UpdateConfig.setMode);
                rememberSetting("showAllLines", config_1.default.showAllLines, UpdateConfig.setShowAllLines);
                if (config_1.default.keymapMode === "next") {
                    rememberSetting("keymapMode", config_1.default.keymapMode, UpdateConfig.setKeymapMode);
                }
            }
            else if (funbox === "nospace") {
                rememberSetting("highlightMode", config_1.default.highlightMode, UpdateConfig.setHighlightMode);
            }
            else if (funbox === "arrows") {
                rememberSetting("highlightMode", config_1.default.highlightMode, UpdateConfig.setHighlightMode);
            }
            else if (funbox === "58008") {
                rememberSetting("numbers", config_1.default.numbers, UpdateConfig.setNumbers);
            }
        }
    });
}
exports.rememberSettings = rememberSettings;


/***/ }),

/***/ "./src/scripts/test/layout-emulator.ts":
/*!*********************************************!*\
  !*** ./src/scripts/test/layout-emulator.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getCharFromEvent = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const caps_warning_1 = __webpack_require__(/*! ./caps-warning */ "./src/scripts/test/caps-warning.ts");
function getCharFromEvent(event) {
    return __awaiter(this, void 0, void 0, function* () {
        function emulatedLayoutShouldShiftKey(event, newKeyPreview) {
            if (caps_warning_1.capsState)
                return Misc.isASCIILetter(newKeyPreview) !== event.shiftKey;
            return event.shiftKey;
        }
        const layout = yield Misc.getLayout(config_1.default.layout);
        let keyEventCodes = [];
        if (layout.type === "ansi") {
            keyEventCodes = [
                "Backquote",
                "Digit1",
                "Digit2",
                "Digit3",
                "Digit4",
                "Digit5",
                "Digit6",
                "Digit7",
                "Digit8",
                "Digit9",
                "Digit0",
                "Minus",
                "Equal",
                "KeyQ",
                "KeyW",
                "KeyE",
                "KeyR",
                "KeyT",
                "KeyY",
                "KeyU",
                "KeyI",
                "KeyO",
                "KeyP",
                "BracketLeft",
                "BracketRight",
                "Backslash",
                "KeyA",
                "KeyS",
                "KeyD",
                "KeyF",
                "KeyG",
                "KeyH",
                "KeyJ",
                "KeyK",
                "KeyL",
                "Semicolon",
                "Quote",
                "KeyZ",
                "KeyX",
                "KeyC",
                "KeyV",
                "KeyB",
                "KeyN",
                "KeyM",
                "Comma",
                "Period",
                "Slash",
                "Space",
            ];
        }
        else if (layout.type === "iso") {
            keyEventCodes = [
                "Backquote",
                "Digit1",
                "Digit2",
                "Digit3",
                "Digit4",
                "Digit5",
                "Digit6",
                "Digit7",
                "Digit8",
                "Digit9",
                "Digit0",
                "Minus",
                "Equal",
                "KeyQ",
                "KeyW",
                "KeyE",
                "KeyR",
                "KeyT",
                "KeyY",
                "KeyU",
                "KeyI",
                "KeyO",
                "KeyP",
                "BracketLeft",
                "BracketRight",
                "KeyA",
                "KeyS",
                "KeyD",
                "KeyF",
                "KeyG",
                "KeyH",
                "KeyJ",
                "KeyK",
                "KeyL",
                "Semicolon",
                "Quote",
                "IntlBackslash",
                "Backquote",
                "KeyZ",
                "KeyX",
                "KeyC",
                "KeyV",
                "KeyB",
                "KeyN",
                "KeyM",
                "Comma",
                "Period",
                "Slash",
                "Space",
            ];
        }
        else if (layout.type === "matrix") {
            keyEventCodes = [
                "Backquote",
                "Digit1",
                "Digit2",
                "Digit3",
                "Digit4",
                "Digit5",
                "Digit6",
                "Digit7",
                "Digit8",
                "Digit9",
                "Digit0",
                "Minus",
                "Equal",
                "KeyQ",
                "KeyW",
                "KeyE",
                "KeyR",
                "KeyT",
                "KeyY",
                "KeyU",
                "KeyI",
                "KeyO",
                "KeyP",
                "BracketLeft",
                "BracketRight",
                "Backslash",
                "KeyA",
                "KeyS",
                "KeyD",
                "KeyF",
                "KeyG",
                "KeyH",
                "KeyJ",
                "KeyK",
                "KeyL",
                "Semicolon",
                "Quote",
                "KeyZ",
                "KeyX",
                "KeyC",
                "KeyV",
                "KeyB",
                "KeyN",
                "KeyM",
                "Comma",
                "Period",
                "Slash",
                "Space",
            ];
        }
        const layoutKeys = layout.keys;
        const layoutMap = layoutKeys["row1"]
            .concat(layoutKeys["row2"])
            .concat(layoutKeys["row3"])
            .concat(layoutKeys["row4"])
            .concat(layoutKeys["row5"]);
        let mapIndex = null;
        for (let i = 0; i < keyEventCodes.length; i++) {
            if (event.code == keyEventCodes[i]) {
                mapIndex = i;
            }
        }
        if (!mapIndex) {
            if (event.code.includes("Numpad")) {
                return event.key;
            }
            else {
                return null;
            }
        }
        const newKeyPreview = layoutMap[mapIndex][0];
        const shift = emulatedLayoutShouldShiftKey(event, newKeyPreview) ? 1 : 0;
        const char = layoutMap[mapIndex][shift];
        if (char) {
            return char;
        }
        else {
            return event.key;
        }
    });
}
exports.getCharFromEvent = getCharFromEvent;


/***/ }),

/***/ "./src/scripts/test/lazy-mode.ts":
/*!***************************************!*\
  !*** ./src/scripts/test/lazy-mode.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.replaceAccents = void 0;
const accents = [
    ["", "a"],
    ["", "e"],
    ["", "i"],
    ["", "o"],
    ["", "u"],
    ["", "n"],
    ["", "c"],
    ["", "r"],
    ["", "d"],
    ["", "t"],
    ["", "ae"],
    ["", "oe"],
    ["", "w"],
    ["g", "g"],
    ["", "h"],
    ["", "j"],
    ["", "n"],
    ["", "s"],
    ["", "z"],
    ["", "y"],
    ["", "l"],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
    ["", ""],
];
function replaceAccents(word, accentsOverride) {
    let newWord = word;
    if (!accents && !accentsOverride)
        return newWord;
    let regex;
    const list = accentsOverride || accents;
    for (let i = 0; i < list.length; i++) {
        regex = new RegExp(`[${list[i][0]}]`, "gi");
        newWord = newWord.replace(regex, list[i][1]);
    }
    return newWord;
}
exports.replaceAccents = replaceAccents;


/***/ }),

/***/ "./src/scripts/test/live-acc.ts":
/*!**************************************!*\
  !*** ./src/scripts/test/live-acc.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = exports.update = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
function update(acc) {
    let number = Math.floor(acc);
    if (config_1.default.blindMode) {
        number = 100;
    }
    document.querySelector("#miniTimerAndLiveWpm .acc").innerHTML =
        number + "%";
    document.querySelector("#liveAcc").innerHTML = number + "%";
}
exports.update = update;
function show() {
    if (!config_1.default.showLiveAcc)
        return;
    if (!TestActive.get())
        return;
    if (config_1.default.timerStyle === "mini") {
        // $("#miniTimerAndLiveWpm .wpm").css("opacity", Config.timerOpacity);
        if (!$("#miniTimerAndLiveWpm .acc").hasClass("hidden"))
            return;
        $("#miniTimerAndLiveWpm .acc")
            .removeClass("hidden")
            .css("opacity", 0)
            .animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
    else {
        // $("#liveWpm").css("opacity", Config.timerOpacity);
        if (!$("#liveAcc").hasClass("hidden"))
            return;
        $("#liveAcc").removeClass("hidden").css("opacity", 0).animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
}
exports.show = show;
function hide() {
    // $("#liveWpm").css("opacity", 0);
    // $("#miniTimerAndLiveWpm .wpm").css("opacity", 0);
    $("#liveAcc").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#liveAcc").addClass("hidden");
    });
    $("#miniTimerAndLiveWpm .acc").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#miniTimerAndLiveWpm .acc").addClass("hidden");
    });
}
exports.hide = hide;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "showLiveAcc")
        eventValue ? show() : hide();
});


/***/ }),

/***/ "./src/scripts/test/live-burst.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/live-burst.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = exports.update = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
function update(burst) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!config_1.default.showLiveBurst)
            return;
        let number = burst;
        if (config_1.default.blindMode) {
            number = 0;
        }
        document.querySelector("#miniTimerAndLiveWpm .burst").innerHTML =
            number.toString();
        document.querySelector("#liveBurst").innerHTML =
            number.toString();
    });
}
exports.update = update;
function show() {
    if (!config_1.default.showLiveBurst)
        return;
    if (!TestActive.get())
        return;
    if (config_1.default.timerStyle === "mini") {
        if (!$("#miniTimerAndLiveWpm .burst").hasClass("hidden"))
            return;
        $("#miniTimerAndLiveWpm .burst")
            .removeClass("hidden")
            .css("opacity", 0)
            .animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
    else {
        if (!$("#liveBurst").hasClass("hidden"))
            return;
        $("#liveBurst").removeClass("hidden").css("opacity", 0).animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
}
exports.show = show;
function hide() {
    $("#liveBurst").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#liveBurst").addClass("hidden");
    });
    $("#miniTimerAndLiveWpm .burst").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#miniTimerAndLiveWpm .burst").addClass("hidden");
    });
}
exports.hide = hide;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "showLiveBurst")
        eventValue ? show() : hide();
});


/***/ }),

/***/ "./src/scripts/test/live-wpm.ts":
/*!**************************************!*\
  !*** ./src/scripts/test/live-wpm.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = exports.update = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const liveWpmElement = document.querySelector("#liveWpm");
const miniLiveWpmElement = document.querySelector("#miniTimerAndLiveWpm .wpm");
function update(wpm, raw) {
    // if (!TestActive.get() || !Config.showLiveWpm) {
    //   hideLiveWpm();
    // } else {
    //   showLiveWpm();
    // }
    let number = wpm;
    if (config_1.default.blindMode) {
        number = raw;
    }
    if (config_1.default.alwaysShowCPM) {
        number = Math.round(number * 5);
    }
    miniLiveWpmElement.innerHTML = number.toString();
    liveWpmElement.innerHTML = number.toString();
}
exports.update = update;
function show() {
    if (!config_1.default.showLiveWpm)
        return;
    if (!TestActive.get())
        return;
    if (config_1.default.timerStyle === "mini") {
        // $("#miniTimerAndLiveWpm .wpm").css("opacity", Config.timerOpacity);
        if (!$("#miniTimerAndLiveWpm .wpm").hasClass("hidden"))
            return;
        $("#miniTimerAndLiveWpm .wpm")
            .removeClass("hidden")
            .css("opacity", 0)
            .animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
    else {
        // $("#liveWpm").css("opacity", Config.timerOpacity);
        if (!$("#liveWpm").hasClass("hidden"))
            return;
        $("#liveWpm").removeClass("hidden").css("opacity", 0).animate({
            opacity: config_1.default.timerOpacity,
        }, 125);
    }
}
exports.show = show;
function hide() {
    $("#liveWpm").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#liveWpm").addClass("hidden");
    });
    $("#miniTimerAndLiveWpm .wpm").animate({
        opacity: config_1.default.timerOpacity,
    }, 125, () => {
        $("#miniTimerAndLiveWpm .wpm").addClass("hidden");
    });
}
exports.hide = hide;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "showLiveWpm")
        eventValue ? show() : hide();
});


/***/ }),

/***/ "./src/scripts/test/manual-restart-tracker.ts":
/*!****************************************************!*\
  !*** ./src/scripts/test/manual-restart-tracker.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.get = exports.reset = exports.set = void 0;
let state = false;
function set() {
    state = true;
}
exports.set = set;
function reset() {
    state = false;
}
exports.reset = reset;
function get() {
    return state;
}
exports.get = get;


/***/ }),

/***/ "./src/scripts/test/monkey.ts":
/*!************************************!*\
  !*** ./src/scripts/test/monkey.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hide = exports.show = exports.stop = exports.type = exports.updateFastOpacity = void 0;
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "monkey" && TestActive.get()) {
        if (config_1.default.monkey) {
            $("#monkey").removeClass("hidden");
        }
        else {
            $("#monkey").addClass("hidden");
        }
    }
});
let left = false;
let right = false;
// 0 hand up
// 1 hand down
// 00 both hands up
// 01 right hand down
// 10 left hand down
// 11 both hands down
const elements = {
    "00": document.querySelector("#monkey .up"),
    "01": document.querySelector("#monkey .right"),
    "10": document.querySelector("#monkey .left"),
    "11": document.querySelector("#monkey .both"),
};
const elementsFast = {
    "00": document.querySelector("#monkey .fast .up"),
    "01": document.querySelector("#monkey .fast .right"),
    "10": document.querySelector("#monkey .fast .left"),
    "11": document.querySelector("#monkey .fast .both"),
};
let last = "right";
function toBit(b) {
    return b ? "1" : "0";
}
function update() {
    var _a, _b, _c;
    if (!config_1.default.monkey)
        return;
    if (!((_a = document.querySelector("#monkey")) === null || _a === void 0 ? void 0 : _a.classList.contains("hidden"))) {
        Object.keys(elements).forEach((key) => {
            var _a;
            (_a = elements[key]) === null || _a === void 0 ? void 0 : _a.classList.add("hidden");
        });
        Object.keys(elementsFast).forEach((key) => {
            var _a;
            (_a = elementsFast[key]) === null || _a === void 0 ? void 0 : _a.classList.add("hidden");
        });
        const id = `${toBit(left)}${toBit(right)}`;
        (_b = elements[id]) === null || _b === void 0 ? void 0 : _b.classList.remove("hidden");
        (_c = elementsFast[id]) === null || _c === void 0 ? void 0 : _c.classList.remove("hidden");
    }
}
function updateFastOpacity(num) {
    if (!config_1.default.monkey)
        return;
    const opacity = (0, misc_1.mapRange)(num, 130, 180, 0, 1);
    $("#monkey .fast").animate({ opacity: opacity }, 1000);
    let animDuration = (0, misc_1.mapRange)(num, 130, 180, 0.25, 0.01);
    if (animDuration == 0.25)
        animDuration = 0;
    $("#monkey").css({ animationDuration: animDuration + "s" });
}
exports.updateFastOpacity = updateFastOpacity;
function type() {
    if (!config_1.default.monkey)
        return;
    if (!left && last == "right") {
        left = true;
        last = "left";
    }
    else if (!right) {
        right = true;
        last = "right";
    }
    update();
}
exports.type = type;
function stop() {
    if (!config_1.default.monkey)
        return;
    if (left) {
        left = false;
    }
    else if (right) {
        right = false;
    }
    update();
}
exports.stop = stop;
function show() {
    if (!config_1.default.monkey)
        return;
    $("#monkey")
        .css("opacity", 0)
        .removeClass("hidden")
        .animate({ opacity: 1 }, 125);
}
exports.show = show;
function hide() {
    $("#monkey")
        .css("opacity", 1)
        .animate({ opacity: 1 }, 125, () => {
        $("#monkey").addClass("hidden");
    });
}
exports.hide = hide;


/***/ }),

/***/ "./src/scripts/test/out-of-focus.ts":
/*!******************************************!*\
  !*** ./src/scripts/test/out-of-focus.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.hide = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const outOfFocusTimeouts = [];
function hide() {
    $("#words").css("transition", "none").removeClass("blurred");
    $(".outOfFocusWarning").addClass("hidden");
    Misc.clearTimeouts(outOfFocusTimeouts);
}
exports.hide = hide;
function show() {
    outOfFocusTimeouts.push(setTimeout(() => {
        $("#words").css("transition", "0.25s").addClass("blurred");
        $(".outOfFocusWarning").removeClass("hidden");
    }, 1000));
}
exports.show = show;


/***/ }),

/***/ "./src/scripts/test/pace-caret.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/pace-caret.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.start = exports.handleSpace = exports.reset = exports.update = exports.init = exports.settings = void 0;
const TestStats = __importStar(__webpack_require__(/*! ./test-stats */ "./src/scripts/test/test-stats.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const TestUI = __importStar(__webpack_require__(/*! ./test-ui */ "./src/scripts/test/test-ui.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const TestState = __importStar(__webpack_require__(/*! ./test-state */ "./src/scripts/test/test-state.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
exports.settings = null;
function resetCaretPosition() {
    var _a;
    if (config_1.default.paceCaret === "off" && !TestState.isPaceRepeat)
        return;
    if (!$("#paceCaret").hasClass("hidden")) {
        $("#paceCaret").addClass("hidden");
    }
    if (config_1.default.mode === "zen")
        return;
    const caret = $("#paceCaret");
    const firstLetter = ((_a = document === null || document === void 0 ? void 0 : document.querySelector("#words .word")) === null || _a === void 0 ? void 0 : _a.querySelector("letter"));
    const firstLetterHeight = $(firstLetter).height();
    if (firstLetter === undefined || firstLetterHeight === undefined)
        return;
    caret.stop(true, true).animate({
        top: firstLetter.offsetTop - firstLetterHeight / 4,
        left: firstLetter.offsetLeft,
    }, 0, "linear");
}
function init() {
    return __awaiter(this, void 0, void 0, function* () {
        $("#paceCaret").addClass("hidden");
        const mode2 = Misc.getMode2(config_1.default, TestWords.randomQuote);
        let wpm;
        if (config_1.default.paceCaret === "pb") {
            wpm = yield DB.getLocalPB(config_1.default.mode, mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode, config_1.default.funbox);
        }
        else if (config_1.default.paceCaret === "average") {
            [wpm] = yield DB.getUserAverage10(config_1.default.mode, mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode);
            wpm = Math.round(wpm);
        }
        else if (config_1.default.paceCaret === "custom") {
            wpm = config_1.default.paceCaretCustomSpeed;
        }
        else if (TestState.isPaceRepeat == true) {
            wpm = TestStats.lastTestWpm;
        }
        if (wpm === undefined || wpm < 1 || Number.isNaN(wpm)) {
            exports.settings = null;
            return;
        }
        const characters = wpm * 5;
        const cps = characters / 60; //characters per step
        const spc = 60 / characters; //seconds per character
        exports.settings = {
            wpm: wpm,
            cps: cps,
            spc: spc,
            correction: 0,
            currentWordIndex: 0,
            currentLetterIndex: -1,
            wordsStatus: {},
            timeout: null,
        };
        resetCaretPosition();
    });
}
exports.init = init;
function update(expectedStepEnd) {
    if (exports.settings === null || !TestActive.get() || TestUI.resultVisible) {
        return;
    }
    // if ($("#paceCaret").hasClass("hidden")) {
    //   $("#paceCaret").removeClass("hidden");
    // }
    try {
        exports.settings.currentLetterIndex++;
        if (exports.settings.currentLetterIndex >=
            TestWords.words.get(exports.settings.currentWordIndex).length) {
            //go to the next word
            exports.settings.currentLetterIndex = -1;
            exports.settings.currentWordIndex++;
        }
        if (!config_1.default.blindMode) {
            if (exports.settings.correction < 0) {
                while (exports.settings.correction < 0) {
                    exports.settings.currentLetterIndex--;
                    if (exports.settings.currentLetterIndex <= -2) {
                        //go to the previous word
                        exports.settings.currentLetterIndex =
                            TestWords.words.get(exports.settings.currentWordIndex - 1).length - 1;
                        exports.settings.currentWordIndex--;
                    }
                    exports.settings.correction++;
                }
            }
            else if (exports.settings.correction > 0) {
                while (exports.settings.correction > 0) {
                    exports.settings.currentLetterIndex++;
                    if (exports.settings.currentLetterIndex >=
                        TestWords.words.get(exports.settings.currentWordIndex).length) {
                        //go to the next word
                        exports.settings.currentLetterIndex = -1;
                        exports.settings.currentWordIndex++;
                    }
                    exports.settings.correction--;
                }
            }
        }
    }
    catch (e) {
        //out of words
        exports.settings = null;
        $("#paceCaret").addClass("hidden");
        return;
    }
    try {
        const caret = $("#paceCaret");
        let currentLetter;
        let newTop;
        let newLeft;
        try {
            const newIndex = exports.settings.currentWordIndex -
                (TestWords.words.currentIndex - TestUI.currentWordElementIndex);
            const word = document.querySelectorAll("#words .word")[newIndex];
            if (exports.settings.currentLetterIndex === -1) {
                currentLetter = word.querySelectorAll("letter")[0];
            }
            else {
                currentLetter = (word.querySelectorAll("letter")[exports.settings.currentLetterIndex]);
            }
            const currentLetterHeight = $(currentLetter).height(), currentLetterWidth = $(currentLetter).width(), caretWidth = caret.width();
            if (currentLetterHeight === undefined ||
                currentLetterWidth === undefined ||
                caretWidth === undefined) {
                throw ``;
            }
            newTop = currentLetter.offsetTop - currentLetterHeight / 5;
            newLeft;
            if (exports.settings.currentLetterIndex === -1) {
                newLeft = currentLetter.offsetLeft;
            }
            else {
                newLeft =
                    currentLetter.offsetLeft + currentLetterWidth - caretWidth / 2;
            }
            caret.removeClass("hidden");
        }
        catch (e) {
            caret.addClass("hidden");
        }
        const duration = expectedStepEnd - performance.now();
        if (newTop !== undefined) {
            let smoothlinescroll = $("#words .smoothScroller").height();
            if (smoothlinescroll === undefined)
                smoothlinescroll = 0;
            $("#paceCaret").css({
                top: newTop - smoothlinescroll,
            });
            if (config_1.default.smoothCaret) {
                caret.stop(true, true).animate({
                    left: newLeft,
                }, SlowTimer.get() ? 0 : duration, "linear");
            }
            else {
                caret.stop(true, true).animate({
                    left: newLeft,
                }, 0, "linear");
            }
        }
        exports.settings.timeout = setTimeout(() => {
            var _a;
            try {
                update(expectedStepEnd + ((_a = exports.settings === null || exports.settings === void 0 ? void 0 : exports.settings.spc) !== null && _a !== void 0 ? _a : 0) * 1000);
            }
            catch (e) {
                exports.settings = null;
            }
        }, duration);
    }
    catch (e) {
        console.error(e);
        $("#paceCaret").addClass("hidden");
    }
}
exports.update = update;
function reset() {
    if (exports.settings !== null && exports.settings.timeout !== null) {
        clearTimeout(exports.settings.timeout);
    }
    exports.settings = null;
}
exports.reset = reset;
function handleSpace(correct, currentWord) {
    if (correct) {
        if (exports.settings !== null &&
            exports.settings.wordsStatus[TestWords.words.currentIndex] === true &&
            !config_1.default.blindMode) {
            exports.settings.wordsStatus[TestWords.words.currentIndex] = undefined;
            exports.settings.correction -= currentWord.length + 1;
        }
    }
    else {
        if (exports.settings !== null &&
            exports.settings.wordsStatus[TestWords.words.currentIndex] === undefined &&
            !config_1.default.blindMode) {
            exports.settings.wordsStatus[TestWords.words.currentIndex] = true;
            exports.settings.correction += currentWord.length + 1;
        }
    }
}
exports.handleSpace = handleSpace;
function start() {
    var _a;
    update(performance.now() + ((_a = exports.settings === null || exports.settings === void 0 ? void 0 : exports.settings.spc) !== null && _a !== void 0 ? _a : 0) * 1000);
}
exports.start = start;
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "paceCaret")
        init();
});


/***/ }),

/***/ "./src/scripts/test/pb-crown.ts":
/*!**************************************!*\
  !*** ./src/scripts/test/pb-crown.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.show = exports.hide = void 0;
function hide() {
    $("#result .stats .wpm .crown").css("opacity", 0).addClass("hidden");
}
exports.hide = hide;
function show() {
    $("#result .stats .wpm .crown")
        .removeClass("hidden")
        .css("opacity", "0")
        .animate({
        opacity: 1,
    }, 250, "easeOutCubic");
}
exports.show = show;


/***/ }),

/***/ "./src/scripts/test/poetry.ts":
/*!************************************!*\
  !*** ./src/scripts/test/poetry.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getPoem = exports.Poem = void 0;
const axios_1 = __importDefault(__webpack_require__(/*! axios */ "./node_modules/axios/index.js"));
const bannedChars = ["", "_", " "];
const maxWords = 100;
const apiURL = "https://poetrydb.org/random";
class Poem {
    constructor(title, author, words) {
        this.title = title;
        this.author = author;
        this.words = words;
        this.cleanUpText();
    }
    cleanUpText() {
        let count = 0;
        const scrubbedWords = [];
        for (let i = 0; i < this.words.length; i++) {
            let scrubbed = "";
            for (let j = 0; j < this.words[i].length; j++) {
                if (!bannedChars.includes(this.words[i][j])) {
                    scrubbed += this.words[i][j];
                }
            }
            if (scrubbed == "")
                continue;
            scrubbedWords.push(scrubbed);
            count++;
            if (count == maxWords)
                break;
        }
        this.words = scrubbedWords;
    }
}
exports.Poem = Poem;
function getPoem() {
    return __awaiter(this, void 0, void 0, function* () {
        console.log("Getting poem");
        const response = yield axios_1.default.get(apiURL);
        try {
            const poemObj = response.data[0];
            const words = [];
            poemObj.lines.forEach((line) => {
                line.split(/ +/).forEach((word) => {
                    words.push(word);
                });
            });
            return new Poem(poemObj.title, poemObj.author, words);
        }
        catch (e) {
            console.log(e);
        }
        return;
    });
}
exports.getPoem = getPoem;


/***/ }),

/***/ "./src/scripts/test/practise-words.ts":
/*!********************************************!*\
  !*** ./src/scripts/test/practise-words.ts ***!
  \********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.hidePopup = exports.showPopup = exports.resetBefore = exports.init = exports.before = void 0;
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const CustomText = __importStar(__webpack_require__(/*! ./custom-text */ "./src/scripts/test/custom-text.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
exports.before = {
    mode: null,
    punctuation: null,
    numbers: null,
};
function init(missed, slow) {
    if (config_1.default.mode === "zen")
        return;
    let limit;
    if ((missed && !slow) || (!missed && slow)) {
        limit = 20;
    }
    else if (missed && slow) {
        limit = 10;
    }
    else {
        limit = 10;
    }
    let sortableMissedWords = [];
    if (missed) {
        Object.keys(TestInput.missedWords).forEach((missedWord) => {
            sortableMissedWords.push([missedWord, TestInput.missedWords[missedWord]]);
        });
        sortableMissedWords.sort((a, b) => {
            return b[1] - a[1];
        });
        sortableMissedWords = sortableMissedWords.slice(0, limit);
    }
    if (missed && !slow && sortableMissedWords.length == 0) {
        Notifications.add("You haven't missed any words", 0);
        return;
    }
    let sortableSlowWords = [];
    if (slow) {
        sortableSlowWords = TestWords.words.get().map((e, i) => [
            e,
            TestInput.burstHistory[i],
        ]);
        sortableSlowWords.sort((a, b) => {
            return a[1] - b[1];
        });
        sortableSlowWords = sortableSlowWords.slice(0, Math.min(limit, Math.round(TestWords.words.length * 0.2)));
    }
    // console.log(sortableMissedWords);
    // console.log(sortableSlowWords);
    if (sortableMissedWords.length == 0 && sortableSlowWords.length == 0) {
        Notifications.add("Could not start a new custom test", 0);
        return;
    }
    const newCustomText = [];
    sortableMissedWords.forEach((missed) => {
        for (let i = 0; i < missed[1]; i++) {
            newCustomText.push(missed[0]);
        }
    });
    sortableSlowWords.forEach((slow, index) => {
        for (let i = 0; i < sortableSlowWords.length - index; i++) {
            newCustomText.push(slow[0]);
        }
    });
    // console.log(newCustomText);
    const mode = exports.before.mode === null ? config_1.default.mode : exports.before.mode;
    const punctuation = exports.before.punctuation === null ? config_1.default.punctuation : exports.before.punctuation;
    const numbers = exports.before.numbers === null ? config_1.default.numbers : exports.before.numbers;
    UpdateConfig.setMode("custom");
    CustomText.setText(newCustomText);
    CustomText.setIsWordRandom(true);
    CustomText.setWord((sortableSlowWords.length + sortableMissedWords.length) * 5);
    CustomText.setTime(-1);
    exports.before.mode = mode;
    exports.before.punctuation = punctuation;
    exports.before.numbers = numbers;
}
exports.init = init;
function resetBefore() {
    exports.before.mode = null;
    exports.before.punctuation = null;
    exports.before.numbers = null;
}
exports.resetBefore = resetBefore;
function showPopup(focus = false) {
    if ($("#practiseWordsPopupWrapper").hasClass("hidden")) {
        if (config_1.default.mode === "zen") {
            Notifications.add("Practice words is unsupported in zen mode", 0);
            return;
        }
        $("#practiseWordsPopupWrapper")
            .stop(true, true)
            .css("opacity", 0)
            .removeClass("hidden")
            .animate({ opacity: 1 }, 100, () => {
            if (focus) {
                console.log("focusing");
                $("#practiseWordsPopup .missed").trigger("focus");
            }
        });
    }
}
exports.showPopup = showPopup;
function hidePopup() {
    if (!$("#practiseWordsPopupWrapper").hasClass("hidden")) {
        $("#practiseWordsPopupWrapper")
            .stop(true, true)
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, 100, () => {
            $("#practiseWordsPopupWrapper").addClass("hidden");
        });
    }
}
exports.hidePopup = hidePopup;
$("#practiseWordsPopupWrapper").on("click", (e) => {
    if ($(e.target).attr("id") === "practiseWordsPopupWrapper") {
        hidePopup();
    }
});
$("#practiseWordsPopup .button").on("keypress", (e) => {
    if (e.key === "Enter") {
        $(e.currentTarget).click();
    }
});
$("#practiseWordsPopup .button.both").on("focusout", (e) => {
    e.preventDefault();
    $("#practiseWordsPopup .missed").trigger("focus");
});
$(document).on("keydown", (event) => {
    if (event.key === "Escape" &&
        !$("#practiseWordsPopupWrapper").hasClass("hidden")) {
        hidePopup();
        event.preventDefault();
    }
});
$(document).on("keypress", "#practiseWordsButton", (event) => {
    if (event.key === "Enter") {
        showPopup(true);
    }
});
$(document.body).on("click", "#practiseWordsButton", () => {
    showPopup();
});
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "mode")
        resetBefore();
});


/***/ }),

/***/ "./src/scripts/test/replay.ts":
/*!************************************!*\
  !*** ./src/scripts/test/replay.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getReplayExport = exports.replayGetWordsList = exports.addReplayEvent = exports.stopReplayRecording = exports.startReplayRecording = exports.pauseReplay = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Sound = __importStar(__webpack_require__(/*! ../controllers/sound-controller */ "./src/scripts/controllers/sound-controller.ts"));
let wordsList = [];
let replayData = [];
let replayStartTime = 0;
let replayRecording = true;
let wordPos = 0;
let curPos = 0;
let targetWordPos = 0;
let targetCurPos = 0;
let timeoutList = [];
let stopwatchList = [];
const toggleButton = (_a = document.getElementById("playpauseReplayButton")) === null || _a === void 0 ? void 0 : _a.children[0];
function replayGetWordsList(wordsListFromScript) {
    wordsList = wordsListFromScript;
}
exports.replayGetWordsList = replayGetWordsList;
function initializeReplayPrompt() {
    const replayWordsElement = document.getElementById("replayWords");
    if (replayWordsElement === null)
        return;
    replayWordsElement.innerHTML = "";
    let wordCount = 0;
    replayData.forEach((item) => {
        //trim wordsList for timed tests
        if (item.action === "backWord") {
            wordCount--;
        }
        else if (item.action === "submitCorrectWord" ||
            item.action === "submitErrorWord") {
            wordCount++;
        }
    });
    wordsList.forEach((item, i) => {
        if (i > wordCount)
            return;
        const x = document.createElement("div");
        x.className = "word";
        for (i = 0; i < item.length; i++) {
            const letter = document.createElement("letter");
            letter.innerHTML = item[i];
            x.appendChild(letter);
        }
        replayWordsElement.appendChild(x);
    });
}
function pauseReplay() {
    var _a;
    timeoutList.forEach((item) => {
        clearTimeout(item);
    });
    timeoutList = [];
    stopwatchList.forEach((item) => {
        clearTimeout(item);
    });
    stopwatchList = [];
    targetCurPos = curPos;
    targetWordPos = wordPos;
    if (toggleButton === undefined)
        return;
    toggleButton.className = "fas fa-play";
    (_a = toggleButton.parentNode) === null || _a === void 0 ? void 0 : _a.setAttribute("aria-label", "Resume replay");
}
exports.pauseReplay = pauseReplay;
function playSound(error = false) {
    if (error) {
        if (config_1.default.playSoundOnError) {
            Sound.playError();
        }
        else {
            Sound.playClick();
        }
    }
    else {
        Sound.playClick();
    }
}
function handleDisplayLogic(item, nosound = false) {
    var _a, _b, _c;
    let activeWord = (_a = document.getElementById("replayWords")) === null || _a === void 0 ? void 0 : _a.children[wordPos];
    if (activeWord === undefined)
        return;
    if (item.action === "correctLetter") {
        if (!nosound)
            playSound();
        activeWord.children[curPos].classList.add("correct");
        curPos++;
    }
    else if (item.action === "incorrectLetter") {
        if (!nosound)
            playSound(true);
        let myElement;
        if (curPos >= activeWord.children.length) {
            //if letter is an extra
            myElement = document.createElement("letter");
            myElement.classList.add("extra");
            myElement.innerHTML = (_c = (_b = item.value) === null || _b === void 0 ? void 0 : _b.toString()) !== null && _c !== void 0 ? _c : "";
            activeWord.appendChild(myElement);
        }
        myElement = activeWord.children[curPos];
        myElement.classList.add("incorrect");
        curPos++;
    }
    else if (item.action === "setLetterIndex" &&
        typeof item.value === "number") {
        if (!nosound)
            playSound();
        curPos = item.value;
        // remove all letters from cursor to end of word
        for (const myElement of [...activeWord.children].slice(curPos)) {
            if (myElement.classList.contains("extra")) {
                myElement.remove();
            }
            else {
                myElement.className = "";
            }
        }
    }
    else if (item.action === "submitCorrectWord") {
        if (!nosound)
            playSound();
        wordPos++;
        curPos = 0;
    }
    else if (item.action === "submitErrorWord") {
        if (!nosound)
            playSound(true);
        activeWord.classList.add("error");
        wordPos++;
        curPos = 0;
    }
    else if (item.action === "backWord") {
        if (!nosound)
            playSound();
        wordPos--;
        const replayWords = document.getElementById("replayWords");
        if (replayWords !== null)
            activeWord = replayWords.children[wordPos];
        curPos = activeWord.children.length;
        while (activeWord.children[curPos - 1].className === "")
            curPos--;
        activeWord.classList.remove("error");
    }
}
function loadOldReplay() {
    let startingIndex = 0;
    curPos = 0;
    wordPos = 0;
    replayData.forEach((item, i) => {
        if (wordPos < targetWordPos ||
            (wordPos === targetWordPos && curPos < targetCurPos)) {
            //quickly display everything up to the target
            handleDisplayLogic(item, true);
            startingIndex = i + 1;
        }
    });
    const time = Math.floor(replayData[startingIndex].time / 1000);
    $("#replayStopwatch").text(time + "s");
    return startingIndex;
}
function toggleReplayDisplay() {
    var _a;
    if ($("#resultReplay").stop(true, true).hasClass("hidden")) {
        initializeReplayPrompt();
        loadOldReplay();
        //show
        if (!$("#watchReplayButton").hasClass("loaded")) {
            $("#words").html(`<div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>`);
            $("#resultReplay")
                .removeClass("hidden")
                .css("display", "none")
                .slideDown(250);
        }
        else {
            $("#resultReplay")
                .removeClass("hidden")
                .css("display", "none")
                .slideDown(250);
        }
    }
    else {
        //hide
        if (((_a = toggleButton === null || toggleButton === void 0 ? void 0 : toggleButton.parentNode) === null || _a === void 0 ? void 0 : _a.getAttribute("aria-label")) !=
            "Start replay") {
            pauseReplay();
        }
        $("#resultReplay").slideUp(250, () => {
            $("#resultReplay").addClass("hidden");
        });
    }
}
function startReplayRecording() {
    if (!$("#resultReplay").stop(true, true).hasClass("hidden")) {
        //hide replay display if user left it open
        toggleReplayDisplay();
    }
    $("#replayStopwatch").text(0 + "s");
    replayData = [];
    replayStartTime = performance.now();
    replayRecording = true;
    targetCurPos = 0;
    targetWordPos = 0;
}
exports.startReplayRecording = startReplayRecording;
function stopReplayRecording() {
    replayRecording = false;
}
exports.stopReplayRecording = stopReplayRecording;
function addReplayEvent(action, value) {
    if (!replayRecording) {
        return;
    }
    const timeDelta = performance.now() - replayStartTime;
    replayData.push({ action: action, value: value, time: timeDelta });
}
exports.addReplayEvent = addReplayEvent;
function playReplay() {
    var _a;
    curPos = 0;
    wordPos = 0;
    if (toggleButton === undefined)
        return;
    toggleButton.className = "fas fa-pause";
    (_a = toggleButton.parentNode) === null || _a === void 0 ? void 0 : _a.setAttribute("aria-label", "Pause replay");
    initializeReplayPrompt();
    const startingIndex = loadOldReplay();
    const lastTime = replayData[startingIndex].time;
    let swTime = Math.round(lastTime / 1000); //starting time
    const swEndTime = Math.round(replayData[replayData.length - 1].time / 1000);
    while (swTime <= swEndTime) {
        const time = swTime;
        stopwatchList.push(setTimeout(() => {
            $("#replayStopwatch").text(time + "s");
        }, time * 1000 - lastTime));
        swTime++;
    }
    replayData.forEach((item, i) => {
        if (i < startingIndex)
            return;
        timeoutList.push(setTimeout(() => {
            handleDisplayLogic(item);
        }, item.time - lastTime));
    });
    timeoutList.push(setTimeout(() => {
        //after the replay has finished, this will run
        targetCurPos = 0;
        targetWordPos = 0;
        toggleButton.className = "fas fa-play";
        toggleButton.parentNode.setAttribute("aria-label", "Start replay");
    }, replayData[replayData.length - 1].time - lastTime));
}
function getReplayExport() {
    return JSON.stringify({
        replayData: replayData,
        wordsList: wordsList,
    });
}
exports.getReplayExport = getReplayExport;
$(".pageTest #playpauseReplayButton").on("click", () => {
    if ((toggleButton === null || toggleButton === void 0 ? void 0 : toggleButton.className) === "fas fa-play") {
        playReplay();
    }
    else if ((toggleButton === null || toggleButton === void 0 ? void 0 : toggleButton.className) === "fas fa-pause") {
        pauseReplay();
    }
});
$("#replayWords").on("click", "letter", (event) => {
    var _a;
    //allows user to click on the place they want to start their replay at
    pauseReplay();
    const replayWords = document.querySelector("#replayWords");
    const words = [...((_a = replayWords === null || replayWords === void 0 ? void 0 : replayWords.children) !== null && _a !== void 0 ? _a : [])];
    targetWordPos = words.indexOf(event.target.parentNode);
    const letters = [...words[targetWordPos].children];
    targetCurPos = letters.indexOf(event.target);
    initializeReplayPrompt();
    loadOldReplay();
});
$(document).on("keypress", "#watchReplayButton", (event) => {
    if (event.key === "Enter") {
        toggleReplayDisplay();
    }
});
$(document.body).on("click", "#watchReplayButton", () => {
    toggleReplayDisplay();
});


/***/ }),

/***/ "./src/scripts/test/result.ts":
/*!************************************!*\
  !*** ./src/scripts/test/result.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = exports.updateRateQuote = exports.updateCrown = exports.hideCrown = exports.showCrown = exports.updateTodayTracker = exports.updateGraphPBLine = exports.toggleUnsmoothedRaw = void 0;
const TestUI = __importStar(__webpack_require__(/*! ./test-ui */ "./src/scripts/test/test-ui.ts"));
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const TestStats = __importStar(__webpack_require__(/*! ./test-stats */ "./src/scripts/test/test-stats.ts"));
const Keymap = __importStar(__webpack_require__(/*! ../elements/keymap */ "./src/scripts/elements/keymap.ts"));
const ChartController = __importStar(__webpack_require__(/*! ../controllers/chart-controller */ "./src/scripts/controllers/chart-controller.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const TodayTracker = __importStar(__webpack_require__(/*! ./today-tracker */ "./src/scripts/test/today-tracker.ts"));
const PbCrown = __importStar(__webpack_require__(/*! ./pb-crown */ "./src/scripts/test/pb-crown.ts"));
const QuoteRatePopup = __importStar(__webpack_require__(/*! ../popups/quote-rate-popup */ "./src/scripts/popups/quote-rate-popup.ts"));
const GlarsesMode = __importStar(__webpack_require__(/*! ../states/glarses-mode */ "./src/scripts/states/glarses-mode.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const ResultsShownEvent = __importStar(__webpack_require__(/*! ../observables/results-shown-event */ "./src/scripts/observables/results-shown-event.ts"));
const chart_js_1 = __webpack_require__(/*! chart.js */ "./node_modules/chart.js/dist/chart.esm.js");
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
let result;
let maxChartVal;
let useUnsmoothedRaw = false;
function toggleUnsmoothedRaw() {
    useUnsmoothedRaw = !useUnsmoothedRaw;
    Notifications.add(useUnsmoothedRaw ? "on" : "off", 1);
}
exports.toggleUnsmoothedRaw = toggleUnsmoothedRaw;
let resultAnnotation = [];
let resultScaleOptions = ChartController.result.options.scales;
function updateGraph() {
    var _a, _b;
    return __awaiter(this, void 0, void 0, function* () {
        const labels = [];
        for (let i = 1; i <= TestInput.wpmHistory.length; i++) {
            if (TestStats.lastSecondNotRound && i === TestInput.wpmHistory.length) {
                labels.push(Misc.roundTo2(result.testDuration).toString());
            }
            else {
                labels.push(i.toString());
            }
        }
        ChartController.result.data.labels = labels;
        resultScaleOptions["wpm"].title.text = config_1.default.alwaysShowCPM
            ? "Character per Minute"
            : "Words per Minute";
        const chartData1 = config_1.default.alwaysShowCPM
            ? TestInput.wpmHistory.map((a) => a * 5)
            : TestInput.wpmHistory;
        let chartData2;
        if (result.chartData === "toolong")
            return;
        if (useUnsmoothedRaw) {
            chartData2 =
                (_b = (config_1.default.alwaysShowCPM
                    ? (_a = result.chartData.unsmoothedRaw) === null || _a === void 0 ? void 0 : _a.map((a) => a * 5)
                    : result.chartData.unsmoothedRaw)) !== null && _b !== void 0 ? _b : [];
        }
        else {
            chartData2 = config_1.default.alwaysShowCPM
                ? result.chartData.raw.map((a) => a * 5)
                : result.chartData.raw;
        }
        ChartController.result.data.datasets[0].data = chartData1;
        ChartController.result.data.datasets[1].data = chartData2;
        ChartController.result.data.datasets[0].label = config_1.default.alwaysShowCPM
            ? "cpm"
            : "wpm";
        maxChartVal = Math.max(...[Math.max(...chartData2), Math.max(...chartData1)]);
        if (!config_1.default.startGraphsAtZero) {
            const minChartVal = Math.min(...[Math.min(...chartData2), Math.min(...chartData1)]);
            resultScaleOptions["wpm"].min = minChartVal;
            resultScaleOptions["raw"].min = minChartVal;
        }
        else {
            resultScaleOptions["wpm"].min = 0;
            resultScaleOptions["raw"].min = 0;
        }
        ChartController.result.data.datasets[2].data = result.chartData.err;
        const fc = yield ThemeColors.get("sub");
        if (config_1.default.funbox !== "none") {
            let content = config_1.default.funbox;
            if (config_1.default.funbox === "layoutfluid") {
                content += " " + config_1.default.customLayoutfluid.replace(/#/g, " ");
            }
            resultAnnotation.push({
                display: true,
                id: "funbox-label",
                type: "line",
                scaleID: "wpm",
                value: resultScaleOptions["wpm"].min,
                borderColor: "transparent",
                borderWidth: 1,
                borderDash: [2, 2],
                label: {
                    backgroundColor: "transparent",
                    font: {
                        family: config_1.default.fontFamily.replace(/_/g, " "),
                        size: 11,
                        style: "normal",
                        weight: chart_js_1.Chart.defaults.font.weight,
                        lineHeight: chart_js_1.Chart.defaults.font.lineHeight,
                    },
                    color: fc,
                    padding: 3,
                    borderRadius: 3,
                    position: "start",
                    enabled: true,
                    content: `${content}`,
                },
            });
        }
        resultScaleOptions["wpm"].max = maxChartVal;
        resultScaleOptions["raw"].max = maxChartVal;
        resultScaleOptions["error"].max = Math.max(...result.chartData.err) + 1;
    });
}
function updateGraphPBLine() {
    var _a, _b, _c;
    return __awaiter(this, void 0, void 0, function* () {
        const themecolors = yield ThemeColors.getAll();
        const lpb = yield DB.getLocalPB(result.mode, result.mode2, (_a = result.punctuation) !== null && _a !== void 0 ? _a : false, result.language, result.difficulty, (_b = result.lazyMode) !== null && _b !== void 0 ? _b : false, (_c = result.funbox) !== null && _c !== void 0 ? _c : "none");
        if (lpb == 0)
            return;
        const chartlpb = Misc.roundTo2(config_1.default.alwaysShowCPM ? lpb * 5 : lpb).toFixed(2);
        resultAnnotation.push({
            display: true,
            type: "line",
            id: "lpb",
            scaleID: "wpm",
            value: chartlpb,
            borderColor: themecolors["sub"],
            borderWidth: 1,
            borderDash: [2, 2],
            label: {
                backgroundColor: themecolors["sub"],
                font: {
                    family: config_1.default.fontFamily.replace(/_/g, " "),
                    size: 11,
                    style: "normal",
                    weight: chart_js_1.Chart.defaults.font.weight,
                    lineHeight: chart_js_1.Chart.defaults.font.lineHeight,
                },
                color: themecolors["bg"],
                padding: 3,
                borderRadius: 3,
                position: "center",
                enabled: true,
                content: `PB: ${chartlpb}`,
            },
        });
        if (maxChartVal >= parseFloat(chartlpb) - 20 &&
            maxChartVal <= parseFloat(chartlpb) + 20) {
            maxChartVal = parseFloat(chartlpb) + 15;
        }
        resultScaleOptions["wpm"].max = Math.round(maxChartVal + 5);
        resultScaleOptions["raw"].max = Math.round(maxChartVal + 5);
    });
}
exports.updateGraphPBLine = updateGraphPBLine;
function updateWpmAndAcc() {
    let inf = false;
    if (result.wpm >= 1000) {
        inf = true;
    }
    if (config_1.default.alwaysShowDecimalPlaces) {
        if (config_1.default.alwaysShowCPM == false) {
            $("#result .stats .wpm .top .text").text("wpm");
            if (inf) {
                $("#result .stats .wpm .bottom").text("Infinite");
            }
            else {
                $("#result .stats .wpm .bottom").text(Misc.roundTo2(result.wpm).toFixed(2));
            }
            $("#result .stats .raw .bottom").text(Misc.roundTo2(result.rawWpm).toFixed(2));
            $("#result .stats .wpm .bottom").attr("aria-label", Misc.roundTo2(result.wpm * 5).toFixed(2) + " cpm");
        }
        else {
            $("#result .stats .wpm .top .text").text("cpm");
            if (inf) {
                $("#result .stats .wpm .bottom").text("Infinite");
            }
            else {
                $("#result .stats .wpm .bottom").text(Misc.roundTo2(result.wpm * 5).toFixed(2));
            }
            $("#result .stats .raw .bottom").text(Misc.roundTo2(result.rawWpm * 5).toFixed(2));
            $("#result .stats .wpm .bottom").attr("aria-label", Misc.roundTo2(result.wpm).toFixed(2) + " wpm");
        }
        $("#result .stats .acc .bottom").text(result.acc == 100 ? "100%" : Misc.roundTo2(result.acc).toFixed(2) + "%");
        let time = Misc.roundTo2(result.testDuration).toFixed(2) + "s";
        if (result.testDuration > 61) {
            time = Misc.secondsToString(Misc.roundTo2(result.testDuration));
        }
        $("#result .stats .time .bottom .text").text(time);
        $("#result .stats .raw .bottom").removeAttr("aria-label");
        $("#result .stats .acc .bottom").removeAttr("aria-label");
    }
    else {
        //not showing decimal places
        if (config_1.default.alwaysShowCPM == false) {
            $("#result .stats .wpm .top .text").text("wpm");
            $("#result .stats .wpm .bottom").attr("aria-label", result.wpm + ` (${Misc.roundTo2(result.wpm * 5)} cpm)`);
            if (inf) {
                $("#result .stats .wpm .bottom").text("Infinite");
            }
            else {
                $("#result .stats .wpm .bottom").text(Math.round(result.wpm));
            }
            $("#result .stats .raw .bottom").text(Math.round(result.rawWpm));
            $("#result .stats .raw .bottom").attr("aria-label", result.rawWpm);
        }
        else {
            $("#result .stats .wpm .top .text").text("cpm");
            $("#result .stats .wpm .bottom").attr("aria-label", Misc.roundTo2(result.wpm * 5) + ` (${Misc.roundTo2(result.wpm)} wpm)`);
            if (inf) {
                $("#result .stats .wpm .bottom").text("Infinite");
            }
            else {
                $("#result .stats .wpm .bottom").text(Math.round(result.wpm * 5));
            }
            $("#result .stats .raw .bottom").text(Math.round(result.rawWpm * 5));
            $("#result .stats .raw .bottom").attr("aria-label", result.rawWpm * 5);
        }
        $("#result .stats .acc .bottom").text(Math.floor(result.acc) + "%");
        $("#result .stats .acc .bottom").attr("aria-label", result.acc + "%");
    }
}
function updateConsistency() {
    if (config_1.default.alwaysShowDecimalPlaces) {
        $("#result .stats .consistency .bottom").text(Misc.roundTo2(result.consistency).toFixed(2) + "%");
        $("#result .stats .consistency .bottom").attr("aria-label", `${result.keyConsistency.toFixed(2)}% key`);
    }
    else {
        $("#result .stats .consistency .bottom").text(Math.round(result.consistency) + "%");
        $("#result .stats .consistency .bottom").attr("aria-label", `${result.consistency}% (${result.keyConsistency}% key)`);
    }
}
function updateTime() {
    const afkSecondsPercent = Misc.roundTo2((result.afkDuration / result.testDuration) * 100);
    $("#result .stats .time .bottom .afk").text("");
    if (afkSecondsPercent > 0) {
        $("#result .stats .time .bottom .afk").text(afkSecondsPercent + "% afk");
    }
    $("#result .stats .time .bottom").attr("aria-label", `${result.afkDuration}s afk ${afkSecondsPercent}%`);
    if (config_1.default.alwaysShowDecimalPlaces) {
        let time = Misc.roundTo2(result.testDuration).toFixed(2) + "s";
        if (result.testDuration > 61) {
            time = Misc.secondsToString(Misc.roundTo2(result.testDuration));
        }
        $("#result .stats .time .bottom .text").text(time);
    }
    else {
        let time = Math.round(result.testDuration) + "s";
        if (result.testDuration > 61) {
            time = Misc.secondsToString(Math.round(result.testDuration));
        }
        $("#result .stats .time .bottom .text").text(time);
        $("#result .stats .time .bottom").attr("aria-label", `${Misc.roundTo2(result.testDuration)}s (${result.afkDuration}s afk ${afkSecondsPercent}%)`);
    }
}
function updateTodayTracker() {
    $("#result .stats .time .bottom .timeToday").text(TodayTracker.getString());
}
exports.updateTodayTracker = updateTodayTracker;
function updateKey() {
    $("#result .stats .key .bottom").text(result.charStats[0] +
        "/" +
        result.charStats[1] +
        "/" +
        result.charStats[2] +
        "/" +
        result.charStats[3]);
}
function showCrown() {
    PbCrown.show();
}
exports.showCrown = showCrown;
function hideCrown() {
    PbCrown.hide();
    $("#result .stats .wpm .crown").attr("aria-label", "");
}
exports.hideCrown = hideCrown;
function updateCrown() {
    return __awaiter(this, void 0, void 0, function* () {
        let pbDiff = 0;
        const lpb = yield DB.getLocalPB(config_1.default.mode, result.mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode, config_1.default.funbox);
        pbDiff = Math.abs(result.wpm - lpb);
        $("#result .stats .wpm .crown").attr("aria-label", "+" + Misc.roundTo2(pbDiff));
    });
}
exports.updateCrown = updateCrown;
function updateTags(dontSave) {
    var _a;
    const activeTags = [];
    try {
        (_a = DB.getSnapshot().tags) === null || _a === void 0 ? void 0 : _a.forEach((tag) => {
            if (tag.active === true) {
                activeTags.push(tag);
            }
        });
    }
    catch (e) { }
    $("#result .stats .tags").addClass("hidden");
    if (activeTags.length == 0) {
        $("#result .stats .tags").addClass("hidden");
    }
    else {
        $("#result .stats .tags").removeClass("hidden");
    }
    $("#result .stats .tags .bottom").text("");
    let annotationSide = "start";
    let labelAdjust = 15;
    activeTags.forEach((tag) => __awaiter(this, void 0, void 0, function* () {
        const tpb = yield DB.getLocalTagPB(tag._id, config_1.default.mode, result.mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode);
        $("#result .stats .tags .bottom").append(`
      <div tagid="${tag._id}" aria-label="PB: ${tpb}" data-balloon-pos="up">${tag.name}<i class="fas fa-crown hidden"></i></div>
    `);
        if (config_1.default.mode != "quote" && !dontSave) {
            if (tpb < result.wpm) {
                //new pb for that tag
                DB.saveLocalTagPB(tag._id, config_1.default.mode, result.mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode, result.wpm, result.acc, result.rawWpm, result.consistency);
                $(`#result .stats .tags .bottom div[tagid="${tag._id}"] .fas`).removeClass("hidden");
                $(`#result .stats .tags .bottom div[tagid="${tag._id}"]`).attr("aria-label", "+" + Misc.roundTo2(result.wpm - tpb));
                // console.log("new pb for tag " + tag.name);
            }
            else {
                const themecolors = yield ThemeColors.getAll();
                resultAnnotation.push({
                    display: true,
                    type: "line",
                    id: "tpb",
                    scaleID: "wpm",
                    value: config_1.default.alwaysShowCPM ? tpb * 5 : tpb,
                    borderColor: themecolors["sub"],
                    borderWidth: 1,
                    borderDash: [2, 2],
                    label: {
                        backgroundColor: themecolors["sub"],
                        font: {
                            family: config_1.default.fontFamily.replace(/_/g, " "),
                            size: 11,
                            style: "normal",
                            weight: chart_js_1.Chart.defaults.font.weight,
                            lineHeight: chart_js_1.Chart.defaults.font.lineHeight,
                        },
                        color: themecolors["bg"],
                        padding: 3,
                        borderRadius: 3,
                        position: annotationSide,
                        xAdjust: labelAdjust,
                        enabled: true,
                        content: `${tag.name} PB: ${Misc.roundTo2(config_1.default.alwaysShowCPM ? tpb * 5 : tpb).toFixed(2)}`,
                    },
                });
                if (annotationSide === "start") {
                    annotationSide = "end";
                    labelAdjust = -15;
                }
                else {
                    annotationSide = "start";
                    labelAdjust = 15;
                }
            }
        }
    }));
}
function updateTestType(randomQuote) {
    let testType = "";
    testType += config_1.default.mode;
    if (config_1.default.mode === "time") {
        testType += " " + config_1.default.time;
    }
    else if (config_1.default.mode === "words") {
        testType += " " + config_1.default.words;
    }
    else if (config_1.default.mode === "quote") {
        if (randomQuote.group !== undefined) {
            testType += " " + ["short", "medium", "long", "thicc"][randomQuote.group];
        }
    }
    if (config_1.default.mode != "custom" &&
        config_1.default.funbox !== "gibberish" &&
        config_1.default.funbox !== "ascii" &&
        config_1.default.funbox !== "58008") {
        testType += "<br>" + result.language.replace(/_/g, " ");
    }
    if (config_1.default.punctuation) {
        testType += "<br>punctuation";
    }
    if (config_1.default.numbers) {
        testType += "<br>numbers";
    }
    if (config_1.default.blindMode) {
        testType += "<br>blind";
    }
    if (config_1.default.lazyMode) {
        testType += "<br>lazy";
    }
    if (config_1.default.funbox !== "none") {
        testType += "<br>" + config_1.default.funbox.replace(/_/g, " ");
    }
    if (config_1.default.difficulty == "expert") {
        testType += "<br>expert";
    }
    else if (config_1.default.difficulty == "master") {
        testType += "<br>master";
    }
    $("#result .stats .testType .bottom").html(testType);
}
function updateOther(difficultyFailed, failReason, afkDetected, isRepeated, tooShort) {
    let otherText = "";
    if (difficultyFailed) {
        otherText += `<br>failed (${failReason})`;
    }
    if (afkDetected) {
        otherText += "<br>afk detected";
    }
    if (TestStats.invalid) {
        otherText += "<br>invalid";
        let extra = "";
        if (result.wpm < 0 || result.wpm > 350) {
            extra += "wpm";
        }
        if (result.acc < 75 || result.acc > 100) {
            if (extra.length > 0) {
                extra += ", ";
            }
            extra += "accuracy";
        }
        if (extra.length > 0) {
            otherText += ` (${extra})`;
        }
    }
    if (isRepeated) {
        otherText += "<br>repeated";
    }
    if (result.bailedOut) {
        otherText += "<br>bailed out";
    }
    if (tooShort) {
        otherText += "<br>too short";
    }
    if (otherText == "") {
        $("#result .stats .info").addClass("hidden");
    }
    else {
        $("#result .stats .info").removeClass("hidden");
        otherText = otherText.substring(4);
        $("#result .stats .info .bottom").html(otherText);
    }
}
function updateRateQuote(randomQuote) {
    var _a, _b;
    if (config_1.default.mode === "quote") {
        const userqr = (_b = (_a = DB.getSnapshot().quoteRatings) === null || _a === void 0 ? void 0 : _a[randomQuote.language]) === null || _b === void 0 ? void 0 : _b[randomQuote.id];
        if (userqr) {
            $(".pageTest #result #rateQuoteButton .icon")
                .removeClass("far")
                .addClass("fas");
        }
        QuoteRatePopup.getQuoteStats(randomQuote).then((quoteStats) => {
            var _a, _b;
            $(".pageTest #result #rateQuoteButton .rating").text((_b = (_a = quoteStats === null || quoteStats === void 0 ? void 0 : quoteStats.average) === null || _a === void 0 ? void 0 : _a.toFixed(1)) !== null && _b !== void 0 ? _b : "");
            $(".pageTest #result #rateQuoteButton")
                .css({ opacity: 0 })
                .removeClass("hidden")
                .css({ opacity: 1 });
        });
    }
}
exports.updateRateQuote = updateRateQuote;
function updateQuoteSource(randomQuote) {
    if (config_1.default.mode === "quote") {
        $("#result .stats .source").removeClass("hidden");
        $("#result .stats .source .bottom").html(randomQuote.source);
    }
    else {
        $("#result .stats .source").addClass("hidden");
    }
}
function update(res, difficultyFailed, failReason, afkDetected, isRepeated, tooShort, randomQuote, dontSave) {
    return __awaiter(this, void 0, void 0, function* () {
        resultScaleOptions = ChartController.result.options.scales;
        resultAnnotation = [];
        result = res;
        $("#result #resultWordsHistory").addClass("hidden");
        $("#retrySavingResultButton").addClass("hidden");
        $(".pageTest #result #rateQuoteButton .icon")
            .removeClass("fas")
            .addClass("far");
        $(".pageTest #result #rateQuoteButton .rating").text("");
        $(".pageTest #result #rateQuoteButton").addClass("hidden");
        $("#testModesNotice").css("opacity", 0);
        $("#words").removeClass("blurred");
        $("#wordsInput").blur();
        $("#result .stats .time .bottom .afk").text("");
        if (firebase_1.Auth.currentUser != null) {
            $("#result .loginTip").addClass("hidden");
        }
        else {
            $("#result .loginTip").removeClass("hidden");
        }
        updateWpmAndAcc();
        updateConsistency();
        updateTime();
        updateKey();
        updateTestType(randomQuote);
        updateQuoteSource(randomQuote);
        yield updateGraph();
        yield updateGraphPBLine();
        updateTags(dontSave);
        updateOther(difficultyFailed, failReason, afkDetected, isRepeated, tooShort);
        ChartController.result.options
            .plugins.annotation.annotations =
            resultAnnotation;
        ChartController.result.updateColors();
        ChartController.result.resize();
        if ($("#result .stats .tags").hasClass("hidden") &&
            $("#result .stats .info").hasClass("hidden")) {
            $("#result .stats .infoAndTags").addClass("hidden");
        }
        else {
            $("#result .stats .infoAndTags").removeClass("hidden");
        }
        if (GlarsesMode.get()) {
            $("#middle #result .noStressMessage").remove();
            $("#middle #result").prepend(`

      <div class='noStressMessage' style="
        text-align: center;
        grid-column: 1/3;
        font-size: 2rem;
        padding-bottom: 2rem;
      ">
      <i class="fas fa-check"></i>
      </div>

    `);
            $("#middle #result .stats").addClass("hidden");
            $("#middle #result .chart").addClass("hidden");
            $("#middle #result #resultWordsHistory").addClass("hidden");
            $("#middle #result #resultReplay").addClass("hidden");
            $("#middle #result .loginTip").addClass("hidden");
            $("#middle #result #showWordHistoryButton").addClass("hidden");
            $("#middle #result #watchReplayButton").addClass("hidden");
            $("#middle #result #saveScreenshotButton").addClass("hidden");
            console.log(`Test Completed: ${result.wpm} wpm ${result.acc}% acc ${result.rawWpm} raw ${result.consistency}% consistency`);
        }
        else {
            $("#middle #result .stats").removeClass("hidden");
            $("#middle #result .chart").removeClass("hidden");
            // $("#middle #result #resultWordsHistory").removeClass("hidden");
            if (firebase_1.Auth.currentUser == null) {
                $("#middle #result .loginTip").removeClass("hidden");
            }
            $("#middle #result #showWordHistoryButton").removeClass("hidden");
            $("#middle #result #watchReplayButton").removeClass("hidden");
            $("#middle #result #saveScreenshotButton").removeClass("hidden");
        }
        if (window.scrollY > 0) {
            $([document.documentElement, document.body])
                .stop()
                .animate({ scrollTop: 0 }, 250);
        }
        Misc.swapElements($("#typingTest"), $("#result"), 250, () => {
            TestUI.setResultCalculating(false);
            $("#words").empty();
            ChartController.result.resize();
            if (config_1.default.alwaysShowWordsHistory && config_1.default.burstHeatmap) {
                TestUI.applyBurstHeatmap();
            }
            $("#result").trigger("focus");
            window.scrollTo({ top: 0 });
            $("#testModesNotice").addClass("hidden");
        }, () => {
            $("#resultExtraButtons").removeClass("hidden").css("opacity", 0).animate({
                opacity: 1,
            }, 125);
            if (config_1.default.alwaysShowWordsHistory && !GlarsesMode.get()) {
                TestUI.toggleResultWords();
            }
            Keymap.hide();
        });
        ResultsShownEvent.dispatch({
            res,
            difficultyFailed,
            failReason,
            afkDetected,
            isRepeated,
            tooShort,
            randomQuote,
            dontSave,
        });
    });
}
exports.update = update;


/***/ }),

/***/ "./src/scripts/test/shift-tracker.ts":
/*!*******************************************!*\
  !*** ./src/scripts/test/shift-tracker.ts ***!
  \*******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.isUsingOppositeShift = exports.reset = exports.rightState = exports.leftState = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const caps_warning_1 = __webpack_require__(/*! ./caps-warning */ "./src/scripts/test/caps-warning.ts");
exports.leftState = false;
exports.rightState = false;
let caseState = false;
const keymapStrings = {
    left: null,
    right: null,
    keymap: null,
};
function dynamicKeymapLegendStyle(uppercase) {
    const keymapKeys = [
        ...document.getElementsByClassName("keymap-key"),
    ];
    const layoutKeys = keymapKeys.map((el) => el.dataset["key"]);
    const keys = keymapKeys.map((el) => el.childNodes[1]);
    if (caps_warning_1.capsState)
        uppercase = !uppercase;
    if (layoutKeys.filter((v) => v === undefined).length > 2)
        return;
    if ((uppercase && caseState) || (!uppercase && !caseState))
        return;
    caseState = uppercase;
    const index = caseState ? 1 : 0;
    for (let i = 0; i < layoutKeys.length; i++) {
        const layoutKey = layoutKeys[i], key = keys[i];
        if (key === undefined || layoutKey === undefined)
            continue;
        key.textContent = layoutKey[index];
    }
}
function buildKeymapStrings() {
    return __awaiter(this, void 0, void 0, function* () {
        if (keymapStrings.keymap === config_1.default.keymapLayout)
            return;
        const layout = yield Misc.getLayout(config_1.default.keymapLayout);
        if (layout === undefined)
            return;
        const layoutKeys = layout.keys;
        const layoutKeysEntries = Object.entries(layoutKeys);
        keymapStrings.keymap = config_1.default.keymapLayout;
        if (!layout) {
            keymapStrings.left = null;
            keymapStrings.right = null;
        }
        else {
            keymapStrings.left = layoutKeysEntries
                .map(([rowName, row]) => row
                // includes "6" and "y" (buttons on qwerty) into the left hand
                .slice(0, ["row1", "row2"].includes(rowName)
                ? rowName === "row1"
                    ? 7
                    : 6
                : 5)
                .map((key) => key.split("")))
                .flat(2);
            keymapStrings.right = layoutKeysEntries
                .map(([rowName, row]) => row
                // includes "b" (buttons on qwerty) into the right hand
                .slice(["row1", "row4"].includes(rowName)
                ? rowName === "row1"
                    ? 6
                    : 4
                : 5)
                .map((key) => key.split("")))
                .flat(2);
        }
    });
}
$(document).on("keydown", (e) => {
    if (e.code === "ShiftLeft") {
        exports.leftState = true;
        exports.rightState = false;
    }
    else if (e.code === "ShiftRight") {
        exports.leftState = false;
        exports.rightState = true;
    }
    if (config_1.default.keymapLegendStyle === "dynamic") {
        dynamicKeymapLegendStyle(exports.leftState || exports.rightState);
    }
});
$(document).keyup((e) => {
    if (e.code === "ShiftLeft" || e.code === "ShiftRight") {
        exports.leftState = false;
        exports.rightState = false;
    }
    if (config_1.default.keymapLegendStyle === "dynamic") {
        dynamicKeymapLegendStyle(exports.leftState || exports.rightState);
    }
});
function reset() {
    exports.leftState = false;
    exports.rightState = false;
}
exports.reset = reset;
const leftSideKeys = [
    "KeyQ",
    "KeyW",
    "KeyE",
    "KeyR",
    "KeyT",
    "KeyA",
    "KeyS",
    "KeyD",
    "KeyF",
    "KeyG",
    "KeyZ",
    "KeyX",
    "KeyC",
    "KeyV",
    "Backquote",
    "Digit1",
    "Digit2",
    "Digit3",
    "Digit4",
    "Digit5",
];
const rightSideKeys = [
    "KeyU",
    "KeyI",
    "KeyO",
    "KeyP",
    "KeyH",
    "KeyJ",
    "KeyK",
    "KeyL",
    "KeyN",
    "KeyM",
    "Digit7",
    "Digit8",
    "Digit9",
    "Digit0",
    "Backslash",
    "BracketLeft",
    "BracketRight",
    "Semicolon",
    "Quote",
    "Comma",
    "Period",
    "Slash",
];
function isUsingOppositeShift(event) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!exports.leftState && !exports.rightState)
            return null;
        if (config_1.default.oppositeShiftMode === "on") {
            if (!rightSideKeys.includes(event.code) &&
                !leftSideKeys.includes(event.code)) {
                return null;
            }
            if ((exports.leftState && rightSideKeys.includes(event.code)) ||
                (exports.rightState && leftSideKeys.includes(event.code))) {
                return true;
            }
            else {
                return false;
            }
        }
        else if (config_1.default.oppositeShiftMode === "keymap") {
            yield buildKeymapStrings();
            if (!keymapStrings.left || !keymapStrings.right)
                return null;
            if ((exports.leftState && keymapStrings.right.includes(event.key)) ||
                (exports.rightState && keymapStrings.left.includes(event.key))) {
                return true;
            }
            else {
                return false;
            }
        }
        return true;
    });
}
exports.isUsingOppositeShift = isUsingOppositeShift;


/***/ }),

/***/ "./src/scripts/test/tbd-mode.ts":
/*!**************************************!*\
  !*** ./src/scripts/test/tbd-mode.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getTbdMode = void 0;
const wordset_1 = __webpack_require__(/*! ./wordset */ "./src/scripts/test/wordset.ts");
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const PageChangeEvent = __importStar(__webpack_require__(/*! ../observables/page-change-event */ "./src/scripts/observables/page-change-event.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ConfigStuff = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const ResultsShownEvent = __importStar(__webpack_require__(/*! ../observables/results-shown-event */ "./src/scripts/observables/results-shown-event.ts"));
const WordTypedEvent = __importStar(__webpack_require__(/*! ../observables/word-typed-event */ "./src/scripts/observables/word-typed-event.ts"));
const ResetRequestedEvent = __importStar(__webpack_require__(/*! ../observables/reset-requested-event */ "./src/scripts/observables/reset-requested-event.ts"));
const debounce_1 = __webpack_require__(/*! ../utils/debounce */ "./src/scripts/utils/debounce.ts");
class TbdConfig {
    init() {
        TbdEvents.addSubscriber("sorterSelectChanged", (data) => {
            this.set("sorter", data["value"]);
        });
        TbdEvents.addSubscriber("configUpdateRequested", (data) => {
            switch (data["configSetting"]) {
                case "targetSpeed":
                    this.processTargetSpeedUpdateRequest();
                    break;
                case "groupSize":
                    this.processGroupSizeUpdateRequest();
                    break;
                case "animations":
                    this.processAnimationToggleRequest();
                    break;
                case "unbeatenWordPercentage":
                    this.processUnbeatenWordPercentageRequest();
                    break;
            }
        });
    }
    get(key, defaultValue = "") {
        const configData = TbdData.getAll().config;
        return configData[key] || defaultValue;
    }
    set(key, value) {
        const original = this.get(key);
        if (original == value) {
            return;
        }
        const data = TbdData.getAll();
        data.config[key] = value;
        TbdData.updateData(data);
        TbdEvents.dispatchEvent(`${key}-changed`, {
            original: original,
            newValue: value,
        });
    }
    bumpTargetSpeed() {
        const current = this.getTargetSpeed();
        this.set("targetSpeed", (current + 5).toString());
    }
    getSorterName() {
        return this.get("sorter", "alphabetical-asc");
    }
    getSorter() {
        return TbdSorting.getSorter(this.getSorterName());
    }
    getTargetSpeed() {
        return parseInt(this.get("targetSpeed", "75"));
    }
    getGroupSize() {
        return parseInt(this.get("groupSize", "30"));
    }
    getUnbeatenWordPercentage() {
        return parseInt(this.get("unbeatenWordPercentage", "60"));
    }
    processTargetSpeedUpdateRequest() {
        const newSpeed = parseInt(prompt("New target speed", this.getTargetSpeed().toString()) || "");
        if (newSpeed > 0) {
            this.set("targetSpeed", newSpeed.toString());
        }
    }
    processAnimationToggleRequest() {
        const enabled = confirm("Confirm to enable, cancel to disable.");
        if (enabled) {
            this.set("animationsEnabled", "1");
        }
        else {
            this.set("animationsEnabled", "0");
        }
    }
    areAnimationsEnabled() {
        return this.get("animationsEnabled", "1") == "1";
    }
    processGroupSizeUpdateRequest() {
        const newSize = parseInt(prompt("New group size", this.getGroupSize().toString()) || "");
        if (newSize > 0) {
            this.set("groupSize", newSize.toString());
        }
    }
    processUnbeatenWordPercentageRequest() {
        const newPercentage = parseInt(prompt(`The odds (still random) that a test word will be one that hasn't been typed faster than the current group threshold. 
        
        Must be between 10-90`, this.getUnbeatenWordPercentage().toString()) || "");
        if (isNaN(newPercentage)) {
            return;
        }
        if (newPercentage < 10 || newPercentage > 90) {
            alert(`${newPercentage} isn't a valid choice.`);
            return;
        }
        this.set("unbeatenWordPercentage", newPercentage.toString());
    }
}
class TbdSorting {
    static getSorter(name) {
        switch (name) {
            case "alphabetical-asc":
                return TbdSorting.alphabeticalAscendingSorter;
            case "alphabetical-desc":
                return TbdSorting.alphabeticalDescendingSorter;
            case "speed-asc":
                return TbdSorting.speedAscendingSorter;
            case "speed-desc":
                return TbdSorting.speedDescendingSorter;
            case "typedCount":
                return TbdSorting.typedCountSorter;
            case "missedCount":
                return TbdSorting.missedCountSorter;
        }
        return TbdSorting.alphabeticalAscendingSorter;
    }
    static randomSorter() {
        return Math.random() < 0.5 ? -1 : 1;
    }
    static alphabeticalDescendingSorter(word, word2) {
        return word.toLowerCase() < word2.toLowerCase() ? 1 : -1;
    }
    static alphabeticalAscendingSorter(word, word2) {
        return word.toLowerCase() < word2.toLowerCase() ? -1 : 1;
    }
    static speedAscendingSorter(word, word2) {
        const speed1 = TbdData.getMedianSpeedForWord(word);
        const speed2 = TbdData.getMedianSpeedForWord(word2);
        return speed1 - speed2;
    }
    static speedDescendingSorter(word, word2) {
        const speed1 = TbdData.getMedianSpeedForWord(word);
        const speed2 = TbdData.getMedianSpeedForWord(word2);
        return speed2 - speed1;
    }
    static typedCountSorter(word, word2) {
        const typed1 = TbdData.getSpeedsForWord(word).length;
        const typed2 = TbdData.getSpeedsForWord(word2).length;
        return typed2 - typed1;
    }
    static missedCountSorter(word, word2) {
        return (TbdData.getMistypedCountForWord(word2) -
            TbdData.getMistypedCountForWord(word));
    }
}
class TbdMode {
    constructor(config) {
        this.previousWord = "";
        this.config = config;
        this.monkeyTypeWordset = new wordset_1.Wordset([]);
        this.currentGroup = new TbdGroup(this.monkeyTypeWordset);
        this.groups = new TbdGroups();
    }
    init() {
        WordTypedEvent.subscribe(this.handleWordTyped.bind(this));
        ResultsShownEvent.subscribe(this.handleResultsShownEvent.bind(this));
        TbdEvents.addSubscriber("resetButtonClicked", this.resetCurrentWords.bind(this));
        TbdEvents.addSubscriber("wordClicked", this.resetWord.bind(this));
        TbdEvents.addSubscriber("targetSpeed-changed", () => {
            this.regenerateGroupsFromWordset(this.monkeyTypeWordset);
        });
        TbdEvents.addSubscriber("groupSize-changed", () => {
            this.regenerateGroupsFromWordset(this.monkeyTypeWordset);
        });
        TbdEvents.addSubscriber("wordsReset", () => {
            this.regenerateGroupsFromWordset(this.monkeyTypeWordset);
        });
        TbdEvents.addSubscriber("nextGroup", (data) => {
            this.currentGroup = data["group"];
        });
        TbdEvents.addSubscriber("groupsRegenerated", () => {
            ResetRequestedEvent.dispatch();
        });
        TbdEvents.addSubscriber("nextGroupButtonClicked", () => {
            if (this.groups.getGroups().length <= 1) {
                return;
            }
            const currentGroupIndex = this.getCurrentGroupIndex();
            let nextIndex = currentGroupIndex + 1;
            // Allow cycling through groups
            if (nextIndex == this.groups.getGroups().length) {
                nextIndex = 0;
            }
            TbdEvents.dispatchEvent("nextGroup", {
                group: this.groups.getGroups()[nextIndex],
                groupNumber: nextIndex + 1,
            });
        });
        TbdEvents.addSubscriber("actionButtonClicked", (data) => {
            switch (data["actionValue"]) {
                case "resetCurrentWords":
                    this.handleResetCurrentWordsRequest();
                    break;
                case "resetAllWords":
                    this.handleResetAllWordsRequest();
                    break;
                case "copyAllData":
                    this.handleCopyDataRequest();
                    break;
                case "importData":
                    this.handleImportDataRequest();
                    break;
            }
        });
    }
    handleWordTyped(_word, isCorrect, burst, currentWordElement) {
        if (!isCorrect) {
            return;
        }
        const wordElement = currentWordElement;
        const typedAboveTarget = burst > this.getConfig().getTargetSpeed();
        if (typedAboveTarget) {
            TbdEvents.dispatchEvent("wordTypedCorrectly", { wordElement });
        }
        else {
            TbdEvents.dispatchEvent("wordMissed", { wordElement });
        }
    }
    handleResetCurrentWordsRequest() {
        if (confirm("Are you sure you want to reset data for the current wordset? This includes all" +
            " words in the language or custom word set you are using, not just the current group!")) {
            TbdData.resetDataForWords(this.monkeyTypeWordset.words);
        }
    }
    handleCopyDataRequest() {
        navigator.clipboard.writeText(JSON.stringify(TbdData.getAll())).then(() => {
            alert("JSON copied to your clipboard");
        }, () => {
            alert("There was a problem copying the data to your clipboard");
        });
    }
    handleImportDataRequest() {
        const exportJson = prompt("Enter the JSON you got from an export here") || "";
        if (exportJson == "") {
            return;
        }
        const parsed = JSON.parse(exportJson);
        if ("words" in parsed && "config" in parsed) {
            TbdData.updateData(parsed, true);
            location.reload();
        }
        else {
            alert("There was something wrong with your JSON, sorry!");
        }
    }
    getConfig() {
        return this.config;
    }
    getWord(originalWordset) {
        this.handleWordsetForNextWord(originalWordset);
        const group = this.getCurrentGroup();
        const random = Math.random() * 100;
        const unbeatenWordset = group.getUnbeatenWordset();
        const isThereMoreThanOneWord = group.getWordset().length > 1;
        let nextWord;
        if (unbeatenWordset.length > 0 &&
            random <= this.getConfig().getUnbeatenWordPercentage()) {
            nextWord = unbeatenWordset.randomWord();
        }
        else {
            nextWord = group.getWordset().randomWord();
        }
        if (this.previousWord == nextWord && isThereMoreThanOneWord) {
            return this.getWord(originalWordset);
        }
        this.previousWord = nextWord;
        return nextWord;
    }
    getCurrentGroup() {
        return this.currentGroup;
    }
    getFirstIncompleteGroup() {
        return this.groups.getFirstIncompleteGroup(this.config.getTargetSpeed());
    }
    recalculateCurrentGroup() {
        if (this.getCurrentGroup().getUnbeatenWordset().length > 0 &&
            this.getCurrentGroup().getThreshold() <= this.getConfig().getTargetSpeed()) {
            const index = this.getCurrentGroupIndex();
            TbdEvents.dispatchEvent("nextGroup", {
                group: this.getCurrentGroup(),
                groupNumber: index + 1,
            });
            return;
        }
        let next = this.getFirstIncompleteGroup();
        while (next == null) {
            this.getConfig().bumpTargetSpeed(); // side effects, regenerates all groups
            next = this.getFirstIncompleteGroup();
        }
        const index = this.groups.getGroups().indexOf(this.currentGroup);
        TbdEvents.dispatchEvent("nextGroup", {
            group: next,
            groupNumber: index + 1,
        });
    }
    getCurrentGroupIndex() {
        return this.groups.getGroups().indexOf(this.getCurrentGroup());
    }
    getMonkeyTypeWordset() {
        return this.monkeyTypeWordset;
    }
    handleWordsetForNextWord(wordset) {
        if (this.monkeyTypeWordset.length != wordset.length &&
            wordset.words.join("$") != this.monkeyTypeWordset.words.join("$")) {
            this.handleNewWordset(wordset);
        }
    }
    handleNewWordset(wordset) {
        this.monkeyTypeWordset = wordset;
        this.regenerateGroupsFromWordset(wordset);
    }
    regenerateGroupsFromWordset(wordset) {
        const notAboveTargetSpeed = wordset.words.filter((word) => {
            return !TbdData.hasWordBeenTypedFasterThan(word, this.config.getTargetSpeed());
        });
        const uniqueBelowTarget = new Set(notAboveTargetSpeed);
        if (uniqueBelowTarget.size == 0) {
            this.getConfig().bumpTargetSpeed();
            // Bumping the target triggers a regeneration of groups and infinite loops are no fun
            return;
        }
        this.groups.regenerateGroups(Array.from(uniqueBelowTarget), this.config.getGroupSize());
    }
    handleResultsShownEvent(results) {
        if (!results.difficultyFailed) {
            this.saveBurstsFromLatestResults();
        }
        this.saveMissesFromLatestResult();
        this.recalculateCurrentGroup();
        this.getCurrentGroup().increaseThresholdUntilSomeWordsAreUnbeaten();
        TbdEvents.dispatchEvent("resultsProcessed", {
            currentGroup: this.getCurrentGroup(),
            monkeyTypeWordset: this.monkeyTypeWordset,
            targetSpeed: this.config.getTargetSpeed(),
        });
    }
    saveBurstsFromLatestResults() {
        const resultWords = TestInput.input.history;
        const resultBursts = TestInput.burstHistory;
        for (let i = 0; i < resultWords.length; i++) {
            const word = resultWords[i];
            const burst = resultBursts[i];
            TbdData.addBurst(word, burst);
        }
    }
    resetCurrentWords() {
        if (!confirm("Are you sure you want to reset the stats for the current words?")) {
            return;
        }
        TbdData.resetDataForWords(this.monkeyTypeWordset.words);
    }
    resetWord(data) {
        const word = data["word"];
        if (!confirm(`Reset all data for ${word}?`)) {
            return;
        }
        TbdData.resetDataForWord(word);
    }
    saveMissesFromLatestResult() {
        Object.keys(TestInput.missedWords).forEach((word) => {
            const missedCount = TestInput.missedWords[word];
            TbdData.addToMissedCount(word, missedCount);
        });
    }
    handleResetAllWordsRequest() {
        let confirmationWord = "delete";
        let slowestSpeed = 1000;
        const allData = TbdData.getAll();
        Object.keys(allData.words)
            .filter((word) => TbdData.getMedianSpeedForWord(word) > 0)
            .forEach((word) => {
            const median = TbdData.getMedianSpeedForWord(word);
            if (median > 0 &&
                median < slowestSpeed &&
                word.length >= confirmationWord.length) {
                confirmationWord = word;
                slowestSpeed = median;
            }
        });
        const confirmationString = `${confirmationWord} ${confirmationWord} ${confirmationWord}`;
        const response = prompt(`This will delete ALL your word data. To confirm, type: ${confirmationString}`);
        if (response == null) {
            return;
        }
        if (response == confirmationString) {
            allData.words = {};
            TbdData.updateData(allData, true);
            alert("Ok! Your data has been deleted and you're starting over from scratch.");
            // Lazy, I know
            location.reload();
        }
        else {
            alert(`Good effort, but you typed 
        
        '${response}' 
        
        instead of 
        
        '${confirmationString}' 
        
        No reset for you!`);
        }
    }
}
class TbdUI {
    constructor(tbdMode) {
        this.$groupThreshold = $("#tbdModeGroupThreshold");
        this.$tbdModeGroupCount = $("#tbdModeGroupCount");
        this.$wordInfo = $("#tbdModeWordInfo");
        this.$wordsDiv = $("#tbdmodeInfo .wordsContainer .words");
        this.$progressMeterTotal = $("#tbdmodeInfo .progressMeterTotal");
        this.$targetThreshold = $("#tbdModeTargetThreshold");
        this.$progressMeterGroup = $("#tbdmodeInfo .progressMeterGroup");
        this.$tbdModeInfo = $("#tbdmodeInfo");
        this.$tbdModeHelpButton = $(".tbdModeHelpButton");
        this.$tbdModeHelp = $("#tbdHelp");
        this.$tbdBeatenExample = $(".tbdBeatenExample");
        this.$tbdLostExample = $(".tbdLostExample");
        this.$tbdModeActionsSelect = $("#tbdModeActionsSelect");
        this.$tbdModeActionsButton = $("#tbdModeActionButton");
        this.$tbdModeConfigSettingsSelect = $("#tbdModeConfigSettings");
        this.$tbdModeConfigSettingsUpdateButton = $("#tbdModeUpdateConfigSettingsUpdateButton");
        this.$tbdNextGroupButton = $("#tbdNextGroupButton");
        this.$sorterSelect = $("#tbdModeSorterSelect");
        this.currentlyAnimating = [];
        this.$tbdModeGroupNumber = $("#tbdModeCurrentGroupNumber");
        this.tbdMode = tbdMode;
        const wordsContainer = document.getElementById("tbdModeWordsContainer");
        if (!(wordsContainer instanceof HTMLDivElement)) {
            throw new Error("Could not locate TBD words container");
        }
        this.wordsContainer = wordsContainer;
        this.$wordInfo.hide();
        this.$tbdModeInfo.hide();
    }
    init() {
        document.body.classList.add("tbdMode");
        this.$tbdModeInfo.show(300);
        PageChangeEvent.subscribe(this.pageChangeHandler.bind(this));
        this.wordsContainer.addEventListener("mousemove", this.updateWordInfo.bind(this));
        this.wordsContainer.addEventListener("click", this.handleWordClicked.bind(this));
        this.wordsContainer.addEventListener("mouseleave", () => {
            return this.$wordInfo.hide(0);
        });
        TbdEvents.addSubscriber("wordTypedCorrectly", (data) => {
            data["wordElement"]
                .children("letter")
                .each((_index, element) => {
                this.animate(element, "tbdBeaten");
            });
        });
        TbdEvents.addSubscriber("wordMissed", (data) => {
            data["wordElement"].addClass("tbdLowOpacity");
            this.animate(data["wordElement"][0], "tbdLost");
        });
        TbdEvents.addSubscriber("groupThresholdChanged", (data) => {
            this.$groupThreshold.text(data["threshold"]);
        });
        TbdEvents.addSubscriber("resultsProcessed", (data) => {
            const group = data["currentGroup"];
            this.updateUiWords(group.getWordset().words);
        });
        TbdEvents.addSubscriber("resultsProcessed", (data) => {
            this.updateTotalProgressMeter(data["monkeyTypeWordset"], data["targetSpeed"]);
        });
        TbdEvents.addSubscriber("resultsProcessed", (data) => {
            this.updateGroupProgressMeter(data["currentGroup"], data["targetSpeed"]);
        });
        this.$sorterSelect.on("change", (event) => {
            if (!(event.target instanceof HTMLSelectElement)) {
                return;
            }
            TbdEvents.dispatchEvent("sorterSelectChanged", {
                value: event.target.value,
            });
        });
        TbdEvents.addSubscriber("sorter-changed", this.handleSorterChange.bind(this));
        TbdEvents.addSubscriber("nextGroup", (data) => {
            const group = data["group"];
            this.updateUiWords(group.getWordset().words);
        });
        TbdEvents.addSubscriber("nextGroup", () => {
            this.updateGroupProgressMeter(this.tbdMode.getCurrentGroup(), this.tbdMode.getConfig().getTargetSpeed());
            this.updateTotalProgressMeter(this.tbdMode.getMonkeyTypeWordset(), this.tbdMode.getConfig().getTargetSpeed());
        });
        // Can't use targetSpeed-changed because of stupid recursive way of
        // auto bumping threshold to ensure there are always groups
        TbdEvents.addSubscriber("nextGroup", () => {
            this.$targetThreshold.text(this.tbdMode.getConfig().getTargetSpeed().toString());
        });
        this.$tbdModeHelpButton.on("click", () => {
            this.$tbdModeHelp.toggle(250);
            this.$wordsDiv.toggle(250);
        });
        this.$tbdBeatenExample.on("click", (event) => {
            this.animate(event.target, "tbdBeaten");
        });
        this.$tbdLostExample.on("click", (event) => {
            this.animate(event.target, "tbdLost");
        });
        this.$tbdNextGroupButton.on("click", () => {
            TbdEvents.dispatchEvent("nextGroupButtonClicked");
        });
        this.$targetThreshold.text(this.tbdMode.getConfig().getTargetSpeed());
        this.$groupThreshold.text(this.tbdMode.getCurrentGroup().getThreshold());
        this.$tbdModeConfigSettingsUpdateButton.on("click", () => {
            const selectValue = this.$tbdModeConfigSettingsSelect.val();
            if (selectValue == "") {
                alert("Select an option from the dropdown first");
            }
            else {
                TbdEvents.dispatchEvent("configUpdateRequested", {
                    configSetting: selectValue,
                });
            }
        });
        this.$tbdModeActionsButton.on("click", () => {
            const selectValue = this.$tbdModeActionsSelect.val();
            if (selectValue == "") {
                alert("Select an option from the dropdown first");
            }
            else {
                TbdEvents.dispatchEvent("actionButtonClicked", {
                    actionValue: selectValue,
                });
            }
        });
        TbdEvents.addSubscriber("wordSaved", (data) => {
            const word = data["word"] || "";
            if (word == "") {
                return;
            }
            const element = this.getWordElement(word);
            if (!element) {
                return;
            }
            this.updateWord(word);
        });
        TbdEvents.addSubscriber("groupsRegenerated", (data) => {
            this.$tbdModeGroupCount.text(data["groups"].length);
        });
        TbdEvents.addSubscriber("nextGroup", (data) => {
            this.$tbdModeGroupNumber.text(data["groupNumber"]);
            this.$groupThreshold.text(data["group"].getThreshold());
        });
        TbdEvents.addSubscriber("groupsRegenerated", (data) => {
            if (data["groups"].length == 1) {
                this.$tbdNextGroupButton.hide();
            }
            else {
                this.$tbdNextGroupButton.show();
            }
        });
        this.$sorterSelect
            .find(`option[value="${this.tbdMode.getConfig().getSorterName()}"]`)
            .attr("selected", "");
    }
    /**
     * @param element
     * @param animation - both the keyframe animation and class with that animation. For simplicity
     * they must be the same.
     */
    animate(element, animation) {
        if (!this.tbdMode.getConfig().areAnimationsEnabled()) {
            return;
        }
        if (this.currentlyAnimating.includes(element)) {
            return;
        }
        const callback = (event) => {
            if (event.animationName !== animation) {
                return;
            }
            const index = this.currentlyAnimating.findIndex((animatingElement) => animatingElement == element);
            if (index >= 0) {
                delete this.currentlyAnimating[index];
            }
            element.classList.remove(animation);
            element.removeEventListener("animationend", callback);
        };
        element.addEventListener("animationend", callback);
        this.currentlyAnimating.push(element);
        element.classList.add(animation);
    }
    handleWordClicked(event) {
        var _a;
        const target = event.target;
        if (!(target instanceof HTMLDivElement)) {
            return;
        }
        if (!target.classList.contains("tbdWord")) {
            return;
        }
        const word = ((_a = target.parentElement) === null || _a === void 0 ? void 0 : _a.dataset["word"]) || "";
        if (word == "") {
            return;
        }
        TbdEvents.dispatchEvent("wordClicked", { word: word });
    }
    handleSorterChange(data) {
        const sorter = TbdSorting.getSorter(data["newValue"] || "");
        this.sortWords(sorter);
    }
    selectSorterOption(sorterName) {
        [...document.querySelectorAll("#tbdModeSorterSelect option")].forEach((option) => {
            if (!(option instanceof HTMLOptionElement)) {
                return;
            }
            if (option["value"] == sorterName) {
                option["selected"] = true;
            }
        });
    }
    updateTotalProgressMeter(monkeyTypeWordset, targetSpeed) {
        const allWords = monkeyTypeWordset.words;
        const count = allWords.length;
        const beatenAtTargetCount = allWords.filter((word) => {
            return TbdData.hasWordBeenTypedFasterThan(word, targetSpeed);
        }).length;
        const percent = (beatenAtTargetCount / count) * 100 || 0;
        this.$progressMeterTotal.css("width", `${percent}%`);
        this.$progressMeterTotal.attr("title", `${beatenAtTargetCount} words of ${count} total have been typed faster than the target of ${targetSpeed}`);
    }
    updateGroupProgressMeter(currentGroup, targetSpeed) {
        const groupWordset = currentGroup.getWordset();
        const beatenAtTargetCount = groupWordset.words.filter((word) => {
            return TbdData.hasWordBeenTypedFasterThan(word, targetSpeed);
        }).length;
        const percent = (beatenAtTargetCount / groupWordset.length) * 100 || 0;
        this.$progressMeterGroup.css("width", `${percent}%`);
        this.$progressMeterGroup.attr("title", `${beatenAtTargetCount} words of ${groupWordset.length} in the current group have been typed faster than the target of ${targetSpeed}`);
    }
    pageChangeHandler(_previousPage, nextPage) {
        const pagesToShowInfo = ["test"];
        if (pagesToShowInfo.includes(nextPage.name)) {
            this.$tbdModeInfo.show();
        }
        else {
            this.$tbdModeInfo.hide();
        }
    }
    updateUiWords(wordsToShow) {
        var _a;
        // Remove words we don't want to show
        this.$wordsDiv.hide();
        (_a = [...document.querySelectorAll(".words .tbdWordContainer")]) === null || _a === void 0 ? void 0 : _a.forEach((wordElement) => {
            // @ts-ignore
            const word = wordElement.dataset["word"];
            if (!wordsToShow.includes(word)) {
                // @ts-ignore
                wordElement.parentElement.removeChild(wordElement);
            }
        });
        wordsToShow.forEach((word) => {
            this.updateWord(word);
        });
        this.sortWords(this.tbdMode.getConfig().getSorter());
        this.$wordsDiv.show();
    }
    updateWord(word) {
        const wordElement = this.getOrCreateWordElement(word);
        const targetSpeed = this.tbdMode.getConfig().getTargetSpeed();
        const groupSpeed = this.tbdMode.getCurrentGroup().getThreshold();
        // Timeout ensures transitions work
        setTimeout(() => {
            var _a;
            wordElement.dataset["beatenAtTarget"] =
                TbdData.hasWordBeenTypedFasterThan(word, targetSpeed) ? "1" : "0";
            wordElement.dataset["beatenAtGroup"] = TbdData.hasWordBeenTypedFasterThan(word, groupSpeed)
                ? "1"
                : "0";
            wordElement.dataset["typed"] =
                TbdData.getSpeedsForWord(word).length == 0 ? "0" : "1";
            wordElement.dataset["missedMore"] =
                TbdData.getMistypedCountForWord(word) >
                    TbdData.getSpeedsForWord(word).length
                    ? "1"
                    : "0";
            const percentComplete = TbdData.getMedianSpeedForWord(word) / targetSpeed;
            const modifier = Math.min(percentComplete, 1);
            const baseScale = 0.75;
            const additional = (1 - baseScale) * modifier;
            // @ts-ignore
            (_a = wordElement.querySelector("div").style) === null || _a === void 0 ? void 0 : _a.transform = `scale(${baseScale + additional})`;
        }, 0);
    }
    sortWords(sorter) {
        var _a;
        const words = (_a = [...document.querySelectorAll(".tbdWordContainer")]) === null || _a === void 0 ? void 0 : _a.map((wordContainerElement) => {
            if (!(wordContainerElement instanceof HTMLDivElement)) {
                throw new Error("RUH ROH");
            }
            return wordContainerElement.dataset["word"] || "";
        });
        const sorted = words.sort(sorter);
        sorted.forEach((word) => {
            const element = this.getOrCreateWordElement(word);
            this.$wordsDiv.append(element);
        });
    }
    getWordElement(word) {
        const query = `.tbdWordContainer[data-word="${word}"]`;
        return document.querySelector(query);
    }
    getOrCreateWordElement(word) {
        const element = this.getWordElement(word);
        if (element) {
            return element;
        }
        const newDiv = document.createElement("div");
        newDiv.innerHTML = `<div class="tbdWord">${word}</div>`;
        newDiv.dataset["word"] = word;
        newDiv.classList.add("tbdWordContainer");
        this.$wordsDiv.append(newDiv);
        return newDiv;
    }
    updateWordInfo(event) {
        var _a;
        const target = event.target;
        if (!(target instanceof HTMLElement)) {
            return;
        }
        if (!target.classList.contains("tbdWord")) {
            return;
        }
        const word = (_a = target.parentElement) === null || _a === void 0 ? void 0 : _a.dataset["word"];
        if (word == undefined) {
            return;
        }
        const wordData = TbdData.getDataForWord(word);
        let wordInfoHtml = `
        <h3>"${word}"</h3>
        <div class="heading">Counts</div>
        <div class="statContainer">
          <span class="label">Correct: </span>
          <span class="stat good">${wordData.speeds.length}</span.>
        </div>
        <div class="statContainer">
          <span class="label">Missed: </span>
          <span class="stat bad">${TbdData.getMistypedCountForWord(word)}</span>
        </div>`;
        if (wordData.speeds.length) {
            wordInfoHtml += `
            <div class="heading">Speeds</div>
        <div class="statContainer">
          <span class="label">Worst: </span>
          <span class="stat bad">${TbdData.getSlowestSpeedForWord(word)}</span>
        </div>
        <div class="statContainer">
          <span class="label">Mean: </span>
          <span class="stat">${TbdData.getMeanSpeedForWord(word)}</span>
        </div>
        <div class="statContainer">
          <span class="label">Median: </span>
          <span class="stat">${TbdData.getMedianSpeedForWord(word)}</span>
        </div>
        <div class="statContainer">
          <span class="label">Best: </span>
          <span class="stat good">${TbdData.getFastestSpeedForWord(word)}</span>
        </div>`;
        }
        wordInfoHtml += `<div class="helpText">click to reset word data</div>`;
        this.$wordInfo.html(wordInfoHtml);
        this.getOrCreateWordElement(word).append(this.$wordInfo[0]);
        this.$wordInfo.show(200);
    }
}
class TbdEvents {
    static dispatchEvent(name, data = {}) {
        const subscribers = this.subscribers[name] || [];
        subscribers.forEach((subscriber) => {
            subscriber(data);
        });
    }
    static addSubscriber(name, callback) {
        if (!Array.isArray(TbdEvents.subscribers[name])) {
            TbdEvents.subscribers[name] = [];
        }
        TbdEvents.subscribers[name].push(callback);
    }
}
TbdEvents.subscribers = {};
TbdEvents.debouncedDispatch = (0, debounce_1.debounce)(TbdEvents.dispatchEvent, 50);
class TbdData {
    static getAll() {
        if (TbdData.data) {
            return TbdData.data;
        }
        TbdData.data = TbdData.getFromLocalStorage();
        return TbdData.data;
    }
    static getFromLocalStorage() {
        const defaultValue = { words: {}, config: {} };
        const storedData = localStorage.getItem(TbdData.localStorageKey);
        if (storedData == null) {
            return defaultValue;
        }
        // Try parsing local storage
        const parsed = JSON.parse(storedData);
        if (typeof parsed == "object") {
            return parsed;
        }
        return defaultValue;
    }
    static updateData(data, immediately = false) {
        TbdData.data = data;
        if (immediately) {
            TbdData.updateLocalStorage(data);
        }
        else {
            TbdData.debouncedUpdateLocalStorage(data);
        }
    }
    static getDataForWord(word) {
        const data = TbdData.getAll();
        if (!data.words[word]) {
            return { speeds: [], missedCount: 0 };
        }
        return data.words[word];
    }
    static resetDataForWord(word) {
        TbdData.saveWordData(word, { speeds: [], missedCount: 0 });
        TbdEvents.dispatchEvent("wordReset", { word: word });
    }
    static resetDataForWords(words) {
        words.forEach((word) => TbdData.resetDataForWord(word));
        TbdEvents.dispatchEvent("wordsReset", { words: words });
    }
    static hasWordBeenTypedFasterThan(word, threshold) {
        return TbdData.getMedianSpeedForWord(word) > threshold;
    }
    static getSpeedsForWord(word) {
        return TbdData.getDataForWord(word).speeds || [];
    }
    static getSlowestSpeedForWord(word) {
        const speeds = TbdData.getSpeedsForWord(word);
        if (speeds.length == 0) {
            return 0;
        }
        return Math.min(...speeds);
    }
    static getFastestSpeedForWord(word) {
        const speeds = TbdData.getSpeedsForWord(word);
        if (speeds.length == 0) {
            return 0;
        }
        return Math.max(...speeds);
    }
    static getMistypedCountForWord(word) {
        return TbdData.getDataForWord(word).missedCount;
    }
    static getMedianSpeedForWord(word) {
        const wordSpeeds = TbdData.getSpeedsForWord(word);
        if (wordSpeeds.length < 1) {
            return 0;
        }
        return (0, misc_1.median)(wordSpeeds);
    }
    static getMeanSpeedForWord(word) {
        const speeds = TbdData.getSpeedsForWord(word);
        if (speeds.length == 0) {
            return 0;
        }
        return Math.round((0, misc_1.mean)(speeds));
    }
    static saveWordData(word, wordData) {
        const data = TbdData.getAll();
        data.words[word] = wordData;
        TbdData.updateData(data);
        TbdEvents.dispatchEvent("wordSaved", { word: word, data: wordData });
    }
    static addBurst(word, speed) {
        if (word == "") {
            return;
        }
        const wordData = TbdData.getDataForWord(word);
        wordData.speeds.push(speed);
        TbdData.saveWordData(word, wordData);
    }
    static addToMissedCount(word, missedCount) {
        const data = TbdData.getDataForWord(word);
        data.missedCount += missedCount;
        TbdData.saveWordData(word, data);
    }
    static updateLocalStorage(data) {
        localStorage.setItem(TbdData.localStorageKey, JSON.stringify(data));
    }
}
TbdData.localStorageKey = "tbdModeData";
TbdData.debouncedUpdateLocalStorage = (0, debounce_1.debounce)(TbdData.updateLocalStorage, 1000);
class TbdGroups {
    constructor() {
        this.groups = [];
    }
    setGroups(groups) {
        this.groups = groups;
    }
    getGroups() {
        return this.groups;
    }
    getFirstIncompleteGroup(targetSpeed) {
        return (this.groups.find((group) => {
            return group
                .getWordset()
                .words.some((word) => !TbdData.hasWordBeenTypedFasterThan(word, targetSpeed));
        }) || null);
    }
    regenerateGroups(words, desiredGroupSize) {
        this.groups = [];
        if (words.length == 0) {
            return;
        }
        const randomlySorted = words.sort(TbdSorting.randomSorter);
        // This is an effort to ensure there are no tiny group sizes, like if there are 200
        // words and a group size of 18. Creating groups of size 18 would mean getting 11 groups
        // of 18 and 1 group of 2. This method ends up creating 8 groups of 17 (136) + 4 groups of
        // 16 (64). I'm sure there is a better way to calculate it but this seems to work and I'm
        // lazy when it comes to math.
        const total = words.length;
        const actualGroupCount = Math.ceil(total / desiredGroupSize);
        const maxGroupSize = Math.ceil(total / actualGroupCount);
        const reducedGroupSize = maxGroupSize - 1;
        const sizesToCreate = [];
        let remainingWords = total;
        for (let i = 0; i < actualGroupCount; i++) {
            if (remainingWords % maxGroupSize == 0) {
                sizesToCreate.push(maxGroupSize);
                remainingWords -= maxGroupSize;
            }
            else {
                sizesToCreate.push(reducedGroupSize);
                remainingWords -= reducedGroupSize;
            }
        }
        let start = 0;
        sizesToCreate.forEach((size) => {
            const words = randomlySorted.slice(start, start + size);
            const wordset = new wordset_1.Wordset(words);
            this.groups.push(new TbdGroup(wordset));
            start = start + size;
        });
        TbdEvents.dispatchEvent("groupsRegenerated", { groups: this.groups });
        TbdEvents.dispatchEvent("nextGroup", {
            group: this.getGroups()[0],
            groupNumber: 1,
        });
    }
}
class TbdGroup {
    constructor(wordset) {
        this.threshold = 1;
        this.wordset = wordset;
    }
    getWordset() {
        return this.wordset;
    }
    getThreshold() {
        return this.threshold;
    }
    bumpThreshold() {
        this.threshold += 1;
        TbdEvents.dispatchEvent("groupThresholdChanged", {
            threshold: this.threshold,
        });
    }
    getUnbeatenWordset() {
        const unbeatenWords = this.wordset.words.filter((word) => {
            return !TbdData.hasWordBeenTypedFasterThan(word, this.getThreshold());
        });
        return new wordset_1.Wordset(unbeatenWords);
    }
    increaseThresholdUntilSomeWordsAreUnbeaten() {
        if (this.wordset.length == 0) {
            return;
        }
        while (this.getUnbeatenWordset().length == 0) {
            this.bumpThreshold();
        }
    }
}
ConfigEvent.subscribe(handleFunboxChange);
function isTbdMode() {
    return config_1.default.funbox == "tbdmode";
}
function handleFunboxChange(key, _newValue, _nosave, _previousValue, _fullConfig) {
    if (key != "funbox") {
        return;
    }
    if (isTbdMode() && !getTbdMode()) {
        const tbdConfig = new TbdConfig();
        tbdConfig.init();
        tbdMode = new TbdMode(tbdConfig);
        tbdMode.init();
        const ui = new TbdUI(tbdMode);
        ui.init();
    }
    else if (!isTbdMode() && getTbdMode()) {
        // This was the easiest way I could think of to ensure there's nothing left over
        // after switching from TBD Mode to something else.
        location.reload();
    }
}
let tbdMode;
function getTbdMode() {
    return tbdMode;
}
exports.getTbdMode = getTbdMode;
ConfigStuff.setFunbox("tbdmode");


/***/ }),

/***/ "./src/scripts/test/test-config.ts":
/*!*****************************************!*\
  !*** ./src/scripts/test/test-config.ts ***!
  \*****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.update = exports.hide = exports.show = void 0;
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
// export function show() {
//   $("#top .config").removeClass("hidden").css("opacity", 1);
// }
// export function hide() {
//   $("#top .config").css("opacity", 0).addClass("hidden");
// }
function show() {
    $("#top .config")
        .stop(true, true)
        .removeClass("hidden")
        .css("opacity", 0)
        .animate({
        opacity: 1,
    }, 125);
}
exports.show = show;
function hide() {
    $("#top .config")
        .stop(true, true)
        .css("opacity", 1)
        .animate({
        opacity: 0,
    }, 125, () => {
        $("#top .config").addClass("hidden");
    });
}
exports.hide = hide;
function update(previous, current) {
    if (previous === current)
        return;
    $("#top .config .mode .text-button").removeClass("active");
    $("#top .config .mode .text-button[mode='" + current + "']").addClass("active");
    if (current == "time") {
        // $("#top .config .wordCount").addClass("hidden");
        // $("#top .config .time").removeClass("hidden");
        // $("#top .config .customText").addClass("hidden");
        $("#top .config .punctuationMode").removeClass("disabled");
        $("#top .config .numbersMode").removeClass("disabled");
        // $("#top .config .puncAndNum").removeClass("disabled");
        // $("#top .config .punctuationMode").removeClass("hidden");
        // $("#top .config .numbersMode").removeClass("hidden");
        // $("#top .config .quoteLength").addClass("hidden");
    }
    else if (current == "words") {
        // $("#top .config .wordCount").removeClass("hidden");
        // $("#top .config .time").addClass("hidden");
        // $("#top .config .customText").addClass("hidden");
        $("#top .config .punctuationMode").removeClass("disabled");
        $("#top .config .numbersMode").removeClass("disabled");
        // $("#top .config .puncAndNum").removeClass("disabled");
        // $("#top .config .punctuationMode").removeClass("hidden");
        // $("#top .config .numbersMode").removeClass("hidden");
        // $("#top .config .quoteLength").addClass("hidden");
    }
    else if (current == "custom") {
        // $("#top .config .wordCount").addClass("hidden");
        // $("#top .config .time").addClass("hidden");
        // $("#top .config .customText").removeClass("hidden");
        $("#top .config .punctuationMode").removeClass("disabled");
        $("#top .config .numbersMode").removeClass("disabled");
        // $("#top .config .puncAndNum").removeClass("disabled");
        // $("#top .config .punctuationMode").removeClass("hidden");
        // $("#top .config .numbersMode").removeClass("hidden");
        // $("#top .config .quoteLength").addClass("hidden");
    }
    else if (current == "quote") {
        // $("#top .config .wordCount").addClass("hidden");
        // $("#top .config .time").addClass("hidden");
        // $("#top .config .customText").addClass("hidden");
        $("#top .config .punctuationMode").addClass("disabled");
        $("#top .config .numbersMode").addClass("disabled");
        // $("#top .config .puncAndNum").addClass("disabled");
        // $("#top .config .punctuationMode").removeClass("hidden");
        // $("#top .config .numbersMode").removeClass("hidden");
        // $("#result .stats .source").removeClass("hidden");
        // $("#top .config .quoteLength").removeClass("hidden");
    }
    else if (current == "zen") {
        // $("#top .config .wordCount").addClass("hidden");
        // $("#top .config .time").addClass("hidden");
        // $("#top .config .customText").addClass("hidden");
        // $("#top .config .punctuationMode").addClass("hidden");
        // $("#top .config .numbersMode").addClass("hidden");
        // $("#top .config .quoteLength").addClass("hidden");
    }
    const submenu = {
        time: "time",
        words: "wordCount",
        custom: "customText",
        quote: "quoteLength",
        zen: "",
    };
    const animTime = 250;
    if (current == "zen") {
        $(`#top .config .${submenu[previous]}`).animate({
            opacity: 0,
        }, animTime / 2, () => {
            $(`#top .config .${submenu[previous]}`).addClass("hidden");
        });
        $(`#top .config .puncAndNum`).animate({
            opacity: 0,
        }, animTime / 2, () => {
            $(`#top .config .puncAndNum`).addClass("invisible");
        });
        return;
    }
    if (previous == "zen") {
        setTimeout(() => {
            $(`#top .config .${submenu[current]}`).removeClass("hidden");
            $(`#top .config .${submenu[current]}`)
                .css({ opacity: 0 })
                .animate({
                opacity: 1,
            }, animTime / 2);
            $(`#top .config .puncAndNum`).removeClass("invisible");
            $(`#top .config .puncAndNum`)
                .css({ opacity: 0 })
                .animate({
                opacity: 1,
            }, animTime / 2);
        }, animTime / 2);
        return;
    }
    Misc.swapElements($("#top .config ." + submenu[previous]), $("#top .config ." + submenu[current]), animTime);
}
exports.update = update;
ConfigEvent.subscribe((eventKey, eventValue, _nosave, eventPreviousValue) => {
    if (eventKey === "mode") {
        update(eventPreviousValue, eventValue);
    }
});


/***/ }),

/***/ "./src/scripts/test/test-input.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-input.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.restart = exports.pushBurstToHistory = exports.pushToRawHistory = exports.pushToWpmHistory = exports.pushMissedWord = exports.resetKeypressTimings = exports.recordKeypressSpacing = exports.setKeypressDuration = exports.pushKeypressDuration = exports.setKeypressTimingsTooLong = exports.incrementAccuracy = exports.pushKeypressesToHistory = exports.setBurstStart = exports.pushKeypressWord = exports.incrementKeypressErrors = exports.setKeypressNotAfk = exports.incrementKeypressCount = exports.updateLastKeypress = exports.enableSpacingDebug = exports.spacingDebug = exports.setBailout = exports.bailout = exports.burstHistory = exports.rawHistory = exports.wpmHistory = exports.keypressTimings = exports.accuracy = exports.missedWords = exports.currentBurstStart = exports.lastKeypress = exports.currentKeypress = exports.keypressPerSecond = exports.corrected = exports.input = void 0;
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
class Input {
    constructor() {
        this.current = "";
        this.history = [];
        this.historyLength = 0;
        this.length = 0;
    }
    reset() {
        this.current = "";
        this.history = [];
        this.length = 0;
    }
    resetHistory() {
        this.history = [];
        this.length = 0;
    }
    setCurrent(val) {
        this.current = val;
        this.length = this.current.length;
    }
    appendCurrent(val) {
        this.current += val;
        this.length = this.current.length;
    }
    resetCurrent() {
        this.current = "";
    }
    getCurrent() {
        return this.current;
    }
    pushHistory() {
        this.history.push(this.current);
        this.historyLength = this.history.length;
        this.resetCurrent();
    }
    popHistory() {
        var _a;
        const ret = (_a = this.history.pop()) !== null && _a !== void 0 ? _a : "";
        this.historyLength = this.history.length;
        return ret;
    }
    getHistory(i) {
        if (i === undefined) {
            return this.history;
        }
        else {
            return this.history[i];
        }
    }
    getHistoryLast() {
        return this.history[this.history.length - 1];
    }
}
class Corrected {
    constructor() {
        this.current = "";
        this.history = [];
    }
    setCurrent(val) {
        this.current = val;
    }
    appendCurrent(val) {
        this.current += val;
    }
    resetCurrent() {
        this.current = "";
    }
    resetHistory() {
        this.history = [];
    }
    reset() {
        this.resetCurrent();
        this.resetHistory();
    }
    getHistory(i) {
        return this.history[i];
    }
    popHistory() {
        var _a;
        return (_a = this.history.pop()) !== null && _a !== void 0 ? _a : "";
    }
    pushHistory() {
        this.history.push(this.current);
        this.current = "";
    }
}
exports.input = new Input();
exports.corrected = new Corrected();
exports.keypressPerSecond = [];
exports.currentKeypress = {
    count: 0,
    errors: 0,
    words: [],
    afk: true,
};
exports.currentBurstStart = 0;
exports.missedWords = {};
exports.accuracy = {
    correct: 0,
    incorrect: 0,
};
exports.keypressTimings = {
    spacing: {
        current: -1,
        array: [],
    },
    duration: {
        current: -1,
        array: [],
    },
};
exports.wpmHistory = [];
exports.rawHistory = [];
exports.burstHistory = [];
exports.bailout = false;
function setBailout(tf) {
    exports.bailout = tf;
}
exports.setBailout = setBailout;
exports.spacingDebug = false;
function enableSpacingDebug() {
    exports.spacingDebug = true;
    console.clear();
}
exports.enableSpacingDebug = enableSpacingDebug;
function updateLastKeypress() {
    exports.lastKeypress = performance.now();
}
exports.updateLastKeypress = updateLastKeypress;
function incrementKeypressCount() {
    exports.currentKeypress.count++;
}
exports.incrementKeypressCount = incrementKeypressCount;
function setKeypressNotAfk() {
    exports.currentKeypress.afk = false;
}
exports.setKeypressNotAfk = setKeypressNotAfk;
function incrementKeypressErrors() {
    exports.currentKeypress.errors++;
}
exports.incrementKeypressErrors = incrementKeypressErrors;
function pushKeypressWord(wordIndex) {
    exports.currentKeypress.words.push(wordIndex);
}
exports.pushKeypressWord = pushKeypressWord;
function setBurstStart(time) {
    exports.currentBurstStart = time;
}
exports.setBurstStart = setBurstStart;
function pushKeypressesToHistory() {
    exports.keypressPerSecond.push(exports.currentKeypress);
    exports.currentKeypress = {
        count: 0,
        errors: 0,
        words: [],
        afk: true,
    };
}
exports.pushKeypressesToHistory = pushKeypressesToHistory;
function incrementAccuracy(correctincorrect) {
    if (correctincorrect) {
        exports.accuracy.correct++;
    }
    else {
        exports.accuracy.incorrect++;
    }
}
exports.incrementAccuracy = incrementAccuracy;
function setKeypressTimingsTooLong() {
    exports.keypressTimings.spacing.array = "toolong";
    exports.keypressTimings.duration.array = "toolong";
}
exports.setKeypressTimingsTooLong = setKeypressTimingsTooLong;
function pushKeypressDuration(val) {
    exports.keypressTimings.duration.array.push((0, misc_1.roundTo2)(val));
}
exports.pushKeypressDuration = pushKeypressDuration;
function setKeypressDuration(val) {
    exports.keypressTimings.duration.current = (0, misc_1.roundTo2)(val);
}
exports.setKeypressDuration = setKeypressDuration;
function pushKeypressSpacing(val) {
    exports.keypressTimings.spacing.array.push((0, misc_1.roundTo2)(val));
}
function setKeypressSpacing(val) {
    exports.keypressTimings.spacing.current = (0, misc_1.roundTo2)(val);
}
function recordKeypressSpacing() {
    const now = performance.now();
    const diff = Math.abs(exports.keypressTimings.spacing.current - now);
    if (exports.keypressTimings.spacing.current !== -1) {
        pushKeypressSpacing(diff);
        if (exports.spacingDebug) {
            console.log("spacing debug", "push", diff, "length", exports.keypressTimings.spacing.array.length);
        }
    }
    setKeypressSpacing(now);
    if (exports.spacingDebug) {
        console.log("spacing debug", "set", now, "length", exports.keypressTimings.spacing.array.length);
    }
    if (exports.spacingDebug) {
        console.log("spacing debug", "recorded", "length", exports.keypressTimings.spacing.array.length);
    }
}
exports.recordKeypressSpacing = recordKeypressSpacing;
function resetKeypressTimings() {
    exports.keypressTimings = {
        spacing: {
            current: performance.now(),
            array: [],
        },
        duration: {
            current: performance.now(),
            array: [],
        },
    };
    if (exports.spacingDebug)
        console.clear();
}
exports.resetKeypressTimings = resetKeypressTimings;
function pushMissedWord(word) {
    if (!Object.keys(exports.missedWords).includes(word)) {
        exports.missedWords[word] = 1;
    }
    else {
        exports.missedWords[word]++;
    }
}
exports.pushMissedWord = pushMissedWord;
function pushToWpmHistory(wpm) {
    exports.wpmHistory.push(wpm);
}
exports.pushToWpmHistory = pushToWpmHistory;
function pushToRawHistory(raw) {
    exports.rawHistory.push(raw);
}
exports.pushToRawHistory = pushToRawHistory;
function pushBurstToHistory(speed) {
    if (exports.burstHistory[TestWords.words.currentIndex] === undefined) {
        exports.burstHistory.push(speed);
    }
    else {
        //repeated word - override
        exports.burstHistory[TestWords.words.currentIndex] = speed;
    }
}
exports.pushBurstToHistory = pushBurstToHistory;
function restart() {
    exports.wpmHistory = [];
    exports.rawHistory = [];
    exports.burstHistory = [];
    exports.keypressPerSecond = [];
    exports.currentKeypress = {
        count: 0,
        errors: 0,
        words: [],
        afk: true,
    };
    exports.currentBurstStart = 0;
    exports.missedWords = {};
    exports.accuracy = {
        correct: 0,
        incorrect: 0,
    };
    exports.keypressTimings = {
        spacing: {
            current: -1,
            array: [],
        },
        duration: {
            current: -1,
            array: [],
        },
    };
}
exports.restart = restart;


/***/ }),

/***/ "./src/scripts/test/test-logic.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-logic.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.fail = exports.finish = exports.retrySavingResult = exports.addWord = exports.init = exports.restart = exports.startTest = exports.punctuateWord = exports.setNotSignedInUid = exports.clearNotSignedInResult = exports.notSignedInLastResult = void 0;
const ape_1 = __importDefault(__webpack_require__(/*! ../ape */ "./src/scripts/ape/index.ts"));
const TestUI = __importStar(__webpack_require__(/*! ./test-ui */ "./src/scripts/test/test-ui.ts"));
const ManualRestart = __importStar(__webpack_require__(/*! ./manual-restart-tracker */ "./src/scripts/test/manual-restart-tracker.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const quotes_controller_1 = __importDefault(__webpack_require__(/*! ../controllers/quotes-controller */ "./src/scripts/controllers/quotes-controller.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const CustomText = __importStar(__webpack_require__(/*! ./custom-text */ "./src/scripts/test/custom-text.ts"));
const TestStats = __importStar(__webpack_require__(/*! ./test-stats */ "./src/scripts/test/test-stats.ts"));
const PractiseWords = __importStar(__webpack_require__(/*! ./practise-words */ "./src/scripts/test/practise-words.ts"));
const ShiftTracker = __importStar(__webpack_require__(/*! ./shift-tracker */ "./src/scripts/test/shift-tracker.ts"));
const Focus = __importStar(__webpack_require__(/*! ./focus */ "./src/scripts/test/focus.ts"));
const Funbox = __importStar(__webpack_require__(/*! ./funbox */ "./src/scripts/test/funbox.ts"));
const Keymap = __importStar(__webpack_require__(/*! ../elements/keymap */ "./src/scripts/elements/keymap.ts"));
const ThemeController = __importStar(__webpack_require__(/*! ../controllers/theme-controller */ "./src/scripts/controllers/theme-controller.ts"));
const PaceCaret = __importStar(__webpack_require__(/*! ./pace-caret */ "./src/scripts/test/pace-caret.ts"));
const Caret = __importStar(__webpack_require__(/*! ./caret */ "./src/scripts/test/caret.ts"));
const LiveWpm = __importStar(__webpack_require__(/*! ./live-wpm */ "./src/scripts/test/live-wpm.ts"));
const LiveAcc = __importStar(__webpack_require__(/*! ./live-acc */ "./src/scripts/test/live-acc.ts"));
const LiveBurst = __importStar(__webpack_require__(/*! ./live-burst */ "./src/scripts/test/live-burst.ts"));
const TimerProgress = __importStar(__webpack_require__(/*! ./timer-progress */ "./src/scripts/test/timer-progress.ts"));
const QuoteSearchPopup = __importStar(__webpack_require__(/*! ../popups/quote-search-popup */ "./src/scripts/popups/quote-search-popup.ts"));
const QuoteSubmitPopup = __importStar(__webpack_require__(/*! ../popups/quote-submit-popup */ "./src/scripts/popups/quote-submit-popup.ts"));
const PbCrown = __importStar(__webpack_require__(/*! ./pb-crown */ "./src/scripts/test/pb-crown.ts"));
const TestTimer = __importStar(__webpack_require__(/*! ./test-timer */ "./src/scripts/test/test-timer.ts"));
const OutOfFocus = __importStar(__webpack_require__(/*! ./out-of-focus */ "./src/scripts/test/out-of-focus.ts"));
const AccountButton = __importStar(__webpack_require__(/*! ../elements/account-button */ "./src/scripts/elements/account-button.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const Replay = __importStar(__webpack_require__(/*! ./replay */ "./src/scripts/test/replay.ts"));
const Poetry = __importStar(__webpack_require__(/*! ./poetry */ "./src/scripts/test/poetry.ts"));
const Wikipedia = __importStar(__webpack_require__(/*! ./wikipedia */ "./src/scripts/test/wikipedia.ts"));
const TodayTracker = __importStar(__webpack_require__(/*! ./today-tracker */ "./src/scripts/test/today-tracker.ts"));
const WeakSpot = __importStar(__webpack_require__(/*! ./weak-spot */ "./src/scripts/test/weak-spot.ts"));
const Wordset = __importStar(__webpack_require__(/*! ./wordset */ "./src/scripts/test/wordset.ts"));
const ChallengeContoller = __importStar(__webpack_require__(/*! ../controllers/challenge-controller */ "./src/scripts/controllers/challenge-controller.ts"));
const QuoteRatePopup = __importStar(__webpack_require__(/*! ../popups/quote-rate-popup */ "./src/scripts/popups/quote-rate-popup.ts"));
const BritishEnglish = __importStar(__webpack_require__(/*! ./british-english */ "./src/scripts/test/british-english.ts"));
const LazyMode = __importStar(__webpack_require__(/*! ./lazy-mode */ "./src/scripts/test/lazy-mode.ts"));
const Result = __importStar(__webpack_require__(/*! ./result */ "./src/scripts/test/result.ts"));
const MonkeyPower = __importStar(__webpack_require__(/*! ../elements/monkey-power */ "./src/scripts/elements/monkey-power.ts"));
const ActivePage = __importStar(__webpack_require__(/*! ../states/active-page */ "./src/scripts/states/active-page.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const TestState = __importStar(__webpack_require__(/*! ./test-state */ "./src/scripts/test/test-state.ts"));
const ModesNotice = __importStar(__webpack_require__(/*! ../elements/modes-notice */ "./src/scripts/elements/modes-notice.ts"));
const PageTransition = __importStar(__webpack_require__(/*! ../states/page-transition */ "./src/scripts/states/page-transition.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const TimerEvent = __importStar(__webpack_require__(/*! ../observables/timer-event */ "./src/scripts/observables/timer-event.ts"));
const ResetRequestedEvent = __importStar(__webpack_require__(/*! ../observables/reset-requested-event */ "./src/scripts/observables/reset-requested-event.ts"));
const Last10Average = __importStar(__webpack_require__(/*! ../elements/last-10-average */ "./src/scripts/elements/last-10-average.ts"));
const Monkey = __importStar(__webpack_require__(/*! ./monkey */ "./src/scripts/test/monkey.ts"));
const tbd_mode_1 = __webpack_require__(/*! ./tbd-mode */ "./src/scripts/test/tbd-mode.ts");
const object_hash_1 = __importDefault(__webpack_require__(/*! object-hash */ "./node_modules/object-hash/dist/object_hash.js"));
const AnalyticsController = __importStar(__webpack_require__(/*! ../controllers/analytics-controller */ "./src/scripts/controllers/analytics-controller.ts"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
let failReason = "";
exports.notSignedInLastResult = null;
function clearNotSignedInResult() {
    exports.notSignedInLastResult = null;
}
exports.clearNotSignedInResult = clearNotSignedInResult;
function setNotSignedInUid(uid) {
    if (exports.notSignedInLastResult === null)
        return;
    exports.notSignedInLastResult.uid = uid;
    delete exports.notSignedInLastResult.hash;
    exports.notSignedInLastResult.hash = (0, object_hash_1.default)(exports.notSignedInLastResult);
}
exports.setNotSignedInUid = setNotSignedInUid;
let spanishSentenceTracker = "";
function punctuateWord(previousWord, currentWord, index, maxindex) {
    let word = currentWord;
    const currentLanguage = config_1.default.language.split("_")[0];
    const lastChar = Misc.getLastChar(previousWord);
    if (config_1.default.funbox === "58008") {
        if (currentWord.length > 3) {
            if (Math.random() < 0.75) {
                const special = ["/", "*", "-", "+"][Math.floor(Math.random() * 4)];
                word = Misc.setCharAt(word, Math.floor(word.length / 2), special);
            }
        }
    }
    else {
        if ((index == 0 || lastChar == "." || lastChar == "?" || lastChar == "!") &&
            currentLanguage != "code") {
            //always capitalise the first word or if there was a dot unless using a code alphabet
            word = Misc.capitalizeFirstLetterOfEachWord(word);
            if (currentLanguage == "spanish" || currentLanguage == "catalan") {
                const rand = Math.random();
                if (rand > 0.9) {
                    word = "" + word;
                    spanishSentenceTracker = "?";
                }
                else if (rand > 0.8) {
                    word = "" + word;
                    spanishSentenceTracker = "!";
                }
            }
        }
        else if ((Math.random() < 0.1 &&
            lastChar != "." &&
            lastChar != "," &&
            index != maxindex - 2) ||
            index == maxindex - 1) {
            if (currentLanguage == "spanish" || currentLanguage == "catalan") {
                if (spanishSentenceTracker == "?" || spanishSentenceTracker == "!") {
                    word += spanishSentenceTracker;
                    spanishSentenceTracker = "";
                }
            }
            else {
                const rand = Math.random();
                if (rand <= 0.8) {
                    word += ".";
                }
                else if (rand > 0.8 && rand < 0.9) {
                    if (currentLanguage == "french") {
                        word = "?";
                    }
                    else if (currentLanguage == "arabic" ||
                        currentLanguage == "persian" ||
                        currentLanguage == "urdu") {
                        word += "";
                    }
                    else if (currentLanguage == "greek") {
                        word += ";";
                    }
                    else {
                        word += "?";
                    }
                }
                else {
                    if (currentLanguage == "french") {
                        word = "!";
                    }
                    else {
                        word += "!";
                    }
                }
            }
        }
        else if (Math.random() < 0.01 &&
            lastChar != "," &&
            lastChar != "." &&
            currentLanguage !== "russian") {
            word = `"${word}"`;
        }
        else if (Math.random() < 0.011 &&
            lastChar != "," &&
            lastChar != "." &&
            currentLanguage !== "russian" &&
            currentLanguage !== "ukrainian") {
            word = `'${word}'`;
        }
        else if (Math.random() < 0.012 && lastChar != "," && lastChar != ".") {
            if (currentLanguage == "code") {
                const r = Math.random();
                if (r < 0.25) {
                    word = `(${word})`;
                }
                else if (r < 0.5) {
                    word = `{${word}}`;
                }
                else if (r < 0.75) {
                    word = `[${word}]`;
                }
                else {
                    word = `<${word}>`;
                }
            }
            else {
                word = `(${word})`;
            }
        }
        else if (Math.random() < 0.013 &&
            lastChar != "," &&
            lastChar != "." &&
            lastChar != ";" &&
            lastChar != "" &&
            lastChar != ":") {
            if (currentLanguage == "french") {
                word = ":";
            }
            else if (currentLanguage == "greek") {
                word = "";
            }
            else {
                word += ":";
            }
        }
        else if (Math.random() < 0.014 &&
            lastChar != "," &&
            lastChar != "." &&
            previousWord != "-") {
            word = "-";
        }
        else if (Math.random() < 0.015 &&
            lastChar != "," &&
            lastChar != "." &&
            lastChar != ";" &&
            lastChar != "" &&
            lastChar != ":") {
            if (currentLanguage == "french") {
                word = ";";
            }
            else if (currentLanguage == "greek") {
                word = "";
            }
            else if (currentLanguage == "arabic") {
                word += "";
            }
            else {
                word += ";";
            }
        }
        else if (Math.random() < 0.2 && lastChar != ",") {
            if (currentLanguage == "arabic" ||
                currentLanguage == "urdu" ||
                currentLanguage == "persian") {
                word += "";
            }
            else {
                word += ",";
            }
        }
        else if (Math.random() < 0.25 && currentLanguage == "code") {
            const specials = ["{", "}", "[", "]", "(", ")", ";", "=", "+", "%", "/"];
            word = Misc.randomElementFromArray(specials);
        }
    }
    return word;
}
exports.punctuateWord = punctuateWord;
function startTest() {
    if (PageTransition.get()) {
        return false;
    }
    if (!UpdateConfig.dbConfigLoaded) {
        UpdateConfig.setChangedBeforeDb(true);
    }
    if (firebase_1.Auth.currentUser !== null) {
        AnalyticsController.log("testStarted");
    }
    else {
        AnalyticsController.log("testStartedNoLogin");
    }
    TestActive.set(true);
    Replay.startReplayRecording();
    Replay.replayGetWordsList(TestWords.words.list);
    TestInput.resetKeypressTimings();
    TimerProgress.restart();
    TimerProgress.show();
    $("#liveWpm").text("0");
    LiveWpm.show();
    LiveAcc.show();
    LiveBurst.show();
    TimerProgress.update();
    TestTimer.clear();
    Monkey.show();
    if (config_1.default.funbox === "memory") {
        Funbox.resetMemoryTimer();
        $("#wordsWrapper").addClass("hidden");
    }
    try {
        if (config_1.default.paceCaret !== "off" ||
            (config_1.default.repeatedPace && TestState.isPaceRepeat)) {
            PaceCaret.start();
        }
    }
    catch (e) { }
    //use a recursive self-adjusting timer to avoid time drift
    TestStats.setStart(performance.now());
    TestTimer.start();
    return true;
}
exports.startTest = startTest;
function restart(withSameWordset = false, _, // this is nosave and should be renamed to nosave when needed
event, practiseMissed = false, noAnim = false) {
    if (TestUI.testRestarting || TestUI.resultCalculating) {
        event === null || event === void 0 ? void 0 : event.preventDefault();
        return;
    }
    if (ActivePage.get() == "test" && !TestUI.resultVisible) {
        if (!ManualRestart.get()) {
            if (TestWords.hasTab) {
                if (!(event === null || event === void 0 ? void 0 : event.shiftKey))
                    return;
            }
            if (config_1.default.mode !== "zen")
                event === null || event === void 0 ? void 0 : event.preventDefault();
            if (!Misc.canQuickRestart(config_1.default.mode, config_1.default.words, config_1.default.time, CustomText)) {
                let message = "Use your mouse to confirm.";
                if (config_1.default.quickTab) {
                    message = "Press shift + tab or use your mouse to confirm.";
                }
                Notifications.add("Quick restart disabled. " + message, 0, 3);
                return;
            }
            // }else{
            //   return;
            // }
        }
    }
    if (TestActive.get()) {
        TestInput.pushKeypressesToHistory();
        const testSeconds = TestStats.calculateTestSeconds(performance.now());
        const afkseconds = TestStats.calculateAfkSeconds(testSeconds);
        // incompleteTestSeconds += ;
        let tt = testSeconds - afkseconds;
        if (tt < 0)
            tt = 0;
        console.log(`increasing incomplete time by ${tt}s (${testSeconds}s - ${afkseconds}s afk)`);
        TestStats.incrementIncompleteSeconds(tt);
        TestStats.incrementRestartCount();
        if (tt > 600) {
            Notifications.add(`Your time typing just increased by ${Misc.roundTo2(tt / 60)} minutes. If you think this is incorrect please contact Miodec and dont refresh the website.`, -1);
        }
        // restartCount++;
    }
    if (config_1.default.mode == "zen") {
        $("#words").empty();
    }
    if (PractiseWords.before.mode !== null &&
        !withSameWordset &&
        !practiseMissed) {
        Notifications.add("Reverting to previous settings.", 0);
        if (PractiseWords.before.punctuation !== null) {
            UpdateConfig.setPunctuation(PractiseWords.before.punctuation);
        }
        if (PractiseWords.before.numbers !== null) {
            UpdateConfig.setNumbers(PractiseWords.before.numbers);
        }
        UpdateConfig.setMode(PractiseWords.before.mode);
        PractiseWords.resetBefore();
    }
    let repeatWithPace = false;
    if (TestUI.resultVisible && config_1.default.repeatedPace && withSameWordset) {
        repeatWithPace = true;
    }
    ManualRestart.reset();
    TestTimer.clear();
    TestStats.restart();
    TestInput.restart();
    TestInput.corrected.reset();
    ShiftTracker.reset();
    Caret.hide();
    TestActive.set(false);
    Replay.stopReplayRecording();
    LiveWpm.hide();
    LiveAcc.hide();
    LiveBurst.hide();
    TimerProgress.hide();
    Replay.pauseReplay();
    TestInput.setBailout(false);
    PaceCaret.reset();
    Monkey.hide();
    if (config_1.default.showAverage)
        Last10Average.update();
    $("#showWordHistoryButton").removeClass("loaded");
    $("#restartTestButton").blur();
    Funbox.resetMemoryTimer();
    QuoteRatePopup.clearQuoteStats();
    if (ActivePage.get() == "test" && window.scrollY > 0) {
        window.scrollTo({ top: 0, behavior: "smooth" });
    }
    $("#wordsInput").val(" ");
    TestUI.reset();
    $("#timerNumber").css("opacity", 0);
    let el = null;
    if (TestUI.resultVisible) {
        //results are being displayed
        el = $("#result");
    }
    else {
        //words are being displayed
        el = $("#typingTest");
    }
    if (TestUI.resultVisible) {
        if (config_1.default.randomTheme !== "off" &&
            !PageTransition.get()
        // && Config.customThemeId === ""
        ) {
            ThemeController.randomizeTheme();
        }
    }
    TestUI.setResultVisible(false);
    PageTransition.set(true);
    TestUI.setTestRestarting(true);
    el.stop(true, true).animate({
        opacity: 0,
    }, noAnim ? 0 : 125, () => __awaiter(this, void 0, void 0, function* () {
        if (ActivePage.get() == "test")
            Focus.set(false);
        TestUI.focusWords();
        $("#monkey .fast").stop(true, true).css("opacity", 0);
        $("#monkey").stop(true, true).css({ animationDuration: "0s" });
        $("#typingTest").css("opacity", 0).removeClass("hidden");
        $("#wordsInput").val(" ");
        let shouldQuoteRepeat = false;
        if (config_1.default.mode === "quote" &&
            config_1.default.repeatQuotes === "typing" &&
            failReason !== "") {
            shouldQuoteRepeat = true;
        }
        yield Funbox.rememberSettings();
        if (config_1.default.funbox === "arrows") {
            UpdateConfig.setPunctuation(false, true);
            UpdateConfig.setNumbers(false, true);
        }
        else if (config_1.default.funbox === "58008") {
            UpdateConfig.setNumbers(false, true);
        }
        else if (config_1.default.funbox === "specials") {
            UpdateConfig.setPunctuation(false, true);
            UpdateConfig.setNumbers(false, true);
        }
        else if (config_1.default.funbox === "ascii") {
            UpdateConfig.setPunctuation(false, true);
            UpdateConfig.setNumbers(false, true);
        }
        if (withSameWordset &&
            (config_1.default.funbox === "plus_one" || config_1.default.funbox === "plus_two")) {
            Notifications.add("Sorry, this funbox won't work with repeated tests.", 0, 4);
            withSameWordset = false;
        }
        if (!withSameWordset && !shouldQuoteRepeat) {
            TestState.setRepeated(false);
            TestState.setPaceRepeat(repeatWithPace);
            TestWords.setHasTab(false);
            yield init();
            yield PaceCaret.init();
        }
        else {
            TestState.setRepeated(true);
            TestState.setPaceRepeat(repeatWithPace);
            TestActive.set(false);
            Replay.stopReplayRecording();
            TestWords.words.resetCurrentIndex();
            TestInput.input.reset();
            TestUI.showWords();
            if (config_1.default.keymapMode === "next" && config_1.default.mode !== "zen") {
                Keymap.highlightKey(TestWords.words
                    .getCurrent()
                    .substring(TestInput.input.current.length, TestInput.input.current.length + 1)
                    .toString()
                    .toUpperCase());
            }
            Funbox.toggleScript(TestWords.words.getCurrent());
            yield PaceCaret.init();
        }
        failReason = "";
        if (config_1.default.mode === "quote") {
            TestState.setRepeated(false);
        }
        if (config_1.default.keymapMode !== "off") {
            Keymap.show();
        }
        else {
            Keymap.hide();
        }
        (document.querySelector("#miniTimerAndLiveWpm .wpm")).innerHTML = "0";
        (document.querySelector("#miniTimerAndLiveWpm .acc")).innerHTML = "100%";
        (document.querySelector("#miniTimerAndLiveWpm .burst")).innerHTML = "0";
        document.querySelector("#liveWpm").innerHTML = "0";
        document.querySelector("#liveAcc").innerHTML = "100%";
        document.querySelector("#liveBurst").innerHTML = "0";
        if (config_1.default.funbox === "memory") {
            Funbox.startMemoryTimer();
            if (config_1.default.keymapMode === "next") {
                UpdateConfig.setKeymapMode("react");
            }
        }
        const mode2 = Misc.getMode2(config_1.default, TestWords.randomQuote);
        let fbtext = "";
        if (config_1.default.funbox !== "none") {
            fbtext = " " + config_1.default.funbox;
        }
        $(".pageTest #premidTestMode").text(`${config_1.default.mode} ${mode2} ${config_1.default.language.replace(/_/g, " ")}${fbtext}`);
        $(".pageTest #premidSecondsLeft").text(config_1.default.time);
        if (config_1.default.funbox === "layoutfluid") {
            UpdateConfig.setLayout(config_1.default.customLayoutfluid
                ? config_1.default.customLayoutfluid.split("#")[0]
                : "qwerty", true);
            UpdateConfig.setKeymapLayout(config_1.default.customLayoutfluid
                ? config_1.default.customLayoutfluid.split("#")[0]
                : "qwerty", true);
            Keymap.highlightKey(TestWords.words
                .getCurrent()
                .substring(TestInput.input.current.length, TestInput.input.current.length + 1)
                .toString()
                .toUpperCase());
        }
        $("#result").addClass("hidden");
        $("#testModesNotice").removeClass("hidden").css({
            opacity: 1,
        });
        // resetPaceCaret();
        ModesNotice.update();
        $("#typingTest")
            .css("opacity", 0)
            .removeClass("hidden")
            .stop(true, true)
            .animate({
            opacity: 1,
        }, noAnim ? 0 : 125, () => {
            TestUI.setTestRestarting(false);
            // resetPaceCaret();
            PbCrown.hide();
            TestTimer.clear();
            if ($("#commandLineWrapper").hasClass("hidden")) {
                TestUI.focusWords();
            }
            // ChartController.result.update();
            PageTransition.set(false);
            // console.log(TestStats.incompleteSeconds);
            // console.log(TestStats.restartCount);
        });
    }));
}
exports.restart = restart;
function applyFunboxesToWord(word, wordset) {
    var _a;
    if (config_1.default.funbox === "rAnDoMcAsE") {
        let randomcaseword = "";
        for (let i = 0; i < word.length; i++) {
            if (i % 2 != 0) {
                randomcaseword += word[i].toUpperCase();
            }
            else {
                randomcaseword += word[i];
            }
        }
        word = randomcaseword;
    }
    else if (config_1.default.funbox === "capitals") {
        word = Misc.capitalizeFirstLetterOfEachWord(word);
    }
    else if (config_1.default.funbox === "gibberish") {
        word = Misc.getGibberish();
    }
    else if (config_1.default.funbox === "arrows") {
        word = Misc.getArrows();
    }
    else if (config_1.default.funbox === "58008") {
        word = Misc.getNumbers(7);
    }
    else if (config_1.default.funbox === "specials") {
        word = Misc.getSpecials();
    }
    else if (config_1.default.funbox === "ascii") {
        word = Misc.getASCII();
    }
    else if (wordset !== undefined && config_1.default.funbox === "weakspot") {
        word = WeakSpot.getWord(wordset);
    }
    else if (wordset !== undefined && config_1.default.funbox === "tbdmode") {
        word = ((_a = (0, tbd_mode_1.getTbdMode)()) === null || _a === void 0 ? void 0 : _a.getWord(wordset)) || word;
    }
    return word;
}
function applyBritishEnglishToWord(word) {
    return __awaiter(this, void 0, void 0, function* () {
        if (config_1.default.britishEnglish && /english/.test(config_1.default.language)) {
            word = yield BritishEnglish.replace(word);
        }
        return word;
    });
}
function applyLazyModeToWord(word, language) {
    if (config_1.default.lazyMode === true && !language.noLazyMode) {
        word = LazyMode.replaceAccents(word, language.accents);
    }
    return word;
}
function getNextWord(wordset, language, wordsBound) {
    var _a, _b;
    return __awaiter(this, void 0, void 0, function* () {
        let randomWord = wordset.randomWord();
        const previousWord = TestWords.words.get(TestWords.words.length - 1, true);
        const previousWord2 = TestWords.words.get(TestWords.words.length - 2, true);
        if (config_1.default.mode === "quote") {
            randomWord =
                (_b = (_a = TestWords.randomQuote.textSplit) === null || _a === void 0 ? void 0 : _a[TestWords.words.length]) !== null && _b !== void 0 ? _b : "";
        }
        else if (config_1.default.mode == "custom" &&
            !CustomText.isWordRandom &&
            !CustomText.isTimeRandom) {
            randomWord = CustomText.text[TestWords.words.length];
        }
        else if (config_1.default.mode == "custom" &&
            (CustomText.isWordRandom || CustomText.isTimeRandom) &&
            (wordset.length < 4 || PractiseWords.before.mode !== null)) {
            randomWord = wordset.randomWord();
        }
        else {
            let regenarationCount = 0; //infinite loop emergency stop button
            while (regenarationCount < 100 &&
                (previousWord == randomWord ||
                    previousWord2 == randomWord ||
                    (!config_1.default.punctuation && randomWord == "I"))) {
                regenarationCount++;
                randomWord = wordset.randomWord();
            }
        }
        if (randomWord === undefined) {
            randomWord = wordset.randomWord();
        }
        randomWord = randomWord.replace(/ +/gm, " ");
        randomWord = randomWord.replace(/^ | $/gm, "");
        randomWord = applyLazyModeToWord(randomWord, language);
        randomWord = yield applyBritishEnglishToWord(randomWord);
        randomWord = applyFunboxesToWord(randomWord, wordset);
        if (config_1.default.punctuation) {
            randomWord = punctuateWord(TestWords.words.get(TestWords.words.length - 1), randomWord, TestWords.words.length, wordsBound);
        }
        if (config_1.default.numbers) {
            if (Math.random() < 0.1) {
                randomWord = Misc.getNumbers(4);
            }
        }
        return randomWord;
    });
}
let rememberLazyMode;
function init() {
    return __awaiter(this, void 0, void 0, function* () {
        TestActive.set(false);
        MonkeyPower.reset();
        Replay.stopReplayRecording();
        TestWords.words.reset();
        TestUI.setCurrentWordElementIndex(0);
        // accuracy = {
        //   correct: 0,
        //   incorrect: 0,
        // };
        TestInput.input.resetHistory();
        TestInput.input.resetCurrent();
        if (ActivePage.get() == "test") {
            yield Funbox.activate();
        }
        let language = yield Misc.getLanguage(config_1.default.language);
        if (language && language.name !== config_1.default.language) {
            UpdateConfig.setLanguage("english");
        }
        if (!language) {
            UpdateConfig.setLanguage("english");
            language = yield Misc.getLanguage(config_1.default.language);
        }
        if (config_1.default.lazyMode === true && language.noLazyMode) {
            rememberLazyMode = true;
            Notifications.add("This language does not support lazy mode.", 0);
            UpdateConfig.setLazyMode(false, true);
        }
        else if (rememberLazyMode === true && !language.noLazyMode) {
            UpdateConfig.setLazyMode(true, true);
        }
        if (config_1.default.lazyMode === false && !language.noLazyMode) {
            rememberLazyMode = false;
        }
        let wordsBound = 100;
        if (config_1.default.showAllLines) {
            if (config_1.default.mode === "quote") {
                wordsBound = 100;
            }
            else if (config_1.default.mode === "custom") {
                if (CustomText.isWordRandom) {
                    wordsBound = CustomText.word;
                }
                else if (CustomText.isTimeRandom) {
                    wordsBound = 100;
                }
                else {
                    wordsBound = CustomText.text.length;
                }
            }
            else if (config_1.default.mode != "time") {
                wordsBound = config_1.default.words;
            }
        }
        else {
            if (config_1.default.mode === "words" && config_1.default.words < wordsBound) {
                wordsBound = config_1.default.words;
            }
            if (config_1.default.mode == "custom" &&
                CustomText.isWordRandom &&
                CustomText.word < wordsBound) {
                wordsBound = CustomText.word;
            }
            if (config_1.default.mode == "custom" && CustomText.isTimeRandom) {
                wordsBound = 100;
            }
            if (config_1.default.mode == "custom" &&
                !CustomText.isWordRandom &&
                !CustomText.isTimeRandom &&
                CustomText.text.length < wordsBound) {
                wordsBound = CustomText.text.length;
            }
        }
        if ((config_1.default.mode === "custom" &&
            CustomText.isWordRandom &&
            CustomText.word == 0) ||
            (config_1.default.mode === "custom" &&
                CustomText.isTimeRandom &&
                CustomText.time == 0)) {
            wordsBound = 100;
        }
        if (config_1.default.mode === "words" && config_1.default.words === 0) {
            wordsBound = 100;
        }
        if (config_1.default.funbox === "plus_one") {
            wordsBound = 2;
            if (config_1.default.mode === "words" && config_1.default.words < wordsBound) {
                wordsBound = config_1.default.words;
            }
        }
        if (config_1.default.funbox === "plus_two") {
            wordsBound = 3;
            if (config_1.default.mode === "words" && config_1.default.words < wordsBound) {
                wordsBound = config_1.default.words;
            }
        }
        if (config_1.default.mode == "time" ||
            config_1.default.mode == "words" ||
            config_1.default.mode == "custom") {
            let wordList = language.words;
            if (config_1.default.mode == "custom") {
                wordList = CustomText.text;
            }
            const wordset = Wordset.withWords(wordList, config_1.default.funbox);
            if ((config_1.default.funbox == "wikipedia" || config_1.default.funbox == "poetry") &&
                config_1.default.mode != "custom") {
                let wordCount = 0;
                // If mode is words, get as many sections as you need until the wordCount is fullfilled
                while ((config_1.default.mode == "words" && config_1.default.words >= wordCount) ||
                    (config_1.default.mode === "time" && wordCount < 100)) {
                    const section = config_1.default.funbox == "wikipedia"
                        ? yield Wikipedia.getSection(config_1.default.language)
                        : yield Poetry.getPoem();
                    if (section === undefined)
                        continue;
                    for (const word of section.words) {
                        if (wordCount >= config_1.default.words && config_1.default.mode == "words") {
                            wordCount++;
                            break;
                        }
                        wordCount++;
                        TestWords.words.push(word);
                    }
                }
            }
            else {
                for (let i = 0; i < wordsBound; i++) {
                    const randomWord = yield getNextWord(wordset, language, wordsBound);
                    if (/\t/g.test(randomWord)) {
                        TestWords.setHasTab(true);
                    }
                    if (/ +/.test(randomWord)) {
                        const randomList = randomWord.split(" ");
                        let id = 0;
                        while (id < randomList.length) {
                            TestWords.words.push(randomList[id]);
                            id++;
                            if (TestWords.words.length == wordsBound &&
                                config_1.default.mode == "custom" &&
                                CustomText.isWordRandom) {
                                break;
                            }
                        }
                        if (config_1.default.mode == "custom" &&
                            !CustomText.isWordRandom &&
                            !CustomText.isTimeRandom) {
                            //
                        }
                        else {
                            i = TestWords.words.length - 1;
                        }
                    }
                    else {
                        TestWords.words.push(randomWord);
                    }
                }
            }
        }
        else if (config_1.default.mode === "quote") {
            const quotesCollection = yield quotes_controller_1.default.getQuotes(config_1.default.language, config_1.default.quoteLength);
            if (quotesCollection.length === 0) {
                TestUI.setTestRestarting(false);
                Notifications.add(`No ${config_1.default.language.replace(/_\d*k$/g, "")} quotes found`, 0);
                if (firebase_1.Auth.currentUser) {
                    QuoteSubmitPopup.show(false);
                }
                UpdateConfig.setMode("words");
                restart();
                return;
            }
            let rq = undefined;
            if (config_1.default.quoteLength.includes(-2) && config_1.default.quoteLength.length == 1) {
                const targetQuote = quotes_controller_1.default.getQuoteById(QuoteSearchPopup.selectedId);
                if (targetQuote === undefined) {
                    rq = quotesCollection.groups[0][0];
                    Notifications.add("Quote Id Does Not Exist", 0);
                }
                else {
                    rq = targetQuote;
                }
            }
            else {
                const randomQuote = quotes_controller_1.default.getRandomQuote();
                if (randomQuote === null) {
                    Notifications.add("No quotes found for selected quote length", 0);
                    TestUI.setTestRestarting(false);
                    return;
                }
                rq = randomQuote;
            }
            if (rq === undefined)
                return;
            rq.text = rq.text.replace(/ +/gm, " ");
            rq.text = rq.text.replace(/\\\\t/gm, "\t");
            rq.text = rq.text.replace(/\\\\n/gm, "\n");
            rq.text = rq.text.replace(/\\t/gm, "\t");
            rq.text = rq.text.replace(/\\n/gm, "\n");
            rq.text = rq.text.replace(/( *(\r\n|\r|\n) *)/g, "\n ");
            rq.text = rq.text.replace(//g, "...");
            rq.text = rq.text.trim();
            rq.textSplit = rq.text.split(" ");
            rq.language = config_1.default.language.replace(/_\d*k$/g, "");
            TestWords.setRandomQuote(rq);
            const w = TestWords.randomQuote.textSplit;
            if (w === undefined)
                return;
            if (config_1.default.showAllLines) {
                wordsBound = w.length;
            }
            else {
                wordsBound = Math.min(wordsBound, w.length);
            }
            for (let i = 0; i < wordsBound; i++) {
                if (/\t/g.test(w[i])) {
                    TestWords.setHasTab(true);
                }
                w[i] = applyLazyModeToWord(w[i], language);
                w[i] = yield applyBritishEnglishToWord(w[i]);
                w[i] = applyFunboxesToWord(w[i]);
                TestWords.words.push(w[i]);
            }
        }
        //handle right-to-left languages
        if (language.leftToRight) {
            TestUI.arrangeCharactersLeftToRight();
        }
        else {
            TestUI.arrangeCharactersRightToLeft();
        }
        if (language.ligatures) {
            $("#words").addClass("withLigatures");
            $("#resultWordsHistory .words").addClass("withLigatures");
            $("#resultReplay .words").addClass("withLigatures");
        }
        else {
            $("#words").removeClass("withLigatures");
            $("#resultWordsHistory .words").removeClass("withLigatures");
            $("#resultReplay .words").removeClass("withLigatures");
        }
        // if (Config.mode == "zen") {
        //   // Creating an empty active word element for zen mode
        //   $("#words").append('<div class="word active"></div>');
        //   $("#words").css("height", "auto");
        //   $("#wordsWrapper").css("height", "auto");
        // } else {
        TestUI.showWords();
        if (config_1.default.keymapMode === "next" && config_1.default.mode !== "zen") {
            Keymap.highlightKey(TestWords.words
                .getCurrent()
                .substring(TestInput.input.current.length, TestInput.input.current.length + 1)
                .toString()
                .toUpperCase());
        }
        Funbox.toggleScript(TestWords.words.getCurrent());
        // }
    });
}
exports.init = init;
function addWord() {
    var _a, _b;
    return __awaiter(this, void 0, void 0, function* () {
        let bound = 100;
        if (config_1.default.funbox === "plus_one")
            bound = 1;
        if (config_1.default.funbox === "plus_two")
            bound = 2;
        if (TestWords.words.length - TestInput.input.history.length > bound ||
            (config_1.default.mode === "words" &&
                TestWords.words.length >= config_1.default.words &&
                config_1.default.words > 0) ||
            (config_1.default.mode === "custom" &&
                CustomText.isWordRandom &&
                TestWords.words.length >= CustomText.word &&
                CustomText.word != 0) ||
            (config_1.default.mode === "custom" &&
                !CustomText.isWordRandom &&
                !CustomText.isTimeRandom &&
                TestWords.words.length >= CustomText.text.length) ||
            (config_1.default.mode === "quote" &&
                TestWords.words.length >= ((_b = (_a = TestWords.randomQuote.textSplit) === null || _a === void 0 ? void 0 : _a.length) !== null && _b !== void 0 ? _b : 0))) {
            return;
        }
        if (config_1.default.funbox === "wikipedia" || config_1.default.funbox == "poetry") {
            if (TestWords.words.length - TestWords.words.currentIndex < 20) {
                const section = config_1.default.funbox == "wikipedia"
                    ? yield Wikipedia.getSection(config_1.default.language)
                    : yield Poetry.getPoem();
                if (section === undefined)
                    return;
                let wordCount = 0;
                for (const word of section.words) {
                    if (wordCount >= config_1.default.words && config_1.default.mode == "words") {
                        break;
                    }
                    wordCount++;
                    TestWords.words.push(word);
                    TestUI.addWord(word);
                }
            }
            else {
                return;
            }
        }
        const language = config_1.default.mode !== "custom"
            ? yield Misc.getCurrentLanguage(config_1.default.language)
            : Object.assign(Object.assign({}, (yield Misc.getCurrentLanguage(config_1.default.language))), { words: CustomText.text });
        const wordset = Wordset.withWords(language.words, config_1.default.funbox);
        const randomWord = yield getNextWord(wordset, language, bound);
        const split = randomWord.split(" ");
        if (split.length > 1) {
            split.forEach((word) => {
                TestWords.words.push(word);
                TestUI.addWord(word);
            });
        }
        else {
            TestWords.words.push(randomWord);
            TestUI.addWord(randomWord);
        }
    });
}
exports.addWord = addWord;
const retrySaving = {
    completedEvent: null,
    canRetry: false,
};
function retrySavingResult() {
    return __awaiter(this, void 0, void 0, function* () {
        const { completedEvent } = retrySaving;
        if (completedEvent === null) {
            Notifications.add("Could not retry saving the result as the result no longer exists.", 0, -1);
            return;
        }
        if (!retrySaving.canRetry) {
            return;
        }
        retrySaving.canRetry = false;
        $("#retrySavingResultButton").addClass("hidden");
        AccountButton.loading(true);
        Notifications.add("Retrying to save...");
        const response = yield ape_1.default.results.save(completedEvent);
        AccountButton.loading(false);
        Result.hideCrown();
        if (response.status !== 200) {
            retrySaving.canRetry = true;
            $("#retrySavingResultButton").removeClass("hidden");
            return Notifications.add("Result not saved. " + response.message, -1);
        }
        completedEvent._id = response.data.insertedId;
        if (response.data.isPb) {
            completedEvent.isPb = true;
        }
        DB.saveLocalResult(completedEvent);
        DB.updateLocalStats({
            time: completedEvent.testDuration +
                completedEvent.incompleteTestSeconds -
                completedEvent.afkDuration,
            started: TestStats.restartCount + 1,
        });
        AnalyticsController.log("testCompleted");
        if (response.data.isPb) {
            //new pb
            Result.showCrown();
            Result.updateCrown();
            DB.saveLocalPB(config_1.default.mode, completedEvent.mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode, completedEvent.wpm, completedEvent.acc, completedEvent.rawWpm, completedEvent.consistency);
        }
        $("#retrySavingResultButton").addClass("hidden");
        Notifications.add("Result saved", 1);
    });
}
exports.retrySavingResult = retrySavingResult;
function buildCompletedEvent(difficultyFailed) {
    var _a, _b, _c;
    //build completed event object
    const completedEvent = {
        wpm: undefined,
        rawWpm: undefined,
        charStats: undefined,
        acc: undefined,
        mode: config_1.default.mode,
        mode2: undefined,
        quoteLength: -1,
        punctuation: config_1.default.punctuation,
        numbers: config_1.default.numbers,
        lazyMode: config_1.default.lazyMode,
        timestamp: Date.now(),
        language: config_1.default.language,
        restartCount: TestStats.restartCount,
        incompleteTestSeconds: TestStats.incompleteSeconds < 0
            ? 0
            : Misc.roundTo2(TestStats.incompleteSeconds),
        difficulty: config_1.default.difficulty,
        blindMode: config_1.default.blindMode,
        tags: undefined,
        keySpacing: TestInput.keypressTimings.spacing.array,
        keyDuration: TestInput.keypressTimings.duration.array,
        consistency: undefined,
        keyConsistency: undefined,
        funbox: config_1.default.funbox,
        bailedOut: TestInput.bailout,
        chartData: {
            wpm: TestInput.wpmHistory,
            raw: undefined,
            err: undefined,
        },
        customText: undefined,
        testDuration: undefined,
        afkDuration: undefined,
    };
    // stats
    const stats = TestStats.calculateStats();
    if (stats.time % 1 != 0 && config_1.default.mode !== "time") {
        TestStats.setLastSecondNotRound();
    }
    TestStats.setLastTestWpm(stats.wpm);
    completedEvent.wpm = stats.wpm;
    completedEvent.rawWpm = stats.wpmRaw;
    completedEvent.charStats = [
        stats.correctChars + stats.correctSpaces,
        stats.incorrectChars,
        stats.extraChars,
        stats.missedChars,
    ];
    completedEvent.acc = stats.acc;
    // if the last second was not rounded, add another data point to the history
    if (TestStats.lastSecondNotRound && !difficultyFailed) {
        const wpmAndRaw = TestStats.calculateWpmAndRaw();
        TestInput.pushToWpmHistory(wpmAndRaw.wpm);
        TestInput.pushToRawHistory(wpmAndRaw.raw);
        TestInput.pushKeypressesToHistory();
    }
    //consistency
    const rawPerSecond = TestInput.keypressPerSecond.map((f) => Math.round((f.count / 5) * 60));
    const stddev = Misc.stdDev(rawPerSecond);
    const avg = Misc.mean(rawPerSecond);
    let consistency = Misc.roundTo2(Misc.kogasa(stddev / avg));
    let keyConsistencyArray = TestInput.keypressTimings.spacing.array === "toolong"
        ? []
        : TestInput.keypressTimings.spacing.array.slice();
    if (keyConsistencyArray.length > 0) {
        keyConsistencyArray = keyConsistencyArray.slice(0, keyConsistencyArray.length - 1);
    }
    let keyConsistency = Misc.roundTo2(Misc.kogasa(Misc.stdDev(keyConsistencyArray) / Misc.mean(keyConsistencyArray)));
    if (!consistency || isNaN(consistency)) {
        consistency = 0;
    }
    if (!keyConsistency || isNaN(keyConsistency)) {
        keyConsistency = 0;
    }
    completedEvent.keyConsistency = keyConsistency;
    completedEvent.consistency = consistency;
    const smoothedraw = Misc.smooth(rawPerSecond, 1);
    completedEvent.chartData.raw = smoothedraw;
    completedEvent.chartData.unsmoothedRaw = rawPerSecond;
    //smoothed consistency
    const stddev2 = Misc.stdDev(smoothedraw);
    const avg2 = Misc.mean(smoothedraw);
    const smoothConsistency = Misc.roundTo2(Misc.kogasa(stddev2 / avg2));
    completedEvent.smoothConsistency = smoothConsistency;
    //wpm consistency
    const stddev3 = Misc.stdDev((_a = completedEvent.chartData.wpm) !== null && _a !== void 0 ? _a : []);
    const avg3 = Misc.mean((_b = completedEvent.chartData.wpm) !== null && _b !== void 0 ? _b : []);
    const wpmConsistency = Misc.roundTo2(Misc.kogasa(stddev3 / avg3));
    completedEvent.wpmConsistency = wpmConsistency;
    completedEvent.testDuration = parseFloat(stats.time.toString());
    completedEvent.afkDuration = TestStats.calculateAfkSeconds(completedEvent.testDuration);
    completedEvent.chartData.err = [];
    for (let i = 0; i < TestInput.keypressPerSecond.length; i++) {
        completedEvent.chartData.err.push(TestInput.keypressPerSecond[i].errors);
    }
    if (config_1.default.mode === "quote") {
        completedEvent.quoteLength = TestWords.randomQuote.group;
        completedEvent.lang = config_1.default.language.replace(/_\d*k$/g, "");
    }
    // @ts-ignore TODO fix this
    completedEvent.mode2 = Misc.getMode2(config_1.default, TestWords.randomQuote);
    if (config_1.default.mode === "custom") {
        completedEvent.customText = {};
        completedEvent.customText.textLen = CustomText.text.length;
        completedEvent.customText.isWordRandom = CustomText.isWordRandom;
        completedEvent.customText.isTimeRandom = CustomText.isTimeRandom;
        completedEvent.customText.word = CustomText.word;
        completedEvent.customText.time = CustomText.time;
    }
    else {
        delete completedEvent.customText;
    }
    //tags
    const activeTagsIds = [];
    try {
        (_c = DB.getSnapshot().tags) === null || _c === void 0 ? void 0 : _c.forEach((tag) => {
            if (tag.active === true) {
                activeTagsIds.push(tag._id);
            }
        });
    }
    catch (e) { }
    completedEvent.tags = activeTagsIds;
    if (completedEvent.mode != "custom")
        delete completedEvent.customText;
    return completedEvent;
}
function finish(difficultyFailed = false) {
    var _a;
    return __awaiter(this, void 0, void 0, function* () {
        if (!TestActive.get())
            return;
        if (config_1.default.mode == "zen" && TestInput.input.current.length != 0) {
            TestInput.input.pushHistory();
            TestInput.corrected.pushHistory();
            Replay.replayGetWordsList(TestInput.input.history);
        }
        TestInput.recordKeypressSpacing(); //this is needed in case there is afk time at the end - to make sure test duration makes sense
        TestUI.setResultCalculating(true);
        TestUI.setResultVisible(true);
        TestStats.setEnd(performance.now());
        TestActive.set(false);
        Replay.stopReplayRecording();
        Focus.set(false);
        Caret.hide();
        LiveWpm.hide();
        PbCrown.hide();
        LiveAcc.hide();
        LiveBurst.hide();
        TimerProgress.hide();
        OutOfFocus.hide();
        TestTimer.clear();
        Funbox.clear();
        Monkey.hide();
        //need one more calculation for the last word if test auto ended
        if (TestInput.burstHistory.length !== TestInput.input.getHistory().length) {
            const burst = TestStats.calculateBurst();
            TestInput.pushBurstToHistory(burst);
        }
        //remove afk from zen
        if (config_1.default.mode == "zen" || TestInput.bailout) {
            TestStats.removeAfkData();
        }
        const completedEvent = buildCompletedEvent(difficultyFailed);
        //todo check if any fields are undefined
        ///////// completed event ready
        //afk check
        const kps = TestInput.keypressPerSecond.slice(-5);
        let afkDetected = kps.every((second) => second.afk);
        if (TestInput.bailout)
            afkDetected = false;
        let tooShort = false;
        let dontSave = false;
        //fail checks
        if (difficultyFailed) {
            Notifications.add(`Test failed - ${failReason}`, 0, 1);
            dontSave = true;
        }
        else if (afkDetected) {
            Notifications.add("Test invalid - AFK detected", 0);
            dontSave = true;
        }
        else if (TestState.isRepeated) {
            Notifications.add("Test invalid - repeated", 0);
            dontSave = true;
        }
        else if ((config_1.default.mode === "time" &&
            completedEvent.mode2 < 15 &&
            completedEvent.mode2 > 0) ||
            (config_1.default.mode === "time" &&
                completedEvent.mode2 == 0 &&
                completedEvent.testDuration < 15) ||
            (config_1.default.mode === "words" &&
                completedEvent.mode2 < 10 &&
                completedEvent.mode2 > 0) ||
            (config_1.default.mode === "words" &&
                completedEvent.mode2 == 0 &&
                completedEvent.testDuration < 15) ||
            (config_1.default.mode === "custom" &&
                !CustomText.isWordRandom &&
                !CustomText.isTimeRandom &&
                CustomText.text.length < 10) ||
            (config_1.default.mode === "custom" &&
                CustomText.isWordRandom &&
                !CustomText.isTimeRandom &&
                CustomText.word < 10) ||
            (config_1.default.mode === "custom" &&
                !CustomText.isWordRandom &&
                CustomText.isTimeRandom &&
                CustomText.time < 15) ||
            (config_1.default.mode === "zen" && completedEvent.testDuration < 15)) {
            Notifications.add("Test invalid - too short", 0);
            tooShort = true;
            dontSave = true;
        }
        else if (completedEvent.wpm < 0 || completedEvent.wpm > 350) {
            Notifications.add("Test invalid - wpm", 0);
            TestStats.setInvalid();
            dontSave = true;
        }
        else if (completedEvent.acc < 75 || completedEvent.acc > 100) {
            Notifications.add("Test invalid - accuracy", 0);
            TestStats.setInvalid();
            dontSave = true;
        }
        // test is valid
        if (!dontSave) {
            TodayTracker.addSeconds(completedEvent.testDuration +
                (TestStats.incompleteSeconds < 0
                    ? 0
                    : Misc.roundTo2(TestStats.incompleteSeconds)) -
                completedEvent.afkDuration);
            Result.updateTodayTracker();
        }
        if (firebase_1.Auth.currentUser == null) {
            $(".pageTest #result #rateQuoteButton").addClass("hidden");
            $(".pageTest #result #reportQuoteButton").addClass("hidden");
            AnalyticsController.log("testCompletedNoLogin");
            if (!dontSave)
                exports.notSignedInLastResult = completedEvent;
            dontSave = true;
        }
        else {
            $(".pageTest #result #reportQuoteButton").removeClass("hidden");
        }
        yield Result.update(completedEvent, difficultyFailed, failReason, afkDetected, TestState.isRepeated, tooShort, TestWords.randomQuote, dontSave);
        if (completedEvent.chartData !== "toolong") {
            delete completedEvent.chartData.unsmoothedRaw;
        }
        if (completedEvent.testDuration > 122) {
            completedEvent.chartData = "toolong";
            completedEvent.keySpacing = "toolong";
            completedEvent.keyDuration = "toolong";
            TestInput.setKeypressTimingsTooLong();
        }
        if (dontSave) {
            AnalyticsController.log("testCompletedInvalid");
            return;
        }
        // user is logged in
        if (config_1.default.difficulty == "normal" ||
            ((config_1.default.difficulty == "master" || config_1.default.difficulty == "expert") &&
                !difficultyFailed)) {
            TestStats.resetIncomplete();
        }
        completedEvent.uid = (_a = firebase_1.Auth.currentUser) === null || _a === void 0 ? void 0 : _a.uid;
        Result.updateRateQuote(TestWords.randomQuote);
        AccountButton.loading(true);
        completedEvent.challenge = ChallengeContoller.verify(completedEvent);
        if (completedEvent.challenge === null)
            completedEvent === null || completedEvent === void 0 ? true : delete completedEvent.challenge;
        completedEvent.hash = (0, object_hash_1.default)(completedEvent);
        const response = yield ape_1.default.results.save(completedEvent);
        AccountButton.loading(false);
        if (response.status !== 200) {
            console.log("Error saving result", completedEvent);
            $("#retrySavingResultButton").removeClass("hidden");
            if (response.message === "Incorrect result hash") {
                console.log(completedEvent);
            }
            retrySaving.completedEvent = completedEvent;
            retrySaving.canRetry = true;
            return Notifications.add("Failed to save result: " + response.message, -1);
        }
        Result.hideCrown();
        completedEvent._id = response.data.insertedId;
        if (response.data.isPb) {
            completedEvent.isPb = true;
        }
        DB.saveLocalResult(completedEvent);
        DB.updateLocalStats({
            time: completedEvent.testDuration +
                completedEvent.incompleteTestSeconds -
                completedEvent.afkDuration,
            started: TestStats.restartCount + 1,
        });
        AnalyticsController.log("testCompleted");
        if (response.data.isPb) {
            //new pb
            Result.showCrown();
            Result.updateCrown();
            DB.saveLocalPB(config_1.default.mode, completedEvent.mode2, config_1.default.punctuation, config_1.default.language, config_1.default.difficulty, config_1.default.lazyMode, completedEvent.wpm, completedEvent.acc, completedEvent.rawWpm, completedEvent.consistency);
        }
        $("#retrySavingResultButton").addClass("hidden");
    });
}
exports.finish = finish;
function fail(reason) {
    failReason = reason;
    // input.pushHistory();
    // corrected.pushHistory();
    TestInput.pushKeypressesToHistory();
    finish(true);
    const testSeconds = TestStats.calculateTestSeconds(performance.now());
    const afkseconds = TestStats.calculateAfkSeconds(testSeconds);
    let tt = testSeconds - afkseconds;
    if (tt < 0)
        tt = 0;
    TestStats.incrementIncompleteSeconds(tt);
    TestStats.incrementRestartCount();
}
exports.fail = fail;
$(document).on("click", "#testModesNotice .text-button.restart", () => {
    restart();
});
$(document).on("keypress", "#restartTestButton", (event) => {
    if (event.key === "Enter") {
        ManualRestart.reset();
        if (TestActive.get() &&
            config_1.default.repeatQuotes === "typing" &&
            config_1.default.mode === "quote") {
            restart(true);
        }
        else {
            restart();
        }
    }
});
$(document.body).on("click", "#restartTestButton", () => {
    ManualRestart.set();
    if (TestUI.resultCalculating)
        return;
    if (TestActive.get() &&
        config_1.default.repeatQuotes === "typing" &&
        config_1.default.mode === "quote") {
        restart(true);
    }
    else {
        restart();
    }
});
$(document.body).on("click", "#retrySavingResultButton", retrySavingResult);
$(document).on("keypress", "#nextTestButton", (event) => {
    if (event.key === "Enter") {
        restart();
    }
});
$(document.body).on("click", "#nextTestButton", () => {
    ManualRestart.set();
    restart();
});
$(document.body).on("click", "#restartTestButtonWithSameWordset", () => {
    if (config_1.default.mode == "zen") {
        Notifications.add("Repeat test disabled in zen mode");
        return;
    }
    ManualRestart.set();
    restart(true);
});
$(document).on("keypress", "#restartTestButtonWithSameWordset", (event) => {
    if (config_1.default.mode == "zen") {
        Notifications.add("Repeat test disabled in zen mode");
        return;
    }
    if (event.key === "Enter") {
        restart(true);
    }
});
$(document).on("click", "#top .config .wordCount .text-button", (e) => {
    var _a;
    const wrd = (_a = $(e.currentTarget).attr("wordCount")) !== null && _a !== void 0 ? _a : "15";
    if (wrd != "custom") {
        UpdateConfig.setWordCount(parseInt(wrd));
        ManualRestart.set();
        restart();
    }
});
$(document).on("click", "#top .config .time .text-button", (e) => {
    var _a;
    const mode = (_a = $(e.currentTarget).attr("timeConfig")) !== null && _a !== void 0 ? _a : "10";
    if (mode != "custom") {
        UpdateConfig.setTimeConfig(parseInt(mode));
        ManualRestart.set();
        restart();
    }
});
$(document).on("click", "#top .config .quoteLength .text-button", (e) => {
    var _a;
    let len = parseInt((_a = $(e.currentTarget).attr("quoteLength")) !== null && _a !== void 0 ? _a : "1");
    if (len != -2) {
        if (len == -1) {
            len = [0, 1, 2, 3];
        }
        UpdateConfig.setQuoteLength(len, false, e.shiftKey);
        ManualRestart.set();
        restart();
    }
});
$(document).on("click", "#top .config .punctuationMode .text-button", () => {
    UpdateConfig.setPunctuation(!config_1.default.punctuation);
    ManualRestart.set();
    restart();
});
$(document).on("click", "#top .config .numbersMode .text-button", () => {
    UpdateConfig.setNumbers(!config_1.default.numbers);
    ManualRestart.set();
    restart();
});
$(document).on("click", "#top .config .mode .text-button", (e) => {
    var _a;
    if ($(e.currentTarget).hasClass("active"))
        return;
    const mode = ((_a = $(e.currentTarget).attr("mode")) !== null && _a !== void 0 ? _a : "time");
    if (mode === undefined)
        return;
    UpdateConfig.setMode(mode);
    ManualRestart.set();
    restart();
});
$("#practiseWordsPopup .button.missed").on("click", () => {
    PractiseWords.hidePopup();
    PractiseWords.init(true, false);
    restart(false, false, undefined, true);
});
$("#practiseWordsPopup .button.slow").on("click", () => {
    PractiseWords.hidePopup();
    PractiseWords.init(false, true);
    restart(false, false, undefined, true);
});
$("#practiseWordsPopup .button.both").on("click", () => {
    PractiseWords.hidePopup();
    PractiseWords.init(true, true);
    restart(false, false, undefined, true);
});
$(document).on("click", "#quoteSearchPopup #quoteSearchResults .searchResult", (e) => {
    var _a;
    if (e.target.classList.contains("report")) {
        return;
    }
    const sid = parseInt((_a = $(e.currentTarget).attr("id")) !== null && _a !== void 0 ? _a : "");
    QuoteSearchPopup.setSelectedId(sid);
    if (QuoteSearchPopup.apply(sid) === true)
        restart();
});
$(document).on("click", "#top #menu #startTestButton, #top .logo", () => {
    if (ActivePage.get() === "test")
        restart();
});
// ===============================
ConfigEvent.subscribe((eventKey, eventValue, nosave) => {
    if (eventKey === "difficulty" && !nosave)
        restart(false, nosave);
    if (eventKey === "showAllLines" && !nosave)
        restart();
    if (eventKey === "keymapMode" && !nosave)
        restart(false, nosave);
    if (eventKey === "lazyMode" && eventValue === false && !nosave) {
        rememberLazyMode = false;
    }
});
TimerEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "fail" && eventValue !== undefined)
        fail(eventValue);
    if (eventKey === "finish")
        finish();
});
ResetRequestedEvent.subscribe(() => {
    restart();
});


/***/ }),

/***/ "./src/scripts/test/test-state.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-state.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.setActiveChallenge = exports.setPaceRepeat = exports.setRepeated = exports.activeChallenge = exports.isPaceRepeat = exports.isRepeated = void 0;
exports.isRepeated = false;
exports.isPaceRepeat = false;
exports.activeChallenge = null;
function setRepeated(tf) {
    exports.isRepeated = tf;
}
exports.setRepeated = setRepeated;
function setPaceRepeat(tf) {
    exports.isPaceRepeat = tf;
}
exports.setPaceRepeat = setPaceRepeat;
function setActiveChallenge(val) {
    exports.activeChallenge = val;
}
exports.setActiveChallenge = setActiveChallenge;


/***/ }),

/***/ "./src/scripts/test/test-stats.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-stats.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.calculateStats = exports.removeAfkData = exports.calculateAccuracy = exports.calculateBurst = exports.setLastSecondNotRound = exports.calculateAfkSeconds = exports.setStart = exports.setEnd = exports.calculateWpmAndRaw = exports.calculateTestSeconds = exports.setInvalid = exports.resetIncomplete = exports.incrementIncompleteSeconds = exports.incrementRestartCount = exports.incompleteSeconds = exports.restartCount = exports.restart = exports.getStats = exports.setLastTestWpm = exports.lastTestWpm = exports.lastSecondNotRound = exports.end2 = exports.start2 = exports.end = exports.start = exports.invalid = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
exports.invalid = false;
exports.lastSecondNotRound = false;
exports.lastTestWpm = 0;
function setLastTestWpm(wpm) {
    exports.lastTestWpm = wpm;
}
exports.setLastTestWpm = setLastTestWpm;
function getStats() {
    const ret = {
        start: exports.start,
        end: exports.end,
        wpmHistory: TestInput.wpmHistory,
        rawHistory: TestInput.wpmHistory,
        burstHistory: TestInput.burstHistory,
        keypressPerSecond: TestInput.keypressPerSecond,
        currentKeypress: TestInput.currentKeypress,
        lastKeypress: TestInput.lastKeypress,
        currentBurstStart: TestInput.currentBurstStart,
        lastSecondNotRound: exports.lastSecondNotRound,
        missedWords: TestInput.missedWords,
        accuracy: TestInput.accuracy,
        keypressTimings: TestInput.keypressTimings,
    };
    try {
        ret.keySpacingStats = {
            average: TestInput.keypressTimings.spacing.array.reduce((previous, current) => (current += previous)) / TestInput.keypressTimings.spacing.array.length,
            sd: Misc.stdDev(TestInput.keypressTimings.spacing.array),
        };
    }
    catch (e) {
        //
    }
    try {
        ret.keyDurationStats = {
            average: TestInput.keypressTimings.duration.array.reduce((previous, current) => (current += previous)) / TestInput.keypressTimings.duration.array.length,
            sd: Misc.stdDev(TestInput.keypressTimings.duration.array),
        };
    }
    catch (e) {
        //
    }
    return ret;
}
exports.getStats = getStats;
function restart() {
    exports.start = 0;
    exports.end = 0;
    exports.invalid = false;
    exports.lastSecondNotRound = false;
}
exports.restart = restart;
exports.restartCount = 0;
exports.incompleteSeconds = 0;
function incrementRestartCount() {
    exports.restartCount++;
}
exports.incrementRestartCount = incrementRestartCount;
function incrementIncompleteSeconds(val) {
    exports.incompleteSeconds += val;
}
exports.incrementIncompleteSeconds = incrementIncompleteSeconds;
function resetIncomplete() {
    exports.restartCount = 0;
    exports.incompleteSeconds = 0;
}
exports.resetIncomplete = resetIncomplete;
function setInvalid() {
    exports.invalid = true;
}
exports.setInvalid = setInvalid;
function calculateTestSeconds(now) {
    if (now === undefined) {
        const endAfkSeconds = (exports.end - TestInput.lastKeypress) / 1000;
        if ((config_1.default.mode == "zen" || TestInput.bailout) && endAfkSeconds < 7) {
            return (TestInput.lastKeypress - exports.start) / 1000;
        }
        else {
            return (exports.end - exports.start) / 1000;
        }
    }
    else {
        return (now - exports.start) / 1000;
    }
}
exports.calculateTestSeconds = calculateTestSeconds;
function calculateWpmAndRaw() {
    let chars = 0;
    let correctWordChars = 0;
    let spaces = 0;
    //check input history
    for (let i = 0; i < TestInput.input.history.length; i++) {
        const word = config_1.default.mode == "zen"
            ? TestInput.input.getHistory(i)
            : TestWords.words.get(i);
        if (TestInput.input.getHistory(i) == word) {
            //the word is correct
            //+1 for space
            correctWordChars += word.length;
            if (i < TestInput.input.history.length - 1 &&
                Misc.getLastChar(TestInput.input.getHistory(i)) !== "\n") {
                spaces++;
            }
        }
        chars += TestInput.input.getHistory(i).length;
    }
    if (TestInput.input.current !== "") {
        const word = config_1.default.mode == "zen"
            ? TestInput.input.current
            : TestWords.words.getCurrent();
        //check whats currently typed
        const toAdd = {
            correct: 0,
            incorrect: 0,
            missed: 0,
        };
        for (let c = 0; c < word.length; c++) {
            if (c < TestInput.input.current.length) {
                //on char that still has a word list pair
                if (TestInput.input.current[c] == word[c]) {
                    toAdd.correct++;
                }
                else {
                    toAdd.incorrect++;
                }
            }
            else {
                //on char that is extra
                toAdd.missed++;
            }
        }
        chars += toAdd.correct;
        chars += toAdd.incorrect;
        chars += toAdd.missed;
        if (toAdd.incorrect == 0) {
            //word is correct so far, add chars
            correctWordChars += toAdd.correct;
        }
    }
    if (config_1.default.funbox === "nospace" || config_1.default.funbox === "arrows") {
        spaces = 0;
    }
    chars += TestInput.input.current.length;
    const testSeconds = calculateTestSeconds(performance.now());
    const wpm = Math.round(((correctWordChars + spaces) * (60 / testSeconds)) / 5);
    const raw = Math.round(((chars + spaces) * (60 / testSeconds)) / 5);
    return {
        wpm: wpm,
        raw: raw,
    };
}
exports.calculateWpmAndRaw = calculateWpmAndRaw;
function setEnd(e) {
    exports.end = e;
    exports.end2 = Date.now();
}
exports.setEnd = setEnd;
function setStart(s) {
    exports.start = s;
    exports.start2 = Date.now();
}
exports.setStart = setStart;
function calculateAfkSeconds(testSeconds) {
    let extraAfk = 0;
    if (testSeconds !== undefined) {
        if (config_1.default.mode === "time") {
            extraAfk = Math.round(testSeconds) - TestInput.keypressPerSecond.length;
        }
        else {
            extraAfk = Math.ceil(testSeconds) - TestInput.keypressPerSecond.length;
        }
        if (extraAfk < 0)
            extraAfk = 0;
        // console.log("-- extra afk debug");
        // console.log("should be " + Math.ceil(testSeconds));
        // console.log(keypressPerSecond.length);
        // console.log(
        //   `gonna add extra ${extraAfk} seconds of afk because of no keypress data`
        // );
    }
    const ret = TestInput.keypressPerSecond.filter((x) => x.afk).length;
    return ret + extraAfk;
}
exports.calculateAfkSeconds = calculateAfkSeconds;
function setLastSecondNotRound() {
    exports.lastSecondNotRound = true;
}
exports.setLastSecondNotRound = setLastSecondNotRound;
function calculateBurst() {
    const timeToWrite = (performance.now() - TestInput.currentBurstStart) / 1000;
    let wordLength;
    wordLength = TestInput.input.current.length;
    if (wordLength == 0) {
        wordLength = TestInput.input.getHistoryLast().length;
    }
    const speed = Misc.roundTo2((wordLength * (60 / timeToWrite)) / 5);
    return Math.round(speed);
}
exports.calculateBurst = calculateBurst;
function calculateAccuracy() {
    const acc = (TestInput.accuracy.correct /
        (TestInput.accuracy.correct + TestInput.accuracy.incorrect)) *
        100;
    return isNaN(acc) ? 100 : acc;
}
exports.calculateAccuracy = calculateAccuracy;
function removeAfkData() {
    const testSeconds = calculateTestSeconds();
    TestInput.keypressPerSecond.splice(testSeconds);
    TestInput.keypressTimings.duration.array.splice(testSeconds);
    TestInput.keypressTimings.spacing.array.splice(testSeconds);
    TestInput.wpmHistory.splice(testSeconds);
}
exports.removeAfkData = removeAfkData;
function countChars() {
    let correctWordChars = 0;
    let correctChars = 0;
    let incorrectChars = 0;
    let extraChars = 0;
    let missedChars = 0;
    let spaces = 0;
    let correctspaces = 0;
    for (let i = 0; i < TestInput.input.history.length; i++) {
        const word = config_1.default.mode == "zen"
            ? TestInput.input.getHistory(i)
            : TestWords.words.get(i);
        if (TestInput.input.getHistory(i) === "") {
            //last word that was not started
            continue;
        }
        if (TestInput.input.getHistory(i) == word) {
            //the word is correct
            correctWordChars += word.length;
            correctChars += word.length;
            if (i < TestInput.input.history.length - 1 &&
                Misc.getLastChar(TestInput.input.getHistory(i)) !== "\n") {
                correctspaces++;
            }
        }
        else if (TestInput.input.getHistory(i).length >= word.length) {
            //too many chars
            for (let c = 0; c < TestInput.input.getHistory(i).length; c++) {
                if (c < word.length) {
                    //on char that still has a word list pair
                    if (TestInput.input.getHistory(i)[c] == word[c]) {
                        correctChars++;
                    }
                    else {
                        incorrectChars++;
                    }
                }
                else {
                    //on char that is extra
                    extraChars++;
                }
            }
        }
        else {
            //not enough chars
            const toAdd = {
                correct: 0,
                incorrect: 0,
                missed: 0,
            };
            for (let c = 0; c < word.length; c++) {
                if (c < TestInput.input.getHistory(i).length) {
                    //on char that still has a word list pair
                    if (TestInput.input.getHistory(i)[c] == word[c]) {
                        toAdd.correct++;
                    }
                    else {
                        toAdd.incorrect++;
                    }
                }
                else {
                    //on char that is extra
                    toAdd.missed++;
                }
            }
            correctChars += toAdd.correct;
            incorrectChars += toAdd.incorrect;
            if (i === TestInput.input.history.length - 1 && config_1.default.mode == "time") {
                //last word - check if it was all correct - add to correct word chars
                if (toAdd.incorrect === 0)
                    correctWordChars += toAdd.correct;
            }
            else {
                missedChars += toAdd.missed;
            }
        }
        if (i < TestInput.input.history.length - 1) {
            spaces++;
        }
    }
    if (config_1.default.funbox === "nospace" || config_1.default.funbox === "arrows") {
        spaces = 0;
        correctspaces = 0;
    }
    return {
        spaces: spaces,
        correctWordChars: correctWordChars,
        allCorrectChars: correctChars,
        incorrectChars: config_1.default.mode == "zen" ? TestInput.accuracy.incorrect : incorrectChars,
        extraChars: extraChars,
        missedChars: missedChars,
        correctSpaces: correctspaces,
    };
}
function calculateStats() {
    let testSeconds = calculateTestSeconds();
    // console.log((end2 - start2) / 1000);
    // console.log(testSeconds);
    if (config_1.default.mode != "custom") {
        testSeconds = Misc.roundTo2(testSeconds);
    }
    const chars = countChars();
    const wpm = Misc.roundTo2(((chars.correctWordChars + chars.correctSpaces) * (60 / testSeconds)) / 5);
    const wpmraw = Misc.roundTo2(((chars.allCorrectChars +
        chars.spaces +
        chars.incorrectChars +
        chars.extraChars) *
        (60 / testSeconds)) /
        5);
    const acc = Misc.roundTo2(calculateAccuracy());
    return {
        wpm: isNaN(wpm) ? 0 : wpm,
        wpmRaw: isNaN(wpmraw) ? 0 : wpmraw,
        acc: acc,
        correctChars: chars.correctWordChars,
        incorrectChars: chars.incorrectChars,
        missedChars: chars.missedChars,
        extraChars: chars.extraChars,
        allChars: chars.allCorrectChars +
            chars.spaces +
            chars.incorrectChars +
            chars.extraChars,
        time: Misc.roundTo2(testSeconds),
        spaces: chars.spaces,
        correctSpaces: chars.correctSpaces,
    };
}
exports.calculateStats = calculateStats;


/***/ }),

/***/ "./src/scripts/test/test-timer.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-timer.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


//most of the code is thanks to
//https://stackoverflow.com/questions/29971898/how-to-create-an-accurate-timer-in-javascript
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.start = exports.getTimerStats = exports.clear = exports.enableTimerDebug = void 0;
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const CustomText = __importStar(__webpack_require__(/*! ./custom-text */ "./src/scripts/test/custom-text.ts"));
const TimerProgress = __importStar(__webpack_require__(/*! ./timer-progress */ "./src/scripts/test/timer-progress.ts"));
const LiveWpm = __importStar(__webpack_require__(/*! ./live-wpm */ "./src/scripts/test/live-wpm.ts"));
const TestStats = __importStar(__webpack_require__(/*! ./test-stats */ "./src/scripts/test/test-stats.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const Monkey = __importStar(__webpack_require__(/*! ./monkey */ "./src/scripts/test/monkey.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const Caret = __importStar(__webpack_require__(/*! ./caret */ "./src/scripts/test/caret.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const Time = __importStar(__webpack_require__(/*! ../states/time */ "./src/scripts/states/time.ts"));
const TimerEvent = __importStar(__webpack_require__(/*! ../observables/timer-event */ "./src/scripts/observables/timer-event.ts"));
let slowTimerCount = 0;
let timer = null;
const interval = 1000;
let expected = 0;
let timerDebug = false;
function enableTimerDebug() {
    timerDebug = true;
}
exports.enableTimerDebug = enableTimerDebug;
function clear() {
    Time.set(0);
    if (timer !== null)
        clearTimeout(timer);
}
exports.clear = clear;
function premid() {
    if (timerDebug)
        console.time("premid");
    const premidSecondsLeft = document.querySelector("#premidSecondsLeft");
    if (premidSecondsLeft !== null) {
        premidSecondsLeft.innerHTML = (config_1.default.time - Time.get()).toString();
    }
    if (timerDebug)
        console.timeEnd("premid");
}
function updateTimer() {
    if (timerDebug)
        console.time("timer progress update");
    if (config_1.default.mode === "time" ||
        (config_1.default.mode === "custom" && CustomText.isTimeRandom)) {
        TimerProgress.update();
    }
    if (timerDebug)
        console.timeEnd("timer progress update");
}
function calculateWpmRaw() {
    if (timerDebug)
        console.time("calculate wpm and raw");
    const wpmAndRaw = TestStats.calculateWpmAndRaw();
    if (timerDebug)
        console.timeEnd("calculate wpm and raw");
    if (timerDebug)
        console.time("update live wpm");
    LiveWpm.update(wpmAndRaw.wpm, wpmAndRaw.raw);
    if (timerDebug)
        console.timeEnd("update live wpm");
    if (timerDebug)
        console.time("push to history");
    TestInput.pushToWpmHistory(wpmAndRaw.wpm);
    TestInput.pushToRawHistory(wpmAndRaw.raw);
    if (timerDebug)
        console.timeEnd("push to history");
    return wpmAndRaw;
}
function monkey(wpmAndRaw) {
    if (timerDebug)
        console.time("update monkey");
    const num = config_1.default.blindMode ? wpmAndRaw.raw : wpmAndRaw.wpm;
    Monkey.updateFastOpacity(num);
    if (timerDebug)
        console.timeEnd("update monkey");
}
function calculateAcc() {
    if (timerDebug)
        console.time("calculate acc");
    const acc = Misc.roundTo2(TestStats.calculateAccuracy());
    if (timerDebug)
        console.timeEnd("calculate acc");
    return acc;
}
function layoutfluid() {
    if (timerDebug)
        console.time("layoutfluid");
    if (config_1.default.funbox === "layoutfluid" && config_1.default.mode === "time") {
        const layouts = config_1.default.customLayoutfluid
            ? config_1.default.customLayoutfluid.split("#")
            : ["qwerty", "dvorak", "colemak"];
        const switchTime = config_1.default.time / layouts.length;
        const time = Time.get();
        const index = Math.floor(time / switchTime);
        const layout = layouts[index];
        const flooredSwitchTimes = [];
        for (let i = 1; i < layouts.length; i++) {
            flooredSwitchTimes.push(Math.floor(switchTime * i));
        }
        if (flooredSwitchTimes.includes(time + 3)) {
            Notifications.add("3", 0, 1);
        }
        else if (flooredSwitchTimes.includes(time + 2)) {
            Notifications.add("2", 0, 1);
        }
        else if (flooredSwitchTimes.includes(time + 1)) {
            Notifications.add("1", 0, 1);
        }
        if (config_1.default.layout !== layout && layout !== undefined) {
            Notifications.add(`--- !!! ${layout} !!! ---`, 0);
            UpdateConfig.setLayout(layout, true);
            UpdateConfig.setKeymapLayout(layout, true);
        }
    }
    if (timerDebug)
        console.timeEnd("layoutfluid");
}
function checkIfFailed(wpmAndRaw, acc) {
    if (timerDebug)
        console.time("fail conditions");
    TestInput.pushKeypressesToHistory();
    if (config_1.default.minWpm === "custom" &&
        wpmAndRaw.wpm < config_1.default.minWpmCustomSpeed &&
        TestWords.words.currentIndex > 3) {
        if (timer !== null)
            clearTimeout(timer);
        SlowTimer.clear();
        slowTimerCount = 0;
        TimerEvent.dispatch("fail", "min wpm");
        return;
    }
    if (config_1.default.minAcc === "custom" &&
        acc < config_1.default.minAccCustom &&
        TestWords.words.currentIndex > 3) {
        if (timer !== null)
            clearTimeout(timer);
        SlowTimer.clear();
        slowTimerCount = 0;
        TimerEvent.dispatch("fail", "min accuracy");
        return;
    }
    if (timerDebug)
        console.timeEnd("fail conditions");
}
function checkIfTimeIsUp() {
    if (timerDebug)
        console.time("times up check");
    if (config_1.default.mode == "time" ||
        (config_1.default.mode === "custom" && CustomText.isTimeRandom)) {
        if ((Time.get() >= config_1.default.time &&
            config_1.default.time !== 0 &&
            config_1.default.mode === "time") ||
            (Time.get() >= CustomText.time &&
                CustomText.time !== 0 &&
                config_1.default.mode === "custom")) {
            //times up
            if (timer !== null)
                clearTimeout(timer);
            Caret.hide();
            TestInput.input.pushHistory();
            TestInput.corrected.pushHistory();
            SlowTimer.clear();
            slowTimerCount = 0;
            TimerEvent.dispatch("finish");
            return;
        }
    }
    if (timerDebug)
        console.timeEnd("times up check");
}
// ---------------------------------------
let timerStats = [];
function getTimerStats() {
    return timerStats;
}
exports.getTimerStats = getTimerStats;
function timerStep() {
    return __awaiter(this, void 0, void 0, function* () {
        if (timerDebug)
            console.time("timer step -----------------------------");
        Time.increment();
        premid();
        updateTimer();
        const wpmAndRaw = calculateWpmRaw();
        const acc = calculateAcc();
        monkey(wpmAndRaw);
        layoutfluid();
        checkIfFailed(wpmAndRaw, acc);
        checkIfTimeIsUp();
        if (timerDebug)
            console.timeEnd("timer step -----------------------------");
    });
}
function start() {
    return __awaiter(this, void 0, void 0, function* () {
        SlowTimer.clear();
        slowTimerCount = 0;
        timerStats = [];
        expected = TestStats.start + interval;
        (function loop() {
            const delay = expected - performance.now();
            timerStats.push({
                dateNow: Date.now(),
                now: performance.now(),
                expected: expected,
                nextDelay: delay,
            });
            if ((config_1.default.mode === "time" && config_1.default.time < 130 && config_1.default.time > 0) ||
                (config_1.default.mode === "words" && config_1.default.words < 250 && config_1.default.words > 0)) {
                if (delay < interval / 2) {
                    //slow timer
                    SlowTimer.set();
                }
                if (delay < interval / 10) {
                    slowTimerCount++;
                    if (slowTimerCount > 5) {
                        //slow timer
                        if (window.navigator.userAgent.includes("Edg")) {
                            Notifications.add('This bad performance could be caused by "efficiency mode" on Microsoft Edge.');
                        }
                        Notifications.add("Stopping the test due to bad performance. This would cause test calculations to be incorrect. If this happens a lot, please report this.", -1);
                        TimerEvent.dispatch("fail", "slow timer");
                    }
                }
            }
            timer = setTimeout(function () {
                // time++;
                if (!TestActive.get()) {
                    if (timer !== null)
                        clearTimeout(timer);
                    SlowTimer.clear();
                    slowTimerCount = 0;
                    return;
                }
                timerStep();
                expected += interval;
                loop();
            }, delay);
        })();
    });
}
exports.start = start;


/***/ }),

/***/ "./src/scripts/test/test-ui.ts":
/*!*************************************!*\
  !*** ./src/scripts/test/test-ui.ts ***!
  \*************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.highlightBadWord = exports.applyBurstHeatmap = exports.toggleResultWords = exports.arrangeCharactersLeftToRight = exports.arrangeCharactersRightToLeft = exports.lineJump = exports.updateWordElement = exports.screenshot = exports.colorful = exports.flipColors = exports.addWord = exports.showWords = exports.updateActiveElement = exports.focusWords = exports.reset = exports.setResultCalculating = exports.setTestRestarting = exports.setActiveWordTop = exports.setCurrentWordElementIndex = exports.setResultVisible = exports.resultCalculating = exports.currentTestLine = exports.lineTransition = exports.testRestartingPromise = exports.testRestarting = exports.activeWordTop = exports.resultVisible = exports.currentWordElementIndex = void 0;
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
const ThemeColors = __importStar(__webpack_require__(/*! ../elements/theme-colors */ "./src/scripts/elements/theme-colors.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const CustomText = __importStar(__webpack_require__(/*! ./custom-text */ "./src/scripts/test/custom-text.ts"));
const Caret = __importStar(__webpack_require__(/*! ./caret */ "./src/scripts/test/caret.ts"));
const OutOfFocus = __importStar(__webpack_require__(/*! ./out-of-focus */ "./src/scripts/test/out-of-focus.ts"));
const Replay = __importStar(__webpack_require__(/*! ./replay */ "./src/scripts/test/replay.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventValue === undefined || typeof eventValue !== "boolean")
        return;
    if (eventKey === "flipTestColors")
        flipColors(eventValue);
    if (eventKey === "colorfulMode")
        colorful(eventValue);
    if (eventKey === "highlightMode")
        updateWordElement(eventValue);
    if (eventKey === "burstHeatmap")
        applyBurstHeatmap();
});
exports.currentWordElementIndex = 0;
exports.resultVisible = false;
exports.activeWordTop = 0;
exports.testRestarting = false;
exports.lineTransition = false;
exports.currentTestLine = 0;
exports.resultCalculating = false;
function setResultVisible(val) {
    exports.resultVisible = val;
}
exports.setResultVisible = setResultVisible;
function setCurrentWordElementIndex(val) {
    exports.currentWordElementIndex = val;
}
exports.setCurrentWordElementIndex = setCurrentWordElementIndex;
function setActiveWordTop(val) {
    exports.activeWordTop = val;
}
exports.setActiveWordTop = setActiveWordTop;
let restartingResolve;
function setTestRestarting(val) {
    exports.testRestarting = val;
    if (val === true) {
        exports.testRestartingPromise = new Promise((resolve) => {
            restartingResolve = resolve;
        });
    }
    else {
        if (restartingResolve)
            restartingResolve();
        restartingResolve = null;
    }
}
exports.setTestRestarting = setTestRestarting;
function setResultCalculating(val) {
    exports.resultCalculating = val;
}
exports.setResultCalculating = setResultCalculating;
function reset() {
    exports.currentTestLine = 0;
    exports.currentWordElementIndex = 0;
}
exports.reset = reset;
function focusWords() {
    if (!$("#wordsWrapper").hasClass("hidden")) {
        $("#wordsInput").trigger("focus");
    }
}
exports.focusWords = focusWords;
function updateActiveElement(backspace) {
    const active = document.querySelector("#words .active");
    if (config_1.default.mode == "zen" && backspace) {
        active === null || active === void 0 ? void 0 : active.remove();
    }
    else if (active !== null) {
        if (config_1.default.highlightMode == "word") {
            active.querySelectorAll("letter").forEach((e) => {
                e.classList.remove("correct");
            });
        }
        active.classList.remove("active");
    }
    try {
        const activeWord = document.querySelectorAll("#words .word")[exports.currentWordElementIndex];
        activeWord.classList.add("active");
        activeWord.classList.remove("error");
        exports.activeWordTop = document.querySelector("#words .active")
            .offsetTop;
        if (config_1.default.highlightMode == "word") {
            activeWord.querySelectorAll("letter").forEach((e) => {
                e.classList.add("correct");
            });
        }
    }
    catch (e) { }
}
exports.updateActiveElement = updateActiveElement;
function getWordHTML(word) {
    let newlineafter = false;
    let retval = `<div class='word'>`;
    for (let c = 0; c < word.length; c++) {
        if (config_1.default.funbox === "arrows") {
            if (word.charAt(c) === "") {
                retval += `<letter><i class="fas fa-arrow-up"></i></letter>`;
            }
            if (word.charAt(c) === "") {
                retval += `<letter><i class="fas fa-arrow-down"></i></letter>`;
            }
            if (word.charAt(c) === "") {
                retval += `<letter><i class="fas fa-arrow-left"></i></letter>`;
            }
            if (word.charAt(c) === "") {
                retval += `<letter><i class="fas fa-arrow-right"></i></letter>`;
            }
        }
        else if (word.charAt(c) === "\t") {
            retval += `<letter class='tabChar'><i class="fas fa-long-arrow-alt-right"></i></letter>`;
        }
        else if (word.charAt(c) === "\n") {
            newlineafter = true;
            retval += `<letter class='nlChar'><i class="fas fa-angle-down"></i></letter>`;
        }
        else {
            retval += "<letter>" + word.charAt(c) + "</letter>";
        }
    }
    retval += "</div>";
    if (newlineafter)
        retval += "<div class='newline'></div>";
    return retval;
}
function showWords() {
    $("#words").empty();
    let wordsHTML = "";
    if (config_1.default.mode !== "zen") {
        for (let i = 0; i < TestWords.words.length; i++) {
            wordsHTML += getWordHTML(TestWords.words.get(i));
        }
    }
    else {
        wordsHTML =
            '<div class="word">word height</div><div class="word active"></div>';
    }
    $("#words").html(wordsHTML);
    $("#wordsWrapper").removeClass("hidden");
    const wordHeight = ($(document.querySelector(".word")).outerHeight(true));
    const wordsHeight = ($(document.querySelector("#words")).outerHeight(true));
    if (config_1.default.showAllLines &&
        config_1.default.mode != "time" &&
        !(CustomText.isWordRandom && CustomText.word == 0) &&
        !CustomText.isTimeRandom) {
        $("#words").css("height", "auto");
        $("#wordsWrapper").css("height", "auto");
        let nh = wordHeight * 3;
        if (nh > wordsHeight) {
            nh = wordsHeight;
        }
        $(".outOfFocusWarning").css("line-height", nh + "px");
    }
    else {
        $("#words")
            .css("height", wordHeight * 4 + "px")
            .css("overflow", "hidden");
        $("#wordsWrapper")
            .css("height", wordHeight * 3 + "px")
            .css("overflow", "hidden");
        $(".outOfFocusWarning").css("line-height", wordHeight * 3 + "px");
    }
    if (config_1.default.mode === "zen") {
        $(document.querySelector(".word")).remove();
    }
    updateActiveElement();
    Caret.updatePosition();
}
exports.showWords = showWords;
function addWord(word) {
    $("#words").append(getWordHTML(word));
}
exports.addWord = addWord;
function flipColors(tf) {
    if (tf) {
        $("#words").addClass("flipped");
    }
    else {
        $("#words").removeClass("flipped");
    }
}
exports.flipColors = flipColors;
function colorful(tc) {
    if (tc) {
        $("#words").addClass("colorfulMode");
    }
    else {
        $("#words").removeClass("colorfulMode");
    }
}
exports.colorful = colorful;
function screenshot() {
    return __awaiter(this, void 0, void 0, function* () {
        let revealReplay = false;
        function revertScreenshot() {
            $("#notificationCenter").removeClass("hidden");
            $("#commandLineMobileButton").removeClass("hidden");
            $(".pageTest .ssWatermark").addClass("hidden");
            $(".pageTest .ssWatermark").text("monkeytype.com");
            $(".pageTest .buttons").removeClass("hidden");
            if (revealReplay)
                $("#resultReplay").removeClass("hidden");
            if (firebase_1.Auth.currentUser == null) {
                $(".pageTest .loginTip").removeClass("hidden");
            }
        }
        if (!$("#resultReplay").hasClass("hidden")) {
            revealReplay = true;
            Replay.pauseReplay();
        }
        const dateNow = new Date(Date.now());
        $("#resultReplay").addClass("hidden");
        $(".pageTest .ssWatermark").removeClass("hidden");
        $(".pageTest .ssWatermark").text((0, format_1.default)(dateNow, "dd MMM yyyy HH:mm") + " | monkeytype.com ");
        if (firebase_1.Auth.currentUser != null) {
            $(".pageTest .ssWatermark").text(DB.getSnapshot().name +
                " | " +
                (0, format_1.default)(dateNow, "dd MMM yyyy HH:mm") +
                " | monkeytype.com  ");
        }
        $(".pageTest .buttons").addClass("hidden");
        const src = $("#middle");
        const sourceX = src.position().left; /*X position from div#target*/
        const sourceY = src.position().top; /*Y position from div#target*/
        const sourceWidth = (src.outerWidth(true)); /*clientWidth/offsetWidth from div#target*/
        const sourceHeight = (src.outerHeight(true)); /*clientHeight/offsetHeight from div#target*/
        $("#notificationCenter").addClass("hidden");
        $("#commandLineMobileButton").addClass("hidden");
        $(".pageTest .loginTip").addClass("hidden");
        try {
            const paddingX = 50;
            const paddingY = 25;
            html2canvas(document.body, {
                backgroundColor: yield ThemeColors.get("bg"),
                width: sourceWidth + paddingX * 2,
                height: sourceHeight + paddingY * 2,
                x: sourceX - paddingX,
                y: sourceY - paddingY,
            }).then((canvas) => {
                canvas.toBlob((blob) => {
                    try {
                        if (blob === null)
                            return;
                        if (navigator.userAgent.toLowerCase().indexOf("firefox") > -1) {
                            open(URL.createObjectURL(blob));
                            revertScreenshot();
                        }
                        else {
                            navigator.clipboard
                                .write([
                                new ClipboardItem(Object.defineProperty({}, blob.type, {
                                    value: blob,
                                    enumerable: true,
                                })),
                            ])
                                .then(() => {
                                Notifications.add("Copied to clipboard", 1, 2);
                                revertScreenshot();
                            });
                        }
                    }
                    catch (e) {
                        Notifications.add("Error saving image to clipboard: " + e.message, -1);
                        revertScreenshot();
                    }
                });
            });
        }
        catch (e) {
            Notifications.add("Error creating image: " + e.message, -1);
            revertScreenshot();
        }
        setTimeout(() => {
            revertScreenshot();
        }, 3000);
    });
}
exports.screenshot = screenshot;
function updateWordElement(showError = !config_1.default.blindMode) {
    const input = TestInput.input.current;
    const wordAtIndex = document.querySelector("#words .word.active");
    const currentWord = TestWords.words.getCurrent();
    if (!currentWord && config_1.default.mode !== "zen")
        return;
    let ret = "";
    let newlineafter = false;
    if (config_1.default.mode === "zen") {
        for (let i = 0; i < TestInput.input.current.length; i++) {
            if (TestInput.input.current[i] === "\t") {
                ret += `<letter class='tabChar correct' style="opacity: 0"><i class="fas fa-long-arrow-alt-right"></i></letter>`;
            }
            else if (TestInput.input.current[i] === "\n") {
                newlineafter = true;
                ret += `<letter class='nlChar correct' style="opacity: 0"><i class="fas fa-angle-down"></i></letter>`;
            }
            else {
                ret += `<letter class="correct">${TestInput.input.current[i]}</letter>`;
            }
        }
    }
    else {
        let correctSoFar = false;
        // slice earlier if input has trailing compose characters
        const inputWithoutComposeLength = Misc.trailingComposeChars.test(input)
            ? input.search(Misc.trailingComposeChars)
            : input.length;
        if (input.search(Misc.trailingComposeChars) < currentWord.length &&
            currentWord.slice(0, inputWithoutComposeLength) ===
                input.slice(0, inputWithoutComposeLength)) {
            correctSoFar = true;
        }
        let wordHighlightClassString = correctSoFar ? "correct" : "incorrect";
        if (config_1.default.blindMode) {
            wordHighlightClassString = "correct";
        }
        for (let i = 0; i < input.length; i++) {
            const charCorrect = currentWord[i] == input[i];
            let correctClass = "correct";
            if (config_1.default.highlightMode == "off") {
                correctClass = "";
            }
            let currentLetter = currentWord[i];
            let tabChar = "";
            let nlChar = "";
            if (config_1.default.funbox === "arrows") {
                if (currentLetter === "") {
                    currentLetter = `<i class="fas fa-arrow-up"></i>`;
                }
                if (currentLetter === "") {
                    currentLetter = `<i class="fas fa-arrow-down"></i>`;
                }
                if (currentLetter === "") {
                    currentLetter = `<i class="fas fa-arrow-left"></i>`;
                }
                if (currentLetter === "") {
                    currentLetter = `<i class="fas fa-arrow-right"></i>`;
                }
            }
            else if (currentLetter === "\t") {
                tabChar = "tabChar";
                currentLetter = `<i class="fas fa-long-arrow-alt-right"></i>`;
            }
            else if (currentLetter === "\n") {
                nlChar = "nlChar";
                currentLetter = `<i class="fas fa-angle-down"></i>`;
            }
            if (Misc.trailingComposeChars.test(input) &&
                i > input.search(Misc.trailingComposeChars)) {
                continue;
            }
            if (charCorrect) {
                ret += `<letter class="${config_1.default.highlightMode == "word"
                    ? wordHighlightClassString
                    : correctClass} ${tabChar}${nlChar}">${currentLetter}</letter>`;
            }
            else if (currentLetter !== undefined &&
                Misc.trailingComposeChars.test(input) &&
                i === input.search(Misc.trailingComposeChars)) {
                ret += `<letter class="${config_1.default.highlightMode == "word" ? wordHighlightClassString : ""} dead">${currentLetter}</letter>`;
            }
            else if (!showError) {
                if (currentLetter !== undefined) {
                    ret += `<letter class="${config_1.default.highlightMode == "word"
                        ? wordHighlightClassString
                        : correctClass} ${tabChar}${nlChar}">${currentLetter}</letter>`;
                }
            }
            else if (currentLetter === undefined) {
                if (!config_1.default.hideExtraLetters) {
                    let letter = input[i];
                    if (letter == " " || letter == "\t" || letter == "\n") {
                        letter = "_";
                    }
                    ret += `<letter class="${config_1.default.highlightMode == "word"
                        ? wordHighlightClassString
                        : "incorrect"} extra ${tabChar}${nlChar}">${letter}</letter>`;
                }
            }
            else {
                ret +=
                    `<letter class="${config_1.default.highlightMode == "word"
                        ? wordHighlightClassString
                        : "incorrect"} ${tabChar}${nlChar}">` +
                        (config_1.default.indicateTypos === "replace"
                            ? input[i] == " "
                                ? "_"
                                : input[i]
                            : currentLetter) +
                        (config_1.default.indicateTypos === "below" ? `<hint>${input[i]}</hint>` : "") +
                        "</letter>";
            }
        }
        const inputWithSingleComposeLength = Misc.trailingComposeChars.test(input)
            ? input.search(Misc.trailingComposeChars) + 1
            : input.length;
        if (inputWithSingleComposeLength < currentWord.length) {
            for (let i = inputWithSingleComposeLength; i < currentWord.length; i++) {
                if (config_1.default.funbox === "arrows") {
                    if (currentWord[i] === "") {
                        ret += `<letter><i class="fas fa-arrow-up"></i></letter>`;
                    }
                    if (currentWord[i] === "") {
                        ret += `<letter><i class="fas fa-arrow-down"></i></letter>`;
                    }
                    if (currentWord[i] === "") {
                        ret += `<letter><i class="fas fa-arrow-left"></i></letter>`;
                    }
                    if (currentWord[i] === "") {
                        ret += `<letter><i class="fas fa-arrow-right"></i></letter>`;
                    }
                }
                else if (currentWord[i] === "\t") {
                    ret += `<letter class='tabChar'><i class="fas fa-long-arrow-alt-right"></i></letter>`;
                }
                else if (currentWord[i] === "\n") {
                    ret += `<letter class='nlChar'><i class="fas fa-angle-down"></i></letter>`;
                }
                else {
                    ret +=
                        `<letter class="${config_1.default.highlightMode == "word" ? wordHighlightClassString : ""}">` +
                            currentWord[i] +
                            "</letter>";
                }
            }
        }
        if (config_1.default.highlightMode === "letter" && config_1.default.hideExtraLetters) {
            if (input.length > currentWord.length && !config_1.default.blindMode) {
                $(wordAtIndex).addClass("error");
            }
            else if (input.length == currentWord.length) {
                $(wordAtIndex).removeClass("error");
            }
        }
    }
    wordAtIndex.innerHTML = ret;
    if (newlineafter)
        $("#words").append("<div class='newline'></div>");
}
exports.updateWordElement = updateWordElement;
function lineJump(currentTop) {
    var _a;
    //last word of the line
    if (exports.currentTestLine > 0) {
        const hideBound = currentTop;
        const toHide = [];
        const wordElements = $("#words .word");
        for (let i = 0; i < exports.currentWordElementIndex; i++) {
            if ($(wordElements[i]).hasClass("hidden"))
                continue;
            const forWordTop = Math.floor(wordElements[i].offsetTop);
            if (forWordTop < hideBound - 10) {
                toHide.push($($("#words .word")[i]));
            }
        }
        const wordHeight = ($(document.querySelector(".word")).outerHeight(true));
        if (config_1.default.smoothLineScroll && toHide.length > 0) {
            exports.lineTransition = true;
            $("#words").prepend(`<div class="smoothScroller" style="position: fixed;height:${wordHeight}px;width:100%"></div>`);
            $("#words .smoothScroller").animate({
                height: 0,
            }, SlowTimer.get() ? 0 : 125, () => {
                $("#words .smoothScroller").remove();
            });
            $("#paceCaret").animate({
                top: ((_a = document.querySelector("#paceCaret")) === null || _a === void 0 ? void 0 : _a.offsetTop) -
                    wordHeight,
            }, SlowTimer.get() ? 0 : 125);
            $("#words").animate({
                marginTop: `-${wordHeight}px`,
            }, SlowTimer.get() ? 0 : 125, () => {
                exports.activeWordTop = (document.querySelector("#words .active")).offsetTop;
                exports.currentWordElementIndex -= toHide.length;
                exports.lineTransition = false;
                toHide.forEach((el) => el.remove());
                $("#words").css("marginTop", "0");
            });
        }
        else {
            toHide.forEach((el) => el.remove());
            exports.currentWordElementIndex -= toHide.length;
            $("#paceCaret").css({
                top: document.querySelector("#paceCaret").offsetTop -
                    wordHeight,
            });
        }
    }
    exports.currentTestLine++;
}
exports.lineJump = lineJump;
function arrangeCharactersRightToLeft() {
    $("#words").addClass("rightToLeftTest");
    $("#resultWordsHistory .words").addClass("rightToLeftTest");
    $("#resultReplay .words").addClass("rightToLeftTest");
}
exports.arrangeCharactersRightToLeft = arrangeCharactersRightToLeft;
function arrangeCharactersLeftToRight() {
    $("#words").removeClass("rightToLeftTest");
    $("#resultWordsHistory .words").removeClass("rightToLeftTest");
    $("#resultReplay .words").removeClass("rightToLeftTest");
}
exports.arrangeCharactersLeftToRight = arrangeCharactersLeftToRight;
function loadWordsHistory() {
    return __awaiter(this, void 0, void 0, function* () {
        $("#resultWordsHistory .words").empty();
        let wordsHTML = "";
        for (let i = 0; i < TestInput.input.history.length + 2; i++) {
            const input = TestInput.input.getHistory(i);
            const word = TestWords.words.get(i);
            let wordEl = "";
            try {
                if (input === "")
                    throw new Error("empty input word");
                if (TestInput.corrected.getHistory(i) !== undefined &&
                    TestInput.corrected.getHistory(i) !== "") {
                    wordEl = `<div class='word' burst="${TestInput.burstHistory[i]}" input="${TestInput.corrected
                        .getHistory(i)
                        .replace(/"/g, "&quot;")
                        .replace(/ /g, "_")}">`;
                }
                else {
                    wordEl = `<div class='word' burst="${TestInput.burstHistory[i]}" input="${input.replace(/"/g, "&quot;").replace(/ /g, "_")}">`;
                }
                if (i === TestInput.input.history.length - 1) {
                    //last word
                    const wordstats = {
                        correct: 0,
                        incorrect: 0,
                        missed: 0,
                    };
                    const length = config_1.default.mode == "zen" ? input.length : word.length;
                    for (let c = 0; c < length; c++) {
                        if (c < input.length) {
                            //on char that still has a word list pair
                            if (config_1.default.mode == "zen" || input[c] == word[c]) {
                                wordstats.correct++;
                            }
                            else {
                                wordstats.incorrect++;
                            }
                        }
                        else {
                            //on char that is extra
                            wordstats.missed++;
                        }
                    }
                    if (wordstats.incorrect !== 0 || config_1.default.mode !== "time") {
                        if (config_1.default.mode != "zen" && input !== word) {
                            wordEl = `<div class='word error' burst="${TestInput.burstHistory[i]}" input="${input.replace(/"/g, "&quot;").replace(/ /g, "_")}">`;
                        }
                    }
                }
                else {
                    if (config_1.default.mode != "zen" && input !== word) {
                        wordEl = `<div class='word error' burst="${TestInput.burstHistory[i]}" input="${input.replace(/"/g, "&quot;").replace(/ /g, "_")}">`;
                    }
                }
                let loop;
                if (config_1.default.mode == "zen" || input.length > word.length) {
                    //input is longer - extra characters possible (loop over input)
                    loop = input.length;
                }
                else {
                    //input is shorter or equal (loop over word list)
                    loop = word.length;
                }
                for (let c = 0; c < loop; c++) {
                    let correctedChar;
                    try {
                        correctedChar = TestInput.corrected.getHistory(i)[c];
                    }
                    catch (e) {
                        correctedChar = undefined;
                    }
                    let extraCorrected = "";
                    if (c + 1 === loop &&
                        TestInput.corrected.getHistory(i) !== undefined &&
                        TestInput.corrected.getHistory(i).length > input.length) {
                        extraCorrected = "extraCorrected";
                    }
                    if (config_1.default.mode == "zen" || word[c] !== undefined) {
                        if (config_1.default.mode == "zen" || input[c] === word[c]) {
                            if (correctedChar === input[c] || correctedChar === undefined) {
                                wordEl += `<letter class="correct ${extraCorrected}">${input[c]}</letter>`;
                            }
                            else {
                                wordEl +=
                                    `<letter class="corrected ${extraCorrected}">` +
                                        input[c] +
                                        "</letter>";
                            }
                        }
                        else {
                            if (input[c] === TestInput.input.current) {
                                wordEl +=
                                    `<letter class='correct ${extraCorrected}'>` +
                                        word[c] +
                                        "</letter>";
                            }
                            else if (input[c] === undefined) {
                                wordEl += "<letter>" + word[c] + "</letter>";
                            }
                            else {
                                wordEl +=
                                    `<letter class="incorrect ${extraCorrected}">` +
                                        word[c] +
                                        "</letter>";
                            }
                        }
                    }
                    else {
                        wordEl += '<letter class="incorrect extra">' + input[c] + "</letter>";
                    }
                }
                wordEl += "</div>";
            }
            catch (e) {
                try {
                    wordEl = "<div class='word'>";
                    for (let c = 0; c < word.length; c++) {
                        wordEl += "<letter>" + word[c] + "</letter>";
                    }
                    wordEl += "</div>";
                }
                catch (_a) { }
            }
            wordsHTML += wordEl;
        }
        $("#resultWordsHistory .words").html(wordsHTML);
        $("#showWordHistoryButton").addClass("loaded");
        return true;
    });
}
function toggleResultWords() {
    if (exports.resultVisible) {
        if ($("#resultWordsHistory").stop(true, true).hasClass("hidden")) {
            //show
            if (!$("#showWordHistoryButton").hasClass("loaded")) {
                $("#words").html(`<div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>`);
                loadWordsHistory().then(() => {
                    if (config_1.default.burstHeatmap) {
                        applyBurstHeatmap();
                    }
                    $("#resultWordsHistory")
                        .removeClass("hidden")
                        .css("display", "none")
                        .slideDown(250, () => {
                        if (config_1.default.burstHeatmap) {
                            applyBurstHeatmap();
                        }
                    });
                });
            }
            else {
                if (config_1.default.burstHeatmap) {
                    applyBurstHeatmap();
                }
                $("#resultWordsHistory")
                    .removeClass("hidden")
                    .css("display", "none")
                    .slideDown(250);
            }
        }
        else {
            //hide
            $("#resultWordsHistory").slideUp(250, () => {
                $("#resultWordsHistory").addClass("hidden");
            });
        }
    }
}
exports.toggleResultWords = toggleResultWords;
function applyBurstHeatmap() {
    var _a, _b;
    if (config_1.default.burstHeatmap) {
        $("#resultWordsHistory .heatmapLegend").removeClass("hidden");
        let burstlist = [...TestInput.burstHistory];
        burstlist = burstlist.filter((x) => x !== Infinity);
        burstlist = burstlist.filter((x) => x < 350);
        if (((_a = TestInput.input.getHistory(TestInput.input.getHistory().length - 1)) === null || _a === void 0 ? void 0 : _a.length) !== ((_b = TestWords.words.getCurrent()) === null || _b === void 0 ? void 0 : _b.length)) {
            burstlist = burstlist.splice(0, burstlist.length - 1);
        }
        const median = Misc.median(burstlist);
        const adatm = [];
        burstlist.forEach((burst) => {
            adatm.push(Math.abs(median - burst));
        });
        const step = Misc.mean(adatm);
        const steps = [
            {
                val: 0,
                class: "heatmap-0",
            },
            {
                val: median - step * 1.5,
                class: "heatmap-1",
            },
            {
                val: median - step * 0.5,
                class: "heatmap-2",
            },
            {
                val: median + step * 0.5,
                class: "heatmap-3",
            },
            {
                val: median + step * 1.5,
                class: "heatmap-4",
            },
        ];
        $("#resultWordsHistory .words .word").each((_, word) => {
            const wordBurstVal = parseInt($(word).attr("burst"));
            let cls = "";
            steps.forEach((step) => {
                if (wordBurstVal > step.val)
                    cls = step.class;
            });
            $(word).addClass(cls);
        });
    }
    else {
        $("#resultWordsHistory .heatmapLegend").addClass("hidden");
        $("#resultWordsHistory .words .word").removeClass("heatmap-0");
        $("#resultWordsHistory .words .word").removeClass("heatmap-1");
        $("#resultWordsHistory .words .word").removeClass("heatmap-2");
        $("#resultWordsHistory .words .word").removeClass("heatmap-3");
        $("#resultWordsHistory .words .word").removeClass("heatmap-4");
    }
}
exports.applyBurstHeatmap = applyBurstHeatmap;
function highlightBadWord(index, showError) {
    if (!showError)
        return;
    $($("#words .word")[index]).addClass("error");
}
exports.highlightBadWord = highlightBadWord;
$(document.body).on("click", "#saveScreenshotButton", () => {
    screenshot();
});
$(document).on("click", "#testModesNotice .text-button.blind", () => {
    UpdateConfig.setBlindMode(!config_1.default.blindMode);
});
$(".pageTest #copyWordsListButton").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    try {
        let words;
        if (config_1.default.mode == "zen") {
            words = TestInput.input.history.join(" ");
        }
        else {
            words = TestWords.words.get()
                .slice(0, TestInput.input.history.length)
                .join(" ");
        }
        yield navigator.clipboard.writeText(words);
        Notifications.add("Copied to clipboard", 0, 2);
    }
    catch (e) {
        Notifications.add("Could not copy to clipboard: " + e, -1);
    }
}));
$(".pageTest #toggleBurstHeatmap").on("click", () => __awaiter(void 0, void 0, void 0, function* () {
    UpdateConfig.setBurstHeatmap(!config_1.default.burstHeatmap);
}));
$(document).on("mouseleave", "#resultWordsHistory .words .word", () => {
    $(".wordInputAfter").remove();
});
$("#wpmChart").on("mouseleave", () => {
    $(".wordInputAfter").remove();
});
$(document).on("mouseenter", "#resultWordsHistory .words .word", (e) => {
    if (exports.resultVisible) {
        const input = $(e.currentTarget).attr("input");
        const burst = parseInt($(e.currentTarget).attr("burst"));
        if (input != undefined) {
            $(e.currentTarget).append(`<div class="wordInputAfter">
          <div class="text">
          ${input
                .replace(/\t/g, "_")
                .replace(/\n/g, "_")
                .replace(/</g, "&lt")
                .replace(/>/g, "&gt")}
          </div>
          <div class="speed">
          ${Math.round(config_1.default.alwaysShowCPM ? burst * 5 : burst)}${config_1.default.alwaysShowCPM ? "cpm" : "wpm"}
          </div>
          </div>`);
        }
    }
});
$("#wordsInput").on("focus", () => {
    if (!exports.resultVisible && config_1.default.showOutOfFocusWarning) {
        OutOfFocus.hide();
    }
    Caret.show();
});
$("#wordsInput").on("focusout", () => {
    if (!exports.resultVisible && config_1.default.showOutOfFocusWarning) {
        OutOfFocus.show();
    }
    Caret.hide();
});
$(document).on("keypress", "#showWordHistoryButton", (event) => {
    if (event.key === "Enter") {
        toggleResultWords();
    }
});
$(document.body).on("click", "#showWordHistoryButton", () => {
    toggleResultWords();
});
$("#wordsWrapper").on("click", () => {
    focusWords();
});


/***/ }),

/***/ "./src/scripts/test/test-words.ts":
/*!****************************************!*\
  !*** ./src/scripts/test/test-words.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.setHasTab = exports.setRandomQuote = exports.randomQuote = exports.hasTab = exports.words = void 0;
class Words {
    constructor() {
        this.list = [];
        this.length = 0;
        this.currentIndex = 0;
    }
    get(i, raw = false) {
        var _a, _b;
        if (i === undefined) {
            return this.list;
        }
        else {
            if (raw) {
                return (_b = (_a = this.list[i]) === null || _a === void 0 ? void 0 : _a.replace(/[.?!":\-,]/g, "")) === null || _b === void 0 ? void 0 : _b.toLowerCase();
            }
            else {
                return this.list[i];
            }
        }
    }
    getCurrent() {
        return this.list[this.currentIndex];
    }
    getLast() {
        return this.list[this.list.length - 1];
    }
    push(word) {
        this.list.push(word);
        this.length = this.list.length;
    }
    reset() {
        this.list = [];
        this.currentIndex = 0;
        this.length = this.list.length;
    }
    resetCurrentIndex() {
        this.currentIndex = 0;
    }
    decreaseCurrentIndex() {
        this.currentIndex--;
    }
    increaseCurrentIndex() {
        this.currentIndex++;
    }
    clean() {
        for (const s of this.list) {
            if (/ +/.test(s)) {
                const id = this.list.indexOf(s);
                const tempList = s.split(" ");
                this.list.splice(id, 1);
                for (let i = 0; i < tempList.length; i++) {
                    this.list.splice(id + i, 0, tempList[i]);
                }
            }
        }
    }
}
exports.words = new Words();
exports.hasTab = false;
exports.randomQuote = null;
function setRandomQuote(rq) {
    exports.randomQuote = rq;
}
exports.setRandomQuote = setRandomQuote;
function setHasTab(tf) {
    exports.hasTab = tf;
}
exports.setHasTab = setHasTab;


/***/ }),

/***/ "./src/scripts/test/timer-progress.ts":
/*!********************************************!*\
  !*** ./src/scripts/test/timer-progress.ts ***!
  \********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateStyle = exports.update = exports.restart = exports.hide = exports.show = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const CustomText = __importStar(__webpack_require__(/*! ./custom-text */ "./src/scripts/test/custom-text.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const TestWords = __importStar(__webpack_require__(/*! ./test-words */ "./src/scripts/test/test-words.ts"));
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
const Time = __importStar(__webpack_require__(/*! ../states/time */ "./src/scripts/states/time.ts"));
const SlowTimer = __importStar(__webpack_require__(/*! ../states/slow-timer */ "./src/scripts/states/slow-timer.ts"));
const TestActive = __importStar(__webpack_require__(/*! ../states/test-active */ "./src/scripts/states/test-active.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
function show() {
    const op = config_1.default.showTimerProgress ? config_1.default.timerOpacity : 0;
    if (config_1.default.mode != "zen" && config_1.default.timerStyle === "bar") {
        $("#timerWrapper").stop(true, true).removeClass("hidden").animate({
            opacity: op,
        }, 125);
    }
    else if (config_1.default.timerStyle === "text") {
        $("#timerNumber")
            .stop(true, true)
            .removeClass("hidden")
            .css("opacity", 0)
            .animate({
            opacity: op,
        }, 125);
    }
    else if (config_1.default.mode == "zen" || config_1.default.timerStyle === "mini") {
        if (op > 0) {
            $("#miniTimerAndLiveWpm .time")
                .stop(true, true)
                .removeClass("hidden")
                .animate({
                opacity: op,
            }, 125);
        }
    }
}
exports.show = show;
function hide() {
    $("#timerWrapper").stop(true, true).animate({
        opacity: 0,
    }, 125);
    $("#miniTimerAndLiveWpm .time")
        .stop(true, true)
        .animate({
        opacity: 0,
    }, 125, () => {
        $("#miniTimerAndLiveWpm .time").addClass("hidden");
    });
    $("#timerNumber").stop(true, true).animate({
        opacity: 0,
    }, 125);
}
exports.hide = hide;
function restart() {
    if (config_1.default.timerStyle === "bar") {
        if (config_1.default.mode === "time") {
            $("#timer").stop(true, true).animate({
                width: "100vw",
            }, 0);
        }
        else if (config_1.default.mode === "words" || config_1.default.mode === "custom") {
            $("#timer").stop(true, true).animate({
                width: "0vw",
            }, 0);
        }
    }
}
exports.restart = restart;
const timerNumberElement = document.querySelector("#timerNumber");
const miniTimerNumberElement = document.querySelector("#miniTimerAndLiveWpm .time");
function update() {
    var _a, _b, _c;
    const time = Time.get();
    if (config_1.default.mode === "time" ||
        (config_1.default.mode === "custom" && CustomText.isTimeRandom)) {
        let maxtime = config_1.default.time;
        if (config_1.default.mode === "custom" && CustomText.isTimeRandom) {
            maxtime = CustomText.time;
        }
        if (config_1.default.timerStyle === "bar") {
            const percent = 100 - ((time + 1) / maxtime) * 100;
            $("#timer")
                .stop(true, true)
                .animate({
                width: percent + "vw",
            }, SlowTimer.get() ? 0 : 1000, "linear");
        }
        else if (config_1.default.timerStyle === "text") {
            let displayTime = Misc.secondsToString(maxtime - time);
            if (maxtime === 0) {
                displayTime = Misc.secondsToString(time);
            }
            if (timerNumberElement !== null) {
                timerNumberElement.innerHTML = "<div>" + displayTime + "</div>";
            }
        }
        else if (config_1.default.timerStyle === "mini") {
            let displayTime = Misc.secondsToString(maxtime - time);
            if (maxtime === 0) {
                displayTime = Misc.secondsToString(time);
            }
            if (miniTimerNumberElement !== null) {
                miniTimerNumberElement.innerHTML = displayTime;
            }
        }
    }
    else if (config_1.default.mode === "words" ||
        config_1.default.mode === "custom" ||
        config_1.default.mode === "quote") {
        let outof = TestWords.words.length;
        if (config_1.default.mode === "words") {
            outof = config_1.default.words;
        }
        if (config_1.default.mode === "custom") {
            if (CustomText.isWordRandom) {
                outof = CustomText.word;
            }
            else {
                outof = CustomText.text.length;
            }
        }
        if (config_1.default.mode === "quote") {
            outof = (_c = (_b = (_a = TestWords.randomQuote) === null || _a === void 0 ? void 0 : _a.textSplit) === null || _b === void 0 ? void 0 : _b.length) !== null && _c !== void 0 ? _c : 1;
        }
        if (config_1.default.timerStyle === "bar") {
            const percent = Math.floor(((TestWords.words.currentIndex + 1) / outof) * 100);
            $("#timer")
                .stop(true, true)
                .animate({
                width: percent + "vw",
            }, SlowTimer.get() ? 0 : 250);
        }
        else if (config_1.default.timerStyle === "text") {
            if (outof === 0) {
                if (timerNumberElement !== null) {
                    timerNumberElement.innerHTML =
                        "<div>" + `${TestInput.input.history.length}` + "</div>";
                }
            }
            else {
                if (timerNumberElement !== null) {
                    timerNumberElement.innerHTML =
                        "<div>" + `${TestInput.input.history.length}/${outof}` + "</div>";
                }
            }
        }
        else if (config_1.default.timerStyle === "mini") {
            if (config_1.default.words === 0) {
                if (miniTimerNumberElement !== null) {
                    miniTimerNumberElement.innerHTML = `${TestInput.input.history.length}`;
                }
            }
            else {
                if (miniTimerNumberElement !== null) {
                    miniTimerNumberElement.innerHTML = `${TestInput.input.history.length}/${outof}`;
                }
            }
        }
    }
    else if (config_1.default.mode == "zen") {
        if (config_1.default.timerStyle === "text") {
            if (timerNumberElement !== null) {
                timerNumberElement.innerHTML =
                    "<div>" + `${TestInput.input.history.length}` + "</div>";
            }
        }
        else {
            if (miniTimerNumberElement !== null) {
                miniTimerNumberElement.innerHTML = `${TestInput.input.history.length}`;
            }
        }
    }
}
exports.update = update;
function updateStyle() {
    if (!TestActive.get())
        return;
    hide();
    update();
    setTimeout(() => {
        show();
    }, 125);
}
exports.updateStyle = updateStyle;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "showTimerProgress") {
        if (eventValue === true && TestActive.get()) {
            show();
        }
        else {
            hide();
        }
    }
    if (eventKey === "timerStyle")
        updateStyle();
});


/***/ }),

/***/ "./src/scripts/test/today-tracker.ts":
/*!*******************************************!*\
  !*** ./src/scripts/test/today-tracker.ts ***!
  \*******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.addAllFromToday = exports.getString = exports.addSeconds = void 0;
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const DB = __importStar(__webpack_require__(/*! ../db */ "./src/scripts/db.ts"));
let seconds = 0;
let addedAllToday = false;
let dayToday;
function addSeconds(s) {
    if (addedAllToday) {
        const nowDate = new Date().getDate();
        if (nowDate > dayToday) {
            seconds = s;
            return;
        }
    }
    seconds += s;
}
exports.addSeconds = addSeconds;
function getString() {
    const secString = Misc.secondsToString(Math.round(seconds), true, true);
    return secString + (addedAllToday === true ? " today" : " session");
}
exports.getString = getString;
function addAllFromToday() {
    const todayDate = new Date();
    todayDate.setSeconds(0);
    todayDate.setMinutes(0);
    todayDate.setHours(0);
    todayDate.setMilliseconds(0);
    dayToday = todayDate.getDate();
    const todayDateMS = todayDate.getTime();
    seconds = 0;
    const results = DB.getSnapshot().results;
    results === null || results === void 0 ? void 0 : results.forEach((result) => {
        const resultDate = new Date(result.timestamp);
        resultDate.setSeconds(0);
        resultDate.setMinutes(0);
        resultDate.setHours(0);
        resultDate.setMilliseconds(0);
        const resultDateMS = resultDate.getTime();
        if (resultDateMS >= todayDateMS) {
            seconds +=
                result.testDuration + result.incompleteTestSeconds - result.afkDuration;
        }
    });
    addedAllToday = true;
}
exports.addAllFromToday = addAllFromToday;


/***/ }),

/***/ "./src/scripts/test/tts.ts":
/*!*********************************!*\
  !*** ./src/scripts/test/tts.ts ***!
  \*********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.speak = exports.clear = exports.init = exports.setLanguage = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ../config */ "./src/scripts/config.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ../observables/config-event */ "./src/scripts/observables/config-event.ts"));
let voice;
function setLanguage(lang = config_1.default.language) {
    return __awaiter(this, void 0, void 0, function* () {
        if (!voice)
            return;
        const language = yield Misc.getLanguage(lang);
        const bcp = language.bcp47 ? language.bcp47 : "en-US";
        voice.lang = bcp;
    });
}
exports.setLanguage = setLanguage;
function init() {
    return __awaiter(this, void 0, void 0, function* () {
        voice = new SpeechSynthesisUtterance();
        setLanguage();
    });
}
exports.init = init;
function clear() {
    voice = undefined;
}
exports.clear = clear;
function speak(text) {
    window.speechSynthesis.cancel();
    if (voice === undefined)
        init();
    if (voice !== undefined) {
        voice.text = text;
        window.speechSynthesis.speak(voice);
    }
}
exports.speak = speak;
ConfigEvent.subscribe((eventKey, eventValue) => {
    if (eventKey === "funbox") {
        if (eventValue === "none") {
            clear();
        }
        else if (eventValue === "tts") {
            init();
        }
    }
    if (eventKey === "language" && config_1.default.funbox === "tts")
        setLanguage();
});


/***/ }),

/***/ "./src/scripts/test/weak-spot.ts":
/*!***************************************!*\
  !*** ./src/scripts/test/weak-spot.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getWord = exports.updateScore = void 0;
const TestInput = __importStar(__webpack_require__(/*! ./test-input */ "./src/scripts/test/test-input.ts"));
// Changes how quickly it 'learns' scores - very roughly the score for a char
// is based on last perCharCount occurrences. Make it smaller to adjust faster.
const perCharCount = 50;
// Choose the highest scoring word from this many random words. Higher values
// will choose words with more weak letters on average.
const wordSamples = 20;
// Score penatly (in milliseconds) for getting a letter wrong.
const incorrectPenalty = 5000;
const scores = {};
class Score {
    constructor() {
        this.average = 0.0;
        this.count = 0;
    }
    update(score) {
        if (this.count < perCharCount) {
            this.count++;
        }
        const adjustRate = 1.0 / this.count;
        // Keep an exponential moving average of the score over time.
        this.average = score * adjustRate + this.average * (1 - adjustRate);
    }
}
function updateScore(char, isCorrect) {
    const timings = TestInput.keypressTimings.spacing.array;
    if (timings.length === 0 || typeof timings === "string") {
        return;
    }
    let score = timings[timings.length - 1];
    if (!isCorrect) {
        score += incorrectPenalty;
    }
    if (!(char in scores)) {
        scores[char] = new Score();
    }
    scores[char].update(score);
}
exports.updateScore = updateScore;
function score(word) {
    let total = 0.0;
    let numChars = 0;
    for (const c of word) {
        if (c in scores) {
            total += scores[c].average;
            numChars++;
        }
    }
    return numChars == 0 ? 0.0 : total / numChars;
}
function getWord(wordset) {
    let highScore;
    let randomWord = "";
    for (let i = 0; i < wordSamples; i++) {
        const newWord = wordset.randomWord();
        const newScore = score(newWord);
        if (i == 0 || highScore === undefined || newScore > highScore) {
            randomWord = newWord;
            highScore = newScore;
        }
    }
    return randomWord;
}
exports.getWord = getWord;


/***/ }),

/***/ "./src/scripts/test/wikipedia.ts":
/*!***************************************!*\
  !*** ./src/scripts/test/wikipedia.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.getSection = exports.getTLD = exports.Section = void 0;
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const Misc = __importStar(__webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts"));
class Section {
    constructor(title, author, words) {
        this.title = title;
        this.author = author;
        this.words = words;
    }
}
exports.Section = Section;
function getTLD(languageGroup) {
    return __awaiter(this, void 0, void 0, function* () {
        // language group to tld
        switch (languageGroup.name) {
            case "english":
                return "en";
            case "spanish":
                return "es";
            case "french":
                return "fr";
            case "german":
                return "de";
            case "portuguese":
                return "pt";
            case "italian":
                return "it";
            case "dutch":
                return "nl";
            default:
                return "en";
        }
    });
}
exports.getTLD = getTLD;
function getSection(language) {
    return __awaiter(this, void 0, void 0, function* () {
        // console.log("Getting section");
        Loader.show();
        // get TLD for wikipedia according to language group
        let urlTLD = "en";
        const currentLanguageGroup = yield Misc.findCurrentGroup(language);
        if (currentLanguageGroup !== undefined) {
            urlTLD = yield getTLD(currentLanguageGroup);
        }
        const randomPostURL = `https://${urlTLD}.wikipedia.org/api/rest_v1/page/random/summary`;
        const sectionObj = { title: "", author: "" };
        const randomPostReq = yield fetch(randomPostURL);
        let pageid = 0;
        if (randomPostReq.status == 200) {
            const postObj = yield randomPostReq.json();
            sectionObj.title = postObj.title;
            sectionObj.author = postObj.author;
            pageid = postObj.pageid;
        }
        return new Promise((res, rej) => {
            if (randomPostReq.status != 200) {
                Loader.hide();
                rej(randomPostReq.status);
            }
            const sectionURL = `https://${urlTLD}.wikipedia.org/w/api.php?action=query&format=json&pageids=${pageid}&prop=extracts&exintro=true&origin=*`;
            const sectionReq = new XMLHttpRequest();
            sectionReq.onload = () => {
                if (sectionReq.readyState == 4) {
                    if (sectionReq.status == 200) {
                        let sectionText = JSON.parse(sectionReq.responseText).query
                            .pages[pageid.toString()].extract;
                        const words = [];
                        // Remove double whitespaces and finally trailing whitespaces.
                        sectionText = sectionText.replace(/<\/p><p>+/g, " ");
                        sectionText = $("<div/>").html(sectionText).text();
                        sectionText = sectionText.replace(/\s+/g, " ");
                        sectionText = sectionText.trim();
                        // // Add spaces
                        // sectionText = sectionText.replace(/[a-zA-Z0-9]{3,}\.[a-zA-Z]/g, (x) =>
                        //   x.replace(/\./, ". ")
                        // );
                        sectionText.split(" ").forEach((word) => {
                            words.push(word);
                        });
                        const section = new Section(sectionObj.title, sectionObj.author, words);
                        Loader.hide();
                        res(section);
                    }
                    else {
                        Loader.hide();
                        rej(sectionReq.status);
                    }
                }
            };
            sectionReq.open("GET", sectionURL);
            sectionReq.send();
        });
    });
}
exports.getSection = getSection;


/***/ }),

/***/ "./src/scripts/test/wordset.ts":
/*!*************************************!*\
  !*** ./src/scripts/test/wordset.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.withWords = exports.Wordset = void 0;
const misc_1 = __webpack_require__(/*! ../utils/misc */ "./src/scripts/utils/misc.ts");
let currentWordset = null;
let currentWordGenerator = null;
class Wordset {
    constructor(words) {
        this.words = words;
        this.length = this.words.length;
    }
    randomWord() {
        return (0, misc_1.randomElementFromArray)(this.words);
    }
}
exports.Wordset = Wordset;
const prefixSize = 2;
class CharDistribution {
    constructor() {
        this.chars = {};
        this.count = 0;
    }
    addChar(char) {
        this.count++;
        if (char in this.chars) {
            this.chars[char]++;
        }
        else {
            this.chars[char] = 1;
        }
    }
    randomChar() {
        const randomIndex = (0, misc_1.randomIntFromRange)(0, this.count - 1);
        let runningCount = 0;
        for (const [char, charCount] of Object.entries(this.chars)) {
            runningCount += charCount;
            if (runningCount > randomIndex) {
                return char;
            }
        }
        return Object.keys(this.chars)[0];
    }
}
class WordGenerator extends Wordset {
    constructor(words) {
        super(words);
        this.ngrams = {};
        // Can generate an unbounded number of words in theory.
        this.length = Infinity;
        for (let word of words) {
            // Mark the end of each word with a space.
            word += " ";
            let prefix = "";
            for (const c of word) {
                // Add `c` to the distribution of chars that can come after `prefix`.
                if (!(prefix in this.ngrams)) {
                    this.ngrams[prefix] = new CharDistribution();
                }
                this.ngrams[prefix].addChar(c);
                prefix = (prefix + c).substr(-prefixSize);
            }
        }
    }
    randomWord() {
        let word = "";
        for (;;) {
            const prefix = word.substr(-prefixSize);
            const charDistribution = this.ngrams[prefix];
            if (!charDistribution) {
                // This shouldn't happen if this.ngrams is complete. If it does
                // somehow, start generating a new word.
                word = "";
                continue;
            }
            // Pick a random char from the distribution that comes after `prefix`.
            const nextChar = charDistribution.randomChar();
            if (nextChar == " ") {
                // A space marks the end of the word, so stop generating and return.
                break;
            }
            word += nextChar;
        }
        return word;
    }
}
function withWords(words, funbox) {
    if (funbox == "pseudolang") {
        if (currentWordGenerator == null || words !== currentWordGenerator.words) {
            currentWordGenerator = new WordGenerator(words);
        }
        return currentWordGenerator;
    }
    else {
        if (currentWordset == null || words !== currentWordset.words) {
            currentWordset = new Wordset(words);
        }
        return currentWordset;
    }
}
exports.withWords = withWords;


/***/ }),

/***/ "./src/scripts/ui.ts":
/*!***************************!*\
  !*** ./src/scripts/ui.ts ***!
  \***************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.updateKeytips = void 0;
const config_1 = __importDefault(__webpack_require__(/*! ./config */ "./src/scripts/config.ts"));
const Caret = __importStar(__webpack_require__(/*! ./test/caret */ "./src/scripts/test/caret.ts"));
const Notifications = __importStar(__webpack_require__(/*! ./elements/notifications */ "./src/scripts/elements/notifications.ts"));
const CustomText = __importStar(__webpack_require__(/*! ./test/custom-text */ "./src/scripts/test/custom-text.ts"));
const TestActive = __importStar(__webpack_require__(/*! ./states/test-active */ "./src/scripts/states/test-active.ts"));
const ConfigEvent = __importStar(__webpack_require__(/*! ./observables/config-event */ "./src/scripts/observables/config-event.ts"));
function updateKeytips() {
    if (config_1.default.swapEscAndTab) {
        $(".pageSettings .tip").html(`
    tip: You can also change all these settings quickly using the
    command line (
    <key>tab</key>
    )`);
        $("#bottom .keyTips").html(`
    <key>esc</key> - restart test<br>
      <key>tab</key> - command line`);
    }
    else {
        $(".pageSettings .tip").html(`
    tip: You can also change all these settings quickly using the
    command line (
    <key>esc</key>
    )`);
        $("#bottom .keyTips").html(`
    <key>tab</key> - restart test<br>
      <key>esc</key> or <key>ctrl/cmd</key>+<key>shift</key>+<key>p</key> - command line`);
    }
}
exports.updateKeytips = updateKeytips;
if (window.location.hostname === "localhost") {
    window.onerror = function (error) {
        Notifications.add(error.toString(), -1);
    };
    $("#top .logo .top").text("localhost");
    $("head title").text($("head title").text() + " (localhost)");
    $("body").append(`<div class="devIndicator tl">local</div><div class="devIndicator br">local</div>`);
    $(".pageSettings .discordIntegration .buttons a").attr("href", "https://discord.com/api/oauth2/authorize?client_id=798272335035498557&redirect_uri=http%3A%2F%2Flocalhost%3A5000%2Fverify&response_type=token&scope=identify");
}
//stop space scrolling
window.addEventListener("keydown", function (e) {
    if (e.code === "Space" && e.target === document.body) {
        e.preventDefault();
    }
});
window.addEventListener("beforeunload", (event) => {
    // Cancel the event as stated by the standard.
    if ((config_1.default.mode === "words" && config_1.default.words < 1000) ||
        (config_1.default.mode === "time" && config_1.default.time < 3600) ||
        config_1.default.mode === "quote" ||
        (config_1.default.mode === "custom" &&
            CustomText.isWordRandom &&
            CustomText.word < 1000) ||
        (config_1.default.mode === "custom" &&
            CustomText.isTimeRandom &&
            CustomText.time < 1000) ||
        (config_1.default.mode === "custom" &&
            !CustomText.isWordRandom &&
            CustomText.text.length < 1000)) {
        //ignore
    }
    else {
        if (TestActive.get()) {
            event.preventDefault();
            // Chrome requires returnValue to be set.
            event.returnValue = "";
        }
    }
});
$(window).on("resize", () => {
    console.log("Updating caret position");
    Caret.updatePosition();
});
ConfigEvent.subscribe((eventKey) => {
    if (eventKey === "swapEscAndTab")
        updateKeytips();
});


/***/ }),

/***/ "./src/scripts/utils/debounce.ts":
/*!***************************************!*\
  !*** ./src/scripts/utils/debounce.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.debounce = void 0;
function debounce(fn, ms = 250) {
    let timeoutId;
    return function (...args) {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => fn.apply(this, args), ms);
    };
}
exports.debounce = debounce;


/***/ }),

/***/ "./src/scripts/utils/misc.ts":
/*!***********************************!*\
  !*** ./src/scripts/utils/misc.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.regexIndexOf = exports.setCharAt = exports.clearTimeouts = exports.canQuickRestart = exports.mapRange = exports.isUsernameValid = exports.cleanTypographySymbols = exports.escapeRegExp = exports.remove_non_ascii = exports.getWords = exports.toggleFullscreen = exports.objectToQueryString = exports.findGetParameter = exports.getPositionString = exports.getArrows = exports.getASCII = exports.getSpecials = exports.getNumbers = exports.secondsToString = exports.getGibberish = exports.findLineByLeastSquares = exports.roundTo2 = exports.whorf = exports.kogasa = exports.isASCIILetter = exports.capitalizeFirstLetterOfEachWord = exports.getLastChar = exports.getReleasesFromGitHub = exports.median = exports.mean = exports.stdDev = exports.smooth = exports.getChallengeList = exports.findCurrentGroup = exports.getCurrentLanguage = exports.getLanguage = exports.getLanguageGroups = exports.getLanguageList = exports.getContributorsList = exports.getSupportersList = exports.getFontsList = exports.getLayout = exports.getLayoutsList = exports.getFunbox = exports.getFunboxList = exports.getSortedThemesList = exports.getThemesList = exports.isColorDark = exports.isColorLight = exports.getuid = void 0;
exports.createErrorMessage = exports.randomElementFromObject = exports.randomElementFromArray = exports.shuffle = exports.randomIntFromRange = exports.downloadResultsCSV = exports.getMode2 = exports.swapElements = exports.convertRemToPixels = exports.trailingComposeChars = exports.convertRGBtoHEX = void 0;
const Loader = __importStar(__webpack_require__(/*! ../elements/loader */ "./src/scripts/elements/loader.ts"));
const format_1 = __importDefault(__webpack_require__(/*! date-fns/format */ "./node_modules/date-fns/esm/format/index.js"));
const firebase_1 = __webpack_require__(/*! ../firebase */ "./src/scripts/firebase.ts");
function getuid() {
    var _a;
    console.error("Only share this uid with Miodec and nobody else!");
    console.log((_a = firebase_1.Auth.currentUser) === null || _a === void 0 ? void 0 : _a.uid);
    console.error("Only share this uid with Miodec and nobody else!");
}
exports.getuid = getuid;
function hexToHSL(hex) {
    // Convert hex to RGB first
    let r;
    let g;
    let b;
    if (hex.length == 4) {
        r = ("0x" + hex[1] + hex[1]);
        g = ("0x" + hex[2] + hex[2]);
        b = ("0x" + hex[3] + hex[3]);
    }
    else if (hex.length == 7) {
        r = ("0x" + hex[1] + hex[2]);
        g = ("0x" + hex[3] + hex[4]);
        b = ("0x" + hex[5] + hex[6]);
    }
    else {
        r = 0x00;
        g = 0x00;
        b = 0x00;
    }
    // Then to HSL
    r /= 255;
    g /= 255;
    b /= 255;
    const cmin = Math.min(r, g, b);
    const cmax = Math.max(r, g, b);
    const delta = cmax - cmin;
    let h = 0;
    let s = 0;
    let l = 0;
    if (delta == 0)
        h = 0;
    else if (cmax == r)
        h = ((g - b) / delta) % 6;
    else if (cmax == g)
        h = (b - r) / delta + 2;
    else
        h = (r - g) / delta + 4;
    h = Math.round(h * 60);
    if (h < 0)
        h += 360;
    l = (cmax + cmin) / 2;
    s = delta == 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));
    s = +(s * 100).toFixed(1);
    l = +(l * 100).toFixed(1);
    return {
        hue: h,
        sat: s,
        lgt: l,
        string: "hsl(" + h + "," + s + "%," + l + "%)",
    };
}
function isColorLight(hex) {
    const hsl = hexToHSL(hex);
    return hsl.lgt >= 50;
}
exports.isColorLight = isColorLight;
function isColorDark(hex) {
    const hsl = hexToHSL(hex);
    return hsl.lgt < 50;
}
exports.isColorDark = isColorDark;
let themesList = [];
function getThemesList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (themesList.length == 0) {
            return $.getJSON("themes/_list.json", function (data) {
                const list = data.sort(function (a, b) {
                    const nameA = a.name.toLowerCase();
                    const nameB = b.name.toLowerCase();
                    if (nameA < nameB)
                        return -1;
                    if (nameA > nameB)
                        return 1;
                    return 0;
                });
                themesList = list;
                return themesList;
            });
        }
        else {
            return themesList;
        }
    });
}
exports.getThemesList = getThemesList;
let sortedThemesList = [];
function getSortedThemesList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (sortedThemesList.length === 0) {
            if (themesList.length === 0) {
                yield getThemesList();
            }
            let sorted = [...themesList];
            sorted = sorted.sort((a, b) => {
                const b1 = hexToHSL(a.bgColor);
                const b2 = hexToHSL(b.bgColor);
                return b2.lgt - b1.lgt;
            });
            sortedThemesList = sorted;
            return sortedThemesList;
        }
        else {
            return sortedThemesList;
        }
    });
}
exports.getSortedThemesList = getSortedThemesList;
let funboxList = [];
function getFunboxList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (funboxList.length === 0) {
            return $.getJSON("funbox/_list.json", function (data) {
                funboxList = data.sort(function (a, b) {
                    const nameA = a.name.toLowerCase();
                    const nameB = b.name.toLowerCase();
                    if (nameA < nameB)
                        return -1;
                    if (nameA > nameB)
                        return 1;
                    return 0;
                });
                return funboxList;
            });
        }
        else {
            return funboxList;
        }
    });
}
exports.getFunboxList = getFunboxList;
function getFunbox(funbox) {
    return __awaiter(this, void 0, void 0, function* () {
        const list = yield getFunboxList();
        return list.find(function (element) {
            return element.name == funbox;
        });
    });
}
exports.getFunbox = getFunbox;
let layoutsList = {};
function getLayoutsList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (Object.keys(layoutsList).length === 0) {
            return $.getJSON("layouts/_list.json", function (data) {
                layoutsList = data;
                return layoutsList;
            });
        }
        else {
            return layoutsList;
        }
    });
}
exports.getLayoutsList = getLayoutsList;
function getLayout(layoutName) {
    return __awaiter(this, void 0, void 0, function* () {
        if (Object.keys(layoutsList).length === 0) {
            yield getLayoutsList();
        }
        return layoutsList[layoutName];
    });
}
exports.getLayout = getLayout;
let fontsList = [];
function getFontsList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (fontsList.length === 0) {
            return $.getJSON("fonts/_list.json", function (data) {
                fontsList = data.sort(function (a, b) {
                    const nameA = a.name.toLowerCase();
                    const nameB = b.name.toLowerCase();
                    if (nameA < nameB)
                        return -1;
                    if (nameA > nameB)
                        return 1;
                    return 0;
                });
                return fontsList;
            });
        }
        else {
            return fontsList;
        }
    });
}
exports.getFontsList = getFontsList;
let supportersList = [];
function getSupportersList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (supportersList.length === 0) {
            return $.getJSON("about/supporters.json", function (data) {
                supportersList = data;
                return supportersList;
            });
        }
        else {
            return supportersList;
        }
    });
}
exports.getSupportersList = getSupportersList;
let contributorsList = [];
function getContributorsList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (contributorsList.length === 0) {
            return $.getJSON("about/contributors.json", function (data) {
                contributorsList = data;
                return contributorsList;
            });
        }
        else {
            return contributorsList;
        }
    });
}
exports.getContributorsList = getContributorsList;
let languageList = [];
function getLanguageList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (languageList.length === 0) {
            return $.getJSON("languages/_list.json", function (data) {
                languageList = data;
                return languageList;
            });
        }
        else {
            return languageList;
        }
    });
}
exports.getLanguageList = getLanguageList;
let languageGroupList = [];
function getLanguageGroups() {
    return __awaiter(this, void 0, void 0, function* () {
        if (languageGroupList.length === 0) {
            return $.getJSON("languages/_groups.json", function (data) {
                languageGroupList = data;
                return languageGroupList;
            });
        }
        else {
            return languageGroupList;
        }
    });
}
exports.getLanguageGroups = getLanguageGroups;
let currentLanguage;
function getLanguage(lang) {
    return __awaiter(this, void 0, void 0, function* () {
        try {
            if (currentLanguage == undefined || currentLanguage.name !== lang) {
                console.log("getting language json");
                yield $.getJSON(`languages/${lang}.json`, function (data) {
                    currentLanguage = data;
                });
            }
            return currentLanguage;
        }
        catch (e) {
            console.error(`error getting language`);
            console.error(e);
            yield $.getJSON(`languages/english.json`, function (data) {
                currentLanguage = data;
            });
            return currentLanguage;
        }
    });
}
exports.getLanguage = getLanguage;
function getCurrentLanguage(languageName) {
    return __awaiter(this, void 0, void 0, function* () {
        return yield getLanguage(languageName);
    });
}
exports.getCurrentLanguage = getCurrentLanguage;
function findCurrentGroup(language) {
    return __awaiter(this, void 0, void 0, function* () {
        let retgroup;
        const groups = yield getLanguageGroups();
        groups.forEach((group) => {
            if (retgroup === undefined) {
                if (group.languages.includes(language)) {
                    retgroup = group;
                }
            }
        });
        return retgroup;
    });
}
exports.findCurrentGroup = findCurrentGroup;
let challengeList = [];
function getChallengeList() {
    return __awaiter(this, void 0, void 0, function* () {
        if (challengeList.length === 0) {
            return $.getJSON("challenges/_list.json", function (data) {
                challengeList = data;
                return challengeList;
            });
        }
        else {
            return challengeList;
        }
    });
}
exports.getChallengeList = getChallengeList;
function smooth(arr, windowSize, getter = (value) => value) {
    const get = getter;
    const result = [];
    for (let i = 0; i < arr.length; i += 1) {
        const leftOffeset = i - windowSize;
        const from = leftOffeset >= 0 ? leftOffeset : 0;
        const to = i + windowSize + 1;
        let count = 0;
        let sum = 0;
        for (let j = from; j < to && j < arr.length; j += 1) {
            sum += get(arr[j]);
            count += 1;
        }
        result[i] = sum / count;
    }
    return result;
}
exports.smooth = smooth;
function stdDev(array) {
    try {
        const n = array.length;
        const mean = array.reduce((a, b) => a + b) / n;
        return Math.sqrt(array.map((x) => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / n);
    }
    catch (e) {
        return 0;
    }
}
exports.stdDev = stdDev;
function mean(array) {
    try {
        return (array.reduce((previous, current) => (current += previous)) / array.length);
    }
    catch (e) {
        return 0;
    }
}
exports.mean = mean;
//https://www.w3resource.com/javascript-exercises/fundamental/javascript-fundamental-exercise-88.php
function median(arr) {
    try {
        const mid = Math.floor(arr.length / 2), nums = [...arr].sort((a, b) => a - b);
        return arr.length % 2 !== 0 ? nums[mid] : (nums[mid - 1] + nums[mid]) / 2;
    }
    catch (e) {
        return 0;
    }
}
exports.median = median;
function getReleasesFromGitHub() {
    return __awaiter(this, void 0, void 0, function* () {
        return $.getJSON("https://api.github.com/repos/Miodec/monkeytype/releases", (data) => {
            $("#bottom .version .text").text(data[0].name);
            $("#bottom .version").css("opacity", 1);
            $("#versionHistory .releases").empty();
            data.forEach((release) => {
                if (!release.draft && !release.prerelease) {
                    $("#versionHistory .releases").append(`
          <div class="release">
            <div class="title">${release.name}</div>
            <div class="date">${(0, format_1.default)(new Date(release.published_at), "dd MMM yyyy")}</div>
            <div class="body">${release.body.replace(/\r\n/g, "<br>")}</div>
          </div>
        `);
                }
            });
        });
    });
}
exports.getReleasesFromGitHub = getReleasesFromGitHub;
// function getPatreonNames() {
//   let namesel = $(".pageAbout .section .supporters");
//   firebase
//     .functions()
//     .httpsCallable("getPatreons")()
//     .then((data) => {
//       let names = data.data;
//       names.forEach((name) => {
//         namesel.append(`<div>${name}</div>`);
//       });
//     });
// }
function getLastChar(word) {
    try {
        return word.charAt(word.length - 1);
    }
    catch (_a) {
        return "";
    }
}
exports.getLastChar = getLastChar;
function capitalizeFirstLetterOfEachWord(str) {
    return str
        .split(/ +/)
        .map((s) => s.charAt(0).toUpperCase() + s.slice(1))
        .join(" ");
}
exports.capitalizeFirstLetterOfEachWord = capitalizeFirstLetterOfEachWord;
function isASCIILetter(c) {
    return c.length === 1 && /[a-z]/i.test(c);
}
exports.isASCIILetter = isASCIILetter;
function kogasa(cov) {
    return (100 * (1 - Math.tanh(cov + Math.pow(cov, 3) / 3 + Math.pow(cov, 5) / 5)));
}
exports.kogasa = kogasa;
function whorf(speed, wordlen) {
    return Math.min(speed, Math.floor(speed * Math.pow(1.03, -2 * (wordlen - 3))));
}
exports.whorf = whorf;
function roundTo2(num) {
    return Math.round((num + Number.EPSILON) * 100) / 100;
}
exports.roundTo2 = roundTo2;
function findLineByLeastSquares(values_y) {
    let sum_x = 0;
    let sum_y = 0;
    let sum_xy = 0;
    let sum_xx = 0;
    let count = 0;
    /*
     * We'll use those letiables for faster read/write access.
     */
    let x = 0;
    let y = 0;
    const values_length = values_y.length;
    /*
     * Nothing to do.
     */
    if (values_length === 0) {
        return [[], []];
    }
    /*
     * Calculate the sum for each of the parts necessary.
     */
    for (let v = 0; v < values_length; v++) {
        x = v + 1;
        y = values_y[v];
        sum_x += x;
        sum_y += y;
        sum_xx += x * x;
        sum_xy += x * y;
        count++;
    }
    /*
     * Calculate m and b for the formular:
     * y = x * m + b
     */
    const m = (count * sum_xy - sum_x * sum_y) / (count * sum_xx - sum_x * sum_x);
    const b = sum_y / count - (m * sum_x) / count;
    const returnpoint1 = [1, 1 * m + b];
    const returnpoint2 = [values_length, values_length * m + b];
    return [returnpoint1, returnpoint2];
}
exports.findLineByLeastSquares = findLineByLeastSquares;
function getGibberish() {
    const randLen = randomIntFromRange(1, 7);
    let ret = "";
    for (let i = 0; i < randLen; i++) {
        ret += String.fromCharCode(97 + randomIntFromRange(0, 25));
    }
    return ret;
}
exports.getGibberish = getGibberish;
function secondsToString(sec, alwaysShowMinutes = false, alwaysShowHours = false, delimiter = ":", showSeconds = true, showDays = false) {
    sec = Math.abs(sec);
    let days = 0;
    let hours;
    if (showDays) {
        days = Math.floor(sec / 86400);
        hours = Math.floor((sec % 86400) / 3600);
    }
    else {
        hours = Math.floor(sec / 3600);
    }
    const minutes = Math.floor((sec % 3600) / 60);
    const seconds = roundTo2((sec % 3600) % 60);
    let daysString;
    let hoursString;
    let minutesString;
    let secondsString;
    if (showDays) {
        days < 10 && delimiter !== "text"
            ? (daysString = "0" + days)
            : (daysString = days);
    }
    hours < 10 && delimiter !== "text"
        ? (hoursString = "0" + hours)
        : (hoursString = hours);
    minutes < 10 && delimiter !== "text"
        ? (minutesString = "0" + minutes)
        : (minutesString = minutes);
    seconds < 10 &&
        (minutes > 0 || hours > 0 || alwaysShowMinutes) &&
        delimiter !== "text"
        ? (secondsString = "0" + seconds)
        : (secondsString = seconds);
    let ret = "";
    if (days > 0 && showDays) {
        ret += daysString;
        if (delimiter === "text") {
            if (days == 1) {
                ret += " day ";
            }
            else {
                ret += " days ";
            }
        }
        else {
            ret += delimiter;
        }
    }
    if (hours > 0 || alwaysShowHours) {
        ret += hoursString;
        if (delimiter === "text") {
            if (hours == 1) {
                ret += " hour ";
            }
            else {
                ret += " hours ";
            }
        }
        else {
            ret += delimiter;
        }
    }
    if (minutes > 0 || hours > 0 || alwaysShowMinutes) {
        ret += minutesString;
        if (delimiter === "text") {
            if (minutes == 1) {
                ret += " minute ";
            }
            else {
                ret += " minutes ";
            }
        }
        else if (showSeconds) {
            ret += delimiter;
        }
    }
    if (showSeconds) {
        ret += secondsString;
        if (delimiter === "text") {
            if (seconds == 1) {
                ret += " second";
            }
            else {
                ret += " seconds";
            }
        }
    }
    if (hours === 0 && minutes === 0 && !showSeconds && delimiter === "text") {
        ret = "less than 1 minute";
    }
    return ret.trim();
}
exports.secondsToString = secondsToString;
function getNumbers(len) {
    const randLen = randomIntFromRange(1, len);
    let ret = "";
    for (let i = 0; i < randLen; i++) {
        const randomNum = randomIntFromRange(0, 9);
        ret += randomNum.toString();
    }
    return ret;
}
exports.getNumbers = getNumbers;
function getSpecials() {
    const randLen = randomIntFromRange(1, 7);
    let ret = "";
    const specials = [
        "!",
        "@",
        "#",
        "$",
        "%",
        "^",
        "&",
        "*",
        "(",
        ")",
        "-",
        "_",
        "=",
        "+",
        "{",
        "}",
        "[",
        "]",
        "'",
        '"',
        "/",
        "\\",
        "|",
    ];
    for (let i = 0; i < randLen; i++) {
        ret += randomElementFromArray(specials);
    }
    return ret;
}
exports.getSpecials = getSpecials;
function getASCII() {
    const randLen = randomIntFromRange(1, 10);
    let ret = "";
    for (let i = 0; i < randLen; i++) {
        let ran = 33 + randomIntFromRange(0, 93);
        while (ran == 96 || ran == 94)
            ran = 33 + randomIntFromRange(0, 93); //todo remove when input rewrite is fixed
        ret += String.fromCharCode(ran);
    }
    return ret;
}
exports.getASCII = getASCII;
function getArrows() {
    const arrowArray = ["", "", "", ""];
    let arrowWord = "";
    let lastchar;
    for (let i = 0; i < 5; i++) {
        let random = randomElementFromArray(arrowArray);
        while (random === lastchar) {
            random = randomElementFromArray(arrowArray);
        }
        lastchar = random;
        arrowWord += random;
    }
    return arrowWord;
}
exports.getArrows = getArrows;
function getPositionString(number) {
    let numend = "th";
    const t = number % 10;
    const h = number % 100;
    if (t == 1 && h != 11) {
        numend = "st";
    }
    if (t == 2 && h != 12) {
        numend = "nd";
    }
    if (t == 3 && h != 13) {
        numend = "rd";
    }
    return number + numend;
}
exports.getPositionString = getPositionString;
function findGetParameter(parameterName) {
    let result = null;
    let tmp = [];
    location.search
        .substr(1)
        .split("&")
        .forEach(function (item) {
        tmp = item.split("=");
        if (tmp[0] === parameterName)
            result = decodeURIComponent(tmp[1]);
    });
    return result;
}
exports.findGetParameter = findGetParameter;
function objectToQueryString(obj) {
    const str = [];
    for (const p in obj) {
        if (Object.prototype.hasOwnProperty.call(obj, p)) {
            // Arrays get encoded as a comma(%2C)-separated list
            str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
        }
    }
    return str.join("&");
}
exports.objectToQueryString = objectToQueryString;
function toggleFullscreen() {
    const elem = document.documentElement;
    if (!document.fullscreenElement &&
        !document.mozFullScreenElement &&
        !document.webkitFullscreenElement &&
        !document.msFullscreenElement) {
        if (elem.requestFullscreen) {
            elem.requestFullscreen();
        }
        else if (elem.msRequestFullscreen) {
            elem.msRequestFullscreen();
        }
        else if (elem.mozRequestFullScreen) {
            elem.mozRequestFullScreen();
        }
        else if (elem.webkitRequestFullscreen) {
            // @ts-ignore
            elem.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
        }
    }
    else {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        }
        else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
        else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        }
        else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
        }
    }
}
exports.toggleFullscreen = toggleFullscreen;
function getWords() {
    const words = [...document.querySelectorAll("#words .word")]
        .map((word) => {
        return [...word.querySelectorAll("letter")]
            .map((letter) => letter.textContent)
            .join("");
    })
        .join(" ");
    return words;
}
exports.getWords = getWords;
//credit: https://www.w3resource.com/javascript-exercises/javascript-string-exercise-32.php
function remove_non_ascii(str) {
    if (str === null || str === "")
        return "";
    else
        str = str.toString();
    return str.replace(/[^\x20-\x7E]/g, "");
}
exports.remove_non_ascii = remove_non_ascii;
function escapeRegExp(str) {
    return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
}
exports.escapeRegExp = escapeRegExp;
function cleanTypographySymbols(textToClean) {
    const specials = {
        "": '"',
        "": '"',
        "": "'",
        "": "'",
        ",": ",",
        "": "-",
        "": "...",
        "": "<<",
        "": ">>",
        "": "-",
        "": " ",
        "": " ",
        "": " ",
    };
    return textToClean.replace(/[,\u2007\u202F\u00A0]/g, (char) => specials[char] || "");
}
exports.cleanTypographySymbols = cleanTypographySymbols;
function isUsernameValid(name) {
    if (name === null || name === undefined || name === "")
        return false;
    if (/miodec/.test(name.toLowerCase()))
        return false;
    if (/bitly/.test(name.toLowerCase()))
        return false;
    if (name.length > 14)
        return false;
    if (/^\..*/.test(name.toLowerCase()))
        return false;
    return /^[0-9a-zA-Z_.-]+$/.test(name);
}
exports.isUsernameValid = isUsernameValid;
function mapRange(x, in_min, in_max, out_min, out_max) {
    let num = ((x - in_min) * (out_max - out_min)) / (in_max - in_min) + out_min;
    if (out_min > out_max) {
        if (num > out_min) {
            num = out_min;
        }
        else if (num < out_max) {
            num = out_max;
        }
    }
    else {
        if (num < out_min) {
            num = out_min;
        }
        else if (num > out_max) {
            num = out_max;
        }
    }
    return num;
}
exports.mapRange = mapRange;
function canQuickRestart(mode, words, time, CustomText) {
    if ((mode === "words" && words < 1000) ||
        (mode === "time" && time < 3600) ||
        mode === "quote" ||
        (mode === "custom" && CustomText.isWordRandom && CustomText.word < 1000) ||
        (mode === "custom" && CustomText.isTimeRandom && CustomText.time < 3600) ||
        (mode === "custom" &&
            !CustomText.isWordRandom &&
            CustomText.text.length < 1000)) {
        return true;
    }
    else {
        return false;
    }
}
exports.canQuickRestart = canQuickRestart;
function clearTimeouts(timeouts) {
    timeouts.forEach((to) => {
        if (typeof to === "number")
            clearTimeout(to);
        else
            clearTimeout(to);
    });
}
exports.clearTimeouts = clearTimeouts;
//https://stackoverflow.com/questions/1431094/how-do-i-replace-a-character-at-a-particular-index-in-javascript
function setCharAt(str, index, chr) {
    if (index > str.length - 1)
        return str;
    return str.substring(0, index) + chr + str.substring(index + 1);
}
exports.setCharAt = setCharAt;
//https://stackoverflow.com/questions/273789/is-there-a-version-of-javascripts-string-indexof-that-allows-for-regular-expr
function regexIndexOf(string, regex, startpos) {
    const indexOf = string.substring(startpos || 0).search(regex);
    return indexOf >= 0 ? indexOf + (startpos || 0) : indexOf;
}
exports.regexIndexOf = regexIndexOf;
function convertRGBtoHEX(rgb) {
    const match = rgb.match(/^rgb\((\d+), \s*(\d+), \s*(\d+)\)$/);
    if (match === null)
        return;
    if (match.length < 3)
        return;
    function hexCode(i) {
        // Take the last 2 characters and convert
        // them to Hexadecimal.
        return ("0" + parseInt(i).toString(16)).slice(-2);
    }
    return "#" + hexCode(match[1]) + hexCode(match[2]) + hexCode(match[3]);
}
exports.convertRGBtoHEX = convertRGBtoHEX;
String.prototype.lastIndexOfRegex = function (regex) {
    const match = this.match(regex);
    return match ? this.lastIndexOf(match[match.length - 1]) : -1;
};
exports.trailingComposeChars = /[\u02B0-\u02FF`^~]+$|.*$/;
//https://stackoverflow.com/questions/36532307/rem-px-in-javascript
function convertRemToPixels(rem) {
    return rem * parseFloat(getComputedStyle(document.documentElement).fontSize);
}
exports.convertRemToPixels = convertRemToPixels;
function swapElements(el1, el2, totalDuration, callback = function () {
    return;
}, middleCallback = function () {
    return;
}) {
    if ((el1.hasClass("hidden") && !el2.hasClass("hidden")) ||
        (!el1.hasClass("hidden") && el2.hasClass("hidden"))) {
        //one of them is hidden and the other is visible
        if (el1.hasClass("hidden")) {
            callback();
            return false;
        }
        $(el1)
            .removeClass("hidden")
            .css("opacity", 1)
            .animate({
            opacity: 0,
        }, totalDuration / 2, () => {
            middleCallback();
            $(el1).addClass("hidden");
            $(el2)
                .removeClass("hidden")
                .css("opacity", 0)
                .animate({
                opacity: 1,
            }, totalDuration / 2, () => {
                callback();
            });
        });
    }
    else if (el1.hasClass("hidden") && el2.hasClass("hidden")) {
        //both are hidden, only fade in the second
        $(el2)
            .removeClass("hidden")
            .css("opacity", 0)
            .animate({
            opacity: 1,
        }, totalDuration, () => {
            callback();
        });
    }
    else {
        callback();
    }
    return;
}
exports.swapElements = swapElements;
function getMode2(config, randomQuote) {
    const mode = config.mode;
    if (mode === "time") {
        return config.time.toString();
    }
    else if (mode === "words") {
        return config.words.toString();
    }
    else if (mode === "custom") {
        return "custom";
    }
    else if (mode === "zen") {
        return "zen";
    }
    else if (mode === "quote") {
        return randomQuote.id.toString();
    }
    return "";
}
exports.getMode2 = getMode2;
function downloadResultsCSV(array) {
    return __awaiter(this, void 0, void 0, function* () {
        Loader.show();
        const csvString = [
            [
                "_id",
                "isPb",
                "wpm",
                "acc",
                "rawWpm",
                "consistency",
                "charStats",
                "mode",
                "mode2",
                "quoteLength",
                "restartCount",
                "testDuration",
                "afkDuration",
                "incompleteTestSeconds",
                "punctuation",
                "numbers",
                "language",
                "funbox",
                "difficulty",
                "lazyMode",
                "blindMode",
                "bailedOut",
                "tags",
                "timestamp",
            ],
            ...array.map((item) => [
                item._id,
                item.isPb,
                item.wpm,
                item.acc,
                item.rawWpm,
                item.consistency,
                item.charStats.join(","),
                item.mode,
                item.mode2,
                item.quoteLength,
                item.restartCount,
                item.testDuration,
                item.afkDuration,
                item.incompleteTestSeconds,
                item.punctuation,
                item.numbers,
                item.language,
                item.funbox,
                item.difficulty,
                item.lazyMode,
                item.blindMode,
                item.bailedOut,
                item.tags.join(","),
                item.timestamp,
            ]),
        ]
            .map((e) => e.join("|"))
            .join("\n");
        const blob = new Blob([csvString], { type: "text/csv" });
        const href = window.URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.setAttribute("href", href);
        link.setAttribute("download", "results.csv");
        document.body.appendChild(link); // Required for FF
        link.click();
        link.remove();
        Loader.hide();
    });
}
exports.downloadResultsCSV = downloadResultsCSV;
/**
 * Gets an integer between min and max, both are inclusive.
 * @param min
 * @param max
 * @returns Random integer betwen min and max.
 */
function randomIntFromRange(min, max) {
    const minNorm = Math.ceil(min);
    const maxNorm = Math.floor(max);
    return Math.floor(Math.random() * (maxNorm - minNorm + 1) + minNorm);
}
exports.randomIntFromRange = randomIntFromRange;
/**
 * Shuffle an array of elements using the FisherYates algorithm.
 * This function mutates the input array.
 * @param elements
 */
function shuffle(elements) {
    for (let i = elements.length - 1; i > 0; --i) {
        const j = randomIntFromRange(0, i);
        const temp = elements[j];
        elements[j] = elements[i];
        elements[i] = temp;
    }
}
exports.shuffle = shuffle;
function randomElementFromArray(array) {
    return array[randomIntFromRange(0, array.length - 1)];
}
exports.randomElementFromArray = randomElementFromArray;
function randomElementFromObject(object) {
    return randomElementFromArray(Object.values(object));
}
exports.randomElementFromObject = randomElementFromObject;
function createErrorMessage(error, message) {
    if (error instanceof Error)
        return `${message}: ${error.message}`;
    return `${message}`;
}
exports.createErrorMessage = createErrorMessage;


/***/ }),

/***/ "./src/scripts/utils/search-service.ts":
/*!*********************************************!*\
  !*** ./src/scripts/utils/search-service.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.buildSearchService = void 0;
const stemmer_1 = __webpack_require__(/*! stemmer */ "./node_modules/stemmer/index.js");
const damerau_levenshtein_1 = __importDefault(__webpack_require__(/*! damerau-levenshtein */ "./node_modules/damerau-levenshtein/index.js"));
const DEFAULT_OPTIONS = {
    fuzzyMatchSensitivity: 0.2,
    scoreForSimilarMatch: 0.5,
    scoreForExactMatch: 1, // When ranking results, the score a match gets for having an exact match with a token in the search query.
};
function inverseDocumentFrequency(numberOfDocuments, numberOfDocumentsWithTerm) {
    if (numberOfDocumentsWithTerm === 0) {
        return 0;
    }
    return Math.log10(numberOfDocuments / numberOfDocumentsWithTerm);
}
function tokenize(text) {
    return text.match(/[^\\\][.,"/#!?$%^&*;:{}=\-_`~()\s]+/g) || [];
}
const buildSearchService = (documents, getSearchableText, options = DEFAULT_OPTIONS) => {
    const reverseIndex = {};
    const normalizedTokenToOriginal = {};
    documents.forEach((document, documentIndex) => {
        const rawTokens = tokenize(getSearchableText(document));
        const internalDocument = {
            id: documentIndex,
        };
        rawTokens.forEach((token) => {
            const stemmedToken = (0, stemmer_1.stemmer)(token);
            if (!(stemmedToken in normalizedTokenToOriginal)) {
                normalizedTokenToOriginal[stemmedToken] = new Set();
            }
            normalizedTokenToOriginal[stemmedToken].add(token);
            if (!(stemmedToken in reverseIndex)) {
                reverseIndex[stemmedToken] = new Set();
            }
            reverseIndex[stemmedToken].add(internalDocument);
        });
    });
    const tokenSet = Object.keys(reverseIndex);
    const query = (searchQuery) => {
        const searchResult = {
            results: [],
            matchedQueryTerms: [],
        };
        const normalizedSearchQuery = new Set(tokenize(searchQuery).map((token) => (0, stemmer_1.stemmer)(token)));
        if (normalizedSearchQuery.size === 0) {
            return searchResult;
        }
        const results = new Map();
        const matchedTokens = new Set();
        normalizedSearchQuery.forEach((searchToken) => {
            tokenSet.forEach((token) => {
                const { similarity } = (0, damerau_levenshtein_1.default)(searchToken, token);
                const matchesSearchToken = token === searchToken;
                const isSimilar = similarity >= 1 - options.fuzzyMatchSensitivity;
                if (matchesSearchToken || isSimilar) {
                    const documentMatches = reverseIndex[token];
                    const idf = inverseDocumentFrequency(documents.length, documentMatches.size);
                    documentMatches.forEach((document) => {
                        var _a;
                        const currentScore = (_a = results.get(document.id)) !== null && _a !== void 0 ? _a : 0;
                        const scoreForExactMatch = matchesSearchToken
                            ? options.scoreForExactMatch
                            : 0;
                        const scoreForSimilarity = isSimilar
                            ? options.scoreForSimilarMatch
                            : 0;
                        const score = scoreForExactMatch + scoreForSimilarity;
                        const scoreForToken = score * idf;
                        results.set(document.id, currentScore + scoreForToken);
                    });
                    normalizedTokenToOriginal[token].forEach((originalToken) => {
                        matchedTokens.add(originalToken);
                    });
                }
            });
        });
        const orderedResults = [...results]
            .sort((match1, match2) => {
            return match2[1] - match1[1];
        })
            .map((match) => documents[match[0]]);
        searchResult.results = orderedResults;
        searchResult.matchedQueryTerms = [...matchedTokens];
        return searchResult;
    };
    return {
        query,
    };
};
exports.buildSearchService = buildSearchService;


/***/ }),

/***/ "./src/scripts/utils/strings.ts":
/*!**************************************!*\
  !*** ./src/scripts/utils/strings.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.splitByAndKeep = void 0;
/**
 *
 * @param text String to split
 * @param delimiters Single character delimiters.
 */
function splitByAndKeep(text, delimiters) {
    const splitString = [];
    let currentToken = [];
    const delimiterSet = new Set(delimiters);
    for (const char of text) {
        if (delimiterSet.has(char)) {
            if (currentToken.length > 0) {
                splitString.push(currentToken.join(""));
            }
            splitString.push(char);
            currentToken = [];
        }
        else {
            currentToken.push(char);
        }
    }
    if (currentToken.length > 0) {
        splitString.push(currentToken.join(""));
    }
    return splitString;
}
exports.splitByAndKeep = splitByAndKeep;


/***/ }),

/***/ "./src/scripts/utils/url-handler.ts":
/*!******************************************!*\
  !*** ./src/scripts/utils/url-handler.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.loadCustomThemeFromUrl = void 0;
const Misc = __importStar(__webpack_require__(/*! ./misc */ "./src/scripts/utils/misc.ts"));
const config_1 = __importStar(__webpack_require__(/*! ../config */ "./src/scripts/config.ts")), UpdateConfig = config_1;
const Notifications = __importStar(__webpack_require__(/*! ../elements/notifications */ "./src/scripts/elements/notifications.ts"));
function loadCustomThemeFromUrl() {
    var _a;
    const getValue = Misc.findGetParameter("customTheme");
    if (getValue === null)
        return;
    const urlEncoded = getValue.split(",");
    let base64decoded = null;
    try {
        base64decoded = JSON.parse((_a = atob(getValue)) !== null && _a !== void 0 ? _a : "");
    }
    catch (e) {
        //
    }
    let colorArray = [];
    if (Array.isArray(urlEncoded) && urlEncoded.length === 9) {
        colorArray = urlEncoded;
    }
    else if (Array.isArray(base64decoded) && base64decoded.length === 9) {
        colorArray = base64decoded;
    }
    if (colorArray.length === 0) {
        return Notifications.add("Invalid custom theme ", 0);
    }
    const oldCustomTheme = config_1.default.customTheme;
    const oldCustomThemeColors = config_1.default.customThemeColors;
    try {
        UpdateConfig.setCustomThemeColors(colorArray);
        Notifications.add("Custom theme applied", 1);
        if (!config_1.default.customTheme)
            UpdateConfig.setCustomTheme(true);
    }
    catch (e) {
        Notifications.add("Something went wrong. Reverting to previous state.", 0);
        console.error(e);
        UpdateConfig.setCustomTheme(oldCustomTheme);
        UpdateConfig.setCustomThemeColors(oldCustomThemeColors);
    }
}
exports.loadCustomThemeFromUrl = loadCustomThemeFromUrl;


/***/ }),

/***/ "./src/scripts/version.ts":
/*!********************************!*\
  !*** ./src/scripts/version.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CLIENT_VERSION = void 0;
exports.CLIENT_VERSION = "DEVELOPMENT-CLIENT";
$(document.body).on("click", ".version", (e) => {
    if (e.shiftKey) {
        alert(exports.CLIENT_VERSION);
    }
});


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = __webpack_modules__;
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/chunk loaded */
/******/ 	(() => {
/******/ 		var deferred = [];
/******/ 		__webpack_require__.O = (result, chunkIds, fn, priority) => {
/******/ 			if(chunkIds) {
/******/ 				priority = priority || 0;
/******/ 				for(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];
/******/ 				deferred[i] = [chunkIds, fn, priority];
/******/ 				return;
/******/ 			}
/******/ 			var notFulfilled = Infinity;
/******/ 			for (var i = 0; i < deferred.length; i++) {
/******/ 				var [chunkIds, fn, priority] = deferred[i];
/******/ 				var fulfilled = true;
/******/ 				for (var j = 0; j < chunkIds.length; j++) {
/******/ 					if ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {
/******/ 						chunkIds.splice(j--, 1);
/******/ 					} else {
/******/ 						fulfilled = false;
/******/ 						if(priority < notFulfilled) notFulfilled = priority;
/******/ 					}
/******/ 				}
/******/ 				if(fulfilled) {
/******/ 					deferred.splice(i--, 1)
/******/ 					var r = fn();
/******/ 					if (r !== undefined) result = r;
/******/ 				}
/******/ 			}
/******/ 			return result;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/global */
/******/ 	(() => {
/******/ 		__webpack_require__.g = (function() {
/******/ 			if (typeof globalThis === 'object') return globalThis;
/******/ 			try {
/******/ 				return this || new Function('return this')();
/******/ 			} catch (e) {
/******/ 				if (typeof window === 'object') return window;
/******/ 			}
/******/ 		})();
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/jsonp chunk loading */
/******/ 	(() => {
/******/ 		// no baseURI
/******/ 		
/******/ 		// object to store loaded and loading chunks
/******/ 		// undefined = chunk not loaded, null = chunk preloaded/prefetched
/******/ 		// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded
/******/ 		var installedChunks = {
/******/ 			"monkeytype": 0
/******/ 		};
/******/ 		
/******/ 		// no chunk on demand loading
/******/ 		
/******/ 		// no prefetching
/******/ 		
/******/ 		// no preloaded
/******/ 		
/******/ 		// no HMR
/******/ 		
/******/ 		// no HMR manifest
/******/ 		
/******/ 		__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);
/******/ 		
/******/ 		// install a JSONP callback for chunk loading
/******/ 		var webpackJsonpCallback = (parentChunkLoadingFunction, data) => {
/******/ 			var [chunkIds, moreModules, runtime] = data;
/******/ 			// add "moreModules" to the modules object,
/******/ 			// then flag all "chunkIds" as loaded and fire callback
/******/ 			var moduleId, chunkId, i = 0;
/******/ 			if(chunkIds.some((id) => (installedChunks[id] !== 0))) {
/******/ 				for(moduleId in moreModules) {
/******/ 					if(__webpack_require__.o(moreModules, moduleId)) {
/******/ 						__webpack_require__.m[moduleId] = moreModules[moduleId];
/******/ 					}
/******/ 				}
/******/ 				if(runtime) var result = runtime(__webpack_require__);
/******/ 			}
/******/ 			if(parentChunkLoadingFunction) parentChunkLoadingFunction(data);
/******/ 			for(;i < chunkIds.length; i++) {
/******/ 				chunkId = chunkIds[i];
/******/ 				if(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {
/******/ 					installedChunks[chunkId][0]();
/******/ 				}
/******/ 				installedChunks[chunkId] = 0;
/******/ 			}
/******/ 			return __webpack_require__.O(result);
/******/ 		}
/******/ 		
/******/ 		var chunkLoadingGlobal = self["webpackChunkmonkeytype_frontend"] = self["webpackChunkmonkeytype_frontend"] || [];
/******/ 		chunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));
/******/ 		chunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module depends on other loaded chunks and execution need to be delayed
/******/ 	var __webpack_exports__ = __webpack_require__.O(undefined, ["vendor"], () => (__webpack_require__("./src/scripts/index.ts")))
/******/ 	__webpack_exports__ = __webpack_require__.O(__webpack_exports__);
/******/ 	
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHVDQUF1Qyx3QkFBd0Isa0RBQWtEO0FBQzdILFlBQVksdUNBQXVDLHdCQUF3QixrRUFBa0U7QUFDN0ksWUFBWSxTQUFTO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHVDQUF1Qyx3QkFBd0Isa0RBQWtEO0FBQzdILFlBQVksdUNBQXVDLHdCQUF3QixrRUFBa0U7QUFDN0ksWUFBWSxTQUFTO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHVDQUF1Qyx3QkFBd0Isa0RBQWtEO0FBQzdILFlBQVksdUNBQXVDLHdCQUF3QixrRUFBa0U7QUFDN0ksWUFBWSxTQUFTO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHVDQUF1Qyx3QkFBd0Isa0RBQWtEO0FBQzdILFlBQVksdUNBQXVDLHdCQUF3QixrRUFBa0U7QUFDN0ksWUFBWSxTQUFTO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSx1Q0FBdUMsd0JB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QXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFD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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLE9BQU87QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9EQUFvRDtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0MscUNBQXFDO0FBQzdFLHdDQUF3QyxxQ0FBcUM7QUFDN0U7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0Esd0NBQXdDLHFDQUFxQztBQUM3RSx3Q0FBd0MscUNBQXFDO0FBQzdFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHdDQUF3QyxxQ0FBcUM7QUFDN0Usd0NBQXdDLHFDQUFxQztBQUM3RTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLHFDQUFxQztBQUM3RSx3Q0FBd0Msc0NBQXNDO0FBQzlFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHdDQUF3QyxxQ0FBcUM7QUFDN0Usd0NBQXdDLHNDQUFzQztBQUM5RTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSx3Q0FBd0MscUNBQXFDO0FBQzdFLHdDQUF3QyxzQ0FBc0M7QUFDOUU7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0Esd0NBQXdDLHFDQUFxQztBQUM3RSx3Q0FBd0Msc0NBQXNDO0FBQzlFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHdDQUF3QyxxQ0FBcUM7QUFDN0Usd0NBQXdDLHNDQUFzQztBQUM5RTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSx3Q0FBd0MscUNBQXFDO0FBQzdFLHdDQUF3QyxzQ0FBc0M7QUFDOUU7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxxQ0FBcUM7QUFDN0Usd0NBQXdDLHNDQUFzQztBQUM5RTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSx3Q0FBd0MscUNBQXFDO0FBQzdFLHdDQUF3QyxzQ0FBc0M7QUFDOUU7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0Esd0NBQXdDLHFDQUFxQztBQUM3RSx3Q0FBd0Msc0NBQXNDO0FBQzlFO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHdDQUF3QyxxQ0FBcUM7QUFDN0Usd0NB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QUFDVDtBQUNBO0FBQ0E7QUFDQSxJQUFJLGtDQUFrQztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnRkFBZ0YsUUFBUTtBQUN4RjtBQUNBO0FBQ0E7QUFDQSxnRkFBZ0YsUUFBUTtBQUN4RjtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksb0NBQW9DO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLO0FBQ0wsQ0FBQztBQUNELDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSwwQkFBMEI7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCLHFCQUFxQjtBQUNyQjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQSxJQUFJLGVBQWU7QUFDbkI7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7Ozs7Ozs7Ozs7O0FDdnNHWTtBQUNiO0FBQ0E7QUFDQSxtQ0FBbUMsb0NBQW9DLGdCQUFnQjtBQUN2RixDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLDBDQUEwQyw0QkFBNEI7QUFDdEUsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELFlBQVksR0FBRyxxQ0FBcUM7QUFDcEQscUNBQXFDLG1CQUFPLENBQUMsc0ZBQWlDO0FBQzlFLDhCQUE4QixtQkFBTyxDQUFDLDBDQUFXO0FBQ2pELDJCQUEyQixtQkFBTyxDQUFDLGtEQUFlO0FBQ2xELHNDQUFzQyxtQkFBTyxDQUFDLHdFQUFxQjtBQUNuRSw0QkFBNEIsbUJBQU8sQ0FBQyxzREFBaUI7QUFDckQsd0JBQXdCLG1CQUFPLENBQUMsa0NBQU87QUFDdkMsbUNBQW1DLG1CQUFPLENBQUMsMEVBQTJCO0FBQ3RFLHlDQUF5QyxtQkFBTyxDQUFDLDhGQUFxQztBQUN0RixvQ0FBb0MsbUJBQU8sQ0FBQywwRUFBMkI7QUFDdkUsbUJBQW1CLG1CQUFPLENBQUMsOENBQWE7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRCxLQUFLO0FBQ3JEO0FBQ0E7QUFDQSw4Q0FBOEMsS0FBSztBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRCxLQUFLO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBLDJEQUEyRCxPQUFPLElBQUksU0FBUyxPQUFPLFlBQVk7QUFDbEc7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDJDQUEyQyxzQkFBc0I7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscURBQXFEO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EscURBQXFELFNBQVM7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0Q7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksWUFBWTtBQUNoQjtBQUNBO0FBQ0E7QUFDQSxJQUFJLFlBQVk7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxxREFBcUQsZ0VBQWdFO0FBQ3JIO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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UztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzREFBc0Q7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxREFBcUQseUJBQXlCO0FBQzlFLHVEQUF1RCxVQUFVLEdBQUcsMkRBQTJEO0FBQy9IO0FBQ0EsUUFBUSx1Q0FBdUM7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0dBQWdHO0FBQ2hHLHFHQUFxRyxFQUFFLCtDQUErQztBQUN0SjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQsRUFBRTtBQUN6RDtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsNEJBQTRCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxNQUFNO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLGlCQUFpQixNQUFNO0FBQ3ZCLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRCxZQUFZO0FBQ1o7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLENBQUM7Ozs7Ozs7Ozs7O0FDcjVCWTtBQUNiO0FBQ0E7QUFDQSxtQ0FBbUMsb0NBQW9DLGdCQUFnQjtBQUN2RixDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLDBDQUEwQyw0QkFBNEI7QUFDdEUsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsK0RBQStELGlCQUFpQjtBQUM1RztBQUNBLG9DQUFvQyxNQUFNLCtCQUErQixZQUFZO0FBQ3JGLG1DQUFtQyxNQUFNLG1DQUFtQyxZQUFZO0FBQ3hGLGdDQUFnQztBQUNoQztBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsNkNBQTZDO0FBQzdDO0FBQ0EsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELFlBQVksR0FBRyxlQUFlLEdBQUcsa0JBQWtCLEdBQUcsaUJBQWlCO0FBQ3ZFLDBCQUEwQixtQkFBTyxDQUFDLGtEQUFlO0FBQ2pELCtCQUErQixtQkFBTyxDQUFDLDJDQUFRO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQSxlQUFlO0FBQ2YsWUFBWTtBQUNaO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsQ0FBQzs7Ozs7Ozs7Ozs7QUNwRVk7QUFDYjtBQUNBLDZDQUE2QztBQUM3QztBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxZQUFZO0FBQ1osK0JBQStCLG1CQUFPLENBQUMsMkNBQVE7QUFDL0MsWUFBWTtBQUNaO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsQ0FBQzs7Ozs7Ozs7Ozs7QUNmWTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWU7Ozs7Ozs7Ozs7O0FDYkY7QUFDYjtBQUNBO0FBQ0EsbUNBQW1DLG9DQUFvQyxnQkFBZ0I7QUFDdkYsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSwwQ0FBMEMsNEJBQTRCO0FBQ3RFLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLCtEQUErRCxpQkFBaUI7QUFDNUc7QUFDQSxvQ0FBb0MsTUFBTSwrQkFBK0IsWUFBWTtBQUNyRixtQ0FBbUMsTUFBTSxtQ0FBbUMsWUFBWTtBQUN4RixnQ0FBZ0M7QUFDaEM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDZDQUE2QztBQUM3QztBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxZQUFZLEdBQUcsd0JBQXdCLEdBQUcsY0FBYyxHQUFHLDBCQUEwQixHQUFHLDBCQUEwQixHQUFHLDRCQUE0QixHQUFHLDBCQUEwQixHQUFHLHdCQUF3QixHQUFHLGFBQWEsR0FBRyxjQUFjO0FBQzFPLHlDQUF5QyxtQkFBTyxDQUFDLDRFQUE0QjtBQUM3RSw4QkFBOEIsbUJBQU8sQ0FBQywwQ0FBVztBQUNqRCwyQkFBMkIsbUJBQU8sQ0FBQyxzRkFBaUM7QUFDcEUsMEJBQTBCLG1CQUFPLENBQUMsa0RBQWU7QUFDakQsd0JBQXdCLG1CQUFPLENBQUMsa0NBQU87QUFDdkMsNEJBQTRCLG1CQUFPLENBQUMsb0RBQWdCO0FBQ3BELG1DQUFtQyxtQkFBTyxDQUFDLGtGQUErQjtBQUMxRSxzQ0FBc0MsbUJBQU8sQ0FBQyx3RkFBa0M7QUFDaEYsaUNBQWlDLG1CQUFPLENBQUMsd0VBQTBCO0FBQ25FLG1DQUFtQyxtQkFBTyxDQUFDLDBFQUEyQjtBQUN0RSwrQ0FBK0MsbUJBQU8sQ0FBQyxvR0FBd0M7QUFDL0YsaUNBQWlDLG1CQUFPLENBQUMsOEVBQTZCO0FBQ3RFLGdDQUFnQyxtQkFBTyxDQUFDLGtFQUF1QjtBQUMvRCxrQ0FBa0MsbUJBQU8sQ0FBQyx3RUFBMEI7QUFDcEUsK0JBQStCLG1CQUFPLENBQUMsMkNBQVE7QUFDL0MsbUJBQW1CLG1CQUFPLENBQUMsOENBQWE7QUFDeEMsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBLFFBQVEsMEJBQTZCO0FBQ3JDLFFBQVEseUJBQTRCO0FBQ3BDLFFBQVEsdUJBQTBCO0FBQ2xDLFFBQVEsMEJBQTZCO0FBQ3JDO0FBQ0EsU0FBUztBQUNULFFBQVEsMEJBQTZCO0FBQ3JDLFFBQVEsNEJBQStCO0FBQ3ZDLFFBQVEsZ0NBQW1DO0FBQzNDLFFBQVEsMEJBQTZCO0FBQ3JDLFFBQVEseUJBQTRCO0FBQ3BDO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULFFBQVEsMkJBQThCO0FBQ3RDLFFBQVEsMkJBQThCO0FBQ3RDLFFBQVEsZ0NBQW1DO0FBQzNDLFFBQVEsMEJBQTZCO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxRQUFRLDBCQUE2QjtBQUNyQztBQUNBLFNBQVM7QUFDVCxRQUFRLDBCQUE2QjtBQUNyQyxRQUFRLGdDQUFtQztBQUMzQyxRQUFRLDZCQUFnQztBQUN4QztBQUNBO0FBQ0EsU0FBUztBQUNULFFBQVEsNEJBQStCO0FBQ3ZDLFFBQVEsK0JBQWtDO0FBQzFDLFFBQVEsd0JBQTJCO0FBQ25DLFFBQVEsdUJBQTBCO0FBQ2xDLFFBQVEsMkJBQThCO0FBQ3RDLFFBQVEsd0JBQTJCO0FBQ25DLFFBQVEscUNBQXdDO0FBQ2hELFFBQVEsNkJBQWdDO0FBQ3hDLFFBQVEsb0NBQXVDO0FBQy9DLFFBQVEsOEJBQWlDO0FBQ3pDLFFBQVEsNkJBQWdDO0FBQ3hDLFFBQVEsNEJBQStCO0FBQ3ZDLFFBQVEsb0NBQXVDO0FBQy9DLFFBQVEsMkJBQThCO0FBQ3RDLFFBQVEsZ0NBQW1DO0FBQzNDLFFBQVEsOEJBQWlDO0FBQ3pDLFFBQVEsMEJBQTZCO0FBQ3JDLFFBQVEsMEJBQTZCO0FBQ3JDO0FBQ0EsU0FBUztBQUNULFFBQVEsMEJBQTZCO0FBQ3JDLFFBQVEsK0JBQWtDO0FBQzFDO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsUUFBUSwrQkFBa0M7QUFDMUM7QUFDQTtBQUNBLFNBQVM7QUFDVCxRQUFRLDJCQUE4QjtBQUN0QyxRQUFRLHdCQUEyQjtBQUNuQyxRQUFRLDJCQUE4QjtBQUN0QyxRQUFRLHFCQUF3QjtBQUNoQyxRQUFRLHFCQUF3QjtBQUNoQyxRQUFRLHVCQUEwQjtBQUNsQyxRQUFRLCtCQUFrQztBQUMxQyxRQUFRLHVCQUEwQjtBQUNsQyxRQUFRLHFCQUF3QjtBQUNoQyxRQUFRLHVCQUEwQjtBQUNsQyxRQUFRLHVCQUEwQjtBQUNsQyxRQUFRLHdCQUEyQjtBQUNuQyxRQUFRLHlCQUE0QjtBQUNwQyxRQUFRLDZCQUFnQztBQUN4QyxRQUFRLHlCQUE0QjtBQUNwQyxRQUFRLDRCQUErQjtBQUN2QyxRQUFRLDJCQUE4QjtBQUN0QyxRQUFRLHlCQUE0QjtBQUNwQyxRQUFRLHlCQUE0QjtBQUNwQztBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsK0NBQStDO0FBQzVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULFFBQVEsc0NBQXlDO0FBQ2pELFFBQVEsNEJBQStCO0FBQ3ZDLFFBQVEsbUNBQXNDO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1ELFdBQVc7QUFDOUQ7QUFDQSxrREFBa0QsU0FBUztBQUMzRCxVQUFVO0FBQ1Y7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QyxPQUFPLElBQUksMEJBQTBCO0FBQ25GLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0RBQWtELE9BQU8sSUFBSSwwQkFBMEI7QUFDdkY7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsV0FBVyxJQUFJLDhCQUE4QjtBQUMzRiw4Q0FBOEMsV0FBVyxJQUFJLDhCQUE4QjtBQUMzRjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEVBQTBFLFlBQVksZ0JBQWdCLFlBQVksMERBQTBELFlBQVksOEJBQThCLElBQUksK0JBQStCO0FBQ3pQO0FBQ0E7QUFDQSwwRUFBMEUsWUFBWSxnQkFBZ0IsWUFBWSwwREFBMEQsWUFBWSxJQUFJLCtCQUErQjtBQUMzTjtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0RBQW9ELDJEQUEyRCx1QkFBdUIsc0RBQXNELGdCQUFnQiw2QkFBNkI7QUFDek8sNkJBQTZCLElBQUksc0RBQXNEO0FBQ3ZGLGFBQWE7QUFDYjtBQUNBLHlGQUF5RixZQUFZLCtDQUErQztBQUNwSixrRkFBa0Y7QUFDbEYsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQSx1REFBdUQsd0JBQXdCO0FBQy9FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsT0FBTztBQUM3QztBQUNBOztBQUVBLHFDQUFxQyxRQUFRO0FBQzdDLHVDQUF1QywyQkFBMkIsWUFBWSxXQUFXO0FBQ3pGLCtCQUErQixTQUFTO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLFdBQVc7QUFDbkQ7QUFDQSwrQkFBK0IsWUFBWTtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQSxzQ0FBc0MsVUFBVTtBQUNoRDtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMsVUFBVTtBQUNwRCxvREFBb0QsVUFBVTtBQUM5RDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0Esb0RBQW9ELFVBQVU7QUFDOUQ7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLHFEQUFxRCxjQUFjO0FBQ25FO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCxZQUFZO0FBQ1o7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLENBQUM7Ozs7Ozs7Ozs7O0FDeG1CWTtBQUNiO0FBQ0E7QUFDQSxtQ0FBbUMsb0NBQW9DLGdCQUFnQjtBQUN2RixDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLDBDQUEwQyw0QkFBNEI7QUFDdEUsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsK0RBQStELGlCQUFpQjtBQUM1RztBQUNBLG9DQUFvQyxNQUFNLCtCQUErQixZQUFZO0FBQ3JGLG1DQUFtQyxNQUFNLG1DQUFtQyxZQUFZO0FBQ3hGLGdDQUFnQztBQUNoQztBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsNkNBQTZDO0FBQzdDO0FBQ0EsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELFlBQVk7QUFDWixpQ0FBaUMsbUJBQU8sQ0FBQywwQ0FBVztBQUNwRCwrQkFBK0IsbUJBQU8sQ0FBQyw0REFBb0I7QUFDM0QsNEJBQTRCLG1CQUFPLENBQUMsc0RBQWlCO0FBQ3JELG1DQUFtQyxtQkFBTyxDQUFDLG9GQUFnQztBQUMzRSxnQ0FBZ0MsbUJBQU8sQ0FBQyw4REFBcUI7QUFDN0QsK0JBQStCLG1CQUFPLENBQUMsNERBQW9CO0FBQzNELDRCQUE0QixtQkFBTyxDQUFDLG9EQUFnQjtBQUNwRCwrQkFBK0IsbUJBQU8sQ0FBQywyQ0FBUTtBQUMvQyxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLENBQUM7Ozs7Ozs7Ozs7O0FDekRZO0FBQ2I7QUFDQTtBQUNBLG1DQUFtQyxvQ0FBb0MsZ0JBQWdCO0FBQ3ZGLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsMENBQTBDLDRCQUE0QjtBQUN0RSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QiwrREFBK0QsaUJBQWlCO0FBQzVHO0FBQ0Esb0NBQW9DLE1BQU0sK0JBQStCLFlBQVk7QUFDckYsbUNBQW1DLE1BQU0sbUNBQW1DLFlBQVk7QUFDeEYsZ0NBQWdDO0FBQ2hDO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSw2Q0FBNkM7QUFDN0M7QUFDQSw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsWUFBWSxHQUFHLFlBQVk7QUFDM0IsOEJBQThCLG1CQUFPLENBQUMsMENBQVE7QUFDOUMsNEJBQTRCLG1CQUFPLENBQUMsNERBQW9CO0FBQ3hELG1DQUFtQyxtQkFBTyxDQUFDLDBFQUEyQjtBQUN0RSxpQ0FBaUMsbUJBQU8sQ0FBQyxvRUFBaUI7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvRUFBb0U7QUFDcEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixTQUFTO0FBQzVCO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLFNBQVM7QUFDdkIsY0FBYyxvRUFBb0U7QUFDbEYsY0FBYyxxRUFBcUU7QUFDbkYsY0FBYztBQUNkO0FBQ0EsbUZBQW1GO0FBQ25GO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsS0FBSztBQUNMO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUFBaUUsdUJBQXVCO0FBQ3hGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7Ozs7Ozs7Ozs7O0FDM0pZO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsWUFBWTtBQUMvQixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsWUFBWTtBQUNuQztBQUNBLFNBQVM7QUFDVDtBQUNBLENBQUM7Ozs7Ozs7Ozs7O0FDZlk7QUFDYjtBQUNBO0FBQ0EsbUNBQW1DLG9DQUFvQyxnQkFBZ0I7QUFDdkYsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSwwQ0FBMEMsNEJBQTRCO0FBQ3RFLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxZQUFZLEdBQUcsWUFBWTtBQUMzQixrQ0FBa0MsbUJBQU8sQ0FBQywwQ0FBVztBQUNyRCxtQ0FBbUMsbUJBQU8sQ0FBQyxvRkFBZ0M7QUFDM0UsK0JBQStCLG1CQUFPLENBQUMsNERBQW9CO0FBQzNELG1DQUFtQyxtQkFBTyxDQUFDLDBFQUEyQjtBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLE9BQU8sTUFBTSx1QkFBdUI7QUFDekQ7QUFDQTtBQUNBLHFCQUFxQixTQUFTLFFBQVEseUJBQXlCO0FBQy9EO0FBQ0E7QUFDQSxxQkFBcUIsU0FBUyxRQUFRLHlCQUF5QjtBQUMvRDtBQUNBO0FBQ0Esa0JBQWtCLFFBQVEsSUFBSSxTQUFTLE1BQU0sUUFBUTtBQUNyRDtBQUNBO0FBQ0Esa0JBQWtCLFNBQVMsTUFBTSxRQUFRO0FBQ3pDO0FBQ0E7QUFDQSxrQkFBa0IsUUFBUTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLFlBQVk7QUFDbkM7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7Ozs7Ozs7Ozs7QUMxSlk7QUFDYjtBQUNBO0FBQ0EsbUNBQW1DLG9DQUFvQyxnQkFBZ0I7QUFDdkYsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSwwQ0FBMEMsNEJBQTRCO0FBQ3RFLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxpQkFBaUIsR0FBRyxZQUFZLEdBQUcsWUFBWTtBQUMvQyxnQ0FBZ0MsbUJBQU8sQ0FBQyw4REFBcUI7QUFDN0QsbUNBQW1DLG1CQUFPLENBQUMsb0ZBQWdDO0FBQzNFLCtCQUErQixtQkFBTyxDQUFDLDREQUFvQjtBQUMzRCx5Q0FBeUMsbUJBQU8sQ0FBQyw4RkFBcUM7QUFDdEYsOEJBQThCLG1CQUFPLENBQUMsMENBQVc7QUFDakQsMEJBQTBCLG1CQUFPLENBQUMsa0RBQWU7QUFDakQscUNBQXFDLG1CQUFPLENBQUMsc0VBQXFCO0FBQ2xFLG1DQUFtQyxtQkFBTyxDQUFDLDBFQUEyQjtBQUN0RSxxQ0FBcUMsbUJBQU8sQ0FBQyxzRUFBcUI7QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsT0FBTztBQUN4QixpQkFBaUIsT0FBTztBQUN4QjtBQUNBO0FBQ0EsaUJBQWlCLE9BQU87QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixZQUFZO0FBQ25DO0FBQ0E7QUFDQSxpQkFBaUIsT0FBTztBQUN4QixpQkFBaUIsT0FBTztBQUN4QixpQkFBaUIsT0FBTztBQUN4QixpQkFBaUIsT0FBTztBQUN4QixTQUFTO0FBQ1Q7QUFDQTtBQUNBLGFBQWEsT0FBTztBQUNwQixLQUFLO0FBQ0w7QUFDQSxZQUFZO0FBQ1osS0FBSyxPQUFPO0FBQ1o7QUFDQSxhQUFhLE9BQU87QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsT0FBTztBQUNwQixpQ0FBaUMsT0FBTztBQUN4QztBQUNBO0FBQ0E7QUFDQSxhQUFhLE9BQU87QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLE9BQU87QUFDcEI7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCxLQUFLLE9BQU87QUFDWixhQUFhLE9BQU87QUFDcEIsYUFBYSxPQUFPO0FBQ3BCO0FBQ0E7QUFDQSxhQUFhLE9BQU87QUFDcEI7QUFDQSxDQUFDO0FBQ0QsS0FBSyxPQUFPO0FBQ1o7QUFDQSxhQUFhLE9BQU87QUFDcEI7QUFDQSxDQUFDO0FBQ0QsS0FBSyxPQUFPO0FBQ1osU0FBUyxPQUFPO0FBQ2hCLENBQUM7QUFDRCxLQUFLLE9BQU87QUFDWixTQUFTLE9BQU87QUFDaEIsQ0FBQztBQUNELEtBQUssT0FBTztBQUNaO0FBQ0EsQ0FBQztBQUNELEtBQUssT0FBTztBQUNaO0FBQ0EsQ0FBQztBQUNEO0FBQ0Esb0JBQW9CLE9BQU87QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsT0FBTztBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLE9BQU87QUFDNUMscUNBQXFDLE9BQU87QUFDNUMsb0NBQW9DLE9BQU87QUFDM0Msb0NBQW9DLE9BQU87QUFDM0MsYUFBYSxPQUFPO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLE9BQU87QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsT0FBTztBQUNsQztBQUNBLENBQUM7QUFDRCwyQkFBMkIsT0FBTztBQUNsQztBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7Ozs7Ozs7Ozs7O0FDN0xZO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsWUFBWTtBQUNuQztBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7Ozs7Ozs7Ozs7O0FDOURZO0FBQ2I7QUFDQTtBQUNBLG1DQUFtQyxvQ0FBb0MsZ0JBQWdCO0FBQ3ZGLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsMENBQTBDLDRCQUE0QjtBQUN0RSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsWUFBWSxHQUFHLFlBQVk7QUFDM0Isa0NBQWtDLG1CQUFPLENBQUMsMENBQVc7QUFDckQsbUNBQW1DLG1CQUFPLENBQUMsb0ZBQWdDO0FBQzNFLCtCQUErQixtQkFBTyxDQUFDLDREQUFvQjtBQUMzRCxtQ0FBbUMsbUJBQU8sQ0FBQywwRUFBMkI7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLFlBQVk7QUFDbkM7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOzs7Ozs7Ozs7OztBQzlGWTtBQUNiO0FBQ0E7QUFDQSxtQ0FBbUMsb0NBQW9DLGdCQUFnQjtBQUN2RixDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLDBDQUEwQyw0QkFBNEI7QUFDdEUsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsK0RBQStELGlCQUFpQjtBQUM1RztBQUNBLG9DQUFvQyxNQUFNLCtCQUErQixZQUFZO0FBQ3JGLG1DQUFtQyxNQUFNLG1DQUFtQyxZQUFZO0FBQ3hGLGdDQUFnQztBQUNoQztBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsNkNBQTZDO0FBQzdDO0FBQ0EsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELFlBQVk7QUFDWiw4QkFBOEIsbUJBQU8sQ0FBQywwQ0FBUTtBQUM5Qyx3QkFBd0IsbUJBQU8sQ0FBQyxrQ0FBTztBQUN2Qyw0QkFBNEIsbUJBQU8sQ0FBQywwQ0FBVztBQUMvQyw0QkFBNEIsbUJBQU8sQ0FBQyw0REFBb0I7QUFDeEQsOEJBQThCLG1CQUFPLENBQUMsMERBQW1CO0FBQ3pELG1DQUFtQyxtQkFBTyxDQUFDLDBFQUEyQjtBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLFlBQVk7QUFDbkM7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7Ozs7Ozs7Ozs7QUNyTFk7QUFDYjtBQUNBO0FBQ0EsbUNBQW1DLG9DQUFvQyxnQkFBZ0I7QUFDdkYsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSwwQ0FBMEMsNEJBQTRCO0FBQ3RFLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLCtEQUErRCxpQkFBaUI7QUFDNUc7QUFDQSxvQ0FBb0MsTUFBTSwrQkFBK0IsWUFBWTtBQUNyRixtQ0FBbUMsTUFBTSxtQ0FBbUMsWUFBWTtBQUN4RixnQ0FBZ0M7QUFDaEM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDZDQUE2QztBQUM3QztBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxZQUFZO0FBQ1osOEJBQThCLG1CQUFPLENBQUMsMENBQVE7QUFDOUMsbUNBQW1DLG1CQUFPLENBQUMsMEVBQTJCO0FBQ3RFLHdCQUF3QixtQkFBTyxDQUFDLGtDQUFPO0FBQ3ZDLG1DQUFtQyxtQkFBTyxDQUFDLDBFQUEyQjtBQUN0RSw0QkFBNEIsbUJBQU8sQ0FBQyw0REFBb0I7QUFDeEQsOEJBQThCLG1CQUFPLENBQUMsMERBQW1CO0FBQ3pELHFDQUFxQyxtQkFBTyxDQUFDLHNFQUFxQjtBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLFlBQVk7QUFDbkM7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQztBQUNwQyxxQ0FBcUM7QUFDckMsc0NBQXNDLFlBQVk7QUFDbEQsbUNBQW1DLFNBQVM7QUFDNUMscUNBQXFDLFlBQVk7QUFDakQ7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOzs7Ozs7Ozs7OztBQzVOWTtBQUNiO0FBQ0E7QUFDQSxtQ0FBbUMsb0NBQW9DLGdCQUFnQjtBQUN2RixDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLDBDQUEwQyw0QkFBNEI7QUFDdEUsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELFlBQVk7QUFDWixrQ0FBa0MsbUJBQU8sQ0FBQywwQ0FBVztBQUNyRCxtQ0FBbUMsbUJBQU8sQ0FBQywwRUFBMkI7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixZQUFZO0FBQ25DO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsWUFBWTtBQUNuQztBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7Ozs7Ozs7Ozs7O0FDeEVZO0FBQ2I7QUFDQTtBQUNBLG1DQUFtQyxvQ0FBb0MsZ0JBQWdCO0FBQ3ZGLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsMENBQTBDLDRCQUE0QjtBQUN0RSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QztBQUM3QztBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxjQUFjO0FBQ2QsK0JBQStCLG1CQUFPLENBQUMsNERBQW9CO0FBQzNELGlDQUFpQyxtQkFBTyxDQUFDLDBDQUFXO0FBQ3BELGtDQUFrQyxtQkFBTyxDQUFDLDBDQUFXO0FBQ3JELG1DQUFtQyxtQkFBTyxDQUFDLG9GQUFnQztBQUMzRSwyQ0FBMkMsbUJBQU8sQ0FBQyxvRkFBNEI7QUFDL0UsNkNBQTZDLG1CQUFPLENBQUMsd0ZBQThCO0FBQ25GLHNDQUFzQyxtQkFBTyxDQUFDLHdFQUFzQjtBQUNwRSxxQ0FBcUMsbUJBQU8sQ0FBQyxzRUFBcUI7QUFDbEUsaUNBQWlDLG1CQUFPLENBQUMsOEVBQTZCO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxzQkFBc0I7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0Isc0JBQXNCO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLHNCQUFzQjtBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4Qyx1QkFBdUI7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsNkJBQTZCO0FBQzNFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixZQUFZO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7Ozs7Ozs7Ozs7QUN0TFk7QUFDYjtBQUNBO0FBQ0EsbUNBQW1DLG9DQUFvQyxnQkFBZ0I7QUFDdkYsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSwwQ0FBMEMsNEJBQTRCO0FBQ3RFLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDO0FBQzdDO0FBQ0EsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHdCQUF3QixtQkFBTyxDQUFDLGtDQUFPO0FBQ3ZDLGlDQUFpQyxtQkFBTyxDQUFDLG9FQUFpQjtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMseUNBQXlDO0FBQ3ZEO0FBQ0EsWUFBWTtBQUNaO0FBQ0EsOEJBQThCLDRCQUE0QjtBQUMxRDtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0EsOEJBQThCLDRDQUE0QztBQUMxRTtBQUNBLGNBQWMsY0FBYztBQUM1QixjQUFjLG1EQUFtRDtBQUNqRSxjQUFjLHFEQUFxRDtBQUNuRSxjQUFjLGtEQUFrRDtBQUNoRSxjQUFjLFNBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDLE1BQU07QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsWUFBWTtBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQzs7Ozs7Ozs7Ozs7QUN0SFk7QUFDYjtBQUNBO0FBQ0EsbUNBQW1DLG9DQUFvQyxnQkFBZ0I7QUFDdkYsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSwwQ0FBMEMsNEJBQTRCO0FBQ3RFLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLCtEQUErRCxpQkFBaUI7QUFDNUc7QUFDQSxvQ0FBb0MsTUFBTSwrQkFBK0IsWUFBWTtBQUNyRixtQ0FBbUMsTUFBTSxtQ0FBbUMsWUFBWTtBQUN4RixnQ0FBZ0M7QUFDaEM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDZDQUE2QztBQUM3QztBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxZQUFZLEdBQUcsWUFBWTtBQUMzQiw4QkFBOEIsbUJBQU8sQ0FBQywwQ0FBUTtBQUM5Qyw0QkFBNEIsbUJBQU8sQ0FBQyw0REFBb0I7QUFDeEQsbUNBQW1DLG1CQUFPLENBQUMsMEVBQTJCO0FBQ3RFLGlDQUFpQyxtQkFBTyxDQUFDLG9FQUFpQjtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLE1BQU0sVUFBVSxVQUFVO0FBQ3pELGlDQUFpQyxXQUFXO0FBQzVDLHdFQUF3RSxhQUFhO0FBQ3JGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLG9DQUFvQyxrQkFBa0Isa0JBQWtCO0FBQ3ZHLDRDQUE0QyxlQUFlO0FBQzNELGlEQUFpRCxzRUFBc0U7QUFDdkg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0Esd0RBQXdELE1BQU07QUFDOUQsc0NBQXNDLE1BQU07QUFDNUM7QUFDQSwwQ0FBMEMsTUFBTTtBQUNoRDtBQUNBO0FBQ0EsMENBQTBDLE1BQU07QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLFlBQVk7QUFDdkM7QUFDQSxLQUFLO0FBQ0w7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0Esc0NBQXNDLE1BQU07QUFDNUMsc0NBQXNDLE1BQU07QUFDNUMsc0NBQXNDLE1BQU07QUFDNUMsc0NBQXNDLE1BQU07QUFDNUMsc0NBQXNDLE1BQU07QUFDNUM7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQsTUFBTTtBQUM3RCx5REFBeUQsTUFBTTtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxzQ0FBc0MsTUFBTTtBQUM1QyxzQ0FBc0MsTUFBTTtBQUM1QyxzQ0FBc0MsTUFBTTtBQUM1QztBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0Esc0NBQXNDLE1BQU07QUFDNUMsc0NBQXNDLE1BQU07QUFDNUMsc0NBQXNDLE1BQU07QUFDNUMsQ0FBQzs7Ozs7Ozs7Ozs7QUNyTlk7QUFDYjtBQUNBO0FBQ0EsbUNBQW1DLG9DQUFvQyxnQkFBZ0I7QUFDdkYsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSwwQ0FBMEMsNEJBQTRCO0FBQ3RFLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLCtEQUErRCxpQkFBaUI7QUFDNUc7QUFDQSxvQ0FBb0MsTUFBTSwrQkFBK0IsWUFBWTtBQUNyRixtQ0FBbUMsTUFBTSxtQ0FBbUMsWUFBWTtBQUN4RixnQ0FBZ0M7QUFDaEM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDZDQUE2QztBQUM3QztBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCx1QkFBdUIsR0FBRyxZQUFZLEdBQUcscUJBQXFCO0FBQzlELDhCQUE4QixtQkFBTyxDQUFDLDBDQUFRO0FBQzlDLHdCQUF3QixtQkFBTyxDQUFDLGtDQUFPO0FBQ3ZDLCtCQUErQixtQkFBTyxDQUFDLDREQUFvQjtBQUMzRCw0QkFBNEIsbUJBQU8sQ0FBQyw0REFBb0I7QUFDeEQsbUNBQW1DLG1CQUFPLENBQUMsMEVBQTJCO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixZQUFZO0FBQ2hDLDBDQUEwQyxFQUFFO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsWUFBWTtBQUNuQztBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7Ozs7Ozs7Ozs7QUM3T1k7QUFDYjtBQUNBO0FBQ0EsbUNBQW1DLG9DQUFvQyxnQkFBZ0I7QUFDdkYsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSwwQ0FBMEMsNEJBQTRCO0FBQ3RFLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLCtEQUErRCxpQkFBaUI7QUFDNUc7QUFDQSxvQ0FBb0MsTUFBTSwrQkFBK0IsWUFBWTtBQUNyRixtQ0FBbUMsTUFBTSxtQ0FBbUMsWUFBWTtBQUN4RixnQ0FBZ0M7QUFDaEM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDZDQUE2QztBQUM3QztBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxZQUFZLEdBQUcsWUFBWTtBQUMzQiw4QkFBOEIsbUJBQU8sQ0FBQywwQ0FBUTtBQUM5QyxpQ0FBaUMsbUJBQU8sQ0FBQywwQ0FBVztBQUNwRCwrQkFBK0IsbUJBQU8sQ0FBQyw0REFBb0I7QUFDM0QsNEJBQTRCLG1CQUFPLENBQUMsNERBQW9CO0FBQ3hELG1DQUFtQyxtQkFBTyxDQUFDLDBFQUEyQjtBQUN0RSw0Q0FBNEMsbUJBQU8sQ0FBQyx3RkFBa0M7QUFDdEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiw2Q0FBNkM7QUFDakU7QUFDQSxvQkFBb0IsU0FBUztBQUM3QjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixZQUFZO0FBQ3ZDO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsS0FBSztBQUNMO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsS0FBSztBQUNMO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwREFBMEQscUJBQXFCO0FBQy9FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQzs7Ozs7Ozs7Ozs7QUM5Slk7QUFDYjtBQUNBO0FBQ0EsbUNBQW1DLG9DQUFvQyxnQkFBZ0I7QUFDdkYsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSwwQ0FBMEMsNEJBQTRCO0FBQ3RFLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLCtEQUErRCxpQkFBaUI7QUFDNUc7QUFDQSxvQ0FBb0MsTUFBTSwrQkFBK0IsWUFBWTtBQUNyRixtQ0FBbUMsTUFBTSxtQ0FBbUMsWUFBWTtBQUN4RixnQ0FBZ0M7QUFDaEM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDZDQUE2QztBQUM3QztBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxhQUFhLEdBQUcsWUFBWSxHQUFHLFlBQVksR0FBRyxxQkFBcUIsR0FBRyxrQkFBa0I7QUFDeEYsNEJBQTRCLG1CQUFPLENBQUMsc0RBQWlCO0FBQ3JELDhCQUE4QixtQkFBTyxDQUFDLDBDQUFXO0FBQ2pELHdCQUF3QixtQkFBTyxDQUFDLGtDQUFPO0FBQ3ZDLG1DQUFtQyxtQkFBTyxDQUFDLG9GQUFnQztBQUMzRSxtQ0FBbUMsbUJBQU8sQ0FBQywwRUFBMkI7QUFDdEUsc0NBQXNDLG1CQUFPLENBQUMsd0VBQXNCO0FBQ3BFLHVDQUF1QyxtQkFBTyxDQUFDLDBFQUF1QjtBQUN0RSxzQ0FBc0MsbUJBQU8sQ0FBQyx3RUFBc0I7QUFDcEUseUJBQXlCLG1CQUFPLENBQUMsc0VBQXlCO0FBQzFELG1CQUFtQixtQkFBTyxDQUFDLDBEQUFtQjtBQUM5QyxrQkFBa0IsbUJBQU8sQ0FBQyx3REFBa0I7QUFDNUMsNENBQTRDLG1CQUFPLENBQUMsd0ZBQWtDO0FBQ3RGLG1CQUFtQixtQkFBTyxDQUFDLDhDQUFhO0FBQ3hDLGtCQUFrQjtBQUNsQjtBQUNBLElBQUksa0JBQWtCO0FBQ3RCO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUVBQW1FLEdBQUc7QUFDdEU7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULDREQUE0RCxLQUFLO0FBQ2pFLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsU0FBUztBQUMzQztBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQSxRQUFRLG1EQUFtRDtBQUMzRCxxQ0FBcUMsd0JBQXdCO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLFNBQVM7QUFDekI7QUFDQSxzQkFBc0IsWUFBWSxFQUFFLFVBQVUsRUFBRSxhQUFhO0FBQzdELFNBQVM7QUFDVCxnQkFBZ0Isc0NBQXNDO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMscUJBQXFCLFVBQVUsb0JBQW9CO0FBQ3RGLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixZQUFZO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsS0FBSztBQUNMO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxrQkFBa0I7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOzs7Ozs7Ozs7OztBQ2xTWTtBQUNiO0FBQ0E7QUFDQSxtQ0FBbUMsb0NBQW9DLGdCQUFnQjtBQUN2RixDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLDBDQUEwQyw0QkFBNEI7QUFDdEUsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsK0RBQStELGlCQUFpQjtBQUM1RztBQUNBLG9DQUFvQyxNQUFNLCtCQUErQixZQUFZO0FBQ3JGLG1DQUFtQyxNQUFNLG1DQUFtQyxZQUFZO0FBQ3hGLGdDQUFnQztBQUNoQztBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsNkNBQTZDO0FBQzdDO0FBQ0EsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELFlBQVksR0FBRyxZQUFZO0FBQzNCLDhCQUE4QixtQkFBTyxDQUFDLDBDQUFRO0FBQzlDLDRCQUE0QixtQkFBTyxDQUFDLDREQUFvQjtBQUN4RCxtQ0FBbUMsbUJBQU8sQ0FBQywwRUFBMkI7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixTQUFTLElBQUksNEJBQTRCO0FBQ3RFO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixZQUFZO0FBQ3RDO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0EsS0FBSztBQUNMO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7Ozs7Ozs7Ozs7O0FDL0lZO0FBQ2I7QUFDQTtBQUNBLG1DQUFtQyxvQ0FBb0MsZ0JBQWdCO0FBQ3ZGLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsMENBQTBDLDRCQUE0QjtBQUN0RSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QiwrREFBK0QsaUJBQWlCO0FBQzVHO0FBQ0Esb0NBQW9DLE1BQU0sK0JBQStCLFlBQVk7QUFDckYsbUNBQW1DLE1BQU0sbUNBQW1DLFlBQVk7QUFDeEYsZ0NBQWdDO0FBQ2hDO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSw2Q0FBNkM7QUFDN0M7QUFDQSw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QscUJBQXFCO0FBQ3JCLDhCQUE4QixtQkFBTyxDQUFDLDBDQUFRO0FBQzlDLHdCQUF3QixtQkFBTyxDQUFDLGtDQUFPO0FBQ3ZDLDRCQUE0QixtQkFBTyxDQUFDLDREQUFvQjtBQUN4RCxtQ0FBbUMsbUJBQU8sQ0FBQywwRUFBMkI7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLFlBQVk7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9GQUFvRixRQUFRLElBQUksU0FBUztBQUN6RyxLQUFLO0FBQ0w7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0QsU0FBUztBQUN6RDtBQUNBLG9EQUFvRCxTQUFTO0FBQzdELG9EQUFvRCxTQUFTO0FBQzdEO0FBQ0E7QUFDQSxvREFBb0QsU0FBUztBQUM3RCxvREFBb0QsU0FBUztBQUM3RDtBQUNBLENBQUM7Ozs7Ozs7Ozs7O0FDekpZO0FBQ2I7QUFDQTtBQUNBLG1DQUFtQyxvQ0FBb0MsZ0JBQWdCO0FBQ3ZGLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsMENBQTBDLDRCQUE0QjtBQUN0RSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QiwrREFBK0QsaUJBQWlCO0FBQzVHO0FBQ0Esb0NBQW9DLE1BQU0sK0JBQStCLFlBQVk7QUFDckYsbUNBQW1DLE1BQU0sbUNBQW1DLFlBQVk7QUFDeEYsZ0NBQWdDO0FBQ2hDO0FBQ0EsS0FBSztBQUNMO0FBQ0EsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELFlBQVk7QUFDWixnQ0FBZ0MsbUJBQU8sQ0FBQyw4REFBcUI7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxLQUFLO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7Ozs7Ozs7Ozs7QUM3RVk7QUFDYjtBQUNBO0FBQ0EsbUNBQW1DLG9DQUFvQyxnQkFBZ0I7QUFDdkYsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSwwQ0FBMEMsNEJBQTRCO0FBQ3RFLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLCtEQUErRCxpQkFBaUI7QUFDNUc7QUFDQSxvQ0FBb0MsTUFBTSwrQkFBK0IsWUFBWTtBQUNyRixtQ0FBbUMsTUFBTSxtQ0FBbUMsWUFBWTtBQUN4RixnQ0FBZ0M7QUFDaEM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDZDQUE2QztBQUM3QztBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxZQUFZLEdBQUcsWUFBWTtBQUMzQiw4QkFBOEIsbUJBQU8sQ0FBQywwQ0FBUTtBQUM5Qyx1Q0FBdUMsbUJBQU8sQ0FBQywwRkFBbUM7QUFDbEYsd0JBQXdCLG1CQUFPLENBQUMsa0NBQU87QUFDdkMsa0NBQWtDLG1CQUFPLENBQUMsMENBQVc7QUFDckQsNEJBQTRCLG1CQUFPLENBQUMsNERBQW9CO0FBQ3hELG1DQUFtQyxtQkFBTyxDQUFDLDBFQUEyQjtBQUN0RSw4QkFBOEIsbUJBQU8sQ0FBQywwREFBbUI7QUFDekQsa0NBQWtDLG1CQUFPLENBQUMsd0VBQTBCO0FBQ3BFLGlDQUFpQyxtQkFBTyxDQUFDLHdFQUEwQjtBQUNuRSxnQ0FBZ0MsbUJBQU8sQ0FBQyw4REFBcUI7QUFDN0QscUNBQXFDLG1CQUFPLENBQUMsOEVBQTZCO0FBQzFFLHFDQUFxQyxtQkFBTyxDQUFDLHNFQUFxQjtBQUNsRSxtQkFBbUIsbUJBQU8sQ0FBQyw4Q0FBYTtBQUN4QyxlQUFlLG1CQUFPLENBQUMscUVBQWU7QUFDdEM7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsY0FBYztBQUNyQyw2QkFBNkIsa0JBQWtCO0FBQy9DLHVCQUF1Qiw2QkFBNkI7QUFDcEQsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxrQkFBa0I7QUFDbkQsMkJBQTJCLDZCQUE2QjtBQUN4RCxvQkFBb0I7QUFDcEIsb0JBQW9CO0FBQ3BCO0FBQ0EsbUJBQW1CLGNBQWM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLFdBQVc7QUFDakMsdUJBQXVCLGNBQWM7QUFDckMsNkJBQTZCLGtCQUFrQjtBQUMvQyx1QkFBdUIsNkJBQTZCO0FBQ3BELGdCQUFnQjtBQUNoQixnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLGNBQWM7QUFDdkMsK0JBQStCLGtCQUFrQjtBQUNqRCx5QkFBeUIsNkJBQTZCO0FBQ3RELGtCQUFrQjtBQUNsQixrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLFlBQVk7QUFDbkM7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLFlBQVk7QUFDbkM7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLFlBQVk7QUFDL0I7QUFDQSxLQUFLO0FBQ0w7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixZQUFZO0FBQ25DO0FBQ0EsU0FBUztBQUNUO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNELHdCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0QsdUJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNELDJCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRCw0QkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0QsMEJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNB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O0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsOENBQThDLHVCQUF1QjtBQUNyRTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLDBCQUEwQjtBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSx3QkFBd0I7Ozs7Ozs7Ozs7O0FDMU9YO0FBQ2IsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsK0NBQStDO0FBQ3JFO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEM7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQzs7Ozs7Ozs7Ozs7QUN2VFk7QUFDYjtBQUNB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RCxhQUFhO0FBQ3pFO0FBQ0E7QUFDQSxvREFBb0QsYUFBYTtBQUNqRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRDtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix3QkFBd0I7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkMsS0FBSztBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxzQ0FBc0Msa0JBQWtCLEVBQUUsa0JBQWtCLEVBQUUsaUJBQWlCO0FBQy9GLDBGQUEwRixtQkFBbUI7QUFDN0c7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLFNBQVM7QUFDcEI7QUFDQTtBQUNBO0FBQ0EsV0FBVyxtQkFBbUI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsbUNBQW1DLHlDQUF5QztBQUM1RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpREFBaUQsWUFBWTtBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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QUF3QjtBQUM1RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLDRCQUE0QjtBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLHlCQUF5QjtBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MsdUJBQXVCLEVBQUUsT0FBTyxFQUFFLDZDQUE2QyxFQUFFLE9BQU87QUFDdkk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGlCQUFpQjtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxnQkFBZ0I7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxrREFBa0Q7QUFDMUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsZ0JBQWdCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMsaUVBQWlFLHdCQUF3QjtBQUNySTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixpQkFBaUI7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0Isd0NBQXdDO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxXQUFXO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQiw2QkFBNkI7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDOzs7Ozs7Ozs7OztBQ3orQ1k7QUFDYiw4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VUFDQTs7VUFFQTtVQUNBOzs7OztXQ3pCQTtXQUNBO1dBQ0E7V0FDQTtXQUNBLCtCQUErQix3Q0FBd0M7V0FDdkU7V0FDQTtXQUNBO1dBQ0E7V0FDQSxpQkFBaUIscUJBQXFCO1dBQ3RDO1dBQ0E7V0FDQSxrQkFBa0IscUJBQXFCO1dBQ3ZDO1dBQ0E7V0FDQSxLQUFLO1dBQ0w7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBOzs7OztXQzNCQTtXQUNBO1dBQ0E7V0FDQTtXQUNBLHlDQUF5Qyx3Q0FBd0M7V0FDakY7V0FDQTtXQUNBOzs7OztXQ1BBO1dBQ0E7V0FDQTtXQUNBO1dBQ0EsR0FBRztXQUNIO1dBQ0E7V0FDQSxDQUFDOzs7OztXQ1BEOzs7OztXQ0FBO1dBQ0E7V0FDQTtXQUNBLHVEQUF1RCxpQkFBaUI7V0FDeEU7V0FDQSxnREFBZ0QsYUFBYTtXQUM3RDs7Ozs7V0NOQTs7V0FFQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7O1dBRUE7O1dBRUE7O1dBRUE7O1dBRUE7O1dBRUE7O1dBRUE7O1dBRUE7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0EsTUFBTSxxQkFBcUI7V0FDM0I7V0FDQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQTs7V0FFQTtXQUNBO1dBQ0E7Ozs7O1VFaERBO1VBQ0E7VUFDQTtVQUNBO1VBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3N0eWxlcy9pbmRleC5zY3NzPzg2ZWMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2FjY291bnQvYWxsLXRpbWUtc3RhdHMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2FjY291bnQvbWluaS1yZXN1bHQtY2hhcnQudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2FjY291bnQvcGItdGFibGVzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9hY2NvdW50L3Jlc3VsdC1maWx0ZXJzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9hY2NvdW50L3NpZ24tb3V0LWJ1dHRvbi50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvYXBlL2VuZHBvaW50cy9hcGUta2V5cy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvYXBlL2VuZHBvaW50cy9jb25maWdzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9hcGUvZW5kcG9pbnRzL2luZGV4LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9hcGUvZW5kcG9pbnRzL2xlYWRlcmJvYXJkcy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvYXBlL2VuZHBvaW50cy9wcmVzZXRzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9hcGUvZW5kcG9pbnRzL3BzYXMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2FwZS9lbmRwb2ludHMvcXVvdGVzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9hcGUvZW5kcG9pbnRzL3Jlc3VsdHMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2FwZS9lbmRwb2ludHMvdXNlcnMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2FwZS9pbmRleC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29uZmlnLXZhbGlkYXRpb24udHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbmZpZy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29uc3RhbnRzL2RlZmF1bHQtY29uZmlnLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb25zdGFudHMvZGVmYXVsdC1zbmFwc2hvdC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29uc3RhbnRzL2ZpcmViYXNlLWNvbmZpZy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29udHJvbGxlcnMvYWNjb3VudC1jb250cm9sbGVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb250cm9sbGVycy9hbmFseXRpY3MtY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29udHJvbGxlcnMvY2hhbGxlbmdlLWNvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbnRyb2xsZXJzL2NoYXJ0LWNvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbnRyb2xsZXJzL2lucHV0LWNvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbnRyb2xsZXJzL3BhZ2UtY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29udHJvbGxlcnMvcHJlc2V0LWNvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2NvbnRyb2xsZXJzL3F1b3Rlcy1jb250cm9sbGVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb250cm9sbGVycy9yb3V0ZS1jb250cm9sbGVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb250cm9sbGVycy9zb3VuZC1jb250cm9sbGVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9jb250cm9sbGVycy90YWctY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29udHJvbGxlcnMvdGhlbWUtY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvY29udHJvbGxlcnMvdmVyaWZpY2F0aW9uLWNvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2RiLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9lbGVtZW50cy9hY2NvdW50LWJ1dHRvbi50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvZWxlbWVudHMvY29tbWFuZGxpbmUtbGlzdHMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2VsZW1lbnRzL2NvbW1hbmRsaW5lLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9lbGVtZW50cy9jdXN0b20tYmFja2dyb3VuZC1maWx0ZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2VsZW1lbnRzL2tleW1hcC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvZWxlbWVudHMvbGFzdC0xMC1hdmVyYWdlLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9lbGVtZW50cy9sZWFkZXJib2FyZHMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2VsZW1lbnRzL2xvYWRlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvZWxlbWVudHMvbW9kZXMtbm90aWNlLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9lbGVtZW50cy9tb25rZXktcG93ZXIudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2VsZW1lbnRzL25vdGlmaWNhdGlvbnMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL2VsZW1lbnRzL3BzYS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvZWxlbWVudHMvc2Nyb2xsLXRvLXRvcC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvZWxlbWVudHMvdGhlbWUtY29sb3JzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9lbGVtZW50cy92ZXJzaW9uLWNoZWNrLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9maXJlYmFzZS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL29ic2VydmFibGVzL2NvbmZpZy1ldmVudC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvb2JzZXJ2YWJsZXMvcGFnZS1jaGFuZ2UtZXZlbnQudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL29ic2VydmFibGVzL3Jlc2V0LXJlcXVlc3RlZC1ldmVudC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvb2JzZXJ2YWJsZXMvcmVzdWx0cy1zaG93bi1ldmVudC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvb2JzZXJ2YWJsZXMvdGltZXItZXZlbnQudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL29ic2VydmFibGVzL3dvcmQtdHlwZWQtZXZlbnQudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BhZ2VzL2Fib3V0LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wYWdlcy9hY2NvdW50LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wYWdlcy9sb2FkaW5nLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wYWdlcy9sb2dpbi50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcGFnZXMvcGFnZS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcGFnZXMvc2V0dGluZ3MudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BhZ2VzL3Rlc3QudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9hcGUta2V5cy1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL2NvbnRhY3QtcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9jdXN0b20tdGVzdC1kdXJhdGlvbi1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL2N1c3RvbS10ZXh0LXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvY3VzdG9tLXRoZW1lLXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvY3VzdG9tLXdvcmQtYW1vdW50LXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvZWRpdC1wcmVzZXQtcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9lZGl0LXRhZ3MtcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9pbXBvcnQtZXhwb3J0LXNldHRpbmdzLXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvbW9iaWxlLXRlc3QtY29uZmlnLXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvcGItdGFibGVzLXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvcXVvdGUtYXBwcm92ZS1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL3F1b3RlLXJhdGUtcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9xdW90ZS1yZXBvcnQtcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9xdW90ZS1zZWFyY2gtcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9xdW90ZS1zdWJtaXQtcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy9yZXN1bHQtdGFncy1wb3B1cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL3NhdmVkLXRleHRzLXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvc2ltcGxlLXBvcHVwcy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvcG9wdXBzL3N1cHBvcnQtcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3BvcHVwcy92ZXJzaW9uLXBvcHVwLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9wb3B1cHMvd29yZC1maWx0ZXItcG9wdXAudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3JlYWR5LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9zZXR0aW5ncy9zZXR0aW5ncy1ncm91cC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvc2V0dGluZ3MvdGhlbWUtcGlja2VyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9zdGF0ZXMvYWN0aXZlLXBhZ2UudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3N0YXRlcy9nbGFyc2VzLW1vZGUudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3N0YXRlcy9wYWdlLXRyYW5zaXRpb24udHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3N0YXRlcy9zbG93LXRpbWVyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy9zdGF0ZXMvdGVzdC1hY3RpdmUudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3N0YXRlcy90aW1lLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L2JyaXRpc2gtZW5nbGlzaC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9jYXBzLXdhcm5pbmcudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvY2FyZXQudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvY3VzdG9tLXRleHQudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvZm9jdXMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvZnVuYm94LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L2xheW91dC1lbXVsYXRvci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9sYXp5LW1vZGUudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvbGl2ZS1hY2MudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvbGl2ZS1idXJzdC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9saXZlLXdwbS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9tYW51YWwtcmVzdGFydC10cmFja2VyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L21vbmtleS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9vdXQtb2YtZm9jdXMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvcGFjZS1jYXJldC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9wYi1jcm93bi50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9wb2V0cnkudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvcHJhY3Rpc2Utd29yZHMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvcmVwbGF5LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3Jlc3VsdC50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC9zaGlmdC10cmFja2VyLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3RiZC1tb2RlLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3Rlc3QtY29uZmlnLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3Rlc3QtaW5wdXQudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvdGVzdC1sb2dpYy50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC90ZXN0LXN0YXRlLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3Rlc3Qtc3RhdHMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvdGVzdC10aW1lci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC90ZXN0LXVpLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3Rlc3Qtd29yZHMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvdGltZXItcHJvZ3Jlc3MudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3QvdG9kYXktdHJhY2tlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC90dHMudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3Rlc3Qvd2Vhay1zcG90LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy90ZXN0L3dpa2lwZWRpYS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdGVzdC93b3Jkc2V0LnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy91aS50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdXRpbHMvZGVib3VuY2UudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3V0aWxzL21pc2MudHMiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC8uL3NyYy9zY3JpcHRzL3V0aWxzL3NlYXJjaC1zZXJ2aWNlLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy91dGlscy9zdHJpbmdzLnRzIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvLi9zcmMvc2NyaXB0cy91dGlscy91cmwtaGFuZGxlci50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kLy4vc3JjL3NjcmlwdHMvdmVyc2lvbi50cyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvd2VicGFjay9ydW50aW1lL2NodW5rIGxvYWRlZCIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kL3dlYnBhY2svcnVudGltZS9nbG9iYWwiLCJ3ZWJwYWNrOi8vbW9ua2V5dHlwZS1mcm9udGVuZC93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kL3dlYnBhY2svcnVudGltZS9qc29ucCBjaHVuayBsb2FkaW5nIiwid2VicGFjazovL21vbmtleXR5cGUtZnJvbnRlbmQvd2VicGFjay9iZWZvcmUtc3RhcnR1cCIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kL3dlYnBhY2svc3RhcnR1cCIsIndlYnBhY2s6Ly9tb25rZXl0eXBlLWZyb250ZW5kL3dlYnBhY2svYWZ0ZXItc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBleHRyYWN0ZWQgYnkgbWluaS1jc3MtZXh0cmFjdC1wbHVnaW5cbmV4cG9ydCB7fTsiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51cGRhdGUgPSBleHBvcnRzLmNsZWFyID0gdm9pZCAwO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuZnVuY3Rpb24gY2xlYXIoKSB7XG4gICAgJChcIi5wYWdlQWNjb3VudCAuZ2xvYmFsVGltZVR5cGluZyAudmFsXCIpLnRleHQoYC1gKTtcbiAgICAkKFwiLnBhZ2VBY2NvdW50IC5nbG9iYWxUZXN0c1N0YXJ0ZWQgLnZhbFwiKS50ZXh0KGAtYCk7XG4gICAgJChcIi5wYWdlQWNjb3VudCAuZ2xvYmFsVGVzdHNDb21wbGV0ZWQgLnZhbFwiKS50ZXh0KGAtYCk7XG59XG5leHBvcnRzLmNsZWFyID0gY2xlYXI7XG5mdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBjb25zdCBzbmFwc2hvdCA9IERCLmdldFNuYXBzaG90KCk7XG4gICAgaWYgKHNuYXBzaG90Lmdsb2JhbFN0YXRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgLy8gbGV0IHRoID0gTWF0aC5mbG9vcihEQi5nZXRTbmFwc2hvdCgpLmdsb2JhbFN0YXRzLnRpbWUgLyAzNjAwKTtcbiAgICAgICAgLy8gbGV0IHRtID0gTWF0aC5mbG9vcigoREIuZ2V0U25hcHNob3QoKS5nbG9iYWxTdGF0cy50aW1lICUgMzYwMCkgLyA2MCk7XG4gICAgICAgIC8vIGxldCB0cyA9IE1hdGguZmxvb3IoKERCLmdldFNuYXBzaG90KCkuZ2xvYmFsU3RhdHMudGltZSAlIDM2MDApICUgNjApO1xuICAgICAgICBjb25zdCBzZWNvbmRzID0gKF9iID0gKF9hID0gc25hcHNob3QgPT09IG51bGwgfHwgc25hcHNob3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNuYXBzaG90Lmdsb2JhbFN0YXRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudGltZSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogMDtcbiAgICAgICAgbGV0IHN0cmluZyA9IFwiXCI7XG4gICAgICAgIGlmIChzZWNvbmRzID09PSAwKSB7XG4gICAgICAgICAgICBzdHJpbmcgPSBcIi1cIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN0cmluZyA9IE1pc2Muc2Vjb25kc1RvU3RyaW5nKE1hdGgucm91bmQoc2Vjb25kcyksIHRydWUsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmdsb2JhbFRpbWVUeXBpbmcgLnZhbFwiKS50ZXh0KHN0cmluZyk7XG4gICAgfVxuICAgIGlmIChzbmFwc2hvdC5nbG9iYWxTdGF0cyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmdsb2JhbFRlc3RzU3RhcnRlZCAudmFsXCIpLnRleHQoc25hcHNob3QuZ2xvYmFsU3RhdHMuc3RhcnRlZCk7XG4gICAgfVxuICAgIGlmIChzbmFwc2hvdC5nbG9iYWxTdGF0cyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmdsb2JhbFRlc3RzQ29tcGxldGVkIC52YWxcIikudGV4dChzbmFwc2hvdC5nbG9iYWxTdGF0cy5jb21wbGV0ZWQpO1xuICAgIH1cbn1cbmV4cG9ydHMudXBkYXRlID0gdXBkYXRlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudXBkYXRlRGF0YSA9IGV4cG9ydHMuc2hvdyA9IGV4cG9ydHMudXBkYXRlUG9zaXRpb24gPSB2b2lkIDA7XG5jb25zdCBDaGFydENvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL2NoYXJ0LWNvbnRyb2xsZXJcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBtaW5pUmVzdWx0U2NhbGVPcHRpb25zID0gQ2hhcnRDb250cm9sbGVyLnJlc3VsdC5vcHRpb25zLnNjYWxlcztcbmZ1bmN0aW9uIHVwZGF0ZVBvc2l0aW9uKHgsIHkpIHtcbiAgICAkKFwiLnBhZ2VBY2NvdW50IC5taW5pUmVzdWx0Q2hhcnRXcmFwcGVyXCIpLmNzcyh7IHRvcDogeSwgbGVmdDogeCB9KTtcbn1cbmV4cG9ydHMudXBkYXRlUG9zaXRpb24gPSB1cGRhdGVQb3NpdGlvbjtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgJChcIi5wYWdlQWNjb3VudCAubWluaVJlc3VsdENoYXJ0V3JhcHBlclwiKS5zdG9wKHRydWUsIHRydWUpLmZhZGVJbigxMjUpO1xuICAgICQoXCIucGFnZUFjY291bnQgLm1pbmlSZXN1bHRDaGFydEJnXCIpLnN0b3AodHJ1ZSwgdHJ1ZSkuZmFkZUluKDEyNSk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAkKFwiLnBhZ2VBY2NvdW50IC5taW5pUmVzdWx0Q2hhcnRXcmFwcGVyXCIpLnN0b3AodHJ1ZSwgdHJ1ZSkuZmFkZU91dCgxMjUpO1xuICAgICQoXCIucGFnZUFjY291bnQgLm1pbmlSZXN1bHRDaGFydEJnXCIpLnN0b3AodHJ1ZSwgdHJ1ZSkuZmFkZU91dCgxMjUpO1xufVxuZnVuY3Rpb24gdXBkYXRlRGF0YShkYXRhKSB7XG4gICAgLy8gbGV0IGRhdGEgPSBmaWx0ZXJlZFJlc3VsdHNbZmlsdGVyZWRJZF0uY2hhcnREYXRhO1xuICAgIGNvbnN0IGxhYmVscyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IGRhdGEud3BtLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGxhYmVscy5wdXNoKGkudG9TdHJpbmcoKSk7XG4gICAgfVxuICAgIENoYXJ0Q29udHJvbGxlci5taW5pUmVzdWx0LmRhdGEubGFiZWxzID0gbGFiZWxzO1xuICAgIENoYXJ0Q29udHJvbGxlci5taW5pUmVzdWx0LmRhdGEuZGF0YXNldHNbMF0uZGF0YSA9IGRhdGEud3BtO1xuICAgIENoYXJ0Q29udHJvbGxlci5taW5pUmVzdWx0LmRhdGEuZGF0YXNldHNbMV0uZGF0YSA9IGRhdGEucmF3O1xuICAgIENoYXJ0Q29udHJvbGxlci5taW5pUmVzdWx0LmRhdGEuZGF0YXNldHNbMl0uZGF0YSA9IGRhdGEuZXJyO1xuICAgIGNvbnN0IG1heENoYXJ0VmFsID0gTWF0aC5tYXgoLi4uW01hdGgubWF4KC4uLmRhdGEud3BtKSwgTWF0aC5tYXgoLi4uZGF0YS5yYXcpXSk7XG4gICAgY29uc3QgbWluQ2hhcnRWYWwgPSBNYXRoLm1pbiguLi5bTWF0aC5taW4oLi4uZGF0YS53cG0pLCBNYXRoLm1pbiguLi5kYXRhLnJhdyldKTtcbiAgICBtaW5pUmVzdWx0U2NhbGVPcHRpb25zW1wid3BtXCJdLm1heCA9IE1hdGgucm91bmQobWF4Q2hhcnRWYWwpO1xuICAgIG1pbmlSZXN1bHRTY2FsZU9wdGlvbnNbXCJyYXdcIl0ubWF4ID0gTWF0aC5yb3VuZChtYXhDaGFydFZhbCk7XG4gICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LnN0YXJ0R3JhcGhzQXRaZXJvKSB7XG4gICAgICAgIG1pbmlSZXN1bHRTY2FsZU9wdGlvbnNbXCJ3cG1cIl0ubWluID0gTWF0aC5yb3VuZChtaW5DaGFydFZhbCk7XG4gICAgICAgIG1pbmlSZXN1bHRTY2FsZU9wdGlvbnNbXCJyYXdcIl0ubWluID0gTWF0aC5yb3VuZChtaW5DaGFydFZhbCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBtaW5pUmVzdWx0U2NhbGVPcHRpb25zW1wid3BtXCJdLm1pbiA9IDA7XG4gICAgICAgIG1pbmlSZXN1bHRTY2FsZU9wdGlvbnNbXCJyYXdcIl0ubWluID0gMDtcbiAgICB9XG4gICAgQ2hhcnRDb250cm9sbGVyLm1pbmlSZXN1bHQudXBkYXRlQ29sb3JzKCk7XG59XG5leHBvcnRzLnVwZGF0ZURhdGEgPSB1cGRhdGVEYXRhO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlQWNjb3VudCAubWluaVJlc3VsdENoYXJ0QmdcIiwgKCkgPT4ge1xuICAgIGhpZGUoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudXBkYXRlID0gdm9pZCAwO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBmb3JtYXRfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiZGF0ZS1mbnMvZm9ybWF0XCIpKTtcbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICAkKFwiLnBhZ2VBY2NvdW50IC50aW1lUGJUYWJsZSB0Ym9keVwiKS5odG1sKGBcbiAgPHRyPlxuICAgIDx0ZD4xNTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICA8L3RyPlxuICA8dHI+XG4gICAgPHRkPjMwPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gIDwvdHI+XG4gIDx0cj5cbiAgICA8dGQ+NjA8L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgPC90cj5cbiAgPHRyPlxuICAgIDx0ZD4xMjA8L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgPC90cj5cbiAgYCk7XG4gICAgJChcIi5wYWdlQWNjb3VudCAud29yZHNQYlRhYmxlIHRib2R5XCIpLmh0bWwoYFxuICA8dHI+XG4gICAgPHRkPjEwPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gIDwvdHI+XG4gIDx0cj5cbiAgICA8dGQ+MjU8L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgPC90cj5cbiAgPHRyPlxuICAgIDx0ZD41MDwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICA8L3RyPlxuICA8dHI+XG4gICAgPHRkPjEwMDwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICAgIDx0ZD4tPC90ZD5cbiAgICA8dGQ+LTwvdGQ+XG4gICAgPHRkPi08L3RkPlxuICA8L3RyPlxuICBgKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNKSB7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLnRpbWVQYlRhYmxlIHRoZWFkIHRyIHRkOm50aC1jaGlsZCgyKSwgLnBhZ2VBY2NvdW50IC53b3Jkc1BiVGFibGUgdGhlYWQgdHIgdGQ6bnRoLWNoaWxkKDIpXCIpLmh0bWwoJ2NwbTxicj48c3BhbiBjbGFzcz1cInN1YlwiPmFjY3VyYWN5PC9zcGFuPicpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAudGltZVBiVGFibGUgdGhlYWQgdHIgdGQ6bnRoLWNoaWxkKDIpLCAucGFnZUFjY291bnQgLndvcmRzUGJUYWJsZSB0aGVhZCB0ciB0ZDpudGgtY2hpbGQoMilcIikuaHRtbCgnd3BtPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+YWNjdXJhY3k8L3NwYW4+Jyk7XG4gICAgfVxuICAgIGNvbnN0IHBiID0gREIuZ2V0U25hcHNob3QoKS5wZXJzb25hbEJlc3RzO1xuICAgIGlmIChwYiA9PT0gdW5kZWZpbmVkKVxuICAgICAgICByZXR1cm47XG4gICAgbGV0IHBiRGF0YTtcbiAgICBsZXQgdGV4dDtcbiAgICBsZXQgZGF0ZVRleHQgPSBgLTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+YDtcbiAgICBjb25zdCBtdWx0aXBsaWVyID0gY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNID8gNSA6IDE7XG4gICAgdGV4dCA9IFwiXCI7XG4gICAgdHJ5IHtcbiAgICAgICAgcGJEYXRhID0gcGIudGltZVsxNV0uc29ydCgoYSwgYikgPT4gYi53cG0gLSBhLndwbSlbMF07XG4gICAgICAgIGRhdGVUZXh0ID0gYC08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPmA7XG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShwYkRhdGEudGltZXN0YW1wKTtcbiAgICAgICAgaWYgKHBiRGF0YS50aW1lc3RhbXApIHtcbiAgICAgICAgICAgIGRhdGVUZXh0ID1cbiAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJkZCBNTU0geXl5eVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPGJyPjxkaXYgY2xhc3M9J3N1Yic+XCIgK1xuICAgICAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJISDptbVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPC9kaXY+XCI7XG4gICAgICAgIH1cbiAgICAgICAgdGV4dCArPSBgPHRyPlxuICAgICAgPHRkPjE1PC90ZD5cbiAgICAgIDx0ZD4ke01pc2Mucm91bmRUbzIocGJEYXRhLndwbSAqIG11bHRpcGxpZXIpfTxicj48c3BhbiBjbGFzcz1cInN1YlwiPiR7cGJEYXRhLmFjYyA9PT0gdW5kZWZpbmVkID8gXCItXCIgOiBwYkRhdGEuYWNjICsgXCIlXCJ9PC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+JHtNaXNjLnJvdW5kVG8yKHBiRGF0YS5yYXcgKiBtdWx0aXBsaWVyKX08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiRGF0YS5jb25zaXN0ZW5jeSA9PT0gdW5kZWZpbmVkID8gXCItXCIgOiBwYkRhdGEuY29uc2lzdGVuY3kgKyBcIiVcIn08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4ke2RhdGVUZXh0fTwvdGQ+XG4gICAgPC90cj5gO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICB0ZXh0ICs9IGA8dHI+XG4gICAgICA8dGQ+MTU8L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgIDwvdHI+YDtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgcGJEYXRhID0gcGIudGltZVszMF0uc29ydCgoYSwgYikgPT4gYi53cG0gLSBhLndwbSlbMF07XG4gICAgICAgIGRhdGVUZXh0ID0gYC08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPmA7XG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShwYkRhdGEudGltZXN0YW1wKTtcbiAgICAgICAgaWYgKHBiRGF0YS50aW1lc3RhbXApIHtcbiAgICAgICAgICAgIGRhdGVUZXh0ID1cbiAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJkZCBNTU0geXl5eVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPGJyPjxkaXYgY2xhc3M9J3N1Yic+XCIgK1xuICAgICAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJISDptbVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPC9kaXY+XCI7XG4gICAgICAgIH1cbiAgICAgICAgdGV4dCArPSBgPHRyPlxuICAgIDx0ZD4zMDwvdGQ+XG4gICAgICA8dGQ+JHtNaXNjLnJvdW5kVG8yKHBiRGF0YS53cG0gKiBtdWx0aXBsaWVyKX08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiRGF0YS5hY2MgPT09IHVuZGVmaW5lZCA/IFwiLVwiIDogcGJEYXRhLmFjYyArIFwiJVwifTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPiR7TWlzYy5yb3VuZFRvMihwYkRhdGEucmF3ICogbXVsdGlwbGllcil9PGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYkRhdGEuY29uc2lzdGVuY3kgPT09IHVuZGVmaW5lZCA/IFwiLVwiIDogcGJEYXRhLmNvbnNpc3RlbmN5ICsgXCIlXCJ9PC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+JHtkYXRlVGV4dH08L3RkPlxuICAgIDwvdHI+YDtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgdGV4dCArPSBgPHRyPlxuICAgICAgPHRkPjMwPC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICA8L3RyPmA7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIHBiRGF0YSA9IHBiLnRpbWVbNjBdLnNvcnQoKGEsIGIpID0+IGIud3BtIC0gYS53cG0pWzBdO1xuICAgICAgICBkYXRlVGV4dCA9IGAtPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj5gO1xuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUocGJEYXRhLnRpbWVzdGFtcCk7XG4gICAgICAgIGlmIChwYkRhdGEudGltZXN0YW1wKSB7XG4gICAgICAgICAgICBkYXRlVGV4dCA9XG4gICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiZGQgTU1NIHl5eXlcIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjxicj48ZGl2IGNsYXNzPSdzdWInPlwiICtcbiAgICAgICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiSEg6bW1cIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjwvZGl2PlwiO1xuICAgICAgICB9XG4gICAgICAgIHRleHQgKz0gYDx0cj5cbiAgICAgIDx0ZD42MDwvdGQ+XG4gICAgICA8dGQ+JHtNaXNjLnJvdW5kVG8yKHBiRGF0YS53cG0gKiBtdWx0aXBsaWVyKX08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiRGF0YS5hY2MgPT09IHVuZGVmaW5lZCA/IFwiLVwiIDogcGJEYXRhLmFjYyArIFwiJVwifTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPiR7TWlzYy5yb3VuZFRvMihwYkRhdGEucmF3ICogbXVsdGlwbGllcil9PGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYkRhdGEuY29uc2lzdGVuY3kgPT09IHVuZGVmaW5lZCA/IFwiLVwiIDogcGJEYXRhLmNvbnNpc3RlbmN5ICsgXCIlXCJ9PC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+JHtkYXRlVGV4dH08L3RkPlxuICAgIDwvdHI+YDtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgdGV4dCArPSBgPHRyPlxuICAgICAgPHRkPjYwPC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICA8L3RyPmA7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIHBiRGF0YSA9IHBiLnRpbWVbMTIwXS5zb3J0KChhLCBiKSA9PiBiLndwbSAtIGEud3BtKVswXTtcbiAgICAgICAgZGF0ZVRleHQgPSBgLTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+YDtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHBiRGF0YS50aW1lc3RhbXApO1xuICAgICAgICBpZiAocGJEYXRhLnRpbWVzdGFtcCkge1xuICAgICAgICAgICAgZGF0ZVRleHQgPVxuICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcImRkIE1NTSB5eXl5XCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8YnI+PGRpdiBjbGFzcz0nc3ViJz5cIiArXG4gICAgICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcIkhIOm1tXCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8L2Rpdj5cIjtcbiAgICAgICAgfVxuICAgICAgICB0ZXh0ICs9IGA8dHI+XG4gICAgICA8dGQ+MTIwPC90ZD5cbiAgICAgIDx0ZD4ke01pc2Mucm91bmRUbzIocGJEYXRhLndwbSAqIG11bHRpcGxpZXIpfTxicj48c3BhbiBjbGFzcz1cInN1YlwiPiR7cGJEYXRhLmFjYyA9PT0gdW5kZWZpbmVkID8gXCItXCIgOiBwYkRhdGEuYWNjICsgXCIlXCJ9PC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+JHtNaXNjLnJvdW5kVG8yKHBiRGF0YS5yYXcgKiBtdWx0aXBsaWVyKX08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiRGF0YS5jb25zaXN0ZW5jeSA9PT0gdW5kZWZpbmVkID8gXCItXCIgOiBwYkRhdGEuY29uc2lzdGVuY3kgKyBcIiVcIn08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4ke2RhdGVUZXh0fTwvdGQ+XG4gICAgPC90cj5gO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICB0ZXh0ICs9IGA8dHI+XG4gICAgICA8dGQ+MTIwPC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICA8L3RyPmA7XG4gICAgfVxuICAgICQoXCIucGFnZUFjY291bnQgLnRpbWVQYlRhYmxlIHRib2R5XCIpLmh0bWwodGV4dCk7XG4gICAgdGV4dCA9IFwiXCI7XG4gICAgdHJ5IHtcbiAgICAgICAgcGJEYXRhID0gcGIud29yZHNbMTBdLnNvcnQoKGEsIGIpID0+IGIud3BtIC0gYS53cG0pWzBdO1xuICAgICAgICBkYXRlVGV4dCA9IGAtPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj5gO1xuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUocGJEYXRhLnRpbWVzdGFtcCk7XG4gICAgICAgIGlmIChwYkRhdGEudGltZXN0YW1wKSB7XG4gICAgICAgICAgICBkYXRlVGV4dCA9XG4gICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiZGQgTU1NIHl5eXlcIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjxicj48ZGl2IGNsYXNzPSdzdWInPlwiICtcbiAgICAgICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiSEg6bW1cIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjwvZGl2PlwiO1xuICAgICAgICB9XG4gICAgICAgIHRleHQgKz0gYDx0cj5cbiAgICAgIDx0ZD4xMDwvdGQ+XG4gICAgICA8dGQ+JHtNaXNjLnJvdW5kVG8yKHBiRGF0YS53cG0gKiBtdWx0aXBsaWVyKX08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiRGF0YS5hY2MgPT09IHVuZGVmaW5lZCA/IFwiLVwiIDogcGJEYXRhLmFjYyArIFwiJVwifTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPiR7TWlzYy5yb3VuZFRvMihwYkRhdGEucmF3ICogbXVsdGlwbGllcil9PGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYkRhdGEuY29uc2lzdGVuY3kgPT09IHVuZGVmaW5lZCA/IFwiLVwiIDogcGJEYXRhLmNvbnNpc3RlbmN5ICsgXCIlXCJ9PC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+JHtkYXRlVGV4dH08L3RkPlxuICAgIDwvdHI+YDtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgdGV4dCArPSBgPHRyPlxuICAgICAgPHRkPjEwPC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICA8L3RyPmA7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIHBiRGF0YSA9IHBiLndvcmRzWzI1XS5zb3J0KChhLCBiKSA9PiBiLndwbSAtIGEud3BtKVswXTtcbiAgICAgICAgZGF0ZVRleHQgPSBgLTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+YDtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHBiRGF0YS50aW1lc3RhbXApO1xuICAgICAgICBpZiAocGJEYXRhLnRpbWVzdGFtcCkge1xuICAgICAgICAgICAgZGF0ZVRleHQgPVxuICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcImRkIE1NTSB5eXl5XCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8YnI+PGRpdiBjbGFzcz0nc3ViJz5cIiArXG4gICAgICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcIkhIOm1tXCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8L2Rpdj5cIjtcbiAgICAgICAgfVxuICAgICAgICB0ZXh0ICs9IGA8dHI+XG4gICAgICA8dGQ+MjU8L3RkPlxuICAgICAgPHRkPiR7TWlzYy5yb3VuZFRvMihwYkRhdGEud3BtICogbXVsdGlwbGllcil9PGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYkRhdGEuYWNjID09PSB1bmRlZmluZWQgPyBcIi1cIiA6IHBiRGF0YS5hY2MgKyBcIiVcIn08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4ke01pc2Mucm91bmRUbzIocGJEYXRhLnJhdyAqIG11bHRpcGxpZXIpfTxicj48c3BhbiBjbGFzcz1cInN1YlwiPiR7cGJEYXRhLmNvbnNpc3RlbmN5ID09PSB1bmRlZmluZWQgPyBcIi1cIiA6IHBiRGF0YS5jb25zaXN0ZW5jeSArIFwiJVwifTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPiR7ZGF0ZVRleHR9PC90ZD5cbiAgICA8L3RyPmA7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHRleHQgKz0gYDx0cj5cbiAgICAgIDx0ZD4yNTwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgPC90cj5gO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBwYkRhdGEgPSBwYi53b3Jkc1s1MF0uc29ydCgoYSwgYikgPT4gYi53cG0gLSBhLndwbSlbMF07XG4gICAgICAgIGRhdGVUZXh0ID0gYC08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPmA7XG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShwYkRhdGEudGltZXN0YW1wKTtcbiAgICAgICAgaWYgKHBiRGF0YS50aW1lc3RhbXApIHtcbiAgICAgICAgICAgIGRhdGVUZXh0ID1cbiAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJkZCBNTU0geXl5eVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPGJyPjxkaXYgY2xhc3M9J3N1Yic+XCIgK1xuICAgICAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZSwgXCJISDptbVwiKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPC9kaXY+XCI7XG4gICAgICAgIH1cbiAgICAgICAgdGV4dCArPSBgPHRyPlxuICAgICAgPHRkPjUwPC90ZD5cbiAgICAgIDx0ZD4ke01pc2Mucm91bmRUbzIocGJEYXRhLndwbSAqIG11bHRpcGxpZXIpfTxicj48c3BhbiBjbGFzcz1cInN1YlwiPiR7cGJEYXRhLmFjYyA9PT0gdW5kZWZpbmVkID8gXCItXCIgOiBwYkRhdGEuYWNjICsgXCIlXCJ9PC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+JHtNaXNjLnJvdW5kVG8yKHBiRGF0YS5yYXcgKiBtdWx0aXBsaWVyKX08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiRGF0YS5jb25zaXN0ZW5jeSA9PT0gdW5kZWZpbmVkID8gXCItXCIgOiBwYkRhdGEuY29uc2lzdGVuY3kgKyBcIiVcIn08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4ke2RhdGVUZXh0fTwvdGQ+XG4gICAgPC90cj5gO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICB0ZXh0ICs9IGA8dHI+XG4gICAgICA8dGQ+NTA8L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgIDwvdHI+YDtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgcGJEYXRhID0gcGIud29yZHNbMTAwXS5zb3J0KChhLCBiKSA9PiBiLndwbSAtIGEud3BtKVswXTtcbiAgICAgICAgZGF0ZVRleHQgPSBgLTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+YDtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHBiRGF0YS50aW1lc3RhbXApO1xuICAgICAgICBpZiAocGJEYXRhLnRpbWVzdGFtcCkge1xuICAgICAgICAgICAgZGF0ZVRleHQgPVxuICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcImRkIE1NTSB5eXl5XCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8YnI+PGRpdiBjbGFzcz0nc3ViJz5cIiArXG4gICAgICAgICAgICAgICAgICAgICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcIkhIOm1tXCIpICtcbiAgICAgICAgICAgICAgICAgICAgXCI8L2Rpdj5cIjtcbiAgICAgICAgfVxuICAgICAgICB0ZXh0ICs9IGA8dHI+XG4gICAgICA8dGQ+MTAwPC90ZD5cbiAgICAgIDx0ZD4ke01pc2Mucm91bmRUbzIocGJEYXRhLndwbSAqIG11bHRpcGxpZXIpfTxicj48c3BhbiBjbGFzcz1cInN1YlwiPiR7cGJEYXRhLmFjYyA9PT0gdW5kZWZpbmVkID8gXCItXCIgOiBwYkRhdGEuYWNjICsgXCIlXCJ9PC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+JHtNaXNjLnJvdW5kVG8yKHBiRGF0YS5yYXcgKiBtdWx0aXBsaWVyKX08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiRGF0YS5jb25zaXN0ZW5jeSA9PT0gdW5kZWZpbmVkID8gXCItXCIgOiBwYkRhdGEuY29uc2lzdGVuY3kgKyBcIiVcIn08L3NwYW4+PC90ZD5cbiAgICAgIDx0ZD4ke2RhdGVUZXh0fTwvdGQ+XG4gICAgPC90cj5gO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICB0ZXh0ICs9IGA8dHI+XG4gICAgICA8dGQ+MTAwPC90ZD5cbiAgICAgIDx0ZD4tPGJyPjxzcGFuIGNsYXNzPVwic3ViXCI+LTwvc3Bhbj48L3RkPlxuICAgICAgPHRkPi08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPjwvdGQ+XG4gICAgICA8dGQ+LTxicj48c3BhbiBjbGFzcz1cInN1YlwiPi08L3NwYW4+PC90ZD5cbiAgICA8L3RyPmA7XG4gICAgfVxuICAgICQoXCIucGFnZUFjY291bnQgLndvcmRzUGJUYWJsZSB0Ym9keVwiKS5odG1sKHRleHQpO1xufVxuZXhwb3J0cy51cGRhdGUgPSB1cGRhdGU7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51cGRhdGVUYWdzID0gZXhwb3J0cy50b2dnbGUgPSBleHBvcnRzLnVwZGF0ZUFjdGl2ZSA9IGV4cG9ydHMucmVzZXQgPSBleHBvcnRzLmxvYWRUYWdzID0gZXhwb3J0cy5nZXRGaWx0ZXIgPSBleHBvcnRzLmdldEdyb3VwID0gZXhwb3J0cy5nZXRGaWx0ZXJzID0gZXhwb3J0cy5sb2FkID0gZXhwb3J0cy5maWx0ZXJzID0gZXhwb3J0cy5kZWZhdWx0UmVzdWx0RmlsdGVycyA9IHZvaWQgMDtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5leHBvcnRzLmRlZmF1bHRSZXN1bHRGaWx0ZXJzID0ge1xuICAgIGRpZmZpY3VsdHk6IHtcbiAgICAgICAgbm9ybWFsOiB0cnVlLFxuICAgICAgICBleHBlcnQ6IHRydWUsXG4gICAgICAgIG1hc3RlcjogdHJ1ZSxcbiAgICB9LFxuICAgIG1vZGU6IHtcbiAgICAgICAgd29yZHM6IHRydWUsXG4gICAgICAgIHRpbWU6IHRydWUsXG4gICAgICAgIHF1b3RlOiB0cnVlLFxuICAgICAgICB6ZW46IHRydWUsXG4gICAgICAgIGN1c3RvbTogdHJ1ZSxcbiAgICB9LFxuICAgIHdvcmRzOiB7XG4gICAgICAgIDEwOiB0cnVlLFxuICAgICAgICAyNTogdHJ1ZSxcbiAgICAgICAgNTA6IHRydWUsXG4gICAgICAgIDEwMDogdHJ1ZSxcbiAgICAgICAgY3VzdG9tOiB0cnVlLFxuICAgIH0sXG4gICAgdGltZToge1xuICAgICAgICAxNTogdHJ1ZSxcbiAgICAgICAgMzA6IHRydWUsXG4gICAgICAgIDYwOiB0cnVlLFxuICAgICAgICAxMjA6IHRydWUsXG4gICAgICAgIGN1c3RvbTogdHJ1ZSxcbiAgICB9LFxuICAgIHF1b3RlTGVuZ3RoOiB7XG4gICAgICAgIHNob3J0OiB0cnVlLFxuICAgICAgICBtZWRpdW06IHRydWUsXG4gICAgICAgIGxvbmc6IHRydWUsXG4gICAgICAgIHRoaWNjOiB0cnVlLFxuICAgIH0sXG4gICAgcHVuY3R1YXRpb246IHtcbiAgICAgICAgb246IHRydWUsXG4gICAgICAgIG9mZjogdHJ1ZSxcbiAgICB9LFxuICAgIG51bWJlcnM6IHtcbiAgICAgICAgb246IHRydWUsXG4gICAgICAgIG9mZjogdHJ1ZSxcbiAgICB9LFxuICAgIGRhdGU6IHtcbiAgICAgICAgbGFzdF9kYXk6IGZhbHNlLFxuICAgICAgICBsYXN0X3dlZWs6IGZhbHNlLFxuICAgICAgICBsYXN0X21vbnRoOiBmYWxzZSxcbiAgICAgICAgbGFzdF8zbW9udGhzOiBmYWxzZSxcbiAgICAgICAgYWxsOiB0cnVlLFxuICAgIH0sXG4gICAgdGFnczoge1xuICAgICAgICBub25lOiB0cnVlLFxuICAgIH0sXG4gICAgbGFuZ3VhZ2U6IHt9LFxuICAgIGZ1bmJveDoge1xuICAgICAgICBub25lOiB0cnVlLFxuICAgIH0sXG59O1xuZXhwb3J0cy5maWx0ZXJzID0gZXhwb3J0cy5kZWZhdWx0UmVzdWx0RmlsdGVycztcbmZ1bmN0aW9uIHNhdmUoKSB7XG4gICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwicmVzdWx0RmlsdGVyc1wiLCBKU09OLnN0cmluZ2lmeShleHBvcnRzLmZpbHRlcnMpKTtcbn1cbmZ1bmN0aW9uIGxvYWQoKSB7XG4gICAgY29uc29sZS5sb2coXCJsb2FkaW5nIGZpbHRlcnNcIik7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbmV3UmVzdWx0RmlsdGVycyA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInJlc3VsdEZpbHRlcnNcIik7XG4gICAgICAgIGlmIChuZXdSZXN1bHRGaWx0ZXJzICE9IHVuZGVmaW5lZCAmJlxuICAgICAgICAgICAgbmV3UmVzdWx0RmlsdGVycyAhPT0gXCJcIiAmJlxuICAgICAgICAgICAgT2JqZWN0LmtleXMoSlNPTi5wYXJzZShuZXdSZXN1bHRGaWx0ZXJzKSkubGVuZ3RoID49XG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoZXhwb3J0cy5kZWZhdWx0UmVzdWx0RmlsdGVycykubGVuZ3RoKSB7XG4gICAgICAgICAgICBleHBvcnRzLmZpbHRlcnMgPSBKU09OLnBhcnNlKG5ld1Jlc3VsdEZpbHRlcnMpO1xuICAgICAgICAgICAgLy8gc2F2ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzID0gZXhwb3J0cy5kZWZhdWx0UmVzdWx0RmlsdGVycztcbiAgICAgICAgICAgIC8vIHNhdmUoKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuZXdUYWdzID0geyBub25lOiBmYWxzZSB9O1xuICAgICAgICBPYmplY3Qua2V5cyhleHBvcnRzLmRlZmF1bHRSZXN1bHRGaWx0ZXJzLnRhZ3MpLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgaWYgKGV4cG9ydHMuZmlsdGVycy50YWdzW3RhZ10gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIG5ld1RhZ3NbdGFnXSA9IGV4cG9ydHMuZmlsdGVycy50YWdzW3RhZ107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBuZXdUYWdzW3RhZ10gPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgZXhwb3J0cy5maWx0ZXJzLnRhZ3MgPSBuZXdUYWdzO1xuICAgICAgICBzYXZlKCk7XG4gICAgfVxuICAgIGNhdGNoIChfYSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yIGluIGxvYWRpbmcgcmVzdWx0IGZpbHRlcnNcIik7XG4gICAgICAgIGV4cG9ydHMuZmlsdGVycyA9IGV4cG9ydHMuZGVmYXVsdFJlc3VsdEZpbHRlcnM7XG4gICAgICAgIHNhdmUoKTtcbiAgICB9XG59XG5leHBvcnRzLmxvYWQgPSBsb2FkO1xuZnVuY3Rpb24gZ2V0RmlsdGVycygpIHtcbiAgICByZXR1cm4gZXhwb3J0cy5maWx0ZXJzO1xufVxuZXhwb3J0cy5nZXRGaWx0ZXJzID0gZ2V0RmlsdGVycztcbmZ1bmN0aW9uIGdldEdyb3VwKGdyb3VwKSB7XG4gICAgcmV0dXJuIGV4cG9ydHMuZmlsdGVyc1tncm91cF07XG59XG5leHBvcnRzLmdldEdyb3VwID0gZ2V0R3JvdXA7XG4vLyBleHBvcnQgZnVuY3Rpb24gc2V0RmlsdGVyKGdyb3VwLCBmaWx0ZXIsIHZhbHVlKSB7XG4vLyAgIGZpbHRlcnNbZ3JvdXBdW2ZpbHRlcl0gPSB2YWx1ZTtcbi8vIH1cbmZ1bmN0aW9uIGdldEZpbHRlcihncm91cCwgZmlsdGVyKSB7XG4gICAgcmV0dXJuIGV4cG9ydHMuZmlsdGVyc1tncm91cF1bZmlsdGVyXTtcbn1cbmV4cG9ydHMuZ2V0RmlsdGVyID0gZ2V0RmlsdGVyO1xuLy8gZXhwb3J0IGZ1bmN0aW9uIHRvZ2dsZUZpbHRlcihncm91cCwgZmlsdGVyKSB7XG4vLyAgIGZpbHRlcnNbZ3JvdXBdW2ZpbHRlcl0gPSAhZmlsdGVyc1tncm91cF1bZmlsdGVyXTtcbi8vIH1cbmZ1bmN0aW9uIGxvYWRUYWdzKHRhZ3MpIHtcbiAgICBjb25zb2xlLmxvZyhcImxvYWRpbmcgdGFnc1wiKTtcbiAgICB0YWdzLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICBleHBvcnRzLmRlZmF1bHRSZXN1bHRGaWx0ZXJzLnRhZ3NbdGFnLl9pZF0gPSB0cnVlO1xuICAgIH0pO1xufVxuZXhwb3J0cy5sb2FkVGFncyA9IGxvYWRUYWdzO1xuZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgZXhwb3J0cy5maWx0ZXJzID0gZXhwb3J0cy5kZWZhdWx0UmVzdWx0RmlsdGVycztcbiAgICBzYXZlKCk7XG59XG5leHBvcnRzLnJlc2V0ID0gcmVzZXQ7XG5mdW5jdGlvbiB1cGRhdGVBY3RpdmUoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICAgIGNvbnN0IGFib3ZlQ2hhcnREaXNwbGF5ID0ge307XG4gICAgT2JqZWN0LmtleXMoZ2V0RmlsdGVycygpKS5mb3JFYWNoKChncm91cCkgPT4ge1xuICAgICAgICBhYm92ZUNoYXJ0RGlzcGxheVtncm91cF0gPSB7XG4gICAgICAgICAgICBhbGw6IHRydWUsXG4gICAgICAgICAgICBhcnJheTogW10sXG4gICAgICAgIH07XG4gICAgICAgIE9iamVjdC5rZXlzKGdldEdyb3VwKGdyb3VwKSkuZm9yRWFjaCgoZmlsdGVyKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICBjb25zdCBncm91cEFib3ZlQ2hhcnREaXNwbGF5ID0gYWJvdmVDaGFydERpc3BsYXlbZ3JvdXBdO1xuICAgICAgICAgICAgaWYgKGdyb3VwQWJvdmVDaGFydERpc3BsYXkgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBpZiAoZ2V0RmlsdGVyKGdyb3VwLCBmaWx0ZXIpKSB7XG4gICAgICAgICAgICAgICAgKF9hID0gZ3JvdXBBYm92ZUNoYXJ0RGlzcGxheVtcImFycmF5XCJdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucHVzaChmaWx0ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGdyb3VwQWJvdmVDaGFydERpc3BsYXlbXCJhbGxcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBncm91cEFib3ZlQ2hhcnREaXNwbGF5W1wiYWxsXCJdID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGJ1dHRvbkVsO1xuICAgICAgICAgICAgaWYgKGdyb3VwID09PSBcImRhdGVcIikge1xuICAgICAgICAgICAgICAgIGJ1dHRvbkVsID0gJChgLnBhZ2VBY2NvdW50IC5ncm91cC50b3BGaWx0ZXJzIC5maWx0ZXJHcm91cFtncm91cD1cIiR7Z3JvdXB9XCJdIC5idXR0b25bZmlsdGVyPVwiJHtmaWx0ZXJ9XCJdYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBidXR0b25FbCA9ICQoYC5wYWdlQWNjb3VudCAuZ3JvdXAuZmlsdGVyQnV0dG9ucyAuZmlsdGVyR3JvdXBbZ3JvdXA9XCIke2dyb3VwfVwiXSAuYnV0dG9uW2ZpbHRlcj1cIiR7ZmlsdGVyfVwiXWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdldEZpbHRlcihncm91cCwgZmlsdGVyKSkge1xuICAgICAgICAgICAgICAgIGJ1dHRvbkVsLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgYnV0dG9uRWwucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGZ1bmN0aW9uIGFkZFRleHQoZ3JvdXApIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZTtcbiAgICAgICAgbGV0IHJldCA9IFwiXCI7XG4gICAgICAgIHJldCArPSBcIjxkaXYgY2xhc3M9J2dyb3VwJz5cIjtcbiAgICAgICAgaWYgKGdyb3VwID09IFwiZGlmZmljdWx0eVwiKSB7XG4gICAgICAgICAgICByZXQgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCJEaWZmaWN1bHR5XCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtc3RhclwiPjwvaT5gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGdyb3VwID09IFwibW9kZVwiKSB7XG4gICAgICAgICAgICByZXQgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCJNb2RlXCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtYmFyc1wiPjwvaT5gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGdyb3VwID09IFwicHVuY3R1YXRpb25cIikge1xuICAgICAgICAgICAgcmV0ICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwiUHVuY3R1YXRpb25cIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48c3BhbiBjbGFzcz1cInB1bmNcIiBzdHlsZT1cImZvbnQtd2VpZ2h0OiA5MDA7XG4gICAgICB3aWR0aDogMS4yNXJlbTtcbiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgICAgIGxldHRlci1zcGFjaW5nOiAtLjFyZW07XCI+IT88L3NwYW4+YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChncm91cCA9PSBcIm51bWJlcnNcIikge1xuICAgICAgICAgICAgcmV0ICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwiTnVtYmVyc1wiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxzcGFuIGNsYXNzPVwibnVtYmVyc1wiIHN0eWxlPVwiZm9udC13ZWlnaHQ6IDkwMDtcbiAgICAgICAgd2lkdGg6IDEuMjVyZW07XG4gICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICAgICAgbWFyZ2luLXJpZ2h0OiAuMXJlbTtcbiAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICAgICAgICBsZXR0ZXItc3BhY2luZzogLS4xcmVtO1wiPjE1PC9zcGFuPmA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZ3JvdXAgPT0gXCJ3b3Jkc1wiKSB7XG4gICAgICAgICAgICByZXQgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCJXb3Jkc1wiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWZvbnRcIj48L2k+YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChncm91cCA9PSBcInRpbWVcIikge1xuICAgICAgICAgICAgcmV0ICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwiVGltZVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWNsb2NrXCI+PC9pPmA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZ3JvdXAgPT0gXCJkYXRlXCIpIHtcbiAgICAgICAgICAgIHJldCArPSBgPHNwYW4gYXJpYS1sYWJlbD1cIkRhdGVcIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1jYWxlbmRhclwiPjwvaT5gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGdyb3VwID09IFwidGFnc1wiKSB7XG4gICAgICAgICAgICByZXQgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCJUYWdzXCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtdGFnc1wiPjwvaT5gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGdyb3VwID09IFwibGFuZ3VhZ2VcIikge1xuICAgICAgICAgICAgcmV0ICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwiTGFuZ3VhZ2VcIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1nbG9iZS1hbWVyaWNhc1wiPjwvaT5gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGdyb3VwID09IFwiZnVuYm94XCIpIHtcbiAgICAgICAgICAgIHJldCArPSBgPHNwYW4gYXJpYS1sYWJlbD1cIkZ1bmJveFwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWdhbWVwYWRcIj48L2k+YDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKF9hID0gYWJvdmVDaGFydERpc3BsYXlbZ3JvdXBdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuYWxsKSB7XG4gICAgICAgICAgICByZXQgKz0gXCJhbGxcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChncm91cCA9PT0gXCJ0YWdzXCIpIHtcbiAgICAgICAgICAgICAgICByZXQgKz0gKF9jID0gKF9iID0gYWJvdmVDaGFydERpc3BsYXkudGFncykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmFycmF5KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MubWFwKChpZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaWQgPT0gXCJub25lXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWQ7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNuYXBzaG90ID0gREIuZ2V0U25hcHNob3QoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IChfYSA9IHNuYXBzaG90LnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5maWx0ZXIoKHQpID0+IHQuX2lkID09IGlkKVswXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChfYiA9IHNuYXBzaG90LnRhZ3MpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5maWx0ZXIoKHQpID0+IHQuX2lkID09IGlkKVswXS5uYW1lO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuYW1lO1xuICAgICAgICAgICAgICAgIH0pLmpvaW4oXCIsIFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldCArPSAoX2UgPSAoX2QgPSBhYm92ZUNoYXJ0RGlzcGxheVtncm91cF0pID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5hcnJheSkgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lLmpvaW4oXCIsIFwiKS5yZXBsYWNlKC9fL2csIFwiIFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXQgKz0gXCI8L3NwYW4+PC9kaXY+XCI7XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfVxuICAgIGxldCBjaGFydFN0cmluZyA9IFwiXCI7XG4gICAgLy9kYXRlXG4gICAgY2hhcnRTdHJpbmcgKz0gYWRkVGV4dChcImRhdGVcIik7XG4gICAgY2hhcnRTdHJpbmcgKz0gYDxkaXYgY2xhc3M9XCJzcGFjZXJcIj48L2Rpdj5gO1xuICAgIC8vbW9kZVxuICAgIGNoYXJ0U3RyaW5nICs9IGFkZFRleHQoXCJtb2RlXCIpO1xuICAgIGNoYXJ0U3RyaW5nICs9IGA8ZGl2IGNsYXNzPVwic3BhY2VyXCI+PC9kaXY+YDtcbiAgICAvL3RpbWVcbiAgICBpZiAoKF9iID0gKF9hID0gYWJvdmVDaGFydERpc3BsYXkubW9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmFycmF5KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuaW5jbHVkZXMoXCJ0aW1lXCIpKSB7XG4gICAgICAgIGNoYXJ0U3RyaW5nICs9IGFkZFRleHQoXCJ0aW1lXCIpO1xuICAgICAgICBjaGFydFN0cmluZyArPSBgPGRpdiBjbGFzcz1cInNwYWNlclwiPjwvZGl2PmA7XG4gICAgfVxuICAgIC8vd29yZHNcbiAgICBpZiAoKF9kID0gKF9jID0gYWJvdmVDaGFydERpc3BsYXkubW9kZSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmFycmF5KSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QuaW5jbHVkZXMoXCJ3b3Jkc1wiKSkge1xuICAgICAgICBjaGFydFN0cmluZyArPSBhZGRUZXh0KFwid29yZHNcIik7XG4gICAgICAgIGNoYXJ0U3RyaW5nICs9IGA8ZGl2IGNsYXNzPVwic3BhY2VyXCI+PC9kaXY+YDtcbiAgICB9XG4gICAgLy9kaWZmXG4gICAgY2hhcnRTdHJpbmcgKz0gYWRkVGV4dChcImRpZmZpY3VsdHlcIik7XG4gICAgY2hhcnRTdHJpbmcgKz0gYDxkaXYgY2xhc3M9XCJzcGFjZXJcIj48L2Rpdj5gO1xuICAgIC8vcHVuY1xuICAgIGNoYXJ0U3RyaW5nICs9IGFkZFRleHQoXCJwdW5jdHVhdGlvblwiKTtcbiAgICBjaGFydFN0cmluZyArPSBgPGRpdiBjbGFzcz1cInNwYWNlclwiPjwvZGl2PmA7XG4gICAgLy9udW1iZXJzXG4gICAgY2hhcnRTdHJpbmcgKz0gYWRkVGV4dChcIm51bWJlcnNcIik7XG4gICAgY2hhcnRTdHJpbmcgKz0gYDxkaXYgY2xhc3M9XCJzcGFjZXJcIj48L2Rpdj5gO1xuICAgIC8vbGFuZ3VhZ2VcbiAgICBjaGFydFN0cmluZyArPSBhZGRUZXh0KFwibGFuZ3VhZ2VcIik7XG4gICAgY2hhcnRTdHJpbmcgKz0gYDxkaXYgY2xhc3M9XCJzcGFjZXJcIj48L2Rpdj5gO1xuICAgIC8vZnVuYm94XG4gICAgY2hhcnRTdHJpbmcgKz0gYWRkVGV4dChcImZ1bmJveFwiKTtcbiAgICBjaGFydFN0cmluZyArPSBgPGRpdiBjbGFzcz1cInNwYWNlclwiPjwvZGl2PmA7XG4gICAgLy90YWdzXG4gICAgY2hhcnRTdHJpbmcgKz0gYWRkVGV4dChcInRhZ3NcIik7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmdyb3VwLmNoYXJ0IC5hYm92ZVwiKS5odG1sKGNoYXJ0U3RyaW5nKTtcbiAgICB9LCAwKTtcbn1cbmV4cG9ydHMudXBkYXRlQWN0aXZlID0gdXBkYXRlQWN0aXZlO1xuZnVuY3Rpb24gdG9nZ2xlKGdyb3VwLCBmaWx0ZXIpIHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoZ3JvdXAgPT09IFwiZGF0ZVwiKSB7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhnZXRHcm91cChcImRhdGVcIikpLmZvckVhY2goKGRhdGUpID0+IHtcbiAgICAgICAgICAgICAgICBleHBvcnRzLmZpbHRlcnNbXCJkYXRlXCJdW2RhdGVdID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBleHBvcnRzLmZpbHRlcnNbZ3JvdXBdW2ZpbHRlcl0gPSAhZXhwb3J0cy5maWx0ZXJzW2dyb3VwXVtmaWx0ZXJdO1xuICAgICAgICBzYXZlKCk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiU29tZXRoaW5nIHdlbnQgd3JvbmcgdG9nZ2xpbmcgZmlsdGVyLiBSZXZlcnRpbmcgdG8gZGVmYXVsdHMuXCIsIDApO1xuICAgICAgICBjb25zb2xlLmxvZyhcInRvZ2dsaW5nIGZpbHRlciBlcnJvclwiKTtcbiAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgcmVzZXQoKTtcbiAgICAgICAgdXBkYXRlQWN0aXZlKCk7XG4gICAgfVxufVxuZXhwb3J0cy50b2dnbGUgPSB0b2dnbGU7XG5mdW5jdGlvbiB1cGRhdGVUYWdzKCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgJChcIi5wYWdlQWNjb3VudCAuY29udGVudCAuZmlsdGVyQnV0dG9ucyAuYnV0dG9uc0FuZFRpdGxlLnRhZ3MgLmJ1dHRvbnNcIikuZW1wdHkoKTtcbiAgICBjb25zdCBzbmFwc2hvdCA9IERCLmdldFNuYXBzaG90KCk7XG4gICAgaWYgKCgoX2EgPSBzbmFwc2hvdC50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSB8fCAwID4gMCkge1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5jb250ZW50IC5maWx0ZXJCdXR0b25zIC5idXR0b25zQW5kVGl0bGUudGFnc1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuY29udGVudCAuZmlsdGVyQnV0dG9ucyAuYnV0dG9uc0FuZFRpdGxlLnRhZ3MgLmJ1dHRvbnNcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwiYnV0dG9uXCIgZmlsdGVyPVwibm9uZVwiPm5vIHRhZzwvZGl2PmApO1xuICAgICAgICAoX2IgPSBzbmFwc2hvdC50YWdzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5jb250ZW50IC5maWx0ZXJCdXR0b25zIC5idXR0b25zQW5kVGl0bGUudGFncyAuYnV0dG9uc1wiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJidXR0b25cIiBmaWx0ZXI9XCIke3RhZy5faWR9XCI+JHt0YWcubmFtZX08L2Rpdj5gKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5jb250ZW50IC5maWx0ZXJCdXR0b25zIC5idXR0b25zQW5kVGl0bGUudGFnc1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG59XG5leHBvcnRzLnVwZGF0ZVRhZ3MgPSB1cGRhdGVUYWdzO1xuJChcIi5wYWdlQWNjb3VudCAuZmlsdGVyQnV0dG9ucyAuYnV0dG9uc0FuZFRpdGxlIC5idXR0b25zLCAucGFnZUFjY291bnQgLmdyb3VwLnRvcEZpbHRlcnMgLmJ1dHRvbnNBbmRUaXRsZS50ZXN0RGF0ZSAuYnV0dG9uc1wiKS5vbihcImNsaWNrXCIsIFwiLmJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIGNvbnN0IGdyb3VwID0gJChlLnRhcmdldClcbiAgICAgICAgLnBhcmVudHMoXCIuYnV0dG9uc1wiKVxuICAgICAgICAuYXR0cihcImdyb3VwXCIpO1xuICAgIGNvbnN0IGZpbHRlciA9ICQoZS50YXJnZXQpLmF0dHIoXCJmaWx0ZXJcIik7XG4gICAgaWYgKCQoZS50YXJnZXQpLmhhc0NsYXNzKFwiYWxsRmlsdGVyc1wiKSkge1xuICAgICAgICBPYmplY3Qua2V5cyhnZXRGaWx0ZXJzKCkpLmZvckVhY2goKGdyb3VwKSA9PiB7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhnZXRHcm91cChncm91cCkpLmZvckVhY2goKGZpbHRlcikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChncm91cCA9PT0gXCJkYXRlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyBmaWd1cmUgb3V0IHdoeSBcImZpbHRlclwiIGlzIG5ldmVyXG4gICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzW2dyb3VwXVtmaWx0ZXJdID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGV4cG9ydHMuZmlsdGVyc1tncm91cF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVyc1tncm91cF1bZmlsdGVyXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBleHBvcnRzLmZpbHRlcnNbXCJkYXRlXCJdW1wiYWxsXCJdID0gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSBpZiAoJChlLnRhcmdldCkuaGFzQ2xhc3MoXCJub0ZpbHRlcnNcIikpIHtcbiAgICAgICAgT2JqZWN0LmtleXMoZ2V0RmlsdGVycygpKS5mb3JFYWNoKChncm91cCkgPT4ge1xuICAgICAgICAgICAgaWYgKGdyb3VwICE9PSBcImRhdGVcIikge1xuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGdldEdyb3VwKGdyb3VwKSkuZm9yRWFjaCgoZmlsdGVyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE8gZmlndXJlIG91dCB3aHkgXCJmaWx0ZXJcIiBpcyBuZXZlclxuICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVyc1tncm91cF1bZmlsdGVyXSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSBpZiAoJChlLnRhcmdldCkuaGFzQ2xhc3MoXCJidXR0b25cIikpIHtcbiAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGdldEdyb3VwKGdyb3VwKSkuZm9yRWFjaCgoZmlsdGVyKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETyBmaWd1cmUgb3V0IHdoeSBcImZpbHRlclwiIGlzIG5ldmVyXG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVyc1tncm91cF1bZmlsdGVyXSA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBUT0RPIGZpZ3VyZSBvdXQgd2h5IFwiZmlsdGVyXCIgaXMgbmV2ZXJcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVyc1tncm91cF1bZmlsdGVyXSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0b2dnbGUoZ3JvdXAsIGZpbHRlcik7XG4gICAgICAgICAgICAvLyBmaWx0ZXJzW2dyb3VwXVtmaWx0ZXJdID0gIWZpbHRlcnNbZ3JvdXBdW2ZpbHRlcl07XG4gICAgICAgIH1cbiAgICB9XG4gICAgdXBkYXRlQWN0aXZlKCk7XG4gICAgc2F2ZSgpO1xufSk7XG4kKFwiLnBhZ2VBY2NvdW50IC50b3BGaWx0ZXJzIC5idXR0b24uYWxsRmlsdGVyc1wiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBPYmplY3Qua2V5cyhnZXRGaWx0ZXJzKCkpLmZvckVhY2goKGdyb3VwKSA9PiB7XG4gICAgICAgIE9iamVjdC5rZXlzKGdldEdyb3VwKGdyb3VwKSkuZm9yRWFjaCgoZmlsdGVyKSA9PiB7XG4gICAgICAgICAgICBpZiAoZ3JvdXAgPT09IFwiZGF0ZVwiKSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETyBmaWd1cmUgb3V0IHdoeSBcImZpbHRlclwiIGlzIG5ldmVyXG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVyc1tncm91cF1bZmlsdGVyXSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETyBmaWd1cmUgb3V0IHdoeSBcImZpbHRlclwiIGlzIG5ldmVyXG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVyc1tncm91cF1bZmlsdGVyXSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGV4cG9ydHMuZmlsdGVyc1tcImRhdGVcIl1bXCJhbGxcIl0gPSB0cnVlO1xuICAgIHVwZGF0ZUFjdGl2ZSgpO1xuICAgIHNhdmUoKTtcbn0pO1xuJChcIi5wYWdlQWNjb3VudCAudG9wRmlsdGVycyAuYnV0dG9uLmN1cnJlbnRDb25maWdGaWx0ZXJcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIE9iamVjdC5rZXlzKGdldEZpbHRlcnMoKSkuZm9yRWFjaCgoZ3JvdXApID0+IHtcbiAgICAgICAgT2JqZWN0LmtleXMoZ2V0R3JvdXAoZ3JvdXApKS5mb3JFYWNoKChmaWx0ZXIpID0+IHtcbiAgICAgICAgICAgIC8vIFRPRE8gZmlndXJlIG91dCB3aHkgXCJmaWx0ZXJcIiBpcyBuZXZlclxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzW2dyb3VwXVtmaWx0ZXJdID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGV4cG9ydHMuZmlsdGVyc1tcImRpZmZpY3VsdHlcIl1bY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5XSA9IHRydWU7XG4gICAgZXhwb3J0cy5maWx0ZXJzW1wibW9kZVwiXVtjb25maWdfMS5kZWZhdWx0Lm1vZGVdID0gdHJ1ZTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInRpbWVcIikge1xuICAgICAgICBpZiAoWzE1LCAzMCwgNjAsIDEyMF0uaW5jbHVkZXMoY29uZmlnXzEuZGVmYXVsdC50aW1lKSkge1xuICAgICAgICAgICAgY29uc3QgY29uZmlnVGltZSA9IGNvbmZpZ18xLmRlZmF1bHQudGltZTtcbiAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVyc1tcInRpbWVcIl1bY29uZmlnVGltZV0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzW1widGltZVwiXVtcImN1c3RvbVwiXSA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIpIHtcbiAgICAgICAgaWYgKFsxMCwgMjUsIDUwLCAxMDAsIDIwMF0uaW5jbHVkZXMoY29uZmlnXzEuZGVmYXVsdC53b3JkcykpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZ1dvcmRzID0gY29uZmlnXzEuZGVmYXVsdC53b3JkcztcbiAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVyc1tcIndvcmRzXCJdW2NvbmZpZ1dvcmRzXSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBleHBvcnRzLmZpbHRlcnNbXCJ3b3Jkc1wiXVtcImN1c3RvbVwiXSA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInF1b3RlXCIpIHtcbiAgICAgICAgY29uc3QgZmlsdGVyTmFtZSA9IFtcbiAgICAgICAgICAgIFwic2hvcnRcIixcbiAgICAgICAgICAgIFwibWVkaXVtXCIsXG4gICAgICAgICAgICBcImxvbmdcIixcbiAgICAgICAgICAgIFwidGhpY2NcIixcbiAgICAgICAgXTtcbiAgICAgICAgZmlsdGVyTmFtZS5mb3JFYWNoKChxbCwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnF1b3RlTGVuZ3RoLmluY2x1ZGVzKGluZGV4KSkge1xuICAgICAgICAgICAgICAgIGV4cG9ydHMuZmlsdGVyc1tcInF1b3RlTGVuZ3RoXCJdW3FsXSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBleHBvcnRzLmZpbHRlcnNbXCJxdW90ZUxlbmd0aFwiXVtxbF0gPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnB1bmN0dWF0aW9uKSB7XG4gICAgICAgIGV4cG9ydHMuZmlsdGVyc1tcInB1bmN0dWF0aW9uXCJdW1wib25cIl0gPSB0cnVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZXhwb3J0cy5maWx0ZXJzW1wicHVuY3R1YXRpb25cIl1bXCJvZmZcIl0gPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5udW1iZXJzKSB7XG4gICAgICAgIGV4cG9ydHMuZmlsdGVyc1tcIm51bWJlcnNcIl1bXCJvblwiXSA9IHRydWU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBleHBvcnRzLmZpbHRlcnNbXCJudW1iZXJzXCJdW1wib2ZmXCJdID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiICYmIC9lbmdsaXNoLiovLnRlc3QoY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSkpIHtcbiAgICAgICAgZXhwb3J0cy5maWx0ZXJzW1wibGFuZ3VhZ2VcIl1bXCJlbmdsaXNoXCJdID0gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGV4cG9ydHMuZmlsdGVyc1tcImxhbmd1YWdlXCJdW2NvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2VdID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcIm5vbmVcIikge1xuICAgICAgICBleHBvcnRzLmZpbHRlcnMuZnVuYm94Lm5vbmUgPSB0cnVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZXhwb3J0cy5maWx0ZXJzLmZ1bmJveFtjb25maWdfMS5kZWZhdWx0LmZ1bmJveF0gPSB0cnVlO1xuICAgIH1cbiAgICBleHBvcnRzLmZpbHRlcnNbXCJ0YWdzXCJdW1wibm9uZVwiXSA9IHRydWU7XG4gICAgKF9hID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgIGlmICh0YWcuYWN0aXZlID09PSB0cnVlKSB7XG4gICAgICAgICAgICBleHBvcnRzLmZpbHRlcnNbXCJ0YWdzXCJdW1wibm9uZVwiXSA9IGZhbHNlO1xuICAgICAgICAgICAgZXhwb3J0cy5maWx0ZXJzW1widGFnc1wiXVt0YWcuX2lkXSA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBleHBvcnRzLmZpbHRlcnNbXCJkYXRlXCJdW1wiYWxsXCJdID0gdHJ1ZTtcbiAgICB1cGRhdGVBY3RpdmUoKTtcbiAgICBzYXZlKCk7XG59KTtcbiQoXCIucGFnZUFjY291bnQgLnRvcEZpbHRlcnMgLmJ1dHRvbi50b2dnbGVBZHZhbmNlZEZpbHRlcnNcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgJChcIi5wYWdlQWNjb3VudCAuZmlsdGVyQnV0dG9uc1wiKS5zbGlkZVRvZ2dsZSgyNTApO1xuICAgICQoXCIucGFnZUFjY291bnQgLnRvcEZpbHRlcnMgLmJ1dHRvbi50b2dnbGVBZHZhbmNlZEZpbHRlcnNcIikudG9nZ2xlQ2xhc3MoXCJhY3RpdmVcIik7XG59KTtcbk1pc2MuZ2V0TGFuZ3VhZ2VMaXN0KCkudGhlbigobGFuZ3VhZ2VzKSA9PiB7XG4gICAgbGFuZ3VhZ2VzLmZvckVhY2goKGxhbmd1YWdlKSA9PiB7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmNvbnRlbnQgLmZpbHRlckJ1dHRvbnMgLmJ1dHRvbnNBbmRUaXRsZS5sYW5ndWFnZXMgLmJ1dHRvbnNcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwiYnV0dG9uXCIgZmlsdGVyPVwiJHtsYW5ndWFnZX1cIj4ke2xhbmd1YWdlLnJlcGxhY2UoXCJfXCIsIFwiIFwiKX08L2Rpdj5gKTtcbiAgICB9KTtcbn0pO1xuJChcIi5wYWdlQWNjb3VudCAuY29udGVudCAuZmlsdGVyQnV0dG9ucyAuYnV0dG9uc0FuZFRpdGxlLmZ1bmJveCAuYnV0dG9uc1wiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJidXR0b25cIiBmaWx0ZXI9XCJub25lXCI+bm9uZTwvZGl2PmApO1xuTWlzYy5nZXRGdW5ib3hMaXN0KCkudGhlbigoZnVuYm94TW9kZXMpID0+IHtcbiAgICBmdW5ib3hNb2Rlcy5mb3JFYWNoKChmdW5ib3gpID0+IHtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuY29udGVudCAuZmlsdGVyQnV0dG9ucyAuYnV0dG9uc0FuZFRpdGxlLmZ1bmJveCAuYnV0dG9uc1wiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJidXR0b25cIiBmaWx0ZXI9XCIke2Z1bmJveC5uYW1lfVwiPiR7ZnVuYm94Lm5hbWUucmVwbGFjZSgvXy9nLCBcIiBcIil9PC9kaXY+YCk7XG4gICAgfSk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuZnVuY3Rpb24gc2hvdygpIHtcbiAgICAvLyAkKFwiLnNpZ25PdXRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIikuY3NzKFwib3BhY2l0eVwiLCAxKTtcbiAgICAkKFwiLnNpZ25PdXRcIilcbiAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgIC5jc3Moe1xuICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB0cmFuc2l0aW9uOiBcIjBzXCIsXG4gICAgfSlcbiAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiAxLFxuICAgIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAkKFwiLnNpZ25PdXRcIikuY3NzKHsgdHJhbnNpdGlvbjogXCIwLjI1c1wiIH0pO1xuICAgIH0pO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgJChcIi5zaWduT3V0XCIpXG4gICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgIC5jc3Moe1xuICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICB0cmFuc2l0aW9uOiBcIjBzXCIsXG4gICAgfSlcbiAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiAwLFxuICAgIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAkKFwiLnNpZ25PdXRcIikuY3NzKHsgdHJhbnNpdGlvbjogXCIwLjI1c1wiIH0pO1xuICAgICAgICAkKFwiLnNpZ25PdXRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfSk7XG4gICAgLy8gJChcIi5zaWduT3V0XCIpLmNzcyhcIm9wYWNpdHlcIiwgMCkuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuLy8gJChcIiNsaXZlV3BtXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpLmNzcyhcIm9wYWNpdHlcIiwgMCkuYW5pbWF0ZShcbi8vICAge1xuLy8gICAgIG9wYWNpdHk6IENvbmZpZy50aW1lck9wYWNpdHksXG4vLyAgIH0sXG4vLyAgIDEyNVxuLy8gKTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBCQVNFX1BBVEggPSBcIi9hcGUta2V5c1wiO1xuZnVuY3Rpb24gZ2V0QXBlS2V5c0VuZHBvaW50cyhhcGVDbGllbnQpIHtcbiAgICBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmdldChCQVNFX1BBVEgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZ2VuZXJhdGUobmFtZSwgZW5hYmxlZCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHsgbmFtZSwgZW5hYmxlZCB9O1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wb3N0KEJBU0VfUEFUSCwgeyBwYXlsb2FkIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gdXBkYXRlKGFwZUtleUlkLCB1cGRhdGVzKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0gT2JqZWN0LmFzc2lnbih7fSwgdXBkYXRlcyk7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBhdGNoKGAke0JBU0VfUEFUSH0vJHthcGVLZXlJZH1gLCB7IHBheWxvYWQgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBfZGVsZXRlKGFwZUtleUlkKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmRlbGV0ZShgJHtCQVNFX1BBVEh9LyR7YXBlS2V5SWR9YCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBnZXQsXG4gICAgICAgIGdlbmVyYXRlLFxuICAgICAgICB1cGRhdGUsXG4gICAgICAgIGRlbGV0ZTogX2RlbGV0ZSxcbiAgICB9O1xufVxuZXhwb3J0cy5kZWZhdWx0ID0gZ2V0QXBlS2V5c0VuZHBvaW50cztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBCQVNFX1BBVEggPSBcIi9jb25maWdzXCI7XG5mdW5jdGlvbiBnZXRDb25maWdzRW5kcG9pbnRzKGFwZUNsaWVudCkge1xuICAgIGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZ2V0KEJBU0VfUEFUSCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBzYXZlKGNvbmZpZykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wYXRjaChCQVNFX1BBVEgsIHsgcGF5bG9hZDogeyBjb25maWcgfSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIGdldCxcbiAgICAgICAgc2F2ZSxcbiAgICB9O1xufVxuZXhwb3J0cy5kZWZhdWx0ID0gZ2V0Q29uZmlnc0VuZHBvaW50cztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgY29uZmlnc18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL2NvbmZpZ3NcIikpO1xuY29uc3QgbGVhZGVyYm9hcmRzXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vbGVhZGVyYm9hcmRzXCIpKTtcbmNvbnN0IHByZXNldHNfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9wcmVzZXRzXCIpKTtcbmNvbnN0IHBzYXNfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9wc2FzXCIpKTtcbmNvbnN0IHF1b3Rlc18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL3F1b3Rlc1wiKSk7XG5jb25zdCByZXN1bHRzXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vcmVzdWx0c1wiKSk7XG5jb25zdCB1c2Vyc18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL3VzZXJzXCIpKTtcbmNvbnN0IGFwZV9rZXlzXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vYXBlLWtleXNcIikpO1xuZXhwb3J0cy5kZWZhdWx0ID0ge1xuICAgIGdldENvbmZpZ3NFbmRwb2ludHM6IGNvbmZpZ3NfMS5kZWZhdWx0LFxuICAgIGdldExlYWRlcmJvYXJkc0VuZHBvaW50czogbGVhZGVyYm9hcmRzXzEuZGVmYXVsdCxcbiAgICBnZXRQcmVzZXRzRW5kcG9pbnRzOiBwcmVzZXRzXzEuZGVmYXVsdCxcbiAgICBnZXRQc2FzRW5kcG9pbnRzOiBwc2FzXzEuZGVmYXVsdCxcbiAgICBnZXRRdW90ZXNFbmRwb2ludHM6IHF1b3Rlc18xLmRlZmF1bHQsXG4gICAgZ2V0UmVzdWx0c0VuZHBvaW50czogcmVzdWx0c18xLmRlZmF1bHQsXG4gICAgZ2V0VXNlcnNFbmRwb2ludHM6IHVzZXJzXzEuZGVmYXVsdCxcbiAgICBnZXRBcGVLZXlzRW5kcG9pbnRzOiBhcGVfa2V5c18xLmRlZmF1bHQsXG59O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IEJBU0VfUEFUSCA9IFwiL2xlYWRlcmJvYXJkc1wiO1xuZnVuY3Rpb24gZ2V0TGVhZGVyYm9hcmRzRW5kcG9pbnRzKGFwZUNsaWVudCkge1xuICAgIGZ1bmN0aW9uIGdldChsYW5ndWFnZSwgbW9kZSwgbW9kZTIsIHNraXAgPSAwLCBsaW1pdCA9IDUwKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBzZWFyY2hRdWVyeSA9IHtcbiAgICAgICAgICAgICAgICBsYW5ndWFnZSxcbiAgICAgICAgICAgICAgICBtb2RlLFxuICAgICAgICAgICAgICAgIG1vZGUyLFxuICAgICAgICAgICAgICAgIHNraXAsXG4gICAgICAgICAgICAgICAgbGltaXQ6IE1hdGgubWF4KE1hdGgubWluKGxpbWl0LCA1MCksIDApLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZ2V0KEJBU0VfUEFUSCwgeyBzZWFyY2hRdWVyeSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGdldFJhbmsobGFuZ3VhZ2UsIG1vZGUsIG1vZGUyKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBzZWFyY2hRdWVyeSA9IHtcbiAgICAgICAgICAgICAgICBsYW5ndWFnZSxcbiAgICAgICAgICAgICAgICBtb2RlLFxuICAgICAgICAgICAgICAgIG1vZGUyLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZ2V0KGAke0JBU0VfUEFUSH0vcmFua2AsIHsgc2VhcmNoUXVlcnkgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4geyBnZXQsIGdldFJhbmsgfTtcbn1cbmV4cG9ydHMuZGVmYXVsdCA9IGdldExlYWRlcmJvYXJkc0VuZHBvaW50cztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBCQVNFX1BBVEggPSBcIi9wcmVzZXRzXCI7XG5mdW5jdGlvbiBnZXRQcmVzZXRzRW5kcG9pbnRzKGFwZUNsaWVudCkge1xuICAgIGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZ2V0KEJBU0VfUEFUSCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBhZGQocHJlc2V0TmFtZSwgY29uZmlnQ2hhbmdlcykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiBwcmVzZXROYW1lLFxuICAgICAgICAgICAgICAgIGNvbmZpZzogY29uZmlnQ2hhbmdlcyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBvc3QoQkFTRV9QQVRILCB7IHBheWxvYWQgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBlZGl0KHByZXNldElkLCBwcmVzZXROYW1lLCBjb25maWdDaGFuZ2VzKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICAgICAgICAgIF9pZDogcHJlc2V0SWQsXG4gICAgICAgICAgICAgICAgbmFtZTogcHJlc2V0TmFtZSxcbiAgICAgICAgICAgICAgICBjb25maWc6IGNvbmZpZ0NoYW5nZXMsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wYXRjaChCQVNFX1BBVEgsIHsgcGF5bG9hZCB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIF9kZWxldGUocHJlc2V0SWQpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZGVsZXRlKGAke0JBU0VfUEFUSH0vJHtwcmVzZXRJZH1gKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiB7IGdldCwgYWRkLCBlZGl0LCBkZWxldGU6IF9kZWxldGUgfTtcbn1cbmV4cG9ydHMuZGVmYXVsdCA9IGdldFByZXNldHNFbmRwb2ludHM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgdmVyc2lvbl8xID0gcmVxdWlyZShcIi4uLy4uL3ZlcnNpb25cIik7XG5jb25zdCBCQVNFX1BBVEggPSBcIi9wc2FzXCI7XG5mdW5jdGlvbiBnZXRQc2FzRW5kcG9pbnRzKGFwZUNsaWVudCkge1xuICAgIGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZ2V0KEJBU0VfUEFUSCwge1xuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJDbGllbnQtVmVyc2lvblwiOiB2ZXJzaW9uXzEuQ0xJRU5UX1ZFUlNJT04sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHsgZ2V0IH07XG59XG5leHBvcnRzLmRlZmF1bHQgPSBnZXRQc2FzRW5kcG9pbnRzO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IEJBU0VfUEFUSCA9IFwiL3F1b3Rlc1wiO1xuZnVuY3Rpb24gZ2V0UXVvdGVzRW5kcG9pbnRzKGFwZUNsaWVudCkge1xuICAgIGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZ2V0KEJBU0VfUEFUSCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBzdWJtaXQodGV4dCwgc291cmNlLCBsYW5ndWFnZSwgY2FwdGNoYSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgICAgICB0ZXh0LFxuICAgICAgICAgICAgICAgIHNvdXJjZSxcbiAgICAgICAgICAgICAgICBsYW5ndWFnZSxcbiAgICAgICAgICAgICAgICBjYXB0Y2hhLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucG9zdChCQVNFX1BBVEgsIHsgcGF5bG9hZCB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGFwcHJvdmVTdWJtaXNzaW9uKHF1b3RlU3VibWlzc2lvbklkLCBlZGl0VGV4dCwgZWRpdFNvdXJjZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgICAgICBxdW90ZUlkOiBxdW90ZVN1Ym1pc3Npb25JZCxcbiAgICAgICAgICAgICAgICBlZGl0VGV4dCxcbiAgICAgICAgICAgICAgICBlZGl0U291cmNlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucG9zdChgJHtCQVNFX1BBVEh9L2FwcHJvdmVgLCB7IHBheWxvYWQgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiByZWplY3RTdWJtaXNzaW9uKHF1b3RlU3VibWlzc2lvbklkKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBvc3QoYCR7QkFTRV9QQVRIfS9yZWplY3RgLCB7XG4gICAgICAgICAgICAgICAgcGF5bG9hZDogeyBxdW90ZUlkOiBxdW90ZVN1Ym1pc3Npb25JZCB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBnZXRSYXRpbmcocXVvdGUpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlYXJjaFF1ZXJ5ID0ge1xuICAgICAgICAgICAgICAgIHF1b3RlSWQ6IHF1b3RlLmlkLFxuICAgICAgICAgICAgICAgIGxhbmd1YWdlOiBxdW90ZS5sYW5ndWFnZSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmdldChgJHtCQVNFX1BBVEh9L3JhdGluZ2AsIHsgc2VhcmNoUXVlcnkgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBhZGRSYXRpbmcocXVvdGUsIHJhdGluZykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgICAgICBxdW90ZUlkOiBxdW90ZS5pZCxcbiAgICAgICAgICAgICAgICByYXRpbmcsXG4gICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IHF1b3RlLmxhbmd1YWdlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucG9zdChgJHtCQVNFX1BBVEh9L3JhdGluZ2AsIHsgcGF5bG9hZCB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHJlcG9ydChxdW90ZUlkLCBxdW90ZUxhbmd1YWdlLCByZWFzb24sIGNvbW1lbnQsIGNhcHRjaGEpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgcXVvdGVJZCxcbiAgICAgICAgICAgICAgICBxdW90ZUxhbmd1YWdlLFxuICAgICAgICAgICAgICAgIHJlYXNvbixcbiAgICAgICAgICAgICAgICBjb21tZW50LFxuICAgICAgICAgICAgICAgIGNhcHRjaGEsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wb3N0KGAke0JBU0VfUEFUSH0vcmVwb3J0YCwgeyBwYXlsb2FkIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0LFxuICAgICAgICBzdWJtaXQsXG4gICAgICAgIGFwcHJvdmVTdWJtaXNzaW9uLFxuICAgICAgICByZWplY3RTdWJtaXNzaW9uLFxuICAgICAgICBnZXRSYXRpbmcsXG4gICAgICAgIGFkZFJhdGluZyxcbiAgICAgICAgcmVwb3J0LFxuICAgIH07XG59XG5leHBvcnRzLmRlZmF1bHQgPSBnZXRRdW90ZXNFbmRwb2ludHM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgdmVyc2lvbl8xID0gcmVxdWlyZShcIi4uLy4uL3ZlcnNpb25cIik7XG5jb25zdCBCQVNFX1BBVEggPSBcIi9yZXN1bHRzXCI7XG5mdW5jdGlvbiBnZXRSZXN1bHRzRW5kcG9pbnRzKGFwZUNsaWVudCkge1xuICAgIGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZ2V0KEJBU0VfUEFUSCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBzYXZlKHJlc3VsdCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wb3N0KEJBU0VfUEFUSCwge1xuICAgICAgICAgICAgICAgIHBheWxvYWQ6IHsgcmVzdWx0IH0sXG4gICAgICAgICAgICAgICAgaGVhZGVyczogeyBcIkNsaWVudC1WZXJzaW9uXCI6IHZlcnNpb25fMS5DTElFTlRfVkVSU0lPTiB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiB1cGRhdGVUYWdzKHJlc3VsdElkLCB0YWdJZHMpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucGF0Y2goYCR7QkFTRV9QQVRIfS90YWdzYCwge1xuICAgICAgICAgICAgICAgIHBheWxvYWQ6IHsgcmVzdWx0SWQsIHRhZ0lkcyB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBkZWxldGVBbGwoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmRlbGV0ZShCQVNFX1BBVEgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHsgZ2V0LCBzYXZlLCB1cGRhdGVUYWdzLCBkZWxldGVBbGwgfTtcbn1cbmV4cG9ydHMuZGVmYXVsdCA9IGdldFJlc3VsdHNFbmRwb2ludHM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgQkFTRV9QQVRIID0gXCIvdXNlcnNcIjtcbmZ1bmN0aW9uIGdldFVzZXJzRW5kcG9pbnRzKGFwZUNsaWVudCkge1xuICAgIGZ1bmN0aW9uIGdldERhdGEoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmdldChCQVNFX1BBVEgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gY3JlYXRlKG5hbWUsIGVtYWlsLCB1aWQpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgZW1haWwsXG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICB1aWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wb3N0KGAke0JBU0VfUEFUSH0vc2lnbnVwYCwgeyBwYXlsb2FkIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZ2V0TmFtZUF2YWlsYWJpbGl0eShuYW1lKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmdldChgJHtCQVNFX1BBVEh9L2NoZWNrTmFtZS8ke25hbWV9YCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBfZGVsZXRlKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5kZWxldGUoQkFTRV9QQVRIKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHVwZGF0ZU5hbWUobmFtZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5wYXRjaChgJHtCQVNFX1BBVEh9L25hbWVgLCB7IHBheWxvYWQ6IHsgbmFtZSB9IH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gdXBkYXRlTGVhZGVyYm9hcmRNZW1vcnkobW9kZSwgbW9kZTIsIGxhbmd1YWdlLCByYW5rKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICAgICAgICAgIG1vZGUsXG4gICAgICAgICAgICAgICAgbW9kZTIsXG4gICAgICAgICAgICAgICAgbGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgcmFuayxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBhdGNoKGAke0JBU0VfUEFUSH0vbGVhZGVyYm9hcmRNZW1vcnlgLCB7IHBheWxvYWQgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiB1cGRhdGVFbWFpbChuZXdFbWFpbCwgcHJldmlvdXNFbWFpbCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgICAgICBuZXdFbWFpbCxcbiAgICAgICAgICAgICAgICBwcmV2aW91c0VtYWlsLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucGF0Y2goYCR7QkFTRV9QQVRIfS9lbWFpbGAsIHsgcGF5bG9hZCB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGRlbGV0ZVBlcnNvbmFsQmVzdHMoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmRlbGV0ZShgJHtCQVNFX1BBVEh9L3BlcnNvbmFsQmVzdHNgKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGdldFRhZ3MoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LmdldChgJHtCQVNFX1BBVEh9L3RhZ3NgKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGNyZWF0ZVRhZyh0YWdOYW1lKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBvc3QoYCR7QkFTRV9QQVRIfS90YWdzYCwgeyBwYXlsb2FkOiB7IHRhZ05hbWUgfSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGVkaXRUYWcodGFnSWQsIG5ld05hbWUpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgdGFnSWQsXG4gICAgICAgICAgICAgICAgbmV3TmFtZSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4geWllbGQgYXBlQ2xpZW50LnBhdGNoKGAke0JBU0VfUEFUSH0vdGFnc2AsIHsgcGF5bG9hZCB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGRlbGV0ZVRhZyh0YWdJZCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5kZWxldGUoYCR7QkFTRV9QQVRIfS90YWdzLyR7dGFnSWR9YCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBkZWxldGVUYWdQZXJzb25hbEJlc3QodGFnSWQpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZGVsZXRlKGAke0JBU0VfUEFUSH0vdGFncy8ke3RhZ0lkfS9wZXJzb25hbEJlc3RgKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGdldEN1c3RvbVRoZW1lcygpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQuZ2V0KGAke0JBU0VfUEFUSH0vY3VzdG9tVGhlbWVzYCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBlZGl0Q3VzdG9tVGhlbWUodGhlbWVJZCwgbmV3VGhlbWUpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgdGhlbWVJZDogdGhlbWVJZCxcbiAgICAgICAgICAgICAgICB0aGVtZToge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBuZXdUaGVtZS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBjb2xvcnM6IG5ld1RoZW1lLmNvbG9ycyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucGF0Y2goYCR7QkFTRV9QQVRIfS9jdXN0b21UaGVtZXNgLCB7IHBheWxvYWQgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBkZWxldGVDdXN0b21UaGVtZSh0aGVtZUlkKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICAgICAgICAgIHRoZW1lSWQ6IHRoZW1lSWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkIGFwZUNsaWVudC5kZWxldGUoYCR7QkFTRV9QQVRIfS9jdXN0b21UaGVtZXNgLCB7IHBheWxvYWQgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBhZGRDdXN0b21UaGVtZShuZXdUaGVtZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHsgbmFtZTogbmV3VGhlbWUubmFtZSwgY29sb3JzOiBuZXdUaGVtZS5jb2xvcnMgfTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucG9zdChgJHtCQVNFX1BBVEh9L2N1c3RvbVRoZW1lc2AsIHsgcGF5bG9hZCB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGxpbmtEaXNjb3JkKGRhdGEpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucG9zdChgJHtCQVNFX1BBVEh9L2Rpc2NvcmQvbGlua2AsIHtcbiAgICAgICAgICAgICAgICBwYXlsb2FkOiB7IGRhdGEgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gdW5saW5rRGlzY29yZCgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCBhcGVDbGllbnQucG9zdChgJHtCQVNFX1BBVEh9L2Rpc2NvcmQvdW5saW5rYCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBnZXREYXRhLFxuICAgICAgICBjcmVhdGUsXG4gICAgICAgIGdldE5hbWVBdmFpbGFiaWxpdHksXG4gICAgICAgIGRlbGV0ZTogX2RlbGV0ZSxcbiAgICAgICAgdXBkYXRlTmFtZSxcbiAgICAgICAgdXBkYXRlTGVhZGVyYm9hcmRNZW1vcnksXG4gICAgICAgIHVwZGF0ZUVtYWlsLFxuICAgICAgICBkZWxldGVQZXJzb25hbEJlc3RzLFxuICAgICAgICBnZXRUYWdzLFxuICAgICAgICBjcmVhdGVUYWcsXG4gICAgICAgIGVkaXRUYWcsXG4gICAgICAgIGRlbGV0ZVRhZyxcbiAgICAgICAgZGVsZXRlVGFnUGVyc29uYWxCZXN0LFxuICAgICAgICBsaW5rRGlzY29yZCxcbiAgICAgICAgdW5saW5rRGlzY29yZCxcbiAgICAgICAgZ2V0Q3VzdG9tVGhlbWVzLFxuICAgICAgICBhZGRDdXN0b21UaGVtZSxcbiAgICAgICAgZWRpdEN1c3RvbVRoZW1lLFxuICAgICAgICBkZWxldGVDdXN0b21UaGVtZSxcbiAgICB9O1xufVxuZXhwb3J0cy5kZWZhdWx0ID0gZ2V0VXNlcnNFbmRwb2ludHM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgYXhpb3NfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiYXhpb3NcIikpO1xuY29uc3QgZW5kcG9pbnRzXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vZW5kcG9pbnRzXCIpKTtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi4vZmlyZWJhc2VcIik7XG5jb25zdCBhdXRoXzEgPSByZXF1aXJlKFwiZmlyZWJhc2UvYXV0aFwiKTtcbmNvbnN0IERFVl9TRVJWRVJfSE9TVCA9IFwiaHR0cDovL2xvY2FsaG9zdDo1MDA1XCI7XG5jb25zdCBQUk9EX1NFUlZFUl9IT1NUID0gXCJodHRwczovL2FwaS5tb25rZXl0eXBlLmNvbVwiO1xuY29uc3QgQVBJX1BBVEggPSBcIlwiO1xuY29uc3QgQkFTRV9VUkwgPSB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgPT09IFwibG9jYWxob3N0XCIgPyBERVZfU0VSVkVSX0hPU1QgOiBQUk9EX1NFUlZFUl9IT1NUO1xuY29uc3QgQVBJX1VSTCA9IGAke0JBU0VfVVJMfSR7QVBJX1BBVEh9YDtcbi8vIEFkYXB0cyB0aGUgYXBlIGNsaWVudCdzIHZpZXcgb2YgcmVxdWVzdCBvcHRpb25zIHRvIHRoZSB1bmRlcmx5aW5nIEhUVFAgY2xpZW50LlxuZnVuY3Rpb24gYWRhcHRSZXF1ZXN0T3B0aW9ucyhvcHRpb25zKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgY3VycmVudFVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgICAgIGNvbnN0IGlkVG9rZW4gPSBjdXJyZW50VXNlciAmJiAoeWllbGQgKDAsIGF1dGhfMS5nZXRJZFRva2VuKShjdXJyZW50VXNlcikpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcGFyYW1zOiBvcHRpb25zLnNlYXJjaFF1ZXJ5LFxuICAgICAgICAgICAgZGF0YTogb3B0aW9ucy5wYXlsb2FkLFxuICAgICAgICAgICAgaGVhZGVyczogT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMuaGVhZGVycyksIHsgQWNjZXB0OiBcImFwcGxpY2F0aW9uL2pzb25cIiwgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIgfSksIChpZFRva2VuICYmIHsgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2lkVG9rZW59YCB9KSksXG4gICAgICAgIH07XG4gICAgfSk7XG59XG4vLyBXcmFwIHRoZSB1bmRlcmx5aW5nIEhUVFAgY2xpZW50J3MgbWV0aG9kIHdpdGggb3VyIG93bi5cbmZ1bmN0aW9uIGFwZWlmeUNsaWVudE1ldGhvZChjbGllbnRNZXRob2QsIG1ldGhvZFR5cGUpIHtcbiAgICByZXR1cm4gKGVuZHBvaW50LCBvcHRpb25zID0ge30pID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgICAgIGxldCBlcnJvck1lc3NhZ2UgPSBcIlwiO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVxdWVzdE9wdGlvbnMgPSB5aWVsZCBhZGFwdFJlcXVlc3RPcHRpb25zKG9wdGlvbnMpO1xuICAgICAgICAgICAgbGV0IHJlc3BvbnNlO1xuICAgICAgICAgICAgaWYgKG1ldGhvZFR5cGUgPT09IFwiZ2V0XCIgfHwgbWV0aG9kVHlwZSA9PT0gXCJkZWxldGVcIikge1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlID0geWllbGQgY2xpZW50TWV0aG9kKGVuZHBvaW50LCByZXF1ZXN0T3B0aW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHlpZWxkIGNsaWVudE1ldGhvZChlbmRwb2ludCwgcmVxdWVzdE9wdGlvbnMuZGF0YSwgcmVxdWVzdE9wdGlvbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgeyBtZXNzYWdlLCBkYXRhIH0gPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlLFxuICAgICAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICBjb25zdCB0eXBlZEVycm9yID0gZXJyb3I7XG4gICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSB0eXBlZEVycm9yLm1lc3NhZ2U7XG4gICAgICAgICAgICBpZiAoYXhpb3NfMS5kZWZhdWx0LmlzQXhpb3NFcnJvcih0eXBlZEVycm9yKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHsgc3RhdHVzOiAoX2IgPSAoX2EgPSB0eXBlZEVycm9yLnJlc3BvbnNlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhdHVzKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiA1MDAsIG1lc3NhZ2U6IHR5cGVkRXJyb3IubWVzc2FnZSB9LCAoX2MgPSB0eXBlZEVycm9yLnJlc3BvbnNlKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN0YXR1czogNTAwLFxuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3JNZXNzYWdlLFxuICAgICAgICB9O1xuICAgIH0pO1xufVxuY29uc3QgYXhpb3NDbGllbnQgPSBheGlvc18xLmRlZmF1bHQuY3JlYXRlKHtcbiAgICBiYXNlVVJMOiBBUElfVVJMLFxuICAgIHRpbWVvdXQ6IDEwMDAwLFxufSk7XG5jb25zdCBhcGVDbGllbnQgPSB7XG4gICAgZ2V0OiBhcGVpZnlDbGllbnRNZXRob2QoYXhpb3NDbGllbnQuZ2V0LCBcImdldFwiKSxcbiAgICBwb3N0OiBhcGVpZnlDbGllbnRNZXRob2QoYXhpb3NDbGllbnQucG9zdCwgXCJwb3N0XCIpLFxuICAgIHB1dDogYXBlaWZ5Q2xpZW50TWV0aG9kKGF4aW9zQ2xpZW50LnB1dCwgXCJwdXRcIiksXG4gICAgcGF0Y2g6IGFwZWlmeUNsaWVudE1ldGhvZChheGlvc0NsaWVudC5wYXRjaCwgXCJwYXRjaFwiKSxcbiAgICBkZWxldGU6IGFwZWlmeUNsaWVudE1ldGhvZChheGlvc0NsaWVudC5kZWxldGUsIFwiZGVsZXRlXCIpLFxufTtcbi8vIEFQSSBFbmRwb2ludHNcbmNvbnN0IEFwZSA9IHtcbiAgICB1c2VyczogZW5kcG9pbnRzXzEuZGVmYXVsdC5nZXRVc2Vyc0VuZHBvaW50cyhhcGVDbGllbnQpLFxuICAgIGNvbmZpZ3M6IGVuZHBvaW50c18xLmRlZmF1bHQuZ2V0Q29uZmlnc0VuZHBvaW50cyhhcGVDbGllbnQpLFxuICAgIHJlc3VsdHM6IGVuZHBvaW50c18xLmRlZmF1bHQuZ2V0UmVzdWx0c0VuZHBvaW50cyhhcGVDbGllbnQpLFxuICAgIHBzYXM6IGVuZHBvaW50c18xLmRlZmF1bHQuZ2V0UHNhc0VuZHBvaW50cyhhcGVDbGllbnQpLFxuICAgIHF1b3RlczogZW5kcG9pbnRzXzEuZGVmYXVsdC5nZXRRdW90ZXNFbmRwb2ludHMoYXBlQ2xpZW50KSxcbiAgICBsZWFkZXJib2FyZHM6IGVuZHBvaW50c18xLmRlZmF1bHQuZ2V0TGVhZGVyYm9hcmRzRW5kcG9pbnRzKGFwZUNsaWVudCksXG4gICAgcHJlc2V0czogZW5kcG9pbnRzXzEuZGVmYXVsdC5nZXRQcmVzZXRzRW5kcG9pbnRzKGFwZUNsaWVudCksXG4gICAgYXBlS2V5czogZW5kcG9pbnRzXzEuZGVmYXVsdC5nZXRBcGVLZXlzRW5kcG9pbnRzKGFwZUNsaWVudCksXG59O1xuZXhwb3J0cy5kZWZhdWx0ID0gQXBlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5pc0NvbmZpZ1ZhbHVlVmFsaWRBc3luYyA9IGV4cG9ydHMuaXNDb25maWdWYWx1ZVZhbGlkID0gZXhwb3J0cy5pc0NvbmZpZ0tleVZhbGlkID0gdm9pZCAwO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5mdW5jdGlvbiBpc0NvbmZpZ0tleVZhbGlkKG5hbWUpIHtcbiAgICBpZiAobmFtZSA9PT0gbnVsbCB8fCBuYW1lID09PSB1bmRlZmluZWQgfHwgbmFtZSA9PT0gXCJcIilcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChuYW1lLmxlbmd0aCA+IDMwKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIC9eWzAtOWEtekEtWl8uXFwtIytdKyQvLnRlc3QobmFtZSk7XG59XG5leHBvcnRzLmlzQ29uZmlnS2V5VmFsaWQgPSBpc0NvbmZpZ0tleVZhbGlkO1xuZnVuY3Rpb24gaW52YWxpZChrZXksIHZhbCwgY3VzdG9tTWVzc2FnZSkge1xuICAgIGlmIChjdXN0b21NZXNzYWdlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoYEludmFsaWQgdmFsdWUgZm9yICR7a2V5fSAoJHt2YWx9KS4gUGxlYXNlIHRyeSB0byBjaGFuZ2UgdGhpcyBzZXR0aW5nIGFnYWluLmAsIC0xKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGBJbnZhbGlkIHZhbHVlIGZvciAke2tleX0gKCR7dmFsfSkuICR7Y3VzdG9tTWVzc2FnZX1gLCAtMSk7XG4gICAgfVxuICAgIGNvbnNvbGUuZXJyb3IoYEludmFsaWQgdmFsdWUga2V5ICR7a2V5fSB2YWx1ZSAke3ZhbH0gdHlwZSAke3R5cGVvZiB2YWx9YCk7XG59XG5mdW5jdGlvbiBpc0FycmF5KHZhbCkge1xuICAgIHJldHVybiB2YWwgaW5zdGFuY2VvZiBBcnJheTtcbn1cbmZ1bmN0aW9uIGlzQ29uZmlnVmFsdWVWYWxpZChrZXksIHZhbCwgcG9zc2libGVUeXBlcykge1xuICAgIGxldCBpc1ZhbGlkID0gZmFsc2U7XG4gICAgLy8gbWlnaHQgYmUgdXNlZCBpbiB0aGUgZnV0dXJlXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgbGV0IGN1c3RvbU1lc3NhZ2UgPSB1bmRlZmluZWQ7XG4gICAgZm9yIChjb25zdCBwb3NzaWJsZVR5cGUgb2YgcG9zc2libGVUeXBlcykge1xuICAgICAgICBzd2l0Y2ggKHBvc3NpYmxlVHlwZSkge1xuICAgICAgICAgICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gXCJib29sZWFuXCIpXG4gICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIm51bGxcIjpcbiAgICAgICAgICAgICAgICBpZiAodmFsID09PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJudW1iZXJcIjpcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gXCJudW1iZXJcIilcbiAgICAgICAgICAgICAgICAgICAgaXNWYWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibnVtYmVyQXJyYXlcIjpcbiAgICAgICAgICAgICAgICBpZiAoaXNBcnJheSh2YWwpICYmIHZhbC5ldmVyeSgodikgPT4gdHlwZW9mIHYgPT09IFwibnVtYmVyXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJzdHJpbmdcIjpcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gXCJzdHJpbmdcIilcbiAgICAgICAgICAgICAgICAgICAgaXNWYWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwic3RyaW5nQXJyYXlcIjpcbiAgICAgICAgICAgICAgICBpZiAoaXNBcnJheSh2YWwpICYmIHZhbC5ldmVyeSgodikgPT4gdHlwZW9mIHYgPT09IFwic3RyaW5nXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjpcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gXCJ1bmRlZmluZWRcIiB8fCB2YWwgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgaXNWYWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGlmIChpc0FycmF5KHBvc3NpYmxlVHlwZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBvc3NpYmxlVHlwZS5pbmNsdWRlcyh2YWwpKVxuICAgICAgICAgICAgICAgICAgICAgICAgaXNWYWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICghaXNWYWxpZClcbiAgICAgICAgaW52YWxpZChrZXksIHZhbCwgY3VzdG9tTWVzc2FnZSk7XG4gICAgcmV0dXJuIGlzVmFsaWQ7XG59XG5leHBvcnRzLmlzQ29uZmlnVmFsdWVWYWxpZCA9IGlzQ29uZmlnVmFsdWVWYWxpZDtcbmZ1bmN0aW9uIGlzQ29uZmlnVmFsdWVWYWxpZEFzeW5jKGtleSwgdmFsLCBwb3NzaWJsZVR5cGVzKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgbGV0IGlzVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgbGV0IGN1c3RvbU1lc3NhZ2UgPSB1bmRlZmluZWQ7XG4gICAgICAgIGZvciAoY29uc3QgcG9zc2libGVUeXBlIG9mIHBvc3NpYmxlVHlwZXMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAocG9zc2libGVUeXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcImxheW91dGZsdWlkXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWwgIT09IFwic3RyaW5nXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGF5b3V0TmFtZXMgPSB2YWwuc3BsaXQoL1sjIF0rLyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsYXlvdXROYW1lcy5sZW5ndGggPCAyIHx8IGxheW91dE5hbWVzLmxlbmd0aCA+IDUpXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgLy8gY29udmVydCB0aGUgbGF5b3V0IG5hbWVzIHRvIGxheW91dHNcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGF5b3V0cyA9IHlpZWxkIFByb21pc2UuYWxsKGxheW91dE5hbWVzLm1hcCgobGF5b3V0TmFtZSkgPT4gTWlzYy5nZXRMYXlvdXQobGF5b3V0TmFtZSkpKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgaWYgYWxsIGxheW91dHMgZXhpc3RcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFsYXlvdXRzLmV2ZXJ5KChsYXlvdXQpID0+IGxheW91dCAhPT0gdW5kZWZpbmVkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW52YWxpZExheW91dE5hbWVzID0gbGF5b3V0TmFtZXMubWFwKChsYXlvdXROYW1lLCBpbmRleCkgPT4gW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dE5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5b3V0c1tpbmRleF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGludmFsaWRMYXlvdXRzID0gaW52YWxpZExheW91dE5hbWVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigoW18sIGxheW91dF0pID0+IGxheW91dCA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKFtsYXlvdXROYW1lXSkgPT4gbGF5b3V0TmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21NZXNzYWdlID0gYFRoZSBmb2xsb3dpbmcgaW5wdXR0ZWQgbGF5b3V0cyBkbyBub3QgZXhpc3Q6ICR7aW52YWxpZExheW91dHMuam9pbihcIiwgXCIpfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghaXNWYWxpZClcbiAgICAgICAgICAgIGludmFsaWQoa2V5LCB2YWwsIGN1c3RvbU1lc3NhZ2UpO1xuICAgICAgICByZXR1cm4gaXNWYWxpZDtcbiAgICB9KTtcbn1cbmV4cG9ydHMuaXNDb25maWdWYWx1ZVZhbGlkQXN5bmMgPSBpc0NvbmZpZ1ZhbHVlVmFsaWRBc3luYztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2V0U2hvd0xpdmVBY2MgPSBleHBvcnRzLnNldFNob3dMaXZlV3BtID0gZXhwb3J0cy5zZXRTaG93VGltZXJQcm9ncmVzcyA9IGV4cG9ydHMuc2V0UGFjZUNhcmV0U3R5bGUgPSBleHBvcnRzLnNldENhcmV0U3R5bGUgPSBleHBvcnRzLnNldFBhZ2VXaWR0aCA9IGV4cG9ydHMuc2V0T3Bwb3NpdGVTaGlmdE1vZGUgPSBleHBvcnRzLnNldFN0cmljdFNwYWNlID0gZXhwb3J0cy5zZXRDb2xvcmZ1bE1vZGUgPSBleHBvcnRzLnNldEZsaXBUZXN0Q29sb3JzID0gZXhwb3J0cy5zZXRSZXBlYXRRdW90ZXMgPSBleHBvcnRzLnNldEVuYWJsZUFkcyA9IGV4cG9ydHMuc2V0UXVpY2tFbmQgPSBleHBvcnRzLnNldFNob3dBbGxMaW5lcyA9IGV4cG9ydHMuc2V0Q2Fwc0xvY2tXYXJuaW5nID0gZXhwb3J0cy5zZXRTaW5nbGVMaXN0Q29tbWFuZExpbmUgPSBleHBvcnRzLnNldEFsd2F5c1Nob3dXb3Jkc0hpc3RvcnkgPSBleHBvcnRzLnNldE1pbkJ1cnN0Q3VzdG9tU3BlZWQgPSBleHBvcnRzLnNldE1pbkJ1cnN0ID0gZXhwb3J0cy5zZXRNaW5BY2NDdXN0b20gPSBleHBvcnRzLnNldE1pbkFjYyA9IGV4cG9ydHMuc2V0TWluV3BtQ3VzdG9tU3BlZWQgPSBleHBvcnRzLnNldE1pbldwbSA9IGV4cG9ydHMuc2V0UmVwZWF0ZWRQYWNlID0gZXhwb3J0cy5zZXRQYWNlQ2FyZXRDdXN0b21TcGVlZCA9IGV4cG9ydHMuc2V0UGFjZUNhcmV0ID0gZXhwb3J0cy5zZXRTd2FwRXNjQW5kVGFiID0gZXhwb3J0cy5zZXRTaG93T3V0T2ZGb2N1c1dhcm5pbmcgPSBleHBvcnRzLnNldEFsd2F5c1Nob3dDUE0gPSBleHBvcnRzLnNldEFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzID0gZXhwb3J0cy5zZXRTdG9wT25FcnJvciA9IGV4cG9ydHMuc2V0Q2hhcnRTdHlsZSA9IGV4cG9ydHMuc2V0Q2hhcnRBY2N1cmFjeSA9IGV4cG9ydHMuc2V0QmxpbmRNb2RlID0gZXhwb3J0cy5zZXRGdW5ib3ggPSBleHBvcnRzLnNldEZhdlRoZW1lcyA9IGV4cG9ydHMuc2V0RGlmZmljdWx0eSA9IGV4cG9ydHMuc2V0U291bmRWb2x1bWUgPSBleHBvcnRzLnNldFBsYXlTb3VuZE9uQ2xpY2sgPSBleHBvcnRzLnNldFBsYXlTb3VuZE9uRXJyb3IgPSBleHBvcnRzLnNldE1vZGUgPSBleHBvcnRzLnNldFB1bmN0dWF0aW9uID0gZXhwb3J0cy5zZXROdW1iZXJzID0gZXhwb3J0cy5zYXZlRnVsbENvbmZpZ1RvTG9jYWxTdG9yYWdlID0gZXhwb3J0cy5zZXRDaGFuZ2VkQmVmb3JlRGIgPSBleHBvcnRzLnNldERiQ29uZmlnTG9hZGVkID0gZXhwb3J0cy5zZXRMb2NhbFN0b3JhZ2VDb25maWcgPSBleHBvcnRzLmNoYW5nZWRCZWZvcmVEYiA9IGV4cG9ydHMuZGJDb25maWdMb2FkZWQgPSBleHBvcnRzLmxvY2FsU3RvcmFnZUNvbmZpZyA9IHZvaWQgMDtcbmV4cG9ydHMubG9hZFByb21pc2UgPSBleHBvcnRzLnNldENvbmZpZyA9IGV4cG9ydHMuZ2V0Q29uZmlnQ2hhbmdlcyA9IGV4cG9ydHMubG9hZEZyb21Mb2NhbFN0b3JhZ2UgPSBleHBvcnRzLnJlc2V0ID0gZXhwb3J0cy5hcHBseSA9IGV4cG9ydHMuc2V0QnVyc3RIZWF0bWFwID0gZXhwb3J0cy5zZXRNb25rZXlQb3dlckxldmVsID0gZXhwb3J0cy5zZXRDdXN0b21CYWNrZ3JvdW5kRmlsdGVyID0gZXhwb3J0cy5zZXRDdXN0b21CYWNrZ3JvdW5kU2l6ZSA9IGV4cG9ydHMuc2V0Q3VzdG9tTGF5b3V0Zmx1aWQgPSBleHBvcnRzLnNldEN1c3RvbUJhY2tncm91bmQgPSBleHBvcnRzLnNldEZvbnRTaXplID0gZXhwb3J0cy5zZXRMYXlvdXQgPSBleHBvcnRzLnNldEtleW1hcExheW91dCA9IGV4cG9ydHMuc2V0S2V5bWFwU3R5bGUgPSBleHBvcnRzLnNldEtleW1hcExlZ2VuZFN0eWxlID0gZXhwb3J0cy5zZXRLZXltYXBNb2RlID0gZXhwb3J0cy5zZXRNb25rZXkgPSBleHBvcnRzLnNldExhbmd1YWdlID0gZXhwb3J0cy5zZXRDdXN0b21UaGVtZUNvbG9ycyA9IGV4cG9ydHMuc2V0TGF6eU1vZGUgPSBleHBvcnRzLnNldEJyaXRpc2hFbmdsaXNoID0gZXhwb3J0cy5zZXRSYW5kb21UaGVtZSA9IGV4cG9ydHMuc2V0VGhlbWVEYXJrID0gZXhwb3J0cy5zZXRUaGVtZUxpZ2h0ID0gZXhwb3J0cy5zZXRUaGVtZSA9IGV4cG9ydHMuc2V0Q3VzdG9tVGhlbWUgPSBleHBvcnRzLnNldEF1dG9Td2l0Y2hUaGVtZSA9IGV4cG9ydHMuc2V0SW5kaWNhdGVUeXBvcyA9IGV4cG9ydHMuc2V0Q29uZmlkZW5jZU1vZGUgPSBleHBvcnRzLnNldEZyZWVkb21Nb2RlID0gZXhwb3J0cy5zZXRGb250RmFtaWx5ID0gZXhwb3J0cy5wcmV2aWV3Rm9udEZhbWlseSA9IGV4cG9ydHMuc2V0UXVpY2tUYWJNb2RlID0gZXhwb3J0cy5zZXRTbW9vdGhMaW5lU2Nyb2xsID0gZXhwb3J0cy5zZXRTdGFydEdyYXBoc0F0WmVybyA9IGV4cG9ydHMuc2V0U21vb3RoQ2FyZXQgPSBleHBvcnRzLnNldFdvcmRDb3VudCA9IGV4cG9ydHMuc2V0UXVvdGVMZW5ndGggPSBleHBvcnRzLnNldFRpbWVDb25maWcgPSBleHBvcnRzLnNldEtleVRpcHMgPSBleHBvcnRzLnNldFRpbWVyT3BhY2l0eSA9IGV4cG9ydHMuc2V0VGltZXJDb2xvciA9IGV4cG9ydHMuc2V0VGltZXJTdHlsZSA9IGV4cG9ydHMuc2V0SGlkZUV4dHJhTGV0dGVycyA9IGV4cG9ydHMuc2V0SGlnaGxpZ2h0TW9kZSA9IGV4cG9ydHMuc2V0U2hvd0F2ZXJhZ2UgPSBleHBvcnRzLnNldFNob3dMaXZlQnVyc3QgPSB2b2lkIDA7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9kYlwiKSk7XG5jb25zdCBPdXRPZkZvY3VzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qvb3V0LW9mLWZvY3VzXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBjb25maWdfdmFsaWRhdGlvbl8xID0gcmVxdWlyZShcIi4vY29uZmlnLXZhbGlkYXRpb25cIik7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuY29uc3QgZGVmYXVsdF9jb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9jb25zdGFudHMvZGVmYXVsdC1jb25maWdcIikpO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuL2ZpcmViYXNlXCIpO1xuY29uc3QgQW5hbHl0aWNzQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jb250cm9sbGVycy9hbmFseXRpY3MtY29udHJvbGxlclwiKSk7XG5leHBvcnRzLmRiQ29uZmlnTG9hZGVkID0gZmFsc2U7XG5leHBvcnRzLmNoYW5nZWRCZWZvcmVEYiA9IGZhbHNlO1xuZnVuY3Rpb24gc2V0TG9jYWxTdG9yYWdlQ29uZmlnKHZhbCkge1xuICAgIGV4cG9ydHMubG9jYWxTdG9yYWdlQ29uZmlnID0gdmFsO1xufVxuZXhwb3J0cy5zZXRMb2NhbFN0b3JhZ2VDb25maWcgPSBzZXRMb2NhbFN0b3JhZ2VDb25maWc7XG5mdW5jdGlvbiBzZXREYkNvbmZpZ0xvYWRlZCh2YWwpIHtcbiAgICBleHBvcnRzLmRiQ29uZmlnTG9hZGVkID0gdmFsO1xufVxuZXhwb3J0cy5zZXREYkNvbmZpZ0xvYWRlZCA9IHNldERiQ29uZmlnTG9hZGVkO1xuZnVuY3Rpb24gc2V0Q2hhbmdlZEJlZm9yZURiKHZhbCkge1xuICAgIGV4cG9ydHMuY2hhbmdlZEJlZm9yZURiID0gdmFsO1xufVxuZXhwb3J0cy5zZXRDaGFuZ2VkQmVmb3JlRGIgPSBzZXRDaGFuZ2VkQmVmb3JlRGI7XG5sZXQgbG9hZERvbmU7XG5sZXQgY29uZmlnID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdF9jb25maWdfMS5kZWZhdWx0KTtcbmZ1bmN0aW9uIHNhdmVUb0xvY2FsU3RvcmFnZShrZXksIG5vc2F2ZSA9IGZhbHNlLCBub0RiQ2hlY2sgPSBmYWxzZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmICghZXhwb3J0cy5kYkNvbmZpZ0xvYWRlZCAmJiAhbm9EYkNoZWNrICYmICFub3NhdmUpIHtcbiAgICAgICAgICAgIHNldENoYW5nZWRCZWZvcmVEYih0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9zYXZlKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBsb2NhbFRvU2F2ZSA9IGNvbmZpZztcbiAgICAgICAgZGVsZXRlIGxvY2FsVG9TYXZlLnJlc3VsdEZpbHRlcnM7XG4gICAgICAgIGNvbnN0IGxvY2FsVG9TYXZlU3RyaW5naWZpZWQgPSBKU09OLnN0cmluZ2lmeShsb2NhbFRvU2F2ZSk7XG4gICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImNvbmZpZ1wiLCBsb2NhbFRvU2F2ZVN0cmluZ2lmaWVkKTtcbiAgICAgICAgaWYgKCFub0RiQ2hlY2spIHtcbiAgICAgICAgICAgIC8vIGF3YWl0IERCLnNhdmVDb25maWcoZGJUb1NhdmUpO1xuICAgICAgICAgICAgeWllbGQgc2F2ZVRvRGF0YWJhc2Uoa2V5KTtcbiAgICAgICAgfVxuICAgICAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInNhdmVUb0xvY2FsU3RvcmFnZVwiLCBsb2NhbFRvU2F2ZVN0cmluZ2lmaWVkKTtcbiAgICB9KTtcbn1cbmxldCBjb25maWdUb1NlbmQgPSB7fTtcbmxldCBzYXZlVGltZW91dCA9IG51bGw7XG5mdW5jdGlvbiBzYXZlVG9EYXRhYmFzZShrZXkpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25maWdUb1NlbmRba2V5XSA9IGNvbmZpZ1trZXldO1xuICAgICAgICBpZiAoc2F2ZVRpbWVvdXQgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHNhdmVUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIGNvbmZpZ1RvU2VuZC5yZXN1bHRGaWx0ZXJzO1xuICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhjb25maWdUb1NlbmQpLmxlbmd0aCA+IDApXG4gICAgICAgICAgICAgICAgICAgIERCLnNhdmVDb25maWcoY29uZmlnVG9TZW5kKTtcbiAgICAgICAgICAgICAgICBjb25maWdUb1NlbmQgPSB7fTtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoc2F2ZVRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIHNhdmVUaW1lb3V0ID0gbnVsbDtcbiAgICAgICAgICAgIH0pLCB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgPT09IFwibG9jYWxob3N0XCIgPyAwIDogMTAwMCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHNhdmVGdWxsQ29uZmlnVG9Mb2NhbFN0b3JhZ2Uobm9EYkNoZWNrID0gZmFsc2UpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoIWV4cG9ydHMuZGJDb25maWdMb2FkZWQgJiYgIW5vRGJDaGVjaykge1xuICAgICAgICAgICAgc2V0Q2hhbmdlZEJlZm9yZURiKHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNhdmUgPSBjb25maWc7XG4gICAgICAgIGRlbGV0ZSBzYXZlLnJlc3VsdEZpbHRlcnM7XG4gICAgICAgIGNvbnN0IHN0cmluZ2lmaWVkID0gSlNPTi5zdHJpbmdpZnkoc2F2ZSk7XG4gICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImNvbmZpZ1wiLCBzdHJpbmdpZmllZCk7XG4gICAgICAgIGlmICghbm9EYkNoZWNrKVxuICAgICAgICAgICAgeWllbGQgREIuc2F2ZUNvbmZpZyhzYXZlKTtcbiAgICAgICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzYXZlVG9Mb2NhbFN0b3JhZ2VcIiwgc3RyaW5naWZpZWQpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5zYXZlRnVsbENvbmZpZ1RvTG9jYWxTdG9yYWdlID0gc2F2ZUZ1bGxDb25maWdUb0xvY2FsU3RvcmFnZTtcbi8vbnVtYmVyc1xuZnVuY3Rpb24gc2V0TnVtYmVycyhudW1iLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJudW1iZXJzXCIsIG51bWIsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgaWYgKGNvbmZpZy5tb2RlID09PSBcInF1b3RlXCIpIHtcbiAgICAgICAgbnVtYiA9IGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcubnVtYmVycyA9IG51bWI7XG4gICAgaWYgKCFjb25maWcubnVtYmVycykge1xuICAgICAgICAkKFwiI3RvcCAuY29uZmlnIC5udW1iZXJzTW9kZSAudGV4dC1idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiI3RvcCAuY29uZmlnIC5udW1iZXJzTW9kZSAudGV4dC1idXR0b25cIikuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgfVxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcIm51bWJlcnNcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcIm51bWJlcnNcIiwgY29uZmlnLm51bWJlcnMpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXROdW1iZXJzID0gc2V0TnVtYmVycztcbi8vcHVuY3R1YXRpb25cbmZ1bmN0aW9uIHNldFB1bmN0dWF0aW9uKHB1bmMsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInB1bmN0dWF0aW9uXCIsIHB1bmMsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgaWYgKGNvbmZpZy5tb2RlID09PSBcInF1b3RlXCIpIHtcbiAgICAgICAgcHVuYyA9IGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcucHVuY3R1YXRpb24gPSBwdW5jO1xuICAgIGlmICghY29uZmlnLnB1bmN0dWF0aW9uKSB7XG4gICAgICAgICQoXCIjdG9wIC5jb25maWcgLnB1bmN0dWF0aW9uTW9kZSAudGV4dC1idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiI3RvcCAuY29uZmlnIC5wdW5jdHVhdGlvbk1vZGUgLnRleHQtYnV0dG9uXCIpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgIH1cbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJwdW5jdHVhdGlvblwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwicHVuY3R1YXRpb25cIiwgY29uZmlnLnB1bmN0dWF0aW9uKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0UHVuY3R1YXRpb24gPSBzZXRQdW5jdHVhdGlvbjtcbmZ1bmN0aW9uIHNldE1vZGUobW9kZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwibW9kZVwiLCBtb2RlLCBbXG4gICAgICAgIFtcInRpbWVcIiwgXCJ3b3Jkc1wiLCBcInF1b3RlXCIsIFwiemVuXCIsIFwiY3VzdG9tXCJdLFxuICAgIF0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKG1vZGUgIT09IFwid29yZHNcIiAmJiBjb25maWcuZnVuYm94ID09PSBcIm1lbW9yeVwiKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiTWVtb3J5IGZ1bmJveCBjYW4gb25seSBiZSB1c2VkIHdpdGggd29yZHMgbW9kZS5cIiwgMCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgcHJldmlvdXMgPSBjb25maWcubW9kZTtcbiAgICBjb25maWcubW9kZSA9IG1vZGU7XG4gICAgaWYgKGNvbmZpZy5tb2RlID09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgc2V0UHVuY3R1YXRpb24oZmFsc2UsIHRydWUpO1xuICAgICAgICBzZXROdW1iZXJzKGZhbHNlLCB0cnVlKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnLm1vZGUgPT0gXCJxdW90ZVwiKSB7XG4gICAgICAgIHNldFB1bmN0dWF0aW9uKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgc2V0TnVtYmVycyhmYWxzZSwgdHJ1ZSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZy5tb2RlID09IFwiemVuXCIpIHtcbiAgICAgICAgaWYgKGNvbmZpZy5wYWNlQ2FyZXQgIT0gXCJvZmZcIikge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoYFBhY2UgY2FyZXQgd2lsbCBub3Qgd29yayB3aXRoIHplbiBtb2RlLmAsIDApO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcIm1vZGVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcIm1vZGVcIiwgY29uZmlnLm1vZGUsIG5vc2F2ZSwgcHJldmlvdXMpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRNb2RlID0gc2V0TW9kZTtcbmZ1bmN0aW9uIHNldFBsYXlTb3VuZE9uRXJyb3IodmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJwbGF5IHNvdW5kIG9uIGVycm9yXCIsIHZhbCwgW1wiYm9vbGVhblwiXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcucGxheVNvdW5kT25FcnJvciA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJwbGF5U291bmRPbkVycm9yXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJwbGF5U291bmRPbkVycm9yXCIsIGNvbmZpZy5wbGF5U291bmRPbkVycm9yKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0UGxheVNvdW5kT25FcnJvciA9IHNldFBsYXlTb3VuZE9uRXJyb3I7XG5mdW5jdGlvbiBzZXRQbGF5U291bmRPbkNsaWNrKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwicGxheSBzb3VuZCBvbiBjbGlja1wiLCB2YWwsIFtcbiAgICAgICAgW1wib2ZmXCIsIFwiMVwiLCBcIjJcIiwgXCIzXCIsIFwiNFwiLCBcIjVcIiwgXCI2XCIsIFwiN1wiXSxcbiAgICBdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5wbGF5U291bmRPbkNsaWNrID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInBsYXlTb3VuZE9uQ2xpY2tcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInBsYXlTb3VuZE9uQ2xpY2tcIiwgY29uZmlnLnBsYXlTb3VuZE9uQ2xpY2spO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRQbGF5U291bmRPbkNsaWNrID0gc2V0UGxheVNvdW5kT25DbGljaztcbmZ1bmN0aW9uIHNldFNvdW5kVm9sdW1lKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwic291bmQgdm9sdW1lXCIsIHZhbCwgW1tcIjAuMVwiLCBcIjAuNVwiLCBcIjEuMFwiXV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnNvdW5kVm9sdW1lID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInNvdW5kVm9sdW1lXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzb3VuZFZvbHVtZVwiLCBjb25maWcuc291bmRWb2x1bWUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRTb3VuZFZvbHVtZSA9IHNldFNvdW5kVm9sdW1lO1xuLy9kaWZmaWN1bHR5XG5mdW5jdGlvbiBzZXREaWZmaWN1bHR5KGRpZmYsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImRpZmZpY3VsdHlcIiwgZGlmZiwgW1tcIm5vcm1hbFwiLCBcImV4cGVydFwiLCBcIm1hc3RlclwiXV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmRpZmZpY3VsdHkgPSBkaWZmO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImRpZmZpY3VsdHlcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImRpZmZpY3VsdHlcIiwgY29uZmlnLmRpZmZpY3VsdHksIG5vc2F2ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldERpZmZpY3VsdHkgPSBzZXREaWZmaWN1bHR5O1xuLy9zZXQgZmF2IHRoZW1lc1xuZnVuY3Rpb24gc2V0RmF2VGhlbWVzKHRoZW1lcywgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiZmF2b3JpdGUgdGhlbWVzXCIsIHRoZW1lcywgW1wic3RyaW5nQXJyYXlcIl0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmZhdlRoZW1lcyA9IHRoZW1lcztcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJmYXZUaGVtZXNcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImZhdlRoZW1lc1wiLCBjb25maWcuZmF2VGhlbWVzKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0RmF2VGhlbWVzID0gc2V0RmF2VGhlbWVzO1xuZnVuY3Rpb24gc2V0RnVuYm94KGZ1bmJveCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiZnVuYm94XCIsIGZ1bmJveCwgW1wic3RyaW5nXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbnN0IHZhbCA9IGZ1bmJveCA/IGZ1bmJveCA6IFwibm9uZVwiO1xuICAgIGNvbmZpZy5mdW5ib3ggPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiZnVuYm94XCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJmdW5ib3hcIiwgY29uZmlnLmZ1bmJveCk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEZ1bmJveCA9IHNldEZ1bmJveDtcbmZ1bmN0aW9uIHNldEJsaW5kTW9kZShibGluZCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiYmxpbmQgbW9kZVwiLCBibGluZCwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcuYmxpbmRNb2RlID0gYmxpbmQ7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiYmxpbmRNb2RlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJibGluZE1vZGVcIiwgY29uZmlnLmJsaW5kTW9kZSwgbm9zYXZlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0QmxpbmRNb2RlID0gc2V0QmxpbmRNb2RlO1xuZnVuY3Rpb24gc2V0Q2hhcnRBY2N1cmFjeShjaGFydEFjY3VyYWN5LCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJjaGFydCBhY2N1cmFjeVwiLCBjaGFydEFjY3VyYWN5LCBbXCJib29sZWFuXCJdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5jaGFydEFjY3VyYWN5ID0gY2hhcnRBY2N1cmFjeTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJjaGFydEFjY3VyYWN5XCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJjaGFydEFjY3VyYWN5XCIsIGNvbmZpZy5jaGFydEFjY3VyYWN5KTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0Q2hhcnRBY2N1cmFjeSA9IHNldENoYXJ0QWNjdXJhY3k7XG5mdW5jdGlvbiBzZXRDaGFydFN0eWxlKGNoYXJ0U3R5bGUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImNoYXJ0IHN0eWxlXCIsIGNoYXJ0U3R5bGUsIFtbXCJsaW5lXCIsIFwic2NhdHRlclwiXV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmNoYXJ0U3R5bGUgPSBjaGFydFN0eWxlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImNoYXJ0U3R5bGVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImNoYXJ0U3R5bGVcIiwgY29uZmlnLmNoYXJ0U3R5bGUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRDaGFydFN0eWxlID0gc2V0Q2hhcnRTdHlsZTtcbmZ1bmN0aW9uIHNldFN0b3BPbkVycm9yKHNvZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwic3RvcCBvbiBlcnJvclwiLCBzb2UsIFtbXCJvZmZcIiwgXCJ3b3JkXCIsIFwibGV0dGVyXCJdXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuc3RvcE9uRXJyb3IgPSBzb2U7XG4gICAgaWYgKGNvbmZpZy5zdG9wT25FcnJvciAhPT0gXCJvZmZcIikge1xuICAgICAgICBjb25maWcuY29uZmlkZW5jZU1vZGUgPSBcIm9mZlwiO1xuICAgIH1cbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJzdG9wT25FcnJvclwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic3RvcE9uRXJyb3JcIiwgY29uZmlnLnN0b3BPbkVycm9yLCBub3NhdmUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRTdG9wT25FcnJvciA9IHNldFN0b3BPbkVycm9yO1xuZnVuY3Rpb24gc2V0QWx3YXlzU2hvd0RlY2ltYWxQbGFjZXModmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJhbHdheXMgc2hvdyBkZWNpbWFsIHBsYWNlc1wiLCB2YWwsIFtcImJvb2xlYW5cIl0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJhbHdheXNTaG93RGVjaW1hbFBsYWNlc1wiLCBjb25maWcuYWx3YXlzU2hvd0RlY2ltYWxQbGFjZXMpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRBbHdheXNTaG93RGVjaW1hbFBsYWNlcyA9IHNldEFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzO1xuZnVuY3Rpb24gc2V0QWx3YXlzU2hvd0NQTSh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImFsd2F5cyBzaG93IENQTVwiLCB2YWwsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLmFsd2F5c1Nob3dDUE0gPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiYWx3YXlzU2hvd0NQTVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiYWx3YXlzU2hvd0NQTVwiLCBjb25maWcuYWx3YXlzU2hvd0NQTSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEFsd2F5c1Nob3dDUE0gPSBzZXRBbHdheXNTaG93Q1BNO1xuZnVuY3Rpb24gc2V0U2hvd091dE9mRm9jdXNXYXJuaW5nKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwic2hvdyBvdXQgb2YgZm9jdXMgd2FybmluZ1wiLCB2YWwsIFtcImJvb2xlYW5cIl0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnNob3dPdXRPZkZvY3VzV2FybmluZyA9IHZhbDtcbiAgICBpZiAoIWNvbmZpZy5zaG93T3V0T2ZGb2N1c1dhcm5pbmcpIHtcbiAgICAgICAgT3V0T2ZGb2N1cy5oaWRlKCk7XG4gICAgfVxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInNob3dPdXRPZkZvY3VzV2FybmluZ1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic2hvd091dE9mRm9jdXNXYXJuaW5nXCIsIGNvbmZpZy5zaG93T3V0T2ZGb2N1c1dhcm5pbmcpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRTaG93T3V0T2ZGb2N1c1dhcm5pbmcgPSBzZXRTaG93T3V0T2ZGb2N1c1dhcm5pbmc7XG5mdW5jdGlvbiBzZXRTd2FwRXNjQW5kVGFiKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwic3dhcCBlc2MgYW5kIHRhYlwiLCB2YWwsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLnN3YXBFc2NBbmRUYWIgPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwic3dhcEVzY0FuZFRhYlwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic3dhcEVzY0FuZFRhYlwiLCBjb25maWcuc3dhcEVzY0FuZFRhYik7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFN3YXBFc2NBbmRUYWIgPSBzZXRTd2FwRXNjQW5kVGFiO1xuLy9wYWNlIGNhcmV0XG5mdW5jdGlvbiBzZXRQYWNlQ2FyZXQodmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJwYWNlIGNhcmV0XCIsIHZhbCwgW1tcImN1c3RvbVwiLCBcIm9mZlwiLCBcImF2ZXJhZ2VcIiwgXCJwYlwiXV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09IFwiY29tcGxldGVcIikge1xuICAgICAgICBpZiAodmFsID09IFwicGJcIiAmJiBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgPT09IG51bGwpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUEIgcGFjZSBjYXJldCBpcyB1bmF2YWlsYWJsZSB3aXRob3V0IGFuIGFjY291bnRcIiwgMCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gaWYgKGNvbmZpZy5tb2RlID09PSBcInplblwiICYmIHZhbCAhPSBcIm9mZlwiKSB7XG4gICAgLy8gICBOb3RpZmljYXRpb25zLmFkZChgQ2FuJ3QgdXNlIHBhY2UgY2FyZXQgd2l0aCB6ZW4gbW9kZS5gLCAwKTtcbiAgICAvLyAgIHZhbCA9IFwib2ZmXCI7XG4gICAgLy8gfVxuICAgIGNvbmZpZy5wYWNlQ2FyZXQgPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwicGFjZUNhcmV0XCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJwYWNlQ2FyZXRcIiwgY29uZmlnLnBhY2VDYXJldCwgbm9zYXZlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0UGFjZUNhcmV0ID0gc2V0UGFjZUNhcmV0O1xuZnVuY3Rpb24gc2V0UGFjZUNhcmV0Q3VzdG9tU3BlZWQodmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJwYWNlIGNhcmV0IGN1c3RvbSBzcGVlZFwiLCB2YWwsIFtcIm51bWJlclwiXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcucGFjZUNhcmV0Q3VzdG9tU3BlZWQgPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwicGFjZUNhcmV0Q3VzdG9tU3BlZWRcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInBhY2VDYXJldEN1c3RvbVNwZWVkXCIsIGNvbmZpZy5wYWNlQ2FyZXRDdXN0b21TcGVlZCk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFBhY2VDYXJldEN1c3RvbVNwZWVkID0gc2V0UGFjZUNhcmV0Q3VzdG9tU3BlZWQ7XG5mdW5jdGlvbiBzZXRSZXBlYXRlZFBhY2UocGFjZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwicmVwZWF0ZWQgcGFjZVwiLCBwYWNlLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5yZXBlYXRlZFBhY2UgPSBwYWNlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInJlcGVhdGVkUGFjZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwicmVwZWF0ZWRQYWNlXCIsIGNvbmZpZy5yZXBlYXRlZFBhY2UpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRSZXBlYXRlZFBhY2UgPSBzZXRSZXBlYXRlZFBhY2U7XG4vL21pbiB3cG1cbmZ1bmN0aW9uIHNldE1pbldwbShtaW53cG0sIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcIm1pbiBXUE1cIiwgbWlud3BtLCBbW1wib2ZmXCIsIFwiY3VzdG9tXCJdXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcubWluV3BtID0gbWlud3BtO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcIm1pbldwbVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwibWluV3BtXCIsIGNvbmZpZy5taW5XcG0sIG5vc2F2ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldE1pbldwbSA9IHNldE1pbldwbTtcbmZ1bmN0aW9uIHNldE1pbldwbUN1c3RvbVNwZWVkKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwibWluIFdQTSBjdXN0b20gc3BlZWRcIiwgdmFsLCBbXCJudW1iZXJcIl0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLm1pbldwbUN1c3RvbVNwZWVkID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcIm1pbldwbUN1c3RvbVNwZWVkXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJtaW5XcG1DdXN0b21TcGVlZFwiLCBjb25maWcubWluV3BtQ3VzdG9tU3BlZWQpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRNaW5XcG1DdXN0b21TcGVlZCA9IHNldE1pbldwbUN1c3RvbVNwZWVkO1xuLy9taW4gYWNjXG5mdW5jdGlvbiBzZXRNaW5BY2MobWluLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJtaW4gYWNjXCIsIG1pbiwgW1tcIm9mZlwiLCBcImN1c3RvbVwiXV0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLm1pbkFjYyA9IG1pbjtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJtaW5BY2NcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcIm1pbkFjY1wiLCBjb25maWcubWluQWNjLCBub3NhdmUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRNaW5BY2MgPSBzZXRNaW5BY2M7XG5mdW5jdGlvbiBzZXRNaW5BY2NDdXN0b20odmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJtaW4gYWNjIGN1c3RvbVwiLCB2YWwsIFtcIm51bWJlclwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcubWluQWNjQ3VzdG9tID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcIm1pbkFjY0N1c3RvbVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwibWluQWNjQ3VzdG9tXCIsIGNvbmZpZy5taW5BY2NDdXN0b20pO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRNaW5BY2NDdXN0b20gPSBzZXRNaW5BY2NDdXN0b207XG4vL21pbiBidXJzdFxuZnVuY3Rpb24gc2V0TWluQnVyc3QobWluLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJtaW4gYnVyc3RcIiwgbWluLCBbW1wib2ZmXCIsIFwiZml4ZWRcIiwgXCJmbGV4XCJdXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcubWluQnVyc3QgPSBtaW47XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwibWluQnVyc3RcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcIm1pbkJ1cnN0XCIsIGNvbmZpZy5taW5CdXJzdCwgbm9zYXZlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0TWluQnVyc3QgPSBzZXRNaW5CdXJzdDtcbmZ1bmN0aW9uIHNldE1pbkJ1cnN0Q3VzdG9tU3BlZWQodmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJtaW4gYnVyc3QgY3VzdG9tIHNwZWVkXCIsIHZhbCwgW1wibnVtYmVyXCJdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5taW5CdXJzdEN1c3RvbVNwZWVkID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcIm1pbkJ1cnN0Q3VzdG9tU3BlZWRcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcIm1pbkJ1cnN0Q3VzdG9tU3BlZWRcIiwgY29uZmlnLm1pbkJ1cnN0Q3VzdG9tU3BlZWQpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRNaW5CdXJzdEN1c3RvbVNwZWVkID0gc2V0TWluQnVyc3RDdXN0b21TcGVlZDtcbi8vYWx3YXlzIHNob3cgd29yZHMgaGlzdG9yeVxuZnVuY3Rpb24gc2V0QWx3YXlzU2hvd1dvcmRzSGlzdG9yeSh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImFsd2F5cyBzaG93IHdvcmRzIGhpc3RvcnlcIiwgdmFsLCBbXCJib29sZWFuXCJdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5hbHdheXNTaG93V29yZHNIaXN0b3J5ID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImFsd2F5c1Nob3dXb3Jkc0hpc3RvcnlcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImFsd2F5c1Nob3dXb3Jkc0hpc3RvcnlcIiwgY29uZmlnLmFsd2F5c1Nob3dXb3Jkc0hpc3RvcnkpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRBbHdheXNTaG93V29yZHNIaXN0b3J5ID0gc2V0QWx3YXlzU2hvd1dvcmRzSGlzdG9yeTtcbi8vc2luZ2xlIGxpc3QgY29tbWFuZCBsaW5lXG5mdW5jdGlvbiBzZXRTaW5nbGVMaXN0Q29tbWFuZExpbmUob3B0aW9uLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJzaW5nbGUgbGlzdCBjb21tYW5kIGxpbmVcIiwgb3B0aW9uLCBbW1wibWFudWFsXCIsIFwib25cIl1dKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5zaW5nbGVMaXN0Q29tbWFuZExpbmUgPSBvcHRpb247XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwic2luZ2xlTGlzdENvbW1hbmRMaW5lXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzaW5nbGVMaXN0Q29tbWFuZExpbmVcIiwgY29uZmlnLnNpbmdsZUxpc3RDb21tYW5kTGluZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFNpbmdsZUxpc3RDb21tYW5kTGluZSA9IHNldFNpbmdsZUxpc3RDb21tYW5kTGluZTtcbi8vY2FwcyBsb2NrIHdhcm5pbmdcbmZ1bmN0aW9uIHNldENhcHNMb2NrV2FybmluZyh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImNhcHMgbG9jayB3YXJuaW5nXCIsIHZhbCwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcuY2Fwc0xvY2tXYXJuaW5nID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImNhcHNMb2NrV2FybmluZ1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiY2Fwc0xvY2tXYXJuaW5nXCIsIGNvbmZpZy5jYXBzTG9ja1dhcm5pbmcpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRDYXBzTG9ja1dhcm5pbmcgPSBzZXRDYXBzTG9ja1dhcm5pbmc7XG5mdW5jdGlvbiBzZXRTaG93QWxsTGluZXMoc2FsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJzaG93IGFsbCBsaW5lc1wiLCBzYWwsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLnNob3dBbGxMaW5lcyA9IHNhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJzaG93QWxsTGluZXNcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInNob3dBbGxMaW5lc1wiLCBjb25maWcuc2hvd0FsbExpbmVzLCBub3NhdmUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRTaG93QWxsTGluZXMgPSBzZXRTaG93QWxsTGluZXM7XG5mdW5jdGlvbiBzZXRRdWlja0VuZChxZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwicXVpY2sgZW5kXCIsIHFlLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5xdWlja0VuZCA9IHFlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInF1aWNrRW5kXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJxdWlja0VuZFwiLCBjb25maWcucXVpY2tFbmQpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRRdWlja0VuZCA9IHNldFF1aWNrRW5kO1xuZnVuY3Rpb24gc2V0RW5hYmxlQWRzKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiZW5hYmxlIGFkc1wiLCB2YWwsIFtbXCJvblwiLCBcIm9mZlwiLCBcIm1heFwiXV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmVuYWJsZUFkcyA9IHZhbDtcbiAgICBpZiAoIW5vc2F2ZSkge1xuICAgICAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJlbmFibGVBZHNcIiwgbm9zYXZlKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgfSwgMzAwMCk7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQWQgc2V0dGluZ3MgY2hhbmdlZC4gUmVmcmVzaGluZy4uLlwiLCAwKTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEVuYWJsZUFkcyA9IHNldEVuYWJsZUFkcztcbmZ1bmN0aW9uIHNldFJlcGVhdFF1b3Rlcyh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInJlcGVhdCBxdW90ZXNcIiwgdmFsLCBbW1wib2ZmXCIsIFwidHlwaW5nXCJdXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcucmVwZWF0UXVvdGVzID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInJlcGVhdFF1b3Rlc1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwicmVwZWF0UXVvdGVzXCIsIGNvbmZpZy5yZXBlYXRRdW90ZXMpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRSZXBlYXRRdW90ZXMgPSBzZXRSZXBlYXRRdW90ZXM7XG4vL2ZsaXAgY29sb3JzXG5mdW5jdGlvbiBzZXRGbGlwVGVzdENvbG9ycyhmbGlwLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJmbGlwIHRlc3QgY29sb3JzXCIsIGZsaXAsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLmZsaXBUZXN0Q29sb3JzID0gZmxpcDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJmbGlwVGVzdENvbG9yc1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiZmxpcFRlc3RDb2xvcnNcIiwgY29uZmlnLmZsaXBUZXN0Q29sb3JzKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0RmxpcFRlc3RDb2xvcnMgPSBzZXRGbGlwVGVzdENvbG9ycztcbi8vZXh0cmEgY29sb3JcbmZ1bmN0aW9uIHNldENvbG9yZnVsTW9kZShleHRyYSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiY29sb3JmdWwgbW9kZVwiLCBleHRyYSwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcuY29sb3JmdWxNb2RlID0gZXh0cmE7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiY29sb3JmdWxNb2RlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJjb2xvcmZ1bE1vZGVcIiwgY29uZmlnLmNvbG9yZnVsTW9kZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldENvbG9yZnVsTW9kZSA9IHNldENvbG9yZnVsTW9kZTtcbi8vc3RyaWN0IHNwYWNlXG5mdW5jdGlvbiBzZXRTdHJpY3RTcGFjZSh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInN0cmljdCBzcGFjZVwiLCB2YWwsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLnN0cmljdFNwYWNlID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInN0cmljdFNwYWNlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzdHJpY3RTcGFjZVwiLCBjb25maWcuc3RyaWN0U3BhY2UpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRTdHJpY3RTcGFjZSA9IHNldFN0cmljdFNwYWNlO1xuLy9vcHBvc2l0ZSBzaGlmdCBzcGFjZVxuZnVuY3Rpb24gc2V0T3Bwb3NpdGVTaGlmdE1vZGUodmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJvcHBvc2l0ZSBzaGlmdCBtb2RlXCIsIHZhbCwgW1tcIm9mZlwiLCBcIm9uXCIsIFwia2V5bWFwXCJdXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcub3Bwb3NpdGVTaGlmdE1vZGUgPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwib3Bwb3NpdGVTaGlmdE1vZGVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcIm9wcG9zaXRlU2hpZnRNb2RlXCIsIGNvbmZpZy5vcHBvc2l0ZVNoaWZ0TW9kZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldE9wcG9zaXRlU2hpZnRNb2RlID0gc2V0T3Bwb3NpdGVTaGlmdE1vZGU7XG5mdW5jdGlvbiBzZXRQYWdlV2lkdGgodmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJwYWdlIHdpZHRoXCIsIHZhbCwgW1xuICAgICAgICBbXCJtYXhcIiwgXCIxMDBcIiwgXCIxMjVcIiwgXCIxNTBcIiwgXCIyMDBcIl0sXG4gICAgXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcucGFnZVdpZHRoID0gdmFsO1xuICAgICQoXCIjY2VudGVyQ29udGVudFwiKS5yZW1vdmVDbGFzcyhcIndpZGUxMjVcIik7XG4gICAgJChcIiNjZW50ZXJDb250ZW50XCIpLnJlbW92ZUNsYXNzKFwid2lkZTE1MFwiKTtcbiAgICAkKFwiI2NlbnRlckNvbnRlbnRcIikucmVtb3ZlQ2xhc3MoXCJ3aWRlMjAwXCIpO1xuICAgICQoXCIjY2VudGVyQ29udGVudFwiKS5yZW1vdmVDbGFzcyhcIndpZGVtYXhcIik7XG4gICAgaWYgKHZhbCAhPT0gXCIxMDBcIikge1xuICAgICAgICAkKFwiI2NlbnRlckNvbnRlbnRcIikuYWRkQ2xhc3MoXCJ3aWRlXCIgKyB2YWwpO1xuICAgIH1cbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJwYWdlV2lkdGhcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInBhZ2VXaWR0aFwiLCBjb25maWcucGFnZVdpZHRoKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0UGFnZVdpZHRoID0gc2V0UGFnZVdpZHRoO1xuZnVuY3Rpb24gc2V0Q2FyZXRTdHlsZShjYXJldFN0eWxlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJjYXJldCBzdHlsZVwiLCBjYXJldFN0eWxlLCBbXG4gICAgICAgIFtcIm9mZlwiLCBcImRlZmF1bHRcIiwgXCJibG9ja1wiLCBcIm91dGxpbmVcIiwgXCJ1bmRlcmxpbmVcIiwgXCJjYXJyb3RcIiwgXCJiYW5hbmFcIl0sXG4gICAgXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuY2FyZXRTdHlsZSA9IGNhcmV0U3R5bGU7XG4gICAgJChcIiNjYXJldFwiKS5yZW1vdmVDbGFzcyhcIm9mZlwiKTtcbiAgICAkKFwiI2NhcmV0XCIpLnJlbW92ZUNsYXNzKFwiZGVmYXVsdFwiKTtcbiAgICAkKFwiI2NhcmV0XCIpLnJlbW92ZUNsYXNzKFwidW5kZXJsaW5lXCIpO1xuICAgICQoXCIjY2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJvdXRsaW5lXCIpO1xuICAgICQoXCIjY2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJibG9ja1wiKTtcbiAgICAkKFwiI2NhcmV0XCIpLnJlbW92ZUNsYXNzKFwiY2Fycm90XCIpO1xuICAgICQoXCIjY2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJiYW5hbmFcIik7XG4gICAgaWYgKGNhcmV0U3R5bGUgPT0gXCJvZmZcIikge1xuICAgICAgICAkKFwiI2NhcmV0XCIpLmFkZENsYXNzKFwib2ZmXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjYXJldFN0eWxlID09IFwiZGVmYXVsdFwiKSB7XG4gICAgICAgICQoXCIjY2FyZXRcIikuYWRkQ2xhc3MoXCJkZWZhdWx0XCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjYXJldFN0eWxlID09IFwiYmxvY2tcIikge1xuICAgICAgICAkKFwiI2NhcmV0XCIpLmFkZENsYXNzKFwiYmxvY2tcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNhcmV0U3R5bGUgPT0gXCJvdXRsaW5lXCIpIHtcbiAgICAgICAgJChcIiNjYXJldFwiKS5hZGRDbGFzcyhcIm91dGxpbmVcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNhcmV0U3R5bGUgPT0gXCJ1bmRlcmxpbmVcIikge1xuICAgICAgICAkKFwiI2NhcmV0XCIpLmFkZENsYXNzKFwidW5kZXJsaW5lXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjYXJldFN0eWxlID09IFwiY2Fycm90XCIpIHtcbiAgICAgICAgJChcIiNjYXJldFwiKS5hZGRDbGFzcyhcImNhcnJvdFwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY2FyZXRTdHlsZSA9PSBcImJhbmFuYVwiKSB7XG4gICAgICAgICQoXCIjY2FyZXRcIikuYWRkQ2xhc3MoXCJiYW5hbmFcIik7XG4gICAgfVxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImNhcmV0U3R5bGVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImNhcmV0U3R5bGVcIiwgY29uZmlnLmNhcmV0U3R5bGUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRDYXJldFN0eWxlID0gc2V0Q2FyZXRTdHlsZTtcbmZ1bmN0aW9uIHNldFBhY2VDYXJldFN0eWxlKGNhcmV0U3R5bGUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInBhY2UgY2FyZXQgc3R5bGVcIiwgY2FyZXRTdHlsZSwgW1xuICAgICAgICBbXCJvZmZcIiwgXCJkZWZhdWx0XCIsIFwiYmxvY2tcIiwgXCJvdXRsaW5lXCIsIFwidW5kZXJsaW5lXCIsIFwiY2Fycm90XCIsIFwiYmFuYW5hXCJdLFxuICAgIF0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnBhY2VDYXJldFN0eWxlID0gY2FyZXRTdHlsZTtcbiAgICAkKFwiI3BhY2VDYXJldFwiKS5yZW1vdmVDbGFzcyhcIm9mZlwiKTtcbiAgICAkKFwiI3BhY2VDYXJldFwiKS5yZW1vdmVDbGFzcyhcImRlZmF1bHRcIik7XG4gICAgJChcIiNwYWNlQ2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJ1bmRlcmxpbmVcIik7XG4gICAgJChcIiNwYWNlQ2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJvdXRsaW5lXCIpO1xuICAgICQoXCIjcGFjZUNhcmV0XCIpLnJlbW92ZUNsYXNzKFwiYmxvY2tcIik7XG4gICAgJChcIiNwYWNlQ2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJjYXJyb3RcIik7XG4gICAgJChcIiNwYWNlQ2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJiYW5hbmFcIik7XG4gICAgaWYgKGNhcmV0U3R5bGUgPT0gXCJkZWZhdWx0XCIpIHtcbiAgICAgICAgJChcIiNwYWNlQ2FyZXRcIikuYWRkQ2xhc3MoXCJkZWZhdWx0XCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjYXJldFN0eWxlID09IFwiYmxvY2tcIikge1xuICAgICAgICAkKFwiI3BhY2VDYXJldFwiKS5hZGRDbGFzcyhcImJsb2NrXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjYXJldFN0eWxlID09IFwib3V0bGluZVwiKSB7XG4gICAgICAgICQoXCIjcGFjZUNhcmV0XCIpLmFkZENsYXNzKFwib3V0bGluZVwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY2FyZXRTdHlsZSA9PSBcInVuZGVybGluZVwiKSB7XG4gICAgICAgICQoXCIjcGFjZUNhcmV0XCIpLmFkZENsYXNzKFwidW5kZXJsaW5lXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjYXJldFN0eWxlID09IFwiY2Fycm90XCIpIHtcbiAgICAgICAgJChcIiNwYWNlQ2FyZXRcIikuYWRkQ2xhc3MoXCJjYXJyb3RcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNhcmV0U3R5bGUgPT0gXCJiYW5hbmFcIikge1xuICAgICAgICAkKFwiI3BhY2VDYXJldFwiKS5hZGRDbGFzcyhcImJhbmFuYVwiKTtcbiAgICB9XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwicGFjZUNhcmV0U3R5bGVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInBhY2VDYXJldFN0eWxlXCIsIGNvbmZpZy5wYWNlQ2FyZXRTdHlsZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFBhY2VDYXJldFN0eWxlID0gc2V0UGFjZUNhcmV0U3R5bGU7XG5mdW5jdGlvbiBzZXRTaG93VGltZXJQcm9ncmVzcyh0aW1lciwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwic2hvdyB0aW1lciBwcm9ncmVzc1wiLCB0aW1lciwgW1wiYm9vbGVhblwiXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuc2hvd1RpbWVyUHJvZ3Jlc3MgPSB0aW1lcjtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJzaG93VGltZXJQcm9ncmVzc1wiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwic2hvd1RpbWVyUHJvZ3Jlc3NcIiwgY29uZmlnLnNob3dUaW1lclByb2dyZXNzKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0U2hvd1RpbWVyUHJvZ3Jlc3MgPSBzZXRTaG93VGltZXJQcm9ncmVzcztcbmZ1bmN0aW9uIHNldFNob3dMaXZlV3BtKGxpdmUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInNob3cgbGl2ZSBXUE1cIiwgbGl2ZSwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcuc2hvd0xpdmVXcG0gPSBsaXZlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInNob3dMaXZlV3BtXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzaG93TGl2ZVdwbVwiLCBjb25maWcuc2hvd0xpdmVXcG0pO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRTaG93TGl2ZVdwbSA9IHNldFNob3dMaXZlV3BtO1xuZnVuY3Rpb24gc2V0U2hvd0xpdmVBY2MobGl2ZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwic2hvdyBsaXZlIGFjY1wiLCBsaXZlLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5zaG93TGl2ZUFjYyA9IGxpdmU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwic2hvd0xpdmVBY2NcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInNob3dMaXZlQWNjXCIsIGNvbmZpZy5zaG93TGl2ZUFjYyk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFNob3dMaXZlQWNjID0gc2V0U2hvd0xpdmVBY2M7XG5mdW5jdGlvbiBzZXRTaG93TGl2ZUJ1cnN0KGxpdmUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInNob3cgbGl2ZSBidXJzdFwiLCBsaXZlLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5zaG93TGl2ZUJ1cnN0ID0gbGl2ZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJzaG93TGl2ZUJ1cnN0XCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzaG93TGl2ZUJ1cnN0XCIsIGNvbmZpZy5zaG93TGl2ZUJ1cnN0KTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0U2hvd0xpdmVCdXJzdCA9IHNldFNob3dMaXZlQnVyc3Q7XG5mdW5jdGlvbiBzZXRTaG93QXZlcmFnZSh2YWx1ZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwic2hvdyBhdmVyYWdlXCIsIHZhbHVlLCBbW1wib2ZmXCIsIFwid3BtXCIsIFwiYWNjXCIsIFwiYm90aFwiXV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLnNob3dBdmVyYWdlID0gdmFsdWU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwic2hvd0F2ZXJhZ2VcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInNob3dBdmVyYWdlXCIsIGNvbmZpZy5zaG93QXZlcmFnZSwgbm9zYXZlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0U2hvd0F2ZXJhZ2UgPSBzZXRTaG93QXZlcmFnZTtcbmZ1bmN0aW9uIHNldEhpZ2hsaWdodE1vZGUobW9kZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiaGlnaGxpZ2h0IG1vZGVcIiwgbW9kZSwgW1tcIm9mZlwiLCBcImxldHRlclwiLCBcIndvcmRcIl1dKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChtb2RlID09PSBcIndvcmRcIiAmJlxuICAgICAgICAoY29uZmlnLmZ1bmJveCA9PT0gXCJub3NwYWNlXCIgfHxcbiAgICAgICAgICAgIGNvbmZpZy5mdW5ib3ggPT09IFwicmVhZF9haGVhZFwiIHx8XG4gICAgICAgICAgICBjb25maWcuZnVuYm94ID09PSBcInJlYWRfYWhlYWRfZWFzeVwiIHx8XG4gICAgICAgICAgICBjb25maWcuZnVuYm94ID09PSBcInJlYWRfYWhlYWRfaGFyZFwiIHx8XG4gICAgICAgICAgICBjb25maWcuZnVuYm94ID09PSBcInR0c1wiIHx8XG4gICAgICAgICAgICBjb25maWcuZnVuYm94ID09PSBcImFycm93c1wiKSkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkNhbid0IHVzZSB3b3JkIGhpZ2hsaWdodCB3aXRoIHRoaXMgZnVuYm94XCIsIDApO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5oaWdobGlnaHRNb2RlID0gbW9kZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJoaWdobGlnaHRNb2RlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJoaWdobGlnaHRNb2RlXCIsIGNvbmZpZy5oaWdobGlnaHRNb2RlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0SGlnaGxpZ2h0TW9kZSA9IHNldEhpZ2hsaWdodE1vZGU7XG5mdW5jdGlvbiBzZXRIaWRlRXh0cmFMZXR0ZXJzKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiaGlkZSBleHRyYSBsZXR0ZXJzXCIsIHZhbCwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcuaGlkZUV4dHJhTGV0dGVycyA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJoaWRlRXh0cmFMZXR0ZXJzXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJoaWRlRXh0cmFMZXR0ZXJzXCIsIGNvbmZpZy5oaWRlRXh0cmFMZXR0ZXJzKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0SGlkZUV4dHJhTGV0dGVycyA9IHNldEhpZGVFeHRyYUxldHRlcnM7XG5mdW5jdGlvbiBzZXRUaW1lclN0eWxlKHN0eWxlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJ0aW1lciBzdHlsZVwiLCBzdHlsZSwgW1tcImJhclwiLCBcInRleHRcIiwgXCJtaW5pXCJdXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcudGltZXJTdHlsZSA9IHN0eWxlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInRpbWVyU3R5bGVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInRpbWVyU3R5bGVcIiwgY29uZmlnLnRpbWVyU3R5bGUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRUaW1lclN0eWxlID0gc2V0VGltZXJTdHlsZTtcbmZ1bmN0aW9uIHNldFRpbWVyQ29sb3IoY29sb3IsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInRpbWVyIGNvbG9yXCIsIGNvbG9yLCBbXG4gICAgICAgIFtcImJsYWNrXCIsIFwic3ViXCIsIFwidGV4dFwiLCBcIm1haW5cIl0sXG4gICAgXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcudGltZXJDb2xvciA9IGNvbG9yO1xuICAgICQoXCIjdGltZXJcIikucmVtb3ZlQ2xhc3MoXCJ0aW1lclN1YlwiKTtcbiAgICAkKFwiI3RpbWVyXCIpLnJlbW92ZUNsYXNzKFwidGltZXJUZXh0XCIpO1xuICAgICQoXCIjdGltZXJcIikucmVtb3ZlQ2xhc3MoXCJ0aW1lck1haW5cIik7XG4gICAgJChcIiN0aW1lck51bWJlclwiKS5yZW1vdmVDbGFzcyhcInRpbWVyU3ViXCIpO1xuICAgICQoXCIjdGltZXJOdW1iZXJcIikucmVtb3ZlQ2xhc3MoXCJ0aW1lclRleHRcIik7XG4gICAgJChcIiN0aW1lck51bWJlclwiKS5yZW1vdmVDbGFzcyhcInRpbWVyTWFpblwiKTtcbiAgICAkKFwiI2xhcmdlTGl2ZVdwbUFuZEFjY1wiKS5yZW1vdmVDbGFzcyhcInRpbWVyU3ViXCIpO1xuICAgICQoXCIjbGFyZ2VMaXZlV3BtQW5kQWNjXCIpLnJlbW92ZUNsYXNzKFwidGltZXJUZXh0XCIpO1xuICAgICQoXCIjbGFyZ2VMaXZlV3BtQW5kQWNjXCIpLnJlbW92ZUNsYXNzKFwidGltZXJNYWluXCIpO1xuICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbVwiKS5yZW1vdmVDbGFzcyhcInRpbWVyU3ViXCIpO1xuICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbVwiKS5yZW1vdmVDbGFzcyhcInRpbWVyVGV4dFwiKTtcbiAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG1cIikucmVtb3ZlQ2xhc3MoXCJ0aW1lck1haW5cIik7XG4gICAgaWYgKGNvbG9yID09PSBcIm1haW5cIikge1xuICAgICAgICAkKFwiI3RpbWVyXCIpLmFkZENsYXNzKFwidGltZXJNYWluXCIpO1xuICAgICAgICAkKFwiI3RpbWVyTnVtYmVyXCIpLmFkZENsYXNzKFwidGltZXJNYWluXCIpO1xuICAgICAgICAkKFwiI2xhcmdlTGl2ZVdwbUFuZEFjY1wiKS5hZGRDbGFzcyhcInRpbWVyTWFpblwiKTtcbiAgICAgICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtXCIpLmFkZENsYXNzKFwidGltZXJNYWluXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb2xvciA9PT0gXCJzdWJcIikge1xuICAgICAgICAkKFwiI3RpbWVyXCIpLmFkZENsYXNzKFwidGltZXJTdWJcIik7XG4gICAgICAgICQoXCIjdGltZXJOdW1iZXJcIikuYWRkQ2xhc3MoXCJ0aW1lclN1YlwiKTtcbiAgICAgICAgJChcIiNsYXJnZUxpdmVXcG1BbmRBY2NcIikuYWRkQ2xhc3MoXCJ0aW1lclN1YlwiKTtcbiAgICAgICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtXCIpLmFkZENsYXNzKFwidGltZXJTdWJcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbG9yID09PSBcInRleHRcIikge1xuICAgICAgICAkKFwiI3RpbWVyXCIpLmFkZENsYXNzKFwidGltZXJUZXh0XCIpO1xuICAgICAgICAkKFwiI3RpbWVyTnVtYmVyXCIpLmFkZENsYXNzKFwidGltZXJUZXh0XCIpO1xuICAgICAgICAkKFwiI2xhcmdlTGl2ZVdwbUFuZEFjY1wiKS5hZGRDbGFzcyhcInRpbWVyVGV4dFwiKTtcbiAgICAgICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtXCIpLmFkZENsYXNzKFwidGltZXJUZXh0XCIpO1xuICAgIH1cbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJ0aW1lckNvbG9yXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJ0aW1lckNvbG9yXCIsIGNvbmZpZy50aW1lckNvbG9yKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0VGltZXJDb2xvciA9IHNldFRpbWVyQ29sb3I7XG5mdW5jdGlvbiBzZXRUaW1lck9wYWNpdHkob3BhY2l0eSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwidGltZXIgb3BhY2l0eVwiLCBvcGFjaXR5LCBbXG4gICAgICAgIFtcIjAuMjVcIiwgXCIwLjVcIiwgXCIwLjc1XCIsIFwiMVwiXSxcbiAgICBdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy50aW1lck9wYWNpdHkgPSBvcGFjaXR5O1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInRpbWVyT3BhY2l0eVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwidGltZXJPcGFjaXR5XCIsIGNvbmZpZy50aW1lck9wYWNpdHkpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRUaW1lck9wYWNpdHkgPSBzZXRUaW1lck9wYWNpdHk7XG4vL2tleSB0aXBzXG5mdW5jdGlvbiBzZXRLZXlUaXBzKGtleVRpcHMsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImtleSB0aXBzXCIsIGtleVRpcHMsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLnNob3dLZXlUaXBzID0ga2V5VGlwcztcbiAgICBpZiAoY29uZmlnLnNob3dLZXlUaXBzKSB7XG4gICAgICAgICQoXCIjYm90dG9tIC5rZXlUaXBzXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiNib3R0b20gLmtleVRpcHNcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInNob3dLZXlUaXBzXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzaG93S2V5VGlwc1wiLCBjb25maWcuc2hvd0tleVRpcHMpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRLZXlUaXBzID0gc2V0S2V5VGlwcztcbi8vbW9kZVxuZnVuY3Rpb24gc2V0VGltZUNvbmZpZyh0aW1lLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJ0aW1lXCIsIHRpbWUsIFtcIm51bWJlclwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25zdCBuZXdUaW1lID0gaXNOYU4odGltZSkgfHwgdGltZSA8IDAgPyBkZWZhdWx0X2NvbmZpZ18xLmRlZmF1bHQudGltZSA6IHRpbWU7XG4gICAgJChcIiN0b3AgLmNvbmZpZyAudGltZSAudGV4dC1idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgY29uc3QgdGltZUN1c3RvbSA9ICFbMTUsIDMwLCA2MCwgMTIwXS5pbmNsdWRlcyhuZXdUaW1lKSA/IFwiY3VzdG9tXCIgOiBuZXdUaW1lO1xuICAgIGNvbmZpZy50aW1lID0gbmV3VGltZTtcbiAgICAkKFwiI3RvcCAuY29uZmlnIC50aW1lIC50ZXh0LWJ1dHRvblt0aW1lQ29uZmlnPSdcIiArIHRpbWVDdXN0b20gKyBcIiddXCIpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInRpbWVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInRpbWVcIiwgY29uZmlnLnRpbWUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRUaW1lQ29uZmlnID0gc2V0VGltZUNvbmZpZztcbi8vcXVvdGUgbGVuZ3RoXG5mdW5jdGlvbiBzZXRRdW90ZUxlbmd0aChsZW4sIG5vc2F2ZSwgbXVsdGlwbGVNb2RlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwicXVvdGUgbGVuZ3RoXCIsIGxlbiwgW1xuICAgICAgICBbLTIsIC0xLCAwLCAxLCAyLCAzXSxcbiAgICAgICAgXCJudW1iZXJBcnJheVwiLFxuICAgIF0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKEFycmF5LmlzQXJyYXkobGVuKSkge1xuICAgICAgICAvL2NvbmZpZyBsb2FkXG4gICAgICAgIGlmIChsZW4ubGVuZ3RoID09PSAxICYmIGxlblswXSA9PT0gLTEpXG4gICAgICAgICAgICBsZW4gPSBbMV07XG4gICAgICAgIGNvbmZpZy5xdW90ZUxlbmd0aCA9IGxlbjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShjb25maWcucXVvdGVMZW5ndGgpKVxuICAgICAgICAgICAgY29uZmlnLnF1b3RlTGVuZ3RoID0gW107XG4gICAgICAgIGlmIChsZW4gPT09IG51bGwgfHwgaXNOYU4obGVuKSB8fCBsZW4gPCAtMiB8fCBsZW4gPiAzKSB7XG4gICAgICAgICAgICBsZW4gPSAxO1xuICAgICAgICB9XG4gICAgICAgIGxlbiA9IHBhcnNlSW50KGxlbi50b1N0cmluZygpKTtcbiAgICAgICAgaWYgKG11bHRpcGxlTW9kZSkge1xuICAgICAgICAgICAgaWYgKCFjb25maWcucXVvdGVMZW5ndGguaW5jbHVkZXMobGVuKSkge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5xdW90ZUxlbmd0aC5wdXNoKGxlbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLnF1b3RlTGVuZ3RoLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLnF1b3RlTGVuZ3RoID0gY29uZmlnLnF1b3RlTGVuZ3RoLmZpbHRlcigocWwpID0+IHFsICE9PSBsZW4pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbmZpZy5xdW90ZUxlbmd0aCA9IFtsZW5dO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIGlmICghbm9zYXZlKSBzZXRNb2RlKFwicXVvdGVcIiwgbm9zYXZlKTtcbiAgICAkKFwiI3RvcCAuY29uZmlnIC5xdW90ZUxlbmd0aCAudGV4dC1idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgY29uZmlnLnF1b3RlTGVuZ3RoLmZvckVhY2goKHFsKSA9PiB7XG4gICAgICAgICQoXCIjdG9wIC5jb25maWcgLnF1b3RlTGVuZ3RoIC50ZXh0LWJ1dHRvbltxdW90ZUxlbmd0aD0nXCIgKyBxbCArIFwiJ11cIikuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgfSk7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwicXVvdGVMZW5ndGhcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInF1b3RlTGVuZ3RoXCIsIGNvbmZpZy5xdW90ZUxlbmd0aCk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFF1b3RlTGVuZ3RoID0gc2V0UXVvdGVMZW5ndGg7XG5mdW5jdGlvbiBzZXRXb3JkQ291bnQod29yZENvdW50LCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJ3b3Jkc1wiLCB3b3JkQ291bnQsIFtcIm51bWJlclwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25zdCBuZXdXb3JkQ291bnQgPSB3b3JkQ291bnQgPCAwIHx8IHdvcmRDb3VudCA+IDEwMDAwMCA/IGRlZmF1bHRfY29uZmlnXzEuZGVmYXVsdC53b3JkcyA6IHdvcmRDb3VudDtcbiAgICAkKFwiI3RvcCAuY29uZmlnIC53b3JkQ291bnQgLnRleHQtYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgIGNvbnN0IHdvcmRDdXN0b20gPSAhWzEwLCAyNSwgNTAsIDEwMCwgMjAwXS5pbmNsdWRlcyhuZXdXb3JkQ291bnQpXG4gICAgICAgID8gXCJjdXN0b21cIlxuICAgICAgICA6IG5ld1dvcmRDb3VudDtcbiAgICBjb25maWcud29yZHMgPSBuZXdXb3JkQ291bnQ7XG4gICAgJChcIiN0b3AgLmNvbmZpZyAud29yZENvdW50IC50ZXh0LWJ1dHRvblt3b3JkQ291bnQ9J1wiICsgd29yZEN1c3RvbSArIFwiJ11cIikuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwid29yZHNcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcIndvcmRzXCIsIGNvbmZpZy53b3Jkcyk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldFdvcmRDb3VudCA9IHNldFdvcmRDb3VudDtcbi8vY2FyZXRcbmZ1bmN0aW9uIHNldFNtb290aENhcmV0KG1vZGUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInNtb290aCBjYXJldFwiLCBtb2RlLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5zbW9vdGhDYXJldCA9IG1vZGU7XG4gICAgaWYgKG1vZGUpIHtcbiAgICAgICAgJChcIiNjYXJldFwiKS5jc3MoXCJhbmltYXRpb24tbmFtZVwiLCBcImNhcmV0Rmxhc2hTbW9vdGhcIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiI2NhcmV0XCIpLmNzcyhcImFuaW1hdGlvbi1uYW1lXCIsIFwiY2FyZXRGbGFzaEhhcmRcIik7XG4gICAgfVxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInNtb290aENhcmV0XCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzbW9vdGhDYXJldFwiLCBjb25maWcuc21vb3RoQ2FyZXQpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRTbW9vdGhDYXJldCA9IHNldFNtb290aENhcmV0O1xuZnVuY3Rpb24gc2V0U3RhcnRHcmFwaHNBdFplcm8obW9kZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwic3RhcnQgZ3JhcGhzIGF0IHplcm9cIiwgbW9kZSwgW1wiYm9vbGVhblwiXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuc3RhcnRHcmFwaHNBdFplcm8gPSBtb2RlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcInN0YXJ0R3JhcGhzQXRaZXJvXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzdGFydEdyYXBoc0F0WmVyb1wiLCBjb25maWcuc3RhcnRHcmFwaHNBdFplcm8pO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRTdGFydEdyYXBoc0F0WmVybyA9IHNldFN0YXJ0R3JhcGhzQXRaZXJvO1xuLy9saW5lc2Nyb2xsXG5mdW5jdGlvbiBzZXRTbW9vdGhMaW5lU2Nyb2xsKG1vZGUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInNtb290aCBsaW5lIHNjcm9sbFwiLCBtb2RlLCBbXCJib29sZWFuXCJdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5zbW9vdGhMaW5lU2Nyb2xsID0gbW9kZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJzbW9vdGhMaW5lU2Nyb2xsXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJzbW9vdGhMaW5lU2Nyb2xsXCIsIGNvbmZpZy5zbW9vdGhMaW5lU2Nyb2xsKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0U21vb3RoTGluZVNjcm9sbCA9IHNldFNtb290aExpbmVTY3JvbGw7XG4vL3F1aWNrIHRhYlxuZnVuY3Rpb24gc2V0UXVpY2tUYWJNb2RlKG1vZGUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInF1aWNrIHRhYiBtb2RlXCIsIG1vZGUsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLnF1aWNrVGFiID0gbW9kZTtcbiAgICBpZiAoIWNvbmZpZy5xdWlja1RhYikge1xuICAgICAgICAkKFwiI3Jlc3RhcnRUZXN0QnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI3Jlc3RhcnRUZXN0QnV0dG9uXCIpLmNzcyhcIm9wYWNpdHlcIiwgMSk7XG4gICAgICAgICQoXCIjYm90dG9tIC5rZXlUaXBzXCIpXG4gICAgICAgICAgICAuaHRtbChgPGtleT50YWI8L2tleT4gYW5kIDxrZXk+ZW50ZXI8L2tleT4gLyA8a2V5PnNwYWNlPC9rZXk+IC0gcmVzdGFydCB0ZXN0PGJyPlxuICAgICAgPGtleT5jdHJsL2NtZDwva2V5Pis8a2V5PnNoaWZ0PC9rZXk+KzxrZXk+cDwva2V5PiBvciA8a2V5PmVzYzwva2V5PiAtIGNvbW1hbmQgbGluZWApO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiNyZXN0YXJ0VGVzdEJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiNib3R0b20gLmtleVRpcHNcIikuaHRtbChgPGtleT50YWI8L2tleT4gLSByZXN0YXJ0IHRlc3Q8YnI+XG4gICAgPGtleT5jdHJsL2NtZDwva2V5Pis8a2V5PnNoaWZ0PC9rZXk+KzxrZXk+cDwva2V5PiBvciA8a2V5PmVzYzwva2V5PiAtIGNvbW1hbmQgbGluZWApO1xuICAgIH1cbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJxdWlja1RhYlwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwicXVpY2tUYWJcIiwgY29uZmlnLnF1aWNrVGFiKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0UXVpY2tUYWJNb2RlID0gc2V0UXVpY2tUYWJNb2RlO1xuZnVuY3Rpb24gcHJldmlld0ZvbnRGYW1pbHkoZm9udCkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInByZXZpZXcgZm9udCBmYW1pbHlcIiwgZm9udCwgW1wic3RyaW5nXCJdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eShcIi0tZm9udFwiLCAnXCInICsgZm9udC5yZXBsYWNlKC9fL2csIFwiIFwiKSArICdcIiwgXCJSb2JvdG8gTW9ub1wiJyk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnByZXZpZXdGb250RmFtaWx5ID0gcHJldmlld0ZvbnRGYW1pbHk7XG4vL2ZvbnQgZmFtaWx5XG5mdW5jdGlvbiBzZXRGb250RmFtaWx5KGZvbnQsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImZvbnQgZmFtaWx5XCIsIGZvbnQsIFtcInN0cmluZ1wiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAoZm9udCA9PT0gXCJcIikge1xuICAgICAgICBmb250ID0gXCJyb2JvdG9fbW9ub1wiO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVtcHR5IGlucHV0IHJlY2VpdmVkLCByZXZlcnRlZCB0byB0aGUgZGVmYXVsdCBmb250LlwiLCAwLCAzLCBcIkN1c3RvbSBmb250XCIpO1xuICAgIH1cbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnS2V5VmFsaWQpKGZvbnQpKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGBJbnZhbGlkIGZvbnQgbmFtZSB2YWx1ZTogXCIke2ZvbnR9XCIuYCwgLTEsIDMsIFwiQ3VzdG9tIGZvbnRcIik7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmZvbnRGYW1pbHkgPSBmb250O1xuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eShcIi0tZm9udFwiLCBgXCIke2ZvbnQucmVwbGFjZSgvXy9nLCBcIiBcIil9XCIsIFwiUm9ib3RvIE1vbm9cImApO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImZvbnRGYW1pbHlcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImZvbnRGYW1pbHlcIiwgY29uZmlnLmZvbnRGYW1pbHkpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRGb250RmFtaWx5ID0gc2V0Rm9udEZhbWlseTtcbi8vZnJlZWRvbVxuZnVuY3Rpb24gc2V0RnJlZWRvbU1vZGUoZnJlZWRvbSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiZnJlZWRvbSBtb2RlXCIsIGZyZWVkb20sIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgaWYgKGZyZWVkb20gPT0gbnVsbCkge1xuICAgICAgICBmcmVlZG9tID0gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5mcmVlZG9tTW9kZSA9IGZyZWVkb207XG4gICAgaWYgKGNvbmZpZy5mcmVlZG9tTW9kZSAmJiBjb25maWcuY29uZmlkZW5jZU1vZGUgIT09IFwib2ZmXCIpIHtcbiAgICAgICAgY29uZmlnLmNvbmZpZGVuY2VNb2RlID0gXCJvZmZcIjtcbiAgICB9XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiZnJlZWRvbU1vZGVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImZyZWVkb21Nb2RlXCIsIGNvbmZpZy5mcmVlZG9tTW9kZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEZyZWVkb21Nb2RlID0gc2V0RnJlZWRvbU1vZGU7XG5mdW5jdGlvbiBzZXRDb25maWRlbmNlTW9kZShjbSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiY29uZmlkZW5jZSBtb2RlXCIsIGNtLCBbW1wib2ZmXCIsIFwib25cIiwgXCJtYXhcIl1dKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5jb25maWRlbmNlTW9kZSA9IGNtO1xuICAgIGlmIChjb25maWcuY29uZmlkZW5jZU1vZGUgIT09IFwib2ZmXCIpIHtcbiAgICAgICAgY29uZmlnLmZyZWVkb21Nb2RlID0gZmFsc2U7XG4gICAgICAgIGNvbmZpZy5zdG9wT25FcnJvciA9IFwib2ZmXCI7XG4gICAgfVxuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImNvbmZpZGVuY2VNb2RlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJjb25maWRlbmNlTW9kZVwiLCBjb25maWcuY29uZmlkZW5jZU1vZGUsIG5vc2F2ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldENvbmZpZGVuY2VNb2RlID0gc2V0Q29uZmlkZW5jZU1vZGU7XG5mdW5jdGlvbiBzZXRJbmRpY2F0ZVR5cG9zKHZhbHVlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJpbmRpY2F0ZSB0eXBvc1wiLCB2YWx1ZSwgW1tcIm9mZlwiLCBcImJlbG93XCIsIFwicmVwbGFjZVwiXV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmluZGljYXRlVHlwb3MgPSB2YWx1ZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJpbmRpY2F0ZVR5cG9zXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJpbmRpY2F0ZVR5cG9zXCIsIGNvbmZpZy5pbmRpY2F0ZVR5cG9zKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0SW5kaWNhdGVUeXBvcyA9IHNldEluZGljYXRlVHlwb3M7XG5mdW5jdGlvbiBzZXRBdXRvU3dpdGNoVGhlbWUoYm9vbGVhbiwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiYXV0byBzd2l0Y2ggdGhlbWVcIiwgYm9vbGVhbiwgW1wiYm9vbGVhblwiXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBib29sZWFuID0gYm9vbGVhbiAhPT0gbnVsbCAmJiBib29sZWFuICE9PSB2b2lkIDAgPyBib29sZWFuIDogZGVmYXVsdF9jb25maWdfMS5kZWZhdWx0LmF1dG9Td2l0Y2hUaGVtZTtcbiAgICBjb25maWcuYXV0b1N3aXRjaFRoZW1lID0gYm9vbGVhbjtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJhdXRvU3dpdGNoVGhlbWVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImF1dG9Td2l0Y2hUaGVtZVwiLCBjb25maWcuYXV0b1N3aXRjaFRoZW1lKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0QXV0b1N3aXRjaFRoZW1lID0gc2V0QXV0b1N3aXRjaFRoZW1lO1xuZnVuY3Rpb24gc2V0Q3VzdG9tVGhlbWUoYm9vbGVhbiwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiY3VzdG9tIHRoZW1lXCIsIGJvb2xlYW4sIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLmN1c3RvbVRoZW1lID0gYm9vbGVhbjtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJjdXN0b21UaGVtZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiY3VzdG9tVGhlbWVcIiwgY29uZmlnLmN1c3RvbVRoZW1lKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0Q3VzdG9tVGhlbWUgPSBzZXRDdXN0b21UaGVtZTtcbmZ1bmN0aW9uIHNldFRoZW1lKG5hbWUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInRoZW1lXCIsIG5hbWUsIFtcInN0cmluZ1wiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcudGhlbWUgPSBuYW1lO1xuICAgIHNldEN1c3RvbVRoZW1lKGZhbHNlKTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJ0aGVtZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwidGhlbWVcIiwgY29uZmlnLnRoZW1lKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0VGhlbWUgPSBzZXRUaGVtZTtcbmZ1bmN0aW9uIHNldFRoZW1lTGlnaHQobmFtZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwidGhlbWUgbGlnaHRcIiwgbmFtZSwgW1wic3RyaW5nXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy50aGVtZUxpZ2h0ID0gbmFtZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJ0aGVtZUxpZ2h0XCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJ0aGVtZUxpZ2h0XCIsIGNvbmZpZy50aGVtZUxpZ2h0LCBub3NhdmUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRUaGVtZUxpZ2h0ID0gc2V0VGhlbWVMaWdodDtcbmZ1bmN0aW9uIHNldFRoZW1lRGFyayhuYW1lLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJ0aGVtZSBkYXJrXCIsIG5hbWUsIFtcInN0cmluZ1wiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcudGhlbWVEYXJrID0gbmFtZTtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJ0aGVtZURhcmtcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInRoZW1lRGFya1wiLCBjb25maWcudGhlbWVEYXJrLCBub3NhdmUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRUaGVtZURhcmsgPSBzZXRUaGVtZURhcms7XG5mdW5jdGlvbiBzZXRUaGVtZXModGhlbWUsIGN1c3RvbVN0YXRlLCBjdXN0b21UaGVtZUNvbG9ycywgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwidGhlbWVzXCIsIHRoZW1lLCBbXCJzdHJpbmdcIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLmN1c3RvbVRoZW1lQ29sb3JzID0gY3VzdG9tVGhlbWVDb2xvcnM7XG4gICAgY29uZmlnLnRoZW1lID0gdGhlbWU7XG4gICAgY29uZmlnLmN1c3RvbVRoZW1lID0gY3VzdG9tU3RhdGU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwidGhlbWVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcInNldFRoZW1lc1wiLCBjdXN0b21TdGF0ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5mdW5jdGlvbiBzZXRSYW5kb21UaGVtZSh2YWwsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcInJhbmRvbSB0aGVtZVwiLCB2YWwsIFtcbiAgICAgICAgW1wib2ZmXCIsIFwib25cIiwgXCJmYXZcIiwgXCJsaWdodFwiLCBcImRhcmtcIiwgXCJjdXN0b21cIl0sXG4gICAgXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAodmFsID09PSBcImN1c3RvbVwiKSB7XG4gICAgICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgPT09IG51bGwpIHtcbiAgICAgICAgICAgIGNvbmZpZy5yYW5kb21UaGVtZSA9IHZhbDtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIURCLmdldFNuYXBzaG90KCkpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgaWYgKERCLmdldFNuYXBzaG90KCkuY3VzdG9tVGhlbWVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJZb3UgbmVlZCB0byBjcmVhdGUgYSBjdXN0b20gdGhlbWUgZmlyc3RcIiwgMCk7XG4gICAgICAgICAgICBjb25maWcucmFuZG9tVGhlbWUgPSBcIm9mZlwiO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbmZpZy5yYW5kb21UaGVtZSA9IHZhbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJyYW5kb21UaGVtZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwicmFuZG9tVGhlbWVcIiwgY29uZmlnLnJhbmRvbVRoZW1lKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0UmFuZG9tVGhlbWUgPSBzZXRSYW5kb21UaGVtZTtcbmZ1bmN0aW9uIHNldEJyaXRpc2hFbmdsaXNoKHZhbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiYnJpdGlzaCBlbmdsaXNoXCIsIHZhbCwgW1wiYm9vbGVhblwiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAoIXZhbCkge1xuICAgICAgICB2YWwgPSBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmJyaXRpc2hFbmdsaXNoID0gdmFsO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImJyaXRpc2hFbmdsaXNoXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJicml0aXNoRW5nbGlzaFwiLCBjb25maWcuYnJpdGlzaEVuZ2xpc2gpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRCcml0aXNoRW5nbGlzaCA9IHNldEJyaXRpc2hFbmdsaXNoO1xuZnVuY3Rpb24gc2V0TGF6eU1vZGUodmFsLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJsYXp5IG1vZGVcIiwgdmFsLCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmICghdmFsKSB7XG4gICAgICAgIHZhbCA9IGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcubGF6eU1vZGUgPSB2YWw7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwibGF6eU1vZGVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImxhenlNb2RlXCIsIGNvbmZpZy5sYXp5TW9kZSwgbm9zYXZlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0TGF6eU1vZGUgPSBzZXRMYXp5TW9kZTtcbmZ1bmN0aW9uIHNldEN1c3RvbVRoZW1lQ29sb3JzKGNvbG9ycywgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwiY3VzdG9tIHRoZW1lIGNvbG9yc1wiLCBjb2xvcnMsIFtcInN0cmluZ0FycmF5XCJdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChjb2xvcnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb25maWcuY3VzdG9tVGhlbWVDb2xvcnMgPSBjb2xvcnM7XG4gICAgICAgIC8vIFRoZW1lQ29udHJvbGxlci5zZXQoXCJjdXN0b21cIik7XG4gICAgICAgIC8vIGFwcGx5Q3VzdG9tVGhlbWVDb2xvcnMoKTtcbiAgICB9XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiY3VzdG9tVGhlbWVDb2xvcnNcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImN1c3RvbVRoZW1lQ29sb3JzXCIsIGNvbmZpZy5jdXN0b21UaGVtZUNvbG9ycywgbm9zYXZlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0Q3VzdG9tVGhlbWVDb2xvcnMgPSBzZXRDdXN0b21UaGVtZUNvbG9ycztcbmZ1bmN0aW9uIHNldExhbmd1YWdlKGxhbmd1YWdlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJsYW5ndWFnZVwiLCBsYW5ndWFnZSwgW1wic3RyaW5nXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5sYW5ndWFnZSA9IGxhbmd1YWdlO1xuICAgIEFuYWx5dGljc0NvbnRyb2xsZXIubG9nKFwiY2hhbmdlZExhbmd1YWdlXCIsIHsgbGFuZ3VhZ2UgfSk7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwibGFuZ3VhZ2VcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImxhbmd1YWdlXCIsIGNvbmZpZy5sYW5ndWFnZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldExhbmd1YWdlID0gc2V0TGFuZ3VhZ2U7XG5mdW5jdGlvbiBzZXRNb25rZXkobW9ua2V5LCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJtb25rZXlcIiwgbW9ua2V5LCBbXCJib29sZWFuXCJdKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbmZpZy5tb25rZXkgPSBtb25rZXk7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwibW9ua2V5XCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJtb25rZXlcIiwgY29uZmlnLm1vbmtleSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldE1vbmtleSA9IHNldE1vbmtleTtcbmZ1bmN0aW9uIHNldEtleW1hcE1vZGUobW9kZSwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwia2V5bWFwIG1vZGVcIiwgbW9kZSwgW1xuICAgICAgICBbXCJvZmZcIiwgXCJzdGF0aWNcIiwgXCJyZWFjdFwiLCBcIm5leHRcIl0sXG4gICAgXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAkKFwiLmFjdGl2ZS1rZXlcIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmUta2V5XCIpO1xuICAgICQoXCIua2V5bWFwLWtleVwiKS5hdHRyKFwic3R5bGVcIiwgXCJcIik7XG4gICAgY29uZmlnLmtleW1hcE1vZGUgPSBtb2RlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImtleW1hcE1vZGVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImtleW1hcE1vZGVcIiwgY29uZmlnLmtleW1hcE1vZGUsIG5vc2F2ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEtleW1hcE1vZGUgPSBzZXRLZXltYXBNb2RlO1xuZnVuY3Rpb24gc2V0S2V5bWFwTGVnZW5kU3R5bGUoc3R5bGUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImtleW1hcCBsZWdlbmQgc3R5bGVcIiwgc3R5bGUsIFtcbiAgICAgICAgW1wibG93ZXJjYXNlXCIsIFwidXBwZXJjYXNlXCIsIFwiYmxhbmtcIiwgXCJkeW5hbWljXCJdLFxuICAgIF0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy8gUmVtb3ZlIGV4aXN0aW5nIHN0eWxlc1xuICAgIGNvbnN0IGtleW1hcExlZ2VuZFN0eWxlcyA9IFtcImxvd2VyY2FzZVwiLCBcInVwcGVyY2FzZVwiLCBcImJsYW5rXCIsIFwiZHluYW1pY1wiXTtcbiAgICBrZXltYXBMZWdlbmRTdHlsZXMuZm9yRWFjaCgobmFtZSkgPT4ge1xuICAgICAgICAkKFwiLmtleW1hcExlZ2VuZFN0eWxlXCIpLnJlbW92ZUNsYXNzKG5hbWUpO1xuICAgIH0pO1xuICAgIHN0eWxlID0gc3R5bGUgfHwgXCJsb3dlcmNhc2VcIjtcbiAgICAvLyBNdXRhdGUgdGhlIGtleW1hcCBpbiB0aGUgRE9NLCBpZiBpdCBleGlzdHMuXG4gICAgLy8gMS4gUmVtb3ZlIGV2ZXJ5dGhpbmdcbiAgICAkKFwiLmtleW1hcC1rZXkgPiAubGV0dGVyXCIpLmNzcyhcImRpc3BsYXlcIiwgXCJcIik7XG4gICAgJChcIi5rZXltYXAta2V5ID4gLmxldHRlclwiKS5jc3MoXCJ0ZXh0LXRyYW5zZm9ybVwiLCBcIlwiKTtcbiAgICAvLyAyLiBBcHBlbmQgc3BlY2lhbCBzdHlsZXMgb250byB0aGUgRE9NIGVsZW1lbnRzXG4gICAgaWYgKHN0eWxlID09PSBcInVwcGVyY2FzZVwiKSB7XG4gICAgICAgICQoXCIua2V5bWFwLWtleSA+IC5sZXR0ZXJcIikuY3NzKFwidGV4dC10cmFuc2Zvcm1cIiwgXCJjYXBpdGFsaXplXCIpO1xuICAgIH1cbiAgICBpZiAoc3R5bGUgPT09IFwiYmxhbmtcIikge1xuICAgICAgICAkKFwiLmtleW1hcC1rZXkgPiAubGV0dGVyXCIpLmNzcyhcImRpc3BsYXlcIiwgXCJub25lXCIpO1xuICAgIH1cbiAgICAvLyBVcGRhdGUgYW5kIHNhdmUgdG8gY29va2llIGZvciBwZXJzaXN0ZW5jZVxuICAgICQoXCIua2V5bWFwTGVnZW5kU3R5bGVcIikuYWRkQ2xhc3Moc3R5bGUpO1xuICAgIGNvbmZpZy5rZXltYXBMZWdlbmRTdHlsZSA9IHN0eWxlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImtleW1hcExlZ2VuZFN0eWxlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJrZXltYXBMZWdlbmRTdHlsZVwiLCBjb25maWcua2V5bWFwTGVnZW5kU3R5bGUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRLZXltYXBMZWdlbmRTdHlsZSA9IHNldEtleW1hcExlZ2VuZFN0eWxlO1xuZnVuY3Rpb24gc2V0S2V5bWFwU3R5bGUoc3R5bGUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImtleW1hcCBzdHlsZVwiLCBzdHlsZSwgW1xuICAgICAgICBbXCJzdGFnZ2VyZWRcIiwgXCJhbGljZVwiLCBcIm1hdHJpeFwiLCBcInNwbGl0XCIsIFwic3BsaXRfbWF0cml4XCJdLFxuICAgIF0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgc3R5bGUgPSBzdHlsZSB8fCBcInN0YWdnZXJlZFwiO1xuICAgIGNvbmZpZy5rZXltYXBTdHlsZSA9IHN0eWxlO1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImtleW1hcFN0eWxlXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJrZXltYXBTdHlsZVwiLCBjb25maWcua2V5bWFwU3R5bGUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRLZXltYXBTdHlsZSA9IHNldEtleW1hcFN0eWxlO1xuZnVuY3Rpb24gc2V0S2V5bWFwTGF5b3V0KGxheW91dCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwia2V5bWFwIGxheW91dFwiLCBsYXlvdXQsIFtcInN0cmluZ1wiXSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25maWcua2V5bWFwTGF5b3V0ID0gbGF5b3V0O1xuICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImtleW1hcExheW91dFwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwia2V5bWFwTGF5b3V0XCIsIGNvbmZpZy5rZXltYXBMYXlvdXQpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRLZXltYXBMYXlvdXQgPSBzZXRLZXltYXBMYXlvdXQ7XG5mdW5jdGlvbiBzZXRMYXlvdXQobGF5b3V0LCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJsYXlvdXRcIiwgbGF5b3V0LCBbXCJzdHJpbmdcIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uZmlnLmxheW91dCA9IGxheW91dDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJsYXlvdXRcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImxheW91dFwiLCBjb25maWcubGF5b3V0LCBub3NhdmUpO1xuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRMYXlvdXQgPSBzZXRMYXlvdXQ7XG4vLyBleHBvcnQgZnVuY3Rpb24gc2V0U2F2ZWRMYXlvdXQobGF5b3V0OiBzdHJpbmcsIG5vc2F2ZT86IGJvb2xlYW4pOiBib29sZWFuIHtcbi8vICAgaWYgKGxheW91dCA9PSBudWxsIHx8IGxheW91dCA9PSB1bmRlZmluZWQpIHtcbi8vICAgICBsYXlvdXQgPSBcInF3ZXJ0eVwiO1xuLy8gICB9XG4vLyAgIGNvbmZpZy5zYXZlZExheW91dCA9IGxheW91dDtcbi8vICAgc2V0TGF5b3V0KGxheW91dCwgbm9zYXZlKTtcbi8vICAgcmV0dXJuIHRydWU7XG4vLyB9XG5mdW5jdGlvbiBzZXRGb250U2l6ZShmb250U2l6ZSwgbm9zYXZlKSB7XG4gICAgZm9udFNpemUgPSBmb250U2l6ZS50b1N0cmluZygpOyAvL3RvZG8gcmVtb3ZlIGFmdGVyIGFyb3VuZCBhIHdlZWtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJmb250IHNpemVcIiwgZm9udFNpemUsIFtcbiAgICAgICAgW1wiMVwiLCBcIjEyNVwiLCBcIjE1XCIsIFwiMlwiLCBcIjNcIiwgXCI0XCJdLFxuICAgIF0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uZmlnLmZvbnRTaXplID0gZm9udFNpemU7XG4gICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcInNpemUxMjVcIik7XG4gICAgJChcIiNjYXJldCwgI3BhY2VDYXJldFwiKS5yZW1vdmVDbGFzcyhcInNpemUxMjVcIik7XG4gICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcInNpemUxNVwiKTtcbiAgICAkKFwiI2NhcmV0LCAjcGFjZUNhcmV0XCIpLnJlbW92ZUNsYXNzKFwic2l6ZTE1XCIpO1xuICAgICQoXCIjd29yZHNcIikucmVtb3ZlQ2xhc3MoXCJzaXplMlwiKTtcbiAgICAkKFwiI2NhcmV0LCAjcGFjZUNhcmV0XCIpLnJlbW92ZUNsYXNzKFwic2l6ZTJcIik7XG4gICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcInNpemUzXCIpO1xuICAgICQoXCIjY2FyZXQsICNwYWNlQ2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJzaXplM1wiKTtcbiAgICAkKFwiI3dvcmRzXCIpLnJlbW92ZUNsYXNzKFwic2l6ZTM1XCIpO1xuICAgICQoXCIjY2FyZXQsICNwYWNlQ2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJzaXplMzVcIik7XG4gICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcInNpemU0XCIpO1xuICAgICQoXCIjY2FyZXQsICNwYWNlQ2FyZXRcIikucmVtb3ZlQ2xhc3MoXCJzaXplNFwiKTtcbiAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG1cIikucmVtb3ZlQ2xhc3MoXCJzaXplMTI1XCIpO1xuICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbVwiKS5yZW1vdmVDbGFzcyhcInNpemUxNVwiKTtcbiAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG1cIikucmVtb3ZlQ2xhc3MoXCJzaXplMlwiKTtcbiAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG1cIikucmVtb3ZlQ2xhc3MoXCJzaXplM1wiKTtcbiAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG1cIikucmVtb3ZlQ2xhc3MoXCJzaXplMzVcIik7XG4gICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtXCIpLnJlbW92ZUNsYXNzKFwic2l6ZTRcIik7XG4gICAgaWYgKGZvbnRTaXplID09IFwiMTI1XCIpIHtcbiAgICAgICAgJChcIiN3b3Jkc1wiKS5hZGRDbGFzcyhcInNpemUxMjVcIik7XG4gICAgICAgICQoXCIjY2FyZXQsICNwYWNlQ2FyZXRcIikuYWRkQ2xhc3MoXCJzaXplMTI1XCIpO1xuICAgICAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG1cIikuYWRkQ2xhc3MoXCJzaXplMTI1XCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChmb250U2l6ZSA9PSBcIjE1XCIpIHtcbiAgICAgICAgJChcIiN3b3Jkc1wiKS5hZGRDbGFzcyhcInNpemUxNVwiKTtcbiAgICAgICAgJChcIiNjYXJldCwgI3BhY2VDYXJldFwiKS5hZGRDbGFzcyhcInNpemUxNVwiKTtcbiAgICAgICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtXCIpLmFkZENsYXNzKFwic2l6ZTE1XCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChmb250U2l6ZSA9PSBcIjJcIikge1xuICAgICAgICAkKFwiI3dvcmRzXCIpLmFkZENsYXNzKFwic2l6ZTJcIik7XG4gICAgICAgICQoXCIjY2FyZXQsICNwYWNlQ2FyZXRcIikuYWRkQ2xhc3MoXCJzaXplMlwiKTtcbiAgICAgICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtXCIpLmFkZENsYXNzKFwic2l6ZTJcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGZvbnRTaXplID09IFwiM1wiKSB7XG4gICAgICAgICQoXCIjd29yZHNcIikuYWRkQ2xhc3MoXCJzaXplM1wiKTtcbiAgICAgICAgJChcIiNjYXJldCwgI3BhY2VDYXJldFwiKS5hZGRDbGFzcyhcInNpemUzXCIpO1xuICAgICAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG1cIikuYWRkQ2xhc3MoXCJzaXplM1wiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZm9udFNpemUgPT0gXCI0XCIpIHtcbiAgICAgICAgJChcIiN3b3Jkc1wiKS5hZGRDbGFzcyhcInNpemU0XCIpO1xuICAgICAgICAkKFwiI2NhcmV0LCAjcGFjZUNhcmV0XCIpLmFkZENsYXNzKFwic2l6ZTRcIik7XG4gICAgICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbVwiKS5hZGRDbGFzcyhcInNpemU0XCIpO1xuICAgIH1cbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJmb250U2l6ZVwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiZm9udFNpemVcIiwgY29uZmlnLmZvbnRTaXplKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0Rm9udFNpemUgPSBzZXRGb250U2l6ZTtcbmZ1bmN0aW9uIHNldEN1c3RvbUJhY2tncm91bmQodmFsdWUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImN1c3RvbSBiYWNrZ3JvdW5kXCIsIHZhbHVlLCBbXCJzdHJpbmdcIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgdmFsdWUgPSB2YWx1ZS50cmltKCk7XG4gICAgaWYgKCgvKGh0dHBzfGh0dHApOlxcL1xcLyh3d3dcXC58KS4rXFwuLitcXC8uKyhcXC5wbmd8XFwuZ2lmfFxcLmpwZWd8XFwuanBnKS9naS50ZXN0KHZhbHVlKSAmJlxuICAgICAgICAhL1s8Pl0vLnRlc3QodmFsdWUpKSB8fFxuICAgICAgICB2YWx1ZSA9PSBcIlwiKSB7XG4gICAgICAgIGNvbmZpZy5jdXN0b21CYWNrZ3JvdW5kID0gdmFsdWU7XG4gICAgICAgIHNhdmVUb0xvY2FsU3RvcmFnZShcImN1c3RvbUJhY2tncm91bmRcIiwgbm9zYXZlKTtcbiAgICAgICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJjdXN0b21CYWNrZ3JvdW5kXCIsIGNvbmZpZy5jdXN0b21CYWNrZ3JvdW5kKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiSW52YWxpZCBjdXN0b20gYmFja2dyb3VuZCBVUkxcIiwgMCk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0cy5zZXRDdXN0b21CYWNrZ3JvdW5kID0gc2V0Q3VzdG9tQmFja2dyb3VuZDtcbmZ1bmN0aW9uIHNldEN1c3RvbUxheW91dGZsdWlkKHZhbHVlLCBub3NhdmUpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCB0cmltbWVkID0gdmFsdWUudHJpbSgpO1xuICAgICAgICBpZiAoISh5aWVsZCAoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWRBc3luYykoXCJsYXlvdXRmbHVpZFwiLCB0cmltbWVkLCBbXCJsYXlvdXRmbHVpZFwiXSkpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY3VzdG9tTGF5b3V0Zmx1aWQgPSB0cmltbWVkLnJlcGxhY2UoLyAvZywgXCIjXCIpO1xuICAgICAgICBjb25maWcuY3VzdG9tTGF5b3V0Zmx1aWQgPSBjdXN0b21MYXlvdXRmbHVpZDtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uY3VzdG9tTGF5b3V0Zmx1aWQgaW5wdXRcIikudmFsKGN1c3RvbUxheW91dGZsdWlkLnJlcGxhY2UoLyMvZywgXCIgXCIpKTtcbiAgICAgICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiY3VzdG9tTGF5b3V0Zmx1aWRcIiwgbm9zYXZlKTtcbiAgICAgICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJjdXN0b21MYXlvdXRGbHVpZFwiLCBjb25maWcuY3VzdG9tTGF5b3V0Zmx1aWQpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc2V0Q3VzdG9tTGF5b3V0Zmx1aWQgPSBzZXRDdXN0b21MYXlvdXRmbHVpZDtcbmZ1bmN0aW9uIHNldEN1c3RvbUJhY2tncm91bmRTaXplKHZhbHVlLCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJjdXN0b20gYmFja2dyb3VuZCBzaXplXCIsIHZhbHVlLCBbXG4gICAgICAgIFtcIm1heFwiLCBcImNvdmVyXCIsIFwiY29udGFpblwiXSxcbiAgICBdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmICh2YWx1ZSAhPSBcImNvdmVyXCIgJiYgdmFsdWUgIT0gXCJjb250YWluXCIgJiYgdmFsdWUgIT0gXCJtYXhcIikge1xuICAgICAgICB2YWx1ZSA9IFwiY292ZXJcIjtcbiAgICB9XG4gICAgY29uZmlnLmN1c3RvbUJhY2tncm91bmRTaXplID0gdmFsdWU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiY3VzdG9tQmFja2dyb3VuZFNpemVcIiwgbm9zYXZlKTtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImN1c3RvbUJhY2tncm91bmRTaXplXCIsIGNvbmZpZy5jdXN0b21CYWNrZ3JvdW5kU2l6ZSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEN1c3RvbUJhY2tncm91bmRTaXplID0gc2V0Q3VzdG9tQmFja2dyb3VuZFNpemU7XG5mdW5jdGlvbiBzZXRDdXN0b21CYWNrZ3JvdW5kRmlsdGVyKGFycmF5LCBub3NhdmUpIHtcbiAgICBpZiAoISgwLCBjb25maWdfdmFsaWRhdGlvbl8xLmlzQ29uZmlnVmFsdWVWYWxpZCkoXCJjdXN0b20gYmFja2dyb3VuZCBmaWx0ZXJcIiwgYXJyYXksIFtcIm51bWJlckFycmF5XCJdKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbmZpZy5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyID0gYXJyYXk7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiY3VzdG9tQmFja2dyb3VuZEZpbHRlclwiLCBub3NhdmUpO1xuICAgIENvbmZpZ0V2ZW50LmRpc3BhdGNoKFwiY3VzdG9tQmFja2dyb3VuZEZpbHRlclwiLCBjb25maWcuY3VzdG9tQmFja2dyb3VuZEZpbHRlcik7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEN1c3RvbUJhY2tncm91bmRGaWx0ZXIgPSBzZXRDdXN0b21CYWNrZ3JvdW5kRmlsdGVyO1xuZnVuY3Rpb24gc2V0TW9ua2V5UG93ZXJMZXZlbChsZXZlbCwgbm9zYXZlKSB7XG4gICAgaWYgKCEoMCwgY29uZmlnX3ZhbGlkYXRpb25fMS5pc0NvbmZpZ1ZhbHVlVmFsaWQpKFwibW9ua2V5IHBvd2VyIGxldmVsXCIsIGxldmVsLCBbXG4gICAgICAgIFtcIm9mZlwiLCBcIjFcIiwgXCIyXCIsIFwiM1wiLCBcIjRcIl0sXG4gICAgXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoIVtcIm9mZlwiLCBcIjFcIiwgXCIyXCIsIFwiM1wiLCBcIjRcIl0uaW5jbHVkZXMobGV2ZWwpKVxuICAgICAgICBsZXZlbCA9IFwib2ZmXCI7XG4gICAgY29uZmlnLm1vbmtleVBvd2VyTGV2ZWwgPSBsZXZlbDtcbiAgICBzYXZlVG9Mb2NhbFN0b3JhZ2UoXCJtb25rZXlQb3dlckxldmVsXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJtb25rZXlQb3dlckxldmVsXCIsIGNvbmZpZy5tb25rZXlQb3dlckxldmVsKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0TW9ua2V5UG93ZXJMZXZlbCA9IHNldE1vbmtleVBvd2VyTGV2ZWw7XG5mdW5jdGlvbiBzZXRCdXJzdEhlYXRtYXAodmFsdWUsIG5vc2F2ZSkge1xuICAgIGlmICghKDAsIGNvbmZpZ192YWxpZGF0aW9uXzEuaXNDb25maWdWYWx1ZVZhbGlkKShcImJ1cnN0IGhlYXRtYXBcIiwgdmFsdWUsIFtcImJvb2xlYW5cIl0pKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICB2YWx1ZSA9IGZhbHNlO1xuICAgIH1cbiAgICBjb25maWcuYnVyc3RIZWF0bWFwID0gdmFsdWU7XG4gICAgc2F2ZVRvTG9jYWxTdG9yYWdlKFwiYnVyc3RIZWF0bWFwXCIsIG5vc2F2ZSk7XG4gICAgQ29uZmlnRXZlbnQuZGlzcGF0Y2goXCJidXJzdEhlYXRtYXBcIiwgY29uZmlnLmJ1cnN0SGVhdG1hcCk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnRzLnNldEJ1cnN0SGVhdG1hcCA9IHNldEJ1cnN0SGVhdG1hcDtcbmZ1bmN0aW9uIGFwcGx5KGNvbmZpZ1RvQXBwbHkpIHtcbiAgICBpZiAoIWNvbmZpZ1RvQXBwbHkpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBjb25maWdPYmogPSBjb25maWdUb0FwcGx5O1xuICAgIE9iamVjdC5rZXlzKGRlZmF1bHRfY29uZmlnXzEuZGVmYXVsdCkuZm9yRWFjaCgoY29uZmlnS2V5KSA9PiB7XG4gICAgICAgIGlmIChjb25maWdPYmpbY29uZmlnS2V5XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IGRlZmF1bHRfY29uZmlnXzEuZGVmYXVsdFtjb25maWdLZXldO1xuICAgICAgICAgICAgY29uZmlnT2JqW2NvbmZpZ0tleV0gPSBuZXdWYWx1ZTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGlmIChjb25maWdPYmogIT09IHVuZGVmaW5lZCAmJiBjb25maWdPYmogIT09IG51bGwpIHtcbiAgICAgICAgc2V0VGhlbWVMaWdodChjb25maWdPYmoudGhlbWVMaWdodCwgdHJ1ZSk7XG4gICAgICAgIHNldFRoZW1lRGFyayhjb25maWdPYmoudGhlbWVEYXJrLCB0cnVlKTtcbiAgICAgICAgc2V0QXV0b1N3aXRjaFRoZW1lKGNvbmZpZ09iai5hdXRvU3dpdGNoVGhlbWUsIHRydWUpO1xuICAgICAgICBzZXRUaGVtZXMoY29uZmlnT2JqLnRoZW1lLCBjb25maWdPYmouY3VzdG9tVGhlbWUsIGNvbmZpZ09iai5jdXN0b21UaGVtZUNvbG9ycywgdHJ1ZSk7XG4gICAgICAgIHNldEN1c3RvbUxheW91dGZsdWlkKGNvbmZpZ09iai5jdXN0b21MYXlvdXRmbHVpZCwgdHJ1ZSk7XG4gICAgICAgIHNldEN1c3RvbUJhY2tncm91bmQoY29uZmlnT2JqLmN1c3RvbUJhY2tncm91bmQsIHRydWUpO1xuICAgICAgICBzZXRDdXN0b21CYWNrZ3JvdW5kU2l6ZShjb25maWdPYmouY3VzdG9tQmFja2dyb3VuZFNpemUsIHRydWUpO1xuICAgICAgICBzZXRDdXN0b21CYWNrZ3JvdW5kRmlsdGVyKGNvbmZpZ09iai5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyLCB0cnVlKTtcbiAgICAgICAgc2V0UXVpY2tUYWJNb2RlKGNvbmZpZ09iai5xdWlja1RhYiwgdHJ1ZSk7XG4gICAgICAgIHNldEtleVRpcHMoY29uZmlnT2JqLnNob3dLZXlUaXBzLCB0cnVlKTtcbiAgICAgICAgc2V0VGltZUNvbmZpZyhjb25maWdPYmoudGltZSwgdHJ1ZSk7XG4gICAgICAgIHNldFF1b3RlTGVuZ3RoKGNvbmZpZ09iai5xdW90ZUxlbmd0aCwgdHJ1ZSk7XG4gICAgICAgIHNldFdvcmRDb3VudChjb25maWdPYmoud29yZHMsIHRydWUpO1xuICAgICAgICBzZXRMYW5ndWFnZShjb25maWdPYmoubGFuZ3VhZ2UsIHRydWUpO1xuICAgICAgICBzZXRMYXlvdXQoY29uZmlnT2JqLmxheW91dCwgdHJ1ZSk7XG4gICAgICAgIHNldEZvbnRTaXplKGNvbmZpZ09iai5mb250U2l6ZSwgdHJ1ZSk7XG4gICAgICAgIHNldEZyZWVkb21Nb2RlKGNvbmZpZ09iai5mcmVlZG9tTW9kZSwgdHJ1ZSk7XG4gICAgICAgIHNldENhcmV0U3R5bGUoY29uZmlnT2JqLmNhcmV0U3R5bGUsIHRydWUpO1xuICAgICAgICBzZXRQYWNlQ2FyZXRTdHlsZShjb25maWdPYmoucGFjZUNhcmV0U3R5bGUsIHRydWUpO1xuICAgICAgICBzZXREaWZmaWN1bHR5KGNvbmZpZ09iai5kaWZmaWN1bHR5LCB0cnVlKTtcbiAgICAgICAgc2V0QmxpbmRNb2RlKGNvbmZpZ09iai5ibGluZE1vZGUsIHRydWUpO1xuICAgICAgICBzZXRRdWlja0VuZChjb25maWdPYmoucXVpY2tFbmQsIHRydWUpO1xuICAgICAgICBzZXRGbGlwVGVzdENvbG9ycyhjb25maWdPYmouZmxpcFRlc3RDb2xvcnMsIHRydWUpO1xuICAgICAgICBzZXRDb2xvcmZ1bE1vZGUoY29uZmlnT2JqLmNvbG9yZnVsTW9kZSwgdHJ1ZSk7XG4gICAgICAgIHNldENvbmZpZGVuY2VNb2RlKGNvbmZpZ09iai5jb25maWRlbmNlTW9kZSwgdHJ1ZSk7XG4gICAgICAgIHNldEluZGljYXRlVHlwb3MoY29uZmlnT2JqLmluZGljYXRlVHlwb3MsIHRydWUpO1xuICAgICAgICBzZXRUaW1lclN0eWxlKGNvbmZpZ09iai50aW1lclN0eWxlLCB0cnVlKTtcbiAgICAgICAgc2V0VGltZXJDb2xvcihjb25maWdPYmoudGltZXJDb2xvciwgdHJ1ZSk7XG4gICAgICAgIHNldFRpbWVyT3BhY2l0eShjb25maWdPYmoudGltZXJPcGFjaXR5LCB0cnVlKTtcbiAgICAgICAgc2V0S2V5bWFwTW9kZShjb25maWdPYmoua2V5bWFwTW9kZSwgdHJ1ZSk7XG4gICAgICAgIHNldEtleW1hcFN0eWxlKGNvbmZpZ09iai5rZXltYXBTdHlsZSwgdHJ1ZSk7XG4gICAgICAgIHNldEtleW1hcExlZ2VuZFN0eWxlKGNvbmZpZ09iai5rZXltYXBMZWdlbmRTdHlsZSwgdHJ1ZSk7XG4gICAgICAgIHNldEtleW1hcExheW91dChjb25maWdPYmoua2V5bWFwTGF5b3V0LCB0cnVlKTtcbiAgICAgICAgc2V0Rm9udEZhbWlseShjb25maWdPYmouZm9udEZhbWlseSwgdHJ1ZSk7XG4gICAgICAgIHNldFNtb290aENhcmV0KGNvbmZpZ09iai5zbW9vdGhDYXJldCwgdHJ1ZSk7XG4gICAgICAgIHNldFNtb290aExpbmVTY3JvbGwoY29uZmlnT2JqLnNtb290aExpbmVTY3JvbGwsIHRydWUpO1xuICAgICAgICBzZXRTaG93TGl2ZVdwbShjb25maWdPYmouc2hvd0xpdmVXcG0sIHRydWUpO1xuICAgICAgICBzZXRTaG93TGl2ZUFjYyhjb25maWdPYmouc2hvd0xpdmVBY2MsIHRydWUpO1xuICAgICAgICBzZXRTaG93TGl2ZUJ1cnN0KGNvbmZpZ09iai5zaG93TGl2ZUJ1cnN0LCB0cnVlKTtcbiAgICAgICAgc2V0U2hvd1RpbWVyUHJvZ3Jlc3MoY29uZmlnT2JqLnNob3dUaW1lclByb2dyZXNzLCB0cnVlKTtcbiAgICAgICAgc2V0QWx3YXlzU2hvd0RlY2ltYWxQbGFjZXMoY29uZmlnT2JqLmFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzLCB0cnVlKTtcbiAgICAgICAgc2V0QWx3YXlzU2hvd1dvcmRzSGlzdG9yeShjb25maWdPYmouYWx3YXlzU2hvd1dvcmRzSGlzdG9yeSwgdHJ1ZSk7XG4gICAgICAgIHNldFNpbmdsZUxpc3RDb21tYW5kTGluZShjb25maWdPYmouc2luZ2xlTGlzdENvbW1hbmRMaW5lLCB0cnVlKTtcbiAgICAgICAgc2V0Q2Fwc0xvY2tXYXJuaW5nKGNvbmZpZ09iai5jYXBzTG9ja1dhcm5pbmcsIHRydWUpO1xuICAgICAgICBzZXRQbGF5U291bmRPbkVycm9yKGNvbmZpZ09iai5wbGF5U291bmRPbkVycm9yLCB0cnVlKTtcbiAgICAgICAgc2V0UGxheVNvdW5kT25DbGljayhjb25maWdPYmoucGxheVNvdW5kT25DbGljaywgdHJ1ZSk7XG4gICAgICAgIHNldFNvdW5kVm9sdW1lKGNvbmZpZ09iai5zb3VuZFZvbHVtZSwgdHJ1ZSk7XG4gICAgICAgIHNldFN0b3BPbkVycm9yKGNvbmZpZ09iai5zdG9wT25FcnJvciwgdHJ1ZSk7XG4gICAgICAgIHNldEZhdlRoZW1lcyhjb25maWdPYmouZmF2VGhlbWVzLCB0cnVlKTtcbiAgICAgICAgc2V0RnVuYm94KGNvbmZpZ09iai5mdW5ib3gsIHRydWUpO1xuICAgICAgICBzZXRSYW5kb21UaGVtZShjb25maWdPYmoucmFuZG9tVGhlbWUsIHRydWUpO1xuICAgICAgICBzZXRTaG93QWxsTGluZXMoY29uZmlnT2JqLnNob3dBbGxMaW5lcywgdHJ1ZSk7XG4gICAgICAgIHNldFN3YXBFc2NBbmRUYWIoY29uZmlnT2JqLnN3YXBFc2NBbmRUYWIsIHRydWUpO1xuICAgICAgICBzZXRTaG93T3V0T2ZGb2N1c1dhcm5pbmcoY29uZmlnT2JqLnNob3dPdXRPZkZvY3VzV2FybmluZywgdHJ1ZSk7XG4gICAgICAgIHNldFBhY2VDYXJldChjb25maWdPYmoucGFjZUNhcmV0LCB0cnVlKTtcbiAgICAgICAgc2V0UGFjZUNhcmV0Q3VzdG9tU3BlZWQoY29uZmlnT2JqLnBhY2VDYXJldEN1c3RvbVNwZWVkLCB0cnVlKTtcbiAgICAgICAgc2V0UmVwZWF0ZWRQYWNlKGNvbmZpZ09iai5yZXBlYXRlZFBhY2UsIHRydWUpO1xuICAgICAgICBzZXRQYWdlV2lkdGgoY29uZmlnT2JqLnBhZ2VXaWR0aCwgdHJ1ZSk7XG4gICAgICAgIHNldENoYXJ0QWNjdXJhY3koY29uZmlnT2JqLmNoYXJ0QWNjdXJhY3ksIHRydWUpO1xuICAgICAgICBzZXRDaGFydFN0eWxlKGNvbmZpZ09iai5jaGFydFN0eWxlLCB0cnVlKTtcbiAgICAgICAgc2V0TWluQnVyc3QoY29uZmlnT2JqLm1pbkJ1cnN0LCB0cnVlKTtcbiAgICAgICAgc2V0TWluQnVyc3RDdXN0b21TcGVlZChjb25maWdPYmoubWluQnVyc3RDdXN0b21TcGVlZCwgdHJ1ZSk7XG4gICAgICAgIHNldE1pbldwbShjb25maWdPYmoubWluV3BtLCB0cnVlKTtcbiAgICAgICAgc2V0TWluV3BtQ3VzdG9tU3BlZWQoY29uZmlnT2JqLm1pbldwbUN1c3RvbVNwZWVkLCB0cnVlKTtcbiAgICAgICAgc2V0TWluQWNjKGNvbmZpZ09iai5taW5BY2MsIHRydWUpO1xuICAgICAgICBzZXRNaW5BY2NDdXN0b20oY29uZmlnT2JqLm1pbkFjY0N1c3RvbSwgdHJ1ZSk7XG4gICAgICAgIHNldE51bWJlcnMoY29uZmlnT2JqLm51bWJlcnMsIHRydWUpO1xuICAgICAgICBzZXRQdW5jdHVhdGlvbihjb25maWdPYmoucHVuY3R1YXRpb24sIHRydWUpO1xuICAgICAgICBzZXRIaWdobGlnaHRNb2RlKGNvbmZpZ09iai5oaWdobGlnaHRNb2RlLCB0cnVlKTtcbiAgICAgICAgc2V0QWx3YXlzU2hvd0NQTShjb25maWdPYmouYWx3YXlzU2hvd0NQTSwgdHJ1ZSk7XG4gICAgICAgIHNldEhpZGVFeHRyYUxldHRlcnMoY29uZmlnT2JqLmhpZGVFeHRyYUxldHRlcnMsIHRydWUpO1xuICAgICAgICBzZXRTdGFydEdyYXBoc0F0WmVybyhjb25maWdPYmouc3RhcnRHcmFwaHNBdFplcm8sIHRydWUpO1xuICAgICAgICBzZXRTdHJpY3RTcGFjZShjb25maWdPYmouc3RyaWN0U3BhY2UsIHRydWUpO1xuICAgICAgICBzZXRPcHBvc2l0ZVNoaWZ0TW9kZShjb25maWdPYmoub3Bwb3NpdGVTaGlmdE1vZGUsIHRydWUpO1xuICAgICAgICBzZXRNb2RlKGNvbmZpZ09iai5tb2RlLCB0cnVlKTtcbiAgICAgICAgc2V0TW9ua2V5KGNvbmZpZ09iai5tb25rZXksIHRydWUpO1xuICAgICAgICBzZXRSZXBlYXRRdW90ZXMoY29uZmlnT2JqLnJlcGVhdFF1b3RlcywgdHJ1ZSk7XG4gICAgICAgIHNldE1vbmtleVBvd2VyTGV2ZWwoY29uZmlnT2JqLm1vbmtleVBvd2VyTGV2ZWwsIHRydWUpO1xuICAgICAgICBzZXRCdXJzdEhlYXRtYXAoY29uZmlnT2JqLmJ1cnN0SGVhdG1hcCwgdHJ1ZSk7XG4gICAgICAgIHNldEJyaXRpc2hFbmdsaXNoKGNvbmZpZ09iai5icml0aXNoRW5nbGlzaCwgdHJ1ZSk7XG4gICAgICAgIHNldExhenlNb2RlKGNvbmZpZ09iai5sYXp5TW9kZSwgdHJ1ZSk7XG4gICAgICAgIHNldFNob3dBdmVyYWdlKGNvbmZpZ09iai5zaG93QXZlcmFnZSwgdHJ1ZSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzZXRFbmFibGVBZHMoY29uZmlnT2JqLmVuYWJsZUFkcywgdHJ1ZSk7XG4gICAgICAgICAgICBpZiAoY29uZmlnLmVuYWJsZUFkcyA9PT0gXCJtYXhcIiB8fCBjb25maWcuZW5hYmxlQWRzID09PSBcIm9uXCIpIHtcbiAgICAgICAgICAgICAgICAkKFwiaGVhZFwiKS5hcHBlbmQoYFxuICAgICAgICAgIDxzY3JpcHRcbiAgICAgICAgICBzcmM9XCJodHRwczovL2hiLnZudHNtLmNvbS92My9saXZlL2FkLW1hbmFnZXIubWluLmpzXCJcbiAgICAgICAgICB0eXBlPVwidGV4dC9qYXZhc2NyaXB0XCJcbiAgICAgICAgICBkYXRhLXNpdGUtaWQ9XCI2MGI3OGFmMTIxMTkxMjJiODk1ODkxMGZcIlxuICAgICAgICAgIGRhdGEtbW9kZT1cInNjYW5cIlxuICAgICAgICAgIGlkPVwiYWRTY3JpcHRcIlxuICAgICAgICAgIGFzeW5jXG4gICAgICAgICAgPjwvc2NyaXB0PlxuICAgICAgICBgKTtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmVuYWJsZUFkcyA9PT0gXCJtYXhcIikge1xuICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICAkKFwiI2FkX3JpY2hfbWVkaWFcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgICAgICQoXCIjYWRfcmljaF9tZWRpYVwiKS5odG1sKGA8ZGl2IGNsYXNzPVwidm0tcGxhY2VtZW50XCIgZGF0YS1pZD1cIjYwYmY3MzdlZTA0Y2I3NjFjODhhYWZiMVwiIHN0eWxlPVwiZGlzcGxheTpub25lXCI+PC9kaXY+YCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKFwiI2FkX3JpY2hfbWVkaWFcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vPGRpdiBjbGFzcz1cInZtLXBsYWNlbWVudFwiIGRhdGEtaWQ9XCI2MGJmNzNkYWUwNGNiNzYxYzg4YWFmYjVcIj48L2Rpdj5cbiAgICAgICAgICAgICAgICAkKFwiI2FkX2Zvb3RlclwiKS5odG1sKGA8ZGl2IGNsYXNzPVwidm0tcGxhY2VtZW50XCIgZGF0YS1pZD1cIjYwYmY3M2RhZTA0Y2I3NjFjODhhYWZiNVwiPjwvZGl2PmApO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfZm9vdGVyXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIC8vICQoXCIjYWRfZm9vdGVyMlwiKS5odG1sKGA8ZGl2IGNsYXNzPVwidm0tcGxhY2VtZW50XCIgZGF0YS1pZD1cIjYwYmY3M2U5ZTA0Y2I3NjFjODhhYWZiN1wiPjwvZGl2PmApO1xuICAgICAgICAgICAgICAgIC8vICQoXCIjYWRfZm9vdGVyMlwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX2Fib3V0MVwiKS5odG1sKGA8ZGl2IGNsYXNzPVwidm0tcGxhY2VtZW50XCIgZGF0YS1pZD1cIjYwYmY3M2RhZTA0Y2I3NjFjODhhYWZiNVwiPjwvZGl2PmApO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfYWJvdXQxXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfYWJvdXQyXCIpLmh0bWwoYDxkaXYgY2xhc3M9XCJ2bS1wbGFjZW1lbnRcIiBkYXRhLWlkPVwiNjBiZjczZGFlMDRjYjc2MWM4OGFhZmI1XCI+PC9kaXY+YCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9hYm91dDJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9zZXR0aW5nczBcIikuaHRtbChgPGRpdiBjbGFzcz1cInZtLXBsYWNlbWVudFwiIGRhdGEtaWQ9XCI2MGJmNzNkYWUwNGNiNzYxYzg4YWFmYjVcIj48L2Rpdj5gKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX3NldHRpbmdzMFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX3NldHRpbmdzMVwiKS5odG1sKGA8ZGl2IGNsYXNzPVwidm0tcGxhY2VtZW50XCIgZGF0YS1pZD1cIjYwYmY3M2RhZTA0Y2I3NjFjODhhYWZiNVwiPjwvZGl2PmApO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfc2V0dGluZ3MxXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfc2V0dGluZ3MyXCIpLmh0bWwoYDxkaXYgY2xhc3M9XCJ2bS1wbGFjZW1lbnRcIiBkYXRhLWlkPVwiNjBiZjczZGFlMDRjYjc2MWM4OGFhZmI1XCI+PC9kaXY+YCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9zZXR0aW5nczJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9zZXR0aW5nczNcIikuaHRtbChgPGRpdiBjbGFzcz1cInZtLXBsYWNlbWVudFwiIGRhdGEtaWQ9XCI2MGJmNzNkYWUwNGNiNzYxYzg4YWFmYjVcIj48L2Rpdj5gKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX3NldHRpbmdzM1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX2FjY291bnRcIikuaHRtbChgPGRpdiBjbGFzcz1cInZtLXBsYWNlbWVudFwiIGRhdGEtaWQ9XCI2MGJmNzNkYWUwNGNiNzYxYzg4YWFmYjVcIj48L2Rpdj5gKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX2FjY291bnRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgJChcIi5mb290ZXJhZHNcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKFwiI2FkU2NyaXB0XCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoXCIuZm9vdGVyYWRzXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfbGVmdFwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX3JpZ2h0XCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfZm9vdGVyXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfZm9vdGVyMlwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKFwiI2FkX2Zvb3RlcjNcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9zZXR0aW5nczBcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9zZXR0aW5nczFcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9zZXR0aW5nczJcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9zZXR0aW5nczNcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJChcIiNhZF9hY2NvdW50XCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfYWJvdXQxXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoXCIjYWRfYWJvdXQyXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVycm9yIGluaXRpYWxpc2luZyBhZHM6IFwiICsgZS5tZXNzYWdlKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgaW5pdGlhbGlzaW5nIGFkcyBcIiArIGUubWVzc2FnZSk7XG4gICAgICAgICAgICAkKFwiLmZvb3RlcmFkc1wiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICQoXCIjYWRfbGVmdFwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICQoXCIjYWRfcmlnaHRcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAkKFwiI2FkX2Zvb3RlclwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICQoXCIjYWRfZm9vdGVyMlwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICQoXCIjYWRfZm9vdGVyM1wiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICQoXCIjYWRfc2V0dGluZ3MwXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgJChcIiNhZF9zZXR0aW5nczFcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAkKFwiI2FkX3NldHRpbmdzMlwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICQoXCIjYWRfc2V0dGluZ3MzXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgJChcIiNhZF9hY2NvdW50XCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgJChcIiNhZF9hYm91dDFcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAkKFwiI2FkX2Fib3V0MlwiKS5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgICAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImNvbmZpZ0FwcGxpZWRcIiwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgY29uZmlnKTtcbiAgICB9XG59XG5leHBvcnRzLmFwcGx5ID0gYXBwbHk7XG5mdW5jdGlvbiByZXNldCgpIHtcbiAgICBDb25maWdFdmVudC5kaXNwYXRjaChcImZ1bGxDb25maWdDaGFuZ2VcIik7XG4gICAgYXBwbHkoZGVmYXVsdF9jb25maWdfMS5kZWZhdWx0KTtcbiAgICBzYXZlRnVsbENvbmZpZ1RvTG9jYWxTdG9yYWdlKCk7XG59XG5leHBvcnRzLnJlc2V0ID0gcmVzZXQ7XG5mdW5jdGlvbiBsb2FkRnJvbUxvY2FsU3RvcmFnZSgpIHtcbiAgICBjb25zb2xlLmxvZyhcImxvYWRpbmcgbG9jYWxTdG9yYWdlIGNvbmZpZ1wiKTtcbiAgICBjb25zdCBuZXdDb25maWdTdHJpbmcgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJjb25maWdcIik7XG4gICAgbGV0IG5ld0NvbmZpZztcbiAgICBpZiAobmV3Q29uZmlnU3RyaW5nICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgbmV3Q29uZmlnU3RyaW5nICE9PSBudWxsICYmXG4gICAgICAgIG5ld0NvbmZpZ1N0cmluZyAhPT0gXCJcIikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbmV3Q29uZmlnID0gSlNPTi5wYXJzZShuZXdDb25maWdTdHJpbmcpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBuZXdDb25maWcgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICBhcHBseShuZXdDb25maWcpO1xuICAgICAgICBjb25zb2xlLmxvZyhcImFwcGx5aW5nIGxvY2FsU3RvcmFnZSBjb25maWdcIik7XG4gICAgICAgIGV4cG9ydHMubG9jYWxTdG9yYWdlQ29uZmlnID0gbmV3Q29uZmlnO1xuICAgICAgICBzYXZlRnVsbENvbmZpZ1RvTG9jYWxTdG9yYWdlKHRydWUpO1xuICAgICAgICBjb25zb2xlLmxvZyhcInNhdmluZyBsb2NhbFN0b3JhZ2UgY29uZmlnXCIpO1xuICAgIH1cbiAgICAvLyBUZXN0TG9naWMucmVzdGFydChmYWxzZSwgdHJ1ZSk7XG4gICAgbG9hZERvbmUoKTtcbn1cbmV4cG9ydHMubG9hZEZyb21Mb2NhbFN0b3JhZ2UgPSBsb2FkRnJvbUxvY2FsU3RvcmFnZTtcbmZ1bmN0aW9uIGdldENvbmZpZ0NoYW5nZXMoKSB7XG4gICAgY29uc3QgY29uZmlnQ2hhbmdlcyA9IHt9O1xuICAgIE9iamVjdC5rZXlzKGNvbmZpZylcbiAgICAgICAgLmZpbHRlcigoa2V5KSA9PiB7XG4gICAgICAgIHJldHVybiBjb25maWdba2V5XSAhPSBkZWZhdWx0X2NvbmZpZ18xLmRlZmF1bHRba2V5XTtcbiAgICB9KVxuICAgICAgICAuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgIGNvbmZpZ0NoYW5nZXNba2V5XSA9IGNvbmZpZ1trZXldO1xuICAgIH0pO1xuICAgIHJldHVybiBjb25maWdDaGFuZ2VzO1xufVxuZXhwb3J0cy5nZXRDb25maWdDaGFuZ2VzID0gZ2V0Q29uZmlnQ2hhbmdlcztcbmZ1bmN0aW9uIHNldENvbmZpZyhuZXdDb25maWcpIHtcbiAgICBjb25maWcgPSBuZXdDb25maWc7XG59XG5leHBvcnRzLnNldENvbmZpZyA9IHNldENvbmZpZztcbmV4cG9ydHMubG9hZFByb21pc2UgPSBuZXcgUHJvbWlzZSgodikgPT4ge1xuICAgIGxvYWREb25lID0gdjtcbn0pO1xuZXhwb3J0cy5kZWZhdWx0ID0gY29uZmlnO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmRlZmF1bHQgPSB7XG4gICAgdGhlbWU6IFwic2VyaWthX2RhcmtcIixcbiAgICB0aGVtZUxpZ2h0OiBcInNlcmlrYVwiLFxuICAgIHRoZW1lRGFyazogXCJzZXJpa2FfZGFya1wiLFxuICAgIGF1dG9Td2l0Y2hUaGVtZTogZmFsc2UsXG4gICAgY3VzdG9tVGhlbWU6IGZhbHNlLFxuICAgIGN1c3RvbVRoZW1lQ29sb3JzOiBbXG4gICAgICAgIFwiIzMyMzQzN1wiLFxuICAgICAgICBcIiNlMmI3MTRcIixcbiAgICAgICAgXCIjZTJiNzE0XCIsXG4gICAgICAgIFwiIzY0NjY2OVwiLFxuICAgICAgICBcIiNkMWQwYzVcIixcbiAgICAgICAgXCIjY2E0NzU0XCIsXG4gICAgICAgIFwiIzdlMmEzM1wiLFxuICAgICAgICBcIiNjYTQ3NTRcIixcbiAgICAgICAgXCIjN2UyYTMzXCIsXG4gICAgXSxcbiAgICBmYXZUaGVtZXM6IFtdLFxuICAgIHNob3dLZXlUaXBzOiB0cnVlLFxuICAgIHNob3dMaXZlV3BtOiBmYWxzZSxcbiAgICBzaG93VGltZXJQcm9ncmVzczogdHJ1ZSxcbiAgICBzbW9vdGhDYXJldDogdHJ1ZSxcbiAgICBxdWlja1RhYjogZmFsc2UsXG4gICAgcHVuY3R1YXRpb246IGZhbHNlLFxuICAgIG51bWJlcnM6IGZhbHNlLFxuICAgIHdvcmRzOiA1MCxcbiAgICB0aW1lOiAzMCxcbiAgICBtb2RlOiBcInRpbWVcIixcbiAgICBxdW90ZUxlbmd0aDogWzFdLFxuICAgIGxhbmd1YWdlOiBcImVuZ2xpc2hcIixcbiAgICBmb250U2l6ZTogXCIxNVwiLFxuICAgIGZyZWVkb21Nb2RlOiBmYWxzZSxcbiAgICByZXN1bHRGaWx0ZXJzOiBudWxsLFxuICAgIGRpZmZpY3VsdHk6IFwibm9ybWFsXCIsXG4gICAgYmxpbmRNb2RlOiBmYWxzZSxcbiAgICBxdWlja0VuZDogZmFsc2UsXG4gICAgY2FyZXRTdHlsZTogXCJkZWZhdWx0XCIsXG4gICAgcGFjZUNhcmV0U3R5bGU6IFwiZGVmYXVsdFwiLFxuICAgIGZsaXBUZXN0Q29sb3JzOiBmYWxzZSxcbiAgICBsYXlvdXQ6IFwiZGVmYXVsdFwiLFxuICAgIGZ1bmJveDogXCJub25lXCIsXG4gICAgY29uZmlkZW5jZU1vZGU6IFwib2ZmXCIsXG4gICAgaW5kaWNhdGVUeXBvczogXCJvZmZcIixcbiAgICB0aW1lclN0eWxlOiBcIm1pbmlcIixcbiAgICBjb2xvcmZ1bE1vZGU6IGZhbHNlLFxuICAgIHJhbmRvbVRoZW1lOiBcIm9mZlwiLFxuICAgIHRpbWVyQ29sb3I6IFwibWFpblwiLFxuICAgIHRpbWVyT3BhY2l0eTogXCIxXCIsXG4gICAgc3RvcE9uRXJyb3I6IFwib2ZmXCIsXG4gICAgc2hvd0FsbExpbmVzOiBmYWxzZSxcbiAgICBrZXltYXBNb2RlOiBcIm9mZlwiLFxuICAgIGtleW1hcFN0eWxlOiBcInN0YWdnZXJlZFwiLFxuICAgIGtleW1hcExlZ2VuZFN0eWxlOiBcImxvd2VyY2FzZVwiLFxuICAgIGtleW1hcExheW91dDogXCJvdmVycmlkZVN5bmNcIixcbiAgICBmb250RmFtaWx5OiBcIlJvYm90b19Nb25vXCIsXG4gICAgc21vb3RoTGluZVNjcm9sbDogZmFsc2UsXG4gICAgYWx3YXlzU2hvd0RlY2ltYWxQbGFjZXM6IGZhbHNlLFxuICAgIGFsd2F5c1Nob3dXb3Jkc0hpc3Rvcnk6IGZhbHNlLFxuICAgIHNpbmdsZUxpc3RDb21tYW5kTGluZTogXCJtYW51YWxcIixcbiAgICBjYXBzTG9ja1dhcm5pbmc6IHRydWUsXG4gICAgcGxheVNvdW5kT25FcnJvcjogZmFsc2UsXG4gICAgcGxheVNvdW5kT25DbGljazogXCJvZmZcIixcbiAgICBzb3VuZFZvbHVtZTogXCIwLjVcIixcbiAgICBzdGFydEdyYXBoc0F0WmVybzogdHJ1ZSxcbiAgICBzd2FwRXNjQW5kVGFiOiBmYWxzZSxcbiAgICBzaG93T3V0T2ZGb2N1c1dhcm5pbmc6IHRydWUsXG4gICAgcGFjZUNhcmV0OiBcIm9mZlwiLFxuICAgIHBhY2VDYXJldEN1c3RvbVNwZWVkOiAxMDAsXG4gICAgcmVwZWF0ZWRQYWNlOiB0cnVlLFxuICAgIHBhZ2VXaWR0aDogXCIxMDBcIixcbiAgICBjaGFydEFjY3VyYWN5OiB0cnVlLFxuICAgIGNoYXJ0U3R5bGU6IFwibGluZVwiLFxuICAgIG1pbldwbTogXCJvZmZcIixcbiAgICBtaW5XcG1DdXN0b21TcGVlZDogMTAwLFxuICAgIGhpZ2hsaWdodE1vZGU6IFwibGV0dGVyXCIsXG4gICAgYWx3YXlzU2hvd0NQTTogZmFsc2UsXG4gICAgZW5hYmxlQWRzOiBcIm9mZlwiLFxuICAgIGhpZGVFeHRyYUxldHRlcnM6IGZhbHNlLFxuICAgIHN0cmljdFNwYWNlOiBmYWxzZSxcbiAgICBtaW5BY2M6IFwib2ZmXCIsXG4gICAgbWluQWNjQ3VzdG9tOiA5MCxcbiAgICBzaG93TGl2ZUFjYzogZmFsc2UsXG4gICAgc2hvd0xpdmVCdXJzdDogZmFsc2UsXG4gICAgbW9ua2V5OiBmYWxzZSxcbiAgICByZXBlYXRRdW90ZXM6IFwib2ZmXCIsXG4gICAgb3Bwb3NpdGVTaGlmdE1vZGU6IFwib2ZmXCIsXG4gICAgY3VzdG9tQmFja2dyb3VuZDogXCJcIixcbiAgICBjdXN0b21CYWNrZ3JvdW5kU2l6ZTogXCJjb3ZlclwiLFxuICAgIGN1c3RvbUJhY2tncm91bmRGaWx0ZXI6IFswLCAxLCAxLCAxLCAxXSxcbiAgICBjdXN0b21MYXlvdXRmbHVpZDogXCJxd2VydHkjZHZvcmFrI2NvbGVtYWtcIixcbiAgICBtb25rZXlQb3dlckxldmVsOiBcIm9mZlwiLFxuICAgIG1pbkJ1cnN0OiBcIm9mZlwiLFxuICAgIG1pbkJ1cnN0Q3VzdG9tU3BlZWQ6IDEwMCxcbiAgICBidXJzdEhlYXRtYXA6IGZhbHNlLFxuICAgIGJyaXRpc2hFbmdsaXNoOiBmYWxzZSxcbiAgICBsYXp5TW9kZTogZmFsc2UsXG4gICAgc2hvd0F2ZXJhZ2U6IFwib2ZmXCIsXG59O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmRlZmF1bHRTbmFwID0gdm9pZCAwO1xuZXhwb3J0cy5kZWZhdWx0U25hcCA9IHtcbiAgICByZXN1bHRzOiB1bmRlZmluZWQsXG4gICAgcGVyc29uYWxCZXN0czoge1xuICAgICAgICB0aW1lOiB7fSxcbiAgICAgICAgd29yZHM6IHt9LFxuICAgICAgICB6ZW46IHsgemVuOiBbXSB9LFxuICAgICAgICBxdW90ZTogeyBjdXN0b206IFtdIH0sXG4gICAgICAgIGN1c3RvbTogeyBjdXN0b206IFtdIH0sXG4gICAgfSxcbiAgICBuYW1lOiBcIlwiLFxuICAgIGN1c3RvbVRoZW1lczogW10sXG4gICAgcHJlc2V0czogW10sXG4gICAgdGFnczogW10sXG4gICAgZmF2b3VyaXRlVGhlbWVzOiBbXSxcbiAgICBiYW5uZWQ6IHVuZGVmaW5lZCxcbiAgICB2ZXJpZmllZDogdW5kZWZpbmVkLFxuICAgIGVtYWlsVmVyaWZpZWQ6IHVuZGVmaW5lZCxcbiAgICBsYk1lbW9yeTogeyB0aW1lOiB7IDE1OiB7IGVuZ2xpc2g6IDAgfSwgNjA6IHsgZW5nbGlzaDogMCB9IH0gfSxcbiAgICBnbG9iYWxTdGF0czoge1xuICAgICAgICB0aW1lOiAwLFxuICAgICAgICBzdGFydGVkOiAwLFxuICAgICAgICBjb21wbGV0ZWQ6IDAsXG4gICAgfSxcbiAgICBxdW90ZVJhdGluZ3M6IHVuZGVmaW5lZCxcbiAgICBxdW90ZU1vZDogZmFsc2UsXG59O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG4vLyBUbyBmaW5kIHlvdXIgY29uZmlnLCBnbyB0byBodHRwczovL2NvbnNvbGUuZmlyZWJhc2UuZ29vZ2xlLmNvbS8gYW5kIHNlbGVjdCB5b3VyIHByb2plY3Rcbi8vIEdvIHRvICh0b3AgbGVmdCkgU2V0dGluZ3MgPiBQcm9qZWN0IFNldHRpbmdzID4gR2VuZXJhbFxuLy8gc2Nyb2xsIGRvd24gdG8gWW91ciBhcHBzID4gV2ViIEFwcHMgKGlmIGl0IGRvZXNudCBleGlzdCwgY3JlYXRlIG9uZSkgPiBTREsgc2V0dXAgYW5kIGNvbmZpZ3VyYXRpb24gPiBzZWxlY3QgbnBtXG4vLyB5b3VyIGNvbmZpZyBzaG91bGQgYmUgdmlzaWJsZSB0aGVyZVxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5maXJlYmFzZUNvbmZpZyA9IHZvaWQgMDtcbmV4cG9ydHMuZmlyZWJhc2VDb25maWcgPSB7XG4gICAgYXBpS2V5OiBcIkFJemFTeUM4WkdsQ25hWUpZc3o1YnNNdG1KR2J1OFFxdENWcE00Z1wiLFxuICAgIGF1dGhEb21haW46IFwibW9ua2V5dHlwZS1kNDQwYS5maXJlYmFzZWFwcC5jb21cIixcbiAgICBwcm9qZWN0SWQ6IFwibW9ua2V5dHlwZS1kNDQwYVwiLFxuICAgIHN0b3JhZ2VCdWNrZXQ6IFwibW9ua2V5dHlwZS1kNDQwYS5hcHBzcG90LmNvbVwiLFxuICAgIG1lc3NhZ2luZ1NlbmRlcklkOiBcIjQwOTc5ODc0NTQzMFwiLFxuICAgIGFwcElkOiBcIjE6NDA5Nzk4NzQ1NDMwOndlYjo2ODQzNTU3YjM2YTI1MTU2MzcwYWY3XCJcbn07XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNpZ25PdXQgPSBleHBvcnRzLmFkZFBhc3N3b3JkQXV0aCA9IGV4cG9ydHMucmVtb3ZlR29vZ2xlQXV0aCA9IGV4cG9ydHMuYWRkR29vZ2xlQXV0aCA9IGV4cG9ydHMuc2lnbkluV2l0aEdvb2dsZSA9IGV4cG9ydHMuc2lnbkluID0gZXhwb3J0cy5nZXREYXRhQW5kSW5pdCA9IGV4cG9ydHMuc2VuZFZlcmlmaWNhdGlvbkVtYWlsID0gZXhwb3J0cy5nbWFpbFByb3ZpZGVyID0gdm9pZCAwO1xuY29uc3QgYXBlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2FwZVwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpLCBVcGRhdGVDb25maWcgPSBjb25maWdfMTtcbmNvbnN0IEFjY291bnRCdXR0b24gPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2FjY291bnQtYnV0dG9uXCIpKTtcbmNvbnN0IEFjY291bnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BhZ2VzL2FjY291bnRcIikpO1xuY29uc3QgVmVyaWZpY2F0aW9uQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi92ZXJpZmljYXRpb24tY29udHJvbGxlclwiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IFNldHRpbmdzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wYWdlcy9zZXR0aW5nc1wiKSk7XG5jb25zdCBBbGxUaW1lU3RhdHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2FjY291bnQvYWxsLXRpbWUtc3RhdHNcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IFRlc3RMb2dpYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LWxvZ2ljXCIpKTtcbmNvbnN0IFBhZ2VDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3BhZ2UtY29udHJvbGxlclwiKSk7XG5jb25zdCBQU0EgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL3BzYVwiKSk7XG5jb25zdCBGb2N1cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9mb2N1c1wiKSk7XG5jb25zdCBMb2FkZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2xvYWRlclwiKSk7XG5jb25zdCBQYWdlVHJhbnNpdGlvbiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3BhZ2UtdHJhbnNpdGlvblwiKSk7XG5jb25zdCBBY3RpdmVQYWdlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvYWN0aXZlLXBhZ2VcIikpO1xuY29uc3QgVGVzdEFjdGl2ZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3Rlc3QtYWN0aXZlXCIpKTtcbmNvbnN0IExvYWRpbmdQYWdlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wYWdlcy9sb2FkaW5nXCIpKTtcbmNvbnN0IFJlc3VsdEZpbHRlcnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2FjY291bnQvcmVzdWx0LWZpbHRlcnNcIikpO1xuY29uc3QgUGFjZUNhcmV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3BhY2UtY2FyZXRcIikpO1xuY29uc3QgQ29tbWFuZGxpbmVMaXN0cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvY29tbWFuZGxpbmUtbGlzdHNcIikpO1xuY29uc3QgVGFnQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90YWctY29udHJvbGxlclwiKSk7XG5jb25zdCBSZXN1bHRUYWdzUG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BvcHVwcy9yZXN1bHQtdGFncy1wb3B1cFwiKSk7XG5jb25zdCBVUkxIYW5kbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy91cmwtaGFuZGxlclwiKSk7XG5jb25zdCBhdXRoXzEgPSByZXF1aXJlKFwiZmlyZWJhc2UvYXV0aFwiKTtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi4vZmlyZWJhc2VcIik7XG5jb25zdCBkaWZmZXJlbmNlSW5EYXlzXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImRhdGUtZm5zL2RpZmZlcmVuY2VJbkRheXNcIikpO1xuY29uc3QgZGVmYXVsdF9zbmFwc2hvdF8xID0gcmVxdWlyZShcIi4uL2NvbnN0YW50cy9kZWZhdWx0LXNuYXBzaG90XCIpO1xuZXhwb3J0cy5nbWFpbFByb3ZpZGVyID0gbmV3IGF1dGhfMS5Hb29nbGVBdXRoUHJvdmlkZXIoKTtcbmZ1bmN0aW9uIHNlbmRWZXJpZmljYXRpb25FbWFpbCgpIHtcbiAgICBMb2FkZXIuc2hvdygpO1xuICAgIGNvbnN0IHVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgaWYgKHVzZXIgPT09IG51bGwpXG4gICAgICAgIHJldHVybjtcbiAgICAoMCwgYXV0aF8xLnNlbmRFbWFpbFZlcmlmaWNhdGlvbikodXNlcilcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVtYWlsIHNlbnQgdG8gXCIgKyB1c2VyLmVtYWlsLCA0MDAwKTtcbiAgICB9KVxuICAgICAgICAuY2F0Y2goKGUpID0+IHtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJFcnJvcjogXCIgKyBlLm1lc3NhZ2UsIDMwMDApO1xuICAgICAgICBjb25zb2xlLmVycm9yKGUubWVzc2FnZSk7XG4gICAgfSk7XG59XG5leHBvcnRzLnNlbmRWZXJpZmljYXRpb25FbWFpbCA9IHNlbmRWZXJpZmljYXRpb25FbWFpbDtcbmZ1bmN0aW9uIGdldERhdGFBbmRJbml0KCkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJnZXR0aW5nIGFjY291bnQgZGF0YVwiKTtcbiAgICAgICAgICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09PSBcImxvYWRpbmdcIikge1xuICAgICAgICAgICAgICAgIExvYWRpbmdQYWdlLnVwZGF0ZUJhcig5MCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBMb2FkaW5nUGFnZS51cGRhdGVCYXIoNDUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTG9hZGluZ1BhZ2UudXBkYXRlVGV4dChcIkRvd25sb2FkaW5nIHVzZXIgZGF0YS4uLlwiKTtcbiAgICAgICAgICAgIHlpZWxkIExvYWRpbmdQYWdlLnNob3dCYXIoKTtcbiAgICAgICAgICAgIHlpZWxkIERCLmluaXRTbmFwc2hvdCgpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc3QgZSA9IGVycm9yO1xuICAgICAgICAgICAgQWNjb3VudEJ1dHRvbi5sb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlQ29kZSA9PT0gNDI5KSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJEb2luZyBzbyB3aWxsIHNhdmUgeW91IGJhbmR3aWR0aCwgbWFrZSB0aGUgbmV4dCB0ZXN0IGJlIHJlYWR5IGZhc3RlciBhbmQgd2lsbCBub3Qgc2lnbiB5b3Ugb3V0ICh3aGljaCBjb3VsZCBtZWFuIHlvdXIgbmV3IHBlcnNvbmFsIGJlc3Qgd291bGQgbm90IHNhdmUgdG8geW91ciBhY2NvdW50KS5cIiwgMCwgMCk7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJZb3Ugd2lsbCBydW4gaW50byB0aGlzIGVycm9yIGlmIHlvdSByZWZyZXNoIHRoZSB3ZWJzaXRlIHRvIHJlc3RhcnQgdGhlIHRlc3QuIEl0IGlzIE5PVCByZWNvbW1lbmRlZCB0byBkbyB0aGF0LiBJbnN0ZWFkLCB1c2UgdGFiICsgZW50ZXIgb3IganVzdCB0YWIgKHdpdGggcXVpY2sgdGFiIG1vZGUgZW5hYmxlZCkgdG8gcmVzdGFydCB0aGUgdGVzdC5cIiwgMCwgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBtc2cgPSBlLm1lc3NhZ2UgfHwgZTtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGdldCB1c2VyIGRhdGE6IFwiICsgbXNnLCAtMSk7XG4gICAgICAgICAgICAkKFwiI3RvcCAjbWVudSAuYWNjb3VudFwiKS5jc3MoXCJvcGFjaXR5XCIsIDEpO1xuICAgICAgICAgICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT09IFwibG9hZGluZ1wiKVxuICAgICAgICAgICAgICAgIFBhZ2VDb250cm9sbGVyLmNoYW5nZShcIlwiKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoQWN0aXZlUGFnZS5nZXQoKSA9PSBcImxvYWRpbmdcIikge1xuICAgICAgICAgICAgTG9hZGluZ1BhZ2UudXBkYXRlQmFyKDEwMCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBMb2FkaW5nUGFnZS51cGRhdGVCYXIoNDUpO1xuICAgICAgICB9XG4gICAgICAgIExvYWRpbmdQYWdlLnVwZGF0ZVRleHQoXCJBcHBseWluZyBzZXR0aW5ncy4uLlwiKTtcbiAgICAgICAgY29uc3Qgc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdCgpO1xuICAgICAgICAkKFwiI21lbnUgLmljb24tYnV0dG9uLmFjY291bnQgLnRleHRcIikudGV4dChzbmFwc2hvdC5uYW1lKTtcbiAgICAgICAgUmVzdWx0RmlsdGVycy5sb2FkVGFncyhzbmFwc2hvdC50YWdzKTtcbiAgICAgICAgUHJvbWlzZS5hbGwoW01pc2MuZ2V0TGFuZ3VhZ2VMaXN0KCksIE1pc2MuZ2V0RnVuYm94TGlzdCgpXSkudGhlbigodmFsdWVzKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBbbGFuZ3VhZ2VzLCBmdW5ib3hlc10gPSB2YWx1ZXM7XG4gICAgICAgICAgICBsYW5ndWFnZXMuZm9yRWFjaCgobGFuZ3VhZ2UpID0+IHtcbiAgICAgICAgICAgICAgICBSZXN1bHRGaWx0ZXJzLmRlZmF1bHRSZXN1bHRGaWx0ZXJzLmxhbmd1YWdlW2xhbmd1YWdlXSA9IHRydWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGZ1bmJveGVzLmZvckVhY2goKGZ1bmJveCkgPT4ge1xuICAgICAgICAgICAgICAgIFJlc3VsdEZpbHRlcnMuZGVmYXVsdFJlc3VsdEZpbHRlcnMuZnVuYm94W2Z1bmJveC5uYW1lXSA9IHRydWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIGZpbHRlcnMgPSBkZWZhdWx0UmVzdWx0RmlsdGVycztcbiAgICAgICAgICAgIFJlc3VsdEZpbHRlcnMubG9hZCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFzbmFwc2hvdC5uYW1lKSB7XG4gICAgICAgICAgICAvL3ZlcmlmeSB1c2VybmFtZVxuICAgICAgICAgICAgLy9pbnZhbGlkLCBnZXQgbmV3XG4gICAgICAgICAgICBsZXQgbmFtZUdvb2QgPSBmYWxzZTtcbiAgICAgICAgICAgIGxldCBuYW1lID0gXCJcIjtcbiAgICAgICAgICAgIHdoaWxlICghbmFtZUdvb2QpIHtcbiAgICAgICAgICAgICAgICBuYW1lID1cbiAgICAgICAgICAgICAgICAgICAgKF9hID0gcHJvbXB0KFwiUGxlYXNlIHByb3ZpZGUgYSBuZXcgdXNlcm5hbWUgKGNhbm5vdCBiZSBsb25nZXIgdGhhbiAxNiBjaGFyYWN0ZXJzLCBjYW4gb25seSBjb250YWluIGxldHRlcnMsIG51bWJlcnMsIHVuZGVyc2NvcmVzLCBkb3RzIGFuZCBkYXNoZXMpOlwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCJcIjtcbiAgICAgICAgICAgICAgICBpZiAoIW5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMudXBkYXRlTmFtZShuYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gdXBkYXRlIG5hbWU6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG5hbWVHb29kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIk5hbWUgdXBkYXRlZFwiLCAxKTtcbiAgICAgICAgICAgICAgICBzbmFwc2hvdC5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgICAgICBEQi5zZXRTbmFwc2hvdChzbmFwc2hvdCk7XG4gICAgICAgICAgICAgICAgJChcIiNtZW51IC5pY29uLWJ1dHRvbi5hY2NvdW50IC50ZXh0XCIpLnRleHQobmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFVcGRhdGVDb25maWcuY2hhbmdlZEJlZm9yZURiKSB7XG4gICAgICAgICAgICAvL2NvbmZpZyBkaWRudCBjaGFuZ2UgYmVmb3JlIGRiIGxvYWRlZFxuICAgICAgICAgICAgaWYgKFVwZGF0ZUNvbmZpZy5sb2NhbFN0b3JhZ2VDb25maWcgPT09IG51bGwgJiYgc25hcHNob3QuY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJubyBsb2NhbCBjb25maWcsIGFwcGx5aW5nIGRiXCIpO1xuICAgICAgICAgICAgICAgIEFjY291bnRCdXR0b24ubG9hZGluZyhmYWxzZSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLmFwcGx5KHNuYXBzaG90LmNvbmZpZyk7XG4gICAgICAgICAgICAgICAgU2V0dGluZ3MudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNhdmVGdWxsQ29uZmlnVG9Mb2NhbFN0b3JhZ2UodHJ1ZSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoc25hcHNob3QuY29uZmlnICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAvL2xvYWRpbmcgZGIgY29uZmlnLCBrZWVwIGZvciBub3dcbiAgICAgICAgICAgICAgICBsZXQgY29uZmlnc0RpZmZlcmVudCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGNvbmZpZ18xLmRlZmF1bHQpLmZvckVhY2goKGtlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IGtlO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnc0RpZmZlcmVudClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgIT09IFwicmVzdWx0RmlsdGVyc1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlnXzEuZGVmYXVsdFtrZXldKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0W2tleV0uZm9yRWFjaCgoYXJydmFsLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXJyYXlWYWx1ZSA9ICgoX2EgPSBzbmFwc2hvdCA9PT0gbnVsbCB8fCBzbmFwc2hvdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogc25hcHNob3QuY29uZmlnKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Fba2V5XSlbaW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFycnZhbCAhPSBhcnJheVZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnc0RpZmZlcmVudCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYC5jb25maWcgaXMgZGlmZmVyZW50OiAke2FycnZhbH0gIT0gJHthcnJheVZhbHVlfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0W2tleV0gIT0gKChfYSA9IHNuYXBzaG90ID09PSBudWxsIHx8IHNuYXBzaG90ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzbmFwc2hvdC5jb25maWcpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVtrZXldKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnc0RpZmZlcmVudCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgLi5jb25maWcgaXMgZGlmZmVyZW50ICR7a2V5fTogJHtjb25maWdfMS5kZWZhdWx0W2tleV19ICE9ICR7KF9iID0gc25hcHNob3QgPT09IG51bGwgfHwgc25hcHNob3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNuYXBzaG90LmNvbmZpZykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iW2tleV19YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnc0RpZmZlcmVudCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgLi4uY29uZmlnIGlzIGRpZmZlcmVudGApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ3NEaWZmZXJlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb25maWdzIGFyZSBkaWZmZXJlbnQsIGFwcGx5aW5nIGNvbmZpZyBmcm9tIGRiXCIpO1xuICAgICAgICAgICAgICAgICAgICBBY2NvdW50QnV0dG9uLmxvYWRpbmcoZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuYXBwbHkoc25hcHNob3QuY29uZmlnKTtcbiAgICAgICAgICAgICAgICAgICAgU2V0dGluZ3MudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zYXZlRnVsbENvbmZpZ1RvTG9jYWxTdG9yYWdlKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoQWN0aXZlUGFnZS5nZXQoKSA9PSBcInRlc3RcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIERCLnNhdmVDb25maWcoY29uZmlnXzEuZGVmYXVsdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldERiQ29uZmlnTG9hZGVkKHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb25maWcgY2hhbmdlZCBiZWZvcmUgZGJcIik7XG4gICAgICAgICAgICBBY2NvdW50QnV0dG9uLmxvYWRpbmcoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnBhY2VDYXJldCA9PT0gXCJwYlwiIHx8IGNvbmZpZ18xLmRlZmF1bHQucGFjZUNhcmV0ID09PSBcImF2ZXJhZ2VcIikge1xuICAgICAgICAgICAgaWYgKCFUZXN0QWN0aXZlLmdldCgpKSB7XG4gICAgICAgICAgICAgICAgUGFjZUNhcmV0LmluaXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBBY2NvdW50QnV0dG9uLmxvYWRpbmcoZmFsc2UpO1xuICAgICAgICBSZXN1bHRGaWx0ZXJzLnVwZGF0ZVRhZ3MoKTtcbiAgICAgICAgQ29tbWFuZGxpbmVMaXN0cy51cGRhdGVUYWdDb21tYW5kcygpO1xuICAgICAgICBUYWdDb250cm9sbGVyLmxvYWRBY3RpdmVGcm9tTG9jYWxTdG9yYWdlKCk7XG4gICAgICAgIFJlc3VsdFRhZ3NQb3B1cC51cGRhdGVCdXR0b25zKCk7XG4gICAgICAgIFNldHRpbmdzLnNob3dBY2NvdW50U2VjdGlvbigpO1xuICAgICAgICBQYWdlVHJhbnNpdGlvbi5zZXQoZmFsc2UpO1xuICAgICAgICBjb25zb2xlLmxvZyhcImFjY291bnQgbG9hZGluZyBmaW5pc2hlZFwiKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG59XG5leHBvcnRzLmdldERhdGFBbmRJbml0ID0gZ2V0RGF0YUFuZEluaXQ7XG5mdW5jdGlvbiBsb2FkVXNlcih1c2VyKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgLy8gVXNlciBpcyBzaWduZWQgaW4uXG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmNvbnRlbnQgcC5hY2NvdW50VmVyaWZpY2F0aW5Ob3RpY2VcIikucmVtb3ZlKCk7XG4gICAgICAgIGlmICh1c2VyLmVtYWlsVmVyaWZpZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5jb250ZW50XCIpLnByZXBlbmQoYDxwIGNsYXNzPVwiYWNjb3VudFZlcmlmaWNhdGluTm90aWNlXCIgc3R5bGU9XCJ0ZXh0LWFsaWduOmNlbnRlclwiPllvdXIgYWNjb3VudCBpcyBub3QgdmVyaWZpZWQuIDxhIGNsYXNzPVwic2VuZFZlcmlmaWNhdGlvbkVtYWlsXCI+U2VuZCB0aGUgdmVyaWZpY2F0aW9uIGVtYWlsIGFnYWluPC9hPi5gKTtcbiAgICAgICAgfVxuICAgICAgICBQYWdlVHJhbnNpdGlvbi5zZXQoZmFsc2UpO1xuICAgICAgICBBY2NvdW50QnV0dG9uLnVwZGF0ZSgpO1xuICAgICAgICBBY2NvdW50QnV0dG9uLmxvYWRpbmcodHJ1ZSk7XG4gICAgICAgIGlmICgoeWllbGQgZ2V0RGF0YUFuZEluaXQoKSkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBzaWduT3V0KCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdmFyIGRpc3BsYXlOYW1lID0gdXNlci5kaXNwbGF5TmFtZTtcbiAgICAgICAgLy8gdmFyIGVtYWlsID0gdXNlci5lbWFpbDtcbiAgICAgICAgLy8gdmFyIGVtYWlsVmVyaWZpZWQgPSB1c2VyLmVtYWlsVmVyaWZpZWQ7XG4gICAgICAgIC8vIHZhciBwaG90b1VSTCA9IHVzZXIucGhvdG9VUkw7XG4gICAgICAgIC8vIHZhciBpc0Fub255bW91cyA9IHVzZXIuaXNBbm9ueW1vdXM7XG4gICAgICAgIC8vIHZhciB1aWQgPSB1c2VyLnVpZDtcbiAgICAgICAgLy8gdmFyIHByb3ZpZGVyRGF0YSA9IHVzZXIucHJvdmlkZXJEYXRhO1xuICAgICAgICAkKFwiLnBhZ2VMb2dpbiAucHJlbG9hZGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyBzaG93RmF2b3VyaXRlVGhlbWVzQXRUaGVUb3AoKTtcbiAgICAgICAgbGV0IHRleHQgPSBcIkFjY291bnQgY3JlYXRlZCBvbiBcIiArIHVzZXIubWV0YWRhdGEuY3JlYXRpb25UaW1lO1xuICAgICAgICBjb25zdCBjcmVhdGlvbkRhdGUgPSBuZXcgRGF0ZSh1c2VyLm1ldGFkYXRhLmNyZWF0aW9uVGltZSk7XG4gICAgICAgIGNvbnN0IGRpZmZEYXlzID0gKDAsIGRpZmZlcmVuY2VJbkRheXNfMS5kZWZhdWx0KShuZXcgRGF0ZSgpLCBjcmVhdGlvbkRhdGUpO1xuICAgICAgICB0ZXh0ICs9IGAgKCR7ZGlmZkRheXN9IGRheSR7ZGlmZkRheXMgIT0gMSA/IFwic1wiIDogXCJcIn0gYWdvKWA7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmdyb3VwLmNyZWF0ZWREYXRlXCIpLnRleHQodGV4dCk7XG4gICAgICAgIGlmIChWZXJpZmljYXRpb25Db250cm9sbGVyLmRhdGEgIT09IG51bGwpIHtcbiAgICAgICAgICAgIFZlcmlmaWNhdGlvbkNvbnRyb2xsZXIudmVyaWZ5KHVzZXIudWlkKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuY29uc3QgYXV0aExpc3RlbmVyID0gZmlyZWJhc2VfMS5BdXRoLm9uQXV0aFN0YXRlQ2hhbmdlZChmdW5jdGlvbiAodXNlcikge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIC8vIGF3YWl0IFVwZGF0ZUNvbmZpZy5sb2FkUHJvbWlzZTtcbiAgICAgICAgY29uc29sZS5sb2coYGF1dGggc3RhdGUgY2hhbmdlZCwgdXNlciAke3VzZXIgPyB0cnVlIDogZmFsc2V9YCk7XG4gICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgICB5aWVsZCBsb2FkVXNlcih1c2VyKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT0gXCIvYWNjb3VudFwiKSB7XG4gICAgICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKFwiXCIsIFwiXCIsIFwiL2xvZ2luXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgUGFnZVRyYW5zaXRpb24uc2V0KGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PSBcIi9sb2dpblwiKSB7XG4gICAgICAgICAgICAgICAgUGFnZUNvbnRyb2xsZXIuY2hhbmdlKFwiYWNjb3VudFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSAhPSBcIi9hY2NvdW50XCIpIHtcbiAgICAgICAgICAgICAgICBQYWdlQ29udHJvbGxlci5jaGFuZ2UoKTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgRm9jdXMuc2V0KGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9LCAxMjUgLyAyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIEFjY291bnQudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgLy8gU2lnbk91dEJ1dHRvbi5zaG93KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBQYWdlQ29udHJvbGxlci5jaGFuZ2UoKTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIEZvY3VzLnNldChmYWxzZSk7XG4gICAgICAgICAgICB9LCAxMjUgLyAyKTtcbiAgICAgICAgfVxuICAgICAgICBVUkxIYW5kbGVyLmxvYWRDdXN0b21UaGVtZUZyb21VcmwoKTtcbiAgICAgICAgaWYgKC9jaGFsbGVuZ2VfLisvZy50ZXN0KHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSkpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ2hhbGxlbmdlIGxpbmtzIHRlbXBvcmFyaWx5IGRpc2FibGVkLiBQbGVhc2UgdXNlIHRoZSBjb21tYW5kIGxpbmUgdG8gbG9hZCB0aGUgY2hhbGxlbmdlIG1hbnVhbGx5XCIsIDAsIDcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgLy8gTm90aWZpY2F0aW9ucy5hZGQoXCJMb2FkaW5nIGNoYWxsZW5nZVwiLCAwKTtcbiAgICAgICAgICAgIC8vIGxldCBjaGFsbGVuZ2VOYW1lID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLnNwbGl0KFwiX1wiKVsxXTtcbiAgICAgICAgICAgIC8vIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgLy8gICBDaGFsbGVuZ2VDb250cm9sbGVyLnNldHVwKGNoYWxsZW5nZU5hbWUpO1xuICAgICAgICAgICAgLy8gfSwgMTAwMCk7XG4gICAgICAgIH1cbiAgICAgICAgUFNBLnNob3coKTtcbiAgICB9KTtcbn0pO1xuZnVuY3Rpb24gc2lnbkluKCkge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRDaGFuZ2VkQmVmb3JlRGIoZmFsc2UpO1xuICAgIGF1dGhMaXN0ZW5lcigpO1xuICAgICQoXCIucGFnZUxvZ2luIC5wcmVsb2FkZXJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgJChcIi5wYWdlTG9naW4gLmJ1dHRvblwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIGNvbnN0IGVtYWlsID0gJChcIi5wYWdlTG9naW4gLmxvZ2luIGlucHV0XCIpWzBdLnZhbHVlO1xuICAgIGNvbnN0IHBhc3N3b3JkID0gJChcIi5wYWdlTG9naW4gLmxvZ2luIGlucHV0XCIpWzFdLnZhbHVlO1xuICAgIGNvbnN0IHBlcnNpc3RlbmNlID0gJChcIi5wYWdlTG9naW4gLmxvZ2luICNyZW1lbWJlck1lIGlucHV0XCIpLnByb3AoXCJjaGVja2VkXCIpXG4gICAgICAgID8gYXV0aF8xLmJyb3dzZXJMb2NhbFBlcnNpc3RlbmNlXG4gICAgICAgIDogYXV0aF8xLmJyb3dzZXJTZXNzaW9uUGVyc2lzdGVuY2U7XG4gICAgKDAsIGF1dGhfMS5zZXRQZXJzaXN0ZW5jZSkoZmlyZWJhc2VfMS5BdXRoLCBwZXJzaXN0ZW5jZSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAoMCwgYXV0aF8xLnNpZ25JbldpdGhFbWFpbEFuZFBhc3N3b3JkKShmaXJlYmFzZV8xLkF1dGgsIGVtYWlsLCBwYXNzd29yZClcbiAgICAgICAgICAgIC50aGVuKChlKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICB5aWVsZCBsb2FkVXNlcihlLnVzZXIpO1xuICAgICAgICAgICAgUGFnZUNvbnRyb2xsZXIuY2hhbmdlKFwiYWNjb3VudFwiKTtcbiAgICAgICAgICAgIGlmIChUZXN0TG9naWMubm90U2lnbmVkSW5MYXN0UmVzdWx0ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnNldE5vdFNpZ25lZEluVWlkKGUudXNlci51aWQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5yZXN1bHRzLnNhdmUoVGVzdExvZ2ljLm5vdFNpZ25lZEluTGFzdFJlc3VsdCk7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBzYXZlIGxhc3QgcmVzdWx0OiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLmNsZWFyTm90U2lnbmVkSW5SZXN1bHQoKTtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkxhc3QgdGVzdCByZXN1bHQgc2F2ZWRcIiwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL1RPRE86IHJlZGlyZWN0IHVzZXIgdG8gcmVsZXZhbnQgcGFnZVxuICAgICAgICB9KSlcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgIGxldCBtZXNzYWdlID0gZXJyb3IubWVzc2FnZTtcbiAgICAgICAgICAgIGlmIChlcnJvci5jb2RlID09PSBcImF1dGgvd3JvbmctcGFzc3dvcmRcIikge1xuICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBcIkluY29ycmVjdCBwYXNzd29yZC5cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGVycm9yLmNvZGUgPT09IFwiYXV0aC91c2VyLW5vdC1mb3VuZFwiKSB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZSA9IFwiVXNlciBub3QgZm91bmQuXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChtZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICAkKFwiLnBhZ2VMb2dpbiAucHJlbG9hZGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlTG9naW4gLmJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc2lnbkluID0gc2lnbkluO1xuZnVuY3Rpb24gc2lnbkluV2l0aEdvb2dsZSgpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDaGFuZ2VkQmVmb3JlRGIoZmFsc2UpO1xuICAgICAgICAkKFwiLnBhZ2VMb2dpbiAucHJlbG9hZGVyXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiLnBhZ2VMb2dpbiAuYnV0dG9uXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIGF1dGhMaXN0ZW5lcigpO1xuICAgICAgICBsZXQgc2lnbmVkSW5Vc2VyO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcGVyc2lzdGVuY2UgPSAkKFwiLnBhZ2VMb2dpbiAubG9naW4gI3JlbWVtYmVyTWUgaW5wdXRcIikucHJvcChcImNoZWNrZWRcIilcbiAgICAgICAgICAgICAgICA/IGF1dGhfMS5icm93c2VyTG9jYWxQZXJzaXN0ZW5jZVxuICAgICAgICAgICAgICAgIDogYXV0aF8xLmJyb3dzZXJTZXNzaW9uUGVyc2lzdGVuY2U7XG4gICAgICAgICAgICB5aWVsZCAoMCwgYXV0aF8xLnNldFBlcnNpc3RlbmNlKShmaXJlYmFzZV8xLkF1dGgsIHBlcnNpc3RlbmNlKTtcbiAgICAgICAgICAgIHNpZ25lZEluVXNlciA9IHlpZWxkICgwLCBhdXRoXzEuc2lnbkluV2l0aFBvcHVwKShmaXJlYmFzZV8xLkF1dGgsIGV4cG9ydHMuZ21haWxQcm92aWRlcik7XG4gICAgICAgICAgICBpZiAoKF9hID0gKDAsIGF1dGhfMS5nZXRBZGRpdGlvbmFsVXNlckluZm8pKHNpZ25lZEluVXNlcikpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc05ld1VzZXIpIHtcbiAgICAgICAgICAgICAgICAvL2FzayBmb3IgdXNlcm5hbWVcbiAgICAgICAgICAgICAgICBsZXQgbmFtZUdvb2QgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBsZXQgbmFtZSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgd2hpbGUgKCFuYW1lR29vZCkge1xuICAgICAgICAgICAgICAgICAgICBuYW1lID1cbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21wdChcIlBsZWFzZSBwcm92aWRlIGEgbmV3IHVzZXJuYW1lIChjYW5ub3QgYmUgbG9uZ2VyIHRoYW4gMTYgY2hhcmFjdGVycywgY2FuIG9ubHkgY29udGFpbiBsZXR0ZXJzLCBudW1iZXJzLCB1bmRlcnNjb3JlcywgZG90cyBhbmQgZGFzaGVzKTpcIikgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaWduT3V0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiLnBhZ2VMb2dpbiAucHJlbG9hZGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5nZXROYW1lQXZhaWxhYmlsaXR5KG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBjaGVjayBuYW1lOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBuYW1lR29vZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vY3JlYXRlIGRhdGFiYXNlIG9iamVjdCBmb3IgdGhlIG5ldyB1c2VyXG4gICAgICAgICAgICAgICAgLy8gdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMuY3JlYXRlKG5hbWUpO1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyByZXNwb25zZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIC8vICAgbGV0IG1zZyA9IGU/LnJlc3BvbnNlPy5kYXRhPy5tZXNzYWdlID8/IGUubWVzc2FnZTtcbiAgICAgICAgICAgICAgICAvLyAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGNyZWF0ZSBhY2NvdW50OiBcIiArIG1zZywgLTEpO1xuICAgICAgICAgICAgICAgIC8vICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgeWllbGQgKDAsIGF1dGhfMS51cGRhdGVQcm9maWxlKShzaWduZWRJblVzZXIudXNlciwgeyBkaXNwbGF5TmFtZTogbmFtZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgeWllbGQgKDAsIGF1dGhfMS5zZW5kRW1haWxWZXJpZmljYXRpb24pKHNpZ25lZEluVXNlci51c2VyKTtcbiAgICAgICAgICAgICAgICAgICAgQWxsVGltZVN0YXRzLmNsZWFyKCk7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQWNjb3VudCBjcmVhdGVkXCIsIDEsIDMpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiI21lbnUgLmljb24tYnV0dG9uLmFjY291bnQgLnRleHRcIikudGV4dChuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi5wYWdlTG9naW4gLmJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiLnBhZ2VMb2dpbiAucHJlbG9hZGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICAgICB5aWVsZCBsb2FkVXNlcihzaWduZWRJblVzZXIudXNlcik7XG4gICAgICAgICAgICAgICAgICAgIFBhZ2VDb250cm9sbGVyLmNoYW5nZShcImFjY291bnRcIik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChUZXN0TG9naWMubm90U2lnbmVkSW5MYXN0UmVzdWx0ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBUZXN0TG9naWMuc2V0Tm90U2lnbmVkSW5VaWQoc2lnbmVkSW5Vc2VyLnVzZXIudWlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdHNTYXZlUmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnJlc3VsdHMuc2F2ZShUZXN0TG9naWMubm90U2lnbmVkSW5MYXN0UmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHRzU2F2ZVJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gVGVzdExvZ2ljLm5vdFNpZ25lZEluTGFzdFJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEQi5zYXZlTG9jYWxSZXN1bHQocmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEQi51cGRhdGVMb2NhbFN0YXRzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogcmVzdWx0LnRlc3REdXJhdGlvbiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuaW5jb21wbGV0ZVRlc3RTZWNvbmRzIC1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5hZmtEdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRlZDogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHlpZWxkIGxvYWRVc2VyKHNpZ25lZEluVXNlci51c2VyKTtcbiAgICAgICAgICAgICAgICBQYWdlQ29udHJvbGxlci5jaGFuZ2UoXCJhY2NvdW50XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBNaXNjLmNyZWF0ZUVycm9yTWVzc2FnZShlLCBcIkZhaWxlZCB0byBzaWduIGluIHdpdGggR29vZ2xlXCIpO1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQobWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgJChcIi5wYWdlTG9naW4gLnByZWxvYWRlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUxvZ2luIC5idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIGlmIChzaWduZWRJblVzZXIgJiYgKChfYiA9ICgwLCBhdXRoXzEuZ2V0QWRkaXRpb25hbFVzZXJJbmZvKShzaWduZWRJblVzZXIpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuaXNOZXdVc2VyKSkge1xuICAgICAgICAgICAgICAgIHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMuZGVsZXRlKCk7XG4gICAgICAgICAgICAgICAgeWllbGQgc2lnbmVkSW5Vc2VyLnVzZXIuZGVsZXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzaWduT3V0KCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuc2lnbkluV2l0aEdvb2dsZSA9IHNpZ25JbldpdGhHb29nbGU7XG5mdW5jdGlvbiBhZGRHb29nbGVBdXRoKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgPT09IG51bGwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICgwLCBhdXRoXzEubGlua1dpdGhQb3B1cCkoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyLCBleHBvcnRzLmdtYWlsUHJvdmlkZXIpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJHb29nbGUgYXV0aGVudGljYXRpb24gYWRkZWRcIiwgMSk7XG4gICAgICAgICAgICBTZXR0aW5ncy51cGRhdGVBdXRoU2VjdGlvbnMoKTtcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBhZGQgR29vZ2xlIGF1dGhlbmljYXRpb246IFwiICsgZXJyb3IubWVzc2FnZSwgLTEpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuYWRkR29vZ2xlQXV0aCA9IGFkZEdvb2dsZUF1dGg7XG5mdW5jdGlvbiByZW1vdmVHb29nbGVBdXRoKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgICAgIGlmICh1c2VyID09PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAodXNlci5wcm92aWRlckRhdGEuZmluZCgocHJvdmlkZXIpID0+IHByb3ZpZGVyLnByb3ZpZGVySWQgPT09IFwicGFzc3dvcmRcIikpIHtcbiAgICAgICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHlpZWxkICgwLCBhdXRoXzEucmVhdXRoZW50aWNhdGVXaXRoUG9wdXApKHVzZXIsIGV4cG9ydHMuZ21haWxQcm92aWRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IE1pc2MuY3JlYXRlRXJyb3JNZXNzYWdlKGUsIFwiRmFpbGVkIHRvIHJlYXV0aGVudGljYXRlXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChtZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAoMCwgYXV0aF8xLnVubGluaykodXNlciwgXCJnb29nbGUuY29tXCIpXG4gICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiR29vZ2xlIGF1dGhlbnRpY2F0aW9uIHJlbW92ZWRcIiwgMSk7XG4gICAgICAgICAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgICAgICAgICBTZXR0aW5ncy51cGRhdGVBdXRoU2VjdGlvbnMoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gcmVtb3ZlIEdvb2dsZSBhdXRoZW50aWNhdGlvbjogXCIgKyBlcnJvci5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUGFzc3dvcmQgYXV0aGVudGljYXRpb24gbmVlZHMgdG8gYmUgZW5hYmxlZCB0byByZW1vdmUgR29vZ2xlIGF1dGhlbnRpY2F0aW9uXCIsIC0xKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5yZW1vdmVHb29nbGVBdXRoID0gcmVtb3ZlR29vZ2xlQXV0aDtcbmZ1bmN0aW9uIGFkZFBhc3N3b3JkQXV0aChlbWFpbCwgcGFzc3dvcmQpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICBjb25zdCB1c2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgICAgICBpZiAodXNlciA9PT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKHVzZXIucHJvdmlkZXJEYXRhLmZpbmQoKHByb3ZpZGVyKSA9PiBwcm92aWRlci5wcm92aWRlcklkID09PSBcImdvb2dsZS5jb21cIikpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgeWllbGQgKDAsIGF1dGhfMS5yZWF1dGhlbnRpY2F0ZVdpdGhQb3B1cCkodXNlciwgZXhwb3J0cy5nbWFpbFByb3ZpZGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gTWlzYy5jcmVhdGVFcnJvck1lc3NhZ2UoZSwgXCJGYWlsZWQgdG8gcmVhdXRoZW50aWNhdGVcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKG1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjcmVkZW50aWFsID0gYXV0aF8xLkVtYWlsQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwoZW1haWwsIHBhc3N3b3JkKTtcbiAgICAgICAgKDAsIGF1dGhfMS5saW5rV2l0aENyZWRlbnRpYWwpKHVzZXIsIGNyZWRlbnRpYWwpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJQYXNzd29yZCBhdXRoZW5pY2F0aW9uIGFkZGVkXCIsIDEpO1xuICAgICAgICAgICAgU2V0dGluZ3MudXBkYXRlQXV0aFNlY3Rpb25zKCk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gYWRkIHBhc3N3b3JkIGF1dGhlbmljYXRpb246IFwiICsgZXJyb3IubWVzc2FnZSwgLTEpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuYWRkUGFzc3dvcmRBdXRoID0gYWRkUGFzc3dvcmRBdXRoO1xuZnVuY3Rpb24gc2lnbk91dCgpIHtcbiAgICBmaXJlYmFzZV8xLkF1dGguc2lnbk91dCgpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJTaWduZWQgb3V0XCIsIDAsIDIpO1xuICAgICAgICBBbGxUaW1lU3RhdHMuY2xlYXIoKTtcbiAgICAgICAgU2V0dGluZ3MuaGlkZUFjY291bnRTZWN0aW9uKCk7XG4gICAgICAgIEFjY291bnRCdXR0b24udXBkYXRlKCk7XG4gICAgICAgIFBhZ2VDb250cm9sbGVyLmNoYW5nZShcImxvZ2luXCIpO1xuICAgICAgICBEQi5zZXRTbmFwc2hvdChkZWZhdWx0X3NuYXBzaG90XzEuZGVmYXVsdFNuYXApO1xuICAgICAgICAkKFwiLnBhZ2VMb2dpbiAuYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgfSlcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChlcnJvci5tZXNzYWdlLCAtMSk7XG4gICAgfSk7XG59XG5leHBvcnRzLnNpZ25PdXQgPSBzaWduT3V0O1xuZnVuY3Rpb24gc2lnblVwKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICQoXCIucGFnZUxvZ2luIC5idXR0b25cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgJChcIi5wYWdlTG9naW4gLnByZWxvYWRlclwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgY29uc3Qgbm5hbWUgPSAkKFwiLnBhZ2VMb2dpbiAucmVnaXN0ZXIgaW5wdXRcIilbMF0udmFsdWU7XG4gICAgICAgIGNvbnN0IGVtYWlsID0gJChcIi5wYWdlTG9naW4gLnJlZ2lzdGVyIGlucHV0XCIpWzFdLnZhbHVlO1xuICAgICAgICBjb25zdCBlbWFpbFZlcmlmeSA9ICQoXCIucGFnZUxvZ2luIC5yZWdpc3RlciBpbnB1dFwiKVsyXVxuICAgICAgICAgICAgLnZhbHVlO1xuICAgICAgICBjb25zdCBwYXNzd29yZCA9ICQoXCIucGFnZUxvZ2luIC5yZWdpc3RlciBpbnB1dFwiKVszXVxuICAgICAgICAgICAgLnZhbHVlO1xuICAgICAgICBjb25zdCBwYXNzd29yZFZlcmlmeSA9ICQoXCIucGFnZUxvZ2luIC5yZWdpc3RlciBpbnB1dFwiKVs0XS52YWx1ZTtcbiAgICAgICAgaWYgKGVtYWlsICE9PSBlbWFpbFZlcmlmeSkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJFbWFpbHMgZG8gbm90IG1hdGNoXCIsIDAsIDMpO1xuICAgICAgICAgICAgJChcIi5wYWdlTG9naW4gLnByZWxvYWRlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUxvZ2luIC5idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFzc3dvcmQgIT09IHBhc3N3b3JkVmVyaWZ5KSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlBhc3N3b3JkcyBkbyBub3QgbWF0Y2hcIiwgMCwgMyk7XG4gICAgICAgICAgICAkKFwiLnBhZ2VMb2dpbiAucHJlbG9hZGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlTG9naW4gLmJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5nZXROYW1lQXZhaWxhYmlsaXR5KG5uYW1lKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChyZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICAkKFwiLnBhZ2VMb2dpbiAucHJlbG9hZGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlTG9naW4gLmJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGF1dGhMaXN0ZW5lcigpO1xuICAgICAgICBsZXQgY3JlYXRlZEF1dGhVc2VyO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY3JlYXRlZEF1dGhVc2VyID0geWllbGQgKDAsIGF1dGhfMS5jcmVhdGVVc2VyV2l0aEVtYWlsQW5kUGFzc3dvcmQpKGZpcmViYXNlXzEuQXV0aCwgZW1haWwsIHBhc3N3b3JkKTtcbiAgICAgICAgICAgIGNvbnN0IHNpZ25JblJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5jcmVhdGUobm5hbWUsIGVtYWlsLCBjcmVhdGVkQXV0aFVzZXIudXNlci51aWQpO1xuICAgICAgICAgICAgaWYgKHNpZ25JblJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgc2lnbkluUmVzcG9uc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB5aWVsZCAoMCwgYXV0aF8xLnVwZGF0ZVByb2ZpbGUpKGNyZWF0ZWRBdXRoVXNlci51c2VyLCB7IGRpc3BsYXlOYW1lOiBubmFtZSB9KTtcbiAgICAgICAgICAgIHlpZWxkICgwLCBhdXRoXzEuc2VuZEVtYWlsVmVyaWZpY2F0aW9uKShjcmVhdGVkQXV0aFVzZXIudXNlcik7XG4gICAgICAgICAgICBBbGxUaW1lU3RhdHMuY2xlYXIoKTtcbiAgICAgICAgICAgICQoXCIjbWVudSAuaWNvbi1idXR0b24uYWNjb3VudCAudGV4dFwiKS50ZXh0KG5uYW1lKTtcbiAgICAgICAgICAgICQoXCIucGFnZUxvZ2luIC5idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUxvZ2luIC5wcmVsb2FkZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICB5aWVsZCBsb2FkVXNlcihjcmVhdGVkQXV0aFVzZXIudXNlcik7XG4gICAgICAgICAgICBpZiAoVGVzdExvZ2ljLm5vdFNpZ25lZEluTGFzdFJlc3VsdCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5zZXROb3RTaWduZWRJblVpZChjcmVhdGVkQXV0aFVzZXIudXNlci51aWQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5yZXN1bHRzLnNhdmUoVGVzdExvZ2ljLm5vdFNpZ25lZEluTGFzdFJlc3VsdCk7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IFRlc3RMb2dpYy5ub3RTaWduZWRJbkxhc3RSZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIERCLnNhdmVMb2NhbFJlc3VsdChyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICBEQi51cGRhdGVMb2NhbFN0YXRzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IHJlc3VsdC50ZXN0RHVyYXRpb24gK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5pbmNvbXBsZXRlVGVzdFNlY29uZHMgLVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5hZmtEdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IDEsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFBhZ2VDb250cm9sbGVyLmNoYW5nZShcImFjY291bnRcIik7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkFjY291bnQgY3JlYXRlZFwiLCAxLCAzKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgLy9tYWtlIHN1cmUgdG8gZG8gY2xlYW4gdXAgaGVyZVxuICAgICAgICAgICAgaWYgKGNyZWF0ZWRBdXRoVXNlcikge1xuICAgICAgICAgICAgICAgIHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMuZGVsZXRlKCk7XG4gICAgICAgICAgICAgICAgeWllbGQgY3JlYXRlZEF1dGhVc2VyLnVzZXIuZGVsZXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBNaXNjLmNyZWF0ZUVycm9yTWVzc2FnZShlLCBcIkZhaWxlZCB0byBjcmVhdGUgYWNjb3VudFwiKTtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKG1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgICQoXCIucGFnZUxvZ2luIC5wcmVsb2FkZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VMb2dpbiAuYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICBzaWduT3V0KCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbiQoXCIucGFnZUxvZ2luICNmb3Jnb3RQYXNzd29yZEJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjb25zdCBlbWFpbEZpZWxkID0gJChcIi5wYWdlTG9naW4gLmxvZ2luIGlucHV0XCIpWzBdLnZhbHVlIHx8IFwiXCI7XG4gICAgY29uc3QgZW1haWwgPSBwcm9tcHQoXCJFbWFpbCBhZGRyZXNzXCIsIGVtYWlsRmllbGQpO1xuICAgIGlmIChlbWFpbCkge1xuICAgICAgICAoMCwgYXV0aF8xLnNlbmRQYXNzd29yZFJlc2V0RW1haWwpKGZpcmViYXNlXzEuQXV0aCwgZW1haWwpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBFbWFpbCBzZW50LlxuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJFbWFpbCBzZW50XCIsIDEsIDIpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgLy8gQW4gZXJyb3IgaGFwcGVuZWQuXG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChlcnJvci5tZXNzYWdlLCAtMSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pO1xuJChcIi5wYWdlTG9naW4gLmxvZ2luIGlucHV0XCIpLmtleXVwKChlKSA9PiB7XG4gICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldENoYW5nZWRCZWZvcmVEYihmYWxzZSk7XG4gICAgICAgIHNpZ25JbigpO1xuICAgIH1cbn0pO1xuJChcIi5wYWdlTG9naW4gLmxvZ2luIC5idXR0b24uc2lnbkluXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRDaGFuZ2VkQmVmb3JlRGIoZmFsc2UpO1xuICAgIHNpZ25JbigpO1xufSk7XG4kKFwiLnBhZ2VMb2dpbiAubG9naW4gLmJ1dHRvbi5zaWduSW5XaXRoR29vZ2xlXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRDaGFuZ2VkQmVmb3JlRGIoZmFsc2UpO1xuICAgIHNpZ25JbldpdGhHb29nbGUoKTtcbn0pO1xuLy8gJChcIi5wYWdlTG9naW4gLmxvZ2luIC5idXR0b24uc2lnbkluV2l0aEdpdEh1YlwiKS5vbihcImNsaWNrXCIsKGUpID0+IHtcbi8vIFVwZGF0ZUNvbmZpZy5zZXRDaGFuZ2VkQmVmb3JlRGIoZmFsc2UpO1xuLy8gc2lnbkluV2l0aEdpdEh1YigpO1xuLy8gfSk7XG4kKFwiLnNpZ25PdXRcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgc2lnbk91dCgpO1xufSk7XG4kKFwiLnBhZ2VMb2dpbiAucmVnaXN0ZXIgaW5wdXRcIikua2V5dXAoKGUpID0+IHtcbiAgICBpZiAoJChcIi5wYWdlTG9naW4gLnJlZ2lzdGVyIC5idXR0b25cIikuaGFzQ2xhc3MoXCJkaXNhYmxlZFwiKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIHNpZ25VcCgpO1xuICAgIH1cbn0pO1xuJChcIi5wYWdlTG9naW4gLnJlZ2lzdGVyIC5idXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgaWYgKCQoXCIucGFnZUxvZ2luIC5yZWdpc3RlciAuYnV0dG9uXCIpLmhhc0NsYXNzKFwiZGlzYWJsZWRcIikpXG4gICAgICAgIHJldHVybjtcbiAgICBzaWduVXAoKTtcbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgI2FkZEdvb2dsZUF1dGhcIikub24oXCJjbGlja1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBhZGRHb29nbGVBdXRoKCk7XG59KSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAjcmVtb3ZlR29vZ2xlQXV0aFwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICByZW1vdmVHb29nbGVBdXRoKCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZUFjY291bnQgLnNlbmRWZXJpZmljYXRpb25FbWFpbFwiLCAoKSA9PiB7XG4gICAgc2VuZFZlcmlmaWNhdGlvbkVtYWlsKCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmxvZyA9IHZvaWQgMDtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi4vZmlyZWJhc2VcIik7XG5jb25zdCBhbmFseXRpY3NfMSA9IHJlcXVpcmUoXCJmaXJlYmFzZS9hbmFseXRpY3NcIik7XG5mdW5jdGlvbiBsb2coZXZlbnROYW1lLCBwYXJhbXMpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgKDAsIGFuYWx5dGljc18xLmxvZ0V2ZW50KShmaXJlYmFzZV8xLkFuYWx5dGljcywgZXZlbnROYW1lLCBwYXJhbXMpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkFuYWx5dGljcyB1bmF2YWlsYWJsZVwiKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5sb2cgPSBsb2c7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNldHVwID0gZXhwb3J0cy52ZXJpZnkgPSBleHBvcnRzLmNsZWFyQWN0aXZlID0gdm9pZCAwO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IE1hbnVhbFJlc3RhcnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvbWFudWFsLXJlc3RhcnQtdHJhY2tlclwiKSk7XG5jb25zdCBDdXN0b21UZXh0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2N1c3RvbS10ZXh0XCIpKTtcbmNvbnN0IEZ1bmJveCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9mdW5ib3hcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgVGVzdFVJID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtdWlcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBUZXN0U3RhdGUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC1zdGF0ZVwiKSk7XG5sZXQgY2hhbGxlbmdlTG9hZGluZyA9IGZhbHNlO1xuZnVuY3Rpb24gY2xlYXJBY3RpdmUoKSB7XG4gICAgaWYgKFRlc3RTdGF0ZS5hY3RpdmVDaGFsbGVuZ2UgJiZcbiAgICAgICAgIWNoYWxsZW5nZUxvYWRpbmcgJiZcbiAgICAgICAgIVRlc3RVSS50ZXN0UmVzdGFydGluZykge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkNoYWxsZW5nZSBjbGVhcmVkXCIsIDApO1xuICAgICAgICBUZXN0U3RhdGUuc2V0QWN0aXZlQ2hhbGxlbmdlKG51bGwpO1xuICAgIH1cbn1cbmV4cG9ydHMuY2xlYXJBY3RpdmUgPSBjbGVhckFjdGl2ZTtcbmZ1bmN0aW9uIHZlcmlmeShyZXN1bHQpIHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoVGVzdFN0YXRlLmFjdGl2ZUNoYWxsZW5nZSkge1xuICAgICAgICAgICAgY29uc3QgYWZrID0gKHJlc3VsdC5hZmtEdXJhdGlvbiAvIHJlc3VsdC50ZXN0RHVyYXRpb24pICogMTAwO1xuICAgICAgICAgICAgaWYgKGFmayA+IDEwKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoYENoYWxsZW5nZSBmYWlsZWQ6IEFGSyB0aW1lIGlzIGdyZWF0ZXIgdGhhbiAxMCVgLCAwKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghVGVzdFN0YXRlLmFjdGl2ZUNoYWxsZW5nZS5yZXF1aXJlbWVudHMpIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgJHtUZXN0U3RhdGUuYWN0aXZlQ2hhbGxlbmdlLmRpc3BsYXl9IGNoYWxsZW5nZSBwYXNzZWQhYCwgMSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFRlc3RTdGF0ZS5hY3RpdmVDaGFsbGVuZ2UubmFtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxldCByZXF1aXJlbWVudHNNZXQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGZhaWxSZWFzb25zID0gW107XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCByZXF1aXJlbWVudFR5cGUgaW4gVGVzdFN0YXRlLmFjdGl2ZUNoYWxsZW5nZS5yZXF1aXJlbWVudHMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcXVpcmVtZW50c01ldCA9PSBmYWxzZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXF1aXJlbWVudFZhbHVlID0gVGVzdFN0YXRlLmFjdGl2ZUNoYWxsZW5nZS5yZXF1aXJlbWVudHNbcmVxdWlyZW1lbnRUeXBlXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcXVpcmVtZW50VHlwZSA9PSBcIndwbVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB3cG1Nb2RlID0gT2JqZWN0LmtleXMocmVxdWlyZW1lbnRWYWx1ZSlbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAod3BtTW9kZSA9PSBcImV4YWN0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5yb3VuZChyZXN1bHQud3BtKSAhPSByZXF1aXJlbWVudFZhbHVlW1wiZXhhY3RcIl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZW1lbnRzTWV0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxSZWFzb25zLnB1c2goYFdQTSBub3QgJHtyZXF1aXJlbWVudFZhbHVlW1wiZXhhY3RcIl19YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAod3BtTW9kZSA9PSBcIm1pblwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC53cG0gPCByZXF1aXJlbWVudFZhbHVlW1wibWluXCJdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVtZW50c01ldCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsUmVhc29ucy5wdXNoKGBXUE0gYmVsb3cgJHtyZXF1aXJlbWVudFZhbHVlW1wibWluXCJdfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXF1aXJlbWVudFR5cGUgPT0gXCJhY2NcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWNjTW9kZSA9IE9iamVjdC5rZXlzKHJlcXVpcmVtZW50VmFsdWUpWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjY01vZGUgPT0gXCJleGFjdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5hY2MgIT0gcmVxdWlyZW1lbnRWYWx1ZVtcImV4YWN0XCJdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVtZW50c01ldCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsUmVhc29ucy5wdXNoKGBBY2N1cmFjeSBub3QgJHtyZXF1aXJlbWVudFZhbHVlW1wiZXhhY3RcIl19YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYWNjTW9kZSA9PSBcIm1pblwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5hY2MgPCByZXF1aXJlbWVudFZhbHVlW1wibWluXCJdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVtZW50c01ldCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsUmVhc29ucy5wdXNoKGBBY2N1cmFjeSBiZWxvdyAke3JlcXVpcmVtZW50VmFsdWVbXCJtaW5cIl19YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlcXVpcmVtZW50VHlwZSA9PSBcImFma1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhZmtNb2RlID0gT2JqZWN0LmtleXMocmVxdWlyZW1lbnRWYWx1ZSlbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWZrTW9kZSA9PSBcIm1heFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGgucm91bmQoYWZrKSA+IHJlcXVpcmVtZW50VmFsdWVbXCJtYXhcIl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZW1lbnRzTWV0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxSZWFzb25zLnB1c2goYEFGSyBwZXJjZW50YWdlIGFib3ZlICR7cmVxdWlyZW1lbnRWYWx1ZVtcIm1heFwiXX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVxdWlyZW1lbnRUeXBlID09IFwidGltZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aW1lTW9kZSA9IE9iamVjdC5rZXlzKHJlcXVpcmVtZW50VmFsdWUpWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWVNb2RlID09IFwibWluXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5yb3VuZChyZXN1bHQudGVzdER1cmF0aW9uKSA8IHJlcXVpcmVtZW50VmFsdWVbXCJtaW5cIl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZW1lbnRzTWV0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxSZWFzb25zLnB1c2goYFRlc3QgdGltZSBiZWxvdyAke3JlcXVpcmVtZW50VmFsdWVbXCJtaW5cIl19YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlcXVpcmVtZW50VHlwZSA9PSBcImZ1bmJveFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmdW5ib3hNb2RlID0gcmVxdWlyZW1lbnRWYWx1ZVtcImV4YWN0XCJdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZ1bmJveE1vZGUgIT0gcmVzdWx0LmZ1bmJveCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVtZW50c01ldCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxSZWFzb25zLnB1c2goYCR7ZnVuYm94TW9kZX0gZnVuYm94IG5vdCBhY3RpdmVgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXF1aXJlbWVudFR5cGUgPT0gXCJyYXdcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmF3TW9kZSA9IE9iamVjdC5rZXlzKHJlcXVpcmVtZW50VmFsdWUpWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJhd01vZGUgPT0gXCJleGFjdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGgucm91bmQocmVzdWx0LnJhd1dwbSkgIT0gcmVxdWlyZW1lbnRWYWx1ZVtcImV4YWN0XCJdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVtZW50c01ldCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsUmVhc29ucy5wdXNoKGBSYXcgV1BNIG5vdCAke3JlcXVpcmVtZW50VmFsdWVbXCJleGFjdFwiXX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVxdWlyZW1lbnRUeXBlID09IFwiY29uXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbk1vZGUgPSBPYmplY3Qua2V5cyhyZXF1aXJlbWVudFZhbHVlKVswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25Nb2RlID09IFwiZXhhY3RcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLnJvdW5kKHJlc3VsdC5jb25zaXN0ZW5jeSkgIT0gcmVxdWlyZW1lbnRWYWx1ZVtcImV4YWN0XCJdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVtZW50c01ldCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsUmVhc29ucy5wdXNoKGBDb25zaXN0ZW5jeSBub3QgJHtyZXF1aXJlbWVudFZhbHVlW1wiZXhhY3RcIl19YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlcXVpcmVtZW50VHlwZSA9PSBcImNvbmZpZ1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNvbmZpZ0tleSBpbiByZXF1aXJlbWVudFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29uZmlnVmFsdWUgPSByZXF1aXJlbWVudFZhbHVlW2NvbmZpZ0tleV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHRbY29uZmlnS2V5XSAhPSBjb25maWdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlbWVudHNNZXQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbFJlYXNvbnMucHVzaChgJHtjb25maWdLZXl9IG5vdCBzZXQgdG8gJHtjb25maWdWYWx1ZX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJlcXVpcmVtZW50c01ldCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoVGVzdFN0YXRlLmFjdGl2ZUNoYWxsZW5nZS5hdXRvUm9sZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJZb3Ugd2lsbCByZWNlaXZlIGEgcm9sZSBzaG9ydGx5LiBQbGVhc2UgZG9uJ3QgcG9zdCBhIHNjcmVlbnNob3QgaW4gY2hhbGxlbmdlIHN1Ym1pc3Npb25zLlwiLCAxLCA1KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgJHtUZXN0U3RhdGUuYWN0aXZlQ2hhbGxlbmdlLmRpc3BsYXl9IGNoYWxsZW5nZSBwYXNzZWQhYCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBUZXN0U3RhdGUuYWN0aXZlQ2hhbGxlbmdlLm5hbWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgJHtUZXN0U3RhdGUuYWN0aXZlQ2hhbGxlbmdlLmRpc3BsYXl9IGNoYWxsZW5nZSBmYWlsZWQ6ICR7ZmFpbFJlYXNvbnMuam9pbihcIiwgXCIpfWAsIDApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgU29tZXRoaW5nIHdlbnQgd3Jvbmcgd2hlbiB2ZXJpZnlpbmcgY2hhbGxlbmdlOiAke2UubWVzc2FnZX1gLCAwKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuZXhwb3J0cy52ZXJpZnkgPSB2ZXJpZnk7XG5mdW5jdGlvbiBzZXR1cChjaGFsbGVuZ2VOYW1lKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY2hhbGxlbmdlTG9hZGluZyA9IHRydWU7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGdW5ib3goXCJub25lXCIpO1xuICAgICAgICBjb25zdCBsaXN0ID0geWllbGQgTWlzYy5nZXRDaGFsbGVuZ2VMaXN0KCk7XG4gICAgICAgIGNvbnN0IGNoYWxsZW5nZSA9IGxpc3QuZmlsdGVyKChjKSA9PiBjLm5hbWUgPT09IGNoYWxsZW5nZU5hbWUpWzBdO1xuICAgICAgICBsZXQgbm90aXRleHQ7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoY2hhbGxlbmdlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkNoYWxsZW5nZSBub3QgZm91bmRcIiwgMCk7XG4gICAgICAgICAgICAgICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgJChcIiN0b3AgLmNvbmZpZ1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi5wYWdlLnBhZ2VUZXN0XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIH0sIDI1MCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNoYWxsZW5nZS50eXBlID09PSBcImN1c3RvbVRpbWVcIikge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lQ29uZmlnKGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzBdLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcInRpbWVcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldERpZmZpY3VsdHkoXCJub3JtYWxcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKGNoYWxsZW5nZS5uYW1lID09PSBcImVuZ2xpc2hNYXN0ZXJcIikge1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TGFuZ3VhZ2UoXCJlbmdsaXNoXzEwa1wiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE51bWJlcnModHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQdW5jdHVhdGlvbih0cnVlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjaGFsbGVuZ2UudHlwZSA9PT0gXCJjdXN0b21Xb3Jkc1wiKSB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFdvcmRDb3VudChjaGFsbGVuZ2UucGFyYW1ldGVyc1swXSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ3b3Jkc1wiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RGlmZmljdWx0eShcIm5vcm1hbFwiLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNoYWxsZW5nZS50eXBlID09PSBcImN1c3RvbVRleHRcIikge1xuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQuc2V0VGV4dChjaGFsbGVuZ2UucGFyYW1ldGVyc1swXS5zcGxpdChcIiBcIikpO1xuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQuc2V0SXNUaW1lUmFuZG9tKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBDdXN0b21UZXh0LnNldElzV29yZFJhbmRvbShjaGFsbGVuZ2UucGFyYW1ldGVyc1sxXSk7XG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC5zZXRXb3JkKGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzJdKTtcbiAgICAgICAgICAgICAgICBDdXN0b21UZXh0LnNldFRpbWUoLTEpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwiY3VzdG9tXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXREaWZmaWN1bHR5KFwibm9ybWFsXCIsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY2hhbGxlbmdlLnR5cGUgPT09IFwic2NyaXB0XCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGZldGNoKFwiL2NoYWxsZW5nZXMvXCIgKyBjaGFsbGVuZ2UucGFyYW1ldGVyc1swXSk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2NyaXB0ZGF0YSA9IHlpZWxkIHJlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgICAgICAgICBsZXQgdGV4dCA9IHNjcmlwdGRhdGEudHJpbSgpO1xuICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1tcXG5cXHJcXHQgXS9nbSwgXCIgXCIpO1xuICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyArL2dtLCBcIiBcIik7XG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC5zZXRUZXh0KHRleHQuc3BsaXQoXCIgXCIpKTtcbiAgICAgICAgICAgICAgICBDdXN0b21UZXh0LnNldElzV29yZFJhbmRvbShmYWxzZSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJjdXN0b21cIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldERpZmZpY3VsdHkoXCJub3JtYWxcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzFdICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRoZW1lKGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzFdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzJdICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgRnVuYm94LmFjdGl2YXRlKGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzJdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjaGFsbGVuZ2UudHlwZSA9PT0gXCJhY2N1cmFjeVwiKSB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVDb25maWcoMCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ0aW1lXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXREaWZmaWN1bHR5KFwibWFzdGVyXCIsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY2hhbGxlbmdlLnR5cGUgPT09IFwiZnVuYm94XCIpIHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RnVuYm94KGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzBdLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RGlmZmljdWx0eShcIm5vcm1hbFwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBpZiAoY2hhbGxlbmdlLnBhcmFtZXRlcnNbMV0gPT09IFwid29yZHNcIikge1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0V29yZENvdW50KGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzJdLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY2hhbGxlbmdlLnBhcmFtZXRlcnNbMV0gPT09IFwidGltZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lQ29uZmlnKGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzJdLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoY2hhbGxlbmdlLnBhcmFtZXRlcnNbMV0sIHRydWUpO1xuICAgICAgICAgICAgICAgIGlmIChjaGFsbGVuZ2UucGFyYW1ldGVyc1szXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXREaWZmaWN1bHR5KGNoYWxsZW5nZS5wYXJhbWV0ZXJzWzNdLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjaGFsbGVuZ2UudHlwZSA9PT0gXCJzcGVjaWFsXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAoY2hhbGxlbmdlLm5hbWUgPT09IFwic2VtaW1ha1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHNvIGNhbiB5b3UgbWFrZSBhIGxpbmsgdGhhdCBzZXRzIHVwIDEyMHMsIDEwaywgcHVuY3QsIHN0b3Agb24gd29yZCwgYW5kIHNlbWltYWsgYXMgdGhlIGxheW91dD9cbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ0aW1lXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZUNvbmZpZygxMjAsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TGFuZ3VhZ2UoXCJlbmdsaXNoXzEwa1wiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFB1bmN0dWF0aW9uKHRydWUsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U3RvcE9uRXJyb3IoXCJ3b3JkXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TGF5b3V0KFwic2VtaW1ha1wiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcExheW91dChcIm92ZXJyaWRlU3luY1wiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcE1vZGUoXCJzdGF0aWNcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICAgICAgICAgIG5vdGl0ZXh0ID0gY2hhbGxlbmdlLm1lc3NhZ2U7XG4gICAgICAgICAgICAkKFwiI3RvcCAuY29uZmlnXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlLnBhZ2VUZXN0XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgaWYgKG5vdGl0ZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgQ2hhbGxlbmdlICcke2NoYWxsZW5nZS5kaXNwbGF5fScgbG9hZGVkLmAsIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDaGFsbGVuZ2UgbG9hZGVkLiBcIiArIG5vdGl0ZXh0LCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFRlc3RTdGF0ZS5zZXRBY3RpdmVDaGFsbGVuZ2UoY2hhbGxlbmdlKTtcbiAgICAgICAgICAgIGNoYWxsZW5nZUxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlNvbWV0aGluZyB3ZW50IHdyb25nOiBcIiArIGUsIC0xKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5zZXR1cCA9IHNldHVwO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSkgPT4ge1xuICAgIGlmIChbXG4gICAgICAgIFwiZGlmZmljdWx0eVwiLFxuICAgICAgICBcIm51bWJlcnNcIixcbiAgICAgICAgXCJwdW5jdHVhdGlvblwiLFxuICAgICAgICBcIm1vZGVcIixcbiAgICAgICAgXCJmdW5ib3hcIixcbiAgICAgICAgXCJwYWNlQ2FyZXRcIixcbiAgICAgICAgXCJzaG93QWxsTGluZXNcIixcbiAgICAgICAgXCJzaG93TGl2ZVdwbVwiLFxuICAgICAgICBcImhpZ2hsaWdodE1vZGVcIixcbiAgICAgICAgXCJ0aW1lXCIsXG4gICAgICAgIFwid29yZHNcIixcbiAgICAgICAgXCJrZXltYXBNb2RlXCIsXG4gICAgICAgIFwia2V5bWFwTGF5b3V0XCIsXG4gICAgICAgIFwibGF5b3V0XCIsXG4gICAgXS5pbmNsdWRlcyhldmVudEtleSkpIHtcbiAgICAgICAgY2xlYXJBY3RpdmUoKTtcbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudXBkYXRlQWxsQ2hhcnRDb2xvcnMgPSBleHBvcnRzLnNldERlZmF1bHRGb250RmFtaWx5ID0gZXhwb3J0cy51cGRhdGVDb2xvcnMgPSBleHBvcnRzLm1pbmlSZXN1bHQgPSBleHBvcnRzLmFjY291bnRBY3Rpdml0eSA9IGV4cG9ydHMuYWNjb3VudEhpc3RvcnkgPSBleHBvcnRzLmFjY291bnRIaXN0b3J5QWN0aXZlSW5kZXggPSBleHBvcnRzLnJlc3VsdCA9IHZvaWQgMDtcbmNvbnN0IGNoYXJ0X2pzXzEgPSByZXF1aXJlKFwiY2hhcnQuanNcIik7XG5jb25zdCBjaGFydGpzX3BsdWdpbl90cmVuZGxpbmVfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiY2hhcnRqcy1wbHVnaW4tdHJlbmRsaW5lXCIpKTtcbmNvbnN0IGNoYXJ0anNfcGx1Z2luX2Fubm90YXRpb25fMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiY2hhcnRqcy1wbHVnaW4tYW5ub3RhdGlvblwiKSk7XG5jaGFydF9qc18xLkNoYXJ0LnJlZ2lzdGVyKGNoYXJ0X2pzXzEuQmFyQ29udHJvbGxlciwgY2hhcnRfanNfMS5CYXJFbGVtZW50LCBjaGFydF9qc18xLkNhdGVnb3J5U2NhbGUsIGNoYXJ0X2pzXzEuRmlsbGVyLCBjaGFydF9qc18xLkxpbmVhclNjYWxlLCBjaGFydF9qc18xLkxpbmVDb250cm9sbGVyLCBjaGFydF9qc18xLkxpbmVFbGVtZW50LCBjaGFydF9qc18xLlBvaW50RWxlbWVudCwgY2hhcnRfanNfMS5TY2F0dGVyQ29udHJvbGxlciwgY2hhcnRfanNfMS5UaW1lU2NhbGUsIGNoYXJ0X2pzXzEuVGltZVNlcmllc1NjYWxlLCBjaGFydF9qc18xLlRvb2x0aXAsIGNoYXJ0anNfcGx1Z2luX3RyZW5kbGluZV8xLmRlZmF1bHQsIGNoYXJ0anNfcGx1Z2luX2Fubm90YXRpb25fMS5kZWZhdWx0KTtcbmNoYXJ0X2pzXzEuQ2hhcnQuZGVmYXVsdHMuYW5pbWF0aW9uLmR1cmF0aW9uID0gMDtcbmNoYXJ0X2pzXzEuQ2hhcnQuZGVmYXVsdHMuZWxlbWVudHMubGluZS50ZW5zaW9uID0gMC4zO1xuY2hhcnRfanNfMS5DaGFydC5kZWZhdWx0cy5lbGVtZW50cy5saW5lLmZpbGwgPSBcIm9yaWdpblwiO1xuY29uc3QgVGVzdElucHV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtaW5wdXRcIikpO1xuY29uc3QgVGhlbWVDb2xvcnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL3RoZW1lLWNvbG9yc1wiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBmb3JtYXRfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiZGF0ZS1mbnMvZm9ybWF0XCIpKTtcbnJlcXVpcmUoXCJjaGFydGpzLWFkYXB0ZXItZGF0ZS1mbnNcIik7XG5jbGFzcyBDaGFydFdpdGhVcGRhdGVDb2xvcnMgZXh0ZW5kcyBjaGFydF9qc18xLkNoYXJ0IHtcbiAgICBjb25zdHJ1Y3RvcihpdGVtLCBjb25maWcpIHtcbiAgICAgICAgc3VwZXIoaXRlbSwgY29uZmlnKTtcbiAgICB9XG4gICAgdXBkYXRlQ29sb3JzKCkge1xuICAgICAgICB1cGRhdGVDb2xvcnModGhpcyk7XG4gICAgfVxufVxuZXhwb3J0cy5yZXN1bHQgPSBuZXcgQ2hhcnRXaXRoVXBkYXRlQ29sb3JzKCQoXCIjd3BtQ2hhcnRcIiksIHtcbiAgICB0eXBlOiBcImxpbmVcIixcbiAgICBkYXRhOiB7XG4gICAgICAgIGxhYmVsczogW10sXG4gICAgICAgIGRhdGFzZXRzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbGFiZWw6IFwid3BtXCIsXG4gICAgICAgICAgICAgICAgZGF0YTogW10sXG4gICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IFwicmdiYSgxMjUsIDEyNSwgMTI1LCAxKVwiLFxuICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAyLFxuICAgICAgICAgICAgICAgIHlBeGlzSUQ6IFwid3BtXCIsXG4gICAgICAgICAgICAgICAgb3JkZXI6IDIsXG4gICAgICAgICAgICAgICAgcG9pbnRSYWRpdXM6IDIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGxhYmVsOiBcInJhd1wiLFxuICAgICAgICAgICAgICAgIGRhdGE6IFtdLFxuICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiBcInJnYmEoMTI1LCAxMjUsIDEyNSwgMSlcIixcbiAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMixcbiAgICAgICAgICAgICAgICB5QXhpc0lEOiBcInJhd1wiLFxuICAgICAgICAgICAgICAgIG9yZGVyOiAzLFxuICAgICAgICAgICAgICAgIHBvaW50UmFkaXVzOiAyLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJlcnJvcnNcIixcbiAgICAgICAgICAgICAgICBkYXRhOiBbXSxcbiAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogXCJyZ2JhKDI1NSwgMTI1LCAxMjUsIDEpXCIsXG4gICAgICAgICAgICAgICAgcG9pbnRCYWNrZ3JvdW5kQ29sb3I6IFwicmdiYSgyNTUsIDEyNSwgMTI1LCAxKVwiLFxuICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAyLFxuICAgICAgICAgICAgICAgIG9yZGVyOiAxLFxuICAgICAgICAgICAgICAgIHlBeGlzSUQ6IFwiZXJyb3JcIixcbiAgICAgICAgICAgICAgICB0eXBlOiBcInNjYXR0ZXJcIixcbiAgICAgICAgICAgICAgICBwb2ludFN0eWxlOiBcImNyb3NzUm90XCIsXG4gICAgICAgICAgICAgICAgcG9pbnRSYWRpdXM6IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gY29udGV4dC5kYXRhSW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gY29udGV4dC5kYXRhc2V0LmRhdGFbaW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB2b2lkIDAgPyB2YWx1ZSA6IDApIDw9IDAgPyAwIDogMztcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHBvaW50SG92ZXJSYWRpdXM6IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gY29udGV4dC5kYXRhSW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gY29udGV4dC5kYXRhc2V0LmRhdGFbaW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB2b2lkIDAgPyB2YWx1ZSA6IDApIDw9IDAgPyAwIDogNTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICB9LFxuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgcmVzcG9uc2l2ZTogdHJ1ZSxcbiAgICAgICAgbWFpbnRhaW5Bc3BlY3RSYXRpbzogZmFsc2UsXG4gICAgICAgIHNjYWxlczoge1xuICAgICAgICAgICAgeDoge1xuICAgICAgICAgICAgICAgIGF4aXM6IFwieFwiLFxuICAgICAgICAgICAgICAgIHRpY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcFBhZGRpbmc6IDIwLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJTZWNvbmRzXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3cG06IHtcbiAgICAgICAgICAgICAgICBheGlzOiBcInlcIixcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiV29yZHMgcGVyIE1pbnV0ZVwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYmVnaW5BdFplcm86IHRydWUsXG4gICAgICAgICAgICAgICAgbWluOiAwLFxuICAgICAgICAgICAgICAgIHRpY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcFBhZGRpbmc6IDIwLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZ3JpZDoge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmF3OiB7XG4gICAgICAgICAgICAgICAgYXhpczogXCJ5XCIsXG4gICAgICAgICAgICAgICAgZGlzcGxheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJSYXcgV29yZHMgcGVyIE1pbnV0ZVwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYmVnaW5BdFplcm86IHRydWUsXG4gICAgICAgICAgICAgICAgbWluOiAwLFxuICAgICAgICAgICAgICAgIHRpY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcFBhZGRpbmc6IDIwLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZ3JpZDoge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICAgICAgYXhpczogXCJ5XCIsXG4gICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogXCJyaWdodFwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiRXJyb3JzXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBiZWdpbkF0WmVybzogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0aWNrczoge1xuICAgICAgICAgICAgICAgICAgICBwcmVjaXNpb246IDAsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcFBhZGRpbmc6IDIwLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZ3JpZDoge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgcGx1Z2luczoge1xuICAgICAgICAgICAgYW5ub3RhdGlvbjoge1xuICAgICAgICAgICAgICAgIGFubm90YXRpb25zOiBbXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0b29sdGlwOiB7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB7IGR1cmF0aW9uOiAyNTAgfSxcbiAgICAgICAgICAgICAgICBtb2RlOiBcImluZGV4XCIsXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0OiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjYWxsYmFja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgYWZ0ZXJMYWJlbDogZnVuY3Rpb24gKHRpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIud29yZElucHV0QWZ0ZXJcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgd29yZHNUb0hpZ2hsaWdodCA9IFRlc3RJbnB1dC5rZXlwcmVzc1BlclNlY29uZFtwYXJzZUludCh0aS5sYWJlbCkgLSAxXS53b3JkcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1bmlxdWUgPSBbLi4ubmV3IFNldCh3b3Jkc1RvSGlnaGxpZ2h0KV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pcXVlLmZvckVhY2goKHdvcmRJbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB3b3JkRWwgPSAkKCQoXCIjcmVzdWx0V29yZHNIaXN0b3J5IC53b3JkcyAud29yZFwiKVt3b3JkSW5kZXhdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5wdXQgPSB3b3JkRWwuYXR0cihcImlucHV0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JkRWwuYXBwZW5kKGA8ZGl2IGNsYXNzPVwid29yZElucHV0QWZ0ZXJcIj4ke2lucHV0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcdC9nLCBcIl9cIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFxuL2csIFwiX1wiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC88L2csIFwiJmx0XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLz4vZywgXCImZ3RcIil9PC9kaXY+YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChfYSkgeyB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICB9LFxufSk7XG5leHBvcnRzLmFjY291bnRIaXN0b3J5ID0gbmV3IENoYXJ0V2l0aFVwZGF0ZUNvbG9ycygkKFwiLnBhZ2VBY2NvdW50ICNhY2NvdW50SGlzdG9yeUNoYXJ0XCIpLCB7XG4gICAgdHlwZTogXCJsaW5lXCIsXG4gICAgZGF0YToge1xuICAgICAgICBsYWJlbHM6IFtdLFxuICAgICAgICBkYXRhc2V0czogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHlBeGlzSUQ6IFwid3BtXCIsXG4gICAgICAgICAgICAgICAgbGFiZWw6IFwid3BtXCIsXG4gICAgICAgICAgICAgICAgZmlsbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgZGF0YTogW10sXG4gICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IFwiI2Y0NDMzNlwiLFxuICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAyLFxuICAgICAgICAgICAgICAgIHRyZW5kbGluZUxpbmVhcjoge1xuICAgICAgICAgICAgICAgICAgICBzdHlsZTogXCJyZ2JhKDI1NSwxMDUsMTgwLCAuOClcIixcbiAgICAgICAgICAgICAgICAgICAgbGluZVN0eWxlOiBcImRvdHRlZFwiLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogNCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB5QXhpc0lEOiBcImFjY1wiLFxuICAgICAgICAgICAgICAgIGxhYmVsOiBcImFjY1wiLFxuICAgICAgICAgICAgICAgIGZpbGw6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRhdGE6IFtdLFxuICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiBcIiNjY2NjY2NcIixcbiAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMixcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgfSxcbiAgICBvcHRpb25zOiB7XG4gICAgICAgIHJlc3BvbnNpdmU6IHRydWUsXG4gICAgICAgIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlLFxuICAgICAgICBob3Zlcjoge1xuICAgICAgICAgICAgbW9kZTogXCJuZWFyZXN0XCIsXG4gICAgICAgICAgICBpbnRlcnNlY3Q6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgICBzY2FsZXM6IHtcbiAgICAgICAgICAgIHg6IHtcbiAgICAgICAgICAgICAgICBheGlzOiBcInhcIixcbiAgICAgICAgICAgICAgICB0eXBlOiBcInRpbWVzZXJpZXNcIixcbiAgICAgICAgICAgICAgICBib3VuZHM6IFwidGlja3NcIixcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICBvZmZzZXQ6IHRydWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiRGF0ZVwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgd3BtOiB7XG4gICAgICAgICAgICAgICAgYXhpczogXCJ5XCIsXG4gICAgICAgICAgICAgICAgYmVnaW5BdFplcm86IHRydWUsXG4gICAgICAgICAgICAgICAgbWluOiAwLFxuICAgICAgICAgICAgICAgIHRpY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0ZXBTaXplOiAxMCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJXb3JkcyBwZXIgTWludXRlXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhY2M6IHtcbiAgICAgICAgICAgICAgICBheGlzOiBcInlcIixcbiAgICAgICAgICAgICAgICBiZWdpbkF0WmVybzogdHJ1ZSxcbiAgICAgICAgICAgICAgICBtYXg6IDEwMCxcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBcInJpZ2h0XCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJFcnJvciByYXRlICgxMDAgLSBhY2N1cmFjeSlcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGdyaWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHBsdWdpbnM6IHtcbiAgICAgICAgICAgIGFubm90YXRpb246IHtcbiAgICAgICAgICAgICAgICBhbm5vdGF0aW9uczogW10sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdG9vbHRpcDoge1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogeyBkdXJhdGlvbjogMjUwIH0sXG4gICAgICAgICAgICAgICAgLy8gRGlzYWJsZSB0aGUgb24tY2FudmFzIHRvb2x0aXBcbiAgICAgICAgICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGludGVyc2VjdDogZmFsc2UsXG4gICAgICAgICAgICAgICAgZXh0ZXJuYWw6IGZ1bmN0aW9uIChjdHgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjdHgpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIGN0eC50b29sdGlwLm9wdGlvbnMuZGlzcGxheUNvbG9ycyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY2FsbGJhY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgYmVmb3JlTGFiZWw6IGZ1bmN0aW9uICh0b29sdGlwSXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRvb2x0aXBJdGVtLmRhdGFzZXRJbmRleCAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdERhdGEgPSB0b29sdGlwSXRlbS5kYXRhc2V0LmRhdGFbdG9vbHRpcEl0ZW0uZGF0YUluZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYGVycm9yIHJhdGU6ICR7TWlzYy5yb3VuZFRvMihyZXN1bHREYXRhLmVycm9yUmF0ZSl9JVxcbmFjYzogJHtNaXNjLnJvdW5kVG8yKDEwMCAtIHJlc3VsdERhdGEuZXJyb3JSYXRlKX0lYDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdERhdGEgPSB0b29sdGlwSXRlbS5kYXRhc2V0LmRhdGFbdG9vbHRpcEl0ZW0uZGF0YUluZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBsYWJlbCA9IGAke2NvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSA/IFwiY3BtXCIgOiBcIndwbVwifTogJHtyZXN1bHREYXRhLndwbX1gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlxcblwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgcmF3OiAke3Jlc3VsdERhdGEucmF3fWAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiXFxuXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBhY2M6ICR7cmVzdWx0RGF0YS5hY2N9YCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJcXG5cXG5cIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYG1vZGU6ICR7cmVzdWx0RGF0YS5tb2RlfSBgO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdERhdGEubW9kZSA9PSBcInRpbWVcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsICs9IHJlc3VsdERhdGEubW9kZTI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXN1bHREYXRhLm1vZGUgPT0gXCJ3b3Jkc1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgKz0gcmVzdWx0RGF0YS5tb2RlMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkaWZmID0gcmVzdWx0RGF0YS5kaWZmaWN1bHR5O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpZmYgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlmZiA9IFwibm9ybWFsXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCArPSBcIlxcblwiICsgYGRpZmZpY3VsdHk6ICR7ZGlmZn1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgKz1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlxcblwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYHB1bmN0dWF0aW9uOiAke3Jlc3VsdERhdGEucHVuY3R1YXRpb259YCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiXFxuXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgbGFuZ3VhZ2U6ICR7cmVzdWx0RGF0YS5sYW5ndWFnZX1gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJcXG5cXG5cIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBkYXRlOiAkeygwLCBmb3JtYXRfMS5kZWZhdWx0KShuZXcgRGF0ZShyZXN1bHREYXRhLnRpbWVzdGFtcCksIFwiZGQgTU1NIHl5eXkgSEg6bW1cIil9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsYWJlbDtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBhZnRlckxhYmVsOiBmdW5jdGlvbiAodG9vbHRpcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5hY2NvdW50SGlzdG9yeUFjdGl2ZUluZGV4ID0gdG9vbHRpcC5kYXRhSW5kZXg7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICB9LFxufSk7XG5leHBvcnRzLmFjY291bnRBY3Rpdml0eSA9IG5ldyBDaGFydFdpdGhVcGRhdGVDb2xvcnMoJChcIi5wYWdlQWNjb3VudCAjYWNjb3VudEFjdGl2aXR5Q2hhcnRcIiksIHtcbiAgICB0eXBlOiBcImJhclwiLFxuICAgIGRhdGE6IHtcbiAgICAgICAgbGFiZWxzOiBbXSxcbiAgICAgICAgZGF0YXNldHM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB5QXhpc0lEOiBcImNvdW50XCIsXG4gICAgICAgICAgICAgICAgbGFiZWw6IFwiU2Vjb25kc1wiLFxuICAgICAgICAgICAgICAgIGRhdGE6IFtdLFxuICAgICAgICAgICAgICAgIHRyZW5kbGluZUxpbmVhcjoge1xuICAgICAgICAgICAgICAgICAgICBzdHlsZTogXCJyZ2JhKDI1NSwxMDUsMTgwLCAuOClcIixcbiAgICAgICAgICAgICAgICAgICAgbGluZVN0eWxlOiBcImRvdHRlZFwiLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogMixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9yZGVyOiAzLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB5QXhpc0lEOiBcImF2Z1dwbVwiLFxuICAgICAgICAgICAgICAgIGxhYmVsOiBcIkF2ZXJhZ2UgV3BtXCIsXG4gICAgICAgICAgICAgICAgZGF0YTogW10sXG4gICAgICAgICAgICAgICAgdHlwZTogXCJsaW5lXCIsXG4gICAgICAgICAgICAgICAgb3JkZXI6IDIsXG4gICAgICAgICAgICAgICAgdGVuc2lvbjogMCxcbiAgICAgICAgICAgICAgICBmaWxsOiBmYWxzZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgfSxcbiAgICBvcHRpb25zOiB7XG4gICAgICAgIHJlc3BvbnNpdmU6IHRydWUsXG4gICAgICAgIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlLFxuICAgICAgICBob3Zlcjoge1xuICAgICAgICAgICAgbW9kZTogXCJuZWFyZXN0XCIsXG4gICAgICAgICAgICBpbnRlcnNlY3Q6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgICBzY2FsZXM6IHtcbiAgICAgICAgICAgIHg6IHtcbiAgICAgICAgICAgICAgICBheGlzOiBcInhcIixcbiAgICAgICAgICAgICAgICB0aWNrczoge1xuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXBQYWRkaW5nOiAyMCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHR5cGU6IFwidGltZVwiLFxuICAgICAgICAgICAgICAgIHRpbWU6IHtcbiAgICAgICAgICAgICAgICAgICAgdW5pdDogXCJkYXlcIixcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheUZvcm1hdHM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRheTogXCJkIE1NTVwiLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYm91bmRzOiBcInRpY2tzXCIsXG4gICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJEYXRlXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvZmZzZXQ6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY291bnQ6IHtcbiAgICAgICAgICAgICAgICBheGlzOiBcInlcIixcbiAgICAgICAgICAgICAgICBiZWdpbkF0WmVybzogdHJ1ZSxcbiAgICAgICAgICAgICAgICBtaW46IDAsXG4gICAgICAgICAgICAgICAgdGlja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0b1NraXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwUGFkZGluZzogMjAsXG4gICAgICAgICAgICAgICAgICAgIHN0ZXBTaXplOiAxMCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJUaW1lIFR5cGluZ1wiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXZnV3BtOiB7XG4gICAgICAgICAgICAgICAgYXhpczogXCJ5XCIsXG4gICAgICAgICAgICAgICAgYmVnaW5BdFplcm86IHRydWUsXG4gICAgICAgICAgICAgICAgbWluOiAwLFxuICAgICAgICAgICAgICAgIHRpY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcFBhZGRpbmc6IDIwLFxuICAgICAgICAgICAgICAgICAgICBzdGVwU2l6ZTogMTAsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBcInJpZ2h0XCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJBdmVyYWdlIFdwbVwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZ3JpZDoge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgcGx1Z2luczoge1xuICAgICAgICAgICAgYW5ub3RhdGlvbjoge1xuICAgICAgICAgICAgICAgIGFubm90YXRpb25zOiBbXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0b29sdGlwOiB7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB7IGR1cmF0aW9uOiAyNTAgfSxcbiAgICAgICAgICAgICAgICBjYWxsYmFja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGZ1bmN0aW9uICh0b29sdGlwSXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0RGF0YSA9IHRvb2x0aXBJdGVtWzBdLmRhdGFzZXQuZGF0YVt0b29sdGlwSXRlbVswXS5kYXRhSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBmb3JtYXRfMS5kZWZhdWx0KShuZXcgRGF0ZShyZXN1bHREYXRhLngpLCBcImRkIE1NTSB5eXl5XCIpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBiZWZvcmVMYWJlbDogZnVuY3Rpb24gKHRvb2x0aXBJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHREYXRhID0gdG9vbHRpcEl0ZW0uZGF0YXNldC5kYXRhW3Rvb2x0aXBJdGVtLmRhdGFJbmRleF07XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRvb2x0aXBJdGVtLmRhdGFzZXRJbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGBUaW1lIFR5cGluZzogJHtNaXNjLnNlY29uZHNUb1N0cmluZyhNYXRoLnJvdW5kKHJlc3VsdERhdGEueSksIHRydWUsIHRydWUpfVxcblRlc3RzIENvbXBsZXRlZDogJHtyZXN1bHREYXRhLmFtb3VudH1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGBBdmVyYWdlICR7Y29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNID8gXCJDcG1cIiA6IFwiV3BtXCJ9OiAke01pc2Mucm91bmRUbzIocmVzdWx0RGF0YS55KX1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgfSxcbn0pO1xuZXhwb3J0cy5taW5pUmVzdWx0ID0gbmV3IENoYXJ0V2l0aFVwZGF0ZUNvbG9ycygkKFwiLnBhZ2VBY2NvdW50ICNtaW5pUmVzdWx0Q2hhcnRcIiksIHtcbiAgICB0eXBlOiBcImxpbmVcIixcbiAgICBkYXRhOiB7XG4gICAgICAgIGxhYmVsczogW10sXG4gICAgICAgIGRhdGFzZXRzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbGFiZWw6IFwid3BtXCIsXG4gICAgICAgICAgICAgICAgZGF0YTogW10sXG4gICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IFwicmdiYSgxMjUsIDEyNSwgMTI1LCAxKVwiLFxuICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAyLFxuICAgICAgICAgICAgICAgIHlBeGlzSUQ6IFwid3BtXCIsXG4gICAgICAgICAgICAgICAgb3JkZXI6IDIsXG4gICAgICAgICAgICAgICAgcG9pbnRSYWRpdXM6IDIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGxhYmVsOiBcInJhd1wiLFxuICAgICAgICAgICAgICAgIGRhdGE6IFtdLFxuICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiBcInJnYmEoMTI1LCAxMjUsIDEyNSwgMSlcIixcbiAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMixcbiAgICAgICAgICAgICAgICB5QXhpc0lEOiBcInJhd1wiLFxuICAgICAgICAgICAgICAgIG9yZGVyOiAzLFxuICAgICAgICAgICAgICAgIHBvaW50UmFkaXVzOiAyLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJlcnJvcnNcIixcbiAgICAgICAgICAgICAgICBkYXRhOiBbXSxcbiAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogXCJyZ2JhKDI1NSwgMTI1LCAxMjUsIDEpXCIsXG4gICAgICAgICAgICAgICAgcG9pbnRCYWNrZ3JvdW5kQ29sb3I6IFwicmdiYSgyNTUsIDEyNSwgMTI1LCAxKVwiLFxuICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAyLFxuICAgICAgICAgICAgICAgIG9yZGVyOiAxLFxuICAgICAgICAgICAgICAgIHlBeGlzSUQ6IFwiZXJyb3JcIixcbiAgICAgICAgICAgICAgICB0eXBlOiBcInNjYXR0ZXJcIixcbiAgICAgICAgICAgICAgICBwb2ludFN0eWxlOiBcImNyb3NzUm90XCIsXG4gICAgICAgICAgICAgICAgcG9pbnRSYWRpdXM6IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gY29udGV4dC5kYXRhSW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gY29udGV4dC5kYXRhc2V0LmRhdGFbaW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB2b2lkIDAgPyB2YWx1ZSA6IDApIDw9IDAgPyAwIDogMztcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHBvaW50SG92ZXJSYWRpdXM6IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gY29udGV4dC5kYXRhSW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gY29udGV4dC5kYXRhc2V0LmRhdGFbaW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB2b2lkIDAgPyB2YWx1ZSA6IDApIDw9IDAgPyAwIDogNTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICB9LFxuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgcmVzcG9uc2l2ZTogdHJ1ZSxcbiAgICAgICAgbWFpbnRhaW5Bc3BlY3RSYXRpbzogZmFsc2UsXG4gICAgICAgIHNjYWxlczoge1xuICAgICAgICAgICAgeDoge1xuICAgICAgICAgICAgICAgIGF4aXM6IFwieFwiLFxuICAgICAgICAgICAgICAgIHRpY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcFBhZGRpbmc6IDIwLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJTZWNvbmRzXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3cG06IHtcbiAgICAgICAgICAgICAgICBheGlzOiBcInlcIixcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiV29yZHMgcGVyIE1pbnV0ZVwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYmVnaW5BdFplcm86IHRydWUsXG4gICAgICAgICAgICAgICAgbWluOiAwLFxuICAgICAgICAgICAgICAgIHRpY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcFBhZGRpbmc6IDIwLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZ3JpZDoge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmF3OiB7XG4gICAgICAgICAgICAgICAgYXhpczogXCJ5XCIsXG4gICAgICAgICAgICAgICAgZGlzcGxheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJSYXcgV29yZHMgcGVyIE1pbnV0ZVwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYmVnaW5BdFplcm86IHRydWUsXG4gICAgICAgICAgICAgICAgbWluOiAwLFxuICAgICAgICAgICAgICAgIHRpY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcFBhZGRpbmc6IDIwLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZ3JpZDoge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogXCJyaWdodFwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiRXJyb3JzXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBiZWdpbkF0WmVybzogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0aWNrczoge1xuICAgICAgICAgICAgICAgICAgICBwcmVjaXNpb246IDAsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcFBhZGRpbmc6IDIwLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZ3JpZDoge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgcGx1Z2luczoge1xuICAgICAgICAgICAgYW5ub3RhdGlvbjoge1xuICAgICAgICAgICAgICAgIGFubm90YXRpb25zOiBbXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0b29sdGlwOiB7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB7IGR1cmF0aW9uOiAyNTAgfSxcbiAgICAgICAgICAgICAgICBtb2RlOiBcImluZGV4XCIsXG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0OiBmYWxzZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgfSxcbn0pO1xuZnVuY3Rpb24gdXBkYXRlQWNjdXJhY3koKSB7XG4gICAgZXhwb3J0cy5hY2NvdW50SGlzdG9yeS5kYXRhLmRhdGFzZXRzWzFdLmhpZGRlbiA9ICFjb25maWdfMS5kZWZhdWx0LmNoYXJ0QWNjdXJhY3k7XG4gICAgZXhwb3J0cy5hY2NvdW50SGlzdG9yeS5vcHRpb25zLnNjYWxlc1tcImFjY1wiXS5kaXNwbGF5ID1cbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5jaGFydEFjY3VyYWN5O1xuICAgIGV4cG9ydHMuYWNjb3VudEhpc3RvcnkudXBkYXRlKCk7XG59XG5mdW5jdGlvbiB1cGRhdGVTdHlsZSgpIHtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5jaGFydFN0eWxlID09IFwic2NhdHRlclwiKSB7XG4gICAgICAgIGV4cG9ydHMuYWNjb3VudEhpc3RvcnkuZGF0YS5kYXRhc2V0c1swXS5zaG93TGluZSA9IGZhbHNlO1xuICAgICAgICBleHBvcnRzLmFjY291bnRIaXN0b3J5LmRhdGEuZGF0YXNldHNbMV0uc2hvd0xpbmUgPSBmYWxzZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGV4cG9ydHMuYWNjb3VudEhpc3RvcnkuZGF0YS5kYXRhc2V0c1swXS5zaG93TGluZSA9IHRydWU7XG4gICAgICAgIGV4cG9ydHMuYWNjb3VudEhpc3RvcnkuZGF0YS5kYXRhc2V0c1sxXS5zaG93TGluZSA9IHRydWU7XG4gICAgfVxuICAgIGV4cG9ydHMuYWNjb3VudEhpc3RvcnkudXBkYXRlQ29sb3JzKCk7XG59XG5mdW5jdGlvbiB1cGRhdGVDb2xvcnMoY2hhcnQpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCBiZ2NvbG9yID0geWllbGQgVGhlbWVDb2xvcnMuZ2V0KFwiYmdcIik7XG4gICAgICAgIGNvbnN0IHN1YmNvbG9yID0geWllbGQgVGhlbWVDb2xvcnMuZ2V0KFwic3ViXCIpO1xuICAgICAgICBjb25zdCBtYWluY29sb3IgPSB5aWVsZCBUaGVtZUNvbG9ycy5nZXQoXCJtYWluXCIpO1xuICAgICAgICBjb25zdCBlcnJvcmNvbG9yID0geWllbGQgVGhlbWVDb2xvcnMuZ2V0KFwiZXJyb3JcIik7XG4gICAgICAgIGlmIChjaGFydC5kYXRhLmRhdGFzZXRzLmV2ZXJ5KChkYXRhc2V0KSA9PiBkYXRhc2V0LmRhdGEubGVuZ3RoID09PSAwKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNoYXJ0LmRhdGEuZGF0YXNldHNbMF0uYm9yZGVyQ29sb3IgPSBtYWluY29sb3I7XG4gICAgICAgIGNoYXJ0LmRhdGEuZGF0YXNldHNbMV0uYm9yZGVyQ29sb3IgPSBzdWJjb2xvcjtcbiAgICAgICAgaWYgKGNoYXJ0LmRhdGEuZGF0YXNldHNbMl0pIHtcbiAgICAgICAgICAgIGNoYXJ0LmRhdGEuZGF0YXNldHNbMl0uYm9yZGVyQ29sb3IgPSBlcnJvcmNvbG9yO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGFydC5kYXRhLmRhdGFzZXRzWzBdLnR5cGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYgKGNoYXJ0LmNvbmZpZy50eXBlID09PSBcImxpbmVcIikge1xuICAgICAgICAgICAgICAgIGNoYXJ0LmRhdGEuZGF0YXNldHNbMF0ucG9pbnRCYWNrZ3JvdW5kQ29sb3IgPSBtYWluY29sb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjaGFydC5jb25maWcudHlwZSA9PT0gXCJiYXJcIikge1xuICAgICAgICAgICAgICAgIGNoYXJ0LmRhdGEuZGF0YXNldHNbMF0uYmFja2dyb3VuZENvbG9yID0gbWFpbmNvbG9yO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNoYXJ0LmRhdGEuZGF0YXNldHNbMF0udHlwZSA9PT0gXCJiYXJcIikge1xuICAgICAgICAgICAgY2hhcnQuZGF0YS5kYXRhc2V0c1swXS5iYWNrZ3JvdW5kQ29sb3IgPSBtYWluY29sb3I7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY2hhcnQuZGF0YS5kYXRhc2V0c1swXS50eXBlID09PSBcImxpbmVcIikge1xuICAgICAgICAgICAgY2hhcnQuZGF0YS5kYXRhc2V0c1swXS5wb2ludEJhY2tncm91bmRDb2xvciA9IG1haW5jb2xvcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hhcnQuZGF0YS5kYXRhc2V0c1sxXS50eXBlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmIChjaGFydC5jb25maWcudHlwZSA9PT0gXCJsaW5lXCIpIHtcbiAgICAgICAgICAgICAgICBjaGFydC5kYXRhLmRhdGFzZXRzWzFdLnBvaW50QmFja2dyb3VuZENvbG9yID0gc3ViY29sb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjaGFydC5jb25maWcudHlwZSA9PT0gXCJiYXJcIikge1xuICAgICAgICAgICAgICAgIGNoYXJ0LmRhdGEuZGF0YXNldHNbMV0uYmFja2dyb3VuZENvbG9yID0gc3ViY29sb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY2hhcnQuZGF0YS5kYXRhc2V0c1sxXS50eXBlID09PSBcImJhclwiKSB7XG4gICAgICAgICAgICBjaGFydC5kYXRhLmRhdGFzZXRzWzFdLmJhY2tncm91bmRDb2xvciA9IHN1YmNvbG9yO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNoYXJ0LmRhdGEuZGF0YXNldHNbMV0udHlwZSA9PT0gXCJsaW5lXCIpIHtcbiAgICAgICAgICAgIGNoYXJ0LmRhdGEuZGF0YXNldHNbMV0ucG9pbnRCYWNrZ3JvdW5kQ29sb3IgPSBzdWJjb2xvcjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjaGFydFNjYWxlT3B0aW9ucyA9IGNoYXJ0Lm9wdGlvbnM7XG4gICAgICAgIE9iamVjdC5rZXlzKGNoYXJ0U2NhbGVPcHRpb25zLnNjYWxlcykuZm9yRWFjaCgoc2NhbGVJRCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYXhpcyA9IGNoYXJ0U2NhbGVPcHRpb25zLnNjYWxlc1tzY2FsZUlEXTtcbiAgICAgICAgICAgIGF4aXMudGlja3MuY29sb3IgPSBzdWJjb2xvcjtcbiAgICAgICAgICAgIGF4aXMudGl0bGUuY29sb3IgPSBzdWJjb2xvcjtcbiAgICAgICAgfSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjaGFydC5kYXRhLmRhdGFzZXRzWzBdXG4gICAgICAgICAgICAgICAgLnRyZW5kbGluZUxpbmVhci5zdHlsZSA9IHN1YmNvbG9yO1xuICAgICAgICAgICAgY2hhcnQuZGF0YS5kYXRhc2V0c1sxXVxuICAgICAgICAgICAgICAgIC50cmVuZGxpbmVMaW5lYXIuc3R5bGUgPSBzdWJjb2xvcjtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoX2EpIHsgfVxuICAgICAgICBjaGFydC5vcHRpb25zLnBsdWdpbnMuYW5ub3RhdGlvblxuICAgICAgICAgICAgLmFubm90YXRpb25zLmZvckVhY2goKGFubm90YXRpb24pID0+IHtcbiAgICAgICAgICAgIGlmIChhbm5vdGF0aW9uLmlkICE9PSBcImZ1bmJveC1sYWJlbFwiKSB7XG4gICAgICAgICAgICAgICAgYW5ub3RhdGlvbi5ib3JkZXJDb2xvciA9IHN1YmNvbG9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYW5ub3RhdGlvbi5sYWJlbC5iYWNrZ3JvdW5kQ29sb3IgPSBzdWJjb2xvcjtcbiAgICAgICAgICAgIGFubm90YXRpb24ubGFiZWwuY29sb3IgPSBiZ2NvbG9yO1xuICAgICAgICB9KTtcbiAgICAgICAgY2hhcnQudXBkYXRlKFwibm9uZVwiKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMudXBkYXRlQ29sb3JzID0gdXBkYXRlQ29sb3JzO1xuZnVuY3Rpb24gc2V0RGVmYXVsdEZvbnRGYW1pbHkoZm9udCkge1xuICAgIGNoYXJ0X2pzXzEuQ2hhcnQuZGVmYXVsdHMuZm9udC5mYW1pbHkgPSBmb250LnJlcGxhY2UoL18vZywgXCIgXCIpO1xufVxuZXhwb3J0cy5zZXREZWZhdWx0Rm9udEZhbWlseSA9IHNldERlZmF1bHRGb250RmFtaWx5O1xuZnVuY3Rpb24gdXBkYXRlQWxsQ2hhcnRDb2xvcnMoKSB7XG4gICAgVGhlbWVDb2xvcnMudXBkYXRlKCk7XG4gICAgZXhwb3J0cy5hY2NvdW50SGlzdG9yeS51cGRhdGVDb2xvcnMoKTtcbiAgICBleHBvcnRzLnJlc3VsdC51cGRhdGVDb2xvcnMoKTtcbiAgICBleHBvcnRzLmFjY291bnRBY3Rpdml0eS51cGRhdGVDb2xvcnMoKTtcbiAgICBleHBvcnRzLm1pbmlSZXN1bHQudXBkYXRlQ29sb3JzKCk7XG59XG5leHBvcnRzLnVwZGF0ZUFsbENoYXJ0Q29sb3JzID0gdXBkYXRlQWxsQ2hhcnRDb2xvcnM7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5LCBldmVudFZhbHVlKSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImNoYXJ0QWNjdXJhY3lcIilcbiAgICAgICAgdXBkYXRlQWNjdXJhY3koKTtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiY2hhcnRTdHlsZVwiKVxuICAgICAgICB1cGRhdGVTdHlsZSgpO1xuICAgIGlmIChldmVudEtleSA9PT0gXCJmb250RmFtaWx5XCIpXG4gICAgICAgIHNldERlZmF1bHRGb250RmFtaWx5KGV2ZW50VmFsdWUpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBUZXN0TG9naWMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC1sb2dpY1wiKSk7XG5jb25zdCBUZXN0VUkgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC11aVwiKSk7XG5jb25zdCBUZXN0U3RhdHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC1zdGF0c1wiKSk7XG5jb25zdCBNb25rZXkgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvbW9ua2V5XCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpLCBVcGRhdGVDb25maWcgPSBjb25maWdfMTtcbmNvbnN0IEtleW1hcCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMva2V5bWFwXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgTGl2ZUFjYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9saXZlLWFjY1wiKSk7XG5jb25zdCBMaXZlQnVyc3QgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvbGl2ZS1idXJzdFwiKSk7XG5jb25zdCBGdW5ib3ggPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvZnVuYm94XCIpKTtcbmNvbnN0IFNvdW5kID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3NvdW5kLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgQ2FyZXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvY2FyZXRcIikpO1xuY29uc3QgTWFudWFsUmVzdGFydCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9tYW51YWwtcmVzdGFydC10cmFja2VyXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgQ3VzdG9tVGV4dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9jdXN0b20tdGV4dFwiKSk7XG5jb25zdCBQYWdlQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9wYWdlLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgU2V0dGluZ3MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BhZ2VzL3NldHRpbmdzXCIpKTtcbmNvbnN0IExheW91dEVtdWxhdG9yID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2xheW91dC1lbXVsYXRvclwiKSk7XG5jb25zdCBQYWNlQ2FyZXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvcGFjZS1jYXJldFwiKSk7XG5jb25zdCBUaW1lclByb2dyZXNzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3RpbWVyLXByb2dyZXNzXCIpKTtcbmNvbnN0IEZvY3VzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2ZvY3VzXCIpKTtcbmNvbnN0IFNoaWZ0VHJhY2tlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9zaGlmdC10cmFja2VyXCIpKTtcbmNvbnN0IFJlcGxheSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9yZXBsYXlcIikpO1xuY29uc3QgTW9ua2V5UG93ZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL21vbmtleS1wb3dlclwiKSk7XG5jb25zdCBXZWFrU3BvdCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC93ZWFrLXNwb3RcIikpO1xuY29uc3QgTGVhZGVyYm9hcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sZWFkZXJib2FyZHNcIikpO1xuY29uc3QgQWN0aXZlUGFnZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL2FjdGl2ZS1wYWdlXCIpKTtcbmNvbnN0IFRlc3RBY3RpdmUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy90ZXN0LWFjdGl2ZVwiKSk7XG5jb25zdCBUZXN0SW5wdXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC1pbnB1dFwiKSk7XG5jb25zdCBUZXN0V29yZHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC13b3Jkc1wiKSk7XG5jb25zdCBXb3JkVHlwZWRFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvd29yZC10eXBlZC1ldmVudFwiKSk7XG5sZXQgZG9udEluc2VydFNwYWNlID0gZmFsc2U7XG5sZXQgY29ycmVjdFNoaWZ0VXNlZCA9IHRydWU7XG5jb25zdCB3b3Jkc0lucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ3b3Jkc0lucHV0XCIpO1xuZnVuY3Rpb24gc2V0V29yZHNJbnB1dCh2YWx1ZSkge1xuICAgIC8vIE9ubHkgY2hhbmdlICN3b3Jkc0lucHV0IGlmIGl0J3Mgbm90IGFscmVhZHkgdGhlIHdhbnRlZCB2YWx1ZVxuICAgIC8vIEF2b2lkcyBTYWZhcmkgdHJpZ2dlcmluZyB1bm5lZWRlZCBldmVudHMsIGNhdXNpbmcgaXNzdWVzIHdpdGhcbiAgICAvLyBkZWFkIGtleXMuXG4gICAgLy8gY29uc29sZS5sb2coXCJzZXR0aW5ncyB3b3JkcyBpbnB1dCB0byBcIiArIHZhbHVlKTtcbiAgICBpZiAodmFsdWUgIT09IHdvcmRzSW5wdXQudmFsdWUpIHtcbiAgICAgICAgd29yZHNJbnB1dC52YWx1ZSA9IHZhbHVlO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHVwZGF0ZVVJKCkge1xuICAgIGNvbnN0IGFjYyA9IE1pc2Mucm91bmRUbzIoVGVzdFN0YXRzLmNhbGN1bGF0ZUFjY3VyYWN5KCkpO1xuICAgIGlmICghaXNOYU4oYWNjKSlcbiAgICAgICAgTGl2ZUFjYy51cGRhdGUoYWNjKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBNb2RlID09PSBcIm5leHRcIiAmJiBjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT09IFwiemVuXCIpIHtcbiAgICAgICAgS2V5bWFwLmhpZ2hsaWdodEtleShUZXN0V29yZHMud29yZHNcbiAgICAgICAgICAgIC5nZXRDdXJyZW50KClcbiAgICAgICAgICAgIC5jaGFyQXQoVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoKVxuICAgICAgICAgICAgLnRvU3RyaW5nKClcbiAgICAgICAgICAgIC50b1VwcGVyQ2FzZSgpKTtcbiAgICB9XG59XG5mdW5jdGlvbiBiYWNrc3BhY2VUb1ByZXZpb3VzKCkge1xuICAgIGlmICghVGVzdEFjdGl2ZS5nZXQoKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGggPT0gMCB8fFxuICAgICAgICBUZXN0VUkuY3VycmVudFdvcmRFbGVtZW50SW5kZXggPT0gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICgoVGVzdElucHV0LmlucHV0Lmhpc3RvcnlbVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleCAtIDFdID09XG4gICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5nZXQoVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleCAtIDEpICYmXG4gICAgICAgICFjb25maWdfMS5kZWZhdWx0LmZyZWVkb21Nb2RlKSB8fFxuICAgICAgICAkKCQoXCIud29yZFwiKVtUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4IC0gMV0pLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuY29uZmlkZW5jZU1vZGUgPT09IFwib25cIiB8fCBjb25maWdfMS5kZWZhdWx0LmNvbmZpZGVuY2VNb2RlID09PSBcIm1heFwiKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgVGVzdElucHV0LmlucHV0LmN1cnJlbnQgPSBUZXN0SW5wdXQuaW5wdXQucG9wSGlzdG9yeSgpO1xuICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQucG9wSGlzdG9yeSgpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJub3NwYWNlXCIgfHwgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwiYXJyb3dzXCIpIHtcbiAgICAgICAgVGVzdElucHV0LmlucHV0LmN1cnJlbnQgPSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5zbGljZSgwLCAtMSk7XG4gICAgfVxuICAgIFRlc3RXb3Jkcy53b3Jkcy5kZWNyZWFzZUN1cnJlbnRJbmRleCgpO1xuICAgIFRlc3RVSS5zZXRDdXJyZW50V29yZEVsZW1lbnRJbmRleChUZXN0VUkuY3VycmVudFdvcmRFbGVtZW50SW5kZXggLSAxKTtcbiAgICBUZXN0VUkudXBkYXRlQWN0aXZlRWxlbWVudCh0cnVlKTtcbiAgICBGdW5ib3gudG9nZ2xlU2NyaXB0KFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KCkpO1xuICAgIFRlc3RVSS51cGRhdGVXb3JkRWxlbWVudCgpO1xuICAgIENhcmV0LnVwZGF0ZVBvc2l0aW9uKCk7XG4gICAgUmVwbGF5LmFkZFJlcGxheUV2ZW50KFwiYmFja1dvcmRcIik7XG59XG5mdW5jdGlvbiBoYW5kbGVTcGFjZSgpIHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKCFUZXN0QWN0aXZlLmdldCgpKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50ID09PSBcIlwiKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiKSB7XG4gICAgICAgICQoXCIjd29yZHMgLndvcmQuYWN0aXZlXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAkKFwiI3dvcmRzXCIpLmFwcGVuZChcIjxkaXYgY2xhc3M9J3dvcmQgYWN0aXZlJz48L2Rpdj5cIik7XG4gICAgfVxuICAgIGNvbnN0IGN1cnJlbnRXb3JkID0gVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwibGF5b3V0Zmx1aWRcIiAmJiBjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT09IFwidGltZVwiKSB7XG4gICAgICAgIC8vIGhlcmUgSSBuZWVkIHRvIGNoZWNrIGlmIENvbmZpZy5jdXN0b21MYXlvdXRGbHVpZCBleGlzdHMgYmVjYXVzZSBvZiBteSBzY3VmZmVkIHNvbHV0aW9uIG9mIHJldHVybmluZyB3aGVuZXZlciB2YWx1ZSBpcyB1bmRlZmluZWQgaW4gdGhlIHNldEN1c3RvbUxheW91dGZsdWlkIGZ1bmN0aW9uXG4gICAgICAgIGNvbnN0IGxheW91dHMgPSBjb25maWdfMS5kZWZhdWx0LmN1c3RvbUxheW91dGZsdWlkXG4gICAgICAgICAgICA/IGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tTGF5b3V0Zmx1aWQuc3BsaXQoXCIjXCIpXG4gICAgICAgICAgICA6IFtcInF3ZXJ0eVwiLCBcImR2b3Jha1wiLCBcImNvbGVtYWtcIl07XG4gICAgICAgIGxldCBpbmRleCA9IDA7XG4gICAgICAgIGNvbnN0IG91dG9mID0gVGVzdFdvcmRzLndvcmRzLmxlbmd0aDtcbiAgICAgICAgaW5kZXggPSBNYXRoLmZsb29yKChUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGggKyAxKSAvIChvdXRvZiAvIGxheW91dHMubGVuZ3RoKSk7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmxheW91dCAhPT0gbGF5b3V0c1tpbmRleF0gJiYgbGF5b3V0c1tpbmRleF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoYC0tLSAhISEgJHtsYXlvdXRzW2luZGV4XX0gISEhIC0tLWAsIDApO1xuICAgICAgICB9XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRMYXlvdXQobGF5b3V0c1tpbmRleF0pO1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTGF5b3V0KGxheW91dHNbaW5kZXhdKTtcbiAgICAgICAgS2V5bWFwLmhpZ2hsaWdodEtleShUZXN0V29yZHMud29yZHNcbiAgICAgICAgICAgIC5nZXRDdXJyZW50KClcbiAgICAgICAgICAgIC5jaGFyQXQoVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoKVxuICAgICAgICAgICAgLnRvU3RyaW5nKClcbiAgICAgICAgICAgIC50b1VwcGVyQ2FzZSgpKTtcbiAgICAgICAgKF9hID0gU2V0dGluZ3MuZ3JvdXBzW1wibGF5b3V0XCJdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudXBkYXRlSW5wdXQoKTtcbiAgICB9XG4gICAgZG9udEluc2VydFNwYWNlID0gdHJ1ZTtcbiAgICBjb25zdCBidXJzdCA9IFRlc3RTdGF0cy5jYWxjdWxhdGVCdXJzdCgpO1xuICAgIExpdmVCdXJzdC51cGRhdGUoTWF0aC5yb3VuZChidXJzdCkpO1xuICAgIFRlc3RJbnB1dC5wdXNoQnVyc3RUb0hpc3RvcnkoYnVyc3QpO1xuICAgIC8vY29ycmVjdCB3b3JkIG9yIGluIHplbiBtb2RlXG4gICAgY29uc3QgaXNXb3JkQ29ycmVjdCA9IGN1cnJlbnRXb3JkID09IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50IHx8IGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiO1xuICAgIC8vIFRoaXMgd2lsbCBwcm9iYWJseSBicmVhayBpZiBsZXR0ZXIgbW9kZSBpcyBvbiBvciBzb21ldGhpbmdcbiAgICBjb25zdCAkY3VycmVudFRlc3RXb3JkID0gJChgI3dvcmRzIC53b3JkLmFjdGl2ZWApO1xuICAgIFdvcmRUeXBlZEV2ZW50LmRpc3BhdGNoKGN1cnJlbnRXb3JkLCBpc1dvcmRDb3JyZWN0LCBidXJzdCwgJGN1cnJlbnRUZXN0V29yZCk7XG4gICAgTW9ua2V5UG93ZXIuYWRkUG93ZXIoaXNXb3JkQ29ycmVjdCwgdHJ1ZSk7XG4gICAgVGVzdElucHV0LmluY3JlbWVudEFjY3VyYWN5KGlzV29yZENvcnJlY3QpO1xuICAgIGlmIChpc1dvcmRDb3JyZWN0KSB7XG4gICAgICAgIFBhY2VDYXJldC5oYW5kbGVTcGFjZSh0cnVlLCBjdXJyZW50V29yZCk7XG4gICAgICAgIFRlc3RJbnB1dC5pbnB1dC5wdXNoSGlzdG9yeSgpO1xuICAgICAgICBUZXN0V29yZHMud29yZHMuaW5jcmVhc2VDdXJyZW50SW5kZXgoKTtcbiAgICAgICAgVGVzdFVJLnNldEN1cnJlbnRXb3JkRWxlbWVudEluZGV4KFRlc3RVSS5jdXJyZW50V29yZEVsZW1lbnRJbmRleCArIDEpO1xuICAgICAgICBUZXN0VUkudXBkYXRlQWN0aXZlRWxlbWVudCgpO1xuICAgICAgICBGdW5ib3gudG9nZ2xlU2NyaXB0KFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KCkpO1xuICAgICAgICBDYXJldC51cGRhdGVQb3NpdGlvbigpO1xuICAgICAgICBUZXN0SW5wdXQuaW5jcmVtZW50S2V5cHJlc3NDb3VudCgpO1xuICAgICAgICBUZXN0SW5wdXQucHVzaEtleXByZXNzV29yZChUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4KTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ICE9PSBcIm5vc3BhY2VcIiAmJiBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCAhPT0gXCJhcnJvd3NcIikge1xuICAgICAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgICAgIH1cbiAgICAgICAgUmVwbGF5LmFkZFJlcGxheUV2ZW50KFwic3VibWl0Q29ycmVjdFdvcmRcIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggIT09IFwibm9zcGFjZVwiICYmIGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ICE9PSBcImFycm93c1wiKSB7XG4gICAgICAgICAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQucGxheVNvdW5kT25FcnJvciB8fCBjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSkge1xuICAgICAgICAgICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgU291bmQucGxheUVycm9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgVGVzdElucHV0LnB1c2hNaXNzZWRXb3JkKFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KCkpO1xuICAgICAgICBUZXN0SW5wdXQuaW5jcmVtZW50S2V5cHJlc3NFcnJvcnMoKTtcbiAgICAgICAgY29uc3QgY2lsID0gVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoO1xuICAgICAgICBpZiAoY2lsIDw9IFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KCkubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAoY2lsID49IFRlc3RJbnB1dC5jb3JyZWN0ZWQuY3VycmVudC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBUZXN0SW5wdXQuY29ycmVjdGVkLmN1cnJlbnQgKz0gXCJfXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBUZXN0SW5wdXQuY29ycmVjdGVkLmN1cnJlbnQgPVxuICAgICAgICAgICAgICAgICAgICBUZXN0SW5wdXQuY29ycmVjdGVkLmN1cnJlbnQuc3Vic3RyaW5nKDAsIGNpbCkgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJfXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgVGVzdElucHV0LmNvcnJlY3RlZC5jdXJyZW50LnN1YnN0cmluZyhjaWwgKyAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zdG9wT25FcnJvciAhPSBcIm9mZlwiKSB7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ID09IFwiZXhwZXJ0XCIgfHwgY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ID09IFwibWFzdGVyXCIpIHtcbiAgICAgICAgICAgICAgICAvL2ZhaWxlZCBkdWUgdG8gZGlmZiB3aGVuIHByZXNzaW5nIHNwYWNlXG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLmZhaWwoXCJkaWZmaWN1bHR5XCIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnN0b3BPbkVycm9yID09IFwid29yZFwiKSB7XG4gICAgICAgICAgICAgICAgZG9udEluc2VydFNwYWNlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgUmVwbGF5LmFkZFJlcGxheUV2ZW50KFwiaW5jb3JyZWN0TGV0dGVyXCIsIFwiX1wiKTtcbiAgICAgICAgICAgICAgICBUZXN0VUkudXBkYXRlV29yZEVsZW1lbnQodHJ1ZSk7XG4gICAgICAgICAgICAgICAgQ2FyZXQudXBkYXRlUG9zaXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBQYWNlQ2FyZXQuaGFuZGxlU3BhY2UoZmFsc2UsIGN1cnJlbnRXb3JkKTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlICYmIGNvbmZpZ18xLmRlZmF1bHQuaGlnaGxpZ2h0TW9kZSAhPT0gXCJvZmZcIikge1xuICAgICAgICAgICAgJChcIiN3b3JkcyAud29yZC5hY3RpdmUgbGV0dGVyXCIpLmFkZENsYXNzKFwiY29ycmVjdFwiKTtcbiAgICAgICAgfVxuICAgICAgICBUZXN0SW5wdXQuaW5wdXQucHVzaEhpc3RvcnkoKTtcbiAgICAgICAgVGVzdFVJLmhpZ2hsaWdodEJhZFdvcmQoVGVzdFVJLmN1cnJlbnRXb3JkRWxlbWVudEluZGV4LCAhY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUpO1xuICAgICAgICBUZXN0V29yZHMud29yZHMuaW5jcmVhc2VDdXJyZW50SW5kZXgoKTtcbiAgICAgICAgVGVzdFVJLnNldEN1cnJlbnRXb3JkRWxlbWVudEluZGV4KFRlc3RVSS5jdXJyZW50V29yZEVsZW1lbnRJbmRleCArIDEpO1xuICAgICAgICBUZXN0VUkudXBkYXRlQWN0aXZlRWxlbWVudCgpO1xuICAgICAgICBGdW5ib3gudG9nZ2xlU2NyaXB0KFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KCkpO1xuICAgICAgICBDYXJldC51cGRhdGVQb3NpdGlvbigpO1xuICAgICAgICBUZXN0SW5wdXQuaW5jcmVtZW50S2V5cHJlc3NDb3VudCgpO1xuICAgICAgICBUZXN0SW5wdXQucHVzaEtleXByZXNzV29yZChUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4KTtcbiAgICAgICAgVGVzdElucHV0LnVwZGF0ZUxhc3RLZXlwcmVzcygpO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ID09IFwiZXhwZXJ0XCIgfHwgY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ID09IFwibWFzdGVyXCIpIHtcbiAgICAgICAgICAgIFRlc3RMb2dpYy5mYWlsKFwiZGlmZmljdWx0eVwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4ID09IFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIC8vc3VibWl0dGVkIGxhc3Qgd29yZCB0aGF0IGlzIGluY29ycmVjdFxuICAgICAgICAgICAgVGVzdExvZ2ljLmZpbmlzaCgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIFJlcGxheS5hZGRSZXBsYXlFdmVudChcInN1Ym1pdEVycm9yV29yZFwiKTtcbiAgICB9XG4gICAgbGV0IHdvcmRMZW5ndGg7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ6ZW5cIikge1xuICAgICAgICB3b3JkTGVuZ3RoID0gVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgd29yZExlbmd0aCA9IFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KCkubGVuZ3RoO1xuICAgIH1cbiAgICBjb25zdCBmbGV4ID0gTWlzYy53aG9yZihjb25maWdfMS5kZWZhdWx0Lm1pbkJ1cnN0Q3VzdG9tU3BlZWQsIHdvcmRMZW5ndGgpO1xuICAgIGlmICgoY29uZmlnXzEuZGVmYXVsdC5taW5CdXJzdCA9PT0gXCJmaXhlZFwiICYmIGJ1cnN0IDwgY29uZmlnXzEuZGVmYXVsdC5taW5CdXJzdEN1c3RvbVNwZWVkKSB8fFxuICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5taW5CdXJzdCA9PT0gXCJmbGV4XCIgJiYgYnVyc3QgPCBmbGV4KSkge1xuICAgICAgICBUZXN0TG9naWMuZmFpbChcIm1pbiBidXJzdFwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBUZXN0SW5wdXQuY29ycmVjdGVkLnB1c2hIaXN0b3J5KCk7XG4gICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LnNob3dBbGxMaW5lcyB8fFxuICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ0aW1lXCIgfHxcbiAgICAgICAgKEN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmIEN1c3RvbVRleHQud29yZCA9PSAwKSB8fFxuICAgICAgICBDdXN0b21UZXh0LmlzVGltZVJhbmRvbSkge1xuICAgICAgICBjb25zdCBjdXJyZW50VG9wID0gTWF0aC5mbG9vcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiI3dvcmRzIC53b3JkXCIpW1Rlc3RVSS5jdXJyZW50V29yZEVsZW1lbnRJbmRleCAtIDFdLm9mZnNldFRvcCk7XG4gICAgICAgIGxldCBuZXh0VG9wO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbmV4dFRvcCA9IE1hdGguZmxvb3IoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIiN3b3JkcyAud29yZFwiKVtUZXN0VUkuY3VycmVudFdvcmRFbGVtZW50SW5kZXhdLm9mZnNldFRvcCk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIG5leHRUb3AgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChuZXh0VG9wID4gY3VycmVudFRvcCAmJiAhVGVzdFVJLmxpbmVUcmFuc2l0aW9uKSB7XG4gICAgICAgICAgICBUZXN0VUkubGluZUp1bXAoY3VycmVudFRvcCk7XG4gICAgICAgIH1cbiAgICB9IC8vZW5kIG9mIGxpbmUgd3JhcFxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmtleW1hcE1vZGUgPT09IFwicmVhY3RcIikge1xuICAgICAgICBLZXltYXAuZmxhc2hLZXkoXCIgXCIsIHRydWUpO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIgfHxcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiIHx8XG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiIHx8XG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ6ZW5cIikge1xuICAgICAgICBUaW1lclByb2dyZXNzLnVwZGF0ZSgpO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwidGltZVwiIHx8XG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcIndvcmRzXCIgfHxcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiY3VzdG9tXCIgfHxcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwicXVvdGVcIikge1xuICAgICAgICBUZXN0TG9naWMuYWRkV29yZCgpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGlzQ2hhckNvcnJlY3QoY2hhciwgY2hhckluZGV4KSB7XG4gICAgaWYgKCFjb3JyZWN0U2hpZnRVc2VkKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBjb25zdCBvcmlnaW5hbENoYXIgPSBUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpW2NoYXJJbmRleF07XG4gICAgaWYgKG9yaWdpbmFsQ2hhciA9PSBjaGFyKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZS5zcGxpdChcIl9cIilbMF0gPT0gXCJydXNzaWFuXCIpIHtcbiAgICAgICAgaWYgKChjaGFyID09PSBcItC1XCIgfHwgY2hhciA9PT0gXCJlXCIpICYmIG9yaWdpbmFsQ2hhciA9PSBcItGRXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGFyID09PSBcItGRXCIgJiYgKG9yaWdpbmFsQ2hhciA9PSBcItC1XCIgfHwgb3JpZ2luYWxDaGFyID09PSBcImVcIikpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICBpZiAoKGNoYXIgPT09IFwid1wiIHx8IGNoYXIgPT09IFwiQXJyb3dVcFwiKSAmJiBvcmlnaW5hbENoYXIgPT0gXCLihpFcIikge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKChjaGFyID09PSBcInNcIiB8fCBjaGFyID09PSBcIkFycm93RG93blwiKSAmJiBvcmlnaW5hbENoYXIgPT0gXCLihpNcIikge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKChjaGFyID09PSBcImFcIiB8fCBjaGFyID09PSBcIkFycm93TGVmdFwiKSAmJiBvcmlnaW5hbENoYXIgPT0gXCLihpBcIikge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKChjaGFyID09PSBcImRcIiB8fCBjaGFyID09PSBcIkFycm93UmlnaHRcIikgJiYgb3JpZ2luYWxDaGFyID09IFwi4oaSXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICgoY2hhciA9PT0gYOKAmWAgfHwgY2hhciA9PT0gXCLigJhcIiB8fCBjaGFyID09PSBcIidcIikgJiZcbiAgICAgICAgKG9yaWdpbmFsQ2hhciA9PSBg4oCZYCB8fCBvcmlnaW5hbENoYXIgPT09IFwi4oCYXCIgfHwgb3JpZ2luYWxDaGFyID09PSBcIidcIikpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmICgoY2hhciA9PT0gYFwiYCB8fCBjaGFyID09PSBcIuKAnVwiIHx8IGNoYXIgPT0gXCLigJxcIiB8fCBjaGFyID09PSBcIuKAnlwiKSAmJlxuICAgICAgICAob3JpZ2luYWxDaGFyID09IGBcImAgfHxcbiAgICAgICAgICAgIG9yaWdpbmFsQ2hhciA9PT0gXCLigJ1cIiB8fFxuICAgICAgICAgICAgb3JpZ2luYWxDaGFyID09PSBcIuKAnFwiIHx8XG4gICAgICAgICAgICBvcmlnaW5hbENoYXIgPT09IFwi4oCeXCIpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoKGNoYXIgPT09IFwi4oCTXCIgfHwgY2hhciA9PT0gXCLigJRcIiB8fCBjaGFyID09IFwiLVwiKSAmJlxuICAgICAgICAob3JpZ2luYWxDaGFyID09IFwiLVwiIHx8IG9yaWdpbmFsQ2hhciA9PT0gXCLigJNcIiB8fCBvcmlnaW5hbENoYXIgPT09IFwi4oCUXCIpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5mdW5jdGlvbiBoYW5kbGVDaGFyKGNoYXIsIGNoYXJJbmRleCkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICBpZiAoVGVzdFVJLnJlc3VsdENhbGN1bGF0aW5nIHx8IFRlc3RVSS5yZXN1bHRWaXNpYmxlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNoYXIgPT09IFwi4oCmXCIpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHtcbiAgICAgICAgICAgIGhhbmRsZUNoYXIoXCIuXCIsIGNoYXJJbmRleCArIGkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNoYXIgPT09IFwiXFxuXCIgJiYgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwiNTgwMDhcIikge1xuICAgICAgICBjaGFyID0gXCIgXCI7XG4gICAgfVxuICAgIGlmIChjaGFyICE9PSBcIlxcblwiICYmIGNoYXIgIT09IFwiXFx0XCIgJiYgL1xccy8udGVzdChjaGFyKSkge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwibm9zcGFjZVwiIHx8IGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcImFycm93c1wiKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBoYW5kbGVTcGFjZSgpO1xuICAgICAgICAvL2luc2VydCBzcGFjZSBmb3IgZXhwZXJ0IGFuZCBtYXN0ZXIgb3Igc3RyaWN0IHNwYWNlLFxuICAgICAgICAvL29yIGZvciBzdG9wIG9uIGVycm9yIHNldCB0byB3b3JkLFxuICAgICAgICAvL290aGVyd2lzZSBkb250IGRvIGFueXRoaW5nXG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHkgIT09IFwibm9ybWFsXCIgfHxcbiAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0LnN0cmljdFNwYWNlICYmIGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJ6ZW5cIikgfHxcbiAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQuc3RvcE9uRXJyb3IgPT09IFwid29yZFwiKSB7XG4gICAgICAgICAgICBpZiAoZG9udEluc2VydFNwYWNlKSB7XG4gICAgICAgICAgICAgICAgZG9udEluc2VydFNwYWNlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT09IFwiemVuXCIgJiZcbiAgICAgICAgVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKVtjaGFySW5kZXhdICE9PSBcIlxcblwiICYmXG4gICAgICAgIGNoYXIgPT09IFwiXFxuXCIpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvL3N0YXJ0IHRoZSB0ZXN0XG4gICAgaWYgKCFUZXN0QWN0aXZlLmdldCgpICYmICFUZXN0TG9naWMuc3RhcnRUZXN0KCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBGb2N1cy5zZXQodHJ1ZSk7XG4gICAgQ2FyZXQuc3RvcEFuaW1hdGlvbigpO1xuICAgIGNvbnN0IHRoaXNDaGFyQ29ycmVjdCA9IGlzQ2hhckNvcnJlY3QoY2hhciwgY2hhckluZGV4KTtcbiAgICBpZiAodGhpc0NoYXJDb3JyZWN0ICYmIGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJ6ZW5cIikge1xuICAgICAgICBjaGFyID0gVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKS5jaGFyQXQoY2hhckluZGV4KTtcbiAgICB9XG4gICAgaWYgKCF0aGlzQ2hhckNvcnJlY3QgJiYgY2hhciA9PT0gXCJcXG5cIikge1xuICAgICAgICBpZiAoVGVzdElucHV0LmlucHV0LmN1cnJlbnQgPT09IFwiXCIpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNoYXIgPSBcIiBcIjtcbiAgICB9XG4gICAgaWYgKFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50ID09PSBcIlwiKSB7XG4gICAgICAgIFRlc3RJbnB1dC5zZXRCdXJzdFN0YXJ0KHBlcmZvcm1hbmNlLm5vdygpKTtcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0aW5nV29yZCA9IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50LnN1YnN0cmluZygwLCBjaGFySW5kZXgpICtcbiAgICAgICAgY2hhciArXG4gICAgICAgIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50LnN1YnN0cmluZyhjaGFySW5kZXggKyAxKTtcbiAgICBpZiAoIXRoaXNDaGFyQ29ycmVjdCAmJiBNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzLnRlc3QocmVzdWx0aW5nV29yZCkpIHtcbiAgICAgICAgVGVzdElucHV0LmlucHV0LmN1cnJlbnQgPSByZXN1bHRpbmdXb3JkO1xuICAgICAgICBUZXN0VUkudXBkYXRlV29yZEVsZW1lbnQoKTtcbiAgICAgICAgQ2FyZXQudXBkYXRlUG9zaXRpb24oKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBNb25rZXlQb3dlci5hZGRQb3dlcih0aGlzQ2hhckNvcnJlY3QpO1xuICAgIFRlc3RJbnB1dC5pbmNyZW1lbnRBY2N1cmFjeSh0aGlzQ2hhckNvcnJlY3QpO1xuICAgIGlmICghdGhpc0NoYXJDb3JyZWN0KSB7XG4gICAgICAgIFRlc3RJbnB1dC5pbmNyZW1lbnRLZXlwcmVzc0Vycm9ycygpO1xuICAgICAgICBUZXN0SW5wdXQucHVzaE1pc3NlZFdvcmQoVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKSk7XG4gICAgfVxuICAgIFdlYWtTcG90LnVwZGF0ZVNjb3JlKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ6ZW5cIiA/IGNoYXIgOiBUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpW2NoYXJJbmRleF0sIHRoaXNDaGFyQ29ycmVjdCk7XG4gICAgaWYgKHRoaXNDaGFyQ29ycmVjdCkge1xuICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5wbGF5U291bmRPbkVycm9yIHx8IGNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlKSB7XG4gICAgICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIFNvdW5kLnBsYXlFcnJvcigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICghY29ycmVjdFNoaWZ0VXNlZCAmJiBjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHkgIT0gXCJtYXN0ZXJcIilcbiAgICAgICAgcmV0dXJuO1xuICAgIC8vdXBkYXRlIGN1cnJlbnQgY29ycmVjdGVkIHZlcnNpb24uIGlmIGl0cyBlbXB0eSB0aGVuIGFkZCB0aGUgY3VycmVudCBjaGFyLiBpZiBpdHMgbm90IHRoZW4gcmVwbGFjZSB0aGUgbGFzdCBjaGFyYWN0ZXIgd2l0aCB0aGUgY3VycmVudGx5IHByZXNzZWQgb25lIC8gYWRkIGl0XG4gICAgaWYgKFRlc3RJbnB1dC5jb3JyZWN0ZWQuY3VycmVudCA9PT0gXCJcIikge1xuICAgICAgICBUZXN0SW5wdXQuY29ycmVjdGVkLmN1cnJlbnQgKz0gcmVzdWx0aW5nV29yZDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChjaGFySW5kZXggPj0gVGVzdElucHV0LmNvcnJlY3RlZC5jdXJyZW50Lmxlbmd0aCkge1xuICAgICAgICAgICAgVGVzdElucHV0LmNvcnJlY3RlZC5jdXJyZW50ICs9IGNoYXI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIXRoaXNDaGFyQ29ycmVjdCkge1xuICAgICAgICAgICAgVGVzdElucHV0LmNvcnJlY3RlZC5jdXJyZW50ID1cbiAgICAgICAgICAgICAgICBUZXN0SW5wdXQuY29ycmVjdGVkLmN1cnJlbnQuc3Vic3RyaW5nKDAsIGNoYXJJbmRleCkgK1xuICAgICAgICAgICAgICAgICAgICBjaGFyICtcbiAgICAgICAgICAgICAgICAgICAgVGVzdElucHV0LmNvcnJlY3RlZC5jdXJyZW50LnN1YnN0cmluZyhjaGFySW5kZXggKyAxKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBUZXN0SW5wdXQuaW5jcmVtZW50S2V5cHJlc3NDb3VudCgpO1xuICAgIFRlc3RJbnB1dC51cGRhdGVMYXN0S2V5cHJlc3MoKTtcbiAgICBUZXN0SW5wdXQucHVzaEtleXByZXNzV29yZChUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4KTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ICE9PSBcIm1hc3RlclwiICYmXG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQuc3RvcE9uRXJyb3IgPT0gXCJsZXR0ZXJcIiAmJlxuICAgICAgICAhdGhpc0NoYXJDb3JyZWN0KSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgUmVwbGF5LmFkZFJlcGxheUV2ZW50KHRoaXNDaGFyQ29ycmVjdCA/IFwiY29ycmVjdExldHRlclwiIDogXCJpbmNvcnJlY3RMZXR0ZXJcIiwgY2hhcik7XG4gICAgLy91cGRhdGUgdGhlIGFjdGl2ZSB3b3JkIHRvcCwgYnV0IG9ubHkgb25jZVxuICAgIGlmIChUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGggPT09IDEgJiZcbiAgICAgICAgVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleCA9PT0gMCkge1xuICAgICAgICBUZXN0VUkuc2V0QWN0aXZlV29yZFRvcCgoX2EgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3dvcmRzIC5hY3RpdmVcIikpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5vZmZzZXRUb3ApO1xuICAgIH1cbiAgICAvL21heCBsZW5ndGggb2YgdGhlIGlucHV0IGlzIDIwIHVubGVzcyBpbiB6ZW4gbW9kZSB0aGVuIGl0cyAzMFxuICAgIGlmICgoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInplblwiICYmIGNoYXJJbmRleCA8IDMwKSB8fFxuICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9PSBcInplblwiICYmXG4gICAgICAgICAgICBjaGFySW5kZXggPCBUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpLmxlbmd0aCArIDIwKSkge1xuICAgICAgICBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCA9IHJlc3VsdGluZ1dvcmQ7XG4gICAgfVxuICAgIGlmICghdGhpc0NoYXJDb3JyZWN0ICYmIGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSA9PSBcIm1hc3RlclwiKSB7XG4gICAgICAgIFRlc3RJbnB1dC5pbnB1dC5wdXNoSGlzdG9yeSgpO1xuICAgICAgICBUZXN0SW5wdXQuY29ycmVjdGVkLnB1c2hIaXN0b3J5KCk7XG4gICAgICAgIFRlc3RMb2dpYy5mYWlsKFwiZGlmZmljdWx0eVwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvL2tleW1hcFxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmtleW1hcE1vZGUgPT09IFwicmVhY3RcIikge1xuICAgICAgICBLZXltYXAuZmxhc2hLZXkoY2hhciwgdGhpc0NoYXJDb3JyZWN0KTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPSBcInplblwiKSB7XG4gICAgICAgIC8vbm90IGFwcGxpY2FibGUgdG8gemVuIG1vZGVcbiAgICAgICAgLy9hdXRvIHN0b3AgdGhlIHRlc3QgaWYgdGhlIGxhc3Qgd29yZCBpcyBjb3JyZWN0XG4gICAgICAgIGNvbnN0IGN1cnJlbnRXb3JkID0gVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKTtcbiAgICAgICAgY29uc3QgbGFzdGluZGV4ID0gVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleDtcbiAgICAgICAgaWYgKChjdXJyZW50V29yZCA9PSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQucXVpY2tFbmQgJiZcbiAgICAgICAgICAgICAgICBjdXJyZW50V29yZC5sZW5ndGggPT0gVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoICYmXG4gICAgICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5zdG9wT25FcnJvciA9PSBcIm9mZlwiKSkgJiZcbiAgICAgICAgICAgIGxhc3RpbmRleCA9PSBUZXN0V29yZHMud29yZHMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgVGVzdElucHV0LmlucHV0LnB1c2hIaXN0b3J5KCk7XG4gICAgICAgICAgICBUZXN0SW5wdXQuY29ycmVjdGVkLnB1c2hIaXN0b3J5KCk7XG4gICAgICAgICAgICBUZXN0TG9naWMuZmluaXNoKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgYWN0aXZlV29yZFRvcEJlZm9yZUp1bXAgPSAoX2IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3dvcmRzIC53b3JkLmFjdGl2ZVwiKSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLm9mZnNldFRvcDtcbiAgICBUZXN0VUkudXBkYXRlV29yZEVsZW1lbnQoKTtcbiAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuaGlkZUV4dHJhTGV0dGVycykge1xuICAgICAgICBjb25zdCBuZXdBY3RpdmVUb3AgPSAoX2MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3dvcmRzIC53b3JkLmFjdGl2ZVwiKSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLm9mZnNldFRvcDtcbiAgICAgICAgLy9zdG9wIHRoZSB3b3JkIGp1bXAgYnkgc2xpY2luZyBvZmYgdGhlIGxhc3QgY2hhcmFjdGVyLCB1cGRhdGUgd29yZCBhZ2FpblxuICAgICAgICBpZiAoYWN0aXZlV29yZFRvcEJlZm9yZUp1bXAgPCBuZXdBY3RpdmVUb3AgJiZcbiAgICAgICAgICAgICFUZXN0VUkubGluZVRyYW5zaXRpb24gJiZcbiAgICAgICAgICAgIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIikge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRUb3AgPSBNYXRoLmZsb29yKChfZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIjd29yZHMgLndvcmRcIilbVGVzdFVJLmN1cnJlbnRXb3JkRWxlbWVudEluZGV4IC0gMV0pID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5vZmZzZXRUb3ApO1xuICAgICAgICAgICAgICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5zaG93QWxsTGluZXMpXG4gICAgICAgICAgICAgICAgICAgIFRlc3RVSS5saW5lSnVtcChjdXJyZW50VG9wKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50ID0gVGVzdElucHV0LmlucHV0LmN1cnJlbnQuc2xpY2UoMCwgLTEpO1xuICAgICAgICAgICAgICAgIFRlc3RVSS51cGRhdGVXb3JkRWxlbWVudCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8vc2ltdWxhdGUgc3BhY2UgcHJlc3MgaW4gbm9zcGFjZSBmdW5ib3hcbiAgICBpZiAoKChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJub3NwYWNlXCIgfHwgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwiYXJyb3dzXCIpICYmXG4gICAgICAgIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCA9PT0gVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKS5sZW5ndGgpIHx8XG4gICAgICAgIChjaGFyID09PSBcIlxcblwiICYmIHRoaXNDaGFyQ29ycmVjdCkpIHtcbiAgICAgICAgaGFuZGxlU3BhY2UoKTtcbiAgICB9XG4gICAgaWYgKGNoYXIgIT09IFwiXFxuXCIpIHtcbiAgICAgICAgQ2FyZXQudXBkYXRlUG9zaXRpb24oKTtcbiAgICB9XG59XG5mdW5jdGlvbiBoYW5kbGVUYWIoZXZlbnQsIHBvcHVwVmlzaWJsZSkge1xuICAgIC8vdG9kbyByZWZhY3RvciB0aGlzIG1lc3NcbiAgICBpZiAoVGVzdFVJLnJlc3VsdENhbGN1bGF0aW5nKSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICAgIGlmIChBY3RpdmVQYWdlLmdldCgpICE9PSBcInRlc3RcIiAmJiBwb3B1cFZpc2libGUpIHtcbiAgICAgICAgLy8gZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoJChcIiNjdXN0b21UZXh0UG9wdXAgLnRleHRhcmVhXCIpLmlzKFwiOmZvY3VzXCIpKSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNvbnN0IGFyZWEgPSAkKFwiI2N1c3RvbVRleHRQb3B1cCAudGV4dGFyZWFcIilbMF07XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gYXJlYS5zZWxlY3Rpb25TdGFydDtcbiAgICAgICAgY29uc3QgZW5kID0gYXJlYS5zZWxlY3Rpb25FbmQ7XG4gICAgICAgIC8vIHNldCB0ZXh0YXJlYSB2YWx1ZSB0bzogdGV4dCBiZWZvcmUgY2FyZXQgKyB0YWIgKyB0ZXh0IGFmdGVyIGNhcmV0XG4gICAgICAgIGFyZWEudmFsdWUgPVxuICAgICAgICAgICAgYXJlYS52YWx1ZS5zdWJzdHJpbmcoMCwgc3RhcnQpICsgXCJcXHRcIiArIGFyZWEudmFsdWUuc3Vic3RyaW5nKGVuZCk7XG4gICAgICAgIC8vIHB1dCBjYXJldCBhdCByaWdodCBwb3NpdGlvbiBhZ2FpblxuICAgICAgICBhcmVhLnNlbGVjdGlvblN0YXJ0ID0gYXJlYS5zZWxlY3Rpb25FbmQgPSBzdGFydCArIDE7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZWxzZSBpZiAoIVRlc3RVSS5yZXN1bHRDYWxjdWxhdGluZyAmJlxuICAgICAgICAkKFwiI2NvbW1hbmRMaW5lV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSAmJlxuICAgICAgICAkKFwiI3NpbXBsZVBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSAmJlxuICAgICAgICAkKFwiI3F1b3RlU3VibWl0UG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpICYmXG4gICAgICAgIEFjdGl2ZVBhZ2UuZ2V0KCkgIT0gXCJsb2dpblwiKSB7XG4gICAgICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09IFwidGVzdFwiKSB7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5xdWlja1RhYikge1xuICAgICAgICAgICAgICAgIGlmICghJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIExlYWRlcmJvYXJkcy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChwb3B1cFZpc2libGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoVGVzdFVJLnJlc3VsdFZpc2libGUgfHxcbiAgICAgICAgICAgICAgICAgICAgISgoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIgJiYgIWV2ZW50LnNoaWZ0S2V5KSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgKFRlc3RXb3Jkcy5oYXNUYWIgJiYgIWV2ZW50LnNoaWZ0S2V5KSkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgTWFudWFsUmVzdGFydC5yZXNldCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChUZXN0QWN0aXZlLmdldCgpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0LnJlcGVhdFF1b3RlcyA9PT0gXCJ0eXBpbmdcIiAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInF1b3RlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KHRydWUsIGZhbHNlLCBldmVudCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydChmYWxzZSwgZmFsc2UsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlQ2hhcihcIlxcdFwiLCBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICBzZXRXb3Jkc0lucHV0KFwiIFwiICsgVGVzdElucHV0LmlucHV0LmN1cnJlbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFUZXN0VUkucmVzdWx0VmlzaWJsZSkge1xuICAgICAgICAgICAgICAgIGlmICgoVGVzdFdvcmRzLmhhc1RhYiAmJiBldmVudC5zaGlmdEtleSkgfHxcbiAgICAgICAgICAgICAgICAgICAgKCFUZXN0V29yZHMuaGFzVGFiICYmIGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJ6ZW5cIikgfHxcbiAgICAgICAgICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ6ZW5cIiAmJiBldmVudC5zaGlmdEtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIiNyZXN0YXJ0VGVzdEJ1dHRvblwiKS50cmlnZ2VyKFwiZm9jdXNcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVDaGFyKFwiXFx0XCIsIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgIHNldFdvcmRzSW5wdXQoXCIgXCIgKyBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQucXVpY2tUYWIpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBQYWdlQ29udHJvbGxlci5jaGFuZ2UoXCJ0ZXN0XCIpO1xuICAgICAgICB9XG4gICAgfVxufVxuJChkb2N1bWVudCkua2V5ZG93bigoZXZlbnQpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAoQWN0aXZlUGFnZS5nZXQoKSA9PSBcImxvYWRpbmdcIilcbiAgICAgICAgcmV0dXJuIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgLy9hdXRvZm9jdXNcbiAgICBjb25zdCB3b3Jkc0ZvY3VzZWQgPSAkKFwiI3dvcmRzSW5wdXRcIikuaXMoXCI6Zm9jdXNcIik7XG4gICAgY29uc3QgcGFnZVRlc3RBY3RpdmUgPSBBY3RpdmVQYWdlLmdldCgpID09PSBcInRlc3RcIjtcbiAgICBjb25zdCBjb21tYW5kTGluZVZpc2libGUgPSAhJChcIiNjb21tYW5kTGluZVdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgY29uc3QgbGVhZGVyYm9hcmRzVmlzaWJsZSA9ICEkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgY29uc3QgcG9wdXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5wb3B1cFdyYXBwZXJcIik7XG4gICAgbGV0IHBvcHVwVmlzaWJsZSA9IGZhbHNlO1xuICAgIGZvciAoY29uc3QgcG9wdXAgb2YgcG9wdXBzKSB7XG4gICAgICAgIGlmICghcG9wdXAuY2xhc3NMaXN0LmNvbnRhaW5zKFwiaGlkZGVuXCIpID09PSB0cnVlKSB7XG4gICAgICAgICAgICBwb3B1cFZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgYWxsb3dUeXBpbmcgPSBwYWdlVGVzdEFjdGl2ZSAmJlxuICAgICAgICAhY29tbWFuZExpbmVWaXNpYmxlICYmXG4gICAgICAgICFsZWFkZXJib2FyZHNWaXNpYmxlICYmXG4gICAgICAgICFwb3B1cFZpc2libGUgJiZcbiAgICAgICAgIVRlc3RVSS5yZXN1bHRWaXNpYmxlICYmXG4gICAgICAgICh3b3Jkc0ZvY3VzZWQgfHwgZXZlbnQua2V5ICE9PSBcIkVudGVyXCIpO1xuICAgIGlmIChhbGxvd1R5cGluZyAmJiAhd29yZHNGb2N1c2VkICYmIGV2ZW50LmtleSAhPT0gXCJFbnRlclwiKSB7XG4gICAgICAgIFRlc3RVSS5mb2N1c1dvcmRzKCk7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnNob3dPdXRPZkZvY3VzV2FybmluZykge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvL3RhYlxuICAgIGlmICgoZXZlbnQua2V5ID09IFwiVGFiXCIgJiYgIWNvbmZpZ18xLmRlZmF1bHQuc3dhcEVzY0FuZFRhYikgfHxcbiAgICAgICAgKGV2ZW50LmtleSA9PSBcIkVzY2FwZVwiICYmIGNvbmZpZ18xLmRlZmF1bHQuc3dhcEVzY0FuZFRhYikpIHtcbiAgICAgICAgaGFuZGxlVGFiKGV2ZW50LCBwb3B1cFZpc2libGUpO1xuICAgIH1cbiAgICBpZiAoIWFsbG93VHlwaW5nKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKCEoKF9hID0gZXZlbnQub3JpZ2luYWxFdmVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlzVHJ1c3RlZCkgfHwgVGVzdFVJLnRlc3RSZXN0YXJ0aW5nKSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKFRlc3RJbnB1dC5zcGFjaW5nRGVidWcpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJzcGFjaW5nIGRlYnVnXCIsIFwia2V5cHJlc3NcIiwgZXZlbnQua2V5LCBcImxlbmd0aFwiLCBUZXN0SW5wdXQua2V5cHJlc3NUaW1pbmdzLnNwYWNpbmcuYXJyYXkubGVuZ3RoKTtcbiAgICB9XG4gICAgVGVzdElucHV0LnJlY29yZEtleXByZXNzU3BhY2luZygpO1xuICAgIFRlc3RJbnB1dC5zZXRLZXlwcmVzc0R1cmF0aW9uKHBlcmZvcm1hbmNlLm5vdygpKTtcbiAgICBUZXN0SW5wdXQuc2V0S2V5cHJlc3NOb3RBZmsoKTtcbiAgICAvL2Jsb2NraW5nIGZpcmVmb3ggZnJvbSBnb2luZyBiYWNrIGluIGhpc3Rvcnkgd2l0aCBiYWNrc3BhY2VcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkJhY2tzcGFjZVwiKSB7XG4gICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgICAgICBjb25zdCB0ID0gL0lOUFVUfFNFTEVDVHxURVhUQVJFQS9pO1xuICAgICAgICBpZiAoIXQudGVzdChldmVudC50YXJnZXQudGFnTmFtZSlcbiAgICAgICAgLy8gaWYgdGhpcyBicmVha3MgaW4gdGhlIGZ1dHVyZSwgY2FsbCBtaW8gYW5kIHRlbGwgaGltIHRvIHN0b3AgYmVpbmcgbGF6eVxuICAgICAgICAvLyAoZXZlbnQudGFyZ2V0IGFzIHVua25vd24gYXMgS2V5Ym9hcmRFdmVudCkuZGlzYWJsZWQgfHxcbiAgICAgICAgLy8gKGV2ZW50LnRhcmdldCBhcyB1bmtub3duIGFzIEVsZW1lbnQpLnJlYWRPbmx5XG4gICAgICAgICkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5jb25maWRlbmNlTW9kZSA9PT0gXCJtYXhcIikge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggIT09IFwiYXJyb3dzXCIgJiYgL0Fycm93L2kudGVzdChldmVudC5rZXkpKSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgTW9ua2V5LnR5cGUoKTtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkJhY2tzcGFjZVwiICYmIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBiYWNrc3BhY2VUb1ByZXZpb3VzKCk7XG4gICAgICAgIGlmIChUZXN0SW5wdXQuaW5wdXQuY3VycmVudCkge1xuICAgICAgICAgICAgc2V0V29yZHNJbnB1dChcIiBcIiArIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50ICsgXCIgXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChldmVudC5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICBpZiAoZXZlbnQuc2hpZnRLZXkgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIpIHtcbiAgICAgICAgICAgIFRlc3RMb2dpYy5maW5pc2goKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChldmVudC5zaGlmdEtleSAmJlxuICAgICAgICAgICAgKChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ0aW1lXCIgJiYgY29uZmlnXzEuZGVmYXVsdC50aW1lID09PSAwKSB8fFxuICAgICAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ3b3Jkc1wiICYmIGNvbmZpZ18xLmRlZmF1bHQud29yZHMgPT09IDApKSkge1xuICAgICAgICAgICAgVGVzdElucHV0LnNldEJhaWxvdXQodHJ1ZSk7XG4gICAgICAgICAgICBUZXN0TG9naWMuZmluaXNoKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBoYW5kbGVDaGFyKFwiXFxuXCIsIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCk7XG4gICAgICAgICAgICBzZXRXb3Jkc0lucHV0KFwiIFwiICsgVGVzdElucHV0LmlucHV0LmN1cnJlbnQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vc2hvdyBkZWFkIGtleXNcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkRlYWRcIiAmJlxuICAgICAgICAhTWlzYy50cmFpbGluZ0NvbXBvc2VDaGFycy50ZXN0KFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50KSkge1xuICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICAgICAgY29uc3Qgd29yZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjd29yZHMgLndvcmQuYWN0aXZlXCIpO1xuICAgICAgICBjb25zdCBsZW4gPSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGg7IC8vIGhhdmUgdG8gZG8gdGhpcyBiZWNhdXNlIHByZXR0aWVyIHdyYXBzIHRoZSBsaW5lIGFuZCBjYXVzZXMgYW4gZXJyb3JcbiAgICAgICAgd29yZCA9PT0gbnVsbCB8fCB3b3JkID09PSB2b2lkIDAgPyB2b2lkIDAgOiB3b3JkLnF1ZXJ5U2VsZWN0b3JBbGwoXCJsZXR0ZXJcIilbbGVuXS5jbGFzc0xpc3QudG9nZ2xlKFwiZGVhZFwiKTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQub3Bwb3NpdGVTaGlmdE1vZGUgIT09IFwib2ZmXCIpIHtcbiAgICAgICAgY29ycmVjdFNoaWZ0VXNlZCA9XG4gICAgICAgICAgICAoeWllbGQgU2hpZnRUcmFja2VyLmlzVXNpbmdPcHBvc2l0ZVNoaWZ0KGV2ZW50KSkgIT09IGZhbHNlO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwiYXJyb3dzXCIpIHtcbiAgICAgICAgbGV0IGNoYXIgPSBldmVudC5rZXk7XG4gICAgICAgIGlmIChbXCJBcnJvd0xlZnRcIiwgXCJBcnJvd1VwXCIsIFwiQXJyb3dSaWdodFwiLCBcIkFycm93RG93blwiXS5pbmNsdWRlcyhjaGFyKSkge1xuICAgICAgICAgICAgaWYgKGNoYXIgPT09IFwiQXJyb3dMZWZ0XCIpXG4gICAgICAgICAgICAgICAgY2hhciA9IFwiYVwiO1xuICAgICAgICAgICAgaWYgKGNoYXIgPT09IFwiQXJyb3dSaWdodFwiKVxuICAgICAgICAgICAgICAgIGNoYXIgPSBcImRcIjtcbiAgICAgICAgICAgIGlmIChjaGFyID09PSBcIkFycm93RG93blwiKVxuICAgICAgICAgICAgICAgIGNoYXIgPSBcInNcIjtcbiAgICAgICAgICAgIGlmIChjaGFyID09PSBcIkFycm93VXBcIilcbiAgICAgICAgICAgICAgICBjaGFyID0gXCJ3XCI7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgaGFuZGxlQ2hhcihjaGFyLCBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGgpO1xuICAgICAgICAgICAgdXBkYXRlVUkoKTtcbiAgICAgICAgICAgIHNldFdvcmRzSW5wdXQoXCIgXCIgKyBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5sYXlvdXQgIT09IFwiZGVmYXVsdFwiICYmXG4gICAgICAgICEoZXZlbnQuY3RybEtleSB8fFxuICAgICAgICAgICAgKGV2ZW50LmFsdEtleSAmJiB3aW5kb3cubmF2aWdhdG9yLnBsYXRmb3JtLnNlYXJjaChcIkxpbnV4XCIpID4gLTEpKSkge1xuICAgICAgICBjb25zdCBjaGFyID0geWllbGQgTGF5b3V0RW11bGF0b3IuZ2V0Q2hhckZyb21FdmVudChldmVudCk7XG4gICAgICAgIGlmIChjaGFyICE9PSBudWxsKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgaGFuZGxlQ2hhcihjaGFyLCBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGgpO1xuICAgICAgICAgICAgdXBkYXRlVUkoKTtcbiAgICAgICAgICAgIHNldFdvcmRzSW5wdXQoXCIgXCIgKyBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCk7XG4gICAgICAgIH1cbiAgICB9XG59KSk7XG4kKFwiI3dvcmRzSW5wdXRcIikua2V5dXAoKGV2ZW50KSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGlmICghKChfYSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc1RydXN0ZWQpIHx8IFRlc3RVSS50ZXN0UmVzdGFydGluZykge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChUZXN0VUkucmVzdWx0VmlzaWJsZSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IG5vdyA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIGlmIChUZXN0SW5wdXQua2V5cHJlc3NUaW1pbmdzLmR1cmF0aW9uLmN1cnJlbnQgIT09IC0xKSB7XG4gICAgICAgIGNvbnN0IGRpZmYgPSBNYXRoLmFicyhUZXN0SW5wdXQua2V5cHJlc3NUaW1pbmdzLmR1cmF0aW9uLmN1cnJlbnQgLSBub3cpO1xuICAgICAgICBUZXN0SW5wdXQucHVzaEtleXByZXNzRHVyYXRpb24oZGlmZik7XG4gICAgfVxuICAgIFRlc3RJbnB1dC5zZXRLZXlwcmVzc0R1cmF0aW9uKG5vdyk7XG4gICAgTW9ua2V5LnN0b3AoKTtcbn0pO1xuJChcIiN3b3Jkc0lucHV0XCIpLm9uKFwiYmVmb3JlaW5wdXRcIiwgKGV2ZW50KSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGlmICghKChfYSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc1RydXN0ZWQpKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKGV2ZW50LnRhcmdldC52YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICBldmVudC50YXJnZXQudmFsdWUgPSBcIiBcIjtcbiAgICB9XG59KTtcbiQoXCIjd29yZHNJbnB1dFwiKS5vbihcImlucHV0XCIsIChldmVudCkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBpZiAoISgoX2EgPSBldmVudC5vcmlnaW5hbEV2ZW50KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaXNUcnVzdGVkKSB8fCBUZXN0VUkudGVzdFJlc3RhcnRpbmcpIHtcbiAgICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gXCIgXCI7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgVGVzdElucHV0LnNldEtleXByZXNzTm90QWZrKCk7XG4gICAgY29uc3QgcmVhbElucHV0VmFsdWUgPSBldmVudC50YXJnZXQudmFsdWUubm9ybWFsaXplKCk7XG4gICAgY29uc3QgaW5wdXRWYWx1ZSA9IHJlYWxJbnB1dFZhbHVlLnNsaWNlKDEpO1xuICAgIC8vIGlucHV0IHdpbGwgYmUgbW9kaWZpZWQgZXZlbiB3aXRoIHRoZSBwcmV2ZW50RGVmYXVsdCgpIGluXG4gICAgLy8gYmVmb3JlaW5wdXQva2V5ZG93biBpZiBpdCdzIHBhcnQgb2YgYSBjb21wb3NlIHNlcXVlbmNlLiB0aGlzIHVuZG9lc1xuICAgIC8vIHRoZSBlZmZlY3RzIG9mIHRoYXQgYW5kIHRha2VzIHRoZSBpbnB1dCBvdXQgb2YgY29tcG9zZSBtb2RlLlxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmxheW91dCAhPT0gXCJkZWZhdWx0XCIgJiZcbiAgICAgICAgaW5wdXRWYWx1ZS5sZW5ndGggPj0gVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoKSB7XG4gICAgICAgIHNldFdvcmRzSW5wdXQoXCIgXCIgKyBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHJlYWxJbnB1dFZhbHVlLmxlbmd0aCA9PT0gMCAmJiBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgLy8gZmFsbGJhY2sgZm9yIHdoZW4gbm8gQmFja3NwYWNlIGtleWRvd24gZXZlbnQgKG1vYmlsZSlcbiAgICAgICAgYmFja3NwYWNlVG9QcmV2aW91cygpO1xuICAgIH1cbiAgICBlbHNlIGlmIChpbnB1dFZhbHVlLmxlbmd0aCA8IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCkge1xuICAgICAgICBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCA9IGlucHV0VmFsdWU7XG4gICAgICAgIFRlc3RVSS51cGRhdGVXb3JkRWxlbWVudCgpO1xuICAgICAgICBDYXJldC51cGRhdGVQb3NpdGlvbigpO1xuICAgICAgICBpZiAoIU1pc2MudHJhaWxpbmdDb21wb3NlQ2hhcnMudGVzdChUZXN0SW5wdXQuaW5wdXQuY3VycmVudCkpIHtcbiAgICAgICAgICAgIFJlcGxheS5hZGRSZXBsYXlFdmVudChcInNldExldHRlckluZGV4XCIsIFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoaW5wdXRWYWx1ZSAhPT0gVGVzdElucHV0LmlucHV0LmN1cnJlbnQpIHtcbiAgICAgICAgbGV0IGRpZmZTdGFydCA9IDA7XG4gICAgICAgIHdoaWxlIChpbnB1dFZhbHVlW2RpZmZTdGFydF0gPT09IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50W2RpZmZTdGFydF0pIHtcbiAgICAgICAgICAgIGRpZmZTdGFydCsrO1xuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGkgPSBkaWZmU3RhcnQ7IGkgPCBpbnB1dFZhbHVlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBoYW5kbGVDaGFyKGlucHV0VmFsdWVbaV0sIGkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNldFdvcmRzSW5wdXQoXCIgXCIgKyBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCk7XG4gICAgdXBkYXRlVUkoKTtcbiAgICAvLyBmb3JjZSBjYXJldCBhdCBlbmQgb2YgaW5wdXRcbiAgICAvLyBkb2luZyBpdCBvbiBuZXh0IGN5Y2xlIGJlY2F1c2UgQ2hyb21pdW0gb24gQW5kcm9pZCB3b24ndCBsZXQgbWUgZWRpdFxuICAgIC8vIHRoZSBzZWxlY3Rpb24gaW5zaWRlIHRoZSBpbnB1dCBldmVudFxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmIChldmVudC50YXJnZXQuc2VsZWN0aW9uU3RhcnQgIT09XG4gICAgICAgICAgICBldmVudC50YXJnZXQudmFsdWUubGVuZ3RoICYmXG4gICAgICAgICAgICAoIU1pc2MudHJhaWxpbmdDb21wb3NlQ2hhcnMudGVzdChldmVudC50YXJnZXQudmFsdWUpIHx8XG4gICAgICAgICAgICAgICAgKChfYSA9IGV2ZW50LnRhcmdldC5zZWxlY3Rpb25TdGFydCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogMCkgPFxuICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQudmFsdWUuc2VhcmNoKE1pc2MudHJhaWxpbmdDb21wb3NlQ2hhcnMpKSkge1xuICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnNlbGVjdGlvblN0YXJ0ID0gZXZlbnQudGFyZ2V0LnNlbGVjdGlvbkVuZCA9IGV2ZW50LnRhcmdldC52YWx1ZS5sZW5ndGg7XG4gICAgICAgIH1cbiAgICB9LCAwKTtcbn0pO1xuJChcIiN3b3Jkc0lucHV0XCIpLm9uKFwiZm9jdXNcIiwgKGV2ZW50KSA9PiB7XG4gICAgZXZlbnQudGFyZ2V0LnNlbGVjdGlvblN0YXJ0ID0gZXZlbnQudGFyZ2V0LnNlbGVjdGlvbkVuZCA9IGV2ZW50LnRhcmdldC52YWx1ZS5sZW5ndGg7XG59KTtcbiQoXCIjd29yZHNJbnB1dFwiKS5vbihcImNvcHkgcGFzdGVcIiwgKGV2ZW50KSA9PiB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5jaGFuZ2UgPSB2b2lkIDA7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IEFjdGl2ZVBhZ2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9hY3RpdmUtcGFnZVwiKSk7XG5jb25zdCBTZXR0aW5ncyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcGFnZXMvc2V0dGluZ3NcIikpO1xuY29uc3QgQWNjb3VudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcGFnZXMvYWNjb3VudFwiKSk7XG5jb25zdCBNYW51YWxSZXN0YXJ0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L21hbnVhbC1yZXN0YXJ0LXRyYWNrZXJcIikpO1xuY29uc3QgUGFnZVRlc3QgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BhZ2VzL3Rlc3RcIikpO1xuY29uc3QgUGFnZUFib3V0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wYWdlcy9hYm91dFwiKSk7XG5jb25zdCBQYWdlQ2hhbmdlRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL3BhZ2UtY2hhbmdlLWV2ZW50XCIpKTtcbmNvbnN0IFBhZ2VMb2dpbiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcGFnZXMvbG9naW5cIikpO1xuY29uc3QgUGFnZUxvYWRpbmcgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BhZ2VzL2xvYWRpbmdcIikpO1xuY29uc3QgUGFnZVRyYW5zaXRpb24gPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9wYWdlLXRyYW5zaXRpb25cIikpO1xuZnVuY3Rpb24gY2hhbmdlKHBhZ2UpIHtcbiAgICBpZiAoUGFnZVRyYW5zaXRpb24uZ2V0KCkpIHtcbiAgICAgICAgY29uc29sZS5sb2coYGNoYW5nZSBwYWdlICR7cGFnZX0gc3RvcHBlZGApO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKGBjaGFuZ2UgcGFnZSAke3BhZ2V9YCk7XG4gICAgaWYgKHBhZ2UgPT09IFwiXCIpXG4gICAgICAgIHBhZ2UgPSBcInRlc3RcIjtcbiAgICBpZiAocGFnZSA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgLy91c2Ugd2luZG93IGxvYWNhdGlvblxuICAgICAgICBjb25zdCBwYWdlcyA9IHtcbiAgICAgICAgICAgIFwiL1wiOiBcInRlc3RcIixcbiAgICAgICAgICAgIFwiL2xvZ2luXCI6IFwibG9naW5cIixcbiAgICAgICAgICAgIFwiL3NldHRpbmdzXCI6IFwic2V0dGluZ3NcIixcbiAgICAgICAgICAgIFwiL2Fib3V0XCI6IFwiYWJvdXRcIixcbiAgICAgICAgICAgIFwiL2FjY291bnRcIjogXCJhY2NvdW50XCIsXG4gICAgICAgIH07XG4gICAgICAgIGxldCBwYXRoID0gcGFnZXNbd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lXTtcbiAgICAgICAgaWYgKCFwYXRoKSB7XG4gICAgICAgICAgICBwYXRoID0gXCJ0ZXN0XCI7XG4gICAgICAgIH1cbiAgICAgICAgcGFnZSA9IHBhdGg7XG4gICAgfVxuICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09PSBwYWdlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBwYWdlICR7cGFnZX0gYWxyZWFkeSBhY3RpdmVgKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBwYWdlcyA9IHtcbiAgICAgICAgbG9hZGluZzogUGFnZUxvYWRpbmcucGFnZSxcbiAgICAgICAgdGVzdDogUGFnZVRlc3QucGFnZSxcbiAgICAgICAgc2V0dGluZ3M6IFNldHRpbmdzLnBhZ2UsXG4gICAgICAgIGFib3V0OiBQYWdlQWJvdXQucGFnZSxcbiAgICAgICAgYWNjb3VudDogQWNjb3VudC5wYWdlLFxuICAgICAgICBsb2dpbjogUGFnZUxvZ2luLnBhZ2UsXG4gICAgfTtcbiAgICBjb25zdCBwcmV2aW91c1BhZ2UgPSBwYWdlc1tBY3RpdmVQYWdlLmdldCgpXTtcbiAgICBjb25zdCBuZXh0UGFnZSA9IHBhZ2VzW3BhZ2VdO1xuICAgIHByZXZpb3VzUGFnZSA9PT0gbnVsbCB8fCBwcmV2aW91c1BhZ2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHByZXZpb3VzUGFnZS5iZWZvcmVIaWRlKCk7XG4gICAgUGFnZVRyYW5zaXRpb24uc2V0KHRydWUpO1xuICAgIEFjdGl2ZVBhZ2Uuc2V0KHVuZGVmaW5lZCk7XG4gICAgJChcIi5wYWdlXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgIE1pc2Muc3dhcEVsZW1lbnRzKHByZXZpb3VzUGFnZS5lbGVtZW50LCBuZXh0UGFnZS5lbGVtZW50LCAyNTAsICgpID0+IHtcbiAgICAgICAgUGFnZVRyYW5zaXRpb24uc2V0KGZhbHNlKTtcbiAgICAgICAgQWN0aXZlUGFnZS5zZXQobmV4dFBhZ2UubmFtZSk7XG4gICAgICAgIHByZXZpb3VzUGFnZSA9PT0gbnVsbCB8fCBwcmV2aW91c1BhZ2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHByZXZpb3VzUGFnZS5hZnRlckhpZGUoKTtcbiAgICAgICAgbmV4dFBhZ2UuZWxlbWVudC5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgaGlzdG9yeS5wdXNoU3RhdGUobmV4dFBhZ2UucGF0aG5hbWUsIFwiXCIsIG5leHRQYWdlLnBhdGhuYW1lKTtcbiAgICAgICAgbmV4dFBhZ2UgPT09IG51bGwgfHwgbmV4dFBhZ2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5leHRQYWdlLmFmdGVyU2hvdygpO1xuICAgIH0sICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgeWllbGQgKG5leHRQYWdlID09PSBudWxsIHx8IG5leHRQYWdlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuZXh0UGFnZS5iZWZvcmVTaG93KCkpO1xuICAgIH0pKTtcbiAgICBQYWdlQ2hhbmdlRXZlbnQuZGlzcGF0Y2gocHJldmlvdXNQYWdlLCBuZXh0UGFnZSk7XG59XG5leHBvcnRzLmNoYW5nZSA9IGNoYW5nZTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjdG9wIC5sb2dvXCIsICgpID0+IHtcbiAgICBjaGFuZ2UoXCJ0ZXN0XCIpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3RvcCAjbWVudSAuaWNvbi1idXR0b25cIiwgKGUpID0+IHtcbiAgICBpZiAoISQoZS5jdXJyZW50VGFyZ2V0KS5oYXNDbGFzcyhcImxlYWRlcmJvYXJkc1wiKSkge1xuICAgICAgICBjb25zdCBocmVmID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJocmVmXCIpO1xuICAgICAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgICAgICBjaGFuZ2UoaHJlZi5yZXBsYWNlKFwiL1wiLCBcIlwiKSk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn0pO1xuJChcIi5wYWdlVGVzdCAubG9naW5UaXAgLmxpbmtcIikub24oXCJjbGlja1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBjaGFuZ2UoXCJsb2dpblwiKTtcbn0pKTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmFwcGx5ID0gdm9pZCAwO1xuY29uc3QgVXBkYXRlQ29uZmlnID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgVGVzdExvZ2ljID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtbG9naWNcIikpO1xuY29uc3QgVGFnQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90YWctY29udHJvbGxlclwiKSk7XG5mdW5jdGlvbiBhcHBseShfaWQpIHtcbiAgICB2YXIgX2E7XG4gICAgLy8gY29uc29sZS5sb2coREIuZ2V0U25hcHNob3QoKS5wcmVzZXRzKTtcbiAgICBjb25zdCBzbmFwc2hvdCA9IERCLmdldFNuYXBzaG90KCk7XG4gICAgKF9hID0gc25hcHNob3QucHJlc2V0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHByZXNldCkgPT4ge1xuICAgICAgICBpZiAocHJlc2V0Ll9pZCA9PSBfaWQpIHtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5hcHBseShwcmVzZXQuY29uZmlnKTtcbiAgICAgICAgICAgIFRhZ0NvbnRyb2xsZXIuY2xlYXIodHJ1ZSk7XG4gICAgICAgICAgICBpZiAocHJlc2V0LmNvbmZpZy50YWdzKSB7XG4gICAgICAgICAgICAgICAgcHJlc2V0LmNvbmZpZy50YWdzLmZvckVhY2goKHRhZ2lkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIFRhZ0NvbnRyb2xsZXIuc2V0KHRhZ2lkLCB0cnVlLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJQcmVzZXQgYXBwbGllZFwiLCAxLCAyKTtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zYXZlRnVsbENvbmZpZ1RvTG9jYWxTdG9yYWdlKCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuYXBwbHkgPSBhcHBseTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBtaXNjXzEgPSByZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKTtcbmNvbnN0IGNvbmZpZ19ldmVudF8xID0gcmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKTtcbmNvbnN0IGRlZmF1bHRRdW90ZUNvbGxlY3Rpb24gPSB7XG4gICAgcXVvdGVzOiBbXSxcbiAgICBsZW5ndGg6IDAsXG4gICAgbGFuZ3VhZ2U6IG51bGwsXG4gICAgZ3JvdXBzOiBbXSxcbn07XG5jbGFzcyBRdW90ZXNDb250cm9sbGVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5xdW90ZUNvbGxlY3Rpb24gPSBkZWZhdWx0UXVvdGVDb2xsZWN0aW9uO1xuICAgICAgICB0aGlzLnF1b3RlUXVldWUgPSBbXTtcbiAgICAgICAgdGhpcy5xdWV1ZUluZGV4ID0gMDtcbiAgICB9XG4gICAgZ2V0UXVvdGVzKGxhbmd1YWdlLCBxdW90ZUxlbmd0aHMpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRMYW5ndWFnZSA9IGxhbmd1YWdlLnJlcGxhY2UoL19cXGQqayQvZywgXCJcIik7XG4gICAgICAgICAgICBpZiAodGhpcy5xdW90ZUNvbGxlY3Rpb24ubGFuZ3VhZ2UgIT09IG5vcm1hbGl6ZWRMYW5ndWFnZSkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB5aWVsZCAkLmdldEpTT04oYHF1b3Rlcy8ke25vcm1hbGl6ZWRMYW5ndWFnZX0uanNvbmApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5xdW90ZXMgPT09IHVuZGVmaW5lZCB8fCBkYXRhLnF1b3Rlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZhdWx0UXVvdGVDb2xsZWN0aW9uO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucXVvdGVDb2xsZWN0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcXVvdGVzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aDogZGF0YS5xdW90ZXMubGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlOiBkYXRhLmxhbmd1YWdlLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAvLyBUcmFuc2Zvcm0gSlNPTiBRdW90ZSBzY2hlbWEgdG8gTW9ua2V5VHlwZXMgUXVvdGUgc2NoZW1hXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucXVvdGVzLmZvckVhY2goKHF1b3RlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtb25rZXlUeXBlUXVvdGUgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogcXVvdGUudGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2U6IHF1b3RlLnNvdXJjZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGg6IHF1b3RlLmxlbmd0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogcXVvdGUuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IGRhdGEubGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXA6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5xdW90ZUNvbGxlY3Rpb24ucXVvdGVzLnB1c2gobW9ua2V5VHlwZVF1b3RlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZ3JvdXBzLmZvckVhY2goKHF1b3RlR3JvdXAsIGdyb3VwSW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvd2VyID0gcXVvdGVHcm91cFswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwcGVyID0gcXVvdGVHcm91cFsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucXVvdGVDb2xsZWN0aW9uLmdyb3Vwc1tncm91cEluZGV4XSA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5xdW90ZUNvbGxlY3Rpb24ucXVvdGVzLmZpbHRlcigocXVvdGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHF1b3RlLmxlbmd0aCA+PSBsb3dlciAmJiBxdW90ZS5sZW5ndGggPD0gdXBwZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1b3RlLmdyb3VwID0gZ3JvdXBJbmRleDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChxdW90ZUxlbmd0aHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVRdW90ZVF1ZXVlKHF1b3RlTGVuZ3Rocyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKF9hKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZhdWx0UXVvdGVDb2xsZWN0aW9uO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLnF1b3RlQ29sbGVjdGlvbjtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldFF1b3RlQnlJZChpZCkge1xuICAgICAgICBjb25zdCB0YXJnZXRRdW90ZSA9IHRoaXMucXVvdGVDb2xsZWN0aW9uLnF1b3Rlcy5maW5kKChxdW90ZSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHF1b3RlLmlkID09PSBpZDtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0YXJnZXRRdW90ZTtcbiAgICB9XG4gICAgdXBkYXRlUXVvdGVRdWV1ZShxdW90ZUdyb3Vwcykge1xuICAgICAgICB0aGlzLnF1b3RlUXVldWUgPSBbXTtcbiAgICAgICAgcXVvdGVHcm91cHMuZm9yRWFjaCgoZ3JvdXApID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIGlmIChncm91cCA8IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAoX2EgPSB0aGlzLnF1b3RlQ29sbGVjdGlvbi5ncm91cHNbZ3JvdXBdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgocXVvdGUpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnF1b3RlUXVldWUucHVzaChxdW90ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgICgwLCBtaXNjXzEuc2h1ZmZsZSkodGhpcy5xdW90ZVF1ZXVlKTtcbiAgICAgICAgdGhpcy5xdWV1ZUluZGV4ID0gMDtcbiAgICB9XG4gICAgZ2V0UmFuZG9tUXVvdGUoKSB7XG4gICAgICAgIGlmICh0aGlzLnF1b3RlUXVldWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5xdWV1ZUluZGV4ID49IHRoaXMucXVvdGVRdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMucXVldWVJbmRleCA9IDA7XG4gICAgICAgICAgICAoMCwgbWlzY18xLnNodWZmbGUpKHRoaXMucXVvdGVRdWV1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmFuZG9tUXVvdGUgPSB0aGlzLnF1b3RlUXVldWVbdGhpcy5xdWV1ZUluZGV4XTtcbiAgICAgICAgdGhpcy5xdWV1ZUluZGV4ICs9IDE7XG4gICAgICAgIHJldHVybiByYW5kb21RdW90ZTtcbiAgICB9XG4gICAgZ2V0Q3VycmVudFF1b3RlKCkge1xuICAgICAgICBpZiAodGhpcy5xdW90ZVF1ZXVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMucXVvdGVRdWV1ZVt0aGlzLnF1ZXVlSW5kZXhdO1xuICAgIH1cbn1cbmNvbnN0IHF1b3RlQ29udHJvbGxlciA9IG5ldyBRdW90ZXNDb250cm9sbGVyKCk7XG4oMCwgY29uZmlnX2V2ZW50XzEuc3Vic2NyaWJlKSgoa2V5LCBuZXdWYWx1ZSkgPT4ge1xuICAgIGlmIChrZXkgPT09IFwicXVvdGVMZW5ndGhcIikge1xuICAgICAgICBxdW90ZUNvbnRyb2xsZXIudXBkYXRlUXVvdGVRdWV1ZShuZXdWYWx1ZSk7XG4gICAgfVxufSk7XG5leHBvcnRzLmRlZmF1bHQgPSBxdW90ZUNvbnRyb2xsZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5oYW5kbGVJbml0aWFsUGFnZUNsYXNzZXMgPSB2b2lkIDA7XG4vLyBpbXBvcnQgKiBhcyBGdW5ib3ggZnJvbSBcIi4uL3Rlc3QvZnVuYm94XCI7XG5jb25zdCBQYWdlQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9wYWdlLWNvbnRyb2xsZXJcIikpO1xuLy8gaW1wb3J0IENvbmZpZyBmcm9tIFwiLi4vY29uZmlnXCI7XG5jb25zdCBBY3RpdmVQYWdlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvYWN0aXZlLXBhZ2VcIikpO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuLi9maXJlYmFzZVwiKTtcbmNvbnN0IG1hcHBlZFJvdXRlcyA9IHtcbiAgICBcIi9cIjogXCJwYWdlTG9hZGluZ1wiLFxuICAgIFwiL2xvZ2luXCI6IFwicGFnZUxvYWRpbmdcIixcbiAgICBcIi9zZXR0aW5nc1wiOiBcInBhZ2VMb2FkaW5nXCIsXG4gICAgXCIvYWJvdXRcIjogXCJwYWdlTG9hZGluZ1wiLFxuICAgIFwiL2FjY291bnRcIjogXCJwYWdlQWNjb3VudFwiLFxuICAgIFwiL3ZlcmlmeVwiOiBcInBhZ2VMb2FkaW5nXCIsXG59O1xuZnVuY3Rpb24gaGFuZGxlSW5pdGlhbFBhZ2VDbGFzc2VzKHBhdGhuYW1lKSB7XG4gICAgaWYgKCFtYXBwZWRSb3V0ZXNbcGF0aG5hbWVdKSB7XG4gICAgICAgIHBhdGhuYW1lID0gXCIvXCI7XG4gICAgfVxuICAgIGNvbnN0IGVsID0gJChcIi5wYWdlLlwiICsgbWFwcGVkUm91dGVzW3BhdGhuYW1lXSk7XG4gICAgJChlbCkucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgJChlbCkuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgbGV0IHBhZ2VOYW1lID0gXCJsb2FkaW5nXCI7XG4gICAgaWYgKHBhdGhuYW1lID09PSBcIi9hY2NvdW50XCIpXG4gICAgICAgIHBhZ2VOYW1lID0gXCJhY2NvdW50XCI7XG4gICAgQWN0aXZlUGFnZS5zZXQocGFnZU5hbWUpO1xufVxuZXhwb3J0cy5oYW5kbGVJbml0aWFsUGFnZUNsYXNzZXMgPSBoYW5kbGVJbml0aWFsUGFnZUNsYXNzZXM7XG4vLyBob25lc3RseSBpbSBub3Qgc3VyZSB3aGF0IHRoaXMgZG9lc1xuLy8gKGZ1bmN0aW9uIChoaXN0b3J5KTogdm9pZCB7XG4vLyAgIGNvbnN0IHB1c2hTdGF0ZSA9IGhpc3RvcnkucHVzaFN0YXRlO1xuLy8gICBoaXN0b3J5LnB1c2hTdGF0ZSA9IGZ1bmN0aW9uIChzdGF0ZSk6IHZvaWQge1xuLy8gICAgIGlmIChDb25maWcuZnVuYm94ID09PSBcIm1lbW9yeVwiICYmIHN0YXRlICE9PSBcIi9cIikge1xuLy8gICAgICAgRnVuYm94LnJlc2V0TWVtb3J5VGltZXIoKTtcbi8vICAgICB9XG4vLyAgICAgLy8gQHRzLWlnbm9yZVxuLy8gICAgIHJldHVybiBwdXNoU3RhdGUuYXBwbHkoaGlzdG9yeSwgYXJndW1lbnRzKTtcbi8vICAgfTtcbi8vIH0pKHdpbmRvdy5oaXN0b3J5KTtcbiQod2luZG93KS5vbihcInBvcHN0YXRlXCIsIChlKSA9PiB7XG4gICAgY29uc3Qgc3RhdGUgPSBlLm9yaWdpbmFsRXZlbnQuc3RhdGU7XG4gICAgaWYgKHN0YXRlID09IFwiXCIgfHwgc3RhdGUgPT0gXCIvXCIpIHtcbiAgICAgICAgLy8gc2hvdyB0ZXN0XG4gICAgICAgIFBhZ2VDb250cm9sbGVyLmNoYW5nZShcInRlc3RcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKHN0YXRlID09IFwiYWJvdXRcIikge1xuICAgICAgICAvLyBzaG93IGFib3V0XG4gICAgICAgIFBhZ2VDb250cm9sbGVyLmNoYW5nZShcImFib3V0XCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChzdGF0ZSA9PSBcImFjY291bnRcIiB8fCBzdGF0ZSA9PSBcImxvZ2luXCIpIHtcbiAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcikge1xuICAgICAgICAgICAgUGFnZUNvbnRyb2xsZXIuY2hhbmdlKFwiYWNjb3VudFwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIFBhZ2VDb250cm9sbGVyLmNoYW5nZShcImxvZ2luXCIpO1xuICAgICAgICB9XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zZXRWb2x1bWUgPSBleHBvcnRzLnBsYXlFcnJvciA9IGV4cG9ydHMucGxheUNsaWNrID0gZXhwb3J0cy5wcmV2aWV3Q2xpY2sgPSBleHBvcnRzLmluaXQgPSBleHBvcnRzLmluaXRFcnJvclNvdW5kID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBob3dsZXJfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiaG93bGVyXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuY29uc3QgbWlzY18xID0gcmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIik7XG5sZXQgZXJyb3JTb3VuZCA9IG51bGw7XG5sZXQgY2xpY2tTb3VuZHMgPSBudWxsO1xuZnVuY3Rpb24gaW5pdEVycm9yU291bmQoKSB7XG4gICAgaWYgKGVycm9yU291bmQgIT09IG51bGwpXG4gICAgICAgIHJldHVybjtcbiAgICBlcnJvclNvdW5kID0gbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFtcIi4uL3NvdW5kL2Vycm9yLndhdlwiXSB9KTtcbn1cbmV4cG9ydHMuaW5pdEVycm9yU291bmQgPSBpbml0RXJyb3JTb3VuZDtcbmZ1bmN0aW9uIGluaXQoKSB7XG4gICAgaWYgKGNsaWNrU291bmRzICE9PSBudWxsKVxuICAgICAgICByZXR1cm47XG4gICAgY2xpY2tTb3VuZHMgPSB7XG4gICAgICAgIDE6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2sxL2NsaWNrMV8xLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazEvY2xpY2sxXzEud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2sxL2NsaWNrMV8yLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazEvY2xpY2sxXzIud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2sxL2NsaWNrMV8zLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazEvY2xpY2sxXzMud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgMjogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazIvY2xpY2syXzEud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMi9jbGljazJfMS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazIvY2xpY2syXzIud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMi9jbGljazJfMi53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazIvY2xpY2syXzMud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMi9jbGljazJfMy53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICAzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMy9jbGljazNfMS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2szL2NsaWNrM18xLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMy9jbGljazNfMi53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2szL2NsaWNrM18yLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrMy9jbGljazNfMy53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2szL2NsaWNrM18zLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIDQ6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s0L2NsaWNrNF8xLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazQvY2xpY2s0XzExLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNC9jbGljazRfMi53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s0L2NsaWNrNF8yMi53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazQvY2xpY2s0XzMud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNC9jbGljazRfMzMud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s0L2NsaWNrNF80LndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazQvY2xpY2s0XzQ0LndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNC9jbGljazRfNS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s0L2NsaWNrNF81NS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazQvY2xpY2s0XzYud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNC9jbGljazRfNjYud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgNTogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazUvY2xpY2s1XzEud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNS9jbGljazVfMTEud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s1L2NsaWNrNV8yLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazUvY2xpY2s1XzIyLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNS9jbGljazVfMy53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s1L2NsaWNrNV8zMy53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazUvY2xpY2s1XzQud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNS9jbGljazVfNDQud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s1L2NsaWNrNV81LndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazUvY2xpY2s1XzU1LndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNS9jbGljazVfNi53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s1L2NsaWNrNV82Ni53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICA2OiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNi9jbGljazZfMS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s2L2NsaWNrNl8xMS53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazYvY2xpY2s2XzIud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNi9jbGljazZfMjIud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s2L2NsaWNrNl8zLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazYvY2xpY2s2XzMzLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIDc6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VuZHM6IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s3L2NsaWNrN18xLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazcvY2xpY2s3XzExLndhdlwiIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgY291bnRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc291bmRzOiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNy9jbGljazdfMi53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGhvd2xlcl8xLkhvd2woeyBzcmM6IFwiLi4vc291bmQvY2xpY2s3L2NsaWNrN18yMi53YXZcIiB9KSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNvdW5kczogW1xuICAgICAgICAgICAgICAgICAgICBuZXcgaG93bGVyXzEuSG93bCh7IHNyYzogXCIuLi9zb3VuZC9jbGljazcvY2xpY2s3XzMud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBob3dsZXJfMS5Ib3dsKHsgc3JjOiBcIi4uL3NvdW5kL2NsaWNrNy9jbGljazdfMzMud2F2XCIgfSksXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICB9O1xufVxuZXhwb3J0cy5pbml0ID0gaW5pdDtcbmZ1bmN0aW9uIHByZXZpZXdDbGljayh2YWwpIHtcbiAgICBpZiAoY2xpY2tTb3VuZHMgPT09IG51bGwpXG4gICAgICAgIGluaXQoKTtcbiAgICBjbGlja1NvdW5kc1t2YWxdWzBdLnNvdW5kc1swXS5zZWVrKDApO1xuICAgIGNsaWNrU291bmRzW3ZhbF1bMF0uc291bmRzWzBdLnBsYXkoKTtcbn1cbmV4cG9ydHMucHJldmlld0NsaWNrID0gcHJldmlld0NsaWNrO1xuZnVuY3Rpb24gcGxheUNsaWNrKCkge1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnBsYXlTb3VuZE9uQ2xpY2sgPT09IFwib2ZmXCIpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoY2xpY2tTb3VuZHMgPT09IG51bGwpXG4gICAgICAgIGluaXQoKTtcbiAgICBjb25zdCByYW5kb21Tb3VuZCA9ICgwLCBtaXNjXzEucmFuZG9tRWxlbWVudEZyb21BcnJheSkoY2xpY2tTb3VuZHNbY29uZmlnXzEuZGVmYXVsdC5wbGF5U291bmRPbkNsaWNrXSk7XG4gICAgcmFuZG9tU291bmQuY291bnRlcisrO1xuICAgIGlmIChyYW5kb21Tb3VuZC5jb3VudGVyID09PSAyKVxuICAgICAgICByYW5kb21Tb3VuZC5jb3VudGVyID0gMDtcbiAgICByYW5kb21Tb3VuZC5zb3VuZHNbcmFuZG9tU291bmQuY291bnRlcl0uc2VlaygwKTtcbiAgICByYW5kb21Tb3VuZC5zb3VuZHNbcmFuZG9tU291bmQuY291bnRlcl0ucGxheSgpO1xufVxuZXhwb3J0cy5wbGF5Q2xpY2sgPSBwbGF5Q2xpY2s7XG5mdW5jdGlvbiBwbGF5RXJyb3IoKSB7XG4gICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LnBsYXlTb3VuZE9uRXJyb3IpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoZXJyb3JTb3VuZCA9PT0gbnVsbClcbiAgICAgICAgaW5pdEVycm9yU291bmQoKTtcbiAgICBlcnJvclNvdW5kLnNlZWsoMCk7XG4gICAgZXJyb3JTb3VuZC5wbGF5KCk7XG59XG5leHBvcnRzLnBsYXlFcnJvciA9IHBsYXlFcnJvcjtcbmZ1bmN0aW9uIHNldFZvbHVtZSh2YWwpIHtcbiAgICAvLyBub3Qgc3VyZSB3aHkgaXQgY29tcGxhaW5zIGJ1dCBpdCB3b3Jrc1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBob3dsZXJfMS5kZWZhdWx0Lkhvd2xlci52b2x1bWUodmFsKTtcbn1cbmV4cG9ydHMuc2V0Vm9sdW1lID0gc2V0Vm9sdW1lO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSwgZXZlbnRWYWx1ZSkgPT4ge1xuICAgIGlmIChldmVudEtleSA9PT0gXCJwbGF5U291bmRPbkNsaWNrXCIgJiYgZXZlbnRWYWx1ZSAhPT0gXCJvZmZcIilcbiAgICAgICAgaW5pdCgpO1xuICAgIGlmIChldmVudEtleSA9PT0gXCJzb3VuZFZvbHVtZVwiKVxuICAgICAgICBzZXRWb2x1bWUoZXZlbnRWYWx1ZSk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmxvYWRBY3RpdmVGcm9tTG9jYWxTdG9yYWdlID0gZXhwb3J0cy50b2dnbGUgPSBleHBvcnRzLnNldCA9IGV4cG9ydHMuY2xlYXIgPSBleHBvcnRzLnNhdmVBY3RpdmVUb0xvY2FsU3RvcmFnZSA9IHZvaWQgMDtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBNb2Rlc05vdGljZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbW9kZXMtbm90aWNlXCIpKTtcbmZ1bmN0aW9uIHNhdmVBY3RpdmVUb0xvY2FsU3RvcmFnZSgpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgdGFncyA9IFtdO1xuICAgIHRyeSB7XG4gICAgICAgIChfYSA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgaWYgKHRhZy5hY3RpdmUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB0YWdzLnB1c2godGFnLl9pZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJhY3RpdmVUYWdzXCIsIEpTT04uc3RyaW5naWZ5KHRhZ3MpKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHsgfVxufVxuZXhwb3J0cy5zYXZlQWN0aXZlVG9Mb2NhbFN0b3JhZ2UgPSBzYXZlQWN0aXZlVG9Mb2NhbFN0b3JhZ2U7XG5mdW5jdGlvbiBjbGVhcihub3NhdmUgPSBmYWxzZSkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBzbmFwc2hvdCA9IERCLmdldFNuYXBzaG90KCk7XG4gICAgc25hcHNob3QudGFncyA9IChfYSA9IHNuYXBzaG90LnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tYXAoKHRhZykgPT4ge1xuICAgICAgICB0YWcuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgIHJldHVybiB0YWc7XG4gICAgfSk7XG4gICAgREIuc2V0U25hcHNob3Qoc25hcHNob3QpO1xuICAgIE1vZGVzTm90aWNlLnVwZGF0ZSgpO1xuICAgIGlmICghbm9zYXZlKVxuICAgICAgICBzYXZlQWN0aXZlVG9Mb2NhbFN0b3JhZ2UoKTtcbn1cbmV4cG9ydHMuY2xlYXIgPSBjbGVhcjtcbmZ1bmN0aW9uIHNldCh0YWdpZCwgc3RhdGUsIG5vc2F2ZSA9IGZhbHNlKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHNuYXBzaG90ID0gREIuZ2V0U25hcHNob3QoKTtcbiAgICBzbmFwc2hvdC50YWdzID0gKF9hID0gc25hcHNob3QudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1hcCgodGFnKSA9PiB7XG4gICAgICAgIGlmICh0YWcuX2lkID09PSB0YWdpZCkge1xuICAgICAgICAgICAgdGFnLmFjdGl2ZSA9IHN0YXRlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0YWc7XG4gICAgfSk7XG4gICAgREIuc2V0U25hcHNob3Qoc25hcHNob3QpO1xuICAgIE1vZGVzTm90aWNlLnVwZGF0ZSgpO1xuICAgIGlmICghbm9zYXZlKVxuICAgICAgICBzYXZlQWN0aXZlVG9Mb2NhbFN0b3JhZ2UoKTtcbn1cbmV4cG9ydHMuc2V0ID0gc2V0O1xuZnVuY3Rpb24gdG9nZ2xlKHRhZ2lkLCBub3NhdmUgPSBmYWxzZSkge1xuICAgIHZhciBfYTtcbiAgICAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgaWYgKHRhZy5faWQgPT09IHRhZ2lkKSB7XG4gICAgICAgICAgICBpZiAodGFnLmFjdGl2ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGFnLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0YWcuYWN0aXZlID0gIXRhZy5hY3RpdmU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBNb2Rlc05vdGljZS51cGRhdGUoKTtcbiAgICBpZiAoIW5vc2F2ZSlcbiAgICAgICAgc2F2ZUFjdGl2ZVRvTG9jYWxTdG9yYWdlKCk7XG59XG5leHBvcnRzLnRvZ2dsZSA9IHRvZ2dsZTtcbmZ1bmN0aW9uIGxvYWRBY3RpdmVGcm9tTG9jYWxTdG9yYWdlKCkge1xuICAgIHZhciBfYTtcbiAgICBsZXQgbmV3VGFncyA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImFjdGl2ZVRhZ3NcIik7XG4gICAgaWYgKG5ld1RhZ3MgIT0gdW5kZWZpbmVkICYmIG5ld1RhZ3MgIT09IFwiXCIpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG5ld1RhZ3MgPSAoX2EgPSBKU09OLnBhcnNlKG5ld1RhZ3MpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgbmV3VGFncyA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIG5ld1RhZ3MuZm9yRWFjaCgobnRhZykgPT4ge1xuICAgICAgICAgICAgdG9nZ2xlKG50YWcsIHRydWUpO1xuICAgICAgICB9KTtcbiAgICAgICAgc2F2ZUFjdGl2ZVRvTG9jYWxTdG9yYWdlKCk7XG4gICAgfVxufVxuZXhwb3J0cy5sb2FkQWN0aXZlRnJvbUxvY2FsU3RvcmFnZSA9IGxvYWRBY3RpdmVGcm9tTG9jYWxTdG9yYWdlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9hLCBfYjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuYXBwbHlDdXN0b21CYWNrZ3JvdW5kID0gZXhwb3J0cy5hcHBseUN1c3RvbUJhY2tncm91bmRTaXplID0gZXhwb3J0cy5jbGVhclJhbmRvbSA9IGV4cG9ydHMucmFuZG9taXplVGhlbWUgPSBleHBvcnRzLmNsZWFyUHJldmlldyA9IGV4cG9ydHMuc2V0ID0gZXhwb3J0cy5wcmV2aWV3ID0gZXhwb3J0cy5jb2xvclZhcnMgPSBleHBvcnRzLnJhbmRvbVRoZW1lID0gdm9pZCAwO1xuY29uc3QgVGhlbWVDb2xvcnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL3RoZW1lLWNvbG9yc1wiKSk7XG5jb25zdCBDaGFydENvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY2hhcnQtY29udHJvbGxlclwiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpLCBVcGRhdGVDb25maWcgPSBjb25maWdfMTtcbmNvbnN0IEJhY2tncm91bmRGaWx0ZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2N1c3RvbS1iYWNrZ3JvdW5kLWZpbHRlclwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IEFuYWx5dGljc0NvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL2FuYWx5dGljcy1jb250cm9sbGVyXCIpKTtcbmxldCBpc1ByZXZpZXdpbmdUaGVtZSA9IGZhbHNlO1xuZXhwb3J0cy5yYW5kb21UaGVtZSA9IG51bGw7XG5leHBvcnRzLmNvbG9yVmFycyA9IFtcbiAgICBcIi0tYmctY29sb3JcIixcbiAgICBcIi0tbWFpbi1jb2xvclwiLFxuICAgIFwiLS1jYXJldC1jb2xvclwiLFxuICAgIFwiLS1zdWItY29sb3JcIixcbiAgICBcIi0tdGV4dC1jb2xvclwiLFxuICAgIFwiLS1lcnJvci1jb2xvclwiLFxuICAgIFwiLS1lcnJvci1leHRyYS1jb2xvclwiLFxuICAgIFwiLS1jb2xvcmZ1bC1lcnJvci1jb2xvclwiLFxuICAgIFwiLS1jb2xvcmZ1bC1lcnJvci1leHRyYS1jb2xvclwiLFxuXTtcbmZ1bmN0aW9uIHVwZGF0ZUZhdmljb24oc2l6ZSwgY3VydmVTaXplKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBsZXQgbWFpbmNvbG9yLCBiZ2NvbG9yO1xuICAgICAgICAgICAgYmdjb2xvciA9IHlpZWxkIFRoZW1lQ29sb3JzLmdldChcImJnXCIpO1xuICAgICAgICAgICAgbWFpbmNvbG9yID0geWllbGQgVGhlbWVDb2xvcnMuZ2V0KFwibWFpblwiKTtcbiAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgPT09IFwibG9jYWxob3N0XCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzd2FwID0gbWFpbmNvbG9yO1xuICAgICAgICAgICAgICAgIG1haW5jb2xvciA9IGJnY29sb3I7XG4gICAgICAgICAgICAgICAgYmdjb2xvciA9IHN3YXA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYmdjb2xvciA9PSBtYWluY29sb3IpIHtcbiAgICAgICAgICAgICAgICBiZ2NvbG9yID0gXCIjMTExXCI7XG4gICAgICAgICAgICAgICAgbWFpbmNvbG9yID0gXCIjZWVlXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgICAgICAgICAgY2FudmFzLndpZHRoID0gc2l6ZTtcbiAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBzaXplO1xuICAgICAgICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgIGN0eC5tb3ZlVG8oMCwgY3VydmVTaXplKTtcbiAgICAgICAgICAgIC8vdG9wIGxlZnRcbiAgICAgICAgICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKDAsIDAsIGN1cnZlU2l6ZSwgMCk7XG4gICAgICAgICAgICBjdHgubGluZVRvKHNpemUgLSBjdXJ2ZVNpemUsIDApO1xuICAgICAgICAgICAgLy90b3AgcmlnaHRcbiAgICAgICAgICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKHNpemUsIDAsIHNpemUsIGN1cnZlU2l6ZSk7XG4gICAgICAgICAgICBjdHgubGluZVRvKHNpemUsIHNpemUgLSBjdXJ2ZVNpemUpO1xuICAgICAgICAgICAgY3R4LnF1YWRyYXRpY0N1cnZlVG8oc2l6ZSwgc2l6ZSwgc2l6ZSAtIGN1cnZlU2l6ZSwgc2l6ZSk7XG4gICAgICAgICAgICBjdHgubGluZVRvKGN1cnZlU2l6ZSwgc2l6ZSk7XG4gICAgICAgICAgICBjdHgucXVhZHJhdGljQ3VydmVUbygwLCBzaXplLCAwLCBzaXplIC0gY3VydmVTaXplKTtcbiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBiZ2NvbG9yO1xuICAgICAgICAgICAgY3R4LmZpbGwoKTtcbiAgICAgICAgICAgIGN0eC5mb250ID0gXCI5MDAgXCIgKyAoc2l6ZSAvIDIpICogMS4yICsgXCJweCBMZXhlbmQgRGVjYVwiO1xuICAgICAgICAgICAgY3R4LnRleHRBbGlnbiA9IFwiY2VudGVyXCI7XG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gbWFpbmNvbG9yO1xuICAgICAgICAgICAgY3R4LmZpbGxUZXh0KFwibXRcIiwgc2l6ZSAvIDIgKyAxLCAoc2l6ZSAvIDMpICogMi4xKTtcbiAgICAgICAgICAgIC8vICQoXCJib2R5XCIpLnByZXBlbmQoY2FudmFzKTtcbiAgICAgICAgICAgICQoXCIjZmF2aWNvblwiKS5hdHRyKFwiaHJlZlwiLCBjYW52YXMudG9EYXRhVVJMKFwiaW1hZ2UvcG5nXCIpKTtcbiAgICAgICAgfSksIDEyNSk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBjbGVhckN1c3RvbVRoZW1lKCkge1xuICAgIGV4cG9ydHMuY29sb3JWYXJzLmZvckVhY2goKGUpID0+IHtcbiAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KGUsIFwiXCIpO1xuICAgIH0pO1xufVxuY29uc3QgbG9hZFN0eWxlID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlua1wiKTtcbiAgICAgICAgICAgIGxpbmsudHlwZSA9IFwidGV4dC9jc3NcIjtcbiAgICAgICAgICAgIGxpbmsucmVsID0gXCJzdHlsZXNoZWV0XCI7XG4gICAgICAgICAgICBsaW5rLmlkID0gXCJjdXJyZW50VGhlbWVcIjtcbiAgICAgICAgICAgIGxpbmsub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAobmFtZSA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICAgICAgICAgIGxpbmsuaHJlZiA9IGB0aGVtZXMvc2VyaWthX2RhcmsuY3NzYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxpbmsuaHJlZiA9IGB0aGVtZXMvJHtuYW1lfS5jc3NgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgaGVhZFNjcmlwdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY3VycmVudFRoZW1lXCIpO1xuICAgICAgICAgICAgaGVhZFNjcmlwdC5yZXBsYWNlV2l0aChsaW5rKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59O1xuLy8gZXhwb3J0IGZ1bmN0aW9uIGNoYW5nZUN1c3RvbVRoZW1lKHRoZW1lSWQ6IHN0cmluZywgbm9zYXZlID0gZmFsc2UpOiB2b2lkIHtcbi8vICAgY29uc3QgY3VzdG9tVGhlbWVzID0gREIuZ2V0U25hcHNob3QoKS5jdXN0b21UaGVtZXM7XG4vLyAgIGNvbnN0IGNvbG9ycyA9IGN1c3RvbVRoZW1lcy5maW5kKChlKSA9PiBlLl9pZCA9PT0gdGhlbWVJZClcbi8vICAgICA/LmNvbG9ycyBhcyBzdHJpbmdbXTtcbi8vICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lQ29sb3JzKGNvbG9ycywgbm9zYXZlKTtcbi8vIH1cbmZ1bmN0aW9uIGFwcGx5KHRoZW1lTmFtZSwgaXNDdXN0b20sIGlzUHJldmlldyA9IGZhbHNlKSB7XG4gICAgY2xlYXJDdXN0b21UaGVtZSgpO1xuICAgIGxldCBuYW1lID0gXCJzZXJpa2FfZGFya1wiO1xuICAgIGlmICghaXNDdXN0b20pIHtcbiAgICAgICAgbmFtZSA9IHRoZW1lTmFtZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG5hbWUgPSBcImN1c3RvbVwiO1xuICAgIH1cbiAgICBUaGVtZUNvbG9ycy5yZXNldCgpO1xuICAgICQoXCIua2V5bWFwLWtleVwiKS5hdHRyKFwic3R5bGVcIiwgXCJcIik7XG4gICAgLy8gJChcIiNjdXJyZW50VGhlbWVcIikuYXR0cihcImhyZWZcIiwgYHRoZW1lcy8ke25hbWV9LmNzc2ApO1xuICAgIGxvYWRTdHlsZShuYW1lKS50aGVuKCgpID0+IHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgVGhlbWVDb2xvcnMudXBkYXRlKCk7XG4gICAgICAgIGlmIChpc0N1c3RvbSkge1xuICAgICAgICAgICAgbGV0IGNvbG9yVmFsdWVzID0gY29uZmlnXzEuZGVmYXVsdC5jdXN0b21UaGVtZUNvbG9ycztcbiAgICAgICAgICAgIGNvbnN0IHNuYXBzaG90ID0gREIuZ2V0U25hcHNob3QoKTtcbiAgICAgICAgICAgIGlmIChpc0N1c3RvbSAmJiAhaXNQcmV2aWV3ICYmIHNuYXBzaG90KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VzdG9tQ29sb3JzID0gKF9iID0gKF9hID0gc25hcHNob3QuY3VzdG9tVGhlbWVzLmZpbmQoKGUpID0+IGUuX2lkID09PSB0aGVtZU5hbWUpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY29sb3JzKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBbXTtcbiAgICAgICAgICAgICAgICBpZiAoY3VzdG9tQ29sb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lQ29sb3JzKGN1c3RvbUNvbG9ycyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoZW1lTmFtZSAhPT0gXCJjdXN0b21cIiAmJiBzbmFwc2hvdCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1c3RvbVRoZW1lcyA9IHNuYXBzaG90LmN1c3RvbVRoZW1lcztcbiAgICAgICAgICAgICAgICBjb25zdCBjdXN0b21UaGVtZUJ5SWQgPSBjdXN0b21UaGVtZXMuZmluZCgoZSkgPT4gZS5faWQgPT09IHRoZW1lTmFtZSk7XG4gICAgICAgICAgICAgICAgY29sb3JWYWx1ZXMgPSBjdXN0b21UaGVtZUJ5SWQgPT09IG51bGwgfHwgY3VzdG9tVGhlbWVCeUlkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjdXN0b21UaGVtZUJ5SWQuY29sb3JzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZXhwb3J0cy5jb2xvclZhcnMuZm9yRWFjaCgoZSwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoZSwgY29sb3JWYWx1ZXNbaW5kZXhdKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIEFuYWx5dGljc0NvbnRyb2xsZXIubG9nKFwiY2hhbmdlZFRoZW1lXCIsIHsgdGhlbWU6IHRoZW1lTmFtZSB9KTtcbiAgICAgICAgaWYgKCFpc1ByZXZpZXcpIHtcbiAgICAgICAgICAgIFRoZW1lQ29sb3JzLmdldEFsbCgpLnRoZW4oKGNvbG9ycykgPT4ge1xuICAgICAgICAgICAgICAgICQoXCIua2V5bWFwLWtleVwiKS5hdHRyKFwic3R5bGVcIiwgXCJcIik7XG4gICAgICAgICAgICAgICAgQ2hhcnRDb250cm9sbGVyLnVwZGF0ZUFsbENoYXJ0Q29sb3JzKCk7XG4gICAgICAgICAgICAgICAgdXBkYXRlRmF2aWNvbigxMjgsIDMyKTtcbiAgICAgICAgICAgICAgICAkKFwiI21ldGFUaGVtZUNvbG9yXCIpLmF0dHIoXCJjb250ZW50XCIsIGNvbG9ycy5iZyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiLmN1cnJlbnQtdGhlbWUgLnRleHRcIikudGV4dChpc0N1c3RvbSA/IFwiY3VzdG9tXCIgOiB0aGVtZU5hbWUucmVwbGFjZSgvXy9nLCBcIiBcIikpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gcHJldmlldyh0aGVtZUlkZW50aWZpZXIsIGlzQ3VzdG9tLCByYW5kb21UaGVtZSA9IGZhbHNlKSB7XG4gICAgaXNQcmV2aWV3aW5nVGhlbWUgPSB0cnVlO1xuICAgIGFwcGx5KHRoZW1lSWRlbnRpZmllciwgaXNDdXN0b20sICFyYW5kb21UaGVtZSk7XG59XG5leHBvcnRzLnByZXZpZXcgPSBwcmV2aWV3O1xuZnVuY3Rpb24gc2V0KHRoZW1lSWRlbnRpZmllciwgaXNDdXN0b20pIHtcbiAgICBhcHBseSh0aGVtZUlkZW50aWZpZXIsIGlzQ3VzdG9tKTtcbn1cbmV4cG9ydHMuc2V0ID0gc2V0O1xuZnVuY3Rpb24gY2xlYXJQcmV2aWV3KCkge1xuICAgIGlmIChpc1ByZXZpZXdpbmdUaGVtZSkge1xuICAgICAgICBpc1ByZXZpZXdpbmdUaGVtZSA9IGZhbHNlO1xuICAgICAgICBleHBvcnRzLnJhbmRvbVRoZW1lID0gbnVsbDtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tVGhlbWUpIHtcbiAgICAgICAgICAgIGFwcGx5KFwiY3VzdG9tXCIsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYXBwbHkoY29uZmlnXzEuZGVmYXVsdC50aGVtZSwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5jbGVhclByZXZpZXcgPSBjbGVhclByZXZpZXc7XG5mdW5jdGlvbiByYW5kb21pemVUaGVtZSgpIHtcbiAgICBsZXQgcmFuZG9tTGlzdDtcbiAgICBNaXNjLmdldFRoZW1lc0xpc3QoKS50aGVuKCh0aGVtZXMpID0+IHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucmFuZG9tVGhlbWUgPT09IFwiZmF2XCIgJiYgY29uZmlnXzEuZGVmYXVsdC5mYXZUaGVtZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmFuZG9tTGlzdCA9IGNvbmZpZ18xLmRlZmF1bHQuZmF2VGhlbWVzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQucmFuZG9tVGhlbWUgPT09IFwibGlnaHRcIikge1xuICAgICAgICAgICAgcmFuZG9tTGlzdCA9IHRoZW1lc1xuICAgICAgICAgICAgICAgIC5maWx0ZXIoKHQpID0+IE1pc2MuaXNDb2xvckxpZ2h0KHQuYmdDb2xvcikpXG4gICAgICAgICAgICAgICAgLm1hcCgodCkgPT4gdC5uYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LnJhbmRvbVRoZW1lID09PSBcImRhcmtcIikge1xuICAgICAgICAgICAgcmFuZG9tTGlzdCA9IHRoZW1lc1xuICAgICAgICAgICAgICAgIC5maWx0ZXIoKHQpID0+IE1pc2MuaXNDb2xvckRhcmsodC5iZ0NvbG9yKSlcbiAgICAgICAgICAgICAgICAubWFwKCh0KSA9PiB0Lm5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQucmFuZG9tVGhlbWUgPT09IFwib25cIikge1xuICAgICAgICAgICAgcmFuZG9tTGlzdCA9IHRoZW1lcy5tYXAoKHQpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdC5uYW1lO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByYW5kb21MaXN0ID0gREIuZ2V0U25hcHNob3QoKS5jdXN0b21UaGVtZXMubWFwKChjdCkgPT4gY3QuX2lkKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwcmV2aW91c1RoZW1lID0gZXhwb3J0cy5yYW5kb21UaGVtZTtcbiAgICAgICAgZXhwb3J0cy5yYW5kb21UaGVtZSA9IE1pc2MucmFuZG9tRWxlbWVudEZyb21BcnJheShyYW5kb21MaXN0KTtcbiAgICAgICAgLy8gaWYgKENvbmZpZy5yYW5kb21UaGVtZSA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICAvLyBjaGFuZ2VDdXN0b21UaGVtZShyYW5kb21UaGVtZSwgdHJ1ZSk7XG4gICAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAgIHByZXZpZXcoZXhwb3J0cy5yYW5kb21UaGVtZSwgY29uZmlnXzEuZGVmYXVsdC5yYW5kb21UaGVtZSA9PT0gXCJjdXN0b21cIik7XG4gICAgICAgIC8vIH1cbiAgICAgICAgaWYgKHByZXZpb3VzVGhlbWUgIT0gZXhwb3J0cy5yYW5kb21UaGVtZSkge1xuICAgICAgICAgICAgbGV0IG5hbWUgPSBleHBvcnRzLnJhbmRvbVRoZW1lLnJlcGxhY2UoL18vZywgXCIgXCIpO1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucmFuZG9tVGhlbWUgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgICAgICAgICBuYW1lID0gKChfYiA9IChfYSA9IERCLmdldFNuYXBzaG90KCkuY3VzdG9tVGhlbWVzLmZpbmQoKGN0KSA9PiBjdC5faWQgPT09IGV4cG9ydHMucmFuZG9tVGhlbWUpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubmFtZSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogXCJjdXN0b21cIikucmVwbGFjZSgvXy9nLCBcIiBcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChuYW1lLCAwKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5yYW5kb21pemVUaGVtZSA9IHJhbmRvbWl6ZVRoZW1lO1xuZnVuY3Rpb24gY2xlYXJSYW5kb20oKSB7XG4gICAgaWYgKGV4cG9ydHMucmFuZG9tVGhlbWUgPT09IG51bGwpXG4gICAgICAgIHJldHVybjtcbiAgICBleHBvcnRzLnJhbmRvbVRoZW1lID0gbnVsbDtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5jdXN0b21UaGVtZSkge1xuICAgICAgICBhcHBseShcImN1c3RvbVwiLCB0cnVlKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGFwcGx5KGNvbmZpZ18xLmRlZmF1bHQudGhlbWUsIGZhbHNlKTtcbiAgICB9XG59XG5leHBvcnRzLmNsZWFyUmFuZG9tID0gY2xlYXJSYW5kb207XG5mdW5jdGlvbiBhcHBseUN1c3RvbUJhY2tncm91bmRTaXplKCkge1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmN1c3RvbUJhY2tncm91bmRTaXplID09IFwibWF4XCIpIHtcbiAgICAgICAgJChcIi5jdXN0b21CYWNrZ3JvdW5kIGltZ1wiKS5jc3Moe1xuICAgICAgICAgICAgLy8gd2lkdGg6IFwiY2FsYygxMDAlKVwiLFxuICAgICAgICAgICAgLy8gaGVpZ2h0OiBcImNhbGMoMTAwJSlcIixcbiAgICAgICAgICAgIG9iamVjdEZpdDogXCJcIixcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiLmN1c3RvbUJhY2tncm91bmQgaW1nXCIpLmNzcyh7XG4gICAgICAgICAgICBvYmplY3RGaXQ6IGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tQmFja2dyb3VuZFNpemUsXG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuYXBwbHlDdXN0b21CYWNrZ3JvdW5kU2l6ZSA9IGFwcGx5Q3VzdG9tQmFja2dyb3VuZFNpemU7XG5mdW5jdGlvbiBhcHBseUN1c3RvbUJhY2tncm91bmQoKSB7XG4gICAgLy8gJChcIi5jdXN0b21CYWNrZ3JvdW5kXCIpLmNzcyh7XG4gICAgLy8gICBiYWNrZ3JvdW5kSW1hZ2U6IGB1cmwoJHtDb25maWcuY3VzdG9tQmFja2dyb3VuZH0pYCxcbiAgICAvLyAgIGJhY2tncm91bmRBdHRhY2htZW50OiBcImZpeGVkXCIsXG4gICAgLy8gfSk7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tQmFja2dyb3VuZCA9PT0gXCJcIikge1xuICAgICAgICAkKFwiI3dvcmRzXCIpLnJlbW92ZUNsYXNzKFwibm9FcnJvckJvcmRlclwiKTtcbiAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnlcIikucmVtb3ZlQ2xhc3MoXCJub0Vycm9yQm9yZGVyXCIpO1xuICAgICAgICAkKFwiLmN1c3RvbUJhY2tncm91bmQgaW1nXCIpLnJlbW92ZSgpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiN3b3Jkc1wiKS5hZGRDbGFzcyhcIm5vRXJyb3JCb3JkZXJcIik7XG4gICAgICAgICQoXCIjcmVzdWx0V29yZHNIaXN0b3J5XCIpLmFkZENsYXNzKFwibm9FcnJvckJvcmRlclwiKTtcbiAgICAgICAgJChcIi5jdXN0b21CYWNrZ3JvdW5kXCIpLmh0bWwoYDxpbWcgc3JjPVwiJHtjb25maWdfMS5kZWZhdWx0LmN1c3RvbUJhY2tncm91bmR9XCIgLz5gKTtcbiAgICAgICAgQmFja2dyb3VuZEZpbHRlci5hcHBseSgpO1xuICAgICAgICBhcHBseUN1c3RvbUJhY2tncm91bmRTaXplKCk7XG4gICAgfVxufVxuZXhwb3J0cy5hcHBseUN1c3RvbUJhY2tncm91bmQgPSBhcHBseUN1c3RvbUJhY2tncm91bmQ7XG4oX2IgPSAoX2EgPSB3aW5kb3dcbiAgICAubWF0Y2hNZWRpYSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNhbGwod2luZG93LCBcIihwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaylcIikpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIChldmVudCkgPT4ge1xuICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5hdXRvU3dpdGNoVGhlbWUgfHwgY29uZmlnXzEuZGVmYXVsdC5jdXN0b21UaGVtZSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChldmVudC5tYXRjaGVzKSB7XG4gICAgICAgIHNldChjb25maWdfMS5kZWZhdWx0LnRoZW1lRGFyaywgZmFsc2UpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgc2V0KGNvbmZpZ18xLmRlZmF1bHQudGhlbWVMaWdodCwgZmFsc2UpO1xuICAgIH1cbn0pO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSwgZXZlbnRWYWx1ZSwgbm9zYXZlKSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImN1c3RvbVRoZW1lXCIpIHtcbiAgICAgICAgZXZlbnRWYWx1ZSA/IHNldChcImN1c3RvbVwiLCB0cnVlKSA6IHNldChjb25maWdfMS5kZWZhdWx0LnRoZW1lLCBmYWxzZSk7XG4gICAgfVxuICAgIGlmIChldmVudEtleSA9PT0gXCJjdXN0b21UaGVtZUNvbG9yc1wiKSB7XG4gICAgICAgIG5vc2F2ZSA/IHByZXZpZXcoXCJjdXN0b21cIiwgdHJ1ZSkgOiBzZXQoXCJjdXN0b21cIiwgdHJ1ZSk7XG4gICAgfVxuICAgIGlmIChldmVudEtleSA9PT0gXCJ0aGVtZVwiKSB7XG4gICAgICAgIGNsZWFyUHJldmlldygpO1xuICAgICAgICBzZXQoZXZlbnRWYWx1ZSwgZmFsc2UpO1xuICAgIH1cbiAgICBpZiAoZXZlbnRLZXkgPT09IFwic2V0VGhlbWVzXCIpIHtcbiAgICAgICAgY2xlYXJQcmV2aWV3KCk7XG4gICAgICAgIGlmIChldmVudFZhbHVlKSB7XG4gICAgICAgICAgICBzZXQoXCJjdXN0b21cIiwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hdXRvU3dpdGNoVGhlbWUpIHtcbiAgICAgICAgICAgICAgICBpZiAod2luZG93Lm1hdGNoTWVkaWEgJiZcbiAgICAgICAgICAgICAgICAgICAgd2luZG93Lm1hdGNoTWVkaWEoXCIocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspXCIpLm1hdGNoZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0KGNvbmZpZ18xLmRlZmF1bHQudGhlbWVEYXJrLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZXQoY29uZmlnXzEuZGVmYXVsdC50aGVtZUxpZ2h0LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc2V0KGNvbmZpZ18xLmRlZmF1bHQudGhlbWUsIGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoZXZlbnRLZXkgPT09IFwicmFuZG9tVGhlbWVcIiAmJiBldmVudFZhbHVlID09PSBcIm9mZlwiKVxuICAgICAgICBjbGVhclJhbmRvbSgpO1xuICAgIGlmIChldmVudEtleSA9PT0gXCJjdXN0b21CYWNrZ3JvdW5kXCIpXG4gICAgICAgIGFwcGx5Q3VzdG9tQmFja2dyb3VuZCgpO1xuICAgIGlmIChldmVudEtleSA9PT0gXCJjdXN0b21CYWNrZ3JvdW5kU2l6ZVwiKVxuICAgICAgICBhcHBseUN1c3RvbUJhY2tncm91bmRTaXplKCk7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImF1dG9Td2l0Y2hUaGVtZVwiKSB7XG4gICAgICAgIGlmIChldmVudFZhbHVlKSB7XG4gICAgICAgICAgICBpZiAod2luZG93Lm1hdGNoTWVkaWEgJiZcbiAgICAgICAgICAgICAgICB3aW5kb3cubWF0Y2hNZWRpYShcIihwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaylcIikubWF0Y2hlcykge1xuICAgICAgICAgICAgICAgIHNldChjb25maWdfMS5kZWZhdWx0LnRoZW1lRGFyaywgZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc2V0KGNvbmZpZ18xLmRlZmF1bHQudGhlbWVMaWdodCwgZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc2V0KGNvbmZpZ18xLmRlZmF1bHQudGhlbWUsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoZXZlbnRLZXkgPT09IFwidGhlbWVMaWdodFwiICYmXG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQuYXV0b1N3aXRjaFRoZW1lICYmXG4gICAgICAgICEod2luZG93Lm1hdGNoTWVkaWEgJiZcbiAgICAgICAgICAgIHdpbmRvdy5tYXRjaE1lZGlhKFwiKHByZWZlcnMtY29sb3Itc2NoZW1lOiBkYXJrKVwiKS5tYXRjaGVzKSAmJlxuICAgICAgICAhbm9zYXZlKSB7XG4gICAgICAgIHNldChjb25maWdfMS5kZWZhdWx0LnRoZW1lTGlnaHQsIGZhbHNlKTtcbiAgICB9XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcInRoZW1lRGFya1wiICYmXG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQuYXV0b1N3aXRjaFRoZW1lICYmXG4gICAgICAgIHdpbmRvdy5tYXRjaE1lZGlhICYmXG4gICAgICAgIHdpbmRvdy5tYXRjaE1lZGlhKFwiKHByZWZlcnMtY29sb3Itc2NoZW1lOiBkYXJrKVwiKS5tYXRjaGVzICYmXG4gICAgICAgICFub3NhdmUpIHtcbiAgICAgICAgc2V0KGNvbmZpZ18xLmRlZmF1bHQudGhlbWVEYXJrLCBmYWxzZSk7XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnZlcmlmeSA9IGV4cG9ydHMuc2V0ID0gZXhwb3J0cy5kYXRhID0gdm9pZCAwO1xuY29uc3QgYXBlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2FwZVwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IFNldHRpbmdzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wYWdlcy9zZXR0aW5nc1wiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgTG9hZGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sb2FkZXJcIikpO1xuZXhwb3J0cy5kYXRhID0gbnVsbDtcbmZ1bmN0aW9uIHNldCh2YWwpIHtcbiAgICBleHBvcnRzLmRhdGEgPSB2YWw7XG59XG5leHBvcnRzLnNldCA9IHNldDtcbmZ1bmN0aW9uIHZlcmlmeSh1aWQpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoZXhwb3J0cy5kYXRhID09PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkxpbmtpbmcgRGlzY29yZCBhY2NvdW50XCIsIDAsIDMpO1xuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICBleHBvcnRzLmRhdGEudWlkID0gdWlkO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMubGlua0Rpc2NvcmQoZXhwb3J0cy5kYXRhKTtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gbGluayBEaXNjb3JkOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkFjY291bnRzIGxpbmtlZFwiLCAxKTtcbiAgICAgICAgY29uc3Qgc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdCgpO1xuICAgICAgICBzbmFwc2hvdC5kaXNjb3JkSWQgPSByZXNwb25zZS5kYXRhLmRpZDtcbiAgICAgICAgREIuc2V0U25hcHNob3Qoc25hcHNob3QpO1xuICAgICAgICBTZXR0aW5ncy51cGRhdGVEaXNjb3JkU2VjdGlvbigpO1xuICAgIH0pO1xufVxuZXhwb3J0cy52ZXJpZnkgPSB2ZXJpZnk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZUxvY2FsU3RhdHMgPSBleHBvcnRzLnNhdmVMb2NhbFJlc3VsdCA9IGV4cG9ydHMuc2F2ZUNvbmZpZyA9IGV4cG9ydHMudXBkYXRlTGJNZW1vcnkgPSBleHBvcnRzLnNhdmVMb2NhbFRhZ1BCID0gZXhwb3J0cy5nZXRMb2NhbFRhZ1BCID0gZXhwb3J0cy5zYXZlTG9jYWxQQiA9IGV4cG9ydHMuZ2V0TG9jYWxQQiA9IGV4cG9ydHMuZ2V0VXNlckF2ZXJhZ2UxMCA9IGV4cG9ydHMuZ2V0VXNlckhpZ2hlc3RXcG0gPSBleHBvcnRzLmRlbGV0ZUN1c3RvbVRoZW1lID0gZXhwb3J0cy5lZGl0Q3VzdG9tVGhlbWUgPSBleHBvcnRzLmFkZEN1c3RvbVRoZW1lID0gZXhwb3J0cy5nZXRDdXN0b21UaGVtZUJ5SWQgPSBleHBvcnRzLmdldFVzZXJSZXN1bHRzID0gZXhwb3J0cy5pbml0U25hcHNob3QgPSBleHBvcnRzLnNldFNuYXBzaG90ID0gZXhwb3J0cy5nZXRTbmFwc2hvdCA9IHZvaWQgMDtcbmNvbnN0IGFwZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL2FwZVwiKSk7XG5jb25zdCBBY2NvdW50QnV0dG9uID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2VsZW1lbnRzL2FjY291bnQtYnV0dG9uXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBMb2FkaW5nUGFnZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9wYWdlcy9sb2FkaW5nXCIpKTtcbmNvbnN0IGRlZmF1bHRfY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vY29uc3RhbnRzL2RlZmF1bHQtY29uZmlnXCIpKTtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi9maXJlYmFzZVwiKTtcbmNvbnN0IGRlZmF1bHRfc25hcHNob3RfMSA9IHJlcXVpcmUoXCIuL2NvbnN0YW50cy9kZWZhdWx0LXNuYXBzaG90XCIpO1xubGV0IGRiU25hcHNob3Q7XG5mdW5jdGlvbiBnZXRTbmFwc2hvdCgpIHtcbiAgICByZXR1cm4gZGJTbmFwc2hvdDtcbn1cbmV4cG9ydHMuZ2V0U25hcHNob3QgPSBnZXRTbmFwc2hvdDtcbmZ1bmN0aW9uIHNldFNuYXBzaG90KG5ld1NuYXBzaG90KSB7XG4gICAgdHJ5IHtcbiAgICAgICAgZGVsZXRlIG5ld1NuYXBzaG90LmJhbm5lZDtcbiAgICB9XG4gICAgY2F0Y2ggKF9hKSB7IH1cbiAgICB0cnkge1xuICAgICAgICBkZWxldGUgbmV3U25hcHNob3QudmVyaWZpZWQ7XG4gICAgfVxuICAgIGNhdGNoIChfYikgeyB9XG4gICAgZGJTbmFwc2hvdCA9IG5ld1NuYXBzaG90O1xufVxuZXhwb3J0cy5zZXRTbmFwc2hvdCA9IHNldFNuYXBzaG90O1xuZnVuY3Rpb24gaW5pdFNuYXBzaG90KCkge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2U7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgLy9zZW5kIGFwaSByZXF1ZXN0IHdpdGggdG9rZW4gdGhhdCByZXR1cm5zIHRhZ3MsIHByZXNldHMsIGFuZCBkYXRhIG5lZWRlZCBmb3Igc25hcFxuICAgICAgICBjb25zdCBzbmFwID0gZGVmYXVsdF9zbmFwc2hvdF8xLmRlZmF1bHRTbmFwO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciA9PSBudWxsKVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIC8vIGlmIChBY3RpdmVQYWdlLmdldCgpID09IFwibG9hZGluZ1wiKSB7XG4gICAgICAgICAgICAvLyAgIExvYWRpbmdQYWdlLnVwZGF0ZUJhcigyMi41KTtcbiAgICAgICAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyAgIExvYWRpbmdQYWdlLnVwZGF0ZUJhcigxNik7XG4gICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAvLyBMb2FkaW5nUGFnZS51cGRhdGVUZXh0KFwiRG93bmxvYWRpbmcgdXNlci4uLlwiKTtcbiAgICAgICAgICAgIGNvbnN0IFt1c2VyUmVzcG9uc2UsIGNvbmZpZ1Jlc3BvbnNlLCB0YWdzUmVzcG9uc2UsIHByZXNldHNSZXNwb25zZV0gPSB5aWVsZCBQcm9taXNlLmFsbChbXG4gICAgICAgICAgICAgICAgYXBlXzEuZGVmYXVsdC51c2Vycy5nZXREYXRhKCksXG4gICAgICAgICAgICAgICAgYXBlXzEuZGVmYXVsdC5jb25maWdzLmdldCgpLFxuICAgICAgICAgICAgICAgIGFwZV8xLmRlZmF1bHQudXNlcnMuZ2V0VGFncygpLFxuICAgICAgICAgICAgICAgIGFwZV8xLmRlZmF1bHQucHJlc2V0cy5nZXQoKSxcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgaWYgKHVzZXJSZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHRocm93IHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogYCR7dXNlclJlc3BvbnNlLm1lc3NhZ2V9ICh1c2VyKWAsXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlQ29kZTogdXNlclJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvbmZpZ1Jlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cge1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBgJHtjb25maWdSZXNwb25zZS5tZXNzYWdlfSAoY29uZmlnKWAsXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlQ29kZTogY29uZmlnUmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGFnc1Jlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cge1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBgJHt0YWdzUmVzcG9uc2UubWVzc2FnZX0gKHRhZ3MpYCxcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VDb2RlOiB0YWdzUmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocHJlc2V0c1Jlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cge1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBgJHtwcmVzZXRzUmVzcG9uc2UubWVzc2FnZX0gKHByZXNldHMpYCxcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VDb2RlOiBwcmVzZXRzUmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBbdXNlckRhdGEsIGNvbmZpZ0RhdGEsIHRhZ3NEYXRhLCBwcmVzZXRzRGF0YV0gPSBbXG4gICAgICAgICAgICAgICAgdXNlclJlc3BvbnNlLFxuICAgICAgICAgICAgICAgIGNvbmZpZ1Jlc3BvbnNlLFxuICAgICAgICAgICAgICAgIHRhZ3NSZXNwb25zZSxcbiAgICAgICAgICAgICAgICBwcmVzZXRzUmVzcG9uc2UsXG4gICAgICAgICAgICBdLm1hcCgocmVzcG9uc2UpID0+IHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgc25hcC5uYW1lID0gdXNlckRhdGEubmFtZTtcbiAgICAgICAgICAgIHNuYXAucGVyc29uYWxCZXN0cyA9IHVzZXJEYXRhLnBlcnNvbmFsQmVzdHM7XG4gICAgICAgICAgICBzbmFwLmJhbm5lZCA9IHVzZXJEYXRhLmJhbm5lZDtcbiAgICAgICAgICAgIHNuYXAudmVyaWZpZWQgPSB1c2VyRGF0YS52ZXJpZmllZDtcbiAgICAgICAgICAgIHNuYXAuZGlzY29yZElkID0gdXNlckRhdGEuZGlzY29yZElkO1xuICAgICAgICAgICAgc25hcC5nbG9iYWxTdGF0cyA9IHtcbiAgICAgICAgICAgICAgICB0aW1lOiB1c2VyRGF0YS50aW1lVHlwaW5nLFxuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IHVzZXJEYXRhLnN0YXJ0ZWRUZXN0cyxcbiAgICAgICAgICAgICAgICBjb21wbGV0ZWQ6IHVzZXJEYXRhLmNvbXBsZXRlZFRlc3RzLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmICh1c2VyRGF0YS5xdW90ZU1vZCA9PT0gdHJ1ZSlcbiAgICAgICAgICAgICAgICBzbmFwLnF1b3RlTW9kID0gdHJ1ZTtcbiAgICAgICAgICAgIHNuYXAucXVvdGVSYXRpbmdzID0gdXNlckRhdGEucXVvdGVSYXRpbmdzO1xuICAgICAgICAgICAgc25hcC5mYXZvdXJpdGVUaGVtZXMgPVxuICAgICAgICAgICAgICAgIHVzZXJEYXRhLmZhdm91cml0ZVRoZW1lcyA9PT0gdW5kZWZpbmVkID8gW10gOiB1c2VyRGF0YS5mYXZvdXJpdGVUaGVtZXM7XG4gICAgICAgICAgICBpZiAoKChfYSA9IHVzZXJEYXRhLmxiTWVtb3J5KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudGltZTE1KSB8fCAoKF9iID0gdXNlckRhdGEubGJNZW1vcnkpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50aW1lNjApKSB7XG4gICAgICAgICAgICAgICAgLy9vbGQgbWVtb3J5IGZvcm1hdFxuICAgICAgICAgICAgICAgIHNuYXAubGJNZW1vcnkgPSB7fTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHVzZXJEYXRhLmxiTWVtb3J5KSB7XG4gICAgICAgICAgICAgICAgc25hcC5sYk1lbW9yeSA9IHVzZXJEYXRhLmxiTWVtb3J5O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT0gXCJsb2FkaW5nXCIpIHtcbiAgICAgICAgICAgIC8vICAgTG9hZGluZ1BhZ2UudXBkYXRlQmFyKDQ1KTtcbiAgICAgICAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyAgIExvYWRpbmdQYWdlLnVwZGF0ZUJhcigzMik7XG4gICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAvLyBMb2FkaW5nUGFnZS51cGRhdGVUZXh0KFwiRG93bmxvYWRpbmcgY29uZmlnLi4uXCIpO1xuICAgICAgICAgICAgaWYgKGNvbmZpZ0RhdGEpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdDb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0X2NvbmZpZ18xLmRlZmF1bHQpO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIGNvbmZpZ0RhdGEuY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gY29uZmlnRGF0YS5jb25maWdba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgbmV3Q29uZmlnW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc25hcC5jb25maWcgPSBuZXdDb25maWc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBpZiAoQWN0aXZlUGFnZS5nZXQoKSA9PSBcImxvYWRpbmdcIikge1xuICAgICAgICAgICAgLy8gICBMb2FkaW5nUGFnZS51cGRhdGVCYXIoNjcuNSk7XG4gICAgICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gICBMb2FkaW5nUGFnZS51cGRhdGVCYXIoNDgpO1xuICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgLy8gTG9hZGluZ1BhZ2UudXBkYXRlVGV4dChcIkRvd25sb2FkaW5nIHRhZ3MuLi5cIik7XG4gICAgICAgICAgICBzbmFwLmN1c3RvbVRoZW1lcyA9IChfYyA9IHVzZXJEYXRhLmN1c3RvbVRoZW1lcykgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogW107XG4gICAgICAgICAgICBzbmFwLnRhZ3MgPSB0YWdzRGF0YTtcbiAgICAgICAgICAgIHNuYXAudGFncyA9IChfZCA9IHNuYXAudGFncykgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoYS5uYW1lID4gYi5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChhLm5hbWUgPCBiLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBpZiAoQWN0aXZlUGFnZS5nZXQoKSA9PSBcImxvYWRpbmdcIikge1xuICAgICAgICAgICAgLy8gICBMb2FkaW5nUGFnZS51cGRhdGVCYXIoOTApO1xuICAgICAgICAgICAgLy8gfSBlbHNlIHtcbiAgICAgICAgICAgIC8vICAgTG9hZGluZ1BhZ2UudXBkYXRlQmFyKDY0KTtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIC8vIExvYWRpbmdQYWdlLnVwZGF0ZVRleHQoXCJEb3dubG9hZGluZyBwcmVzZXRzLi4uXCIpO1xuICAgICAgICAgICAgc25hcC5wcmVzZXRzID0gcHJlc2V0c0RhdGE7XG4gICAgICAgICAgICBzbmFwLnByZXNldHMgPSAoX2UgPSBzbmFwLnByZXNldHMpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGEubmFtZSA+IGIubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoYS5uYW1lIDwgYi5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGJTbmFwc2hvdCA9IHNuYXA7XG4gICAgICAgICAgICByZXR1cm4gZGJTbmFwc2hvdDtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgZGJTbmFwc2hvdCA9IGRlZmF1bHRfc25hcHNob3RfMS5kZWZhdWx0U25hcDtcbiAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuaW5pdFNuYXBzaG90ID0gaW5pdFNuYXBzaG90O1xuZnVuY3Rpb24gZ2V0VXNlclJlc3VsdHMoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgdXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICAgICAgaWYgKHVzZXIgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKGRiU25hcHNob3QgPT09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmIChkYlNuYXBzaG90LnJlc3VsdHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBMb2FkaW5nUGFnZS51cGRhdGVUZXh0KFwiRG93bmxvYWRpbmcgcmVzdWx0cy4uLlwiKTtcbiAgICAgICAgICAgIExvYWRpbmdQYWdlLnVwZGF0ZUJhcig5MCk7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucmVzdWx0cy5nZXQoKTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRXJyb3IgZ2V0dGluZyByZXN1bHRzOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIHJlc3VsdHMuZm9yRWFjaCgocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5iYWlsZWRPdXQgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmJhaWxlZE91dCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuYmxpbmRNb2RlID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5ibGluZE1vZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmxhenlNb2RlID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5sYXp5TW9kZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZGlmZmljdWx0eSA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQuZGlmZmljdWx0eSA9IFwibm9ybWFsXCI7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5mdW5ib3ggPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmZ1bmJveCA9IFwibm9uZVwiO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubGFuZ3VhZ2UgPT09IHVuZGVmaW5lZCB8fCByZXN1bHQubGFuZ3VhZ2UgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lmxhbmd1YWdlID0gXCJlbmdsaXNoXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubnVtYmVycyA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQubnVtYmVycyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQucHVuY3R1YXRpb24gPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1bmN0dWF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRiU25hcHNob3QucmVzdWx0cyA9IHJlc3VsdHMgPT09IG51bGwgfHwgcmVzdWx0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzdWx0cy5zb3J0KChhLCBiKSA9PiBiLnRpbWVzdGFtcCAtIGEudGltZXN0YW1wKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmdldFVzZXJSZXN1bHRzID0gZ2V0VXNlclJlc3VsdHM7XG5mdW5jdGlvbiBnZXRDdXN0b21UaGVtZUJ5SWQodGhlbWVJRCkge1xuICAgIHJldHVybiBkYlNuYXBzaG90LmN1c3RvbVRoZW1lcy5maW5kKCh0KSA9PiB0Ll9pZCA9PT0gdGhlbWVJRCk7XG59XG5leHBvcnRzLmdldEN1c3RvbVRoZW1lQnlJZCA9IGdldEN1c3RvbVRoZW1lQnlJZDtcbmZ1bmN0aW9uIGFkZEN1c3RvbVRoZW1lKHRoZW1lKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKGRiU25hcHNob3QgPT09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmIChkYlNuYXBzaG90LmN1c3RvbVRoZW1lcy5sZW5ndGggPj0gMTApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiVG9vIG1hbnkgY3VzdG9tIHRoZW1lcyFcIiwgMCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmFkZEN1c3RvbVRoZW1lKHRoZW1lKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVycm9yIGFkZGluZyBjdXN0b20gdGhlbWU6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5ld0N1c3RvbVRoZW1lID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGVtZSksIHsgX2lkOiByZXNwb25zZS5kYXRhLnRoZW1lLl9pZCB9KTtcbiAgICAgICAgZGJTbmFwc2hvdC5jdXN0b21UaGVtZXMucHVzaChuZXdDdXN0b21UaGVtZSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xufVxuZXhwb3J0cy5hZGRDdXN0b21UaGVtZSA9IGFkZEN1c3RvbVRoZW1lO1xuZnVuY3Rpb24gZWRpdEN1c3RvbVRoZW1lKHRoZW1lSWQsIG5ld1RoZW1lKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgdXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICAgICAgaWYgKHVzZXIgPT09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmIChkYlNuYXBzaG90ID09PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBjb25zdCBjdXN0b21UaGVtZSA9IGRiU25hcHNob3QuY3VzdG9tVGhlbWVzLmZpbmQoKHQpID0+IHQuX2lkID09PSB0aGVtZUlkKTtcbiAgICAgICAgaWYgKCFjdXN0b21UaGVtZSkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJFZGl0aW5nIGZhaWxlZDogQ3VzdG9tIHRoZW1lIHdpdGggaWQ6IFwiICsgdGhlbWVJZCArIFwiIGRvZXMgbm90IGV4aXN0XCIsIC0xKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMuZWRpdEN1c3RvbVRoZW1lKHRoZW1lSWQsIG5ld1RoZW1lKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVycm9yIGVkaXRpbmcgY3VzdG9tIHRoZW1lOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuZXdDdXN0b21UaGVtZSA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgbmV3VGhlbWUpLCB7IF9pZDogdGhlbWVJZCB9KTtcbiAgICAgICAgZGJTbmFwc2hvdC5jdXN0b21UaGVtZXNbZGJTbmFwc2hvdC5jdXN0b21UaGVtZXMuaW5kZXhPZihjdXN0b21UaGVtZSldID1cbiAgICAgICAgICAgIG5ld0N1c3RvbVRoZW1lO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZWRpdEN1c3RvbVRoZW1lID0gZWRpdEN1c3RvbVRoZW1lO1xuZnVuY3Rpb24gZGVsZXRlQ3VzdG9tVGhlbWUodGhlbWVJZCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgICAgIGlmICh1c2VyID09PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAoZGJTbmFwc2hvdCA9PT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgY29uc3QgY3VzdG9tVGhlbWUgPSBkYlNuYXBzaG90LmN1c3RvbVRoZW1lcy5maW5kKCh0KSA9PiB0Ll9pZCA9PT0gdGhlbWVJZCk7XG4gICAgICAgIGlmICghY3VzdG9tVGhlbWUpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy5kZWxldGVDdXN0b21UaGVtZSh0aGVtZUlkKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVycm9yIGRlbGV0aW5nIGN1c3RvbSB0aGVtZTogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZGJTbmFwc2hvdC5jdXN0b21UaGVtZXMgPSBkYlNuYXBzaG90LmN1c3RvbVRoZW1lcy5maWx0ZXIoKHQpID0+IHQuX2lkICE9PSB0aGVtZUlkKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG59XG5leHBvcnRzLmRlbGV0ZUN1c3RvbVRoZW1lID0gZGVsZXRlQ3VzdG9tVGhlbWU7XG5mdW5jdGlvbiBnZXRVc2VySGlnaGVzdFdwbShtb2RlLCBtb2RlMiwgcHVuY3R1YXRpb24sIGxhbmd1YWdlLCBkaWZmaWN1bHR5LCBsYXp5TW9kZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIGNvbnQoKSB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICBsZXQgdG9wV3BtID0gMDtcbiAgICAgICAgICAgIChfYSA9IGRiU25hcHNob3QucmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubW9kZSA9PSBtb2RlICYmXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5tb2RlMiA9PSBtb2RlMiAmJlxuICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVuY3R1YXRpb24gPT0gcHVuY3R1YXRpb24gJiZcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lmxhbmd1YWdlID09IGxhbmd1YWdlICYmXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kaWZmaWN1bHR5ID09IGRpZmZpY3VsdHkgJiZcbiAgICAgICAgICAgICAgICAgICAgKHJlc3VsdC5sYXp5TW9kZSA9PT0gbGF6eU1vZGUgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIChyZXN1bHQubGF6eU1vZGUgPT09IHVuZGVmaW5lZCAmJiBsYXp5TW9kZSA9PT0gZmFsc2UpKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LndwbSA+IHRvcFdwbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9wV3BtID0gcmVzdWx0LndwbTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRvcFdwbTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXR2YWwgPSBkYlNuYXBzaG90ID09PSBudWxsIHx8IGRiU25hcHNob3QucmVzdWx0cyA9PT0gdW5kZWZpbmVkID8gMCA6IGNvbnQoKTtcbiAgICAgICAgcmV0dXJuIHJldHZhbDtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0VXNlckhpZ2hlc3RXcG0gPSBnZXRVc2VySGlnaGVzdFdwbTtcbmZ1bmN0aW9uIGdldFVzZXJBdmVyYWdlMTAobW9kZSwgbW9kZTIsIHB1bmN0dWF0aW9uLCBsYW5ndWFnZSwgZGlmZmljdWx0eSwgbGF6eU1vZGUpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCBzbmFwc2hvdCA9IGdldFNuYXBzaG90KCk7XG4gICAgICAgIGlmICghc25hcHNob3QpXG4gICAgICAgICAgICByZXR1cm4gWzAsIDBdO1xuICAgICAgICBmdW5jdGlvbiBjb250KCkge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgY29uc3QgYWN0aXZlVGFnSWRzID0gW107XG4gICAgICAgICAgICAoX2EgPSBzbmFwc2hvdC50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRhZy5hY3RpdmUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlVGFnSWRzLnB1c2godGFnLl9pZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBsZXQgd3BtU3VtID0gMDtcbiAgICAgICAgICAgIGxldCBhY2NTdW0gPSAwO1xuICAgICAgICAgICAgbGV0IGxhc3QxMFdwbSA9IDA7XG4gICAgICAgICAgICBsZXQgbGFzdDEwQWNjID0gMDtcbiAgICAgICAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICAgICAgICBsZXQgbGFzdDEwQ291bnQgPSAwO1xuICAgICAgICAgICAgaWYgKHNuYXBzaG90LnJlc3VsdHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcmVzdWx0IG9mIHNuYXBzaG90LnJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5tb2RlID09PSBtb2RlICYmXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVuY3R1YXRpb24gPT09IHB1bmN0dWF0aW9uICYmXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQubGFuZ3VhZ2UgPT09IGxhbmd1YWdlICYmXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZGlmZmljdWx0eSA9PT0gZGlmZmljdWx0eSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgKHJlc3VsdC5sYXp5TW9kZSA9PT0gbGF6eU1vZGUgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAocmVzdWx0LmxhenlNb2RlID09PSB1bmRlZmluZWQgJiYgbGF6eU1vZGUgPT09IGZhbHNlKSkgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIChhY3RpdmVUYWdJZHMubGVuZ3RoID09PSAwIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlVGFnSWRzLnNvbWUoKHRhZ0lkKSA9PiByZXN1bHQudGFncy5pbmNsdWRlcyh0YWdJZCkpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29udGludWUgaWYgdGhlIG1vZGUyIGRvZXNuJ3QgbWF0Y2ggYW5kIGl0J3Mgbm90IGEgcXVvdGVcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubW9kZTIgIT09IG1vZGUyICYmIG1vZGUgIT09IFwicXVvdGVcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gR3JhYiB0aGUgbW9zdCByZWNlbnQgcmVzdWx0cyBmcm9tIHRoZSBjdXJyZW50IG1vZGVcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYXN0MTBDb3VudCA8IDEwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdDEwV3BtICs9IHJlc3VsdC53cG07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdDEwQWNjICs9IHJlc3VsdC5hY2M7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdDEwQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBtb2RlMiBtYXRjaGVzIGFuZCBpZiBpdCBkb2VzLCBhZGQgaXQgdG8gdGhlIHN1bSwgZm9yIHF1b3RlcywgdGhpcyBpcyB0aGUgcXVvdGUgaWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubW9kZTIgPT09IG1vZGUyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd3BtU3VtICs9IHJlc3VsdC53cG07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjU3VtICs9IHJlc3VsdC5hY2M7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY291bnQgPj0gMTApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSBsYXN0IDEwIGF2ZXJhZ2Ugd3BtICYgYWNjIGZvciBxdW90ZVxuICAgICAgICAgICAgLy8gaWYgdGhlIGN1cnJlbnQgcXVvdGUgaWQgaGFzIG5ldmVyIGJlZW4gY29tcGxldGVkIGJlZm9yZSBieSB0aGUgdXNlclxuICAgICAgICAgICAgaWYgKGNvdW50ID09PSAwICYmIG1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiBbbGFzdDEwV3BtIC8gbGFzdDEwQ291bnQsIGxhc3QxMEFjYyAvIGxhc3QxMENvdW50XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBbd3BtU3VtIC8gY291bnQsIGFjY1N1bSAvIGNvdW50XTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXR2YWwgPSBzbmFwc2hvdCA9PT0gbnVsbCB8fCAoeWllbGQgZ2V0VXNlclJlc3VsdHMoKSkgPT09IG51bGwgPyBbMCwgMF0gOiBjb250KCk7XG4gICAgICAgIHJldHVybiByZXR2YWw7XG4gICAgfSk7XG59XG5leHBvcnRzLmdldFVzZXJBdmVyYWdlMTAgPSBnZXRVc2VyQXZlcmFnZTEwO1xuZnVuY3Rpb24gZ2V0TG9jYWxQQihtb2RlLCBtb2RlMiwgcHVuY3R1YXRpb24sIGxhbmd1YWdlLCBkaWZmaWN1bHR5LCBsYXp5TW9kZSwgZnVuYm94KSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKGZ1bmJveCAhPT0gXCJub25lXCIgJiYgZnVuYm94ICE9PSBcInBsdXNfb25lXCIgJiYgZnVuYm94ICE9PSBcInBsdXNfdHdvXCIpIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGNvbnQoKSB7XG4gICAgICAgICAgICBsZXQgcmV0ID0gMDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgaWYgKCFkYlNuYXBzaG90LnBlcnNvbmFsQmVzdHMpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICAgICAgZGJTbmFwc2hvdC5wZXJzb25hbEJlc3RzW21vZGVdW21vZGUyXS5mb3JFYWNoKChwYikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAocGIucHVuY3R1YXRpb24gPT0gcHVuY3R1YXRpb24gJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHBiLmRpZmZpY3VsdHkgPT0gZGlmZmljdWx0eSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgcGIubGFuZ3VhZ2UgPT0gbGFuZ3VhZ2UgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIChwYi5sYXp5TW9kZSA9PT0gbGF6eU1vZGUgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAocGIubGF6eU1vZGUgPT09IHVuZGVmaW5lZCAmJiBsYXp5TW9kZSA9PT0gZmFsc2UpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gcGIud3BtO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXR2YWwgPSBkYlNuYXBzaG90ID09PSBudWxsID8gMCA6IGNvbnQoKTtcbiAgICAgICAgcmV0dXJuIHJldHZhbDtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0TG9jYWxQQiA9IGdldExvY2FsUEI7XG5mdW5jdGlvbiBzYXZlTG9jYWxQQihtb2RlLCBtb2RlMiwgcHVuY3R1YXRpb24sIGxhbmd1YWdlLCBkaWZmaWN1bHR5LCBsYXp5TW9kZSwgd3BtLCBhY2MsIHJhdywgY29uc2lzdGVuY3kpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAobW9kZSA9PSBcInF1b3RlXCIpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGZ1bmN0aW9uIGNvbnQoKSB7XG4gICAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChkYlNuYXBzaG90LnBlcnNvbmFsQmVzdHMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGRiU25hcHNob3QucGVyc29uYWxCZXN0cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgdGltZToge30sXG4gICAgICAgICAgICAgICAgICAgIHdvcmRzOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgemVuOiB7IHplbjogW10gfSxcbiAgICAgICAgICAgICAgICAgICAgcXVvdGU6IHsgY3VzdG9tOiBbXSB9LFxuICAgICAgICAgICAgICAgICAgICBjdXN0b206IHsgY3VzdG9tOiBbXSB9LFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGJTbmFwc2hvdC5wZXJzb25hbEJlc3RzW21vZGVdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAobW9kZSA9PT0gXCJ6ZW5cIikge1xuICAgICAgICAgICAgICAgICAgICBkYlNuYXBzaG90LnBlcnNvbmFsQmVzdHNbXCJ6ZW5cIl0gPSB7IHplbjogW10gfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRiU25hcHNob3QucGVyc29uYWxCZXN0c1ttb2RlXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbTogW10sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRiU25hcHNob3QucGVyc29uYWxCZXN0c1ttb2RlXVttb2RlMl0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGRiU25hcHNob3QucGVyc29uYWxCZXN0c1ttb2RlXVttb2RlMl0gPVxuICAgICAgICAgICAgICAgICAgICBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRiU25hcHNob3QucGVyc29uYWxCZXN0c1ttb2RlXVttb2RlMl0uZm9yRWFjaCgocGIpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocGIucHVuY3R1YXRpb24gPT0gcHVuY3R1YXRpb24gJiZcbiAgICAgICAgICAgICAgICAgICAgcGIuZGlmZmljdWx0eSA9PSBkaWZmaWN1bHR5ICYmXG4gICAgICAgICAgICAgICAgICAgIHBiLmxhbmd1YWdlID09IGxhbmd1YWdlICYmXG4gICAgICAgICAgICAgICAgICAgIChwYi5sYXp5TW9kZSA9PT0gbGF6eU1vZGUgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIChwYi5sYXp5TW9kZSA9PT0gdW5kZWZpbmVkICYmIGxhenlNb2RlID09PSBmYWxzZSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgcGIud3BtID0gd3BtO1xuICAgICAgICAgICAgICAgICAgICBwYi5hY2MgPSBhY2M7XG4gICAgICAgICAgICAgICAgICAgIHBiLnJhdyA9IHJhdztcbiAgICAgICAgICAgICAgICAgICAgcGIudGltZXN0YW1wID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICAgICAgcGIuY29uc2lzdGVuY3kgPSBjb25zaXN0ZW5jeTtcbiAgICAgICAgICAgICAgICAgICAgcGIubGF6eU1vZGUgPSBsYXp5TW9kZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICghZm91bmQpIHtcbiAgICAgICAgICAgICAgICAvL25vdGhpbmcgZm91bmRcbiAgICAgICAgICAgICAgICBkYlNuYXBzaG90LnBlcnNvbmFsQmVzdHNbbW9kZV1bbW9kZTJdLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogbGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IGRpZmZpY3VsdHksXG4gICAgICAgICAgICAgICAgICAgIGxhenlNb2RlOiBsYXp5TW9kZSxcbiAgICAgICAgICAgICAgICAgICAgcHVuY3R1YXRpb246IHB1bmN0dWF0aW9uLFxuICAgICAgICAgICAgICAgICAgICB3cG06IHdwbSxcbiAgICAgICAgICAgICAgICAgICAgYWNjOiBhY2MsXG4gICAgICAgICAgICAgICAgICAgIHJhdzogcmF3LFxuICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgICAgICAgICAgICAgIGNvbnNpc3RlbmN5OiBjb25zaXN0ZW5jeSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZGJTbmFwc2hvdCAhPSBudWxsKSB7XG4gICAgICAgICAgICBjb250KCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuc2F2ZUxvY2FsUEIgPSBzYXZlTG9jYWxQQjtcbmZ1bmN0aW9uIGdldExvY2FsVGFnUEIodGFnSWQsIG1vZGUsIG1vZGUyLCBwdW5jdHVhdGlvbiwgbGFuZ3VhZ2UsIGRpZmZpY3VsdHksIGxhenlNb2RlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgZnVuY3Rpb24gY29udCgpIHtcbiAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICBsZXQgcmV0ID0gMDtcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlcmVkdGFnID0gKChfYSA9IGdldFNuYXBzaG90KCkudGFncykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogW10pLmZpbHRlcigodCkgPT4gdC5faWQgPT09IHRhZ0lkKVswXTtcbiAgICAgICAgICAgIGlmIChmaWx0ZXJlZHRhZyA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICBpZiAoZmlsdGVyZWR0YWcucGVyc29uYWxCZXN0cyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgZmlsdGVyZWR0YWcucGVyc29uYWxCZXN0cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgdGltZToge30sXG4gICAgICAgICAgICAgICAgICAgIHdvcmRzOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgemVuOiB7IHplbjogW10gfSxcbiAgICAgICAgICAgICAgICAgICAgcXVvdGU6IHsgY3VzdG9tOiBbXSB9LFxuICAgICAgICAgICAgICAgICAgICBjdXN0b206IHsgY3VzdG9tOiBbXSB9LFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBlcnNvbmFsQmVzdHMgPSAoKF9iID0gZmlsdGVyZWR0YWcucGVyc29uYWxCZXN0c1ttb2RlXVttb2RlMl0pICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IFtdKTtcbiAgICAgICAgICAgICAgICBwZXJzb25hbEJlc3RzLmZvckVhY2goKHBiKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYi5wdW5jdHVhdGlvbiA9PSBwdW5jdHVhdGlvbiAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgcGIuZGlmZmljdWx0eSA9PSBkaWZmaWN1bHR5ICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBwYi5sYW5ndWFnZSA9PSBsYW5ndWFnZSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgKHBiLmxhenlNb2RlID09PSBsYXp5TW9kZSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwYi5sYXp5TW9kZSA9PT0gdW5kZWZpbmVkICYmIGxhenlNb2RlID09PSBmYWxzZSkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBwYi53cG07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJldHZhbCA9IGRiU25hcHNob3QgPT09IG51bGwgPyAwIDogY29udCgpO1xuICAgICAgICByZXR1cm4gcmV0dmFsO1xuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRMb2NhbFRhZ1BCID0gZ2V0TG9jYWxUYWdQQjtcbmZ1bmN0aW9uIHNhdmVMb2NhbFRhZ1BCKHRhZ0lkLCBtb2RlLCBtb2RlMiwgcHVuY3R1YXRpb24sIGxhbmd1YWdlLCBkaWZmaWN1bHR5LCBsYXp5TW9kZSwgd3BtLCBhY2MsIHJhdywgY29uc2lzdGVuY3kpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAobW9kZSA9PSBcInF1b3RlXCIpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGZ1bmN0aW9uIGNvbnQoKSB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICBjb25zdCBmaWx0ZXJlZHRhZyA9IChfYSA9IGRiU25hcHNob3QudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpbHRlcigodCkgPT4gdC5faWQgPT09IHRhZ0lkKVswXTtcbiAgICAgICAgICAgIGlmICghZmlsdGVyZWR0YWcucGVyc29uYWxCZXN0cykge1xuICAgICAgICAgICAgICAgIGZpbHRlcmVkdGFnLnBlcnNvbmFsQmVzdHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWU6IHt9LFxuICAgICAgICAgICAgICAgICAgICB3b3Jkczoge30sXG4gICAgICAgICAgICAgICAgICAgIHplbjogeyB6ZW46IFtdIH0sXG4gICAgICAgICAgICAgICAgICAgIHF1b3RlOiB7IGN1c3RvbTogW10gfSxcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tOiB7IGN1c3RvbTogW10gfSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWR0YWcucGVyc29uYWxCZXN0c1ttb2RlXVttb2RlMl0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZHRhZy5wZXJzb25hbEJlc3RzW21vZGVdW21vZGUyXSA9XG4gICAgICAgICAgICAgICAgICAgICAgICBbXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZmlsdGVyZWR0YWcucGVyc29uYWxCZXN0c1ttb2RlXVttb2RlMl0uZm9yRWFjaCgocGIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBiLnB1bmN0dWF0aW9uID09IHB1bmN0dWF0aW9uICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBwYi5kaWZmaWN1bHR5ID09IGRpZmZpY3VsdHkgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHBiLmxhbmd1YWdlID09IGxhbmd1YWdlICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAocGIubGF6eU1vZGUgPT09IGxhenlNb2RlIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKHBiLmxhenlNb2RlID09PSB1bmRlZmluZWQgJiYgbGF6eU1vZGUgPT09IGZhbHNlKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBiLndwbSA9IHdwbTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBiLmFjYyA9IGFjYztcbiAgICAgICAgICAgICAgICAgICAgICAgIHBiLnJhdyA9IHJhdztcbiAgICAgICAgICAgICAgICAgICAgICAgIHBiLnRpbWVzdGFtcCA9IERhdGUubm93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYi5jb25zaXN0ZW5jeSA9IGNvbnNpc3RlbmN5O1xuICAgICAgICAgICAgICAgICAgICAgICAgcGIubGF6eU1vZGUgPSBsYXp5TW9kZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICghZm91bmQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9ub3RoaW5nIGZvdW5kXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkdGFnLnBlcnNvbmFsQmVzdHNbbW9kZV1bbW9kZTJdLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IGxhbmd1YWdlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eTogZGlmZmljdWx0eSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhenlNb2RlOiBsYXp5TW9kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHB1bmN0dWF0aW9uOiBwdW5jdHVhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHdwbTogd3BtLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWNjOiBhY2MsXG4gICAgICAgICAgICAgICAgICAgICAgICByYXc6IHJhdyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNpc3RlbmN5OiBjb25zaXN0ZW5jeSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAvL3RoYXQgbW9kZSBvciBtb2RlMiBpcyBub3QgZm91bmRcbiAgICAgICAgICAgICAgICBmaWx0ZXJlZHRhZy5wZXJzb25hbEJlc3RzID0ge1xuICAgICAgICAgICAgICAgICAgICB0aW1lOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgd29yZHM6IHt9LFxuICAgICAgICAgICAgICAgICAgICB6ZW46IHsgemVuOiBbXSB9LFxuICAgICAgICAgICAgICAgICAgICBxdW90ZTogeyBjdXN0b206IFtdIH0sXG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbTogeyBjdXN0b206IFtdIH0sXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBpZiAobW9kZSA9PT0gXCJ6ZW5cIikge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZHRhZy5wZXJzb25hbEJlc3RzW1wiemVuXCJdID0geyB6ZW46IFtdIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZHRhZy5wZXJzb25hbEJlc3RzW21vZGVdID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZmlsdGVyZWR0YWcucGVyc29uYWxCZXN0c1ttb2RlXVttb2RlMl0gPSBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlOiBsYW5ndWFnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IGRpZmZpY3VsdHksXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXp5TW9kZTogbGF6eU1vZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwdW5jdHVhdGlvbjogcHVuY3R1YXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICB3cG06IHdwbSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjYzogYWNjLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmF3OiByYXcsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zaXN0ZW5jeTogY29uc2lzdGVuY3ksXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZGJTbmFwc2hvdCAhPSBudWxsKSB7XG4gICAgICAgICAgICBjb250KCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgIH0pO1xufVxuZXhwb3J0cy5zYXZlTG9jYWxUYWdQQiA9IHNhdmVMb2NhbFRhZ1BCO1xuZnVuY3Rpb24gdXBkYXRlTGJNZW1vcnkobW9kZSwgbW9kZTIsIGxhbmd1YWdlLCByYW5rLCBhcGkgPSBmYWxzZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIC8vY291bGQgZGJTbmFwc2hvdCBqdXN0IGJlIHVzZWQgaGVyZSBpbnN0ZWFkIG9mIGdldFNuYXBzaG90KClcbiAgICAgICAgaWYgKG1vZGUgPT09IFwidGltZVwiKSB7XG4gICAgICAgICAgICBjb25zdCB0aW1lTW9kZSA9IG1vZGUsIHRpbWVNb2RlMiA9IG1vZGUyO1xuICAgICAgICAgICAgY29uc3Qgc25hcHNob3QgPSBnZXRTbmFwc2hvdCgpO1xuICAgICAgICAgICAgaWYgKHNuYXBzaG90LmxiTWVtb3J5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBzbmFwc2hvdC5sYk1lbW9yeSA9IHsgdGltZTogeyAxNTogeyBlbmdsaXNoOiAwIH0sIDYwOiB7IGVuZ2xpc2g6IDAgfSB9IH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc25hcHNob3QubGJNZW1vcnlbdGltZU1vZGVdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBzbmFwc2hvdC5sYk1lbW9yeVt0aW1lTW9kZV0gPSB7XG4gICAgICAgICAgICAgICAgICAgIDE1OiB7IGVuZ2xpc2g6IDAgfSxcbiAgICAgICAgICAgICAgICAgICAgNjA6IHsgZW5nbGlzaDogMCB9LFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc25hcHNob3QubGJNZW1vcnlbdGltZU1vZGVdW3RpbWVNb2RlMl0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHNuYXBzaG90LmxiTWVtb3J5W3RpbWVNb2RlXVt0aW1lTW9kZTJdID0ge307XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50ID0gc25hcHNob3QubGJNZW1vcnlbdGltZU1vZGVdW3RpbWVNb2RlMl1bbGFuZ3VhZ2VdO1xuICAgICAgICAgICAgc25hcHNob3QubGJNZW1vcnlbdGltZU1vZGVdW3RpbWVNb2RlMl1bbGFuZ3VhZ2VdID0gcmFuaztcbiAgICAgICAgICAgIGlmIChhcGkgJiYgY3VycmVudCAhPSByYW5rKSB7XG4gICAgICAgICAgICAgICAgeWllbGQgYXBlXzEuZGVmYXVsdC51c2Vycy51cGRhdGVMZWFkZXJib2FyZE1lbW9yeShtb2RlLCBtb2RlMiwgbGFuZ3VhZ2UsIHJhbmspO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0U25hcHNob3Qoc25hcHNob3QpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLnVwZGF0ZUxiTWVtb3J5ID0gdXBkYXRlTGJNZW1vcnk7XG5mdW5jdGlvbiBzYXZlQ29uZmlnKGNvbmZpZykge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgIEFjY291bnRCdXR0b24ubG9hZGluZyh0cnVlKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5jb25maWdzLnNhdmUoY29uZmlnKTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHNhdmUgY29uZmlnOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIEFjY291bnRCdXR0b24ubG9hZGluZyhmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuc2F2ZUNvbmZpZyA9IHNhdmVDb25maWc7XG5mdW5jdGlvbiBzYXZlTG9jYWxSZXN1bHQocmVzdWx0KSB7XG4gICAgY29uc3Qgc25hcHNob3QgPSBnZXRTbmFwc2hvdCgpO1xuICAgIGlmIChzbmFwc2hvdCAhPT0gbnVsbCAmJiBzbmFwc2hvdC5yZXN1bHRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgc25hcHNob3QucmVzdWx0cy51bnNoaWZ0KHJlc3VsdCk7XG4gICAgICAgIHNldFNuYXBzaG90KHNuYXBzaG90KTtcbiAgICB9XG59XG5leHBvcnRzLnNhdmVMb2NhbFJlc3VsdCA9IHNhdmVMb2NhbFJlc3VsdDtcbmZ1bmN0aW9uIHVwZGF0ZUxvY2FsU3RhdHMoc3RhdHMpIHtcbiAgICBjb25zdCBzbmFwc2hvdCA9IGdldFNuYXBzaG90KCk7XG4gICAgaWYgKHNuYXBzaG90Lmdsb2JhbFN0YXRzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgc25hcHNob3QuZ2xvYmFsU3RhdHMgPSB7fTtcbiAgICB9XG4gICAgaWYgKHNuYXBzaG90ICE9PSBudWxsICYmIHNuYXBzaG90Lmdsb2JhbFN0YXRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKHNuYXBzaG90Lmdsb2JhbFN0YXRzLnRpbWUgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBzbmFwc2hvdC5nbG9iYWxTdGF0cy50aW1lID0gc3RhdHMudGltZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHNuYXBzaG90Lmdsb2JhbFN0YXRzLnRpbWUgKz0gc3RhdHMudGltZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc25hcHNob3QuZ2xvYmFsU3RhdHMuc3RhcnRlZCA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHNuYXBzaG90Lmdsb2JhbFN0YXRzLnN0YXJ0ZWQgPSBzdGF0cy5zdGFydGVkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc25hcHNob3QuZ2xvYmFsU3RhdHMuc3RhcnRlZCArPSBzdGF0cy5zdGFydGVkO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzbmFwc2hvdC5nbG9iYWxTdGF0cy5jb21wbGV0ZWQgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBzbmFwc2hvdC5nbG9iYWxTdGF0cy5jb21wbGV0ZWQgPSAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc25hcHNob3QuZ2xvYmFsU3RhdHMuY29tcGxldGVkICs9IDE7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0U25hcHNob3Qoc25hcHNob3QpO1xufVxuZXhwb3J0cy51cGRhdGVMb2NhbFN0YXRzID0gdXBkYXRlTG9jYWxTdGF0cztcbi8vIGV4cG9ydCBhc3luYyBmdW5jdGlvbiBEQi5nZXRMb2NhbFRhZ1BCKHRhZ0lkKSB7XG4vLyAgIGZ1bmN0aW9uIGNvbnQoKSB7XG4vLyAgICAgbGV0IHJldCA9IDA7XG4vLyAgICAgdHJ5IHtcbi8vICAgICAgIHJldCA9IGRiU25hcHNob3QudGFncy5maWx0ZXIoKHQpID0+IHQuaWQgPT09IHRhZ0lkKVswXS5wYjtcbi8vICAgICAgIGlmIChyZXQgPT0gdW5kZWZpbmVkKSB7XG4vLyAgICAgICAgIHJldCA9IDA7XG4vLyAgICAgICB9XG4vLyAgICAgICByZXR1cm4gcmV0O1xuLy8gICAgIH0gY2F0Y2ggKGUpIHtcbi8vICAgICAgIHJldHVybiByZXQ7XG4vLyAgICAgfVxuLy8gICB9XG4vLyAgIGNvbnN0IHJldHZhbCA9IGRiU25hcHNob3QgIT09IG51bGwgPyBjb250KCkgOiB1bmRlZmluZWQ7XG4vLyAgIHJldHVybiByZXR2YWw7XG4vLyB9XG4vLyBleHBvcnQgYXN5bmMgZnVuY3Rpbyh0YWdJZCwgd3BtKSB7XG4vLyAgIGZ1bmN0aW9uIGNvbnQoKSB7XG4vLyAgICAgZGJTbmFwc2hvdC50YWdzLmZvckVhY2goKHRhZykgPT4ge1xuLy8gICAgICAgaWYgKHRhZy5faWQgPT09IHRhZ0lkKSB7XG4vLyAgICAgICAgIHRhZy5wYiA9IHdwbTtcbi8vICAgICAgIH1cbi8vICAgICB9KTtcbi8vICAgfVxuLy8gICBpZiAoZGJTbmFwc2hvdCAhPSBudWxsKSB7XG4vLyAgICAgY29udCgpO1xuLy8gICB9XG4vLyB9XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51cGRhdGUgPSBleHBvcnRzLmxvYWRpbmcgPSB2b2lkIDA7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5mdW5jdGlvbiBsb2FkaW5nKHRydWVmYWxzZSkge1xuICAgIGlmICh0cnVlZmFsc2UpIHtcbiAgICAgICAgJChcIiN0b3AgI21lbnUgLmFjY291bnQgLmljb25cIikuaHRtbCgnPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtc3BpbiBmYS1jaXJjbGUtbm90Y2hcIj48L2k+Jyk7XG4gICAgICAgICQoXCIjdG9wICNtZW51IC5hY2NvdW50XCIpLmNzcyhcIm9wYWNpdHlcIiwgMSkuY3NzKFwicG9pbnRlci1ldmVudHNcIiwgXCJub25lXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiN0b3AgI21lbnUgLmFjY291bnQgLmljb25cIikuaHRtbCgnPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtdXNlclwiPjwvaT4nKTtcbiAgICAgICAgJChcIiN0b3AgI21lbnUgLmFjY291bnRcIikuY3NzKFwib3BhY2l0eVwiLCAxKS5jc3MoXCJwb2ludGVyLWV2ZW50c1wiLCBcImF1dG9cIik7XG4gICAgfVxufVxuZXhwb3J0cy5sb2FkaW5nID0gbG9hZGluZztcbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyICE9IG51bGwpIHtcbiAgICAgICAgTWlzYy5zd2FwRWxlbWVudHMoJChcIiNtZW51IC5pY29uLWJ1dHRvbi5sb2dpblwiKSwgJChcIiNtZW51IC5pY29uLWJ1dHRvbi5hY2NvdW50XCIpLCAyNTApO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgTWlzYy5zd2FwRWxlbWVudHMoJChcIiNtZW51IC5pY29uLWJ1dHRvbi5hY2NvdW50XCIpLCAkKFwiI21lbnUgLmljb24tYnV0dG9uLmxvZ2luXCIpLCAyNTApO1xuICAgIH1cbn1cbmV4cG9ydHMudXBkYXRlID0gdXBkYXRlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5nZXRMaXN0ID0gZXhwb3J0cy5wdXNoQ3VycmVudCA9IGV4cG9ydHMuc2V0Q3VycmVudCA9IGV4cG9ydHMuZGVmYXVsdENvbW1hbmRzID0gZXhwb3J0cy51cGRhdGVUaGVtZUNvbW1hbmRzID0gZXhwb3J0cy5jb21tYW5kc0NoYWxsZW5nZXMgPSBleHBvcnRzLnRoZW1lQ29tbWFuZHMgPSBleHBvcnRzLnVwZGF0ZUN1c3RvbVRoZW1lTGlzdENvbW1hbmRzID0gZXhwb3J0cy5jdXN0b21UaGVtZUxpc3RDb21tYW5kcyA9IGV4cG9ydHMuY3VzdG9tVGhlbWVDb21tYW5kcyA9IGV4cG9ydHMuY29tbWFuZHNFbmFibGVBZHMgPSBleHBvcnRzLnVwZGF0ZVByZXNldENvbW1hbmRzID0gZXhwb3J0cy51cGRhdGVUYWdDb21tYW5kcyA9IGV4cG9ydHMuY29tbWFuZHNLZXltYXBMYXlvdXRzID0gZXhwb3J0cy5jdXJyZW50ID0gdm9pZCAwO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IFNvdW5kID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9zb3VuZC1jb250cm9sbGVyXCIpKTtcbmNvbnN0IFRoZW1lQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvdGhlbWUtY29udHJvbGxlclwiKSk7XG5jb25zdCBDdXN0b21UZXh0UG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BvcHVwcy9jdXN0b20tdGV4dC1wb3B1cFwiKSk7XG5jb25zdCBNYW51YWxSZXN0YXJ0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L21hbnVhbC1yZXN0YXJ0LXRyYWNrZXJcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgUHJhY3Rpc2VXb3JkcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9wcmFjdGlzZS13b3Jkc1wiKSk7XG5jb25zdCBUZXN0VUkgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC11aVwiKSk7XG5jb25zdCBUZXN0TG9naWMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC1sb2dpY1wiKSk7XG5jb25zdCBGdW5ib3ggPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvZnVuYm94XCIpKTtcbmNvbnN0IFRhZ0NvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL3RhZy1jb250cm9sbGVyXCIpKTtcbmNvbnN0IFByZXNldENvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL3ByZXNldC1jb250cm9sbGVyXCIpKTtcbmNvbnN0IEN1c3RvbVRleHQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvY3VzdG9tLXRleHRcIikpO1xuY29uc3QgU2V0dGluZ3MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BhZ2VzL3NldHRpbmdzXCIpKTtcbmNvbnN0IENoYWxsZW5nZUNvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL2NoYWxsZW5nZS1jb250cm9sbGVyXCIpKTtcbmNvbnN0IFBhY2VDYXJldCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9wYWNlLWNhcmV0XCIpKTtcbmNvbnN0IFRlc3RJbnB1dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LWlucHV0XCIpKTtcbmNvbnN0IE1vZGVzTm90aWNlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9tb2Rlcy1ub3RpY2VcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xuZXhwb3J0cy5jdXJyZW50ID0gW107XG5mdW5jdGlvbiBjYW5CYWlsT3V0KCkge1xuICAgIHJldHVybiAoKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICBDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAoQ3VzdG9tVGV4dC53b3JkID49IDUwMDAgfHwgQ3VzdG9tVGV4dC53b3JkID09IDApKSB8fFxuICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICAhQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gJiZcbiAgICAgICAgICAgICFDdXN0b21UZXh0LmlzVGltZVJhbmRvbSAmJlxuICAgICAgICAgICAgQ3VzdG9tVGV4dC50ZXh0Lmxlbmd0aCA+PSA1MDAwKSB8fFxuICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICBDdXN0b21UZXh0LmlzVGltZVJhbmRvbSAmJlxuICAgICAgICAgICAgKEN1c3RvbVRleHQudGltZSA+PSAzNjAwIHx8IEN1c3RvbVRleHQudGltZSA9PSAwKSkgfHxcbiAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ3b3Jkc1wiICYmIGNvbmZpZ18xLmRlZmF1bHQud29yZHMgPj0gNTAwMCkgfHxcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC53b3JkcyA9PT0gMCB8fFxuICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInRpbWVcIiAmJiAoY29uZmlnXzEuZGVmYXVsdC50aW1lID49IDM2MDAgfHwgY29uZmlnXzEuZGVmYXVsdC50aW1lID09PSAwKSkgfHxcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIpO1xufVxuY29uc3QgY29tbWFuZHNMYXlvdXRzID0ge1xuICAgIHRpdGxlOiBcIkxheW91dCBlbXVsYXRvci4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJsYXlvdXRcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNvdWxkbm90bG9hZFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJDb3VsZCBub3QgbG9hZCB0aGUgbGF5b3V0cyBsaXN0IDooXCIsXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5NaXNjLmdldExheW91dHNMaXN0KCkudGhlbigobGF5b3V0cykgPT4ge1xuICAgIGNvbW1hbmRzTGF5b3V0cy5saXN0ID0gW107XG4gICAgY29tbWFuZHNMYXlvdXRzLmxpc3QucHVzaCh7XG4gICAgICAgIGlkOiBcImNoYW5nZUxheW91dERlZmF1bHRcIixcbiAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgY29uZmlnVmFsdWU6IFwiZGVmYXVsdFwiLFxuICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TGF5b3V0KFwiZGVmYXVsdFwiKTtcbiAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgIH0sXG4gICAgfSk7XG4gICAgT2JqZWN0LmtleXMobGF5b3V0cykuZm9yRWFjaCgobGF5b3V0KSA9PiB7XG4gICAgICAgIGNvbW1hbmRzTGF5b3V0cy5saXN0LnB1c2goe1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTGF5b3V0XCIgKyBNaXNjLmNhcGl0YWxpemVGaXJzdExldHRlck9mRWFjaFdvcmQobGF5b3V0KSxcbiAgICAgICAgICAgIGRpc3BsYXk6IGxheW91dCA9PT0gXCJkZWZhdWx0XCIgPyBcIm9mZlwiIDogbGF5b3V0LnJlcGxhY2UoL18vZywgXCIgXCIpLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGxheW91dCxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGVDb25maWcuc2V0U2F2ZWRMYXlvdXQobGF5b3V0KTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TGF5b3V0KGxheW91dCk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG5leHBvcnRzLmNvbW1hbmRzS2V5bWFwTGF5b3V0cyA9IHtcbiAgICB0aXRsZTogXCJDaGFuZ2Uga2V5bWFwIGxheW91dC4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJrZXltYXBMYXlvdXRcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNvdWxkbm90bG9hZFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJDb3VsZCBub3QgbG9hZCB0aGUgbGF5b3V0cyBsaXN0IDooXCIsXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5NaXNjLmdldExheW91dHNMaXN0KCkudGhlbigobGF5b3V0cykgPT4ge1xuICAgIGV4cG9ydHMuY29tbWFuZHNLZXltYXBMYXlvdXRzLmxpc3QgPSBbXTtcbiAgICBleHBvcnRzLmNvbW1hbmRzS2V5bWFwTGF5b3V0cy5saXN0LnB1c2goe1xuICAgICAgICBpZDogXCJjaGFuZ2VLZXltYXBMYXlvdXRPdmVycmlkZVN5bmNcIixcbiAgICAgICAgZGlzcGxheTogXCJlbXVsYXRvciBzeW5jXCIsXG4gICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm92ZXJyaWRlU3luY1wiLFxuICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTGF5b3V0KFwib3ZlcnJpZGVTeW5jXCIpO1xuICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgfSxcbiAgICB9KTtcbiAgICBPYmplY3Qua2V5cyhsYXlvdXRzKS5mb3JFYWNoKChsYXlvdXQpID0+IHtcbiAgICAgICAgaWYgKGxheW91dC50b1N0cmluZygpICE9IFwiZGVmYXVsdFwiKSB7XG4gICAgICAgICAgICBleHBvcnRzLmNvbW1hbmRzS2V5bWFwTGF5b3V0cy5saXN0LnB1c2goe1xuICAgICAgICAgICAgICAgIGlkOiBcImNoYW5nZUtleW1hcExheW91dFwiICsgTWlzYy5jYXBpdGFsaXplRmlyc3RMZXR0ZXJPZkVhY2hXb3JkKGxheW91dCksXG4gICAgICAgICAgICAgICAgZGlzcGxheTogbGF5b3V0LnJlcGxhY2UoL18vZywgXCIgXCIpLFxuICAgICAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBsYXlvdXQsXG4gICAgICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTGF5b3V0KGxheW91dCk7XG4gICAgICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG59KTtcbmNvbnN0IGNvbW1hbmRzTGFuZ3VhZ2VzID0ge1xuICAgIHRpdGxlOiBcIkxhbmd1YWdlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImxhbmd1YWdlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjb3VsZG5vdGxvYWRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQ291bGQgbm90IGxvYWQgdGhlIGxhbmd1YWdlcyBsaXN0IDooXCIsXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb21tYW5kc0xhbmd1YWdlcy5saXN0ID0gW107XG5NaXNjLmdldExhbmd1YWdlTGlzdCgpLnRoZW4oKGxhbmd1YWdlcykgPT4ge1xuICAgIGxhbmd1YWdlcy5mb3JFYWNoKChsYW5ndWFnZSkgPT4ge1xuICAgICAgICBjb21tYW5kc0xhbmd1YWdlcy5saXN0LnB1c2goe1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTGFuZ3VhZ2VcIiArIE1pc2MuY2FwaXRhbGl6ZUZpcnN0TGV0dGVyT2ZFYWNoV29yZChsYW5ndWFnZSksXG4gICAgICAgICAgICBkaXNwbGF5OiBsYW5ndWFnZS5yZXBsYWNlKC9fL2csIFwiIFwiKSxcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBsYW5ndWFnZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TGFuZ3VhZ2UobGFuZ3VhZ2UpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuY29uc3QgY29tbWFuZHNGdW5ib3ggPSB7XG4gICAgdGl0bGU6IFwiRnVuYm94Li4uXCIsXG4gICAgY29uZmlnS2V5OiBcImZ1bmJveFwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlRnVuYm94Tm9uZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJub25lXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJub25lXCIsXG4gICAgICAgICAgICBhbGlhczogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoRnVuYm94LnNldEZ1bmJveChcIm5vbmVcIiwgbnVsbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuTWlzYy5nZXRGdW5ib3hMaXN0KCkudGhlbigoZnVuYm94ZXMpID0+IHtcbiAgICBmdW5ib3hlcy5mb3JFYWNoKChmdW5ib3gpID0+IHtcbiAgICAgICAgY29tbWFuZHNGdW5ib3gubGlzdC5wdXNoKHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUZ1bmJveFwiICsgZnVuYm94Lm5hbWUsXG4gICAgICAgICAgICBkaXNwbGF5OiBmdW5ib3gubmFtZS5yZXBsYWNlKC9fL2csIFwiIFwiKSxcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmdW5ib3gubmFtZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoRnVuYm94LnNldEZ1bmJveChmdW5ib3gubmFtZSwgZnVuYm94LnR5cGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbmNvbnN0IGNvbW1hbmRzRm9udHMgPSB7XG4gICAgdGl0bGU6IFwiRm9udCBmYW1pbHkuLi5cIixcbiAgICBjb25maWdLZXk6IFwiZm9udEZhbWlseVwiLFxuICAgIGxpc3Q6IFtdLFxufTtcbk1pc2MuZ2V0Rm9udHNMaXN0KCkudGhlbigoZm9udHMpID0+IHtcbiAgICBmb250cy5mb3JFYWNoKChmb250KSA9PiB7XG4gICAgICAgIGNvbW1hbmRzRm9udHMubGlzdC5wdXNoKHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUZvbnRcIiArIGZvbnQubmFtZS5yZXBsYWNlKC8gL2csIFwiX1wiKSxcbiAgICAgICAgICAgIGRpc3BsYXk6IGZvbnQuZGlzcGxheSAhPT0gdW5kZWZpbmVkID8gZm9udC5kaXNwbGF5IDogZm9udC5uYW1lLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZvbnQubmFtZSxcbiAgICAgICAgICAgIGhvdmVyOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnByZXZpZXdGb250RmFtaWx5KGZvbnQubmFtZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGb250RmFtaWx5KGZvbnQubmFtZS5yZXBsYWNlKC8gL2csIFwiX1wiKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBjb21tYW5kc0ZvbnRzLmxpc3QucHVzaCh7XG4gICAgICAgIGlkOiBcInNldEZvbnRGYW1pbHlDdXN0b21cIixcbiAgICAgICAgZGlzcGxheTogXCJjdXN0b20uLi5cIixcbiAgICAgICAgaW5wdXQ6IHRydWUsXG4gICAgICAgIGhvdmVyOiAoKSA9PiB7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcucHJldmlld0ZvbnRGYW1pbHkoY29uZmlnXzEuZGVmYXVsdC5mb250RmFtaWx5KTtcbiAgICAgICAgfSxcbiAgICAgICAgZXhlYzogKG5hbWUpID0+IHtcbiAgICAgICAgICAgIGlmICghbmFtZSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Rm9udEZhbWlseShuYW1lLnJlcGxhY2UoL1xccy9nLCBcIl9cIikpO1xuICAgICAgICAgICAgLy8gU2V0dGluZ3MuZ3JvdXBzLmZvbnRGYW1pbHkudXBkYXRlSW5wdXQoKTtcbiAgICAgICAgfSxcbiAgICB9KTtcbn0pO1xuY29uc3QgY29tbWFuZHNUYWdzID0ge1xuICAgIHRpdGxlOiBcIkNoYW5nZSB0YWdzLi4uXCIsXG4gICAgbGlzdDogW10sXG59O1xuZnVuY3Rpb24gdXBkYXRlVGFnQ29tbWFuZHMoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICAgIGlmICgoX2MgPSAoX2IgPSAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudGFncykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmxlbmd0aCkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogMCA+IDApIHtcbiAgICAgICAgY29tbWFuZHNUYWdzLmxpc3QgPSBbXTtcbiAgICAgICAgY29tbWFuZHNUYWdzLmxpc3QucHVzaCh7XG4gICAgICAgICAgICBpZDogXCJjbGVhclRhZ3NcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IGBDbGVhciB0YWdzYCxcbiAgICAgICAgICAgIGljb246IFwiZmEtdGltZXNcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgY29uc3Qgc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdCgpO1xuICAgICAgICAgICAgICAgIHNuYXBzaG90LnRhZ3MgPSAoX2EgPSBzbmFwc2hvdC50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWFwKCh0YWcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGFnLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFnO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIERCLnNldFNuYXBzaG90KHNuYXBzaG90KTtcbiAgICAgICAgICAgICAgICBNb2Rlc05vdGljZS51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICBUYWdDb250cm9sbGVyLnNhdmVBY3RpdmVUb0xvY2FsU3RvcmFnZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIChfZCA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgbGV0IGRpcyA9IHRhZy5uYW1lO1xuICAgICAgICAgICAgaWYgKHRhZy5hY3RpdmUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBkaXMgPSAnPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtY2hlY2tcIj48L2k+JyArIGRpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGRpcyA9ICc8aSBjbGFzcz1cImZhcyBmYS1md1wiPjwvaT4nICsgZGlzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29tbWFuZHNUYWdzLmxpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgaWQ6IFwidG9nZ2xlVGFnXCIgKyB0YWcuX2lkLFxuICAgICAgICAgICAgICAgIG5vSWNvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiBkaXMsXG4gICAgICAgICAgICAgICAgc3RpY2t5OiB0cnVlLFxuICAgICAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgVGFnQ29udHJvbGxlci50b2dnbGUodGFnLl9pZCk7XG4gICAgICAgICAgICAgICAgICAgIE1vZGVzTm90aWNlLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5wYWNlQ2FyZXQgPT09IFwiYXZlcmFnZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBQYWNlQ2FyZXQuaW5pdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgTW9kZXNOb3RpY2UudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbGV0IHR4dCA9IHRhZy5uYW1lO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGFnLmFjdGl2ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHh0ID0gJzxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWNoZWNrXCI+PC9pPicgKyB0eHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eHQgPSAnPGkgY2xhc3M9XCJmYXMgZmEtZndcIj48L2k+JyArIHR4dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoJChcIiNjb21tYW5kTGluZVwiKS5oYXNDbGFzcyhcImFsbENvbW1hbmRzXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKGAjY29tbWFuZExpbmUgLnN1Z2dlc3Rpb25zIC5lbnRyeVtjb21tYW5kPSd0b2dnbGVUYWcke3RhZy5faWR9J11gKS5odG1sKGA8ZGl2IGNsYXNzPVwiaWNvblwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXRhZ1wiPjwvaT48L2Rpdj48ZGl2PlRhZ3MgID4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHh0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoYCNjb21tYW5kTGluZSAuc3VnZ2VzdGlvbnMgLmVudHJ5W2NvbW1hbmQ9J3RvZ2dsZVRhZyR7dGFnLl9pZH0nXWApLmh0bWwodHh0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIGRlZmF1bHRDb21tYW5kcy5saXN0WzRdLnZpc2libGUgPSB0cnVlO1xuICAgIH1cbn1cbmV4cG9ydHMudXBkYXRlVGFnQ29tbWFuZHMgPSB1cGRhdGVUYWdDb21tYW5kcztcbmNvbnN0IGNvbW1hbmRzUHJlc2V0cyA9IHtcbiAgICB0aXRsZTogXCJQcmVzZXRzLi4uXCIsXG4gICAgbGlzdDogW10sXG59O1xuZnVuY3Rpb24gdXBkYXRlUHJlc2V0Q29tbWFuZHMoKSB7XG4gICAgY29uc3Qgc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdCgpO1xuICAgIGlmICghc25hcHNob3QgfHwgIXNuYXBzaG90LnByZXNldHMgfHwgc25hcHNob3QucHJlc2V0cy5sZW5ndGggPT09IDApXG4gICAgICAgIHJldHVybjtcbiAgICBjb21tYW5kc1ByZXNldHMubGlzdCA9IFtdO1xuICAgIHNuYXBzaG90LnByZXNldHMuZm9yRWFjaCgocHJlc2V0KSA9PiB7XG4gICAgICAgIGNvbnN0IGRpcyA9IHByZXNldC5uYW1lO1xuICAgICAgICBjb21tYW5kc1ByZXNldHMubGlzdC5wdXNoKHtcbiAgICAgICAgICAgIGlkOiBcImFwcGx5UHJlc2V0XCIgKyBwcmVzZXQuX2lkLFxuICAgICAgICAgICAgZGlzcGxheTogZGlzLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFNldHRpbmdzLnNldEV2ZW50RGlzYWJsZWQodHJ1ZSk7XG4gICAgICAgICAgICAgICAgUHJlc2V0Q29udHJvbGxlci5hcHBseShwcmVzZXQuX2lkKTtcbiAgICAgICAgICAgICAgICBTZXR0aW5ncy5zZXRFdmVudERpc2FibGVkKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBTZXR0aW5ncy51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICBNb2Rlc05vdGljZS51cGRhdGUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZXhwb3J0cy51cGRhdGVQcmVzZXRDb21tYW5kcyA9IHVwZGF0ZVByZXNldENvbW1hbmRzO1xuY29uc3QgY29tbWFuZHNSZXBlYXRRdW90ZXMgPSB7XG4gICAgdGl0bGU6IFwiUmVwZWF0IHF1b3Rlcy4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJyZXBlYXRRdW90ZXNcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFJlcGVhdFF1b3Rlc09mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRSZXBlYXRRdW90ZXMoXCJvZmZcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRSZXBlYXRRdW90ZXNUeXBpbmdcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwidHlwaW5nXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJ0eXBpbmdcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UmVwZWF0UXVvdGVzKFwidHlwaW5nXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzTGl2ZVdwbSA9IHtcbiAgICB0aXRsZTogXCJMaXZlIFdQTS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJzaG93TGl2ZVdwbVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0TGl2ZVdwbU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2hvd0xpdmVXcG0oZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0TGl2ZVdwbU9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2hvd0xpdmVXcG0odHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNTaG93QXZlcmFnZSA9IHtcbiAgICB0aXRsZTogXCJTaG93IGF2ZXJhZ2UuLi5cIixcbiAgICBjb25maWdLZXk6IFwic2hvd0F2ZXJhZ2VcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNob3dBdmVyYWdlT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNob3dBdmVyYWdlKFwib2ZmXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U2hvd0F2ZXJhZ2VTcGVlZFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJ3cG1cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIndwbVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaG93QXZlcmFnZShcIndwbVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNob3dBdmVyYWdlQWNjXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImFjY3VyYWN5XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJhY2NcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2hvd0F2ZXJhZ2UoXCJhY2NcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTaG93QXZlcmFnZUJvdGhcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiYm90aFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiYm90aFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaG93QXZlcmFnZShcImJvdGhcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNMaXZlQWNjID0ge1xuICAgIHRpdGxlOiBcIkxpdmUgYWNjdXJhY3kuLi5cIixcbiAgICBjb25maWdLZXk6IFwic2hvd0xpdmVBY2NcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldExpdmVBY2NPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNob3dMaXZlQWNjKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldExpdmVBY2NPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNob3dMaXZlQWNjKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzTGl2ZUJ1cnN0ID0ge1xuICAgIHRpdGxlOiBcIkxpdmUgYnVyc3QuLi5cIixcbiAgICBjb25maWdLZXk6IFwic2hvd0xpdmVCdXJzdFwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0TGl2ZUJ1cnN0T2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaG93TGl2ZUJ1cnN0KGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldExpdmVCdXJzdE9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2hvd0xpdmVCdXJzdCh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1Nob3dUaW1lciA9IHtcbiAgICB0aXRsZTogXCJUaW1lci9wcm9ncmVzcy4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJzaG93VGltZXJQcm9ncmVzc1wiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0VGltZXJQcm9ncmVzc09mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2hvd1RpbWVyUHJvZ3Jlc3MoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0VGltZXJQcm9ncmVzc09uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2hvd1RpbWVyUHJvZ3Jlc3ModHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNLZXlUaXBzID0ge1xuICAgIHRpdGxlOiBcIktleSB0aXBzLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInNob3dLZXlUaXBzXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRLZXlUaXBzT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXlUaXBzKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEtleVRpcHNPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleVRpcHModHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNGcmVlZG9tTW9kZSA9IHtcbiAgICB0aXRsZTogXCJGcmVlZG9tIG1vZGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwiZnJlZWRvbU1vZGVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldGZyZWVkb21Nb2RlT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGcmVlZG9tTW9kZShmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRmcmVlZG9tTW9kZU9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RnJlZWRvbU1vZGUodHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNTdHJpY3RTcGFjZSA9IHtcbiAgICB0aXRsZTogXCJTdHJpY3Qgc3BhY2UuLi5cIixcbiAgICBjb25maWdLZXk6IFwic3RyaWN0U3BhY2VcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFN0cmljdFNwYWNlT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTdHJpY3RTcGFjZShmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTdHJpY3RTcGFjZU9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U3RyaWN0U3BhY2UodHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNCbGluZE1vZGUgPSB7XG4gICAgdGl0bGU6IFwiQmxpbmQgbW9kZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJibGluZE1vZGVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEJsaW5kTW9kZU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0QmxpbmRNb2RlKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEJsaW5kTW9kZU9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0QmxpbmRNb2RlKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzU2hvd1dvcmRzSGlzdG9yeSA9IHtcbiAgICB0aXRsZTogXCJBbHdheXMgc2hvdyB3b3JkcyBoaXN0b3J5Li4uXCIsXG4gICAgY29uZmlnS2V5OiBcImFsd2F5c1Nob3dXb3Jkc0hpc3RvcnlcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEFsd2F5c1Nob3dXb3Jkc0hpc3RvcnlPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEFsd2F5c1Nob3dXb3Jkc0hpc3RvcnkoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0QWx3YXlzU2hvd1dvcmRzSGlzdG9yeU9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0QWx3YXlzU2hvd1dvcmRzSGlzdG9yeSh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0luZGljYXRlVHlwb3MgPSB7XG4gICAgdGl0bGU6IFwiSW5kaWNhdGUgdHlwb3MuLi5cIixcbiAgICBjb25maWdLZXk6IFwiaW5kaWNhdGVUeXBvc1wiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0SW5kaWNhdGVUeXBvc09mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRJbmRpY2F0ZVR5cG9zKFwib2ZmXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0SW5kaWNhdGVUeXBvc0JlbG93XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImJlbG93XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJiZWxvd1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRJbmRpY2F0ZVR5cG9zKFwiYmVsb3dcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRJbmRpY2F0ZVR5cG9zUmVwbGFjZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJyZXBsYWNlXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJyZXBsYWNlXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEluZGljYXRlVHlwb3MoXCJyZXBsYWNlXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzSGlkZUV4dHJhTGV0dGVycyA9IHtcbiAgICB0aXRsZTogXCJIaWRlIGV4dHJhIGxldHRlcnMuLi5cIixcbiAgICBjb25maWdLZXk6IFwiaGlkZUV4dHJhTGV0dGVyc1wiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0SGlkZUV4dHJhTGV0dGVyc09mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0SGlkZUV4dHJhTGV0dGVycyhmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRIaWRlRXh0cmFMZXR0ZXJzT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRIaWRlRXh0cmFMZXR0ZXJzKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzUXVpY2tFbmQgPSB7XG4gICAgdGl0bGU6IFwiUXVpY2sgZW5kLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInF1aWNrRW5kXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRRdWlja0VuZE9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UXVpY2tFbmQoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UXVpY2tFbmRPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFF1aWNrRW5kKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzT3Bwb3NpdGVTaGlmdE1vZGUgPSB7XG4gICAgdGl0bGU6IFwiQ2hhbmdlIG9wcG9zaXRlIHNoaWZ0IG1vZGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwib3Bwb3NpdGVTaGlmdE1vZGVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldE9wcG9zaXRlU2hpZnRNb2RlT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE9wcG9zaXRlU2hpZnRNb2RlKFwib2ZmXCIpO1xuICAgICAgICAgICAgICAgIE1vZGVzTm90aWNlLnVwZGF0ZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0T3Bwb3NpdGVTaGlmdE1vZGVPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib25cIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0T3Bwb3NpdGVTaGlmdE1vZGUoXCJvblwiKTtcbiAgICAgICAgICAgICAgICBNb2Rlc05vdGljZS51cGRhdGUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldE9wcG9zaXRlU2hpZnRNb2RlS2V5bWFwXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImtleW1hcFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwia2V5bWFwXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE9wcG9zaXRlU2hpZnRNb2RlKFwia2V5bWFwXCIpO1xuICAgICAgICAgICAgICAgIE1vZGVzTm90aWNlLnVwZGF0ZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzU291bmRPbkVycm9yID0ge1xuICAgIHRpdGxlOiBcIlNvdW5kIG9uIGVycm9yLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInBsYXlTb3VuZE9uRXJyb3JcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFBsYXlTb3VuZE9uRXJyb3JPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBsYXlTb3VuZE9uRXJyb3IoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UGxheVNvdW5kT25FcnJvck9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGxheVNvdW5kT25FcnJvcih0cnVlKTtcbiAgICAgICAgICAgICAgICBTb3VuZC5wbGF5RXJyb3IoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1NvdW5kVm9sdW1lID0ge1xuICAgIHRpdGxlOiBcIlNvdW5kIHZvbHVtZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJzb3VuZFZvbHVtZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U291bmRWb2x1bWUwLjFcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwicXVpZXRcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjAuMVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTb3VuZFZvbHVtZShcIjAuMVwiKTtcbiAgICAgICAgICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNvdW5kVm9sdW1lMC41XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm1lZGl1bVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiMC41XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNvdW5kVm9sdW1lKFwiMC41XCIpO1xuICAgICAgICAgICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U291bmRWb2x1bWUxLjBcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibG91ZFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiMS4wXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNvdW5kVm9sdW1lKFwiMS4wXCIpO1xuICAgICAgICAgICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzRmxpcFRlc3RDb2xvcnMgPSB7XG4gICAgdGl0bGU6IFwiRmxpcCB0ZXN0IGNvbG9ycy4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJmbGlwVGVzdENvbG9yc1wiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0RmxpcFRlc3RDb2xvcnNPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZsaXBUZXN0Q29sb3JzKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEZsaXBUZXN0Q29sb3JzT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGbGlwVGVzdENvbG9ycyh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1Ntb290aExpbmVTY3JvbGwgPSB7XG4gICAgdGl0bGU6IFwiU21vb3RoIGxpbmUgc2Nyb2xsLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInNtb290aExpbmVTY3JvbGxcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNtb290aExpbmVTY3JvbGxPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNtb290aExpbmVTY3JvbGwoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U21vb3RoTGluZVNjcm9sbE9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U21vb3RoTGluZVNjcm9sbCh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0Fsd2F5c1Nob3dEZWNpbWFsID0ge1xuICAgIHRpdGxlOiBcIkFsd2F5cyBzaG93IGRlY2ltYWwgcGxhY2VzLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRBbHdheXNTaG93RGVjaW1hbFBsYWNlc09mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0QWx3YXlzU2hvd0RlY2ltYWxQbGFjZXMoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0QWx3YXlzU2hvd0RlY2ltYWxQbGFjZXNPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzQWx3YXlzU2hvd0NQTSA9IHtcbiAgICB0aXRsZTogXCJBbHdheXMgc2hvdyBDUE0uLi5cIixcbiAgICBjb25maWdLZXk6IFwiYWx3YXlzU2hvd0NQTVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0QWx3YXlzU2hvd0NQTU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0QWx3YXlzU2hvd0NQTShmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRBbHdheXNTaG93Q1BNT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRBbHdheXNTaG93Q1BNKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzU3RhcnRHcmFwaHNBdFplcm8gPSB7XG4gICAgdGl0bGU6IFwiU3RhcnQgZ3JhcGhzIGF0IHplcm8uLi5cIixcbiAgICBjb25maWdLZXk6IFwic3RhcnRHcmFwaHNBdFplcm9cIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFN0YXJ0R3JhcGhzQXRaZXJvT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTdGFydEdyYXBoc0F0WmVybyhmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTdGFydEdyYXBoc0F0WmVyb09uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U3RhcnRHcmFwaHNBdFplcm8odHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNMYXp5TW9kZSA9IHtcbiAgICB0aXRsZTogXCJMYXp5IG1vZGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwibGF6eU1vZGVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldExhenlNb2RlT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRMYXp5TW9kZShmYWxzZSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldExhenlNb2RlT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRMYXp5TW9kZSh0cnVlKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzU3dhcEVzY0FuZFRhYiA9IHtcbiAgICB0aXRsZTogXCJTd2FwIGVzYyBhbmQgdGFiLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInN3YXBFc2NBbmRUYWJcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFN3YXBFc2NBbmRUYWJPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFN3YXBFc2NBbmRUYWIoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U3dhcEVzY0FuZFRhYk9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U3dhcEVzY0FuZFRhYih0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1Nob3dBbGxMaW5lcyA9IHtcbiAgICB0aXRsZTogXCJTaG93IGFsbCBsaW5lcy4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJzaG93QWxsTGluZXNcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNob3dBbGxMaW5lc09mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2hvd0FsbExpbmVzKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNob3dBbGxMaW5lc09uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U2hvd0FsbExpbmVzKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzQ29sb3JmdWxNb2RlID0ge1xuICAgIHRpdGxlOiBcIkNvbG9yZnVsIG1vZGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwiY29sb3JmdWxNb2RlXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRDb2xvcmZ1bE1vZGVPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldENvbG9yZnVsTW9kZShmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRDb2xvcmZ1bE1vZGVPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldENvbG9yZnVsTW9kZSh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc091dE9mRm9jdXNXYXJuaW5nID0ge1xuICAgIHRpdGxlOiBcIkNvbG9yZnVsIG1vZGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwic2hvd091dE9mRm9jdXNXYXJuaW5nXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTaG93T3V0T2ZGb2N1c1dhcm5pbmdPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNob3dPdXRPZkZvY3VzV2FybmluZyhmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTaG93T3V0T2ZGb2N1c1dhcm5pbmdPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNob3dPdXRPZkZvY3VzV2FybmluZyh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0tleW1hcE1vZGUgPSB7XG4gICAgdGl0bGU6IFwiS2V5bWFwIG1vZGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwia2V5bWFwTW9kZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0S2V5bWFwTW9kZU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBNb2RlKFwib2ZmXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0S2V5bWFwTW9kZVN0YXRpY1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJzdGF0aWNcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcInN0YXRpY1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBNb2RlKFwic3RhdGljXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0S2V5bWFwTW9kZU5leHRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibmV4dFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwibmV4dFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBNb2RlKFwibmV4dFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEtleW1hcE1vZGVSZWFjdFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJyZWFjdFwiLFxuICAgICAgICAgICAgYWxpYXM6IFwiZmxhc2hcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcInJlYWN0XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcE1vZGUoXCJyZWFjdFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1NvdW5kT25DbGljayA9IHtcbiAgICB0aXRsZTogXCJTb3VuZCBvbiBjbGljay4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJwbGF5U291bmRPbkNsaWNrXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTb3VuZE9uQ2xpY2tPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGxheVNvdW5kT25DbGljayhcIm9mZlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNvdW5kT25DbGljazFcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiY2xpY2tcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjFcIixcbiAgICAgICAgICAgIGhvdmVyOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgU291bmQucHJldmlld0NsaWNrKFwiMVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBsYXlTb3VuZE9uQ2xpY2soXCIxXCIpO1xuICAgICAgICAgICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0U291bmRPbkNsaWNrMlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJiZWVwXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCIyXCIsXG4gICAgICAgICAgICBob3ZlcjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFNvdW5kLnByZXZpZXdDbGljayhcIjJcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQbGF5U291bmRPbkNsaWNrKFwiMlwiKTtcbiAgICAgICAgICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNvdW5kT25DbGljazNcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwicG9wXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCIzXCIsXG4gICAgICAgICAgICBob3ZlcjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFNvdW5kLnByZXZpZXdDbGljayhcIjNcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQbGF5U291bmRPbkNsaWNrKFwiM1wiKTtcbiAgICAgICAgICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNvdW5kT25DbGljazRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibmsgY3JlYW1zXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCI0XCIsXG4gICAgICAgICAgICBob3ZlcjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFNvdW5kLnByZXZpZXdDbGljayhcIjRcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQbGF5U291bmRPbkNsaWNrKFwiNFwiKTtcbiAgICAgICAgICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFNvdW5kT25DbGljazVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwidHlwZXdyaXRlclwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiNVwiLFxuICAgICAgICAgICAgaG92ZXI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBTb3VuZC5wcmV2aWV3Q2xpY2soXCI1XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGxheVNvdW5kT25DbGljayhcIjVcIik7XG4gICAgICAgICAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTb3VuZE9uQ2xpY2s2XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9zdVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiNlwiLFxuICAgICAgICAgICAgaG92ZXI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBTb3VuZC5wcmV2aWV3Q2xpY2soXCI2XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGxheVNvdW5kT25DbGljayhcIjZcIik7XG4gICAgICAgICAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRTb3VuZE9uQ2xpY2s3XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImhpdG1hcmtlclwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiN1wiLFxuICAgICAgICAgICAgaG92ZXI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBTb3VuZC5wcmV2aWV3Q2xpY2soXCI3XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGxheVNvdW5kT25DbGljayhcIjdcIik7XG4gICAgICAgICAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNSYW5kb21UaGVtZSA9IHtcbiAgICB0aXRsZTogXCJSYW5kb20gdGhlbWUuLi5cIixcbiAgICBjb25maWdLZXk6IFwicmFuZG9tVGhlbWVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFJhbmRvbU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRSYW5kb21UaGVtZShcIm9mZlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFJhbmRvbU9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvblwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRSYW5kb21UaGVtZShcIm9uXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UmFuZG9tRmF2XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImZhdlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiZmF2XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFJhbmRvbVRoZW1lKFwiZmF2XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UmFuZG9tTGlnaHRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibGlnaHRcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImxpZ2h0XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFJhbmRvbVRoZW1lKFwibGlnaHRcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRSYW5kb21EYXJrXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImRhcmtcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImRhcmtcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UmFuZG9tVGhlbWUoXCJkYXJrXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UmFuZG9tQ3VzdG9tXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImN1c3RvbVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiY3VzdG9tXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIk11bHRpcGxlIGN1c3RvbSB0aGVtZXMgYXJlIGF2YWlsYWJsZSB0byBsb2dnZWQgaW4gdXNlcnMgb25seVwiLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UmFuZG9tVGhlbWUoXCJjdXN0b21cIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNEaWZmaWN1bHR5ID0ge1xuICAgIHRpdGxlOiBcIkRpZmZpY3VsdHkuLi5cIixcbiAgICBjb25maWdLZXk6IFwiZGlmZmljdWx0eVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0RGlmZmljdWx0eU5vcm1hbFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJub3JtYWxcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm5vcm1hbFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXREaWZmaWN1bHR5KFwibm9ybWFsXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0RGlmZmljdWx0eUV4cGVydFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJleHBlcnRcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImV4cGVydFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXREaWZmaWN1bHR5KFwiZXhwZXJ0XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0RGlmZmljdWx0eU1hc3RlclwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJtYXN0ZXJcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm1hc3RlclwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXREaWZmaWN1bHR5KFwibWFzdGVyXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmV4cG9ydHMuY29tbWFuZHNFbmFibGVBZHMgPSB7XG4gICAgdGl0bGU6IFwiU2V0IGVuYWJsZSBhZHMuLi5cIixcbiAgICBjb25maWdLZXk6IFwiZW5hYmxlQWRzXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRFbmFibGVBZHNPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RW5hYmxlQWRzKFwib2ZmXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0RW5hYmxlQWRzT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9uXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEVuYWJsZUFkcyhcIm9uXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0RW5hYmxlTWF4XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInNlbGxvdXRcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm1heFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRFbmFibGVBZHMoXCJtYXhcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuZXhwb3J0cy5jdXN0b21UaGVtZUNvbW1hbmRzID0ge1xuICAgIHRpdGxlOiBcIkN1c3RvbSB0aGVtZVwiLFxuICAgIGNvbmZpZ0tleTogXCJjdXN0b21UaGVtZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0Q3VzdG9tVGhlbWVPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEN1c3RvbVRoZW1lT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZSh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5leHBvcnRzLmN1c3RvbVRoZW1lTGlzdENvbW1hbmRzID0ge1xuICAgIHRpdGxlOiBcIkN1c3RvbSB0aGVtZXMgbGlzdC4uLlwiLFxuICAgIC8vIGNvbmZpZ0tleTogXCJjdXN0b21UaGVtZUlkXCIsXG4gICAgbGlzdDogW10sXG59O1xuZnVuY3Rpb24gdXBkYXRlQ3VzdG9tVGhlbWVMaXN0Q29tbWFuZHMoKSB7XG4gICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGV4cG9ydHMuY3VzdG9tVGhlbWVMaXN0Q29tbWFuZHMubGlzdCA9IFtdO1xuICAgIGNvbnN0IHNuYXBzaG90ID0gREIuZ2V0U25hcHNob3QoKTtcbiAgICBpZiAoIXNuYXBzaG90KVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKERCLmdldFNuYXBzaG90KCkuY3VzdG9tVGhlbWVzLmxlbmd0aCA8IDApIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJZb3UgbmVlZCB0byBjcmVhdGUgYSBjdXN0b20gdGhlbWUgZmlyc3RcIiwgMCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgREIuZ2V0U25hcHNob3QoKS5jdXN0b21UaGVtZXMuZm9yRWFjaCgodGhlbWUpID0+IHtcbiAgICAgICAgZXhwb3J0cy5jdXN0b21UaGVtZUxpc3RDb21tYW5kcy5saXN0LnB1c2goe1xuICAgICAgICAgICAgaWQ6IFwic2V0Q3VzdG9tVGhlbWVJZFwiICsgdGhlbWUuX2lkLFxuICAgICAgICAgICAgZGlzcGxheTogdGhlbWUubmFtZSxcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0aGVtZS5faWQsXG4gICAgICAgICAgICBob3ZlcjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFRoZW1lQ29udHJvbGxlci5wcmV2aWV3KHRoZW1lLl9pZCwgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZUlkKHRoZW1lLl9pZCk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lKHRydWUpO1xuICAgICAgICAgICAgICAgIFRoZW1lQ29udHJvbGxlci5zZXQodGhlbWUuX2lkLCB0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIHJldHVybjtcbn1cbmV4cG9ydHMudXBkYXRlQ3VzdG9tVGhlbWVMaXN0Q29tbWFuZHMgPSB1cGRhdGVDdXN0b21UaGVtZUxpc3RDb21tYW5kcztcbmNvbnN0IGNvbW1hbmRzQ2FyZXRTdHlsZSA9IHtcbiAgICB0aXRsZTogXCJDaGFuZ2UgY2FyZXQgc3R5bGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwiY2FyZXRTdHlsZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0Q2FyZXRTdHlsZU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDYXJldFN0eWxlKFwib2ZmXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0Q2FyZXRTdHlsZURlZmF1bHRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibGluZVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiZGVmYXVsdFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDYXJldFN0eWxlKFwiZGVmYXVsdFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldENhcmV0U3R5bGVCbG9ja1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJibG9ja1wiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiYmxvY2tcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q2FyZXRTdHlsZShcImJsb2NrXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0Q2FyZXRTdHlsZU91dGxpbmVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib3V0bGluZS1ibG9ja1wiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib3V0bGluZVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDYXJldFN0eWxlKFwib3V0bGluZVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldENhcmV0U3R5bGVVbmRlcmxpbmVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwidW5kZXJsaW5lXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJ1bmRlcmxpbmVcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q2FyZXRTdHlsZShcInVuZGVybGluZVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldENhcmV0U3R5bGVDYXJyb3RcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiY2Fycm90XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJjYXJyb3RcIixcbiAgICAgICAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDYXJldFN0eWxlKFwiY2Fycm90XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0Q2FyZXRTdHlsZUJhbmFuYVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJiYW5hbmFcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImJhbmFuYVwiLFxuICAgICAgICAgICAgdmlzaWJsZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldENhcmV0U3R5bGUoXCJiYW5hbmFcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNQYWNlQ2FyZXRTdHlsZSA9IHtcbiAgICB0aXRsZTogXCJDaGFuZ2UgcGFjZSBjYXJldCBzdHlsZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJwYWNlQ2FyZXRTdHlsZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UGFjZUNhcmV0U3R5bGVEZWZhdWx0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImxpbmVcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImRlZmF1bHRcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGFjZUNhcmV0U3R5bGUoXCJkZWZhdWx0XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UGFjZUNhcmV0U3R5bGVCbG9ja1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJibG9ja1wiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiYmxvY2tcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGFjZUNhcmV0U3R5bGUoXCJibG9ja1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFBhY2VDYXJldFN0eWxlT3V0bGluZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvdXRsaW5lLWJsb2NrXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvdXRsaW5lXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBhY2VDYXJldFN0eWxlKFwib3V0bGluZVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFBhY2VDYXJldFN0eWxlVW5kZXJsaW5lXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInVuZGVybGluZVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwidW5kZXJsaW5lXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBhY2VDYXJldFN0eWxlKFwidW5kZXJsaW5lXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UGFjZUNhcmV0U3R5bGVDYXJyb3RcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiY2Fycm90XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJjYXJyb3RcIixcbiAgICAgICAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWNlQ2FyZXRTdHlsZShcImNhcnJvdFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFBhY2VDYXJldFN0eWxlQmFuYW5hXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImJhbmFuYVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiYmFuYW5hXCIsXG4gICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGFjZUNhcmV0U3R5bGUoXCJiYW5hbmFcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNSZXBlYXRlZFBhY2UgPSB7XG4gICAgdGl0bGU6IFwiUmVwZWF0ZWQgcGFjZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJyZXBlYXRlZFBhY2VcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFJlcGVhdGVkUGFjZU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UmVwZWF0ZWRQYWNlKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFJlcGVhdGVkUGFjZU9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UmVwZWF0ZWRQYWNlKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzUGFjZUNhcmV0ID0ge1xuICAgIHRpdGxlOiBcIlBhY2UgY2FyZXQgbW9kZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJwYWNlQ2FyZXRcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFBhY2VDYXJldE9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWNlQ2FyZXQoXCJvZmZcIik7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFBhY2VDYXJldFBiXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInBiXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJwYlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWNlQ2FyZXQoXCJwYlwiKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UGFjZUNhcmV0QXZlcmFnZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJhdmVyYWdlXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJhdmVyYWdlXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBhY2VDYXJldChcImF2ZXJhZ2VcIik7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFBhY2VDYXJldEN1c3RvbVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJjdXN0b20uLi5cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImN1c3RvbVwiLFxuICAgICAgICAgICAgaW5wdXQ6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoaW5wdXQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWlucHV0KVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBhY2VDYXJldEN1c3RvbVNwZWVkKHBhcnNlSW50KGlucHV0KSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBhY2VDYXJldChcImN1c3RvbVwiKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzTWluV3BtID0ge1xuICAgIHRpdGxlOiBcIkNoYW5nZSBtaW4gd3BtIG1vZGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwibWluV3BtXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRNaW5XcG1PZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TWluV3BtKFwib2ZmXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0TWluV3BtQ3VzdG9tXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImN1c3RvbS4uLlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiY3VzdG9tXCIsXG4gICAgICAgICAgICBpbnB1dDogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6IChpbnB1dCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghaW5wdXQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TWluV3BtQ3VzdG9tU3BlZWQocGFyc2VJbnQoaW5wdXQpKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TWluV3BtKFwiY3VzdG9tXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzTWluQWNjID0ge1xuICAgIHRpdGxlOiBcIkNoYW5nZSBtaW4gYWNjdXJhY3kgbW9kZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJtaW5BY2NcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldE1pbkFjY09mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNaW5BY2MoXCJvZmZcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRNaW5BY2NDdXN0b21cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiY3VzdG9tLi4uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJjdXN0b21cIixcbiAgICAgICAgICAgIGlucHV0OiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKGlucHV0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFpbnB1dClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNaW5BY2NDdXN0b20ocGFyc2VJbnQoaW5wdXQpKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TWluQWNjKFwiY3VzdG9tXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzTWluQnVyc3QgPSB7XG4gICAgdGl0bGU6IFwiQ2hhbmdlIG1pbiBidXJzdCBtb2RlLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcIm1pbkJ1cnN0XCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRNaW5CdXJzdE9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNaW5CdXJzdChcIm9mZlwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldE1pbkJ1cnN0Rml4ZWRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiZml4ZWQuLi5cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImZpeGVkXCIsXG4gICAgICAgICAgICBpbnB1dDogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6IChpbnB1dCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghaW5wdXQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TWluQnVyc3QoXCJmaXhlZFwiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TWluQnVyc3RDdXN0b21TcGVlZChwYXJzZUludChpbnB1dCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0TWluQnVyc3RGbGV4XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImZsZXguLi5cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImZsZXhcIixcbiAgICAgICAgICAgIGlucHV0OiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKGlucHV0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFpbnB1dClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNaW5CdXJzdChcImZsZXhcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1pbkJ1cnN0Q3VzdG9tU3BlZWQocGFyc2VJbnQoaW5wdXQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0tleW1hcFN0eWxlID0ge1xuICAgIHRpdGxlOiBcIktleW1hcCBzdHlsZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJrZXltYXBTdHlsZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0S2V5bWFwU3R5bGVTdGFnZ2VyZWRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwic3RhZ2dlcmVkXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJzdGFnZ2VyZWRcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwU3R5bGUoXCJzdGFnZ2VyZWRcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRLZXltYXBTdHlsZUFsaWNlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImFsaWNlXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJhbGljZVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBTdHlsZShcImFsaWNlXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0S2V5bWFwU3R5bGVNYXRyaXhcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibWF0cml4XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJtYXRyaXhcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwU3R5bGUoXCJtYXRyaXhcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRLZXltYXBTdHlsZVNwbGl0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInNwbGl0XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJzcGxpdFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBTdHlsZShcInNwbGl0XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0S2V5bWFwU3R5bGVTcGxpdE1hdHJpeFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJzcGxpdCBtYXRyaXhcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcInNwbGl0X21hdHJpeFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBTdHlsZShcInNwbGl0X21hdHJpeFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0tleW1hcExlZ2VuZFN0eWxlID0ge1xuICAgIHRpdGxlOiBcIktleW1hcCBsZWdlbmQgc3R5bGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwia2V5bWFwTGVnZW5kU3R5bGVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEtleW1hcExlZ2VuZFN0eWxlTG93ZXJjYXNlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImxvd2VyY2FzZVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwibG93ZXJjYXNlXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcExlZ2VuZFN0eWxlKFwibG93ZXJjYXNlXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0S2V5bWFwTGVnZW5kU3R5bGVVcHBlcmNhc2VcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwidXBwZXJjYXNlXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJ1cHBlcmNhc2VcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTGVnZW5kU3R5bGUoXCJ1cHBlcmNhc2VcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRLZXltYXBMZWdlbmRTdHlsZUJsYW5rXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImJsYW5rXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJibGFua1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBMZWdlbmRTdHlsZShcImJsYW5rXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0S2V5bWFwTGVnZW5kU3R5bGVEeW5hbWljXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImR5bmFtaWNcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImR5bmFtaWNcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTGVnZW5kU3R5bGUoXCJkeW5hbWljXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzQnJpdGlzaEVuZ2xpc2ggPSB7XG4gICAgdGl0bGU6IFwiQnJpdGlzaCBlbmdsaXNoLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcImJyaXRpc2hFbmdsaXNoXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRCcml0aXNoRW5nbGlzaE9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0QnJpdGlzaEVuZ2xpc2goZmFsc2UpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRCcml0aXNoRW5nbGlzaE9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0QnJpdGlzaEVuZ2xpc2godHJ1ZSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0hpZ2hsaWdodE1vZGUgPSB7XG4gICAgdGl0bGU6IFwiSGlnaGxpZ2h0IG1vZGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwiaGlnaGxpZ2h0TW9kZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0SGlnaGxpZ2h0TW9kZU9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm9mZlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRIaWdobGlnaHRNb2RlKFwib2ZmXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0SGlnaGxpZ2h0TW9kZUxldHRlclwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJsZXR0ZXJcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImxldHRlclwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRIaWdobGlnaHRNb2RlKFwibGV0dGVyXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0SGlnaGxpZ2h0TW9kZVdvcmRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwid29yZFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwid29yZFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRIaWdobGlnaHRNb2RlKFwid29yZFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc1RpbWVyU3R5bGUgPSB7XG4gICAgdGl0bGU6IFwiVGltZXIvcHJvZ3Jlc3Mgc3R5bGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwidGltZXJTdHlsZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0VGltZXJTdHlsZUJhclwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJiYXJcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImJhclwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lclN0eWxlKFwiYmFyXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0VGltZXJTdHlsZVRleHRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwidGV4dFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwidGV4dFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lclN0eWxlKFwidGV4dFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFRpbWVyU3R5bGVNaW5pXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm1pbmlcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm1pbmlcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZXJTdHlsZShcIm1pbmlcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNUaW1lckNvbG9yID0ge1xuICAgIHRpdGxlOiBcIlRpbWVyL3Byb2dyZXNzIGNvbG9yLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInRpbWVyQ29sb3JcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFRpbWVyQ29sb3JCbGFja1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJibGFja1wiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZXJDb2xvcihcImJsYWNrXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0VGltZXJDb2xvclN1YlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJzdWJcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcInN1YlwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lckNvbG9yKFwic3ViXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0VGltZXJDb2xvclRleHRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwidGV4dFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwidGV4dFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lckNvbG9yKFwidGV4dFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFRpbWVyQ29sb3JNYWluXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm1haW5cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIm1haW5cIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZXJDb2xvcihcIm1haW5cIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNTaW5nbGVMaXN0Q29tbWFuZExpbmUgPSB7XG4gICAgdGl0bGU6IFwiU2luZ2xlIGxpc3QgY29tbWFuZCBsaW5lLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInNpbmdsZUxpc3RDb21tYW5kTGluZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2luZ2xlTGlzdENvbW1hbmRMaW5lTWFudWFsXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm1hbnVhbFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwibWFudWFsXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNpbmdsZUxpc3RDb21tYW5kTGluZShcIm1hbnVhbFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNpbmdsZUxpc3RDb21tYW5kTGluZU9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvblwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTaW5nbGVMaXN0Q29tbWFuZExpbmUoXCJvblwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0NhcHNMb2NrV2FybmluZyA9IHtcbiAgICB0aXRsZTogXCJDYXBzIGxvY2sgd2FybmluZy4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJjYXBzTG9ja1dhcm5pbmdcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNhcHNMb2NrV2FybmluZ09uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9uXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q2Fwc0xvY2tXYXJuaW5nKHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2Fwc0xvY2tXYXJuaW5nT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDYXBzTG9ja1dhcm5pbmcoZmFsc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzVGltZXJPcGFjaXR5ID0ge1xuICAgIHRpdGxlOiBcIlRpbWVyL3Byb2dyZXNzIG9wYWNpdHkuLi5cIixcbiAgICBjb25maWdLZXk6IFwidGltZXJPcGFjaXR5XCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRUaW1lck9wYWNpdHkuMjVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiLjI1XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMC4yNSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZXJPcGFjaXR5KFwiMC4yNVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFRpbWVyT3BhY2l0eS41XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIi41XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMC41LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lck9wYWNpdHkoXCIwLjVcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRUaW1lck9wYWNpdHkuNzVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiLjc1XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMC43NSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZXJPcGFjaXR5KFwiMC43NVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFRpbWVyT3BhY2l0eTFcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiMVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDEsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVyT3BhY2l0eShcIjFcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNXb3JkQ291bnQgPSB7XG4gICAgdGl0bGU6IFwiQ2hhbmdlIHdvcmQgY291bnQuLi5cIixcbiAgICBjb25maWdLZXk6IFwid29yZHNcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVdvcmRDb3VudDEwXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjEwXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMTAsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ3b3Jkc1wiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0V29yZENvdW50KDEwKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlV29yZENvdW50MjVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiMjVcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAyNSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcIndvcmRzXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRXb3JkQ291bnQoMjUpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VXb3JkQ291bnQ1MFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCI1MFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDUwLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwid29yZHNcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFdvcmRDb3VudCg1MCk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVdvcmRDb3VudDEwMFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIxMDBcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAxMDAsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ3b3Jkc1wiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0V29yZENvdW50KDEwMCk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVdvcmRDb3VudDIwMFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIyMDBcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAyMDAsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJ3b3Jkc1wiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0V29yZENvdW50KDIwMCk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVdvcmRDb3VudEN1c3RvbVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJjdXN0b20uLi5cIixcbiAgICAgICAgICAgIGlucHV0OiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKGlucHV0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFpbnB1dClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwid29yZHNcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFdvcmRDb3VudChwYXJzZUludChpbnB1dCkpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNRdW90ZUxlbmd0aENvbmZpZyA9IHtcbiAgICB0aXRsZTogXCJDaGFuZ2UgcXVvdGUgbGVuZ3RoLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcInF1b3RlTGVuZ3RoXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VRdW90ZUxlbmd0aEFsbFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJhbGxcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBbMCwgMSwgMiwgM10sXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJxdW90ZVwiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UXVvdGVMZW5ndGgoWzAsIDEsIDIsIDNdKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUXVvdGVMZW5ndGhTaG9ydFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJzaG9ydFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDAsXG4gICAgICAgICAgICBjb25maWdWYWx1ZU1vZGU6IFwiaW5jbHVkZVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwicXVvdGVcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFF1b3RlTGVuZ3RoKDApO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VRdW90ZUxlbmd0aE1lZGl1bVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJtZWRpdW1cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAxLFxuICAgICAgICAgICAgY29uZmlnVmFsdWVNb2RlOiBcImluY2x1ZGVcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcInF1b3RlXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRRdW90ZUxlbmd0aCgxKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUXVvdGVMZW5ndGhMb25nXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImxvbmdcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAyLFxuICAgICAgICAgICAgY29uZmlnVmFsdWVNb2RlOiBcImluY2x1ZGVcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcInF1b3RlXCIpO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRRdW90ZUxlbmd0aCgyKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUXVvdGVMZW5ndGhUaGljY1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJ0aGljY1wiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDMsXG4gICAgICAgICAgICBjb25maWdWYWx1ZU1vZGU6IFwiaW5jbHVkZVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwicXVvdGVcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFF1b3RlTGVuZ3RoKDMpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNQdW5jdHVhdGlvbiA9IHtcbiAgICB0aXRsZTogXCJDaGFuZ2UgcHVuY3R1YXRpb24uLi5cIixcbiAgICBjb25maWdLZXk6IFwicHVuY3R1YXRpb25cIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVB1bmN0dWF0aW9uT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQdW5jdHVhdGlvbih0cnVlKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUHVuY3R1YXRpb25PZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFB1bmN0dWF0aW9uKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzTnVtYmVycyA9IHtcbiAgICB0aXRsZTogXCJOdW1iZXJzLi4uXCIsXG4gICAgY29uZmlnS2V5OiBcIm51bWJlcnNcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZU51bWJlcnNPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE51bWJlcnModHJ1ZSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZU51bWJlcnNPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE51bWJlcnMoZmFsc2UpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNTbW9vdGhDYXJldCA9IHtcbiAgICB0aXRsZTogXCJTbW9vdGggY2FyZXQuLi5cIixcbiAgICBjb25maWdLZXk6IFwic21vb3RoQ2FyZXRcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVNtb290aENhcmV0T25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTbW9vdGhDYXJldCh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVNtb290aENhcmV0T2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTbW9vdGhDYXJldChmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNRdWlja1RhYiA9IHtcbiAgICB0aXRsZTogXCJRdWljayB0YWIuLi5cIixcbiAgICBjb25maWdLZXk6IFwicXVpY2tUYWJcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVF1aWNrVGFiT25cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib25cIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRRdWlja1RhYk1vZGUodHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VRdWlja1RhYk9mZlwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvZmZcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UXVpY2tUYWJNb2RlKGZhbHNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc01vZGUgPSB7XG4gICAgdGl0bGU6IFwiQ2hhbmdlIG1vZGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwibW9kZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTW9kZVRpbWVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwidGltZVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwidGltZVwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwidGltZVwiKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTW9kZVdvcmRzXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIndvcmRzXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJ3b3Jkc1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwid29yZHNcIik7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZU1vZGVRdW90ZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJxdW90ZVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwicXVvdGVcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcInF1b3RlXCIpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VNb2RlQ3VzdG9tXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImN1c3RvbVwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiY3VzdG9tXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE1vZGUoXCJjdXN0b21cIik7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZU1vZGVaZW5cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiemVuXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJ6ZW5cIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcInplblwiKTtcbiAgICAgICAgICAgICAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNUaW1lQ29uZmlnID0ge1xuICAgIHRpdGxlOiBcIkNoYW5nZSB0aW1lIGNvbmZpZy4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJ0aW1lXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VUaW1lQ29uZmlnMTVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiMTVcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAxNSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcInRpbWVcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVDb25maWcoMTUpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VUaW1lQ29uZmlnMzBcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiMzBcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAzMCxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcInRpbWVcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVDb25maWcoMzApO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VUaW1lQ29uZmlnNjBcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiNjBcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiA2MCxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcInRpbWVcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVDb25maWcoNjApO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VUaW1lQ29uZmlnMTIwXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjEyMFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDEyMCxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcInRpbWVcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVDb25maWcoMTIwKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlVGltZUNvbmZpZ0N1c3RvbVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJjdXN0b20uLi5cIixcbiAgICAgICAgICAgIGlucHV0OiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKGlucHV0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFpbnB1dClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwidGltZVwiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGltZUNvbmZpZyhwYXJzZUludChpbnB1dCkpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNDb25maWRlbmNlTW9kZSA9IHtcbiAgICB0aXRsZTogXCJDb25maWRlbmNlIG1vZGUuLi5cIixcbiAgICBjb25maWdLZXk6IFwiY29uZmlkZW5jZU1vZGVcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUNvbmZpZGVuY2VNb2RlT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldENvbmZpZGVuY2VNb2RlKFwib2ZmXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlQ29uZmlkZW5jZU1vZGVPblwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJvblwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib25cIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q29uZmlkZW5jZU1vZGUoXCJvblwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUNvbmZpZGVuY2VNb2RlTWF4XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm1heFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwibWF4XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldENvbmZpZGVuY2VNb2RlKFwibWF4XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzU3RvcE9uRXJyb3IgPSB7XG4gICAgdGl0bGU6IFwiU3RvcCBvbiBlcnJvci4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJzdG9wT25FcnJvclwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU3RvcE9uRXJyb3JPZmZcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib2ZmXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJvZmZcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0U3RvcE9uRXJyb3IoXCJvZmZcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTdG9wT25FcnJvckxldHRlclwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJsZXR0ZXJcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcImxldHRlclwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRTdG9wT25FcnJvcihcImxldHRlclwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVN0b3BPbkVycm9yV29yZFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJ3b3JkXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJ3b3JkXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFN0b3BPbkVycm9yKFwid29yZFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc0ZvbnRTaXplID0ge1xuICAgIHRpdGxlOiBcIkZvbnQgc2l6ZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJmb250U2l6ZVwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlRm9udFNpemUxXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjF4XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogMSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Rm9udFNpemUoXCIxXCIpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VGb250U2l6ZTEyNVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIxLjI1eFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDEyNSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Rm9udFNpemUoXCIxMjVcIik7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUZvbnRTaXplMTVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiMS41eFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDE1LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGb250U2l6ZShcIjE1XCIpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VGb250U2l6ZTJcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiMnhcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiAyLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGb250U2l6ZShcIjJcIik7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUZvbnRTaXplM1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIzeFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IDMsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZvbnRTaXplKFwiM1wiKTtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlRm9udFNpemU0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjR4XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogNCxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Rm9udFNpemUoXCI0XCIpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuY29uc3QgY29tbWFuZHNQYWdlV2lkdGggPSB7XG4gICAgdGl0bGU6IFwiUGFnZSB3aWR0aC4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJwYWdlV2lkdGhcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFBhZ2VXaWR0aDEwMFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIxMDBcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjEwMFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWdlV2lkdGgoXCIxMDBcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRQYWdlV2lkdGgxMjVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiMTI1XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCIxMjVcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGFnZVdpZHRoKFwiMTI1XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2V0UGFnZVdpZHRoMTUwXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIjE1MFwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwiMTUwXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFBhZ2VXaWR0aChcIjE1MFwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldFBhZ2VXaWR0aDIwMFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCIyMDBcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjIwMFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQYWdlV2lkdGgoXCIyMDBcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRQYWdlV2lkdGhNYXhcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibWF4XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCJtYXhcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UGFnZVdpZHRoKFwibWF4XCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmNvbnN0IGNvbW1hbmRzUHJhY3Rpc2VXb3JkcyA9IHtcbiAgICB0aXRsZTogXCJQcmFjdGljZSB3b3Jkcy4uLlwiLFxuICAgIGxpc3Q6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwicHJhY3Rpc2VXb3Jkc01pc3NlZFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJtaXNzZWRcIixcbiAgICAgICAgICAgIG5vSWNvbjogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBQcmFjdGlzZVdvcmRzLmluaXQodHJ1ZSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KGZhbHNlLCBmYWxzZSwgdW5kZWZpbmVkLCB0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInByYWN0aXNlV29yZHNTbG93XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcInNsb3dcIixcbiAgICAgICAgICAgIG5vSWNvbjogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBQcmFjdGlzZVdvcmRzLmluaXQoZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KGZhbHNlLCBmYWxzZSwgdW5kZWZpbmVkLCB0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInByYWN0aXNlV29yZHNCb3RoXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImJvdGhcIixcbiAgICAgICAgICAgIG5vSWNvbjogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBQcmFjdGlzZVdvcmRzLmluaXQodHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoZmFsc2UsIGZhbHNlLCB1bmRlZmluZWQsIHRydWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICBdLFxufTtcbmV4cG9ydHMudGhlbWVDb21tYW5kcyA9IHtcbiAgICB0aXRsZTogXCJUaGVtZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJ0aGVtZVwiLFxuICAgIGxpc3Q6IFtdLFxufTtcbk1pc2MuZ2V0VGhlbWVzTGlzdCgpLnRoZW4oKHRoZW1lcykgPT4ge1xuICAgIHRoZW1lcy5mb3JFYWNoKCh0aGVtZSkgPT4ge1xuICAgICAgICBleHBvcnRzLnRoZW1lQ29tbWFuZHMubGlzdC5wdXNoKHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVRoZW1lXCIgKyBNaXNjLmNhcGl0YWxpemVGaXJzdExldHRlck9mRWFjaFdvcmQodGhlbWUubmFtZSksXG4gICAgICAgICAgICBkaXNwbGF5OiB0aGVtZS5uYW1lLnJlcGxhY2UoL18vZywgXCIgXCIpLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IHRoZW1lLm5hbWUsXG4gICAgICAgICAgICBob3ZlcjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIHByZXZpZXdUaGVtZSh0aGVtZS5uYW1lKTtcbiAgICAgICAgICAgICAgICBUaGVtZUNvbnRyb2xsZXIucHJldmlldyh0aGVtZS5uYW1lLCBmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaGVtZSh0aGVtZS5uYW1lKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG5leHBvcnRzLmNvbW1hbmRzQ2hhbGxlbmdlcyA9IHtcbiAgICB0aXRsZTogXCJMb2FkIGNoYWxsZW5nZS4uLlwiLFxuICAgIGxpc3Q6IFtdLFxufTtcbk1pc2MuZ2V0Q2hhbGxlbmdlTGlzdCgpLnRoZW4oKGNoYWxsZW5nZXMpID0+IHtcbiAgICBjaGFsbGVuZ2VzLmZvckVhY2goKGNoYWxsZW5nZSkgPT4ge1xuICAgICAgICBleHBvcnRzLmNvbW1hbmRzQ2hhbGxlbmdlcy5saXN0LnB1c2goe1xuICAgICAgICAgICAgaWQ6IFwibG9hZENoYWxsZW5nZVwiICsgTWlzYy5jYXBpdGFsaXplRmlyc3RMZXR0ZXJPZkVhY2hXb3JkKGNoYWxsZW5nZS5uYW1lKSxcbiAgICAgICAgICAgIG5vSWNvbjogdHJ1ZSxcbiAgICAgICAgICAgIGRpc3BsYXk6IGNoYWxsZW5nZS5kaXNwbGF5LFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIENoYWxsZW5nZUNvbnRyb2xsZXIuc2V0dXAoY2hhbGxlbmdlLm5hbWUpO1xuICAgICAgICAgICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG4vLyBleHBvcnQgZnVuY3Rpb24gc2hvd0Zhdm91cml0ZVRoZW1lc0F0VGhlVG9wKCkge1xuZnVuY3Rpb24gdXBkYXRlVGhlbWVDb21tYW5kcygpIHtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mYXZUaGVtZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBleHBvcnRzLnRoZW1lQ29tbWFuZHMubGlzdCA9IFtdO1xuICAgICAgICBjb25maWdfMS5kZWZhdWx0LmZhdlRoZW1lcy5mb3JFYWNoKCh0aGVtZSkgPT4ge1xuICAgICAgICAgICAgZXhwb3J0cy50aGVtZUNvbW1hbmRzLmxpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgaWQ6IFwiY2hhbmdlVGhlbWVcIiArIE1pc2MuY2FwaXRhbGl6ZUZpcnN0TGV0dGVyT2ZFYWNoV29yZCh0aGVtZSksXG4gICAgICAgICAgICAgICAgZGlzcGxheTogdGhlbWUucmVwbGFjZSgvXy9nLCBcIiBcIiksXG4gICAgICAgICAgICAgICAgaG92ZXI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gcHJldmlld1RoZW1lKHRoZW1lKTtcbiAgICAgICAgICAgICAgICAgICAgVGhlbWVDb250cm9sbGVyLnByZXZpZXcodGhlbWUsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRoZW1lKHRoZW1lKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBNaXNjLmdldFRoZW1lc0xpc3QoKS50aGVuKCh0aGVtZXMpID0+IHtcbiAgICAgICAgICAgIHRoZW1lcy5mb3JFYWNoKCh0aGVtZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZhdlRoZW1lcy5pbmNsdWRlcyh0aGVtZS5uYW1lKSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGV4cG9ydHMudGhlbWVDb21tYW5kcy5saXN0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBpZDogXCJjaGFuZ2VUaGVtZVwiICsgTWlzYy5jYXBpdGFsaXplRmlyc3RMZXR0ZXJPZkVhY2hXb3JkKHRoZW1lLm5hbWUpLFxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0aGVtZS5uYW1lLnJlcGxhY2UoL18vZywgXCIgXCIpLFxuICAgICAgICAgICAgICAgICAgICBob3ZlcjogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHJldmlld1RoZW1lKHRoZW1lLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgVGhlbWVDb250cm9sbGVyLnByZXZpZXcodGhlbWUubmFtZSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0VGhlbWUodGhlbWUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy51cGRhdGVUaGVtZUNvbW1hbmRzID0gdXBkYXRlVGhlbWVDb21tYW5kcztcbmNvbnN0IGNvbW1hbmRzQ29weVdvcmRzVG9DbGlwYm9hcmQgPSB7XG4gICAgdGl0bGU6IFwiQXJlIHlvdSBzdXJlLi4uXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjb3B5Tm9cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiTmV2ZXJtaW5kXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNvcHlZZXNcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiWWVzLCBJIGFtIHN1cmVcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB3b3JkcyA9IE1pc2MuZ2V0V29yZHMoKTtcbiAgICAgICAgICAgICAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dCh3b3JkcykudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ29waWVkIHRvIGNsaXBib2FyZFwiLCAxKTtcbiAgICAgICAgICAgICAgICB9LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGNvcHkhXCIsIC0xKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5jb25zdCBjb21tYW5kc01vbmtleVBvd2VyTGV2ZWwgPSB7XG4gICAgdGl0bGU6IFwiUG93ZXIgbW9kZS4uLlwiLFxuICAgIGNvbmZpZ0tleTogXCJtb25rZXlQb3dlckxldmVsXCIsXG4gICAgbGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJtb25rZXlQb3dlckxldmVsT2ZmXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIm9mZlwiLFxuICAgICAgICAgICAgY29uZmlnVmFsdWU6IFwib2ZmXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiBVcGRhdGVDb25maWcuc2V0TW9ua2V5UG93ZXJMZXZlbChcIm9mZlwiKSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwibW9ua2V5UG93ZXJMZXZlbDFcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwibWVsbG93XCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCIxXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiBVcGRhdGVDb25maWcuc2V0TW9ua2V5UG93ZXJMZXZlbChcIjFcIiksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcIm1vbmtleVBvd2VyTGV2ZWwyXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcImhpZ2hcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjJcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IFVwZGF0ZUNvbmZpZy5zZXRNb25rZXlQb3dlckxldmVsKFwiMlwiKSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwibW9ua2V5UG93ZXJMZXZlbDNcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwidWx0cmFcIixcbiAgICAgICAgICAgIGNvbmZpZ1ZhbHVlOiBcIjNcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IFVwZGF0ZUNvbmZpZy5zZXRNb25rZXlQb3dlckxldmVsKFwiM1wiKSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwibW9ua2V5UG93ZXJMZXZlbDRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwib3ZlciA5MDAwXCIsXG4gICAgICAgICAgICBjb25maWdWYWx1ZTogXCI0XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiBVcGRhdGVDb25maWcuc2V0TW9ua2V5UG93ZXJMZXZlbChcIjRcIiksXG4gICAgICAgIH0sXG4gICAgXSxcbn07XG5leHBvcnRzLmRlZmF1bHRDb21tYW5kcyA9IHtcbiAgICB0aXRsZTogXCJcIixcbiAgICBsaXN0OiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVB1bmN0dWF0aW9uXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlB1bmN0dWF0aW9uLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcIiE/XCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNQdW5jdHVhdGlvbixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTW9kZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJNb2RlLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWJhcnNcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc01vZGUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVRpbWVDb25maWdcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiVGltZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1jbG9ja1wiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzVGltZUNvbmZpZyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlV29yZENvdW50XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIldvcmRzLi4uXCIsXG4gICAgICAgICAgICBhbGlhczogXCJ3b3Jkc1wiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1mb250XCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNXb3JkQ291bnQsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVF1b3RlTGVuZ3RoXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlF1b3RlIGxlbmd0aC4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1xdW90ZS1yaWdodFwiLFxuICAgICAgICAgICAgYWxpYXM6IFwicXVvdGVzXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNRdW90ZUxlbmd0aENvbmZpZyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgdmlzaWJsZTogZmFsc2UsXG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VUYWdzXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlRhZ3MuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtdGFnXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNUYWdzLFxuICAgICAgICAgICAgYmVmb3JlU3ViZ3JvdXA6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB1cGRhdGVUYWdDb21tYW5kcygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIGV4ZWM6ICgpOiB2b2lkID0+IHtcbiAgICAgICAgICAgIC8vICAgdXBkYXRlVGFnQ29tbWFuZHMoKTtcbiAgICAgICAgICAgIC8vICAgY3VycmVudC5wdXNoKCk7XG4gICAgICAgICAgICAvLyAgIENvbW1hbmRsaW5lLnNob3coKTtcbiAgICAgICAgICAgIC8vIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAgICAgICAgaWQ6IFwiYXBwbHlQcmVzZXRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiUHJlc2V0cy4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1zbGlkZXJzLWhcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1ByZXNldHMsXG4gICAgICAgICAgICBiZWZvcmVTdWJncm91cDogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHVwZGF0ZVByZXNldENvbW1hbmRzKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gZXhlYzogKCk6IHZvaWQgPT4ge1xuICAgICAgICAgICAgLy8gICB1cGRhdGVQcmVzZXRDb21tYW5kcygpO1xuICAgICAgICAgICAgLy8gICBjdXJyZW50LnB1c2goY29tbWFuZHNQcmVzZXRzKTtcbiAgICAgICAgICAgIC8vICAgQ29tbWFuZGxpbmUuc2hvdygpO1xuICAgICAgICAgICAgLy8gfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlQ29uZmlkZW5jZU1vZGVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQ29uZmlkZW5jZSBtb2RlLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWJhY2tzcGFjZVwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzQ29uZmlkZW5jZU1vZGUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVN0b3BPbkVycm9yXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlN0b3Agb24gZXJyb3IuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtaGFuZC1wYXBlclwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzU3RvcE9uRXJyb3IsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZU51bWJlcnNcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiTnVtYmVycy4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCIxNVwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzTnVtYmVycyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU21vb3RoQ2FyZXRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiU21vb3RoIGNhcmV0Li4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWktY3Vyc29yXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNTbW9vdGhDYXJldCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUXVpY2tUYWJcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiUXVpY2sgdGFiLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXJlZG8tYWx0XCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNRdWlja1RhYixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUmVwZWF0UXVvdGVzXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlJlcGVhdCBxdW90ZXMuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtc3luYy1hbHRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1JlcGVhdFF1b3RlcyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTGl2ZVdwbVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJMaXZlIFdQTS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS10YWNob21ldGVyLWFsdFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzTGl2ZVdwbSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTGl2ZUFjY1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJMaXZlIGFjY3VyYWN5Li4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXBlcmNlbnRhZ2VcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0xpdmVBY2MsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUxpdmVCdXJzdFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJMaXZlIGJ1cnN0Li4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWZpcmUtYWx0XCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNMaXZlQnVyc3QsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVNob3dUaW1lclwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJUaW1lci9wcm9ncmVzcy4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1jbG9ja1wiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzU2hvd1RpbWVyLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VLZXlUaXBzXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIktleSB0aXBzLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXF1ZXN0aW9uXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNLZXlUaXBzLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VGcmVlZG9tTW9kZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJGcmVlZG9tIG1vZGUuLi5cIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0ZyZWVkb21Nb2RlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTdHJpY3RTcGFjZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJTdHJpY3Qgc3BhY2UuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtbWludXNcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1N0cmljdFNwYWNlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VCbGluZE1vZGVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQmxpbmQgbW9kZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1leWUtc2xhc2hcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0JsaW5kTW9kZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlU2hvd1dvcmRzSGlzdG9yeVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJBbHdheXMgc2hvdyB3b3JkcyBoaXN0b3J5Li4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWFsaWduLWxlZnRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1Nob3dXb3Jkc0hpc3RvcnksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUluZGljYXRlVHlwb3NcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiSW5kaWNhdGUgdHlwb3MuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtZXhjbGFtYXRpb25cIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0luZGljYXRlVHlwb3MsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUhpZGVFeHRyYUxldHRlcnNcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiSGlkZSBleHRyYSBsZXR0ZXJzLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWV5ZS1zbGFzaFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzSGlkZUV4dHJhTGV0dGVycyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUXVpY2tFbmRcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiUXVpY2sgZW5kLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXN0ZXAtZm9yd2FyZFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzUXVpY2tFbmQsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNpbmdsZUxpc3RDb21tYW5kTGluZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJTaW5nbGUgbGlzdCBjb21tYW5kIGxpbmUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtbGlzdFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzU2luZ2xlTGlzdENvbW1hbmRMaW5lLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjYXBzTG9ja1dhcm5pbmdcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQ2FwcyBsb2NrIHdhcm5pbmcuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtZXhjbGFtYXRpb24tdHJpYW5nbGVcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0NhcHNMb2NrV2FybmluZyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTWluV3BtXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIk1pbmltdW0gd3BtLi4uXCIsXG4gICAgICAgICAgICBhbGlhczogXCJtaW5pbXVtXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWJvbWJcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc01pbldwbSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTWluQWNjXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIk1pbmltdW0gYWNjdXJhY3kuLi5cIixcbiAgICAgICAgICAgIGFsaWFzOiBcIm1pbmltdW1cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtYm9tYlwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzTWluQWNjLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VNaW5CdXJzdFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJNaW5pbXVtIGJ1cnN0Li4uXCIsXG4gICAgICAgICAgICBhbGlhczogXCJtaW5pbXVtXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWJvbWJcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc01pbkJ1cnN0LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VPcHBvc2l0ZVNoaWZ0TW9kZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJDaGFuZ2Ugb3Bwb3NpdGUgc2hpZnQgbW9kZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1leGNoYW5nZS1hbHRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc09wcG9zaXRlU2hpZnRNb2RlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTb3VuZE9uQ2xpY2tcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiU291bmQgb24gY2xpY2suLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtdm9sdW1lLXVwXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNTb3VuZE9uQ2xpY2ssXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVNvdW5kT25FcnJvclwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJTb3VuZCBvbiBlcnJvci4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS12b2x1bWUtbXV0ZVwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzU291bmRPbkVycm9yLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTb3VuZFZvbHVtZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJTb3VuZCB2b2x1bWUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtdm9sdW1lLWRvd25cIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1NvdW5kVm9sdW1lLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VGbGlwVGVzdENvbG9yc1wiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJGbGlwIHRlc3QgY29sb3JzLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWFkanVzdFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzRmxpcFRlc3RDb2xvcnMsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVNtb290aExpbmVTY3JvbGxcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiU21vb3RoIGxpbmUgc2Nyb2xsLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWFsaWduLWxlZnRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1Ntb290aExpbmVTY3JvbGwsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUFsd2F5c1Nob3dEZWNpbWFsXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkFsd2F5cyBzaG93IGRlY2ltYWwgcGxhY2VzLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcIjAwXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNBbHdheXNTaG93RGVjaW1hbCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlQWx3YXlzU2hvd0NQTVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJBbHdheXMgc2hvdyBDUE0uLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtdGFjaG9tZXRlci1hbHRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0Fsd2F5c1Nob3dDUE0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVN0YXJ0R3JhcGhzQXRaZXJvXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlN0YXJ0IGdyYXBocyBhdCB6ZXJvLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWNoYXJ0LWxpbmVcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1N0YXJ0R3JhcGhzQXRaZXJvLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTd2FwRXNjQW5kVGFiXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlN3YXAgZXNjIGFuZCB0YWIuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtZXhjaGFuZ2UtYWx0XCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNTd2FwRXNjQW5kVGFiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VMYXp5TW9kZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJMYXp5IG1vZGUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtY291Y2hcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0xhenlNb2RlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VTaG93QWxsTGluZXNcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiU2hvdyBhbGwgbGluZXMuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtYWxpZ24tbGVmdFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzU2hvd0FsbExpbmVzLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VDb2xvcmZ1bE1vZGVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQ29sb3JmdWwgbW9kZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1maWxsLWRyaXBcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0NvbG9yZnVsTW9kZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlT3V0T2ZGb2N1c1dhcm5pbmdcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiT3V0IG9mIGZvY3VzIHdhcm5pbmcuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtZXhjbGFtYXRpb25cIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc091dE9mRm9jdXNXYXJuaW5nLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRFbmFibGVBZHNcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiRW5hYmxlIGFkcy4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1hZFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGV4cG9ydHMuY29tbWFuZHNFbmFibGVBZHMsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVRoZW1lXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlRoZW1lLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXBhbGV0dGVcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBleHBvcnRzLnRoZW1lQ29tbWFuZHMsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInNldEN1c3RvbVRoZW1lXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkN1c3RvbSB0aGVtZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1wYWxldHRlXCIsXG4gICAgICAgICAgICBzdWJncm91cDogZXhwb3J0cy5jdXN0b21UaGVtZUNvbW1hbmRzLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJzZXRDdXN0b21UaGVtZUlkXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkN1c3RvbSB0aGVtZXMuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtcGFsZXR0ZVwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGV4cG9ydHMuY3VzdG9tVGhlbWVMaXN0Q29tbWFuZHMsXG4gICAgICAgICAgICBiZWZvcmVTdWJncm91cDogKCkgPT4gdXBkYXRlQ3VzdG9tVGhlbWVMaXN0Q29tbWFuZHMoKSxcbiAgICAgICAgICAgIGF2YWlsYWJsZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgIT09IG51bGw7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VSYW5kb21UaGVtZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJSYW5kb20gdGhlbWUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtcmFuZG9tXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNSYW5kb21UaGVtZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwicmFuZG9taXplVGhlbWVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiTmV4dCByYW5kb20gdGhlbWVcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtcmFuZG9tXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiBUaGVtZUNvbnRyb2xsZXIucmFuZG9taXplVGhlbWUoKSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlRGlmZmljdWx0eVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJEaWZmaWN1bHR5Li4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXN0YXJcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0RpZmZpY3VsdHksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUNhcmV0U3R5bGVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiQ2FyZXQgc3R5bGUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtaS1jdXJzb3JcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0NhcmV0U3R5bGUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVBhY2VDYXJldFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJQYWNlIGNhcmV0IG1vZGUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtaS1jdXJzb3JcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1BhY2VDYXJldCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlUGFjZUNhcmV0U3R5bGVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiUGFjZSBjYXJldCBzdHlsZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1pLWN1cnNvclwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzUGFjZUNhcmV0U3R5bGUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVJlcGVhdGVkUGFjZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJSZXBlYXRlZCBwYWNlLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWktY3Vyc29yXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNSZXBlYXRlZFBhY2UsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVRpbWVyU3R5bGVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiVGltZXIvcHJvZ3Jlc3Mgc3R5bGUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtY2xvY2tcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1RpbWVyU3R5bGUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVRpbWVyQ29sb3JcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiVGltZXIvcHJvZ3Jlc3MgY29sb3IuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtY2xvY2tcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1RpbWVyQ29sb3IsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVRpbWVyT3BhY2l0eVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJUaW1lci9wcm9ncmVzcyBvcGFjaXR5Li4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWNsb2NrXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNUaW1lck9wYWNpdHksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUhpZ2hsaWdodE1vZGVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiSGlnaGxpZ2h0IG1vZGUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtaGlnaGxpZ2h0ZXJcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0hpZ2hsaWdodE1vZGUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVNob3dBdmVyYWdlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlNob3cgYXZlcmFnZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1jaGFydC1iYXJcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc1Nob3dBdmVyYWdlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VDdXN0b21CYWNrZ3JvdW5kXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkN1c3RvbSBiYWNrZ3JvdW5kLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWltYWdlXCIsXG4gICAgICAgICAgICBkZWZhdWx0VmFsdWU6IFwiXCIsXG4gICAgICAgICAgICBpbnB1dDogdHJ1ZSxcbiAgICAgICAgICAgIGV4ZWM6IChpbnB1dCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghaW5wdXQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tQmFja2dyb3VuZChpbnB1dCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VMYW5ndWFnZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJMYW5ndWFnZS4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1sYW5ndWFnZVwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzTGFuZ3VhZ2VzLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VCcml0aXNoRW5nbGlzaFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJCcml0aXNoIGVuZ2xpc2guLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtbGFuZ3VhZ2VcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0JyaXRpc2hFbmdsaXNoLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VGdW5ib3hcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiRnVuYm94Li4uXCIsXG4gICAgICAgICAgICBhbGlhczogXCJmdW4gYm94XCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWdhbWVwYWRcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiBjb21tYW5kc0Z1bmJveCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlTGF5b3V0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkxheW91dCBlbXVsYXRvci4uLlwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1rZXlib2FyZFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzTGF5b3V0cyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwidG9nZ2xlS2V5bWFwXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIktleW1hcCBtb2RlLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWtleWJvYXJkXCIsXG4gICAgICAgICAgICBhbGlhczogXCJrZXlib2FyZFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzS2V5bWFwTW9kZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlS2V5bWFwU3R5bGVcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiS2V5bWFwIHN0eWxlLi4uXCIsXG4gICAgICAgICAgICBhbGlhczogXCJrZXlib2FyZFwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1rZXlib2FyZFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzS2V5bWFwU3R5bGUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUtleW1hcExlZ2VuZFN0eWxlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIktleW1hcCBsZWdlbmQgc3R5bGUuLi5cIixcbiAgICAgICAgICAgIGFsaWFzOiBcImtleWJvYXJkXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWtleWJvYXJkXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNLZXltYXBMZWdlbmRTdHlsZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2hhbmdlS2V5bWFwTGF5b3V0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIktleW1hcCBsYXlvdXQuLi5cIixcbiAgICAgICAgICAgIGFsaWFzOiBcImtleWJvYXJkXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWtleWJvYXJkXCIsXG4gICAgICAgICAgICBzdWJncm91cDogZXhwb3J0cy5jb21tYW5kc0tleW1hcExheW91dHMsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUN1c3RvbUxheW91dGZsdWlkXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkN1c3RvbSBsYXlvdXRmbHVpZC4uLlwiLFxuICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBcInF3ZXJ0eSBkdm9yYWsgY29sZW1ha1wiLFxuICAgICAgICAgICAgaW5wdXQ6IHRydWUsXG4gICAgICAgICAgICBpY29uOiBcImZhLXRpbnRcIixcbiAgICAgICAgICAgIGV4ZWM6IChpbnB1dCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpbnB1dCA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbUxheW91dGZsdWlkKGlucHV0KTtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwibGF5b3V0Zmx1aWRcIilcbiAgICAgICAgICAgICAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGVDb25maWcuc2V0TGF5b3V0KFxuICAgICAgICAgICAgICAgIC8vICAgQ29uZmlnLmN1c3RvbUxheW91dGZsdWlkXG4gICAgICAgICAgICAgICAgLy8gICAgID8gQ29uZmlnLmN1c3RvbUxheW91dGZsdWlkLnNwbGl0KFwiX1wiKVswXVxuICAgICAgICAgICAgICAgIC8vICAgICA6IFwicXdlcnR5XCJcbiAgICAgICAgICAgICAgICAvLyApO1xuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBMYXlvdXQoXG4gICAgICAgICAgICAgICAgLy8gICBDb25maWcuY3VzdG9tTGF5b3V0Zmx1aWRcbiAgICAgICAgICAgICAgICAvLyAgICAgPyBDb25maWcuY3VzdG9tTGF5b3V0Zmx1aWQuc3BsaXQoXCJfXCIpWzBdXG4gICAgICAgICAgICAgICAgLy8gICAgIDogXCJxd2VydHlcIlxuICAgICAgICAgICAgICAgIC8vICk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VGb250U2l6ZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJGb250IHNpemUuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtZm9udFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzRm9udFNpemUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZUZvbnRGYW1pbHlcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiRm9udCBmYW1pbHkuLi5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtZm9udFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzRm9udHMsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNoYW5nZVBhZ2VXaWR0aFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJQYWdlIHdpZHRoLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWFycm93cy1hbHQtaFwiLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzUGFnZVdpZHRoLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJ2aWV3VHlwaW5nUGFnZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJWaWV3IFR5cGluZyBQYWdlXCIsXG4gICAgICAgICAgICBhbGlhczogXCJzdGFydCBiZWdpbiB0eXBlIHRlc3RcIixcbiAgICAgICAgICAgIGljb246IFwiZmEta2V5Ym9hcmRcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAkKFwiI3RvcCAjbWVudSAuaWNvbi1idXR0b24udmlldy1zdGFydFwiKS50cmlnZ2VyKFwiY2xpY2tcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJ2aWV3TGVhZGVyYm9hcmRzXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlZpZXcgTGVhZGVyYm9hcmRzIFBhZ2VcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtY3Jvd25cIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAkKFwiI3RvcCAjbWVudSAuaWNvbi1idXR0b24udmlldy1sZWFkZXJib2FyZHNcIikudHJpZ2dlcihcImNsaWNrXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwidmlld0Fib3V0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlZpZXcgQWJvdXQgUGFnZVwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1pbmZvXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgJChcIiN0b3AgI21lbnUgLmljb24tYnV0dG9uLnZpZXctYWJvdXRcIikudHJpZ2dlcihcImNsaWNrXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwidmlld1NldHRpbmdzXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlZpZXcgU2V0dGluZ3MgUGFnZVwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1jb2dcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAkKFwiI3RvcCAjbWVudSAuaWNvbi1idXR0b24udmlldy1zZXR0aW5nc1wiKS50cmlnZ2VyKFwiY2xpY2tcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJ2aWV3UXVvdGVTZWFyY2hQb3B1cFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJTZWFyY2ggZm9yIHF1b3Rlc1wiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1zZWFyY2hcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcInF1b3RlXCIpO1xuICAgICAgICAgICAgICAgICQoXCIjcXVvdGUtc2VhcmNoLWJ1dHRvblwiKS50cmlnZ2VyKFwiY2xpY2tcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2hvdWxkRm9jdXNUZXN0VUk6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJ2aWV3QWNjb3VudFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJWaWV3IEFjY291bnQgUGFnZVwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS11c2VyXCIsXG4gICAgICAgICAgICBhbGlhczogXCJzdGF0c1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICQoXCIjdG9wICNtZW51IC5pY29uLWJ1dHRvbi52aWV3LWFjY291bnRcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgICAgICAgICAgPyAkKFwiI3RvcCAjbWVudSAuaWNvbi1idXR0b24udmlldy1sb2dpblwiKS50cmlnZ2VyKFwiY2xpY2tcIilcbiAgICAgICAgICAgICAgICAgICAgOiAkKFwiI3RvcCAjbWVudSAuaWNvbi1idXR0b24udmlldy1hY2NvdW50XCIpLnRyaWdnZXIoXCJjbGlja1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInRvZ2dsZUZ1bGxzY3JlZW5cIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiVG9nZ2xlIEZ1bGxzY3JlZW5cIixcbiAgICAgICAgICAgIGljb246IFwiZmEtZXhwYW5kXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgTWlzYy50b2dnbGVGdWxsc2NyZWVuKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJiYWlsT3V0XCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkJhaWwgb3V0Li4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXJ1bm5pbmdcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiQXJlIHlvdSBzdXJlLi4uXCIsXG4gICAgICAgICAgICAgICAgbGlzdDogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogXCJiYWlsT3V0Tm9cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IFwiTmV2ZXJtaW5kXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBhdmFpbGFibGU6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FuQmFpbE91dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IFwiYmFpbE91dEZvclN1cmVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IFwiWWVzLCBJIGFtIHN1cmVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXN0SW5wdXQuc2V0QmFpbG91dCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXN0TG9naWMuZmluaXNoKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgYXZhaWxhYmxlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbkJhaWxPdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIGF2YWlsYWJsZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBjYW5CYWlsT3V0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJsb2FkQ2hhbGxlbmdlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkxvYWQgY2hhbGxlbmdlLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWF3YXJkXCIsXG4gICAgICAgICAgICBzdWJncm91cDogZXhwb3J0cy5jb21tYW5kc0NoYWxsZW5nZXMsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImpvaW5EaXNjb3JkXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkpvaW4gdGhlIERpc2NvcmQgc2VydmVyXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLXVzZXJzXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgd2luZG93Lm9wZW4oXCJodHRwczovL2Rpc2NvcmQuZ2cvbW9ua2V5dHlwZVwiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcInJlcGVhdFRlc3RcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiUmVwZWF0IHRlc3RcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtc3luYy1hbHRcIixcbiAgICAgICAgICAgIGV4ZWM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBUZXN0TG9naWMucmVzdGFydCh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhdmFpbGFibGU6ICgpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gVGVzdFVJLnJlc3VsdFZpc2libGU7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJwcmFjdGlzZVdvcmRzXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlByYWN0aWNlIHdvcmRzLi4uXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlXCIsXG4gICAgICAgICAgICBzdWJncm91cDogY29tbWFuZHNQcmFjdGlzZVdvcmRzLFxuICAgICAgICAgICAgYXZhaWxhYmxlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFRlc3RVSS5yZXN1bHRWaXNpYmxlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwidG9nZ2xlV29yZEhpc3RvcnlcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiVG9nZ2xlIHdvcmQgaGlzdG9yeVwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1hbGlnbi1sZWZ0XCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgVGVzdFVJLnRvZ2dsZVJlc3VsdFdvcmRzKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXZhaWxhYmxlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFRlc3RVSS5yZXN1bHRWaXNpYmxlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwic2F2ZVNjcmVlbnNob3RcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiU2F2ZSBzY3JlZW5zaG90XCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWltYWdlXCIsXG4gICAgICAgICAgICBhbGlhczogXCJzcyBwaWN0dXJlXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIFRlc3RVSS5zY3JlZW5zaG90KCk7XG4gICAgICAgICAgICAgICAgfSwgNTAwKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhdmFpbGFibGU6ICgpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gVGVzdFVJLnJlc3VsdFZpc2libGU7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJjaGFuZ2VDdXN0b21Nb2RlVGV4dFwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJDaGFuZ2UgY3VzdG9tIHRleHRcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtYWxpZ24tbGVmdFwiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIEN1c3RvbVRleHRQb3B1cC5zaG93KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogXCJ0b2dnbGVNb25rZXlcIixcbiAgICAgICAgICAgIGRpc3BsYXk6IFwiVG9nZ2xlIE1vbmtleVwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1lZ2dcIixcbiAgICAgICAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb25rZXkoIWNvbmZpZ18xLmRlZmF1bHQubW9ua2V5KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcImNvcHlXb3Jkc1RvQ2xpcGJvYXJkXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkNvcHkgd29yZHMgdG8gY2xpcGJvYXJkXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWNvcHlcIixcbiAgICAgICAgICAgIHN1Ymdyb3VwOiB0cnVlLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGV4cG9ydHMuY3VycmVudC5wdXNoKGNvbW1hbmRzQ29weVdvcmRzVG9DbGlwYm9hcmQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiaW1wb3J0U2V0dGluZ3NKU09OXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkltcG9ydCBzZXR0aW5ncyBKU09OXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWNvZ1wiLFxuICAgICAgICAgICAgaW5wdXQ6IHRydWUsXG4gICAgICAgICAgICBleGVjOiAoaW5wdXQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWlucHV0KVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLmFwcGx5KEpTT04ucGFyc2UoaW5wdXQpKTtcbiAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNhdmVGdWxsQ29uZmlnVG9Mb2NhbFN0b3JhZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgU2V0dGluZ3MudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRG9uZVwiLCAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJBbiBlcnJvciBvY2N1cmVkIHdoaWxlIGltcG9ydGluZyBzZXR0aW5nczogXCIgKyBlLCAtMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiZXhwb3J0U2V0dGluZ3NKU09OXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkV4cG9ydCBzZXR0aW5ncyBKU09OXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWNvZ1wiLFxuICAgICAgICAgICAgaW5wdXQ6IHRydWUsXG4gICAgICAgICAgICBkZWZhdWx0VmFsdWU6IFwiXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBcIm1vbmtleVBvd2VyXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIlBvd2VyIG1vZGUuLi5cIixcbiAgICAgICAgICAgIGFsaWFzOiBcInBvd2VybW9kZVwiLFxuICAgICAgICAgICAgaWNvbjogXCJmYS1lZ2dcIixcbiAgICAgICAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAgICAgICAgc3ViZ3JvdXA6IGNvbW1hbmRzTW9ua2V5UG93ZXJMZXZlbCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiY2xlYXJTd0NhY2hlXCIsXG4gICAgICAgICAgICBkaXNwbGF5OiBcIkNsZWFyIFNXIGNhY2hlXCIsXG4gICAgICAgICAgICBpY29uOiBcImZhLWNvZ1wiLFxuICAgICAgICAgICAgZXhlYzogKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2xpc3QgPSB5aWVsZCBjYWNoZXMua2V5cygpO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBjbGlzdCkge1xuICAgICAgICAgICAgICAgICAgICB5aWVsZCBjYWNoZXMuZGVsZXRlKG5hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiZ2V0U3dDYWNoZVwiLFxuICAgICAgICAgICAgZGlzcGxheTogXCJHZXQgU1cgY2FjaGVcIixcbiAgICAgICAgICAgIGljb246IFwiZmEtY29nXCIsXG4gICAgICAgICAgICBleGVjOiAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgICAgICBhbGVydCh5aWVsZCBjYWNoZXMua2V5cygpKTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICB9LFxuICAgIF0sXG59O1xuZXhwb3J0cy5jdXJyZW50ID0gW2V4cG9ydHMuZGVmYXVsdENvbW1hbmRzXTtcbmZ1bmN0aW9uIHNldEN1cnJlbnQodmFsKSB7XG4gICAgZXhwb3J0cy5jdXJyZW50ID0gdmFsO1xufVxuZXhwb3J0cy5zZXRDdXJyZW50ID0gc2V0Q3VycmVudDtcbmZ1bmN0aW9uIHB1c2hDdXJyZW50KHZhbCkge1xuICAgIGV4cG9ydHMuY3VycmVudC5wdXNoKHZhbCk7XG59XG5leHBvcnRzLnB1c2hDdXJyZW50ID0gcHVzaEN1cnJlbnQ7XG5jb25zdCBsaXN0c09iamVjdCA9IHtcbiAgICBjb21tYW5kc0NoYWxsZW5nZXM6IGV4cG9ydHMuY29tbWFuZHNDaGFsbGVuZ2VzLFxuICAgIGNvbW1hbmRzTGFuZ3VhZ2VzLFxuICAgIGNvbW1hbmRzRGlmZmljdWx0eSxcbiAgICBjb21tYW5kc0xhenlNb2RlLFxuICAgIGNvbW1hbmRzUGFjZUNhcmV0LFxuICAgIGNvbW1hbmRzU2hvd0F2ZXJhZ2UsXG4gICAgY29tbWFuZHNNaW5XcG0sXG4gICAgY29tbWFuZHNNaW5BY2MsXG4gICAgY29tbWFuZHNNaW5CdXJzdCxcbiAgICBjb21tYW5kc0Z1bmJveCxcbiAgICBjb21tYW5kc0NvbmZpZGVuY2VNb2RlLFxuICAgIGNvbW1hbmRzU3RvcE9uRXJyb3IsXG4gICAgY29tbWFuZHNMYXlvdXRzLFxuICAgIGNvbW1hbmRzT3Bwb3NpdGVTaGlmdE1vZGUsXG4gICAgY29tbWFuZHNUYWdzLFxufTtcbmZ1bmN0aW9uIGdldExpc3QobGlzdCkge1xuICAgIHJldHVybiBsaXN0c09iamVjdFtsaXN0XTtcbn1cbmV4cG9ydHMuZ2V0TGlzdCA9IGdldExpc3Q7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5LCBldmVudFZhbHVlKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGlmIChldmVudEtleSA9PT0gXCJzYXZlVG9Mb2NhbFN0b3JhZ2VcIikge1xuICAgICAgICBleHBvcnRzLmRlZmF1bHRDb21tYW5kcy5saXN0LmZpbHRlcigoY29tbWFuZCkgPT4gY29tbWFuZC5pZCA9PSBcImV4cG9ydFNldHRpbmdzSlNPTlwiKVswXS5kZWZhdWx0VmFsdWUgPSBldmVudFZhbHVlO1xuICAgIH1cbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiY3VzdG9tQmFja2dyb3VuZFwiKSB7XG4gICAgICAgIGV4cG9ydHMuZGVmYXVsdENvbW1hbmRzLmxpc3QuZmlsdGVyKChjb21tYW5kKSA9PiBjb21tYW5kLmlkID09IFwiY2hhbmdlQ3VzdG9tQmFja2dyb3VuZFwiKVswXS5kZWZhdWx0VmFsdWUgPSBldmVudFZhbHVlO1xuICAgIH1cbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiY3VzdG9tTGF5b3V0Rmx1aWRcIikge1xuICAgICAgICBleHBvcnRzLmRlZmF1bHRDb21tYW5kcy5saXN0LmZpbHRlcigoY29tbWFuZCkgPT4gY29tbWFuZC5pZCA9PSBcImNoYW5nZUN1c3RvbUxheW91dGZsdWlkXCIpWzBdLmRlZmF1bHRWYWx1ZSA9IChfYSA9IGV2ZW50VmFsdWUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZXBsYWNlKC8jL2csIFwiIFwiKTtcbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNob3cgPSBleHBvcnRzLmlzU2luZ2xlTGlzdENvbW1hbmRMaW5lQWN0aXZlID0gdm9pZCAwO1xuY29uc3QgVGhlbWVDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy90aGVtZS1jb250cm9sbGVyXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpLCBVcGRhdGVDb25maWcgPSBjb25maWdfMTtcbmNvbnN0IEZvY3VzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2ZvY3VzXCIpKTtcbmNvbnN0IENvbW1hbmRsaW5lTGlzdHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY29tbWFuZGxpbmUtbGlzdHNcIikpO1xuY29uc3QgVGVzdFVJID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtdWlcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgQW5hbHl0aWNzQ29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvYW5hbHl0aWNzLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgUGFnZVRyYW5zaXRpb24gPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9wYWdlLXRyYW5zaXRpb25cIikpO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuLi9maXJlYmFzZVwiKTtcbmxldCBjb21tYW5kTGluZU1vdXNlTW9kZSA9IGZhbHNlO1xuZnVuY3Rpb24gc2hvd0lucHV0KGNvbW1hbmQsIHBsYWNlaG9sZGVyLCBkZWZhdWx0VmFsdWUgPSBcIlwiKSB7XG4gICAgJChcIiNjb21tYW5kTGluZVdyYXBwZXJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgJChcIiNjb21tYW5kTGluZVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAkKFwiI2NvbW1hbmRJbnB1dFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAkKFwiI2NvbW1hbmRJbnB1dCBpbnB1dFwiKS5hdHRyKFwicGxhY2Vob2xkZXJcIiwgcGxhY2Vob2xkZXIpO1xuICAgICQoXCIjY29tbWFuZElucHV0IGlucHV0XCIpLnZhbChkZWZhdWx0VmFsdWUpO1xuICAgICQoXCIjY29tbWFuZElucHV0IGlucHV0XCIpLnRyaWdnZXIoXCJmb2N1c1wiKTtcbiAgICAkKFwiI2NvbW1hbmRJbnB1dCBpbnB1dFwiKS5hdHRyKFwiY29tbWFuZFwiLCBcIlwiKTtcbiAgICAkKFwiI2NvbW1hbmRJbnB1dCBpbnB1dFwiKS5hdHRyKFwiY29tbWFuZFwiLCBjb21tYW5kKTtcbiAgICBpZiAoZGVmYXVsdFZhbHVlICE9IFwiXCIpIHtcbiAgICAgICAgJChcIiNjb21tYW5kSW5wdXQgaW5wdXRcIikuc2VsZWN0KCk7XG4gICAgfVxufVxuZnVuY3Rpb24gaXNTaW5nbGVMaXN0Q29tbWFuZExpbmVBY3RpdmUoKSB7XG4gICAgcmV0dXJuICQoXCIjY29tbWFuZExpbmVcIikuaGFzQ2xhc3MoXCJhbGxDb21tYW5kc1wiKTtcbn1cbmV4cG9ydHMuaXNTaW5nbGVMaXN0Q29tbWFuZExpbmVBY3RpdmUgPSBpc1NpbmdsZUxpc3RDb21tYW5kTGluZUFjdGl2ZTtcbmZ1bmN0aW9uIHNob3dGb3VuZCgpIHtcbiAgICAkKFwiI2NvbW1hbmRMaW5lIC5zdWdnZXN0aW9uc1wiKS5lbXB0eSgpO1xuICAgIGxldCBjb21tYW5kc0hUTUwgPSBcIlwiO1xuICAgIGNvbnN0IGxpc3QgPSBDb21tYW5kbGluZUxpc3RzLmN1cnJlbnRbQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50Lmxlbmd0aCAtIDFdO1xuICAgICQuZWFjaChsaXN0Lmxpc3QsIChfaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmIChvYmouZm91bmQgJiYgKG9iai5hdmFpbGFibGUgIT09IHVuZGVmaW5lZCA/IG9iai5hdmFpbGFibGUoKSA6IHRydWUpKSB7XG4gICAgICAgICAgICBsZXQgaWNvbiA9IChfYSA9IG9iai5pY29uKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcImZhLWNoZXZyb24tcmlnaHRcIjtcbiAgICAgICAgICAgIGNvbnN0IGZhSWNvbiA9IC9eZmEtL2cudGVzdChpY29uKTtcbiAgICAgICAgICAgIGlmICghZmFJY29uKSB7XG4gICAgICAgICAgICAgICAgaWNvbiA9IGA8ZGl2IGNsYXNzPVwidGV4dEljb25cIj4ke2ljb259PC9kaXY+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGljb24gPSBgPGkgY2xhc3M9XCJmYXMgZmEtZncgJHtpY29ufVwiPjwvaT5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGxpc3QuY29uZmlnS2V5KSB7XG4gICAgICAgICAgICAgICAgaWYgKChvYmouY29uZmlnVmFsdWVNb2RlICYmXG4gICAgICAgICAgICAgICAgICAgIG9iai5jb25maWdWYWx1ZU1vZGUgPT09IFwiaW5jbHVkZVwiICYmXG4gICAgICAgICAgICAgICAgICAgIC8vIHRvZG8gZmlndXJlIHRoaXMgb3V0IHdpdGhvdXQgdXNpbmcgYW55XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHRbbGlzdC5jb25maWdLZXldLmluY2x1ZGVzKG9iai5jb25maWdWYWx1ZSkpIHx8XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHRbbGlzdC5jb25maWdLZXldID09PSBvYmouY29uZmlnVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWNvbiA9IGA8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1jaGVja1wiPjwvaT5gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWNvbiA9IGA8aSBjbGFzcz1cImZhcyBmYS1md1wiPjwvaT5gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBpY29uSFRNTCA9IGA8ZGl2IGNsYXNzPVwiaWNvblwiPiR7aWNvbn08L2Rpdj5gO1xuICAgICAgICAgICAgaWYgKG9iai5ub0ljb24gJiYgIWlzU2luZ2xlTGlzdENvbW1hbmRMaW5lQWN0aXZlKCkpIHtcbiAgICAgICAgICAgICAgICBpY29uSFRNTCA9IFwiXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb21tYW5kc0hUTUwgKz0gYDxkaXYgY2xhc3M9XCJlbnRyeVwiIGNvbW1hbmQ9XCIke29iai5pZH1cIj4ke2ljb25IVE1MfTxkaXY+JHtvYmouZGlzcGxheX08L2Rpdj48L2Rpdj5gO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgJChcIiNjb21tYW5kTGluZSAuc3VnZ2VzdGlvbnNcIikuaHRtbChjb21tYW5kc0hUTUwpO1xuICAgIGlmICgkKFwiI2NvbW1hbmRMaW5lIC5zdWdnZXN0aW9ucyAuZW50cnlcIikubGVuZ3RoID09IDApIHtcbiAgICAgICAgJChcIiNjb21tYW5kTGluZSAuc2VwYXJhdG9yXCIpLmNzcyh7IGhlaWdodDogMCwgbWFyZ2luOiAwIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiNjb21tYW5kTGluZSAuc2VwYXJhdG9yXCIpLmNzcyh7XG4gICAgICAgICAgICBoZWlnaHQ6IFwiMXB4XCIsXG4gICAgICAgICAgICBcIm1hcmdpbi1ib3R0b21cIjogXCIuNXJlbVwiLFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgZW50cmllcyA9ICQoXCIjY29tbWFuZExpbmUgLnN1Z2dlc3Rpb25zIC5lbnRyeVwiKTtcbiAgICBpZiAoZW50cmllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICQoZW50cmllc1swXSkuYWRkQ2xhc3MoXCJhY3RpdmVLZXlib2FyZFwiKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICQuZWFjaChsaXN0Lmxpc3QsIChfaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChvYmouZm91bmQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCghL3RoZW1lL2dpLnRlc3Qob2JqLmlkKSB8fCBvYmouaWQgPT09IFwidG9nZ2xlQ3VzdG9tVGhlbWVcIikgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICFUaGVtZUNvbnRyb2xsZXIucmFuZG9tVGhlbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFRoZW1lQ29udHJvbGxlci5jbGVhclByZXZpZXcoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoIS9mb250L2dpLnRlc3Qob2JqLmlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnByZXZpZXdGb250RmFtaWx5KGNvbmZpZ18xLmRlZmF1bHQuZm9udEZhbWlseSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5ob3ZlcilcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5ob3ZlcigpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkgeyB9XG4gICAgfVxuICAgICQoXCIjY29tbWFuZExpbmUgLmxpc3RUaXRsZVwiKS5yZW1vdmUoKTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZVN1Z2dlc3RlZCgpIHtcbiAgICBjb25zdCBpbnB1dFZhbCA9ICQoXCIjY29tbWFuZExpbmUgaW5wdXRcIikudmFsKClcbiAgICAgICAgLnRvTG93ZXJDYXNlKClcbiAgICAgICAgLnNwbGl0KFwiIFwiKVxuICAgICAgICAuZmlsdGVyKChzLCBpKSA9PiBzIHx8IGkgPT0gMCk7IC8vcmVtb3ZlIGVtcHR5IGVudHJpZXMgYWZ0ZXIgZmlyc3RcbiAgICBjb25zdCBsaXN0ID0gQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50W0NvbW1hbmRsaW5lTGlzdHMuY3VycmVudC5sZW5ndGggLSAxXTtcbiAgICBpZiAoaW5wdXRWYWxbMF0gPT09IFwiXCIgJiZcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5zaW5nbGVMaXN0Q29tbWFuZExpbmUgPT09IFwib25cIiAmJlxuICAgICAgICBDb21tYW5kbGluZUxpc3RzLmN1cnJlbnQubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICQuZWFjaChsaXN0Lmxpc3QsIChfaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICAgICAgb2JqLmZvdW5kID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgICBzaG93Rm91bmQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvL2lnbm9yZSB0aGUgcHJlY2VlZGluZyBcIj5cInMgaW4gdGhlIGNvbW1hbmQgbGluZSBpbnB1dFxuICAgIGlmIChpbnB1dFZhbFswXSAmJiBpbnB1dFZhbFswXVswXSA9PSBcIj5cIikge1xuICAgICAgICBpbnB1dFZhbFswXSA9IGlucHV0VmFsWzBdLnJlcGxhY2UoL14+Ky8sIFwiXCIpO1xuICAgIH1cbiAgICBpZiAoaW5wdXRWYWxbMF0gPT0gXCJcIiAmJiBpbnB1dFZhbC5sZW5ndGggPT0gMSkge1xuICAgICAgICAkLmVhY2gobGlzdC5saXN0LCAoX2luZGV4LCBvYmopID0+IHtcbiAgICAgICAgICAgIGlmIChvYmoudmlzaWJsZSAhPT0gZmFsc2UpXG4gICAgICAgICAgICAgICAgb2JqLmZvdW5kID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkLmVhY2gobGlzdC5saXN0LCAoX2luZGV4LCBvYmopID0+IHtcbiAgICAgICAgICAgIGxldCBmb3VuZGNvdW50ID0gMDtcbiAgICAgICAgICAgICQuZWFjaChpbnB1dFZhbCwgKF9pbmRleDIsIG9iajIpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAob2JqMiA9PSBcIlwiKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgY29uc3QgZXNjYXBlZCA9IG9iajIucmVwbGFjZSgvWy1bXFxde30oKSorPy4sXFxcXF4kfCNcXHNdL2csIFwiXFxcXCQmXCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlID0gbmV3IFJlZ0V4cChcIlxcXFxiXCIgKyBlc2NhcGVkLCBcImdcIik7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzID0gb2JqLmRpc3BsYXkudG9Mb3dlckNhc2UoKS5tYXRjaChyZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzMiA9IG9iai5hbGlhcyAhPT0gdW5kZWZpbmVkID8gb2JqLmFsaWFzLnRvTG93ZXJDYXNlKCkubWF0Y2gocmUpIDogbnVsbDtcbiAgICAgICAgICAgICAgICBpZiAoKHJlcyAhPSBudWxsICYmIHJlcy5sZW5ndGggPiAwKSB8fFxuICAgICAgICAgICAgICAgICAgICAocmVzMiAhPSBudWxsICYmIHJlczIubGVuZ3RoID4gMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgZm91bmRjb3VudCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZm91bmRjb3VudC0tO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGZvdW5kY291bnQgPiBpbnB1dFZhbC5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgb2JqLmZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG9iai5mb3VuZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgc2hvd0ZvdW5kKCk7XG59XG5sZXQgc2hvdyA9ICgpID0+IHtcbiAgICBpZiAoISQoXCIucGFnZS5wYWdlTG9hZGluZ1wiKS5oYXNDbGFzcyhcImhpZGRlblwiKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIEZvY3VzLnNldChmYWxzZSk7XG4gICAgJChcIiNjb21tYW5kTGluZVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAkKFwiI2NvbW1hbmRJbnB1dFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICBpZiAoJChcIiNjb21tYW5kTGluZVdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNjb21tYW5kTGluZVdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICB9LCAxMDApO1xuICAgIH1cbiAgICAkKFwiI2NvbW1hbmRMaW5lIGlucHV0XCIpLnZhbChcIlwiKTtcbiAgICBDb21tYW5kbGluZUxpc3RzLnVwZGF0ZVRoZW1lQ29tbWFuZHMoKTtcbiAgICB1cGRhdGVTdWdnZXN0ZWQoKTtcbiAgICAkKFwiI2NvbW1hbmRMaW5lIGlucHV0XCIpLnRyaWdnZXIoXCJmb2N1c1wiKTtcbn07XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZShzaG91bGRGb2N1c1Rlc3RVSSA9IHRydWUpIHtcbiAgICBVcGRhdGVDb25maWcucHJldmlld0ZvbnRGYW1pbHkoY29uZmlnXzEuZGVmYXVsdC5mb250RmFtaWx5KTtcbiAgICAvLyBhcHBseUN1c3RvbVRoZW1lQ29sb3JzKCk7XG4gICAgaWYgKCFUaGVtZUNvbnRyb2xsZXIucmFuZG9tVGhlbWUpIHtcbiAgICAgICAgVGhlbWVDb250cm9sbGVyLmNsZWFyUHJldmlldygpO1xuICAgIH1cbiAgICAkKFwiI2NvbW1hbmRMaW5lV3JhcHBlclwiKVxuICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IDAsXG4gICAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICQoXCIjY29tbWFuZExpbmVXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI2NvbW1hbmRMaW5lXCIpLnJlbW92ZUNsYXNzKFwiYWxsQ29tbWFuZHNcIik7XG4gICAgICAgIGlmIChzaG91bGRGb2N1c1Rlc3RVSSkge1xuICAgICAgICAgICAgVGVzdFVJLmZvY3VzV29yZHMoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGlmIChzaG91bGRGb2N1c1Rlc3RVSSkge1xuICAgICAgICBUZXN0VUkuZm9jdXNXb3JkcygpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHRyaWdnZXIoY29tbWFuZCkge1xuICAgIGxldCBzdWJncm91cCA9IGZhbHNlO1xuICAgIGxldCBpbnB1dCA9IGZhbHNlO1xuICAgIGxldCBzaG91bGRGb2N1c1Rlc3RVSSA9IHRydWU7XG4gICAgY29uc3QgbGlzdCA9IENvbW1hbmRsaW5lTGlzdHMuY3VycmVudFtDb21tYW5kbGluZUxpc3RzLmN1cnJlbnQubGVuZ3RoIC0gMV07XG4gICAgbGV0IHN0aWNreSA9IGZhbHNlO1xuICAgICQuZWFjaChsaXN0Lmxpc3QsIChfaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmIChvYmouaWQgPT0gY29tbWFuZCkge1xuICAgICAgICAgICAgaWYgKG9iai5zaG91bGRGb2N1c1Rlc3RVSSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgc2hvdWxkRm9jdXNUZXN0VUkgPSBvYmouc2hvdWxkRm9jdXNUZXN0VUk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob2JqLmlucHV0KSB7XG4gICAgICAgICAgICAgICAgaW5wdXQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGVzY2FwZWQgPSAoX2EgPSBvYmouZGlzcGxheS5zcGxpdChcIjwvaT5cIilbMV0pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IG9iai5kaXNwbGF5O1xuICAgICAgICAgICAgICAgIHNob3dJbnB1dChvYmouaWQsIGVzY2FwZWQsIG9iai5kZWZhdWx0VmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAob2JqLnN1Ymdyb3VwKSB7XG4gICAgICAgICAgICAgICAgc3ViZ3JvdXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmIChvYmouYmVmb3JlU3ViZ3JvdXApIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmJlZm9yZVN1Ymdyb3VwKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIENvbW1hbmRsaW5lTGlzdHMuY3VycmVudC5wdXNoKG9iai5zdWJncm91cCk7XG4gICAgICAgICAgICAgICAgKDAsIGV4cG9ydHMuc2hvdykoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChvYmouZXhlYylcbiAgICAgICAgICAgICAgICAgICAgb2JqLmV4ZWMoKTtcbiAgICAgICAgICAgICAgICBpZiAob2JqLnN0aWNreSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBzdGlja3kgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGlmICghc3ViZ3JvdXAgJiYgIWlucHV0ICYmICFzdGlja3kpIHtcbiAgICAgICAgQW5hbHl0aWNzQ29udHJvbGxlci5sb2coXCJ1c2VkQ29tbWFuZExpbmVcIiwgeyBjb21tYW5kIH0pO1xuICAgICAgICBoaWRlKHNob3VsZEZvY3VzVGVzdFVJKTtcbiAgICB9XG59XG4vL3RvZG8gcmV3cml0ZSB0aGlzIG1lc3NcbmZ1bmN0aW9uIGFkZENoaWxkQ29tbWFuZHModW5pZmllZENvbW1hbmRzLCBjb21tYW5kSXRlbSwgcGFyZW50Q29tbWFuZERpc3BsYXkgPSBcIlwiLCBwYXJlbnRDb21tYW5kKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBsZXQgY29tbWFuZEl0ZW1EaXNwbGF5ID0gY29tbWFuZEl0ZW0uZGlzcGxheS5yZXBsYWNlKC9cXHM/XFwuXFwuXFwuJC9nLCBcIlwiKTtcbiAgICBsZXQgaWNvbiA9IGA8aSBjbGFzcz1cImZhcyBmYS1md1wiPjwvaT5gO1xuICAgIGlmIChjb21tYW5kSXRlbS5jb25maWdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmXG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHRbcGFyZW50Q29tbWFuZCA9PT0gbnVsbCB8fCBwYXJlbnRDb21tYW5kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwYXJlbnRDb21tYW5kLmNvbmZpZ0tleV0gPT09XG4gICAgICAgICAgICBjb21tYW5kSXRlbS5jb25maWdWYWx1ZSkge1xuICAgICAgICBpY29uID0gYDxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWNoZWNrXCI+PC9pPmA7XG4gICAgfVxuICAgIGlmIChjb21tYW5kSXRlbS5ub0ljb24pIHtcbiAgICAgICAgaWNvbiA9IFwiXCI7XG4gICAgfVxuICAgIGlmIChwYXJlbnRDb21tYW5kRGlzcGxheSkge1xuICAgICAgICBjb21tYW5kSXRlbURpc3BsYXkgPVxuICAgICAgICAgICAgcGFyZW50Q29tbWFuZERpc3BsYXkgKyBcIiA+IFwiICsgaWNvbiArIGNvbW1hbmRJdGVtRGlzcGxheTtcbiAgICB9XG4gICAgaWYgKGNvbW1hbmRJdGVtLnN1Ymdyb3VwKSB7XG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSBjb21tYW5kSXRlbTtcbiAgICAgICAgaWYgKGNvbW1hbmQuYmVmb3JlU3ViZ3JvdXApXG4gICAgICAgICAgICBjb21tYW5kLmJlZm9yZVN1Ymdyb3VwKCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAoX2IgPSAoKF9hID0gY29tbWFuZEl0ZW0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdWJncm91cCkubGlzdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmZvckVhY2goKGNtZCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbW1hbmRJdGVtLmNvbmZpZ0tleSA9IGNvbW1hbmRJdGVtXG4gICAgICAgICAgICAgICAgICAgIC5zdWJncm91cC5jb25maWdLZXk7XG4gICAgICAgICAgICAgICAgYWRkQ2hpbGRDb21tYW5kcyh1bmlmaWVkQ29tbWFuZHMsIGNtZCwgY29tbWFuZEl0ZW1EaXNwbGF5LCBjb21tYW5kSXRlbSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIGNvbW1hbmRJdGVtLmV4ZWMoKTtcbiAgICAgICAgICAgIC8vIGNvbnN0IGN1cnJlbnRDb21tYW5kc0luZGV4ID0gQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50Lmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAvLyBDb21tYW5kbGluZUxpc3RzLmN1cnJlbnRbY3VycmVudENvbW1hbmRzSW5kZXhdLmxpc3QuZm9yRWFjaCgoY21kKSA9PiB7XG4gICAgICAgICAgICAvLyAgIGlmIChjbWQuYWxpYXMgPT09IHVuZGVmaW5lZCkgY21kLmFsaWFzID0gY29tbWFuZEl0ZW0uYWxpYXM7XG4gICAgICAgICAgICAvLyAgIGFkZENoaWxkQ29tbWFuZHModW5pZmllZENvbW1hbmRzLCBjbWQsIGNvbW1hbmRJdGVtRGlzcGxheSk7XG4gICAgICAgICAgICAvLyB9KTtcbiAgICAgICAgICAgIC8vIENvbW1hbmRsaW5lTGlzdHMuY3VycmVudC5wb3AoKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkgeyB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb25zdCB0ZW1wQ29tbWFuZEl0ZW0gPSBPYmplY3QuYXNzaWduKHt9LCBjb21tYW5kSXRlbSk7XG4gICAgICAgIGlmIChwYXJlbnRDb21tYW5kKSB7XG4gICAgICAgICAgICB0ZW1wQ29tbWFuZEl0ZW0uaWNvbiA9IHBhcmVudENvbW1hbmQuaWNvbjtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFyZW50Q29tbWFuZERpc3BsYXkpXG4gICAgICAgICAgICB0ZW1wQ29tbWFuZEl0ZW0uZGlzcGxheSA9IGNvbW1hbmRJdGVtRGlzcGxheTtcbiAgICAgICAgdW5pZmllZENvbW1hbmRzLnB1c2godGVtcENvbW1hbmRJdGVtKTtcbiAgICB9XG59XG5mdW5jdGlvbiBnZW5lcmF0ZVNpbmdsZUxpc3RPZkNvbW1hbmRzKCkge1xuICAgIGNvbnN0IGFsbENvbW1hbmRzID0gW107XG4gICAgY29uc3Qgb2xkU2hvd0NvbW1hbmRMaW5lID0gZXhwb3J0cy5zaG93O1xuICAgIGV4cG9ydHMuc2hvdyA9ICgpID0+IHtcbiAgICAgICAgLy9cbiAgICB9O1xuICAgIENvbW1hbmRsaW5lTGlzdHMuZGVmYXVsdENvbW1hbmRzLmxpc3QuZm9yRWFjaCgoYykgPT4gYWRkQ2hpbGRDb21tYW5kcyhhbGxDb21tYW5kcywgYykpO1xuICAgIGV4cG9ydHMuc2hvdyA9IG9sZFNob3dDb21tYW5kTGluZTtcbiAgICByZXR1cm4ge1xuICAgICAgICB0aXRsZTogXCJBbGwgQ29tbWFuZHNcIixcbiAgICAgICAgbGlzdDogYWxsQ29tbWFuZHMsXG4gICAgfTtcbn1cbmZ1bmN0aW9uIHVzZVNpbmdsZUxpc3RDb21tYW5kTGluZShzc2hvdyA9IHRydWUpIHtcbiAgICBjb25zdCBhbGxDb21tYW5kcyA9IGdlbmVyYXRlU2luZ2xlTGlzdE9mQ29tbWFuZHMoKTtcbiAgICAvLyBpZiAoQ29uZmlnLnNpbmdsZUxpc3RDb21tYW5kTGluZSA9PSBcIm1hbnVhbFwiKSB7XG4gICAgLy8gQ29tbWFuZGxpbmVMaXN0cy5wdXNoQ3VycmVudChhbGxDb21tYW5kcyk7XG4gICAgLy8gfSBlbHNlIGlmIChDb25maWcuc2luZ2xlTGlzdENvbW1hbmRMaW5lID09IFwib25cIikge1xuICAgIENvbW1hbmRsaW5lTGlzdHMuc2V0Q3VycmVudChbYWxsQ29tbWFuZHNdKTtcbiAgICAvLyB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc2luZ2xlTGlzdENvbW1hbmRMaW5lICE9IFwibWFudWFsXCIpIHtcbiAgICAgICAgJChcIiNjb21tYW5kTGluZVwiKS5hZGRDbGFzcyhcImFsbENvbW1hbmRzXCIpO1xuICAgIH1cbiAgICBpZiAoc3Nob3cpXG4gICAgICAgICgwLCBleHBvcnRzLnNob3cpKCk7XG59XG5mdW5jdGlvbiByZXN0b3JlT2xkQ29tbWFuZExpbmUoc3Nob3cgPSB0cnVlKSB7XG4gICAgaWYgKGlzU2luZ2xlTGlzdENvbW1hbmRMaW5lQWN0aXZlKCkpIHtcbiAgICAgICAgJChcIiNjb21tYW5kTGluZVwiKS5yZW1vdmVDbGFzcyhcImFsbENvbW1hbmRzXCIpO1xuICAgICAgICBDb21tYW5kbGluZUxpc3RzLnNldEN1cnJlbnQoQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50LmZpbHRlcigobCkgPT4gbC50aXRsZSAhPSBcIkFsbCBDb21tYW5kc1wiKSk7XG4gICAgICAgIGlmIChDb21tYW5kbGluZUxpc3RzLmN1cnJlbnQubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgQ29tbWFuZGxpbmVMaXN0cy5zZXRDdXJyZW50KFtDb21tYW5kbGluZUxpc3RzLmRlZmF1bHRDb21tYW5kc10pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChzc2hvdylcbiAgICAgICAgKDAsIGV4cG9ydHMuc2hvdykoKTtcbn1cbiQoXCIjY29tbWFuZExpbmUgaW5wdXRcIikua2V5dXAoKGUpID0+IHtcbiAgICBjb21tYW5kTGluZU1vdXNlTW9kZSA9IGZhbHNlO1xuICAgICQoXCIjY29tbWFuZExpbmVXcmFwcGVyICNjb21tYW5kTGluZSAuc3VnZ2VzdGlvbnMgLmVudHJ5XCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlTW91c2VcIik7XG4gICAgaWYgKGUua2V5ID09PSBcIkFycm93VXBcIiB8fFxuICAgICAgICBlLmtleSA9PT0gXCJBcnJvd0Rvd25cIiB8fFxuICAgICAgICBlLmtleSA9PT0gXCJFbnRlclwiIHx8XG4gICAgICAgIGUua2V5ID09PSBcIlRhYlwiIHx8XG4gICAgICAgIGUuY29kZSA9PSBcIkFsdExlZnRcIiB8fFxuICAgICAgICAoZS5rZXkubGVuZ3RoID4gMSAmJiBlLmtleSAhPT0gXCJCYWNrc3BhY2VcIiAmJiBlLmtleSAhPT0gXCJEZWxldGVcIikpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB1cGRhdGVTdWdnZXN0ZWQoKTtcbn0pO1xuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuICAgICQoZG9jdW1lbnQpLm9uKFwia2V5ZG93blwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgaWYgKFBhZ2VUcmFuc2l0aW9uLmdldCgpKVxuICAgICAgICAgICAgcmV0dXJuIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIC8vIG9wZW5zIGNvbW1hbmQgbGluZSBpZiBlc2NhcGUsIGN0cmwvY21kICsgc2hpZnQgKyBwLCBvciB0YWIgaXMgcHJlc3NlZCBpZiB0aGUgc2V0dGluZyBzd2FwRXNjQW5kVGFiIGlzIGVuYWJsZWRcbiAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFc2NhcGVcIiB8fFxuICAgICAgICAgICAgKGV2ZW50LmtleSAmJlxuICAgICAgICAgICAgICAgIGV2ZW50LmtleS50b0xvd2VyQ2FzZSgpID09PSBcInBcIiAmJlxuICAgICAgICAgICAgICAgIChldmVudC5tZXRhS2V5IHx8IGV2ZW50LmN0cmxLZXkpICYmXG4gICAgICAgICAgICAgICAgZXZlbnQuc2hpZnRLZXkpIHx8XG4gICAgICAgICAgICAoZXZlbnQua2V5ID09PSBcIlRhYlwiICYmIGNvbmZpZ18xLmRlZmF1bHQuc3dhcEVzY0FuZFRhYikpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBjb25zdCBwb3B1cHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwV3JhcHBlclwiKTtcbiAgICAgICAgICAgIGxldCBwb3B1cFZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgcG9wdXAgb2YgcG9wdXBzKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFwb3B1cC5jbGFzc0xpc3QuY29udGFpbnMoXCJoaWRkZW5cIikgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcG9wdXBWaXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHBvcHVwVmlzaWJsZSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBpZiAoISQoXCIjY29tbWFuZExpbmVXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICAgICAgICAgaWYgKENvbW1hbmRsaW5lTGlzdHMuY3VycmVudC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIENvbW1hbmRsaW5lTGlzdHMuY3VycmVudC5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIiNjb21tYW5kTGluZVwiKS5yZW1vdmVDbGFzcyhcImFsbENvbW1hbmRzXCIpO1xuICAgICAgICAgICAgICAgICAgICAoMCwgZXhwb3J0cy5zaG93KSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaGlkZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Rm9udEZhbWlseShjb25maWdfMS5kZWZhdWx0LmZvbnRGYW1pbHksIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZXZlbnQua2V5ID09PSBcIlRhYlwiIHx8ICFjb25maWdfMS5kZWZhdWx0LnN3YXBFc2NBbmRUYWIpIHtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zaW5nbGVMaXN0Q29tbWFuZExpbmUgPT0gXCJvblwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHVzZVNpbmdsZUxpc3RDb21tYW5kTGluZShmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBDb21tYW5kbGluZUxpc3RzLnNldEN1cnJlbnQoW0NvbW1hbmRsaW5lTGlzdHMuZGVmYXVsdENvbW1hbmRzXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICgwLCBleHBvcnRzLnNob3cpKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0pO1xuJChcIiNjb21tYW5kSW5wdXQgaW5wdXRcIikub24oXCJrZXlkb3duXCIsIChlKSA9PiB7XG4gICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgLy9lbnRlclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSAkKFwiI2NvbW1hbmRJbnB1dCBpbnB1dFwiKS5hdHRyKFwiY29tbWFuZFwiKTtcbiAgICAgICAgY29uc3QgdmFsdWUgPSAkKFwiI2NvbW1hbmRJbnB1dCBpbnB1dFwiKS52YWwoKTtcbiAgICAgICAgY29uc3QgbGlzdCA9IENvbW1hbmRsaW5lTGlzdHMuY3VycmVudFtDb21tYW5kbGluZUxpc3RzLmN1cnJlbnQubGVuZ3RoIC0gMV07XG4gICAgICAgICQuZWFjaChsaXN0Lmxpc3QsIChfaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICAgICAgaWYgKG9iai5pZCA9PSBjb21tYW5kKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5leGVjKVxuICAgICAgICAgICAgICAgICAgICBvYmouZXhlYyh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5zdWJncm91cCAhPT0gbnVsbCAmJiBvYmouc3ViZ3JvdXAgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAvL1RPRE86IHdoYXQgaXMgdGhpcyBmb3I/XG4gICAgICAgICAgICAgICAgICAgIC8vIHN1Ymdyb3VwID0gb2JqLnN1Ymdyb3VwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIEFuYWx5dGljc0NvbnRyb2xsZXIubG9nKFwidXNlZENvbW1hbmRMaW5lXCIsIHsgY29tbWFuZDogY29tbWFuZCAhPT0gbnVsbCAmJiBjb21tYW5kICE9PSB2b2lkIDAgPyBjb21tYW5kIDogXCJcIiB9KTtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbiAgICByZXR1cm47XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwibW91c2Vtb3ZlXCIsICgpID0+IHtcbiAgICBpZiAoIWNvbW1hbmRMaW5lTW91c2VNb2RlKVxuICAgICAgICBjb21tYW5kTGluZU1vdXNlTW9kZSA9IHRydWU7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwibW91c2VlbnRlclwiLCBcIiNjb21tYW5kTGluZVdyYXBwZXIgI2NvbW1hbmRMaW5lIC5zdWdnZXN0aW9ucyAuZW50cnlcIiwgKGUpID0+IHtcbiAgICBpZiAoIWNvbW1hbmRMaW5lTW91c2VNb2RlKVxuICAgICAgICByZXR1cm47XG4gICAgJChlLnRhcmdldCkuYWRkQ2xhc3MoXCJhY3RpdmVNb3VzZVwiKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJtb3VzZWxlYXZlXCIsIFwiI2NvbW1hbmRMaW5lV3JhcHBlciAjY29tbWFuZExpbmUgLnN1Z2dlc3Rpb25zIC5lbnRyeVwiLCAoZSkgPT4ge1xuICAgIGlmICghY29tbWFuZExpbmVNb3VzZU1vZGUpXG4gICAgICAgIHJldHVybjtcbiAgICAkKGUudGFyZ2V0KS5yZW1vdmVDbGFzcyhcImFjdGl2ZU1vdXNlXCIpO1xufSk7XG4kKFwiI2NvbW1hbmRMaW5lV3JhcHBlciAjY29tbWFuZExpbmUgLnN1Z2dlc3Rpb25zXCIpLm9uKFwibW91c2VvdmVyXCIsIChlKSA9PiB7XG4gICAgaWYgKCFjb21tYW5kTGluZU1vdXNlTW9kZSlcbiAgICAgICAgcmV0dXJuO1xuICAgIC8vIGNvbnNvbGUubG9nKFwiY2xlYXJpbmcga2V5Ym9hcmQgYWN0aXZlXCIpO1xuICAgICQoXCIjY29tbWFuZExpbmVXcmFwcGVyICNjb21tYW5kTGluZSAuc3VnZ2VzdGlvbnMgLmVudHJ5XCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlS2V5Ym9hcmRcIik7XG4gICAgY29uc3QgaG92ZXJJZCA9ICQoZS50YXJnZXQpLmF0dHIoXCJjb21tYW5kXCIpO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGxpc3QgPSBDb21tYW5kbGluZUxpc3RzLmN1cnJlbnRbQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50Lmxlbmd0aCAtIDFdO1xuICAgICAgICAkLmVhY2gobGlzdC5saXN0LCAoX2luZGV4LCBvYmopID0+IHtcbiAgICAgICAgICAgIGlmIChvYmouaWQgPT0gaG92ZXJJZCkge1xuICAgICAgICAgICAgICAgIGlmICgoIS90aGVtZS9naS50ZXN0KG9iai5pZCkgfHwgb2JqLmlkID09PSBcInRvZ2dsZUN1c3RvbVRoZW1lXCIpICYmXG4gICAgICAgICAgICAgICAgICAgICFUaGVtZUNvbnRyb2xsZXIucmFuZG9tVGhlbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgVGhlbWVDb250cm9sbGVyLmNsZWFyUHJldmlldygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIS9mb250L2dpLnRlc3Qob2JqLmlkKSkge1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcucHJldmlld0ZvbnRGYW1pbHkoY29uZmlnXzEuZGVmYXVsdC5mb250RmFtaWx5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG9iai5ob3ZlcilcbiAgICAgICAgICAgICAgICAgICAgb2JqLmhvdmVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjYXRjaCAoZSkgeyB9XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjY29tbWFuZExpbmVXcmFwcGVyICNjb21tYW5kTGluZSAuc3VnZ2VzdGlvbnMgLmVudHJ5XCIsIChlKSA9PiB7XG4gICAgJChcIi5zdWdnZXN0aW9ucyAuZW50cnlcIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVLZXlib2FyZFwiKTtcbiAgICB0cmlnZ2VyKCQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiY29tbWFuZFwiKSk7XG59KTtcbiQoXCIjY29tbWFuZExpbmVXcmFwcGVyXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcImNvbW1hbmRMaW5lV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZvbnRGYW1pbHkoY29uZmlnXzEuZGVmYXVsdC5mb250RmFtaWx5LCB0cnVlKTtcbiAgICAgICAgLy8gaWYgKENvbmZpZy5jdXN0b21UaGVtZSA9PT0gdHJ1ZSkge1xuICAgICAgICAvLyAgIGFwcGx5Q3VzdG9tVGhlbWVDb2xvcnMoKTtcbiAgICAgICAgLy8gfSBlbHNlIHtcbiAgICAgICAgLy8gICBzZXRUaGVtZShDb25maWcudGhlbWUsIHRydWUpO1xuICAgICAgICAvLyB9XG4gICAgfVxufSk7XG4vL21pZ2h0IGNvbWUgYmFjayB0byBpdCBsYXRlclxuLy8gZnVuY3Rpb24gc2hpZnRDb21tYW5kKCl7XG4vLyAgIGxldCBhY3RpdmVFbnRyaWVzID0gJChcIiNjb21tYW5kTGluZVdyYXBwZXIgI2NvbW1hbmRMaW5lIC5zdWdnZXN0aW9ucyAuZW50cnkuYWN0aXZlS2V5Ym9hcmQsICNjb21tYW5kTGluZVdyYXBwZXIgI2NvbW1hbmRMaW5lIC5zdWdnZXN0aW9ucyAuZW50cnkuYWN0aXZlTW91c2VcIik7XG4vLyAgIGFjdGl2ZUVudHJpZXMuZWFjaCgoX2luZGV4LCBhY3RpdmVFbnRyeSkgPT4ge1xuLy8gICAgIGxldCBjb21tYW5kSWQgPSBhY3RpdmVFbnRyeS5nZXRBdHRyaWJ1dGUoJ2NvbW1hbmQnKTtcbi8vICAgICBsZXQgZm91bmRDb21tYW5kID0gbnVsbDtcbi8vICAgICBDb21tYW5kbGluZUxpc3RzLmRlZmF1bHRDb21tYW5kcy5saXN0LmZvckVhY2goY29tbWFuZCA9PiB7XG4vLyAgICAgICBpZihmb3VuZENvbW1hbmQgPT09IG51bGwgJiYgY29tbWFuZC5pZCA9PT0gY29tbWFuZElkKXtcbi8vICAgICAgICAgZm91bmRDb21tYW5kID0gY29tbWFuZDtcbi8vICAgICAgIH1cbi8vICAgICB9KVxuLy8gICAgIGlmKGZvdW5kQ29tbWFuZC5zaGlmdCl7XG4vLyAgICAgICAkKGFjdGl2ZUVudHJ5KS5maW5kKCdkaXYnKS50ZXh0KGZvdW5kQ29tbWFuZC5zaGlmdC5kaXNwbGF5KTtcbi8vICAgICB9XG4vLyAgIH0pXG4vLyB9XG4vLyBsZXQgc2hpZnRlZENvbW1hbmRzID0gZmFsc2U7XG4vLyAkKGRvY3VtZW50KS5vbihcImtleWRvd25cIiwgKGUpID0+IHtcbi8vICAgaWYgKGUua2V5ID09PSBcIlNoaWZ0XCIpIHtcbi8vICAgICBpZihzaGlmdGVkQ29tbWFuZHMgPT09IGZhbHNlKXtcbi8vICAgICAgIHNoaWZ0ZWRDb21tYW5kcyA9IHRydWU7XG4vLyAgICAgICBzaGlmdENvbW1hbmQoKTtcbi8vICAgICB9XG4vLyAgIH1cbi8vIH0pO1xuLy8gJChkb2N1bWVudCkua2V5dXAoKGUpID0+IHtcbi8vICAgaWYgKGUua2V5ID09PSBcIlNoaWZ0XCIpIHtcbi8vICAgICBzaGlmdGVkQ29tbWFuZHMgPSBmYWxzZTtcbi8vICAgfVxuLy8gfSk7XG4kKGRvY3VtZW50KS5vbihcImtleWRvd25cIiwgKGUpID0+IHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIC8vIGlmIChpc1ByZXZpZXdpbmdUaGVtZSkge1xuICAgIC8vIGNvbnNvbGUubG9nKFwiYXBwbHlpbmcgdGhlbWVcIik7XG4gICAgLy8gYXBwbHlDdXN0b21UaGVtZUNvbG9ycygpO1xuICAgIC8vIHByZXZpZXdUaGVtZShDb25maWcudGhlbWUsIGZhbHNlKTtcbiAgICAvLyB9XG4gICAgaWYgKCEkKFwiI2NvbW1hbmRMaW5lV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI2NvbW1hbmRMaW5lIGlucHV0XCIpLnRyaWdnZXIoXCJmb2N1c1wiKTtcbiAgICAgICAgaWYgKGUua2V5ID09IFwiPlwiICYmIGNvbmZpZ18xLmRlZmF1bHQuc2luZ2xlTGlzdENvbW1hbmRMaW5lID09IFwibWFudWFsXCIpIHtcbiAgICAgICAgICAgIGlmICghaXNTaW5nbGVMaXN0Q29tbWFuZExpbmVBY3RpdmUoKSkge1xuICAgICAgICAgICAgICAgIHVzZVNpbmdsZUxpc3RDb21tYW5kTGluZShmYWxzZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoJChcIiNjb21tYW5kTGluZSBpbnB1dFwiKS52YWwoKSA9PSBcIj5cIikge1xuICAgICAgICAgICAgICAgIC8vc28gdGhhdCBpdCB3aWxsIGlnbm9yZSBzdWNjZWVkaW5nIFwiPlwiIHdoZW4gaW5wdXQgaXMgYWxyZWFkeSBcIj5cIlxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUua2V5ID09PSBcIkJhY2tzcGFjZVwiIHx8IGUua2V5ID09PSBcIkRlbGV0ZVwiKSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpbnB1dFZhbCA9ICQoXCIjY29tbWFuZExpbmUgaW5wdXRcIikudmFsKCk7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc2luZ2xlTGlzdENvbW1hbmRMaW5lID09IFwibWFudWFsXCIgJiZcbiAgICAgICAgICAgICAgICAgICAgaXNTaW5nbGVMaXN0Q29tbWFuZExpbmVBY3RpdmUoKSAmJlxuICAgICAgICAgICAgICAgICAgICBpbnB1dFZhbFswXSAhPT0gXCI+XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdG9yZU9sZENvbW1hbmRMaW5lKGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAxKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICAgICAgLy9lbnRlclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgY29uc3QgY29tbWFuZCA9ICQoXCIuc3VnZ2VzdGlvbnMgLmVudHJ5LmFjdGl2ZUtleWJvYXJkXCIpLmF0dHIoXCJjb21tYW5kXCIpO1xuICAgICAgICAgICAgdHJpZ2dlcihjb21tYW5kKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZS5rZXkgPT09IFwiQXJyb3dVcFwiIHx8IGUua2V5ID09PSBcIkFycm93RG93blwiIHx8IGUua2V5ID09PSBcIlRhYlwiKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAkKFwiI2NvbW1hbmRMaW5lV3JhcHBlciAjY29tbWFuZExpbmUgLnN1Z2dlc3Rpb25zIC5lbnRyeVwiKS51bmJpbmQoXCJtb3VzZWVudGVyIG1vdXNlbGVhdmVcIik7XG4gICAgICAgICAgICBjb25zdCBlbnRyaWVzID0gJChcIi5zdWdnZXN0aW9ucyAuZW50cnlcIik7XG4gICAgICAgICAgICBsZXQgYWN0aXZlbnVtID0gLTE7XG4gICAgICAgICAgICBsZXQgaG92ZXJJZDtcbiAgICAgICAgICAgICQuZWFjaChlbnRyaWVzLCAoaW5kZXgsIG9iaikgPT4ge1xuICAgICAgICAgICAgICAgIGlmICgkKG9iaikuaGFzQ2xhc3MoXCJhY3RpdmVLZXlib2FyZFwiKSlcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlbnVtID0gaW5kZXg7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChlLmtleSA9PT0gXCJBcnJvd1VwXCIgfHwgKGUua2V5ID09PSBcIlRhYlwiICYmIGUuc2hpZnRLZXkpKSB7XG4gICAgICAgICAgICAgICAgZW50cmllcy5yZW1vdmVDbGFzcyhcImFjdGl2ZUtleWJvYXJkXCIpO1xuICAgICAgICAgICAgICAgIGlmIChhY3RpdmVudW0gPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAkKGVudHJpZXNbZW50cmllcy5sZW5ndGggLSAxXSkuYWRkQ2xhc3MoXCJhY3RpdmVLZXlib2FyZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgaG92ZXJJZCA9ICQoZW50cmllc1tlbnRyaWVzLmxlbmd0aCAtIDFdKS5hdHRyKFwiY29tbWFuZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQoZW50cmllc1stLWFjdGl2ZW51bV0pLmFkZENsYXNzKFwiYWN0aXZlS2V5Ym9hcmRcIik7XG4gICAgICAgICAgICAgICAgICAgIGhvdmVySWQgPSAkKGVudHJpZXNbYWN0aXZlbnVtXSkuYXR0cihcImNvbW1hbmRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGUua2V5ID09PSBcIkFycm93RG93blwiIHx8IChlLmtleSA9PT0gXCJUYWJcIiAmJiAhZS5zaGlmdEtleSkpIHtcbiAgICAgICAgICAgICAgICBlbnRyaWVzLnJlbW92ZUNsYXNzKFwiYWN0aXZlS2V5Ym9hcmRcIik7XG4gICAgICAgICAgICAgICAgaWYgKGFjdGl2ZW51bSArIDEgPT0gZW50cmllcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgJChlbnRyaWVzWzBdKS5hZGRDbGFzcyhcImFjdGl2ZUtleWJvYXJkXCIpO1xuICAgICAgICAgICAgICAgICAgICBob3ZlcklkID0gJChlbnRyaWVzWzBdKS5hdHRyKFwiY29tbWFuZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQoZW50cmllc1srK2FjdGl2ZW51bV0pLmFkZENsYXNzKFwiYWN0aXZlS2V5Ym9hcmRcIik7XG4gICAgICAgICAgICAgICAgICAgIGhvdmVySWQgPSAkKGVudHJpZXNbYWN0aXZlbnVtXSkuYXR0cihcImNvbW1hbmRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzY3JvbGwgPSBNYXRoLmFicygoKF9hID0gJChcIi5zdWdnZXN0aW9uc1wiKS5vZmZzZXQoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRvcCkgLVxuICAgICAgICAgICAgICAgICAgICAoKF9iID0gJChcIi5lbnRyeS5hY3RpdmVLZXlib2FyZFwiKS5vZmZzZXQoKSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnRvcCkgLVxuICAgICAgICAgICAgICAgICAgICAkKFwiLnN1Z2dlc3Rpb25zXCIpLnNjcm9sbFRvcCgpKSAtXG4gICAgICAgICAgICAgICAgICAgICQoXCIuc3VnZ2VzdGlvbnNcIikub3V0ZXJIZWlnaHQoKSAvIDIgK1xuICAgICAgICAgICAgICAgICAgICAkKCQoXCIuZW50cnlcIilbMF0pLm91dGVySGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgJChcIi5zdWdnZXN0aW9uc1wiKS5zY3JvbGxUb3Aoc2Nyb2xsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvdWxkIG5vdCBzY3JvbGwgc3VnZ2VzdGlvbnM6IFwiICsgZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhgc2Nyb2xsaW5nIHRvICR7c2Nyb2xsfWApO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBsaXN0ID0gQ29tbWFuZGxpbmVMaXN0cy5jdXJyZW50W0NvbW1hbmRsaW5lTGlzdHMuY3VycmVudC5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgICAkLmVhY2gobGlzdC5saXN0LCAoX2luZGV4LCBvYmopID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5pZCA9PSBob3ZlcklkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCEvdGhlbWUvZ2kudGVzdChvYmouaWQpIHx8IG9iai5pZCA9PT0gXCJ0b2dnbGVDdXN0b21UaGVtZVwiKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICFUaGVtZUNvbnRyb2xsZXIucmFuZG9tVGhlbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaGVtZUNvbnRyb2xsZXIuY2xlYXJQcmV2aWV3KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIS9mb250L2dpLnRlc3Qob2JqLmlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5wcmV2aWV3Rm9udEZhbWlseShjb25maWdfMS5kZWZhdWx0LmZvbnRGYW1pbHkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5ob3ZlcilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouaG92ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHsgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybjtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNjb21tYW5kTGluZU1vYmlsZUJ1dHRvblwiLCAoKSA9PiB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc2luZ2xlTGlzdENvbW1hbmRMaW5lID09IFwib25cIikge1xuICAgICAgICB1c2VTaW5nbGVMaXN0Q29tbWFuZExpbmUoZmFsc2UpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgQ29tbWFuZGxpbmVMaXN0cy5zZXRDdXJyZW50KFtDb21tYW5kbGluZUxpc3RzLmRlZmF1bHRDb21tYW5kc10pO1xuICAgIH1cbiAgICAoMCwgZXhwb3J0cy5zaG93KSgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI2tleW1hcCAucjUgLmtleS1zcGFjZVwiLCAoKSA9PiB7XG4gICAgQ29tbWFuZGxpbmVMaXN0cy5zZXRDdXJyZW50KFtDb21tYW5kbGluZUxpc3RzLmNvbW1hbmRzS2V5bWFwTGF5b3V0c10pO1xuICAgICgwLCBleHBvcnRzLnNob3cpKCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjdGVzdE1vZGVzTm90aWNlIC50ZXh0LWJ1dHRvblwiLCAoZXZlbnQpID0+IHtcbiAgICBjb25zdCBjb21tYW5kcyA9IENvbW1hbmRsaW5lTGlzdHMuZ2V0TGlzdCgkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJjb21tYW5kc1wiKSk7XG4gICAgaWYgKGNvbW1hbmRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKCQoZXZlbnQuY3VycmVudFRhcmdldCkuYXR0cihcImNvbW1hbmRzXCIpID09PSBcImNvbW1hbmRzVGFnc1wiKSB7XG4gICAgICAgICAgICBDb21tYW5kbGluZUxpc3RzLnVwZGF0ZVRhZ0NvbW1hbmRzKCk7XG4gICAgICAgIH1cbiAgICAgICAgQ29tbWFuZGxpbmVMaXN0cy5wdXNoQ3VycmVudChjb21tYW5kcyk7XG4gICAgICAgICgwLCBleHBvcnRzLnNob3cpKCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI2JvdHRvbSAubGVmdHJpZ2h0IC5yaWdodCAuY3VycmVudC10aGVtZVwiLCAoZSkgPT4ge1xuICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5jdXN0b21UaGVtZSkge1xuICAgICAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmIChEQi5nZXRTbmFwc2hvdCgpLmN1c3RvbVRoZW1lcy5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiTm8gY3VzdG9tIHRoZW1lcyFcIiwgMCk7XG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZShmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZUlkKFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGlmICghREIuZ2V0Q3VzdG9tVGhlbWVCeUlkKENvbmZpZy5jdXN0b21UaGVtZUlkKSkge1xuICAgICAgICAgICAgICAgIC8vICAgLy8gVHVybiBvbiB0aGUgZmlyc3QgY3VzdG9tIHRoZW1lXG4gICAgICAgICAgICAgICAgLy8gICBjb25zdCBmaXJzdEN1c3RvbVRoZW1lSWQgPSBEQi5nZXRTbmFwc2hvdCgpLmN1c3RvbVRoZW1lc1swXS5faWQ7XG4gICAgICAgICAgICAgICAgLy8gICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWVJZChmaXJzdEN1c3RvbVRoZW1lSWQpO1xuICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZSh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWUoZmFsc2UpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tVGhlbWUpXG4gICAgICAgICAgICBDb21tYW5kbGluZUxpc3RzLnVwZGF0ZUN1c3RvbVRoZW1lTGlzdENvbW1hbmRzKCk7XG4gICAgICAgIENvbW1hbmRsaW5lTGlzdHMucHVzaEN1cnJlbnQoY29uZmlnXzEuZGVmYXVsdC5jdXN0b21UaGVtZVxuICAgICAgICAgICAgPyBDb21tYW5kbGluZUxpc3RzLmN1c3RvbVRoZW1lTGlzdENvbW1hbmRzXG4gICAgICAgICAgICA6IENvbW1hbmRsaW5lTGlzdHMudGhlbWVDb21tYW5kcyk7XG4gICAgICAgICgwLCBleHBvcnRzLnNob3cpKCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIucGFnZUFib3V0IC5hYm91dEVuYWJsZUFkc1wiLCAoKSA9PiB7XG4gICAgQ29tbWFuZGxpbmVMaXN0cy5wdXNoQ3VycmVudChDb21tYW5kbGluZUxpc3RzLmNvbW1hbmRzRW5hYmxlQWRzKTtcbiAgICAoMCwgZXhwb3J0cy5zaG93KSgpO1xufSk7XG4kKFwiLnN1cHBvcnRCdXR0b25zIC5idXR0b24uYWRzXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIENvbW1hbmRsaW5lTGlzdHMucHVzaEN1cnJlbnQoQ29tbWFuZGxpbmVMaXN0cy5jb21tYW5kc0VuYWJsZUFkcyk7XG4gICAgKDAsIGV4cG9ydHMuc2hvdykoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMubG9hZENvbmZpZyA9IGV4cG9ydHMuYXBwbHkgPSBleHBvcnRzLmdldENTUyA9IHZvaWQgMDtcbmNvbnN0IFVwZGF0ZUNvbmZpZyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmNvbnN0IGZpbHRlcnMgPSB7XG4gICAgYmx1cjoge1xuICAgICAgICB2YWx1ZTogMCxcbiAgICAgICAgZGVmYXVsdDogMCxcbiAgICB9LFxuICAgIGJyaWdodG5lc3M6IHtcbiAgICAgICAgdmFsdWU6IDEsXG4gICAgICAgIGRlZmF1bHQ6IDEsXG4gICAgfSxcbiAgICBzYXR1cmF0ZToge1xuICAgICAgICB2YWx1ZTogMSxcbiAgICAgICAgZGVmYXVsdDogMSxcbiAgICB9LFxuICAgIG9wYWNpdHk6IHtcbiAgICAgICAgdmFsdWU6IDEsXG4gICAgICAgIGRlZmF1bHQ6IDEsXG4gICAgfSxcbn07XG5mdW5jdGlvbiBnZXRDU1MoKSB7XG4gICAgbGV0IHJldCA9IFwiXCI7XG4gICAgT2JqZWN0LmtleXMoZmlsdGVycykuZm9yRWFjaCgoZmlsdGVyS2V5KSA9PiB7XG4gICAgICAgIGNvbnN0IGtleSA9IGZpbHRlcktleTtcbiAgICAgICAgaWYgKGZpbHRlcnNba2V5XS52YWx1ZSAhPSBmaWx0ZXJzW2tleV0uZGVmYXVsdCkge1xuICAgICAgICAgICAgcmV0ICs9IGAke2ZpbHRlcktleX0oJHtmaWx0ZXJzW2tleV0udmFsdWV9JHtmaWx0ZXJLZXkgPT0gXCJibHVyXCIgPyBcInJlbVwiIDogXCJcIn0pIGA7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcmV0O1xufVxuZXhwb3J0cy5nZXRDU1MgPSBnZXRDU1M7XG5mdW5jdGlvbiBhcHBseSgpIHtcbiAgICBjb25zdCBmaWx0ZXJDU1MgPSBnZXRDU1MoKTtcbiAgICBjb25zdCBjc3MgPSB7XG4gICAgICAgIGZpbHRlcjogZmlsdGVyQ1NTLFxuICAgICAgICB3aWR0aDogYGNhbGMoMTAwJSArICR7ZmlsdGVycy5ibHVyLnZhbHVlICogNH1yZW0pYCxcbiAgICAgICAgaGVpZ2h0OiBgY2FsYygxMDAlICsgJHtmaWx0ZXJzLmJsdXIudmFsdWUgKiA0fXJlbSlgLFxuICAgICAgICBsZWZ0OiBgLSR7ZmlsdGVycy5ibHVyLnZhbHVlICogMn1yZW1gLFxuICAgICAgICB0b3A6IGAtJHtmaWx0ZXJzLmJsdXIudmFsdWUgKiAyfXJlbWAsXG4gICAgICAgIHBvc2l0aW9uOiBcImFic29sdXRlXCIsXG4gICAgfTtcbiAgICAkKFwiLmN1c3RvbUJhY2tncm91bmQgaW1nXCIpLmNzcyhjc3MpO1xufVxuZXhwb3J0cy5hcHBseSA9IGFwcGx5O1xuZnVuY3Rpb24gc3luY1NsaWRlcnMoKSB7XG4gICAgJChcIi5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgLmJsdXIgaW5wdXRcIikudmFsKGZpbHRlcnNbXCJibHVyXCJdLnZhbHVlKTtcbiAgICAkKFwiLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlciAuYnJpZ2h0bmVzcyBpbnB1dFwiKS52YWwoZmlsdGVyc1tcImJyaWdodG5lc3NcIl0udmFsdWUpO1xuICAgICQoXCIuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyIC5zYXR1cmF0ZSBpbnB1dFwiKS52YWwoZmlsdGVyc1tcInNhdHVyYXRlXCJdLnZhbHVlKTtcbiAgICAkKFwiLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlciAub3BhY2l0eSBpbnB1dFwiKS52YWwoZmlsdGVyc1tcIm9wYWNpdHlcIl0udmFsdWUpO1xufVxuZnVuY3Rpb24gdXBkYXRlTnVtYmVycygpIHtcbiAgICAkKFwiLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlciAuYmx1ciAudmFsdWVcIikuaHRtbChmaWx0ZXJzLmJsdXIudmFsdWUudG9GaXhlZCgxKSk7XG4gICAgJChcIi5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgLmJyaWdodG5lc3MgLnZhbHVlXCIpLmh0bWwoZmlsdGVycy5icmlnaHRuZXNzLnZhbHVlLnRvRml4ZWQoMSkpO1xuICAgICQoXCIuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyIC5zYXR1cmF0ZSAudmFsdWVcIikuaHRtbChmaWx0ZXJzLnNhdHVyYXRlLnZhbHVlLnRvRml4ZWQoMSkpO1xuICAgICQoXCIuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyIC5vcGFjaXR5IC52YWx1ZVwiKS5odG1sKGZpbHRlcnMub3BhY2l0eS52YWx1ZS50b0ZpeGVkKDEpKTtcbn1cbmZ1bmN0aW9uIGxvYWRDb25maWcoY29uZmlnKSB7XG4gICAgZmlsdGVycy5ibHVyLnZhbHVlID0gY29uZmlnWzBdO1xuICAgIGZpbHRlcnMuYnJpZ2h0bmVzcy52YWx1ZSA9IGNvbmZpZ1sxXTtcbiAgICBmaWx0ZXJzLnNhdHVyYXRlLnZhbHVlID0gY29uZmlnWzJdO1xuICAgIGZpbHRlcnMub3BhY2l0eS52YWx1ZSA9IGNvbmZpZ1szXTtcbiAgICB1cGRhdGVOdW1iZXJzKCk7XG4gICAgc3luY1NsaWRlcnMoKTtcbn1cbmV4cG9ydHMubG9hZENvbmZpZyA9IGxvYWRDb25maWc7XG4kKFwiLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlciAuYmx1ciBpbnB1dFwiKS5vbihcImlucHV0XCIsICgpID0+IHtcbiAgICBmaWx0ZXJzW1wiYmx1clwiXS52YWx1ZSA9IHBhcnNlRmxvYXQoJChcIi5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgLmJsdXIgaW5wdXRcIikudmFsKCkpO1xuICAgIHVwZGF0ZU51bWJlcnMoKTtcbiAgICBhcHBseSgpO1xufSk7XG4kKFwiLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlciAuYnJpZ2h0bmVzcyBpbnB1dFwiKS5vbihcImlucHV0XCIsICgpID0+IHtcbiAgICBmaWx0ZXJzW1wiYnJpZ2h0bmVzc1wiXS52YWx1ZSA9IHBhcnNlRmxvYXQoJChcIi5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgLmJyaWdodG5lc3MgaW5wdXRcIikudmFsKCkpO1xuICAgIHVwZGF0ZU51bWJlcnMoKTtcbiAgICBhcHBseSgpO1xufSk7XG4kKFwiLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlciAuc2F0dXJhdGUgaW5wdXRcIikub24oXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgZmlsdGVyc1tcInNhdHVyYXRlXCJdLnZhbHVlID0gcGFyc2VGbG9hdCgkKFwiLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlciAuc2F0dXJhdGUgaW5wdXRcIikudmFsKCkpO1xuICAgIHVwZGF0ZU51bWJlcnMoKTtcbiAgICBhcHBseSgpO1xufSk7XG4kKFwiLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlciAub3BhY2l0eSBpbnB1dFwiKS5vbihcImlucHV0XCIsICgpID0+IHtcbiAgICBmaWx0ZXJzW1wib3BhY2l0eVwiXS52YWx1ZSA9IHBhcnNlRmxvYXQoJChcIi5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRGaWx0ZXIgLm9wYWNpdHkgaW5wdXRcIikudmFsKCkpO1xuICAgIHVwZGF0ZU51bWJlcnMoKTtcbiAgICBhcHBseSgpO1xufSk7XG4kKFwiLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlciAgLnNhdmUuYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGFyciA9IE9iamVjdC5rZXlzKGZpbHRlcnMpLm1hcCgoZmlsdGVyS2V5KSA9PiBmaWx0ZXJzW2ZpbHRlcktleV0udmFsdWUpO1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21CYWNrZ3JvdW5kRmlsdGVyKGFyciwgZmFsc2UpO1xuICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ3VzdG9tIGJhY2tncm91bmQgZmlsdGVycyBzYXZlZFwiLCAxKTtcbn0pO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSwgZXZlbnRWYWx1ZSkgPT4ge1xuICAgIGlmIChldmVudEtleSA9PT0gXCJjdXN0b21CYWNrZ3JvdW5kRmlsdGVyXCIpIHtcbiAgICAgICAgbG9hZENvbmZpZyhldmVudFZhbHVlLm1hcCgoZXYpID0+IHBhcnNlRmxvYXQoZXYpKSk7XG4gICAgICAgIGFwcGx5KCk7XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnJlZnJlc2ggPSBleHBvcnRzLnNob3cgPSBleHBvcnRzLmhpZGUgPSBleHBvcnRzLmZsYXNoS2V5ID0gZXhwb3J0cy5oaWdobGlnaHRLZXkgPSB2b2lkIDA7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IFRoZW1lQ29sb3JzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3RoZW1lLWNvbG9yc1wiKSk7XG5jb25zdCBTbG93VGltZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9zbG93LXRpbWVyXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5mdW5jdGlvbiBoaWdobGlnaHRLZXkoY3VycmVudEtleSkge1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiemVuXCIpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoY3VycmVudEtleSA9PT0gXCJcIilcbiAgICAgICAgY3VycmVudEtleSA9IFwiIFwiO1xuICAgIHRyeSB7XG4gICAgICAgIGlmICgkKFwiLmFjdGl2ZS1rZXlcIikgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAkKFwiLmFjdGl2ZS1rZXlcIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmUta2V5XCIpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBoaWdobGlnaHRLZXk7XG4gICAgICAgIGlmIChjdXJyZW50S2V5ID09IFwiIFwiKSB7XG4gICAgICAgICAgICBoaWdobGlnaHRLZXkgPSBcIiNrZXltYXAgLmtleS1zcGFjZSwgI2tleW1hcCAua2V5LXNwbGl0LXNwYWNlXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY3VycmVudEtleSA9PSAnXCInKSB7XG4gICAgICAgICAgICBoaWdobGlnaHRLZXkgPSBgI2tleW1hcCAua2V5bWFwLWtleVtkYXRhLWtleSo9JyR7Y3VycmVudEtleX0nXWA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBoaWdobGlnaHRLZXkgPSBgI2tleW1hcCAua2V5bWFwLWtleVtkYXRhLWtleSo9XCIke2N1cnJlbnRLZXl9XCJdYDtcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZyhcImhpZ2hsaWdodGluZ1wiLCBoaWdobGlnaHRLZXkpO1xuICAgICAgICAkKGhpZ2hsaWdodEtleSkuYWRkQ2xhc3MoXCJhY3RpdmUta2V5XCIpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvdWxkIG5vdCB1cGRhdGUgaGlnaGxpZ2h0ZWQga2V5bWFwIGtleTogXCIgKyBlLm1lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5oaWdobGlnaHRLZXkgPSBoaWdobGlnaHRLZXk7XG5mdW5jdGlvbiBmbGFzaEtleShrZXksIGNvcnJlY3QpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoa2V5ID09IHVuZGVmaW5lZClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKGtleSA9PSBcIiBcIikge1xuICAgICAgICAgICAga2V5ID0gXCIja2V5bWFwIC5rZXktc3BhY2UsICNrZXltYXAgLmtleS1zcGxpdC1zcGFjZVwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGtleSA9PSAnXCInKSB7XG4gICAgICAgICAgICBrZXkgPSBgI2tleW1hcCAua2V5bWFwLWtleVtkYXRhLWtleSo9JyR7a2V5fSddYDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGtleSA9IGAja2V5bWFwIC5rZXltYXAta2V5W2RhdGEta2V5Kj1cIiR7a2V5fVwiXWA7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdGhlbWVjb2xvcnMgPSB5aWVsZCBUaGVtZUNvbG9ycy5nZXRBbGwoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChjb3JyZWN0IHx8IGNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlKSB7XG4gICAgICAgICAgICAgICAgJChrZXkpXG4gICAgICAgICAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogdGhlbWVjb2xvcnMuYmcsXG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogdGhlbWVjb2xvcnMubWFpbixcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IHRoZW1lY29sb3JzLm1haW4sXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogdGhlbWVjb2xvcnMuc3ViLFxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwidHJhbnNwYXJlbnRcIixcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IHRoZW1lY29sb3JzLnN1YixcbiAgICAgICAgICAgICAgICB9LCBTbG93VGltZXIuZ2V0KCkgPyAwIDogNTAwLCBcImVhc2VPdXRFeHBvXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJChrZXkpXG4gICAgICAgICAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogdGhlbWVjb2xvcnMuYmcsXG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogdGhlbWVjb2xvcnMuZXJyb3IsXG4gICAgICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiB0aGVtZWNvbG9ycy5lcnJvcixcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiB0aGVtZWNvbG9ycy5zdWIsXG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogXCJ0cmFuc3BhcmVudFwiLFxuICAgICAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogdGhlbWVjb2xvcnMuc3ViLFxuICAgICAgICAgICAgICAgIH0sIFNsb3dUaW1lci5nZXQoKSA/IDAgOiA1MDAsIFwiZWFzZU91dEV4cG9cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5mbGFzaEtleSA9IGZsYXNoS2V5O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAkKFwiI2tleW1hcFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG5mdW5jdGlvbiBzaG93KCkge1xuICAgICQoXCIja2V5bWFwXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIHJlZnJlc2gobGF5b3V0TmFtZSA9IGNvbmZpZ18xLmRlZmF1bHQubGF5b3V0KSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCFsYXlvdXROYW1lKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgbGF5b3V0cyA9IHlpZWxkIE1pc2MuZ2V0TGF5b3V0c0xpc3QoKTtcbiAgICAgICAgICAgIGxldCBsdHMgPSBsYXlvdXRzW2xheW91dE5hbWVdOyAvL2xheW91dCB0byBzaG93XG4gICAgICAgICAgICBsZXQgbGF5b3V0U3RyaW5nID0gbGF5b3V0TmFtZTtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmtleW1hcExheW91dCA9PT0gXCJvdmVycmlkZVN5bmNcIikge1xuICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmxheW91dCA9PT0gXCJkZWZhdWx0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbHRzID0gbGF5b3V0c1tcInF3ZXJ0eVwiXTtcbiAgICAgICAgICAgICAgICAgICAgbGF5b3V0U3RyaW5nID0gXCJkZWZhdWx0XCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsdHMgPSBsYXlvdXRzW2NvbmZpZ18xLmRlZmF1bHQubGF5b3V0XTtcbiAgICAgICAgICAgICAgICAgICAgbGF5b3V0U3RyaW5nID0gY29uZmlnXzEuZGVmYXVsdC5sYXlvdXQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbHRzID0gbGF5b3V0c1tjb25maWdfMS5kZWZhdWx0LmtleW1hcExheW91dF07XG4gICAgICAgICAgICAgICAgbGF5b3V0U3RyaW5nID0gY29uZmlnXzEuZGVmYXVsdC5rZXltYXBMYXlvdXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBzaG93VG9wUm93ID0gbHRzLmtleW1hcFNob3dUb3BSb3c7XG4gICAgICAgICAgICBjb25zdCBpc01hdHJpeCA9IGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwU3R5bGUgPT09IFwibWF0cml4XCIgfHwgY29uZmlnXzEuZGVmYXVsdC5rZXltYXBTdHlsZSA9PT0gXCJzcGxpdF9tYXRyaXhcIjtcbiAgICAgICAgICAgIGxldCBrZXltYXBFbGVtZW50ID0gXCJcIjtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGx0cy5rZXlzKS5mb3JFYWNoKChyb3csIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm93S2V5cyA9IGx0cy5rZXlzW3Jvd107XG4gICAgICAgICAgICAgICAgbGV0IHJvd0VsZW1lbnQgPSBcIlwiO1xuICAgICAgICAgICAgICAgIGlmIChyb3cgPT09IFwicm93MVwiICYmICFzaG93VG9wUm93KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKChyb3cgPT09IFwicm93MlwiIHx8IHJvdyA9PT0gXCJyb3czXCIgfHwgcm93ID09PSBcInJvdzRcIikgJiYgIWlzTWF0cml4KSB7XG4gICAgICAgICAgICAgICAgICAgIHJvd0VsZW1lbnQgKz0gXCI8ZGl2PjwvZGl2PlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocm93ID09PSBcInJvdzRcIiAmJiBsdHMudHlwZSAhPT0gXCJpc29cIiAmJiAhaXNNYXRyaXgpIHtcbiAgICAgICAgICAgICAgICAgICAgcm93RWxlbWVudCArPSBcIjxkaXY+PC9kaXY+XCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyb3cgPT09IFwicm93NVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBsYXlvdXREaXNwbGF5ID0gbGF5b3V0U3RyaW5nLnJlcGxhY2UoL18vZywgXCIgXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBMZWdlbmRTdHlsZSA9PT0gXCJibGFua1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXlvdXREaXNwbGF5ID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByb3dFbGVtZW50ICs9IFwiPGRpdj48L2Rpdj5cIjtcbiAgICAgICAgICAgICAgICAgICAgcm93RWxlbWVudCArPSBgPGRpdiBjbGFzcz1cImtleW1hcC1rZXkga2V5LXNwYWNlXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImxldHRlclwiPiR7bGF5b3V0RGlzcGxheX08L2Rpdj5cbiAgICAgICAgPC9kaXY+YDtcbiAgICAgICAgICAgICAgICAgICAgcm93RWxlbWVudCArPSBgPGRpdiBjbGFzcz1cImtleW1hcC1zcGxpdC1zcGFjZXJcIj48L2Rpdj5gO1xuICAgICAgICAgICAgICAgICAgICByb3dFbGVtZW50ICs9IGA8ZGl2IGNsYXNzPVwia2V5bWFwLWtleSBrZXktc3BsaXQtc3BhY2VcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwibGV0dGVyXCI+PC9kaXY+XG4gICAgICAgIDwvZGl2PmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJvd0tleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyb3cgPT09IFwicm93MlwiICYmIGkgPT09IDEyKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChjb25maWdfMS5kZWZhdWx0LmtleW1hcFN0eWxlID09PSBcIm1hdHJpeFwiIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5rZXltYXBTdHlsZSA9PT0gXCJzcGxpdF9tYXRyaXhcIikgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpID49IDEwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSByb3dLZXlzW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYnVtcCA9IHJvdyA9PT0gXCJyb3czXCIgJiYgKGkgPT09IDMgfHwgaSA9PT0gNikgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQga2V5RGlzcGxheSA9IGtleVswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmtleW1hcExlZ2VuZFN0eWxlID09PSBcImJsYW5rXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlEaXNwbGF5ID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTGVnZW5kU3R5bGUgPT09IFwidXBwZXJjYXNlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlEaXNwbGF5ID0ga2V5RGlzcGxheS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qga2V5RWxlbWVudCA9IGA8ZGl2IGNsYXNzPVwia2V5bWFwLWtleVwiIGRhdGEta2V5PVwiJHtrZXkucmVwbGFjZSgnXCInLCBcIiZxdW90O1wiKX1cIj5cbiAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJsZXR0ZXJcIj4ke2tleURpc3BsYXl9PC9zcGFuPlxuICAgICAgICAgICAgICAke2J1bXAgPyBcIjxkaXYgY2xhc3M9J2J1bXAnPjwvZGl2PlwiIDogXCJcIn1cbiAgICAgICAgICA8L2Rpdj5gO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNwbGl0U3BhY2VyID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmtleW1hcFN0eWxlID09PSBcInNwbGl0XCIgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0LmtleW1hcFN0eWxlID09PSBcInNwbGl0X21hdHJpeFwiIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5rZXltYXBTdHlsZSA9PT0gXCJhbGljZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvdyA9PT0gXCJyb3c0XCIgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwU3R5bGUgPT09IFwic3BsaXRcIiB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5rZXltYXBTdHlsZSA9PT0gXCJhbGljZVwiKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsdHMudHlwZSA9PT0gXCJpc29cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gNikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BsaXRTcGFjZXIgKz0gYDxkaXYgY2xhc3M9XCJrZXltYXAtc3BsaXQtc3BhY2VyXCI+PC9kaXY+YDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IDUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwbGl0U3BhY2VyICs9IGA8ZGl2IGNsYXNzPVwia2V5bWFwLXNwbGl0LXNwYWNlclwiPjwvZGl2PmA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBTdHlsZSA9PT0gXCJhbGljZVwiICYmIHJvdyA9PT0gXCJyb3c0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGx0cy50eXBlID09PSBcImlzb1wiICYmIGkgPT09IDYpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChsdHMudHlwZSAhPT0gXCJpc29cIiAmJiBpID09PSA1KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGxpdFNwYWNlciArPSBgPGRpdiBjbGFzcz1cImV4dHJhLWtleVwiPjxzcGFuIGNsYXNzPVwibGV0dGVyXCI+PC9zcGFuPjwvZGl2PmA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcm93RWxlbWVudCArPSBzcGxpdFNwYWNlciArIGtleUVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAga2V5bWFwRWxlbWVudCArPSBgPGRpdiBjbGFzcz1cInJvdyByJHtpbmRleCArIDF9XCI+JHtyb3dFbGVtZW50fTwvZGl2PmA7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICQoXCIja2V5bWFwXCIpLmh0bWwoa2V5bWFwRWxlbWVudCk7XG4gICAgICAgICAgICAkKFwiI2tleW1hcFwiKS5yZW1vdmVDbGFzcyhcInN0YWdnZXJlZFwiKTtcbiAgICAgICAgICAgICQoXCIja2V5bWFwXCIpLnJlbW92ZUNsYXNzKFwibWF0cml4XCIpO1xuICAgICAgICAgICAgJChcIiNrZXltYXBcIikucmVtb3ZlQ2xhc3MoXCJzcGxpdFwiKTtcbiAgICAgICAgICAgICQoXCIja2V5bWFwXCIpLnJlbW92ZUNsYXNzKFwic3BsaXRfbWF0cml4XCIpO1xuICAgICAgICAgICAgJChcIiNrZXltYXBcIikucmVtb3ZlQ2xhc3MoXCJhbGljZVwiKTtcbiAgICAgICAgICAgICQoXCIja2V5bWFwXCIpLmFkZENsYXNzKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwU3R5bGUpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJzb21ldGhpbmcgd2VudCB3cm9uZyB3aGVuIGNoYW5naW5nIGxheW91dCwgcmVzZXR0aW5nczogXCIgKyBlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBMYXlvdXQoXCJxd2VydHlcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMucmVmcmVzaCA9IHJlZnJlc2g7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5KSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImxheW91dFwiICYmIGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTGF5b3V0ID09PSBcIm92ZXJyaWRlU3luY1wiKSB7XG4gICAgICAgIHJlZnJlc2goY29uZmlnXzEuZGVmYXVsdC5rZXltYXBMYXlvdXQpO1xuICAgIH1cbiAgICBpZiAoZXZlbnRLZXkgPT09IFwia2V5bWFwTGF5b3V0XCIgfHwgZXZlbnRLZXkgPT09IFwia2V5bWFwU3R5bGVcIilcbiAgICAgICAgcmVmcmVzaCgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmdldEFjYyA9IGV4cG9ydHMuZ2V0V1BNID0gZXhwb3J0cy51cGRhdGUgPSB2b2lkIDA7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IFRlc3RXb3JkcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LXdvcmRzXCIpKTtcbmxldCBhdmVyYWdlV1BNID0gMDtcbmxldCBhdmVyYWdlQWNjID0gMDtcbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCBtb2RlMiA9IE1pc2MuZ2V0TW9kZTIoY29uZmlnXzEuZGVmYXVsdCwgVGVzdFdvcmRzLnJhbmRvbVF1b3RlKTtcbiAgICAgICAgY29uc3QgW3dwbSwgYWNjXSA9ICh5aWVsZCBEQi5nZXRVc2VyQXZlcmFnZTEwKGNvbmZpZ18xLmRlZmF1bHQubW9kZSwgbW9kZTIsIGNvbmZpZ18xLmRlZmF1bHQucHVuY3R1YXRpb24sIGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UsIGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSwgY29uZmlnXzEuZGVmYXVsdC5sYXp5TW9kZSkpXG4gICAgICAgICAgICAubWFwKE1pc2Mucm91bmRUbzIpXG4gICAgICAgICAgICAubWFwKChudW0pID0+IChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzID8gTWF0aC5yb3VuZChudW0pIDogbnVtKSk7XG4gICAgICAgIGF2ZXJhZ2VXUE0gPSB3cG07XG4gICAgICAgIGF2ZXJhZ2VBY2MgPSBhY2M7XG4gICAgfSk7XG59XG5leHBvcnRzLnVwZGF0ZSA9IHVwZGF0ZTtcbmZ1bmN0aW9uIGdldFdQTSgpIHtcbiAgICByZXR1cm4gYXZlcmFnZVdQTTtcbn1cbmV4cG9ydHMuZ2V0V1BNID0gZ2V0V1BNO1xuZnVuY3Rpb24gZ2V0QWNjKCkge1xuICAgIHJldHVybiBhdmVyYWdlQWNjO1xufVxuZXhwb3J0cy5nZXRBY2MgPSBnZXRBY2M7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNob3cgPSBleHBvcnRzLmhpZGUgPSB2b2lkIDA7XG5jb25zdCBhcGVfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vYXBlXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IGZvcm1hdF8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJkYXRlLWZucy9mb3JtYXRcIikpO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuLi9maXJlYmFzZVwiKTtcbmNvbnN0IGN1cnJlbnRMZWFkZXJib2FyZCA9IFwidGltZV8xNVwiO1xubGV0IGN1cnJlbnREYXRhID0ge1xuICAgIDE1OiBbXSxcbiAgICA2MDogW10sXG59O1xubGV0IGN1cnJlbnRSYW5rID0ge1xuICAgIDE1OiB7fSxcbiAgICA2MDoge30sXG59O1xuY29uc3QgcmVxdWVzdGluZyA9IHtcbiAgICAxNTogZmFsc2UsXG4gICAgNjA6IGZhbHNlLFxufTtcbmNvbnN0IGxlYWRlcmJvYXJkU2luZ2xlTGltaXQgPSA1MDtcbmxldCB1cGRhdGVUaW1lcjtcbmZ1bmN0aW9uIGNsZWFyVGFibGUobGIpIHtcbiAgICBpZiAobGIgPT09IDE1KSB7XG4gICAgICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciB0YWJsZS5sZWZ0IHRib2R5XCIpLmVtcHR5KCk7XG4gICAgICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciB0YWJsZS5sZWZ0IHRmb290XCIpLmVtcHR5KCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGxiID09PSA2MCkge1xuICAgICAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgdGFibGUucmlnaHQgdGJvZHlcIikuZW1wdHkoKTtcbiAgICAgICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyIHRhYmxlLnJpZ2h0IHRmb290XCIpLmVtcHR5KCk7XG4gICAgfVxufVxuZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgY3VycmVudERhdGEgPSB7XG4gICAgICAgIDE1OiBbXSxcbiAgICAgICAgNjA6IFtdLFxuICAgIH07XG4gICAgY3VycmVudFJhbmsgPSB7XG4gICAgICAgIDE1OiB7fSxcbiAgICAgICAgNjA6IHt9LFxuICAgIH07XG59XG5mdW5jdGlvbiBzdG9wVGltZXIoKSB7XG4gICAgY2xlYXJJbnRlcnZhbCh1cGRhdGVUaW1lcik7XG4gICAgdXBkYXRlVGltZXIgPSB1bmRlZmluZWQ7XG4gICAgJChcIiNsZWFkZXJib2FyZHMgLnN1YlRpdGxlXCIpLnRleHQoXCJOZXh0IHVwZGF0ZSBpbjogLS06LS1cIik7XG59XG5mdW5jdGlvbiB1cGRhdGVUaW1lckVsZW1lbnQoKSB7XG4gICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgbWludXRlc1RvTmV4dFVwZGF0ZSA9IDE0IC0gKGRhdGUuZ2V0TWludXRlcygpICUgMTUpO1xuICAgIGNvbnN0IHNlY29uZHNUb05leHRVcGRhdGUgPSA2MCAtIGRhdGUuZ2V0U2Vjb25kcygpO1xuICAgIGNvbnN0IHRvdGFsU2Vjb25kcyA9IG1pbnV0ZXNUb05leHRVcGRhdGUgKiA2MCArIHNlY29uZHNUb05leHRVcGRhdGU7XG4gICAgJChcIiNsZWFkZXJib2FyZHMgLnN1YlRpdGxlXCIpLnRleHQoXCJOZXh0IHVwZGF0ZSBpbjogXCIgKyBNaXNjLnNlY29uZHNUb1N0cmluZyh0b3RhbFNlY29uZHMsIHRydWUpKTtcbn1cbmZ1bmN0aW9uIHN0YXJ0VGltZXIoKSB7XG4gICAgdXBkYXRlVGltZXJFbGVtZW50KCk7XG4gICAgdXBkYXRlVGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgIHVwZGF0ZVRpbWVyRWxlbWVudCgpO1xuICAgIH0sIDEwMDApO1xufVxuZnVuY3Rpb24gc2hvd0xvYWRlcihsYikge1xuICAgIGlmIChsYiA9PT0gMTUpIHtcbiAgICAgICAgJChgI2xlYWRlcmJvYXJkc1dyYXBwZXIgLmxlZnRUYWJsZUxvYWRlcmApLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChsYiA9PT0gNjApIHtcbiAgICAgICAgJChgI2xlYWRlcmJvYXJkc1dyYXBwZXIgLnJpZ2h0VGFibGVMb2FkZXJgKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG59XG5mdW5jdGlvbiBoaWRlTG9hZGVyKGxiKSB7XG4gICAgaWYgKGxiID09PSAxNSkge1xuICAgICAgICAkKGAjbGVhZGVyYm9hcmRzV3JhcHBlciAubGVmdFRhYmxlTG9hZGVyYCkuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGxiID09PSA2MCkge1xuICAgICAgICAkKGAjbGVhZGVyYm9hcmRzV3JhcHBlciAucmlnaHRUYWJsZUxvYWRlcmApLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHVwZGF0ZUZvb3RlcihsYikge1xuICAgIGxldCBzaWRlO1xuICAgIGlmIChsYiA9PT0gMTUpIHtcbiAgICAgICAgc2lkZSA9IFwibGVmdFwiO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgc2lkZSA9IFwicmlnaHRcIjtcbiAgICB9XG4gICAgJChgI2xlYWRlcmJvYXJkc1dyYXBwZXIgdGFibGUuJHtzaWRlfSB0Zm9vdGApLmh0bWwoYFxuICAgIDx0cj5cbiAgICAgIDx0ZD48YnI+PGJyPjwvdGQ+XG4gICAgICA8dGQgY29sc3Bhbj1cIjRcIiBzdHlsZT1cInRleHQtYWxpZ246Y2VudGVyO1wiPk5vdCBxdWFsaWZpZWQ8Lz5cbiAgICAgIDx0ZD48YnI+PGJyPjwvdGQ+XG4gICAgPC90cj5cbiAgICBgKTtcbiAgICBsZXQgdG9wcGVyY2VudDtcbiAgICBpZiAoY3VycmVudFJhbmtbbGJdKSB7XG4gICAgICAgIGxldCBudW0gPSBNaXNjLnJvdW5kVG8yKChjdXJyZW50UmFua1tsYl1bXCJyYW5rXCJdIC8gY3VycmVudFJhbmtbbGJdLmNvdW50KSAqIDEwMCk7XG4gICAgICAgIGlmIChudW0gPT0gMCkge1xuICAgICAgICAgICAgbnVtID0gMC4wMTtcbiAgICAgICAgfVxuICAgICAgICB0b3BwZXJjZW50ID0gYFRvcCAke251bX0lYDtcbiAgICB9XG4gICAgaWYgKGN1cnJlbnRSYW5rW2xiXSkge1xuICAgICAgICBjb25zdCBlbnRyeSA9IGN1cnJlbnRSYW5rW2xiXTtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKGVudHJ5LnRpbWVzdGFtcCk7XG4gICAgICAgICQoYCNsZWFkZXJib2FyZHNXcmFwcGVyIHRhYmxlLiR7c2lkZX0gdGZvb3RgKS5odG1sKGBcbiAgICA8dHI+XG4gICAgPHRkPiR7ZW50cnkucmFua308L3RkPlxuICAgIDx0ZD48c3BhbiBjbGFzcz1cInRvcFwiPllvdTwvc3Bhbj48YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4ke3RvcHBlcmNlbnR9PC9zcGFuPjwvdGQ+XG4gICAgPHRkIGNsYXNzPVwiYWxpZ25SaWdodFwiPiR7KGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTVxuICAgICAgICAgICAgPyBlbnRyeS53cG0gKiA1XG4gICAgICAgICAgICA6IGVudHJ5LndwbSkudG9GaXhlZCgyKX08YnI+PGRpdiBjbGFzcz1cInN1YlwiPiR7ZW50cnkuYWNjLnRvRml4ZWQoMil9JTwvZGl2PjwvdGQ+XG4gICAgPHRkIGNsYXNzPVwiYWxpZ25SaWdodFwiPiR7KGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTVxuICAgICAgICAgICAgPyBlbnRyeS5yYXcgKiA1XG4gICAgICAgICAgICA6IGVudHJ5LnJhdykudG9GaXhlZCgyKX08YnI+PGRpdiBjbGFzcz1cInN1YlwiPiR7IWVudHJ5LmNvbnNpc3RlbmN5IHx8IGVudHJ5LmNvbnNpc3RlbmN5ID09PSBcIi1cIlxuICAgICAgICAgICAgPyBcIi1cIlxuICAgICAgICAgICAgOiBlbnRyeS5jb25zaXN0ZW5jeS50b0ZpeGVkKDIpICsgXCIlXCJ9PC9kaXY+PC90ZD5cbiAgICA8dGQgY2xhc3M9XCJhbGlnblJpZ2h0XCI+dGltZTxicj48ZGl2IGNsYXNzPVwic3ViXCI+JHtsYn08L2Rpdj48L3RkPlxuICAgIDx0ZCBjbGFzcz1cImFsaWduUmlnaHRcIj4keygwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcImRkIE1NTSB5eXl5XCIpfTxicj5cbiAgICA8ZGl2IGNsYXNzPSdzdWInPiR7KDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiSEg6bW1cIil9PC9kaXY+PC90ZD5cbiAgPC90cj5cbiAgYCk7XG4gICAgfVxufVxuZnVuY3Rpb24gY2hlY2tMYk1lbW9yeShsYikge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2U7XG4gICAgbGV0IHNpZGU7XG4gICAgaWYgKGxiID09PSAxNSkge1xuICAgICAgICBzaWRlID0gXCJsZWZ0XCI7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBzaWRlID0gXCJyaWdodFwiO1xuICAgIH1cbiAgICBjb25zdCBtZW1vcnkgPSAoX2UgPSAoX2QgPSAoX2MgPSAoX2IgPSAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGJNZW1vcnkpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50aW1lKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2NbbGJdKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2RbXCJlbmdsaXNoXCJdKSAhPT0gbnVsbCAmJiBfZSAhPT0gdm9pZCAwID8gX2UgOiAwO1xuICAgIGlmIChjdXJyZW50UmFua1tsYl0pIHtcbiAgICAgICAgY29uc3QgZGlmZmVyZW5jZSA9IG1lbW9yeSAtIGN1cnJlbnRSYW5rW2xiXS5yYW5rO1xuICAgICAgICBpZiAoZGlmZmVyZW5jZSA+IDApIHtcbiAgICAgICAgICAgIERCLnVwZGF0ZUxiTWVtb3J5KFwidGltZVwiLCBsYiwgXCJlbmdsaXNoXCIsIGN1cnJlbnRSYW5rW2xiXS5yYW5rLCB0cnVlKTtcbiAgICAgICAgICAgIGlmIChtZW1vcnkgIT09IDApIHtcbiAgICAgICAgICAgICAgICAkKGAjbGVhZGVyYm9hcmRzV3JhcHBlciB0YWJsZS4ke3NpZGV9IHRmb290IHRyIHRkIC50b3BgKS5hcHBlbmQoYCAoPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtYW5nbGUtdXBcIj48L2k+JHtNYXRoLmFicyhkaWZmZXJlbmNlKX0gc2luY2UgeW91IGxhc3QgY2hlY2tlZClgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChkaWZmZXJlbmNlIDwgMCkge1xuICAgICAgICAgICAgREIudXBkYXRlTGJNZW1vcnkoXCJ0aW1lXCIsIGxiLCBcImVuZ2xpc2hcIiwgY3VycmVudFJhbmtbbGJdLnJhbmssIHRydWUpO1xuICAgICAgICAgICAgaWYgKG1lbW9yeSAhPT0gMCkge1xuICAgICAgICAgICAgICAgICQoYCNsZWFkZXJib2FyZHNXcmFwcGVyIHRhYmxlLiR7c2lkZX0gdGZvb3QgdHIgdGQgLnRvcGApLmFwcGVuZChgICg8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1hbmdsZS1kb3duXCI+PC9pPiR7TWF0aC5hYnMoZGlmZmVyZW5jZSl9IHNpbmNlIHlvdSBsYXN0IGNoZWNrZWQpYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAobWVtb3J5ICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgJChgI2xlYWRlcmJvYXJkc1dyYXBwZXIgdGFibGUuJHtzaWRlfSB0Zm9vdCB0ciB0ZCAudG9wYCkuYXBwZW5kKGAgKCA9IHNpbmNlIHlvdSBsYXN0IGNoZWNrZWQpYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBmaWxsVGFibGUobGIsIHByZXBlbmQpIHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKCFjdXJyZW50RGF0YVtsYl0pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgc2lkZTtcbiAgICBpZiAobGIgPT09IDE1KSB7XG4gICAgICAgIHNpZGUgPSBcImxlZnRcIjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHNpZGUgPSBcInJpZ2h0XCI7XG4gICAgfVxuICAgIGNvbnN0IGxvZ2dlZEluVXNlck5hbWUgPSAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubmFtZTtcbiAgICBsZXQgYSA9IGN1cnJlbnREYXRhW2xiXS5sZW5ndGggLSBsZWFkZXJib2FyZFNpbmdsZUxpbWl0O1xuICAgIGxldCBiID0gY3VycmVudERhdGFbbGJdLmxlbmd0aDtcbiAgICBpZiAoYSA8IDApXG4gICAgICAgIGEgPSAwO1xuICAgIGlmIChwcmVwZW5kKSB7XG4gICAgICAgIGEgPSAwO1xuICAgICAgICBiID0gcHJlcGVuZDtcbiAgICB9XG4gICAgbGV0IGh0bWwgPSBcIlwiO1xuICAgIGZvciAobGV0IGkgPSBhOyBpIDwgYjsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGVudHJ5ID0gY3VycmVudERhdGFbbGJdW2ldO1xuICAgICAgICBpZiAoIWVudHJ5KSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAoZW50cnkuaGlkZGVuKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBsZXQgbWVDbGFzc1N0cmluZyA9IFwiXCI7XG4gICAgICAgIGlmIChlbnRyeS5uYW1lID09IGxvZ2dlZEluVXNlck5hbWUpIHtcbiAgICAgICAgICAgIG1lQ2xhc3NTdHJpbmcgPSAnIGNsYXNzPVwibWVcIic7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKGVudHJ5LnRpbWVzdGFtcCk7XG4gICAgICAgIGh0bWwgKz0gYFxuICAgIDx0ciAke21lQ2xhc3NTdHJpbmd9PlxuICAgIDx0ZD4ke2VudHJ5LnJhbmsgPT09IDEgPyAnPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtY3Jvd25cIj48L2k+JyA6IGVudHJ5LnJhbmt9PC90ZD5cbiAgICA8dGQ+JHtlbnRyeS5uYW1lfTwvdGQ+XG4gICAgPHRkIGNsYXNzPVwiYWxpZ25SaWdodFwiPiR7KGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTVxuICAgICAgICAgICAgPyBlbnRyeS53cG0gKiA1XG4gICAgICAgICAgICA6IGVudHJ5LndwbSkudG9GaXhlZCgyKX08YnI+PGRpdiBjbGFzcz1cInN1YlwiPiR7ZW50cnkuYWNjLnRvRml4ZWQoMil9JTwvZGl2PjwvdGQ+XG4gICAgPHRkIGNsYXNzPVwiYWxpZ25SaWdodFwiPiR7KGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTVxuICAgICAgICAgICAgPyBlbnRyeS5yYXcgKiA1XG4gICAgICAgICAgICA6IGVudHJ5LnJhdykudG9GaXhlZCgyKX08YnI+PGRpdiBjbGFzcz1cInN1YlwiPiR7IWVudHJ5LmNvbnNpc3RlbmN5IHx8IGVudHJ5LmNvbnNpc3RlbmN5ID09PSBcIi1cIlxuICAgICAgICAgICAgPyBcIi1cIlxuICAgICAgICAgICAgOiBlbnRyeS5jb25zaXN0ZW5jeS50b0ZpeGVkKDIpICsgXCIlXCJ9PC9kaXY+PC90ZD5cbiAgICA8dGQgY2xhc3M9XCJhbGlnblJpZ2h0XCI+dGltZTxicj48ZGl2IGNsYXNzPVwic3ViXCI+JHtsYn08L2Rpdj48L3RkPlxuICAgIDx0ZCBjbGFzcz1cImFsaWduUmlnaHRcIj4keygwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlLCBcImRkIE1NTSB5eXl5XCIpfTxicj5cbiAgICA8ZGl2IGNsYXNzPSdzdWInPiR7KDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiSEg6bW1cIil9PC9kaXY+PC90ZD5cbiAgPC90cj5cbiAgYDtcbiAgICB9XG4gICAgaWYgKCFwcmVwZW5kKSB7XG4gICAgICAgICQoYCNsZWFkZXJib2FyZHNXcmFwcGVyIHRhYmxlLiR7c2lkZX0gdGJvZHlgKS5hcHBlbmQoaHRtbCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKGAjbGVhZGVyYm9hcmRzV3JhcHBlciB0YWJsZS4ke3NpZGV9IHRib2R5YCkucHJlcGVuZChodG1sKTtcbiAgICB9XG59XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlclwiKVxuICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IDAsXG4gICAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgIGNsZWFyVGFibGUoMTUpO1xuICAgICAgICBjbGVhclRhYmxlKDYwKTtcbiAgICAgICAgcmVzZXQoKTtcbiAgICAgICAgc3RvcFRpbWVyKCk7XG4gICAgICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG5mdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyIC5idXR0b25zIC5idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICQoYCNsZWFkZXJib2FyZHNXcmFwcGVyIC5idXR0b25zIC5idXR0b25bYm9hcmQ9JHtjdXJyZW50TGVhZGVyYm9hcmR9XWApLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICBzaG93TG9hZGVyKDE1KTtcbiAgICAgICAgc2hvd0xvYWRlcig2MCk7XG4gICAgICAgIGNvbnN0IGxlYWRlcmJvYXJkUmVxdWVzdHMgPSBbXG4gICAgICAgICAgICBhcGVfMS5kZWZhdWx0LmxlYWRlcmJvYXJkcy5nZXQoXCJlbmdsaXNoXCIsIFwidGltZVwiLCBcIjE1XCIsIDApLFxuICAgICAgICAgICAgYXBlXzEuZGVmYXVsdC5sZWFkZXJib2FyZHMuZ2V0KFwiZW5nbGlzaFwiLCBcInRpbWVcIiwgXCI2MFwiLCAwKSxcbiAgICAgICAgXTtcbiAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcikge1xuICAgICAgICAgICAgbGVhZGVyYm9hcmRSZXF1ZXN0cy5wdXNoKGFwZV8xLmRlZmF1bHQubGVhZGVyYm9hcmRzLmdldFJhbmsoXCJlbmdsaXNoXCIsIFwidGltZVwiLCBcIjE1XCIpLCBhcGVfMS5kZWZhdWx0LmxlYWRlcmJvYXJkcy5nZXRSYW5rKFwiZW5nbGlzaFwiLCBcInRpbWVcIiwgXCI2MFwiKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzcG9uc2VzID0geWllbGQgUHJvbWlzZS5hbGwobGVhZGVyYm9hcmRSZXF1ZXN0cyk7XG4gICAgICAgIGNvbnN0IGZhaWxlZFJlc3BvbnNlID0gcmVzcG9uc2VzLmZpbmQoKHJlc3BvbnNlKSA9PiByZXNwb25zZS5zdGF0dXMgIT09IDIwMCk7XG4gICAgICAgIGlmIChmYWlsZWRSZXNwb25zZSkge1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGxvYWQgbGVhZGVyYm9hcmRzOiBcIiArIGZhaWxlZFJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBbbGIxNURhdGEsIGxiNjBEYXRhLCBsYjE1UmFuaywgbGI2MFJhbmtdID0gcmVzcG9uc2VzLm1hcCgocmVzcG9uc2UpID0+IHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICBjdXJyZW50RGF0YVsxNV0gPSBsYjE1RGF0YTtcbiAgICAgICAgY3VycmVudERhdGFbNjBdID0gbGI2MERhdGE7XG4gICAgICAgIGN1cnJlbnRSYW5rWzE1XSA9IGxiMTVSYW5rO1xuICAgICAgICBjdXJyZW50UmFua1s2MF0gPSBsYjYwUmFuaztcbiAgICAgICAgY29uc3QgbGVhZGVyYm9hcmRLZXlzID0gWzE1LCA2MF07XG4gICAgICAgIGxlYWRlcmJvYXJkS2V5cy5mb3JFYWNoKChsZWFkZXJib2FyZFRpbWUpID0+IHtcbiAgICAgICAgICAgIGhpZGVMb2FkZXIobGVhZGVyYm9hcmRUaW1lKTtcbiAgICAgICAgICAgIGNsZWFyVGFibGUobGVhZGVyYm9hcmRUaW1lKTtcbiAgICAgICAgICAgIHVwZGF0ZUZvb3RlcihsZWFkZXJib2FyZFRpbWUpO1xuICAgICAgICAgICAgY2hlY2tMYk1lbW9yeShsZWFkZXJib2FyZFRpbWUpO1xuICAgICAgICAgICAgZmlsbFRhYmxlKGxlYWRlcmJvYXJkVGltZSk7XG4gICAgICAgIH0pO1xuICAgICAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgLmxlZnRUYWJsZVdyYXBwZXJcIikucmVtb3ZlQ2xhc3MoXCJpbnZpc2libGVcIik7XG4gICAgICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAucmlnaHRUYWJsZVdyYXBwZXJcIikucmVtb3ZlQ2xhc3MoXCJpbnZpc2libGVcIik7XG4gICAgfSk7XG59XG5mdW5jdGlvbiByZXF1ZXN0TW9yZShsYiwgcHJlcGVuZCA9IGZhbHNlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKHByZXBlbmQgJiYgY3VycmVudERhdGFbbGJdWzBdLnJhbmsgPT09IDEpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmIChyZXF1ZXN0aW5nW2xiXSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgcmVxdWVzdGluZ1tsYl0gPSB0cnVlO1xuICAgICAgICBzaG93TG9hZGVyKGxiKTtcbiAgICAgICAgbGV0IHNraXBWYWwgPSBjdXJyZW50RGF0YVtsYl1bY3VycmVudERhdGFbbGJdLmxlbmd0aCAtIDFdLnJhbms7XG4gICAgICAgIGlmIChwcmVwZW5kKSB7XG4gICAgICAgICAgICBza2lwVmFsID0gY3VycmVudERhdGFbbGJdWzBdLnJhbmsgLSBsZWFkZXJib2FyZFNpbmdsZUxpbWl0O1xuICAgICAgICB9XG4gICAgICAgIGxldCBsaW1pdFZhbDtcbiAgICAgICAgaWYgKHNraXBWYWwgPCAwKSB7XG4gICAgICAgICAgICBsaW1pdFZhbCA9IE1hdGguYWJzKHNraXBWYWwpIC0gMTtcbiAgICAgICAgICAgIHNraXBWYWwgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5sZWFkZXJib2FyZHMuZ2V0KFwiZW5nbGlzaFwiLCBcInRpbWVcIiwgbGIsIHNraXBWYWwsIGxpbWl0VmFsKTtcbiAgICAgICAgY29uc3QgZGF0YSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCB8fCBkYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgaGlkZUxvYWRlcihsYik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHByZXBlbmQpIHtcbiAgICAgICAgICAgIGN1cnJlbnREYXRhW2xiXS51bnNoaWZ0KC4uLmRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY3VycmVudERhdGFbbGJdLnB1c2goLi4uZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHByZXBlbmQgJiYgIWxpbWl0VmFsKSB7XG4gICAgICAgICAgICBsaW1pdFZhbCA9IGxlYWRlcmJvYXJkU2luZ2xlTGltaXQgLSAxO1xuICAgICAgICB9XG4gICAgICAgIGZpbGxUYWJsZShsYiwgbGltaXRWYWwpO1xuICAgICAgICBoaWRlTG9hZGVyKGxiKTtcbiAgICAgICAgcmVxdWVzdGluZ1tsYl0gPSBmYWxzZTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHJlcXVlc3ROZXcobGIsIHNraXApIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBzaG93TG9hZGVyKGxiKTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LmxlYWRlcmJvYXJkcy5nZXQoXCJlbmdsaXNoXCIsIFwidGltZVwiLCBsYiwgc2tpcCk7XG4gICAgICAgIGNvbnN0IGRhdGEgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICBjbGVhclRhYmxlKGxiKTtcbiAgICAgICAgY3VycmVudERhdGFbbGJdID0gW107XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCB8fCBkYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgaGlkZUxvYWRlcihsYik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY3VycmVudERhdGFbbGJdID0gZGF0YTtcbiAgICAgICAgZmlsbFRhYmxlKGxiKTtcbiAgICAgICAgaGlkZUxvYWRlcihsYik7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBzaG93KCkge1xuICAgIGlmICgkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcikge1xuICAgICAgICAgICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLnJpZ2h0VGFibGVKdW1wVG9NZVwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLmxlZnRUYWJsZUp1bXBUb01lXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAucmlnaHRUYWJsZUp1bXBUb01lXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAubGVmdFRhYmxlSnVtcFRvTWVcIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNKSB7XG4gICAgICAgICAgICAkKFwiI2xlYWRlcmJvYXJkcyB0YWJsZSB0aGVhZCB0ciB0ZDpudGgtY2hpbGQoMylcIikuaHRtbCgnY3BtPGJyPjxkaXYgY2xhc3M9XCJzdWJcIj5hY2N1cmFjeTwvZGl2PicpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIiNsZWFkZXJib2FyZHMgdGFibGUgdGhlYWQgdHIgdGQ6bnRoLWNoaWxkKDMpXCIpLmh0bWwoJ3dwbTxicj48ZGl2IGNsYXNzPVwic3ViXCI+YWNjdXJhY3k8L2Rpdj4nKTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgICAgIHVwZGF0ZSgpO1xuICAgICAgICAgICAgc3RhcnRUaW1lcigpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcImxlYWRlcmJvYXJkc1dyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4vLyAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgLmJ1dHRvbnMgLmJ1dHRvblwiKS5vbihcImNsaWNrXCIsKGUpID0+IHtcbi8vICAgY3VycmVudExlYWRlcmJvYXJkID0gJChlLnRhcmdldCkuYXR0cihcImJvYXJkXCIpO1xuLy8gICB1cGRhdGUoKTtcbi8vIH0pO1xubGV0IGxlZnRTY3JvbGxFbmFibGVkID0gdHJ1ZTtcbiQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5sZWZ0VGFibGVXcmFwcGVyXCIpLnNjcm9sbCgoZSkgPT4ge1xuICAgIGlmICghbGVmdFNjcm9sbEVuYWJsZWQpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBlbGVtID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgIGlmIChNYXRoLnJvdW5kKGVsZW0uc2Nyb2xsVG9wKCkpIDw9IDUwKSB7XG4gICAgICAgIHJlcXVlc3RNb3JlKDE1LCB0cnVlKTtcbiAgICB9XG59KTtcbiQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5sZWZ0VGFibGVXcmFwcGVyXCIpLnNjcm9sbCgoZSkgPT4ge1xuICAgIGlmICghbGVmdFNjcm9sbEVuYWJsZWQpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBlbGVtID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgIGlmIChNYXRoLnJvdW5kKGVsZW1bMF0uc2Nyb2xsSGVpZ2h0IC0gZWxlbS5zY3JvbGxUb3AoKSkgPD1cbiAgICAgICAgTWF0aC5yb3VuZChlbGVtLm91dGVySGVpZ2h0KCkpICsgNTApIHtcbiAgICAgICAgcmVxdWVzdE1vcmUoMTUpO1xuICAgIH1cbn0pO1xubGV0IHJpZ2h0U2Nyb2xsRW5hYmxlZCA9IHRydWU7XG4kKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAucmlnaHRUYWJsZVdyYXBwZXJcIikuc2Nyb2xsKChlKSA9PiB7XG4gICAgaWYgKCFyaWdodFNjcm9sbEVuYWJsZWQpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBlbGVtID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgIGlmIChNYXRoLnJvdW5kKGVsZW0uc2Nyb2xsVG9wKCkpIDw9IDUwKSB7XG4gICAgICAgIHJlcXVlc3RNb3JlKDYwLCB0cnVlKTtcbiAgICB9XG59KTtcbiQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5yaWdodFRhYmxlV3JhcHBlclwiKS5zY3JvbGwoKGUpID0+IHtcbiAgICBjb25zdCBlbGVtID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgIGlmIChNYXRoLnJvdW5kKGVsZW1bMF0uc2Nyb2xsSGVpZ2h0IC0gZWxlbS5zY3JvbGxUb3AoKSkgPD1cbiAgICAgICAgTWF0aC5yb3VuZChlbGVtLm91dGVySGVpZ2h0KCkgKyA1MCkpIHtcbiAgICAgICAgcmVxdWVzdE1vcmUoNjApO1xuICAgIH1cbn0pO1xuJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLmxlZnRUYWJsZUp1bXBUb1RvcFwiKS5vbihcImNsaWNrXCIsICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIGxlZnRTY3JvbGxFbmFibGVkID0gZmFsc2U7XG4gICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLmxlZnRUYWJsZVdyYXBwZXJcIikuc2Nyb2xsVG9wKDApO1xuICAgIHlpZWxkIHJlcXVlc3ROZXcoMTUsIDApO1xuICAgIGxlZnRTY3JvbGxFbmFibGVkID0gdHJ1ZTtcbn0pKTtcbiQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5sZWZ0VGFibGVKdW1wVG9NZVwiKS5vbihcImNsaWNrXCIsICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIGlmIChjdXJyZW50UmFua1sxNV0ucmFuayA9PT0gdW5kZWZpbmVkKVxuICAgICAgICByZXR1cm47XG4gICAgbGVmdFNjcm9sbEVuYWJsZWQgPSBmYWxzZTtcbiAgICB5aWVsZCByZXF1ZXN0TmV3KDE1LCBjdXJyZW50UmFua1sxNV0ucmFuayAtIGxlYWRlcmJvYXJkU2luZ2xlTGltaXQgLyAyKTtcbiAgICBjb25zdCByb3dIZWlnaHQgPSAkKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAubGVmdFRhYmxlV3JhcHBlciB0YWJsZSB0Ym9keSB0ZFwiKS5vdXRlckhlaWdodCgpO1xuICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5sZWZ0VGFibGVXcmFwcGVyXCIpLmFuaW1hdGUoe1xuICAgICAgICBzY3JvbGxUb3A6IHJvd0hlaWdodCAqXG4gICAgICAgICAgICBNYXRoLm1pbihjdXJyZW50UmFua1sxNV0ucmFuaywgbGVhZGVyYm9hcmRTaW5nbGVMaW1pdCAvIDIpIC1cbiAgICAgICAgICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5sZWZ0VGFibGVXcmFwcGVyXCIpLm91dGVySGVpZ2h0KCkgL1xuICAgICAgICAgICAgICAgIDIuMjUsXG4gICAgfSwgMCwgKCkgPT4ge1xuICAgICAgICBsZWZ0U2Nyb2xsRW5hYmxlZCA9IHRydWU7XG4gICAgfSk7XG59KSk7XG4kKFwiI2xlYWRlcmJvYXJkc1dyYXBwZXIgI2xlYWRlcmJvYXJkcyAucmlnaHRUYWJsZUp1bXBUb1RvcFwiKS5vbihcImNsaWNrXCIsICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHJpZ2h0U2Nyb2xsRW5hYmxlZCA9IGZhbHNlO1xuICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5yaWdodFRhYmxlV3JhcHBlclwiKS5zY3JvbGxUb3AoMCk7XG4gICAgeWllbGQgcmVxdWVzdE5ldyg2MCwgMCk7XG4gICAgcmlnaHRTY3JvbGxFbmFibGVkID0gdHJ1ZTtcbn0pKTtcbiQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5yaWdodFRhYmxlSnVtcFRvTWVcIikub24oXCJjbGlja1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBpZiAoY3VycmVudFJhbmtbNjBdLnJhbmsgPT09IHVuZGVmaW5lZClcbiAgICAgICAgcmV0dXJuO1xuICAgIGxlZnRTY3JvbGxFbmFibGVkID0gZmFsc2U7XG4gICAgeWllbGQgcmVxdWVzdE5ldyg2MCwgY3VycmVudFJhbmtbNjBdLnJhbmsgLSBsZWFkZXJib2FyZFNpbmdsZUxpbWl0IC8gMik7XG4gICAgY29uc3Qgcm93SGVpZ2h0ID0gJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLnJpZ2h0VGFibGVXcmFwcGVyIHRhYmxlIHRib2R5IHRkXCIpLm91dGVySGVpZ2h0KCk7XG4gICAgJChcIiNsZWFkZXJib2FyZHNXcmFwcGVyICNsZWFkZXJib2FyZHMgLnJpZ2h0VGFibGVXcmFwcGVyXCIpLmFuaW1hdGUoe1xuICAgICAgICBzY3JvbGxUb3A6IHJvd0hlaWdodCAqXG4gICAgICAgICAgICBNYXRoLm1pbihjdXJyZW50UmFua1s2MF0ucmFuaywgbGVhZGVyYm9hcmRTaW5nbGVMaW1pdCAvIDIpIC1cbiAgICAgICAgICAgICQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlciAjbGVhZGVyYm9hcmRzIC5yaWdodFRhYmxlV3JhcHBlclwiKS5vdXRlckhlaWdodCgpIC9cbiAgICAgICAgICAgICAgICAyLjI1LFxuICAgIH0sIDAsICgpID0+IHtcbiAgICAgICAgbGVmdFNjcm9sbEVuYWJsZWQgPSB0cnVlO1xuICAgIH0pO1xufSkpO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0b3AgI21lbnUgLmljb24tYnV0dG9uXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS5jdXJyZW50VGFyZ2V0KS5oYXNDbGFzcyhcImxlYWRlcmJvYXJkc1wiKSkge1xuICAgICAgICBzaG93KCk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJrZXlkb3duXCIsIChldmVudCkgPT4ge1xuICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIgJiYgISQoXCIjbGVhZGVyYm9hcmRzV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICBoaWRlKCk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGlkZSA9IGV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgJChcIiNiYWNrZ3JvdW5kTG9hZGVyXCIpLnN0b3AodHJ1ZSwgdHJ1ZSkuZmFkZUluKDEyNSk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAkKFwiI2JhY2tncm91bmRMb2FkZXJcIikuc3RvcCh0cnVlLCB0cnVlKS5mYWRlT3V0KDEyNSk7XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51cGRhdGUgPSB2b2lkIDA7XG5jb25zdCBQYWNlQ2FyZXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvcGFjZS1jYXJldFwiKSk7XG5jb25zdCBUZXN0U3RhdGUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC1zdGF0ZVwiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgTGFzdDEwQXZlcmFnZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbGFzdC0xMC1hdmVyYWdlXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgVGVzdFdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3Qtd29yZHNcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSkgPT4ge1xuICAgIGlmIChbXG4gICAgICAgIFwiZGlmZmljdWx0eVwiLFxuICAgICAgICBcImJsaW5kTW9kZVwiLFxuICAgICAgICBcInN0b3BPbkVycm9yXCIsXG4gICAgICAgIFwicGFjZUNhcmV0XCIsXG4gICAgICAgIFwibWluV3BtXCIsXG4gICAgICAgIFwibWluQWNjXCIsXG4gICAgICAgIFwibWluQnVyc3RcIixcbiAgICAgICAgXCJjb25maWRlbmNlTW9kZVwiLFxuICAgICAgICBcImxheW91dFwiLFxuICAgICAgICBcInNob3dBdmVyYWdlXCIsXG4gICAgICAgIFwiYWx3YXlzU2hvd0NQTVwiLFxuICAgIF0uaW5jbHVkZXMoZXZlbnRLZXkpKSB7XG4gICAgICAgIHVwZGF0ZSgpO1xuICAgIH1cbn0pO1xuZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBsZXQgYW5pbSA9IGZhbHNlO1xuICAgICAgICBpZiAoJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLnRleHQoKSA9PT0gXCJcIilcbiAgICAgICAgICAgIGFuaW0gPSB0cnVlO1xuICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuZW1wdHkoKTtcbiAgICAgICAgaWYgKFRlc3RTdGF0ZS5pc1JlcGVhdGVkICYmIGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJxdW90ZVwiKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b24gcmVzdGFydFwiIHN0eWxlPVwiY29sb3I6dmFyKC0tZXJyb3ItY29sb3IpO1wiPjxpIGNsYXNzPVwiZmFzIGZhLXN5bmMtYWx0XCI+PC9pPnJlcGVhdGVkPC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFRlc3RXb3Jkcy5oYXNUYWIpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiPjxpIGNsYXNzPVwiZmFzIGZhLWxvbmctYXJyb3ctYWx0LXJpZ2h0XCI+PC9pPnNoaWZ0ICsgdGFiIHRvIHJlc3RhcnQ8L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoVGVzdFN0YXRlLmFjdGl2ZUNoYWxsZW5nZSkge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCIgY29tbWFuZHM9XCJjb21tYW5kc0NoYWxsZW5nZXNcIj48aSBjbGFzcz1cImZhcyBmYS1hd2FyZFwiPjwvaT4ke1Rlc3RTdGF0ZS5hY3RpdmVDaGFsbGVuZ2UuZGlzcGxheX08L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInplblwiKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIj48aSBjbGFzcz1cImZhcyBmYS1wb2xsXCI+PC9pPnNoaWZ0ICsgZW50ZXIgdG8gZmluaXNoIHplbiA8L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIiBjb21tYW5kcz1cImNvbW1hbmRzTGFuZ3VhZ2VzXCI+PGkgY2xhc3M9XCJmYXMgZmEtZ2xvYmUtYW1lcmljYXNcIj48L2k+JHtjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlLnJlcGxhY2UoL18vZywgXCIgXCIpfTwvZGl2PmApO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ID09PSBcImV4cGVydFwiKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIiBjb21tYW5kcz1cImNvbW1hbmRzRGlmZmljdWx0eVwiPjxpIGNsYXNzPVwiZmFzIGZhLXN0YXItaGFsZi1hbHRcIj48L2k+ZXhwZXJ0PC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ID09PSBcIm1hc3RlclwiKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIiBjb21tYW5kcz1cImNvbW1hbmRzRGlmZmljdWx0eVwiPjxpIGNsYXNzPVwiZmFzIGZhLXN0YXJcIj48L2k+bWFzdGVyPC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b24gYmxpbmRcIj48aSBjbGFzcz1cImZhcyBmYS1leWUtc2xhc2hcIj48L2k+YmxpbmQ8L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5sYXp5TW9kZSkge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCIgY29tbWFuZHM9XCJjb21tYW5kc0xhenlNb2RlXCI+PGkgY2xhc3M9XCJmYXMgZmEtY291Y2hcIj48L2k+bGF6eTwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnBhY2VDYXJldCAhPT0gXCJvZmZcIiB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQucmVwZWF0ZWRQYWNlICYmIFRlc3RTdGF0ZS5pc1BhY2VSZXBlYXQpKSB7XG4gICAgICAgICAgICBsZXQgc3BlZWQgPSBcIlwiO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBzcGVlZCA9IGAgKCR7TWF0aC5yb3VuZChQYWNlQ2FyZXQuc2V0dGluZ3Mud3BtKX0gd3BtKWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoX2IpIHsgfVxuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCIgY29tbWFuZHM9XCJjb21tYW5kc1BhY2VDYXJldFwiPjxpIGNsYXNzPVwiZmFzIGZhLXRhY2hvbWV0ZXItYWx0XCI+PC9pPiR7Y29uZmlnXzEuZGVmYXVsdC5wYWNlQ2FyZXQgPT09IFwiYXZlcmFnZVwiXG4gICAgICAgICAgICAgICAgPyBcImF2ZXJhZ2VcIlxuICAgICAgICAgICAgICAgIDogY29uZmlnXzEuZGVmYXVsdC5wYWNlQ2FyZXQgPT09IFwicGJcIlxuICAgICAgICAgICAgICAgICAgICA/IFwicGJcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiY3VzdG9tXCJ9IHBhY2Uke3NwZWVkfTwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnNob3dBdmVyYWdlICE9PSBcIm9mZlwiKSB7XG4gICAgICAgICAgICBsZXQgYXZnV1BNID0gTGFzdDEwQXZlcmFnZS5nZXRXUE0oKTtcbiAgICAgICAgICAgIGxldCBhdmdBY2MgPSBMYXN0MTBBdmVyYWdlLmdldEFjYygpO1xuICAgICAgICAgICAgaWYgKCFjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzKSB7XG4gICAgICAgICAgICAgICAgYXZnV1BNID0gTWF0aC5yb3VuZChhdmdXUE0pO1xuICAgICAgICAgICAgICAgIGF2Z0FjYyA9IE1hdGgucm91bmQoYXZnQWNjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgJiYgYXZnV1BNID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGF2Z1dQTVRleHQgPSBbXCJ3cG1cIiwgXCJib3RoXCJdLmluY2x1ZGVzKGNvbmZpZ18xLmRlZmF1bHQuc2hvd0F2ZXJhZ2UpXG4gICAgICAgICAgICAgICAgICAgID8gY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNXG4gICAgICAgICAgICAgICAgICAgICAgICA/IGAke01hdGgucm91bmQoYXZnV1BNICogNSl9IGNwbWBcbiAgICAgICAgICAgICAgICAgICAgICAgIDogYCR7YXZnV1BNfSB3cG1gXG4gICAgICAgICAgICAgICAgICAgIDogXCJcIjtcbiAgICAgICAgICAgICAgICBjb25zdCBhdmdBY2NUZXh0ID0gW1wiYWNjXCIsIFwiYm90aFwiXS5pbmNsdWRlcyhjb25maWdfMS5kZWZhdWx0LnNob3dBdmVyYWdlKVxuICAgICAgICAgICAgICAgICAgICA/IGAke2F2Z0FjY30lIGFjY2BcbiAgICAgICAgICAgICAgICAgICAgOiBcIlwiO1xuICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBgJHthdmdXUE1UZXh0fSAke2F2Z0FjY1RleHR9YC50cmltKCk7XG4gICAgICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCIgY29tbWFuZHM9XCJjb21tYW5kc1Nob3dBdmVyYWdlXCI+PGkgY2xhc3M9XCJmYXMgZmEtY2hhcnQtYmFyXCI+PC9pPmF2ZzogJHt0ZXh0fTwvZGl2PmApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1pbldwbSAhPT0gXCJvZmZcIikge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCIgY29tbWFuZHM9XCJjb21tYW5kc01pbldwbVwiPjxpIGNsYXNzPVwiZmFzIGZhLWJvbWJcIj48L2k+bWluICR7Y29uZmlnXzEuZGVmYXVsdC5taW5XcG1DdXN0b21TcGVlZH0gd3BtPC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubWluQWNjICE9PSBcIm9mZlwiKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIiBjb21tYW5kcz1cImNvbW1hbmRzTWluQWNjXCI+PGkgY2xhc3M9XCJmYXMgZmEtYm9tYlwiPjwvaT5taW4gJHtjb25maWdfMS5kZWZhdWx0Lm1pbkFjY0N1c3RvbX0lIGFjYzwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1pbkJ1cnN0ICE9PSBcIm9mZlwiKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIiBjb21tYW5kcz1cImNvbW1hbmRzTWluQnVyc3RcIj48aSBjbGFzcz1cImZhcyBmYS1ib21iXCI+PC9pPm1pbiAke2NvbmZpZ18xLmRlZmF1bHQubWluQnVyc3RDdXN0b21TcGVlZH0gYnVyc3QgJHtjb25maWdfMS5kZWZhdWx0Lm1pbkJ1cnN0ID09PSBcImZsZXhcIiA/IFwiKGZsZXgpXCIgOiBcIlwifTwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCAhPT0gXCJub25lXCIpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0ZXh0LWJ1dHRvblwiIGNvbW1hbmRzPVwiY29tbWFuZHNGdW5ib3hcIj48aSBjbGFzcz1cImZhcyBmYS1nYW1lcGFkXCI+PC9pPiR7Y29uZmlnXzEuZGVmYXVsdC5mdW5ib3gucmVwbGFjZSgvXy9nLCBcIiBcIil9PC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuY29uZmlkZW5jZU1vZGUgPT09IFwib25cIikge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCIgY29tbWFuZHM9XCJjb21tYW5kc0NvbmZpZGVuY2VNb2RlXCI+PGkgY2xhc3M9XCJmYXMgZmEtYmFja3NwYWNlXCI+PC9pPmNvbmZpZGVuY2U8L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5jb25maWRlbmNlTW9kZSA9PT0gXCJtYXhcIikge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCIgY29tbWFuZHM9XCJjb21tYW5kc0NvbmZpZGVuY2VNb2RlXCI+PGkgY2xhc3M9XCJmYXMgZmEtYmFja3NwYWNlXCI+PC9pPm1heCBjb25maWRlbmNlPC9kaXY+YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc3RvcE9uRXJyb3IgIT0gXCJvZmZcIikge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjdGVzdE1vZGVzTm90aWNlXCIpLmFwcGVuZChgPGRpdiBjbGFzcz1cInRleHQtYnV0dG9uXCIgY29tbWFuZHM9XCJjb21tYW5kc1N0b3BPbkVycm9yXCI+PGkgY2xhc3M9XCJmYXMgZmEtaGFuZC1wYXBlclwiPjwvaT5zdG9wIG9uICR7Y29uZmlnXzEuZGVmYXVsdC5zdG9wT25FcnJvcn08L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5sYXlvdXQgIT09IFwiZGVmYXVsdFwiKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIiBjb21tYW5kcz1cImNvbW1hbmRzTGF5b3V0c1wiPjxpIGNsYXNzPVwiZmFzIGZhLWtleWJvYXJkXCI+PC9pPmVtdWxhdGluZyAke2NvbmZpZ18xLmRlZmF1bHQubGF5b3V0LnJlcGxhY2UoL18vZywgXCIgXCIpfTwvZGl2PmApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm9wcG9zaXRlU2hpZnRNb2RlICE9PSBcIm9mZlwiKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIiBjb21tYW5kcz1cImNvbW1hbmRzT3Bwb3NpdGVTaGlmdE1vZGVcIj48aSBjbGFzcz1cImZhcyBmYS1leGNoYW5nZS1hbHRcIj48L2k+b3Bwb3NpdGUgc2hpZnQke2NvbmZpZ18xLmRlZmF1bHQub3Bwb3NpdGVTaGlmdE1vZGUgPT09IFwia2V5bWFwXCIgPyBcIiAoa2V5bWFwKVwiIDogXCJcIn08L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdGFnc1N0cmluZyA9IFwiXCI7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGFnLmFjdGl2ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0YWdzU3RyaW5nICs9IHRhZy5uYW1lICsgXCIsIFwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKHRhZ3NTdHJpbmcgIT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwidGV4dC1idXR0b25cIiBjb21tYW5kcz1cImNvbW1hbmRzVGFnc1wiPjxpIGNsYXNzPVwiZmFzIGZhLXRhZ1wiPjwvaT4ke3RhZ3NTdHJpbmcuc3Vic3RyaW5nKDAsIHRhZ3NTdHJpbmcubGVuZ3RoIC0gMil9PC9kaXY+YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKF9jKSB7IH1cbiAgICAgICAgaWYgKGFuaW0pIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Rlc3RNb2Rlc05vdGljZVwiKVxuICAgICAgICAgICAgICAgIC5jc3MoXCJ0cmFuc2l0aW9uXCIsIFwibm9uZVwiKVxuICAgICAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICN0ZXN0TW9kZXNOb3RpY2VcIikuY3NzKFwidHJhbnNpdGlvblwiLCBcIi4xMjVzXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMudXBkYXRlID0gdXBkYXRlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5hZGRQb3dlciA9IGV4cG9ydHMucmVzZXQgPSBleHBvcnRzLmluaXQgPSB2b2lkIDA7XG5jb25zdCBUaGVtZUNvbG9ycyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90aGVtZS1jb2xvcnNcIikpO1xuY29uc3QgU2xvd1RpbWVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvc2xvdy10aW1lclwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbi8qKlxuICogQHR5cGVkZWYge3sgeDogbnVtYmVyLCB5OiBudW1iZXIgfX0gdmVjMlxuICogQHR5cGVkZWYge3ZlYzIgJiB7IHByZXY6IHZlYzIsIHZlbDogdmVjMiwgYWxwaGE6IG51bWJlciwgY29sb3I6IHN0cmluZyB9fSBQYXJ0aWNsZVxuICogQHR5cGVkZWYge3sgcGFydGljbGVzOiBQYXJ0aWNsZVtdLCBjYXJldDogYW55LCBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50LCBjb250ZXh0MmQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgcmVuZGVyaW5nOiBib29sZWFuLCBsYXN0RnJhbWU6IG51bWJlciwgZGVsdGFUaW1lOiBudW1iZXIsIHJlc2V0VGltZU91dDogbnVtYmVyIH19IENUWFxuICovXG4vKipcbiAqIEB0eXBlIHtDVFh9IGN0eFxuICovXG5jb25zdCBjdHggPSB7XG4gICAgcGFydGljbGVzOiBbXSxcbiAgICByZW5kZXJpbmc6IGZhbHNlLFxufTtcbmNvbnN0IGdyYXZpdHkgPSAxMDAwO1xuY29uc3QgZHJhZyA9IDAuMDU7XG5jb25zdCBwYXJ0aWNsZVNpemUgPSA0O1xuY29uc3QgcGFydGljbGVGYWRlID0gMC42O1xuY29uc3QgcGFydGljbGVJbml0VmVsID0gMTUwMDtcbmNvbnN0IHBhcnRpY2xlQm91bmNlTW9kID0gMC4zO1xuY29uc3QgcGFydGljbGVDcmVhdGVDb3VudCA9IFs2LCAzXTtcbmNvbnN0IHNoYWtlQW1vdW50ID0gMTA7XG5mdW5jdGlvbiBjcmVhdGVDYW52YXMoKSB7XG4gICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICBjYW52YXMuc3R5bGUuY3NzVGV4dCA9XG4gICAgICAgIFwicG9zaXRpb246Zml4ZWQ7dG9wOjA7bGVmdDowO3BvaW50ZXItZXZlbnRzOm5vbmU7ei1pbmRleDo5OTk5OTlcIjtcbiAgICBjYW52YXMuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuICAgIGNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicmVzaXplXCIsICgpID0+IHtcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICAgICAgY2FudmFzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgfSk7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjYW52YXMpO1xuICAgIHJldHVybiBjYW52YXM7XG59XG4vKipcbiAqIEBwYXJhbSB7bnVtYmVyfSB4XG4gKiBAcGFyYW0ge251bWJlcn0geVxuICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yXG4gKiBAcmV0dXJucyB7UGFydGljbGV9XG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZVBhcnRpY2xlKHgsIHksIGNvbG9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgeCxcbiAgICAgICAgeSxcbiAgICAgICAgY29sb3IsXG4gICAgICAgIGFscGhhOiAxLFxuICAgICAgICBwcmV2OiB7IHgsIHkgfSxcbiAgICAgICAgdmVsOiB7XG4gICAgICAgICAgICB4OiBwYXJ0aWNsZUluaXRWZWwgLSBNYXRoLnJhbmRvbSgpICogcGFydGljbGVJbml0VmVsICogMixcbiAgICAgICAgICAgIHk6IHBhcnRpY2xlSW5pdFZlbCAtIE1hdGgucmFuZG9tKCkgKiBwYXJ0aWNsZUluaXRWZWwgKiAyLFxuICAgICAgICB9LFxuICAgIH07XG59XG4vKipcbiAqIEBwYXJhbSB7UGFydGljbGV9IHBhcnRpY2xlXG4gKi9cbmZ1bmN0aW9uIHVwZGF0ZVBhcnRpY2xlKHBhcnRpY2xlKSB7XG4gICAgaWYgKCFjdHguY2FudmFzIHx8ICFjdHguZGVsdGFUaW1lKVxuICAgICAgICByZXR1cm47XG4gICAgcGFydGljbGUucHJldi54ID0gcGFydGljbGUueDtcbiAgICBwYXJ0aWNsZS5wcmV2LnkgPSBwYXJ0aWNsZS55O1xuICAgIC8vIFVwZGF0ZSBwb3NcbiAgICBwYXJ0aWNsZS54ICs9IHBhcnRpY2xlLnZlbC54ICogY3R4LmRlbHRhVGltZTtcbiAgICBwYXJ0aWNsZS55ICs9IHBhcnRpY2xlLnZlbC55ICogY3R4LmRlbHRhVGltZTtcbiAgICBpZiAocGFydGljbGUueCA+IGN0eC5jYW52YXMud2lkdGgpIHtcbiAgICAgICAgcGFydGljbGUudmVsLnggKj0gLXBhcnRpY2xlQm91bmNlTW9kO1xuICAgICAgICBwYXJ0aWNsZS54ID1cbiAgICAgICAgICAgIGN0eC5jYW52YXMud2lkdGggLSAocGFydGljbGUueCAtIGN0eC5jYW52YXMud2lkdGgpICogcGFydGljbGVCb3VuY2VNb2Q7XG4gICAgfVxuICAgIGVsc2UgaWYgKHBhcnRpY2xlLnggPCAwKSB7XG4gICAgICAgIHBhcnRpY2xlLnZlbC54ICo9IC1wYXJ0aWNsZUJvdW5jZU1vZDtcbiAgICAgICAgcGFydGljbGUueCAqPSAtcGFydGljbGVCb3VuY2VNb2Q7XG4gICAgfVxuICAgIGlmIChwYXJ0aWNsZS55ID4gY3R4LmNhbnZhcy5oZWlnaHQpIHtcbiAgICAgICAgcGFydGljbGUudmVsLnkgKj0gLXBhcnRpY2xlQm91bmNlTW9kO1xuICAgICAgICBwYXJ0aWNsZS55ID1cbiAgICAgICAgICAgIGN0eC5jYW52YXMuaGVpZ2h0IC0gKHBhcnRpY2xlLnkgLSBjdHguY2FudmFzLmhlaWdodCkgKiBwYXJ0aWNsZUJvdW5jZU1vZDtcbiAgICB9XG4gICAgZWxzZSBpZiAocGFydGljbGUueSA8IDApIHtcbiAgICAgICAgcGFydGljbGUudmVsLnkgKj0gLTE7XG4gICAgICAgIHBhcnRpY2xlLnkgKj0gLTE7XG4gICAgfVxuICAgIHBhcnRpY2xlLnZlbC55ICs9IGdyYXZpdHkgKiBjdHguZGVsdGFUaW1lO1xuICAgIHBhcnRpY2xlLnZlbC54ICo9IDEgLSBkcmFnICogY3R4LmRlbHRhVGltZTtcbiAgICBwYXJ0aWNsZS5hbHBoYSAqPSAxIC0gcGFydGljbGVGYWRlICogY3R4LmRlbHRhVGltZTtcbn1cbmZ1bmN0aW9uIGluaXQoKSB7XG4gICAgY3R4LmNhcmV0ID0gJChcIiNjYXJldFwiKTtcbiAgICBjdHguY2FudmFzID0gY3JlYXRlQ2FudmFzKCk7XG4gICAgY3R4LmNvbnRleHQyZCA9IGN0eC5jYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xufVxuZXhwb3J0cy5pbml0ID0gaW5pdDtcbmZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICBpZiAoIWN0eC5sYXN0RnJhbWUgfHwgIWN0eC5jb250ZXh0MmQgfHwgIWN0eC5jYW52YXMpXG4gICAgICAgIHJldHVybjtcbiAgICBjdHgucmVuZGVyaW5nID0gdHJ1ZTtcbiAgICBjb25zdCB0aW1lID0gRGF0ZS5ub3coKTtcbiAgICBjdHguZGVsdGFUaW1lID0gKHRpbWUgLSBjdHgubGFzdEZyYW1lKSAvIDEwMDA7XG4gICAgY3R4Lmxhc3RGcmFtZSA9IHRpbWU7XG4gICAgY3R4LmNvbnRleHQyZC5jbGVhclJlY3QoMCwgMCwgY3R4LmNhbnZhcy53aWR0aCwgY3R4LmNhbnZhcy5oZWlnaHQpO1xuICAgIGNvbnN0IGtlZXAgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGN0eC5wYXJ0aWNsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgcGFydGljbGUgPSBjdHgucGFydGljbGVzW2ldO1xuICAgICAgICBpZiAocGFydGljbGUuYWxwaGEgPCAwLjEpXG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgdXBkYXRlUGFydGljbGUocGFydGljbGUpO1xuICAgICAgICBjdHguY29udGV4dDJkLmdsb2JhbEFscGhhID0gcGFydGljbGUuYWxwaGE7XG4gICAgICAgIGN0eC5jb250ZXh0MmQuc3Ryb2tlU3R5bGUgPSBwYXJ0aWNsZS5jb2xvcjtcbiAgICAgICAgY3R4LmNvbnRleHQyZC5saW5lV2lkdGggPSBwYXJ0aWNsZVNpemU7XG4gICAgICAgIGN0eC5jb250ZXh0MmQuYmVnaW5QYXRoKCk7XG4gICAgICAgIGN0eC5jb250ZXh0MmQubW92ZVRvKE1hdGgucm91bmQocGFydGljbGUucHJldi54KSwgTWF0aC5yb3VuZChwYXJ0aWNsZS5wcmV2LnkpKTtcbiAgICAgICAgY3R4LmNvbnRleHQyZC5saW5lVG8oTWF0aC5yb3VuZChwYXJ0aWNsZS54KSwgTWF0aC5yb3VuZChwYXJ0aWNsZS55KSk7XG4gICAgICAgIGN0eC5jb250ZXh0MmQuc3Ryb2tlKCk7XG4gICAgICAgIGtlZXAucHVzaChwYXJ0aWNsZSk7XG4gICAgfVxuICAgIGN0eC5wYXJ0aWNsZXMgPSBrZWVwO1xuICAgIGlmIChjdHgucGFydGljbGVzLmxlbmd0aCAmJiAhU2xvd1RpbWVyLmdldCgpKSB7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShyZW5kZXIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY3R4LmNvbnRleHQyZC5jbGVhclJlY3QoMCwgMCwgY3R4LmNhbnZhcy53aWR0aCwgY3R4LmNhbnZhcy5oZWlnaHQpO1xuICAgICAgICBjdHgucmVuZGVyaW5nID0gZmFsc2U7XG4gICAgfVxufVxuZnVuY3Rpb24gcmVzZXQoaW1tZWRpYXRlID0gZmFsc2UpIHtcbiAgICBpZiAoIWN0eC5yZXNldFRpbWVPdXQpXG4gICAgICAgIHJldHVybjtcbiAgICBkZWxldGUgY3R4LnJlc2V0VGltZU91dDtcbiAgICBjbGVhclRpbWVvdXQoY3R4LnJlc2V0VGltZU91dCk7XG4gICAgY29uc3QgYm9keSA9ICQoZG9jdW1lbnQuYm9keSk7XG4gICAgYm9keS5jc3MoXCJ0cmFuc2l0aW9uXCIsIFwiYWxsIC4yNXMsIHRyYW5zZm9ybSAwLjhzXCIpO1xuICAgIGJvZHkuY3NzKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoMCwwKWApO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBib2R5LmNzcyhcInRyYW5zaXRpb25cIiwgXCJhbGwgLjI1cywgdHJhbnNmb3JtIC4wNXNcIik7XG4gICAgICAgICQoXCJodG1sXCIpLmNzcyhcIm92ZXJmbG93XCIsIFwiaW5oZXJpdFwiKTtcbiAgICAgICAgJChcImh0bWxcIikuY3NzKFwib3ZlcmZsb3cteVwiLCBcInNjcm9sbFwiKTtcbiAgICB9LCBpbW1lZGlhdGUgPyAwIDogMTAwMCk7XG59XG5leHBvcnRzLnJlc2V0ID0gcmVzZXQ7XG5mdW5jdGlvbiBzdGFydFJlbmRlcigpIHtcbiAgICBpZiAoIWN0eC5yZW5kZXJpbmcpIHtcbiAgICAgICAgY3R4Lmxhc3RGcmFtZSA9IERhdGUubm93KCk7XG4gICAgICAgIHJlbmRlcigpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHJhbmRvbUNvbG9yKCkge1xuICAgIGNvbnN0IHIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyNTYpLnRvU3RyaW5nKDE2KTtcbiAgICBjb25zdCBnID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjU2KS50b1N0cmluZygxNik7XG4gICAgY29uc3QgYiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI1NikudG9TdHJpbmcoMTYpO1xuICAgIHJldHVybiBgIyR7cn0ke2d9JHtifWA7XG59XG4vKipcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gZ29vZCBHb29kIHBvd2VyIG9yIG5vdD9cbiAqL1xuZnVuY3Rpb24gYWRkUG93ZXIoZ29vZCA9IHRydWUsIGV4dHJhID0gZmFsc2UpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lO1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vbmtleVBvd2VyTGV2ZWwgPT09IFwib2ZmXCIgfHwgU2xvd1RpbWVyLmdldCgpKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAvLyBTaGFrZVxuICAgICAgICBpZiAoW1wiM1wiLCBcIjRcIl0uaW5jbHVkZXMoY29uZmlnXzEuZGVmYXVsdC5tb25rZXlQb3dlckxldmVsKSkge1xuICAgICAgICAgICAgJChcImh0bWxcIikuY3NzKFwib3ZlcmZsb3dcIiwgXCJoaWRkZW5cIik7XG4gICAgICAgICAgICBjb25zdCBzaGFrZSA9IFtcbiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKHNoYWtlQW1vdW50IC0gTWF0aC5yYW5kb20oKSAqIHNoYWtlQW1vdW50KSxcbiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKHNoYWtlQW1vdW50IC0gTWF0aC5yYW5kb20oKSAqIHNoYWtlQW1vdW50KSxcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICAkKGRvY3VtZW50LmJvZHkpLmNzcyhcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7c2hha2VbMF19cHgsICR7c2hha2VbMV19cHgpYCk7XG4gICAgICAgICAgICBpZiAoY3R4LnJlc2V0VGltZU91dClcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoY3R4LnJlc2V0VGltZU91dCk7XG4gICAgICAgICAgICBjdHgucmVzZXRUaW1lT3V0ID0gc2V0VGltZW91dChyZXNldCwgMjAwMCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gU3BhcmtzXG4gICAgICAgIGNvbnN0IG9mZnNldCA9IChfYSA9IGN0eC5jYXJldCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm9mZnNldCgpO1xuICAgICAgICBjb25zdCBjb29yZHMgPSBbXG4gICAgICAgICAgICAoX2IgPSBvZmZzZXQgPT09IG51bGwgfHwgb2Zmc2V0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvZmZzZXQubGVmdCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogMCxcbiAgICAgICAgICAgICgoX2MgPSBvZmZzZXQgPT09IG51bGwgfHwgb2Zmc2V0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvZmZzZXQudG9wKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiAwKSArICgoX2UgPSAoX2QgPSBjdHguY2FyZXQpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5oZWlnaHQoKSkgIT09IG51bGwgJiYgX2UgIT09IHZvaWQgMCA/IF9lIDogMCksXG4gICAgICAgIF07XG4gICAgICAgIGZvciAobGV0IGkgPSBNYXRoLnJvdW5kKChwYXJ0aWNsZUNyZWF0ZUNvdW50WzBdICsgTWF0aC5yYW5kb20oKSAqIHBhcnRpY2xlQ3JlYXRlQ291bnRbMV0pICpcbiAgICAgICAgICAgIChleHRyYSA/IDIgOiAxKSk7IGkgPiAwOyBpLS0pIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gW1wiMlwiLCBcIjRcIl0uaW5jbHVkZXMoY29uZmlnXzEuZGVmYXVsdC5tb25rZXlQb3dlckxldmVsKVxuICAgICAgICAgICAgICAgID8gcmFuZG9tQ29sb3IoKVxuICAgICAgICAgICAgICAgIDogZ29vZFxuICAgICAgICAgICAgICAgICAgICA/IHlpZWxkIFRoZW1lQ29sb3JzLmdldChcImNhcmV0XCIpXG4gICAgICAgICAgICAgICAgICAgIDogeWllbGQgVGhlbWVDb2xvcnMuZ2V0KFwiZXJyb3JcIik7XG4gICAgICAgICAgICBjdHgucGFydGljbGVzLnB1c2goY3JlYXRlUGFydGljbGUoLi4uY29vcmRzLCBjb2xvcikpO1xuICAgICAgICB9XG4gICAgICAgIHN0YXJ0UmVuZGVyKCk7XG4gICAgfSk7XG59XG5leHBvcnRzLmFkZFBvd2VyID0gYWRkUG93ZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5hZGRCYW5uZXIgPSBleHBvcnRzLmFkZCA9IHZvaWQgMDtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xubGV0IGlkID0gMDtcbmNsYXNzIE5vdGlmaWNhdGlvbiB7XG4gICAgY29uc3RydWN0b3IodHlwZSwgbWVzc2FnZSwgbGV2ZWwsIGR1cmF0aW9uLCBjdXN0b21UaXRsZSwgY3VzdG9tSWNvbiwgY2xvc2VDYWxsYmFjayA9ICgpID0+IHtcbiAgICAgICAgLy9cbiAgICB9KSB7XG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2U7XG4gICAgICAgIHRoaXMubGV2ZWwgPSBsZXZlbDtcbiAgICAgICAgaWYgKHR5cGUgPT09IFwiYmFubmVyXCIpIHtcbiAgICAgICAgICAgIHRoaXMuZHVyYXRpb24gPSBkdXJhdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChkdXJhdGlvbiA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAobGV2ZWwgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHVyYXRpb24gPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kdXJhdGlvbiA9IDMwMDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kdXJhdGlvbiA9IGR1cmF0aW9uICogMTAwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmN1c3RvbVRpdGxlID0gY3VzdG9tVGl0bGU7XG4gICAgICAgIHRoaXMuY3VzdG9tSWNvbiA9IGN1c3RvbUljb247XG4gICAgICAgIHRoaXMuaWQgPSBpZCsrO1xuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBjbG9zZUNhbGxiYWNrO1xuICAgIH1cbiAgICAvL2xldmVsXG4gICAgLy8wIC0gbm90aWNlXG4gICAgLy8xIC0gZ29vZFxuICAgIC8vLTEgLSBiYWRcbiAgICBzaG93KCkge1xuICAgICAgICBsZXQgY2xzID0gXCJub3RpY2VcIjtcbiAgICAgICAgbGV0IGljb24gPSBgPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtZXhjbGFtYXRpb25cIj48L2k+YDtcbiAgICAgICAgbGV0IHRpdGxlID0gXCJOb3RpY2VcIjtcbiAgICAgICAgaWYgKHRoaXMubGV2ZWwgPT09IDEpIHtcbiAgICAgICAgICAgIGNscyA9IFwiZ29vZFwiO1xuICAgICAgICAgICAgaWNvbiA9IGA8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1jaGVja1wiPjwvaT5gO1xuICAgICAgICAgICAgdGl0bGUgPSBcIlN1Y2Nlc3NcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLmxldmVsID09PSAtMSkge1xuICAgICAgICAgICAgY2xzID0gXCJiYWRcIjtcbiAgICAgICAgICAgIGljb24gPSBgPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtdGltZXNcIj48L2k+YDtcbiAgICAgICAgICAgIHRpdGxlID0gXCJFcnJvclwiO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcih0aGlzLm1lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmN1c3RvbVRpdGxlICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGl0bGUgPSB0aGlzLmN1c3RvbVRpdGxlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnR5cGUgPT09IFwiYmFubmVyXCIpIHtcbiAgICAgICAgICAgIGljb24gPSBgPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtYnVsbGhvcm5cIj48L2k+YDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jdXN0b21JY29uICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWNvbiA9IGA8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS0ke3RoaXMuY3VzdG9tSWNvbn1cIj48L2k+YDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50eXBlID09PSBcIm5vdGlmaWNhdGlvblwiKSB7XG4gICAgICAgICAgICAvLyBtb3ZlQ3VycmVudFRvSGlzdG9yeSgpO1xuICAgICAgICAgICAgY29uc3Qgb2xkSGVpZ2h0ID0gJChcIiNub3RpZmljYXRpb25DZW50ZXIgLmhpc3RvcnlcIikuaGVpZ2h0KCk7XG4gICAgICAgICAgICAkKFwiI25vdGlmaWNhdGlvbkNlbnRlciAuaGlzdG9yeVwiKS5wcmVwZW5kKGBcbiAgICAgICAgICBcbiAgICAgICAgICA8ZGl2IGNsYXNzPVwibm90aWYgJHtjbHN9XCIgaWQ9JHt0aGlzLmlkfT5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImljb25cIj4ke2ljb259PC9kaXY+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtZXNzYWdlXCI+PGRpdiBjbGFzcz1cInRpdGxlXCI+JHt0aXRsZX08L2Rpdj4ke3RoaXMubWVzc2FnZX08L2Rpdj5cbiAgICAgICAgICA8L2Rpdj4gICAgIFxuXG4gICAgICAgICAgYCk7XG4gICAgICAgICAgICBjb25zdCBuZXdIZWlnaHQgPSAkKFwiI25vdGlmaWNhdGlvbkNlbnRlciAuaGlzdG9yeVwiKS5oZWlnaHQoKTtcbiAgICAgICAgICAgICQoYCNub3RpZmljYXRpb25DZW50ZXIgLm5vdGlmW2lkPScke3RoaXMuaWR9J11gKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICQoXCIjbm90aWZpY2F0aW9uQ2VudGVyIC5oaXN0b3J5XCIpXG4gICAgICAgICAgICAgICAgLmNzcyhcIm1hcmdpbi10b3BcIiwgMClcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgbWFyZ2luVG9wOiBuZXdIZWlnaHQgLSBvbGRIZWlnaHQsXG4gICAgICAgICAgICB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgICAgICAgICAkKFwiI25vdGlmaWNhdGlvbkNlbnRlciAuaGlzdG9yeVwiKS5jc3MoXCJtYXJnaW4tdG9wXCIsIDApO1xuICAgICAgICAgICAgICAgICQoXCIjbm90aWZpY2F0aW9uQ2VudGVyIC5oaXN0b3J5XCIpLnByZXBlbmQoYFxuICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm5vdGlmICR7Y2xzfVwiIGlkPSR7dGhpcy5pZH0+XG4gICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImljb25cIj4ke2ljb259PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1lc3NhZ2VcIj48ZGl2IGNsYXNzPVwidGl0bGVcIj4ke3RpdGxlfTwvZGl2PiR7dGhpcy5tZXNzYWdlfTwvZGl2PlxuICAgICAgICAgICAgICAgICAgPC9kaXY+ICAgICBcblxuICAgICAgICAgICAgICBgKTtcbiAgICAgICAgICAgICAgICAkKGAjbm90aWZpY2F0aW9uQ2VudGVyIC5ub3RpZltpZD0nJHt0aGlzLmlkfSddYClcbiAgICAgICAgICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgICAgIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAkKGAjbm90aWZpY2F0aW9uQ2VudGVyIC5ub3RpZltpZD0nJHt0aGlzLmlkfSddYCkuY3NzKFwib3BhY2l0eVwiLCBcIlwiKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAkKGAjbm90aWZpY2F0aW9uQ2VudGVyIC5ub3RpZltpZD0nJHt0aGlzLmlkfSddYCkub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJChgI25vdGlmaWNhdGlvbkNlbnRlciAubm90aWZbaWQ9JyR7dGhpcy5pZH0nXWApLmhvdmVyKCgpID0+IHtcbiAgICAgICAgICAgICAgICAkKGAjbm90aWZpY2F0aW9uQ2VudGVyIC5ub3RpZltpZD0nJHt0aGlzLmlkfSddYCkudG9nZ2xlQ2xhc3MoXCJob3ZlclwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMudHlwZSA9PT0gXCJiYW5uZXJcIikge1xuICAgICAgICAgICAgbGV0IGxlZnRzaWRlID0gYDxkaXYgY2xhc3M9XCJpY29uIGxlZnRpY29uXCI+JHtpY29ufTwvZGl2PmA7XG4gICAgICAgICAgICBpZiAoL15pbWFnZXNcXC8uKi8udGVzdCh0aGlzLmN1c3RvbUljb24pKSB7XG4gICAgICAgICAgICAgICAgbGVmdHNpZGUgPSBgPGRpdiBjbGFzcz1cImltYWdlXCIgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJHt0aGlzLmN1c3RvbUljb259KVwiPjwvZGl2PmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkKFwiI2Jhbm5lckNlbnRlclwiKS5wcmVwZW5kKGBcbiAgICAgICAgPGRpdiBjbGFzcz1cImJhbm5lciAke2Nsc31cIiBpZD1cIiR7dGhpcy5pZH1cIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbnRhaW5lclwiPlxuICAgICAgICAgICR7bGVmdHNpZGV9XG4gICAgICAgICAgPGRpdiBjbGFzcz1cInRleHRcIj5cbiAgICAgICAgICAgICR7dGhpcy5tZXNzYWdlfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICR7dGhpcy5kdXJhdGlvbiA+PSAwXG4gICAgICAgICAgICAgICAgPyBgXG4gICAgICAgICAgPGRpdiBjbGFzcz1cImNsb3NlQnV0dG9uXCI+XG4gICAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS10aW1lc1wiPjwvaT5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICBgXG4gICAgICAgICAgICAgICAgOiBgPGRpdiBjbGFzcz1cInJpZ2h0aWNvblwiPiR7aWNvbn08L2Rpdj5gfVxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICAgYCk7XG4gICAgICAgICAgICBjb25zdCBoZWlnaHQgPSAkKFwiI2Jhbm5lckNlbnRlclwiKS5oZWlnaHQoKTtcbiAgICAgICAgICAgICQoXCIjY2VudGVyQ29udGVudFwiKS5jc3MoXCJwYWRkaW5nLXRvcFwiLCBoZWlnaHQgKyBNaXNjLmNvbnZlcnRSZW1Ub1BpeGVscygyKSArIFwicHhcIik7XG4gICAgICAgICAgICAkKFwiI25vdGlmaWNhdGlvbkNlbnRlclwiKS5jc3MoXCJtYXJnaW4tdG9wXCIsIGhlaWdodCArIFwicHhcIik7XG4gICAgICAgICAgICBpZiAodGhpcy5kdXJhdGlvbiA+PSAwKSB7XG4gICAgICAgICAgICAgICAgJChgI2Jhbm5lckNlbnRlciAuYmFubmVyW2lkPScke3RoaXMuaWR9J10gLmNsb3NlQnV0dG9uYCkub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5kdXJhdGlvbiA+IDApIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICAgICAgfSwgdGhpcy5kdXJhdGlvbiArIDI1MCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGlkZSgpIHtcbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gXCJub3RpZmljYXRpb25cIikge1xuICAgICAgICAgICAgJChgI25vdGlmaWNhdGlvbkNlbnRlciAubm90aWZbaWQ9JyR7dGhpcy5pZH0nXWApXG4gICAgICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICQoYCNub3RpZmljYXRpb25DZW50ZXIgLm5vdGlmW2lkPScke3RoaXMuaWR9J11gKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAwLFxuICAgICAgICAgICAgICAgIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAkKGAjbm90aWZpY2F0aW9uQ2VudGVyIC5ub3RpZltpZD0nJHt0aGlzLmlkfSddYCkucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnR5cGUgPT09IFwiYmFubmVyXCIpIHtcbiAgICAgICAgICAgICQoYCNiYW5uZXJDZW50ZXIgLmJhbm5lcltpZD0nJHt0aGlzLmlkfSddYCkucmVtb3ZlKCk7XG4gICAgICAgICAgICBjb25zdCBoZWlnaHQgPSAkKFwiI2Jhbm5lckNlbnRlclwiKS5oZWlnaHQoKTtcbiAgICAgICAgICAgICQoXCIjY2VudGVyQ29udGVudFwiKS5jc3MoXCJwYWRkaW5nLXRvcFwiLCBoZWlnaHQgKyBNaXNjLmNvbnZlcnRSZW1Ub1BpeGVscygyKSArIFwicHhcIik7XG4gICAgICAgICAgICAkKFwiI25vdGlmaWNhdGlvbkNlbnRlclwiKS5jc3MoXCJtYXJnaW4tdG9wXCIsIGhlaWdodCArIFwicHhcIik7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBhZGQobWVzc2FnZSwgbGV2ZWwgPSAwLCBkdXJhdGlvbiwgY3VzdG9tVGl0bGUsIGN1c3RvbUljb24sIGNsb3NlQ2FsbGJhY2spIHtcbiAgICAvLyBub3RpZmljYXRpb25IaXN0b3J5LnB1c2goXG4gICAgbmV3IE5vdGlmaWNhdGlvbihcIm5vdGlmaWNhdGlvblwiLCBtZXNzYWdlLCBsZXZlbCwgZHVyYXRpb24sIGN1c3RvbVRpdGxlLCBjdXN0b21JY29uLCBjbG9zZUNhbGxiYWNrKS5zaG93KCk7XG4gICAgLy8gKTtcbn1cbmV4cG9ydHMuYWRkID0gYWRkO1xuZnVuY3Rpb24gYWRkQmFubmVyKG1lc3NhZ2UsIGxldmVsID0gLTEsIGN1c3RvbUljb24gPSBcImJ1bGxob3JuXCIsIHN0aWNreSA9IGZhbHNlLCBjbG9zZUNhbGxiYWNrKSB7XG4gICAgLy8gbm90aWZpY2F0aW9uSGlzdG9yeS5wdXNoKFxuICAgIG5ldyBOb3RpZmljYXRpb24oXCJiYW5uZXJcIiwgbWVzc2FnZSwgbGV2ZWwsIHN0aWNreSA/IC0xIDogMCwgdW5kZWZpbmVkLCBjdXN0b21JY29uLCBjbG9zZUNhbGxiYWNrKS5zaG93KCk7XG4gICAgLy8gKTtcbn1cbmV4cG9ydHMuYWRkQmFubmVyID0gYWRkQmFubmVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuY29uc3QgYXBlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2FwZVwiKSk7XG5jb25zdCBtaXNjXzEgPSByZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBmb3JtYXRfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiZGF0ZS1mbnMvZm9ybWF0XCIpKTtcbmZ1bmN0aW9uIGNsZWFyTWVtb3J5KCkge1xuICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImNvbmZpcm1lZFBTQXNcIiwgSlNPTi5zdHJpbmdpZnkoW10pKTtcbn1cbmZ1bmN0aW9uIGdldE1lbW9yeSgpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIHJldHVybiAoX2IgPSBKU09OLnBhcnNlKChfYSA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImNvbmZpcm1lZFBTQXNcIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiW11cIikpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IFtdO1xufVxuZnVuY3Rpb24gc2V0TWVtb3J5KGlkKSB7XG4gICAgY29uc3QgbGlzdCA9IGdldE1lbW9yeSgpO1xuICAgIGxpc3QucHVzaChpZCk7XG4gICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiY29uZmlybWVkUFNBc1wiLCBKU09OLnN0cmluZ2lmeShsaXN0KSk7XG59XG5mdW5jdGlvbiBnZXRMYXRlc3QoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnBzYXMuZ2V0KCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5tZXNzYWdlID09PSBcIlNlcnZlciBpcyBkb3duIGZvciBtYWludGVuYW5jZVwiKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZEJhbm5lcihcIlNlcnZlciBpcyBjdXJyZW50bHkgdW5kZXIgbWFpbnRlbmFuY2UuIDxhIHRhcmdldD0gJ19ibGFuaycgaHJlZj0naHR0cHM6Ly9tb25rZXl0eXBlLmluc3RhdHVzLmNvbS8nPkNsaWNrIGhlcmU8L2E+IGZvciBtb3JlIGluZm8uXCIsIC0xLCBcImJ1bGxob3JuXCIsIHRydWUpO1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gc2hvdygpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCBsYXRlc3QgPSB5aWVsZCBnZXRMYXRlc3QoKTtcbiAgICAgICAgaWYgKGxhdGVzdCA9PSBudWxsIHx8IGxhdGVzdC5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgY2xlYXJNZW1vcnkoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBsb2NhbG1lbW9yeSA9IGdldE1lbW9yeSgpO1xuICAgICAgICBsYXRlc3QuZm9yRWFjaCgocHNhKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICBpZiAobG9jYWxtZW1vcnkuaW5jbHVkZXMocHNhLl9pZCkgJiYgKChfYSA9IHBzYS5zdGlja3kpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGZhbHNlKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocHNhLmRhdGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRlT2JqID0gbmV3IERhdGUocHNhLmRhdGUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGRpZmYgPSBwc2EuZGF0ZSAtIERhdGUubm93KCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RyaW5nID0gKDAsIG1pc2NfMS5zZWNvbmRzVG9TdHJpbmcpKGRpZmYgLyAxMDAwLCBmYWxzZSwgZmFsc2UsIFwidGV4dFwiLCBmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgcHNhLm1lc3NhZ2UgPSBwc2EubWVzc2FnZS5yZXBsYWNlKFwie2RhdGVEaWZmZXJlbmNlfVwiLCBzdHJpbmcpO1xuICAgICAgICAgICAgICAgIHBzYS5tZXNzYWdlID0gcHNhLm1lc3NhZ2UucmVwbGFjZShcIntkYXRlTm9UaW1lfVwiLCAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZU9iaiwgXCJkZCBNTU0geXl5eVwiKSk7XG4gICAgICAgICAgICAgICAgcHNhLm1lc3NhZ2UgPSBwc2EubWVzc2FnZS5yZXBsYWNlKFwie2RhdGV9XCIsICgwLCBmb3JtYXRfMS5kZWZhdWx0KShkYXRlT2JqLCBcImRkIE1NTSB5eXl5IEhIOm1tXCIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkQmFubmVyKHBzYS5tZXNzYWdlLCBwc2EubGV2ZWwsIFwiYnVsbGhvcm5cIiwgcHNhLnN0aWNreSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNldE1lbW9yeShwc2EuX2lkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgQWN0aXZlUGFnZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL2FjdGl2ZS1wYWdlXCIpKTtcbmxldCB2aXNpYmxlID0gZmFsc2U7XG4kKFwiLnNjcm9sbFRvVG9wQnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHdpbmRvdy5zY3JvbGxUbyh7IHRvcDogMCwgYmVoYXZpb3I6IFwic21vb3RoXCIgfSk7XG59KTtcbiQod2luZG93KS5zY3JvbGwoKCkgPT4ge1xuICAgIGNvbnN0IHBhZ2UgPSBBY3RpdmVQYWdlLmdldCgpO1xuICAgIGlmIChwYWdlID09IFwidGVzdFwiKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKHBhZ2UgPT0gXCJhYm91dFwiIHx8IHBhZ2UgPT0gXCJzZXR0aW5nc1wiIHx8IHBhZ2UgPT0gXCJhY2NvdW50XCIpIHtcbiAgICAgICAgY29uc3Qgc2Nyb2xsID0gd2luZG93LnNjcm9sbFk7XG4gICAgICAgIGlmICghdmlzaWJsZSAmJiBzY3JvbGwgPiAxMDApIHtcbiAgICAgICAgICAgICQoXCIuc2Nyb2xsVG9Ub3BCdXR0b25cIikucmVtb3ZlQ2xhc3MoXCJpbnZpc2libGVcIik7XG4gICAgICAgICAgICB2aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh2aXNpYmxlICYmIHNjcm9sbCA8IDEwMCkge1xuICAgICAgICAgICAgJChcIi5zY3JvbGxUb1RvcEJ1dHRvblwiKS5hZGRDbGFzcyhcImludmlzaWJsZVwiKTtcbiAgICAgICAgICAgIHZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudXBkYXRlID0gZXhwb3J0cy5yZXNldCA9IGV4cG9ydHMuZ2V0QWxsID0gZXhwb3J0cy5nZXQgPSB2b2lkIDA7XG5sZXQgY29sb3JzID0ge1xuICAgIGJnOiBcIiMzMjM0MzdcIixcbiAgICBtYWluOiBcIiNlMmI3MTRcIixcbiAgICBjYXJldDogXCIjZTJiNzE0XCIsXG4gICAgc3ViOiBcIiM2NDY2NjlcIixcbiAgICB0ZXh0OiBcIiNkMWQwYzVcIixcbiAgICBlcnJvcjogXCIjY2E0NzU0XCIsXG4gICAgZXJyb3JFeHRyYTogXCIjN2UyYTMzXCIsXG4gICAgY29sb3JmdWxFcnJvcjogXCIjY2E0NzU0XCIsXG4gICAgY29sb3JmdWxFcnJvckV4dHJhOiBcIiM3ZTJhMzNcIixcbn07XG5mdW5jdGlvbiBnZXQoY29sb3IpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoIWNvbG9yc1tjb2xvcl0pXG4gICAgICAgICAgICB1cGRhdGUoKTtcbiAgICAgICAgcmV0dXJuIGNvbG9yc1tjb2xvcl07XG4gICAgfSk7XG59XG5leHBvcnRzLmdldCA9IGdldDtcbmZ1bmN0aW9uIGdldEFsbCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoIWNvbG9ycy5iZylcbiAgICAgICAgICAgIHVwZGF0ZSgpO1xuICAgICAgICByZXR1cm4gY29sb3JzO1xuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRBbGwgPSBnZXRBbGw7XG5mdW5jdGlvbiByZXNldCgpIHtcbiAgICBjb2xvcnMgPSB7XG4gICAgICAgIGJnOiBcIlwiLFxuICAgICAgICBtYWluOiBcIlwiLFxuICAgICAgICBjYXJldDogXCJcIixcbiAgICAgICAgc3ViOiBcIlwiLFxuICAgICAgICB0ZXh0OiBcIlwiLFxuICAgICAgICBlcnJvcjogXCJcIixcbiAgICAgICAgZXJyb3JFeHRyYTogXCJcIixcbiAgICAgICAgY29sb3JmdWxFcnJvcjogXCJcIixcbiAgICAgICAgY29sb3JmdWxFcnJvckV4dHJhOiBcIlwiLFxuICAgIH07XG59XG5leHBvcnRzLnJlc2V0ID0gcmVzZXQ7XG5mdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgY29uc3Qgc3QgPSBnZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LmJvZHkpO1xuICAgIGNvbG9ycy5iZyA9IHN0LmdldFByb3BlcnR5VmFsdWUoXCItLWJnLWNvbG9yXCIpLnJlcGxhY2UoXCIgXCIsIFwiXCIpO1xuICAgIGNvbG9ycy5tYWluID0gc3QuZ2V0UHJvcGVydHlWYWx1ZShcIi0tbWFpbi1jb2xvclwiKS5yZXBsYWNlKFwiIFwiLCBcIlwiKTtcbiAgICBjb2xvcnMuY2FyZXQgPSBzdC5nZXRQcm9wZXJ0eVZhbHVlKFwiLS1jYXJldC1jb2xvclwiKS5yZXBsYWNlKFwiIFwiLCBcIlwiKTtcbiAgICBjb2xvcnMuc3ViID0gc3QuZ2V0UHJvcGVydHlWYWx1ZShcIi0tc3ViLWNvbG9yXCIpLnJlcGxhY2UoXCIgXCIsIFwiXCIpO1xuICAgIGNvbG9ycy50ZXh0ID0gc3QuZ2V0UHJvcGVydHlWYWx1ZShcIi0tdGV4dC1jb2xvclwiKS5yZXBsYWNlKFwiIFwiLCBcIlwiKTtcbiAgICBjb2xvcnMuZXJyb3IgPSBzdC5nZXRQcm9wZXJ0eVZhbHVlKFwiLS1lcnJvci1jb2xvclwiKS5yZXBsYWNlKFwiIFwiLCBcIlwiKTtcbiAgICBjb2xvcnMuZXJyb3JFeHRyYSA9IHN0XG4gICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwiLS1lcnJvci1leHRyYS1jb2xvclwiKVxuICAgICAgICAucmVwbGFjZShcIiBcIiwgXCJcIik7XG4gICAgY29sb3JzLmNvbG9yZnVsRXJyb3IgPSBzdFxuICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcIi0tY29sb3JmdWwtZXJyb3ItY29sb3JcIilcbiAgICAgICAgLnJlcGxhY2UoXCIgXCIsIFwiXCIpO1xuICAgIGNvbG9ycy5jb2xvcmZ1bEVycm9yRXh0cmEgPSBzdFxuICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcIi0tY29sb3JmdWwtZXJyb3ItZXh0cmEtY29sb3JcIilcbiAgICAgICAgLnJlcGxhY2UoXCIgXCIsIFwiXCIpO1xufVxuZXhwb3J0cy51cGRhdGUgPSB1cGRhdGU7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNob3cgPSB2b2lkIDA7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL25vdGlmaWNhdGlvbnNcIikpO1xuLy8gaW1wb3J0ICogYXMgVmVyc2lvblBvcHVwIGZyb20gXCIuL3ZlcnNpb24tcG9wdXBcIjtcbmZ1bmN0aW9uIHNldE1lbW9yeSh2KSB7XG4gICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwibGFzdFNlZW5WZXJzaW9uXCIsIHYpO1xufVxuZnVuY3Rpb24gZ2V0TWVtb3J5KCkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gKF9hID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwibGFzdFNlZW5WZXJzaW9uXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIlwiO1xufVxuZnVuY3Rpb24gc2hvdyh2ZXJzaW9uKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgbWVtb3J5ID0geWllbGQgZ2V0TWVtb3J5KCk7XG4gICAgICAgIGlmIChtZW1vcnkgPT09IFwiXCIpIHtcbiAgICAgICAgICAgIHNldE1lbW9yeSh2ZXJzaW9uKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLmhvc3RuYW1lID09PSBcImxvY2FsaG9zdFwiIHx8XG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgPT09IFwiMTI3LjAuMC4xXCIpIHtcbiAgICAgICAgICAgIGNhY2hlcy5rZXlzKCkudGhlbihmdW5jdGlvbiAobmFtZXMpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgbmFtZXMpXG4gICAgICAgICAgICAgICAgICAgIGNhY2hlcy5kZWxldGUobmFtZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWVtb3J5ID09PSB2ZXJzaW9uKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjYWNoZXMua2V5cygpLnRoZW4oZnVuY3Rpb24gKG5hbWVzKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgbmFtZXMpXG4gICAgICAgICAgICAgICAgY2FjaGVzLmRlbGV0ZShuYW1lKTtcbiAgICAgICAgfSk7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkQmFubmVyKGBWZXJzaW9uICR7dmVyc2lvbn0gaGFzIGJlZW4gcmVsZWFzZWQuIENsaWNrIHRoZSB2ZXJzaW9uIG51bWJlciBpbiB0aGUgYm90dG9tIHJpZ2h0IHRvIHZpZXcgdGhlIGNoYW5nZWxvZy5gLCAxLCBcImNvZGUtYnJhbmNoXCIsIGZhbHNlKTtcbiAgICAgICAgc2V0TWVtb3J5KHZlcnNpb24pO1xuICAgIH0pO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5BbmFseXRpY3MgPSBleHBvcnRzLkF1dGggPSB2b2lkIDA7XG4vLyBJbXBvcnQgdGhlIGZ1bmN0aW9ucyB5b3UgbmVlZCBmcm9tIHRoZSBTREtzIHlvdSBuZWVkXG5jb25zdCBhcHBfMSA9IHJlcXVpcmUoXCJmaXJlYmFzZS9hcHBcIik7XG5jb25zdCBhdXRoXzEgPSByZXF1aXJlKFwiZmlyZWJhc2UvYXV0aFwiKTtcbmNvbnN0IGZpcmViYXNlX2NvbmZpZ18xID0gcmVxdWlyZShcIi4vY29uc3RhbnRzL2ZpcmViYXNlLWNvbmZpZ1wiKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLXBhdGgtZXhpc3RzL2V4aXN0c1xuY29uc3QgYW5hbHl0aWNzXzEgPSByZXF1aXJlKFwiZmlyZWJhc2UvYW5hbHl0aWNzXCIpO1xuLy8gSW5pdGlhbGl6ZSBGaXJlYmFzZVxubGV0IGFwcDtcbnRyeSB7XG4gICAgYXBwID0gKDAsIGFwcF8xLmluaXRpYWxpemVBcHApKGZpcmViYXNlX2NvbmZpZ18xLmZpcmViYXNlQ29uZmlnKTtcbiAgICBleHBvcnRzLkF1dGggPSAoMCwgYXV0aF8xLmdldEF1dGgpKGFwcCk7XG4gICAgZXhwb3J0cy5BbmFseXRpY3MgPSAoMCwgYW5hbHl0aWNzXzEuZ2V0QW5hbHl0aWNzKShhcHApO1xufVxuY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICQoXCJib2R5XCIpLnRleHQoXCJGYWlsZWQgdG8gaW5pdGlhbGl6ZSBGaXJlYmFzZS4gQXJlIHlvdSBzdXJlIHlvdSBoYXZlIHRoZSBjb3JyZWN0IGNvbmZpZyBpbiB0aGUgZmlyZWJhc2UtY29uZmlnLnRzIGZpbGU/XCIpO1xufVxuIiwiXCJ1c2Ugc3RyaWN0XCI7XG4vLyB0aGlzIGZpbGUgc2hvdWxkIGJlIGNvbmNhdGVuYXRlZCBhdCB0aGUgdG9wIG9mIHRoZSBsZWdhY3kganMgZmlsZXNcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xucmVxdWlyZShcIi4uL3N0eWxlcy9pbmRleC5zY3NzXCIpO1xucmVxdWlyZShcIi4vZmlyZWJhc2VcIik7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9kYlwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9jb25maWdcIikpO1xuY29uc3QgVGVzdFN0YXRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QvdGVzdC1zdGF0c1wiKSk7XG5jb25zdCBSZXBsYXkgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC9yZXBsYXlcIikpO1xuY29uc3QgVGVzdFRpbWVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QvdGVzdC10aW1lclwiKSk7XG5jb25zdCBSZXN1bHQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC9yZXN1bHRcIikpO1xuY29uc3QgVGVzdElucHV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QvdGVzdC1pbnB1dFwiKSk7XG5yZXF1aXJlKFwiLi9jb250cm9sbGVycy9hY2NvdW50LWNvbnRyb2xsZXJcIik7XG5jb25zdCBnbGFyc2VzX21vZGVfMSA9IHJlcXVpcmUoXCIuL3N0YXRlcy9nbGFyc2VzLW1vZGVcIik7XG5yZXF1aXJlKFwiLi90ZXN0L2NhcHMtd2FybmluZ1wiKTtcbnJlcXVpcmUoXCIuL3BvcHVwcy9zdXBwb3J0LXBvcHVwXCIpO1xucmVxdWlyZShcIi4vcG9wdXBzL2NvbnRhY3QtcG9wdXBcIik7XG5yZXF1aXJlKFwiLi9wb3B1cHMvdmVyc2lvbi1wb3B1cFwiKTtcbnJlcXVpcmUoXCIuL3BvcHVwcy9lZGl0LXByZXNldC1wb3B1cFwiKTtcbnJlcXVpcmUoXCIuL3BvcHVwcy9zaW1wbGUtcG9wdXBzXCIpO1xucmVxdWlyZShcIi4vY29udHJvbGxlcnMvaW5wdXQtY29udHJvbGxlclwiKTtcbnJlcXVpcmUoXCIuL3JlYWR5XCIpO1xucmVxdWlyZShcIi4vdWlcIik7XG5yZXF1aXJlKFwiLi9wYWdlcy9hYm91dFwiKTtcbnJlcXVpcmUoXCIuL3BvcHVwcy9wYi10YWJsZXMtcG9wdXBcIik7XG5yZXF1aXJlKFwiLi9lbGVtZW50cy9zY3JvbGwtdG8tdG9wXCIpO1xucmVxdWlyZShcIi4vcG9wdXBzL21vYmlsZS10ZXN0LWNvbmZpZy1wb3B1cFwiKTtcbnJlcXVpcmUoXCIuL3BvcHVwcy9lZGl0LXRhZ3MtcG9wdXBcIik7XG5jb25zdCBBY2NvdW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3BhZ2VzL2FjY291bnRcIikpO1xuY29uc3QgZXh0ZW5kZWRHbG9iYWwgPSBnbG9iYWw7XG5leHRlbmRlZEdsb2JhbC5zbmFwc2hvdCA9IERCLmdldFNuYXBzaG90O1xuZXh0ZW5kZWRHbG9iYWwuY29uZmlnID0gY29uZmlnXzEuZGVmYXVsdDtcbmV4dGVuZGVkR2xvYmFsLnRvZ2dsZUZpbHRlckRlYnVnID0gQWNjb3VudC50b2dnbGVGaWx0ZXJEZWJ1ZztcbmV4dGVuZGVkR2xvYmFsLmdsYXJzZXNNb2RlID0gZ2xhcnNlc19tb2RlXzEuZW5hYmxlO1xuZXh0ZW5kZWRHbG9iYWwuc3RhdHMgPSBUZXN0U3RhdHMuZ2V0U3RhdHM7XG5leHRlbmRlZEdsb2JhbC5yZXBsYXkgPSBSZXBsYXkuZ2V0UmVwbGF5RXhwb3J0O1xuZXh0ZW5kZWRHbG9iYWwuZW5hYmxlVGltZXJEZWJ1ZyA9IFRlc3RUaW1lci5lbmFibGVUaW1lckRlYnVnO1xuZXh0ZW5kZWRHbG9iYWwuZ2V0VGltZXJTdGF0cyA9IFRlc3RUaW1lci5nZXRUaW1lclN0YXRzO1xuZXh0ZW5kZWRHbG9iYWwudG9nZ2xlVW5zbW9vdGhlZFJhdyA9IFJlc3VsdC50b2dnbGVVbnNtb290aGVkUmF3O1xuZXh0ZW5kZWRHbG9iYWwuZW5hYmxlU3BhY2luZ0RlYnVnID0gVGVzdElucHV0LmVuYWJsZVNwYWNpbmdEZWJ1ZztcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5kaXNwYXRjaCA9IGV4cG9ydHMuc3Vic2NyaWJlID0gdm9pZCAwO1xuY29uc3Qgc3Vic2NyaWJlcnMgPSBbXTtcbmZ1bmN0aW9uIHN1YnNjcmliZShmbikge1xuICAgIHN1YnNjcmliZXJzLnB1c2goZm4pO1xufVxuZXhwb3J0cy5zdWJzY3JpYmUgPSBzdWJzY3JpYmU7XG5mdW5jdGlvbiBkaXNwYXRjaChrZXksIG5ld1ZhbHVlLCBub3NhdmUsIHByZXZpb3VzVmFsdWUsIGZ1bGxDb25maWcpIHtcbiAgICBzdWJzY3JpYmVycy5mb3JFYWNoKChmbikgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgZm4oa2V5LCBuZXdWYWx1ZSwgbm9zYXZlLCBwcmV2aW91c1ZhbHVlLCBmdWxsQ29uZmlnKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkNvbmZpZyBldmVudCBzdWJzY3JpYmVyIHRocmV3IGFuIGVycm9yXCIpO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5kaXNwYXRjaCA9IGRpc3BhdGNoO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmRpc3BhdGNoID0gZXhwb3J0cy5zdWJzY3JpYmUgPSB2b2lkIDA7XG5jb25zdCBzdWJzY3JpYmVycyA9IFtdO1xuZnVuY3Rpb24gc3Vic2NyaWJlKGZuKSB7XG4gICAgc3Vic2NyaWJlcnMucHVzaChmbik7XG59XG5leHBvcnRzLnN1YnNjcmliZSA9IHN1YnNjcmliZTtcbmZ1bmN0aW9uIGRpc3BhdGNoKHByZXZpb3VzUGFnZSwgbmV3UGFnZSkge1xuICAgIHN1YnNjcmliZXJzLmZvckVhY2goKGZuKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmbihwcmV2aW91c1BhZ2UsIG5ld1BhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiUGFnZSBjaGFuZ2UgZXZlbnQgc3Vic2NyaWJlciB0aHJldyBhbiBlcnJvclwiKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZGlzcGF0Y2ggPSBkaXNwYXRjaDtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5kaXNwYXRjaCA9IGV4cG9ydHMuc3Vic2NyaWJlID0gdm9pZCAwO1xuY29uc3Qgc3Vic2NyaWJlcnMgPSBbXTtcbmZ1bmN0aW9uIHN1YnNjcmliZShmbikge1xuICAgIHN1YnNjcmliZXJzLnB1c2goZm4pO1xufVxuZXhwb3J0cy5zdWJzY3JpYmUgPSBzdWJzY3JpYmU7XG5mdW5jdGlvbiBkaXNwYXRjaCgpIHtcbiAgICBzdWJzY3JpYmVycy5mb3JFYWNoKChmbikgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgZm4oKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlJlc2V0IHJlcXVlc3RlZCBldmVudCBzdWJzY3JpYmVyIHRocmV3IGFuIGVycm9yXCIpO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5kaXNwYXRjaCA9IGRpc3BhdGNoO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmRpc3BhdGNoID0gZXhwb3J0cy5zdWJzY3JpYmUgPSB2b2lkIDA7XG5jb25zdCBzdWJzY3JpYmVycyA9IFtdO1xuZnVuY3Rpb24gc3Vic2NyaWJlKGZuKSB7XG4gICAgc3Vic2NyaWJlcnMucHVzaChmbik7XG59XG5leHBvcnRzLnN1YnNjcmliZSA9IHN1YnNjcmliZTtcbmZ1bmN0aW9uIGRpc3BhdGNoKHJlc3VsdHMpIHtcbiAgICBzdWJzY3JpYmVycy5mb3JFYWNoKChmbikgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgZm4ocmVzdWx0cyk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJQYWdlIGNoYW5nZSBldmVudCBzdWJzY3JpYmVyIHRocmV3IGFuIGVycm9yXCIpO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5kaXNwYXRjaCA9IGRpc3BhdGNoO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmRpc3BhdGNoID0gZXhwb3J0cy5zdWJzY3JpYmUgPSB2b2lkIDA7XG5jb25zdCBzdWJzY3JpYmVycyA9IFtdO1xuZnVuY3Rpb24gc3Vic2NyaWJlKGZuKSB7XG4gICAgc3Vic2NyaWJlcnMucHVzaChmbik7XG59XG5leHBvcnRzLnN1YnNjcmliZSA9IHN1YnNjcmliZTtcbmZ1bmN0aW9uIGRpc3BhdGNoKGtleSwgdmFsdWUsIHZhbHVlMikge1xuICAgIHN1YnNjcmliZXJzLmZvckVhY2goKGZuKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmbihrZXksIHZhbHVlLCB2YWx1ZTIpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiVGltZXIgZXZlbnQgc3Vic2NyaWJlciB0aHJldyBhbiBlcnJvclwiKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZGlzcGF0Y2ggPSBkaXNwYXRjaDtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5kaXNwYXRjaCA9IGV4cG9ydHMuc3Vic2NyaWJlID0gdm9pZCAwO1xuY29uc3Qgc3Vic2NyaWJlcnMgPSBbXTtcbmZ1bmN0aW9uIHN1YnNjcmliZShmbikge1xuICAgIHN1YnNjcmliZXJzLnB1c2goZm4pO1xufVxuZXhwb3J0cy5zdWJzY3JpYmUgPSBzdWJzY3JpYmU7XG5mdW5jdGlvbiBkaXNwYXRjaCh3b3JkLCB0eXBlZENvcnJlY3RseSwgYnVyc3QsIGN1cnJlbnRUZXN0V29yZCkge1xuICAgIHN1YnNjcmliZXJzLmZvckVhY2goKGZuKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmbih3b3JkLCB0eXBlZENvcnJlY3RseSwgYnVyc3QsIGN1cnJlbnRUZXN0V29yZCk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJXb3JkIFR5cGVkIGV2ZW50IHN1YnNjcmliZXIgdGhyZXcgYW4gZXJyb3JcIik7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmRpc3BhdGNoID0gZGlzcGF0Y2g7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnBhZ2UgPSBleHBvcnRzLmZpbGwgPSBleHBvcnRzLnJlc2V0ID0gdm9pZCAwO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBwYWdlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vcGFnZVwiKSk7XG5mdW5jdGlvbiByZXNldCgpIHtcbiAgICAkKFwiLnBhZ2VBYm91dCAuY29udHJpYnV0b3JzXCIpLmVtcHR5KCk7XG4gICAgJChcIi5wYWdlQWJvdXQgLnN1cHBvcnRlcnNcIikuZW1wdHkoKTtcbn1cbmV4cG9ydHMucmVzZXQgPSByZXNldDtcbmZ1bmN0aW9uIGZpbGwoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3Qgc3VwcG9ydGVycyA9IHlpZWxkIE1pc2MuZ2V0U3VwcG9ydGVyc0xpc3QoKTtcbiAgICAgICAgY29uc3QgY29udHJpYnV0b3JzID0geWllbGQgTWlzYy5nZXRDb250cmlidXRvcnNMaXN0KCk7XG4gICAgICAgIHN1cHBvcnRlcnMuZm9yRWFjaCgoc3VwcG9ydGVyKSA9PiB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBYm91dCAuc3VwcG9ydGVyc1wiKS5hcHBlbmQoYFxuICAgICAgPGRpdj4ke3N1cHBvcnRlcn08L2Rpdj5cbiAgICBgKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnRyaWJ1dG9ycy5mb3JFYWNoKChjb250cmlidXRvcikgPT4ge1xuICAgICAgICAgICAgJChcIi5wYWdlQWJvdXQgLmNvbnRyaWJ1dG9yc1wiKS5hcHBlbmQoYFxuICAgICAgPGRpdj4ke2NvbnRyaWJ1dG9yfTwvZGl2PlxuICAgIGApO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZmlsbCA9IGZpbGw7XG5leHBvcnRzLnBhZ2UgPSBuZXcgcGFnZV8xLmRlZmF1bHQoXCJhYm91dFwiLCAkKFwiLnBhZ2UucGFnZUFib3V0XCIpLCBcIi9hYm91dFwiLCAoKSA9PiB7XG4gICAgLy9cbn0sICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHJlc2V0KCk7XG59KSwgKCkgPT4ge1xuICAgIGZpbGwoKTtcbn0sICgpID0+IHtcbiAgICAvL1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnBhZ2UgPSBleHBvcnRzLnVwZGF0ZSA9IGV4cG9ydHMuc21vb3RoSGlzdG9yeSA9IGV4cG9ydHMucmVzZXQgPSBleHBvcnRzLnRvZ2dsZUZpbHRlckRlYnVnID0gdm9pZCAwO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IFJlc3VsdEZpbHRlcnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2FjY291bnQvcmVzdWx0LWZpbHRlcnNcIikpO1xuY29uc3QgVGhlbWVDb2xvcnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL3RoZW1lLWNvbG9yc1wiKSk7XG5jb25zdCBDaGFydENvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL2NoYXJ0LWNvbnRyb2xsZXJcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgTWluaVJlc3VsdENoYXJ0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9hY2NvdW50L21pbmktcmVzdWx0LWNoYXJ0XCIpKTtcbmNvbnN0IEFsbFRpbWVTdGF0cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vYWNjb3VudC9hbGwtdGltZS1zdGF0c1wiKSk7XG5jb25zdCBQYlRhYmxlcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vYWNjb3VudC9wYi10YWJsZXNcIikpO1xuY29uc3QgTG9hZGluZ1BhZ2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbG9hZGluZ1wiKSk7XG5jb25zdCBGb2N1cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9mb2N1c1wiKSk7XG5jb25zdCBTaWduT3V0QnV0dG9uID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9hY2NvdW50L3NpZ24tb3V0LWJ1dHRvblwiKSk7XG5jb25zdCBUb2RheVRyYWNrZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdG9kYXktdHJhY2tlclwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IHBhZ2VfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9wYWdlXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgQWN0aXZlUGFnZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL2FjdGl2ZS1wYWdlXCIpKTtcbmNvbnN0IGZvcm1hdF8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJkYXRlLWZucy9mb3JtYXRcIikpO1xubGV0IGZpbHRlckRlYnVnID0gZmFsc2U7XG4vL3RvZ2dsZSBmaWx0ZXJkZWJ1Z1xuZnVuY3Rpb24gdG9nZ2xlRmlsdGVyRGVidWcoKSB7XG4gICAgZmlsdGVyRGVidWcgPSAhZmlsdGVyRGVidWc7XG4gICAgaWYgKGZpbHRlckRlYnVnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZmlsdGVyRGVidWcgaXMgb25cIik7XG4gICAgfVxufVxuZXhwb3J0cy50b2dnbGVGaWx0ZXJEZWJ1ZyA9IHRvZ2dsZUZpbHRlckRlYnVnO1xubGV0IGZpbHRlcmVkUmVzdWx0cyA9IFtdO1xubGV0IHZpc2libGVUYWJsZUxpbmVzID0gMDtcbmZ1bmN0aW9uIGxvYWRNb3JlTGluZXMobGluZUluZGV4KSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBpZiAoZmlsdGVyZWRSZXN1bHRzID09IFtdIHx8IGZpbHRlcmVkUmVzdWx0cy5sZW5ndGggPT0gMClcbiAgICAgICAgcmV0dXJuO1xuICAgIGxldCBuZXdWaXNpYmxlTGluZXM7XG4gICAgaWYgKGxpbmVJbmRleCAmJiBsaW5lSW5kZXggPiB2aXNpYmxlVGFibGVMaW5lcykge1xuICAgICAgICBuZXdWaXNpYmxlTGluZXMgPSBNYXRoLmNlaWwobGluZUluZGV4IC8gMTApICogMTA7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBuZXdWaXNpYmxlTGluZXMgPSB2aXNpYmxlVGFibGVMaW5lcyArIDEwO1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gdmlzaWJsZVRhYmxlTGluZXM7IGkgPCBuZXdWaXNpYmxlTGluZXM7IGkrKykge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBmaWx0ZXJlZFJlc3VsdHNbaV07XG4gICAgICAgIGlmICghcmVzdWx0KVxuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIGxldCBkaWZmID0gcmVzdWx0LmRpZmZpY3VsdHk7XG4gICAgICAgIGlmIChkaWZmID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgZGlmZiA9IFwibm9ybWFsXCI7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHJhdztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJhdyA9IGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTVxuICAgICAgICAgICAgICAgID8gKHJlc3VsdC5yYXdXcG0gKiA1KS50b0ZpeGVkKDIpXG4gICAgICAgICAgICAgICAgOiByZXN1bHQucmF3V3BtLnRvRml4ZWQoMik7XG4gICAgICAgICAgICBpZiAocmF3ID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJhdyA9IFwiLVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByYXcgPSBcIi1cIjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgaWNvbnMgPSBgPHNwYW4gYXJpYS1sYWJlbD1cIiR7KF9hID0gcmVzdWx0Lmxhbmd1YWdlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVwbGFjZShcIl9cIiwgXCIgXCIpfVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLWdsb2JlLWFtZXJpY2FzXCI+PC9pPjwvc3Bhbj5gO1xuICAgICAgICBpZiAoZGlmZiA9PT0gXCJub3JtYWxcIikge1xuICAgICAgICAgICAgaWNvbnMgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCIke3Jlc3VsdC5kaWZmaWN1bHR5fVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFyIGZhLWZ3IGZhLXN0YXJcIj48L2k+PC9zcGFuPmA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZGlmZiA9PT0gXCJleHBlcnRcIikge1xuICAgICAgICAgICAgaWNvbnMgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCIke3Jlc3VsdC5kaWZmaWN1bHR5fVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXN0YXItaGFsZi1hbHRcIj48L2k+PC9zcGFuPmA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZGlmZiA9PT0gXCJtYXN0ZXJcIikge1xuICAgICAgICAgICAgaWNvbnMgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCIke3Jlc3VsdC5kaWZmaWN1bHR5fVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXN0YXJcIj48L2k+PC9zcGFuPmA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlc3VsdC5wdW5jdHVhdGlvbikge1xuICAgICAgICAgICAgaWNvbnMgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCJwdW5jdHVhdGlvblwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiIHN0eWxlPVwiZm9udC13ZWlnaHQ6OTAwXCI+IT88L3NwYW4+YDtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzdWx0Lm51bWJlcnMpIHtcbiAgICAgICAgICAgIGljb25zICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwibnVtYmVyc1wiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiIHN0eWxlPVwiZm9udC13ZWlnaHQ6OTAwXCI+MTU8L3NwYW4+YDtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzdWx0LmJsaW5kTW9kZSkge1xuICAgICAgICAgICAgaWNvbnMgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCJibGluZCBtb2RlXCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtZXllLXNsYXNoXCI+PC9pPjwvc3Bhbj5gO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXN1bHQubGF6eU1vZGUpIHtcbiAgICAgICAgICAgIGljb25zICs9IGA8c3BhbiBhcmlhLWxhYmVsPVwibGF6eSBtb2RlXCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtY291Y2hcIj48L2k+PC9zcGFuPmA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlc3VsdC5mdW5ib3ggIT09IFwibm9uZVwiICYmIHJlc3VsdC5mdW5ib3ggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWNvbnMgKz0gYDxzcGFuIGFyaWEtbGFiZWw9XCIke3Jlc3VsdC5mdW5ib3gucmVwbGFjZSgvXy9nLCBcIiBcIil9XCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+PGkgY2xhc3M9XCJmYXMgZmEtZ2FtZXBhZFwiPjwvaT48L3NwYW4+YDtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzdWx0LmNoYXJ0RGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpY29ucyArPSBgPHNwYW4gY2xhc3M9XCJtaW5pUmVzdWx0Q2hhcnRCdXR0b25cIiBhcmlhLWxhYmVsPVwiTm8gY2hhcnQgZGF0YSBmb3VuZFwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWNoYXJ0LWxpbmVcIj48L2k+PC9zcGFuPmA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVzdWx0LmNoYXJ0RGF0YSA9PT0gXCJ0b29sb25nXCIpIHtcbiAgICAgICAgICAgIGljb25zICs9IGA8c3BhbiBjbGFzcz1cIm1pbmlSZXN1bHRDaGFydEJ1dHRvblwiIGFyaWEtbGFiZWw9XCJDaGFydCBoaXN0b3J5IGlzIG5vdCBhdmFpbGFibGUgZm9yIGxvbmcgdGVzdHNcIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1jaGFydC1saW5lXCI+PC9pPjwvc3Bhbj5gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWNvbnMgKz0gYDxzcGFuIGNsYXNzPVwibWluaVJlc3VsdENoYXJ0QnV0dG9uXCIgYXJpYS1sYWJlbD1cIlZpZXcgZ3JhcGhcIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIiBmaWx0ZXJlZFJlc3VsdHNJZD1cIiR7aX1cIiBzdHlsZT1cIm9wYWNpdHk6IDFcIj48aSBjbGFzcz1cImZhcyBmYS1jaGFydC1saW5lXCI+PC9pPjwvc3Bhbj5gO1xuICAgICAgICB9XG4gICAgICAgIGxldCB0YWdOYW1lcyA9IFwiXCI7XG4gICAgICAgIGlmIChyZXN1bHQudGFncyAhPT0gdW5kZWZpbmVkICYmIHJlc3VsdC50YWdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJlc3VsdC50YWdzLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKChzbmFwdGFnKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YWcgPT09IHNuYXB0YWcuX2lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YWdOYW1lcyArPSBzbmFwdGFnLm5hbWUgKyBcIiwgXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGFnTmFtZXMgPSB0YWdOYW1lcy5zdWJzdHJpbmcoMCwgdGFnTmFtZXMubGVuZ3RoIC0gMik7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHJlc3RhZ3M7XG4gICAgICAgIGlmIChyZXN1bHQudGFncyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXN0YWdzID0gXCJbXVwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdGFncyA9IEpTT04uc3RyaW5naWZ5KHJlc3VsdC50YWdzKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdGFnSWNvbnMgPSBgPHNwYW4gaWQ9XCJyZXN1bHRFZGl0VGFnc1wiIHJlc3VsdElkPVwiJHtyZXN1bHQuX2lkfVwiIHRhZ3M9JyR7cmVzdGFnc30nIGFyaWEtbGFiZWw9XCJubyB0YWdzXCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCIgc3R5bGU9XCJvcGFjaXR5OiAuMjVcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS10YWdcIj48L2k+PC9zcGFuPmA7XG4gICAgICAgIGlmICh0YWdOYW1lcyAhPT0gXCJcIikge1xuICAgICAgICAgICAgaWYgKHJlc3VsdC50YWdzICE9PSB1bmRlZmluZWQgJiYgcmVzdWx0LnRhZ3MubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIHRhZ0ljb25zID0gYDxzcGFuIGlkPVwicmVzdWx0RWRpdFRhZ3NcIiByZXN1bHRJZD1cIiR7cmVzdWx0Ll9pZH1cIiB0YWdzPScke3Jlc3RhZ3N9JyBhcmlhLWxhYmVsPVwiJHt0YWdOYW1lc31cIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS10YWdzXCI+PC9pPjwvc3Bhbj5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGFnSWNvbnMgPSBgPHNwYW4gaWQ9XCJyZXN1bHRFZGl0VGFnc1wiIHJlc3VsdElkPVwiJHtyZXN1bHQuX2lkfVwiIHRhZ3M9JyR7cmVzdGFnc30nIGFyaWEtbGFiZWw9XCIke3RhZ05hbWVzfVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXRhZ1wiPjwvaT48L3NwYW4+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBsZXQgY29uc2lzdGVuY3kgPSBcIi1cIjtcbiAgICAgICAgaWYgKHJlc3VsdC5jb25zaXN0ZW5jeSkge1xuICAgICAgICAgICAgY29uc2lzdGVuY3kgPSByZXN1bHQuY29uc2lzdGVuY3kudG9GaXhlZCgyKSArIFwiJVwiO1xuICAgICAgICB9XG4gICAgICAgIGxldCBwYiA9IChfYiA9IHJlc3VsdC5pc1BiKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudG9TdHJpbmcoKTtcbiAgICAgICAgaWYgKHBiKSB7XG4gICAgICAgICAgICBwYiA9ICc8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1jcm93blwiPjwvaT4nO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcGIgPSBcIlwiO1xuICAgICAgICB9XG4gICAgICAgIGxldCBjaGFyU3RhdHMgPSBcIi1cIjtcbiAgICAgICAgaWYgKHJlc3VsdC5jaGFyU3RhdHMpIHtcbiAgICAgICAgICAgIGNoYXJTdGF0cyA9IHJlc3VsdC5jaGFyU3RhdHMuam9pbihcIi9cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjaGFyU3RhdHMgPSByZXN1bHQuY29ycmVjdENoYXJzICsgXCIvXCIgKyByZXN1bHQuaW5jb3JyZWN0Q2hhcnMgKyBcIi8tLy1cIjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUocmVzdWx0LnRpbWVzdGFtcCk7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmhpc3RvcnkgdGFibGUgdGJvZHlcIikuYXBwZW5kKGBcbiAgICA8dHIgY2xhc3M9XCJyZXN1bHRSb3dcIiBpZD1cInJlc3VsdC0ke2l9XCI+XG4gICAgPHRkPiR7cGJ9PC90ZD5cbiAgICA8dGQ+JHsoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNID8gcmVzdWx0LndwbSAqIDUgOiByZXN1bHQud3BtKS50b0ZpeGVkKDIpfTwvdGQ+XG4gICAgPHRkPiR7cmF3fTwvdGQ+XG4gICAgPHRkPiR7cmVzdWx0LmFjYy50b0ZpeGVkKDIpfSU8L3RkPlxuICAgIDx0ZD4ke2NvbnNpc3RlbmN5fTwvdGQ+XG4gICAgPHRkPiR7Y2hhclN0YXRzfTwvdGQ+XG4gICAgPHRkPiR7cmVzdWx0Lm1vZGV9ICR7cmVzdWx0Lm1vZGUyfTwvdGQ+XG4gICAgPHRkIGNsYXNzPVwiaW5mb0ljb25zXCI+JHtpY29uc308L3RkPlxuICAgIDx0ZD4ke3RhZ0ljb25zfTwvdGQ+XG4gICAgPHRkPiR7KDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiZGQgTU1NIHl5eXlcIil9PGJyPlxuICAgICR7KDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiSEg6bW1cIil9XG4gICAgPC90ZD5cbiAgICA8L3RyPmApO1xuICAgIH1cbiAgICB2aXNpYmxlVGFibGVMaW5lcyA9IG5ld1Zpc2libGVMaW5lcztcbiAgICBpZiAodmlzaWJsZVRhYmxlTGluZXMgPj0gZmlsdGVyZWRSZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5sb2FkTW9yZUJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmxvYWRNb3JlQnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHJlc2V0KCkge1xuICAgICQoXCIucGFnZUFjY291bnQgLmhpc3RvcnkgdGFibGUgdGJvZHlcIikuZW1wdHkoKTtcbiAgICBDaGFydENvbnRyb2xsZXIuYWNjb3VudEFjdGl2aXR5LmRhdGEuZGF0YXNldHNbMF0uZGF0YSA9IFtdO1xuICAgIENoYXJ0Q29udHJvbGxlci5hY2NvdW50QWN0aXZpdHkuZGF0YS5kYXRhc2V0c1sxXS5kYXRhID0gW107XG4gICAgQ2hhcnRDb250cm9sbGVyLmFjY291bnRIaXN0b3J5LmRhdGEuZGF0YXNldHNbMF0uZGF0YSA9IFtdO1xuICAgIENoYXJ0Q29udHJvbGxlci5hY2NvdW50SGlzdG9yeS5kYXRhLmRhdGFzZXRzWzFdLmRhdGEgPSBbXTtcbiAgICBDaGFydENvbnRyb2xsZXIuYWNjb3VudEFjdGl2aXR5LnVwZGF0ZUNvbG9ycygpO1xuICAgIENoYXJ0Q29udHJvbGxlci5hY2NvdW50SGlzdG9yeS51cGRhdGVDb2xvcnMoKTtcbn1cbmV4cG9ydHMucmVzZXQgPSByZXNldDtcbmxldCB0b3RhbFNlY29uZHNGaWx0ZXJlZCA9IDA7XG5sZXQgY2hhcnREYXRhID0gW107XG5sZXQgYWNjQ2hhcnREYXRhID0gW107XG5mdW5jdGlvbiBzbW9vdGhIaXN0b3J5KGZhY3Rvcikge1xuICAgIGNvbnN0IHNtb290aGVkV3BtRGF0YSA9IE1pc2Muc21vb3RoKGNoYXJ0RGF0YS5tYXAoKGEpID0+IGEueSksIGZhY3Rvcik7XG4gICAgY29uc3Qgc21vb3RoZWRBY2NEYXRhID0gTWlzYy5zbW9vdGgoYWNjQ2hhcnREYXRhLm1hcCgoYSkgPT4gYS55KSwgZmFjdG9yKTtcbiAgICBjb25zdCBjaGFydERhdGEyID0gY2hhcnREYXRhLm1hcCgoYSwgaSkgPT4ge1xuICAgICAgICBjb25zdCByZXQgPSBPYmplY3QuYXNzaWduKHt9LCBhKTtcbiAgICAgICAgcmV0LnkgPSBzbW9vdGhlZFdwbURhdGFbaV07XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfSk7XG4gICAgY29uc3QgYWNjQ2hhcnREYXRhMiA9IGFjY0NoYXJ0RGF0YS5tYXAoKGEsIGkpID0+IHtcbiAgICAgICAgY29uc3QgcmV0ID0gT2JqZWN0LmFzc2lnbih7fSwgYSk7XG4gICAgICAgIHJldC55ID0gc21vb3RoZWRBY2NEYXRhW2ldO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH0pO1xuICAgIENoYXJ0Q29udHJvbGxlci5hY2NvdW50SGlzdG9yeS5kYXRhLmRhdGFzZXRzWzBdLmRhdGEgPSBjaGFydERhdGEyO1xuICAgIENoYXJ0Q29udHJvbGxlci5hY2NvdW50SGlzdG9yeS5kYXRhLmRhdGFzZXRzWzFdLmRhdGEgPSBhY2NDaGFydERhdGEyO1xuICAgIGlmIChjaGFydERhdGEyLmxlbmd0aCB8fCBhY2NDaGFydERhdGEyLmxlbmd0aCkge1xuICAgICAgICBDaGFydENvbnRyb2xsZXIuYWNjb3VudEhpc3RvcnkudXBkYXRlKCk7XG4gICAgfVxufVxuZXhwb3J0cy5zbW9vdGhIaXN0b3J5ID0gc21vb3RoSGlzdG9yeTtcbmZ1bmN0aW9uIGFwcGx5SGlzdG9yeVNtb290aGluZygpIHtcbiAgICBjb25zdCBzbW9vdGhpbmcgPSAkKFwiLnBhZ2VBY2NvdW50IC5jb250ZW50IC5iZWxvdyAuc21vb3RoaW5nIGlucHV0XCIpLnZhbCgpO1xuICAgICQoXCIucGFnZUFjY291bnQgLmNvbnRlbnQgLmJlbG93IC5zbW9vdGhpbmcgLnZhbHVlXCIpLnRleHQoc21vb3RoaW5nKTtcbiAgICBzbW9vdGhIaXN0b3J5KHBhcnNlSW50KHNtb290aGluZykpO1xufVxuZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgIGZ1bmN0aW9uIGNvbnQoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgTG9hZGluZ1BhZ2UudXBkYXRlVGV4dChcIkRpc3BsYXlpbmcgc3RhdHMuLi5cIik7XG4gICAgICAgIExvYWRpbmdQYWdlLnVwZGF0ZUJhcigxMDApO1xuICAgICAgICBjb25zb2xlLmxvZyhcInVwZGF0aW5nIGFjY291bnQgcGFnZVwiKTtcbiAgICAgICAgVGhlbWVDb2xvcnMudXBkYXRlKCk7XG4gICAgICAgIENoYXJ0Q29udHJvbGxlci5hY2NvdW50SGlzdG9yeS51cGRhdGVDb2xvcnMoKTtcbiAgICAgICAgQ2hhcnRDb250cm9sbGVyLmFjY291bnRBY3Rpdml0eS51cGRhdGVDb2xvcnMoKTtcbiAgICAgICAgQWxsVGltZVN0YXRzLnVwZGF0ZSgpO1xuICAgICAgICBQYlRhYmxlcy51cGRhdGUoKTtcbiAgICAgICAgY2hhcnREYXRhID0gW107XG4gICAgICAgIGFjY0NoYXJ0RGF0YSA9IFtdO1xuICAgICAgICBjb25zdCB3cG1DaGFydERhdGEgPSBbXTtcbiAgICAgICAgdmlzaWJsZVRhYmxlTGluZXMgPSAwO1xuICAgICAgICBsZXQgdG9wV3BtID0gMDtcbiAgICAgICAgbGV0IHRvcE1vZGUgPSBcIlwiO1xuICAgICAgICBsZXQgdGVzdFJlc3RhcnRzID0gMDtcbiAgICAgICAgbGV0IHRvdGFsV3BtID0gMDtcbiAgICAgICAgbGV0IHRlc3RDb3VudCA9IDA7XG4gICAgICAgIGxldCBsYXN0MTAgPSAwO1xuICAgICAgICBsZXQgd3BtTGFzdDEwdG90YWwgPSAwO1xuICAgICAgICBsZXQgdG9wQWNjID0gMDtcbiAgICAgICAgbGV0IHRvdGFsQWNjID0gMDtcbiAgICAgICAgbGV0IHRvdGFsQWNjMTAgPSAwO1xuICAgICAgICBjb25zdCByYXdXcG0gPSB7XG4gICAgICAgICAgICB0b3RhbDogMCxcbiAgICAgICAgICAgIGNvdW50OiAwLFxuICAgICAgICAgICAgbGFzdDEwVG90YWw6IDAsXG4gICAgICAgICAgICBsYXN0MTBDb3VudDogMCxcbiAgICAgICAgICAgIG1heDogMCxcbiAgICAgICAgfTtcbiAgICAgICAgLy8gbGV0IHRvdGFsU2Vjb25kcyA9IDA7XG4gICAgICAgIHRvdGFsU2Vjb25kc0ZpbHRlcmVkID0gMDtcbiAgICAgICAgbGV0IHRvcENvbnMgPSAwO1xuICAgICAgICBsZXQgdG90YWxDb25zID0gMDtcbiAgICAgICAgbGV0IHRvdGFsQ29uczEwID0gMDtcbiAgICAgICAgbGV0IGNvbnNDb3VudCA9IDA7XG4gICAgICAgIGNvbnN0IGFjdGl2aXR5Q2hhcnREYXRhID0ge307XG4gICAgICAgIGZpbHRlcmVkUmVzdWx0cyA9IFtdO1xuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5oaXN0b3J5IHRhYmxlIHRib2R5XCIpLmVtcHR5KCk7XG4gICAgICAgIChfYSA9IERCLmdldFNuYXBzaG90KCkucmVzdWx0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgLy8gdG90YWxTZWNvbmRzICs9IHR0O1xuICAgICAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZTtcbiAgICAgICAgICAgIC8vYXBwbHkgZmlsdGVyc1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBsZXQgcmVzZGlmZiA9IHJlc3VsdC5kaWZmaWN1bHR5O1xuICAgICAgICAgICAgICAgIGlmIChyZXNkaWZmID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICByZXNkaWZmID0gXCJub3JtYWxcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcImRpZmZpY3VsdHlcIiwgcmVzZGlmZikpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlckRlYnVnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgc2tpcHBpbmcgcmVzdWx0IGR1ZSB0byBkaWZmaWN1bHR5IGZpbHRlcmAsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIVJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwibW9kZVwiLCByZXN1bHQubW9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlckRlYnVnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgc2tpcHBpbmcgcmVzdWx0IGR1ZSB0byBtb2RlIGZpbHRlcmAsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lm1vZGUgPT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHRpbWVmaWx0ZXIgPSBcImN1c3RvbVwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAoWzE1LCAzMCwgNjAsIDEyMF0uaW5jbHVkZXMocGFyc2VJbnQocmVzdWx0Lm1vZGUyKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVmaWx0ZXIgPSByZXN1bHQubW9kZTI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcInRpbWVcIiwgdGltZWZpbHRlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJEZWJ1Zykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBza2lwcGluZyByZXN1bHQgZHVlIHRvIHRpbWUgZmlsdGVyYCwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXN1bHQubW9kZSA9PSBcIndvcmRzXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHdvcmRmaWx0ZXIgPSBcImN1c3RvbVwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAoWzEwLCAyNSwgNTAsIDEwMCwgMjAwXS5pbmNsdWRlcyhwYXJzZUludChyZXN1bHQubW9kZTIpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd29yZGZpbHRlciA9IHJlc3VsdC5tb2RlMjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoIVJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwid29yZHNcIiwgd29yZGZpbHRlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJEZWJ1Zykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBza2lwcGluZyByZXN1bHQgZHVlIHRvIHdvcmQgZmlsdGVyYCwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnF1b3RlTGVuZ3RoICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGZpbHRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5xdW90ZUxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyID0gXCJzaG9ydFwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlc3VsdC5xdW90ZUxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyID0gXCJtZWRpdW1cIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXN1bHQucXVvdGVMZW5ndGggPT09IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlciA9IFwibG9uZ1wiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlc3VsdC5xdW90ZUxlbmd0aCA9PT0gMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyID0gXCJ0aGljY1wiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXIgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgIVJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwicXVvdGVMZW5ndGhcIiwgZmlsdGVyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlckRlYnVnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYHNraXBwaW5nIHJlc3VsdCBkdWUgdG8gcXVvdGVMZW5ndGggZmlsdGVyYCwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsZXQgbGFuZ0ZpbHRlciA9IFJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwibGFuZ3VhZ2VcIiwgKF9hID0gcmVzdWx0Lmxhbmd1YWdlKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcImVuZ2xpc2hcIik7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5sYW5ndWFnZSA9PT0gXCJlbmdsaXNoX2V4cGFuZGVkXCIgJiZcbiAgICAgICAgICAgICAgICAgICAgUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJsYW5ndWFnZVwiLCBcImVuZ2xpc2hfMWtcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFuZ0ZpbHRlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghbGFuZ0ZpbHRlcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyRGVidWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBza2lwcGluZyByZXN1bHQgZHVlIHRvIGxhbmd1YWdlIGZpbHRlcmAsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsZXQgcHVuY2ZpbHRlciA9IFwib2ZmXCI7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5wdW5jdHVhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBwdW5jZmlsdGVyID0gXCJvblwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIVJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwicHVuY3R1YXRpb25cIiwgcHVuY2ZpbHRlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlckRlYnVnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgc2tpcHBpbmcgcmVzdWx0IGR1ZSB0byBwdW5jdHVhdGlvbiBmaWx0ZXJgLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IG51bWZpbHRlciA9IFwib2ZmXCI7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5udW1iZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgIG51bWZpbHRlciA9IFwib25cIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcIm51bWJlcnNcIiwgbnVtZmlsdGVyKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyRGVidWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBza2lwcGluZyByZXN1bHQgZHVlIHRvIG51bWJlcnMgZmlsdGVyYCwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZnVuYm94ID09PSBcIm5vbmVcIiB8fCByZXN1bHQuZnVuYm94ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcImZ1bmJveFwiLCBcIm5vbmVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJEZWJ1Zykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBza2lwcGluZyByZXN1bHQgZHVlIHRvIGZ1bmJveCBmaWx0ZXJgLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIVJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwiZnVuYm94XCIsIHJlc3VsdC5mdW5ib3gpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyRGVidWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgc2tpcHBpbmcgcmVzdWx0IGR1ZSB0byBmdW5ib3ggZmlsdGVyYCwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsZXQgdGFnSGlkZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC50YWdzID09PSB1bmRlZmluZWQgfHwgcmVzdWx0LnRhZ3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vbm8gdGFncywgc2hvdyB3aGVuIG5vIHRhZyBpcyBlbmFibGVkXG4gICAgICAgICAgICAgICAgICAgIGlmICgoKF9iID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGVuZ3RoKSB8fCAwID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwidGFnc1wiLCBcIm5vbmVcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnSGlkZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFnSGlkZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL3RhZ3MgZXhpc3RcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsaWRUYWdzID0gKF9jID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MubWFwKCh0KSA9PiB0Ll9pZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWxpZFRhZ3MgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnRhZ3MuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NoZWNrIGlmIGkgZXZlbiBuZWVkIHRvIGNoZWNrIHRhZ3MgYW55bW9yZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0YWdIaWRlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vY2hlY2sgaWYgdGFnIGlzIHZhbGlkXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsaWRUYWdzID09PSBudWxsIHx8IHZhbGlkVGFncyA9PT0gdm9pZCAwID8gdm9pZCAwIDogdmFsaWRUYWdzLmluY2x1ZGVzKHRhZykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RhZyB2YWxpZCwgY2hlY2sgaWYgZmlsdGVyIGlzIG9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwidGFnc1wiLCB0YWcpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdIaWRlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RhZyBub3QgZm91bmQgaW4gdmFsaWQgdGFncywgbWVhbmluZyBwcm9iYWJseSBkZWxldGVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwidGFnc1wiLCBcIm5vbmVcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ0hpZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0YWdIaWRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJEZWJ1Zykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYHNraXBwaW5nIHJlc3VsdCBkdWUgdG8gdGFnIGZpbHRlcmAsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCB0aW1lU2luY2VUZXN0ID0gTWF0aC5hYnMocmVzdWx0LnRpbWVzdGFtcCAtIERhdGUubm93KCkpIC8gMTAwMDtcbiAgICAgICAgICAgICAgICBsZXQgZGF0ZWhpZGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmIChSZXN1bHRGaWx0ZXJzLmdldEZpbHRlcihcImRhdGVcIiwgXCJhbGxcIikgfHxcbiAgICAgICAgICAgICAgICAgICAgKFJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwiZGF0ZVwiLCBcImxhc3RfZGF5XCIpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lU2luY2VUZXN0IDw9IDg2NDAwKSB8fFxuICAgICAgICAgICAgICAgICAgICAoUmVzdWx0RmlsdGVycy5nZXRGaWx0ZXIoXCJkYXRlXCIsIFwibGFzdF93ZWVrXCIpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lU2luY2VUZXN0IDw9IDYwNDgwMCkgfHxcbiAgICAgICAgICAgICAgICAgICAgKFJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwiZGF0ZVwiLCBcImxhc3RfbW9udGhcIikgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTaW5jZVRlc3QgPD0gMjU5MjAwMCkgfHxcbiAgICAgICAgICAgICAgICAgICAgKFJlc3VsdEZpbHRlcnMuZ2V0RmlsdGVyKFwiZGF0ZVwiLCBcImxhc3RfM21vbnRoc1wiKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZVNpbmNlVGVzdCA8PSA3Nzc2MDAwKSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRlaGlkZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZGF0ZWhpZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlckRlYnVnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgc2tpcHBpbmcgcmVzdWx0IGR1ZSB0byBkYXRlIGZpbHRlcmAsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmaWx0ZXJlZFJlc3VsdHMucHVzaChyZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlNvbWV0aGluZyB3ZW50IHdyb25nIHdoZW4gZmlsdGVyaW5nLiBSZXNldHRpbmcgZmlsdGVycy5cIiwgMCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgICAgIFJlc3VsdEZpbHRlcnMucmVzZXQoKTtcbiAgICAgICAgICAgICAgICBSZXN1bHRGaWx0ZXJzLnVwZGF0ZUFjdGl2ZSgpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9maWx0ZXJzIGRvbmVcbiAgICAgICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgICAgICBjb25zdCByZXN1bHREYXRlID0gbmV3IERhdGUocmVzdWx0LnRpbWVzdGFtcCk7XG4gICAgICAgICAgICByZXN1bHREYXRlLnNldFNlY29uZHMoMCk7XG4gICAgICAgICAgICByZXN1bHREYXRlLnNldE1pbnV0ZXMoMCk7XG4gICAgICAgICAgICByZXN1bHREYXRlLnNldEhvdXJzKDApO1xuICAgICAgICAgICAgcmVzdWx0RGF0ZS5zZXRNaWxsaXNlY29uZHMoMCk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRUaW1lc3RhbXAgPSByZXN1bHREYXRlLmdldFRpbWUoKTtcbiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhhY3Rpdml0eUNoYXJ0RGF0YSkuaW5jbHVkZXMoU3RyaW5nKHJlc3VsdFRpbWVzdGFtcCkpKSB7XG4gICAgICAgICAgICAgICAgYWN0aXZpdHlDaGFydERhdGFbcmVzdWx0VGltZXN0YW1wXS5hbW91bnQrKztcbiAgICAgICAgICAgICAgICBhY3Rpdml0eUNoYXJ0RGF0YVtyZXN1bHRUaW1lc3RhbXBdLnRpbWUgKz1cbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnRlc3REdXJhdGlvbiArXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuaW5jb21wbGV0ZVRlc3RTZWNvbmRzIC1cbiAgICAgICAgICAgICAgICAgICAgICAgICgoX2QgPSByZXN1bHQuYWZrRHVyYXRpb24pICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IDApO1xuICAgICAgICAgICAgICAgIGFjdGl2aXR5Q2hhcnREYXRhW3Jlc3VsdFRpbWVzdGFtcF0udG90YWxXcG0gKz0gcmVzdWx0LndwbTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGFjdGl2aXR5Q2hhcnREYXRhW3Jlc3VsdFRpbWVzdGFtcF0gPSB7XG4gICAgICAgICAgICAgICAgICAgIGFtb3VudDogMSxcbiAgICAgICAgICAgICAgICAgICAgdGltZTogcmVzdWx0LnRlc3REdXJhdGlvbiArXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuaW5jb21wbGV0ZVRlc3RTZWNvbmRzIC1cbiAgICAgICAgICAgICAgICAgICAgICAgICgoX2UgPSByZXN1bHQuYWZrRHVyYXRpb24pICE9PSBudWxsICYmIF9lICE9PSB2b2lkIDAgPyBfZSA6IDApLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbFdwbTogcmVzdWx0LndwbSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHR0ID0gMDtcbiAgICAgICAgICAgIGlmIChyZXN1bHQudGVzdER1cmF0aW9uID09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgICAgICAgIHJlc3VsdC5tb2RlMiAhPT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgICAgIHJlc3VsdC5tb2RlMiAhPT0gXCJ6ZW5cIikge1xuICAgICAgICAgICAgICAgIC8vdGVzdCBmaW5pc2hlZCBiZWZvcmUgdGVzdER1cmF0aW9uIGZpZWxkIHdhcyBpbnRyb2R1Y2VkIC0gZXN0aW1hdGVcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lm1vZGUgPT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdHQgPSByZXN1bHQubW9kZTI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlc3VsdC5tb2RlID09IFwid29yZHNcIikge1xuICAgICAgICAgICAgICAgICAgICB0dCA9IChyZXN1bHQubW9kZTIgLyByZXN1bHQud3BtKSAqIDYwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHR0ID0gcGFyc2VGbG9hdChyZXN1bHQudGVzdER1cmF0aW9uKTsgLy9sZWdhY3kgcmVzdWx0cyBjb3VsZCBoYXZlIGEgc3RyaW5nIGhlcmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXN1bHQuaW5jb21wbGV0ZVRlc3RTZWNvbmRzICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHR0ICs9IHJlc3VsdC5pbmNvbXBsZXRlVGVzdFNlY29uZHM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChyZXN1bHQucmVzdGFydENvdW50ICE9IHVuZGVmaW5lZCAmJlxuICAgICAgICAgICAgICAgIHJlc3VsdC5yZXN0YXJ0Q291bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgdHQgKz0gKHR0IC8gNCkgKiByZXN1bHQucmVzdGFydENvdW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gaWYgKHJlc3VsdC5pbmNvbXBsZXRlVGVzdFNlY29uZHMgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAvLyAgIHR0ICs9IHJlc3VsdC5pbmNvbXBsZXRlVGVzdFNlY29uZHM7XG4gICAgICAgICAgICAvLyB9IGVsc2UgaWYgKHJlc3VsdC5yZXN0YXJ0Q291bnQgIT0gdW5kZWZpbmVkICYmIHJlc3VsdC5yZXN0YXJ0Q291bnQgPiAwKSB7XG4gICAgICAgICAgICAvLyAgIHR0ICs9ICh0dCAvIDQpICogcmVzdWx0LnJlc3RhcnRDb3VudDtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIHRvdGFsU2Vjb25kc0ZpbHRlcmVkICs9IHR0O1xuICAgICAgICAgICAgaWYgKGxhc3QxMCA8IDEwKSB7XG4gICAgICAgICAgICAgICAgbGFzdDEwKys7XG4gICAgICAgICAgICAgICAgd3BtTGFzdDEwdG90YWwgKz0gcmVzdWx0LndwbTtcbiAgICAgICAgICAgICAgICB0b3RhbEFjYzEwICs9IHJlc3VsdC5hY2M7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmNvbnNpc3RlbmN5ICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgPyAodG90YWxDb25zMTAgKz0gcmVzdWx0LmNvbnNpc3RlbmN5KVxuICAgICAgICAgICAgICAgICAgICA6IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0ZXN0Q291bnQrKztcbiAgICAgICAgICAgIGlmIChyZXN1bHQuY29uc2lzdGVuY3kgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGNvbnNDb3VudCsrO1xuICAgICAgICAgICAgICAgIHRvdGFsQ29ucyArPSByZXN1bHQuY29uc2lzdGVuY3k7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5jb25zaXN0ZW5jeSA+IHRvcENvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9wQ29ucyA9IHJlc3VsdC5jb25zaXN0ZW5jeTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmVzdWx0LnJhd1dwbSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJhd1dwbS5sYXN0MTBDb3VudCA8IDEwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJhd1dwbS5sYXN0MTBDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICByYXdXcG0ubGFzdDEwVG90YWwgKz0gcmVzdWx0LnJhd1dwbTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmF3V3BtLnRvdGFsICs9IHJlc3VsdC5yYXdXcG07XG4gICAgICAgICAgICAgICAgcmF3V3BtLmNvdW50Kys7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5yYXdXcG0gPiByYXdXcG0ubWF4KSB7XG4gICAgICAgICAgICAgICAgICAgIHJhd1dwbS5tYXggPSByZXN1bHQucmF3V3BtO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXN1bHQuYWNjID4gdG9wQWNjKSB7XG4gICAgICAgICAgICAgICAgdG9wQWNjID0gcmVzdWx0LmFjYztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRvdGFsQWNjICs9IHJlc3VsdC5hY2M7XG4gICAgICAgICAgICBpZiAocmVzdWx0LnJlc3RhcnRDb3VudCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0ZXN0UmVzdGFydHMgKz0gcmVzdWx0LnJlc3RhcnRDb3VudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNoYXJ0RGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICB4OiByZXN1bHQudGltZXN0YW1wLFxuICAgICAgICAgICAgICAgIHk6IGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSA/IE1pc2Mucm91bmRUbzIocmVzdWx0LndwbSAqIDUpIDogcmVzdWx0LndwbSxcbiAgICAgICAgICAgICAgICB3cG06IGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTVxuICAgICAgICAgICAgICAgICAgICA/IE1pc2Mucm91bmRUbzIocmVzdWx0LndwbSAqIDUpXG4gICAgICAgICAgICAgICAgICAgIDogcmVzdWx0LndwbSxcbiAgICAgICAgICAgICAgICBhY2M6IHJlc3VsdC5hY2MsXG4gICAgICAgICAgICAgICAgbW9kZTogcmVzdWx0Lm1vZGUsXG4gICAgICAgICAgICAgICAgbW9kZTI6IHJlc3VsdC5tb2RlMixcbiAgICAgICAgICAgICAgICBwdW5jdHVhdGlvbjogcmVzdWx0LnB1bmN0dWF0aW9uLFxuICAgICAgICAgICAgICAgIGxhbmd1YWdlOiByZXN1bHQubGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgdGltZXN0YW1wOiByZXN1bHQudGltZXN0YW1wLFxuICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IHJlc3VsdC5kaWZmaWN1bHR5LFxuICAgICAgICAgICAgICAgIHJhdzogY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNXG4gICAgICAgICAgICAgICAgICAgID8gTWlzYy5yb3VuZFRvMihyZXN1bHQucmF3V3BtICogNSlcbiAgICAgICAgICAgICAgICAgICAgOiByZXN1bHQucmF3V3BtLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB3cG1DaGFydERhdGEucHVzaChyZXN1bHQud3BtKTtcbiAgICAgICAgICAgIGFjY0NoYXJ0RGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICB4OiByZXN1bHQudGltZXN0YW1wLFxuICAgICAgICAgICAgICAgIHk6IDEwMCAtIHJlc3VsdC5hY2MsXG4gICAgICAgICAgICAgICAgZXJyb3JSYXRlOiAxMDAgLSByZXN1bHQuYWNjLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAocmVzdWx0LndwbSA+IHRvcFdwbSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHB1bmNzY3RyaW5nID0gcmVzdWx0LnB1bmN0dWF0aW9uID8gXCIsPGJyPndpdGggcHVuY3R1YXRpb25cIiA6IFwiXCI7XG4gICAgICAgICAgICAgICAgY29uc3QgbnVtYnNjdHJpbmcgPSByZXN1bHQubnVtYmVyc1xuICAgICAgICAgICAgICAgICAgICA/IFwiLDxicj4gXCIgKyAocmVzdWx0LnB1bmN0dWF0aW9uID8gXCImXCIgOiBcIlwiKSArIFwid2l0aCBudW1iZXJzXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIlwiO1xuICAgICAgICAgICAgICAgIHRvcFdwbSA9IHJlc3VsdC53cG07XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5tb2RlID09IFwiY3VzdG9tXCIpXG4gICAgICAgICAgICAgICAgICAgIHRvcE1vZGUgPSByZXN1bHQubW9kZTtcbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9wTW9kZSA9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQubW9kZSArIFwiIFwiICsgcmVzdWx0Lm1vZGUyICsgcHVuY3NjdHJpbmcgKyBudW1ic2N0cmluZztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0b3RhbFdwbSArPSByZXN1bHQud3BtO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSkge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuZ3JvdXAuaGlzdG9yeSB0YWJsZSB0aGVhZCB0ciB0ZDpudGgtY2hpbGQoMilcIikudGV4dChcImNwbVwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmdyb3VwLmhpc3RvcnkgdGFibGUgdGhlYWQgdHIgdGQ6bnRoLWNoaWxkKDIpXCIpLnRleHQoXCJ3cG1cIik7XG4gICAgICAgIH1cbiAgICAgICAgbG9hZE1vcmVMaW5lcygpO1xuICAgICAgICAvLy8vLy8vL1xuICAgICAgICBjb25zdCBhY3Rpdml0eUNoYXJ0RGF0YV9hbW91bnQgPSBbXTtcbiAgICAgICAgY29uc3QgYWN0aXZpdHlDaGFydERhdGFfdGltZSA9IFtdO1xuICAgICAgICBjb25zdCBhY3Rpdml0eUNoYXJ0RGF0YV9hdmdXcG0gPSBbXTtcbiAgICAgICAgLy8gbGV0IGxhc3RUaW1lc3RhbXAgPSAwO1xuICAgICAgICBPYmplY3Qua2V5cyhhY3Rpdml0eUNoYXJ0RGF0YSkuZm9yRWFjaCgoZGF0ZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGF0ZUludCA9IHBhcnNlSW50KGRhdGUpO1xuICAgICAgICAgICAgYWN0aXZpdHlDaGFydERhdGFfYW1vdW50LnB1c2goe1xuICAgICAgICAgICAgICAgIHg6IGRhdGVJbnQsXG4gICAgICAgICAgICAgICAgeTogYWN0aXZpdHlDaGFydERhdGFbZGF0ZUludF0uYW1vdW50LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBhY3Rpdml0eUNoYXJ0RGF0YV90aW1lLnB1c2goe1xuICAgICAgICAgICAgICAgIHg6IGRhdGVJbnQsXG4gICAgICAgICAgICAgICAgeTogTWlzYy5yb3VuZFRvMihhY3Rpdml0eUNoYXJ0RGF0YVtkYXRlSW50XS50aW1lKSxcbiAgICAgICAgICAgICAgICBhbW91bnQ6IGFjdGl2aXR5Q2hhcnREYXRhW2RhdGVJbnRdLmFtb3VudCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYWN0aXZpdHlDaGFydERhdGFfYXZnV3BtLnB1c2goe1xuICAgICAgICAgICAgICAgIHg6IGRhdGVJbnQsXG4gICAgICAgICAgICAgICAgeTogTWlzYy5yb3VuZFRvMigoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNXG4gICAgICAgICAgICAgICAgICAgID8gYWN0aXZpdHlDaGFydERhdGFbZGF0ZUludF0udG90YWxXcG0gKiA1XG4gICAgICAgICAgICAgICAgICAgIDogYWN0aXZpdHlDaGFydERhdGFbZGF0ZUludF0udG90YWxXcG0pIC9cbiAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHlDaGFydERhdGFbZGF0ZUludF0uYW1vdW50KSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gbGFzdFRpbWVzdGFtcCA9IGRhdGU7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBhY2NvdW50QWN0aXZpdHlTY2FsZU9wdGlvbnMgPSBDaGFydENvbnRyb2xsZXIuYWNjb3VudEFjdGl2aXR5Lm9wdGlvbnMuc2NhbGVzO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNKSB7XG4gICAgICAgICAgICBhY2NvdW50QWN0aXZpdHlTY2FsZU9wdGlvbnNbXCJhdmdXcG1cIl0udGl0bGUudGV4dCA9IFwiQXZlcmFnZSBDcG1cIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGFjY291bnRBY3Rpdml0eVNjYWxlT3B0aW9uc1tcImF2Z1dwbVwiXS50aXRsZS50ZXh0ID0gXCJBdmVyYWdlIFdwbVwiO1xuICAgICAgICB9XG4gICAgICAgIENoYXJ0Q29udHJvbGxlci5hY2NvdW50QWN0aXZpdHkuZGF0YS5kYXRhc2V0c1swXS5kYXRhID1cbiAgICAgICAgICAgIGFjdGl2aXR5Q2hhcnREYXRhX3RpbWU7XG4gICAgICAgIENoYXJ0Q29udHJvbGxlci5hY2NvdW50QWN0aXZpdHkuZGF0YS5kYXRhc2V0c1sxXS5kYXRhID1cbiAgICAgICAgICAgIGFjdGl2aXR5Q2hhcnREYXRhX2F2Z1dwbTtcbiAgICAgICAgY29uc3QgYWNjb3VudEhpc3RvcnlTY2FsZU9wdGlvbnMgPSBDaGFydENvbnRyb2xsZXIuYWNjb3VudEhpc3Rvcnkub3B0aW9ucy5zY2FsZXM7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0pIHtcbiAgICAgICAgICAgIGFjY291bnRIaXN0b3J5U2NhbGVPcHRpb25zW1wid3BtXCJdLnRpdGxlLnRleHQgPSBcIkNoYXJhY3RlcnMgcGVyIE1pbnV0ZVwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYWNjb3VudEhpc3RvcnlTY2FsZU9wdGlvbnNbXCJ3cG1cIl0udGl0bGUudGV4dCA9IFwiV29yZHMgcGVyIE1pbnV0ZVwiO1xuICAgICAgICB9XG4gICAgICAgIENoYXJ0Q29udHJvbGxlci5hY2NvdW50SGlzdG9yeS5kYXRhLmRhdGFzZXRzWzBdLmRhdGEgPSBjaGFydERhdGE7XG4gICAgICAgIENoYXJ0Q29udHJvbGxlci5hY2NvdW50SGlzdG9yeS5kYXRhLmRhdGFzZXRzWzFdLmRhdGEgPSBhY2NDaGFydERhdGE7XG4gICAgICAgIGNvbnN0IHdwbXMgPSBjaGFydERhdGEubWFwKChyKSA9PiByLnkpO1xuICAgICAgICBjb25zdCBtaW5XcG1DaGFydFZhbCA9IE1hdGgubWluKC4uLndwbXMpO1xuICAgICAgICBjb25zdCBtYXhXcG1DaGFydFZhbCA9IE1hdGgubWF4KC4uLndwbXMpO1xuICAgICAgICAvLyBsZXQgYWNjdXJhY2llcyA9IGFjY0NoYXJ0RGF0YS5tYXAoKHIpID0+IHIueSk7XG4gICAgICAgIGFjY291bnRIaXN0b3J5U2NhbGVPcHRpb25zW1wid3BtXCJdLm1heCA9XG4gICAgICAgICAgICBNYXRoLmZsb29yKG1heFdwbUNoYXJ0VmFsKSArICgxMCAtIChNYXRoLmZsb29yKG1heFdwbUNoYXJ0VmFsKSAlIDEwKSk7XG4gICAgICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5zdGFydEdyYXBoc0F0WmVybykge1xuICAgICAgICAgICAgYWNjb3VudEhpc3RvcnlTY2FsZU9wdGlvbnNbXCJ3cG1cIl0ubWluID0gTWF0aC5mbG9vcihtaW5XcG1DaGFydFZhbCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhY2NvdW50SGlzdG9yeVNjYWxlT3B0aW9uc1tcIndwbVwiXS5taW4gPSAwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGFydERhdGEgPT0gW10gfHwgY2hhcnREYXRhLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5ncm91cC5ub0RhdGFFcnJvclwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmdyb3VwLmNoYXJ0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuZ3JvdXAuZGFpbHlBY3Rpdml0eUNoYXJ0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuZ3JvdXAuaGlzdG9yeVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLnRyaXBsZWdyb3VwLnN0YXRzXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuZ3JvdXAubm9EYXRhRXJyb3JcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5ncm91cC5jaGFydFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmdyb3VwLmRhaWx5QWN0aXZpdHlDaGFydFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmdyb3VwLmhpc3RvcnlcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC50cmlwbGVncm91cC5zdGF0c1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC50aW1lVG90YWxGaWx0ZXJlZCAudmFsXCIpLnRleHQoTWlzYy5zZWNvbmRzVG9TdHJpbmcoTWF0aC5yb3VuZCh0b3RhbFNlY29uZHNGaWx0ZXJlZCksIHRydWUsIHRydWUpKTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSkge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuaGlnaGVzdFdwbSAudGl0bGVcIikudGV4dChcImhpZ2hlc3QgY3BtXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuaGlnaGVzdFdwbSAudmFsXCIpLnRleHQoTWlzYy5yb3VuZFRvMih0b3BXcG0gKiA1KSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5oaWdoZXN0V3BtIC50aXRsZVwiKS50ZXh0KFwiaGlnaGVzdCB3cG1cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5oaWdoZXN0V3BtIC52YWxcIikudGV4dChNaXNjLnJvdW5kVG8yKHRvcFdwbSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0pIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2ZXJhZ2VXcG0gLnRpdGxlXCIpLnRleHQoXCJhdmVyYWdlIGNwbVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2ZXJhZ2VXcG0gLnZhbFwiKS50ZXh0KE1hdGgucm91bmQoKHRvdGFsV3BtICogNSkgLyB0ZXN0Q291bnQpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2ZXJhZ2VXcG0gLnRpdGxlXCIpLnRleHQoXCJhdmVyYWdlIHdwbVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2ZXJhZ2VXcG0gLnZhbFwiKS50ZXh0KE1hdGgucm91bmQodG90YWxXcG0gLyB0ZXN0Q291bnQpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmVyYWdlV3BtMTAgLnRpdGxlXCIpLnRleHQoXCJhdmVyYWdlIGNwbSAobGFzdCAxMCB0ZXN0cylcIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmVyYWdlV3BtMTAgLnZhbFwiKS50ZXh0KE1hdGgucm91bmQoKHdwbUxhc3QxMHRvdGFsICogNSkgLyBsYXN0MTApKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2ZXJhZ2VXcG0xMCAudGl0bGVcIikudGV4dChcImF2ZXJhZ2Ugd3BtIChsYXN0IDEwIHRlc3RzKVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2ZXJhZ2VXcG0xMCAudmFsXCIpLnRleHQoTWF0aC5yb3VuZCh3cG1MYXN0MTB0b3RhbCAvIGxhc3QxMCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0pIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmhpZ2hlc3RSYXcgLnRpdGxlXCIpLnRleHQoXCJoaWdoZXN0IHJhdyBjcG1cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5oaWdoZXN0UmF3IC52YWxcIikudGV4dChNaXNjLnJvdW5kVG8yKHJhd1dwbS5tYXggKiA1KSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5oaWdoZXN0UmF3IC50aXRsZVwiKS50ZXh0KFwiaGlnaGVzdCByYXcgd3BtXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuaGlnaGVzdFJhdyAudmFsXCIpLnRleHQoTWlzYy5yb3VuZFRvMihyYXdXcG0ubWF4KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSkge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZlcmFnZVJhdyAudGl0bGVcIikudGV4dChcImF2ZXJhZ2UgcmF3IGNwbVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2ZXJhZ2VSYXcgLnZhbFwiKS50ZXh0KE1hdGgucm91bmQoKHJhd1dwbS50b3RhbCAqIDUpIC8gcmF3V3BtLmNvdW50KSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmVyYWdlUmF3IC50aXRsZVwiKS50ZXh0KFwiYXZlcmFnZSByYXcgd3BtXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZlcmFnZVJhdyAudmFsXCIpLnRleHQoTWF0aC5yb3VuZChyYXdXcG0udG90YWwgLyByYXdXcG0uY291bnQpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmVyYWdlUmF3MTAgLnRpdGxlXCIpLnRleHQoXCJhdmVyYWdlIHJhdyBjcG0gKGxhc3QgMTAgdGVzdHMpXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZlcmFnZVJhdzEwIC52YWxcIikudGV4dChNYXRoLnJvdW5kKChyYXdXcG0ubGFzdDEwVG90YWwgKiA1KSAvIHJhd1dwbS5sYXN0MTBDb3VudCkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZlcmFnZVJhdzEwIC50aXRsZVwiKS50ZXh0KFwiYXZlcmFnZSByYXcgd3BtIChsYXN0IDEwIHRlc3RzKVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmF2ZXJhZ2VSYXcxMCAudmFsXCIpLnRleHQoTWF0aC5yb3VuZChyYXdXcG0ubGFzdDEwVG90YWwgLyByYXdXcG0ubGFzdDEwQ291bnQpKTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5oaWdoZXN0V3BtIC5tb2RlXCIpLmh0bWwodG9wTW9kZSk7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLnRlc3RzVGFrZW4gLnZhbFwiKS50ZXh0KHRlc3RDb3VudCk7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLmhpZ2hlc3RBY2MgLnZhbFwiKS50ZXh0KHRvcEFjYyArIFwiJVwiKTtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZnQWNjIC52YWxcIikudGV4dChNYXRoLnJvdW5kKHRvdGFsQWNjIC8gdGVzdENvdW50KSArIFwiJVwiKTtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZnQWNjMTAgLnZhbFwiKS50ZXh0KE1hdGgucm91bmQodG90YWxBY2MxMCAvIGxhc3QxMCkgKyBcIiVcIik7XG4gICAgICAgIGlmICh0b3RhbENvbnMgPT0gMCB8fCB0b3RhbENvbnMgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmdDb25zIC52YWxcIikudGV4dChcIi1cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC5hdmdDb25zMTAgLnZhbFwiKS50ZXh0KFwiLVwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIucGFnZUFjY291bnQgLmhpZ2hlc3RDb25zIC52YWxcIikudGV4dCh0b3BDb25zICsgXCIlXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZnQ29ucyAudmFsXCIpLnRleHQoTWF0aC5yb3VuZCh0b3RhbENvbnMgLyBjb25zQ291bnQpICsgXCIlXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuYXZnQ29uczEwIC52YWxcIikudGV4dChNYXRoLnJvdW5kKHRvdGFsQ29uczEwIC8gTWF0aC5taW4obGFzdDEwLCBjb25zQ291bnQpKSArIFwiJVwiKTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiLnBhZ2VBY2NvdW50IC50ZXN0c1N0YXJ0ZWQgLnZhbFwiKS50ZXh0KGAke3Rlc3RDb3VudCArIHRlc3RSZXN0YXJ0c31gKTtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAudGVzdHNDb21wbGV0ZWQgLnZhbFwiKS50ZXh0KGAke3Rlc3RDb3VudH0oJHtNYXRoLmZsb29yKCh0ZXN0Q291bnQgLyAodGVzdENvdW50ICsgdGVzdFJlc3RhcnRzKSkgKiAxMDApfSUpYCk7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLnRlc3RzQ29tcGxldGVkIC5hdmdyZXNcIikudGV4dChgXG4gICAgICAkeyh0ZXN0UmVzdGFydHMgLyB0ZXN0Q291bnQpLnRvRml4ZWQoMSl9IHJlc3RhcnRzIHBlciBjb21wbGV0ZWQgdGVzdFxuICAgIGApO1xuICAgICAgICBjb25zdCB3cG1Qb2ludHMgPSBmaWx0ZXJlZFJlc3VsdHMubWFwKChyKSA9PiByLndwbSkucmV2ZXJzZSgpO1xuICAgICAgICBjb25zdCB0cmVuZCA9IE1pc2MuZmluZExpbmVCeUxlYXN0U3F1YXJlcyh3cG1Qb2ludHMpO1xuICAgICAgICBjb25zdCB3cG1DaGFuZ2UgPSB0cmVuZFsxXVsxXSAtIHRyZW5kWzBdWzFdO1xuICAgICAgICBjb25zdCB3cG1DaGFuZ2VQZXJIb3VyID0gd3BtQ2hhbmdlICogKDM2MDAgLyB0b3RhbFNlY29uZHNGaWx0ZXJlZCk7XG4gICAgICAgIGNvbnN0IHBsdXMgPSB3cG1DaGFuZ2VQZXJIb3VyID4gMCA/IFwiK1wiIDogXCJcIjtcbiAgICAgICAgJChcIi5wYWdlQWNjb3VudCAuZ3JvdXAuY2hhcnQgLmJlbG93IC50ZXh0XCIpLnRleHQoYFNwZWVkIGNoYW5nZSBwZXIgaG91ciBzcGVudCB0eXBpbmc6ICR7cGx1cyArXG4gICAgICAgICAgICBNaXNjLnJvdW5kVG8yKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSA/IHdwbUNoYW5nZVBlckhvdXIgKiA1IDogd3BtQ2hhbmdlUGVySG91cil9ICR7Y29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNID8gXCJjcG1cIiA6IFwid3BtXCJ9LmApO1xuICAgICAgICBhcHBseUhpc3RvcnlTbW9vdGhpbmcoKTtcbiAgICAgICAgQ2hhcnRDb250cm9sbGVyLmFjY291bnRBY3Rpdml0eS51cGRhdGVDb2xvcnMoKTtcbiAgICAgICAgTG9hZGluZ1BhZ2UudXBkYXRlQmFyKDEwMCwgdHJ1ZSk7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT0gXCJhY2NvdW50XCIpXG4gICAgICAgICAgICAgICAgU2lnbk91dEJ1dHRvbi5zaG93KCk7XG4gICAgICAgIH0sIDEyNSk7XG4gICAgICAgIEZvY3VzLnNldChmYWxzZSk7XG4gICAgICAgIE1pc2Muc3dhcEVsZW1lbnRzKCQoXCIucGFnZUFjY291bnQgLnByZWxvYWRlclwiKSwgJChcIi5wYWdlQWNjb3VudCAuY29udGVudFwiKSwgMjUwKTtcbiAgICB9XG4gICAgaWYgKERCLmdldFNuYXBzaG90KCkgPT09IG51bGwpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoYE1pc3NpbmcgYWNjb3VudCBkYXRhLiBQbGVhc2UgcmVmcmVzaC5gLCAtMSk7XG4gICAgICAgICQoXCIucGFnZUFjY291bnQgLnByZWxvYWRlclwiKS5odG1sKFwiTWlzc2luZyBhY2NvdW50IGRhdGEuIFBsZWFzZSByZWZyZXNoLlwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoREIuZ2V0U25hcHNob3QoKS5yZXN1bHRzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTG9hZGluZ1BhZ2UudXBkYXRlQmFyKDQ1LCB0cnVlKTtcbiAgICAgICAgREIuZ2V0VXNlclJlc3VsdHMoKS50aGVuKChkKSA9PiB7XG4gICAgICAgICAgICBUb2RheVRyYWNrZXIuYWRkQWxsRnJvbVRvZGF5KCk7XG4gICAgICAgICAgICBpZiAoZCkge1xuICAgICAgICAgICAgICAgIFJlc3VsdEZpbHRlcnMudXBkYXRlQWN0aXZlKCk7XG4gICAgICAgICAgICAgICAgdXBkYXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJ1c2luZyBkYiBzbmFwXCIpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29udCgpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoYFNvbWV0aGluZyB3ZW50IHdyb25nOiAke2V9YCwgLTEpO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy51cGRhdGUgPSB1cGRhdGU7XG5mdW5jdGlvbiBzb3J0QW5kUmVmcmVzaEhpc3Rvcnkoa2V5U3RyaW5nLCBoZWFkZXJDbGFzcywgZm9yY2VEZXNjZW5kaW5nID0gbnVsbCkge1xuICAgIC8vIFJlbW92ZXMgc3R5bGluZyBmcm9tIHByZXZpb3VzIHNvcnRpbmcgcmVxdWVzdHM6XG4gICAgJChcInRkXCIpLnJlbW92ZUNsYXNzKFwiaGVhZGVyLXNvcnRlZFwiKTtcbiAgICAkKFwidGRcIikuY2hpbGRyZW4oXCJpXCIpLnJlbW92ZSgpO1xuICAgICQoaGVhZGVyQ2xhc3MpLmFkZENsYXNzKFwiaGVhZGVyLXNvcnRlZFwiKTtcbiAgICBpZiAoZmlsdGVyZWRSZXN1bHRzLmxlbmd0aCA8IDIpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBrZXkgPSBrZXlTdHJpbmc7XG4gICAgLy8gVGhpcyBhbGxvd3MgdG8gcmV2ZXJzZSB0aGUgc29ydGluZyBvcmRlciB3aGVuIGNsaWNraW5nIG11bHRpcGxlIHRpbWVzIG9uIHRoZSB0YWJsZSBoZWFkZXJcbiAgICBsZXQgZGVzY2VuZGluZyA9IHRydWU7XG4gICAgaWYgKGZvcmNlRGVzY2VuZGluZyAhPT0gbnVsbCkge1xuICAgICAgICBpZiAoZm9yY2VEZXNjZW5kaW5nID09IHRydWUpIHtcbiAgICAgICAgICAgICQoaGVhZGVyQ2xhc3MpLmFwcGVuZCgnPGkgY2xhc3M9XCJmYXMgZmEtc29ydC1kb3duXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9pPicpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZGVzY2VuZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgJChoZWFkZXJDbGFzcykuYXBwZW5kKCc8aSBjbGFzcz1cImZhcyBmYS1zb3J0LXVwXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9pPicpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKHBhcnNlSW50KGZpbHRlcmVkUmVzdWx0c1swXVtrZXldKSA8PVxuICAgICAgICBwYXJzZUludChmaWx0ZXJlZFJlc3VsdHNbZmlsdGVyZWRSZXN1bHRzLmxlbmd0aCAtIDFdW2tleV0pKSB7XG4gICAgICAgIGRlc2NlbmRpbmcgPSB0cnVlO1xuICAgICAgICAkKGhlYWRlckNsYXNzKS5hcHBlbmQoJzxpIGNsYXNzPVwiZmFzIGZhLXNvcnQtZG93blwiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvaT4nKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGRlc2NlbmRpbmcgPSBmYWxzZTtcbiAgICAgICAgJChoZWFkZXJDbGFzcykuYXBwZW5kKCc8aSBjbGFzcz1cImZhcyBmYS1zb3J0LXVwXCIsIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvaT4nKTtcbiAgICB9XG4gICAgY29uc3QgdGVtcCA9IFtdO1xuICAgIGNvbnN0IHBhcnNlZEluZGV4ZXMgPSBbXTtcbiAgICB3aGlsZSAodGVtcC5sZW5ndGggPCBmaWx0ZXJlZFJlc3VsdHMubGVuZ3RoKSB7XG4gICAgICAgIGxldCBsb3dlc3QgPSBOdW1iZXIuTUFYX1ZBTFVFO1xuICAgICAgICBsZXQgaGlnaGVzdCA9IC0xO1xuICAgICAgICBsZXQgaWR4ID0gLTE7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsdGVyZWRSZXN1bHRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAvL2ZpbmQgdGhlIGxvd2VzdCB3cG0gd2l0aCBpbmRleCBub3QgYWxyZWFkeSBwYXJzZWRcbiAgICAgICAgICAgIGlmICghZGVzY2VuZGluZykge1xuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJlZFJlc3VsdHNbaV1ba2V5XSA8PSBsb3dlc3QgJiZcbiAgICAgICAgICAgICAgICAgICAgIXBhcnNlZEluZGV4ZXMuaW5jbHVkZXMoaSkpIHtcbiAgICAgICAgICAgICAgICAgICAgbG93ZXN0ID0gZmlsdGVyZWRSZXN1bHRzW2ldW2tleV07XG4gICAgICAgICAgICAgICAgICAgIGlkeCA9IGk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbHRlcmVkUmVzdWx0c1tpXVtrZXldID49IGhpZ2hlc3QgJiZcbiAgICAgICAgICAgICAgICAgICAgIXBhcnNlZEluZGV4ZXMuaW5jbHVkZXMoaSkpIHtcbiAgICAgICAgICAgICAgICAgICAgaGlnaGVzdCA9IGZpbHRlcmVkUmVzdWx0c1tpXVtrZXldO1xuICAgICAgICAgICAgICAgICAgICBpZHggPSBpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0ZW1wLnB1c2goZmlsdGVyZWRSZXN1bHRzW2lkeF0pO1xuICAgICAgICBwYXJzZWRJbmRleGVzLnB1c2goaWR4KTtcbiAgICB9XG4gICAgZmlsdGVyZWRSZXN1bHRzID0gdGVtcDtcbiAgICAkKFwiLnBhZ2VBY2NvdW50IC5oaXN0b3J5IHRhYmxlIHRib2R5XCIpLmVtcHR5KCk7XG4gICAgdmlzaWJsZVRhYmxlTGluZXMgPSAwO1xuICAgIGxvYWRNb3JlTGluZXMoKTtcbn1cbiQoXCIucGFnZUFjY291bnQgLnRvZ2dsZUFjY3VyYWN5T25DaGFydFwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0Q2hhcnRBY2N1cmFjeSghY29uZmlnXzEuZGVmYXVsdC5jaGFydEFjY3VyYWN5KTtcbn0pO1xuJChcIi5wYWdlQWNjb3VudCAudG9nZ2xlQ2hhcnRTdHlsZVwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5jaGFydFN0eWxlID09IFwibGluZVwiKSB7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDaGFydFN0eWxlKFwic2NhdHRlclwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDaGFydFN0eWxlKFwibGluZVwiKTtcbiAgICB9XG59KTtcbiQoXCIucGFnZUFjY291bnQgLmxvYWRNb3JlQnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGxvYWRNb3JlTGluZXMoKTtcbn0pO1xuJChcIi5wYWdlQWNjb3VudCAjYWNjb3VudEhpc3RvcnlDaGFydFwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBjb25zdCBpbmRleCA9IENoYXJ0Q29udHJvbGxlci5hY2NvdW50SGlzdG9yeUFjdGl2ZUluZGV4O1xuICAgIGxvYWRNb3JlTGluZXMoaW5kZXgpO1xuICAgIGlmICghd2luZG93KVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3Qgd2luZG93SGVpZ2h0ID0gKF9hID0gJCh3aW5kb3cpLmhlaWdodCgpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAwO1xuICAgIGNvbnN0IG9mZnNldCA9IChfYyA9IChfYiA9ICQoYCNyZXN1bHQtJHtpbmRleH1gKS5vZmZzZXQoKSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnRvcCkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogMDtcbiAgICBjb25zdCBzY3JvbGxUbyA9IG9mZnNldCAtIHdpbmRvd0hlaWdodCAvIDI7XG4gICAgJChbZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCBkb2N1bWVudC5ib2R5XSkuYW5pbWF0ZSh7XG4gICAgICAgIHNjcm9sbFRvcDogc2Nyb2xsVG8sXG4gICAgfSwgNTAwKTtcbiAgICAkKFwiLnJlc3VsdFJvd1wiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAkKGAjcmVzdWx0LSR7aW5kZXh9YCkuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZUFjY291bnQgLm1pbmlSZXN1bHRDaGFydEJ1dHRvblwiLCAoZXZlbnQpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgY29uc29sZS5sb2coXCJ1cGRhdGluZ1wiKTtcbiAgICBjb25zdCBmaWx0ZXJlZElkID0gJChldmVudC5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiZmlsdGVyZWRSZXN1bHRzSWRcIik7XG4gICAgaWYgKGZpbHRlcmVkSWQgPT09IHVuZGVmaW5lZClcbiAgICAgICAgcmV0dXJuO1xuICAgIE1pbmlSZXN1bHRDaGFydC51cGRhdGVEYXRhKGZpbHRlcmVkUmVzdWx0c1twYXJzZUludChmaWx0ZXJlZElkKV0uY2hhcnREYXRhKTtcbiAgICBNaW5pUmVzdWx0Q2hhcnQuc2hvdygpO1xuICAgIE1pbmlSZXN1bHRDaGFydC51cGRhdGVQb3NpdGlvbihldmVudC5wYWdlWCAtICgoX2EgPSAkKFwiLnBhZ2VBY2NvdW50IC5taW5pUmVzdWx0Q2hhcnRXcmFwcGVyXCIpLm91dGVyV2lkdGgoKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogMCksIGV2ZW50LnBhZ2VZICsgMzApO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLmhpc3Rvcnktd3BtLWhlYWRlclwiLCAoKSA9PiB7XG4gICAgc29ydEFuZFJlZnJlc2hIaXN0b3J5KFwid3BtXCIsIFwiLmhpc3Rvcnktd3BtLWhlYWRlclwiKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5oaXN0b3J5LXJhdy1oZWFkZXJcIiwgKCkgPT4ge1xuICAgIHNvcnRBbmRSZWZyZXNoSGlzdG9yeShcInJhd1dwbVwiLCBcIi5oaXN0b3J5LXJhdy1oZWFkZXJcIik7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIuaGlzdG9yeS1hY2MtaGVhZGVyXCIsICgpID0+IHtcbiAgICBzb3J0QW5kUmVmcmVzaEhpc3RvcnkoXCJhY2NcIiwgXCIuaGlzdG9yeS1hY2MtaGVhZGVyXCIpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLmhpc3RvcnktY29ycmVjdC1jaGFycy1oZWFkZXJcIiwgKCkgPT4ge1xuICAgIHNvcnRBbmRSZWZyZXNoSGlzdG9yeShcImNvcnJlY3RDaGFyc1wiLCBcIi5oaXN0b3J5LWNvcnJlY3QtY2hhcnMtaGVhZGVyXCIpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLmhpc3RvcnktaW5jb3JyZWN0LWNoYXJzLWhlYWRlclwiLCAoKSA9PiB7XG4gICAgc29ydEFuZFJlZnJlc2hIaXN0b3J5KFwiaW5jb3JyZWN0Q2hhcnNcIiwgXCIuaGlzdG9yeS1pbmNvcnJlY3QtY2hhcnMtaGVhZGVyXCIpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLmhpc3RvcnktY29uc2lzdGVuY3ktaGVhZGVyXCIsICgpID0+IHtcbiAgICBzb3J0QW5kUmVmcmVzaEhpc3RvcnkoXCJjb25zaXN0ZW5jeVwiLCBcIi5oaXN0b3J5LWNvbnNpc3RlbmN5LWhlYWRlclwiKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5oaXN0b3J5LWRhdGUtaGVhZGVyXCIsICgpID0+IHtcbiAgICBzb3J0QW5kUmVmcmVzaEhpc3RvcnkoXCJ0aW1lc3RhbXBcIiwgXCIuaGlzdG9yeS1kYXRlLWhlYWRlclwiKTtcbn0pO1xuLy8gUmVzZXRzIHNvcnRpbmcgdG8gYnkgZGF0ZScgd2hlbiBhcHBseWluZyBmaWxlcnMgKG5vcm1hbCBvciBhZHZhbmNlZClcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIuYnV0dG9uc0FuZFRpdGxlIC5idXR0b25zIC5idXR0b25cIiwgKCkgPT4ge1xuICAgIC8vIFdlIHdhbnQgdG8gJ2ZvcmNlJyBkZXNjZW5kaW5nIHNvcnQ6XG4gICAgc29ydEFuZFJlZnJlc2hIaXN0b3J5KFwidGltZXN0YW1wXCIsIFwiLmhpc3RvcnktZGF0ZS1oZWFkZXJcIiwgdHJ1ZSk7XG59KTtcbiQoXCIucGFnZUFjY291bnQgLnRvcEZpbHRlcnMgLmJ1dHRvbiwgLnBhZ2VBY2NvdW50IC5maWx0ZXJCdXR0b25zIC5idXR0b24gXCIpLmNsaWNrKCgpID0+IHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdXBkYXRlKCk7XG4gICAgfSwgMCk7XG59KTtcbiQoXCIucGFnZUFjY291bnQgLmNvbnRlbnQgLmJlbG93IC5zbW9vdGhpbmcgaW5wdXRcIikub24oXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgYXBwbHlIaXN0b3J5U21vb3RoaW5nKCk7XG59KTtcbiQoXCIucGFnZUFjY291bnQgLmNvbnRlbnQgLmdyb3VwLmFib3ZlSGlzdG9yeSAuZXhwb3J0Q1NWXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIE1pc2MuZG93bmxvYWRSZXN1bHRzQ1NWKGZpbHRlcmVkUmVzdWx0cyk7XG59KTtcbmV4cG9ydHMucGFnZSA9IG5ldyBwYWdlXzEuZGVmYXVsdChcImFjY291bnRcIiwgJChcIi5wYWdlLnBhZ2VBY2NvdW50XCIpLCBcIi9hY2NvdW50XCIsICgpID0+IHtcbiAgICBTaWduT3V0QnV0dG9uLmhpZGUoKTtcbn0sICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHJlc2V0KCk7XG59KSwgKCkgPT4ge1xuICAgIHVwZGF0ZSgpO1xuICAgIC8vIFNpZ25PdXRCdXR0b24uc2hvdygpO1xufSwgKCkgPT4ge1xuICAgIC8vXG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucGFnZSA9IGV4cG9ydHMuc2hvd0JhciA9IGV4cG9ydHMudXBkYXRlVGV4dCA9IGV4cG9ydHMudXBkYXRlQmFyID0gdm9pZCAwO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBwYWdlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vcGFnZVwiKSk7XG5mdW5jdGlvbiB1cGRhdGVCYXIocGVyY2VudGFnZSwgZmFzdCkge1xuICAgIGNvbnN0IHNwZWVkID0gZmFzdCA/IDEwMCA6IDEwMDA7XG4gICAgJChcIi5wYWdlTG9hZGluZyAuZmlsbCwgLnBhZ2VBY2NvdW50IC5maWxsXCIpXG4gICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgd2lkdGg6IHBlcmNlbnRhZ2UgKyBcIiVcIixcbiAgICB9LCBzcGVlZCk7XG59XG5leHBvcnRzLnVwZGF0ZUJhciA9IHVwZGF0ZUJhcjtcbmZ1bmN0aW9uIHVwZGF0ZVRleHQodGV4dCkge1xuICAgICQoXCIucGFnZUxvYWRpbmcgLnRleHQsIC5wYWdlQWNjb3VudCAudGV4dFwiKS50ZXh0KHRleHQpO1xufVxuZXhwb3J0cy51cGRhdGVUZXh0ID0gdXBkYXRlVGV4dDtcbmZ1bmN0aW9uIHNob3dCYXIoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgIE1pc2Muc3dhcEVsZW1lbnRzKCQoXCIucGFnZUxvYWRpbmcgLmljb25cIiksICQoXCIucGFnZUxvYWRpbmcgLmJhcldyYXBwZXJcIiksIDEyNSwgKCkgPT4ge1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgTWlzYy5zd2FwRWxlbWVudHMoJChcIi5wYWdlQWNjb3VudCAuaWNvblwiKSwgJChcIi5wYWdlQWNjb3VudCAuYmFyV3JhcHBlclwiKSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZXhwb3J0cy5zaG93QmFyID0gc2hvd0JhcjtcbmV4cG9ydHMucGFnZSA9IG5ldyBwYWdlXzEuZGVmYXVsdChcImxvYWRpbmdcIiwgJChcIi5wYWdlLnBhZ2VMb2FkaW5nXCIpLCBcIi9cIiwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgLy9cbn0pLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAvL1xufSksICgpID0+IHtcbiAgICAvL1xufSwgKCkgPT4ge1xuICAgIC8vXG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5wYWdlID0gdm9pZCAwO1xuY29uc3QgcGFnZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL3BhZ2VcIikpO1xuZXhwb3J0cy5wYWdlID0gbmV3IHBhZ2VfMS5kZWZhdWx0KFwibG9naW5cIiwgJChcIi5wYWdlLnBhZ2VMb2dpblwiKSwgXCIvbG9naW5cIiwgKCkgPT4ge1xuICAgIC8vXG59LCAoKSA9PiB7XG4gICAgLy9cbn0sICgpID0+IHtcbiAgICAvL1xufSwgKCkgPT4ge1xuICAgIC8vXG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY2xhc3MgUGFnZSB7XG4gICAgY29uc3RydWN0b3IobmFtZSwgZWxlbWVudCwgcGF0aG5hbWUsIGJlZm9yZUhpZGUsIGFmdGVySGlkZSwgYmVmb3JlU2hvdywgYWZ0ZXJTaG93KSB7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICAgIHRoaXMucGF0aG5hbWUgPSBwYXRobmFtZTtcbiAgICAgICAgdGhpcy5iZWZvcmVIaWRlID0gYmVmb3JlSGlkZTtcbiAgICAgICAgdGhpcy5hZnRlckhpZGUgPSBhZnRlckhpZGU7XG4gICAgICAgIHRoaXMuYmVmb3JlU2hvdyA9IGJlZm9yZVNob3c7XG4gICAgICAgIHRoaXMuYWZ0ZXJTaG93ID0gYWZ0ZXJTaG93O1xuICAgIH1cbn1cbmV4cG9ydHMuZGVmYXVsdCA9IFBhZ2U7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnBhZ2UgPSBleHBvcnRzLnNldEV2ZW50RGlzYWJsZWQgPSBleHBvcnRzLnVwZGF0ZSA9IGV4cG9ydHMuc2hvd0FjY291bnRTZWN0aW9uID0gZXhwb3J0cy51cGRhdGVBdXRoU2VjdGlvbnMgPSBleHBvcnRzLnVwZGF0ZURpc2NvcmRTZWN0aW9uID0gZXhwb3J0cy5oaWRlQWNjb3VudFNlY3Rpb24gPSBleHBvcnRzLmZpbGxTZXR0aW5nc1BhZ2UgPSBleHBvcnRzLnJlc2V0ID0gZXhwb3J0cy5ncm91cHMgPSB2b2lkIDA7XG5jb25zdCBzZXR0aW5nc19ncm91cF8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9zZXR0aW5ncy9zZXR0aW5ncy1ncm91cFwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBTb3VuZCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvc291bmQtY29udHJvbGxlclwiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBGdW5ib3ggPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvZnVuYm94XCIpKTtcbmNvbnN0IFRhZ0NvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL3RhZy1jb250cm9sbGVyXCIpKTtcbmNvbnN0IFByZXNldENvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL3ByZXNldC1jb250cm9sbGVyXCIpKTtcbmNvbnN0IFRoZW1lUGlja2VyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zZXR0aW5ncy90aGVtZS1waWNrZXJcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBJbXBvcnRFeHBvcnRTZXR0aW5nc1BvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wb3B1cHMvaW1wb3J0LWV4cG9ydC1zZXR0aW5ncy1wb3B1cFwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmNvbnN0IEFjdGl2ZVBhZ2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9hY3RpdmUtcGFnZVwiKSk7XG5jb25zdCBBcGVLZXlzUG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BvcHVwcy9hcGUta2V5cy1wb3B1cFwiKSk7XG5jb25zdCBwYWdlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vcGFnZVwiKSk7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xuZXhwb3J0cy5ncm91cHMgPSB7fTtcbmZ1bmN0aW9uIGluaXRHcm91cHMoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgeWllbGQgVXBkYXRlQ29uZmlnLmxvYWRQcm9taXNlO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInNtb290aENhcmV0XCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInNtb290aENhcmV0XCIsIFVwZGF0ZUNvbmZpZy5zZXRTbW9vdGhDYXJldCwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiZGlmZmljdWx0eVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJkaWZmaWN1bHR5XCIsIFVwZGF0ZUNvbmZpZy5zZXREaWZmaWN1bHR5LCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJxdWlja1RhYlwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJxdWlja1RhYlwiLCBVcGRhdGVDb25maWcuc2V0UXVpY2tUYWJNb2RlLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzaG93TGl2ZVdwbVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJzaG93TGl2ZVdwbVwiLCBVcGRhdGVDb25maWcuc2V0U2hvd0xpdmVXcG0sIFwiYnV0dG9uXCIsICgpID0+IHtcbiAgICAgICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wia2V5bWFwTW9kZVwiXS51cGRhdGVJbnB1dCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzaG93TGl2ZUFjY1wiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJzaG93TGl2ZUFjY1wiLCBVcGRhdGVDb25maWcuc2V0U2hvd0xpdmVBY2MsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInNob3dMaXZlQnVyc3RcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwic2hvd0xpdmVCdXJzdFwiLCBVcGRhdGVDb25maWcuc2V0U2hvd0xpdmVCdXJzdCwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic2hvd1RpbWVyUHJvZ3Jlc3NcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwic2hvd1RpbWVyUHJvZ3Jlc3NcIiwgVXBkYXRlQ29uZmlnLnNldFNob3dUaW1lclByb2dyZXNzLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzaG93QXZlcmFnZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJzaG93QXZlcmFnZVwiLCBVcGRhdGVDb25maWcuc2V0U2hvd0F2ZXJhZ2UsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImtleW1hcE1vZGVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwia2V5bWFwTW9kZVwiLCBVcGRhdGVDb25maWcuc2V0S2V5bWFwTW9kZSwgXCJidXR0b25cIiwgKCkgPT4ge1xuICAgICAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzaG93TGl2ZVdwbVwiXS51cGRhdGVJbnB1dCgpO1xuICAgICAgICB9LCAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBNb2RlID09PSBcIm9mZlwiKSB7XG4gICAgICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ua2V5bWFwU3R5bGVcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ua2V5bWFwTGF5b3V0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmtleW1hcExlZ2VuZFN0eWxlXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ua2V5bWFwU3R5bGVcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ua2V5bWFwTGF5b3V0XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmtleW1hcExlZ2VuZFN0eWxlXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJrZXltYXBNYXRyaXhcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwia2V5bWFwU3R5bGVcIiwgVXBkYXRlQ29uZmlnLnNldEtleW1hcFN0eWxlLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJrZXltYXBMYXlvdXRcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwia2V5bWFwTGF5b3V0XCIsIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBMYXlvdXQsIFwic2VsZWN0XCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImtleW1hcExlZ2VuZFN0eWxlXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImtleW1hcExlZ2VuZFN0eWxlXCIsIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBMZWdlbmRTdHlsZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic2hvd0tleVRpcHNcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwic2hvd0tleVRpcHNcIiwgVXBkYXRlQ29uZmlnLnNldEtleVRpcHMsIFwiYnV0dG9uXCIsIHVuZGVmaW5lZCwgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc2hvd0tleVRpcHMpIHtcbiAgICAgICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAudGlwXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnRpcFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiZnJlZWRvbU1vZGVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiZnJlZWRvbU1vZGVcIiwgVXBkYXRlQ29uZmlnLnNldEZyZWVkb21Nb2RlLCBcImJ1dHRvblwiLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImNvbmZpZGVuY2VNb2RlXCJdLnVwZGF0ZUlucHV0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInN0cmljdFNwYWNlXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInN0cmljdFNwYWNlXCIsIFVwZGF0ZUNvbmZpZy5zZXRTdHJpY3RTcGFjZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wib3Bwb3NpdGVTaGlmdE1vZGVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwib3Bwb3NpdGVTaGlmdE1vZGVcIiwgVXBkYXRlQ29uZmlnLnNldE9wcG9zaXRlU2hpZnRNb2RlLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJjb25maWRlbmNlTW9kZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJjb25maWRlbmNlTW9kZVwiLCBVcGRhdGVDb25maWcuc2V0Q29uZmlkZW5jZU1vZGUsIFwiYnV0dG9uXCIsICgpID0+IHtcbiAgICAgICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiZnJlZWRvbU1vZGVcIl0udXBkYXRlSW5wdXQoKTtcbiAgICAgICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic3RvcE9uRXJyb3JcIl0udXBkYXRlSW5wdXQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiaW5kaWNhdGVUeXBvc1wiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJpbmRpY2F0ZVR5cG9zXCIsIFVwZGF0ZUNvbmZpZy5zZXRJbmRpY2F0ZVR5cG9zLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJoaWRlRXh0cmFMZXR0ZXJzXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImhpZGVFeHRyYUxldHRlcnNcIiwgVXBkYXRlQ29uZmlnLnNldEhpZGVFeHRyYUxldHRlcnMsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImJsaW5kTW9kZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJibGluZE1vZGVcIiwgVXBkYXRlQ29uZmlnLnNldEJsaW5kTW9kZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wicXVpY2tFbmRcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwicXVpY2tFbmRcIiwgVXBkYXRlQ29uZmlnLnNldFF1aWNrRW5kLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJyZXBlYXRRdW90ZXNcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwicmVwZWF0UXVvdGVzXCIsIFVwZGF0ZUNvbmZpZy5zZXRSZXBlYXRRdW90ZXMsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImVuYWJsZUFkc1wiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJlbmFibGVBZHNcIiwgVXBkYXRlQ29uZmlnLnNldEVuYWJsZUFkcywgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiYWx3YXlzU2hvd1dvcmRzSGlzdG9yeVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJhbHdheXNTaG93V29yZHNIaXN0b3J5XCIsIFVwZGF0ZUNvbmZpZy5zZXRBbHdheXNTaG93V29yZHNIaXN0b3J5LCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJicml0aXNoRW5nbGlzaFwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJicml0aXNoRW5nbGlzaFwiLCBVcGRhdGVDb25maWcuc2V0QnJpdGlzaEVuZ2xpc2gsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInNpbmdsZUxpc3RDb21tYW5kTGluZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJzaW5nbGVMaXN0Q29tbWFuZExpbmVcIiwgVXBkYXRlQ29uZmlnLnNldFNpbmdsZUxpc3RDb21tYW5kTGluZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiY2Fwc0xvY2tXYXJuaW5nXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImNhcHNMb2NrV2FybmluZ1wiLCBVcGRhdGVDb25maWcuc2V0Q2Fwc0xvY2tXYXJuaW5nLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJmbGlwVGVzdENvbG9yc1wiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJmbGlwVGVzdENvbG9yc1wiLCBVcGRhdGVDb25maWcuc2V0RmxpcFRlc3RDb2xvcnMsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInN3YXBFc2NBbmRUYWJcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwic3dhcEVzY0FuZFRhYlwiLCBVcGRhdGVDb25maWcuc2V0U3dhcEVzY0FuZFRhYiwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wic2hvd091dE9mRm9jdXNXYXJuaW5nXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInNob3dPdXRPZkZvY3VzV2FybmluZ1wiLCBVcGRhdGVDb25maWcuc2V0U2hvd091dE9mRm9jdXNXYXJuaW5nLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJjb2xvcmZ1bE1vZGVcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwiY29sb3JmdWxNb2RlXCIsIFVwZGF0ZUNvbmZpZy5zZXRDb2xvcmZ1bE1vZGUsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInN0YXJ0R3JhcGhzQXRaZXJvXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInN0YXJ0R3JhcGhzQXRaZXJvXCIsIFVwZGF0ZUNvbmZpZy5zZXRTdGFydEdyYXBoc0F0WmVybywgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiYXV0b1N3aXRjaFRoZW1lXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImF1dG9Td2l0Y2hUaGVtZVwiLCBVcGRhdGVDb25maWcuc2V0QXV0b1N3aXRjaFRoZW1lLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJyYW5kb21UaGVtZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJyYW5kb21UaGVtZVwiLCBVcGRhdGVDb25maWcuc2V0UmFuZG9tVGhlbWUsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInN0b3BPbkVycm9yXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInN0b3BPbkVycm9yXCIsIFVwZGF0ZUNvbmZpZy5zZXRTdG9wT25FcnJvciwgXCJidXR0b25cIiwgKCkgPT4ge1xuICAgICAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJjb25maWRlbmNlTW9kZVwiXS51cGRhdGVJbnB1dCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzb3VuZFZvbHVtZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJzb3VuZFZvbHVtZVwiLCBVcGRhdGVDb25maWcuc2V0U291bmRWb2x1bWUsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInBsYXlTb3VuZE9uRXJyb3JcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwicGxheVNvdW5kT25FcnJvclwiLCBVcGRhdGVDb25maWcuc2V0UGxheVNvdW5kT25FcnJvciwgXCJidXR0b25cIiwgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucGxheVNvdW5kT25FcnJvcilcbiAgICAgICAgICAgICAgICBTb3VuZC5wbGF5RXJyb3IoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wicGxheVNvdW5kT25DbGlja1wiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJwbGF5U291bmRPbkNsaWNrXCIsIFVwZGF0ZUNvbmZpZy5zZXRQbGF5U291bmRPbkNsaWNrLCBcImJ1dHRvblwiLCAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5wbGF5U291bmRPbkNsaWNrICE9PSBcIm9mZlwiKVxuICAgICAgICAgICAgICAgIFNvdW5kLnBsYXlDbGljaygpO1xuICAgICAgICB9KTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzaG93QWxsTGluZXNcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwic2hvd0FsbExpbmVzXCIsIFVwZGF0ZUNvbmZpZy5zZXRTaG93QWxsTGluZXMsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInBhY2VDYXJldFwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJwYWNlQ2FyZXRcIiwgVXBkYXRlQ29uZmlnLnNldFBhY2VDYXJldCwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wicmVwZWF0ZWRQYWNlXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInJlcGVhdGVkUGFjZVwiLCBVcGRhdGVDb25maWcuc2V0UmVwZWF0ZWRQYWNlLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJtaW5XcG1cIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwibWluV3BtXCIsIFVwZGF0ZUNvbmZpZy5zZXRNaW5XcG0sIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcIm1pbkFjY1wiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJtaW5BY2NcIiwgVXBkYXRlQ29uZmlnLnNldE1pbkFjYywgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wibWluQnVyc3RcIl0gPSBuZXcgc2V0dGluZ3NfZ3JvdXBfMS5kZWZhdWx0KFwibWluQnVyc3RcIiwgVXBkYXRlQ29uZmlnLnNldE1pbkJ1cnN0LCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJzbW9vdGhMaW5lU2Nyb2xsXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInNtb290aExpbmVTY3JvbGxcIiwgVXBkYXRlQ29uZmlnLnNldFNtb290aExpbmVTY3JvbGwsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImxhenlNb2RlXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImxhenlNb2RlXCIsIFVwZGF0ZUNvbmZpZy5zZXRMYXp5TW9kZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wibGF5b3V0XCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImxheW91dFwiLCBVcGRhdGVDb25maWcuc2V0TGF5b3V0LCBcInNlbGVjdFwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJsYW5ndWFnZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJsYW5ndWFnZVwiLCBVcGRhdGVDb25maWcuc2V0TGFuZ3VhZ2UsIFwic2VsZWN0XCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImZvbnRTaXplXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImZvbnRTaXplXCIsIFVwZGF0ZUNvbmZpZy5zZXRGb250U2l6ZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wicGFnZVdpZHRoXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInBhZ2VXaWR0aFwiLCBVcGRhdGVDb25maWcuc2V0UGFnZVdpZHRoLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJjYXJldFN0eWxlXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImNhcmV0U3R5bGVcIiwgVXBkYXRlQ29uZmlnLnNldENhcmV0U3R5bGUsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInBhY2VDYXJldFN0eWxlXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcInBhY2VDYXJldFN0eWxlXCIsIFVwZGF0ZUNvbmZpZy5zZXRQYWNlQ2FyZXRTdHlsZSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1widGltZXJTdHlsZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJ0aW1lclN0eWxlXCIsIFVwZGF0ZUNvbmZpZy5zZXRUaW1lclN0eWxlLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJoaWdobGlnaHRNb2RlXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImhpZ2hsaWdodE1vZGVcIiwgVXBkYXRlQ29uZmlnLnNldEhpZ2hsaWdodE1vZGUsIFwiYnV0dG9uXCIpO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcInRpbWVyT3BhY2l0eVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJ0aW1lck9wYWNpdHlcIiwgVXBkYXRlQ29uZmlnLnNldFRpbWVyT3BhY2l0eSwgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1widGltZXJDb2xvclwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJ0aW1lckNvbG9yXCIsIFVwZGF0ZUNvbmZpZy5zZXRUaW1lckNvbG9yLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJmb250RmFtaWx5XCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImZvbnRGYW1pbHlcIiwgVXBkYXRlQ29uZmlnLnNldEZvbnRGYW1pbHksIFwiYnV0dG9uXCIsIHVuZGVmaW5lZCwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY3VzdG9tQnV0dG9uID0gJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZm9udEZhbWlseSAuYnV0dG9ucyAuY3VzdG9tXCIpO1xuICAgICAgICAgICAgaWYgKCQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmZvbnRGYW1pbHkgLmJ1dHRvbnMgLmFjdGl2ZVwiKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBjdXN0b21CdXR0b24uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgY3VzdG9tQnV0dG9uLnRleHQoYEN1c3RvbSAoJHtjb25maWdfMS5kZWZhdWx0LmZvbnRGYW1pbHkucmVwbGFjZSgvXy9nLCBcIiBcIil9KWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY3VzdG9tQnV0dG9uLnRleHQoXCJDdXN0b21cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBleHBvcnRzLmdyb3Vwc1tcImFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzXCJdID0gbmV3IHNldHRpbmdzX2dyb3VwXzEuZGVmYXVsdChcImFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzXCIsIFVwZGF0ZUNvbmZpZy5zZXRBbHdheXNTaG93RGVjaW1hbFBsYWNlcywgXCJidXR0b25cIik7XG4gICAgICAgIGV4cG9ydHMuZ3JvdXBzW1wiYWx3YXlzU2hvd0NQTVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJhbHdheXNTaG93Q1BNXCIsIFVwZGF0ZUNvbmZpZy5zZXRBbHdheXNTaG93Q1BNLCBcImJ1dHRvblwiKTtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbXCJjdXN0b21CYWNrZ3JvdW5kU2l6ZVwiXSA9IG5ldyBzZXR0aW5nc19ncm91cF8xLmRlZmF1bHQoXCJjdXN0b21CYWNrZ3JvdW5kU2l6ZVwiLCBVcGRhdGVDb25maWcuc2V0Q3VzdG9tQmFja2dyb3VuZFNpemUsIFwiYnV0dG9uXCIpO1xuICAgICAgICAvLyBncm91cHMuY3VzdG9tTGF5b3V0Zmx1aWQgPSBuZXcgU2V0dGluZ3NHcm91cChcbiAgICAgICAgLy8gICBcImN1c3RvbUxheW91dGZsdWlkXCIsXG4gICAgICAgIC8vICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbUxheW91dGZsdWlkXG4gICAgICAgIC8vICk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiByZXNldCgpIHtcbiAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLmZhdlRoZW1lcy5idXR0b25zXCIpLmVtcHR5KCk7XG4gICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC5hbGxUaGVtZXMuYnV0dG9uc1wiKS5lbXB0eSgpO1xuICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAuYWxsQ3VzdG9tVGhlbWVzLmJ1dHRvbnNcIikuZW1wdHkoKTtcbiAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5sYW5ndWFnZUdyb3VwcyAuYnV0dG9uc1wiKS5lbXB0eSgpO1xuICAgICQoXCIucGFnZVNldHRpbmdzIHNlbGVjdFwiKS5lbXB0eSgpLnNlbGVjdDIoXCJkZXN0cm95XCIpO1xuICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmZ1bmJveCAuYnV0dG9uc1wiKS5lbXB0eSgpO1xuICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmZvbnRGYW1pbHkgLmJ1dHRvbnNcIikuZW1wdHkoKTtcbn1cbmV4cG9ydHMucmVzZXQgPSByZXNldDtcbmxldCBncm91cHNJbml0aWFsaXplZCA9IGZhbHNlO1xuZnVuY3Rpb24gZmlsbFNldHRpbmdzUGFnZSgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zaG93S2V5VGlwcykge1xuICAgICAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnRpcFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC50aXBcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gTGFuZ3VhZ2UgU2VsZWN0aW9uIENvbWJvYm94XG4gICAgICAgIGNvbnN0IGxhbmd1YWdlRWwgPSAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5sYW5ndWFnZSBzZWxlY3RcIikuZW1wdHkoKTtcbiAgICAgICAgY29uc3QgbGFuZ3VhZ2VHcm91cHMgPSB5aWVsZCBNaXNjLmdldExhbmd1YWdlR3JvdXBzKCk7XG4gICAgICAgIGxhbmd1YWdlR3JvdXBzLmZvckVhY2goKGdyb3VwKSA9PiB7XG4gICAgICAgICAgICBsZXQgbGFuZ0NvbWJvQm94ID0gYDxvcHRncm91cCBsYWJlbD1cIiR7Z3JvdXAubmFtZX1cIj5gO1xuICAgICAgICAgICAgZ3JvdXAubGFuZ3VhZ2VzLmZvckVhY2goKGxhbmd1YWdlKSA9PiB7XG4gICAgICAgICAgICAgICAgbGFuZ0NvbWJvQm94ICs9IGA8b3B0aW9uIHZhbHVlPVwiJHtsYW5ndWFnZX1cIj5cbiAgICAgICAgJHtsYW5ndWFnZS5yZXBsYWNlKC9fL2csIFwiIFwiKX1cbiAgICAgIDwvb3B0aW9uPmA7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxhbmdDb21ib0JveCArPSBgPC9vcHRncm91cD5gO1xuICAgICAgICAgICAgbGFuZ3VhZ2VFbC5hcHBlbmQobGFuZ0NvbWJvQm94KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGxhbmd1YWdlRWwuc2VsZWN0Mih7XG4gICAgICAgICAgICB3aWR0aDogXCIxMDAlXCIsXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBsYXlvdXRFbCA9ICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmxheW91dCBzZWxlY3RcIikuZW1wdHkoKTtcbiAgICAgICAgbGF5b3V0RWwuYXBwZW5kKGA8b3B0aW9uIHZhbHVlPSdkZWZhdWx0Jz5vZmY8L29wdGlvbj5gKTtcbiAgICAgICAgT2JqZWN0LmtleXMoeWllbGQgTWlzYy5nZXRMYXlvdXRzTGlzdCgpKS5mb3JFYWNoKChsYXlvdXQpID0+IHtcbiAgICAgICAgICAgIGxheW91dEVsLmFwcGVuZChgPG9wdGlvbiB2YWx1ZT0nJHtsYXlvdXR9Jz4ke2xheW91dC5yZXBsYWNlKC9fL2csIFwiIFwiKX08L29wdGlvbj5gKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGxheW91dEVsLnNlbGVjdDIoe1xuICAgICAgICAgICAgd2lkdGg6IFwiMTAwJVwiLFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3Qga2V5bWFwRWwgPSAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5rZXltYXBMYXlvdXQgc2VsZWN0XCIpLmVtcHR5KCk7XG4gICAgICAgIGtleW1hcEVsLmFwcGVuZChgPG9wdGlvbiB2YWx1ZT0nb3ZlcnJpZGVTeW5jJz5lbXVsYXRvciBzeW5jPC9vcHRpb24+YCk7XG4gICAgICAgIE9iamVjdC5rZXlzKHlpZWxkIE1pc2MuZ2V0TGF5b3V0c0xpc3QoKSkuZm9yRWFjaCgobGF5b3V0KSA9PiB7XG4gICAgICAgICAgICBpZiAobGF5b3V0LnRvU3RyaW5nKCkgIT0gXCJkZWZhdWx0XCIpIHtcbiAgICAgICAgICAgICAgICBrZXltYXBFbC5hcHBlbmQoYDxvcHRpb24gdmFsdWU9JyR7bGF5b3V0fSc+JHtsYXlvdXQucmVwbGFjZSgvXy9nLCBcIiBcIil9PC9vcHRpb24+YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBrZXltYXBFbC5zZWxlY3QyKHtcbiAgICAgICAgICAgIHdpZHRoOiBcIjEwMCVcIixcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHRoZW1lRWwxID0gJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uYXV0b1N3aXRjaFRoZW1lSW5wdXRzIHNlbGVjdC5saWdodFwiKS5lbXB0eSgpO1xuICAgICAgICBjb25zdCB0aGVtZUVsMiA9ICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmF1dG9Td2l0Y2hUaGVtZUlucHV0cyBzZWxlY3QuZGFya1wiKS5lbXB0eSgpO1xuICAgICAgICBmb3IgKGNvbnN0IHRoZW1lIG9mIHlpZWxkIE1pc2MuZ2V0VGhlbWVzTGlzdCgpKSB7XG4gICAgICAgICAgICB0aGVtZUVsMS5hcHBlbmQoYDxvcHRpb24gdmFsdWU9JyR7dGhlbWUubmFtZX0nPiR7dGhlbWUubmFtZS5yZXBsYWNlKC9fL2csIFwiIFwiKX08L29wdGlvbj5gKTtcbiAgICAgICAgICAgIHRoZW1lRWwyLmFwcGVuZChgPG9wdGlvbiB2YWx1ZT0nJHt0aGVtZS5uYW1lfSc+JHt0aGVtZS5uYW1lLnJlcGxhY2UoL18vZywgXCIgXCIpfTwvb3B0aW9uPmApO1xuICAgICAgICB9XG4gICAgICAgIHRoZW1lRWwxLnNlbGVjdDIoe1xuICAgICAgICAgICAgd2lkdGg6IFwiMTAwJVwiLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhlbWVFbDIuc2VsZWN0Mih7XG4gICAgICAgICAgICB3aWR0aDogXCIxMDAlXCIsXG4gICAgICAgIH0pO1xuICAgICAgICAkKGAucGFnZVNldHRpbmdzIC5zZWN0aW9uLmF1dG9Td2l0Y2hUaGVtZUlucHV0cyBzZWxlY3QubGlnaHRgKVxuICAgICAgICAgICAgLnZhbChjb25maWdfMS5kZWZhdWx0LnRoZW1lTGlnaHQpXG4gICAgICAgICAgICAudHJpZ2dlcihcImNoYW5nZS5zZWxlY3QyXCIpO1xuICAgICAgICAkKGAucGFnZVNldHRpbmdzIC5zZWN0aW9uLmF1dG9Td2l0Y2hUaGVtZUlucHV0cyBzZWxlY3QuZGFya2ApXG4gICAgICAgICAgICAudmFsKGNvbmZpZ18xLmRlZmF1bHQudGhlbWVEYXJrKVxuICAgICAgICAgICAgLnRyaWdnZXIoXCJjaGFuZ2Uuc2VsZWN0MlwiKTtcbiAgICAgICAgY29uc3QgZnVuYm94RWwgPSAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5mdW5ib3ggLmJ1dHRvbnNcIikuZW1wdHkoKTtcbiAgICAgICAgZnVuYm94RWwuYXBwZW5kKGA8ZGl2IGNsYXNzPVwiZnVuYm94IGJ1dHRvblwiIGZ1bmJveD0nbm9uZSc+bm9uZTwvZGl2PmApO1xuICAgICAgICBNaXNjLmdldEZ1bmJveExpc3QoKS50aGVuKChmdW5ib3hNb2RlcykgPT4ge1xuICAgICAgICAgICAgZnVuYm94TW9kZXMuZm9yRWFjaCgoZnVuYm94KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGZ1bmJveC5uYW1lID09PSBcIm1pcnJvclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGZ1bmJveEVsLmFwcGVuZChgPGRpdiBjbGFzcz1cImZ1bmJveCBidXR0b25cIiBmdW5ib3g9JyR7ZnVuYm94Lm5hbWV9JyBhcmlhLWxhYmVsPVwiJHtmdW5ib3guaW5mb31cIiBkYXRhLWJhbGxvb24tcG9zPVwidXBcIiBkYXRhLWJhbGxvb24tbGVuZ3RoPVwiZml0XCIgdHlwZT1cIiR7ZnVuYm94LnR5cGV9XCIgc3R5bGU9XCJ0cmFuc2Zvcm06c2NhbGVYKC0xKTtcIj4ke2Z1bmJveC5uYW1lLnJlcGxhY2UoL18vZywgXCIgXCIpfTwvZGl2PmApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZnVuYm94RWwuYXBwZW5kKGA8ZGl2IGNsYXNzPVwiZnVuYm94IGJ1dHRvblwiIGZ1bmJveD0nJHtmdW5ib3gubmFtZX0nIGFyaWEtbGFiZWw9XCIke2Z1bmJveC5pbmZvfVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJ1cFwiIGRhdGEtYmFsbG9vbi1sZW5ndGg9XCJmaXRcIiB0eXBlPVwiJHtmdW5ib3gudHlwZX1cIj4ke2Z1bmJveC5uYW1lLnJlcGxhY2UoL18vZywgXCIgXCIpfTwvZGl2PmApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgbGV0IGlzQ3VzdG9tRm9udCA9IHRydWU7XG4gICAgICAgIGNvbnN0IGZvbnRzRWwgPSAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5mb250RmFtaWx5IC5idXR0b25zXCIpLmVtcHR5KCk7XG4gICAgICAgIE1pc2MuZ2V0Rm9udHNMaXN0KCkudGhlbigoZm9udHMpID0+IHtcbiAgICAgICAgICAgIGZvbnRzLmZvckVhY2goKGZvbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mb250RmFtaWx5ID09PSBmb250Lm5hbWUpXG4gICAgICAgICAgICAgICAgICAgIGlzQ3VzdG9tRm9udCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGZvbnRzRWwuYXBwZW5kKGA8ZGl2IGNsYXNzPVwiYnV0dG9uJHtjb25maWdfMS5kZWZhdWx0LmZvbnRGYW1pbHkgPT09IGZvbnQubmFtZSA/IFwiIGFjdGl2ZVwiIDogXCJcIn1cIiBzdHlsZT1cImZvbnQtZmFtaWx5OiR7Zm9udC5kaXNwbGF5ICE9PSB1bmRlZmluZWQgPyBmb250LmRpc3BsYXkgOiBmb250Lm5hbWV9XCIgZm9udEZhbWlseT1cIiR7Zm9udC5uYW1lLnJlcGxhY2UoLyAvZywgXCJfXCIpfVwiIHRhYmluZGV4PVwiMFwiXG4gICAgICAgIG9uY2xpY2s9XCJ0aGlzLmJsdXIoKTtcIj4ke2ZvbnQuZGlzcGxheSAhPT0gdW5kZWZpbmVkID8gZm9udC5kaXNwbGF5IDogZm9udC5uYW1lfTwvZGl2PmApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBmb250c0VsLmFwcGVuZChpc0N1c3RvbUZvbnRcbiAgICAgICAgICAgICAgICA/IGA8ZGl2IGNsYXNzPVwiYnV0dG9uIG5vLWF1dG8taGFuZGxlIGN1c3RvbSBhY3RpdmVcIiBvbmNsaWNrPVwidGhpcy5ibHVyKCk7XCI+Q3VzdG9tICgke2NvbmZpZ18xLmRlZmF1bHQuZm9udEZhbWlseS5yZXBsYWNlKC9fL2csIFwiIFwiKX0pPC9kaXY+YFxuICAgICAgICAgICAgICAgIDogJzxkaXYgY2xhc3M9XCJidXR0b24gbm8tYXV0by1oYW5kbGUgY3VzdG9tXCIgb25jbGljaz1cInRoaXMuYmx1cigpO1wiPkN1c3RvbTwvZGl2PicpO1xuICAgICAgICB9KTtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZFNpemUgaW5wdXRcIikudmFsKGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tQmFja2dyb3VuZCk7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmN1c3RvbUxheW91dGZsdWlkIGlucHV0XCIpLnZhbChjb25maWdfMS5kZWZhdWx0LmN1c3RvbUxheW91dGZsdWlkLnJlcGxhY2UoLyMvZywgXCIgXCIpKTtcbiAgICAgICAgc2V0RXZlbnREaXNhYmxlZCh0cnVlKTtcbiAgICAgICAgaWYgKCFncm91cHNJbml0aWFsaXplZCkge1xuICAgICAgICAgICAgeWllbGQgaW5pdEdyb3VwcygpO1xuICAgICAgICAgICAgZ3JvdXBzSW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgT2JqZWN0LmtleXMoZXhwb3J0cy5ncm91cHMpLmZvckVhY2goKGdyb3VwS2V5KSA9PiB7XG4gICAgICAgICAgICAgICAgZXhwb3J0cy5ncm91cHNbZ3JvdXBLZXldLnVwZGF0ZUlucHV0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBzZXRFdmVudERpc2FibGVkKGZhbHNlKTtcbiAgICAgICAgeWllbGQgVGhlbWVQaWNrZXIucmVmcmVzaEJ1dHRvbnMoKTtcbiAgICAgICAgeWllbGQgVXBkYXRlQ29uZmlnLmxvYWRQcm9taXNlO1xuICAgIH0pO1xufVxuZXhwb3J0cy5maWxsU2V0dGluZ3NQYWdlID0gZmlsbFNldHRpbmdzUGFnZTtcbi8vIGV4cG9ydCBsZXQgc2V0dGluZ3NGaWxsUHJvbWlzZSA9IGZpbGxTZXR0aW5nc1BhZ2UoKTtcbmZ1bmN0aW9uIGhpZGVBY2NvdW50U2VjdGlvbigpIHtcbiAgICAkKGAuc2VjdGlvbkdyb3VwVGl0bGVbZ3JvdXA9J2FjY291bnQnXWApLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICQoYC5zZXR0aW5nc0dyb3VwLmFjY291bnRgKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAkKGAucGFnZVNldHRpbmdzIC5zZWN0aW9uLm5lZWRzQWNjb3VudGApLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xufVxuZXhwb3J0cy5oaWRlQWNjb3VudFNlY3Rpb24gPSBoaWRlQWNjb3VudFNlY3Rpb247XG5mdW5jdGlvbiB1cGRhdGVEaXNjb3JkU2VjdGlvbigpIHtcbiAgICAvL25vIGNvZGUgYW5kIG5vIGRpc2NvcmRcbiAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyID09IG51bGwpIHtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZGlzY29yZEludGVncmF0aW9uXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKERCLmdldFNuYXBzaG90KCkgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZGlzY29yZEludGVncmF0aW9uXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICBpZiAoREIuZ2V0U25hcHNob3QoKS5kaXNjb3JkSWQgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAvL3Nob3cgYnV0dG9uXG4gICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5kaXNjb3JkSW50ZWdyYXRpb24gLmJ1dHRvbnNcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5kaXNjb3JkSW50ZWdyYXRpb24gLmluZm9cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5kaXNjb3JkSW50ZWdyYXRpb24gLmJ1dHRvbnNcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5kaXNjb3JkSW50ZWdyYXRpb24gLmluZm9cIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLnVwZGF0ZURpc2NvcmRTZWN0aW9uID0gdXBkYXRlRGlzY29yZFNlY3Rpb247XG5mdW5jdGlvbiB1cGRhdGVBdXRoU2VjdGlvbnMoKSB7XG4gICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ucGFzc3dvcmRBdXRoU2V0dGluZ3MgLmJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5nb29nbGVBdXRoU2V0dGluZ3MgLmJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICBjb25zdCB1c2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgIGlmICghdXNlcilcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IHBhc3N3b3JkUHJvdmlkZXIgPSB1c2VyLnByb3ZpZGVyRGF0YS5maW5kKChwcm92aWRlcikgPT4gcHJvdmlkZXIucHJvdmlkZXJJZCA9PT0gXCJwYXNzd29yZFwiKTtcbiAgICBjb25zdCBnb29nbGVQcm92aWRlciA9IHVzZXIucHJvdmlkZXJEYXRhLmZpbmQoKHByb3ZpZGVyKSA9PiBwcm92aWRlci5wcm92aWRlcklkID09PSBcImdvb2dsZS5jb21cIik7XG4gICAgaWYgKHBhc3N3b3JkUHJvdmlkZXIpIHtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ucGFzc3dvcmRBdXRoU2V0dGluZ3MgI2VtYWlsUGFzc3dvcmRBdXRoXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5wYXNzd29yZEF1dGhTZXR0aW5ncyAjcGFzc1Bhc3N3b3JkQXV0aFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnBhc3N3b3JkQXV0aFNldHRpbmdzICNhZGRQYXNzd29yZEF1dGhcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGlmIChnb29nbGVQcm92aWRlcikge1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5nb29nbGVBdXRoU2V0dGluZ3MgI3JlbW92ZUdvb2dsZUF1dGhcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIGlmIChwYXNzd29yZFByb3ZpZGVyKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5nb29nbGVBdXRoU2V0dGluZ3MgI3JlbW92ZUdvb2dsZUF1dGhcIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmdvb2dsZUF1dGhTZXR0aW5ncyAjcmVtb3ZlR29vZ2xlQXV0aFwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5nb29nbGVBdXRoU2V0dGluZ3MgI2FkZEdvb2dsZUF1dGhcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxufVxuZXhwb3J0cy51cGRhdGVBdXRoU2VjdGlvbnMgPSB1cGRhdGVBdXRoU2VjdGlvbnM7XG5mdW5jdGlvbiBzZXRBY3RpdmVGdW5ib3hCdXR0b24oKSB7XG4gICAgJChgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5mdW5ib3ggLmJ1dHRvbmApLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICQoYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZnVuYm94IC5idXR0b25bZnVuYm94PScke2NvbmZpZ18xLmRlZmF1bHQuZnVuYm94fSddYCkuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG59XG5mdW5jdGlvbiByZWZyZXNoVGFnc1NldHRpbmdzU2VjdGlvbigpIHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciAhPT0gbnVsbCAmJiBEQi5nZXRTbmFwc2hvdCgpICE9PSBudWxsKSB7XG4gICAgICAgIGNvbnN0IHRhZ3NFbCA9ICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRhZ3MgLnRhZ3NMaXN0XCIpLmVtcHR5KCk7XG4gICAgICAgIChfYSA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgLy8gbGV0IHRhZ1BiU3RyaW5nID0gXCJObyBQQiBmb3VuZFwiO1xuICAgICAgICAgICAgLy8gaWYgKHRhZy5wYiAhPSB1bmRlZmluZWQgJiYgdGFnLnBiID4gMCkge1xuICAgICAgICAgICAgLy8gICB0YWdQYlN0cmluZyA9IGBQQjogJHt0YWcucGJ9YDtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIHRhZ3NFbC5hcHBlbmQoYFxuXG4gICAgICA8ZGl2IGNsYXNzPVwiYnV0dG9ucyB0YWdcIiBpZD1cIiR7dGFnLl9pZH1cIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImJ1dHRvbiB0YWdCdXR0b24gJHt0YWcuYWN0aXZlID8gXCJhY3RpdmVcIiA6IFwiXCJ9XCIgYWN0aXZlPVwiJHt0YWcuYWN0aXZlfVwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0aXRsZVwiPiR7dGFnLm5hbWV9PC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY2xlYXJQYkJ1dHRvbiBidXR0b25cIj5cbiAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS1jcm93biBmYS1md1wiPjwvaT5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJlZGl0QnV0dG9uIGJ1dHRvblwiPlxuICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLXBlbiBmYS1md1wiPjwvaT5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJyZW1vdmVCdXR0b24gYnV0dG9uXCI+XG4gICAgICAgICAgPGkgY2xhc3M9XCJmYXMgZmEtdHJhc2ggZmEtZndcIj48L2k+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG5cbiAgICAgIGApO1xuICAgICAgICB9KTtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGFnc1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRhZ3NcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxufVxuZnVuY3Rpb24gcmVmcmVzaFByZXNldHNTZXR0aW5nc1NlY3Rpb24oKSB7XG4gICAgdmFyIF9hO1xuICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgIT09IG51bGwgJiYgREIuZ2V0U25hcHNob3QoKSAhPT0gbnVsbCkge1xuICAgICAgICBjb25zdCBwcmVzZXRzRWwgPSAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5wcmVzZXRzIC5wcmVzZXRzTGlzdFwiKS5lbXB0eSgpO1xuICAgICAgICAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpLnByZXNldHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKChwcmVzZXQpID0+IHtcbiAgICAgICAgICAgIHByZXNldHNFbC5hcHBlbmQoYFxuICAgICAgPGRpdiBjbGFzcz1cImJ1dHRvbnMgcHJlc2V0XCIgaWQ9XCIke3ByZXNldC5faWR9XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJidXR0b24gcHJlc2V0QnV0dG9uXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cInRpdGxlXCI+JHtwcmVzZXQubmFtZX08L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJlZGl0QnV0dG9uIGJ1dHRvblwiPlxuICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLXBlbiBmYS1md1wiPjwvaT5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJyZW1vdmVCdXR0b24gYnV0dG9uXCI+XG4gICAgICAgICAgPGkgY2xhc3M9XCJmYXMgZmEtdHJhc2ggZmEtZndcIj48L2k+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgICBcbiAgICAgIGApO1xuICAgICAgICB9KTtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ucHJlc2V0c1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnByZXNldHNcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxufVxuZnVuY3Rpb24gc2hvd0FjY291bnRTZWN0aW9uKCkge1xuICAgICQoYC5zZWN0aW9uR3JvdXBUaXRsZVtncm91cD0nYWNjb3VudCddYCkucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgJChgLnNldHRpbmdzR3JvdXAuYWNjb3VudGApLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICQoYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubmVlZHNBY2NvdW50YCkucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgcmVmcmVzaFRhZ3NTZXR0aW5nc1NlY3Rpb24oKTtcbiAgICByZWZyZXNoUHJlc2V0c1NldHRpbmdzU2VjdGlvbigpO1xuICAgIHVwZGF0ZURpc2NvcmRTZWN0aW9uKCk7XG59XG5leHBvcnRzLnNob3dBY2NvdW50U2VjdGlvbiA9IHNob3dBY2NvdW50U2VjdGlvbjtcbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICBPYmplY3Qua2V5cyhleHBvcnRzLmdyb3VwcykuZm9yRWFjaCgoZ3JvdXApID0+IHtcbiAgICAgICAgZXhwb3J0cy5ncm91cHNbZ3JvdXBdLnVwZGF0ZUlucHV0KCk7XG4gICAgfSk7XG4gICAgcmVmcmVzaFRhZ3NTZXR0aW5nc1NlY3Rpb24oKTtcbiAgICByZWZyZXNoUHJlc2V0c1NldHRpbmdzU2VjdGlvbigpO1xuICAgIC8vIExhbmd1YWdlUGlja2VyLnNldEFjdGl2ZUdyb3VwKCk7IFNoaWZ0ZWQgZnJvbSBncm91cGVkIGJ0bnMgdG8gY29tYm8tYm94XG4gICAgc2V0QWN0aXZlRnVuYm94QnV0dG9uKCk7XG4gICAgVGhlbWVQaWNrZXIudXBkYXRlQWN0aXZlVGFiKHRydWUpO1xuICAgIFRoZW1lUGlja2VyLnNldEN1c3RvbUlucHV0cyh0cnVlKTtcbiAgICB1cGRhdGVEaXNjb3JkU2VjdGlvbigpO1xuICAgIHVwZGF0ZUF1dGhTZWN0aW9ucygpO1xuICAgIC8vIFRoZW1lUGlja2VyLnVwZGF0ZUFjdGl2ZUJ1dHRvbigpO1xuICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnBhY2VDYXJldCBpbnB1dC5jdXN0b21QYWNlQ2FyZXRTcGVlZFwiKS52YWwoY29uZmlnXzEuZGVmYXVsdC5wYWNlQ2FyZXRDdXN0b21TcGVlZCk7XG4gICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubWluV3BtIGlucHV0LmN1c3RvbU1pbldwbVNwZWVkXCIpLnZhbChjb25maWdfMS5kZWZhdWx0Lm1pbldwbUN1c3RvbVNwZWVkKTtcbiAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5taW5BY2MgaW5wdXQuY3VzdG9tTWluQWNjXCIpLnZhbChjb25maWdfMS5kZWZhdWx0Lm1pbkFjY0N1c3RvbSk7XG4gICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubWluQnVyc3QgaW5wdXQuY3VzdG9tTWluQnVyc3RcIikudmFsKGNvbmZpZ18xLmRlZmF1bHQubWluQnVyc3RDdXN0b21TcGVlZCk7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYXV0b1N3aXRjaFRoZW1lKSB7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmF1dG9Td2l0Y2hUaGVtZUlucHV0c1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmF1dG9Td2l0Y2hUaGVtZUlucHV0c1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tQmFja2dyb3VuZCAhPT0gXCJcIikge1xuICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kRmlsdGVyXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uY3VzdG9tQmFja2dyb3VuZEZpbHRlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG59XG5leHBvcnRzLnVwZGF0ZSA9IHVwZGF0ZTtcbmZ1bmN0aW9uIHRvZ2dsZVNldHRpbmdzR3JvdXAoZ3JvdXBOYW1lKSB7XG4gICAgJChgLnBhZ2VTZXR0aW5ncyAuc2V0dGluZ3NHcm91cC4ke2dyb3VwTmFtZX1gKVxuICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAuc2xpZGVUb2dnbGUoMjUwKVxuICAgICAgICAudG9nZ2xlQ2xhc3MoXCJzbGlkZXVwXCIpO1xuICAgIGlmICgkKGAucGFnZVNldHRpbmdzIC5zZXR0aW5nc0dyb3VwLiR7Z3JvdXBOYW1lfWApLmhhc0NsYXNzKFwic2xpZGV1cFwiKSkge1xuICAgICAgICAkKGAucGFnZVNldHRpbmdzIC5zZWN0aW9uR3JvdXBUaXRsZVtncm91cD0ke2dyb3VwTmFtZX1dIC5mYXNgKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIGRlZzogLTkwLFxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBkdXJhdGlvbjogMjUwLFxuICAgICAgICAgICAgc3RlcDogZnVuY3Rpb24gKG5vdykge1xuICAgICAgICAgICAgICAgICQodGhpcykuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOiBcInJvdGF0ZShcIiArIG5vdyArIFwiZGVnKVwiLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKGAucGFnZVNldHRpbmdzIC5zZWN0aW9uR3JvdXBUaXRsZVtncm91cD0ke2dyb3VwTmFtZX1dIC5mYXNgKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIGRlZzogMCxcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgZHVyYXRpb246IDI1MCxcbiAgICAgICAgICAgIHN0ZXA6IGZ1bmN0aW9uIChub3cpIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogXCJyb3RhdGUoXCIgKyBub3cgKyBcImRlZylcIixcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiQoZG9jdW1lbnQpLm9uKFwiZm9jdXNvdXRcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnBhY2VDYXJldCBpbnB1dC5jdXN0b21QYWNlQ2FyZXRTcGVlZFwiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnNldFBhY2VDYXJldEN1c3RvbVNwZWVkKHBhcnNlSW50KCQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnBhY2VDYXJldCBpbnB1dC5jdXN0b21QYWNlQ2FyZXRTcGVlZFwiKS52YWwoKSkpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5wYWNlQ2FyZXQgLmJ1dHRvbi5zYXZlXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0UGFjZUNhcmV0Q3VzdG9tU3BlZWQocGFyc2VJbnQoJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ucGFjZUNhcmV0IGlucHV0LmN1c3RvbVBhY2VDYXJldFNwZWVkXCIpLnZhbCgpKSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiZm9jdXNvdXRcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLm1pbldwbSBpbnB1dC5jdXN0b21NaW5XcG1TcGVlZFwiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnNldE1pbldwbUN1c3RvbVNwZWVkKHBhcnNlSW50KCQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLm1pbldwbSBpbnB1dC5jdXN0b21NaW5XcG1TcGVlZFwiKS52YWwoKSkpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5taW5XcG0gLmJ1dHRvbi5zYXZlXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0TWluV3BtQ3VzdG9tU3BlZWQocGFyc2VJbnQoJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubWluV3BtIGlucHV0LmN1c3RvbU1pbldwbVNwZWVkXCIpLnZhbCgpKSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiZm9jdXNvdXRcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLm1pbkFjYyBpbnB1dC5jdXN0b21NaW5BY2NcIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRNaW5BY2NDdXN0b20ocGFyc2VJbnQoJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubWluQWNjIGlucHV0LmN1c3RvbU1pbkFjY1wiKS52YWwoKSkpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5taW5BY2MgLmJ1dHRvbi5zYXZlXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0TWluQWNjQ3VzdG9tKHBhcnNlSW50KCQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLm1pbkFjYyBpbnB1dC5jdXN0b21NaW5BY2NcIikudmFsKCkpKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJmb2N1c291dFwiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubWluQnVyc3QgaW5wdXQuY3VzdG9tTWluQnVyc3RcIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRNaW5CdXJzdEN1c3RvbVNwZWVkKHBhcnNlSW50KCQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLm1pbkJ1cnN0IGlucHV0LmN1c3RvbU1pbkJ1cnN0XCIpLnZhbCgpKSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLm1pbkJ1cnN0IC5idXR0b24uc2F2ZVwiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnNldE1pbkJ1cnN0Q3VzdG9tU3BlZWQocGFyc2VJbnQoJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubWluQnVyc3QgaW5wdXQuY3VzdG9tTWluQnVyc3RcIikudmFsKCkpKTtcbn0pO1xuLy8gQ29tbWVudGVkIGJlY2F1c2Ugc3RhcnRlZCB1c2luZyBjb21iby1ib3ggZm9yIGNob29zaW5nIGxhbmd1YWdlcyBpbnN0ZWFkIG9mIGdyb3VwZWQgYnV0dG9uc1xuLy8gbGFuZ3VhZ2VzXG4vLyAkKGRvY3VtZW50KS5vbihcbi8vICAgXCJjbGlja1wiLFxuLy8gICBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ubGFuZ3VhZ2VHcm91cHMgLmJ1dHRvblwiLFxuLy8gICAoZSkgPT4ge1xuLy8gICAgIGNvbnN0IGdyb3VwID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJncm91cFwiKTtcbi8vICAgICBMYW5ndWFnZVBpY2tlci5zZXRBY3RpdmVHcm91cChncm91cCwgdHJ1ZSk7XG4vLyAgIH1cbi8vICk7XG4vL2Z1bmJveFxuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZnVuYm94IC5idXR0b25cIiwgKGUpID0+IHtcbiAgICBjb25zdCBmdW5ib3ggPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcImZ1bmJveFwiKTtcbiAgICBjb25zdCB0eXBlID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJ0eXBlXCIpO1xuICAgIEZ1bmJveC5zZXRGdW5ib3goZnVuYm94LCB0eXBlKTtcbiAgICBzZXRBY3RpdmVGdW5ib3hCdXR0b24oKTtcbn0pO1xuLy90YWdzXG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50YWdzIC50YWdzTGlzdCAudGFnIC50YWdCdXR0b25cIiwgKGUpID0+IHtcbiAgICBjb25zdCB0YXJnZXQgPSBlLmN1cnJlbnRUYXJnZXQ7XG4gICAgY29uc3QgdGFnaWQgPSAkKHRhcmdldCkucGFyZW50KFwiLnRhZ1wiKS5hdHRyKFwiaWRcIik7XG4gICAgVGFnQ29udHJvbGxlci50b2dnbGUodGFnaWQpO1xuICAgICQodGFyZ2V0KS50b2dnbGVDbGFzcyhcImFjdGl2ZVwiKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24ucHJlc2V0cyAucHJlc2V0c0xpc3QgLnByZXNldCAucHJlc2V0QnV0dG9uXCIsIChlKSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0O1xuICAgIGNvbnN0IHByZXNldGlkID0gJCh0YXJnZXQpLnBhcmVudChcIi5wcmVzZXRcIikuYXR0cihcImlkXCIpO1xuICAgIGNvbnNvbGUubG9nKFwiQXBwbHlpbmcgUHJlc2V0XCIpO1xuICAgIGNvbmZpZ0V2ZW50RGlzYWJsZWQgPSB0cnVlO1xuICAgIFByZXNldENvbnRyb2xsZXIuYXBwbHkocHJlc2V0aWQpO1xuICAgIGNvbmZpZ0V2ZW50RGlzYWJsZWQgPSBmYWxzZTtcbiAgICB1cGRhdGUoKTtcbn0pO1xuJChcIiNpbXBvcnRTZXR0aW5nc0J1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBJbXBvcnRFeHBvcnRTZXR0aW5nc1BvcHVwLnNob3coXCJpbXBvcnRcIik7XG59KTtcbiQoXCIjZXhwb3J0U2V0dGluZ3NCdXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY29uc3QgY29uZmlnSlNPTiA9IEpTT04uc3RyaW5naWZ5KGNvbmZpZ18xLmRlZmF1bHQpO1xuICAgIG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGNvbmZpZ0pTT04pLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkpTT04gQ29waWVkIHRvIGNsaXBib2FyZFwiLCAwKTtcbiAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIEltcG9ydEV4cG9ydFNldHRpbmdzUG9wdXAuc2hvdyhcImV4cG9ydFwiKTtcbiAgICB9KTtcbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb25Hcm91cFRpdGxlXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICB0b2dnbGVTZXR0aW5nc0dyb3VwKCQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiZ3JvdXBcIikpO1xufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5hcGVLZXlzICNzaG93QXBlS2V5c1BvcHVwXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIEFwZUtleXNQb3B1cC5zaG93KCk7XG59KTtcbiQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmN1c3RvbUJhY2tncm91bmRTaXplIC5pbnB1dEFuZEJ1dHRvbiAuc2F2ZVwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tQmFja2dyb3VuZCgkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kU2l6ZSAuaW5wdXRBbmRCdXR0b24gaW5wdXRcIikudmFsKCkpO1xufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kU2l6ZSAuaW5wdXRBbmRCdXR0b24gaW5wdXRcIikua2V5cHJlc3MoKGUpID0+IHtcbiAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tQmFja2dyb3VuZCgkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5jdXN0b21CYWNrZ3JvdW5kU2l6ZSAuaW5wdXRBbmRCdXR0b24gaW5wdXRcIikudmFsKCkpO1xuICAgIH1cbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uY3VzdG9tTGF5b3V0Zmx1aWQgLmlucHV0QW5kQnV0dG9uIC5zYXZlXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21MYXlvdXRmbHVpZCgkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5jdXN0b21MYXlvdXRmbHVpZCAuaW5wdXRBbmRCdXR0b24gaW5wdXRcIikudmFsKCkpLnRoZW4oKGJvb2wpID0+IHtcbiAgICAgICAgaWYgKGJvb2wpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ3VzdG9tIGxheW91dGZsdWlkIHNhdmVkXCIsIDEpO1xuICAgICAgICB9XG4gICAgfSk7XG59KTtcbiQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLmN1c3RvbUxheW91dGZsdWlkIC5pbnB1dEFuZEJ1dHRvbiAuaW5wdXRcIikua2V5cHJlc3MoKGUpID0+IHtcbiAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tTGF5b3V0Zmx1aWQoJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uY3VzdG9tTGF5b3V0Zmx1aWQgLmlucHV0QW5kQnV0dG9uIGlucHV0XCIpLnZhbCgpKS50aGVuKChib29sKSA9PiB7XG4gICAgICAgICAgICBpZiAoYm9vbCkge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ3VzdG9tIGxheW91dGZsdWlkIHNhdmVkXCIsIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59KTtcbiQoXCIucXVpY2tOYXYgLmxpbmtzIGFcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGNvbnN0IHNldHRpbmdzR3JvdXAgPSBlLnRhcmdldC5pbm5lclRleHQ7XG4gICAgY29uc3QgaXNPcGVuID0gJChgLnBhZ2VTZXR0aW5ncyAuc2V0dGluZ3NHcm91cC4ke3NldHRpbmdzR3JvdXB9YCkuaGFzQ2xhc3MoXCJzbGlkZXVwXCIpO1xuICAgIGlzT3BlbiAmJiB0b2dnbGVTZXR0aW5nc0dyb3VwKHNldHRpbmdzR3JvdXApO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNoYW5nZVwiLCBgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5hdXRvU3dpdGNoVGhlbWVJbnB1dHMgc2VsZWN0LmxpZ2h0YCwgKGUpID0+IHtcbiAgICBjb25zdCB0YXJnZXQgPSAkKGUuY3VycmVudFRhcmdldCk7XG4gICAgaWYgKHRhcmdldC5oYXNDbGFzcyhcImRpc2FibGVkXCIpIHx8IHRhcmdldC5oYXNDbGFzcyhcIm5vLWF1dG8taGFuZGxlXCIpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgVXBkYXRlQ29uZmlnLnNldFRoZW1lTGlnaHQodGFyZ2V0LnZhbCgpKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjaGFuZ2VcIiwgYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uYXV0b1N3aXRjaFRoZW1lSW5wdXRzIHNlbGVjdC5kYXJrYCwgKGUpID0+IHtcbiAgICBjb25zdCB0YXJnZXQgPSAkKGUuY3VycmVudFRhcmdldCk7XG4gICAgaWYgKHRhcmdldC5oYXNDbGFzcyhcImRpc2FibGVkXCIpIHx8IHRhcmdldC5oYXNDbGFzcyhcIm5vLWF1dG8taGFuZGxlXCIpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgVXBkYXRlQ29uZmlnLnNldFRoZW1lRGFyayh0YXJnZXQudmFsKCkpO1xufSk7XG5sZXQgY29uZmlnRXZlbnREaXNhYmxlZCA9IGZhbHNlO1xuZnVuY3Rpb24gc2V0RXZlbnREaXNhYmxlZCh2YWx1ZSkge1xuICAgIGNvbmZpZ0V2ZW50RGlzYWJsZWQgPSB2YWx1ZTtcbn1cbmV4cG9ydHMuc2V0RXZlbnREaXNhYmxlZCA9IHNldEV2ZW50RGlzYWJsZWQ7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5KSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImZ1bGxDb25maWdDaGFuZ2VcIilcbiAgICAgICAgc2V0RXZlbnREaXNhYmxlZCh0cnVlKTtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiZnVsbENvbmZpZ0NoYW5nZUZpbmlzaGVkXCIpIHtcbiAgICAgICAgc2V0RXZlbnREaXNhYmxlZChmYWxzZSk7XG4gICAgfVxuICAgIGlmIChjb25maWdFdmVudERpc2FibGVkIHx8IGV2ZW50S2V5ID09PSBcInNhdmVUb0xvY2FsU3RvcmFnZVwiKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT09IFwic2V0dGluZ3NcIiAmJiBldmVudEtleSAhPT0gXCJ0aGVtZVwiKSB7XG4gICAgICAgIHVwZGF0ZSgpO1xuICAgIH1cbn0pO1xuZXhwb3J0cy5wYWdlID0gbmV3IHBhZ2VfMS5kZWZhdWx0KFwic2V0dGluZ3NcIiwgJChcIi5wYWdlLnBhZ2VTZXR0aW5nc1wiKSwgXCIvc2V0dGluZ3NcIiwgKCkgPT4ge1xuICAgIC8vXG59LCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICByZXNldCgpO1xufSksICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHlpZWxkIGZpbGxTZXR0aW5nc1BhZ2UoKTtcbiAgICB1cGRhdGUoKTtcbn0pLCAoKSA9PiB7XG4gICAgLy9cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5wYWdlID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBUZXN0U3RhdHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC1zdGF0c1wiKSk7XG5jb25zdCBUZXN0VUkgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC11aVwiKSk7XG5jb25zdCBNYW51YWxSZXN0YXJ0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L21hbnVhbC1yZXN0YXJ0LXRyYWNrZXJcIikpO1xuY29uc3QgVGVzdENvbmZpZyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LWNvbmZpZ1wiKSk7XG5jb25zdCBUZXN0TG9naWMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC1sb2dpY1wiKSk7XG5jb25zdCBGdW5ib3ggPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvZnVuYm94XCIpKTtcbmNvbnN0IHBhZ2VfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi9wYWdlXCIpKTtcbmV4cG9ydHMucGFnZSA9IG5ldyBwYWdlXzEuZGVmYXVsdChcInRlc3RcIiwgJChcIi5wYWdlLnBhZ2VUZXN0XCIpLCBcIi9cIiwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICBGdW5ib3guY2xlYXIoKTtcbiAgICBUZXN0Q29uZmlnLmhpZGUoKTtcbiAgICAkKFwiI3dvcmRzSW5wdXRcIikuZm9jdXNvdXQoKTtcbn0pLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAvL1xufSksICgpID0+IHtcbiAgICBUZXN0Q29uZmlnLnNob3coKTtcbiAgICBUZXN0U3RhdHMucmVzZXRJbmNvbXBsZXRlKCk7XG4gICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICBUZXN0TG9naWMucmVzdGFydCh1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHRydWUpO1xuICAgIEZ1bmJveC5hY3RpdmF0ZShjb25maWdfMS5kZWZhdWx0LmZ1bmJveCk7XG59LCAoKSA9PiB7XG4gICAgVGVzdFVJLmZvY3VzV29yZHMoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zaG93ID0gZXhwb3J0cy5oaWRlID0gdm9pZCAwO1xuY29uc3QgYXBlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2FwZVwiKSk7XG5jb25zdCBMb2FkZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2xvYWRlclwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IGZvcm1hdF8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJkYXRlLWZucy9mb3JtYXRcIikpO1xubGV0IGFwZUtleXMgPSB7fTtcbmZ1bmN0aW9uIGdldERhdGEoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgTG9hZGVyLnNob3coKTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LmFwZUtleXMuZ2V0KCk7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJFcnJvciBnZXR0aW5nIGFwZSBrZXlzOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgYXBlS2V5cyA9IHJlc3BvbnNlLmRhdGE7XG4gICAgfSk7XG59XG5mdW5jdGlvbiByZWZyZXNoTGlzdCgpIHtcbiAgICBjb25zdCBkYXRhID0gYXBlS2V5cztcbiAgICBpZiAoIWRhdGEpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCB0YWJsZSA9ICQoXCIjYXBlS2V5c1BvcHVwV3JhcHBlciB0YWJsZSB0Ym9keVwiKTtcbiAgICB0YWJsZS5lbXB0eSgpO1xuICAgIGNvbnN0IGFwZUtleUlkcyA9IE9iamVjdC5rZXlzKGRhdGEpO1xuICAgIGlmIChhcGVLZXlJZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRhYmxlLmFwcGVuZChcIjx0cj48dGQgY29sc3Bhbj0nNicgc3R5bGU9J3RleHQtYWxpZ246IGNlbnRlcjsnPk5vIGtleXMgZm91bmQ8L3RkPjwvdHI+XCIpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGFwZUtleUlkcy5mb3JFYWNoKChhcGVLZXlJZCkgPT4ge1xuICAgICAgICBjb25zdCBrZXkgPSBkYXRhW2FwZUtleUlkXTtcbiAgICAgICAgdGFibGUuYXBwZW5kKGBcbiAgICAgIDx0ciBrZXlJZD1cIiR7YXBlS2V5SWR9XCI+XG4gICAgICAgIDx0ZD5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiaWNvbi1idXR0b25cIj5cbiAgICAgICAgICAgICR7a2V5LmVuYWJsZWRcbiAgICAgICAgICAgID8gYDxpIGNsYXNzPVwiZmFzIGZhLWNoZWNrLXNxdWFyZVwiPjwvaT5gXG4gICAgICAgICAgICA6IGA8aSBjbGFzcz1cImZhciBmYS1mdyBmYS1zcXVhcmVcIj48L2k+YH1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC90ZD5cbiAgICAgICAgPHRkPiR7a2V5Lm5hbWV9PC90ZD5cbiAgICAgICAgPHRkPiR7KDAsIGZvcm1hdF8xLmRlZmF1bHQpKG5ldyBEYXRlKGtleS5jcmVhdGVkT24pLCBcImRkIE1NTSB5eXl5IEhIOm1tXCIpfTwvdGQ+XG4gICAgICAgIDx0ZD4keygwLCBmb3JtYXRfMS5kZWZhdWx0KShuZXcgRGF0ZShrZXkubW9kaWZpZWRPbiksIFwiZGQgTU1NIHl5eXkgSEg6bW1cIil9PC90ZD5cbiAgICAgICAgPHRkPiR7a2V5Lmxhc3RVc2VkT24gPT09IC0xXG4gICAgICAgICAgICA/IFwiLVwiXG4gICAgICAgICAgICA6ICgwLCBmb3JtYXRfMS5kZWZhdWx0KShuZXcgRGF0ZShrZXkubGFzdFVzZWRPbiksIFwiZGQgTU1NIHl5eXkgSEg6bW1cIil9PC90ZD5cbiAgICAgICAgPHRkPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJrZXlCdXR0b25zXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYnV0dG9uIGVkaXRcIj5cbiAgICAgICAgICAgICAgPGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtcGVuXCI+PC9pPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYnV0dG9uIGRlbGV0ZVwiPlxuICAgICAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS10cmFzaC1hbHRcIj48L2k+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC90ZD5cbiAgICAgIDwvdHI+XG4gICAgYCk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmICghJChcIiNhcGVLZXlzUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjYXBlS2V5c1BvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjYXBlS2V5c1BvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbi8vc2hvdyB0aGUgcG9wdXBcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCQoXCIjYXBlS2V5c1BvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAgICAgeWllbGQgZ2V0RGF0YSgpO1xuICAgICAgICAgICAgcmVmcmVzaExpc3QoKTtcbiAgICAgICAgICAgICQoXCIjYXBlS2V5c1BvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICQoXCIjYXBlS2V5c1BvcHVwIHRleHRhcmVhXCIpLnRyaWdnZXIoXCJmb2N1c1wiKS5zZWxlY3QoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuJChcIiNhcGVLZXlzUG9wdXBXcmFwcGVyXCIpLm9uKFwibW91c2Vkb3duXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJhcGVLZXlzUG9wdXBXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuJChcIiNhcGVLZXlzUG9wdXAgLmdlbmVyYXRlQXBlS2V5XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGhpZGUoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNhcGVLZXlzUG9wdXAgdGFibGUgLmtleUJ1dHRvbnMgLmJ1dHRvblwiLCAoKSA9PiB7XG4gICAgaGlkZSgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI2FwZUtleXNQb3B1cCB0YWJsZSAuaWNvbi1idXR0b25cIiwgKGUpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIGNvbnN0IGtleUlkID0gJChlLnRhcmdldCkuY2xvc2VzdChcInRyXCIpLmF0dHIoXCJrZXlJZFwiKTtcbiAgICBjb25zdCBrZXkgPSBhcGVLZXlzID09PSBudWxsIHx8IGFwZUtleXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFwZUtleXNba2V5SWRdO1xuICAgIGlmICgha2V5IHx8ICFhcGVLZXlzKVxuICAgICAgICByZXR1cm47XG4gICAgTG9hZGVyLnNob3coKTtcbiAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQuYXBlS2V5cy51cGRhdGUoa2V5SWQsIHsgZW5hYmxlZDogIWtleS5lbmFibGVkIH0pO1xuICAgIExvYWRlci5oaWRlKCk7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byB1cGRhdGUga2V5OiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICB9XG4gICAgYXBlS2V5c1trZXlJZF0uZW5hYmxlZCA9ICFrZXkuZW5hYmxlZDtcbiAgICByZWZyZXNoTGlzdCgpO1xuICAgIGlmIChrZXkuZW5hYmxlZCkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIktleSBhY3RpdmVcIiwgMSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIktleSBpbmFjdGl2ZVwiLCAxKTtcbiAgICB9XG59KSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbiQoZG9jdW1lbnQuYm9keSkub24oXCJjbGlja1wiLCBcIiNjb250YWN0UG9wdXBCdXR0b25cIiwgKCkgPT4ge1xuICAgICQoXCIjY29udGFjdFBvcHVwV3JhcHBlclwiKVxuICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEyNSk7XG59KTtcbiQoZG9jdW1lbnQuYm9keSkub24oXCJjbGlja1wiLCBcIiNjb250YWN0UG9wdXBXcmFwcGVyXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJjb250YWN0UG9wdXBXcmFwcGVyXCIpIHtcbiAgICAgICAgJChcIiNjb250YWN0UG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAwIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNjb250YWN0UG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmhpZGUgPSBleHBvcnRzLnNob3cgPSB2b2lkIDA7XG5jb25zdCBVcGRhdGVDb25maWcgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBNYW51YWxSZXN0YXJ0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L21hbnVhbC1yZXN0YXJ0LXRyYWNrZXJcIikpO1xuY29uc3QgVGVzdExvZ2ljID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtbG9naWNcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5mdW5jdGlvbiBwYXJzZUlucHV0KGlucHV0KSB7XG4gICAgY29uc3QgcmUgPSAvKCgtXFxzKik/XFxkKyhcXC5cXGQrKT9cXHMqW2htc10/KS9nO1xuICAgIGNvbnN0IHNlY29uZHMgPSBbLi4uaW5wdXQudG9Mb3dlckNhc2UoKS5tYXRjaEFsbChyZSldXG4gICAgICAgIC5tYXAoKG1hdGNoKSA9PiB7XG4gICAgICAgIGNvbnN0IHBhcnQgPSBtYXRjaFswXTtcbiAgICAgICAgY29uc3QgZHVyYXRpb24gPSBwYXJzZUZsb2F0KHBhcnQucmVwbGFjZSgvXFxzKy9nLCBcIlwiKSk7XG4gICAgICAgIGlmIChwYXJ0LmluY2x1ZGVzKFwiaFwiKSkge1xuICAgICAgICAgICAgcmV0dXJuIDM2MDAgKiBkdXJhdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChwYXJ0LmluY2x1ZGVzKFwibVwiKSkge1xuICAgICAgICAgICAgcmV0dXJuIDYwICogZHVyYXRpb247XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZHVyYXRpb247XG4gICAgICAgIH1cbiAgICB9KVxuICAgICAgICAucmVkdWNlKCh0b3RhbCwgZHVyKSA9PiB0b3RhbCArIGR1ciwgMCk7XG4gICAgcmV0dXJuIE1hdGguZmxvb3Ioc2Vjb25kcyk7XG59XG5mdW5jdGlvbiBmb3JtYXQoZHVyYXRpb24pIHtcbiAgICBjb25zdCBob3VycyA9IE1hdGguZmxvb3IoZHVyYXRpb24gLyAzNjAwKTtcbiAgICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcigoZHVyYXRpb24gJSAzNjAwKSAvIDYwKTtcbiAgICBjb25zdCBzZWNvbmRzID0gKGR1cmF0aW9uICUgMzYwMCkgJSA2MDtcbiAgICBjb25zdCB0aW1lID0gW107XG4gICAgaWYgKGhvdXJzID4gMCkge1xuICAgICAgICB0aW1lLnB1c2goYCR7aG91cnN9IGhvdXIke2hvdXJzID09PSAxID8gXCJcIiA6IFwic1wifWApO1xuICAgIH1cbiAgICBpZiAobWludXRlcyA+IDApIHtcbiAgICAgICAgdGltZS5wdXNoKGAke21pbnV0ZXN9IG1pbnV0ZSR7bWludXRlcyA9PT0gMSA/IFwiXCIgOiBcInNcIn1gKTtcbiAgICB9XG4gICAgaWYgKHNlY29uZHMgPiAwKSB7XG4gICAgICAgIHRpbWUucHVzaChgJHtzZWNvbmRzfSBzZWNvbmQke3NlY29uZHMgPT09IDEgPyBcIlwiIDogXCJzXCJ9YCk7XG4gICAgfVxuICAgIGlmICh0aW1lLmxlbmd0aCA9PT0gMykge1xuICAgICAgICByZXR1cm4gYCR7dGltZVswXX0sICR7dGltZVsxXX0gYW5kICR7dGltZVsyXX1gO1xuICAgIH1cbiAgICBlbHNlIGlmICh0aW1lLmxlbmd0aCA9PT0gMikge1xuICAgICAgICByZXR1cm4gYCR7dGltZVswXX0gYW5kICR7dGltZVsxXX1gO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGAke3RpbWVbMF19YDtcbiAgICB9XG59XG5mdW5jdGlvbiBwcmV2aWV3RHVyYXRpb24oKSB7XG4gICAgY29uc3QgaW5wdXQgPSAkKFwiI2N1c3RvbVRlc3REdXJhdGlvblBvcHVwIGlucHV0XCIpLnZhbCgpO1xuICAgIGNvbnN0IGR1cmF0aW9uID0gcGFyc2VJbnB1dChpbnB1dCk7XG4gICAgbGV0IGZvcm1hdHRlZER1cmF0aW9uID0gXCJcIjtcbiAgICBpZiAoZHVyYXRpb24gPCAwKSB7XG4gICAgICAgIGZvcm1hdHRlZER1cmF0aW9uID0gXCJORUdBVElWRSBUSU1FXCI7XG4gICAgfVxuICAgIGVsc2UgaWYgKGR1cmF0aW9uID09IDApIHtcbiAgICAgICAgZm9ybWF0dGVkRHVyYXRpb24gPSBcIkluZmluaXRlIHRlc3RcIjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGZvcm1hdHRlZER1cmF0aW9uID0gXCJUb3RhbCB0aW1lOiBcIiArIGZvcm1hdChkdXJhdGlvbik7XG4gICAgfVxuICAgICQoXCIjY3VzdG9tVGVzdER1cmF0aW9uUG9wdXAgLnByZXZpZXdcIikudGV4dChmb3JtYXR0ZWREdXJhdGlvbik7XG59XG5mdW5jdGlvbiBzaG93KCkge1xuICAgIGlmICgkKFwiI2N1c3RvbVRlc3REdXJhdGlvblBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI2N1c3RvbVRlc3REdXJhdGlvblBvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjY3VzdG9tVGVzdER1cmF0aW9uUG9wdXAgaW5wdXRcIikudHJpZ2dlcihcImZvY3VzXCIpLnNlbGVjdCgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcHJldmlld0R1cmF0aW9uKCk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICBpZiAoISQoXCIjY3VzdG9tVGVzdER1cmF0aW9uUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjY3VzdG9tVGVzdER1cmF0aW9uUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNjdXN0b21UZXN0RHVyYXRpb25Qb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG5mdW5jdGlvbiBhcHBseSgpIHtcbiAgICBjb25zdCB2YWwgPSBwYXJzZUlucHV0KCQoXCIjY3VzdG9tVGVzdER1cmF0aW9uUG9wdXAgaW5wdXRcIikudmFsKCkpO1xuICAgIGlmICh2YWwgIT09IG51bGwgJiYgIWlzTmFOKHZhbCkgJiYgdmFsID49IDApIHtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVDb25maWcodmFsKTtcbiAgICAgICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICAgICAgaWYgKHZhbCA+PSAxODAwKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlN0YXkgc2FmZSBhbmQgdGFrZSBicmVha3MhXCIsIDApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHZhbCA9PSAwKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkluZmluaXRlIHRpbWUhIE1ha2Ugc3VyZSB0byB1c2UgQmFpbCBPdXQgZnJvbSB0aGUgY29tbWFuZCBsaW5lIHRvIHNhdmUgeW91ciByZXN1bHQuXCIsIDAsIDcpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkN1c3RvbSB0aW1lIG11c3QgYmUgYXQgbGVhc3QgMVwiLCAwKTtcbiAgICB9XG4gICAgaGlkZSgpO1xufVxuJChcIiNjdXN0b21UZXN0RHVyYXRpb25Qb3B1cFdyYXBwZXJcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwiY3VzdG9tVGVzdER1cmF0aW9uUG9wdXBXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuJChcIiNjdXN0b21UZXN0RHVyYXRpb25Qb3B1cCBpbnB1dFwiKS5rZXl1cCgoZSkgPT4ge1xuICAgIHByZXZpZXdEdXJhdGlvbigpO1xuICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIGFwcGx5KCk7XG4gICAgfVxufSk7XG4kKFwiI2N1c3RvbVRlc3REdXJhdGlvblBvcHVwIC5idXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgYXBwbHkoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0b3AgLmNvbmZpZyAudGltZSAudGV4dC1idXR0b25cIiwgKGUpID0+IHtcbiAgICBjb25zdCBtb2RlID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJ0aW1lQ29uZmlnXCIpO1xuICAgIGlmIChtb2RlID09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgc2hvdygpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudCkub24oXCJrZXlkb3duXCIsIChldmVudCkgPT4ge1xuICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIgJiZcbiAgICAgICAgISQoXCIjY3VzdG9tVGVzdER1cmF0aW9uUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmlzVmlzaWJsZSA9IGV4cG9ydHMuaGlkZSA9IGV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmNvbnN0IEN1c3RvbVRleHQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvY3VzdG9tLXRleHRcIikpO1xuY29uc3QgTWFudWFsUmVzdGFydCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9tYW51YWwtcmVzdGFydC10cmFja2VyXCIpKTtcbmNvbnN0IFRlc3RMb2dpYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LWxvZ2ljXCIpKTtcbmNvbnN0IENoYWxsZW5nZUNvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL2NoYWxsZW5nZS1jb250cm9sbGVyXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpLCBVcGRhdGVDb25maWcgPSBjb25maWdfMTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgV29yZEZpbHRlclBvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3dvcmQtZmlsdGVyLXBvcHVwXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgU2F2ZWRUZXh0c1BvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3NhdmVkLXRleHRzLXBvcHVwXCIpKTtcbmNvbnN0IHdyYXBwZXIgPSBcIiNjdXN0b21UZXh0UG9wdXBXcmFwcGVyXCI7XG5jb25zdCBwb3B1cCA9IFwiI2N1c3RvbVRleHRQb3B1cFwiO1xuZnVuY3Rpb24gc2hvdygpIHtcbiAgICBpZiAoJCh3cmFwcGVyKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICBpZiAoJChgJHtwb3B1cH0gLmNoZWNrYm94IGlucHV0YCkucHJvcChcImNoZWNrZWRcIikpIHtcbiAgICAgICAgICAgICQoYCR7cG9wdXB9IC5pbnB1dHMgLnJhbmRvbUlucHV0RmllbGRzYCkucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKGAke3BvcHVwfSAuaW5wdXRzIC5yYW5kb21JbnB1dEZpZWxkc2ApLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgICQod3JhcHBlcilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgbmV3dGV4dCA9IEN1c3RvbVRleHQudGV4dC5qb2luKEN1c3RvbVRleHQuZGVsaW1pdGVyKTtcbiAgICAgICAgICAgIG5ld3RleHQgPSBuZXd0ZXh0LnJlcGxhY2UoL1xcbiAvZywgXCJcXG5cIik7XG4gICAgICAgICAgICAkKGAke3BvcHVwfSB0ZXh0YXJlYWApLnZhbChuZXd0ZXh0KTtcbiAgICAgICAgICAgICQoYCR7cG9wdXB9IC53b3JkY291bnQgaW5wdXRgKS52YWwoQ3VzdG9tVGV4dC53b3JkID09PSAtMSA/IFwiXCIgOiBDdXN0b21UZXh0LndvcmQpO1xuICAgICAgICAgICAgJChgJHtwb3B1cH0gLnRpbWUgaW5wdXRgKS52YWwoQ3VzdG9tVGV4dC50aW1lID09PSAtMSA/IFwiXCIgOiBDdXN0b21UZXh0LnRpbWUpO1xuICAgICAgICAgICAgJChgJHtwb3B1cH0gdGV4dGFyZWFgKS50cmlnZ2VyKFwiZm9jdXNcIik7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgJChgJHtwb3B1cH0gdGV4dGFyZWFgKS50cmlnZ2VyKFwiZm9jdXNcIik7XG4gICAgfSwgMTUwKTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG4kKGAke3BvcHVwfSAuZGVsaW1pdGVyQ2hlY2sgaW5wdXRgKS5jaGFuZ2UoKCkgPT4ge1xuICAgIGxldCBkZWxpbWl0ZXI7XG4gICAgaWYgKCQoYCR7cG9wdXB9IC5kZWxpbWl0ZXJDaGVjayBpbnB1dGApLnByb3AoXCJjaGVja2VkXCIpKSB7XG4gICAgICAgIGRlbGltaXRlciA9IFwifFwiO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZGVsaW1pdGVyID0gXCIgXCI7XG4gICAgfVxuICAgIGlmICgkKGAke3BvcHVwfSB0ZXh0YXJlYWApLnZhbCgpICE9IEN1c3RvbVRleHQudGV4dC5qb2luKEN1c3RvbVRleHQuZGVsaW1pdGVyKSkge1xuICAgICAgICBjb25zdCBjdXJyZW50VGV4dCA9ICQoYCR7cG9wdXB9IHRleHRhcmVhYCkudmFsKCk7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRUZXh0U3BsaXQgPSBjdXJyZW50VGV4dC5zcGxpdChDdXN0b21UZXh0LmRlbGltaXRlcik7XG4gICAgICAgIGxldCBuZXd0ZXh0ID0gY3VycmVudFRleHRTcGxpdC5qb2luKGRlbGltaXRlcik7XG4gICAgICAgIG5ld3RleHQgPSBuZXd0ZXh0LnJlcGxhY2UoL1xcbiAvZywgXCJcXG5cIik7XG4gICAgICAgICQoYCR7cG9wdXB9IHRleHRhcmVhYCkudmFsKG5ld3RleHQpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgbGV0IG5ld3RleHQgPSBDdXN0b21UZXh0LnRleHQuam9pbihkZWxpbWl0ZXIpO1xuICAgICAgICBuZXd0ZXh0ID0gbmV3dGV4dC5yZXBsYWNlKC9cXG4gL2csIFwiXFxuXCIpO1xuICAgICAgICAkKGAke3BvcHVwfSB0ZXh0YXJlYWApLnZhbChuZXd0ZXh0KTtcbiAgICB9XG4gICAgQ3VzdG9tVGV4dC5zZXREZWxpbWl0ZXIoZGVsaW1pdGVyKTtcbn0pO1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICBpZiAoISQod3JhcHBlcikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJCh3cmFwcGVyKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQod3JhcHBlcikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG5mdW5jdGlvbiBpc1Zpc2libGUoKSB7XG4gICAgcmV0dXJuICEkKHdyYXBwZXIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpO1xufVxuZXhwb3J0cy5pc1Zpc2libGUgPSBpc1Zpc2libGU7XG4kKHdyYXBwZXIpLm1vdXNlZG93bigoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwiY3VzdG9tVGV4dFBvcHVwV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbiQoYCR7cG9wdXB9IC5pbnB1dHMgLmNoZWNrYm94IGlucHV0YCkuY2hhbmdlKCgpID0+IHtcbiAgICBpZiAoJChgJHtwb3B1cH0gLmNoZWNrYm94IGlucHV0YCkucHJvcChcImNoZWNrZWRcIikpIHtcbiAgICAgICAgJChgJHtwb3B1cH0gLmlucHV0cyAucmFuZG9tSW5wdXRGaWVsZHNgKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoYCR7cG9wdXB9IC5pbnB1dHMgLnJhbmRvbUlucHV0RmllbGRzYCkuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxufSk7XG4kKGAke3BvcHVwfSB0ZXh0YXJlYWApLm9uKFwia2V5cHJlc3NcIiwgKGUpID0+IHtcbiAgICBpZiAoZS5jb2RlID09PSBcIkVudGVyXCIgJiYgZS5jdHJsS2V5KSB7XG4gICAgICAgICQoYCR7cG9wdXB9IC5idXR0b24uYXBwbHlgKS5jbGljaygpO1xuICAgIH1cbn0pO1xuJChgJHtwb3B1cH0gLnJhbmRvbUlucHV0RmllbGRzIC53b3JkY291bnQgaW5wdXRgKS5vbihcImtleXByZXNzXCIsICgpID0+IHtcbiAgICAkKGAke3BvcHVwfSAucmFuZG9tSW5wdXRGaWVsZHMgLnRpbWUgaW5wdXRgKS52YWwoXCJcIik7XG59KTtcbiQoYCR7cG9wdXB9IC5yYW5kb21JbnB1dEZpZWxkcyAudGltZSBpbnB1dGApLm9uKFwia2V5cHJlc3NcIiwgKCkgPT4ge1xuICAgICQoYCR7cG9wdXB9IC5yYW5kb21JbnB1dEZpZWxkcyAud29yZGNvdW50IGlucHV0YCkudmFsKFwiXCIpO1xufSk7XG4kKGAke3BvcHVwfSAuYnV0dG9uc1RvcCAuc2hvd1NhdmVkVGV4dHNgKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBTYXZlZFRleHRzUG9wdXAuc2hvdygpO1xufSk7XG4kKGAke3BvcHVwfSAuYnV0dG9uc1RvcCAuc2F2ZUN1c3RvbVRleHRgKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBoaWRlKCk7XG59KTtcbmZ1bmN0aW9uIGFwcGx5KCkge1xuICAgIGxldCB0ZXh0ID0gJChgJHtwb3B1cH0gdGV4dGFyZWFgKS52YWwoKS5ub3JtYWxpemUoKTtcbiAgICB0ZXh0ID0gdGV4dC50cmltKCk7XG4gICAgLy8gdGV4dCA9IHRleHQucmVwbGFjZSgvW1xccl0vZ20sIFwiIFwiKTtcbiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXFxcXFxcXHQvZ20sIFwiXFx0XCIpO1xuICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcXFxcXFxcbi9nbSwgXCJcXG5cIik7XG4gICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFxcXHQvZ20sIFwiXFx0XCIpO1xuICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcXFxuL2dtLCBcIlxcblwiKTtcbiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC8gKy9nbSwgXCIgXCIpO1xuICAgIC8vIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyhcXHJcXG4pKy9nLCBcIlxcclxcblwiKTtcbiAgICAvLyB0ZXh0ID0gdGV4dC5yZXBsYWNlKC8oXFxuKSsvZywgXCJcXG5cIik7XG4gICAgLy8gdGV4dCA9IHRleHQucmVwbGFjZSgvKFxccikrL2csIFwiXFxyXCIpO1xuICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyggKihcXHJcXG58XFxyfFxcbikgKikvZywgXCJcXG4gXCIpO1xuICAgIGlmICgkKGAke3BvcHVwfSAudHlwb2dyYXBoeUNoZWNrIGlucHV0YCkucHJvcChcImNoZWNrZWRcIikpIHtcbiAgICAgICAgdGV4dCA9IE1pc2MuY2xlYW5UeXBvZ3JhcGh5U3ltYm9scyh0ZXh0KTtcbiAgICB9XG4gICAgLy8gdGV4dCA9IE1pc2MucmVtb3ZlX25vbl9hc2NpaSh0ZXh0KTtcbiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9bXFx1MjA2MF0vZywgXCJcIik7XG4gICAgQ3VzdG9tVGV4dC5zZXRUZXh0KHRleHQuc3BsaXQoQ3VzdG9tVGV4dC5kZWxpbWl0ZXIpKTtcbiAgICBDdXN0b21UZXh0LnNldFdvcmQocGFyc2VJbnQoJChgJHtwb3B1cH0gLndvcmRjb3VudCBpbnB1dGApLnZhbCgpKSB8fCAtMSk7XG4gICAgQ3VzdG9tVGV4dC5zZXRUaW1lKHBhcnNlSW50KCQoYCR7cG9wdXB9IC50aW1lIGlucHV0YCkudmFsKCkpIHx8IC0xKTtcbiAgICBDdXN0b21UZXh0LnNldElzV29yZFJhbmRvbSgkKGAke3BvcHVwfSAuY2hlY2tib3ggaW5wdXRgKS5wcm9wKFwiY2hlY2tlZFwiKSAmJiBDdXN0b21UZXh0LndvcmQgPiAtMSk7XG4gICAgQ3VzdG9tVGV4dC5zZXRJc1RpbWVSYW5kb20oJChgJHtwb3B1cH0gLmNoZWNrYm94IGlucHV0YCkucHJvcChcImNoZWNrZWRcIikgJiYgQ3VzdG9tVGV4dC50aW1lID4gLTEpO1xuICAgIGlmICgkKGAke3BvcHVwfSAuY2hlY2tib3ggaW5wdXRgKS5wcm9wKFwiY2hlY2tlZFwiKSAmJlxuICAgICAgICAhQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20gJiZcbiAgICAgICAgIUN1c3RvbVRleHQuaXNXb3JkUmFuZG9tKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiWW91IG5lZWQgdG8gc3BlY2lmeSB3b3JkIGNvdW50IG9yIHRpbWUgaW4gc2Vjb25kcyB0byBzdGFydCBhIHJhbmRvbSBjdXN0b20gdGVzdC5cIiwgMCwgNSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCQoYCR7cG9wdXB9IC5jaGVja2JveCBpbnB1dGApLnByb3AoXCJjaGVja2VkXCIpICYmXG4gICAgICAgIEN1c3RvbVRleHQuaXNUaW1lUmFuZG9tICYmXG4gICAgICAgIEN1c3RvbVRleHQuaXNXb3JkUmFuZG9tKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiWW91IG5lZWQgdG8gcGljayBiZXR3ZWVuIHdvcmQgY291bnQgb3IgdGltZSBpbiBzZWNvbmRzIHRvIHN0YXJ0IGEgcmFuZG9tIGN1c3RvbSB0ZXN0LlwiLCAwLCA1KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoKEN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmIEN1c3RvbVRleHQud29yZCA9PT0gMCkgfHxcbiAgICAgICAgKEN1c3RvbVRleHQuaXNUaW1lUmFuZG9tICYmIEN1c3RvbVRleHQudGltZSA9PT0gMCkpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJJbmZpbml0ZSB3b3JkcyEgTWFrZSBzdXJlIHRvIHVzZSBCYWlsIE91dCBmcm9tIHRoZSBjb21tYW5kIGxpbmUgdG8gc2F2ZSB5b3VyIHJlc3VsdC5cIiwgMCwgNyk7XG4gICAgfVxuICAgIENoYWxsZW5nZUNvbnRyb2xsZXIuY2xlYXJBY3RpdmUoKTtcbiAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT09IFwiY3VzdG9tXCIpXG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwiY3VzdG9tXCIpO1xuICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgaGlkZSgpO1xufVxuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBgJHtwb3B1cH0gLmJ1dHRvbi5hcHBseWAsICgpID0+IHtcbiAgICBhcHBseSgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIGAke3BvcHVwfSAud29yZGZpbHRlcmAsICgpID0+IHtcbiAgICBXb3JkRmlsdGVyUG9wdXAuc2hvdygpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3RvcCAuY29uZmlnIC5jdXN0b21UZXh0IC50ZXh0LWJ1dHRvblwiLCAoKSA9PiB7XG4gICAgc2hvdygpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImtleWRvd25cIiwgKGV2ZW50KSA9PiB7XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFc2NhcGVcIiAmJlxuICAgICAgICAhJChcIiNjdXN0b21UZXh0UG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xuLy8gaW1wb3J0IENvbmZpZywgKiBhcyBVcGRhdGVDb25maWcgZnJvbSBcIi4vY29uZmlnXCI7XG4vLyBpbXBvcnQgKiBhcyBOb3RpZmljYXRpb25zIGZyb20gXCIuL25vdGlmaWNhdGlvbnNcIjtcbi8vIGltcG9ydCAqIGFzIFRoZW1lUGlja2VyIGZyb20gXCIuL3RoZW1lLXBpY2tlclwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuZnVuY3Rpb24gc2hvdyh2YWx1ZSkge1xuICAgIGlmICgkKFwiI2N1c3RvbVRoZW1lU2hhcmVXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIC8vIGxldCBzYXZlID0gW107XG4gICAgICAgIC8vICQuZWFjaChcbiAgICAgICAgLy8gICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5jdXN0b21UaGVtZSBbdHlwZT0nY29sb3InXVwiKSxcbiAgICAgICAgLy8gICAoaW5kZXgsIGVsZW1lbnQpID0+IHtcbiAgICAgICAgLy8gICAgIHNhdmUucHVzaCgkKGVsZW1lbnQpLmF0dHIoXCJ2YWx1ZVwiKSk7XG4gICAgICAgIC8vICAgfVxuICAgICAgICAvLyApO1xuICAgICAgICAvLyAkKFwiI2N1c3RvbVRoZW1lU2hhcmVXcmFwcGVyIGlucHV0XCIpLnZhbChKU09OLnN0cmluZ2lmeShzYXZlKSk7XG4gICAgICAgICQoXCIjY3VzdG9tVGhlbWVTaGFyZVdyYXBwZXIgaW5wdXRcIikudmFsKHZhbHVlKTtcbiAgICAgICAgJChcIiNjdXN0b21UaGVtZVNoYXJlV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjY3VzdG9tVGhlbWVTaGFyZSBpbnB1dFwiKS50cmlnZ2VyKFwiZm9jdXNcIik7XG4gICAgICAgICAgICAkKFwiI2N1c3RvbVRoZW1lU2hhcmUgaW5wdXRcIikuc2VsZWN0KCk7XG4gICAgICAgICAgICAkKFwiI2N1c3RvbVRoZW1lU2hhcmUgaW5wdXRcIikudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICBpZiAoISQoXCIjY3VzdG9tVGhlbWVTaGFyZVdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgLy8gdHJ5IHtcbiAgICAgICAgLy8gICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWVDb2xvcnMoXG4gICAgICAgIC8vICAgICBKU09OLnBhcnNlKCQoXCIjY3VzdG9tVGhlbWVTaGFyZVdyYXBwZXIgaW5wdXRcIikudmFsKCkpXG4gICAgICAgIC8vICAgKTtcbiAgICAgICAgLy8gfSBjYXRjaCAoZSkge1xuICAgICAgICAvLyAgIE5vdGlmaWNhdGlvbnMuYWRkKFxuICAgICAgICAvLyAgICAgXCJTb21ldGhpbmcgd2VudCB3cm9uZy4gUmV2ZXJ0aW5nIHRvIGRlZmF1bHQgY3VzdG9tIGNvbG9ycy5cIixcbiAgICAgICAgLy8gICAgIDAsXG4gICAgICAgIC8vICAgICA0XG4gICAgICAgIC8vICAgKTtcbiAgICAgICAgLy8gICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWVDb2xvcnMoQ29uZmlnLmRlZmF1bHRDb25maWcuY3VzdG9tVGhlbWVDb2xvcnMpO1xuICAgICAgICAvLyB9XG4gICAgICAgIC8vIFRoZW1lUGlja2VyLnNldEN1c3RvbUlucHV0cygpO1xuICAgICAgICAkKFwiI2N1c3RvbVRoZW1lU2hhcmVXcmFwcGVyIGlucHV0XCIpLnZhbChcIlwiKTtcbiAgICAgICAgJChcIiNjdXN0b21UaGVtZVNoYXJlV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjY3VzdG9tVGhlbWVTaGFyZVdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiQoXCIjY3VzdG9tVGhlbWVTaGFyZVdyYXBwZXJcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwiY3VzdG9tVGhlbWVTaGFyZVdyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4kKFwiI2N1c3RvbVRoZW1lU2hhcmUgLmJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBoaWRlKCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmhpZGUgPSBleHBvcnRzLnNob3cgPSB2b2lkIDA7XG5jb25zdCBVcGRhdGVDb25maWcgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBNYW51YWxSZXN0YXJ0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L21hbnVhbC1yZXN0YXJ0LXRyYWNrZXJcIikpO1xuY29uc3QgVGVzdExvZ2ljID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtbG9naWNcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5mdW5jdGlvbiBzaG93KCkge1xuICAgIGlmICgkKFwiI2N1c3RvbVdvcmRBbW91bnRQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNjdXN0b21Xb3JkQW1vdW50UG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNjdXN0b21Xb3JkQW1vdW50UG9wdXAgaW5wdXRcIikudHJpZ2dlcihcImZvY3VzXCIpLnNlbGVjdCgpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICBpZiAoISQoXCIjY3VzdG9tV29yZEFtb3VudFBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI2N1c3RvbVdvcmRBbW91bnRQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI2N1c3RvbVdvcmRBbW91bnRQb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG5mdW5jdGlvbiBhcHBseSgpIHtcbiAgICBjb25zdCB2YWwgPSBwYXJzZUludCgkKFwiI2N1c3RvbVdvcmRBbW91bnRQb3B1cCBpbnB1dFwiKS52YWwoKSk7XG4gICAgaWYgKHZhbCAhPT0gbnVsbCAmJiAhaXNOYU4odmFsKSAmJiB2YWwgPj0gMCkge1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0V29yZENvdW50KHZhbCk7XG4gICAgICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgICAgIGlmICh2YWwgPiAyMDAwKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlN0YXkgc2FmZSBhbmQgdGFrZSBicmVha3MhXCIsIDApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHZhbCA9PSAwKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkluZmluaXRlIHdvcmRzISBNYWtlIHN1cmUgdG8gdXNlIEJhaWwgT3V0IGZyb20gdGhlIGNvbW1hbmQgbGluZSB0byBzYXZlIHlvdXIgcmVzdWx0LlwiLCAwLCA3KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDdXN0b20gd29yZCBhbW91bnQgbXVzdCBiZSBhdCBsZWFzdCAxXCIsIDApO1xuICAgIH1cbiAgICBoaWRlKCk7XG59XG4kKFwiI2N1c3RvbVdvcmRBbW91bnRQb3B1cFdyYXBwZXJcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwiY3VzdG9tV29yZEFtb3VudFBvcHVwV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbiQoXCIjY3VzdG9tV29yZEFtb3VudFBvcHVwIGlucHV0XCIpLm9uKFwia2V5cHJlc3NcIiwgKGUpID0+IHtcbiAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICBhcHBseSgpO1xuICAgIH1cbn0pO1xuJChcIiNjdXN0b21Xb3JkQW1vdW50UG9wdXAgLmJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBhcHBseSgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3RvcCAuY29uZmlnIC53b3JkQ291bnQgLnRleHQtYnV0dG9uXCIsIChlKSA9PiB7XG4gICAgY29uc3Qgd3JkID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJ3b3JkQ291bnRcIik7XG4gICAgaWYgKHdyZCA9PSBcImN1c3RvbVwiKSB7XG4gICAgICAgIHNob3coKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwia2V5ZG93blwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiICYmXG4gICAgICAgICEkKFwiI2N1c3RvbVdvcmRBbW91bnRQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuY29uc3QgYXBlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2FwZVwiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgQ29uZmlnID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgTG9hZGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sb2FkZXJcIikpO1xuY29uc3QgU2V0dGluZ3MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BhZ2VzL3NldHRpbmdzXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuZnVuY3Rpb24gc2hvdyhhY3Rpb24sIGlkLCBuYW1lKSB7XG4gICAgaWYgKGFjdGlvbiA9PT0gXCJhZGRcIikge1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXRcIikuYXR0cihcImFjdGlvblwiLCBcImFkZFwiKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IC50aXRsZVwiKS5odG1sKFwiQ3JlYXRlIG5ldyBwcmVzZXRcIik7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCAuYnV0dG9uXCIpLmh0bWwoYDxpIGNsYXNzPVwiZmFzIGZhLXBsdXNcIj48L2k+YCk7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCBpbnB1dC50ZXh0XCIpLnZhbChcIlwiKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IGlucHV0LnRleHRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCBsYWJlbFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoYWN0aW9uID09PSBcImVkaXRcIiAmJiBpZCAmJiBuYW1lKSB7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdFwiKS5hdHRyKFwiYWN0aW9uXCIsIFwiZWRpdFwiKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0XCIpLmF0dHIoXCJwcmVzZXRpZFwiLCBpZCk7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCAudGl0bGVcIikuaHRtbChcIkVkaXQgcHJlc2V0XCIpO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgLmJ1dHRvblwiKS5odG1sKGA8aSBjbGFzcz1cImZhcyBmYS1wZW5cIj48L2k+YCk7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCBpbnB1dC50ZXh0XCIpLnZhbChuYW1lKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IGlucHV0LnRleHRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCBsYWJlbCBpbnB1dFwiKS5wcm9wKFwiY2hlY2tlZFwiLCBmYWxzZSk7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCBsYWJlbFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoYWN0aW9uID09PSBcInJlbW92ZVwiICYmIGlkKSB7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdFwiKS5hdHRyKFwiYWN0aW9uXCIsIFwicmVtb3ZlXCIpO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXRcIikuYXR0cihcInByZXNldGlkXCIsIGlkKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IC50aXRsZVwiKS5odG1sKFwiUmVtb3ZlIHByZXNldCBcIiArIG5hbWUpO1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgLmJ1dHRvblwiKS5odG1sKGA8aSBjbGFzcz1cImZhcyBmYS1jaGVja1wiPjwvaT5gKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0IGlucHV0LnRleHRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCBsYWJlbFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgaWYgKCQoXCIjcHJlc2V0V3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgaW5wdXRcIikudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICBpZiAoISQoXCIjcHJlc2V0V3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXRcIikuYXR0cihcImFjdGlvblwiLCBcIlwiKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyICNwcmVzZXRFZGl0XCIpLmF0dHIoXCJ0YWdpZFwiLCBcIlwiKTtcbiAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNwcmVzZXRXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5mdW5jdGlvbiBhcHBseSgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCBhY3Rpb24gPSAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXRcIikuYXR0cihcImFjdGlvblwiKTtcbiAgICAgICAgY29uc3QgcHJlc2V0TmFtZSA9ICQoXCIjcHJlc2V0V3JhcHBlciAjcHJlc2V0RWRpdCBpbnB1dFwiKS52YWwoKTtcbiAgICAgICAgY29uc3QgcHJlc2V0SWQgPSAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXRcIikuYXR0cihcInByZXNldElkXCIpO1xuICAgICAgICBjb25zdCB1cGRhdGVDb25maWcgPSAkKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgbGFiZWwgaW5wdXRcIikucHJvcChcImNoZWNrZWRcIik7XG4gICAgICAgIGxldCBjb25maWdDaGFuZ2VzID0ge307XG4gICAgICAgIGlmICgodXBkYXRlQ29uZmlnICYmIGFjdGlvbiA9PT0gXCJlZGl0XCIpIHx8IGFjdGlvbiA9PT0gXCJhZGRcIikge1xuICAgICAgICAgICAgY29uZmlnQ2hhbmdlcyA9IENvbmZpZy5nZXRDb25maWdDaGFuZ2VzKCk7XG4gICAgICAgICAgICBjb25zdCB0YWdzID0gREIuZ2V0U25hcHNob3QoKS50YWdzIHx8IFtdO1xuICAgICAgICAgICAgY29uc3QgYWN0aXZlVGFnSWRzID0gdGFnc1xuICAgICAgICAgICAgICAgIC5maWx0ZXIoKHRhZykgPT4gdGFnLmFjdGl2ZSlcbiAgICAgICAgICAgICAgICAubWFwKCh0YWcpID0+IHRhZy5faWQpO1xuICAgICAgICAgICAgY29uZmlnQ2hhbmdlcy50YWdzID0gYWN0aXZlVGFnSWRzO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNuYXBzaG90UHJlc2V0cyA9IERCLmdldFNuYXBzaG90KCkucHJlc2V0cyB8fCBbXTtcbiAgICAgICAgaGlkZSgpO1xuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICBpZiAoYWN0aW9uID09PSBcImFkZFwiKSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucHJlc2V0cy5hZGQocHJlc2V0TmFtZSwgY29uZmlnQ2hhbmdlcyk7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBhZGQgcHJlc2V0OiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUHJlc2V0IGFkZGVkXCIsIDEsIDIpO1xuICAgICAgICAgICAgICAgIHNuYXBzaG90UHJlc2V0cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJlc2V0TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnOiBjb25maWdDaGFuZ2VzLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IHJlc3BvbnNlLmRhdGEucHJlc2V0SWQsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYWN0aW9uID09PSBcImVkaXRcIikge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnByZXNldHMuZWRpdChwcmVzZXRJZCwgcHJlc2V0TmFtZSwgY29uZmlnQ2hhbmdlcyk7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBlZGl0IHByZXNldDogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlByZXNldCB1cGRhdGVkXCIsIDEpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByZXNldCA9IHNuYXBzaG90UHJlc2V0cy5maWx0ZXIoKHByZXNldCkgPT4gcHJlc2V0Ll9pZCA9PT0gcHJlc2V0SWQpWzBdO1xuICAgICAgICAgICAgICAgIHByZXNldC5uYW1lID0gcHJlc2V0TmFtZTtcbiAgICAgICAgICAgICAgICBpZiAodXBkYXRlQ29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgIHByZXNldC5jb25maWcgPSBjb25maWdDaGFuZ2VzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChhY3Rpb24gPT09IFwicmVtb3ZlXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5wcmVzZXRzLmRlbGV0ZShwcmVzZXRJZCk7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byByZW1vdmUgcHJlc2V0OiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUHJlc2V0IHJlbW92ZWRcIiwgMSk7XG4gICAgICAgICAgICAgICAgc25hcHNob3RQcmVzZXRzLmZvckVhY2goKHByZXNldCwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByZXNldC5faWQgPT09IHByZXNldElkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzbmFwc2hvdFByZXNldHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFNldHRpbmdzLnVwZGF0ZSgpO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgIH0pO1xufVxuJChcIiNwcmVzZXRXcmFwcGVyXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcInByZXNldFdyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4kKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgLmJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBhcHBseSgpO1xufSk7XG4kKFwiI3ByZXNldFdyYXBwZXIgI3ByZXNldEVkaXQgaW5wdXRcIikub24oXCJrZXlwcmVzc1wiLCAoZSkgPT4ge1xuICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIGFwcGx5KCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5wcmVzZXRzIC5hZGRQcmVzZXRCdXR0b25cIiwgKCkgPT4ge1xuICAgIHNob3coXCJhZGRcIik7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnByZXNldHMgLmVkaXRCdXR0b25cIiwgKGUpID0+IHtcbiAgICBjb25zdCBwcmVzZXRpZCA9ICQoZS5jdXJyZW50VGFyZ2V0KS5wYXJlbnQoXCIucHJlc2V0XCIpLmF0dHIoXCJpZFwiKTtcbiAgICBjb25zdCBuYW1lID0gJChlLmN1cnJlbnRUYXJnZXQpLnNpYmxpbmdzKFwiLmJ1dHRvblwiKS5jaGlsZHJlbihcIi50aXRsZVwiKS50ZXh0KCk7XG4gICAgc2hvdyhcImVkaXRcIiwgcHJlc2V0aWQsIG5hbWUpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5wcmVzZXRzIC5yZW1vdmVCdXR0b25cIiwgKGUpID0+IHtcbiAgICBjb25zdCBwcmVzZXRpZCA9ICQoZS5jdXJyZW50VGFyZ2V0KS5wYXJlbnQoXCIucHJlc2V0XCIpLmF0dHIoXCJpZFwiKTtcbiAgICBjb25zdCBuYW1lID0gJChlLmN1cnJlbnRUYXJnZXQpLnNpYmxpbmdzKFwiLmJ1dHRvblwiKS5jaGlsZHJlbihcIi50aXRsZVwiKS50ZXh0KCk7XG4gICAgc2hvdyhcInJlbW92ZVwiLCBwcmVzZXRpZCwgbmFtZSk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmNvbnN0IGFwZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9hcGVcIikpO1xuY29uc3QgUmVzdWx0RmlsdGVycyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vYWNjb3VudC9yZXN1bHQtZmlsdGVyc1wiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBMb2FkZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2xvYWRlclwiKSk7XG5jb25zdCBTZXR0aW5ncyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcGFnZXMvc2V0dGluZ3NcIikpO1xuY29uc3QgUmVzdWx0VGFnc1BvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Jlc3VsdC10YWdzLXBvcHVwXCIpKTtcbmZ1bmN0aW9uIHNob3coYWN0aW9uLCBpZCwgbmFtZSkge1xuICAgIGlmIChhY3Rpb24gPT09IFwiYWRkXCIpIHtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXRcIikuYXR0cihcImFjdGlvblwiLCBcImFkZFwiKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgLnRpdGxlXCIpLmh0bWwoXCJBZGQgbmV3IHRhZ1wiKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgLmJ1dHRvblwiKS5odG1sKGA8aSBjbGFzcz1cImZhcyBmYS1wbHVzXCI+PC9pPmApO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCBpbnB1dFwiKS52YWwoXCJcIik7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IGlucHV0XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChhY3Rpb24gPT09IFwiZWRpdFwiICYmIGlkICYmIG5hbWUpIHtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXRcIikuYXR0cihcImFjdGlvblwiLCBcImVkaXRcIik7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0XCIpLmF0dHIoXCJ0YWdpZFwiLCBpZCk7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IC50aXRsZVwiKS5odG1sKFwiRWRpdCB0YWcgbmFtZVwiKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgLmJ1dHRvblwiKS5odG1sKGA8aSBjbGFzcz1cImZhcyBmYS1wZW5cIj48L2k+YCk7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IGlucHV0XCIpLnZhbChuYW1lKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgaW5wdXRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGFjdGlvbiA9PT0gXCJyZW1vdmVcIiAmJiBpZCAmJiBuYW1lKSB7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0XCIpLmF0dHIoXCJhY3Rpb25cIiwgXCJyZW1vdmVcIik7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0XCIpLmF0dHIoXCJ0YWdpZFwiLCBpZCk7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IC50aXRsZVwiKS5odG1sKFwiUmVtb3ZlIHRhZyBcIiArIG5hbWUpO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCAuYnV0dG9uXCIpLmh0bWwoYDxpIGNsYXNzPVwiZmFzIGZhLWNoZWNrXCI+PC9pPmApO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCBpbnB1dFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoYWN0aW9uID09PSBcImNsZWFyUGJcIiAmJiBpZCAmJiBuYW1lKSB7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0XCIpLmF0dHIoXCJhY3Rpb25cIiwgXCJjbGVhclBiXCIpO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdFwiKS5hdHRyKFwidGFnaWRcIiwgaWQpO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCAudGl0bGVcIikuaHRtbChcIkNsZWFyIFBCIGZvciB0YWcgXCIgKyBuYW1lKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgLmJ1dHRvblwiKS5odG1sKGA8aSBjbGFzcz1cImZhcyBmYS1jaGVja1wiPjwvaT5gKTtcbiAgICAgICAgJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgaW5wdXRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGlmICgkKFwiI3RhZ3NXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCBpbnB1dFwiKS50cmlnZ2VyKFwiZm9jdXNcIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmICghJChcIiN0YWdzV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdFwiKS5hdHRyKFwiYWN0aW9uXCIsIFwiXCIpO1xuICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdFwiKS5hdHRyKFwidGFnaWRcIiwgXCJcIik7XG4gICAgICAgICQoXCIjdGFnc1dyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3RhZ3NXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5mdW5jdGlvbiBhcHBseSgpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgYWN0aW9uID0gJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXRcIikuYXR0cihcImFjdGlvblwiKTtcbiAgICAgICAgY29uc3QgdGFnTmFtZSA9ICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0IGlucHV0XCIpLnZhbCgpO1xuICAgICAgICBjb25zdCB0YWdJZCA9ICQoXCIjdGFnc1dyYXBwZXIgI3RhZ3NFZGl0XCIpLmF0dHIoXCJ0YWdpZFwiKTtcbiAgICAgICAgaGlkZSgpO1xuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICBpZiAoYWN0aW9uID09PSBcImFkZFwiKSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMuY3JlYXRlVGFnKHRhZ05hbWUpO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gYWRkIHRhZzogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlRhZyBhZGRlZFwiLCAxKTtcbiAgICAgICAgICAgICAgICAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogcmVzcG9uc2UuZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IHJlc3BvbnNlLmRhdGEuX2lkLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIFJlc3VsdFRhZ3NQb3B1cC51cGRhdGVCdXR0b25zKCk7XG4gICAgICAgICAgICAgICAgU2V0dGluZ3MudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgUmVzdWx0RmlsdGVycy51cGRhdGVUYWdzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYWN0aW9uID09PSBcImVkaXRcIikge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmVkaXRUYWcodGFnSWQsIHRhZ05hbWUpO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gZWRpdCB0YWc6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJUYWcgdXBkYXRlZFwiLCAxKTtcbiAgICAgICAgICAgICAgICAoX2IgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhZy5faWQgPT09IHRhZ0lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YWcubmFtZSA9IHRhZ05hbWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBSZXN1bHRUYWdzUG9wdXAudXBkYXRlQnV0dG9ucygpO1xuICAgICAgICAgICAgICAgIFNldHRpbmdzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIFJlc3VsdEZpbHRlcnMudXBkYXRlVGFncygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGFjdGlvbiA9PT0gXCJyZW1vdmVcIikge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmRlbGV0ZVRhZyh0YWdJZCk7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byByZW1vdmUgdGFnOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiVGFnIHJlbW92ZWRcIiwgMSk7XG4gICAgICAgICAgICAgICAgKF9jID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZm9yRWFjaCgodGFnLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YWcuX2lkID09PSB0YWdJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgKF9hID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIFJlc3VsdFRhZ3NQb3B1cC51cGRhdGVCdXR0b25zKCk7XG4gICAgICAgICAgICAgICAgU2V0dGluZ3MudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgUmVzdWx0RmlsdGVycy51cGRhdGVUYWdzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYWN0aW9uID09PSBcImNsZWFyUGJcIikge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmRlbGV0ZVRhZ1BlcnNvbmFsQmVzdCh0YWdJZCk7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBjbGVhciB0YWcgcGI6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJUYWcgUEIgY2xlYXJlZFwiLCAxKTtcbiAgICAgICAgICAgICAgICAoX2QgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhZy5faWQgPT09IHRhZ0lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YWcucGVyc29uYWxCZXN0cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3Jkczoge30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tOiB7IGN1c3RvbTogW10gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB6ZW46IHsgemVuOiBbXSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1b3RlOiB7IGN1c3RvbTogW10gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBSZXN1bHRUYWdzUG9wdXAudXBkYXRlQnV0dG9ucygpO1xuICAgICAgICAgICAgICAgIFNldHRpbmdzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIFJlc3VsdEZpbHRlcnMudXBkYXRlVGFncygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgfSk7XG59XG4kKFwiI3RhZ3NXcmFwcGVyXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcInRhZ3NXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuJChcIiN0YWdzV3JhcHBlciAjdGFnc0VkaXQgLmJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBhcHBseSgpO1xufSk7XG4kKFwiI3RhZ3NXcmFwcGVyICN0YWdzRWRpdCBpbnB1dFwiKS5vbihcImtleXByZXNzXCIsIChlKSA9PiB7XG4gICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgYXBwbHkoKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRhZ3MgLmFkZFRhZ0J1dHRvblwiLCAoKSA9PiB7XG4gICAgc2hvdyhcImFkZFwiKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGFncyAudGFnc0xpc3QgLnRhZyAuZWRpdEJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIGNvbnN0IHRhZ2lkID0gJChlLmN1cnJlbnRUYXJnZXQpLnBhcmVudChcIi50YWdcIikuYXR0cihcImlkXCIpO1xuICAgIGNvbnN0IG5hbWUgPSAkKGUuY3VycmVudFRhcmdldClcbiAgICAgICAgLnNpYmxpbmdzKFwiLnRhZ0J1dHRvblwiKVxuICAgICAgICAuY2hpbGRyZW4oXCIudGl0bGVcIilcbiAgICAgICAgLnRleHQoKTtcbiAgICBzaG93KFwiZWRpdFwiLCB0YWdpZCwgbmFtZSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRhZ3MgLnRhZ3NMaXN0IC50YWcgLmNsZWFyUGJCdXR0b25cIiwgKGUpID0+IHtcbiAgICBjb25zdCB0YWdpZCA9ICQoZS5jdXJyZW50VGFyZ2V0KS5wYXJlbnQoXCIudGFnXCIpLmF0dHIoXCJpZFwiKTtcbiAgICBjb25zdCBuYW1lID0gJChlLmN1cnJlbnRUYXJnZXQpXG4gICAgICAgIC5zaWJsaW5ncyhcIi50YWdCdXR0b25cIilcbiAgICAgICAgLmNoaWxkcmVuKFwiLnRpdGxlXCIpXG4gICAgICAgIC50ZXh0KCk7XG4gICAgc2hvdyhcImNsZWFyUGJcIiwgdGFnaWQsIG5hbWUpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50YWdzIC50YWdzTGlzdCAudGFnIC5yZW1vdmVCdXR0b25cIiwgKGUpID0+IHtcbiAgICBjb25zdCB0YWdpZCA9ICQoZS5jdXJyZW50VGFyZ2V0KS5wYXJlbnQoXCIudGFnXCIpLmF0dHIoXCJpZFwiKTtcbiAgICBjb25zdCBuYW1lID0gJChlLmN1cnJlbnRUYXJnZXQpXG4gICAgICAgIC5zaWJsaW5ncyhcIi50YWdCdXR0b25cIilcbiAgICAgICAgLmNoaWxkcmVuKFwiLnRpdGxlXCIpXG4gICAgICAgIC50ZXh0KCk7XG4gICAgc2hvdyhcInJlbW92ZVwiLCB0YWdpZCwgbmFtZSk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNob3cgPSB2b2lkIDA7XG5jb25zdCBVcGRhdGVDb25maWcgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmZ1bmN0aW9uIHNob3cobW9kZSwgY29uZmlnKSB7XG4gICAgaWYgKCQoXCIjc2V0dGluZ3NJbXBvcnRXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjc2V0dGluZ3NJbXBvcnRXcmFwcGVyXCIpLmF0dHIoXCJtb2RlXCIsIG1vZGUpO1xuICAgICAgICBpZiAobW9kZSA9PT0gXCJleHBvcnRcIikge1xuICAgICAgICAgICAgJChcIiNzZXR0aW5nc0ltcG9ydFdyYXBwZXIgLmJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIjc2V0dGluZ3NJbXBvcnRXcmFwcGVyIGlucHV0XCIpLnZhbChjb25maWcgIT09IG51bGwgJiYgY29uZmlnICE9PSB2b2lkIDAgPyBjb25maWcgOiBcIlwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChtb2RlID09PSBcImltcG9ydFwiKSB7XG4gICAgICAgICAgICAkKFwiI3NldHRpbmdzSW1wb3J0V3JhcHBlciAuYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICAgICQoXCIjc2V0dGluZ3NJbXBvcnRXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNzZXR0aW5nc0ltcG9ydFdyYXBwZXIgaW5wdXRcIikudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgICAgICAgICAgJChcIiNzZXR0aW5nc0ltcG9ydFdyYXBwZXIgaW5wdXRcIikuc2VsZWN0KCk7XG4gICAgICAgICAgICAkKFwiI3NldHRpbmdzSW1wb3J0V3JhcHBlciBpbnB1dFwiKS50cmlnZ2VyKFwiZm9jdXNcIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmICghJChcIiNzZXR0aW5nc0ltcG9ydFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgaWYgKCQoXCIjc2V0dGluZ3NJbXBvcnRXcmFwcGVyIGlucHV0XCIpLnZhbCgpICE9PSBcIlwiKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5hcHBseShKU09OLnBhcnNlKCQoXCIjc2V0dGluZ3NJbXBvcnRXcmFwcGVyIGlucHV0XCIpLnZhbCgpKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQW4gZXJyb3Igb2NjdXJlZCB3aGlsZSBpbXBvcnRpbmcgc2V0dGluZ3M6IFwiICsgZSwgLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNhdmVGdWxsQ29uZmlnVG9Mb2NhbFN0b3JhZ2UoKTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiI3NldHRpbmdzSW1wb3J0V3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3NldHRpbmdzSW1wb3J0V3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuJChcIiNzZXR0aW5nc0ltcG9ydCAuYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGhpZGUoKTtcbn0pO1xuJChcIiNzZXR0aW5nc0ltcG9ydFdyYXBwZXJcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwic2V0dGluZ3NJbXBvcnRXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudXBkYXRlID0gdm9pZCAwO1xuY29uc3QgVGVzdExvZ2ljID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L3Rlc3QtbG9naWNcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBVcGRhdGVDb25maWcgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBNYW51YWxSZXN0YXJ0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L21hbnVhbC1yZXN0YXJ0LXRyYWNrZXJcIikpO1xuY29uc3QgQ3VzdG9tV29yZEFtb3VudFBvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2N1c3RvbS13b3JkLWFtb3VudC1wb3B1cFwiKSk7XG5jb25zdCBDdXN0b21UZXN0RHVyYXRpb25Qb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jdXN0b20tdGVzdC1kdXJhdGlvbi1wb3B1cFwiKSk7XG5jb25zdCBRdW90ZVNlYXJjaFBvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3F1b3RlLXNlYXJjaC1wb3B1cFwiKSk7XG5jb25zdCBDdXN0b21UZXh0UG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY3VzdG9tLXRleHQtcG9wdXBcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBlbCA9ICQoXCIjbW9iaWxlVGVzdENvbmZpZ1BvcHVwXCIpO1xuZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgIGVsLmZpbmQoXCIuYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgIGVsLmZpbmQoYC5tb2RlR3JvdXAgLmJ1dHRvblttb2RlPScke2NvbmZpZ18xLmRlZmF1bHQubW9kZX0nXWApLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgIGVsLmZpbmQoXCIudGltZUdyb3VwXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIGVsLmZpbmQoXCIud29yZHNHcm91cFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICBlbC5maW5kKFwiLnF1b3RlR3JvdXBcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgZWwuZmluZChcIi5jdXN0b21Hcm91cFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICBlbC5maW5kKGAuJHtjb25maWdfMS5kZWZhdWx0Lm1vZGV9R3JvdXBgKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbikge1xuICAgICAgICBlbC5maW5kKFwiLnB1bmN0dWF0aW9uXCIpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZWwuZmluZChcIi5wdW5jdHVhdGlvblwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubnVtYmVycykge1xuICAgICAgICBlbC5maW5kKFwiLm51bWJlcnNcIikuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBlbC5maW5kKFwiLm51bWJlcnNcIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwidGltZVwiKSB7XG4gICAgICAgIGVsLmZpbmQoYC50aW1lR3JvdXAgLmJ1dHRvblt0aW1lPScke2NvbmZpZ18xLmRlZmF1bHQudGltZX0nXWApLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICBlbC5maW5kKFwiLnB1bmN0dWF0aW9uXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIGVsLmZpbmQoXCIubnVtYmVyc1wiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIikge1xuICAgICAgICBlbC5maW5kKGAud29yZHNHcm91cCAuYnV0dG9uW3dvcmRzPScke2NvbmZpZ18xLmRlZmF1bHQud29yZHN9J11gKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgZWwuZmluZChcIi5wdW5jdHVhdGlvblwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICBlbC5maW5kKFwiLm51bWJlcnNcIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInF1b3RlXCIpIHtcbiAgICAgICAgZWwuZmluZChgLnF1b3RlR3JvdXAgLmJ1dHRvbltxdW90ZT0nJHtjb25maWdfMS5kZWZhdWx0LnF1b3RlTGVuZ3RofSddYCkuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgIGVsLmZpbmQoXCIucHVuY3R1YXRpb25cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgZWwuZmluZChcIi5udW1iZXJzXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ6ZW5cIikge1xuICAgICAgICBlbC5maW5kKFwiLnB1bmN0dWF0aW9uXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIGVsLmZpbmQoXCIubnVtYmVyc1wiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgZWwuZmluZChcIi5wdW5jdHVhdGlvblwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICBlbC5maW5kKFwiLm51bWJlcnNcIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICB9XG59XG5leHBvcnRzLnVwZGF0ZSA9IHVwZGF0ZTtcbmZ1bmN0aW9uIHNob3dQb3B1cCgpIHtcbiAgICBpZiAoJChcIiNtb2JpbGVUZXN0Q29uZmlnUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIHVwZGF0ZSgpO1xuICAgICAgICAkKFwiI21vYmlsZVRlc3RDb25maWdQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTAwKTtcbiAgICB9XG59XG5mdW5jdGlvbiBoaWRlUG9wdXAoKSB7XG4gICAgaWYgKCEkKFwiI21vYmlsZVRlc3RDb25maWdQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNtb2JpbGVUZXN0Q29uZmlnUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNtb2JpbGVUZXN0Q29uZmlnUG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4kKFwiI21vYmlsZVRlc3RDb25maWdQb3B1cFdyYXBwZXJcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwibW9iaWxlVGVzdENvbmZpZ1BvcHVwV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGVQb3B1cCgpO1xuICAgIH1cbn0pO1xuJChcIiN0b3AgLm1vYmlsZUNvbmZpZ1wiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBzaG93UG9wdXAoKTtcbn0pO1xuZWwuZmluZChcIi53b3Jkc0dyb3VwIC5idXR0b25cIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGNvbnN0IHdyZCA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwid29yZHNcIik7XG4gICAgaWYgKHdyZCA9PSBcImN1c3RvbVwiKSB7XG4gICAgICAgIGhpZGVQb3B1cCgpO1xuICAgICAgICBDdXN0b21Xb3JkQW1vdW50UG9wdXAuc2hvdygpO1xuICAgIH1cbiAgICBlbHNlIGlmICh3cmQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb25zdCB3cmROdW0gPSBwYXJzZUludCh3cmQpO1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0V29yZENvdW50KHdyZE51bSk7XG4gICAgICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgfVxufSk7XG5lbC5maW5kKFwiLnRpbWVHcm91cCAuYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBjb25zdCB0aW1lID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJ0aW1lXCIpO1xuICAgIGlmICh0aW1lID09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgaGlkZVBvcHVwKCk7XG4gICAgICAgIEN1c3RvbVRlc3REdXJhdGlvblBvcHVwLnNob3coKTtcbiAgICB9XG4gICAgZWxzZSBpZiAodGltZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnN0IHRpbWVOdW0gPSBwYXJzZUludCh0aW1lKTtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldFRpbWVDb25maWcodGltZU51bSk7XG4gICAgICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG4gICAgfVxufSk7XG5lbC5maW5kKFwiLnF1b3RlR3JvdXAgLmJ1dHRvblwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGxldCBsZW4gPSAoKF9hID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJxdW90ZVwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogMCk7XG4gICAgaWYgKGxlbiA9PSAtMikge1xuICAgICAgICAvLyBVcGRhdGVDb25maWcuc2V0UXVvdGVMZW5ndGgoLTIsIGZhbHNlLCBlLnNoaWZ0S2V5KTtcbiAgICAgICAgaGlkZVBvcHVwKCk7XG4gICAgICAgIFF1b3RlU2VhcmNoUG9wdXAuc2hvdygpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGxlbiA9PSAtMSkge1xuICAgICAgICAgICAgbGVuID0gWzAsIDEsIDIsIDNdO1xuICAgICAgICB9XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRRdW90ZUxlbmd0aChsZW4sIGZhbHNlLCBlLnNoaWZ0S2V5KTtcbiAgICAgICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICAgICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbiAgICB9XG59KTtcbmVsLmZpbmQoXCIuY3VzdG9tQ2hhbmdlXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGhpZGVQb3B1cCgpO1xuICAgIEN1c3RvbVRleHRQb3B1cC5zaG93KCk7XG59KTtcbmVsLmZpbmQoXCIucHVuY3R1YXRpb25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgVXBkYXRlQ29uZmlnLnNldFB1bmN0dWF0aW9uKCFjb25maWdfMS5kZWZhdWx0LnB1bmN0dWF0aW9uKTtcbiAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG59KTtcbmVsLmZpbmQoXCIubnVtYmVyc1wiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0TnVtYmVycyghY29uZmlnXzEuZGVmYXVsdC5udW1iZXJzKTtcbiAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgIFRlc3RMb2dpYy5yZXN0YXJ0KCk7XG59KTtcbmVsLmZpbmQoXCIubW9kZUdyb3VwIC5idXR0b25cIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUuY3VycmVudFRhcmdldCkuaGFzQ2xhc3MoXCJhY3RpdmVcIikpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBtb2RlID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJtb2RlXCIpO1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKG1vZGUpO1xuICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgVGVzdExvZ2ljLnJlc3RhcnQoKTtcbn0pO1xuJChcIiNtb2JpbGVUZXN0Q29uZmlnUG9wdXAgLmJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICAvLyBoaWRlUG9wdXAoKTtcbiAgICB1cGRhdGUoKTtcbn0pO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSkgPT4ge1xuICAgIGlmIChldmVudEtleSA9PT0gXCJtb2RlXCIpXG4gICAgICAgIHVwZGF0ZSgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IGZvcm1hdF8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJkYXRlLWZucy9mb3JtYXRcIikpO1xuZnVuY3Rpb24gdXBkYXRlKG1vZGUpIHtcbiAgICAkKFwiI3BiVGFibGVzUG9wdXAgdGFibGUgdGJvZHlcIikuZW1wdHkoKTtcbiAgICAkKCQoXCIjcGJUYWJsZXNQb3B1cCB0YWJsZSB0aGVhZCB0ciB0ZFwiKVswXSkudGV4dChtb2RlKTtcbiAgICBjb25zdCBzbmFwc2hvdCA9IERCLmdldFNuYXBzaG90KCk7XG4gICAgY29uc3QgYWxsbW9kZTIgPSAoc25hcHNob3QucGVyc29uYWxCZXN0cyA9PT0gdW5kZWZpbmVkXG4gICAgICAgID8gdW5kZWZpbmVkXG4gICAgICAgIDogc25hcHNob3QucGVyc29uYWxCZXN0c1ttb2RlXSk7XG4gICAgaWYgKGFsbG1vZGUyID09PSB1bmRlZmluZWQpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBsaXN0ID0gW107XG4gICAgT2JqZWN0LmtleXMoYWxsbW9kZTIpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICBsZXQgcGJzID0gYWxsbW9kZTJba2V5XTtcbiAgICAgICAgcGJzID0gcGJzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgIHJldHVybiBiLndwbSAtIGEud3BtO1xuICAgICAgICAgICAgLy8gaWYgKGEuZGlmZmljdWx0eSA9PT0gYi5kaWZmaWN1bHR5KSB7XG4gICAgICAgICAgICAvLyAgIHJldHVybiAoYS5sYW5ndWFnZSA8IGIubGFuZ3VhZ2UgPyAtMSA6IDEpO1xuICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgLy8gcmV0dXJuIChhLmRpZmZpY3VsdHkgPCBiLmRpZmZpY3VsdHkgPyAtMSA6IDEpXG4gICAgICAgIH0pO1xuICAgICAgICBwYnMuZm9yRWFjaChmdW5jdGlvbiAocGIpIHtcbiAgICAgICAgICAgIHBiLm1vZGUyID0ga2V5O1xuICAgICAgICAgICAgbGlzdC5wdXNoKHBiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgbGV0IG1vZGUybWVtb3J5O1xuICAgIGxpc3QuZm9yRWFjaCgocGIpID0+IHtcbiAgICAgICAgbGV0IGRhdGVUZXh0ID0gYC08YnI+PHNwYW4gY2xhc3M9XCJzdWJcIj4tPC9zcGFuPmA7XG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShwYi50aW1lc3RhbXApO1xuICAgICAgICBpZiAocGIudGltZXN0YW1wKSB7XG4gICAgICAgICAgICBkYXRlVGV4dCA9XG4gICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiZGQgTU1NIHl5eXlcIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjxicj48ZGl2IGNsYXNzPSdzdWInPlwiICtcbiAgICAgICAgICAgICAgICAgICAgKDAsIGZvcm1hdF8xLmRlZmF1bHQpKGRhdGUsIFwiSEg6bW1cIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjwvZGl2PlwiO1xuICAgICAgICB9XG4gICAgICAgICQoXCIjcGJUYWJsZXNQb3B1cCB0YWJsZSB0Ym9keVwiKS5hcHBlbmQoYFxuICAgICAgPHRyPlxuICAgICAgICA8dGQ+JHttb2RlMm1lbW9yeSA9PT0gcGIubW9kZTIgPyBcIlwiIDogcGIubW9kZTJ9PC90ZD5cbiAgICAgICAgPHRkPlxuICAgICAgICAgICR7cGIud3BtfVxuICAgICAgICAgIDxiciAvPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwic3ViXCI+JHtwYi5hY2MgPyBwYi5hY2MgKyBcIiVcIiA6IFwiLVwifTwvc3Bhbj5cbiAgICAgICAgPC90ZD5cbiAgICAgICAgPHRkPlxuICAgICAgICAgICR7cGIucmF3ID8gcGIucmF3IDogXCItXCJ9XG4gICAgICAgICAgPGJyIC8+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJzdWJcIj4ke3BiLmNvbnNpc3RlbmN5ID8gcGIuY29uc2lzdGVuY3kgKyBcIiVcIiA6IFwiLVwifTwvc3Bhbj5cbiAgICAgICAgPC90ZD5cbiAgICAgICAgPHRkPiR7cGIuZGlmZmljdWx0eX08L3RkPlxuICAgICAgICA8dGQ+JHtwYi5sYW5ndWFnZSA/IHBiLmxhbmd1YWdlLnJlcGxhY2UoL18vZywgXCIgXCIpIDogXCItXCJ9PC90ZD5cbiAgICAgICAgPHRkPiR7cGIucHVuY3R1YXRpb24gPyAnPGkgY2xhc3M9XCJmYXMgZmEtY2hlY2tcIj48L2k+JyA6IFwiXCJ9PC90ZD5cbiAgICAgICAgPHRkPiR7cGIubGF6eU1vZGUgPyAnPGkgY2xhc3M9XCJmYXMgZmEtY2hlY2tcIj48L2k+JyA6IFwiXCJ9PC90ZD5cbiAgICAgICAgPHRkPiR7ZGF0ZVRleHR9PC90ZD5cbiAgICAgIDwvdHI+XG4gICAgYCk7XG4gICAgICAgIG1vZGUybWVtb3J5ID0gcGIubW9kZTI7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBzaG93KG1vZGUpIHtcbiAgICBpZiAoJChcIiNwYlRhYmxlc1BvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICB1cGRhdGUobW9kZSk7XG4gICAgICAgICQoXCIjcGJUYWJsZXNQb3B1cCAudGl0bGVcIikudGV4dChgQWxsICR7bW9kZX0gcGVyc29uYWwgYmVzdHNgKTtcbiAgICAgICAgJChcIiNwYlRhYmxlc1BvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxMDApO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgaWYgKCEkKFwiI3BiVGFibGVzUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjcGJUYWJsZXNQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3BiVGFibGVzUG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIiNwYlRhYmxlc1BvcHVwIHRhYmxlIHRib2R5XCIpLmVtcHR5KCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiQoXCIjcGJUYWJsZXNQb3B1cFdyYXBwZXJcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwicGJUYWJsZXNQb3B1cFdyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4kKFwiLnBhZ2VBY2NvdW50IC5idXR0b24uc2hvd0FsbFRpbWVQYnNcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgc2hvdyhcInRpbWVcIik7XG59KTtcbiQoXCIucGFnZUFjY291bnQgLmJ1dHRvbi5zaG93QWxsV29yZHNQYnNcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgc2hvdyhcIndvcmRzXCIpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmhpZGUgPSBleHBvcnRzLnNob3cgPSB2b2lkIDA7XG5jb25zdCBhcGVfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vYXBlXCIpKTtcbmNvbnN0IExvYWRlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbG9hZGVyXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgZm9ybWF0XzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImRhdGUtZm5zL2Zvcm1hdFwiKSk7XG5sZXQgcXVvdGVzID0gW107XG5mdW5jdGlvbiB1cGRhdGVMaXN0KCkge1xuICAgICQoXCIjcXVvdGVBcHByb3ZlUG9wdXBXcmFwcGVyIC5xdW90ZXNcIikuZW1wdHkoKTtcbiAgICBxdW90ZXMuZm9yRWFjaCgocXVvdGUsIGluZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IHF1b3RlRWwgPSAkKGBcbiAgICAgIDxkaXYgY2xhc3M9XCJxdW90ZVwiIGlkPVwiJHtpbmRleH1cIiBkYmlkPVwiJHtxdW90ZS5faWR9XCI+XG4gICAgICAgIDx0ZXh0YXJlYSBjbGFzcz1cInRleHRcIj4ke3F1b3RlLnRleHR9PC90ZXh0YXJlYT5cbiAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCJzb3VyY2VcIiBwbGFjZWhvbGRlcj1cIlNvdXJjZVwiIHZhbHVlPVwiJHtxdW90ZS5zb3VyY2V9XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJidXR0b25zXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImljb24tYnV0dG9uIGRpc2FibGVkIHVuZG9cIiBhcmlhLWxhYmVsPVwiVW5kbyBjaGFuZ2VzXCIgZGF0YS1iYWxsb29uLXBvcz1cImxlZnRcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS11bmRvLWFsdFwiPjwvaT48L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiaWNvbi1idXR0b24gcmVmdXNlXCIgYXJpYS1sYWJlbD1cIlJlZnVzZSBxdW90ZVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJsZWZ0XCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtdGltZXNcIj48L2k+PC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImljb24tYnV0dG9uIGFwcHJvdmVcIiBhcmlhLWxhYmVsPVwiQXBwcm92ZSBxdW90ZVwiIGRhdGEtYmFsbG9vbi1wb3M9XCJsZWZ0XCI+PGkgY2xhc3M9XCJmYXMgZmEtZncgZmEtY2hlY2tcIj48L2k+PC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImljb24tYnV0dG9uIGVkaXQgaGlkZGVuXCIgYXJpYS1sYWJlbD1cIkVkaXQgYW5kIGFwcHJvdmUgcXVvdGVcIiBkYXRhLWJhbGxvb24tcG9zPVwibGVmdFwiPjxpIGNsYXNzPVwiZmFzIGZhLWZ3IGZhLXBlblwiPjwvaT48L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJib3R0b21cIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwibGVuZ3RoICR7cXVvdGUudGV4dC5sZW5ndGggPCA2MCA/IFwicmVkXCIgOiBcIlwifVwiPlF1b3RlIGxlbmd0aDogJHtxdW90ZS50ZXh0Lmxlbmd0aH08L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwibGFuZ3VhZ2VcIj5MYW5ndWFnZTogJHtxdW90ZS5sYW5ndWFnZX08L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidGltZXN0YW1wXCI+U3VibWl0dGVkIG9uOiAkeygwLCBmb3JtYXRfMS5kZWZhdWx0KShuZXcgRGF0ZShxdW90ZS50aW1lc3RhbXApLCBcImRkIE1NTSB5eXl5IEhIOm1tXCIpfTwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIGApO1xuICAgICAgICAkKFwiI3F1b3RlQXBwcm92ZVBvcHVwV3JhcHBlciAucXVvdGVzXCIpLmFwcGVuZChxdW90ZUVsKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZVF1b3RlTGVuZ3RoKGluZGV4KSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IGxlbiA9IChfYSA9ICQoYCNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGVbaWQ9JHtpbmRleH1dIC50ZXh0YCkudmFsKCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGg7XG4gICAgJChgI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZVtpZD0ke2luZGV4fV0gLmxlbmd0aGApLnRleHQoXCJRdW90ZSBsZW5ndGg6IFwiICsgbGVuKTtcbiAgICBpZiAobGVuIDwgNjApIHtcbiAgICAgICAgJChgI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZVtpZD0ke2luZGV4fV0gLmxlbmd0aGApLmFkZENsYXNzKFwicmVkXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChgI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZVtpZD0ke2luZGV4fV0gLmxlbmd0aGApLnJlbW92ZUNsYXNzKFwicmVkXCIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGdldFF1b3RlcygpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucXVvdGVzLmdldCgpO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBnZXQgbmV3IHF1b3RlczogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgcXVvdGVzID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgdXBkYXRlTGlzdCgpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gc2hvdyhub0FuaW0gPSBmYWxzZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmICgkKFwiI3F1b3RlQXBwcm92ZVBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAgICAgcXVvdGVzID0gW107XG4gICAgICAgICAgICBnZXRRdW90ZXMoKTtcbiAgICAgICAgICAgICQoXCIjcXVvdGVBcHByb3ZlUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCBub0FuaW0gPyAwIDogMTAwKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgaWYgKCEkKFwiI3F1b3RlQXBwcm92ZVBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI3F1b3RlQXBwcm92ZVBvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjcXVvdGVBcHByb3ZlUG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIiNxdW90ZUFwcHJvdmVQb3B1cFdyYXBwZXIgLnF1b3Rlc1wiKS5lbXB0eSgpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuZnVuY3Rpb24gcmVzZXRCdXR0b25zKHRhcmdldCkge1xuICAgICQodGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmZpbmQoXCIuaWNvbi1idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICBpZiAoJCh0YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuZmluZChcIi5lZGl0XCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQodGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmZpbmQoXCIudW5kb1wiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIH1cbn1cbiQoXCIjcXVvdGVBcHByb3ZlUG9wdXBXcmFwcGVyXCIpLm9uKFwibW91c2Vkb3duXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJxdW90ZUFwcHJvdmVQb3B1cFdyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4kKFwiI3F1b3RlQXBwcm92ZVBvcHVwV3JhcHBlciAuYnV0dG9uLnJlZnJlc2hMaXN0XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICQoXCIjcXVvdGVBcHByb3ZlUG9wdXBXcmFwcGVyIC5xdW90ZXNcIikuZW1wdHkoKTtcbiAgICBnZXRRdW90ZXMoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGUgLnVuZG9cIiwgKGUpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIGNvbnN0IGluZGV4ID0gcGFyc2VJbnQoJChlLnRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5hdHRyKFwiaWRcIikpO1xuICAgICQoYCNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGVbaWQ9JHtpbmRleH1dIC50ZXh0YCkudmFsKHF1b3Rlc1tpbmRleF0udGV4dCk7XG4gICAgJChgI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZVtpZD0ke2luZGV4fV0gLnNvdXJjZWApLnZhbChxdW90ZXNbaW5kZXhdLnNvdXJjZSk7XG4gICAgJChgI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZVtpZD0ke2luZGV4fV0gLnVuZG9gKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICQoYCNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGVbaWQ9JHtpbmRleH1dIC5hcHByb3ZlYCkucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgJChgI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZVtpZD0ke2luZGV4fV0gLmVkaXRgKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB1cGRhdGVRdW90ZUxlbmd0aChpbmRleCk7XG59KSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZSAuYXBwcm92ZVwiLCAoZSkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdmFyIF9hO1xuICAgIGlmICghY29uZmlybShcIkFyZSB5b3Ugc3VyZT9cIikpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBpbmRleCA9IHBhcnNlSW50KCQoZS50YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuYXR0cihcImlkXCIpKTtcbiAgICBjb25zdCBkYmlkID0gJChlLnRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5hdHRyKFwiZGJpZFwiKTtcbiAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldDtcbiAgICAkKHRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5maW5kKFwiLmljb24tYnV0dG9uXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgJCh0YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuZmluZChcInRleHRhcmVhLCBpbnB1dFwiKS5wcm9wKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgTG9hZGVyLnNob3coKTtcbiAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQucXVvdGVzLmFwcHJvdmVTdWJtaXNzaW9uKGRiaWQpO1xuICAgIExvYWRlci5oaWRlKCk7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgIHJlc2V0QnV0dG9ucyh0YXJnZXQpO1xuICAgICAgICAkKHRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5maW5kKFwidGV4dGFyZWEsIGlucHV0XCIpLnByb3AoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XG4gICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBhcHByb3ZlIHF1b3RlOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICB9XG4gICAgTm90aWZpY2F0aW9ucy5hZGQoKF9hID0gXCJRdW90ZSBhcHByb3ZlZC4gXCIgKyByZXNwb25zZS5tZXNzYWdlKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIlwiLCAxKTtcbiAgICBxdW90ZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB1cGRhdGVMaXN0KCk7XG59KSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZSAucmVmdXNlXCIsIChlKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBpZiAoIWNvbmZpcm0oXCJBcmUgeW91IHN1cmU/XCIpKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgaW5kZXggPSBwYXJzZUludCgkKGUudGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmF0dHIoXCJpZFwiKSk7XG4gICAgY29uc3QgZGJpZCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuYXR0cihcImRiaWRcIik7XG4gICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgJCh0YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuZmluZChcIi5pY29uLWJ1dHRvblwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICQodGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmZpbmQoXCJ0ZXh0YXJlYSwgaW5wdXRcIikucHJvcChcImRpc2FibGVkXCIsIHRydWUpO1xuICAgIExvYWRlci5zaG93KCk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnF1b3Rlcy5yZWplY3RTdWJtaXNzaW9uKGRiaWQpO1xuICAgIExvYWRlci5oaWRlKCk7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgIHJlc2V0QnV0dG9ucyh0YXJnZXQpO1xuICAgICAgICAkKHRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5maW5kKFwidGV4dGFyZWEsIGlucHV0XCIpLnByb3AoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XG4gICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byByZWZ1c2UgcXVvdGU6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgIH1cbiAgICBOb3RpZmljYXRpb25zLmFkZChcIlF1b3RlIHJlZnVzZWQuXCIsIDEpO1xuICAgIHF1b3Rlcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIHVwZGF0ZUxpc3QoKTtcbn0pKTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlIC5lZGl0XCIsIChlKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB2YXIgX2I7XG4gICAgaWYgKCFjb25maXJtKFwiQXJlIHlvdSBzdXJlP1wiKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IGluZGV4ID0gcGFyc2VJbnQoJChlLnRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5hdHRyKFwiaWRcIikpO1xuICAgIGNvbnN0IGRiaWQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmF0dHIoXCJkYmlkXCIpO1xuICAgIGNvbnN0IGVkaXRUZXh0ID0gJChgI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZVtpZD0ke2luZGV4fV0gLnRleHRgKS52YWwoKTtcbiAgICBjb25zdCBlZGl0U291cmNlID0gJChgI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZVtpZD0ke2luZGV4fV0gLnNvdXJjZWApLnZhbCgpO1xuICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xuICAgICQodGFyZ2V0KS5jbG9zZXN0KFwiLnF1b3RlXCIpLmZpbmQoXCIuaWNvbi1idXR0b25cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAkKHRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5maW5kKFwidGV4dGFyZWEsIGlucHV0XCIpLnByb3AoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICBMb2FkZXIuc2hvdygpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5xdW90ZXMuYXBwcm92ZVN1Ym1pc3Npb24oZGJpZCwgZWRpdFRleHQsIGVkaXRTb3VyY2UpO1xuICAgIExvYWRlci5oaWRlKCk7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgIHJlc2V0QnV0dG9ucyh0YXJnZXQpO1xuICAgICAgICAkKHRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5maW5kKFwidGV4dGFyZWEsIGlucHV0XCIpLnByb3AoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XG4gICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBhcHByb3ZlIHF1b3RlOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICB9XG4gICAgTm90aWZpY2F0aW9ucy5hZGQoKF9iID0gXCJRdW90ZSBlZGl0ZWQgYW5kIGFwcHJvdmVkLiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IFwiXCIsIDEpO1xuICAgIHF1b3Rlcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIHVwZGF0ZUxpc3QoKTtcbn0pKTtcbiQoZG9jdW1lbnQpLm9uKFwiaW5wdXRcIiwgXCIjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlIC50ZXh0XCIsIChlKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBjb25zdCBpbmRleCA9IHBhcnNlSW50KCQoZS50YXJnZXQpLmNsb3Nlc3QoXCIucXVvdGVcIikuYXR0cihcImlkXCIpKTtcbiAgICAkKGAjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlW2lkPSR7aW5kZXh9XSAudW5kb2ApLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgJChgI3F1b3RlQXBwcm92ZVBvcHVwIC5xdW90ZVtpZD0ke2luZGV4fV0gLmFwcHJvdmVgKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAkKGAjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlW2lkPSR7aW5kZXh9XSAuZWRpdGApLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIHVwZGF0ZVF1b3RlTGVuZ3RoKGluZGV4KTtcbn0pKTtcbiQoZG9jdW1lbnQpLm9uKFwiaW5wdXRcIiwgXCIjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlIC5zb3VyY2VcIiwgKGUpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIGNvbnN0IGluZGV4ID0gcGFyc2VJbnQoJChlLnRhcmdldCkuY2xvc2VzdChcIi5xdW90ZVwiKS5hdHRyKFwiaWRcIikpO1xuICAgICQoYCNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGVbaWQ9JHtpbmRleH1dIC51bmRvYCkucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAkKGAjcXVvdGVBcHByb3ZlUG9wdXAgLnF1b3RlW2lkPSR7aW5kZXh9XSAuYXBwcm92ZWApLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICQoYCNxdW90ZUFwcHJvdmVQb3B1cCAucXVvdGVbaWQ9JHtpbmRleH1dIC5lZGl0YCkucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG59KSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmNsZWFyUXVvdGVTdGF0cyA9IGV4cG9ydHMuc2hvdyA9IGV4cG9ydHMuZ2V0UXVvdGVTdGF0cyA9IHZvaWQgMDtcbmNvbnN0IGFwZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9hcGVcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IFRlc3RXb3JkcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC90ZXN0LXdvcmRzXCIpKTtcbmNvbnN0IExvYWRlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbG9hZGVyXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xubGV0IHJhdGluZyA9IDA7XG5sZXQgcXVvdGVTdGF0cyA9IG51bGw7XG5sZXQgY3VycmVudFF1b3RlID0gbnVsbDtcbmZ1bmN0aW9uIHJlc2V0KCkge1xuICAgICQoYCNxdW90ZVJhdGVQb3B1cCAucXVvdGUgLnRleHRgKS50ZXh0KFwiLVwiKTtcbiAgICAkKGAjcXVvdGVSYXRlUG9wdXAgLnF1b3RlIC5zb3VyY2UgLnZhbGApLnRleHQoXCItXCIpO1xuICAgICQoYCNxdW90ZVJhdGVQb3B1cCAucXVvdGUgLmlkIC52YWxgKS50ZXh0KFwiLVwiKTtcbiAgICAkKGAjcXVvdGVSYXRlUG9wdXAgLnF1b3RlIC5sZW5ndGggLnZhbGApLnRleHQoXCItXCIpO1xuICAgICQoXCIjcXVvdGVSYXRlUG9wdXAgLnJhdGluZ0NvdW50IC52YWxcIikudGV4dChcIi1cIik7XG4gICAgJChcIiNxdW90ZVJhdGVQb3B1cCAucmF0aW5nQXZlcmFnZSAudmFsXCIpLnRleHQoXCItXCIpO1xufVxuZnVuY3Rpb24gZ2V0UmF0aW5nQXZlcmFnZShxdW90ZVN0YXRzKSB7XG4gICAgaWYgKCFxdW90ZVN0YXRzLnRvdGFsUmF0aW5nIHx8ICFxdW90ZVN0YXRzLnJhdGluZ3MpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIHJldHVybiBNYXRoLnJvdW5kKChxdW90ZVN0YXRzLnRvdGFsUmF0aW5nIC8gcXVvdGVTdGF0cy5yYXRpbmdzKSAqIDEwKSAvIDEwO1xufVxuZnVuY3Rpb24gZ2V0UXVvdGVTdGF0cyhxdW90ZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmICghcXVvdGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjdXJyZW50UXVvdGUgPSBxdW90ZTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnF1b3Rlcy5nZXRSYXRpbmcoY3VycmVudFF1b3RlKTtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBnZXQgcXVvdGUgcmF0aW5nczogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFyZXNwb25zZS5kYXRhKSB7XG4gICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgIH1cbiAgICAgICAgcXVvdGVTdGF0cyA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIGlmIChxdW90ZVN0YXRzICYmICFxdW90ZVN0YXRzLmF2ZXJhZ2UpIHtcbiAgICAgICAgICAgIHF1b3RlU3RhdHMuYXZlcmFnZSA9IGdldFJhdGluZ0F2ZXJhZ2UocXVvdGVTdGF0cyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHF1b3RlU3RhdHM7XG4gICAgfSk7XG59XG5leHBvcnRzLmdldFF1b3RlU3RhdHMgPSBnZXRRdW90ZVN0YXRzO1xuZnVuY3Rpb24gcmVmcmVzaFN0YXJzKGZvcmNlKSB7XG4gICAgY29uc3QgbGltaXQgPSBmb3JjZSA/IGZvcmNlIDogcmF0aW5nO1xuICAgICQoYCNxdW90ZVJhdGVQb3B1cCAuc3RhcmApLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IGxpbWl0OyBpKyspIHtcbiAgICAgICAgJChgI3F1b3RlUmF0ZVBvcHVwIC5zdGFyW3JhdGluZz0ke2l9XWApLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHVwZGF0ZVJhdGluZ1N0YXRzKCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmICghcXVvdGVTdGF0cylcbiAgICAgICAgICAgIHlpZWxkIGdldFF1b3RlU3RhdHMoKTtcbiAgICAgICAgJChcIiNxdW90ZVJhdGVQb3B1cCAucmF0aW5nQ291bnQgLnZhbFwiKS50ZXh0KChfYSA9IHF1b3RlU3RhdHMgPT09IG51bGwgfHwgcXVvdGVTdGF0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcXVvdGVTdGF0cy5yYXRpbmdzKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIjBcIik7XG4gICAgICAgICQoXCIjcXVvdGVSYXRlUG9wdXAgLnJhdGluZ0F2ZXJhZ2UgLnZhbFwiKS50ZXh0KChfYyA9IChfYiA9IHF1b3RlU3RhdHMgPT09IG51bGwgfHwgcXVvdGVTdGF0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcXVvdGVTdGF0cy5hdmVyYWdlKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudG9GaXhlZCgxKSkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogXCItXCIpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gdXBkYXRlRGF0YSgpIHtcbiAgICBpZiAoIWN1cnJlbnRRdW90ZSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGxldCBsZW5ndGhEZXNjO1xuICAgIGlmIChjdXJyZW50UXVvdGUuZ3JvdXAgPT0gMCkge1xuICAgICAgICBsZW5ndGhEZXNjID0gXCJzaG9ydFwiO1xuICAgIH1cbiAgICBlbHNlIGlmIChjdXJyZW50UXVvdGUuZ3JvdXAgPT0gMSkge1xuICAgICAgICBsZW5ndGhEZXNjID0gXCJtZWRpdW1cIjtcbiAgICB9XG4gICAgZWxzZSBpZiAoY3VycmVudFF1b3RlLmdyb3VwID09IDIpIHtcbiAgICAgICAgbGVuZ3RoRGVzYyA9IFwibG9uZ1wiO1xuICAgIH1cbiAgICBlbHNlIGlmIChjdXJyZW50UXVvdGUuZ3JvdXAgPT0gMykge1xuICAgICAgICBsZW5ndGhEZXNjID0gXCJ0aGljY1wiO1xuICAgIH1cbiAgICAkKGAjcXVvdGVSYXRlUG9wdXAgLnF1b3RlIC50ZXh0YCkudGV4dChjdXJyZW50UXVvdGUudGV4dCk7XG4gICAgJChgI3F1b3RlUmF0ZVBvcHVwIC5xdW90ZSAuc291cmNlIC52YWxgKS50ZXh0KGN1cnJlbnRRdW90ZS5zb3VyY2UpO1xuICAgICQoYCNxdW90ZVJhdGVQb3B1cCAucXVvdGUgLmlkIC52YWxgKS50ZXh0KGN1cnJlbnRRdW90ZS5pZCk7XG4gICAgJChgI3F1b3RlUmF0ZVBvcHVwIC5xdW90ZSAubGVuZ3RoIC52YWxgKS50ZXh0KGxlbmd0aERlc2MpO1xuICAgIHVwZGF0ZVJhdGluZ1N0YXRzKCk7XG59XG5mdW5jdGlvbiBzaG93KHF1b3RlLCBzaG91bGRSZXNldCA9IHRydWUpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGlmICgkKFwiI3F1b3RlUmF0ZVBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICBpZiAoc2hvdWxkUmVzZXQpIHtcbiAgICAgICAgICAgIHJlc2V0KCk7XG4gICAgICAgIH1cbiAgICAgICAgY3VycmVudFF1b3RlID0gcXVvdGU7XG4gICAgICAgIHJhdGluZyA9IDA7XG4gICAgICAgIGNvbnN0IHNuYXBzaG90ID0gREIuZ2V0U25hcHNob3QoKTtcbiAgICAgICAgY29uc3QgYWxyZWFkeVJhdGVkID0gKF9iID0gKF9hID0gc25hcHNob3QgPT09IG51bGwgfHwgc25hcHNob3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNuYXBzaG90LnF1b3RlUmF0aW5ncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hW2N1cnJlbnRRdW90ZS5sYW5ndWFnZV0pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYltjdXJyZW50UXVvdGUuaWRdO1xuICAgICAgICBpZiAoYWxyZWFkeVJhdGVkKSB7XG4gICAgICAgICAgICByYXRpbmcgPSBhbHJlYWR5UmF0ZWQ7XG4gICAgICAgIH1cbiAgICAgICAgcmVmcmVzaFN0YXJzKCk7XG4gICAgICAgIHVwZGF0ZURhdGEoKTtcbiAgICAgICAgJChcIiNxdW90ZVJhdGVQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTI1KTtcbiAgICB9XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICBpZiAoISQoXCIjcXVvdGVSYXRlUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjcXVvdGVSYXRlUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNxdW90ZVJhdGVQb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGNsZWFyUXVvdGVTdGF0cygpIHtcbiAgICBxdW90ZVN0YXRzID0gbnVsbDtcbn1cbmV4cG9ydHMuY2xlYXJRdW90ZVN0YXRzID0gY2xlYXJRdW90ZVN0YXRzO1xuZnVuY3Rpb24gc3VibWl0KCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChyYXRpbmcgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIlBsZWFzZSBzZWxlY3QgYSByYXRpbmdcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjdXJyZW50UXVvdGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBoaWRlKCk7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5xdW90ZXMuYWRkUmF0aW5nKGN1cnJlbnRRdW90ZSwgcmF0aW5nKTtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gc3VibWl0IHF1b3RlIHJhdGluZzogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdCgpO1xuICAgICAgICBjb25zdCBxdW90ZVJhdGluZ3MgPSAoX2EgPSBzbmFwc2hvdC5xdW90ZVJhdGluZ3MpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHt9O1xuICAgICAgICBpZiAoKF9iID0gcXVvdGVSYXRpbmdzID09PSBudWxsIHx8IHF1b3RlUmF0aW5ncyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcXVvdGVSYXRpbmdzW2N1cnJlbnRRdW90ZS5sYW5ndWFnZV0pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYltjdXJyZW50UXVvdGUuaWRdKSB7XG4gICAgICAgICAgICBjb25zdCBvbGRSYXRpbmcgPSBxdW90ZVJhdGluZ3NbY3VycmVudFF1b3RlLmxhbmd1YWdlXVtjdXJyZW50UXVvdGUuaWRdO1xuICAgICAgICAgICAgY29uc3QgZGlmZiA9IHJhdGluZyAtIG9sZFJhdGluZztcbiAgICAgICAgICAgIHF1b3RlUmF0aW5nc1tjdXJyZW50UXVvdGUubGFuZ3VhZ2VdW2N1cnJlbnRRdW90ZS5pZF0gPSByYXRpbmc7XG4gICAgICAgICAgICBxdW90ZVN0YXRzID0ge1xuICAgICAgICAgICAgICAgIHJhdGluZ3M6IHF1b3RlU3RhdHMgPT09IG51bGwgfHwgcXVvdGVTdGF0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcXVvdGVTdGF0cy5yYXRpbmdzLFxuICAgICAgICAgICAgICAgIHRvdGFsUmF0aW5nOiBpc05hTihxdW90ZVN0YXRzID09PSBudWxsIHx8IHF1b3RlU3RhdHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHF1b3RlU3RhdHMudG90YWxSYXRpbmcpXG4gICAgICAgICAgICAgICAgICAgID8gMFxuICAgICAgICAgICAgICAgICAgICA6IChxdW90ZVN0YXRzID09PSBudWxsIHx8IHF1b3RlU3RhdHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHF1b3RlU3RhdHMudG90YWxSYXRpbmcpICsgZGlmZixcbiAgICAgICAgICAgICAgICBxdW90ZUlkOiBjdXJyZW50UXVvdGUuaWQsXG4gICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IGN1cnJlbnRRdW90ZS5sYW5ndWFnZSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlJhdGluZyB1cGRhdGVkXCIsIDEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKCFxdW90ZVJhdGluZ3NbY3VycmVudFF1b3RlLmxhbmd1YWdlXSkge1xuICAgICAgICAgICAgICAgIHF1b3RlUmF0aW5nc1tjdXJyZW50UXVvdGUubGFuZ3VhZ2VdID0ge307XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBxdW90ZVJhdGluZ3NbY3VycmVudFF1b3RlLmxhbmd1YWdlXVtjdXJyZW50UXVvdGUuaWRdID0gcmF0aW5nO1xuICAgICAgICAgICAgaWYgKChxdW90ZVN0YXRzID09PSBudWxsIHx8IHF1b3RlU3RhdHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHF1b3RlU3RhdHMucmF0aW5ncykgJiYgcXVvdGVTdGF0cy50b3RhbFJhdGluZykge1xuICAgICAgICAgICAgICAgIHF1b3RlU3RhdHMucmF0aW5ncysrO1xuICAgICAgICAgICAgICAgIHF1b3RlU3RhdHMudG90YWxSYXRpbmcgKz0gcmF0aW5nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcXVvdGVTdGF0cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgcmF0aW5nczogMSxcbiAgICAgICAgICAgICAgICAgICAgdG90YWxSYXRpbmc6IHJhdGluZyxcbiAgICAgICAgICAgICAgICAgICAgcXVvdGVJZDogY3VycmVudFF1b3RlLmlkLFxuICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogY3VycmVudFF1b3RlLmxhbmd1YWdlLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlJhdGluZyBzdWJtaXR0ZWRcIiwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgc25hcHNob3QucXVvdGVSYXRpbmdzID0gcXVvdGVSYXRpbmdzO1xuICAgICAgICBEQi5zZXRTbmFwc2hvdChzbmFwc2hvdCk7XG4gICAgICAgIHF1b3RlU3RhdHMuYXZlcmFnZSA9IGdldFJhdGluZ0F2ZXJhZ2UocXVvdGVTdGF0cyk7XG4gICAgICAgICQoXCIucGFnZVRlc3QgI3Jlc3VsdCAjcmF0ZVF1b3RlQnV0dG9uIC5yYXRpbmdcIikudGV4dCgoX2MgPSBxdW90ZVN0YXRzLmF2ZXJhZ2UpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy50b0ZpeGVkKDEpKTtcbiAgICAgICAgJChcIi5wYWdlVGVzdCAjcmVzdWx0ICNyYXRlUXVvdGVCdXR0b24gLmljb25cIikucmVtb3ZlQ2xhc3MoXCJmYXJcIik7XG4gICAgICAgICQoXCIucGFnZVRlc3QgI3Jlc3VsdCAjcmF0ZVF1b3RlQnV0dG9uIC5pY29uXCIpLmFkZENsYXNzKFwiZmFzXCIpO1xuICAgIH0pO1xufVxuJChcIiNxdW90ZVJhdGVQb3B1cFdyYXBwZXJcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwicXVvdGVSYXRlUG9wdXBXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuJChcIiNxdW90ZVJhdGVQb3B1cCAuc3RhcnMgLnN0YXJcIikuaG92ZXIoKGUpID0+IHtcbiAgICBjb25zdCByYXRpbmdIb3ZlciA9IHBhcnNlSW50KCQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwicmF0aW5nXCIpKTtcbiAgICByZWZyZXNoU3RhcnMocmF0aW5nSG92ZXIpO1xufSk7XG4kKFwiI3F1b3RlUmF0ZVBvcHVwIC5zdGFycyAuc3RhclwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgY29uc3QgcmF0aW5nSG92ZXIgPSBwYXJzZUludCgkKGUuY3VycmVudFRhcmdldCkuYXR0cihcInJhdGluZ1wiKSk7XG4gICAgcmF0aW5nID0gcmF0aW5nSG92ZXI7XG59KTtcbiQoXCIjcXVvdGVSYXRlUG9wdXAgLnN0YXJzIC5zdGFyXCIpLm1vdXNlb3V0KCgpID0+IHtcbiAgICAkKGAjcXVvdGVSYXRlUG9wdXAgLnN0YXJgKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICByZWZyZXNoU3RhcnMoKTtcbn0pO1xuJChcIiNxdW90ZVJhdGVQb3B1cCAuc3VibWl0QnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHN1Ym1pdCgpO1xufSk7XG4kKFwiLnBhZ2VUZXN0ICNyYXRlUXVvdGVCdXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAvLyBUT0RPIHJlbW92ZSB0aGlzIHdoZW4gZG9uZSB3aXRoIFRlc3RXb3Jkc1xuICAgIHNob3coVGVzdFdvcmRzLnJhbmRvbVF1b3RlKTtcbn0pKTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGlkZSA9IGV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmNvbnN0IGFwZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9hcGVcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBUZXN0V29yZHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC13b3Jkc1wiKSk7XG5jb25zdCBMb2FkZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2xvYWRlclwiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IHF1b3Rlc19jb250cm9sbGVyXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL3F1b3Rlcy1jb250cm9sbGVyXCIpKTtcbmNvbnN0IENBUFRDSEFfSUQgPSAxO1xuY29uc3Qgc3RhdGUgPSB7XG4gICAgcHJldmlvdXNQb3B1cFNob3dDYWxsYmFjazogdW5kZWZpbmVkLFxuICAgIHF1b3RlVG9SZXBvcnQ6IHVuZGVmaW5lZCxcbn07XG5jb25zdCBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgICBxdW90ZUlkOiAtMSxcbiAgICBwcmV2aW91c1BvcHVwU2hvd0NhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgIC8vXG4gICAgfSxcbiAgICBub0FuaW06IGZhbHNlLFxufTtcbmZ1bmN0aW9uIHNob3cob3B0aW9ucyA9IGRlZmF1bHRPcHRpb25zKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmICgkKFwiI3F1b3RlUmVwb3J0UG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICAgICBjb25zdCB7IHF1b3RlSWQsIHByZXZpb3VzUG9wdXBTaG93Q2FsbGJhY2ssIG5vQW5pbSB9ID0gb3B0aW9ucztcbiAgICAgICAgICAgIHN0YXRlLnByZXZpb3VzUG9wdXBTaG93Q2FsbGJhY2sgPSBwcmV2aW91c1BvcHVwU2hvd0NhbGxiYWNrO1xuICAgICAgICAgICAgY29uc3QgeyBxdW90ZXMgfSA9IHlpZWxkIHF1b3Rlc19jb250cm9sbGVyXzEuZGVmYXVsdC5nZXRRdW90ZXMoY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSk7XG4gICAgICAgICAgICBzdGF0ZS5xdW90ZVRvUmVwb3J0ID0gcXVvdGVzLmZpbmQoKHF1b3RlKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHF1b3RlLmlkID09PSBxdW90ZUlkO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkKFwiI3F1b3RlUmVwb3J0UG9wdXAgLnF1b3RlXCIpLnRleHQoKF9hID0gc3RhdGUucXVvdGVUb1JlcG9ydCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRleHQpO1xuICAgICAgICAgICAgJChcIiNxdW90ZVJlcG9ydFBvcHVwIC5yZWFzb25cIikudmFsKFwiR3JhbW1hdGljYWwgZXJyb3JcIik7XG4gICAgICAgICAgICAkKFwiI3F1b3RlUmVwb3J0UG9wdXAgLmNvbW1lbnRcIikudmFsKFwiXCIpO1xuICAgICAgICAgICAgJChcIiNxdW90ZVJlcG9ydFBvcHVwIC5jaGFyYWN0ZXJDb3VudFwiKS50ZXh0KFwiLVwiKTtcbiAgICAgICAgICAgICQoXCIjcXVvdGVSZXBvcnRQb3B1cCAucmVhc29uXCIpLnNlbGVjdDIoe1xuICAgICAgICAgICAgICAgIG1pbmltdW1SZXN1bHRzRm9yU2VhcmNoOiBJbmZpbml0eSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJChcIiNxdW90ZVJlcG9ydFBvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgbm9BbmltID8gMCA6IDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICQoXCIjcXVvdGVSZXBvcnRQb3B1cCB0ZXh0YXJlYVwiKS50cmlnZ2VyKFwiZm9jdXNcIikuc2VsZWN0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKCEkKFwiI3F1b3RlUmVwb3J0UG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICAgICBjb25zdCBub0FuaW0gPSBzdGF0ZS5wcmV2aW91c1BvcHVwU2hvd0NhbGxiYWNrID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgJChcIiNxdW90ZVJlcG9ydFBvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgIH0sIG5vQW5pbSA/IDAgOiAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICAgICBncmVjYXB0Y2hhLnJlc2V0KENBUFRDSEFfSUQpO1xuICAgICAgICAgICAgICAgICQoXCIjcXVvdGVSZXBvcnRQb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXRlLnByZXZpb3VzUG9wdXBTaG93Q2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdGUucHJldmlvdXNQb3B1cFNob3dDYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuZnVuY3Rpb24gc3VibWl0UmVwb3J0KCkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCBjYXB0Y2hhUmVzcG9uc2UgPSBncmVjYXB0Y2hhLmdldFJlc3BvbnNlKENBUFRDSEFfSUQpO1xuICAgICAgICBpZiAoIWNhcHRjaGFSZXNwb25zZSkge1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiUGxlYXNlIGNvbXBsZXRlIHRoZSBjYXB0Y2hhLlwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBxdW90ZUlkID0gKF9hID0gc3RhdGUucXVvdGVUb1JlcG9ydCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlkLnRvU3RyaW5nKCk7XG4gICAgICAgIGNvbnN0IHF1b3RlTGFuZ3VhZ2UgPSBjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlO1xuICAgICAgICBjb25zdCByZWFzb24gPSAkKFwiI3F1b3RlUmVwb3J0UG9wdXAgLnJlYXNvblwiKS52YWwoKTtcbiAgICAgICAgY29uc3QgY29tbWVudCA9ICQoXCIjcXVvdGVSZXBvcnRQb3B1cCAuY29tbWVudFwiKS52YWwoKTtcbiAgICAgICAgY29uc3QgY2FwdGNoYSA9IGNhcHRjaGFSZXNwb25zZTtcbiAgICAgICAgaWYgKCFxdW90ZUlkKSB7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJQbGVhc2Ugc2VsZWN0IGEgcXVvdGUuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghcmVhc29uKSB7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJQbGVhc2Ugc2VsZWN0IGEgdmFsaWQgcmVwb3J0IHJlYXNvbi5cIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhcmFjdGVyRGlmZmVyZW5jZSA9IGNvbW1lbnQubGVuZ3RoIC0gMjUwO1xuICAgICAgICBpZiAoY2hhcmFjdGVyRGlmZmVyZW5jZSA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChgUmVwb3J0IGNvbW1lbnQgaXMgJHtjaGFyYWN0ZXJEaWZmZXJlbmNlfSBjaGFyYWN0ZXIocykgdG9vIGxvbmcuYCk7XG4gICAgICAgIH1cbiAgICAgICAgTG9hZGVyLnNob3coKTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnF1b3Rlcy5yZXBvcnQocXVvdGVJZCwgcXVvdGVMYW5ndWFnZSwgcmVhc29uLCBjb21tZW50LCBjYXB0Y2hhKTtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gcmVwb3J0IHF1b3RlOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlJlcG9ydCBzdWJtaXR0ZWQuIFRoYW5rIHlvdSFcIiwgMSk7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9KTtcbn1cbiQoXCIjcXVvdGVSZXBvcnRQb3B1cFdyYXBwZXJcIikub24oXCJtb3VzZWRvd25cIiwgKGUpID0+IHtcbiAgICBpZiAoJChlLnRhcmdldCkuYXR0cihcImlkXCIpID09PSBcInF1b3RlUmVwb3J0UG9wdXBXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZSgpO1xuICAgIH1cbn0pO1xuJChcIiNxdW90ZVJlcG9ydFBvcHVwIC5jb21tZW50XCIpLm9uKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBjb25zdCBsZW4gPSAkKFwiI3F1b3RlUmVwb3J0UG9wdXAgLmNvbW1lbnRcIikudmFsKCkubGVuZ3RoO1xuICAgICAgICAkKFwiI3F1b3RlUmVwb3J0UG9wdXAgLmNoYXJhY3RlckNvdW50XCIpLnRleHQobGVuKTtcbiAgICAgICAgaWYgKGxlbiA+IDI1MCkge1xuICAgICAgICAgICAgJChcIiNxdW90ZVJlcG9ydFBvcHVwIC5jaGFyYWN0ZXJDb3VudFwiKS5hZGRDbGFzcyhcInJlZFwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIjcXVvdGVSZXBvcnRQb3B1cCAuY2hhcmFjdGVyQ291bnRcIikucmVtb3ZlQ2xhc3MoXCJyZWRcIik7XG4gICAgICAgIH1cbiAgICB9LCAxKTtcbn0pO1xuJChcIiNxdW90ZVJlcG9ydFBvcHVwIC5zdWJtaXRcIikub24oXCJjbGlja1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB5aWVsZCBzdWJtaXRSZXBvcnQoKTtcbn0pKTtcbiQoXCIucGFnZVRlc3QgI3JlcG9ydFF1b3RlQnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdmFyIF9hO1xuICAgIHNob3coe1xuICAgICAgICBxdW90ZUlkOiAoX2EgPSBUZXN0V29yZHMucmFuZG9tUXVvdGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pZCxcbiAgICAgICAgbm9BbmltOiBmYWxzZSxcbiAgICB9KTtcbn0pKTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuYXBwbHkgPSBleHBvcnRzLmhpZGUgPSBleHBvcnRzLnNob3cgPSBleHBvcnRzLnNldFNlbGVjdGVkSWQgPSBleHBvcnRzLnNlbGVjdGVkSWQgPSB2b2lkIDA7XG5jb25zdCBUZXN0VUkgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvdGVzdC11aVwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgTWFudWFsUmVzdGFydCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdGVzdC9tYW51YWwtcmVzdGFydC10cmFja2VyXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgUXVvdGVTdWJtaXRQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9xdW90ZS1zdWJtaXQtcG9wdXBcIikpO1xuY29uc3QgUXVvdGVBcHByb3ZlUG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vcXVvdGUtYXBwcm92ZS1wb3B1cFwiKSk7XG5jb25zdCBRdW90ZVJlcG9ydFBvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3F1b3RlLXJlcG9ydC1wb3B1cFwiKSk7XG5jb25zdCBzZWFyY2hfc2VydmljZV8xID0gcmVxdWlyZShcIi4uL3V0aWxzL3NlYXJjaC1zZXJ2aWNlXCIpO1xuY29uc3QgZGVib3VuY2VfMSA9IHJlcXVpcmUoXCIuLi91dGlscy9kZWJvdW5jZVwiKTtcbmNvbnN0IHN0cmluZ3NfMSA9IHJlcXVpcmUoXCIuLi91dGlscy9zdHJpbmdzXCIpO1xuY29uc3QgcXVvdGVzX2NvbnRyb2xsZXJfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvcXVvdGVzLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgZmlyZWJhc2VfMSA9IHJlcXVpcmUoXCIuLi9maXJlYmFzZVwiKTtcbmV4cG9ydHMuc2VsZWN0ZWRJZCA9IDE7XG5mdW5jdGlvbiBzZXRTZWxlY3RlZElkKHZhbCkge1xuICAgIGV4cG9ydHMuc2VsZWN0ZWRJZCA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0U2VsZWN0ZWRJZCA9IHNldFNlbGVjdGVkSWQ7XG5jb25zdCBzZWFyY2hTZXJ2aWNlQ2FjaGUgPSB7fTtcbmZ1bmN0aW9uIGdldFNlYXJjaFNlcnZpY2UobGFuZ3VhZ2UsIGRhdGEsIHRleHRFeHRyYWN0b3IpIHtcbiAgICBpZiAobGFuZ3VhZ2UgaW4gc2VhcmNoU2VydmljZUNhY2hlKSB7XG4gICAgICAgIHJldHVybiBzZWFyY2hTZXJ2aWNlQ2FjaGVbbGFuZ3VhZ2VdO1xuICAgIH1cbiAgICBjb25zdCBuZXdTZWFyY2hTZXJ2aWNlID0gKDAsIHNlYXJjaF9zZXJ2aWNlXzEuYnVpbGRTZWFyY2hTZXJ2aWNlKShkYXRhLCB0ZXh0RXh0cmFjdG9yKTtcbiAgICBzZWFyY2hTZXJ2aWNlQ2FjaGVbbGFuZ3VhZ2VdID0gbmV3U2VhcmNoU2VydmljZTtcbiAgICByZXR1cm4gbmV3U2VhcmNoU2VydmljZTtcbn1cbmZ1bmN0aW9uIGhpZ2hsaWdodE1hdGNoZXModGV4dCwgbWF0Y2hlZFRleHQpIHtcbiAgICBpZiAobWF0Y2hlZFRleHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB0ZXh0O1xuICAgIH1cbiAgICBjb25zdCB3b3JkcyA9ICgwLCBzdHJpbmdzXzEuc3BsaXRCeUFuZEtlZXApKHRleHQsIGAuLFwiLyMhJCVeJio7Ont9PS1fXFxgfigpIGAuc3BsaXQoXCJcIikpO1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRXb3JkcyA9IHdvcmRzLm1hcCgod29yZCkgPT4ge1xuICAgICAgICBjb25zdCBzaG91bGRIaWdobGlnaHQgPSBtYXRjaGVkVGV4dC5maW5kKChtYXRjaCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHdvcmQuc3RhcnRzV2l0aChtYXRjaCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gc2hvdWxkSGlnaGxpZ2h0ID8gYDxzcGFuIGNsYXNzPVwiaGlnaGxpZ2h0XCI+JHt3b3JkfTwvc3Bhbj5gIDogd29yZDtcbiAgICB9KTtcbiAgICByZXR1cm4gbm9ybWFsaXplZFdvcmRzLmpvaW4oXCJcIik7XG59XG5mdW5jdGlvbiBhcHBseVF1b3RlTGVuZ3RoRmlsdGVyKHF1b3Rlcykge1xuICAgIGNvbnN0IHF1b3RlTGVuZ3RoRmlsdGVyVmFsdWUgPSAkKFwiI3F1b3RlU2VhcmNoUG9wdXAgLnF1b3RlTGVuZ3RoRmlsdGVyXCIpLnZhbCgpO1xuICAgIGlmIChxdW90ZUxlbmd0aEZpbHRlclZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcXVvdGVzO1xuICAgIH1cbiAgICBjb25zdCBxdW90ZUxlbmd0aEZpbHRlciA9IHF1b3RlTGVuZ3RoRmlsdGVyVmFsdWUubWFwKChmaWx0ZXJWYWx1ZSkgPT4gcGFyc2VJbnQoZmlsdGVyVmFsdWUsIDEwKSk7XG4gICAgY29uc3QgZmlsdGVyZWRRdW90ZXMgPSBxdW90ZXMuZmlsdGVyKChxdW90ZSkgPT4gcXVvdGVMZW5ndGhGaWx0ZXIuaW5jbHVkZXMocXVvdGUuZ3JvdXApKTtcbiAgICByZXR1cm4gZmlsdGVyZWRRdW90ZXM7XG59XG5mdW5jdGlvbiBidWlsZFF1b3RlU2VhcmNoUmVzdWx0KHF1b3RlLCBtYXRjaGVkU2VhcmNoVGVybXMpIHtcbiAgICBsZXQgbGVuZ3RoRGVzYztcbiAgICBpZiAocXVvdGUubGVuZ3RoIDwgMTAxKSB7XG4gICAgICAgIGxlbmd0aERlc2MgPSBcInNob3J0XCI7XG4gICAgfVxuICAgIGVsc2UgaWYgKHF1b3RlLmxlbmd0aCA8IDMwMSkge1xuICAgICAgICBsZW5ndGhEZXNjID0gXCJtZWRpdW1cIjtcbiAgICB9XG4gICAgZWxzZSBpZiAocXVvdGUubGVuZ3RoIDwgNjAxKSB7XG4gICAgICAgIGxlbmd0aERlc2MgPSBcImxvbmdcIjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGxlbmd0aERlc2MgPSBcInRoaWNjXCI7XG4gICAgfVxuICAgIGNvbnN0IGlzTm90QXV0aGVkID0gIWZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICByZXR1cm4gYFxuICA8ZGl2IGNsYXNzPVwic2VhcmNoUmVzdWx0XCIgaWQ9XCIke3F1b3RlLmlkfVwiPlxuICAgIDxkaXYgY2xhc3M9XCJ0ZXh0XCI+XG4gICAgICAke2hpZ2hsaWdodE1hdGNoZXMocXVvdGUudGV4dCwgbWF0Y2hlZFNlYXJjaFRlcm1zKX1cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwiaWRcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJzdWJcIj5pZDwvZGl2PlxuICAgICAgPHNwYW4gY2xhc3M9XCJxdW90ZS1pZFwiPlxuICAgICAgICAke2hpZ2hsaWdodE1hdGNoZXMocXVvdGUuaWQudG9TdHJpbmcoKSwgbWF0Y2hlZFNlYXJjaFRlcm1zKX1cbiAgICAgIDwvc3Bhbj5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwibGVuZ3RoXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwic3ViXCI+bGVuZ3RoPC9kaXY+XG4gICAgICAke2xlbmd0aERlc2N9XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cInNvdXJjZVwiPlxuICAgICAgPGRpdiBjbGFzcz1cInN1YlwiPnNvdXJjZTwvZGl2PlxuICAgICAgJHtoaWdobGlnaHRNYXRjaGVzKHF1b3RlLnNvdXJjZSwgbWF0Y2hlZFNlYXJjaFRlcm1zKX08L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwiaWNvbi1idXR0b24gcmVwb3J0ICR7aXNOb3RBdXRoZWQgJiYgXCJoaWRkZW5cIn1cIiBhcmlhLWxhYmVsPVwiUmVwb3J0IHF1b3RlXCIgZGF0YS1iYWxsb29uLXBvcz1cImxlZnRcIj5cbiAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLWZsYWcgcmVwb3J0XCI+PC9pPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbiAgYDtcbn1cbmZ1bmN0aW9uIHVwZGF0ZVJlc3VsdHMoc2VhcmNoVGV4dCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IHsgcXVvdGVzIH0gPSB5aWVsZCBxdW90ZXNfY29udHJvbGxlcl8xLmRlZmF1bHQuZ2V0UXVvdGVzKGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UpO1xuICAgICAgICBjb25zdCBxdW90ZVNlYXJjaFNlcnZpY2UgPSBnZXRTZWFyY2hTZXJ2aWNlKGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UsIHF1b3RlcywgKHF1b3RlKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYCR7cXVvdGUudGV4dH0gJHtxdW90ZS5pZH0gJHtxdW90ZS5zb3VyY2V9YDtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHsgcmVzdWx0czogbWF0Y2hlcywgbWF0Y2hlZFF1ZXJ5VGVybXMgfSA9IHF1b3RlU2VhcmNoU2VydmljZS5xdWVyeShzZWFyY2hUZXh0KTtcbiAgICAgICAgY29uc3QgcXVvdGVzVG9TaG93ID0gYXBwbHlRdW90ZUxlbmd0aEZpbHRlcihzZWFyY2hUZXh0ID09PSBcIlwiID8gcXVvdGVzIDogbWF0Y2hlcyk7XG4gICAgICAgIGNvbnN0IHJlc3VsdHNMaXN0ID0gJChcIiNxdW90ZVNlYXJjaFJlc3VsdHNcIik7XG4gICAgICAgIHJlc3VsdHNMaXN0LmVtcHR5KCk7XG4gICAgICAgIHF1b3Rlc1RvU2hvdy5zbGljZSgwLCAxMDApLmZvckVhY2goKHF1b3RlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBxdW90ZVNlYXJjaFJlc3VsdCA9IGJ1aWxkUXVvdGVTZWFyY2hSZXN1bHQocXVvdGUsIG1hdGNoZWRRdWVyeVRlcm1zKTtcbiAgICAgICAgICAgIHJlc3VsdHNMaXN0LmFwcGVuZChxdW90ZVNlYXJjaFJlc3VsdCk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCByZXN1bHRzRXhjZWVkZWRUZXh0ID0gcXVvdGVzVG9TaG93Lmxlbmd0aCA+IDEwMFxuICAgICAgICAgICAgPyBcIjxzcGFuIHN0eWxlPSdvcGFjaXR5OiAwLjUnPihvbmx5IHNob3dpbmcgMTAwKTwvc3Bhbj5cIlxuICAgICAgICAgICAgOiBcIlwiO1xuICAgICAgICAkKFwiI2V4dHJhUmVzdWx0c1wiKS5odG1sKGAke3F1b3Rlc1RvU2hvdy5sZW5ndGh9IHJlc3VsdHMgJHtyZXN1bHRzRXhjZWVkZWRUZXh0fWApO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gc2hvdyhjbGVhclRleHQgPSB0cnVlKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmICgkKFwiI3F1b3RlU2VhcmNoUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICAgICBpZiAoY2xlYXJUZXh0KSB7XG4gICAgICAgICAgICAgICAgJChcIiNxdW90ZVNlYXJjaFBvcHVwIGlucHV0XCIpLnZhbChcIlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHF1b3RlU2VhcmNoSW5wdXRWYWx1ZSA9ICQoXCIjcXVvdGVTZWFyY2hQb3B1cCBpbnB1dFwiKS52YWwoKTtcbiAgICAgICAgICAgIGlmICghZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyKSB7XG4gICAgICAgICAgICAgICAgJChcIiNxdW90ZVNlYXJjaFBvcHVwICNnb3RvU3VibWl0UXVvdGVCdXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKFwiI3F1b3RlU2VhcmNoUG9wdXAgI2dvdG9TdWJtaXRRdW90ZUJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgoX2EgPSBEQi5nZXRTbmFwc2hvdCgpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucXVvdGVNb2QpIHtcbiAgICAgICAgICAgICAgICAkKFwiI3F1b3RlU2VhcmNoUG9wdXAgI2dvVG9BcHByb3ZlUXVvdGVzXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJChcIiNxdW90ZVNlYXJjaFBvcHVwICNnb1RvQXBwcm92ZVF1b3Rlc1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQoXCIjcXVvdGVTZWFyY2hQb3B1cCAucXVvdGVMZW5ndGhGaWx0ZXJcIikuc2VsZWN0Mih7XG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IFwiRmlsdGVyIGJ5IGxlbmd0aFwiLFxuICAgICAgICAgICAgICAgIG1heGltdW1TZWxlY3Rpb25MZW5ndGg6IEluZmluaXR5LFxuICAgICAgICAgICAgICAgIG11bHRpcGxlOiB0cnVlLFxuICAgICAgICAgICAgICAgIHdpZHRoOiBcIjEwMCVcIixcbiAgICAgICAgICAgICAgICBkYXRhOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJzaG9ydFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IFwibWVkaXVtXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAyLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJsb25nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAzLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJ0aGljY1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICQoXCIjcXVvdGVTZWFyY2hQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjbGVhclRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgJChcIiNxdW90ZVNlYXJjaFBvcHVwIGlucHV0XCIpLnRyaWdnZXIoXCJmb2N1c1wiKS5zZWxlY3QoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdXBkYXRlUmVzdWx0cyhxdW90ZVNlYXJjaElucHV0VmFsdWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKG5vQW5pbSA9IGZhbHNlLCBmb2N1c1dvcmRzID0gdHJ1ZSkge1xuICAgIGlmICghJChcIiNxdW90ZVNlYXJjaFBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI3F1b3RlU2VhcmNoUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIG5vQW5pbSA/IDAgOiAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjcXVvdGVTZWFyY2hQb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICBpZiAoZm9jdXNXb3Jkcykge1xuICAgICAgICAgICAgICAgIFRlc3RVSS5mb2N1c1dvcmRzKCk7XG4gICAgICAgICAgICAgICAgJChcIiNxdW90ZVNlYXJjaFBvcHVwIC5xdW90ZUxlbmd0aEZpbHRlclwiKS52YWwoW10pO1xuICAgICAgICAgICAgICAgICQoXCIjcXVvdGVTZWFyY2hQb3B1cCAucXVvdGVMZW5ndGhGaWx0ZXJcIikudHJpZ2dlcihcImNoYW5nZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbmZ1bmN0aW9uIGFwcGx5KHZhbCkge1xuICAgIGlmIChpc05hTih2YWwpKSB7XG4gICAgICAgIHZhbCA9IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2VhcmNoQm94XCIpLnZhbHVlKTtcbiAgICB9XG4gICAgbGV0IHJldDtcbiAgICBpZiAodmFsICE9PSBudWxsICYmICFpc05hTih2YWwpICYmIHZhbCA+PSAwKSB7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRRdW90ZUxlbmd0aCgtMiwgZmFsc2UpO1xuICAgICAgICBleHBvcnRzLnNlbGVjdGVkSWQgPSB2YWw7XG4gICAgICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgICAgIHJldCA9IHRydWU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlF1b3RlIElEIG11c3QgYmUgYXQgbGVhc3QgMVwiLCAwKTtcbiAgICAgICAgcmV0ID0gZmFsc2U7XG4gICAgfVxuICAgIGhpZGUoKTtcbiAgICByZXR1cm4gcmV0O1xufVxuZXhwb3J0cy5hcHBseSA9IGFwcGx5O1xuY29uc3Qgc2VhcmNoRm9yUXVvdGVzID0gKDAsIGRlYm91bmNlXzEuZGVib3VuY2UpKCgpID0+IHtcbiAgICBjb25zdCBzZWFyY2hUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzZWFyY2hCb3hcIilcbiAgICAgICAgLnZhbHVlO1xuICAgIHVwZGF0ZVJlc3VsdHMoc2VhcmNoVGV4dCk7XG59KTtcbiQoXCIjcXVvdGVTZWFyY2hQb3B1cCAuc2VhcmNoQm94XCIpLm9uKFwia2V5dXBcIiwgKGUpID0+IHtcbiAgICBpZiAoZS5jb2RlID09PSBcIkVzY2FwZVwiKVxuICAgICAgICByZXR1cm47XG4gICAgc2VhcmNoRm9yUXVvdGVzKCk7XG59KTtcbiQoXCIjcXVvdGVTZWFyY2hQb3B1cCAucXVvdGVMZW5ndGhGaWx0ZXJcIikub24oXCJjaGFuZ2VcIiwgc2VhcmNoRm9yUXVvdGVzKTtcbiQoXCIjcXVvdGVTZWFyY2hQb3B1cFdyYXBwZXJcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwicXVvdGVTZWFyY2hQb3B1cFdyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3F1b3RlU2VhcmNoUG9wdXAgI2dvdG9TdWJtaXRRdW90ZUJ1dHRvblwiLCAoKSA9PiB7XG4gICAgaGlkZSh0cnVlKTtcbiAgICBRdW90ZVN1Ym1pdFBvcHVwLnNob3codHJ1ZSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjcXVvdGVTZWFyY2hQb3B1cCAjZ29Ub0FwcHJvdmVRdW90ZXNcIiwgKCkgPT4ge1xuICAgIGhpZGUodHJ1ZSk7XG4gICAgUXVvdGVBcHByb3ZlUG9wdXAuc2hvdyh0cnVlKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNxdW90ZVNlYXJjaFBvcHVwIC5yZXBvcnRcIiwgKGUpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIGNvbnN0IHF1b3RlSWQgPSBlLnRhcmdldC5jbG9zZXN0KFwiLnNlYXJjaFJlc3VsdFwiKS5pZDtcbiAgICBjb25zdCBxdW90ZUlkU2VsZWN0ZWRGb3JSZXBvcnQgPSBwYXJzZUludChxdW90ZUlkKTtcbiAgICBoaWRlKHRydWUsIGZhbHNlKTtcbiAgICBRdW90ZVJlcG9ydFBvcHVwLnNob3coe1xuICAgICAgICBxdW90ZUlkOiBxdW90ZUlkU2VsZWN0ZWRGb3JSZXBvcnQsXG4gICAgICAgIG5vQW5pbTogdHJ1ZSxcbiAgICAgICAgcHJldmlvdXNQb3B1cFNob3dDYWxsYmFjazogKCkgPT4ge1xuICAgICAgICAgICAgc2hvdyhmYWxzZSk7XG4gICAgICAgIH0sXG4gICAgfSk7XG59KSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3RvcCAuY29uZmlnIC5xdW90ZUxlbmd0aCAudGV4dC1idXR0b25cIiwgKGUpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgbGVuID0gKF9hID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJxdW90ZUxlbmd0aFwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogMDtcbiAgICBpZiAobGVuID09IC0yKSB7XG4gICAgICAgIHNob3coKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwia2V5ZG93blwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiICYmXG4gICAgICAgICEkKFwiI3F1b3RlU2VhcmNoUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGlkZSA9IGV4cG9ydHMuc2hvdyA9IHZvaWQgMDtcbmNvbnN0IGFwZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9hcGVcIikpO1xuY29uc3QgTG9hZGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sb2FkZXJcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG4vLyBpbXBvcnQgQ29uZmlnIGZyb20gXCIuLi9jb25maWdcIjtcbi8vIGltcG9ydCAqIGFzIE1pc2MgZnJvbSBcIi4uL21pc2NcIjtcbi8vIGxldCBkcm9wZG93blJlYWR5ID0gZmFsc2U7XG4vLyBhc3luYyBmdW5jdGlvbiBpbml0RHJvcGRvd24oKTogUHJvbWlzZTx2b2lkPiB7XG4vLyAgIGlmIChkcm9wZG93blJlYWR5KSByZXR1cm47XG4vLyAgIGNvbnN0IGxhbmd1YWdlcyA9IGF3YWl0IE1pc2MuZ2V0TGFuZ3VhZ2VMaXN0KCk7XG4vLyAgIGxhbmd1YWdlcy5mb3JFYWNoKChsYW5ndWFnZSkgPT4ge1xuLy8gICAgIGlmIChcbi8vICAgICAgIGxhbmd1YWdlID09PSBcImVuZ2xpc2hfY29tbW9ubHlfbWlzc3BlbGxlZFwiIHx8XG4vLyAgICAgICBsYW5ndWFnZSA9PT0gXCJodW5nYXJpYW5fMi41a1wiXG4vLyAgICAgKVxuLy8gICAgICAgcmV0dXJuO1xuLy8gICAgIGlmICghL19cXGQqayQvZy50ZXN0KGxhbmd1YWdlKSkge1xuLy8gICAgICAgJChcIiNxdW90ZVN1Ym1pdFBvcHVwICNzdWJtaXRRdW90ZUxhbmd1YWdlXCIpLmFwcGVuZChcbi8vICAgICAgICAgYDxvcHRpb24gdmFsdWU9XCIke2xhbmd1YWdlfVwiPiR7bGFuZ3VhZ2UucmVwbGFjZSgvXy9nLCBcIiBcIil9PC9vcHRpb24+YFxuLy8gICAgICAgKTtcbi8vICAgICB9XG4vLyAgIH0pO1xuLy8gICAkKFwiI3F1b3RlU3VibWl0UG9wdXAgI3N1Ym1pdFF1b3RlTGFuZ3VhZ2VcIikuc2VsZWN0MigpO1xuLy8gICBkcm9wZG93blJlYWR5ID0gdHJ1ZTtcbi8vIH1cbmZ1bmN0aW9uIHN1Ym1pdFF1b3RlKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IHRleHQgPSAkKFwiI3F1b3RlU3VibWl0UG9wdXAgI3N1Ym1pdFF1b3RlVGV4dFwiKS52YWwoKTtcbiAgICAgICAgY29uc3Qgc291cmNlID0gJChcIiNxdW90ZVN1Ym1pdFBvcHVwICNzdWJtaXRRdW90ZVNvdXJjZVwiKS52YWwoKTtcbiAgICAgICAgY29uc3QgbGFuZ3VhZ2UgPSAkKFwiI3F1b3RlU3VibWl0UG9wdXAgI3N1Ym1pdFF1b3RlTGFuZ3VhZ2VcIikudmFsKCk7XG4gICAgICAgIGNvbnN0IGNhcHRjaGEgPSAkKFwiI3F1b3RlU3VibWl0UG9wdXAgI2ctcmVjYXB0Y2hhLXJlc3BvbnNlXCIpLnZhbCgpO1xuICAgICAgICBpZiAoIXRleHQgfHwgIXNvdXJjZSB8fCAhbGFuZ3VhZ2UpIHtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIlBsZWFzZSBmaWxsIGluIGFsbCBmaWVsZHNcIiwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgTG9hZGVyLnNob3coKTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnF1b3Rlcy5zdWJtaXQodGV4dCwgc291cmNlLCBsYW5ndWFnZSwgY2FwdGNoYSk7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHN1Ym1pdCBxdW90ZTogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJRdW90ZSBzdWJtaXR0ZWQuXCIsIDEpO1xuICAgICAgICAkKFwiI3F1b3RlU3VibWl0UG9wdXAgI3N1Ym1pdFF1b3RlVGV4dFwiKS52YWwoXCJcIik7XG4gICAgICAgICQoXCIjcXVvdGVTdWJtaXRQb3B1cCAjc3VibWl0UXVvdGVTb3VyY2VcIikudmFsKFwiXCIpO1xuICAgICAgICAkKFwiI3F1b3RlU3VibWl0UG9wdXAgLmNoYXJhY3RlckNvdW50XCIpLnJlbW92ZUNsYXNzKFwicmVkXCIpO1xuICAgICAgICAkKFwiI3F1b3RlU3VibWl0UG9wdXAgLmNoYXJhY3RlckNvdW50XCIpLnRleHQoXCItXCIpO1xuICAgICAgICBncmVjYXB0Y2hhLnJlc2V0KCk7XG4gICAgfSk7XG59XG4vLyBAdHMtaWdub3JlXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbmZ1bmN0aW9uIHNob3cobm9BbmltID0gZmFsc2UpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlF1b3RlIHN1Ym1pc3Npb24gaXMgZGlzYWJsZWQgdGVtcG9yYXJpbHkgZHVlIHRvIGEgbGFyZ2Ugc3VibWlzc2lvbiBxdWV1ZS5cIiwgMCwgNSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgICAgLy8gaWYgKCQoXCIjcXVvdGVTdWJtaXRQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgLy8gICBhd2FpdCBpbml0RHJvcGRvd24oKTtcbiAgICAgICAgLy8gICAkKFwiI3F1b3RlU3VibWl0UG9wdXAgI3N1Ym1pdFF1b3RlTGFuZ3VhZ2VcIikudmFsKFxuICAgICAgICAvLyAgICAgQ29uZmlnLmxhbmd1YWdlLnJlcGxhY2UoL19cXGQqayQvZywgXCJcIilcbiAgICAgICAgLy8gICApO1xuICAgICAgICAvLyAgICQoXCIjcXVvdGVTdWJtaXRQb3B1cCAjc3VibWl0UXVvdGVMYW5ndWFnZVwiKS50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuICAgICAgICAvLyAgICQoXCIjcXVvdGVTdWJtaXRQb3B1cCBpbnB1dFwiKS52YWwoXCJcIik7XG4gICAgICAgIC8vICAgJChcIiNxdW90ZVN1Ym1pdFBvcHVwV3JhcHBlclwiKVxuICAgICAgICAvLyAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgLy8gICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgIC8vICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgLy8gICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCBub0FuaW0gPyAwIDogMTAwLCAoKSA9PiB7XG4gICAgICAgIC8vICAgICAgICQoXCIjcXVvdGVTdWJtaXRQb3B1cCB0ZXh0YXJlYVwiKS50cmlnZ2VyKFwiZm9jdXNcIikuc2VsZWN0KCk7XG4gICAgICAgIC8vICAgICB9KTtcbiAgICAgICAgLy8gfVxuICAgIH0pO1xufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgaWYgKCEkKFwiI3F1b3RlU3VibWl0UG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjcXVvdGVTdWJtaXRQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgMTAwLCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3F1b3RlU3VibWl0UG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuJChcIiNxdW90ZVN1Ym1pdFBvcHVwV3JhcHBlclwiKS5vbihcIm1vdXNlZG93blwiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwicXVvdGVTdWJtaXRQb3B1cFdyYXBwZXJcIikge1xuICAgICAgICBoaWRlKCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3F1b3RlU3VibWl0UG9wdXAgI3N1Ym1pdFF1b3RlQnV0dG9uXCIsICgpID0+IHtcbiAgICBzdWJtaXRRdW90ZSgpO1xufSk7XG4kKFwiI3F1b3RlU3VibWl0UG9wdXAgdGV4dGFyZWFcIikub24oXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgbGVuID0gKF9hID0gJChcIiNxdW90ZVN1Ym1pdFBvcHVwIHRleHRhcmVhXCIpLnZhbCgpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoO1xuICAgICAgICAkKFwiI3F1b3RlU3VibWl0UG9wdXAgLmNoYXJhY3RlckNvdW50XCIpLnRleHQobGVuKTtcbiAgICAgICAgaWYgKGxlbiA8IDYwKSB7XG4gICAgICAgICAgICAkKFwiI3F1b3RlU3VibWl0UG9wdXAgLmNoYXJhY3RlckNvdW50XCIpLmFkZENsYXNzKFwicmVkXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIiNxdW90ZVN1Ym1pdFBvcHVwIC5jaGFyYWN0ZXJDb3VudFwiKS5yZW1vdmVDbGFzcyhcInJlZFwiKTtcbiAgICAgICAgfVxuICAgIH0sIDEpO1xufSk7XG4kKFwiI3F1b3RlU3VibWl0UG9wdXAgaW5wdXRcIikub24oXCJrZXlkb3duXCIsIChlKSA9PiB7XG4gICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgc3VibWl0UXVvdGUoKTtcbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudXBkYXRlQnV0dG9ucyA9IHZvaWQgMDtcbmNvbnN0IGFwZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9hcGVcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IExvYWRlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbG9hZGVyXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuZnVuY3Rpb24gc2hvdygpIHtcbiAgICBpZiAoJChcIiNyZXN1bHRFZGl0VGFnc1BhbmVsV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI3Jlc3VsdEVkaXRUYWdzUGFuZWxXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEyNSk7XG4gICAgfVxufVxuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICBpZiAoISQoXCIjcmVzdWx0RWRpdFRhZ3NQYW5lbFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNyZXN1bHRFZGl0VGFnc1BhbmVsV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCAxMDAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0RWRpdFRhZ3NQYW5lbFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHVwZGF0ZUJ1dHRvbnMoKSB7XG4gICAgdmFyIF9hO1xuICAgICQoXCIjcmVzdWx0RWRpdFRhZ3NQYW5lbCAuYnV0dG9uc1wiKS5lbXB0eSgpO1xuICAgIChfYSA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAkKFwiI3Jlc3VsdEVkaXRUYWdzUGFuZWwgLmJ1dHRvbnNcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwiYnV0dG9uIHRhZ1wiIHRhZ2lkPVwiJHt0YWcuX2lkfVwiPiR7dGFnLm5hbWV9PC9kaXY+YCk7XG4gICAgfSk7XG59XG5leHBvcnRzLnVwZGF0ZUJ1dHRvbnMgPSB1cGRhdGVCdXR0b25zO1xuZnVuY3Rpb24gdXBkYXRlQWN0aXZlQnV0dG9ucyhhY3RpdmUpIHtcbiAgICBpZiAoYWN0aXZlID09PSBbXSlcbiAgICAgICAgcmV0dXJuO1xuICAgICQuZWFjaCgkKFwiI3Jlc3VsdEVkaXRUYWdzUGFuZWwgLmJ1dHRvbnMgLmJ1dHRvblwiKSwgKF8sIG9iaikgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHRhZ2lkID0gKF9hID0gJChvYmopLmF0dHIoXCJ0YWdpZFwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCJcIjtcbiAgICAgICAgaWYgKGFjdGl2ZS5pbmNsdWRlcyh0YWdpZCkpIHtcbiAgICAgICAgICAgICQob2JqKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQob2JqKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlQWNjb3VudCAuZ3JvdXAuaGlzdG9yeSAjcmVzdWx0RWRpdFRhZ3NcIiwgKGYpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKCgoX2EgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpIHx8IDAgPiAwKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdGlkID0gJChmLnRhcmdldCkucGFyZW50cyhcInNwYW5cIikuYXR0cihcInJlc3VsdGlkXCIpO1xuICAgICAgICBjb25zdCB0YWdzID0gJChmLnRhcmdldCkucGFyZW50cyhcInNwYW5cIikuYXR0cihcInRhZ3NcIik7XG4gICAgICAgICQoXCIjcmVzdWx0RWRpdFRhZ3NQYW5lbFwiKS5hdHRyKFwicmVzdWx0aWRcIiwgcmVzdWx0aWQpO1xuICAgICAgICAkKFwiI3Jlc3VsdEVkaXRUYWdzUGFuZWxcIikuYXR0cihcInRhZ3NcIiwgdGFncyk7XG4gICAgICAgIHVwZGF0ZUFjdGl2ZUJ1dHRvbnMoSlNPTi5wYXJzZSh0YWdzKSk7XG4gICAgICAgIHNob3coKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjcmVzdWx0RWRpdFRhZ3NQYW5lbFdyYXBwZXIgLmJ1dHRvbi50YWdcIiwgKGYpID0+IHtcbiAgICAkKGYudGFyZ2V0KS50b2dnbGVDbGFzcyhcImFjdGl2ZVwiKTtcbn0pO1xuJChcIiNyZXN1bHRFZGl0VGFnc1BhbmVsV3JhcHBlclwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJyZXN1bHRFZGl0VGFnc1BhbmVsV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbiQoXCIjcmVzdWx0RWRpdFRhZ3NQYW5lbCAuY29uZmlybUJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCByZXN1bHRJZCA9ICQoXCIjcmVzdWx0RWRpdFRhZ3NQYW5lbFwiKS5hdHRyKFwicmVzdWx0aWRcIik7XG4gICAgLy8gbGV0IG9sZHRhZ3MgPSBKU09OLnBhcnNlKCQoXCIjcmVzdWx0RWRpdFRhZ3NQYW5lbFwiKS5hdHRyKFwidGFnc1wiKSk7XG4gICAgY29uc3QgbmV3VGFncyA9IFtdO1xuICAgICQuZWFjaCgkKFwiI3Jlc3VsdEVkaXRUYWdzUGFuZWwgLmJ1dHRvbnMgLmJ1dHRvblwiKSwgKF8sIG9iaikgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHRhZ2lkID0gKF9hID0gJChvYmopLmF0dHIoXCJ0YWdpZFwiKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCJcIjtcbiAgICAgICAgaWYgKCQob2JqKS5oYXNDbGFzcyhcImFjdGl2ZVwiKSkge1xuICAgICAgICAgICAgbmV3VGFncy5wdXNoKHRhZ2lkKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIExvYWRlci5zaG93KCk7XG4gICAgaGlkZSgpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5yZXN1bHRzLnVwZGF0ZVRhZ3MocmVzdWx0SWQsIG5ld1RhZ3MpO1xuICAgIExvYWRlci5oaWRlKCk7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byB1cGRhdGUgcmVzdWx0IHRhZ3M6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgIH1cbiAgICBOb3RpZmljYXRpb25zLmFkZChcIlRhZ3MgdXBkYXRlZC5cIiwgMSwgMik7XG4gICAgKF9hID0gREIuZ2V0U25hcHNob3QoKS5yZXN1bHRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgocmVzdWx0KSA9PiB7XG4gICAgICAgIGlmIChyZXN1bHQuX2lkID09PSByZXN1bHRJZCkge1xuICAgICAgICAgICAgcmVzdWx0LnRhZ3MgPSBuZXdUYWdzO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgbGV0IHRhZ05hbWVzID0gXCJcIjtcbiAgICBpZiAobmV3VGFncy5sZW5ndGggPiAwKSB7XG4gICAgICAgIG5ld1RhZ3MuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpLnRhZ3MpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb3JFYWNoKChzbmFwdGFnKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRhZyA9PT0gc25hcHRhZy5faWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFnTmFtZXMgKz0gc25hcHRhZy5uYW1lICsgXCIsIFwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgdGFnTmFtZXMgPSB0YWdOYW1lcy5zdWJzdHJpbmcoMCwgdGFnTmFtZXMubGVuZ3RoIC0gMik7XG4gICAgfVxuICAgIGxldCByZXN0YWdzO1xuICAgIGlmIChuZXdUYWdzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmVzdGFncyA9IFwiW11cIjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJlc3RhZ3MgPSBKU09OLnN0cmluZ2lmeShuZXdUYWdzKTtcbiAgICB9XG4gICAgJChgLnBhZ2VBY2NvdW50ICNyZXN1bHRFZGl0VGFnc1tyZXN1bHRpZD0nJHtyZXN1bHRJZH0nXWApLmF0dHIoXCJ0YWdzXCIsIHJlc3RhZ3MpO1xuICAgIGlmIChuZXdUYWdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgJChgLnBhZ2VBY2NvdW50ICNyZXN1bHRFZGl0VGFnc1tyZXN1bHRpZD0nJHtyZXN1bHRJZH0nXWApLmNzcyhcIm9wYWNpdHlcIiwgMSk7XG4gICAgICAgICQoYC5wYWdlQWNjb3VudCAjcmVzdWx0RWRpdFRhZ3NbcmVzdWx0aWQ9JyR7cmVzdWx0SWR9J11gKS5hdHRyKFwiYXJpYS1sYWJlbFwiLCB0YWdOYW1lcyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKGAucGFnZUFjY291bnQgI3Jlc3VsdEVkaXRUYWdzW3Jlc3VsdGlkPScke3Jlc3VsdElkfSddYCkuY3NzKFwib3BhY2l0eVwiLCAwLjI1KTtcbiAgICAgICAgJChgLnBhZ2VBY2NvdW50ICNyZXN1bHRFZGl0VGFnc1tyZXN1bHRpZD0nJHtyZXN1bHRJZH0nXWApLmF0dHIoXCJhcmlhLWxhYmVsXCIsIFwibm8gdGFnc1wiKTtcbiAgICB9XG59KSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNob3cgPSB2b2lkIDA7XG5jb25zdCBDdXN0b21UZXh0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2N1c3RvbS10ZXh0XCIpKTtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgbmFtZXMgPSBDdXN0b21UZXh0LmdldEN1c3RvbVRleHROYW1lcygpO1xuICAgICAgICBjb25zdCBsaXN0RWwgPSAkKGAjc2F2ZWRUZXh0c1BvcHVwIC5saXN0YCkuZW1wdHkoKTtcbiAgICAgICAgbGV0IGxpc3QgPSBcIlwiO1xuICAgICAgICBpZiAobmFtZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBsaXN0ICs9IFwiPGRpdj5ObyBzYXZlZCBjdXN0b20gdGV4dHMgZm91bmQ8L2Rpdj5cIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcykge1xuICAgICAgICAgICAgICAgIGxpc3QgKz0gYDxkaXYgY2xhc3M9XCJzYXZlZFRleHRcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJidXR0b24gbmFtZVwiPiR7bmFtZX08L2Rpdj5cbiAgICAgIDxkaXYgY2xhc3M9XCJidXR0b24gZGVsZXRlXCI+XG4gICAgICA8aSBjbGFzcz1cImZhcyBmYS1mdyBmYS10cmFzaFwiPjwvaT5cbiAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBsaXN0RWwuaHRtbChsaXN0KTtcbiAgICAgICAgJChcIiNzYXZlZFRleHRzUG9wdXBXcmFwcGVyXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI2N1c3RvbVRleHRQb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfSk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZShmdWxsID0gZmFsc2UpIHtcbiAgICAkKFwiI3NhdmVkVGV4dHNQb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgaWYgKCFmdWxsKVxuICAgICAgICAkKFwiI2N1c3RvbVRleHRQb3B1cFdyYXBwZXJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG59XG5mdW5jdGlvbiBhcHBseVNhdmVkKG5hbWUpIHtcbiAgICBjb25zdCB0ZXh0ID0gQ3VzdG9tVGV4dC5nZXRDdXN0b21UZXh0KG5hbWUpO1xuICAgICQoYCNjdXN0b21UZXh0UG9wdXBXcmFwcGVyIHRleHRhcmVhYCkudmFsKHRleHQuam9pbihDdXN0b21UZXh0LmRlbGltaXRlcikpO1xufVxuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBgI3NhdmVkVGV4dHNQb3B1cFdyYXBwZXIgLmxpc3QgLnNhdmVkVGV4dCAuYnV0dG9uLm5hbWVgLCAoZSkgPT4ge1xuICAgIGNvbnN0IG5hbWUgPSAkKGUudGFyZ2V0KS50ZXh0KCk7XG4gICAgYXBwbHlTYXZlZChuYW1lKTtcbiAgICBoaWRlKCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgYCNzYXZlZFRleHRzUG9wdXBXcmFwcGVyIC5saXN0IC5zYXZlZFRleHQgLmJ1dHRvbi5kZWxldGVgLCAoKSA9PiB7XG4gICAgaGlkZSh0cnVlKTtcbn0pO1xuJChcIiNzYXZlZFRleHRzUG9wdXBXcmFwcGVyXCIpLm1vdXNlZG93bigoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwic2F2ZWRUZXh0c1BvcHVwV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGlkZSA9IGV4cG9ydHMubGlzdCA9IHZvaWQgMDtcbmNvbnN0IGFwZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9hcGVcIikpO1xuY29uc3QgQWNjb3VudENvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL2FjY291bnQtY29udHJvbGxlclwiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgVXBkYXRlQ29uZmlnID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgTG9hZGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sb2FkZXJcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBTZXR0aW5ncyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcGFnZXMvc2V0dGluZ3NcIikpO1xuY29uc3QgQXBlS2V5c1BvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wb3B1cHMvYXBlLWtleXMtcG9wdXBcIikpO1xuY29uc3QgVGhlbWVQaWNrZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3NldHRpbmdzL3RoZW1lLXBpY2tlclwiKSk7XG5jb25zdCBDdXN0b21UZXh0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi90ZXN0L2N1c3RvbS10ZXh0XCIpKTtcbmNvbnN0IEN1c3RvbVRleHRQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcG9wdXBzL2N1c3RvbS10ZXh0LXBvcHVwXCIpKTtcbmNvbnN0IFNhdmVkVGV4dHNQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9zYXZlZC10ZXh0cy1wb3B1cFwiKSk7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xuY29uc3QgYXV0aF8xID0gcmVxdWlyZShcImZpcmViYXNlL2F1dGhcIik7XG5sZXQgYWN0aXZlUG9wdXAgPSBudWxsO1xuZXhwb3J0cy5saXN0ID0ge307XG5jbGFzcyBTaW1wbGVQb3B1cCB7XG4gICAgY29uc3RydWN0b3IoaWQsIHR5cGUsIHRpdGxlLCBpbnB1dHMgPSBbXSwgdGV4dCA9IFwiXCIsIGJ1dHRvblRleHQgPSBcIkNvbmZpcm1cIiwgZXhlY0ZuLCBiZWZvcmVJbml0Rm4sIGJlZm9yZVNob3dGbikge1xuICAgICAgICB0aGlzLnBhcmFtZXRlcnMgPSBbXTtcbiAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB0aGlzLmV4ZWNGbiA9ICh0aGlzUG9wdXAsIC4uLnZhbHMpID0+IGV4ZWNGbih0aGlzUG9wdXAsIC4uLnZhbHMpO1xuICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgICAgIHRoaXMuaW5wdXRzID0gaW5wdXRzO1xuICAgICAgICB0aGlzLnRleHQgPSB0ZXh0O1xuICAgICAgICB0aGlzLndyYXBwZXIgPSAkKFwiI3NpbXBsZVBvcHVwV3JhcHBlclwiKTtcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gJChcIiNzaW1wbGVQb3B1cFwiKTtcbiAgICAgICAgdGhpcy5idXR0b25UZXh0ID0gYnV0dG9uVGV4dDtcbiAgICAgICAgdGhpcy5iZWZvcmVJbml0Rm4gPSAodGhpc1BvcHVwKSA9PiBiZWZvcmVJbml0Rm4odGhpc1BvcHVwKTtcbiAgICAgICAgdGhpcy5iZWZvcmVTaG93Rm4gPSAodGhpc1BvcHVwKSA9PiBiZWZvcmVTaG93Rm4odGhpc1BvcHVwKTtcbiAgICAgICAgdGhpcy5jYW5DbG9zZSA9IHRydWU7XG4gICAgfVxuICAgIHJlc2V0KCkge1xuICAgICAgICB0aGlzLmVsZW1lbnQuaHRtbChgXG4gICAgPGRpdiBjbGFzcz1cInRpdGxlXCI+PC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImlucHV0c1wiPjwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJ0ZXh0XCI+PC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImJ1dHRvblwiPjwvZGl2PmApO1xuICAgIH1cbiAgICBpbml0KCkge1xuICAgICAgICBjb25zdCBlbCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgZWwuZmluZChcImlucHV0XCIpLnZhbChcIlwiKTtcbiAgICAgICAgLy8gaWYgKGVsLmF0dHIoXCJwb3B1cElkXCIpICE9PSB0aGlzLmlkKSB7XG4gICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgICAgZWwuYXR0cihcInBvcHVwSWRcIiwgdGhpcy5pZCk7XG4gICAgICAgIGVsLmZpbmQoXCIudGl0bGVcIikudGV4dCh0aGlzLnRpdGxlKTtcbiAgICAgICAgZWwuZmluZChcIi50ZXh0XCIpLnRleHQodGhpcy50ZXh0KTtcbiAgICAgICAgdGhpcy5pbml0SW5wdXRzKCk7XG4gICAgICAgIGlmICh0aGlzLmJ1dHRvblRleHQgPT09IFwiXCIpIHtcbiAgICAgICAgICAgIGVsLmZpbmQoXCIuYnV0dG9uXCIpLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZWwuZmluZChcIi5idXR0b25cIikudGV4dCh0aGlzLmJ1dHRvblRleHQpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnRleHQgPT09IFwiXCIpIHtcbiAgICAgICAgICAgIGVsLmZpbmQoXCIudGV4dFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGVsLmZpbmQoXCIudGV4dFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB9XG4gICAgfVxuICAgIGluaXRJbnB1dHMoKSB7XG4gICAgICAgIGNvbnN0IGVsID0gdGhpcy5lbGVtZW50O1xuICAgICAgICBpZiAodGhpcy5pbnB1dHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gXCJudW1iZXJcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGVsLmZpbmQoXCIuaW5wdXRzXCIpLmFwcGVuZChgXG4gICAgICAgICAgICA8aW5wdXRcbiAgICAgICAgICAgICAgdHlwZT1cIm51bWJlclwiXG4gICAgICAgICAgICAgIG1pbj1cIjFcIlxuICAgICAgICAgICAgICB2YWx1ZT1cIiR7aW5wdXQuaW5pdFZhbH1cIlxuICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cIiR7aW5wdXQucGxhY2Vob2xkZXJ9XCJcbiAgICAgICAgICAgICAgY2xhc3M9XCIke2lucHV0LmhpZGRlbiA/IFwiaGlkZGVuXCIgOiBcIlwifVwiXG4gICAgICAgICAgICAgICR7aW5wdXQuaGlkZGVuID8gXCJcIiA6IFwicmVxdWlyZWRcIn1cbiAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlPVwib2ZmXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICBgKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMudHlwZSA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0LnR5cGUgPT09IFwidGV4dGFyZWFcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLmZpbmQoXCIuaW5wdXRzXCIpLmFwcGVuZChgXG4gICAgICAgICAgICAgICAgPHRleHRhcmVhXG4gICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cIiR7aW5wdXQucGxhY2Vob2xkZXJ9XCJcbiAgICAgICAgICAgICAgICAgIGNsYXNzPVwiJHtpbnB1dC5oaWRkZW4gPyBcImhpZGRlblwiIDogXCJcIn1cIlxuICAgICAgICAgICAgICAgICAgJHtpbnB1dC5oaWRkZW4gPyBcIlwiIDogXCJyZXF1aXJlZFwifVxuICAgICAgICAgICAgICAgICAgJHtpbnB1dC5kaXNhYmxlZCA/IFwiZGlzYWJsZWRcIiA6IFwiXCJ9XG4gICAgICAgICAgICAgICAgICBhdXRvY29tcGxldGU9XCJvZmZcIlxuICAgICAgICAgICAgICAgID4ke2lucHV0LmluaXRWYWx9PC90ZXh0YXJlYT5cbiAgICAgICAgICAgICAgYCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpbnB1dC50eXBlID09PSBcImNoZWNrYm94XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5maW5kKFwiLmlucHV0c1wiKS5hcHBlbmQoYFxuICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz1cImNoZWNrYm94XCI+XG4gICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cImNoZWNrYm94XCI+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY3VzdG9tVGV4dENoZWNrYm94XCI+PC9kaXY+XG4gICAgICAgICAgICAgICAgICAke2lucHV0LmxhYmVsfVxuICAgICAgICAgICAgICAgIDwvbGFiZWw+XG4gICAgICAgICAgICAgIGApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuZmluZChcIi5pbnB1dHNcIikuYXBwZW5kKGBcbiAgICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgIHR5cGU9XCIke2lucHV0LnR5cGV9XCJcbiAgICAgICAgICAgICAgdmFsdWU9XCIke2lucHV0LmluaXRWYWx9XCJcbiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCIke2lucHV0LnBsYWNlaG9sZGVyfVwiXG4gICAgICAgICAgICAgIGNsYXNzPVwiJHtpbnB1dC5oaWRkZW4gPyBcImhpZGRlblwiIDogXCJcIn1cIlxuICAgICAgICAgICAgICAke2lucHV0LmhpZGRlbiA/IFwiXCIgOiBcInJlcXVpcmVkXCJ9XG4gICAgICAgICAgICAgICR7aW5wdXQuZGlzYWJsZWQgPyBcImRpc2FibGVkXCIgOiBcIlwifVxuICAgICAgICAgICAgICBhdXRvY29tcGxldGU9XCJvZmZcIlxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgIGApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWwuZmluZChcIi5pbnB1dHNcIikuYXBwZW5kKGBcbiAgICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgIHZhbHVlPVwiJHtpbnB1dC5pbml0VmFsfVwiXG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCIke2lucHV0LnBsYWNlaG9sZGVyfVwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCIke2lucHV0LmhpZGRlbiA/IFwiaGlkZGVuXCIgOiBcIlwifVwiXG4gICAgICAgICAgICAgICAgJHtpbnB1dC5oaWRkZW4gPyBcIlwiIDogXCJyZXF1aXJlZFwifVxuICAgICAgICAgICAgICAgICR7aW5wdXQuZGlzYWJsZWQgPyBcImRpc2FibGVkXCIgOiBcIlwifVxuICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZT1cIm9mZlwiXG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgIGApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbC5maW5kKFwiLmlucHV0c1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGVsLmZpbmQoXCIuaW5wdXRzXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGV4ZWMoKSB7XG4gICAgICAgIGlmICghdGhpcy5jYW5DbG9zZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgdmFscyA9IFtdO1xuICAgICAgICAkLmVhY2goJChcIiNzaW1wbGVQb3B1cCBpbnB1dFwiKSwgKF8sIGVsKSA9PiB7XG4gICAgICAgICAgICBpZiAoJChlbCkuaXMoXCI6Y2hlY2tib3hcIikpIHtcbiAgICAgICAgICAgICAgICB2YWxzLnB1c2goJChlbCkuaXMoXCI6Y2hlY2tlZFwiKSA/IFwidHJ1ZVwiIDogXCJmYWxzZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhbHMucHVzaCgkKGVsKS52YWwoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmV4ZWNGbih0aGlzLCAuLi52YWxzKTtcbiAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgfVxuICAgIHNob3cocGFyYW1ldGVycyA9IFtdKSB7XG4gICAgICAgIGFjdGl2ZVBvcHVwID0gdGhpcztcbiAgICAgICAgdGhpcy5wYXJhbWV0ZXJzID0gcGFyYW1ldGVycztcbiAgICAgICAgdGhpcy5iZWZvcmVJbml0Rm4odGhpcyk7XG4gICAgICAgIHRoaXMuaW5pdCgpO1xuICAgICAgICB0aGlzLmJlZm9yZVNob3dGbih0aGlzKTtcbiAgICAgICAgdGhpcy53cmFwcGVyXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAgICAgJCgkKFwiI3NpbXBsZVBvcHVwXCIpLmZpbmQoXCJpbnB1dFwiKVswXSkudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaGlkZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmNhbkNsb3NlKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBhY3RpdmVQb3B1cCA9IG51bGw7XG4gICAgICAgIHRoaXMud3JhcHBlclxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMCB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMud3JhcHBlci5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICBpZiAoYWN0aXZlUG9wdXApXG4gICAgICAgIHJldHVybiBhY3RpdmVQb3B1cC5oaWRlKCk7XG4gICAgJChcIiNzaW1wbGVQb3B1cFdyYXBwZXJcIilcbiAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMCB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgJChcIiNzaW1wbGVQb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfSk7XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuJChcIiNzaW1wbGVQb3B1cFdyYXBwZXJcIikubW91c2Vkb3duKChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJzaW1wbGVQb3B1cFdyYXBwZXJcIikge1xuICAgICAgICBpZiAoYWN0aXZlUG9wdXApXG4gICAgICAgICAgICByZXR1cm4gYWN0aXZlUG9wdXAuaGlkZSgpO1xuICAgICAgICAkKFwiI3NpbXBsZVBvcHVwV3JhcHBlclwiKVxuICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMCB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjc2ltcGxlUG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjc2ltcGxlUG9wdXBXcmFwcGVyIC5idXR0b25cIiwgKCkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBpZCA9IChfYSA9ICQoXCIjc2ltcGxlUG9wdXBcIikuYXR0cihcInBvcHVwSWRcIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiXCI7XG4gICAgZXhwb3J0cy5saXN0W2lkXS5leGVjKCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwia2V5dXBcIiwgXCIjc2ltcGxlUG9wdXBXcmFwcGVyIGlucHV0XCIsIChlKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc3QgaWQgPSAoX2EgPSAkKFwiI3NpbXBsZVBvcHVwXCIpLmF0dHIoXCJwb3B1cElkXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIlwiO1xuICAgICAgICBleHBvcnRzLmxpc3RbaWRdLmV4ZWMoKTtcbiAgICB9XG59KTtcbmV4cG9ydHMubGlzdFtcInVwZGF0ZUVtYWlsXCJdID0gbmV3IFNpbXBsZVBvcHVwKFwidXBkYXRlRW1haWxcIiwgXCJ0ZXh0XCIsIFwiVXBkYXRlIEVtYWlsXCIsIFtcbiAgICB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIlBhc3N3b3JkXCIsXG4gICAgICAgIHR5cGU6IFwicGFzc3dvcmRcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuICAgIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiTmV3IGVtYWlsXCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIkNvbmZpcm0gbmV3IGVtYWlsXCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbl0sIFwiXCIsIFwiVXBkYXRlXCIsIChfdGhpc1BvcHVwLCBwYXNzd29yZCwgZW1haWwsIGVtYWlsQ29uZmlybSkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICAgICAgaWYgKHVzZXIgPT09IG51bGwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmIChlbWFpbCAhPT0gZW1haWxDb25maXJtKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVtYWlscyBkb24ndCBtYXRjaFwiLCAwKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodXNlci5wcm92aWRlckRhdGFbMF0ucHJvdmlkZXJJZCA9PT0gXCJwYXNzd29yZFwiKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVkZW50aWFsID0gYXV0aF8xLkVtYWlsQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwodXNlci5lbWFpbCwgcGFzc3dvcmQpO1xuICAgICAgICAgICAgeWllbGQgKDAsIGF1dGhfMS5yZWF1dGhlbnRpY2F0ZVdpdGhDcmVkZW50aWFsKSh1c2VyLCBjcmVkZW50aWFsKTtcbiAgICAgICAgfVxuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMudXBkYXRlRW1haWwoZW1haWwsIHVzZXIuZW1haWwpO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byB1cGRhdGUgZW1haWw6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRW1haWwgdXBkYXRlZFwiLCAxKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgIH0sIDEwMDApO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBjb25zdCB0eXBlZEVycm9yID0gZTtcbiAgICAgICAgaWYgKHR5cGVkRXJyb3IuY29kZSA9PT0gXCJhdXRoL3dyb25nLXBhc3N3b3JkXCIpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiSW5jb3JyZWN0IHBhc3N3b3JkXCIsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiU29tZXRoaW5nIHdlbnQgd3Jvbmc6IFwiICsgZSwgLTEpO1xuICAgICAgICB9XG4gICAgfVxufSksICh0aGlzUG9wdXApID0+IHtcbiAgICBjb25zdCB1c2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgIGlmICh1c2VyID09PSBudWxsKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKCF1c2VyLnByb3ZpZGVyRGF0YS5maW5kKChwKSA9PiAocCA9PT0gbnVsbCB8fCBwID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwLnByb3ZpZGVySWQpID09PSBcInBhc3N3b3JkXCIpKSB7XG4gICAgICAgIHRoaXNQb3B1cC5pbnB1dHMgPSBbXTtcbiAgICAgICAgdGhpc1BvcHVwLmJ1dHRvblRleHQgPSBcIlwiO1xuICAgICAgICB0aGlzUG9wdXAudGV4dCA9IFwiUGFzc3dvcmQgYXV0aGVudGljYXRpb24gaXMgbm90IGVuYWJsZWRcIjtcbiAgICB9XG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59KTtcbmV4cG9ydHMubGlzdFtcInVwZGF0ZU5hbWVcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJ1cGRhdGVOYW1lXCIsIFwidGV4dFwiLCBcIlVwZGF0ZSBOYW1lXCIsIFtcbiAgICB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIlBhc3N3b3JkXCIsXG4gICAgICAgIHR5cGU6IFwicGFzc3dvcmRcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuICAgIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiTmV3IG5hbWVcIixcbiAgICAgICAgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbl0sIFwiXCIsIFwiVXBkYXRlXCIsIChfdGhpc1BvcHVwLCBwYXNzLCBuZXdOYW1lKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB1c2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgICAgICBpZiAodXNlciA9PT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKHVzZXIucHJvdmlkZXJEYXRhWzBdLnByb3ZpZGVySWQgPT09IFwicGFzc3dvcmRcIikge1xuICAgICAgICAgICAgY29uc3QgY3JlZGVudGlhbCA9IGF1dGhfMS5FbWFpbEF1dGhQcm92aWRlci5jcmVkZW50aWFsKHVzZXIuZW1haWwsIHBhc3MpO1xuICAgICAgICAgICAgeWllbGQgKDAsIGF1dGhfMS5yZWF1dGhlbnRpY2F0ZVdpdGhDcmVkZW50aWFsKSh1c2VyLCBjcmVkZW50aWFsKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh1c2VyLnByb3ZpZGVyRGF0YVswXS5wcm92aWRlcklkID09PSBcImdvb2dsZS5jb21cIikge1xuICAgICAgICAgICAgeWllbGQgKDAsIGF1dGhfMS5yZWF1dGhlbnRpY2F0ZVdpdGhQb3B1cCkodXNlciwgQWNjb3VudENvbnRyb2xsZXIuZ21haWxQcm92aWRlcik7XG4gICAgICAgIH1cbiAgICAgICAgTG9hZGVyLnNob3coKTtcbiAgICAgICAgY29uc3QgY2hlY2tOYW1lUmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmdldE5hbWVBdmFpbGFiaWxpdHkobmV3TmFtZSk7XG4gICAgICAgIGlmIChjaGVja05hbWVSZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBjaGVjayBuYW1lOiBcIiArIGNoZWNrTmFtZVJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1cGRhdGVOYW1lUmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLnVwZGF0ZU5hbWUobmV3TmFtZSk7XG4gICAgICAgIGlmICh1cGRhdGVOYW1lUmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gdXBkYXRlIG5hbWU6IFwiICsgdXBkYXRlTmFtZVJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIk5hbWUgdXBkYXRlZFwiLCAxKTtcbiAgICAgICAgREIuZ2V0U25hcHNob3QoKS5uYW1lID0gbmV3TmFtZTtcbiAgICAgICAgJChcIiNtZW51IC5pY29uLWJ1dHRvbi5hY2NvdW50IC50ZXh0XCIpLnRleHQobmV3TmFtZSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnN0IHR5cGVkRXJyb3IgPSBlO1xuICAgICAgICBpZiAodHlwZWRFcnJvci5jb2RlID09PSBcImF1dGgvd3JvbmctcGFzc3dvcmRcIikge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJJbmNvcnJlY3QgcGFzc3dvcmRcIiwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJTb21ldGhpbmcgd2VudCB3cm9uZzogXCIgKyBlLCAtMSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgTG9hZGVyLmhpZGUoKTtcbn0pLCAodGhpc1BvcHVwKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICBpZiAodXNlciA9PT0gbnVsbClcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmICh1c2VyLnByb3ZpZGVyRGF0YVswXS5wcm92aWRlcklkID09PSBcImdvb2dsZS5jb21cIikge1xuICAgICAgICB0aGlzUG9wdXAuaW5wdXRzWzBdLmhpZGRlbiA9IHRydWU7XG4gICAgICAgIHRoaXNQb3B1cC5idXR0b25UZXh0ID0gXCJSZWF1dGhlbnRpY2F0ZSB0byB1cGRhdGVcIjtcbiAgICB9XG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59KTtcbmV4cG9ydHMubGlzdFtcInVwZGF0ZVBhc3N3b3JkXCJdID0gbmV3IFNpbXBsZVBvcHVwKFwidXBkYXRlUGFzc3dvcmRcIiwgXCJ0ZXh0XCIsIFwiVXBkYXRlIFBhc3N3b3JkXCIsIFtcbiAgICB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIlBhc3N3b3JkXCIsXG4gICAgICAgIHR5cGU6IFwicGFzc3dvcmRcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuICAgIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiTmV3IHBhc3N3b3JkXCIsXG4gICAgICAgIHR5cGU6IFwicGFzc3dvcmRcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuICAgIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiQ29uZmlybSBuZXcgcGFzc3dvcmRcIixcbiAgICAgICAgdHlwZTogXCJwYXNzd29yZFwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG5dLCBcIlwiLCBcIlVwZGF0ZVwiLCAoX3RoaXNQb3B1cCwgcHJldmlvdXNQYXNzLCBuZXdQYXNzLCBuZXdQYXNzQ29uZmlybSkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXNlciA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcjtcbiAgICAgICAgaWYgKHVzZXIgPT09IG51bGwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGNyZWRlbnRpYWwgPSBhdXRoXzEuRW1haWxBdXRoUHJvdmlkZXIuY3JlZGVudGlhbCh1c2VyLmVtYWlsLCBwcmV2aW91c1Bhc3MpO1xuICAgICAgICBpZiAobmV3UGFzcyAhPT0gbmV3UGFzc0NvbmZpcm0pIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiTmV3IHBhc3N3b3JkcyBkb24ndCBtYXRjaFwiLCAwKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBMb2FkZXIuc2hvdygpO1xuICAgICAgICB5aWVsZCAoMCwgYXV0aF8xLnJlYXV0aGVudGljYXRlV2l0aENyZWRlbnRpYWwpKHVzZXIsIGNyZWRlbnRpYWwpO1xuICAgICAgICB5aWVsZCAoMCwgYXV0aF8xLnVwZGF0ZVBhc3N3b3JkKSh1c2VyLCBuZXdQYXNzKTtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJQYXNzd29yZCB1cGRhdGVkXCIsIDEpO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgfSwgMTAwMCk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnN0IHR5cGVkRXJyb3IgPSBlO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBpZiAodHlwZWRFcnJvci5jb2RlID09PSBcImF1dGgvd3JvbmctcGFzc3dvcmRcIikge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJJbmNvcnJlY3QgcGFzc3dvcmRcIiwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJTb21ldGhpbmcgd2VudCB3cm9uZzogXCIgKyBlLCAtMSk7XG4gICAgICAgIH1cbiAgICB9XG59KSwgKHRoaXNQb3B1cCkgPT4ge1xuICAgIGNvbnN0IHVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgaWYgKHVzZXIgPT09IG51bGwpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoIXVzZXIucHJvdmlkZXJEYXRhLmZpbmQoKHApID0+IChwID09PSBudWxsIHx8IHAgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHAucHJvdmlkZXJJZCkgPT09IFwicGFzc3dvcmRcIikpIHtcbiAgICAgICAgdGhpc1BvcHVwLmlucHV0cyA9IFtdO1xuICAgICAgICB0aGlzUG9wdXAuYnV0dG9uVGV4dCA9IFwiXCI7XG4gICAgICAgIHRoaXNQb3B1cC50ZXh0ID0gXCJQYXNzd29yZCBhdXRoZW50aWNhdGlvbiBpcyBub3QgZW5hYmxlZFwiO1xuICAgIH1cbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0pO1xuZXhwb3J0cy5saXN0W1wiYWRkUGFzc3dvcmRBdXRoXCJdID0gbmV3IFNpbXBsZVBvcHVwKFwiYWRkUGFzc3dvcmRBdXRoXCIsIFwidGV4dFwiLCBcIkFkZCBQYXNzd29yZCBBdXRoZW50aWNhdGlvblwiLCBbXG4gICAge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJlbWFpbFwiLFxuICAgICAgICB0eXBlOiBcImVtYWlsXCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcImNvbmZpcm0gZW1haWxcIixcbiAgICAgICAgdHlwZTogXCJlbWFpbFwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG4gICAge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJuZXcgcGFzc3dvcmRcIixcbiAgICAgICAgdHlwZTogXCJwYXNzd29yZFwiLFxuICAgICAgICBpbml0VmFsOiBcIlwiLFxuICAgIH0sXG4gICAge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJjb25maXJtIG5ldyBwYXNzd29yZFwiLFxuICAgICAgICB0eXBlOiBcInBhc3N3b3JkXCIsXG4gICAgICAgIGluaXRWYWw6IFwiXCIsXG4gICAgfSxcbl0sIFwiXCIsIFwiQWRkXCIsIChfdGhpc1BvcHVwLCBlbWFpbCwgZW1haWxDb25maXJtLCBwYXNzLCBwYXNzQ29uZmlybSkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgaWYgKGVtYWlsICE9PSBlbWFpbENvbmZpcm0pIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJFbWFpbHMgZG9uJ3QgbWF0Y2hcIiwgMCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHBhc3MgIT09IHBhc3NDb25maXJtKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUGFzc3dvcmRzIGRvbid0IG1hdGNoXCIsIDApO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHlpZWxkIEFjY291bnRDb250cm9sbGVyLmFkZFBhc3N3b3JkQXV0aChlbWFpbCwgcGFzcyk7XG59KSwgKCkgPT4ge1xuICAgIC8vXG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59KTtcbmV4cG9ydHMubGlzdFtcImRlbGV0ZUFjY291bnRcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJkZWxldGVBY2NvdW50XCIsIFwidGV4dFwiLCBcIkRlbGV0ZSBBY2NvdW50XCIsIFtcbiAgICB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIlBhc3N3b3JkXCIsXG4gICAgICAgIHR5cGU6IFwicGFzc3dvcmRcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuXSwgXCJUaGlzIGlzIHRoZSBsYXN0IHRpbWUgeW91IGNhbiBjaGFuZ2UgeW91ciBtaW5kLiBBZnRlciBwcmVzc2luZyB0aGUgYnV0dG9uIGV2ZXJ5dGhpbmcgaXMgZ29uZS5cIiwgXCJEZWxldGVcIiwgKF90aGlzUG9wdXAsIHBhc3N3b3JkKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB2YXIgX2E7XG4gICAgLy9cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB1c2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgICAgICBpZiAodXNlciA9PT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKHVzZXIucHJvdmlkZXJEYXRhWzBdLnByb3ZpZGVySWQgPT09IFwicGFzc3dvcmRcIikge1xuICAgICAgICAgICAgY29uc3QgY3JlZGVudGlhbCA9IGF1dGhfMS5FbWFpbEF1dGhQcm92aWRlci5jcmVkZW50aWFsKHVzZXIuZW1haWwsIHBhc3N3b3JkKTtcbiAgICAgICAgICAgIHlpZWxkICgwLCBhdXRoXzEucmVhdXRoZW50aWNhdGVXaXRoQ3JlZGVudGlhbCkodXNlciwgY3JlZGVudGlhbCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodXNlci5wcm92aWRlckRhdGFbMF0ucHJvdmlkZXJJZCA9PT0gXCJnb29nbGUuY29tXCIpIHtcbiAgICAgICAgICAgIHlpZWxkICgwLCBhdXRoXzEucmVhdXRoZW50aWNhdGVXaXRoUG9wdXApKHVzZXIsIEFjY291bnRDb250cm9sbGVyLmdtYWlsUHJvdmlkZXIpO1xuICAgICAgICB9XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRGVsZXRpbmcgc3RhdHMuLi5cIiwgMCk7XG4gICAgICAgIGNvbnN0IHVzZXJzUmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmRlbGV0ZSgpO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBpZiAodXNlcnNSZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGRlbGV0ZSB1c2VyIHN0YXRzOiBcIiArIHVzZXJzUmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRGVsZXRpbmcgcmVzdWx0cy4uLlwiLCAwKTtcbiAgICAgICAgY29uc3QgcmVzdWx0c1Jlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5yZXN1bHRzLmRlbGV0ZUFsbCgpO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBpZiAocmVzdWx0c1Jlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gZGVsZXRlIHVzZXIgcmVzdWx0czogXCIgKyByZXN1bHRzUmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiRGVsZXRpbmcgbG9naW4gaW5mb3JtYXRpb24uLi5cIiwgMCk7XG4gICAgICAgIHlpZWxkICgoX2EgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5kZWxldGUoKSk7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiR29vZGJ5ZVwiLCAxLCA1KTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgfSwgMzAwMCk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnN0IHR5cGVkRXJyb3IgPSBlO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBpZiAodHlwZWRFcnJvci5jb2RlID09PSBcImF1dGgvd3JvbmctcGFzc3dvcmRcIikge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJJbmNvcnJlY3QgcGFzc3dvcmRcIiwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJTb21ldGhpbmcgd2VudCB3cm9uZzogXCIgKyBlLCAtMSk7XG4gICAgICAgIH1cbiAgICB9XG59KSwgKHRoaXNQb3B1cCkgPT4ge1xuICAgIGNvbnN0IHVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgaWYgKHVzZXIgPT09IG51bGwpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAodXNlci5wcm92aWRlckRhdGFbMF0ucHJvdmlkZXJJZCA9PT0gXCJnb29nbGUuY29tXCIpIHtcbiAgICAgICAgdGhpc1BvcHVwLmlucHV0cyA9IFtdO1xuICAgICAgICB0aGlzUG9wdXAuYnV0dG9uVGV4dCA9IFwiUmVhdXRoZW50aWNhdGUgdG8gZGVsZXRlXCI7XG4gICAgfVxufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSk7XG5leHBvcnRzLmxpc3RbXCJjbGVhclRhZ1BiXCJdID0gbmV3IFNpbXBsZVBvcHVwKFwiY2xlYXJUYWdQYlwiLCBcInRleHRcIiwgXCJDbGVhciBUYWcgUEJcIiwgW10sIGBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gY2xlYXIgdGhpcyB0YWdzIFBCP2AsIFwiQ2xlYXJcIiwgKHRoaXNQb3B1cCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdmFyIF9iO1xuICAgIGNvbnN0IHRhZ0lkID0gdGhpc1BvcHVwLnBhcmFtZXRlcnNbMF07XG4gICAgTG9hZGVyLnNob3coKTtcbiAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMuZGVsZXRlVGFnUGVyc29uYWxCZXN0KHRhZ0lkKTtcbiAgICBMb2FkZXIuaGlkZSgpO1xuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gZGVsZXRlIHRhZydzIFBCOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UpO1xuICAgIH1cbiAgICBpZiAocmVzcG9uc2UuZGF0YS5yZXN1bHRDb2RlID09PSAxKSB7XG4gICAgICAgIGNvbnN0IHRhZyA9IChfYiA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmZpbHRlcigodCkgPT4gdC5faWQgPT09IHRhZ0lkKVswXTtcbiAgICAgICAgaWYgKHRhZyA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0YWcucGVyc29uYWxCZXN0cyA9IHtcbiAgICAgICAgICAgIHRpbWU6IHt9LFxuICAgICAgICAgICAgd29yZHM6IHt9LFxuICAgICAgICAgICAgemVuOiB7IHplbjogW10gfSxcbiAgICAgICAgICAgIHF1b3RlOiB7IGN1c3RvbTogW10gfSxcbiAgICAgICAgICAgIGN1c3RvbTogeyBjdXN0b206IFtdIH0sXG4gICAgICAgIH07XG4gICAgICAgICQoYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGFncyAudGFnc0xpc3QgLnRhZ1tpZD1cIiR7dGFnSWR9XCJdIC5jbGVhclBiQnV0dG9uYCkuYXR0cihcImFyaWEtbGFiZWxcIiwgXCJObyBQQiBmb3VuZFwiKTtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJUYWcgUEIgY2xlYXJlZC5cIiwgMCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlNvbWV0aGluZyB3ZW50IHdyb25nOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICB9XG59KSwgKHRoaXNQb3B1cCkgPT4ge1xuICAgIHRoaXNQb3B1cC50ZXh0ID0gYEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBjbGVhciBQQiBmb3IgdGFnICR7dGhpc1BvcHVwLnBhcmFtZXRlcnNbMV19P2A7XG59LCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIC8vXG59KTtcbmV4cG9ydHMubGlzdFtcImFwcGx5Q3VzdG9tRm9udFwiXSA9IG5ldyBTaW1wbGVQb3B1cChcImFwcGx5Q3VzdG9tRm9udFwiLCBcInRleHRcIiwgXCJDdXN0b20gZm9udFwiLCBbeyBwbGFjZWhvbGRlcjogXCJGb250IG5hbWVcIiwgaW5pdFZhbDogXCJcIiB9XSwgXCJNYWtlIHN1cmUgeW91IGhhdmUgdGhlIGZvbnQgaW5zdGFsbGVkIG9uIHlvdXIgY29tcHV0ZXIgYmVmb3JlIGFwcGx5aW5nLlwiLCBcIkFwcGx5XCIsIChfdGhpc1BvcHVwLCBmb250TmFtZSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBpZiAoZm9udE5hbWUgPT09IFwiXCIpXG4gICAgICAgIHJldHVybjtcbiAgICAoX2EgPSBTZXR0aW5ncy5ncm91cHNbXCJmb250RmFtaWx5XCJdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc2V0VmFsdWUoZm9udE5hbWUucmVwbGFjZSgvXFxzL2csIFwiX1wiKSk7XG59LCAoKSA9PiB7XG4gICAgLy9cbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0pO1xuZXhwb3J0cy5saXN0W1wicmVzZXRQZXJzb25hbEJlc3RzXCJdID0gbmV3IFNpbXBsZVBvcHVwKFwicmVzZXRQZXJzb25hbEJlc3RzXCIsIFwidGV4dFwiLCBcIlJlc2V0IFBlcnNvbmFsIEJlc3RzXCIsIFtcbiAgICB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIlBhc3N3b3JkXCIsXG4gICAgICAgIHR5cGU6IFwicGFzc3dvcmRcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuXSwgXCJcIiwgXCJSZXNldFwiLCAoX3RoaXNQb3B1cCwgcGFzc3dvcmQpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXI7XG4gICAgICAgIGlmICh1c2VyID09PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAodXNlci5wcm92aWRlckRhdGFbMF0ucHJvdmlkZXJJZCA9PT0gXCJwYXNzd29yZFwiKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVkZW50aWFsID0gYXV0aF8xLkVtYWlsQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwodXNlci5lbWFpbCwgcGFzc3dvcmQpO1xuICAgICAgICAgICAgeWllbGQgKDAsIGF1dGhfMS5yZWF1dGhlbnRpY2F0ZVdpdGhDcmVkZW50aWFsKSh1c2VyLCBjcmVkZW50aWFsKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh1c2VyLnByb3ZpZGVyRGF0YVswXS5wcm92aWRlcklkID09PSBcImdvb2dsZS5jb21cIikge1xuICAgICAgICAgICAgeWllbGQgKDAsIGF1dGhfMS5yZWF1dGhlbnRpY2F0ZVdpdGhQb3B1cCkodXNlciwgQWNjb3VudENvbnRyb2xsZXIuZ21haWxQcm92aWRlcik7XG4gICAgICAgIH1cbiAgICAgICAgTG9hZGVyLnNob3coKTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBhcGVfMS5kZWZhdWx0LnVzZXJzLmRlbGV0ZVBlcnNvbmFsQmVzdHMoKTtcbiAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJGYWlsZWQgdG8gcmVzZXQgcGVyc29uYWwgYmVzdHM6IFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUGVyc29uYWwgYmVzdHMgaGF2ZSBiZWVuIHJlc2V0XCIsIDEpO1xuICAgICAgICBEQi5nZXRTbmFwc2hvdCgpLnBlcnNvbmFsQmVzdHMgPSB7XG4gICAgICAgICAgICB0aW1lOiB7fSxcbiAgICAgICAgICAgIHdvcmRzOiB7fSxcbiAgICAgICAgICAgIHplbjogeyB6ZW46IFtdIH0sXG4gICAgICAgICAgICBxdW90ZTogeyBjdXN0b206IFtdIH0sXG4gICAgICAgICAgICBjdXN0b206IHsgY3VzdG9tOiBbXSB9LFxuICAgICAgICB9O1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChlLCAtMSk7XG4gICAgfVxufSksICh0aGlzUG9wdXApID0+IHtcbiAgICBjb25zdCB1c2VyID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyO1xuICAgIGlmICh1c2VyID09PSBudWxsKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKHVzZXIucHJvdmlkZXJEYXRhWzBdLnByb3ZpZGVySWQgPT09IFwiZ29vZ2xlLmNvbVwiKSB7XG4gICAgICAgIHRoaXNQb3B1cC5pbnB1dHMgPSBbXTtcbiAgICAgICAgdGhpc1BvcHVwLmJ1dHRvblRleHQgPSBcIlJlYXV0aGVudGljYXRlIHRvIHJlc2V0XCI7XG4gICAgfVxufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSk7XG5leHBvcnRzLmxpc3RbXCJyZXNldFNldHRpbmdzXCJdID0gbmV3IFNpbXBsZVBvcHVwKFwicmVzZXRTZXR0aW5nc1wiLCBcInRleHRcIiwgXCJSZXNldCBTZXR0aW5nc1wiLCBbXSwgXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gcmVzZXQgYWxsIHlvdXIgc2V0dGluZ3M/XCIsIFwiUmVzZXRcIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5yZXNldCgpO1xuICAgIC8vIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgIC8vICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gICAgLy8gfSwgMTAwMCk7XG59LCAoKSA9PiB7XG4gICAgLy9cbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0pO1xuZXhwb3J0cy5saXN0W1widW5saW5rRGlzY29yZFwiXSA9IG5ldyBTaW1wbGVQb3B1cChcInVubGlua0Rpc2NvcmRcIiwgXCJ0ZXh0XCIsIFwiVW5saW5rIERpc2NvcmRcIiwgW10sIFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHVubGluayB5b3VyIERpc2NvcmQgYWNjb3VudD9cIiwgXCJVbmxpbmtcIiwgKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgTG9hZGVyLnNob3coKTtcbiAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQudXNlcnMudW5saW5rRGlzY29yZCgpO1xuICAgIExvYWRlci5oaWRlKCk7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byB1bmxpbmsgRGlzY29yZDogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgfVxuICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQWNjb3VudHMgdW5saW5rZWRcIiwgMSk7XG4gICAgREIuZ2V0U25hcHNob3QoKS5kaXNjb3JkSWQgPSB1bmRlZmluZWQ7XG4gICAgU2V0dGluZ3MudXBkYXRlRGlzY29yZFNlY3Rpb24oKTtcbn0pLCAoKSA9PiB7XG4gICAgLy9cbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0pO1xuZXhwb3J0cy5saXN0W1wiZ2VuZXJhdGVBcGVLZXlcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJnZW5lcmF0ZUFwZUtleVwiLCBcInRleHRcIiwgXCJHZW5lcmF0ZSBuZXcga2V5XCIsIFtcbiAgICB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIk5hbWVcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuXSwgXCJcIiwgXCJHZW5lcmF0ZVwiLCAoX3RoaXNQb3B1cCwgbmFtZSkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgTG9hZGVyLnNob3coKTtcbiAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQuYXBlS2V5cy5nZW5lcmF0ZShuYW1lLCBmYWxzZSk7XG4gICAgTG9hZGVyLmhpZGUoKTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIGdlbmVyYXRlIGtleTogXCIgKyByZXNwb25zZS5tZXNzYWdlLCAtMSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb25zdCBkYXRhID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgZXhwb3J0cy5saXN0W1widmlld0FwZUtleVwiXS5zaG93KFtkYXRhLmFwZUtleV0pO1xuICAgIH1cbn0pLCAoKSA9PiB7XG4gICAgLy9cbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0pO1xuZXhwb3J0cy5saXN0W1widmlld0FwZUtleVwiXSA9IG5ldyBTaW1wbGVQb3B1cChcInZpZXdBcGVLZXlcIiwgXCJ0ZXh0XCIsIFwiQXBlIEtleVwiLCBbXG4gICAge1xuICAgICAgICB0eXBlOiBcInRleHRhcmVhXCIsXG4gICAgICAgIGRpc2FibGVkOiB0cnVlLFxuICAgICAgICBwbGFjZWhvbGRlcjogXCJLZXlcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuXSwgXCJUaGlzIGlzIHlvdXIgbmV3IEFwZSBLZXkuIFBsZWFzZSBrZWVwIGl0IHNhZmUuIFlvdSB3aWxsIG9ubHkgc2VlIGl0IG9uY2UhXCIsIFwiQ2xvc2VcIiwgKF90aGlzUG9wdXApID0+IHtcbiAgICBBcGVLZXlzUG9wdXAuc2hvdygpO1xufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICBfdGhpc1BvcHVwLmlucHV0c1swXS5pbml0VmFsID0gX3RoaXNQb3B1cC5wYXJhbWV0ZXJzWzBdO1xufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICBfdGhpc1BvcHVwLmNhbkNsb3NlID0gZmFsc2U7XG4gICAgJChcIiNzaW1wbGVQb3B1cCB0ZXh0YXJlYVwiKS5jc3MoXCJoZWlnaHRcIiwgXCIxMTBweFwiKTtcbiAgICAkKFwiI3NpbXBsZVBvcHVwIC5idXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIF90aGlzUG9wdXAuY2FuQ2xvc2UgPSB0cnVlO1xuICAgICAgICAkKFwiI3NpbXBsZVBvcHVwIC5idXR0b25cIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfSwgMzAwMCk7XG59KTtcbmV4cG9ydHMubGlzdFtcImRlbGV0ZUFwZUtleVwiXSA9IG5ldyBTaW1wbGVQb3B1cChcImRlbGV0ZUFwZUtleVwiLCBcInRleHRcIiwgXCJEZWxldGUgQXBlIEtleVwiLCBbXSwgXCJBcmUgeW91IHN1cmU/XCIsIFwiRGVsZXRlXCIsIChfdGhpc1BvcHVwKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBMb2FkZXIuc2hvdygpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5hcGVLZXlzLmRlbGV0ZShfdGhpc1BvcHVwLnBhcmFtZXRlcnNbMF0pO1xuICAgIExvYWRlci5oaWRlKCk7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byBkZWxldGUga2V5OiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICB9XG4gICAgTm90aWZpY2F0aW9ucy5hZGQoXCJLZXkgZGVsZXRlZFwiLCAxKTtcbiAgICBBcGVLZXlzUG9wdXAuc2hvdygpO1xufSksIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0pO1xuZXhwb3J0cy5saXN0W1wiZWRpdEFwZUtleVwiXSA9IG5ldyBTaW1wbGVQb3B1cChcImVkaXRBcGVLZXlcIiwgXCJ0ZXh0XCIsIFwiRWRpdCBBcGUgS2V5XCIsIFtcbiAgICB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIk5hbWVcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuXSwgXCJcIiwgXCJFZGl0XCIsIChfdGhpc1BvcHVwLCBpbnB1dCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgTG9hZGVyLnNob3coKTtcbiAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGFwZV8xLmRlZmF1bHQuYXBlS2V5cy51cGRhdGUoX3RoaXNQb3B1cC5wYXJhbWV0ZXJzWzBdLCB7XG4gICAgICAgIG5hbWU6IGlucHV0LFxuICAgIH0pO1xuICAgIExvYWRlci5oaWRlKCk7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIkZhaWxlZCB0byB1cGRhdGUga2V5OiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICB9XG4gICAgTm90aWZpY2F0aW9ucy5hZGQoXCJLZXkgdXBkYXRlZFwiLCAxKTtcbiAgICBBcGVLZXlzUG9wdXAuc2hvdygpO1xufSksIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0pO1xuZXhwb3J0cy5saXN0W1wic2F2ZUN1c3RvbVRleHRcIl0gPSBuZXcgU2ltcGxlUG9wdXAoXCJzYXZlQ3VzdG9tVGV4dFwiLCBcInRleHRcIiwgXCJTYXZlIGN1c3RvbSB0ZXh0XCIsIFtcbiAgICB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIk5hbWVcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuXSwgXCJcIiwgXCJTYXZlXCIsIChfdGhpc1BvcHVwLCBpbnB1dCkgPT4ge1xuICAgIGNvbnN0IHRleHQgPSAkKGAjY3VzdG9tVGV4dFBvcHVwIHRleHRhcmVhYCkudmFsKCkubm9ybWFsaXplKCk7XG4gICAgQ3VzdG9tVGV4dC5zZXRDdXN0b21UZXh0KGlucHV0LCB0ZXh0KTtcbiAgICBOb3RpZmljYXRpb25zLmFkZChcIkN1c3RvbSB0ZXh0IHNhdmVkXCIsIDEpO1xuICAgIEN1c3RvbVRleHRQb3B1cC5zaG93KCk7XG59LCAoKSA9PiB7XG4gICAgLy9cbn0sICgpID0+IHtcbiAgICAvL1xufSk7XG5leHBvcnRzLmxpc3RbXCJkZWxldGVDdXN0b21UZXh0XCJdID0gbmV3IFNpbXBsZVBvcHVwKFwiZGVsZXRlQ3VzdG9tVGV4dFwiLCBcInRleHRcIiwgXCJEZWxldGUgY3VzdG9tIHRleHRcIiwgW10sIFwiQXJlIHlvdSBzdXJlP1wiLCBcIkRlbGV0ZVwiLCAoX3RoaXNQb3B1cCkgPT4ge1xuICAgIEN1c3RvbVRleHQuZGVsZXRlQ3VzdG9tVGV4dChfdGhpc1BvcHVwLnBhcmFtZXRlcnNbMF0pO1xuICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ3VzdG9tIHRleHQgZGVsZXRlZFwiLCAxKTtcbiAgICBTYXZlZFRleHRzUG9wdXAuc2hvdygpO1xufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICBfdGhpc1BvcHVwLnRleHQgPSBgQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSBjdXN0b20gdGV4dCAke190aGlzUG9wdXAucGFyYW1ldGVyc1swXX0/YDtcbn0sICgpID0+IHtcbiAgICAvL1xufSk7XG5leHBvcnRzLmxpc3RbXCJ1cGRhdGVDdXN0b21UaGVtZVwiXSA9IG5ldyBTaW1wbGVQb3B1cChcInVwZGF0ZUN1c3RvbVRoZW1lXCIsIFwidGV4dFwiLCBcIlVwZGF0ZSBDdXN0b20gVGhlbWVcIiwgW1xuICAgIHtcbiAgICAgICAgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgIHBsYWNlaG9sZGVyOiBcIk5hbWVcIixcbiAgICAgICAgaW5pdFZhbDogXCJcIixcbiAgICB9LFxuICAgIHtcbiAgICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgICBpbml0VmFsOiBcImZhbHNlXCIsXG4gICAgICAgIGxhYmVsOiBcIlVwZGF0ZSBjdXN0b20gdGhlbWUgdG8gY3VycmVudCBjb2xvcnNcIixcbiAgICB9LFxuXSwgXCJcIiwgXCJVcGRhdGVcIiwgKF90aGlzUG9wdXAsIG5hbWUsIHVwZGF0ZUNvbG9ycykgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgY29uc3Qgc25hcHNob3QgPSBEQi5nZXRTbmFwc2hvdCgpO1xuICAgIGNvbnN0IGN1c3RvbVRoZW1lID0gc25hcHNob3QuY3VzdG9tVGhlbWVzLmZpbmQoKHQpID0+IHQuX2lkID09PSBfdGhpc1BvcHVwLnBhcmFtZXRlcnNbMF0pO1xuICAgIGlmIChjdXN0b21UaGVtZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ3VzdG9tIHRoZW1lIGRvZXMgbm90IGV4aXN0IVwiLCAtMSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IG5ld0NvbG9ycyA9IFtdO1xuICAgIGlmICh1cGRhdGVDb2xvcnMgPT09IFwidHJ1ZVwiKSB7XG4gICAgICAgICQuZWFjaCgkKFwiLnBhZ2VTZXR0aW5ncyAuY3VzdG9tVGhlbWUgLmN1c3RvbVRoZW1lRWRpdCBbdHlwZT0nY29sb3InXVwiKSwgKF9pbmRleCwgZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgbmV3Q29sb3JzLnB1c2goJChlbGVtZW50KS5hdHRyKFwidmFsdWVcIikpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG5ld0NvbG9ycyA9IGN1c3RvbVRoZW1lLmNvbG9ycztcbiAgICB9XG4gICAgY29uc3QgbmV3VGhlbWUgPSB7XG4gICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgIGNvbG9yczogbmV3Q29sb3JzLFxuICAgIH07XG4gICAgTG9hZGVyLnNob3coKTtcbiAgICB5aWVsZCBEQi5lZGl0Q3VzdG9tVGhlbWUoY3VzdG9tVGhlbWUuX2lkLCBuZXdUaGVtZSk7XG4gICAgTG9hZGVyLmhpZGUoKTtcbiAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWVDb2xvcnMobmV3Q29sb3JzKTtcbiAgICBOb3RpZmljYXRpb25zLmFkZChcIkN1c3RvbSB0aGVtZSB1cGRhdGVkXCIsIDEpO1xuICAgIFRoZW1lUGlja2VyLnJlZnJlc2hCdXR0b25zKCk7XG59KSwgKF90aGlzUG9wdXApID0+IHtcbiAgICBjb25zdCBzbmFwc2hvdCA9IERCLmdldFNuYXBzaG90KCk7XG4gICAgY29uc3QgY3VzdG9tVGhlbWUgPSBzbmFwc2hvdC5jdXN0b21UaGVtZXMuZmluZCgodCkgPT4gdC5faWQgPT09IF90aGlzUG9wdXAucGFyYW1ldGVyc1swXSk7XG4gICAgaWYgKCFjdXN0b21UaGVtZSlcbiAgICAgICAgcmV0dXJuO1xuICAgIF90aGlzUG9wdXAuaW5wdXRzWzBdLmluaXRWYWwgPSBjdXN0b21UaGVtZS5uYW1lO1xufSwgKF90aGlzUG9wdXApID0+IHtcbiAgICAvL1xufSk7XG5leHBvcnRzLmxpc3RbXCJkZWxldGVDdXN0b21UaGVtZVwiXSA9IG5ldyBTaW1wbGVQb3B1cChcImRlbGV0ZUN1c3RvbVRoZW1lXCIsIFwidGV4dFwiLCBcIkRlbGV0ZSBDdXN0b20gVGhlbWVcIiwgW10sIFwiQXJlIHlvdSBzdXJlP1wiLCBcIkRlbGV0ZVwiLCAoX3RoaXNQb3B1cCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgTG9hZGVyLnNob3coKTtcbiAgICB5aWVsZCBEQi5kZWxldGVDdXN0b21UaGVtZShfdGhpc1BvcHVwLnBhcmFtZXRlcnNbMF0pO1xuICAgIExvYWRlci5oaWRlKCk7XG4gICAgTm90aWZpY2F0aW9ucy5hZGQoXCJDdXN0b20gdGhlbWUgZGVsZXRlZFwiLCAxKTtcbiAgICBUaGVtZVBpY2tlci5yZWZyZXNoQnV0dG9ucygpO1xufSksIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0sIChfdGhpc1BvcHVwKSA9PiB7XG4gICAgLy9cbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uZGlzY29yZEludGVncmF0aW9uICN1bmxpbmtEaXNjb3JkQnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGV4cG9ydHMubGlzdFtcInVubGlua0Rpc2NvcmRcIl0uc2hvdygpO1xufSk7XG4kKFwiI3Jlc2V0U2V0dGluZ3NCdXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgZXhwb3J0cy5saXN0W1wicmVzZXRTZXR0aW5nc1wiXS5zaG93KCk7XG59KTtcbiQoXCIucGFnZVNldHRpbmdzICNyZXNldFBlcnNvbmFsQmVzdHNCdXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgZXhwb3J0cy5saXN0W1wicmVzZXRQZXJzb25hbEJlc3RzXCJdLnNob3coKTtcbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgI3VwZGF0ZUFjY291bnROYW1lXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGV4cG9ydHMubGlzdFtcInVwZGF0ZU5hbWVcIl0uc2hvdygpO1xufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAjYWRkUGFzc3dvcmRBdXRoXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGV4cG9ydHMubGlzdFtcImFkZFBhc3N3b3JkQXV0aFwiXS5zaG93KCk7XG59KTtcbiQoXCIucGFnZVNldHRpbmdzICNlbWFpbFBhc3N3b3JkQXV0aFwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBleHBvcnRzLmxpc3RbXCJ1cGRhdGVFbWFpbFwiXS5zaG93KCk7XG59KTtcbiQoXCIucGFnZVNldHRpbmdzICNwYXNzUGFzc3dvcmRBdXRoXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGV4cG9ydHMubGlzdFtcInVwZGF0ZVBhc3N3b3JkXCJdLnNob3coKTtcbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgI2RlbGV0ZUFjY291bnRcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgZXhwb3J0cy5saXN0W1wiZGVsZXRlQWNjb3VudFwiXS5zaG93KCk7XG59KTtcbiQoXCIjYXBlS2V5c1BvcHVwIC5nZW5lcmF0ZUFwZUtleVwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBleHBvcnRzLmxpc3RbXCJnZW5lcmF0ZUFwZUtleVwiXS5zaG93KCk7XG59KTtcbiQoYCNjdXN0b21UZXh0UG9wdXAgLmJ1dHRvbnNUb3AgLnNhdmVDdXN0b21UZXh0YCkub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgZXhwb3J0cy5saXN0W1wic2F2ZUN1c3RvbVRleHRcIl0uc2hvdygpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLmN1c3RvbVRoZW1lIC5kZWxCdXR0b25cIiwgKGUpID0+IHtcbiAgICBjb25zdCAkcGFyZW50RWxlbWVudCA9ICQoZS5jdXJyZW50VGFyZ2V0KS5wYXJlbnQoXCIuY3VzdG9tVGhlbWUuYnV0dG9uXCIpO1xuICAgIGNvbnN0IGN1c3RvbVRoZW1lSWQgPSAkcGFyZW50RWxlbWVudC5hdHRyKFwiY3VzdG9tVGhlbWVJZFwiKTtcbiAgICBleHBvcnRzLmxpc3RbXCJkZWxldGVDdXN0b21UaGVtZVwiXS5zaG93KFtjdXN0b21UaGVtZUlkXSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAuY3VzdG9tVGhlbWUgLmVkaXRCdXR0b25cIiwgKGUpID0+IHtcbiAgICBjb25zdCAkcGFyZW50RWxlbWVudCA9ICQoZS5jdXJyZW50VGFyZ2V0KS5wYXJlbnQoXCIuY3VzdG9tVGhlbWUuYnV0dG9uXCIpO1xuICAgIGNvbnN0IGN1c3RvbVRoZW1lSWQgPSAkcGFyZW50RWxlbWVudC5hdHRyKFwiY3VzdG9tVGhlbWVJZFwiKTtcbiAgICBleHBvcnRzLmxpc3RbXCJ1cGRhdGVDdXN0b21UaGVtZVwiXS5zaG93KFtjdXN0b21UaGVtZUlkXSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgYCNzYXZlZFRleHRzUG9wdXBXcmFwcGVyIC5saXN0IC5zYXZlZFRleHQgLmJ1dHRvbi5kZWxldGVgLCAoZSkgPT4ge1xuICAgIGNvbnN0IG5hbWUgPSAkKGUudGFyZ2V0KS5zaWJsaW5ncyhcIi5idXR0b24ubmFtZVwiKS50ZXh0KCk7XG4gICAgZXhwb3J0cy5saXN0W1wiZGVsZXRlQ3VzdG9tVGV4dFwiXS5zaG93KFtuYW1lXSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjYXBlS2V5c1BvcHVwIHRhYmxlIHRib2R5IHRyIC5idXR0b24uZGVsZXRlXCIsIChlKSA9PiB7XG4gICAgY29uc3Qga2V5SWQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KFwidHJcIikuYXR0cihcImtleUlkXCIpO1xuICAgIGV4cG9ydHMubGlzdFtcImRlbGV0ZUFwZUtleVwiXS5zaG93KFtrZXlJZF0pO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI2FwZUtleXNQb3B1cCB0YWJsZSB0Ym9keSB0ciAuYnV0dG9uLmVkaXRcIiwgKGUpID0+IHtcbiAgICBjb25zdCBrZXlJZCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoXCJ0clwiKS5hdHRyKFwia2V5SWRcIik7XG4gICAgZXhwb3J0cy5saXN0W1wiZWRpdEFwZUtleVwiXS5zaG93KFtrZXlJZF0pO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi5mb250RmFtaWx5IC5idXR0b24uY3VzdG9tXCIsICgpID0+IHtcbiAgICBleHBvcnRzLmxpc3RbXCJhcHBseUN1c3RvbUZvbnRcIl0uc2hvdyhbXSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwia2V5ZG93blwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiICYmICEkKFwiI3NpbXBsZVBvcHVwV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICBoaWRlKCk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgQ29tbWFuZGxpbmUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2NvbW1hbmRsaW5lXCIpKTtcbmNvbnN0IENvbW1hbmRsaW5lTGlzdHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2NvbW1hbmRsaW5lLWxpc3RzXCIpKTtcbiQoZG9jdW1lbnQuYm9keSkub24oXCJjbGlja1wiLCBcIiNzdXBwb3J0TWVCdXR0b25cIiwgKCkgPT4ge1xuICAgICQoXCIjc3VwcG9ydE1lV3JhcHBlclwiKVxuICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEyNSk7XG59KTtcbiQoZG9jdW1lbnQuYm9keSkub24oXCJjbGlja1wiLCBcIiNzdXBwb3J0TWVXcmFwcGVyXCIsICgpID0+IHtcbiAgICAkKFwiI3N1cHBvcnRNZVdyYXBwZXJcIilcbiAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAwIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAkKFwiI3N1cHBvcnRNZVdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfSk7XG59KTtcbiQoZG9jdW1lbnQuYm9keSkub24oXCJjbGlja1wiLCBcIiNzdXBwb3J0TWVXcmFwcGVyIC5idXR0b24uYWRzXCIsICgpID0+IHtcbiAgICBDb21tYW5kbGluZUxpc3RzLnB1c2hDdXJyZW50KENvbW1hbmRsaW5lTGlzdHMuY29tbWFuZHNFbmFibGVBZHMpO1xuICAgIENvbW1hbmRsaW5lLnNob3coKTtcbiAgICAkKFwiI3N1cHBvcnRNZVdyYXBwZXJcIilcbiAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAwIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAkKFwiI3N1cHBvcnRNZVdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfSk7XG59KTtcbiQoZG9jdW1lbnQuYm9keSkub24oXCJjbGlja1wiLCBcIiNzdXBwb3J0TWVXcmFwcGVyIGEuYnV0dG9uXCIsICgpID0+IHtcbiAgICAkKFwiI3N1cHBvcnRNZVdyYXBwZXJcIilcbiAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAwIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAkKFwiI3N1cHBvcnRNZVdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfSk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuZnVuY3Rpb24gc2hvdygpIHtcbiAgICAkKFwiI3ZlcnNpb25IaXN0b3J5V3JhcHBlclwiKVxuICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEyNSk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiLnZlcnNpb25cIiwgKGUpID0+IHtcbiAgICBpZiAoZS5zaGlmdEtleSlcbiAgICAgICAgcmV0dXJuO1xuICAgIHNob3coKTtcbn0pO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiI3ZlcnNpb25IaXN0b3J5V3JhcHBlclwiLCAoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwidmVyc2lvbkhpc3RvcnlXcmFwcGVyXCIpIHtcbiAgICAgICAgJChcIiN2ZXJzaW9uSGlzdG9yeVdyYXBwZXJcIilcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDEpXG4gICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3ZlcnNpb25IaXN0b3J5V3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNob3cgPSB2b2lkIDA7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IEN1c3RvbVRleHQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3Rlc3QvY3VzdG9tLXRleHRcIikpO1xubGV0IGluaXRpYWxpc2VkID0gZmFsc2U7XG5mdW5jdGlvbiBpbml0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmICghaW5pdGlhbGlzZWQpIHtcbiAgICAgICAgICAgICQoXCIjd29yZEZpbHRlclBvcHVwIC5sYW5ndWFnZUlucHV0XCIpLmVtcHR5KCk7XG4gICAgICAgICAgICBjb25zdCBMYW5ndWFnZUxpc3QgPSB5aWVsZCBNaXNjLmdldExhbmd1YWdlTGlzdCgpO1xuICAgICAgICAgICAgTGFuZ3VhZ2VMaXN0LmZvckVhY2goKGxhbmd1YWdlKSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHByZXR0eUxhbmcgPSBsYW5ndWFnZTtcbiAgICAgICAgICAgICAgICBwcmV0dHlMYW5nID0gcHJldHR5TGFuZy5yZXBsYWNlKFwiX1wiLCBcIiBcIik7XG4gICAgICAgICAgICAgICAgJChcIiN3b3JkRmlsdGVyUG9wdXAgLmxhbmd1YWdlSW5wdXRcIikuYXBwZW5kKGBcbiAgICAgICAgPG9wdGlvbiB2YWx1ZT0ke2xhbmd1YWdlfT4ke3ByZXR0eUxhbmd9PC9vcHRpb24+XG4gICAgICBgKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaW5pdGlhbGlzZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5mdW5jdGlvbiBzaG93KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHlpZWxkIGluaXQoKTtcbiAgICAgICAgJChcIiN3b3JkRmlsdGVyUG9wdXBXcmFwcGVyXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI2N1c3RvbVRleHRQb3B1cFdyYXBwZXJcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjd29yZEZpbHRlclBvcHVwIC5sYW5ndWFnZUlucHV0XCIpLnNlbGVjdDIoe1xuICAgICAgICAgICAgd2lkdGg6IFwiMTAwJVwiLFxuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgICQoXCIjd29yZEZpbHRlclBvcHVwV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAkKFwiI2N1c3RvbVRleHRQb3B1cFdyYXBwZXJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG59XG5mdW5jdGlvbiBmaWx0ZXIobGFuZ3VhZ2UpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBsZXQgZmlsdGVyaW4gPSAkKFwiI3dvcmRGaWx0ZXJQb3B1cCAud29yZEluY2x1ZGVJbnB1dFwiKS52YWwoKTtcbiAgICAgICAgZmlsdGVyaW4gPSBNaXNjLmVzY2FwZVJlZ0V4cChmaWx0ZXJpbiA9PT0gbnVsbCB8fCBmaWx0ZXJpbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmlsdGVyaW4udHJpbSgpKTtcbiAgICAgICAgZmlsdGVyaW4gPSBmaWx0ZXJpbi5yZXBsYWNlKC9cXHMrL2dpLCBcInxcIik7XG4gICAgICAgIGNvbnN0IHJlZ2luY2wgPSBuZXcgUmVnRXhwKGZpbHRlcmluLCBcImlcIik7XG4gICAgICAgIGxldCBmaWx0ZXJvdXQgPSAkKFwiI3dvcmRGaWx0ZXJQb3B1cCAud29yZEV4Y2x1ZGVJbnB1dFwiKS52YWwoKTtcbiAgICAgICAgZmlsdGVyb3V0ID0gTWlzYy5lc2NhcGVSZWdFeHAoZmlsdGVyb3V0LnRyaW0oKSk7XG4gICAgICAgIGZpbHRlcm91dCA9IGZpbHRlcm91dC5yZXBsYWNlKC9cXHMrL2dpLCBcInxcIik7XG4gICAgICAgIGNvbnN0IHJlZ2V4Y2wgPSBuZXcgUmVnRXhwKGZpbHRlcm91dCwgXCJpXCIpO1xuICAgICAgICBjb25zdCBmaWx0ZXJlZFdvcmRzID0gW107XG4gICAgICAgIGNvbnN0IGxhbmd1YWdlV29yZExpc3QgPSB5aWVsZCBNaXNjLmdldExhbmd1YWdlKGxhbmd1YWdlKTtcbiAgICAgICAgY29uc3QgbWF4TGVuZ3RoSW5wdXQgPSAkKFwiI3dvcmRGaWx0ZXJQb3B1cCAud29yZE1heElucHV0XCIpLnZhbCgpO1xuICAgICAgICBjb25zdCBtaW5MZW5ndGhJbnB1dCA9ICQoXCIjd29yZEZpbHRlclBvcHVwIC53b3JkTWluSW5wdXRcIikudmFsKCk7XG4gICAgICAgIGxldCBtYXhMZW5ndGg7XG4gICAgICAgIGxldCBtaW5MZW5ndGg7XG4gICAgICAgIGlmIChtYXhMZW5ndGhJbnB1dCA9PSBcIlwiKSB7XG4gICAgICAgICAgICBtYXhMZW5ndGggPSA5OTk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtYXhMZW5ndGggPSBwYXJzZUludChtYXhMZW5ndGhJbnB1dCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1pbkxlbmd0aElucHV0ID09IFwiXCIpIHtcbiAgICAgICAgICAgIG1pbkxlbmd0aCA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtaW5MZW5ndGggPSBwYXJzZUludChtaW5MZW5ndGhJbnB1dCk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsYW5ndWFnZVdvcmRMaXN0LndvcmRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCB3b3JkID0gbGFuZ3VhZ2VXb3JkTGlzdC53b3Jkc1tpXTtcbiAgICAgICAgICAgIGNvbnN0IHRlc3QxID0gcmVnaW5jbC50ZXN0KHdvcmQpO1xuICAgICAgICAgICAgY29uc3QgdGVzdDIgPSByZWdleGNsLnRlc3Qod29yZCk7XG4gICAgICAgICAgICBpZiAoKCh0ZXN0MSAmJiAhdGVzdDIpIHx8ICh0ZXN0MSAmJiBmaWx0ZXJvdXQgPT0gXCJcIikpICYmXG4gICAgICAgICAgICAgICAgd29yZC5sZW5ndGggPD0gbWF4TGVuZ3RoICYmXG4gICAgICAgICAgICAgICAgd29yZC5sZW5ndGggPj0gbWluTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgZmlsdGVyZWRXb3Jkcy5wdXNoKHdvcmQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmaWx0ZXJlZFdvcmRzO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gYXBwbHkoc2V0KSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgbGFuZ3VhZ2UgPSAkKFwiI3dvcmRGaWx0ZXJQb3B1cCAubGFuZ3VhZ2VJbnB1dFwiKS52YWwoKTtcbiAgICAgICAgY29uc3QgZmlsdGVyZWRXb3JkcyA9IHlpZWxkIGZpbHRlcihsYW5ndWFnZSk7XG4gICAgICAgIGNvbnN0IGN1c3RvbVRleHQgPSBmaWx0ZXJlZFdvcmRzLmpvaW4oQ3VzdG9tVGV4dC5kZWxpbWl0ZXIpO1xuICAgICAgICAkKFwiI2N1c3RvbVRleHRQb3B1cCB0ZXh0YXJlYVwiKS52YWwoKF8sIHZhbCkgPT4gKHNldCA/IFwiXCIgOiB2YWwgKyBcIiBcIikgKyBjdXN0b21UZXh0KTtcbiAgICAgICAgaGlkZSgpO1xuICAgIH0pO1xufVxuJChcIiN3b3JkRmlsdGVyUG9wdXBXcmFwcGVyXCIpLm1vdXNlZG93bigoZSkgPT4ge1xuICAgIGlmICgkKGUudGFyZ2V0KS5hdHRyKFwiaWRcIikgPT09IFwid29yZEZpbHRlclBvcHVwV3JhcHBlclwiKSB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9XG59KTtcbiQoXCIjd29yZEZpbHRlclBvcHVwIC5sYW5ndWFnZUlucHV0XCIpLm9uZShcInNlbGVjdDI6b3BlblwiLCBmdW5jdGlvbiAoKSB7XG4gICAgJChcImlucHV0LnNlbGVjdDItc2VhcmNoX19maWVsZFwiKS5wcm9wKFwicGxhY2Vob2xkZXJcIiwgXCJzZWFyY2hcIik7XG59KTtcbiQoXCIjd29yZEZpbHRlclBvcHVwV3JhcHBlciAuYnV0dG9uXCIpLm1vdXNlZG93bigoZSkgPT4ge1xuICAgICQoXCIjd29yZEZpbHRlclBvcHVwV3JhcHBlciAubG9hZGluZ0luZGljYXRvclwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAkKFwiI3dvcmRGaWx0ZXJQb3B1cFdyYXBwZXIgLmJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgYXBwbHkoJChlLnRhcmdldCkuaXMoXCIjc2V0XCIpKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICQoXCIjd29yZEZpbHRlclBvcHVwV3JhcHBlciAubG9hZGluZ0luZGljYXRvclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIjd29yZEZpbHRlclBvcHVwV3JhcHBlciAuYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9LCAxKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IE1hbnVhbFJlc3RhcnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC9tYW51YWwtcmVzdGFydC10cmFja2VyXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IFZlcmlmaWNhdGlvbkNvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY29udHJvbGxlcnMvdmVyaWZpY2F0aW9uLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgUm91dGVDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2NvbnRyb2xsZXJzL3JvdXRlLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgUGFnZUNvbnRyb2xsZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY29udHJvbGxlcnMvcGFnZS1jb250cm9sbGVyXCIpKTtcbmNvbnN0IE1vbmtleVBvd2VyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2VsZW1lbnRzL21vbmtleS1wb3dlclwiKSk7XG5jb25zdCBOZXdWZXJzaW9uTm90aWZpY2F0aW9uID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2VsZW1lbnRzL3ZlcnNpb24tY2hlY2tcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IEZvY3VzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QvZm9jdXNcIikpO1xuTWFudWFsUmVzdGFydC5zZXQoKTtcblVwZGF0ZUNvbmZpZy5sb2FkRnJvbUxvY2FsU3RvcmFnZSgpO1xuaWYgKHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSA9PT0gXCJsb2NhbGhvc3RcIikge1xuICAgICQoXCIjYm90dG9tIC52ZXJzaW9uIC50ZXh0XCIpLnRleHQoXCJsb2NhbGhvc3RcIik7XG4gICAgJChcIiNib3R0b20gLnZlcnNpb25cIikuY3NzKFwib3BhY2l0eVwiLCAxKTtcbn1cbmVsc2Uge1xuICAgIE1pc2MuZ2V0UmVsZWFzZXNGcm9tR2l0SHViKCkudGhlbigodikgPT4ge1xuICAgICAgICBOZXdWZXJzaW9uTm90aWZpY2F0aW9uLnNob3codlswXS5uYW1lKTtcbiAgICB9KTtcbn1cbkZvY3VzLnNldCh0cnVlLCB0cnVlKTtcblJvdXRlQ29udHJvbGxlci5oYW5kbGVJbml0aWFsUGFnZUNsYXNzZXMod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lKTtcbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcbiAgICBpZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09PSBcIi9cIikge1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICAkKFwiYm9keVwiKS5jc3MoXCJ0cmFuc2l0aW9uXCIsIFwiYWxsIC4yNXMsIHRyYW5zZm9ybSAuMDVzXCIpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnF1aWNrVGFiKSB7XG4gICAgICAgICQoXCIjcmVzdGFydFRlc3RCdXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGlmICghd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwibWVyY2hiYW5uZXJjbG9zZWRcIikpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGRCYW5uZXIoYENoZWNrb3V0IG91ciBtZXJjaGFuZGlzZSwgYXZhaWxhYmxlIGF0IDxhIHRhcmdldD1cIl9ibGFua1wiIGhyZWY9XCJodHRwczovL21vbmtleXR5cGUuc3RvcmUvXCI+bW9ua2V5dHlwZS5zdG9yZTwvYT5gLCAxLCBcImltYWdlcy9tZXJjaGRyb3B3ZWJzaXRlMi5wbmdcIiwgZmFsc2UsICgpID0+IHtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcIm1lcmNoYmFubmVyY2xvc2VkXCIsIFwidHJ1ZVwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgICQoXCIjY2VudGVyQ29udGVudFwiKVxuICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCBcIjBcIilcbiAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgIC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAyNTAsICgpID0+IHtcbiAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gXCIvdmVyaWZ5XCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGZyYWdtZW50ID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uaGFzaC5zbGljZSgxKSk7XG4gICAgICAgICAgICBpZiAoZnJhZ21lbnQuaGFzKFwiYWNjZXNzX3Rva2VuXCIpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSBmcmFnbWVudC5nZXQoXCJhY2Nlc3NfdG9rZW5cIik7XG4gICAgICAgICAgICAgICAgY29uc3QgdG9rZW5UeXBlID0gZnJhZ21lbnQuZ2V0KFwidG9rZW5fdHlwZVwiKTtcbiAgICAgICAgICAgICAgICBWZXJpZmljYXRpb25Db250cm9sbGVyLnNldCh7XG4gICAgICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuOiBhY2Nlc3NUb2tlbixcbiAgICAgICAgICAgICAgICAgICAgdG9rZW5UeXBlOiB0b2tlblR5cGUsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUoXCIvXCIsIFwiXCIsIFwiL1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHBhZ2UgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZShcIi9cIiwgXCJcIik7XG4gICAgICAgICAgICBQYWdlQ29udHJvbGxlci5jaGFuZ2UocGFnZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09PSBcIi9hY2NvdW50XCIpIHtcbiAgICAgICAgICAgIC8vIGhpc3RvcnkucmVwbGFjZVN0YXRlKFwiL1wiLCBudWxsLCBcIi9cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoL2NoYWxsZW5nZV8uKy9nLnRlc3Qod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lKSkge1xuICAgICAgICAgICAgLy9kbyBub3RoaW5nXG4gICAgICAgICAgICAvLyB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lICE9PSBcIi9cIikge1xuICAgICAgICAgICAgLy8gbGV0IHBhZ2UgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZShcIi9cIiwgXCJcIik7XG4gICAgICAgICAgICAvLyBQYWdlQ29udHJvbGxlci5jaGFuZ2UocGFnZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICAvLyBTZXR0aW5ncy5zZXR0aW5nc0ZpbGxQcm9taXNlLnRoZW4oU2V0dGluZ3MudXBkYXRlKTtcbiAgICBNb25rZXlQb3dlci5pbml0KCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jbGFzcyBTZXR0aW5nc0dyb3VwIHtcbiAgICBjb25zdHJ1Y3Rvcihjb25maWdOYW1lLCBjb25maWdGdW5jdGlvbiwgbW9kZSwgc2V0Q2FsbGJhY2ssIHVwZGF0ZUNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuY29uZmlnTmFtZSA9IGNvbmZpZ05hbWU7XG4gICAgICAgIHRoaXMuY29uZmlnVmFsdWUgPSBjb25maWdfMS5kZWZhdWx0W2NvbmZpZ05hbWVdO1xuICAgICAgICB0aGlzLm1vZGUgPSBtb2RlO1xuICAgICAgICB0aGlzLmNvbmZpZ0Z1bmN0aW9uID0gY29uZmlnRnVuY3Rpb247XG4gICAgICAgIHRoaXMuc2V0Q2FsbGJhY2sgPSBzZXRDYWxsYmFjaztcbiAgICAgICAgdGhpcy51cGRhdGVDYWxsYmFjayA9IHVwZGF0ZUNhbGxiYWNrO1xuICAgICAgICB0aGlzLnVwZGF0ZUlucHV0KCk7XG4gICAgICAgIGlmICh0aGlzLm1vZGUgPT09IFwic2VsZWN0XCIpIHtcbiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKFwiY2hhbmdlXCIsIGAucGFnZVNldHRpbmdzIC5zZWN0aW9uLiR7dGhpcy5jb25maWdOYW1lfSBzZWxlY3RgLCAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0Lmhhc0NsYXNzKFwiZGlzYWJsZWRcIikgfHxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Lmhhc0NsYXNzKFwibm8tYXV0by1oYW5kbGVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlKHRhcmdldC52YWwoKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLm1vZGUgPT09IFwiYnV0dG9uXCIpIHtcbiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uJHt0aGlzLmNvbmZpZ05hbWV9IC5idXR0b25gLCAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0Lmhhc0NsYXNzKFwiZGlzYWJsZWRcIikgfHxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Lmhhc0NsYXNzKFwibm8tYXV0by1oYW5kbGVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsZXQgdmFsdWUgPSB0YXJnZXQuYXR0cihjb25maWdOYW1lKTtcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbXMgPSB0YXJnZXQuYXR0cihcInBhcmFtc1wiKTtcbiAgICAgICAgICAgICAgICBpZiAoIXZhbHVlICYmICFwYXJhbXMpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IFwidHJ1ZVwiKVxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSBcImZhbHNlXCIpXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZSwgcGFyYW1zKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNldFZhbHVlKHZhbHVlLCBwYXJhbXMpIHtcbiAgICAgICAgaWYgKHBhcmFtcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZ0Z1bmN0aW9uKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY29uZmlnRnVuY3Rpb24odmFsdWUsIC4uLnBhcmFtcyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cGRhdGVJbnB1dCgpO1xuICAgICAgICBpZiAodGhpcy5zZXRDYWxsYmFjaylcbiAgICAgICAgICAgIHRoaXMuc2V0Q2FsbGJhY2soKTtcbiAgICB9XG4gICAgdXBkYXRlSW5wdXQoKSB7XG4gICAgICAgIHRoaXMuY29uZmlnVmFsdWUgPSBjb25maWdfMS5kZWZhdWx0W3RoaXMuY29uZmlnTmFtZV07XG4gICAgICAgICQoYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uJHt0aGlzLmNvbmZpZ05hbWV9IC5idXR0b25gKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gXCJzZWxlY3RcIikge1xuICAgICAgICAgICAgJChgLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi4ke3RoaXMuY29uZmlnTmFtZX0gc2VsZWN0YClcbiAgICAgICAgICAgICAgICAudmFsKHRoaXMuY29uZmlnVmFsdWUpXG4gICAgICAgICAgICAgICAgLnRyaWdnZXIoXCJjaGFuZ2Uuc2VsZWN0MlwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLm1vZGUgPT09IFwiYnV0dG9uXCIpIHtcbiAgICAgICAgICAgICQoYC5wYWdlU2V0dGluZ3MgLnNlY3Rpb24uJHt0aGlzLmNvbmZpZ05hbWV9IC5idXR0b25bJHt0aGlzLmNvbmZpZ05hbWV9PScke3RoaXMuY29uZmlnVmFsdWV9J11gKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy51cGRhdGVDYWxsYmFjaylcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQ2FsbGJhY2soKTtcbiAgICB9XG59XG5leHBvcnRzLmRlZmF1bHQgPSBTZXR0aW5nc0dyb3VwO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51cGRhdGVBY3RpdmVUYWIgPSBleHBvcnRzLnNhdmVDdXN0b21UaGVtZUNvbG9ycyA9IGV4cG9ydHMuc2V0Q3VzdG9tSW5wdXRzID0gZXhwb3J0cy5yZWZyZXNoQnV0dG9ucyA9IGV4cG9ydHMudXBkYXRlQWN0aXZlQnV0dG9uID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgVGhlbWVDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy90aGVtZS1jb250cm9sbGVyXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBUaGVtZUNvbG9ycyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvdGhlbWUtY29sb3JzXCIpKTtcbmNvbnN0IENoYXJ0Q29udHJvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvY2hhcnQtY29udHJvbGxlclwiKSk7XG5jb25zdCBDdXN0b21UaGVtZVBvcHVwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9wb3B1cHMvY3VzdG9tLXRoZW1lLXBvcHVwXCIpKTtcbmNvbnN0IExvYWRlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbG9hZGVyXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi4vZmlyZWJhc2VcIik7XG5mdW5jdGlvbiB1cGRhdGVBY3RpdmVCdXR0b24oKSB7XG4gICAgbGV0IGFjdGl2ZVRoZW1lTmFtZSA9IGNvbmZpZ18xLmRlZmF1bHQudGhlbWU7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucmFuZG9tVGhlbWUgIT09IFwib2ZmXCIgJiZcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5yYW5kb21UaGVtZSAhPT0gXCJjdXN0b21cIiAmJlxuICAgICAgICBUaGVtZUNvbnRyb2xsZXIucmFuZG9tVGhlbWUgIT09IG51bGwpIHtcbiAgICAgICAgYWN0aXZlVGhlbWVOYW1lID0gVGhlbWVDb250cm9sbGVyLnJhbmRvbVRoZW1lO1xuICAgIH1cbiAgICAkKGAucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAudGhlbWVgKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAkKGAucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAudGhlbWVbdGhlbWU9JHthY3RpdmVUaGVtZU5hbWV9XWApLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xufVxuZXhwb3J0cy51cGRhdGVBY3RpdmVCdXR0b24gPSB1cGRhdGVBY3RpdmVCdXR0b247XG5mdW5jdGlvbiB1cGRhdGVDb2xvcnMoY29sb3JQaWNrZXIsIGNvbG9yLCBvbmx5U3R5bGUgPSBmYWxzZSwgbm9UaGVtZVVwZGF0ZSA9IGZhbHNlKSB7XG4gICAgaWYgKG9ubHlTdHlsZSkge1xuICAgICAgICBjb25zdCBjb2xvcklEID0gY29sb3JQaWNrZXIuZmluZChcImlucHV0W3R5cGU9Y29sb3JdXCIpLmF0dHIoXCJpZFwiKTtcbiAgICAgICAgaWYgKGNvbG9ySUQgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDb3VsZCBub3QgZmluZCBjb2xvciBJRCFcIik7XG4gICAgICAgIGlmICghbm9UaGVtZVVwZGF0ZSAmJiBjb2xvcklEICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eShjb2xvcklELCBjb2xvcik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGlja2VyQnV0dG9uID0gY29sb3JQaWNrZXIuZmluZChcImxhYmVsXCIpO1xuICAgICAgICBwaWNrZXJCdXR0b24udmFsKGNvbG9yKTtcbiAgICAgICAgcGlja2VyQnV0dG9uLmF0dHIoXCJ2YWx1ZVwiLCBjb2xvcik7XG4gICAgICAgIGlmIChwaWNrZXJCdXR0b24uYXR0cihcImZvclwiKSAhPT0gXCItLWJnLWNvbG9yXCIpIHtcbiAgICAgICAgICAgIHBpY2tlckJ1dHRvbi5jc3MoXCJiYWNrZ3JvdW5kLWNvbG9yXCIsIGNvbG9yKTtcbiAgICAgICAgfVxuICAgICAgICBjb2xvclBpY2tlci5maW5kKFwiaW5wdXRbdHlwZT10ZXh0XVwiKS52YWwoY29sb3IpO1xuICAgICAgICBjb2xvclBpY2tlci5maW5kKFwiaW5wdXRbdHlwZT1jb2xvcl1cIikuYXR0cihcInZhbHVlXCIsIGNvbG9yKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBjb2xvclJFR0VYID0gW1xuICAgICAgICB7XG4gICAgICAgICAgICBydWxlOiAvXFxiWzAtOV17MSwzfSxcXHM/WzAtOV17MSwzfSxcXHM/WzAtOV17MSwzfVxccypcXGIvLFxuICAgICAgICAgICAgc3RhcnQ6IFwicmdiKFwiLFxuICAgICAgICAgICAgZW5kOiBcIilcIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgcnVsZTogL1xcYltBLVosIGEteiwgMC05XXs2fVxcYi8sXG4gICAgICAgICAgICBzdGFydDogXCIjXCIsXG4gICAgICAgICAgICBlbmQ6IFwiXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIHJ1bGU6IC9cXGJbMC05XXsxLDN9LFxccz9bMC05XXsxLDN9JSxcXHM/WzAtOV17MSwzfSU/XFxzKlxcYi8sXG4gICAgICAgICAgICBzdGFydDogXCJoc2woXCIsXG4gICAgICAgICAgICBlbmQ6IFwiKVwiLFxuICAgICAgICB9LFxuICAgIF07XG4gICAgY29sb3IgPSBjb2xvci5yZXBsYWNlKFwiwrBcIiwgXCJcIik7XG4gICAgZm9yIChjb25zdCByZWdleCBvZiBjb2xvclJFR0VYKSB7XG4gICAgICAgIGlmIChjb2xvci5tYXRjaChyZWdleC5ydWxlKSkge1xuICAgICAgICAgICAgY29sb3IgPSByZWdleC5zdGFydCArIGNvbG9yICsgcmVnZXguZW5kO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgJChcIi5jb2xvckNvbnZlcnRlclwiKS5jc3MoXCJjb2xvclwiLCBjb2xvcik7XG4gICAgY29uc3QgaGV4Q29sb3IgPSBNaXNjLmNvbnZlcnRSR0J0b0hFWCgkKFwiLmNvbG9yQ29udmVydGVyXCIpLmNzcyhcImNvbG9yXCIpKTtcbiAgICBpZiAoaGV4Q29sb3IgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbG9yID0gaGV4Q29sb3I7XG4gICAgY29uc3QgY29sb3JJRCA9IGNvbG9yUGlja2VyLmZpbmQoXCJpbnB1dFt0eXBlPWNvbG9yXVwiKS5hdHRyKFwiaWRcIik7XG4gICAgaWYgKGNvbG9ySUQgPT09IHVuZGVmaW5lZClcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkNvdWxkIG5vdCBmaW5kIGNvbG9yIElEIVwiKTtcbiAgICBpZiAoIW5vVGhlbWVVcGRhdGUgJiYgY29sb3JJRCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eShjb2xvcklELCBjb2xvcik7XG4gICAgfVxuICAgIGNvbnN0IHBpY2tlckJ1dHRvbiA9IGNvbG9yUGlja2VyLmZpbmQoXCJsYWJlbFwiKTtcbiAgICBwaWNrZXJCdXR0b24udmFsKGNvbG9yKTtcbiAgICBwaWNrZXJCdXR0b24uYXR0cihcInZhbHVlXCIsIGNvbG9yKTtcbiAgICBpZiAocGlja2VyQnV0dG9uLmF0dHIoXCJmb3JcIikgIT09IFwiLS1iZy1jb2xvclwiKSB7XG4gICAgICAgIHBpY2tlckJ1dHRvbi5jc3MoXCJiYWNrZ3JvdW5kLWNvbG9yXCIsIGNvbG9yKTtcbiAgICB9XG4gICAgY29sb3JQaWNrZXIuZmluZChcImlucHV0W3R5cGU9dGV4dF1cIikudmFsKGNvbG9yKTtcbiAgICBjb2xvclBpY2tlci5maW5kKFwiaW5wdXRbdHlwZT1jb2xvcl1cIikuYXR0cihcInZhbHVlXCIsIGNvbG9yKTtcbn1cbmZ1bmN0aW9uIHJlZnJlc2hCdXR0b25zKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmN1c3RvbVRoZW1lKSB7XG4gICAgICAgICAgICAvLyBVcGRhdGUgY3VzdG9tIHRoZW1lIGJ1dHRvbnNcbiAgICAgICAgICAgIGNvbnN0IGN1c3RvbVRoZW1lc0VsID0gJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC5hbGxDdXN0b21UaGVtZXMuYnV0dG9uc1wiKS5lbXB0eSgpO1xuICAgICAgICAgICAgY29uc3QgYWRkQnV0dG9uID0gJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC5hZGRDdXN0b21UaGVtZUJ1dHRvblwiKTtcbiAgICAgICAgICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLmN1c3RvbVRoZW1lRWRpdCAuc2F2ZUN1c3RvbVRoZW1lQnV0dG9uXCIpLnRleHQoXCJzYXZlXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAuY3VzdG9tVGhlbWVFZGl0IC5zYXZlQ3VzdG9tVGhlbWVCdXR0b25cIikudGV4dChcInNhdmUgYXMgbmV3XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYWRkQnV0dG9uLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgY29uc3QgY3VzdG9tVGhlbWVzID0gREIuZ2V0U25hcHNob3QoKS5jdXN0b21UaGVtZXM7XG4gICAgICAgICAgICBjdXN0b21UaGVtZXMuZm9yRWFjaCgoY3VzdG9tVGhlbWUpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBjb25zdCBhY3RpdmVUaGVtZSA9XG4gICAgICAgICAgICAgICAgLy8gICBDb25maWcuY3VzdG9tVGhlbWVJZCA9PT0gY3VzdG9tVGhlbWUuX2lkID8gXCJhY3RpdmVcIiA6IFwiXCI7XG4gICAgICAgICAgICAgICAgY29uc3QgYmdDb2xvciA9IGN1c3RvbVRoZW1lLmNvbG9yc1swXTtcbiAgICAgICAgICAgICAgICBjb25zdCBtYWluQ29sb3IgPSBjdXN0b21UaGVtZS5jb2xvcnNbMV07XG4gICAgICAgICAgICAgICAgY3VzdG9tVGhlbWVzRWwuYXBwZW5kKGA8ZGl2IGNsYXNzPVwiY3VzdG9tVGhlbWUgYnV0dG9uXCIgY3VzdG9tVGhlbWVJZD0nJHtjdXN0b21UaGVtZS5faWR9JyBcbiAgICAgICAgc3R5bGU9XCJjb2xvcjoke21haW5Db2xvcn07YmFja2dyb3VuZDoke2JnQ29sb3J9XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJlZGl0QnV0dG9uXCI+PGkgY2xhc3M9XCJmYXMgZmEtcGVuXCI+PC9pPjwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwidGV4dFwiPiR7Y3VzdG9tVGhlbWUubmFtZS5yZXBsYWNlKC9fL2csIFwiIFwiKX08L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImRlbEJ1dHRvblwiPjxpIGNsYXNzPVwiZmFzIGZhLXRyYXNoIGZhLWZ3XCI+PC9pPjwvZGl2PlxuICAgICAgICA8L2Rpdj5gKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gVXBkYXRlIHRoZW1lIGJ1dHRvbnNcbiAgICAgICAgICAgIGNvbnN0IGZhdlRoZW1lc0VsID0gJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC5mYXZUaGVtZXMuYnV0dG9uc1wiKS5lbXB0eSgpO1xuICAgICAgICAgICAgY29uc3QgdGhlbWVzRWwgPSAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLmFsbFRoZW1lcy5idXR0b25zXCIpLmVtcHR5KCk7XG4gICAgICAgICAgICBsZXQgYWN0aXZlVGhlbWVOYW1lID0gY29uZmlnXzEuZGVmYXVsdC50aGVtZTtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnJhbmRvbVRoZW1lICE9PSBcIm9mZlwiICYmXG4gICAgICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5yYW5kb21UaGVtZSAhPT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgICAgIFRoZW1lQ29udHJvbGxlci5yYW5kb21UaGVtZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGFjdGl2ZVRoZW1lTmFtZSA9IFRoZW1lQ29udHJvbGxlci5yYW5kb21UaGVtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHRoZW1lcyA9IHlpZWxkIE1pc2MuZ2V0U29ydGVkVGhlbWVzTGlzdCgpO1xuICAgICAgICAgICAgLy9maXJzdCBzaG93IGZhdm91cml0ZXNcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZhdlRoZW1lcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgZmF2VGhlbWVzRWwuY3NzKHsgcGFkZGluZ0JvdHRvbTogXCIxcmVtXCIgfSk7XG4gICAgICAgICAgICAgICAgdGhlbWVzLmZvckVhY2goKHRoZW1lKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZhdlRoZW1lcy5pbmNsdWRlcyh0aGVtZS5uYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aXZlVGhlbWUgPSBhY3RpdmVUaGVtZU5hbWUgPT09IHRoZW1lLm5hbWUgPyBcImFjdGl2ZVwiIDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhdlRoZW1lc0VsLmFwcGVuZChgPGRpdiBjbGFzcz1cInRoZW1lIGJ1dHRvbiAke2FjdGl2ZVRoZW1lfVwiIHRoZW1lPScke3RoZW1lLm5hbWV9JyBcbiAgICAgICAgICAgIHN0eWxlPVwiY29sb3I6JHt0aGVtZS5tYWluQ29sb3J9O2JhY2tncm91bmQ6JHt0aGVtZS5iZ0NvbG9yfVwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImFjdGl2ZUluZGljYXRvclwiPjxpIGNsYXNzPVwiZmFzIGZhLWNpcmNsZVwiPjwvaT48L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0ZXh0XCI+JHt0aGVtZS5uYW1lLnJlcGxhY2UoL18vZywgXCIgXCIpfTwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImZhdkJ1dHRvbiBhY3RpdmVcIj48aSBjbGFzcz1cImZhcyBmYS1zdGFyXCI+PC9pPjwvZGl2PjwvZGl2PmApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBmYXZUaGVtZXNFbC5jc3MoeyBwYWRkaW5nQm90dG9tOiBcIjBcIiB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vdGhlbiB0aGUgcmVzdFxuICAgICAgICAgICAgdGhlbWVzLmZvckVhY2goKHRoZW1lKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZmF2VGhlbWVzLmluY2x1ZGVzKHRoZW1lLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgYWN0aXZlVGhlbWUgPSBhY3RpdmVUaGVtZU5hbWUgPT09IHRoZW1lLm5hbWUgPyBcImFjdGl2ZVwiIDogXCJcIjtcbiAgICAgICAgICAgICAgICB0aGVtZXNFbC5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ0aGVtZSBidXR0b24gJHthY3RpdmVUaGVtZX1cIiB0aGVtZT0nJHt0aGVtZS5uYW1lfScgc3R5bGU9XCJjb2xvcjoke3RoZW1lLm1haW5Db2xvcn07YmFja2dyb3VuZDoke3RoZW1lLmJnQ29sb3J9XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJhY3RpdmVJbmRpY2F0b3JcIj48aSBjbGFzcz1cImZhcyBmYS1jaXJjbGVcIj48L2k+PC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJ0ZXh0XCI+JHt0aGVtZS5uYW1lLnJlcGxhY2UoL18vZywgXCIgXCIpfTwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiZmF2QnV0dG9uXCI+PGkgY2xhc3M9XCJmYXIgZmEtc3RhclwiPjwvaT48L2Rpdj48L2Rpdj5gKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHVwZGF0ZUFjdGl2ZUJ1dHRvbigpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5yZWZyZXNoQnV0dG9ucyA9IHJlZnJlc2hCdXR0b25zO1xuZnVuY3Rpb24gc2V0Q3VzdG9tSW5wdXRzKG5vVGhlbWVVcGRhdGUgPSBmYWxzZSkge1xuICAgICQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAudGFiQ29udGFpbmVyIC5jdXN0b21UaGVtZSAuY29sb3JQaWNrZXJcIikuZWFjaCgoX2luZGV4LCBlbGVtZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRDb2xvciA9IGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tVGhlbWVDb2xvcnNbVGhlbWVDb250cm9sbGVyLmNvbG9yVmFycy5pbmRleE9mKCQoZWxlbWVudCkuZmluZChcImlucHV0W3R5cGU9Y29sb3JdXCIpLmF0dHIoXCJpZFwiKSldO1xuICAgICAgICB1cGRhdGVDb2xvcnMoJChlbGVtZW50KSwgY3VycmVudENvbG9yLCBmYWxzZSwgbm9UaGVtZVVwZGF0ZSk7XG4gICAgfSk7XG59XG5leHBvcnRzLnNldEN1c3RvbUlucHV0cyA9IHNldEN1c3RvbUlucHV0cztcbmZ1bmN0aW9uIHRvZ2dsZUZhdm91cml0ZSh0aGVtZU5hbWUpIHtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mYXZUaGVtZXMuaW5jbHVkZXModGhlbWVOYW1lKSkge1xuICAgICAgICAvLyBhbHJlYWR5IGZhdm91cml0ZSwgcmVtb3ZlXG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGYXZUaGVtZXMoY29uZmlnXzEuZGVmYXVsdC5mYXZUaGVtZXMuZmlsdGVyKCh0KSA9PiB0ICE9PSB0aGVtZU5hbWUpKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIGFkZCB0byBmYXZvdXJpdGVzXG4gICAgICAgIGNvbnN0IG5ld0xpc3QgPSBjb25maWdfMS5kZWZhdWx0LmZhdlRoZW1lcztcbiAgICAgICAgbmV3TGlzdC5wdXNoKHRoZW1lTmFtZSk7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRGYXZUaGVtZXMobmV3TGlzdCk7XG4gICAgfVxuICAgIFVwZGF0ZUNvbmZpZy5zYXZlRnVsbENvbmZpZ1RvTG9jYWxTdG9yYWdlKCk7XG59XG5mdW5jdGlvbiBzYXZlQ3VzdG9tVGhlbWVDb2xvcnMoKSB7XG4gICAgY29uc3QgbmV3Q29sb3JzID0gW107XG4gICAgJC5lYWNoKCQoXCIucGFnZVNldHRpbmdzIC5jdXN0b21UaGVtZSAuY3VzdG9tVGhlbWVFZGl0IFt0eXBlPSdjb2xvciddXCIpLCAoX2luZGV4LCBlbGVtZW50KSA9PiB7XG4gICAgICAgIG5ld0NvbG9ycy5wdXNoKCQoZWxlbWVudCkuYXR0cihcInZhbHVlXCIpKTtcbiAgICB9KTtcbiAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWVDb2xvcnMobmV3Q29sb3JzKTtcbiAgICBOb3RpZmljYXRpb25zLmFkZChcIkN1c3RvbSB0aGVtZSBzYXZlZFwiLCAxKTtcbn1cbmV4cG9ydHMuc2F2ZUN1c3RvbVRoZW1lQ29sb3JzID0gc2F2ZUN1c3RvbVRoZW1lQ29sb3JzO1xuZnVuY3Rpb24gdXBkYXRlQWN0aXZlVGFiKGZvcmNlZCA9IGZhbHNlKSB7XG4gICAgLy8gU2V0IGZvcmNlIHRvIHRydWUgb25seSB3aGVuIHNvbWUgY2hhbmdlIGZvciB0aGUgYWN0aXZlIHRhYiBoYXMgdGFrZW4gcGxhY2VcbiAgICAvLyBQcmV2ZW50IHRoZW1lIGJ1dHRvbnMgZnJvbSBiZWluZyBhZGRlZCB0d2ljZSBieSBkb2luZyBhbiB1cGRhdGUgb25seSB3aGVuIHRoZSBzdGF0ZSBoYXMgY2hhbmdlZFxuICAgIGNvbnN0ICRwcmVzZXRUYWJCdXR0b24gPSAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLnRhYnMgLmJ1dHRvblt0YWI9J3ByZXNldCddXCIpO1xuICAgIGNvbnN0ICRjdXN0b21UYWJCdXR0b24gPSAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLnRhYnMgLmJ1dHRvblt0YWI9J2N1c3RvbSddXCIpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmN1c3RvbVRoZW1lKSB7XG4gICAgICAgICRwcmVzZXRUYWJCdXR0b24ucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgIGlmICghJGN1c3RvbVRhYkJ1dHRvbi5oYXNDbGFzcyhcImFjdGl2ZVwiKSB8fCBmb3JjZWQpIHtcbiAgICAgICAgICAgICRjdXN0b21UYWJCdXR0b24uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICByZWZyZXNoQnV0dG9ucygpO1xuICAgICAgICB9XG4gICAgICAgIE1pc2Muc3dhcEVsZW1lbnRzKCQoJy5wYWdlU2V0dGluZ3MgW3RhYkNvbnRlbnQ9XCJwcmVzZXRcIl0nKSwgJCgnLnBhZ2VTZXR0aW5ncyBbdGFiQ29udGVudD1cImN1c3RvbVwiXScpLCAyNTApO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJGN1c3RvbVRhYkJ1dHRvbi5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgaWYgKCEkcHJlc2V0VGFiQnV0dG9uLmhhc0NsYXNzKFwiYWN0aXZlXCIpIHx8IGZvcmNlZCkge1xuICAgICAgICAgICAgJHByZXNldFRhYkJ1dHRvbi5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgIHJlZnJlc2hCdXR0b25zKCk7XG4gICAgICAgIH1cbiAgICAgICAgTWlzYy5zd2FwRWxlbWVudHMoJCgnLnBhZ2VTZXR0aW5ncyBbdGFiQ29udGVudD1cImN1c3RvbVwiXScpLCAkKCcucGFnZVNldHRpbmdzIFt0YWJDb250ZW50PVwicHJlc2V0XCJdJyksIDI1MCk7XG4gICAgfVxufVxuZXhwb3J0cy51cGRhdGVBY3RpdmVUYWIgPSB1cGRhdGVBY3RpdmVUYWI7XG4vLyBBZGQgZXZlbnRzIHRvIHRoZSBET01cbi8vIEhhbmRsZSBjbGljayBvbiB0aGVtZTogcHJlc2V0IG9yIGN1c3RvbSB0YWJcbiQoXCIucGFnZVNldHRpbmdzIC5zZWN0aW9uLnRoZW1lcyAudGFicyAuYnV0dG9uXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLnRhYnMgLmJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICBjb25zdCAkdGFyZ2V0ID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgICR0YXJnZXQuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgLy8gc2V0Q3VzdG9tSW5wdXRzKCk7XG4gICAgaWYgKCR0YXJnZXQuYXR0cihcInRhYlwiKSA9PSBcInByZXNldFwiKSB7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZShmYWxzZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWUodHJ1ZSk7XG4gICAgfVxufSk7XG4vLyBIYW5kbGUgY2xpY2sgb24gY3VzdG9tIHRoZW1lIGJ1dHRvblxuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC5jdXN0b21UaGVtZS5idXR0b25cIiwgKGUpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgLy8gRG8gbm90IGFwcGx5IGlmIHVzZXIgd2FudGVkIHRvIGRlbGV0ZSBpdFxuICAgIGlmICgkKGUudGFyZ2V0KS5oYXNDbGFzcyhcImRlbEJ1dHRvblwiKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmICgkKGUudGFyZ2V0KS5oYXNDbGFzcyhcImVkaXRCdXR0b25cIikpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBjdXN0b21UaGVtZUlkID0gKF9hID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJjdXN0b21UaGVtZUlkXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIlwiO1xuICAgIFRoZW1lQ29udHJvbGxlci5zZXQoY3VzdG9tVGhlbWVJZCwgdHJ1ZSk7XG59KTtcbi8vIEhhbmRsZSBjbGljayBvbiBmYXZvcml0ZSBwcmVzZXQgdGhlbWUgYnV0dG9uXG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLnRoZW1lIC5mYXZCdXR0b25cIiwgKGUpID0+IHtcbiAgICBjb25zdCB0aGVtZSA9ICQoZS5jdXJyZW50VGFyZ2V0KS5wYXJlbnRzKFwiLnRoZW1lLmJ1dHRvblwiKS5hdHRyKFwidGhlbWVcIik7XG4gICAgaWYgKHRoZW1lICE9PSB1bmRlZmluZWQpXG4gICAgICAgIHRvZ2dsZUZhdm91cml0ZSh0aGVtZSk7XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDb3VsZCBub3QgZmluZCB0aGUgdGhlbWUgYXR0cmlidXRlIGF0dGFjaGVkIHRvIHRoZSBidXR0b24gY2xpY2tlZCFcIik7XG4gICAgfVxufSk7XG4vLyBIYW5kbGUgY2xpY2sgb24gcHJlc2V0IHRoZW1lIGJ1dHRvblxuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC50aGVtZS5idXR0b25cIiwgKGUpID0+IHtcbiAgICBjb25zdCB0aGVtZSA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwidGhlbWVcIik7XG4gICAgaWYgKCEkKGUudGFyZ2V0KS5oYXNDbGFzcyhcImZhdkJ1dHRvblwiKSAmJiB0aGVtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaGVtZSh0aGVtZSk7XG4gICAgICAgIHVwZGF0ZUFjdGl2ZUJ1dHRvbigpO1xuICAgIH1cbn0pO1xuJChcIi5wYWdlU2V0dGluZ3MgLnNlY3Rpb24udGhlbWVzIC50YWJDb250YWluZXIgLmN1c3RvbVRoZW1lIGlucHV0W3R5cGU9Y29sb3JdXCIpLm9uKFwiaW5wdXRcIiwgKGUpID0+IHtcbiAgICBjb25zdCAkY29sb3JWYXIgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcImlkXCIpO1xuICAgIGNvbnN0ICRwaWNrZWRDb2xvciA9ICQoZS5jdXJyZW50VGFyZ2V0KS52YWwoKTtcbiAgICB1cGRhdGVDb2xvcnMoJChcIi5jb2xvclBpY2tlciAjXCIgKyAkY29sb3JWYXIpLnBhcmVudCgpLCAkcGlja2VkQ29sb3IsIHRydWUpO1xufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLnRhYkNvbnRhaW5lciAuY3VzdG9tVGhlbWUgaW5wdXRbdHlwZT1jb2xvcl1cIikub24oXCJjaGFuZ2VcIiwgKGUpID0+IHtcbiAgICBjb25zdCAkY29sb3JWYXIgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcImlkXCIpO1xuICAgIGNvbnN0ICRwaWNrZWRDb2xvciA9ICQoZS5jdXJyZW50VGFyZ2V0KS52YWwoKTtcbiAgICB1cGRhdGVDb2xvcnMoJChcIi5jb2xvclBpY2tlciAjXCIgKyAkY29sb3JWYXIpLnBhcmVudCgpLCAkcGlja2VkQ29sb3IpO1xufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAuc2VjdGlvbi50aGVtZXMgLnRhYkNvbnRhaW5lciAuY3VzdG9tVGhlbWUgaW5wdXRbdHlwZT10ZXh0XVwiKVxuICAgIC5vbihcImJsdXJcIiwgKGUpID0+IHtcbiAgICBpZiAoZS50YXJnZXQuaWQgPT09IFwibmFtZVwiKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgJGNvbG9yVmFyID0gJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJpZFwiKTtcbiAgICBjb25zdCAkcGlja2VkQ29sb3IgPSAkKGUuY3VycmVudFRhcmdldCkudmFsKCk7XG4gICAgdXBkYXRlQ29sb3JzKCQoXCIuY29sb3JQaWNrZXIgI1wiICsgJGNvbG9yVmFyKS5wYXJlbnQoKSwgJHBpY2tlZENvbG9yKTtcbn0pXG4gICAgLm9uKFwia2V5cHJlc3NcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuaWQgPT09IFwibmFtZVwiKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKGUuY29kZSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICQodGhpcykuYXR0cihcImRpc2FibGVkXCIsIFwiZGlzYWJsZWRcIik7XG4gICAgICAgIGNvbnN0ICRjb2xvclZhciA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiaWRcIik7XG4gICAgICAgIGNvbnN0ICRwaWNrZWRDb2xvciA9ICQoZS5jdXJyZW50VGFyZ2V0KS52YWwoKTtcbiAgICAgICAgdXBkYXRlQ29sb3JzKCQoXCIuY29sb3JQaWNrZXIgI1wiICsgJGNvbG9yVmFyKS5wYXJlbnQoKSwgJHBpY2tlZENvbG9yKTtcbiAgICAgICAgJCh0aGlzKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XG4gICAgfVxufSk7XG4kKFwiLnBhZ2VTZXR0aW5ncyAjbG9hZEN1c3RvbUNvbG9yc0Zyb21QcmVzZXRcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgLy8gcHJldmlld1RoZW1lKENvbmZpZy50aGVtZSk7XG4gICAgJChcIiNjdXJyZW50VGhlbWVcIikuYXR0cihcImhyZWZcIiwgYHRoZW1lcy8ke2NvbmZpZ18xLmRlZmF1bHQudGhlbWV9LmNzc2ApO1xuICAgIFRoZW1lQ29udHJvbGxlci5jb2xvclZhcnMuZm9yRWFjaCgoZSkgPT4ge1xuICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoZSwgXCJcIik7XG4gICAgfSk7XG4gICAgc2V0VGltZW91dCgoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgQ2hhcnRDb250cm9sbGVyLnVwZGF0ZUFsbENoYXJ0Q29sb3JzKCk7XG4gICAgICAgIGNvbnN0IHRoZW1lQ29sb3JzID0geWllbGQgVGhlbWVDb2xvcnMuZ2V0QWxsKCk7XG4gICAgICAgIFRoZW1lQ29udHJvbGxlci5jb2xvclZhcnMuZm9yRWFjaCgoY29sb3JOYW1lKSA9PiB7XG4gICAgICAgICAgICBsZXQgY29sb3I7XG4gICAgICAgICAgICBpZiAoY29sb3JOYW1lID09PSBcIi0tYmctY29sb3JcIikge1xuICAgICAgICAgICAgICAgIGNvbG9yID0gdGhlbWVDb2xvcnMuYmc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjb2xvck5hbWUgPT09IFwiLS1tYWluLWNvbG9yXCIpIHtcbiAgICAgICAgICAgICAgICBjb2xvciA9IHRoZW1lQ29sb3JzLm1haW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjb2xvck5hbWUgPT09IFwiLS1zdWItY29sb3JcIikge1xuICAgICAgICAgICAgICAgIGNvbG9yID0gdGhlbWVDb2xvcnMuc3ViO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29sb3JOYW1lID09PSBcIi0tY2FyZXQtY29sb3JcIikge1xuICAgICAgICAgICAgICAgIGNvbG9yID0gdGhlbWVDb2xvcnMuY2FyZXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjb2xvck5hbWUgPT09IFwiLS10ZXh0LWNvbG9yXCIpIHtcbiAgICAgICAgICAgICAgICBjb2xvciA9IHRoZW1lQ29sb3JzLnRleHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjb2xvck5hbWUgPT09IFwiLS1lcnJvci1jb2xvclwiKSB7XG4gICAgICAgICAgICAgICAgY29sb3IgPSB0aGVtZUNvbG9ycy5lcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNvbG9yTmFtZSA9PT0gXCItLWVycm9yLWV4dHJhLWNvbG9yXCIpIHtcbiAgICAgICAgICAgICAgICBjb2xvciA9IHRoZW1lQ29sb3JzLmVycm9yRXh0cmE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjb2xvck5hbWUgPT09IFwiLS1jb2xvcmZ1bC1lcnJvci1jb2xvclwiKSB7XG4gICAgICAgICAgICAgICAgY29sb3IgPSB0aGVtZUNvbG9ycy5jb2xvcmZ1bEVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29sb3JOYW1lID09PSBcIi0tY29sb3JmdWwtZXJyb3ItZXh0cmEtY29sb3JcIikge1xuICAgICAgICAgICAgICAgIGNvbG9yID0gdGhlbWVDb2xvcnMuY29sb3JmdWxFcnJvckV4dHJhO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdXBkYXRlQ29sb3JzKCQoXCIuY29sb3JQaWNrZXIgI1wiICsgY29sb3JOYW1lKS5wYXJlbnQoKSwgY29sb3IpO1xuICAgICAgICB9KTtcbiAgICB9KSwgMjUwKTtcbn0pO1xuLy8gSGFuZGxlcyBjbGljayBvbiBzaGFyZSBjdXN0b20gdGhlbWUgYnV0dG9uXG4kKFwiI3NoYXJlQ3VzdG9tVGhlbWVCdXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY29uc3Qgc2hhcmUgPSBbXTtcbiAgICAkLmVhY2goJChcIi5wYWdlU2V0dGluZ3MgLmN1c3RvbVRoZW1lIC5jdXN0b21UaGVtZUVkaXQgW3R5cGU9J2NvbG9yJ11cIiksIChfLCBlbGVtZW50KSA9PiB7XG4gICAgICAgIHNoYXJlLnB1c2goJChlbGVtZW50KS5hdHRyKFwidmFsdWVcIikpO1xuICAgIH0pO1xuICAgIGNvbnN0IHVybCA9IFwiaHR0cHM6Ly9tb25rZXl0eXBlLmNvbT9jdXN0b21UaGVtZT1cIiArIGJ0b2EoSlNPTi5zdHJpbmdpZnkoc2hhcmUpKTtcbiAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dCh1cmwpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlVSTCBDb3BpZWQgdG8gY2xpcGJvYXJkXCIsIDApO1xuICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgQ3VzdG9tVGhlbWVQb3B1cC5zaG93KHVybCk7XG4gICAgfSk7XG59KTtcbiQoXCIucGFnZVNldHRpbmdzIC5zYXZlQ3VzdG9tVGhlbWVCdXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBzYXZlQ3VzdG9tVGhlbWVDb2xvcnMoKTtcbiAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyKSB7XG4gICAgICAgIGNvbnN0IG5ld0N1c3RvbVRoZW1lID0ge1xuICAgICAgICAgICAgbmFtZTogXCJjdXN0b21cIixcbiAgICAgICAgICAgIGNvbG9yczogY29uZmlnXzEuZGVmYXVsdC5jdXN0b21UaGVtZUNvbG9ycyxcbiAgICAgICAgfTtcbiAgICAgICAgTG9hZGVyLnNob3coKTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBEQi5hZGRDdXN0b21UaGVtZShuZXdDdXN0b21UaGVtZSk7XG4gICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgIGlmIChyZXNwb25zZSkge1xuICAgICAgICAgICAgdXBkYXRlQWN0aXZlVGFiKHRydWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB1cGRhdGVBY3RpdmVUYWIodHJ1ZSk7XG4gICAgfVxufSkpO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSkgPT4ge1xuICAgIGlmIChldmVudEtleSA9PT0gXCJjdXN0b21UaGVtZUlkXCIpXG4gICAgICAgIHJlZnJlc2hCdXR0b25zKCk7XG4gICAgLy8gaWYgKGV2ZW50S2V5ID09PSBcImN1c3RvbVRoZW1lXCIpIHVwZGF0ZUFjdGl2ZVRhYigpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2V0ID0gZXhwb3J0cy5nZXQgPSB2b2lkIDA7XG5sZXQgYWN0aXZlUGFnZSA9IFwibG9hZGluZ1wiO1xuZnVuY3Rpb24gZ2V0KCkge1xuICAgIHJldHVybiBhY3RpdmVQYWdlO1xufVxuZXhwb3J0cy5nZXQgPSBnZXQ7XG5mdW5jdGlvbiBzZXQoYWN0aXZlKSB7XG4gICAgYWN0aXZlUGFnZSA9IGFjdGl2ZTtcbn1cbmV4cG9ydHMuc2V0ID0gc2V0O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmVuYWJsZSA9IGV4cG9ydHMuZ2V0ID0gdm9pZCAwO1xubGV0IGdsYXJzZXNNb2RlID0gZmFsc2U7XG5mdW5jdGlvbiBnZXQoKSB7XG4gICAgcmV0dXJuIGdsYXJzZXNNb2RlO1xufVxuZXhwb3J0cy5nZXQgPSBnZXQ7XG5mdW5jdGlvbiBlbmFibGUoKSB7XG4gICAgZ2xhcnNlc01vZGUgPSB0cnVlO1xuICAgIGNvbnNvbGUubG9nKFwiR2xhcnNlcyBNb2RlIE9uIC0gdGVzdCByZXN1bHQgd2lsbCBiZSBoaWRkZW4uIFlvdSBjYW4gY2hlY2sgdGhlIHN0YXRzIGluIHRoZSBjb25zb2xlIChoZXJlKVwiKTtcbiAgICBjb25zb2xlLmxvZyhcIlRvIGRpc2FibGUgR2xhcnNlcyBNb2RlIHJlZnJlc2ggdGhlIHBhZ2UuXCIpO1xufVxuZXhwb3J0cy5lbmFibGUgPSBlbmFibGU7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZ2V0ID0gZXhwb3J0cy5zZXQgPSB2b2lkIDA7XG5sZXQgdHJhbnNpdGlvbiA9IHRydWU7XG5mdW5jdGlvbiBzZXQodmFsKSB7XG4gICAgdHJhbnNpdGlvbiA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0ID0gc2V0O1xuZnVuY3Rpb24gZ2V0KCkge1xuICAgIHJldHVybiB0cmFuc2l0aW9uO1xufVxuZXhwb3J0cy5nZXQgPSBnZXQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZ2V0ID0gZXhwb3J0cy5jbGVhciA9IGV4cG9ydHMuc2V0ID0gdm9pZCAwO1xubGV0IHNsb3dUaW1lciA9IGZhbHNlO1xuZnVuY3Rpb24gc2V0KCkge1xuICAgIGlmIChzbG93VGltZXIpXG4gICAgICAgIHJldHVybjtcbiAgICBzbG93VGltZXIgPSB0cnVlO1xuICAgIGNvbnNvbGUuZXJyb3IoXCJTbG93IHRpbWVyLCBkaXNhYmxpbmcgYW5pbWF0aW9uc1wiKTtcbiAgICAvLyBOb3RpZmljYXRpb25zLmFkZChcIlNsb3cgdGltZXIgZGV0ZWN0ZWRcIiwgLTEsIDUpO1xufVxuZXhwb3J0cy5zZXQgPSBzZXQ7XG5mdW5jdGlvbiBjbGVhcigpIHtcbiAgICBzbG93VGltZXIgPSBmYWxzZTtcbn1cbmV4cG9ydHMuY2xlYXIgPSBjbGVhcjtcbmZ1bmN0aW9uIGdldCgpIHtcbiAgICByZXR1cm4gc2xvd1RpbWVyO1xufVxuZXhwb3J0cy5nZXQgPSBnZXQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2V0ID0gZXhwb3J0cy5nZXQgPSB2b2lkIDA7XG5sZXQgdGVzdEFjdGl2ZSA9IGZhbHNlO1xuZnVuY3Rpb24gZ2V0KCkge1xuICAgIHJldHVybiB0ZXN0QWN0aXZlO1xufVxuZXhwb3J0cy5nZXQgPSBnZXQ7XG5mdW5jdGlvbiBzZXQoYWN0aXZlKSB7XG4gICAgdGVzdEFjdGl2ZSA9IGFjdGl2ZTtcbn1cbmV4cG9ydHMuc2V0ID0gc2V0O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmluY3JlbWVudCA9IGV4cG9ydHMuc2V0ID0gZXhwb3J0cy5nZXQgPSB2b2lkIDA7XG5sZXQgdGltZSA9IDA7XG5mdW5jdGlvbiBnZXQoKSB7XG4gICAgcmV0dXJuIHRpbWU7XG59XG5leHBvcnRzLmdldCA9IGdldDtcbmZ1bmN0aW9uIHNldChhY3RpdmUpIHtcbiAgICB0aW1lID0gYWN0aXZlO1xufVxuZXhwb3J0cy5zZXQgPSBzZXQ7XG5mdW5jdGlvbiBpbmNyZW1lbnQoKSB7XG4gICAgdGltZSsrO1xufVxuZXhwb3J0cy5pbmNyZW1lbnQgPSBpbmNyZW1lbnQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5yZXBsYWNlID0gZXhwb3J0cy5nZXRMaXN0ID0gdm9pZCAwO1xuY29uc3QgbWlzY18xID0gcmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIik7XG5sZXQgbGlzdCA9IFtdO1xuZnVuY3Rpb24gZ2V0TGlzdCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAobGlzdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiAkLmdldEpTT04oXCJsYW5ndWFnZXMvYnJpdGlzaGVuZ2xpc2guanNvblwiLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGxpc3QgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHJldHVybiBsaXN0O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbGlzdDtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRMaXN0ID0gZ2V0TGlzdDtcbmZ1bmN0aW9uIHJlcGxhY2Uod29yZCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IGxpc3QgPSB5aWVsZCBnZXRMaXN0KCk7XG4gICAgICAgIGNvbnN0IHJlcGxhY2VtZW50ID0gbGlzdC5maW5kKChhKSA9PiB3b3JkLm1hdGNoKFJlZ0V4cChgXihbXFxcXFddKiR7YVswXX1bXFxcXFddKikkYCwgXCJnaVwiKSkpO1xuICAgICAgICByZXR1cm4gcmVwbGFjZW1lbnRcbiAgICAgICAgICAgID8gd29yZC5yZXBsYWNlKFJlZ0V4cChgXig/OihbXFxcXFddKikoJHtyZXBsYWNlbWVudFswXX0pKFtcXFxcV10qKSkkYCwgXCJnaVwiKSwgKF8sICQxLCAkMiwgJDMpID0+ICQxICtcbiAgICAgICAgICAgICAgICAoJDIuY2hhckF0KDApID09PSAkMi5jaGFyQXQoMCkudG9VcHBlckNhc2UoKVxuICAgICAgICAgICAgICAgICAgICA/ICQyID09PSAkMi50b1VwcGVyQ2FzZSgpXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHJlcGxhY2VtZW50WzFdLnRvVXBwZXJDYXNlKClcbiAgICAgICAgICAgICAgICAgICAgICAgIDogKDAsIG1pc2NfMS5jYXBpdGFsaXplRmlyc3RMZXR0ZXJPZkVhY2hXb3JkKShyZXBsYWNlbWVudFsxXSlcbiAgICAgICAgICAgICAgICAgICAgOiByZXBsYWNlbWVudFsxXSkgK1xuICAgICAgICAgICAgICAgICQzKVxuICAgICAgICAgICAgOiB3b3JkO1xuICAgIH0pO1xufVxuZXhwb3J0cy5yZXBsYWNlID0gcmVwbGFjZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5jYXBzU3RhdGUgPSB2b2lkIDA7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmV4cG9ydHMuY2Fwc1N0YXRlID0gZmFsc2U7XG5mdW5jdGlvbiBzaG93KCkge1xuICAgIGlmICgkKFwiI2NhcHNXYXJuaW5nXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjY2Fwc1dhcm5pbmdcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxufVxuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICBpZiAoISQoXCIjY2Fwc1dhcm5pbmdcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNjYXBzV2FybmluZ1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG59XG4kKGRvY3VtZW50KS5rZXlkb3duKGZ1bmN0aW9uIChldmVudCkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgaWYgKCgoX2EgPSBldmVudCA9PT0gbnVsbCB8fCBldmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXZlbnQub3JpZ2luYWxFdmVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldE1vZGlmaWVyU3RhdGUpICYmXG4gICAgICAgICgoX2IgPSBldmVudCA9PT0gbnVsbCB8fCBldmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXZlbnQub3JpZ2luYWxFdmVudCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmdldE1vZGlmaWVyU3RhdGUoXCJDYXBzTG9ja1wiKSkpIHtcbiAgICAgICAgZXhwb3J0cy5jYXBzU3RhdGUgPSB0cnVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZXhwb3J0cy5jYXBzU3RhdGUgPSBmYWxzZTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuY2Fwc0xvY2tXYXJuaW5nICYmIGV4cG9ydHMuY2Fwc1N0YXRlKSB7XG4gICAgICAgICAgICBzaG93KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBoaWRlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKF9jKSB7IH1cbn0pO1xuJChkb2N1bWVudCkua2V5dXAoZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBpZiAoKChfYSA9IGV2ZW50ID09PSBudWxsIHx8IGV2ZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBldmVudC5vcmlnaW5hbEV2ZW50KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZ2V0TW9kaWZpZXJTdGF0ZSkgJiZcbiAgICAgICAgKChfYiA9IGV2ZW50ID09PSBudWxsIHx8IGV2ZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBldmVudC5vcmlnaW5hbEV2ZW50KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZ2V0TW9kaWZpZXJTdGF0ZShcIkNhcHNMb2NrXCIpKSkge1xuICAgICAgICAvL2ZpbHRoeSBmaXggYnV0IG9wdGlvbmFsIGNoYWluaW5nIHJlZnVlcyB0byB3b3JrXG4gICAgICAgIGV4cG9ydHMuY2Fwc1N0YXRlID0gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGV4cG9ydHMuY2Fwc1N0YXRlID0gZmFsc2U7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmNhcHNMb2NrV2FybmluZyAmJiBleHBvcnRzLmNhcHNTdGF0ZSkge1xuICAgICAgICAgICAgc2hvdygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaGlkZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChfYykgeyB9XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2hvdyA9IGV4cG9ydHMudXBkYXRlUG9zaXRpb24gPSBleHBvcnRzLmhpZGUgPSBleHBvcnRzLnN0YXJ0QW5pbWF0aW9uID0gZXhwb3J0cy5zdG9wQW5pbWF0aW9uID0gZXhwb3J0cy5jYXJldEFuaW1hdGluZyA9IHZvaWQgMDtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBUZXN0SW5wdXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC1pbnB1dFwiKSk7XG5jb25zdCBTbG93VGltZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9zbG93LXRpbWVyXCIpKTtcbmNvbnN0IFRlc3RBY3RpdmUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy90ZXN0LWFjdGl2ZVwiKSk7XG5leHBvcnRzLmNhcmV0QW5pbWF0aW5nID0gdHJ1ZTtcbmZ1bmN0aW9uIHN0b3BBbmltYXRpb24oKSB7XG4gICAgaWYgKGV4cG9ydHMuY2FyZXRBbmltYXRpbmcgPT09IHRydWUpIHtcbiAgICAgICAgJChcIiNjYXJldFwiKS5jc3MoXCJhbmltYXRpb24tbmFtZVwiLCBcIm5vbmVcIik7XG4gICAgICAgICQoXCIjY2FyZXRcIikuY3NzKFwib3BhY2l0eVwiLCBcIjFcIik7XG4gICAgICAgIGV4cG9ydHMuY2FyZXRBbmltYXRpbmcgPSBmYWxzZTtcbiAgICB9XG59XG5leHBvcnRzLnN0b3BBbmltYXRpb24gPSBzdG9wQW5pbWF0aW9uO1xuZnVuY3Rpb24gc3RhcnRBbmltYXRpb24oKSB7XG4gICAgaWYgKGV4cG9ydHMuY2FyZXRBbmltYXRpbmcgPT09IGZhbHNlKSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnNtb290aENhcmV0ICYmICFTbG93VGltZXIuZ2V0KCkpIHtcbiAgICAgICAgICAgICQoXCIjY2FyZXRcIikuY3NzKFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJjYXJldEZsYXNoU21vb3RoXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIiNjYXJldFwiKS5jc3MoXCJhbmltYXRpb24tbmFtZVwiLCBcImNhcmV0Rmxhc2hIYXJkXCIpO1xuICAgICAgICB9XG4gICAgICAgIGV4cG9ydHMuY2FyZXRBbmltYXRpbmcgPSB0cnVlO1xuICAgIH1cbn1cbmV4cG9ydHMuc3RhcnRBbmltYXRpb24gPSBzdGFydEFuaW1hdGlvbjtcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgJChcIiNjYXJldFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbn1cbmV4cG9ydHMuaGlkZSA9IGhpZGU7XG5mdW5jdGlvbiB1cGRhdGVQb3NpdGlvbigpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmICgkKFwiI3dvcmRzV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgLy8gaWYgKCQoXCIjY2FyZXRcIikuaGFzQ2xhc3MoXCJvZmZcIikpIHtcbiAgICAgICAgLy8gICByZXR1cm47XG4gICAgICAgIC8vIH1cbiAgICAgICAgY29uc3QgY2FyZXQgPSAkKFwiI2NhcmV0XCIpO1xuICAgICAgICBsZXQgaW5wdXRMZW4gPSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGg7XG4gICAgICAgIGlucHV0TGVuID0gTWlzYy50cmFpbGluZ0NvbXBvc2VDaGFycy50ZXN0KFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50KVxuICAgICAgICAgICAgPyBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5zZWFyY2goTWlzYy50cmFpbGluZ0NvbXBvc2VDaGFycykgKyAxXG4gICAgICAgICAgICA6IGlucHV0TGVuO1xuICAgICAgICBsZXQgY3VycmVudExldHRlckluZGV4ID0gaW5wdXRMZW4gLSAxO1xuICAgICAgICBpZiAoY3VycmVudExldHRlckluZGV4ID09IC0xKSB7XG4gICAgICAgICAgICBjdXJyZW50TGV0dGVySW5kZXggPSAwO1xuICAgICAgICB9XG4gICAgICAgIC8vaW5zZXJ0IHRlbXBvcmFyeSBjaGFyYWN0ZXIgc28gdGhlIGNhcmV0IHdpbGwgd29yayBpbiB6ZW4gbW9kZVxuICAgICAgICBjb25zdCBhY3RpdmVXb3JkRW1wdHkgPSAkKFwiI3dvcmRzIC5hY3RpdmVcIikuY2hpbGRyZW4oKS5sZW5ndGggPT0gMDtcbiAgICAgICAgaWYgKGFjdGl2ZVdvcmRFbXB0eSkge1xuICAgICAgICAgICAgJChcIiN3b3JkcyAuYWN0aXZlXCIpLmFwcGVuZCgnPGxldHRlciBzdHlsZT1cIm9wYWNpdHk6IDA7XCI+XzwvbGV0dGVyPicpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGN1cnJlbnRXb3JkTm9kZUxpc3QgPSAoX2EgPSBkb2N1bWVudCA9PT0gbnVsbCB8fCBkb2N1bWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN3b3JkcyAuYWN0aXZlXCIpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucXVlcnlTZWxlY3RvckFsbChcImxldHRlclwiKTtcbiAgICAgICAgaWYgKCFjdXJyZW50V29yZE5vZGVMaXN0KVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBsZXQgY3VycmVudExldHRlciA9IGN1cnJlbnRXb3JkTm9kZUxpc3RbY3VycmVudExldHRlckluZGV4XTtcbiAgICAgICAgaWYgKGlucHV0TGVuID4gY3VycmVudFdvcmROb2RlTGlzdC5sZW5ndGgpIHtcbiAgICAgICAgICAgIGN1cnJlbnRMZXR0ZXIgPSBjdXJyZW50V29yZE5vZGVMaXN0W2N1cnJlbnRXb3JkTm9kZUxpc3QubGVuZ3RoIC0gMV07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPSBcInplblwiICYmICQoY3VycmVudExldHRlcikubGVuZ3RoID09IDApXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGN1cnJlbnRMYW5ndWFnZSA9IHlpZWxkIE1pc2MuZ2V0Q3VycmVudExhbmd1YWdlKGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UpO1xuICAgICAgICBjb25zdCBpc0xhbmd1YWdlTGVmdFRvUmlnaHQgPSBjdXJyZW50TGFuZ3VhZ2UubGVmdFRvUmlnaHQ7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRMZXR0ZXJQb3NMZWZ0ID0gaXNMYW5ndWFnZUxlZnRUb1JpZ2h0XG4gICAgICAgICAgICA/IGN1cnJlbnRMZXR0ZXIub2Zmc2V0TGVmdFxuICAgICAgICAgICAgOiBjdXJyZW50TGV0dGVyLm9mZnNldExlZnQgKyAoKF9iID0gJChjdXJyZW50TGV0dGVyKS53aWR0aCgpKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAwKTtcbiAgICAgICAgY29uc3QgY3VycmVudExldHRlclBvc1RvcCA9IGN1cnJlbnRMZXR0ZXIub2Zmc2V0VG9wO1xuICAgICAgICBjb25zdCBsZXR0ZXJIZWlnaHQgPSAkKGN1cnJlbnRMZXR0ZXIpLmhlaWdodCgpO1xuICAgICAgICBsZXQgbmV3VG9wID0gMDtcbiAgICAgICAgbGV0IG5ld0xlZnQgPSAwO1xuICAgICAgICBuZXdUb3AgPSBjdXJyZW50TGV0dGVyUG9zVG9wIC0gTWF0aC5yb3VuZChsZXR0ZXJIZWlnaHQgLyA1KTtcbiAgICAgICAgaWYgKGlucHV0TGVuID09IDApIHtcbiAgICAgICAgICAgIG5ld0xlZnQgPSBpc0xhbmd1YWdlTGVmdFRvUmlnaHRcbiAgICAgICAgICAgICAgICA/IGN1cnJlbnRMZXR0ZXJQb3NMZWZ0IC0gY2FyZXQud2lkdGgoKSAvIDJcbiAgICAgICAgICAgICAgICA6IGN1cnJlbnRMZXR0ZXJQb3NMZWZ0ICsgY2FyZXQud2lkdGgoKSAvIDI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBuZXdMZWZ0ID0gaXNMYW5ndWFnZUxlZnRUb1JpZ2h0XG4gICAgICAgICAgICAgICAgPyBjdXJyZW50TGV0dGVyUG9zTGVmdCArXG4gICAgICAgICAgICAgICAgICAgICQoY3VycmVudExldHRlcikud2lkdGgoKSAtXG4gICAgICAgICAgICAgICAgICAgIGNhcmV0LndpZHRoKCkgLyAyXG4gICAgICAgICAgICAgICAgOiBjdXJyZW50TGV0dGVyUG9zTGVmdCAtXG4gICAgICAgICAgICAgICAgICAgICQoY3VycmVudExldHRlcikud2lkdGgoKSArXG4gICAgICAgICAgICAgICAgICAgIGNhcmV0LndpZHRoKCkgLyAyO1xuICAgICAgICB9XG4gICAgICAgIGxldCBzbW9vdGhsaW5lc2Nyb2xsID0gJChcIiN3b3JkcyAuc21vb3RoU2Nyb2xsZXJcIikuaGVpZ2h0KCk7XG4gICAgICAgIGlmIChzbW9vdGhsaW5lc2Nyb2xsID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICBzbW9vdGhsaW5lc2Nyb2xsID0gMDtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc21vb3RoQ2FyZXQpIHtcbiAgICAgICAgICAgIGNhcmV0LnN0b3AodHJ1ZSwgZmFsc2UpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIHRvcDogbmV3VG9wIC0gc21vb3RobGluZXNjcm9sbCxcbiAgICAgICAgICAgICAgICBsZWZ0OiBuZXdMZWZ0LFxuICAgICAgICAgICAgfSwgU2xvd1RpbWVyLmdldCgpID8gMCA6IDEwMCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjYXJldC5zdG9wKHRydWUsIHRydWUpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIHRvcDogbmV3VG9wIC0gc21vb3RobGluZXNjcm9sbCxcbiAgICAgICAgICAgICAgICBsZWZ0OiBuZXdMZWZ0LFxuICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc2hvd0FsbExpbmVzKSB7XG4gICAgICAgICAgICBjb25zdCBicm93c2VySGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgICAgICAgY29uc3QgbWlkZGxlUG9zID0gYnJvd3NlckhlaWdodCAvIDIgLSAkKFwiI2NhcmV0XCIpLm91dGVySGVpZ2h0KCkgLyAyO1xuICAgICAgICAgICAgY29uc3QgY29udGVudEhlaWdodCA9IGRvY3VtZW50LmJvZHkuc2Nyb2xsSGVpZ2h0O1xuICAgICAgICAgICAgaWYgKG5ld1RvcCA+PSBtaWRkbGVQb3MgJiZcbiAgICAgICAgICAgICAgICBjb250ZW50SGVpZ2h0ID4gYnJvd3NlckhlaWdodCAmJlxuICAgICAgICAgICAgICAgIFRlc3RBY3RpdmUuZ2V0KCkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdzY3JvbGx0b3AgPSBuZXdUb3AgLSBtaWRkbGVQb3MgLyAyO1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCctLS0tLS0tLS0nKTtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhuZXdUb3ApO1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKG1pZGRsZVBvcyk7XG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coYnJvd3NlckhlaWdodCk7XG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coY29udGVudEhlaWdodCk7XG4gICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKHtcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogMCxcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBuZXdzY3JvbGx0b3AsXG4gICAgICAgICAgICAgICAgICAgIGJlaGF2aW9yOiBcInNtb290aFwiLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChhY3RpdmVXb3JkRW1wdHkpIHtcbiAgICAgICAgICAgICQoXCIjd29yZHMgLmFjdGl2ZVwiKS5jaGlsZHJlbigpLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLnVwZGF0ZVBvc2l0aW9uID0gdXBkYXRlUG9zaXRpb247XG5mdW5jdGlvbiBzaG93KCkge1xuICAgIGlmICgkKFwiI3Jlc3VsdFwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICB1cGRhdGVQb3NpdGlvbigpO1xuICAgICAgICAkKFwiI2NhcmV0XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICBzdGFydEFuaW1hdGlvbigpO1xuICAgIH1cbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZ2V0Q3VzdG9tVGV4dE5hbWVzID0gZXhwb3J0cy5kZWxldGVDdXN0b21UZXh0ID0gZXhwb3J0cy5zZXRDdXN0b21UZXh0ID0gZXhwb3J0cy5nZXRDdXN0b21UZXh0ID0gZXhwb3J0cy5zZXREZWxpbWl0ZXIgPSBleHBvcnRzLnNldFdvcmQgPSBleHBvcnRzLnNldFRpbWUgPSBleHBvcnRzLnNldElzVGltZVJhbmRvbSA9IGV4cG9ydHMuc2V0SXNXb3JkUmFuZG9tID0gZXhwb3J0cy5zZXRUZXh0ID0gZXhwb3J0cy5kZWxpbWl0ZXIgPSBleHBvcnRzLnRpbWUgPSBleHBvcnRzLndvcmQgPSBleHBvcnRzLmlzVGltZVJhbmRvbSA9IGV4cG9ydHMuaXNXb3JkUmFuZG9tID0gZXhwb3J0cy50ZXh0ID0gdm9pZCAwO1xuZXhwb3J0cy50ZXh0ID0gW1xuICAgIFwiVGhlXCIsXG4gICAgXCJxdWlja1wiLFxuICAgIFwiYnJvd25cIixcbiAgICBcImZveFwiLFxuICAgIFwianVtcHNcIixcbiAgICBcIm92ZXJcIixcbiAgICBcInRoZVwiLFxuICAgIFwibGF6eVwiLFxuICAgIFwiZG9nXCIsXG5dO1xuZXhwb3J0cy5pc1dvcmRSYW5kb20gPSBmYWxzZTtcbmV4cG9ydHMuaXNUaW1lUmFuZG9tID0gZmFsc2U7XG5leHBvcnRzLmRlbGltaXRlciA9IFwiIFwiO1xuZnVuY3Rpb24gc2V0VGV4dCh0eHQpIHtcbiAgICBleHBvcnRzLnRleHQgPSB0eHQ7XG59XG5leHBvcnRzLnNldFRleHQgPSBzZXRUZXh0O1xuZnVuY3Rpb24gc2V0SXNXb3JkUmFuZG9tKHZhbCkge1xuICAgIGV4cG9ydHMuaXNXb3JkUmFuZG9tID0gdmFsO1xufVxuZXhwb3J0cy5zZXRJc1dvcmRSYW5kb20gPSBzZXRJc1dvcmRSYW5kb207XG5mdW5jdGlvbiBzZXRJc1RpbWVSYW5kb20odmFsKSB7XG4gICAgZXhwb3J0cy5pc1RpbWVSYW5kb20gPSB2YWw7XG59XG5leHBvcnRzLnNldElzVGltZVJhbmRvbSA9IHNldElzVGltZVJhbmRvbTtcbmZ1bmN0aW9uIHNldFRpbWUodmFsKSB7XG4gICAgZXhwb3J0cy50aW1lID0gdmFsO1xufVxuZXhwb3J0cy5zZXRUaW1lID0gc2V0VGltZTtcbmZ1bmN0aW9uIHNldFdvcmQodmFsKSB7XG4gICAgZXhwb3J0cy53b3JkID0gdmFsO1xufVxuZXhwb3J0cy5zZXRXb3JkID0gc2V0V29yZDtcbmZ1bmN0aW9uIHNldERlbGltaXRlcih2YWwpIHtcbiAgICBleHBvcnRzLmRlbGltaXRlciA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0RGVsaW1pdGVyID0gc2V0RGVsaW1pdGVyO1xuZnVuY3Rpb24gZ2V0Q3VzdG9tVGV4dChuYW1lKSB7XG4gICAgY29uc3QgY3VzdG9tVGV4dCA9IGdldEN1c3RvbVRleHRPYmplY3QoKTtcbiAgICByZXR1cm4gY3VzdG9tVGV4dFtuYW1lXS5zcGxpdCgvICsvKTtcbn1cbmV4cG9ydHMuZ2V0Q3VzdG9tVGV4dCA9IGdldEN1c3RvbVRleHQ7XG5mdW5jdGlvbiBzZXRDdXN0b21UZXh0KG5hbWUsIHRleHQpIHtcbiAgICBjb25zdCBjdXN0b21UZXh0ID0gZ2V0Q3VzdG9tVGV4dE9iamVjdCgpO1xuICAgIGlmICh0eXBlb2YgdGV4dCA9PT0gXCJzdHJpbmdcIilcbiAgICAgICAgY3VzdG9tVGV4dFtuYW1lXSA9IHRleHQ7XG4gICAgZWxzZVxuICAgICAgICBjdXN0b21UZXh0W25hbWVdID0gdGV4dC5qb2luKFwiIFwiKTtcbiAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJjdXN0b21UZXh0XCIsIEpTT04uc3RyaW5naWZ5KGN1c3RvbVRleHQpKTtcbn1cbmV4cG9ydHMuc2V0Q3VzdG9tVGV4dCA9IHNldEN1c3RvbVRleHQ7XG5mdW5jdGlvbiBkZWxldGVDdXN0b21UZXh0KG5hbWUpIHtcbiAgICBjb25zdCBjdXN0b21UZXh0ID0gZ2V0Q3VzdG9tVGV4dE9iamVjdCgpO1xuICAgIGlmIChjdXN0b21UZXh0W25hbWVdKVxuICAgICAgICBkZWxldGUgY3VzdG9tVGV4dFtuYW1lXTtcbiAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJjdXN0b21UZXh0XCIsIEpTT04uc3RyaW5naWZ5KGN1c3RvbVRleHQpKTtcbn1cbmV4cG9ydHMuZGVsZXRlQ3VzdG9tVGV4dCA9IGRlbGV0ZUN1c3RvbVRleHQ7XG5mdW5jdGlvbiBnZXRDdXN0b21UZXh0T2JqZWN0KCkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gSlNPTi5wYXJzZSgoX2EgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJjdXN0b21UZXh0XCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcInt9XCIpO1xufVxuZnVuY3Rpb24gZ2V0Q3VzdG9tVGV4dE5hbWVzKCkge1xuICAgIHJldHVybiBPYmplY3Qua2V5cyhnZXRDdXN0b21UZXh0T2JqZWN0KCkpO1xufVxuZXhwb3J0cy5nZXRDdXN0b21UZXh0TmFtZXMgPSBnZXRDdXN0b21UZXh0TmFtZXM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zZXQgPSB2b2lkIDA7XG5jb25zdCBDYXJldCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jYXJldFwiKSk7XG5jb25zdCBBY3RpdmVQYWdlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvYWN0aXZlLXBhZ2VcIikpO1xuY29uc3QgdW5mb2N1c1B4ID0gMztcbmxldCBzdGF0ZSA9IGZhbHNlO1xuZnVuY3Rpb24gc2V0KGZvYywgd2l0aEN1cnNvciA9IGZhbHNlKSB7XG4gICAgaWYgKGZvYyAmJiAhc3RhdGUpIHtcbiAgICAgICAgc3RhdGUgPSB0cnVlO1xuICAgICAgICBDYXJldC5zdG9wQW5pbWF0aW9uKCk7XG4gICAgICAgICQoXCIjdG9wXCIpLmFkZENsYXNzKFwiZm9jdXNcIik7XG4gICAgICAgICQoXCIjYm90dG9tXCIpLmFkZENsYXNzKFwiZm9jdXNcIik7XG4gICAgICAgIGlmICghd2l0aEN1cnNvcilcbiAgICAgICAgICAgICQoXCJib2R5XCIpLmNzcyhcImN1cnNvclwiLCBcIm5vbmVcIik7XG4gICAgICAgICQoXCIjbWlkZGxlXCIpLmFkZENsYXNzKFwiZm9jdXNcIik7XG4gICAgICAgICQoXCIjYmFubmVyQ2VudGVyXCIpLmFkZENsYXNzKFwiZm9jdXNcIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKCFmb2MgJiYgc3RhdGUpIHtcbiAgICAgICAgc3RhdGUgPSBmYWxzZTtcbiAgICAgICAgQ2FyZXQuc3RhcnRBbmltYXRpb24oKTtcbiAgICAgICAgJChcIiN0b3BcIikucmVtb3ZlQ2xhc3MoXCJmb2N1c1wiKTtcbiAgICAgICAgJChcIiNib3R0b21cIikucmVtb3ZlQ2xhc3MoXCJmb2N1c1wiKTtcbiAgICAgICAgJChcImJvZHlcIikuY3NzKFwiY3Vyc29yXCIsIFwiZGVmYXVsdFwiKTtcbiAgICAgICAgJChcIiNtaWRkbGVcIikucmVtb3ZlQ2xhc3MoXCJmb2N1c1wiKTtcbiAgICAgICAgJChcIiNiYW5uZXJDZW50ZXJcIikucmVtb3ZlQ2xhc3MoXCJmb2N1c1wiKTtcbiAgICB9XG59XG5leHBvcnRzLnNldCA9IHNldDtcbiQoZG9jdW1lbnQpLm1vdXNlbW92ZShmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBpZiAoIXN0YXRlKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT0gXCJsb2FkaW5nXCIpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoQWN0aXZlUGFnZS5nZXQoKSA9PSBcImFjY291bnRcIiAmJiBzdGF0ZSA9PSB0cnVlKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKCQoXCIjdG9wXCIpLmhhc0NsYXNzKFwiZm9jdXNcIikgJiZcbiAgICAgICAgZXZlbnQub3JpZ2luYWxFdmVudCAmJlxuICAgICAgICAvLyBUbyBhdm9pZCBtb3VzZS9kZXNrIHZpYnJhdGlvbiBmcm9tIGNyZWF0aW5nIGEgZmxhc2h5IGVmZmVjdCwgd2UnbGwgdW5mb2N1cyBAID41cHggaW5zdGVhZCBvZiA+MHB4XG4gICAgICAgIChldmVudC5vcmlnaW5hbEV2ZW50Lm1vdmVtZW50WCA+IHVuZm9jdXNQeCB8fFxuICAgICAgICAgICAgZXZlbnQub3JpZ2luYWxFdmVudC5tb3ZlbWVudFkgPiB1bmZvY3VzUHgpKSB7XG4gICAgICAgIHNldChmYWxzZSk7XG4gICAgfVxufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnJlbWVtYmVyU2V0dGluZ3MgPSBleHBvcnRzLmFjdGl2YXRlID0gZXhwb3J0cy5jbGVhciA9IGV4cG9ydHMuc2V0RnVuYm94ID0gZXhwb3J0cy50b2dnbGVTY3JpcHQgPSBleHBvcnRzLnJlc2V0ID0gZXhwb3J0cy5zdGFydE1lbW9yeVRpbWVyID0gZXhwb3J0cy5yZXNldE1lbW9yeVRpbWVyID0gdm9pZCAwO1xuY29uc3QgVGVzdFdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtd29yZHNcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IE1hbnVhbFJlc3RhcnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbWFudWFsLXJlc3RhcnQtdHJhY2tlclwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBUVFMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdHRzXCIpKTtcbmNvbnN0IE1vZGVzTm90aWNlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9tb2Rlcy1ub3RpY2VcIikpO1xubGV0IG1vZGVTYXZlZCA9IG51bGw7XG5sZXQgbWVtb3J5VGltZXIgPSBudWxsO1xubGV0IG1lbW9yeUludGVydmFsID0gbnVsbDtcbmxldCBzZXR0aW5nc01lbW9yeSA9IHt9O1xuZnVuY3Rpb24gcmVtZW1iZXJTZXR0aW5nKHNldHRpbmdOYW1lLCB2YWx1ZSwgc2V0RnVuY3Rpb24pIHtcbiAgICB2YXIgX2E7XG4gICAgKF9hID0gc2V0dGluZ3NNZW1vcnlbc2V0dGluZ05hbWVdKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAoc2V0dGluZ3NNZW1vcnlbc2V0dGluZ05hbWVdID0ge1xuICAgICAgICB2YWx1ZSxcbiAgICAgICAgc2V0RnVuY3Rpb24sXG4gICAgfSk7XG59XG5mdW5jdGlvbiBsb2FkTWVtb3J5KCkge1xuICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUmV2ZXJ0aW5nIGZ1bmJveCBzZXR0aW5nc1wiLCAwKTtcbiAgICBPYmplY3Qua2V5cyhzZXR0aW5nc01lbW9yeSkuZm9yRWFjaCgoc2V0dGluZykgPT4ge1xuICAgICAgICBzZXR0aW5nc01lbW9yeVtzZXR0aW5nXS5zZXRGdW5jdGlvbihzZXR0aW5nc01lbW9yeVtzZXR0aW5nXS52YWx1ZSwgdHJ1ZSk7XG4gICAgfSk7XG4gICAgc2V0dGluZ3NNZW1vcnkgPSB7fTtcbn1cbmZ1bmN0aW9uIHNob3dNZW1vcnlUaW1lcigpIHtcbiAgICAkKFwiI3R5cGluZ1Rlc3QgI21lbW9yeVRpbWVyXCIpLnN0b3AodHJ1ZSwgdHJ1ZSkuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IDEsXG4gICAgfSwgMTI1KTtcbn1cbmZ1bmN0aW9uIGhpZGVNZW1vcnlUaW1lcigpIHtcbiAgICAkKFwiI3R5cGluZ1Rlc3QgI21lbW9yeVRpbWVyXCIpLnN0b3AodHJ1ZSwgdHJ1ZSkuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IDAsXG4gICAgfSwgMTI1KTtcbn1cbmZ1bmN0aW9uIHJlc2V0TWVtb3J5VGltZXIoKSB7XG4gICAgaWYgKG1lbW9yeUludGVydmFsICE9PSBudWxsKSB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwobWVtb3J5SW50ZXJ2YWwpO1xuICAgICAgICBtZW1vcnlJbnRlcnZhbCA9IG51bGw7XG4gICAgfVxuICAgIG1lbW9yeVRpbWVyID0gbnVsbDtcbiAgICBoaWRlTWVtb3J5VGltZXIoKTtcbn1cbmV4cG9ydHMucmVzZXRNZW1vcnlUaW1lciA9IHJlc2V0TWVtb3J5VGltZXI7XG5mdW5jdGlvbiB1cGRhdGVNZW1vcnlUaW1lcihzZWMpIHtcbiAgICAkKFwiI3R5cGluZ1Rlc3QgI21lbW9yeVRpbWVyXCIpLnRleHQoYFRpbWVyIGxlZnQgdG8gbWVtb3Jpc2UgYWxsIHdvcmRzOiAke3NlY31zYCk7XG59XG5mdW5jdGlvbiBzdGFydE1lbW9yeVRpbWVyKCkge1xuICAgIHJlc2V0TWVtb3J5VGltZXIoKTtcbiAgICBtZW1vcnlUaW1lciA9IE1hdGgucm91bmQoTWF0aC5wb3coVGVzdFdvcmRzLndvcmRzLmxlbmd0aCwgMS4yKSk7XG4gICAgdXBkYXRlTWVtb3J5VGltZXIobWVtb3J5VGltZXIpO1xuICAgIHNob3dNZW1vcnlUaW1lcigpO1xuICAgIG1lbW9yeUludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICBpZiAobWVtb3J5VGltZXIgPT09IG51bGwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIG1lbW9yeVRpbWVyIC09IDE7XG4gICAgICAgIG1lbW9yeVRpbWVyID09IDAgPyBoaWRlTWVtb3J5VGltZXIoKSA6IHVwZGF0ZU1lbW9yeVRpbWVyKG1lbW9yeVRpbWVyKTtcbiAgICAgICAgaWYgKG1lbW9yeVRpbWVyIDw9IDApIHtcbiAgICAgICAgICAgIHJlc2V0TWVtb3J5VGltZXIoKTtcbiAgICAgICAgICAgICQoXCIjd29yZHNXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgfSwgMTAwMCk7XG59XG5leHBvcnRzLnN0YXJ0TWVtb3J5VGltZXIgPSBzdGFydE1lbW9yeVRpbWVyO1xuZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgcmVzZXRNZW1vcnlUaW1lcigpO1xufVxuZXhwb3J0cy5yZXNldCA9IHJlc2V0O1xuZnVuY3Rpb24gdG9nZ2xlU2NyaXB0KC4uLnBhcmFtcykge1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJ0dHNcIikge1xuICAgICAgICBUVFMuc3BlYWsocGFyYW1zWzBdKTtcbiAgICB9XG59XG5leHBvcnRzLnRvZ2dsZVNjcmlwdCA9IHRvZ2dsZVNjcmlwdDtcbmZ1bmN0aW9uIHNldEZ1bmJveChmdW5ib3gsIG1vZGUpIHtcbiAgICBtb2RlU2F2ZWQgPSBtb2RlO1xuICAgIFVwZGF0ZUNvbmZpZy5zZXRGdW5ib3goZnVuYm94LCBmYWxzZSk7XG4gICAgaWYgKGZ1bmJveCA9PT0gXCJub25lXCIpXG4gICAgICAgIGxvYWRNZW1vcnkoKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0RnVuYm94ID0gc2V0RnVuYm94O1xuZnVuY3Rpb24gY2xlYXIoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgJChcIiNmdW5Cb3hUaGVtZVwiKS5hdHRyKFwiaHJlZlwiLCBgYCk7XG4gICAgICAgICQoXCIjd29yZHNcIikucmVtb3ZlQ2xhc3MoXCJub3NwYWNlXCIpO1xuICAgICAgICAkKFwiI3dvcmRzXCIpLnJlbW92ZUNsYXNzKFwiYXJyb3dzXCIpO1xuICAgICAgICByZXNldCgpO1xuICAgICAgICAkKFwiI3dvcmRzV3JhcHBlclwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICAgICAgTW9kZXNOb3RpY2UudXBkYXRlKCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xufVxuZXhwb3J0cy5jbGVhciA9IGNsZWFyO1xuZnVuY3Rpb24gYWN0aXZhdGUoZnVuYm94KSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgbGV0IG1vZGUgPSBtb2RlU2F2ZWQ7XG4gICAgICAgIGlmIChmdW5ib3ggPT09IHVuZGVmaW5lZCB8fCBmdW5ib3ggPT09IG51bGwpIHtcbiAgICAgICAgICAgIGZ1bmJveCA9IGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZ1bmJveEluZm8gPSB5aWVsZCBNaXNjLmdldEZ1bmJveChmdW5ib3gpO1xuICAgICAgICAkKFwiI2Z1bkJveFRoZW1lXCIpLmF0dHIoXCJocmVmXCIsIGBgKTtcbiAgICAgICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcIm5vc3BhY2VcIik7XG4gICAgICAgICQoXCIjd29yZHNcIikucmVtb3ZlQ2xhc3MoXCJhcnJvd3NcIik7XG4gICAgICAgIGlmICgoeWllbGQgTWlzYy5nZXRDdXJyZW50TGFuZ3VhZ2UoY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSkpLmxpZ2F0dXJlcykge1xuICAgICAgICAgICAgaWYgKGZ1bmJveCA9PSBcImNob29fY2hvb1wiIHx8IGZ1bmJveCA9PSBcImVhcnRocXVha2VcIikge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ3VycmVudCBsYW5ndWFnZSBkb2VzIG5vdCBzdXBwb3J0IHRoaXMgZnVuYm94IG1vZGVcIiwgMCk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEZ1bmJveChcIm5vbmVcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgeWllbGQgY2xlYXIoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZ1bmJveCAhPT0gXCJub25lXCIgJiYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ6ZW5cIiB8fCBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJxdW90ZVwiKSkge1xuICAgICAgICAgICAgaWYgKChmdW5ib3hJbmZvID09PSBudWxsIHx8IGZ1bmJveEluZm8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZ1bmJveEluZm8uYWZmZWN0c1dvcmRHZW5lcmF0aW9uKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGAke01pc2MuY2FwaXRhbGl6ZUZpcnN0TGV0dGVyT2ZFYWNoV29yZChjb25maWdfMS5kZWZhdWx0Lm1vZGUpfSBtb2RlIGRvZXMgbm90IHN1cHBvcnQgdGhlICR7ZnVuYm94fSBmdW5ib3hgLCAwKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0RnVuYm94KFwibm9uZVwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB5aWVsZCBjbGVhcigpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBpZiAoZnVuYm94ID09PSBcIm5vbmVcIikge1xuICAgICAgICByZXNldCgpO1xuICAgICAgICAkKFwiI3dvcmRzV3JhcHBlclwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gfVxuICAgICAgICBpZiAoZnVuYm94ID09PSBcIm5vbmVcIiAmJiBtb2RlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIG1vZGUgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKChmdW5ib3ggIT09IFwibm9uZVwiICYmIG1vZGUgPT09IHVuZGVmaW5lZCkgfHxcbiAgICAgICAgICAgIChmdW5ib3ggIT09IFwibm9uZVwiICYmIG1vZGUgPT09IG51bGwpKSB7XG4gICAgICAgICAgICBjb25zdCBsaXN0ID0geWllbGQgTWlzYy5nZXRGdW5ib3hMaXN0KCk7XG4gICAgICAgICAgICBtb2RlID0gbGlzdC5maWx0ZXIoKGYpID0+IGYubmFtZSA9PT0gZnVuYm94KVswXS50eXBlO1xuICAgICAgICB9XG4gICAgICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgICAgIGlmIChtb2RlID09PSBcInN0eWxlXCIpIHtcbiAgICAgICAgICAgIGlmIChmdW5ib3ggIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgJChcIiNmdW5Cb3hUaGVtZVwiKS5hdHRyKFwiaHJlZlwiLCBgZnVuYm94LyR7ZnVuYm94fS5jc3NgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmdW5ib3ggPT09IFwic2ltb25fc2F5c1wiKSB7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcE1vZGUoXCJuZXh0XCIsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZ1bmJveCA9PT0gXCJyZWFkX2FoZWFkXCIgfHxcbiAgICAgICAgICAgICAgICBmdW5ib3ggPT09IFwicmVhZF9haGVhZF9lYXN5XCIgfHxcbiAgICAgICAgICAgICAgICBmdW5ib3ggPT09IFwicmVhZF9haGVhZF9oYXJkXCIpIHtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0SGlnaGxpZ2h0TW9kZShcImxldHRlclwiLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChtb2RlID09PSBcInNjcmlwdFwiKSB7XG4gICAgICAgICAgICBpZiAoZnVuYm94ID09PSBcInR0c1wiKSB7XG4gICAgICAgICAgICAgICAgJChcIiNmdW5Cb3hUaGVtZVwiKS5hdHRyKFwiaHJlZlwiLCBgZnVuYm94L3NpbW9uX3NheXMuY3NzYCk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcE1vZGUoXCJvZmZcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEhpZ2hsaWdodE1vZGUoXCJsZXR0ZXJcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmdW5ib3ggPT09IFwibGF5b3V0Zmx1aWRcIikge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRMYXlvdXQoY29uZmlnXzEuZGVmYXVsdC5jdXN0b21MYXlvdXRmbHVpZFxuICAgICAgICAgICAgICAgICAgICA/IGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tTGF5b3V0Zmx1aWQuc3BsaXQoXCIjXCIpWzBdXG4gICAgICAgICAgICAgICAgICAgIDogXCJxd2VydHlcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcExheW91dChjb25maWdfMS5kZWZhdWx0LmN1c3RvbUxheW91dGZsdWlkXG4gICAgICAgICAgICAgICAgICAgID8gY29uZmlnXzEuZGVmYXVsdC5jdXN0b21MYXlvdXRmbHVpZC5zcGxpdChcIiNcIilbMF1cbiAgICAgICAgICAgICAgICAgICAgOiBcInF3ZXJ0eVwiLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZ1bmJveCA9PT0gXCJtZW1vcnlcIikge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFwid29yZHNcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFNob3dBbGxMaW5lcyh0cnVlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBNb2RlID09PSBcIm5leHRcIikge1xuICAgICAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0S2V5bWFwTW9kZShcInJlYWN0XCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZ1bmJveCA9PT0gXCJub3NwYWNlXCIpIHtcbiAgICAgICAgICAgICAgICAkKFwiI3dvcmRzXCIpLmFkZENsYXNzKFwibm9zcGFjZVwiKTtcbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0SGlnaGxpZ2h0TW9kZShcImxldHRlclwiLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICAgICAgICAgICQoXCIjd29yZHNcIikuYWRkQ2xhc3MoXCJhcnJvd3NcIik7XG4gICAgICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEhpZ2hsaWdodE1vZGUoXCJsZXR0ZXJcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gTW9kZXNOb3RpY2UudXBkYXRlKCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xufVxuZXhwb3J0cy5hY3RpdmF0ZSA9IGFjdGl2YXRlO1xuZnVuY3Rpb24gcmVtZW1iZXJTZXR0aW5ncygpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCBmdW5ib3ggPSBjb25maWdfMS5kZWZhdWx0LmZ1bmJveDtcbiAgICAgICAgbGV0IG1vZGUgPSBtb2RlU2F2ZWQ7XG4gICAgICAgIGlmIChmdW5ib3ggPT09IFwibm9uZVwiICYmIG1vZGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbW9kZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoKGZ1bmJveCAhPT0gXCJub25lXCIgJiYgbW9kZSA9PT0gdW5kZWZpbmVkKSB8fFxuICAgICAgICAgICAgKGZ1bmJveCAhPT0gXCJub25lXCIgJiYgbW9kZSA9PT0gbnVsbCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGxpc3QgPSB5aWVsZCBNaXNjLmdldEZ1bmJveExpc3QoKTtcbiAgICAgICAgICAgIG1vZGUgPSBsaXN0LmZpbHRlcigoZikgPT4gZi5uYW1lID09PSBmdW5ib3gpWzBdLnR5cGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1vZGUgPT09IFwic3R5bGVcIikge1xuICAgICAgICAgICAgaWYgKGZ1bmJveCA9PT0gXCJzaW1vbl9zYXlzXCIpIHtcbiAgICAgICAgICAgICAgICByZW1lbWJlclNldHRpbmcoXCJrZXltYXBNb2RlXCIsIGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTW9kZSwgVXBkYXRlQ29uZmlnLnNldEtleW1hcE1vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZ1bmJveCA9PT0gXCJyZWFkX2FoZWFkXCIgfHxcbiAgICAgICAgICAgICAgICBmdW5ib3ggPT09IFwicmVhZF9haGVhZF9lYXN5XCIgfHxcbiAgICAgICAgICAgICAgICBmdW5ib3ggPT09IFwicmVhZF9haGVhZF9oYXJkXCIpIHtcbiAgICAgICAgICAgICAgICByZW1lbWJlclNldHRpbmcoXCJoaWdobGlnaHRNb2RlXCIsIGNvbmZpZ18xLmRlZmF1bHQuaGlnaGxpZ2h0TW9kZSwgVXBkYXRlQ29uZmlnLnNldEhpZ2hsaWdodE1vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG1vZGUgPT09IFwic2NyaXB0XCIpIHtcbiAgICAgICAgICAgIGlmIChmdW5ib3ggPT09IFwidHRzXCIpIHtcbiAgICAgICAgICAgICAgICByZW1lbWJlclNldHRpbmcoXCJrZXltYXBNb2RlXCIsIGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTW9kZSwgVXBkYXRlQ29uZmlnLnNldEtleW1hcE1vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZnVuYm94ID09PSBcImxheW91dGZsdWlkXCIpIHtcbiAgICAgICAgICAgICAgICByZW1lbWJlclNldHRpbmcoXCJrZXltYXBNb2RlXCIsIGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTW9kZSwgVXBkYXRlQ29uZmlnLnNldEtleW1hcE1vZGUpO1xuICAgICAgICAgICAgICAgIHJlbWVtYmVyU2V0dGluZyhcImxheW91dFwiLCBjb25maWdfMS5kZWZhdWx0LmxheW91dCwgVXBkYXRlQ29uZmlnLnNldExheW91dCk7XG4gICAgICAgICAgICAgICAgcmVtZW1iZXJTZXR0aW5nKFwia2V5bWFwTGF5b3V0XCIsIGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTGF5b3V0LCBVcGRhdGVDb25maWcuc2V0S2V5bWFwTGF5b3V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZ1bmJveCA9PT0gXCJtZW1vcnlcIikge1xuICAgICAgICAgICAgICAgIHJlbWVtYmVyU2V0dGluZyhcIm1vZGVcIiwgY29uZmlnXzEuZGVmYXVsdC5tb2RlLCBVcGRhdGVDb25maWcuc2V0TW9kZSk7XG4gICAgICAgICAgICAgICAgcmVtZW1iZXJTZXR0aW5nKFwic2hvd0FsbExpbmVzXCIsIGNvbmZpZ18xLmRlZmF1bHQuc2hvd0FsbExpbmVzLCBVcGRhdGVDb25maWcuc2V0U2hvd0FsbExpbmVzKTtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBNb2RlID09PSBcIm5leHRcIikge1xuICAgICAgICAgICAgICAgICAgICByZW1lbWJlclNldHRpbmcoXCJrZXltYXBNb2RlXCIsIGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTW9kZSwgVXBkYXRlQ29uZmlnLnNldEtleW1hcE1vZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZ1bmJveCA9PT0gXCJub3NwYWNlXCIpIHtcbiAgICAgICAgICAgICAgICByZW1lbWJlclNldHRpbmcoXCJoaWdobGlnaHRNb2RlXCIsIGNvbmZpZ18xLmRlZmF1bHQuaGlnaGxpZ2h0TW9kZSwgVXBkYXRlQ29uZmlnLnNldEhpZ2hsaWdodE1vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZnVuYm94ID09PSBcImFycm93c1wiKSB7XG4gICAgICAgICAgICAgICAgcmVtZW1iZXJTZXR0aW5nKFwiaGlnaGxpZ2h0TW9kZVwiLCBjb25maWdfMS5kZWZhdWx0LmhpZ2hsaWdodE1vZGUsIFVwZGF0ZUNvbmZpZy5zZXRIaWdobGlnaHRNb2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZ1bmJveCA9PT0gXCI1ODAwOFwiKSB7XG4gICAgICAgICAgICAgICAgcmVtZW1iZXJTZXR0aW5nKFwibnVtYmVyc1wiLCBjb25maWdfMS5kZWZhdWx0Lm51bWJlcnMsIFVwZGF0ZUNvbmZpZy5zZXROdW1iZXJzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5yZW1lbWJlclNldHRpbmdzID0gcmVtZW1iZXJTZXR0aW5ncztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZ2V0Q2hhckZyb21FdmVudCA9IHZvaWQgMDtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBjYXBzX3dhcm5pbmdfMSA9IHJlcXVpcmUoXCIuL2NhcHMtd2FybmluZ1wiKTtcbmZ1bmN0aW9uIGdldENoYXJGcm9tRXZlbnQoZXZlbnQpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBmdW5jdGlvbiBlbXVsYXRlZExheW91dFNob3VsZFNoaWZ0S2V5KGV2ZW50LCBuZXdLZXlQcmV2aWV3KSB7XG4gICAgICAgICAgICBpZiAoY2Fwc193YXJuaW5nXzEuY2Fwc1N0YXRlKVxuICAgICAgICAgICAgICAgIHJldHVybiBNaXNjLmlzQVNDSUlMZXR0ZXIobmV3S2V5UHJldmlldykgIT09IGV2ZW50LnNoaWZ0S2V5O1xuICAgICAgICAgICAgcmV0dXJuIGV2ZW50LnNoaWZ0S2V5O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGxheW91dCA9IHlpZWxkIE1pc2MuZ2V0TGF5b3V0KGNvbmZpZ18xLmRlZmF1bHQubGF5b3V0KTtcbiAgICAgICAgbGV0IGtleUV2ZW50Q29kZXMgPSBbXTtcbiAgICAgICAgaWYgKGxheW91dC50eXBlID09PSBcImFuc2lcIikge1xuICAgICAgICAgICAga2V5RXZlbnRDb2RlcyA9IFtcbiAgICAgICAgICAgICAgICBcIkJhY2txdW90ZVwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQxXCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDJcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0M1wiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ0XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDVcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0NlwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ3XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDhcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0OVwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQwXCIsXG4gICAgICAgICAgICAgICAgXCJNaW51c1wiLFxuICAgICAgICAgICAgICAgIFwiRXF1YWxcIixcbiAgICAgICAgICAgICAgICBcIktleVFcIixcbiAgICAgICAgICAgICAgICBcIktleVdcIixcbiAgICAgICAgICAgICAgICBcIktleUVcIixcbiAgICAgICAgICAgICAgICBcIktleVJcIixcbiAgICAgICAgICAgICAgICBcIktleVRcIixcbiAgICAgICAgICAgICAgICBcIktleVlcIixcbiAgICAgICAgICAgICAgICBcIktleVVcIixcbiAgICAgICAgICAgICAgICBcIktleUlcIixcbiAgICAgICAgICAgICAgICBcIktleU9cIixcbiAgICAgICAgICAgICAgICBcIktleVBcIixcbiAgICAgICAgICAgICAgICBcIkJyYWNrZXRMZWZ0XCIsXG4gICAgICAgICAgICAgICAgXCJCcmFja2V0UmlnaHRcIixcbiAgICAgICAgICAgICAgICBcIkJhY2tzbGFzaFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5QVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5U1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5RFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5RlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5R1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5SFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5SlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5S1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5TFwiLFxuICAgICAgICAgICAgICAgIFwiU2VtaWNvbG9uXCIsXG4gICAgICAgICAgICAgICAgXCJRdW90ZVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5WlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5WFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5Q1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5VlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5QlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5TlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5TVwiLFxuICAgICAgICAgICAgICAgIFwiQ29tbWFcIixcbiAgICAgICAgICAgICAgICBcIlBlcmlvZFwiLFxuICAgICAgICAgICAgICAgIFwiU2xhc2hcIixcbiAgICAgICAgICAgICAgICBcIlNwYWNlXCIsXG4gICAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGxheW91dC50eXBlID09PSBcImlzb1wiKSB7XG4gICAgICAgICAgICBrZXlFdmVudENvZGVzID0gW1xuICAgICAgICAgICAgICAgIFwiQmFja3F1b3RlXCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDFcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0MlwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQzXCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDRcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0NVwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ2XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDdcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0OFwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ5XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDBcIixcbiAgICAgICAgICAgICAgICBcIk1pbnVzXCIsXG4gICAgICAgICAgICAgICAgXCJFcXVhbFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5UVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5V1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5RVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5UlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5VFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5WVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5VVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5SVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5T1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5UFwiLFxuICAgICAgICAgICAgICAgIFwiQnJhY2tldExlZnRcIixcbiAgICAgICAgICAgICAgICBcIkJyYWNrZXRSaWdodFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5QVwiLFxuICAgICAgICAgICAgICAgIFwiS2V5U1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5RFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5RlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5R1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5SFwiLFxuICAgICAgICAgICAgICAgIFwiS2V5SlwiLFxuICAgICAgICAgICAgICAgIFwiS2V5S1wiLFxuICAgICAgICAgICAgICAgIFwiS2V5TFwiLFxuICAgICAgICAgICAgICAgIFwiU2VtaWNvbG9uXCIsXG4gICAgICAgICAgICAgICAgXCJRdW90ZVwiLFxuICAgICAgICAgICAgICAgIFwiSW50bEJhY2tzbGFzaFwiLFxuICAgICAgICAgICAgICAgIFwiQmFja3F1b3RlXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlaXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlYXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlDXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlWXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlCXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlOXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlNXCIsXG4gICAgICAgICAgICAgICAgXCJDb21tYVwiLFxuICAgICAgICAgICAgICAgIFwiUGVyaW9kXCIsXG4gICAgICAgICAgICAgICAgXCJTbGFzaFwiLFxuICAgICAgICAgICAgICAgIFwiU3BhY2VcIixcbiAgICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobGF5b3V0LnR5cGUgPT09IFwibWF0cml4XCIpIHtcbiAgICAgICAgICAgIGtleUV2ZW50Q29kZXMgPSBbXG4gICAgICAgICAgICAgICAgXCJCYWNrcXVvdGVcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0MVwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQyXCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDNcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0NFwiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ1XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDZcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0N1wiLFxuICAgICAgICAgICAgICAgIFwiRGlnaXQ4XCIsXG4gICAgICAgICAgICAgICAgXCJEaWdpdDlcIixcbiAgICAgICAgICAgICAgICBcIkRpZ2l0MFwiLFxuICAgICAgICAgICAgICAgIFwiTWludXNcIixcbiAgICAgICAgICAgICAgICBcIkVxdWFsXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlRXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlXXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlFXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlSXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlUXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlZXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlVXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlJXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlPXCIsXG4gICAgICAgICAgICAgICAgXCJLZXlQXCIsXG4gICAgICAgICAgICAgICAgXCJCcmFja2V0TGVmdFwiLFxuICAgICAgICAgICAgICAgIFwiQnJhY2tldFJpZ2h0XCIsXG4gICAgICAgICAgICAgICAgXCJCYWNrc2xhc2hcIixcbiAgICAgICAgICAgICAgICBcIktleUFcIixcbiAgICAgICAgICAgICAgICBcIktleVNcIixcbiAgICAgICAgICAgICAgICBcIktleURcIixcbiAgICAgICAgICAgICAgICBcIktleUZcIixcbiAgICAgICAgICAgICAgICBcIktleUdcIixcbiAgICAgICAgICAgICAgICBcIktleUhcIixcbiAgICAgICAgICAgICAgICBcIktleUpcIixcbiAgICAgICAgICAgICAgICBcIktleUtcIixcbiAgICAgICAgICAgICAgICBcIktleUxcIixcbiAgICAgICAgICAgICAgICBcIlNlbWljb2xvblwiLFxuICAgICAgICAgICAgICAgIFwiUXVvdGVcIixcbiAgICAgICAgICAgICAgICBcIktleVpcIixcbiAgICAgICAgICAgICAgICBcIktleVhcIixcbiAgICAgICAgICAgICAgICBcIktleUNcIixcbiAgICAgICAgICAgICAgICBcIktleVZcIixcbiAgICAgICAgICAgICAgICBcIktleUJcIixcbiAgICAgICAgICAgICAgICBcIktleU5cIixcbiAgICAgICAgICAgICAgICBcIktleU1cIixcbiAgICAgICAgICAgICAgICBcIkNvbW1hXCIsXG4gICAgICAgICAgICAgICAgXCJQZXJpb2RcIixcbiAgICAgICAgICAgICAgICBcIlNsYXNoXCIsXG4gICAgICAgICAgICAgICAgXCJTcGFjZVwiLFxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBsYXlvdXRLZXlzID0gbGF5b3V0LmtleXM7XG4gICAgICAgIGNvbnN0IGxheW91dE1hcCA9IGxheW91dEtleXNbXCJyb3cxXCJdXG4gICAgICAgICAgICAuY29uY2F0KGxheW91dEtleXNbXCJyb3cyXCJdKVxuICAgICAgICAgICAgLmNvbmNhdChsYXlvdXRLZXlzW1wicm93M1wiXSlcbiAgICAgICAgICAgIC5jb25jYXQobGF5b3V0S2V5c1tcInJvdzRcIl0pXG4gICAgICAgICAgICAuY29uY2F0KGxheW91dEtleXNbXCJyb3c1XCJdKTtcbiAgICAgICAgbGV0IG1hcEluZGV4ID0gbnVsbDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlFdmVudENvZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQuY29kZSA9PSBrZXlFdmVudENvZGVzW2ldKSB7XG4gICAgICAgICAgICAgICAgbWFwSW5kZXggPSBpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghbWFwSW5kZXgpIHtcbiAgICAgICAgICAgIGlmIChldmVudC5jb2RlLmluY2x1ZGVzKFwiTnVtcGFkXCIpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50LmtleTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5ld0tleVByZXZpZXcgPSBsYXlvdXRNYXBbbWFwSW5kZXhdWzBdO1xuICAgICAgICBjb25zdCBzaGlmdCA9IGVtdWxhdGVkTGF5b3V0U2hvdWxkU2hpZnRLZXkoZXZlbnQsIG5ld0tleVByZXZpZXcpID8gMSA6IDA7XG4gICAgICAgIGNvbnN0IGNoYXIgPSBsYXlvdXRNYXBbbWFwSW5kZXhdW3NoaWZ0XTtcbiAgICAgICAgaWYgKGNoYXIpIHtcbiAgICAgICAgICAgIHJldHVybiBjaGFyO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGV2ZW50LmtleTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRDaGFyRnJvbUV2ZW50ID0gZ2V0Q2hhckZyb21FdmVudDtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5yZXBsYWNlQWNjZW50cyA9IHZvaWQgMDtcbmNvbnN0IGFjY2VudHMgPSBbXG4gICAgW1wiw6HDoMOiw6TDpcOjxIXEhcyBxIHEhcyExINcIiwgXCJhXCJdLFxuICAgIFtcIsOpw6jDqsOr4bq9xJnEmcyBxJPEmcyExJfEm1wiLCBcImVcIl0sXG4gICAgW1wiw63DrMOuw6/EqcSvxK/MgcSrxK/MhFwiLCBcImlcIl0sXG4gICAgW1wiw7PDssO0w7bDuMO1w7PFjcerx6vMgcetxZFcIiwgXCJvXCJdLFxuICAgIFtcIsO6w7nDu8O8xa3FqcO6xavFr8WxXCIsIFwidVwiXSxcbiAgICBbXCLFhMWIXCIsIFwiblwiXSxcbiAgICBbXCLDp8SJxI3Eh1wiLCBcImNcIl0sXG4gICAgW1wixZlcIiwgXCJyXCJdLFxuICAgIFtcIsSPXCIsIFwiZFwiXSxcbiAgICBbXCLFpcibXCIsIFwidFwiXSxcbiAgICBbXCLDplwiLCBcImFlXCJdLFxuICAgIFtcIsWTXCIsIFwib2VcIl0sXG4gICAgW1wi4bqFXCIsIFwid1wiXSxcbiAgICBbXCLEncSfZ8yDXCIsIFwiZ1wiXSxcbiAgICBbXCLEpVwiLCBcImhcIl0sXG4gICAgW1wixLVcIiwgXCJqXCJdLFxuICAgIFtcIsWEXCIsIFwiblwiXSxcbiAgICBbXCLFncWbxaHImVwiLCBcInNcIl0sXG4gICAgW1wixbzFusW+XCIsIFwielwiXSxcbiAgICBbXCLDv+G7ucO9w7/Ft1wiLCBcInlcIl0sXG4gICAgW1wixYLEvlwiLCBcImxcIl0sXG4gICAgW1wi2KPYpdiiXCIsIFwi2KdcIl0sXG4gICAgW1wi2Y5cIiwgXCJcIl0sXG4gICAgW1wi2Y9cIiwgXCJcIl0sXG4gICAgW1wi2ZBcIiwgXCJcIl0sXG4gICAgW1wi2ZJcIiwgXCJcIl0sXG4gICAgW1wi2YtcIiwgXCJcIl0sXG4gICAgW1wi2YxcIiwgXCJcIl0sXG4gICAgW1wi2Y1cIiwgXCJcIl0sXG4gICAgW1wi2ZFcIiwgXCJcIl0sXG5dO1xuZnVuY3Rpb24gcmVwbGFjZUFjY2VudHMod29yZCwgYWNjZW50c092ZXJyaWRlKSB7XG4gICAgbGV0IG5ld1dvcmQgPSB3b3JkO1xuICAgIGlmICghYWNjZW50cyAmJiAhYWNjZW50c092ZXJyaWRlKVxuICAgICAgICByZXR1cm4gbmV3V29yZDtcbiAgICBsZXQgcmVnZXg7XG4gICAgY29uc3QgbGlzdCA9IGFjY2VudHNPdmVycmlkZSB8fCBhY2NlbnRzO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICByZWdleCA9IG5ldyBSZWdFeHAoYFske2xpc3RbaV1bMF19XWAsIFwiZ2lcIik7XG4gICAgICAgIG5ld1dvcmQgPSBuZXdXb3JkLnJlcGxhY2UocmVnZXgsIGxpc3RbaV1bMV0pO1xuICAgIH1cbiAgICByZXR1cm4gbmV3V29yZDtcbn1cbmV4cG9ydHMucmVwbGFjZUFjY2VudHMgPSByZXBsYWNlQWNjZW50cztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmhpZGUgPSBleHBvcnRzLnNob3cgPSBleHBvcnRzLnVwZGF0ZSA9IHZvaWQgMDtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgVGVzdEFjdGl2ZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3Rlc3QtYWN0aXZlXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuZnVuY3Rpb24gdXBkYXRlKGFjYykge1xuICAgIGxldCBudW1iZXIgPSBNYXRoLmZsb29yKGFjYyk7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlKSB7XG4gICAgICAgIG51bWJlciA9IDEwMDtcbiAgICB9XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC5hY2NcIikuaW5uZXJIVE1MID1cbiAgICAgICAgbnVtYmVyICsgXCIlXCI7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNsaXZlQWNjXCIpLmlubmVySFRNTCA9IG51bWJlciArIFwiJVwiO1xufVxuZXhwb3J0cy51cGRhdGUgPSB1cGRhdGU7XG5mdW5jdGlvbiBzaG93KCkge1xuICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5zaG93TGl2ZUFjYylcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmICghVGVzdEFjdGl2ZS5nZXQoKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnRpbWVyU3R5bGUgPT09IFwibWluaVwiKSB7XG4gICAgICAgIC8vICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAud3BtXCIpLmNzcyhcIm9wYWNpdHlcIiwgQ29uZmlnLnRpbWVyT3BhY2l0eSk7XG4gICAgICAgIGlmICghJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC5hY2NcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAuYWNjXCIpXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiBjb25maWdfMS5kZWZhdWx0LnRpbWVyT3BhY2l0eSxcbiAgICAgICAgfSwgMTI1KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vICQoXCIjbGl2ZVdwbVwiKS5jc3MoXCJvcGFjaXR5XCIsIENvbmZpZy50aW1lck9wYWNpdHkpO1xuICAgICAgICBpZiAoISQoXCIjbGl2ZUFjY1wiKS5oYXNDbGFzcyhcImhpZGRlblwiKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgJChcIiNsaXZlQWNjXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpLmNzcyhcIm9wYWNpdHlcIiwgMCkuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiBjb25maWdfMS5kZWZhdWx0LnRpbWVyT3BhY2l0eSxcbiAgICAgICAgfSwgMTI1KTtcbiAgICB9XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAvLyAkKFwiI2xpdmVXcG1cIikuY3NzKFwib3BhY2l0eVwiLCAwKTtcbiAgICAvLyAkKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLndwbVwiKS5jc3MoXCJvcGFjaXR5XCIsIDApO1xuICAgICQoXCIjbGl2ZUFjY1wiKS5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogY29uZmlnXzEuZGVmYXVsdC50aW1lck9wYWNpdHksXG4gICAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICQoXCIjbGl2ZUFjY1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbiAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLmFjY1wiKS5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogY29uZmlnXzEuZGVmYXVsdC50aW1lck9wYWNpdHksXG4gICAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAuYWNjXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXksIGV2ZW50VmFsdWUpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwic2hvd0xpdmVBY2NcIilcbiAgICAgICAgZXZlbnRWYWx1ZSA/IHNob3coKSA6IGhpZGUoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5zaG93ID0gZXhwb3J0cy51cGRhdGUgPSB2b2lkIDA7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IFRlc3RBY3RpdmUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy90ZXN0LWFjdGl2ZVwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmZ1bmN0aW9uIHVwZGF0ZShidXJzdCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5zaG93TGl2ZUJ1cnN0KVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBsZXQgbnVtYmVyID0gYnVyc3Q7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSkge1xuICAgICAgICAgICAgbnVtYmVyID0gMDtcbiAgICAgICAgfVxuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLmJ1cnN0XCIpLmlubmVySFRNTCA9XG4gICAgICAgICAgICBudW1iZXIudG9TdHJpbmcoKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNsaXZlQnVyc3RcIikuaW5uZXJIVE1MID1cbiAgICAgICAgICAgIG51bWJlci50b1N0cmluZygpO1xuICAgIH0pO1xufVxuZXhwb3J0cy51cGRhdGUgPSB1cGRhdGU7XG5mdW5jdGlvbiBzaG93KCkge1xuICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5zaG93TGl2ZUJ1cnN0KVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKCFUZXN0QWN0aXZlLmdldCgpKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQudGltZXJTdHlsZSA9PT0gXCJtaW5pXCIpIHtcbiAgICAgICAgaWYgKCEkKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLmJ1cnN0XCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLmJ1cnN0XCIpXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiBjb25maWdfMS5kZWZhdWx0LnRpbWVyT3BhY2l0eSxcbiAgICAgICAgfSwgMTI1KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmICghJChcIiNsaXZlQnVyc3RcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICQoXCIjbGl2ZUJ1cnN0XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpLmNzcyhcIm9wYWNpdHlcIiwgMCkuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiBjb25maWdfMS5kZWZhdWx0LnRpbWVyT3BhY2l0eSxcbiAgICAgICAgfSwgMTI1KTtcbiAgICB9XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAkKFwiI2xpdmVCdXJzdFwiKS5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogY29uZmlnXzEuZGVmYXVsdC50aW1lck9wYWNpdHksXG4gICAgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICQoXCIjbGl2ZUJ1cnN0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xuICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAuYnVyc3RcIikuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IGNvbmZpZ18xLmRlZmF1bHQudGltZXJPcGFjaXR5LFxuICAgIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLmJ1cnN0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXksIGV2ZW50VmFsdWUpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwic2hvd0xpdmVCdXJzdFwiKVxuICAgICAgICBldmVudFZhbHVlID8gc2hvdygpIDogaGlkZSgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5zaG93ID0gZXhwb3J0cy51cGRhdGUgPSB2b2lkIDA7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IFRlc3RBY3RpdmUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy90ZXN0LWFjdGl2ZVwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmNvbnN0IGxpdmVXcG1FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNsaXZlV3BtXCIpO1xuY29uc3QgbWluaUxpdmVXcG1FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC53cG1cIik7XG5mdW5jdGlvbiB1cGRhdGUod3BtLCByYXcpIHtcbiAgICAvLyBpZiAoIVRlc3RBY3RpdmUuZ2V0KCkgfHwgIUNvbmZpZy5zaG93TGl2ZVdwbSkge1xuICAgIC8vICAgaGlkZUxpdmVXcG0oKTtcbiAgICAvLyB9IGVsc2Uge1xuICAgIC8vICAgc2hvd0xpdmVXcG0oKTtcbiAgICAvLyB9XG4gICAgbGV0IG51bWJlciA9IHdwbTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUpIHtcbiAgICAgICAgbnVtYmVyID0gcmF3O1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNKSB7XG4gICAgICAgIG51bWJlciA9IE1hdGgucm91bmQobnVtYmVyICogNSk7XG4gICAgfVxuICAgIG1pbmlMaXZlV3BtRWxlbWVudC5pbm5lckhUTUwgPSBudW1iZXIudG9TdHJpbmcoKTtcbiAgICBsaXZlV3BtRWxlbWVudC5pbm5lckhUTUwgPSBudW1iZXIudG9TdHJpbmcoKTtcbn1cbmV4cG9ydHMudXBkYXRlID0gdXBkYXRlO1xuZnVuY3Rpb24gc2hvdygpIHtcbiAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuc2hvd0xpdmVXcG0pXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoIVRlc3RBY3RpdmUuZ2V0KCkpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC50aW1lclN0eWxlID09PSBcIm1pbmlcIikge1xuICAgICAgICAvLyAkKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLndwbVwiKS5jc3MoXCJvcGFjaXR5XCIsIENvbmZpZy50aW1lck9wYWNpdHkpO1xuICAgICAgICBpZiAoISQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAud3BtXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLndwbVwiKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogY29uZmlnXzEuZGVmYXVsdC50aW1lck9wYWNpdHksXG4gICAgICAgIH0sIDEyNSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyAkKFwiI2xpdmVXcG1cIikuY3NzKFwib3BhY2l0eVwiLCBDb25maWcudGltZXJPcGFjaXR5KTtcbiAgICAgICAgaWYgKCEkKFwiI2xpdmVXcG1cIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICQoXCIjbGl2ZVdwbVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKS5jc3MoXCJvcGFjaXR5XCIsIDApLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogY29uZmlnXzEuZGVmYXVsdC50aW1lck9wYWNpdHksXG4gICAgICAgIH0sIDEyNSk7XG4gICAgfVxufVxuZXhwb3J0cy5zaG93ID0gc2hvdztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgJChcIiNsaXZlV3BtXCIpLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiBjb25maWdfMS5kZWZhdWx0LnRpbWVyT3BhY2l0eSxcbiAgICB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgJChcIiNsaXZlV3BtXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xuICAgICQoXCIjbWluaVRpbWVyQW5kTGl2ZVdwbSAud3BtXCIpLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiBjb25maWdfMS5kZWZhdWx0LnRpbWVyT3BhY2l0eSxcbiAgICB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC53cG1cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfSk7XG59XG5leHBvcnRzLmhpZGUgPSBoaWRlO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSwgZXZlbnRWYWx1ZSkgPT4ge1xuICAgIGlmIChldmVudEtleSA9PT0gXCJzaG93TGl2ZVdwbVwiKVxuICAgICAgICBldmVudFZhbHVlID8gc2hvdygpIDogaGlkZSgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZ2V0ID0gZXhwb3J0cy5yZXNldCA9IGV4cG9ydHMuc2V0ID0gdm9pZCAwO1xubGV0IHN0YXRlID0gZmFsc2U7XG5mdW5jdGlvbiBzZXQoKSB7XG4gICAgc3RhdGUgPSB0cnVlO1xufVxuZXhwb3J0cy5zZXQgPSBzZXQ7XG5mdW5jdGlvbiByZXNldCgpIHtcbiAgICBzdGF0ZSA9IGZhbHNlO1xufVxuZXhwb3J0cy5yZXNldCA9IHJlc2V0O1xuZnVuY3Rpb24gZ2V0KCkge1xuICAgIHJldHVybiBzdGF0ZTtcbn1cbmV4cG9ydHMuZ2V0ID0gZ2V0O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGlkZSA9IGV4cG9ydHMuc2hvdyA9IGV4cG9ydHMuc3RvcCA9IGV4cG9ydHMudHlwZSA9IGV4cG9ydHMudXBkYXRlRmFzdE9wYWNpdHkgPSB2b2lkIDA7XG5jb25zdCBtaXNjXzEgPSByZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBUZXN0QWN0aXZlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvdGVzdC1hY3RpdmVcIikpO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSkgPT4ge1xuICAgIGlmIChldmVudEtleSA9PT0gXCJtb25rZXlcIiAmJiBUZXN0QWN0aXZlLmdldCgpKSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vbmtleSkge1xuICAgICAgICAgICAgJChcIiNtb25rZXlcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiI21vbmtleVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xubGV0IGxlZnQgPSBmYWxzZTtcbmxldCByaWdodCA9IGZhbHNlO1xuLy8gMCBoYW5kIHVwXG4vLyAxIGhhbmQgZG93blxuLy8gMDAgYm90aCBoYW5kcyB1cFxuLy8gMDEgcmlnaHQgaGFuZCBkb3duXG4vLyAxMCBsZWZ0IGhhbmQgZG93blxuLy8gMTEgYm90aCBoYW5kcyBkb3duXG5jb25zdCBlbGVtZW50cyA9IHtcbiAgICBcIjAwXCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbW9ua2V5IC51cFwiKSxcbiAgICBcIjAxXCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbW9ua2V5IC5yaWdodFwiKSxcbiAgICBcIjEwXCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbW9ua2V5IC5sZWZ0XCIpLFxuICAgIFwiMTFcIjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtb25rZXkgLmJvdGhcIiksXG59O1xuY29uc3QgZWxlbWVudHNGYXN0ID0ge1xuICAgIFwiMDBcIjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtb25rZXkgLmZhc3QgLnVwXCIpLFxuICAgIFwiMDFcIjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtb25rZXkgLmZhc3QgLnJpZ2h0XCIpLFxuICAgIFwiMTBcIjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtb25rZXkgLmZhc3QgLmxlZnRcIiksXG4gICAgXCIxMVwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21vbmtleSAuZmFzdCAuYm90aFwiKSxcbn07XG5sZXQgbGFzdCA9IFwicmlnaHRcIjtcbmZ1bmN0aW9uIHRvQml0KGIpIHtcbiAgICByZXR1cm4gYiA/IFwiMVwiIDogXCIwXCI7XG59XG5mdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgaWYgKCFjb25maWdfMS5kZWZhdWx0Lm1vbmtleSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmICghKChfYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbW9ua2V5XCIpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2xhc3NMaXN0LmNvbnRhaW5zKFwiaGlkZGVuXCIpKSkge1xuICAgICAgICBPYmplY3Qua2V5cyhlbGVtZW50cykuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAoX2EgPSBlbGVtZW50c1trZXldKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5rZXlzKGVsZW1lbnRzRmFzdCkuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAoX2EgPSBlbGVtZW50c0Zhc3Rba2V5XSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBpZCA9IGAke3RvQml0KGxlZnQpfSR7dG9CaXQocmlnaHQpfWA7XG4gICAgICAgIChfYiA9IGVsZW1lbnRzW2lkXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG4gICAgICAgIChfYyA9IGVsZW1lbnRzRmFzdFtpZF0pID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHVwZGF0ZUZhc3RPcGFjaXR5KG51bSkge1xuICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5tb25rZXkpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBvcGFjaXR5ID0gKDAsIG1pc2NfMS5tYXBSYW5nZSkobnVtLCAxMzAsIDE4MCwgMCwgMSk7XG4gICAgJChcIiNtb25rZXkgLmZhc3RcIikuYW5pbWF0ZSh7IG9wYWNpdHk6IG9wYWNpdHkgfSwgMTAwMCk7XG4gICAgbGV0IGFuaW1EdXJhdGlvbiA9ICgwLCBtaXNjXzEubWFwUmFuZ2UpKG51bSwgMTMwLCAxODAsIDAuMjUsIDAuMDEpO1xuICAgIGlmIChhbmltRHVyYXRpb24gPT0gMC4yNSlcbiAgICAgICAgYW5pbUR1cmF0aW9uID0gMDtcbiAgICAkKFwiI21vbmtleVwiKS5jc3MoeyBhbmltYXRpb25EdXJhdGlvbjogYW5pbUR1cmF0aW9uICsgXCJzXCIgfSk7XG59XG5leHBvcnRzLnVwZGF0ZUZhc3RPcGFjaXR5ID0gdXBkYXRlRmFzdE9wYWNpdHk7XG5mdW5jdGlvbiB0eXBlKCkge1xuICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5tb25rZXkpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoIWxlZnQgJiYgbGFzdCA9PSBcInJpZ2h0XCIpIHtcbiAgICAgICAgbGVmdCA9IHRydWU7XG4gICAgICAgIGxhc3QgPSBcImxlZnRcIjtcbiAgICB9XG4gICAgZWxzZSBpZiAoIXJpZ2h0KSB7XG4gICAgICAgIHJpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgbGFzdCA9IFwicmlnaHRcIjtcbiAgICB9XG4gICAgdXBkYXRlKCk7XG59XG5leHBvcnRzLnR5cGUgPSB0eXBlO1xuZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQubW9ua2V5KVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKGxlZnQpIHtcbiAgICAgICAgbGVmdCA9IGZhbHNlO1xuICAgIH1cbiAgICBlbHNlIGlmIChyaWdodCkge1xuICAgICAgICByaWdodCA9IGZhbHNlO1xuICAgIH1cbiAgICB1cGRhdGUoKTtcbn1cbmV4cG9ydHMuc3RvcCA9IHN0b3A7XG5mdW5jdGlvbiBzaG93KCkge1xuICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5tb25rZXkpXG4gICAgICAgIHJldHVybjtcbiAgICAkKFwiI21vbmtleVwiKVxuICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEyNSk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAkKFwiI21vbmtleVwiKVxuICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMTI1LCAoKSA9PiB7XG4gICAgICAgICQoXCIjbW9ua2V5XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNob3cgPSBleHBvcnRzLmhpZGUgPSB2b2lkIDA7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IG91dE9mRm9jdXNUaW1lb3V0cyA9IFtdO1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAkKFwiI3dvcmRzXCIpLmNzcyhcInRyYW5zaXRpb25cIiwgXCJub25lXCIpLnJlbW92ZUNsYXNzKFwiYmx1cnJlZFwiKTtcbiAgICAkKFwiLm91dE9mRm9jdXNXYXJuaW5nXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIE1pc2MuY2xlYXJUaW1lb3V0cyhvdXRPZkZvY3VzVGltZW91dHMpO1xufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgb3V0T2ZGb2N1c1RpbWVvdXRzLnB1c2goc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICQoXCIjd29yZHNcIikuY3NzKFwidHJhbnNpdGlvblwiLCBcIjAuMjVzXCIpLmFkZENsYXNzKFwiYmx1cnJlZFwiKTtcbiAgICAgICAgJChcIi5vdXRPZkZvY3VzV2FybmluZ1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9LCAxMDAwKSk7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zdGFydCA9IGV4cG9ydHMuaGFuZGxlU3BhY2UgPSBleHBvcnRzLnJlc2V0ID0gZXhwb3J0cy51cGRhdGUgPSBleHBvcnRzLmluaXQgPSBleHBvcnRzLnNldHRpbmdzID0gdm9pZCAwO1xuY29uc3QgVGVzdFN0YXRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtc3RhdHNcIikpO1xuY29uc3QgVGVzdFdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtd29yZHNcIikpO1xuY29uc3QgVGVzdFVJID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QtdWlcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xuY29uc3QgU2xvd1RpbWVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvc2xvdy10aW1lclwiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IFRlc3RBY3RpdmUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy90ZXN0LWFjdGl2ZVwiKSk7XG5jb25zdCBUZXN0U3RhdGUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC1zdGF0ZVwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmV4cG9ydHMuc2V0dGluZ3MgPSBudWxsO1xuZnVuY3Rpb24gcmVzZXRDYXJldFBvc2l0aW9uKCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5wYWNlQ2FyZXQgPT09IFwib2ZmXCIgJiYgIVRlc3RTdGF0ZS5pc1BhY2VSZXBlYXQpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoISQoXCIjcGFjZUNhcmV0XCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICQoXCIjcGFjZUNhcmV0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInplblwiKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgY2FyZXQgPSAkKFwiI3BhY2VDYXJldFwiKTtcbiAgICBjb25zdCBmaXJzdExldHRlciA9ICgoX2EgPSBkb2N1bWVudCA9PT0gbnVsbCB8fCBkb2N1bWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN3b3JkcyAud29yZFwiKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnF1ZXJ5U2VsZWN0b3IoXCJsZXR0ZXJcIikpO1xuICAgIGNvbnN0IGZpcnN0TGV0dGVySGVpZ2h0ID0gJChmaXJzdExldHRlcikuaGVpZ2h0KCk7XG4gICAgaWYgKGZpcnN0TGV0dGVyID09PSB1bmRlZmluZWQgfHwgZmlyc3RMZXR0ZXJIZWlnaHQgPT09IHVuZGVmaW5lZClcbiAgICAgICAgcmV0dXJuO1xuICAgIGNhcmV0LnN0b3AodHJ1ZSwgdHJ1ZSkuYW5pbWF0ZSh7XG4gICAgICAgIHRvcDogZmlyc3RMZXR0ZXIub2Zmc2V0VG9wIC0gZmlyc3RMZXR0ZXJIZWlnaHQgLyA0LFxuICAgICAgICBsZWZ0OiBmaXJzdExldHRlci5vZmZzZXRMZWZ0LFxuICAgIH0sIDAsIFwibGluZWFyXCIpO1xufVxuZnVuY3Rpb24gaW5pdCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAkKFwiI3BhY2VDYXJldFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgY29uc3QgbW9kZTIgPSBNaXNjLmdldE1vZGUyKGNvbmZpZ18xLmRlZmF1bHQsIFRlc3RXb3Jkcy5yYW5kb21RdW90ZSk7XG4gICAgICAgIGxldCB3cG07XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnBhY2VDYXJldCA9PT0gXCJwYlwiKSB7XG4gICAgICAgICAgICB3cG0gPSB5aWVsZCBEQi5nZXRMb2NhbFBCKGNvbmZpZ18xLmRlZmF1bHQubW9kZSwgbW9kZTIsIGNvbmZpZ18xLmRlZmF1bHQucHVuY3R1YXRpb24sIGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UsIGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSwgY29uZmlnXzEuZGVmYXVsdC5sYXp5TW9kZSwgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3gpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQucGFjZUNhcmV0ID09PSBcImF2ZXJhZ2VcIikge1xuICAgICAgICAgICAgW3dwbV0gPSB5aWVsZCBEQi5nZXRVc2VyQXZlcmFnZTEwKGNvbmZpZ18xLmRlZmF1bHQubW9kZSwgbW9kZTIsIGNvbmZpZ18xLmRlZmF1bHQucHVuY3R1YXRpb24sIGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UsIGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSwgY29uZmlnXzEuZGVmYXVsdC5sYXp5TW9kZSk7XG4gICAgICAgICAgICB3cG0gPSBNYXRoLnJvdW5kKHdwbSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5wYWNlQ2FyZXQgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgICAgIHdwbSA9IGNvbmZpZ18xLmRlZmF1bHQucGFjZUNhcmV0Q3VzdG9tU3BlZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoVGVzdFN0YXRlLmlzUGFjZVJlcGVhdCA9PSB0cnVlKSB7XG4gICAgICAgICAgICB3cG0gPSBUZXN0U3RhdHMubGFzdFRlc3RXcG07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHdwbSA9PT0gdW5kZWZpbmVkIHx8IHdwbSA8IDEgfHwgTnVtYmVyLmlzTmFOKHdwbSkpIHtcbiAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3MgPSBudWxsO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNoYXJhY3RlcnMgPSB3cG0gKiA1O1xuICAgICAgICBjb25zdCBjcHMgPSBjaGFyYWN0ZXJzIC8gNjA7IC8vY2hhcmFjdGVycyBwZXIgc3RlcFxuICAgICAgICBjb25zdCBzcGMgPSA2MCAvIGNoYXJhY3RlcnM7IC8vc2Vjb25kcyBwZXIgY2hhcmFjdGVyXG4gICAgICAgIGV4cG9ydHMuc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICB3cG06IHdwbSxcbiAgICAgICAgICAgIGNwczogY3BzLFxuICAgICAgICAgICAgc3BjOiBzcGMsXG4gICAgICAgICAgICBjb3JyZWN0aW9uOiAwLFxuICAgICAgICAgICAgY3VycmVudFdvcmRJbmRleDogMCxcbiAgICAgICAgICAgIGN1cnJlbnRMZXR0ZXJJbmRleDogLTEsXG4gICAgICAgICAgICB3b3Jkc1N0YXR1czoge30sXG4gICAgICAgICAgICB0aW1lb3V0OiBudWxsLFxuICAgICAgICB9O1xuICAgICAgICByZXNldENhcmV0UG9zaXRpb24oKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuaW5pdCA9IGluaXQ7XG5mdW5jdGlvbiB1cGRhdGUoZXhwZWN0ZWRTdGVwRW5kKSB7XG4gICAgaWYgKGV4cG9ydHMuc2V0dGluZ3MgPT09IG51bGwgfHwgIVRlc3RBY3RpdmUuZ2V0KCkgfHwgVGVzdFVJLnJlc3VsdFZpc2libGUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBpZiAoJChcIiNwYWNlQ2FyZXRcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAvLyAgICQoXCIjcGFjZUNhcmV0XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIC8vIH1cbiAgICB0cnkge1xuICAgICAgICBleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRMZXR0ZXJJbmRleCsrO1xuICAgICAgICBpZiAoZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50TGV0dGVySW5kZXggPj1cbiAgICAgICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5nZXQoZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50V29yZEluZGV4KS5sZW5ndGgpIHtcbiAgICAgICAgICAgIC8vZ28gdG8gdGhlIG5leHQgd29yZFxuICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50TGV0dGVySW5kZXggPSAtMTtcbiAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudFdvcmRJbmRleCsrO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUpIHtcbiAgICAgICAgICAgIGlmIChleHBvcnRzLnNldHRpbmdzLmNvcnJlY3Rpb24gPCAwKSB7XG4gICAgICAgICAgICAgICAgd2hpbGUgKGV4cG9ydHMuc2V0dGluZ3MuY29ycmVjdGlvbiA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50TGV0dGVySW5kZXgtLTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudExldHRlckluZGV4IDw9IC0yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2dvIHRvIHRoZSBwcmV2aW91cyB3b3JkXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRMZXR0ZXJJbmRleCA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVGVzdFdvcmRzLndvcmRzLmdldChleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRXb3JkSW5kZXggLSAxKS5sZW5ndGggLSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50V29yZEluZGV4LS07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy5jb3JyZWN0aW9uKys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZXhwb3J0cy5zZXR0aW5ncy5jb3JyZWN0aW9uID4gMCkge1xuICAgICAgICAgICAgICAgIHdoaWxlIChleHBvcnRzLnNldHRpbmdzLmNvcnJlY3Rpb24gPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudExldHRlckluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgIGlmIChleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRMZXR0ZXJJbmRleCA+PVxuICAgICAgICAgICAgICAgICAgICAgICAgVGVzdFdvcmRzLndvcmRzLmdldChleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRXb3JkSW5kZXgpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9nbyB0byB0aGUgbmV4dCB3b3JkXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRMZXR0ZXJJbmRleCA9IC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy5jdXJyZW50V29yZEluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy5jb3JyZWN0aW9uLS07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIC8vb3V0IG9mIHdvcmRzXG4gICAgICAgIGV4cG9ydHMuc2V0dGluZ3MgPSBudWxsO1xuICAgICAgICAkKFwiI3BhY2VDYXJldFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjYXJldCA9ICQoXCIjcGFjZUNhcmV0XCIpO1xuICAgICAgICBsZXQgY3VycmVudExldHRlcjtcbiAgICAgICAgbGV0IG5ld1RvcDtcbiAgICAgICAgbGV0IG5ld0xlZnQ7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBuZXdJbmRleCA9IGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudFdvcmRJbmRleCAtXG4gICAgICAgICAgICAgICAgKFRlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXggLSBUZXN0VUkuY3VycmVudFdvcmRFbGVtZW50SW5kZXgpO1xuICAgICAgICAgICAgY29uc3Qgd29yZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIjd29yZHMgLndvcmRcIilbbmV3SW5kZXhdO1xuICAgICAgICAgICAgaWYgKGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudExldHRlckluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRMZXR0ZXIgPSB3b3JkLnF1ZXJ5U2VsZWN0b3JBbGwoXCJsZXR0ZXJcIilbMF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50TGV0dGVyID0gKHdvcmQucXVlcnlTZWxlY3RvckFsbChcImxldHRlclwiKVtleHBvcnRzLnNldHRpbmdzLmN1cnJlbnRMZXR0ZXJJbmRleF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgY3VycmVudExldHRlckhlaWdodCA9ICQoY3VycmVudExldHRlcikuaGVpZ2h0KCksIGN1cnJlbnRMZXR0ZXJXaWR0aCA9ICQoY3VycmVudExldHRlcikud2lkdGgoKSwgY2FyZXRXaWR0aCA9IGNhcmV0LndpZHRoKCk7XG4gICAgICAgICAgICBpZiAoY3VycmVudExldHRlckhlaWdodCA9PT0gdW5kZWZpbmVkIHx8XG4gICAgICAgICAgICAgICAgY3VycmVudExldHRlcldpZHRoID09PSB1bmRlZmluZWQgfHxcbiAgICAgICAgICAgICAgICBjYXJldFdpZHRoID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBgYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5ld1RvcCA9IGN1cnJlbnRMZXR0ZXIub2Zmc2V0VG9wIC0gY3VycmVudExldHRlckhlaWdodCAvIDU7XG4gICAgICAgICAgICBuZXdMZWZ0O1xuICAgICAgICAgICAgaWYgKGV4cG9ydHMuc2V0dGluZ3MuY3VycmVudExldHRlckluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgICAgIG5ld0xlZnQgPSBjdXJyZW50TGV0dGVyLm9mZnNldExlZnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBuZXdMZWZ0ID1cbiAgICAgICAgICAgICAgICAgICAgY3VycmVudExldHRlci5vZmZzZXRMZWZ0ICsgY3VycmVudExldHRlcldpZHRoIC0gY2FyZXRXaWR0aCAvIDI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXJldC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY2FyZXQuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZHVyYXRpb24gPSBleHBlY3RlZFN0ZXBFbmQgLSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgaWYgKG5ld1RvcCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBsZXQgc21vb3RobGluZXNjcm9sbCA9ICQoXCIjd29yZHMgLnNtb290aFNjcm9sbGVyXCIpLmhlaWdodCgpO1xuICAgICAgICAgICAgaWYgKHNtb290aGxpbmVzY3JvbGwgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICBzbW9vdGhsaW5lc2Nyb2xsID0gMDtcbiAgICAgICAgICAgICQoXCIjcGFjZUNhcmV0XCIpLmNzcyh7XG4gICAgICAgICAgICAgICAgdG9wOiBuZXdUb3AgLSBzbW9vdGhsaW5lc2Nyb2xsLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zbW9vdGhDYXJldCkge1xuICAgICAgICAgICAgICAgIGNhcmV0LnN0b3AodHJ1ZSwgdHJ1ZSkuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IG5ld0xlZnQsXG4gICAgICAgICAgICAgICAgfSwgU2xvd1RpbWVyLmdldCgpID8gMCA6IGR1cmF0aW9uLCBcImxpbmVhclwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNhcmV0LnN0b3AodHJ1ZSwgdHJ1ZSkuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IG5ld0xlZnQsXG4gICAgICAgICAgICAgICAgfSwgMCwgXCJsaW5lYXJcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy50aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHVwZGF0ZShleHBlY3RlZFN0ZXBFbmQgKyAoKF9hID0gZXhwb3J0cy5zZXR0aW5ncyA9PT0gbnVsbCB8fCBleHBvcnRzLnNldHRpbmdzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBleHBvcnRzLnNldHRpbmdzLnNwYykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogMCkgKiAxMDAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncyA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGR1cmF0aW9uKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgJChcIiNwYWNlQ2FyZXRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxufVxuZXhwb3J0cy51cGRhdGUgPSB1cGRhdGU7XG5mdW5jdGlvbiByZXNldCgpIHtcbiAgICBpZiAoZXhwb3J0cy5zZXR0aW5ncyAhPT0gbnVsbCAmJiBleHBvcnRzLnNldHRpbmdzLnRpbWVvdXQgIT09IG51bGwpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KGV4cG9ydHMuc2V0dGluZ3MudGltZW91dCk7XG4gICAgfVxuICAgIGV4cG9ydHMuc2V0dGluZ3MgPSBudWxsO1xufVxuZXhwb3J0cy5yZXNldCA9IHJlc2V0O1xuZnVuY3Rpb24gaGFuZGxlU3BhY2UoY29ycmVjdCwgY3VycmVudFdvcmQpIHtcbiAgICBpZiAoY29ycmVjdCkge1xuICAgICAgICBpZiAoZXhwb3J0cy5zZXR0aW5ncyAhPT0gbnVsbCAmJlxuICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy53b3Jkc1N0YXR1c1tUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4XSA9PT0gdHJ1ZSAmJlxuICAgICAgICAgICAgIWNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlKSB7XG4gICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzLndvcmRzU3RhdHVzW1Rlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXhdID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy5jb3JyZWN0aW9uIC09IGN1cnJlbnRXb3JkLmxlbmd0aCArIDE7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChleHBvcnRzLnNldHRpbmdzICE9PSBudWxsICYmXG4gICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzLndvcmRzU3RhdHVzW1Rlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXhdID09PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgICFjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSkge1xuICAgICAgICAgICAgZXhwb3J0cy5zZXR0aW5ncy53b3Jkc1N0YXR1c1tUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4XSA9IHRydWU7XG4gICAgICAgICAgICBleHBvcnRzLnNldHRpbmdzLmNvcnJlY3Rpb24gKz0gY3VycmVudFdvcmQubGVuZ3RoICsgMTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMuaGFuZGxlU3BhY2UgPSBoYW5kbGVTcGFjZTtcbmZ1bmN0aW9uIHN0YXJ0KCkge1xuICAgIHZhciBfYTtcbiAgICB1cGRhdGUocGVyZm9ybWFuY2Uubm93KCkgKyAoKF9hID0gZXhwb3J0cy5zZXR0aW5ncyA9PT0gbnVsbCB8fCBleHBvcnRzLnNldHRpbmdzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBleHBvcnRzLnNldHRpbmdzLnNwYykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogMCkgKiAxMDAwKTtcbn1cbmV4cG9ydHMuc3RhcnQgPSBzdGFydDtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXkpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwicGFjZUNhcmV0XCIpXG4gICAgICAgIGluaXQoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNob3cgPSBleHBvcnRzLmhpZGUgPSB2b2lkIDA7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC5jcm93blwiKS5jc3MoXCJvcGFjaXR5XCIsIDApLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLmNyb3duXCIpXG4gICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCBcIjBcIilcbiAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiAxLFxuICAgIH0sIDI1MCwgXCJlYXNlT3V0Q3ViaWNcIik7XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZ2V0UG9lbSA9IGV4cG9ydHMuUG9lbSA9IHZvaWQgMDtcbmNvbnN0IGF4aW9zXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImF4aW9zXCIpKTtcbmNvbnN0IGJhbm5lZENoYXJzID0gW1wi4oCUXCIsIFwiX1wiLCBcIiBcIl07XG5jb25zdCBtYXhXb3JkcyA9IDEwMDtcbmNvbnN0IGFwaVVSTCA9IFwiaHR0cHM6Ly9wb2V0cnlkYi5vcmcvcmFuZG9tXCI7XG5jbGFzcyBQb2VtIHtcbiAgICBjb25zdHJ1Y3Rvcih0aXRsZSwgYXV0aG9yLCB3b3Jkcykge1xuICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgICAgIHRoaXMuYXV0aG9yID0gYXV0aG9yO1xuICAgICAgICB0aGlzLndvcmRzID0gd29yZHM7XG4gICAgICAgIHRoaXMuY2xlYW5VcFRleHQoKTtcbiAgICB9XG4gICAgY2xlYW5VcFRleHQoKSB7XG4gICAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICAgIGNvbnN0IHNjcnViYmVkV29yZHMgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLndvcmRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgc2NydWJiZWQgPSBcIlwiO1xuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLndvcmRzW2ldLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFiYW5uZWRDaGFycy5pbmNsdWRlcyh0aGlzLndvcmRzW2ldW2pdKSkge1xuICAgICAgICAgICAgICAgICAgICBzY3J1YmJlZCArPSB0aGlzLndvcmRzW2ldW2pdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzY3J1YmJlZCA9PSBcIlwiKVxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgc2NydWJiZWRXb3Jkcy5wdXNoKHNjcnViYmVkKTtcbiAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgICAgICBpZiAoY291bnQgPT0gbWF4V29yZHMpXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy53b3JkcyA9IHNjcnViYmVkV29yZHM7XG4gICAgfVxufVxuZXhwb3J0cy5Qb2VtID0gUG9lbTtcbmZ1bmN0aW9uIGdldFBvZW0oKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJHZXR0aW5nIHBvZW1cIik7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXhpb3NfMS5kZWZhdWx0LmdldChhcGlVUkwpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcG9lbU9iaiA9IHJlc3BvbnNlLmRhdGFbMF07XG4gICAgICAgICAgICBjb25zdCB3b3JkcyA9IFtdO1xuICAgICAgICAgICAgcG9lbU9iai5saW5lcy5mb3JFYWNoKChsaW5lKSA9PiB7XG4gICAgICAgICAgICAgICAgbGluZS5zcGxpdCgvICsvKS5mb3JFYWNoKCh3b3JkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHdvcmRzLnB1c2god29yZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUG9lbShwb2VtT2JqLnRpdGxlLCBwb2VtT2JqLmF1dGhvciwgd29yZHMpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgfSk7XG59XG5leHBvcnRzLmdldFBvZW0gPSBnZXRQb2VtO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGlkZVBvcHVwID0gZXhwb3J0cy5zaG93UG9wdXAgPSBleHBvcnRzLnJlc2V0QmVmb3JlID0gZXhwb3J0cy5pbml0ID0gZXhwb3J0cy5iZWZvcmUgPSB2b2lkIDA7XG5jb25zdCBUZXN0V29yZHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC13b3Jkc1wiKSk7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpLCBVcGRhdGVDb25maWcgPSBjb25maWdfMTtcbmNvbnN0IEN1c3RvbVRleHQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY3VzdG9tLXRleHRcIikpO1xuY29uc3QgVGVzdElucHV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QtaW5wdXRcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5leHBvcnRzLmJlZm9yZSA9IHtcbiAgICBtb2RlOiBudWxsLFxuICAgIHB1bmN0dWF0aW9uOiBudWxsLFxuICAgIG51bWJlcnM6IG51bGwsXG59O1xuZnVuY3Rpb24gaW5pdChtaXNzZWQsIHNsb3cpIHtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInplblwiKVxuICAgICAgICByZXR1cm47XG4gICAgbGV0IGxpbWl0O1xuICAgIGlmICgobWlzc2VkICYmICFzbG93KSB8fCAoIW1pc3NlZCAmJiBzbG93KSkge1xuICAgICAgICBsaW1pdCA9IDIwO1xuICAgIH1cbiAgICBlbHNlIGlmIChtaXNzZWQgJiYgc2xvdykge1xuICAgICAgICBsaW1pdCA9IDEwO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgbGltaXQgPSAxMDtcbiAgICB9XG4gICAgbGV0IHNvcnRhYmxlTWlzc2VkV29yZHMgPSBbXTtcbiAgICBpZiAobWlzc2VkKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKFRlc3RJbnB1dC5taXNzZWRXb3JkcykuZm9yRWFjaCgobWlzc2VkV29yZCkgPT4ge1xuICAgICAgICAgICAgc29ydGFibGVNaXNzZWRXb3Jkcy5wdXNoKFttaXNzZWRXb3JkLCBUZXN0SW5wdXQubWlzc2VkV29yZHNbbWlzc2VkV29yZF1dKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHNvcnRhYmxlTWlzc2VkV29yZHMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGJbMV0gLSBhWzFdO1xuICAgICAgICB9KTtcbiAgICAgICAgc29ydGFibGVNaXNzZWRXb3JkcyA9IHNvcnRhYmxlTWlzc2VkV29yZHMuc2xpY2UoMCwgbGltaXQpO1xuICAgIH1cbiAgICBpZiAobWlzc2VkICYmICFzbG93ICYmIHNvcnRhYmxlTWlzc2VkV29yZHMubGVuZ3RoID09IDApIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJZb3UgaGF2ZW4ndCBtaXNzZWQgYW55IHdvcmRzXCIsIDApO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCBzb3J0YWJsZVNsb3dXb3JkcyA9IFtdO1xuICAgIGlmIChzbG93KSB7XG4gICAgICAgIHNvcnRhYmxlU2xvd1dvcmRzID0gVGVzdFdvcmRzLndvcmRzLmdldCgpLm1hcCgoZSwgaSkgPT4gW1xuICAgICAgICAgICAgZSxcbiAgICAgICAgICAgIFRlc3RJbnB1dC5idXJzdEhpc3RvcnlbaV0sXG4gICAgICAgIF0pO1xuICAgICAgICBzb3J0YWJsZVNsb3dXb3Jkcy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYVsxXSAtIGJbMV07XG4gICAgICAgIH0pO1xuICAgICAgICBzb3J0YWJsZVNsb3dXb3JkcyA9IHNvcnRhYmxlU2xvd1dvcmRzLnNsaWNlKDAsIE1hdGgubWluKGxpbWl0LCBNYXRoLnJvdW5kKFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGggKiAwLjIpKSk7XG4gICAgfVxuICAgIC8vIGNvbnNvbGUubG9nKHNvcnRhYmxlTWlzc2VkV29yZHMpO1xuICAgIC8vIGNvbnNvbGUubG9nKHNvcnRhYmxlU2xvd1dvcmRzKTtcbiAgICBpZiAoc29ydGFibGVNaXNzZWRXb3Jkcy5sZW5ndGggPT0gMCAmJiBzb3J0YWJsZVNsb3dXb3Jkcy5sZW5ndGggPT0gMCkge1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkNvdWxkIG5vdCBzdGFydCBhIG5ldyBjdXN0b20gdGVzdFwiLCAwKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBuZXdDdXN0b21UZXh0ID0gW107XG4gICAgc29ydGFibGVNaXNzZWRXb3Jkcy5mb3JFYWNoKChtaXNzZWQpID0+IHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtaXNzZWRbMV07IGkrKykge1xuICAgICAgICAgICAgbmV3Q3VzdG9tVGV4dC5wdXNoKG1pc3NlZFswXSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBzb3J0YWJsZVNsb3dXb3Jkcy5mb3JFYWNoKChzbG93LCBpbmRleCkgPT4ge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNvcnRhYmxlU2xvd1dvcmRzLmxlbmd0aCAtIGluZGV4OyBpKyspIHtcbiAgICAgICAgICAgIG5ld0N1c3RvbVRleHQucHVzaChzbG93WzBdKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIC8vIGNvbnNvbGUubG9nKG5ld0N1c3RvbVRleHQpO1xuICAgIGNvbnN0IG1vZGUgPSBleHBvcnRzLmJlZm9yZS5tb2RlID09PSBudWxsID8gY29uZmlnXzEuZGVmYXVsdC5tb2RlIDogZXhwb3J0cy5iZWZvcmUubW9kZTtcbiAgICBjb25zdCBwdW5jdHVhdGlvbiA9IGV4cG9ydHMuYmVmb3JlLnB1bmN0dWF0aW9uID09PSBudWxsID8gY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbiA6IGV4cG9ydHMuYmVmb3JlLnB1bmN0dWF0aW9uO1xuICAgIGNvbnN0IG51bWJlcnMgPSBleHBvcnRzLmJlZm9yZS5udW1iZXJzID09PSBudWxsID8gY29uZmlnXzEuZGVmYXVsdC5udW1iZXJzIDogZXhwb3J0cy5iZWZvcmUubnVtYmVycztcbiAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcImN1c3RvbVwiKTtcbiAgICBDdXN0b21UZXh0LnNldFRleHQobmV3Q3VzdG9tVGV4dCk7XG4gICAgQ3VzdG9tVGV4dC5zZXRJc1dvcmRSYW5kb20odHJ1ZSk7XG4gICAgQ3VzdG9tVGV4dC5zZXRXb3JkKChzb3J0YWJsZVNsb3dXb3Jkcy5sZW5ndGggKyBzb3J0YWJsZU1pc3NlZFdvcmRzLmxlbmd0aCkgKiA1KTtcbiAgICBDdXN0b21UZXh0LnNldFRpbWUoLTEpO1xuICAgIGV4cG9ydHMuYmVmb3JlLm1vZGUgPSBtb2RlO1xuICAgIGV4cG9ydHMuYmVmb3JlLnB1bmN0dWF0aW9uID0gcHVuY3R1YXRpb247XG4gICAgZXhwb3J0cy5iZWZvcmUubnVtYmVycyA9IG51bWJlcnM7XG59XG5leHBvcnRzLmluaXQgPSBpbml0O1xuZnVuY3Rpb24gcmVzZXRCZWZvcmUoKSB7XG4gICAgZXhwb3J0cy5iZWZvcmUubW9kZSA9IG51bGw7XG4gICAgZXhwb3J0cy5iZWZvcmUucHVuY3R1YXRpb24gPSBudWxsO1xuICAgIGV4cG9ydHMuYmVmb3JlLm51bWJlcnMgPSBudWxsO1xufVxuZXhwb3J0cy5yZXNldEJlZm9yZSA9IHJlc2V0QmVmb3JlO1xuZnVuY3Rpb24gc2hvd1BvcHVwKGZvY3VzID0gZmFsc2UpIHtcbiAgICBpZiAoJChcIiNwcmFjdGlzZVdvcmRzUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiemVuXCIpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUHJhY3RpY2Ugd29yZHMgaXMgdW5zdXBwb3J0ZWQgaW4gemVuIG1vZGVcIiwgMCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgJChcIiNwcmFjdGlzZVdvcmRzUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGZvY3VzKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJmb2N1c2luZ1wiKTtcbiAgICAgICAgICAgICAgICAkKFwiI3ByYWN0aXNlV29yZHNQb3B1cCAubWlzc2VkXCIpLnRyaWdnZXIoXCJmb2N1c1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5zaG93UG9wdXAgPSBzaG93UG9wdXA7XG5mdW5jdGlvbiBoaWRlUG9wdXAoKSB7XG4gICAgaWYgKCEkKFwiI3ByYWN0aXNlV29yZHNQb3B1cFdyYXBwZXJcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgJChcIiNwcmFjdGlzZVdvcmRzUG9wdXBXcmFwcGVyXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIDEwMCwgKCkgPT4ge1xuICAgICAgICAgICAgJChcIiNwcmFjdGlzZVdvcmRzUG9wdXBXcmFwcGVyXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLmhpZGVQb3B1cCA9IGhpZGVQb3B1cDtcbiQoXCIjcHJhY3Rpc2VXb3Jkc1BvcHVwV3JhcHBlclwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgaWYgKCQoZS50YXJnZXQpLmF0dHIoXCJpZFwiKSA9PT0gXCJwcmFjdGlzZVdvcmRzUG9wdXBXcmFwcGVyXCIpIHtcbiAgICAgICAgaGlkZVBvcHVwKCk7XG4gICAgfVxufSk7XG4kKFwiI3ByYWN0aXNlV29yZHNQb3B1cCAuYnV0dG9uXCIpLm9uKFwia2V5cHJlc3NcIiwgKGUpID0+IHtcbiAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICAkKGUuY3VycmVudFRhcmdldCkuY2xpY2soKTtcbiAgICB9XG59KTtcbiQoXCIjcHJhY3Rpc2VXb3Jkc1BvcHVwIC5idXR0b24uYm90aFwiKS5vbihcImZvY3Vzb3V0XCIsIChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICQoXCIjcHJhY3Rpc2VXb3Jkc1BvcHVwIC5taXNzZWRcIikudHJpZ2dlcihcImZvY3VzXCIpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImtleWRvd25cIiwgKGV2ZW50KSA9PiB7XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFc2NhcGVcIiAmJlxuICAgICAgICAhJChcIiNwcmFjdGlzZVdvcmRzUG9wdXBXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIGhpZGVQb3B1cCgpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudCkub24oXCJrZXlwcmVzc1wiLCBcIiNwcmFjdGlzZVdvcmRzQnV0dG9uXCIsIChldmVudCkgPT4ge1xuICAgIGlmIChldmVudC5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICBzaG93UG9wdXAodHJ1ZSk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIjcHJhY3Rpc2VXb3Jkc0J1dHRvblwiLCAoKSA9PiB7XG4gICAgc2hvd1BvcHVwKCk7XG59KTtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXkpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwibW9kZVwiKVxuICAgICAgICByZXNldEJlZm9yZSgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xudmFyIF9hO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5nZXRSZXBsYXlFeHBvcnQgPSBleHBvcnRzLnJlcGxheUdldFdvcmRzTGlzdCA9IGV4cG9ydHMuYWRkUmVwbGF5RXZlbnQgPSBleHBvcnRzLnN0b3BSZXBsYXlSZWNvcmRpbmcgPSBleHBvcnRzLnN0YXJ0UmVwbGF5UmVjb3JkaW5nID0gZXhwb3J0cy5wYXVzZVJlcGxheSA9IHZvaWQgMDtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgU291bmQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL3NvdW5kLWNvbnRyb2xsZXJcIikpO1xubGV0IHdvcmRzTGlzdCA9IFtdO1xubGV0IHJlcGxheURhdGEgPSBbXTtcbmxldCByZXBsYXlTdGFydFRpbWUgPSAwO1xubGV0IHJlcGxheVJlY29yZGluZyA9IHRydWU7XG5sZXQgd29yZFBvcyA9IDA7XG5sZXQgY3VyUG9zID0gMDtcbmxldCB0YXJnZXRXb3JkUG9zID0gMDtcbmxldCB0YXJnZXRDdXJQb3MgPSAwO1xubGV0IHRpbWVvdXRMaXN0ID0gW107XG5sZXQgc3RvcHdhdGNoTGlzdCA9IFtdO1xuY29uc3QgdG9nZ2xlQnV0dG9uID0gKF9hID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwbGF5cGF1c2VSZXBsYXlCdXR0b25cIikpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jaGlsZHJlblswXTtcbmZ1bmN0aW9uIHJlcGxheUdldFdvcmRzTGlzdCh3b3Jkc0xpc3RGcm9tU2NyaXB0KSB7XG4gICAgd29yZHNMaXN0ID0gd29yZHNMaXN0RnJvbVNjcmlwdDtcbn1cbmV4cG9ydHMucmVwbGF5R2V0V29yZHNMaXN0ID0gcmVwbGF5R2V0V29yZHNMaXN0O1xuZnVuY3Rpb24gaW5pdGlhbGl6ZVJlcGxheVByb21wdCgpIHtcbiAgICBjb25zdCByZXBsYXlXb3Jkc0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlcGxheVdvcmRzXCIpO1xuICAgIGlmIChyZXBsYXlXb3Jkc0VsZW1lbnQgPT09IG51bGwpXG4gICAgICAgIHJldHVybjtcbiAgICByZXBsYXlXb3Jkc0VsZW1lbnQuaW5uZXJIVE1MID0gXCJcIjtcbiAgICBsZXQgd29yZENvdW50ID0gMDtcbiAgICByZXBsYXlEYXRhLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgLy90cmltIHdvcmRzTGlzdCBmb3IgdGltZWQgdGVzdHNcbiAgICAgICAgaWYgKGl0ZW0uYWN0aW9uID09PSBcImJhY2tXb3JkXCIpIHtcbiAgICAgICAgICAgIHdvcmRDb3VudC0tO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGl0ZW0uYWN0aW9uID09PSBcInN1Ym1pdENvcnJlY3RXb3JkXCIgfHxcbiAgICAgICAgICAgIGl0ZW0uYWN0aW9uID09PSBcInN1Ym1pdEVycm9yV29yZFwiKSB7XG4gICAgICAgICAgICB3b3JkQ291bnQrKztcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHdvcmRzTGlzdC5mb3JFYWNoKChpdGVtLCBpKSA9PiB7XG4gICAgICAgIGlmIChpID4gd29yZENvdW50KVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCB4ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgeC5jbGFzc05hbWUgPSBcIndvcmRcIjtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGl0ZW0ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGxldHRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsZXR0ZXJcIik7XG4gICAgICAgICAgICBsZXR0ZXIuaW5uZXJIVE1MID0gaXRlbVtpXTtcbiAgICAgICAgICAgIHguYXBwZW5kQ2hpbGQobGV0dGVyKTtcbiAgICAgICAgfVxuICAgICAgICByZXBsYXlXb3Jkc0VsZW1lbnQuYXBwZW5kQ2hpbGQoeCk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBwYXVzZVJlcGxheSgpIHtcbiAgICB2YXIgX2E7XG4gICAgdGltZW91dExpc3QuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBjbGVhclRpbWVvdXQoaXRlbSk7XG4gICAgfSk7XG4gICAgdGltZW91dExpc3QgPSBbXTtcbiAgICBzdG9wd2F0Y2hMaXN0LmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KGl0ZW0pO1xuICAgIH0pO1xuICAgIHN0b3B3YXRjaExpc3QgPSBbXTtcbiAgICB0YXJnZXRDdXJQb3MgPSBjdXJQb3M7XG4gICAgdGFyZ2V0V29yZFBvcyA9IHdvcmRQb3M7XG4gICAgaWYgKHRvZ2dsZUJ1dHRvbiA9PT0gdW5kZWZpbmVkKVxuICAgICAgICByZXR1cm47XG4gICAgdG9nZ2xlQnV0dG9uLmNsYXNzTmFtZSA9IFwiZmFzIGZhLXBsYXlcIjtcbiAgICAoX2EgPSB0b2dnbGVCdXR0b24ucGFyZW50Tm9kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgXCJSZXN1bWUgcmVwbGF5XCIpO1xufVxuZXhwb3J0cy5wYXVzZVJlcGxheSA9IHBhdXNlUmVwbGF5O1xuZnVuY3Rpb24gcGxheVNvdW5kKGVycm9yID0gZmFsc2UpIHtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucGxheVNvdW5kT25FcnJvcikge1xuICAgICAgICAgICAgU291bmQucGxheUVycm9yKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBTb3VuZC5wbGF5Q2xpY2soKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgU291bmQucGxheUNsaWNrKCk7XG4gICAgfVxufVxuZnVuY3Rpb24gaGFuZGxlRGlzcGxheUxvZ2ljKGl0ZW0sIG5vc291bmQgPSBmYWxzZSkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIGxldCBhY3RpdmVXb3JkID0gKF9hID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXBsYXlXb3Jkc1wiKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNoaWxkcmVuW3dvcmRQb3NdO1xuICAgIGlmIChhY3RpdmVXb3JkID09PSB1bmRlZmluZWQpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoaXRlbS5hY3Rpb24gPT09IFwiY29ycmVjdExldHRlclwiKSB7XG4gICAgICAgIGlmICghbm9zb3VuZClcbiAgICAgICAgICAgIHBsYXlTb3VuZCgpO1xuICAgICAgICBhY3RpdmVXb3JkLmNoaWxkcmVuW2N1clBvc10uY2xhc3NMaXN0LmFkZChcImNvcnJlY3RcIik7XG4gICAgICAgIGN1clBvcysrO1xuICAgIH1cbiAgICBlbHNlIGlmIChpdGVtLmFjdGlvbiA9PT0gXCJpbmNvcnJlY3RMZXR0ZXJcIikge1xuICAgICAgICBpZiAoIW5vc291bmQpXG4gICAgICAgICAgICBwbGF5U291bmQodHJ1ZSk7XG4gICAgICAgIGxldCBteUVsZW1lbnQ7XG4gICAgICAgIGlmIChjdXJQb3MgPj0gYWN0aXZlV29yZC5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgICAgIC8vaWYgbGV0dGVyIGlzIGFuIGV4dHJhXG4gICAgICAgICAgICBteUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGV0dGVyXCIpO1xuICAgICAgICAgICAgbXlFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJleHRyYVwiKTtcbiAgICAgICAgICAgIG15RWxlbWVudC5pbm5lckhUTUwgPSAoX2MgPSAoX2IgPSBpdGVtLnZhbHVlKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudG9TdHJpbmcoKSkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogXCJcIjtcbiAgICAgICAgICAgIGFjdGl2ZVdvcmQuYXBwZW5kQ2hpbGQobXlFbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgICBteUVsZW1lbnQgPSBhY3RpdmVXb3JkLmNoaWxkcmVuW2N1clBvc107XG4gICAgICAgIG15RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiaW5jb3JyZWN0XCIpO1xuICAgICAgICBjdXJQb3MrKztcbiAgICB9XG4gICAgZWxzZSBpZiAoaXRlbS5hY3Rpb24gPT09IFwic2V0TGV0dGVySW5kZXhcIiAmJlxuICAgICAgICB0eXBlb2YgaXRlbS52YWx1ZSA9PT0gXCJudW1iZXJcIikge1xuICAgICAgICBpZiAoIW5vc291bmQpXG4gICAgICAgICAgICBwbGF5U291bmQoKTtcbiAgICAgICAgY3VyUG9zID0gaXRlbS52YWx1ZTtcbiAgICAgICAgLy8gcmVtb3ZlIGFsbCBsZXR0ZXJzIGZyb20gY3Vyc29yIHRvIGVuZCBvZiB3b3JkXG4gICAgICAgIGZvciAoY29uc3QgbXlFbGVtZW50IG9mIFsuLi5hY3RpdmVXb3JkLmNoaWxkcmVuXS5zbGljZShjdXJQb3MpKSB7XG4gICAgICAgICAgICBpZiAobXlFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhcImV4dHJhXCIpKSB7XG4gICAgICAgICAgICAgICAgbXlFbGVtZW50LnJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbXlFbGVtZW50LmNsYXNzTmFtZSA9IFwiXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoaXRlbS5hY3Rpb24gPT09IFwic3VibWl0Q29ycmVjdFdvcmRcIikge1xuICAgICAgICBpZiAoIW5vc291bmQpXG4gICAgICAgICAgICBwbGF5U291bmQoKTtcbiAgICAgICAgd29yZFBvcysrO1xuICAgICAgICBjdXJQb3MgPSAwO1xuICAgIH1cbiAgICBlbHNlIGlmIChpdGVtLmFjdGlvbiA9PT0gXCJzdWJtaXRFcnJvcldvcmRcIikge1xuICAgICAgICBpZiAoIW5vc291bmQpXG4gICAgICAgICAgICBwbGF5U291bmQodHJ1ZSk7XG4gICAgICAgIGFjdGl2ZVdvcmQuY2xhc3NMaXN0LmFkZChcImVycm9yXCIpO1xuICAgICAgICB3b3JkUG9zKys7XG4gICAgICAgIGN1clBvcyA9IDA7XG4gICAgfVxuICAgIGVsc2UgaWYgKGl0ZW0uYWN0aW9uID09PSBcImJhY2tXb3JkXCIpIHtcbiAgICAgICAgaWYgKCFub3NvdW5kKVxuICAgICAgICAgICAgcGxheVNvdW5kKCk7XG4gICAgICAgIHdvcmRQb3MtLTtcbiAgICAgICAgY29uc3QgcmVwbGF5V29yZHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlcGxheVdvcmRzXCIpO1xuICAgICAgICBpZiAocmVwbGF5V29yZHMgIT09IG51bGwpXG4gICAgICAgICAgICBhY3RpdmVXb3JkID0gcmVwbGF5V29yZHMuY2hpbGRyZW5bd29yZFBvc107XG4gICAgICAgIGN1clBvcyA9IGFjdGl2ZVdvcmQuY2hpbGRyZW4ubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoYWN0aXZlV29yZC5jaGlsZHJlbltjdXJQb3MgLSAxXS5jbGFzc05hbWUgPT09IFwiXCIpXG4gICAgICAgICAgICBjdXJQb3MtLTtcbiAgICAgICAgYWN0aXZlV29yZC5jbGFzc0xpc3QucmVtb3ZlKFwiZXJyb3JcIik7XG4gICAgfVxufVxuZnVuY3Rpb24gbG9hZE9sZFJlcGxheSgpIHtcbiAgICBsZXQgc3RhcnRpbmdJbmRleCA9IDA7XG4gICAgY3VyUG9zID0gMDtcbiAgICB3b3JkUG9zID0gMDtcbiAgICByZXBsYXlEYXRhLmZvckVhY2goKGl0ZW0sIGkpID0+IHtcbiAgICAgICAgaWYgKHdvcmRQb3MgPCB0YXJnZXRXb3JkUG9zIHx8XG4gICAgICAgICAgICAod29yZFBvcyA9PT0gdGFyZ2V0V29yZFBvcyAmJiBjdXJQb3MgPCB0YXJnZXRDdXJQb3MpKSB7XG4gICAgICAgICAgICAvL3F1aWNrbHkgZGlzcGxheSBldmVyeXRoaW5nIHVwIHRvIHRoZSB0YXJnZXRcbiAgICAgICAgICAgIGhhbmRsZURpc3BsYXlMb2dpYyhpdGVtLCB0cnVlKTtcbiAgICAgICAgICAgIHN0YXJ0aW5nSW5kZXggPSBpICsgMTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGNvbnN0IHRpbWUgPSBNYXRoLmZsb29yKHJlcGxheURhdGFbc3RhcnRpbmdJbmRleF0udGltZSAvIDEwMDApO1xuICAgICQoXCIjcmVwbGF5U3RvcHdhdGNoXCIpLnRleHQodGltZSArIFwic1wiKTtcbiAgICByZXR1cm4gc3RhcnRpbmdJbmRleDtcbn1cbmZ1bmN0aW9uIHRvZ2dsZVJlcGxheURpc3BsYXkoKSB7XG4gICAgdmFyIF9hO1xuICAgIGlmICgkKFwiI3Jlc3VsdFJlcGxheVwiKS5zdG9wKHRydWUsIHRydWUpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIGluaXRpYWxpemVSZXBsYXlQcm9tcHQoKTtcbiAgICAgICAgbG9hZE9sZFJlcGxheSgpO1xuICAgICAgICAvL3Nob3dcbiAgICAgICAgaWYgKCEkKFwiI3dhdGNoUmVwbGF5QnV0dG9uXCIpLmhhc0NsYXNzKFwibG9hZGVkXCIpKSB7XG4gICAgICAgICAgICAkKFwiI3dvcmRzXCIpLmh0bWwoYDxkaXYgY2xhc3M9XCJwcmVsb2FkZXJcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1zcGluIGZhLWNpcmNsZS1ub3RjaFwiPjwvaT48L2Rpdj5gKTtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0UmVwbGF5XCIpXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAgICAgLmNzcyhcImRpc3BsYXlcIiwgXCJub25lXCIpXG4gICAgICAgICAgICAgICAgLnNsaWRlRG93bigyNTApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIiNyZXN1bHRSZXBsYXlcIilcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgICAgICAuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIilcbiAgICAgICAgICAgICAgICAuc2xpZGVEb3duKDI1MCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vaGlkZVxuICAgICAgICBpZiAoKChfYSA9IHRvZ2dsZUJ1dHRvbiA9PT0gbnVsbCB8fCB0b2dnbGVCdXR0b24gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRvZ2dsZUJ1dHRvbi5wYXJlbnROb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZ2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiKSkgIT1cbiAgICAgICAgICAgIFwiU3RhcnQgcmVwbGF5XCIpIHtcbiAgICAgICAgICAgIHBhdXNlUmVwbGF5KCk7XG4gICAgICAgIH1cbiAgICAgICAgJChcIiNyZXN1bHRSZXBsYXlcIikuc2xpZGVVcCgyNTAsICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0UmVwbGF5XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5mdW5jdGlvbiBzdGFydFJlcGxheVJlY29yZGluZygpIHtcbiAgICBpZiAoISQoXCIjcmVzdWx0UmVwbGF5XCIpLnN0b3AodHJ1ZSwgdHJ1ZSkuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgLy9oaWRlIHJlcGxheSBkaXNwbGF5IGlmIHVzZXIgbGVmdCBpdCBvcGVuXG4gICAgICAgIHRvZ2dsZVJlcGxheURpc3BsYXkoKTtcbiAgICB9XG4gICAgJChcIiNyZXBsYXlTdG9wd2F0Y2hcIikudGV4dCgwICsgXCJzXCIpO1xuICAgIHJlcGxheURhdGEgPSBbXTtcbiAgICByZXBsYXlTdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICByZXBsYXlSZWNvcmRpbmcgPSB0cnVlO1xuICAgIHRhcmdldEN1clBvcyA9IDA7XG4gICAgdGFyZ2V0V29yZFBvcyA9IDA7XG59XG5leHBvcnRzLnN0YXJ0UmVwbGF5UmVjb3JkaW5nID0gc3RhcnRSZXBsYXlSZWNvcmRpbmc7XG5mdW5jdGlvbiBzdG9wUmVwbGF5UmVjb3JkaW5nKCkge1xuICAgIHJlcGxheVJlY29yZGluZyA9IGZhbHNlO1xufVxuZXhwb3J0cy5zdG9wUmVwbGF5UmVjb3JkaW5nID0gc3RvcFJlcGxheVJlY29yZGluZztcbmZ1bmN0aW9uIGFkZFJlcGxheUV2ZW50KGFjdGlvbiwgdmFsdWUpIHtcbiAgICBpZiAoIXJlcGxheVJlY29yZGluZykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHRpbWVEZWx0YSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcmVwbGF5U3RhcnRUaW1lO1xuICAgIHJlcGxheURhdGEucHVzaCh7IGFjdGlvbjogYWN0aW9uLCB2YWx1ZTogdmFsdWUsIHRpbWU6IHRpbWVEZWx0YSB9KTtcbn1cbmV4cG9ydHMuYWRkUmVwbGF5RXZlbnQgPSBhZGRSZXBsYXlFdmVudDtcbmZ1bmN0aW9uIHBsYXlSZXBsYXkoKSB7XG4gICAgdmFyIF9hO1xuICAgIGN1clBvcyA9IDA7XG4gICAgd29yZFBvcyA9IDA7XG4gICAgaWYgKHRvZ2dsZUJ1dHRvbiA9PT0gdW5kZWZpbmVkKVxuICAgICAgICByZXR1cm47XG4gICAgdG9nZ2xlQnV0dG9uLmNsYXNzTmFtZSA9IFwiZmFzIGZhLXBhdXNlXCI7XG4gICAgKF9hID0gdG9nZ2xlQnV0dG9uLnBhcmVudE5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIFwiUGF1c2UgcmVwbGF5XCIpO1xuICAgIGluaXRpYWxpemVSZXBsYXlQcm9tcHQoKTtcbiAgICBjb25zdCBzdGFydGluZ0luZGV4ID0gbG9hZE9sZFJlcGxheSgpO1xuICAgIGNvbnN0IGxhc3RUaW1lID0gcmVwbGF5RGF0YVtzdGFydGluZ0luZGV4XS50aW1lO1xuICAgIGxldCBzd1RpbWUgPSBNYXRoLnJvdW5kKGxhc3RUaW1lIC8gMTAwMCk7IC8vc3RhcnRpbmcgdGltZVxuICAgIGNvbnN0IHN3RW5kVGltZSA9IE1hdGgucm91bmQocmVwbGF5RGF0YVtyZXBsYXlEYXRhLmxlbmd0aCAtIDFdLnRpbWUgLyAxMDAwKTtcbiAgICB3aGlsZSAoc3dUaW1lIDw9IHN3RW5kVGltZSkge1xuICAgICAgICBjb25zdCB0aW1lID0gc3dUaW1lO1xuICAgICAgICBzdG9wd2F0Y2hMaXN0LnB1c2goc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAkKFwiI3JlcGxheVN0b3B3YXRjaFwiKS50ZXh0KHRpbWUgKyBcInNcIik7XG4gICAgICAgIH0sIHRpbWUgKiAxMDAwIC0gbGFzdFRpbWUpKTtcbiAgICAgICAgc3dUaW1lKys7XG4gICAgfVxuICAgIHJlcGxheURhdGEuZm9yRWFjaCgoaXRlbSwgaSkgPT4ge1xuICAgICAgICBpZiAoaSA8IHN0YXJ0aW5nSW5kZXgpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRpbWVvdXRMaXN0LnB1c2goc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBoYW5kbGVEaXNwbGF5TG9naWMoaXRlbSk7XG4gICAgICAgIH0sIGl0ZW0udGltZSAtIGxhc3RUaW1lKSk7XG4gICAgfSk7XG4gICAgdGltZW91dExpc3QucHVzaChzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgLy9hZnRlciB0aGUgcmVwbGF5IGhhcyBmaW5pc2hlZCwgdGhpcyB3aWxsIHJ1blxuICAgICAgICB0YXJnZXRDdXJQb3MgPSAwO1xuICAgICAgICB0YXJnZXRXb3JkUG9zID0gMDtcbiAgICAgICAgdG9nZ2xlQnV0dG9uLmNsYXNzTmFtZSA9IFwiZmFzIGZhLXBsYXlcIjtcbiAgICAgICAgdG9nZ2xlQnV0dG9uLnBhcmVudE5vZGUuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCBcIlN0YXJ0IHJlcGxheVwiKTtcbiAgICB9LCByZXBsYXlEYXRhW3JlcGxheURhdGEubGVuZ3RoIC0gMV0udGltZSAtIGxhc3RUaW1lKSk7XG59XG5mdW5jdGlvbiBnZXRSZXBsYXlFeHBvcnQoKSB7XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgcmVwbGF5RGF0YTogcmVwbGF5RGF0YSxcbiAgICAgICAgd29yZHNMaXN0OiB3b3Jkc0xpc3QsXG4gICAgfSk7XG59XG5leHBvcnRzLmdldFJlcGxheUV4cG9ydCA9IGdldFJlcGxheUV4cG9ydDtcbiQoXCIucGFnZVRlc3QgI3BsYXlwYXVzZVJlcGxheUJ1dHRvblwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBpZiAoKHRvZ2dsZUJ1dHRvbiA9PT0gbnVsbCB8fCB0b2dnbGVCdXR0b24gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRvZ2dsZUJ1dHRvbi5jbGFzc05hbWUpID09PSBcImZhcyBmYS1wbGF5XCIpIHtcbiAgICAgICAgcGxheVJlcGxheSgpO1xuICAgIH1cbiAgICBlbHNlIGlmICgodG9nZ2xlQnV0dG9uID09PSBudWxsIHx8IHRvZ2dsZUJ1dHRvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogdG9nZ2xlQnV0dG9uLmNsYXNzTmFtZSkgPT09IFwiZmFzIGZhLXBhdXNlXCIpIHtcbiAgICAgICAgcGF1c2VSZXBsYXkoKTtcbiAgICB9XG59KTtcbiQoXCIjcmVwbGF5V29yZHNcIikub24oXCJjbGlja1wiLCBcImxldHRlclwiLCAoZXZlbnQpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgLy9hbGxvd3MgdXNlciB0byBjbGljayBvbiB0aGUgcGxhY2UgdGhleSB3YW50IHRvIHN0YXJ0IHRoZWlyIHJlcGxheSBhdFxuICAgIHBhdXNlUmVwbGF5KCk7XG4gICAgY29uc3QgcmVwbGF5V29yZHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3JlcGxheVdvcmRzXCIpO1xuICAgIGNvbnN0IHdvcmRzID0gWy4uLigoX2EgPSByZXBsYXlXb3JkcyA9PT0gbnVsbCB8fCByZXBsYXlXb3JkcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVwbGF5V29yZHMuY2hpbGRyZW4pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFtdKV07XG4gICAgdGFyZ2V0V29yZFBvcyA9IHdvcmRzLmluZGV4T2YoZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUpO1xuICAgIGNvbnN0IGxldHRlcnMgPSBbLi4ud29yZHNbdGFyZ2V0V29yZFBvc10uY2hpbGRyZW5dO1xuICAgIHRhcmdldEN1clBvcyA9IGxldHRlcnMuaW5kZXhPZihldmVudC50YXJnZXQpO1xuICAgIGluaXRpYWxpemVSZXBsYXlQcm9tcHQoKTtcbiAgICBsb2FkT2xkUmVwbGF5KCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwia2V5cHJlc3NcIiwgXCIjd2F0Y2hSZXBsYXlCdXR0b25cIiwgKGV2ZW50KSA9PiB7XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIHRvZ2dsZVJlcGxheURpc3BsYXkoKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQuYm9keSkub24oXCJjbGlja1wiLCBcIiN3YXRjaFJlcGxheUJ1dHRvblwiLCAoKSA9PiB7XG4gICAgdG9nZ2xlUmVwbGF5RGlzcGxheSgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZSA9IGV4cG9ydHMudXBkYXRlUmF0ZVF1b3RlID0gZXhwb3J0cy51cGRhdGVDcm93biA9IGV4cG9ydHMuaGlkZUNyb3duID0gZXhwb3J0cy5zaG93Q3Jvd24gPSBleHBvcnRzLnVwZGF0ZVRvZGF5VHJhY2tlciA9IGV4cG9ydHMudXBkYXRlR3JhcGhQQkxpbmUgPSBleHBvcnRzLnRvZ2dsZVVuc21vb3RoZWRSYXcgPSB2b2lkIDA7XG5jb25zdCBUZXN0VUkgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC11aVwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgVGVzdFN0YXRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtc3RhdHNcIikpO1xuY29uc3QgS2V5bWFwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9rZXltYXBcIikpO1xuY29uc3QgQ2hhcnRDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9jaGFydC1jb250cm9sbGVyXCIpKTtcbmNvbnN0IFRoZW1lQ29sb3JzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy90aGVtZS1jb2xvcnNcIikpO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IFRvZGF5VHJhY2tlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90b2RheS10cmFja2VyXCIpKTtcbmNvbnN0IFBiQ3Jvd24gPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vcGItY3Jvd25cIikpO1xuY29uc3QgUXVvdGVSYXRlUG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BvcHVwcy9xdW90ZS1yYXRlLXBvcHVwXCIpKTtcbmNvbnN0IEdsYXJzZXNNb2RlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvZ2xhcnNlcy1tb2RlXCIpKTtcbmNvbnN0IFRlc3RJbnB1dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LWlucHV0XCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgUmVzdWx0c1Nob3duRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL3Jlc3VsdHMtc2hvd24tZXZlbnRcIikpO1xuY29uc3QgY2hhcnRfanNfMSA9IHJlcXVpcmUoXCJjaGFydC5qc1wiKTtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi4vZmlyZWJhc2VcIik7XG5sZXQgcmVzdWx0O1xubGV0IG1heENoYXJ0VmFsO1xubGV0IHVzZVVuc21vb3RoZWRSYXcgPSBmYWxzZTtcbmZ1bmN0aW9uIHRvZ2dsZVVuc21vb3RoZWRSYXcoKSB7XG4gICAgdXNlVW5zbW9vdGhlZFJhdyA9ICF1c2VVbnNtb290aGVkUmF3O1xuICAgIE5vdGlmaWNhdGlvbnMuYWRkKHVzZVVuc21vb3RoZWRSYXcgPyBcIm9uXCIgOiBcIm9mZlwiLCAxKTtcbn1cbmV4cG9ydHMudG9nZ2xlVW5zbW9vdGhlZFJhdyA9IHRvZ2dsZVVuc21vb3RoZWRSYXc7XG5sZXQgcmVzdWx0QW5ub3RhdGlvbiA9IFtdO1xubGV0IHJlc3VsdFNjYWxlT3B0aW9ucyA9IENoYXJ0Q29udHJvbGxlci5yZXN1bHQub3B0aW9ucy5zY2FsZXM7XG5mdW5jdGlvbiB1cGRhdGVHcmFwaCgpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IGxhYmVscyA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBUZXN0SW5wdXQud3BtSGlzdG9yeS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKFRlc3RTdGF0cy5sYXN0U2Vjb25kTm90Um91bmQgJiYgaSA9PT0gVGVzdElucHV0LndwbUhpc3RvcnkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgbGFiZWxzLnB1c2goTWlzYy5yb3VuZFRvMihyZXN1bHQudGVzdER1cmF0aW9uKS50b1N0cmluZygpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxhYmVscy5wdXNoKGkudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgQ2hhcnRDb250cm9sbGVyLnJlc3VsdC5kYXRhLmxhYmVscyA9IGxhYmVscztcbiAgICAgICAgcmVzdWx0U2NhbGVPcHRpb25zW1wid3BtXCJdLnRpdGxlLnRleHQgPSBjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE1cbiAgICAgICAgICAgID8gXCJDaGFyYWN0ZXIgcGVyIE1pbnV0ZVwiXG4gICAgICAgICAgICA6IFwiV29yZHMgcGVyIE1pbnV0ZVwiO1xuICAgICAgICBjb25zdCBjaGFydERhdGExID0gY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNXG4gICAgICAgICAgICA/IFRlc3RJbnB1dC53cG1IaXN0b3J5Lm1hcCgoYSkgPT4gYSAqIDUpXG4gICAgICAgICAgICA6IFRlc3RJbnB1dC53cG1IaXN0b3J5O1xuICAgICAgICBsZXQgY2hhcnREYXRhMjtcbiAgICAgICAgaWYgKHJlc3VsdC5jaGFydERhdGEgPT09IFwidG9vbG9uZ1wiKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAodXNlVW5zbW9vdGhlZFJhdykge1xuICAgICAgICAgICAgY2hhcnREYXRhMiA9XG4gICAgICAgICAgICAgICAgKF9iID0gKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTVxuICAgICAgICAgICAgICAgICAgICA/IChfYSA9IHJlc3VsdC5jaGFydERhdGEudW5zbW9vdGhlZFJhdykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1hcCgoYSkgPT4gYSAqIDUpXG4gICAgICAgICAgICAgICAgICAgIDogcmVzdWx0LmNoYXJ0RGF0YS51bnNtb290aGVkUmF3KSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogW107XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjaGFydERhdGEyID0gY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNXG4gICAgICAgICAgICAgICAgPyByZXN1bHQuY2hhcnREYXRhLnJhdy5tYXAoKGEpID0+IGEgKiA1KVxuICAgICAgICAgICAgICAgIDogcmVzdWx0LmNoYXJ0RGF0YS5yYXc7XG4gICAgICAgIH1cbiAgICAgICAgQ2hhcnRDb250cm9sbGVyLnJlc3VsdC5kYXRhLmRhdGFzZXRzWzBdLmRhdGEgPSBjaGFydERhdGExO1xuICAgICAgICBDaGFydENvbnRyb2xsZXIucmVzdWx0LmRhdGEuZGF0YXNldHNbMV0uZGF0YSA9IGNoYXJ0RGF0YTI7XG4gICAgICAgIENoYXJ0Q29udHJvbGxlci5yZXN1bHQuZGF0YS5kYXRhc2V0c1swXS5sYWJlbCA9IGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTVxuICAgICAgICAgICAgPyBcImNwbVwiXG4gICAgICAgICAgICA6IFwid3BtXCI7XG4gICAgICAgIG1heENoYXJ0VmFsID0gTWF0aC5tYXgoLi4uW01hdGgubWF4KC4uLmNoYXJ0RGF0YTIpLCBNYXRoLm1heCguLi5jaGFydERhdGExKV0pO1xuICAgICAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuc3RhcnRHcmFwaHNBdFplcm8pIHtcbiAgICAgICAgICAgIGNvbnN0IG1pbkNoYXJ0VmFsID0gTWF0aC5taW4oLi4uW01hdGgubWluKC4uLmNoYXJ0RGF0YTIpLCBNYXRoLm1pbiguLi5jaGFydERhdGExKV0pO1xuICAgICAgICAgICAgcmVzdWx0U2NhbGVPcHRpb25zW1wid3BtXCJdLm1pbiA9IG1pbkNoYXJ0VmFsO1xuICAgICAgICAgICAgcmVzdWx0U2NhbGVPcHRpb25zW1wicmF3XCJdLm1pbiA9IG1pbkNoYXJ0VmFsO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0U2NhbGVPcHRpb25zW1wid3BtXCJdLm1pbiA9IDA7XG4gICAgICAgICAgICByZXN1bHRTY2FsZU9wdGlvbnNbXCJyYXdcIl0ubWluID0gMDtcbiAgICAgICAgfVxuICAgICAgICBDaGFydENvbnRyb2xsZXIucmVzdWx0LmRhdGEuZGF0YXNldHNbMl0uZGF0YSA9IHJlc3VsdC5jaGFydERhdGEuZXJyO1xuICAgICAgICBjb25zdCBmYyA9IHlpZWxkIFRoZW1lQ29sb3JzLmdldChcInN1YlwiKTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ICE9PSBcIm5vbmVcIikge1xuICAgICAgICAgICAgbGV0IGNvbnRlbnQgPSBjb25maWdfMS5kZWZhdWx0LmZ1bmJveDtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJsYXlvdXRmbHVpZFwiKSB7XG4gICAgICAgICAgICAgICAgY29udGVudCArPSBcIiBcIiArIGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tTGF5b3V0Zmx1aWQucmVwbGFjZSgvIy9nLCBcIiBcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXN1bHRBbm5vdGF0aW9uLnB1c2goe1xuICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgaWQ6IFwiZnVuYm94LWxhYmVsXCIsXG4gICAgICAgICAgICAgICAgdHlwZTogXCJsaW5lXCIsXG4gICAgICAgICAgICAgICAgc2NhbGVJRDogXCJ3cG1cIixcbiAgICAgICAgICAgICAgICB2YWx1ZTogcmVzdWx0U2NhbGVPcHRpb25zW1wid3BtXCJdLm1pbixcbiAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogXCJ0cmFuc3BhcmVudFwiLFxuICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAxLFxuICAgICAgICAgICAgICAgIGJvcmRlckRhc2g6IFsyLCAyXSxcbiAgICAgICAgICAgICAgICBsYWJlbDoge1xuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwidHJhbnNwYXJlbnRcIixcbiAgICAgICAgICAgICAgICAgICAgZm9udDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmFtaWx5OiBjb25maWdfMS5kZWZhdWx0LmZvbnRGYW1pbHkucmVwbGFjZSgvXy9nLCBcIiBcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiAxMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlOiBcIm5vcm1hbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgd2VpZ2h0OiBjaGFydF9qc18xLkNoYXJ0LmRlZmF1bHRzLmZvbnQud2VpZ2h0LFxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodDogY2hhcnRfanNfMS5DaGFydC5kZWZhdWx0cy5mb250LmxpbmVIZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiBmYyxcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMyxcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAzLFxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogXCJzdGFydFwiLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBgJHtjb250ZW50fWAsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdFNjYWxlT3B0aW9uc1tcIndwbVwiXS5tYXggPSBtYXhDaGFydFZhbDtcbiAgICAgICAgcmVzdWx0U2NhbGVPcHRpb25zW1wicmF3XCJdLm1heCA9IG1heENoYXJ0VmFsO1xuICAgICAgICByZXN1bHRTY2FsZU9wdGlvbnNbXCJlcnJvclwiXS5tYXggPSBNYXRoLm1heCguLi5yZXN1bHQuY2hhcnREYXRhLmVycikgKyAxO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gdXBkYXRlR3JhcGhQQkxpbmUoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgdGhlbWVjb2xvcnMgPSB5aWVsZCBUaGVtZUNvbG9ycy5nZXRBbGwoKTtcbiAgICAgICAgY29uc3QgbHBiID0geWllbGQgREIuZ2V0TG9jYWxQQihyZXN1bHQubW9kZSwgcmVzdWx0Lm1vZGUyLCAoX2EgPSByZXN1bHQucHVuY3R1YXRpb24pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGZhbHNlLCByZXN1bHQubGFuZ3VhZ2UsIHJlc3VsdC5kaWZmaWN1bHR5LCAoX2IgPSByZXN1bHQubGF6eU1vZGUpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IGZhbHNlLCAoX2MgPSByZXN1bHQuZnVuYm94KSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiBcIm5vbmVcIik7XG4gICAgICAgIGlmIChscGIgPT0gMClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgY2hhcnRscGIgPSBNaXNjLnJvdW5kVG8yKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd0NQTSA/IGxwYiAqIDUgOiBscGIpLnRvRml4ZWQoMik7XG4gICAgICAgIHJlc3VsdEFubm90YXRpb24ucHVzaCh7XG4gICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgdHlwZTogXCJsaW5lXCIsXG4gICAgICAgICAgICBpZDogXCJscGJcIixcbiAgICAgICAgICAgIHNjYWxlSUQ6IFwid3BtXCIsXG4gICAgICAgICAgICB2YWx1ZTogY2hhcnRscGIsXG4gICAgICAgICAgICBib3JkZXJDb2xvcjogdGhlbWVjb2xvcnNbXCJzdWJcIl0sXG4gICAgICAgICAgICBib3JkZXJXaWR0aDogMSxcbiAgICAgICAgICAgIGJvcmRlckRhc2g6IFsyLCAyXSxcbiAgICAgICAgICAgIGxhYmVsOiB7XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiB0aGVtZWNvbG9yc1tcInN1YlwiXSxcbiAgICAgICAgICAgICAgICBmb250OiB7XG4gICAgICAgICAgICAgICAgICAgIGZhbWlseTogY29uZmlnXzEuZGVmYXVsdC5mb250RmFtaWx5LnJlcGxhY2UoL18vZywgXCIgXCIpLFxuICAgICAgICAgICAgICAgICAgICBzaXplOiAxMSxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IFwibm9ybWFsXCIsXG4gICAgICAgICAgICAgICAgICAgIHdlaWdodDogY2hhcnRfanNfMS5DaGFydC5kZWZhdWx0cy5mb250LndlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodDogY2hhcnRfanNfMS5DaGFydC5kZWZhdWx0cy5mb250LmxpbmVIZWlnaHQsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjb2xvcjogdGhlbWVjb2xvcnNbXCJiZ1wiXSxcbiAgICAgICAgICAgICAgICBwYWRkaW5nOiAzLFxuICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogMyxcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGBQQjogJHtjaGFydGxwYn1gLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChtYXhDaGFydFZhbCA+PSBwYXJzZUZsb2F0KGNoYXJ0bHBiKSAtIDIwICYmXG4gICAgICAgICAgICBtYXhDaGFydFZhbCA8PSBwYXJzZUZsb2F0KGNoYXJ0bHBiKSArIDIwKSB7XG4gICAgICAgICAgICBtYXhDaGFydFZhbCA9IHBhcnNlRmxvYXQoY2hhcnRscGIpICsgMTU7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0U2NhbGVPcHRpb25zW1wid3BtXCJdLm1heCA9IE1hdGgucm91bmQobWF4Q2hhcnRWYWwgKyA1KTtcbiAgICAgICAgcmVzdWx0U2NhbGVPcHRpb25zW1wicmF3XCJdLm1heCA9IE1hdGgucm91bmQobWF4Q2hhcnRWYWwgKyA1KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMudXBkYXRlR3JhcGhQQkxpbmUgPSB1cGRhdGVHcmFwaFBCTGluZTtcbmZ1bmN0aW9uIHVwZGF0ZVdwbUFuZEFjYygpIHtcbiAgICBsZXQgaW5mID0gZmFsc2U7XG4gICAgaWYgKHJlc3VsdC53cG0gPj0gMTAwMCkge1xuICAgICAgICBpbmYgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93RGVjaW1hbFBsYWNlcykge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNID09IGZhbHNlKSB7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAudG9wIC50ZXh0XCIpLnRleHQoXCJ3cG1cIik7XG4gICAgICAgICAgICBpZiAoaW5mKSB7XG4gICAgICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLmJvdHRvbVwiKS50ZXh0KFwiSW5maW5pdGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAuYm90dG9tXCIpLnRleHQoTWlzYy5yb3VuZFRvMihyZXN1bHQud3BtKS50b0ZpeGVkKDIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAucmF3IC5ib3R0b21cIikudGV4dChNaXNjLnJvdW5kVG8yKHJlc3VsdC5yYXdXcG0pLnRvRml4ZWQoMikpO1xuICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLmJvdHRvbVwiKS5hdHRyKFwiYXJpYS1sYWJlbFwiLCBNaXNjLnJvdW5kVG8yKHJlc3VsdC53cG0gKiA1KS50b0ZpeGVkKDIpICsgXCIgY3BtXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLnRvcCAudGV4dFwiKS50ZXh0KFwiY3BtXCIpO1xuICAgICAgICAgICAgaWYgKGluZikge1xuICAgICAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC5ib3R0b21cIikudGV4dChcIkluZmluaXRlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLmJvdHRvbVwiKS50ZXh0KE1pc2Mucm91bmRUbzIocmVzdWx0LndwbSAqIDUpLnRvRml4ZWQoMikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5yYXcgLmJvdHRvbVwiKS50ZXh0KE1pc2Mucm91bmRUbzIocmVzdWx0LnJhd1dwbSAqIDUpLnRvRml4ZWQoMikpO1xuICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLmJvdHRvbVwiKS5hdHRyKFwiYXJpYS1sYWJlbFwiLCBNaXNjLnJvdW5kVG8yKHJlc3VsdC53cG0pLnRvRml4ZWQoMikgKyBcIiB3cG1cIik7XG4gICAgICAgIH1cbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5hY2MgLmJvdHRvbVwiKS50ZXh0KHJlc3VsdC5hY2MgPT0gMTAwID8gXCIxMDAlXCIgOiBNaXNjLnJvdW5kVG8yKHJlc3VsdC5hY2MpLnRvRml4ZWQoMikgKyBcIiVcIik7XG4gICAgICAgIGxldCB0aW1lID0gTWlzYy5yb3VuZFRvMihyZXN1bHQudGVzdER1cmF0aW9uKS50b0ZpeGVkKDIpICsgXCJzXCI7XG4gICAgICAgIGlmIChyZXN1bHQudGVzdER1cmF0aW9uID4gNjEpIHtcbiAgICAgICAgICAgIHRpbWUgPSBNaXNjLnNlY29uZHNUb1N0cmluZyhNaXNjLnJvdW5kVG8yKHJlc3VsdC50ZXN0RHVyYXRpb24pKTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnRpbWUgLmJvdHRvbSAudGV4dFwiKS50ZXh0KHRpbWUpO1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnJhdyAuYm90dG9tXCIpLnJlbW92ZUF0dHIoXCJhcmlhLWxhYmVsXCIpO1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLmFjYyAuYm90dG9tXCIpLnJlbW92ZUF0dHIoXCJhcmlhLWxhYmVsXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy9ub3Qgc2hvd2luZyBkZWNpbWFsIHBsYWNlc1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93Q1BNID09IGZhbHNlKSB7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAudG9wIC50ZXh0XCIpLnRleHQoXCJ3cG1cIik7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAuYm90dG9tXCIpLmF0dHIoXCJhcmlhLWxhYmVsXCIsIHJlc3VsdC53cG0gKyBgICgke01pc2Mucm91bmRUbzIocmVzdWx0LndwbSAqIDUpfSBjcG0pYCk7XG4gICAgICAgICAgICBpZiAoaW5mKSB7XG4gICAgICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLmJvdHRvbVwiKS50ZXh0KFwiSW5maW5pdGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAuYm90dG9tXCIpLnRleHQoTWF0aC5yb3VuZChyZXN1bHQud3BtKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnJhdyAuYm90dG9tXCIpLnRleHQoTWF0aC5yb3VuZChyZXN1bHQucmF3V3BtKSk7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnJhdyAuYm90dG9tXCIpLmF0dHIoXCJhcmlhLWxhYmVsXCIsIHJlc3VsdC5yYXdXcG0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLnRvcCAudGV4dFwiKS50ZXh0KFwiY3BtXCIpO1xuICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLmJvdHRvbVwiKS5hdHRyKFwiYXJpYS1sYWJlbFwiLCBNaXNjLnJvdW5kVG8yKHJlc3VsdC53cG0gKiA1KSArIGAgKCR7TWlzYy5yb3VuZFRvMihyZXN1bHQud3BtKX0gd3BtKWApO1xuICAgICAgICAgICAgaWYgKGluZikge1xuICAgICAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAud3BtIC5ib3R0b21cIikudGV4dChcIkluZmluaXRlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLmJvdHRvbVwiKS50ZXh0KE1hdGgucm91bmQocmVzdWx0LndwbSAqIDUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAucmF3IC5ib3R0b21cIikudGV4dChNYXRoLnJvdW5kKHJlc3VsdC5yYXdXcG0gKiA1KSk7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnJhdyAuYm90dG9tXCIpLmF0dHIoXCJhcmlhLWxhYmVsXCIsIHJlc3VsdC5yYXdXcG0gKiA1KTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLmFjYyAuYm90dG9tXCIpLnRleHQoTWF0aC5mbG9vcihyZXN1bHQuYWNjKSArIFwiJVwiKTtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5hY2MgLmJvdHRvbVwiKS5hdHRyKFwiYXJpYS1sYWJlbFwiLCByZXN1bHQuYWNjICsgXCIlXCIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHVwZGF0ZUNvbnNpc3RlbmN5KCkge1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dEZWNpbWFsUGxhY2VzKSB7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAuY29uc2lzdGVuY3kgLmJvdHRvbVwiKS50ZXh0KE1pc2Mucm91bmRUbzIocmVzdWx0LmNvbnNpc3RlbmN5KS50b0ZpeGVkKDIpICsgXCIlXCIpO1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLmNvbnNpc3RlbmN5IC5ib3R0b21cIikuYXR0cihcImFyaWEtbGFiZWxcIiwgYCR7cmVzdWx0LmtleUNvbnNpc3RlbmN5LnRvRml4ZWQoMil9JSBrZXlgKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAuY29uc2lzdGVuY3kgLmJvdHRvbVwiKS50ZXh0KE1hdGgucm91bmQocmVzdWx0LmNvbnNpc3RlbmN5KSArIFwiJVwiKTtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5jb25zaXN0ZW5jeSAuYm90dG9tXCIpLmF0dHIoXCJhcmlhLWxhYmVsXCIsIGAke3Jlc3VsdC5jb25zaXN0ZW5jeX0lICgke3Jlc3VsdC5rZXlDb25zaXN0ZW5jeX0lIGtleSlgKTtcbiAgICB9XG59XG5mdW5jdGlvbiB1cGRhdGVUaW1lKCkge1xuICAgIGNvbnN0IGFma1NlY29uZHNQZXJjZW50ID0gTWlzYy5yb3VuZFRvMigocmVzdWx0LmFma0R1cmF0aW9uIC8gcmVzdWx0LnRlc3REdXJhdGlvbikgKiAxMDApO1xuICAgICQoXCIjcmVzdWx0IC5zdGF0cyAudGltZSAuYm90dG9tIC5hZmtcIikudGV4dChcIlwiKTtcbiAgICBpZiAoYWZrU2Vjb25kc1BlcmNlbnQgPiAwKSB7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAudGltZSAuYm90dG9tIC5hZmtcIikudGV4dChhZmtTZWNvbmRzUGVyY2VudCArIFwiJSBhZmtcIik7XG4gICAgfVxuICAgICQoXCIjcmVzdWx0IC5zdGF0cyAudGltZSAuYm90dG9tXCIpLmF0dHIoXCJhcmlhLWxhYmVsXCIsIGAke3Jlc3VsdC5hZmtEdXJhdGlvbn1zIGFmayAke2Fma1NlY29uZHNQZXJjZW50fSVgKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93RGVjaW1hbFBsYWNlcykge1xuICAgICAgICBsZXQgdGltZSA9IE1pc2Mucm91bmRUbzIocmVzdWx0LnRlc3REdXJhdGlvbikudG9GaXhlZCgyKSArIFwic1wiO1xuICAgICAgICBpZiAocmVzdWx0LnRlc3REdXJhdGlvbiA+IDYxKSB7XG4gICAgICAgICAgICB0aW1lID0gTWlzYy5zZWNvbmRzVG9TdHJpbmcoTWlzYy5yb3VuZFRvMihyZXN1bHQudGVzdER1cmF0aW9uKSk7XG4gICAgICAgIH1cbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC50aW1lIC5ib3R0b20gLnRleHRcIikudGV4dCh0aW1lKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGxldCB0aW1lID0gTWF0aC5yb3VuZChyZXN1bHQudGVzdER1cmF0aW9uKSArIFwic1wiO1xuICAgICAgICBpZiAocmVzdWx0LnRlc3REdXJhdGlvbiA+IDYxKSB7XG4gICAgICAgICAgICB0aW1lID0gTWlzYy5zZWNvbmRzVG9TdHJpbmcoTWF0aC5yb3VuZChyZXN1bHQudGVzdER1cmF0aW9uKSk7XG4gICAgICAgIH1cbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC50aW1lIC5ib3R0b20gLnRleHRcIikudGV4dCh0aW1lKTtcbiAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC50aW1lIC5ib3R0b21cIikuYXR0cihcImFyaWEtbGFiZWxcIiwgYCR7TWlzYy5yb3VuZFRvMihyZXN1bHQudGVzdER1cmF0aW9uKX1zICgke3Jlc3VsdC5hZmtEdXJhdGlvbn1zIGFmayAke2Fma1NlY29uZHNQZXJjZW50fSUpYCk7XG4gICAgfVxufVxuZnVuY3Rpb24gdXBkYXRlVG9kYXlUcmFja2VyKCkge1xuICAgICQoXCIjcmVzdWx0IC5zdGF0cyAudGltZSAuYm90dG9tIC50aW1lVG9kYXlcIikudGV4dChUb2RheVRyYWNrZXIuZ2V0U3RyaW5nKCkpO1xufVxuZXhwb3J0cy51cGRhdGVUb2RheVRyYWNrZXIgPSB1cGRhdGVUb2RheVRyYWNrZXI7XG5mdW5jdGlvbiB1cGRhdGVLZXkoKSB7XG4gICAgJChcIiNyZXN1bHQgLnN0YXRzIC5rZXkgLmJvdHRvbVwiKS50ZXh0KHJlc3VsdC5jaGFyU3RhdHNbMF0gK1xuICAgICAgICBcIi9cIiArXG4gICAgICAgIHJlc3VsdC5jaGFyU3RhdHNbMV0gK1xuICAgICAgICBcIi9cIiArXG4gICAgICAgIHJlc3VsdC5jaGFyU3RhdHNbMl0gK1xuICAgICAgICBcIi9cIiArXG4gICAgICAgIHJlc3VsdC5jaGFyU3RhdHNbM10pO1xufVxuZnVuY3Rpb24gc2hvd0Nyb3duKCkge1xuICAgIFBiQ3Jvd24uc2hvdygpO1xufVxuZXhwb3J0cy5zaG93Q3Jvd24gPSBzaG93Q3Jvd247XG5mdW5jdGlvbiBoaWRlQ3Jvd24oKSB7XG4gICAgUGJDcm93bi5oaWRlKCk7XG4gICAgJChcIiNyZXN1bHQgLnN0YXRzIC53cG0gLmNyb3duXCIpLmF0dHIoXCJhcmlhLWxhYmVsXCIsIFwiXCIpO1xufVxuZXhwb3J0cy5oaWRlQ3Jvd24gPSBoaWRlQ3Jvd247XG5mdW5jdGlvbiB1cGRhdGVDcm93bigpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBsZXQgcGJEaWZmID0gMDtcbiAgICAgICAgY29uc3QgbHBiID0geWllbGQgREIuZ2V0TG9jYWxQQihjb25maWdfMS5kZWZhdWx0Lm1vZGUsIHJlc3VsdC5tb2RlMiwgY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbiwgY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSwgY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5LCBjb25maWdfMS5kZWZhdWx0LmxhenlNb2RlLCBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCk7XG4gICAgICAgIHBiRGlmZiA9IE1hdGguYWJzKHJlc3VsdC53cG0gLSBscGIpO1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLndwbSAuY3Jvd25cIikuYXR0cihcImFyaWEtbGFiZWxcIiwgXCIrXCIgKyBNaXNjLnJvdW5kVG8yKHBiRGlmZikpO1xuICAgIH0pO1xufVxuZXhwb3J0cy51cGRhdGVDcm93biA9IHVwZGF0ZUNyb3duO1xuZnVuY3Rpb24gdXBkYXRlVGFncyhkb250U2F2ZSkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBhY3RpdmVUYWdzID0gW107XG4gICAgdHJ5IHtcbiAgICAgICAgKF9hID0gREIuZ2V0U25hcHNob3QoKS50YWdzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgICAgICBpZiAodGFnLmFjdGl2ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGFjdGl2ZVRhZ3MucHVzaCh0YWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHsgfVxuICAgICQoXCIjcmVzdWx0IC5zdGF0cyAudGFnc1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICBpZiAoYWN0aXZlVGFncy5sZW5ndGggPT0gMCkge1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnRhZ3NcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnRhZ3NcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgICQoXCIjcmVzdWx0IC5zdGF0cyAudGFncyAuYm90dG9tXCIpLnRleHQoXCJcIik7XG4gICAgbGV0IGFubm90YXRpb25TaWRlID0gXCJzdGFydFwiO1xuICAgIGxldCBsYWJlbEFkanVzdCA9IDE1O1xuICAgIGFjdGl2ZVRhZ3MuZm9yRWFjaCgodGFnKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGNvbnN0IHRwYiA9IHlpZWxkIERCLmdldExvY2FsVGFnUEIodGFnLl9pZCwgY29uZmlnXzEuZGVmYXVsdC5tb2RlLCByZXN1bHQubW9kZTIsIGNvbmZpZ18xLmRlZmF1bHQucHVuY3R1YXRpb24sIGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UsIGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSwgY29uZmlnXzEuZGVmYXVsdC5sYXp5TW9kZSk7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAudGFncyAuYm90dG9tXCIpLmFwcGVuZChgXG4gICAgICA8ZGl2IHRhZ2lkPVwiJHt0YWcuX2lkfVwiIGFyaWEtbGFiZWw9XCJQQjogJHt0cGJ9XCIgZGF0YS1iYWxsb29uLXBvcz1cInVwXCI+JHt0YWcubmFtZX08aSBjbGFzcz1cImZhcyBmYS1jcm93biBoaWRkZW5cIj48L2k+PC9kaXY+XG4gICAgYCk7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT0gXCJxdW90ZVwiICYmICFkb250U2F2ZSkge1xuICAgICAgICAgICAgaWYgKHRwYiA8IHJlc3VsdC53cG0pIHtcbiAgICAgICAgICAgICAgICAvL25ldyBwYiBmb3IgdGhhdCB0YWdcbiAgICAgICAgICAgICAgICBEQi5zYXZlTG9jYWxUYWdQQih0YWcuX2lkLCBjb25maWdfMS5kZWZhdWx0Lm1vZGUsIHJlc3VsdC5tb2RlMiwgY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbiwgY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSwgY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5LCBjb25maWdfMS5kZWZhdWx0LmxhenlNb2RlLCByZXN1bHQud3BtLCByZXN1bHQuYWNjLCByZXN1bHQucmF3V3BtLCByZXN1bHQuY29uc2lzdGVuY3kpO1xuICAgICAgICAgICAgICAgICQoYCNyZXN1bHQgLnN0YXRzIC50YWdzIC5ib3R0b20gZGl2W3RhZ2lkPVwiJHt0YWcuX2lkfVwiXSAuZmFzYCkucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgJChgI3Jlc3VsdCAuc3RhdHMgLnRhZ3MgLmJvdHRvbSBkaXZbdGFnaWQ9XCIke3RhZy5faWR9XCJdYCkuYXR0cihcImFyaWEtbGFiZWxcIiwgXCIrXCIgKyBNaXNjLnJvdW5kVG8yKHJlc3VsdC53cG0gLSB0cGIpKTtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIm5ldyBwYiBmb3IgdGFnIFwiICsgdGFnLm5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGhlbWVjb2xvcnMgPSB5aWVsZCBUaGVtZUNvbG9ycy5nZXRBbGwoKTtcbiAgICAgICAgICAgICAgICByZXN1bHRBbm5vdGF0aW9uLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImxpbmVcIixcbiAgICAgICAgICAgICAgICAgICAgaWQ6IFwidHBiXCIsXG4gICAgICAgICAgICAgICAgICAgIHNjYWxlSUQ6IFwid3BtXCIsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0gPyB0cGIgKiA1IDogdHBiLFxuICAgICAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogdGhlbWVjb2xvcnNbXCJzdWJcIl0sXG4gICAgICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAxLFxuICAgICAgICAgICAgICAgICAgICBib3JkZXJEYXNoOiBbMiwgMl0sXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHRoZW1lY29sb3JzW1wic3ViXCJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgZm9udDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbWlseTogY29uZmlnXzEuZGVmYXVsdC5mb250RmFtaWx5LnJlcGxhY2UoL18vZywgXCIgXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IDExLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlOiBcIm5vcm1hbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdlaWdodDogY2hhcnRfanNfMS5DaGFydC5kZWZhdWx0cy5mb250LndlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiBjaGFydF9qc18xLkNoYXJ0LmRlZmF1bHRzLmZvbnQubGluZUhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogdGhlbWVjb2xvcnNbXCJiZ1wiXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IDMsXG4gICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6IDMsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogYW5ub3RhdGlvblNpZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICB4QWRqdXN0OiBsYWJlbEFkanVzdCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBgJHt0YWcubmFtZX0gUEI6ICR7TWlzYy5yb3VuZFRvMihjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0gPyB0cGIgKiA1IDogdHBiKS50b0ZpeGVkKDIpfWAsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKGFubm90YXRpb25TaWRlID09PSBcInN0YXJ0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgYW5ub3RhdGlvblNpZGUgPSBcImVuZFwiO1xuICAgICAgICAgICAgICAgICAgICBsYWJlbEFkanVzdCA9IC0xNTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGFubm90YXRpb25TaWRlID0gXCJzdGFydFwiO1xuICAgICAgICAgICAgICAgICAgICBsYWJlbEFkanVzdCA9IDE1O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pKTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZVRlc3RUeXBlKHJhbmRvbVF1b3RlKSB7XG4gICAgbGV0IHRlc3RUeXBlID0gXCJcIjtcbiAgICB0ZXN0VHlwZSArPSBjb25maWdfMS5kZWZhdWx0Lm1vZGU7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgdGVzdFR5cGUgKz0gXCIgXCIgKyBjb25maWdfMS5kZWZhdWx0LnRpbWU7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ3b3Jkc1wiKSB7XG4gICAgICAgIHRlc3RUeXBlICs9IFwiIFwiICsgY29uZmlnXzEuZGVmYXVsdC53b3JkcztcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInF1b3RlXCIpIHtcbiAgICAgICAgaWYgKHJhbmRvbVF1b3RlLmdyb3VwICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRlc3RUeXBlICs9IFwiIFwiICsgW1wic2hvcnRcIiwgXCJtZWRpdW1cIiwgXCJsb25nXCIsIFwidGhpY2NcIl1bcmFuZG9tUXVvdGUuZ3JvdXBdO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT0gXCJjdXN0b21cIiAmJlxuICAgICAgICBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCAhPT0gXCJnaWJiZXJpc2hcIiAmJlxuICAgICAgICBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCAhPT0gXCJhc2NpaVwiICYmXG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ICE9PSBcIjU4MDA4XCIpIHtcbiAgICAgICAgdGVzdFR5cGUgKz0gXCI8YnI+XCIgKyByZXN1bHQubGFuZ3VhZ2UucmVwbGFjZSgvXy9nLCBcIiBcIik7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnB1bmN0dWF0aW9uKSB7XG4gICAgICAgIHRlc3RUeXBlICs9IFwiPGJyPnB1bmN0dWF0aW9uXCI7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm51bWJlcnMpIHtcbiAgICAgICAgdGVzdFR5cGUgKz0gXCI8YnI+bnVtYmVyc1wiO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUpIHtcbiAgICAgICAgdGVzdFR5cGUgKz0gXCI8YnI+YmxpbmRcIjtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubGF6eU1vZGUpIHtcbiAgICAgICAgdGVzdFR5cGUgKz0gXCI8YnI+bGF6eVwiO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggIT09IFwibm9uZVwiKSB7XG4gICAgICAgIHRlc3RUeXBlICs9IFwiPGJyPlwiICsgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3gucmVwbGFjZSgvXy9nLCBcIiBcIik7XG4gICAgfVxuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmRpZmZpY3VsdHkgPT0gXCJleHBlcnRcIikge1xuICAgICAgICB0ZXN0VHlwZSArPSBcIjxicj5leHBlcnRcIjtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ID09IFwibWFzdGVyXCIpIHtcbiAgICAgICAgdGVzdFR5cGUgKz0gXCI8YnI+bWFzdGVyXCI7XG4gICAgfVxuICAgICQoXCIjcmVzdWx0IC5zdGF0cyAudGVzdFR5cGUgLmJvdHRvbVwiKS5odG1sKHRlc3RUeXBlKTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZU90aGVyKGRpZmZpY3VsdHlGYWlsZWQsIGZhaWxSZWFzb24sIGFma0RldGVjdGVkLCBpc1JlcGVhdGVkLCB0b29TaG9ydCkge1xuICAgIGxldCBvdGhlclRleHQgPSBcIlwiO1xuICAgIGlmIChkaWZmaWN1bHR5RmFpbGVkKSB7XG4gICAgICAgIG90aGVyVGV4dCArPSBgPGJyPmZhaWxlZCAoJHtmYWlsUmVhc29ufSlgO1xuICAgIH1cbiAgICBpZiAoYWZrRGV0ZWN0ZWQpIHtcbiAgICAgICAgb3RoZXJUZXh0ICs9IFwiPGJyPmFmayBkZXRlY3RlZFwiO1xuICAgIH1cbiAgICBpZiAoVGVzdFN0YXRzLmludmFsaWQpIHtcbiAgICAgICAgb3RoZXJUZXh0ICs9IFwiPGJyPmludmFsaWRcIjtcbiAgICAgICAgbGV0IGV4dHJhID0gXCJcIjtcbiAgICAgICAgaWYgKHJlc3VsdC53cG0gPCAwIHx8IHJlc3VsdC53cG0gPiAzNTApIHtcbiAgICAgICAgICAgIGV4dHJhICs9IFwid3BtXCI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlc3VsdC5hY2MgPCA3NSB8fCByZXN1bHQuYWNjID4gMTAwKSB7XG4gICAgICAgICAgICBpZiAoZXh0cmEubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGV4dHJhICs9IFwiLCBcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGV4dHJhICs9IFwiYWNjdXJhY3lcIjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXh0cmEubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgb3RoZXJUZXh0ICs9IGAgKCR7ZXh0cmF9KWA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGlzUmVwZWF0ZWQpIHtcbiAgICAgICAgb3RoZXJUZXh0ICs9IFwiPGJyPnJlcGVhdGVkXCI7XG4gICAgfVxuICAgIGlmIChyZXN1bHQuYmFpbGVkT3V0KSB7XG4gICAgICAgIG90aGVyVGV4dCArPSBcIjxicj5iYWlsZWQgb3V0XCI7XG4gICAgfVxuICAgIGlmICh0b29TaG9ydCkge1xuICAgICAgICBvdGhlclRleHQgKz0gXCI8YnI+dG9vIHNob3J0XCI7XG4gICAgfVxuICAgIGlmIChvdGhlclRleHQgPT0gXCJcIikge1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLmluZm9cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLmluZm9cIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIG90aGVyVGV4dCA9IG90aGVyVGV4dC5zdWJzdHJpbmcoNCk7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAuaW5mbyAuYm90dG9tXCIpLmh0bWwob3RoZXJUZXh0KTtcbiAgICB9XG59XG5mdW5jdGlvbiB1cGRhdGVSYXRlUXVvdGUocmFuZG9tUXVvdGUpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICBjb25zdCB1c2VycXIgPSAoX2IgPSAoX2EgPSBEQi5nZXRTbmFwc2hvdCgpLnF1b3RlUmF0aW5ncykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hW3JhbmRvbVF1b3RlLmxhbmd1YWdlXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iW3JhbmRvbVF1b3RlLmlkXTtcbiAgICAgICAgaWYgKHVzZXJxcikge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjcmVzdWx0ICNyYXRlUXVvdGVCdXR0b24gLmljb25cIilcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJmYXJcIilcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJmYXNcIik7XG4gICAgICAgIH1cbiAgICAgICAgUXVvdGVSYXRlUG9wdXAuZ2V0UXVvdGVTdGF0cyhyYW5kb21RdW90ZSkudGhlbigocXVvdGVTdGF0cykgPT4ge1xuICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Jlc3VsdCAjcmF0ZVF1b3RlQnV0dG9uIC5yYXRpbmdcIikudGV4dCgoX2IgPSAoX2EgPSBxdW90ZVN0YXRzID09PSBudWxsIHx8IHF1b3RlU3RhdHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHF1b3RlU3RhdHMuYXZlcmFnZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRvRml4ZWQoMSkpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IFwiXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjcmVzdWx0ICNyYXRlUXVvdGVCdXR0b25cIilcbiAgICAgICAgICAgICAgICAuY3NzKHsgb3BhY2l0eTogMCB9KVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgICAgIC5jc3MoeyBvcGFjaXR5OiAxIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLnVwZGF0ZVJhdGVRdW90ZSA9IHVwZGF0ZVJhdGVRdW90ZTtcbmZ1bmN0aW9uIHVwZGF0ZVF1b3RlU291cmNlKHJhbmRvbVF1b3RlKSB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAuc291cmNlXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI3Jlc3VsdCAuc3RhdHMgLnNvdXJjZSAuYm90dG9tXCIpLmh0bWwocmFuZG9tUXVvdGUuc291cmNlKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAuc291cmNlXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHVwZGF0ZShyZXMsIGRpZmZpY3VsdHlGYWlsZWQsIGZhaWxSZWFzb24sIGFma0RldGVjdGVkLCBpc1JlcGVhdGVkLCB0b29TaG9ydCwgcmFuZG9tUXVvdGUsIGRvbnRTYXZlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgcmVzdWx0U2NhbGVPcHRpb25zID0gQ2hhcnRDb250cm9sbGVyLnJlc3VsdC5vcHRpb25zLnNjYWxlcztcbiAgICAgICAgcmVzdWx0QW5ub3RhdGlvbiA9IFtdO1xuICAgICAgICByZXN1bHQgPSByZXM7XG4gICAgICAgICQoXCIjcmVzdWx0ICNyZXN1bHRXb3Jkc0hpc3RvcnlcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjcmV0cnlTYXZpbmdSZXN1bHRCdXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIucGFnZVRlc3QgI3Jlc3VsdCAjcmF0ZVF1b3RlQnV0dG9uIC5pY29uXCIpXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJmYXNcIilcbiAgICAgICAgICAgIC5hZGRDbGFzcyhcImZhclwiKTtcbiAgICAgICAgJChcIi5wYWdlVGVzdCAjcmVzdWx0ICNyYXRlUXVvdGVCdXR0b24gLnJhdGluZ1wiKS50ZXh0KFwiXCIpO1xuICAgICAgICAkKFwiLnBhZ2VUZXN0ICNyZXN1bHQgI3JhdGVRdW90ZUJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiN0ZXN0TW9kZXNOb3RpY2VcIikuY3NzKFwib3BhY2l0eVwiLCAwKTtcbiAgICAgICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcImJsdXJyZWRcIik7XG4gICAgICAgICQoXCIjd29yZHNJbnB1dFwiKS5ibHVyKCk7XG4gICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAudGltZSAuYm90dG9tIC5hZmtcIikudGV4dChcIlwiKTtcbiAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciAhPSBudWxsKSB7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAubG9naW5UaXBcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdCAubG9naW5UaXBcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgdXBkYXRlV3BtQW5kQWNjKCk7XG4gICAgICAgIHVwZGF0ZUNvbnNpc3RlbmN5KCk7XG4gICAgICAgIHVwZGF0ZVRpbWUoKTtcbiAgICAgICAgdXBkYXRlS2V5KCk7XG4gICAgICAgIHVwZGF0ZVRlc3RUeXBlKHJhbmRvbVF1b3RlKTtcbiAgICAgICAgdXBkYXRlUXVvdGVTb3VyY2UocmFuZG9tUXVvdGUpO1xuICAgICAgICB5aWVsZCB1cGRhdGVHcmFwaCgpO1xuICAgICAgICB5aWVsZCB1cGRhdGVHcmFwaFBCTGluZSgpO1xuICAgICAgICB1cGRhdGVUYWdzKGRvbnRTYXZlKTtcbiAgICAgICAgdXBkYXRlT3RoZXIoZGlmZmljdWx0eUZhaWxlZCwgZmFpbFJlYXNvbiwgYWZrRGV0ZWN0ZWQsIGlzUmVwZWF0ZWQsIHRvb1Nob3J0KTtcbiAgICAgICAgQ2hhcnRDb250cm9sbGVyLnJlc3VsdC5vcHRpb25zXG4gICAgICAgICAgICAucGx1Z2lucy5hbm5vdGF0aW9uLmFubm90YXRpb25zID1cbiAgICAgICAgICAgIHJlc3VsdEFubm90YXRpb247XG4gICAgICAgIENoYXJ0Q29udHJvbGxlci5yZXN1bHQudXBkYXRlQ29sb3JzKCk7XG4gICAgICAgIENoYXJ0Q29udHJvbGxlci5yZXN1bHQucmVzaXplKCk7XG4gICAgICAgIGlmICgkKFwiI3Jlc3VsdCAuc3RhdHMgLnRhZ3NcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikgJiZcbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAuaW5mb1wiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAgICAgJChcIiNyZXN1bHQgLnN0YXRzIC5pbmZvQW5kVGFnc1wiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0IC5zdGF0cyAuaW5mb0FuZFRhZ3NcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKEdsYXJzZXNNb2RlLmdldCgpKSB7XG4gICAgICAgICAgICAkKFwiI21pZGRsZSAjcmVzdWx0IC5ub1N0cmVzc01lc3NhZ2VcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAkKFwiI21pZGRsZSAjcmVzdWx0XCIpLnByZXBlbmQoYFxuXG4gICAgICA8ZGl2IGNsYXNzPSdub1N0cmVzc01lc3NhZ2UnIHN0eWxlPVwiXG4gICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICAgICAgZ3JpZC1jb2x1bW46IDEvMztcbiAgICAgICAgZm9udC1zaXplOiAycmVtO1xuICAgICAgICBwYWRkaW5nLWJvdHRvbTogMnJlbTtcbiAgICAgIFwiPlxuICAgICAgPGkgY2xhc3M9XCJmYXMgZmEtY2hlY2tcIj48L2k+XG4gICAgICA8L2Rpdj5cblxuICAgIGApO1xuICAgICAgICAgICAgJChcIiNtaWRkbGUgI3Jlc3VsdCAuc3RhdHNcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiI21pZGRsZSAjcmVzdWx0IC5jaGFydFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIjbWlkZGxlICNyZXN1bHQgI3Jlc3VsdFdvcmRzSGlzdG9yeVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIjbWlkZGxlICNyZXN1bHQgI3Jlc3VsdFJlcGxheVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIjbWlkZGxlICNyZXN1bHQgLmxvZ2luVGlwXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIiNtaWRkbGUgI3Jlc3VsdCAjc2hvd1dvcmRIaXN0b3J5QnV0dG9uXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIiNtaWRkbGUgI3Jlc3VsdCAjd2F0Y2hSZXBsYXlCdXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiI21pZGRsZSAjcmVzdWx0ICNzYXZlU2NyZWVuc2hvdEJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBUZXN0IENvbXBsZXRlZDogJHtyZXN1bHQud3BtfSB3cG0gJHtyZXN1bHQuYWNjfSUgYWNjICR7cmVzdWx0LnJhd1dwbX0gcmF3ICR7cmVzdWx0LmNvbnNpc3RlbmN5fSUgY29uc2lzdGVuY3lgKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoXCIjbWlkZGxlICNyZXN1bHQgLnN0YXRzXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIiNtaWRkbGUgI3Jlc3VsdCAuY2hhcnRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAvLyAkKFwiI21pZGRsZSAjcmVzdWx0ICNyZXN1bHRXb3Jkc0hpc3RvcnlcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAkKFwiI21pZGRsZSAjcmVzdWx0IC5sb2dpblRpcFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQoXCIjbWlkZGxlICNyZXN1bHQgI3Nob3dXb3JkSGlzdG9yeUJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIjbWlkZGxlICNyZXN1bHQgI3dhdGNoUmVwbGF5QnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIiNtaWRkbGUgI3Jlc3VsdCAjc2F2ZVNjcmVlbnNob3RCdXR0b25cIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHdpbmRvdy5zY3JvbGxZID4gMCkge1xuICAgICAgICAgICAgJChbZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCBkb2N1bWVudC5ib2R5XSlcbiAgICAgICAgICAgICAgICAuc3RvcCgpXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoeyBzY3JvbGxUb3A6IDAgfSwgMjUwKTtcbiAgICAgICAgfVxuICAgICAgICBNaXNjLnN3YXBFbGVtZW50cygkKFwiI3R5cGluZ1Rlc3RcIiksICQoXCIjcmVzdWx0XCIpLCAyNTAsICgpID0+IHtcbiAgICAgICAgICAgIFRlc3RVSS5zZXRSZXN1bHRDYWxjdWxhdGluZyhmYWxzZSk7XG4gICAgICAgICAgICAkKFwiI3dvcmRzXCIpLmVtcHR5KCk7XG4gICAgICAgICAgICBDaGFydENvbnRyb2xsZXIucmVzdWx0LnJlc2l6ZSgpO1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYWx3YXlzU2hvd1dvcmRzSGlzdG9yeSAmJiBjb25maWdfMS5kZWZhdWx0LmJ1cnN0SGVhdG1hcCkge1xuICAgICAgICAgICAgICAgIFRlc3RVSS5hcHBseUJ1cnN0SGVhdG1hcCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJChcIiNyZXN1bHRcIikudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKHsgdG9wOiAwIH0pO1xuICAgICAgICAgICAgJChcIiN0ZXN0TW9kZXNOb3RpY2VcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIH0sICgpID0+IHtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0RXh0cmFCdXR0b25zXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpLmNzcyhcIm9wYWNpdHlcIiwgMCkuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIH0sIDEyNSk7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5hbHdheXNTaG93V29yZHNIaXN0b3J5ICYmICFHbGFyc2VzTW9kZS5nZXQoKSkge1xuICAgICAgICAgICAgICAgIFRlc3RVSS50b2dnbGVSZXN1bHRXb3JkcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgS2V5bWFwLmhpZGUoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFJlc3VsdHNTaG93bkV2ZW50LmRpc3BhdGNoKHtcbiAgICAgICAgICAgIHJlcyxcbiAgICAgICAgICAgIGRpZmZpY3VsdHlGYWlsZWQsXG4gICAgICAgICAgICBmYWlsUmVhc29uLFxuICAgICAgICAgICAgYWZrRGV0ZWN0ZWQsXG4gICAgICAgICAgICBpc1JlcGVhdGVkLFxuICAgICAgICAgICAgdG9vU2hvcnQsXG4gICAgICAgICAgICByYW5kb21RdW90ZSxcbiAgICAgICAgICAgIGRvbnRTYXZlLFxuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMudXBkYXRlID0gdXBkYXRlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5pc1VzaW5nT3Bwb3NpdGVTaGlmdCA9IGV4cG9ydHMucmVzZXQgPSBleHBvcnRzLnJpZ2h0U3RhdGUgPSBleHBvcnRzLmxlZnRTdGF0ZSA9IHZvaWQgMDtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBjYXBzX3dhcm5pbmdfMSA9IHJlcXVpcmUoXCIuL2NhcHMtd2FybmluZ1wiKTtcbmV4cG9ydHMubGVmdFN0YXRlID0gZmFsc2U7XG5leHBvcnRzLnJpZ2h0U3RhdGUgPSBmYWxzZTtcbmxldCBjYXNlU3RhdGUgPSBmYWxzZTtcbmNvbnN0IGtleW1hcFN0cmluZ3MgPSB7XG4gICAgbGVmdDogbnVsbCxcbiAgICByaWdodDogbnVsbCxcbiAgICBrZXltYXA6IG51bGwsXG59O1xuZnVuY3Rpb24gZHluYW1pY0tleW1hcExlZ2VuZFN0eWxlKHVwcGVyY2FzZSkge1xuICAgIGNvbnN0IGtleW1hcEtleXMgPSBbXG4gICAgICAgIC4uLmRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJrZXltYXAta2V5XCIpLFxuICAgIF07XG4gICAgY29uc3QgbGF5b3V0S2V5cyA9IGtleW1hcEtleXMubWFwKChlbCkgPT4gZWwuZGF0YXNldFtcImtleVwiXSk7XG4gICAgY29uc3Qga2V5cyA9IGtleW1hcEtleXMubWFwKChlbCkgPT4gZWwuY2hpbGROb2Rlc1sxXSk7XG4gICAgaWYgKGNhcHNfd2FybmluZ18xLmNhcHNTdGF0ZSlcbiAgICAgICAgdXBwZXJjYXNlID0gIXVwcGVyY2FzZTtcbiAgICBpZiAobGF5b3V0S2V5cy5maWx0ZXIoKHYpID0+IHYgPT09IHVuZGVmaW5lZCkubGVuZ3RoID4gMilcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmICgodXBwZXJjYXNlICYmIGNhc2VTdGF0ZSkgfHwgKCF1cHBlcmNhc2UgJiYgIWNhc2VTdGF0ZSkpXG4gICAgICAgIHJldHVybjtcbiAgICBjYXNlU3RhdGUgPSB1cHBlcmNhc2U7XG4gICAgY29uc3QgaW5kZXggPSBjYXNlU3RhdGUgPyAxIDogMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxheW91dEtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgbGF5b3V0S2V5ID0gbGF5b3V0S2V5c1tpXSwga2V5ID0ga2V5c1tpXTtcbiAgICAgICAgaWYgKGtleSA9PT0gdW5kZWZpbmVkIHx8IGxheW91dEtleSA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIGtleS50ZXh0Q29udGVudCA9IGxheW91dEtleVtpbmRleF07XG4gICAgfVxufVxuZnVuY3Rpb24gYnVpbGRLZXltYXBTdHJpbmdzKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChrZXltYXBTdHJpbmdzLmtleW1hcCA9PT0gY29uZmlnXzEuZGVmYXVsdC5rZXltYXBMYXlvdXQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGxheW91dCA9IHlpZWxkIE1pc2MuZ2V0TGF5b3V0KGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTGF5b3V0KTtcbiAgICAgICAgaWYgKGxheW91dCA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBsYXlvdXRLZXlzID0gbGF5b3V0LmtleXM7XG4gICAgICAgIGNvbnN0IGxheW91dEtleXNFbnRyaWVzID0gT2JqZWN0LmVudHJpZXMobGF5b3V0S2V5cyk7XG4gICAgICAgIGtleW1hcFN0cmluZ3Mua2V5bWFwID0gY29uZmlnXzEuZGVmYXVsdC5rZXltYXBMYXlvdXQ7XG4gICAgICAgIGlmICghbGF5b3V0KSB7XG4gICAgICAgICAgICBrZXltYXBTdHJpbmdzLmxlZnQgPSBudWxsO1xuICAgICAgICAgICAga2V5bWFwU3RyaW5ncy5yaWdodCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBrZXltYXBTdHJpbmdzLmxlZnQgPSBsYXlvdXRLZXlzRW50cmllc1xuICAgICAgICAgICAgICAgIC5tYXAoKFtyb3dOYW1lLCByb3ddKSA9PiByb3dcbiAgICAgICAgICAgICAgICAvLyBpbmNsdWRlcyBcIjZcIiBhbmQgXCJ5XCIgKGJ1dHRvbnMgb24gcXdlcnR5KSBpbnRvIHRoZSBsZWZ0IGhhbmRcbiAgICAgICAgICAgICAgICAuc2xpY2UoMCwgW1wicm93MVwiLCBcInJvdzJcIl0uaW5jbHVkZXMocm93TmFtZSlcbiAgICAgICAgICAgICAgICA/IHJvd05hbWUgPT09IFwicm93MVwiXG4gICAgICAgICAgICAgICAgICAgID8gN1xuICAgICAgICAgICAgICAgICAgICA6IDZcbiAgICAgICAgICAgICAgICA6IDUpXG4gICAgICAgICAgICAgICAgLm1hcCgoa2V5KSA9PiBrZXkuc3BsaXQoXCJcIikpKVxuICAgICAgICAgICAgICAgIC5mbGF0KDIpO1xuICAgICAgICAgICAga2V5bWFwU3RyaW5ncy5yaWdodCA9IGxheW91dEtleXNFbnRyaWVzXG4gICAgICAgICAgICAgICAgLm1hcCgoW3Jvd05hbWUsIHJvd10pID0+IHJvd1xuICAgICAgICAgICAgICAgIC8vIGluY2x1ZGVzIFwiYlwiIChidXR0b25zIG9uIHF3ZXJ0eSkgaW50byB0aGUgcmlnaHQgaGFuZFxuICAgICAgICAgICAgICAgIC5zbGljZShbXCJyb3cxXCIsIFwicm93NFwiXS5pbmNsdWRlcyhyb3dOYW1lKVxuICAgICAgICAgICAgICAgID8gcm93TmFtZSA9PT0gXCJyb3cxXCJcbiAgICAgICAgICAgICAgICAgICAgPyA2XG4gICAgICAgICAgICAgICAgICAgIDogNFxuICAgICAgICAgICAgICAgIDogNSlcbiAgICAgICAgICAgICAgICAubWFwKChrZXkpID0+IGtleS5zcGxpdChcIlwiKSkpXG4gICAgICAgICAgICAgICAgLmZsYXQoMik7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbiQoZG9jdW1lbnQpLm9uKFwia2V5ZG93blwiLCAoZSkgPT4ge1xuICAgIGlmIChlLmNvZGUgPT09IFwiU2hpZnRMZWZ0XCIpIHtcbiAgICAgICAgZXhwb3J0cy5sZWZ0U3RhdGUgPSB0cnVlO1xuICAgICAgICBleHBvcnRzLnJpZ2h0U3RhdGUgPSBmYWxzZTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZS5jb2RlID09PSBcIlNoaWZ0UmlnaHRcIikge1xuICAgICAgICBleHBvcnRzLmxlZnRTdGF0ZSA9IGZhbHNlO1xuICAgICAgICBleHBvcnRzLnJpZ2h0U3RhdGUgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBMZWdlbmRTdHlsZSA9PT0gXCJkeW5hbWljXCIpIHtcbiAgICAgICAgZHluYW1pY0tleW1hcExlZ2VuZFN0eWxlKGV4cG9ydHMubGVmdFN0YXRlIHx8IGV4cG9ydHMucmlnaHRTdGF0ZSk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50KS5rZXl1cCgoZSkgPT4ge1xuICAgIGlmIChlLmNvZGUgPT09IFwiU2hpZnRMZWZ0XCIgfHwgZS5jb2RlID09PSBcIlNoaWZ0UmlnaHRcIikge1xuICAgICAgICBleHBvcnRzLmxlZnRTdGF0ZSA9IGZhbHNlO1xuICAgICAgICBleHBvcnRzLnJpZ2h0U3RhdGUgPSBmYWxzZTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTGVnZW5kU3R5bGUgPT09IFwiZHluYW1pY1wiKSB7XG4gICAgICAgIGR5bmFtaWNLZXltYXBMZWdlbmRTdHlsZShleHBvcnRzLmxlZnRTdGF0ZSB8fCBleHBvcnRzLnJpZ2h0U3RhdGUpO1xuICAgIH1cbn0pO1xuZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgZXhwb3J0cy5sZWZ0U3RhdGUgPSBmYWxzZTtcbiAgICBleHBvcnRzLnJpZ2h0U3RhdGUgPSBmYWxzZTtcbn1cbmV4cG9ydHMucmVzZXQgPSByZXNldDtcbmNvbnN0IGxlZnRTaWRlS2V5cyA9IFtcbiAgICBcIktleVFcIixcbiAgICBcIktleVdcIixcbiAgICBcIktleUVcIixcbiAgICBcIktleVJcIixcbiAgICBcIktleVRcIixcbiAgICBcIktleUFcIixcbiAgICBcIktleVNcIixcbiAgICBcIktleURcIixcbiAgICBcIktleUZcIixcbiAgICBcIktleUdcIixcbiAgICBcIktleVpcIixcbiAgICBcIktleVhcIixcbiAgICBcIktleUNcIixcbiAgICBcIktleVZcIixcbiAgICBcIkJhY2txdW90ZVwiLFxuICAgIFwiRGlnaXQxXCIsXG4gICAgXCJEaWdpdDJcIixcbiAgICBcIkRpZ2l0M1wiLFxuICAgIFwiRGlnaXQ0XCIsXG4gICAgXCJEaWdpdDVcIixcbl07XG5jb25zdCByaWdodFNpZGVLZXlzID0gW1xuICAgIFwiS2V5VVwiLFxuICAgIFwiS2V5SVwiLFxuICAgIFwiS2V5T1wiLFxuICAgIFwiS2V5UFwiLFxuICAgIFwiS2V5SFwiLFxuICAgIFwiS2V5SlwiLFxuICAgIFwiS2V5S1wiLFxuICAgIFwiS2V5TFwiLFxuICAgIFwiS2V5TlwiLFxuICAgIFwiS2V5TVwiLFxuICAgIFwiRGlnaXQ3XCIsXG4gICAgXCJEaWdpdDhcIixcbiAgICBcIkRpZ2l0OVwiLFxuICAgIFwiRGlnaXQwXCIsXG4gICAgXCJCYWNrc2xhc2hcIixcbiAgICBcIkJyYWNrZXRMZWZ0XCIsXG4gICAgXCJCcmFja2V0UmlnaHRcIixcbiAgICBcIlNlbWljb2xvblwiLFxuICAgIFwiUXVvdGVcIixcbiAgICBcIkNvbW1hXCIsXG4gICAgXCJQZXJpb2RcIixcbiAgICBcIlNsYXNoXCIsXG5dO1xuZnVuY3Rpb24gaXNVc2luZ09wcG9zaXRlU2hpZnQoZXZlbnQpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoIWV4cG9ydHMubGVmdFN0YXRlICYmICFleHBvcnRzLnJpZ2h0U3RhdGUpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQub3Bwb3NpdGVTaGlmdE1vZGUgPT09IFwib25cIikge1xuICAgICAgICAgICAgaWYgKCFyaWdodFNpZGVLZXlzLmluY2x1ZGVzKGV2ZW50LmNvZGUpICYmXG4gICAgICAgICAgICAgICAgIWxlZnRTaWRlS2V5cy5pbmNsdWRlcyhldmVudC5jb2RlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKChleHBvcnRzLmxlZnRTdGF0ZSAmJiByaWdodFNpZGVLZXlzLmluY2x1ZGVzKGV2ZW50LmNvZGUpKSB8fFxuICAgICAgICAgICAgICAgIChleHBvcnRzLnJpZ2h0U3RhdGUgJiYgbGVmdFNpZGVLZXlzLmluY2x1ZGVzKGV2ZW50LmNvZGUpKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQub3Bwb3NpdGVTaGlmdE1vZGUgPT09IFwia2V5bWFwXCIpIHtcbiAgICAgICAgICAgIHlpZWxkIGJ1aWxkS2V5bWFwU3RyaW5ncygpO1xuICAgICAgICAgICAgaWYgKCFrZXltYXBTdHJpbmdzLmxlZnQgfHwgIWtleW1hcFN0cmluZ3MucmlnaHQpXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICBpZiAoKGV4cG9ydHMubGVmdFN0YXRlICYmIGtleW1hcFN0cmluZ3MucmlnaHQuaW5jbHVkZXMoZXZlbnQua2V5KSkgfHxcbiAgICAgICAgICAgICAgICAoZXhwb3J0cy5yaWdodFN0YXRlICYmIGtleW1hcFN0cmluZ3MubGVmdC5pbmNsdWRlcyhldmVudC5rZXkpKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xufVxuZXhwb3J0cy5pc1VzaW5nT3Bwb3NpdGVTaGlmdCA9IGlzVXNpbmdPcHBvc2l0ZVNoaWZ0O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZ2V0VGJkTW9kZSA9IHZvaWQgMDtcbmNvbnN0IHdvcmRzZXRfMSA9IHJlcXVpcmUoXCIuL3dvcmRzZXRcIik7XG5jb25zdCBUZXN0SW5wdXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC1pbnB1dFwiKSk7XG5jb25zdCBQYWdlQ2hhbmdlRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL3BhZ2UtY2hhbmdlLWV2ZW50XCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuY29uc3QgbWlzY18xID0gcmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIik7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IENvbmZpZ1N0dWZmID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuY29uc3QgUmVzdWx0c1Nob3duRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL3Jlc3VsdHMtc2hvd24tZXZlbnRcIikpO1xuY29uc3QgV29yZFR5cGVkRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL3dvcmQtdHlwZWQtZXZlbnRcIikpO1xuY29uc3QgUmVzZXRSZXF1ZXN0ZWRFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvcmVzZXQtcmVxdWVzdGVkLWV2ZW50XCIpKTtcbmNvbnN0IGRlYm91bmNlXzEgPSByZXF1aXJlKFwiLi4vdXRpbHMvZGVib3VuY2VcIik7XG5jbGFzcyBUYmRDb25maWcge1xuICAgIGluaXQoKSB7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwic29ydGVyU2VsZWN0Q2hhbmdlZFwiLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXQoXCJzb3J0ZXJcIiwgZGF0YVtcInZhbHVlXCJdKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwiY29uZmlnVXBkYXRlUmVxdWVzdGVkXCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKGRhdGFbXCJjb25maWdTZXR0aW5nXCJdKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcInRhcmdldFNwZWVkXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvY2Vzc1RhcmdldFNwZWVkVXBkYXRlUmVxdWVzdCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZ3JvdXBTaXplXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvY2Vzc0dyb3VwU2l6ZVVwZGF0ZVJlcXVlc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImFuaW1hdGlvbnNcIjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzQW5pbWF0aW9uVG9nZ2xlUmVxdWVzdCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwidW5iZWF0ZW5Xb3JkUGVyY2VudGFnZVwiOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NVbmJlYXRlbldvcmRQZXJjZW50YWdlUmVxdWVzdCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldChrZXksIGRlZmF1bHRWYWx1ZSA9IFwiXCIpIHtcbiAgICAgICAgY29uc3QgY29uZmlnRGF0YSA9IFRiZERhdGEuZ2V0QWxsKCkuY29uZmlnO1xuICAgICAgICByZXR1cm4gY29uZmlnRGF0YVtrZXldIHx8IGRlZmF1bHRWYWx1ZTtcbiAgICB9XG4gICAgc2V0KGtleSwgdmFsdWUpIHtcbiAgICAgICAgY29uc3Qgb3JpZ2luYWwgPSB0aGlzLmdldChrZXkpO1xuICAgICAgICBpZiAob3JpZ2luYWwgPT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkYXRhID0gVGJkRGF0YS5nZXRBbGwoKTtcbiAgICAgICAgZGF0YS5jb25maWdba2V5XSA9IHZhbHVlO1xuICAgICAgICBUYmREYXRhLnVwZGF0ZURhdGEoZGF0YSk7XG4gICAgICAgIFRiZEV2ZW50cy5kaXNwYXRjaEV2ZW50KGAke2tleX0tY2hhbmdlZGAsIHtcbiAgICAgICAgICAgIG9yaWdpbmFsOiBvcmlnaW5hbCxcbiAgICAgICAgICAgIG5ld1ZhbHVlOiB2YWx1ZSxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGJ1bXBUYXJnZXRTcGVlZCgpIHtcbiAgICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuZ2V0VGFyZ2V0U3BlZWQoKTtcbiAgICAgICAgdGhpcy5zZXQoXCJ0YXJnZXRTcGVlZFwiLCAoY3VycmVudCArIDUpLnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgICBnZXRTb3J0ZXJOYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXQoXCJzb3J0ZXJcIiwgXCJhbHBoYWJldGljYWwtYXNjXCIpO1xuICAgIH1cbiAgICBnZXRTb3J0ZXIoKSB7XG4gICAgICAgIHJldHVybiBUYmRTb3J0aW5nLmdldFNvcnRlcih0aGlzLmdldFNvcnRlck5hbWUoKSk7XG4gICAgfVxuICAgIGdldFRhcmdldFNwZWVkKCkge1xuICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5nZXQoXCJ0YXJnZXRTcGVlZFwiLCBcIjc1XCIpKTtcbiAgICB9XG4gICAgZ2V0R3JvdXBTaXplKCkge1xuICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5nZXQoXCJncm91cFNpemVcIiwgXCIzMFwiKSk7XG4gICAgfVxuICAgIGdldFVuYmVhdGVuV29yZFBlcmNlbnRhZ2UoKSB7XG4gICAgICAgIHJldHVybiBwYXJzZUludCh0aGlzLmdldChcInVuYmVhdGVuV29yZFBlcmNlbnRhZ2VcIiwgXCI2MFwiKSk7XG4gICAgfVxuICAgIHByb2Nlc3NUYXJnZXRTcGVlZFVwZGF0ZVJlcXVlc3QoKSB7XG4gICAgICAgIGNvbnN0IG5ld1NwZWVkID0gcGFyc2VJbnQocHJvbXB0KFwiTmV3IHRhcmdldCBzcGVlZFwiLCB0aGlzLmdldFRhcmdldFNwZWVkKCkudG9TdHJpbmcoKSkgfHwgXCJcIik7XG4gICAgICAgIGlmIChuZXdTcGVlZCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuc2V0KFwidGFyZ2V0U3BlZWRcIiwgbmV3U3BlZWQudG9TdHJpbmcoKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJvY2Vzc0FuaW1hdGlvblRvZ2dsZVJlcXVlc3QoKSB7XG4gICAgICAgIGNvbnN0IGVuYWJsZWQgPSBjb25maXJtKFwiQ29uZmlybSB0byBlbmFibGUsIGNhbmNlbCB0byBkaXNhYmxlLlwiKTtcbiAgICAgICAgaWYgKGVuYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0KFwiYW5pbWF0aW9uc0VuYWJsZWRcIiwgXCIxXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXQoXCJhbmltYXRpb25zRW5hYmxlZFwiLCBcIjBcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXJlQW5pbWF0aW9uc0VuYWJsZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldChcImFuaW1hdGlvbnNFbmFibGVkXCIsIFwiMVwiKSA9PSBcIjFcIjtcbiAgICB9XG4gICAgcHJvY2Vzc0dyb3VwU2l6ZVVwZGF0ZVJlcXVlc3QoKSB7XG4gICAgICAgIGNvbnN0IG5ld1NpemUgPSBwYXJzZUludChwcm9tcHQoXCJOZXcgZ3JvdXAgc2l6ZVwiLCB0aGlzLmdldEdyb3VwU2l6ZSgpLnRvU3RyaW5nKCkpIHx8IFwiXCIpO1xuICAgICAgICBpZiAobmV3U2l6ZSA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuc2V0KFwiZ3JvdXBTaXplXCIsIG5ld1NpemUudG9TdHJpbmcoKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJvY2Vzc1VuYmVhdGVuV29yZFBlcmNlbnRhZ2VSZXF1ZXN0KCkge1xuICAgICAgICBjb25zdCBuZXdQZXJjZW50YWdlID0gcGFyc2VJbnQocHJvbXB0KGBUaGUgb2RkcyAoc3RpbGwgcmFuZG9tKSB0aGF0IGEgdGVzdCB3b3JkIHdpbGwgYmUgb25lIHRoYXQgaGFzbid0IGJlZW4gdHlwZWQgZmFzdGVyIHRoYW4gdGhlIGN1cnJlbnQgZ3JvdXAgdGhyZXNob2xkLiBcbiAgICAgICAgXG4gICAgICAgIE11c3QgYmUgYmV0d2VlbiAxMC05MGAsIHRoaXMuZ2V0VW5iZWF0ZW5Xb3JkUGVyY2VudGFnZSgpLnRvU3RyaW5nKCkpIHx8IFwiXCIpO1xuICAgICAgICBpZiAoaXNOYU4obmV3UGVyY2VudGFnZSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmV3UGVyY2VudGFnZSA8IDEwIHx8IG5ld1BlcmNlbnRhZ2UgPiA5MCkge1xuICAgICAgICAgICAgYWxlcnQoYCR7bmV3UGVyY2VudGFnZX0gaXNuJ3QgYSB2YWxpZCBjaG9pY2UuYCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXQoXCJ1bmJlYXRlbldvcmRQZXJjZW50YWdlXCIsIG5ld1BlcmNlbnRhZ2UudG9TdHJpbmcoKSk7XG4gICAgfVxufVxuY2xhc3MgVGJkU29ydGluZyB7XG4gICAgc3RhdGljIGdldFNvcnRlcihuYW1lKSB7XG4gICAgICAgIHN3aXRjaCAobmFtZSkge1xuICAgICAgICAgICAgY2FzZSBcImFscGhhYmV0aWNhbC1hc2NcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gVGJkU29ydGluZy5hbHBoYWJldGljYWxBc2NlbmRpbmdTb3J0ZXI7XG4gICAgICAgICAgICBjYXNlIFwiYWxwaGFiZXRpY2FsLWRlc2NcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gVGJkU29ydGluZy5hbHBoYWJldGljYWxEZXNjZW5kaW5nU29ydGVyO1xuICAgICAgICAgICAgY2FzZSBcInNwZWVkLWFzY1wiOlxuICAgICAgICAgICAgICAgIHJldHVybiBUYmRTb3J0aW5nLnNwZWVkQXNjZW5kaW5nU29ydGVyO1xuICAgICAgICAgICAgY2FzZSBcInNwZWVkLWRlc2NcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gVGJkU29ydGluZy5zcGVlZERlc2NlbmRpbmdTb3J0ZXI7XG4gICAgICAgICAgICBjYXNlIFwidHlwZWRDb3VudFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBUYmRTb3J0aW5nLnR5cGVkQ291bnRTb3J0ZXI7XG4gICAgICAgICAgICBjYXNlIFwibWlzc2VkQ291bnRcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gVGJkU29ydGluZy5taXNzZWRDb3VudFNvcnRlcjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gVGJkU29ydGluZy5hbHBoYWJldGljYWxBc2NlbmRpbmdTb3J0ZXI7XG4gICAgfVxuICAgIHN0YXRpYyByYW5kb21Tb3J0ZXIoKSB7XG4gICAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpIDwgMC41ID8gLTEgOiAxO1xuICAgIH1cbiAgICBzdGF0aWMgYWxwaGFiZXRpY2FsRGVzY2VuZGluZ1NvcnRlcih3b3JkLCB3b3JkMikge1xuICAgICAgICByZXR1cm4gd29yZC50b0xvd2VyQ2FzZSgpIDwgd29yZDIudG9Mb3dlckNhc2UoKSA/IDEgOiAtMTtcbiAgICB9XG4gICAgc3RhdGljIGFscGhhYmV0aWNhbEFzY2VuZGluZ1NvcnRlcih3b3JkLCB3b3JkMikge1xuICAgICAgICByZXR1cm4gd29yZC50b0xvd2VyQ2FzZSgpIDwgd29yZDIudG9Mb3dlckNhc2UoKSA/IC0xIDogMTtcbiAgICB9XG4gICAgc3RhdGljIHNwZWVkQXNjZW5kaW5nU29ydGVyKHdvcmQsIHdvcmQyKSB7XG4gICAgICAgIGNvbnN0IHNwZWVkMSA9IFRiZERhdGEuZ2V0TWVkaWFuU3BlZWRGb3JXb3JkKHdvcmQpO1xuICAgICAgICBjb25zdCBzcGVlZDIgPSBUYmREYXRhLmdldE1lZGlhblNwZWVkRm9yV29yZCh3b3JkMik7XG4gICAgICAgIHJldHVybiBzcGVlZDEgLSBzcGVlZDI7XG4gICAgfVxuICAgIHN0YXRpYyBzcGVlZERlc2NlbmRpbmdTb3J0ZXIod29yZCwgd29yZDIpIHtcbiAgICAgICAgY29uc3Qgc3BlZWQxID0gVGJkRGF0YS5nZXRNZWRpYW5TcGVlZEZvcldvcmQod29yZCk7XG4gICAgICAgIGNvbnN0IHNwZWVkMiA9IFRiZERhdGEuZ2V0TWVkaWFuU3BlZWRGb3JXb3JkKHdvcmQyKTtcbiAgICAgICAgcmV0dXJuIHNwZWVkMiAtIHNwZWVkMTtcbiAgICB9XG4gICAgc3RhdGljIHR5cGVkQ291bnRTb3J0ZXIod29yZCwgd29yZDIpIHtcbiAgICAgICAgY29uc3QgdHlwZWQxID0gVGJkRGF0YS5nZXRTcGVlZHNGb3JXb3JkKHdvcmQpLmxlbmd0aDtcbiAgICAgICAgY29uc3QgdHlwZWQyID0gVGJkRGF0YS5nZXRTcGVlZHNGb3JXb3JkKHdvcmQyKS5sZW5ndGg7XG4gICAgICAgIHJldHVybiB0eXBlZDIgLSB0eXBlZDE7XG4gICAgfVxuICAgIHN0YXRpYyBtaXNzZWRDb3VudFNvcnRlcih3b3JkLCB3b3JkMikge1xuICAgICAgICByZXR1cm4gKFRiZERhdGEuZ2V0TWlzdHlwZWRDb3VudEZvcldvcmQod29yZDIpIC1cbiAgICAgICAgICAgIFRiZERhdGEuZ2V0TWlzdHlwZWRDb3VudEZvcldvcmQod29yZCkpO1xuICAgIH1cbn1cbmNsYXNzIFRiZE1vZGUge1xuICAgIGNvbnN0cnVjdG9yKGNvbmZpZykge1xuICAgICAgICB0aGlzLnByZXZpb3VzV29yZCA9IFwiXCI7XG4gICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgICAgICB0aGlzLm1vbmtleVR5cGVXb3Jkc2V0ID0gbmV3IHdvcmRzZXRfMS5Xb3Jkc2V0KFtdKTtcbiAgICAgICAgdGhpcy5jdXJyZW50R3JvdXAgPSBuZXcgVGJkR3JvdXAodGhpcy5tb25rZXlUeXBlV29yZHNldCk7XG4gICAgICAgIHRoaXMuZ3JvdXBzID0gbmV3IFRiZEdyb3VwcygpO1xuICAgIH1cbiAgICBpbml0KCkge1xuICAgICAgICBXb3JkVHlwZWRFdmVudC5zdWJzY3JpYmUodGhpcy5oYW5kbGVXb3JkVHlwZWQuYmluZCh0aGlzKSk7XG4gICAgICAgIFJlc3VsdHNTaG93bkV2ZW50LnN1YnNjcmliZSh0aGlzLmhhbmRsZVJlc3VsdHNTaG93bkV2ZW50LmJpbmQodGhpcykpO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcInJlc2V0QnV0dG9uQ2xpY2tlZFwiLCB0aGlzLnJlc2V0Q3VycmVudFdvcmRzLmJpbmQodGhpcykpO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcIndvcmRDbGlja2VkXCIsIHRoaXMucmVzZXRXb3JkLmJpbmQodGhpcykpO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcInRhcmdldFNwZWVkLWNoYW5nZWRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZWdlbmVyYXRlR3JvdXBzRnJvbVdvcmRzZXQodGhpcy5tb25rZXlUeXBlV29yZHNldCk7XG4gICAgICAgIH0pO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcImdyb3VwU2l6ZS1jaGFuZ2VkXCIsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVnZW5lcmF0ZUdyb3Vwc0Zyb21Xb3Jkc2V0KHRoaXMubW9ua2V5VHlwZVdvcmRzZXQpO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJ3b3Jkc1Jlc2V0XCIsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVnZW5lcmF0ZUdyb3Vwc0Zyb21Xb3Jkc2V0KHRoaXMubW9ua2V5VHlwZVdvcmRzZXQpO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJuZXh0R3JvdXBcIiwgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEdyb3VwID0gZGF0YVtcImdyb3VwXCJdO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJncm91cHNSZWdlbmVyYXRlZFwiLCAoKSA9PiB7XG4gICAgICAgICAgICBSZXNldFJlcXVlc3RlZEV2ZW50LmRpc3BhdGNoKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcIm5leHRHcm91cEJ1dHRvbkNsaWNrZWRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuZ3JvdXBzLmdldEdyb3VwcygpLmxlbmd0aCA8PSAxKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgY3VycmVudEdyb3VwSW5kZXggPSB0aGlzLmdldEN1cnJlbnRHcm91cEluZGV4KCk7XG4gICAgICAgICAgICBsZXQgbmV4dEluZGV4ID0gY3VycmVudEdyb3VwSW5kZXggKyAxO1xuICAgICAgICAgICAgLy8gQWxsb3cgY3ljbGluZyB0aHJvdWdoIGdyb3Vwc1xuICAgICAgICAgICAgaWYgKG5leHRJbmRleCA9PSB0aGlzLmdyb3Vwcy5nZXRHcm91cHMoKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBuZXh0SW5kZXggPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJuZXh0R3JvdXBcIiwge1xuICAgICAgICAgICAgICAgIGdyb3VwOiB0aGlzLmdyb3Vwcy5nZXRHcm91cHMoKVtuZXh0SW5kZXhdLFxuICAgICAgICAgICAgICAgIGdyb3VwTnVtYmVyOiBuZXh0SW5kZXggKyAxLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcImFjdGlvbkJ1dHRvbkNsaWNrZWRcIiwgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIHN3aXRjaCAoZGF0YVtcImFjdGlvblZhbHVlXCJdKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcInJlc2V0Q3VycmVudFdvcmRzXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzZXRDdXJyZW50V29yZHNSZXF1ZXN0KCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJyZXNldEFsbFdvcmRzXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzZXRBbGxXb3Jkc1JlcXVlc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImNvcHlBbGxEYXRhXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlQ29weURhdGFSZXF1ZXN0KCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJpbXBvcnREYXRhXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlSW1wb3J0RGF0YVJlcXVlc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoYW5kbGVXb3JkVHlwZWQoX3dvcmQsIGlzQ29ycmVjdCwgYnVyc3QsIGN1cnJlbnRXb3JkRWxlbWVudCkge1xuICAgICAgICBpZiAoIWlzQ29ycmVjdCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHdvcmRFbGVtZW50ID0gY3VycmVudFdvcmRFbGVtZW50O1xuICAgICAgICBjb25zdCB0eXBlZEFib3ZlVGFyZ2V0ID0gYnVyc3QgPiB0aGlzLmdldENvbmZpZygpLmdldFRhcmdldFNwZWVkKCk7XG4gICAgICAgIGlmICh0eXBlZEFib3ZlVGFyZ2V0KSB7XG4gICAgICAgICAgICBUYmRFdmVudHMuZGlzcGF0Y2hFdmVudChcIndvcmRUeXBlZENvcnJlY3RseVwiLCB7IHdvcmRFbGVtZW50IH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJ3b3JkTWlzc2VkXCIsIHsgd29yZEVsZW1lbnQgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlUmVzZXRDdXJyZW50V29yZHNSZXF1ZXN0KCkge1xuICAgICAgICBpZiAoY29uZmlybShcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byByZXNldCBkYXRhIGZvciB0aGUgY3VycmVudCB3b3Jkc2V0PyBUaGlzIGluY2x1ZGVzIGFsbFwiICtcbiAgICAgICAgICAgIFwiIHdvcmRzIGluIHRoZSBsYW5ndWFnZSBvciBjdXN0b20gd29yZCBzZXQgeW91IGFyZSB1c2luZywgbm90IGp1c3QgdGhlIGN1cnJlbnQgZ3JvdXAhXCIpKSB7XG4gICAgICAgICAgICBUYmREYXRhLnJlc2V0RGF0YUZvcldvcmRzKHRoaXMubW9ua2V5VHlwZVdvcmRzZXQud29yZHMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZUNvcHlEYXRhUmVxdWVzdCgpIHtcbiAgICAgICAgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQoSlNPTi5zdHJpbmdpZnkoVGJkRGF0YS5nZXRBbGwoKSkpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgYWxlcnQoXCJKU09OIGNvcGllZCB0byB5b3VyIGNsaXBib2FyZFwiKTtcbiAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgYWxlcnQoXCJUaGVyZSB3YXMgYSBwcm9ibGVtIGNvcHlpbmcgdGhlIGRhdGEgdG8geW91ciBjbGlwYm9hcmRcIik7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoYW5kbGVJbXBvcnREYXRhUmVxdWVzdCgpIHtcbiAgICAgICAgY29uc3QgZXhwb3J0SnNvbiA9IHByb21wdChcIkVudGVyIHRoZSBKU09OIHlvdSBnb3QgZnJvbSBhbiBleHBvcnQgaGVyZVwiKSB8fCBcIlwiO1xuICAgICAgICBpZiAoZXhwb3J0SnNvbiA9PSBcIlwiKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShleHBvcnRKc29uKTtcbiAgICAgICAgaWYgKFwid29yZHNcIiBpbiBwYXJzZWQgJiYgXCJjb25maWdcIiBpbiBwYXJzZWQpIHtcbiAgICAgICAgICAgIFRiZERhdGEudXBkYXRlRGF0YShwYXJzZWQsIHRydWUpO1xuICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhbGVydChcIlRoZXJlIHdhcyBzb21ldGhpbmcgd3Jvbmcgd2l0aCB5b3VyIEpTT04sIHNvcnJ5IVwiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRDb25maWcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbmZpZztcbiAgICB9XG4gICAgZ2V0V29yZChvcmlnaW5hbFdvcmRzZXQpIHtcbiAgICAgICAgdGhpcy5oYW5kbGVXb3Jkc2V0Rm9yTmV4dFdvcmQob3JpZ2luYWxXb3Jkc2V0KTtcbiAgICAgICAgY29uc3QgZ3JvdXAgPSB0aGlzLmdldEN1cnJlbnRHcm91cCgpO1xuICAgICAgICBjb25zdCByYW5kb20gPSBNYXRoLnJhbmRvbSgpICogMTAwO1xuICAgICAgICBjb25zdCB1bmJlYXRlbldvcmRzZXQgPSBncm91cC5nZXRVbmJlYXRlbldvcmRzZXQoKTtcbiAgICAgICAgY29uc3QgaXNUaGVyZU1vcmVUaGFuT25lV29yZCA9IGdyb3VwLmdldFdvcmRzZXQoKS5sZW5ndGggPiAxO1xuICAgICAgICBsZXQgbmV4dFdvcmQ7XG4gICAgICAgIGlmICh1bmJlYXRlbldvcmRzZXQubGVuZ3RoID4gMCAmJlxuICAgICAgICAgICAgcmFuZG9tIDw9IHRoaXMuZ2V0Q29uZmlnKCkuZ2V0VW5iZWF0ZW5Xb3JkUGVyY2VudGFnZSgpKSB7XG4gICAgICAgICAgICBuZXh0V29yZCA9IHVuYmVhdGVuV29yZHNldC5yYW5kb21Xb3JkKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBuZXh0V29yZCA9IGdyb3VwLmdldFdvcmRzZXQoKS5yYW5kb21Xb3JkKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucHJldmlvdXNXb3JkID09IG5leHRXb3JkICYmIGlzVGhlcmVNb3JlVGhhbk9uZVdvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFdvcmQob3JpZ2luYWxXb3Jkc2V0KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnByZXZpb3VzV29yZCA9IG5leHRXb3JkO1xuICAgICAgICByZXR1cm4gbmV4dFdvcmQ7XG4gICAgfVxuICAgIGdldEN1cnJlbnRHcm91cCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEdyb3VwO1xuICAgIH1cbiAgICBnZXRGaXJzdEluY29tcGxldGVHcm91cCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ3JvdXBzLmdldEZpcnN0SW5jb21wbGV0ZUdyb3VwKHRoaXMuY29uZmlnLmdldFRhcmdldFNwZWVkKCkpO1xuICAgIH1cbiAgICByZWNhbGN1bGF0ZUN1cnJlbnRHcm91cCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZ2V0Q3VycmVudEdyb3VwKCkuZ2V0VW5iZWF0ZW5Xb3Jkc2V0KCkubGVuZ3RoID4gMCAmJlxuICAgICAgICAgICAgdGhpcy5nZXRDdXJyZW50R3JvdXAoKS5nZXRUaHJlc2hvbGQoKSA8PSB0aGlzLmdldENvbmZpZygpLmdldFRhcmdldFNwZWVkKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5nZXRDdXJyZW50R3JvdXBJbmRleCgpO1xuICAgICAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJuZXh0R3JvdXBcIiwge1xuICAgICAgICAgICAgICAgIGdyb3VwOiB0aGlzLmdldEN1cnJlbnRHcm91cCgpLFxuICAgICAgICAgICAgICAgIGdyb3VwTnVtYmVyOiBpbmRleCArIDEsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgbmV4dCA9IHRoaXMuZ2V0Rmlyc3RJbmNvbXBsZXRlR3JvdXAoKTtcbiAgICAgICAgd2hpbGUgKG5leHQgPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5nZXRDb25maWcoKS5idW1wVGFyZ2V0U3BlZWQoKTsgLy8gc2lkZSBlZmZlY3RzLCByZWdlbmVyYXRlcyBhbGwgZ3JvdXBzXG4gICAgICAgICAgICBuZXh0ID0gdGhpcy5nZXRGaXJzdEluY29tcGxldGVHcm91cCgpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5ncm91cHMuZ2V0R3JvdXBzKCkuaW5kZXhPZih0aGlzLmN1cnJlbnRHcm91cCk7XG4gICAgICAgIFRiZEV2ZW50cy5kaXNwYXRjaEV2ZW50KFwibmV4dEdyb3VwXCIsIHtcbiAgICAgICAgICAgIGdyb3VwOiBuZXh0LFxuICAgICAgICAgICAgZ3JvdXBOdW1iZXI6IGluZGV4ICsgMSxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldEN1cnJlbnRHcm91cEluZGV4KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ncm91cHMuZ2V0R3JvdXBzKCkuaW5kZXhPZih0aGlzLmdldEN1cnJlbnRHcm91cCgpKTtcbiAgICB9XG4gICAgZ2V0TW9ua2V5VHlwZVdvcmRzZXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1vbmtleVR5cGVXb3Jkc2V0O1xuICAgIH1cbiAgICBoYW5kbGVXb3Jkc2V0Rm9yTmV4dFdvcmQod29yZHNldCkge1xuICAgICAgICBpZiAodGhpcy5tb25rZXlUeXBlV29yZHNldC5sZW5ndGggIT0gd29yZHNldC5sZW5ndGggJiZcbiAgICAgICAgICAgIHdvcmRzZXQud29yZHMuam9pbihcIiRcIikgIT0gdGhpcy5tb25rZXlUeXBlV29yZHNldC53b3Jkcy5qb2luKFwiJFwiKSkge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVOZXdXb3Jkc2V0KHdvcmRzZXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZU5ld1dvcmRzZXQod29yZHNldCkge1xuICAgICAgICB0aGlzLm1vbmtleVR5cGVXb3Jkc2V0ID0gd29yZHNldDtcbiAgICAgICAgdGhpcy5yZWdlbmVyYXRlR3JvdXBzRnJvbVdvcmRzZXQod29yZHNldCk7XG4gICAgfVxuICAgIHJlZ2VuZXJhdGVHcm91cHNGcm9tV29yZHNldCh3b3Jkc2V0KSB7XG4gICAgICAgIGNvbnN0IG5vdEFib3ZlVGFyZ2V0U3BlZWQgPSB3b3Jkc2V0LndvcmRzLmZpbHRlcigod29yZCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuICFUYmREYXRhLmhhc1dvcmRCZWVuVHlwZWRGYXN0ZXJUaGFuKHdvcmQsIHRoaXMuY29uZmlnLmdldFRhcmdldFNwZWVkKCkpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgdW5pcXVlQmVsb3dUYXJnZXQgPSBuZXcgU2V0KG5vdEFib3ZlVGFyZ2V0U3BlZWQpO1xuICAgICAgICBpZiAodW5pcXVlQmVsb3dUYXJnZXQuc2l6ZSA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmdldENvbmZpZygpLmJ1bXBUYXJnZXRTcGVlZCgpO1xuICAgICAgICAgICAgLy8gQnVtcGluZyB0aGUgdGFyZ2V0IHRyaWdnZXJzIGEgcmVnZW5lcmF0aW9uIG9mIGdyb3VwcyBhbmQgaW5maW5pdGUgbG9vcHMgYXJlIG5vIGZ1blxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZ3JvdXBzLnJlZ2VuZXJhdGVHcm91cHMoQXJyYXkuZnJvbSh1bmlxdWVCZWxvd1RhcmdldCksIHRoaXMuY29uZmlnLmdldEdyb3VwU2l6ZSgpKTtcbiAgICB9XG4gICAgaGFuZGxlUmVzdWx0c1Nob3duRXZlbnQocmVzdWx0cykge1xuICAgICAgICBpZiAoIXJlc3VsdHMuZGlmZmljdWx0eUZhaWxlZCkge1xuICAgICAgICAgICAgdGhpcy5zYXZlQnVyc3RzRnJvbUxhdGVzdFJlc3VsdHMoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNhdmVNaXNzZXNGcm9tTGF0ZXN0UmVzdWx0KCk7XG4gICAgICAgIHRoaXMucmVjYWxjdWxhdGVDdXJyZW50R3JvdXAoKTtcbiAgICAgICAgdGhpcy5nZXRDdXJyZW50R3JvdXAoKS5pbmNyZWFzZVRocmVzaG9sZFVudGlsU29tZVdvcmRzQXJlVW5iZWF0ZW4oKTtcbiAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJyZXN1bHRzUHJvY2Vzc2VkXCIsIHtcbiAgICAgICAgICAgIGN1cnJlbnRHcm91cDogdGhpcy5nZXRDdXJyZW50R3JvdXAoKSxcbiAgICAgICAgICAgIG1vbmtleVR5cGVXb3Jkc2V0OiB0aGlzLm1vbmtleVR5cGVXb3Jkc2V0LFxuICAgICAgICAgICAgdGFyZ2V0U3BlZWQ6IHRoaXMuY29uZmlnLmdldFRhcmdldFNwZWVkKCksXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzYXZlQnVyc3RzRnJvbUxhdGVzdFJlc3VsdHMoKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdFdvcmRzID0gVGVzdElucHV0LmlucHV0Lmhpc3Rvcnk7XG4gICAgICAgIGNvbnN0IHJlc3VsdEJ1cnN0cyA9IFRlc3RJbnB1dC5idXJzdEhpc3Rvcnk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVzdWx0V29yZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHdvcmQgPSByZXN1bHRXb3Jkc1tpXTtcbiAgICAgICAgICAgIGNvbnN0IGJ1cnN0ID0gcmVzdWx0QnVyc3RzW2ldO1xuICAgICAgICAgICAgVGJkRGF0YS5hZGRCdXJzdCh3b3JkLCBidXJzdCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVzZXRDdXJyZW50V29yZHMoKSB7XG4gICAgICAgIGlmICghY29uZmlybShcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byByZXNldCB0aGUgc3RhdHMgZm9yIHRoZSBjdXJyZW50IHdvcmRzP1wiKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIFRiZERhdGEucmVzZXREYXRhRm9yV29yZHModGhpcy5tb25rZXlUeXBlV29yZHNldC53b3Jkcyk7XG4gICAgfVxuICAgIHJlc2V0V29yZChkYXRhKSB7XG4gICAgICAgIGNvbnN0IHdvcmQgPSBkYXRhW1wid29yZFwiXTtcbiAgICAgICAgaWYgKCFjb25maXJtKGBSZXNldCBhbGwgZGF0YSBmb3IgJHt3b3JkfT9gKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIFRiZERhdGEucmVzZXREYXRhRm9yV29yZCh3b3JkKTtcbiAgICB9XG4gICAgc2F2ZU1pc3Nlc0Zyb21MYXRlc3RSZXN1bHQoKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKFRlc3RJbnB1dC5taXNzZWRXb3JkcykuZm9yRWFjaCgod29yZCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbWlzc2VkQ291bnQgPSBUZXN0SW5wdXQubWlzc2VkV29yZHNbd29yZF07XG4gICAgICAgICAgICBUYmREYXRhLmFkZFRvTWlzc2VkQ291bnQod29yZCwgbWlzc2VkQ291bnQpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaGFuZGxlUmVzZXRBbGxXb3Jkc1JlcXVlc3QoKSB7XG4gICAgICAgIGxldCBjb25maXJtYXRpb25Xb3JkID0gXCJkZWxldGVcIjtcbiAgICAgICAgbGV0IHNsb3dlc3RTcGVlZCA9IDEwMDA7XG4gICAgICAgIGNvbnN0IGFsbERhdGEgPSBUYmREYXRhLmdldEFsbCgpO1xuICAgICAgICBPYmplY3Qua2V5cyhhbGxEYXRhLndvcmRzKVxuICAgICAgICAgICAgLmZpbHRlcigod29yZCkgPT4gVGJkRGF0YS5nZXRNZWRpYW5TcGVlZEZvcldvcmQod29yZCkgPiAwKVxuICAgICAgICAgICAgLmZvckVhY2goKHdvcmQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1lZGlhbiA9IFRiZERhdGEuZ2V0TWVkaWFuU3BlZWRGb3JXb3JkKHdvcmQpO1xuICAgICAgICAgICAgaWYgKG1lZGlhbiA+IDAgJiZcbiAgICAgICAgICAgICAgICBtZWRpYW4gPCBzbG93ZXN0U3BlZWQgJiZcbiAgICAgICAgICAgICAgICB3b3JkLmxlbmd0aCA+PSBjb25maXJtYXRpb25Xb3JkLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGNvbmZpcm1hdGlvbldvcmQgPSB3b3JkO1xuICAgICAgICAgICAgICAgIHNsb3dlc3RTcGVlZCA9IG1lZGlhbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGNvbmZpcm1hdGlvblN0cmluZyA9IGAke2NvbmZpcm1hdGlvbldvcmR9ICR7Y29uZmlybWF0aW9uV29yZH0gJHtjb25maXJtYXRpb25Xb3JkfWA7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gcHJvbXB0KGBUaGlzIHdpbGwgZGVsZXRlIEFMTCB5b3VyIHdvcmQgZGF0YS4gVG8gY29uZmlybSwgdHlwZTogJHtjb25maXJtYXRpb25TdHJpbmd9YCk7XG4gICAgICAgIGlmIChyZXNwb25zZSA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlc3BvbnNlID09IGNvbmZpcm1hdGlvblN0cmluZykge1xuICAgICAgICAgICAgYWxsRGF0YS53b3JkcyA9IHt9O1xuICAgICAgICAgICAgVGJkRGF0YS51cGRhdGVEYXRhKGFsbERhdGEsIHRydWUpO1xuICAgICAgICAgICAgYWxlcnQoXCJPayEgWW91ciBkYXRhIGhhcyBiZWVuIGRlbGV0ZWQgYW5kIHlvdSdyZSBzdGFydGluZyBvdmVyIGZyb20gc2NyYXRjaC5cIik7XG4gICAgICAgICAgICAvLyBMYXp5LCBJIGtub3dcbiAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYWxlcnQoYEdvb2QgZWZmb3J0LCBidXQgeW91IHR5cGVkIFxuICAgICAgICBcbiAgICAgICAgJyR7cmVzcG9uc2V9JyBcbiAgICAgICAgXG4gICAgICAgIGluc3RlYWQgb2YgXG4gICAgICAgIFxuICAgICAgICAnJHtjb25maXJtYXRpb25TdHJpbmd9JyBcbiAgICAgICAgXG4gICAgICAgIE5vIHJlc2V0IGZvciB5b3UhYCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5jbGFzcyBUYmRVSSB7XG4gICAgY29uc3RydWN0b3IodGJkTW9kZSkge1xuICAgICAgICB0aGlzLiRncm91cFRocmVzaG9sZCA9ICQoXCIjdGJkTW9kZUdyb3VwVGhyZXNob2xkXCIpO1xuICAgICAgICB0aGlzLiR0YmRNb2RlR3JvdXBDb3VudCA9ICQoXCIjdGJkTW9kZUdyb3VwQ291bnRcIik7XG4gICAgICAgIHRoaXMuJHdvcmRJbmZvID0gJChcIiN0YmRNb2RlV29yZEluZm9cIik7XG4gICAgICAgIHRoaXMuJHdvcmRzRGl2ID0gJChcIiN0YmRtb2RlSW5mbyAud29yZHNDb250YWluZXIgLndvcmRzXCIpO1xuICAgICAgICB0aGlzLiRwcm9ncmVzc01ldGVyVG90YWwgPSAkKFwiI3RiZG1vZGVJbmZvIC5wcm9ncmVzc01ldGVyVG90YWxcIik7XG4gICAgICAgIHRoaXMuJHRhcmdldFRocmVzaG9sZCA9ICQoXCIjdGJkTW9kZVRhcmdldFRocmVzaG9sZFwiKTtcbiAgICAgICAgdGhpcy4kcHJvZ3Jlc3NNZXRlckdyb3VwID0gJChcIiN0YmRtb2RlSW5mbyAucHJvZ3Jlc3NNZXRlckdyb3VwXCIpO1xuICAgICAgICB0aGlzLiR0YmRNb2RlSW5mbyA9ICQoXCIjdGJkbW9kZUluZm9cIik7XG4gICAgICAgIHRoaXMuJHRiZE1vZGVIZWxwQnV0dG9uID0gJChcIi50YmRNb2RlSGVscEJ1dHRvblwiKTtcbiAgICAgICAgdGhpcy4kdGJkTW9kZUhlbHAgPSAkKFwiI3RiZEhlbHBcIik7XG4gICAgICAgIHRoaXMuJHRiZEJlYXRlbkV4YW1wbGUgPSAkKFwiLnRiZEJlYXRlbkV4YW1wbGVcIik7XG4gICAgICAgIHRoaXMuJHRiZExvc3RFeGFtcGxlID0gJChcIi50YmRMb3N0RXhhbXBsZVwiKTtcbiAgICAgICAgdGhpcy4kdGJkTW9kZUFjdGlvbnNTZWxlY3QgPSAkKFwiI3RiZE1vZGVBY3Rpb25zU2VsZWN0XCIpO1xuICAgICAgICB0aGlzLiR0YmRNb2RlQWN0aW9uc0J1dHRvbiA9ICQoXCIjdGJkTW9kZUFjdGlvbkJ1dHRvblwiKTtcbiAgICAgICAgdGhpcy4kdGJkTW9kZUNvbmZpZ1NldHRpbmdzU2VsZWN0ID0gJChcIiN0YmRNb2RlQ29uZmlnU2V0dGluZ3NcIik7XG4gICAgICAgIHRoaXMuJHRiZE1vZGVDb25maWdTZXR0aW5nc1VwZGF0ZUJ1dHRvbiA9ICQoXCIjdGJkTW9kZVVwZGF0ZUNvbmZpZ1NldHRpbmdzVXBkYXRlQnV0dG9uXCIpO1xuICAgICAgICB0aGlzLiR0YmROZXh0R3JvdXBCdXR0b24gPSAkKFwiI3RiZE5leHRHcm91cEJ1dHRvblwiKTtcbiAgICAgICAgdGhpcy4kc29ydGVyU2VsZWN0ID0gJChcIiN0YmRNb2RlU29ydGVyU2VsZWN0XCIpO1xuICAgICAgICB0aGlzLmN1cnJlbnRseUFuaW1hdGluZyA9IFtdO1xuICAgICAgICB0aGlzLiR0YmRNb2RlR3JvdXBOdW1iZXIgPSAkKFwiI3RiZE1vZGVDdXJyZW50R3JvdXBOdW1iZXJcIik7XG4gICAgICAgIHRoaXMudGJkTW9kZSA9IHRiZE1vZGU7XG4gICAgICAgIGNvbnN0IHdvcmRzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0YmRNb2RlV29yZHNDb250YWluZXJcIik7XG4gICAgICAgIGlmICghKHdvcmRzQ29udGFpbmVyIGluc3RhbmNlb2YgSFRNTERpdkVsZW1lbnQpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgbG9jYXRlIFRCRCB3b3JkcyBjb250YWluZXJcIik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy53b3Jkc0NvbnRhaW5lciA9IHdvcmRzQ29udGFpbmVyO1xuICAgICAgICB0aGlzLiR3b3JkSW5mby5oaWRlKCk7XG4gICAgICAgIHRoaXMuJHRiZE1vZGVJbmZvLmhpZGUoKTtcbiAgICB9XG4gICAgaW5pdCgpIHtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKFwidGJkTW9kZVwiKTtcbiAgICAgICAgdGhpcy4kdGJkTW9kZUluZm8uc2hvdygzMDApO1xuICAgICAgICBQYWdlQ2hhbmdlRXZlbnQuc3Vic2NyaWJlKHRoaXMucGFnZUNoYW5nZUhhbmRsZXIuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMud29yZHNDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCB0aGlzLnVwZGF0ZVdvcmRJbmZvLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLndvcmRzQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmhhbmRsZVdvcmRDbGlja2VkLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLndvcmRzQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiR3b3JkSW5mby5oaWRlKDApO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJ3b3JkVHlwZWRDb3JyZWN0bHlcIiwgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGRhdGFbXCJ3b3JkRWxlbWVudFwiXVxuICAgICAgICAgICAgICAgIC5jaGlsZHJlbihcImxldHRlclwiKVxuICAgICAgICAgICAgICAgIC5lYWNoKChfaW5kZXgsIGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFuaW1hdGUoZWxlbWVudCwgXCJ0YmRCZWF0ZW5cIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwid29yZE1pc3NlZFwiLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgZGF0YVtcIndvcmRFbGVtZW50XCJdLmFkZENsYXNzKFwidGJkTG93T3BhY2l0eVwiKTtcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0ZShkYXRhW1wid29yZEVsZW1lbnRcIl1bMF0sIFwidGJkTG9zdFwiKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwiZ3JvdXBUaHJlc2hvbGRDaGFuZ2VkXCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICB0aGlzLiRncm91cFRocmVzaG9sZC50ZXh0KGRhdGFbXCJ0aHJlc2hvbGRcIl0pO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJyZXN1bHRzUHJvY2Vzc2VkXCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBncm91cCA9IGRhdGFbXCJjdXJyZW50R3JvdXBcIl07XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVVpV29yZHMoZ3JvdXAuZ2V0V29yZHNldCgpLndvcmRzKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwicmVzdWx0c1Byb2Nlc3NlZFwiLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVUb3RhbFByb2dyZXNzTWV0ZXIoZGF0YVtcIm1vbmtleVR5cGVXb3Jkc2V0XCJdLCBkYXRhW1widGFyZ2V0U3BlZWRcIl0pO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJyZXN1bHRzUHJvY2Vzc2VkXCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUdyb3VwUHJvZ3Jlc3NNZXRlcihkYXRhW1wiY3VycmVudEdyb3VwXCJdLCBkYXRhW1widGFyZ2V0U3BlZWRcIl0pO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy4kc29ydGVyU2VsZWN0Lm9uKFwiY2hhbmdlXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKCEoZXZlbnQudGFyZ2V0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJzb3J0ZXJTZWxlY3RDaGFuZ2VkXCIsIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogZXZlbnQudGFyZ2V0LnZhbHVlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcInNvcnRlci1jaGFuZ2VkXCIsIHRoaXMuaGFuZGxlU29ydGVyQ2hhbmdlLmJpbmQodGhpcykpO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcIm5leHRHcm91cFwiLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZ3JvdXAgPSBkYXRhW1wiZ3JvdXBcIl07XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVVpV29yZHMoZ3JvdXAuZ2V0V29yZHNldCgpLndvcmRzKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwibmV4dEdyb3VwXCIsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlR3JvdXBQcm9ncmVzc01ldGVyKHRoaXMudGJkTW9kZS5nZXRDdXJyZW50R3JvdXAoKSwgdGhpcy50YmRNb2RlLmdldENvbmZpZygpLmdldFRhcmdldFNwZWVkKCkpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVUb3RhbFByb2dyZXNzTWV0ZXIodGhpcy50YmRNb2RlLmdldE1vbmtleVR5cGVXb3Jkc2V0KCksIHRoaXMudGJkTW9kZS5nZXRDb25maWcoKS5nZXRUYXJnZXRTcGVlZCgpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIENhbid0IHVzZSB0YXJnZXRTcGVlZC1jaGFuZ2VkIGJlY2F1c2Ugb2Ygc3R1cGlkIHJlY3Vyc2l2ZSB3YXkgb2ZcbiAgICAgICAgLy8gYXV0byBidW1waW5nIHRocmVzaG9sZCB0byBlbnN1cmUgdGhlcmUgYXJlIGFsd2F5cyBncm91cHNcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJuZXh0R3JvdXBcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy4kdGFyZ2V0VGhyZXNob2xkLnRleHQodGhpcy50YmRNb2RlLmdldENvbmZpZygpLmdldFRhcmdldFNwZWVkKCkudG9TdHJpbmcoKSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLiR0YmRNb2RlSGVscEJ1dHRvbi5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuJHRiZE1vZGVIZWxwLnRvZ2dsZSgyNTApO1xuICAgICAgICAgICAgdGhpcy4kd29yZHNEaXYudG9nZ2xlKDI1MCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLiR0YmRCZWF0ZW5FeGFtcGxlLm9uKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmFuaW1hdGUoZXZlbnQudGFyZ2V0LCBcInRiZEJlYXRlblwiKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuJHRiZExvc3RFeGFtcGxlLm9uKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmFuaW1hdGUoZXZlbnQudGFyZ2V0LCBcInRiZExvc3RcIik7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLiR0YmROZXh0R3JvdXBCdXR0b24ub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBUYmRFdmVudHMuZGlzcGF0Y2hFdmVudChcIm5leHRHcm91cEJ1dHRvbkNsaWNrZWRcIik7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLiR0YXJnZXRUaHJlc2hvbGQudGV4dCh0aGlzLnRiZE1vZGUuZ2V0Q29uZmlnKCkuZ2V0VGFyZ2V0U3BlZWQoKSk7XG4gICAgICAgIHRoaXMuJGdyb3VwVGhyZXNob2xkLnRleHQodGhpcy50YmRNb2RlLmdldEN1cnJlbnRHcm91cCgpLmdldFRocmVzaG9sZCgpKTtcbiAgICAgICAgdGhpcy4kdGJkTW9kZUNvbmZpZ1NldHRpbmdzVXBkYXRlQnV0dG9uLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0VmFsdWUgPSB0aGlzLiR0YmRNb2RlQ29uZmlnU2V0dGluZ3NTZWxlY3QudmFsKCk7XG4gICAgICAgICAgICBpZiAoc2VsZWN0VmFsdWUgPT0gXCJcIikge1xuICAgICAgICAgICAgICAgIGFsZXJ0KFwiU2VsZWN0IGFuIG9wdGlvbiBmcm9tIHRoZSBkcm9wZG93biBmaXJzdFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIFRiZEV2ZW50cy5kaXNwYXRjaEV2ZW50KFwiY29uZmlnVXBkYXRlUmVxdWVzdGVkXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnU2V0dGluZzogc2VsZWN0VmFsdWUsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLiR0YmRNb2RlQWN0aW9uc0J1dHRvbi5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdFZhbHVlID0gdGhpcy4kdGJkTW9kZUFjdGlvbnNTZWxlY3QudmFsKCk7XG4gICAgICAgICAgICBpZiAoc2VsZWN0VmFsdWUgPT0gXCJcIikge1xuICAgICAgICAgICAgICAgIGFsZXJ0KFwiU2VsZWN0IGFuIG9wdGlvbiBmcm9tIHRoZSBkcm9wZG93biBmaXJzdFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIFRiZEV2ZW50cy5kaXNwYXRjaEV2ZW50KFwiYWN0aW9uQnV0dG9uQ2xpY2tlZFwiLCB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvblZhbHVlOiBzZWxlY3RWYWx1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwid29yZFNhdmVkXCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB3b3JkID0gZGF0YVtcIndvcmRcIl0gfHwgXCJcIjtcbiAgICAgICAgICAgIGlmICh3b3JkID09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5nZXRXb3JkRWxlbWVudCh3b3JkKTtcbiAgICAgICAgICAgIGlmICghZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudXBkYXRlV29yZCh3b3JkKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5hZGRTdWJzY3JpYmVyKFwiZ3JvdXBzUmVnZW5lcmF0ZWRcIiwgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIHRoaXMuJHRiZE1vZGVHcm91cENvdW50LnRleHQoZGF0YVtcImdyb3Vwc1wiXS5sZW5ndGgpO1xuICAgICAgICB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmFkZFN1YnNjcmliZXIoXCJuZXh0R3JvdXBcIiwgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIHRoaXMuJHRiZE1vZGVHcm91cE51bWJlci50ZXh0KGRhdGFbXCJncm91cE51bWJlclwiXSk7XG4gICAgICAgICAgICB0aGlzLiRncm91cFRocmVzaG9sZC50ZXh0KGRhdGFbXCJncm91cFwiXS5nZXRUaHJlc2hvbGQoKSk7XG4gICAgICAgIH0pO1xuICAgICAgICBUYmRFdmVudHMuYWRkU3Vic2NyaWJlcihcImdyb3Vwc1JlZ2VuZXJhdGVkXCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICBpZiAoZGF0YVtcImdyb3Vwc1wiXS5sZW5ndGggPT0gMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuJHRiZE5leHRHcm91cEJ1dHRvbi5oaWRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLiR0YmROZXh0R3JvdXBCdXR0b24uc2hvdygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy4kc29ydGVyU2VsZWN0XG4gICAgICAgICAgICAuZmluZChgb3B0aW9uW3ZhbHVlPVwiJHt0aGlzLnRiZE1vZGUuZ2V0Q29uZmlnKCkuZ2V0U29ydGVyTmFtZSgpfVwiXWApXG4gICAgICAgICAgICAuYXR0cihcInNlbGVjdGVkXCIsIFwiXCIpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gZWxlbWVudFxuICAgICAqIEBwYXJhbSBhbmltYXRpb24gLSBib3RoIHRoZSBrZXlmcmFtZSBhbmltYXRpb24gYW5kIGNsYXNzIHdpdGggdGhhdCBhbmltYXRpb24uIEZvciBzaW1wbGljaXR5XG4gICAgICogdGhleSBtdXN0IGJlIHRoZSBzYW1lLlxuICAgICAqL1xuICAgIGFuaW1hdGUoZWxlbWVudCwgYW5pbWF0aW9uKSB7XG4gICAgICAgIGlmICghdGhpcy50YmRNb2RlLmdldENvbmZpZygpLmFyZUFuaW1hdGlvbnNFbmFibGVkKCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jdXJyZW50bHlBbmltYXRpbmcuaW5jbHVkZXMoZWxlbWVudCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjYWxsYmFjayA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGV2ZW50LmFuaW1hdGlvbk5hbWUgIT09IGFuaW1hdGlvbikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5jdXJyZW50bHlBbmltYXRpbmcuZmluZEluZGV4KChhbmltYXRpbmdFbGVtZW50KSA9PiBhbmltYXRpbmdFbGVtZW50ID09IGVsZW1lbnQpO1xuICAgICAgICAgICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5jdXJyZW50bHlBbmltYXRpbmdbaW5kZXhdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGFuaW1hdGlvbik7XG4gICAgICAgICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJhbmltYXRpb25lbmRcIiwgY2FsbGJhY2spO1xuICAgICAgICB9O1xuICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJhbmltYXRpb25lbmRcIiwgY2FsbGJhY2spO1xuICAgICAgICB0aGlzLmN1cnJlbnRseUFuaW1hdGluZy5wdXNoKGVsZW1lbnQpO1xuICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoYW5pbWF0aW9uKTtcbiAgICB9XG4gICAgaGFuZGxlV29yZENsaWNrZWQoZXZlbnQpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICAgIGlmICghKHRhcmdldCBpbnN0YW5jZW9mIEhUTUxEaXZFbGVtZW50KSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInRiZFdvcmRcIikpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB3b3JkID0gKChfYSA9IHRhcmdldC5wYXJlbnRFbGVtZW50KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZGF0YXNldFtcIndvcmRcIl0pIHx8IFwiXCI7XG4gICAgICAgIGlmICh3b3JkID09IFwiXCIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBUYmRFdmVudHMuZGlzcGF0Y2hFdmVudChcIndvcmRDbGlja2VkXCIsIHsgd29yZDogd29yZCB9KTtcbiAgICB9XG4gICAgaGFuZGxlU29ydGVyQ2hhbmdlKGRhdGEpIHtcbiAgICAgICAgY29uc3Qgc29ydGVyID0gVGJkU29ydGluZy5nZXRTb3J0ZXIoZGF0YVtcIm5ld1ZhbHVlXCJdIHx8IFwiXCIpO1xuICAgICAgICB0aGlzLnNvcnRXb3Jkcyhzb3J0ZXIpO1xuICAgIH1cbiAgICBzZWxlY3RTb3J0ZXJPcHRpb24oc29ydGVyTmFtZSkge1xuICAgICAgICBbLi4uZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIiN0YmRNb2RlU29ydGVyU2VsZWN0IG9wdGlvblwiKV0uZm9yRWFjaCgob3B0aW9uKSA9PiB7XG4gICAgICAgICAgICBpZiAoIShvcHRpb24gaW5zdGFuY2VvZiBIVE1MT3B0aW9uRWxlbWVudCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob3B0aW9uW1widmFsdWVcIl0gPT0gc29ydGVyTmFtZSkge1xuICAgICAgICAgICAgICAgIG9wdGlvbltcInNlbGVjdGVkXCJdID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHVwZGF0ZVRvdGFsUHJvZ3Jlc3NNZXRlcihtb25rZXlUeXBlV29yZHNldCwgdGFyZ2V0U3BlZWQpIHtcbiAgICAgICAgY29uc3QgYWxsV29yZHMgPSBtb25rZXlUeXBlV29yZHNldC53b3JkcztcbiAgICAgICAgY29uc3QgY291bnQgPSBhbGxXb3Jkcy5sZW5ndGg7XG4gICAgICAgIGNvbnN0IGJlYXRlbkF0VGFyZ2V0Q291bnQgPSBhbGxXb3Jkcy5maWx0ZXIoKHdvcmQpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBUYmREYXRhLmhhc1dvcmRCZWVuVHlwZWRGYXN0ZXJUaGFuKHdvcmQsIHRhcmdldFNwZWVkKTtcbiAgICAgICAgfSkubGVuZ3RoO1xuICAgICAgICBjb25zdCBwZXJjZW50ID0gKGJlYXRlbkF0VGFyZ2V0Q291bnQgLyBjb3VudCkgKiAxMDAgfHwgMDtcbiAgICAgICAgdGhpcy4kcHJvZ3Jlc3NNZXRlclRvdGFsLmNzcyhcIndpZHRoXCIsIGAke3BlcmNlbnR9JWApO1xuICAgICAgICB0aGlzLiRwcm9ncmVzc01ldGVyVG90YWwuYXR0cihcInRpdGxlXCIsIGAke2JlYXRlbkF0VGFyZ2V0Q291bnR9IHdvcmRzIG9mICR7Y291bnR9IHRvdGFsIGhhdmUgYmVlbiB0eXBlZCBmYXN0ZXIgdGhhbiB0aGUgdGFyZ2V0IG9mICR7dGFyZ2V0U3BlZWR9YCk7XG4gICAgfVxuICAgIHVwZGF0ZUdyb3VwUHJvZ3Jlc3NNZXRlcihjdXJyZW50R3JvdXAsIHRhcmdldFNwZWVkKSB7XG4gICAgICAgIGNvbnN0IGdyb3VwV29yZHNldCA9IGN1cnJlbnRHcm91cC5nZXRXb3Jkc2V0KCk7XG4gICAgICAgIGNvbnN0IGJlYXRlbkF0VGFyZ2V0Q291bnQgPSBncm91cFdvcmRzZXQud29yZHMuZmlsdGVyKCh3b3JkKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gVGJkRGF0YS5oYXNXb3JkQmVlblR5cGVkRmFzdGVyVGhhbih3b3JkLCB0YXJnZXRTcGVlZCk7XG4gICAgICAgIH0pLmxlbmd0aDtcbiAgICAgICAgY29uc3QgcGVyY2VudCA9IChiZWF0ZW5BdFRhcmdldENvdW50IC8gZ3JvdXBXb3Jkc2V0Lmxlbmd0aCkgKiAxMDAgfHwgMDtcbiAgICAgICAgdGhpcy4kcHJvZ3Jlc3NNZXRlckdyb3VwLmNzcyhcIndpZHRoXCIsIGAke3BlcmNlbnR9JWApO1xuICAgICAgICB0aGlzLiRwcm9ncmVzc01ldGVyR3JvdXAuYXR0cihcInRpdGxlXCIsIGAke2JlYXRlbkF0VGFyZ2V0Q291bnR9IHdvcmRzIG9mICR7Z3JvdXBXb3Jkc2V0Lmxlbmd0aH0gaW4gdGhlIGN1cnJlbnQgZ3JvdXAgaGF2ZSBiZWVuIHR5cGVkIGZhc3RlciB0aGFuIHRoZSB0YXJnZXQgb2YgJHt0YXJnZXRTcGVlZH1gKTtcbiAgICB9XG4gICAgcGFnZUNoYW5nZUhhbmRsZXIoX3ByZXZpb3VzUGFnZSwgbmV4dFBhZ2UpIHtcbiAgICAgICAgY29uc3QgcGFnZXNUb1Nob3dJbmZvID0gW1widGVzdFwiXTtcbiAgICAgICAgaWYgKHBhZ2VzVG9TaG93SW5mby5pbmNsdWRlcyhuZXh0UGFnZS5uYW1lKSkge1xuICAgICAgICAgICAgdGhpcy4kdGJkTW9kZUluZm8uc2hvdygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy4kdGJkTW9kZUluZm8uaGlkZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZVVpV29yZHMod29yZHNUb1Nob3cpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAvLyBSZW1vdmUgd29yZHMgd2UgZG9uJ3Qgd2FudCB0byBzaG93XG4gICAgICAgIHRoaXMuJHdvcmRzRGl2LmhpZGUoKTtcbiAgICAgICAgKF9hID0gWy4uLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIud29yZHMgLnRiZFdvcmRDb250YWluZXJcIildKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yRWFjaCgod29yZEVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIGNvbnN0IHdvcmQgPSB3b3JkRWxlbWVudC5kYXRhc2V0W1wid29yZFwiXTtcbiAgICAgICAgICAgIGlmICghd29yZHNUb1Nob3cuaW5jbHVkZXMod29yZCkpIHtcbiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgd29yZEVsZW1lbnQucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZCh3b3JkRWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB3b3Jkc1RvU2hvdy5mb3JFYWNoKCh3b3JkKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVdvcmQod29yZCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnNvcnRXb3Jkcyh0aGlzLnRiZE1vZGUuZ2V0Q29uZmlnKCkuZ2V0U29ydGVyKCkpO1xuICAgICAgICB0aGlzLiR3b3Jkc0Rpdi5zaG93KCk7XG4gICAgfVxuICAgIHVwZGF0ZVdvcmQod29yZCkge1xuICAgICAgICBjb25zdCB3b3JkRWxlbWVudCA9IHRoaXMuZ2V0T3JDcmVhdGVXb3JkRWxlbWVudCh3b3JkKTtcbiAgICAgICAgY29uc3QgdGFyZ2V0U3BlZWQgPSB0aGlzLnRiZE1vZGUuZ2V0Q29uZmlnKCkuZ2V0VGFyZ2V0U3BlZWQoKTtcbiAgICAgICAgY29uc3QgZ3JvdXBTcGVlZCA9IHRoaXMudGJkTW9kZS5nZXRDdXJyZW50R3JvdXAoKS5nZXRUaHJlc2hvbGQoKTtcbiAgICAgICAgLy8gVGltZW91dCBlbnN1cmVzIHRyYW5zaXRpb25zIHdvcmtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICB3b3JkRWxlbWVudC5kYXRhc2V0W1wiYmVhdGVuQXRUYXJnZXRcIl0gPVxuICAgICAgICAgICAgICAgIFRiZERhdGEuaGFzV29yZEJlZW5UeXBlZEZhc3RlclRoYW4od29yZCwgdGFyZ2V0U3BlZWQpID8gXCIxXCIgOiBcIjBcIjtcbiAgICAgICAgICAgIHdvcmRFbGVtZW50LmRhdGFzZXRbXCJiZWF0ZW5BdEdyb3VwXCJdID0gVGJkRGF0YS5oYXNXb3JkQmVlblR5cGVkRmFzdGVyVGhhbih3b3JkLCBncm91cFNwZWVkKVxuICAgICAgICAgICAgICAgID8gXCIxXCJcbiAgICAgICAgICAgICAgICA6IFwiMFwiO1xuICAgICAgICAgICAgd29yZEVsZW1lbnQuZGF0YXNldFtcInR5cGVkXCJdID1cbiAgICAgICAgICAgICAgICBUYmREYXRhLmdldFNwZWVkc0ZvcldvcmQod29yZCkubGVuZ3RoID09IDAgPyBcIjBcIiA6IFwiMVwiO1xuICAgICAgICAgICAgd29yZEVsZW1lbnQuZGF0YXNldFtcIm1pc3NlZE1vcmVcIl0gPVxuICAgICAgICAgICAgICAgIFRiZERhdGEuZ2V0TWlzdHlwZWRDb3VudEZvcldvcmQod29yZCkgPlxuICAgICAgICAgICAgICAgICAgICBUYmREYXRhLmdldFNwZWVkc0ZvcldvcmQod29yZCkubGVuZ3RoXG4gICAgICAgICAgICAgICAgICAgID8gXCIxXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjBcIjtcbiAgICAgICAgICAgIGNvbnN0IHBlcmNlbnRDb21wbGV0ZSA9IFRiZERhdGEuZ2V0TWVkaWFuU3BlZWRGb3JXb3JkKHdvcmQpIC8gdGFyZ2V0U3BlZWQ7XG4gICAgICAgICAgICBjb25zdCBtb2RpZmllciA9IE1hdGgubWluKHBlcmNlbnRDb21wbGV0ZSwgMSk7XG4gICAgICAgICAgICBjb25zdCBiYXNlU2NhbGUgPSAwLjc1O1xuICAgICAgICAgICAgY29uc3QgYWRkaXRpb25hbCA9ICgxIC0gYmFzZVNjYWxlKSAqIG1vZGlmaWVyO1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgKF9hID0gd29yZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcImRpdlwiKS5zdHlsZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRyYW5zZm9ybSA9IGBzY2FsZSgke2Jhc2VTY2FsZSArIGFkZGl0aW9uYWx9KWA7XG4gICAgICAgIH0sIDApO1xuICAgIH1cbiAgICBzb3J0V29yZHMoc29ydGVyKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3Qgd29yZHMgPSAoX2EgPSBbLi4uZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi50YmRXb3JkQ29udGFpbmVyXCIpXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1hcCgod29yZENvbnRhaW5lckVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgIGlmICghKHdvcmRDb250YWluZXJFbGVtZW50IGluc3RhbmNlb2YgSFRNTERpdkVsZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUlVIIFJPSFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB3b3JkQ29udGFpbmVyRWxlbWVudC5kYXRhc2V0W1wid29yZFwiXSB8fCBcIlwiO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3Qgc29ydGVkID0gd29yZHMuc29ydChzb3J0ZXIpO1xuICAgICAgICBzb3J0ZWQuZm9yRWFjaCgod29yZCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuZ2V0T3JDcmVhdGVXb3JkRWxlbWVudCh3b3JkKTtcbiAgICAgICAgICAgIHRoaXMuJHdvcmRzRGl2LmFwcGVuZChlbGVtZW50KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldFdvcmRFbGVtZW50KHdvcmQpIHtcbiAgICAgICAgY29uc3QgcXVlcnkgPSBgLnRiZFdvcmRDb250YWluZXJbZGF0YS13b3JkPVwiJHt3b3JkfVwiXWA7XG4gICAgICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHF1ZXJ5KTtcbiAgICB9XG4gICAgZ2V0T3JDcmVhdGVXb3JkRWxlbWVudCh3b3JkKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLmdldFdvcmRFbGVtZW50KHdvcmQpO1xuICAgICAgICBpZiAoZWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmV3RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgbmV3RGl2LmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPVwidGJkV29yZFwiPiR7d29yZH08L2Rpdj5gO1xuICAgICAgICBuZXdEaXYuZGF0YXNldFtcIndvcmRcIl0gPSB3b3JkO1xuICAgICAgICBuZXdEaXYuY2xhc3NMaXN0LmFkZChcInRiZFdvcmRDb250YWluZXJcIik7XG4gICAgICAgIHRoaXMuJHdvcmRzRGl2LmFwcGVuZChuZXdEaXYpO1xuICAgICAgICByZXR1cm4gbmV3RGl2O1xuICAgIH1cbiAgICB1cGRhdGVXb3JkSW5mbyhldmVudCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgaWYgKCEodGFyZ2V0IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwidGJkV29yZFwiKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHdvcmQgPSAoX2EgPSB0YXJnZXQucGFyZW50RWxlbWVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmRhdGFzZXRbXCJ3b3JkXCJdO1xuICAgICAgICBpZiAod29yZCA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB3b3JkRGF0YSA9IFRiZERhdGEuZ2V0RGF0YUZvcldvcmQod29yZCk7XG4gICAgICAgIGxldCB3b3JkSW5mb0h0bWwgPSBgXG4gICAgICAgIDxoMz5cIiR7d29yZH1cIjwvaDM+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJoZWFkaW5nXCI+Q291bnRzPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzdGF0Q29udGFpbmVyXCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJsYWJlbFwiPkNvcnJlY3Q6IDwvc3Bhbj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cInN0YXQgZ29vZFwiPiR7d29yZERhdGEuc3BlZWRzLmxlbmd0aH08L3NwYW4uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInN0YXRDb250YWluZXJcIj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cImxhYmVsXCI+TWlzc2VkOiA8L3NwYW4+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJzdGF0IGJhZFwiPiR7VGJkRGF0YS5nZXRNaXN0eXBlZENvdW50Rm9yV29yZCh3b3JkKX08L3NwYW4+XG4gICAgICAgIDwvZGl2PmA7XG4gICAgICAgIGlmICh3b3JkRGF0YS5zcGVlZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICB3b3JkSW5mb0h0bWwgKz0gYFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImhlYWRpbmdcIj5TcGVlZHM8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInN0YXRDb250YWluZXJcIj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cImxhYmVsXCI+V29yc3Q6IDwvc3Bhbj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cInN0YXQgYmFkXCI+JHtUYmREYXRhLmdldFNsb3dlc3RTcGVlZEZvcldvcmQod29yZCl9PC9zcGFuPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInN0YXRDb250YWluZXJcIj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cImxhYmVsXCI+TWVhbjogPC9zcGFuPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwic3RhdFwiPiR7VGJkRGF0YS5nZXRNZWFuU3BlZWRGb3JXb3JkKHdvcmQpfTwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzdGF0Q29udGFpbmVyXCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJsYWJlbFwiPk1lZGlhbjogPC9zcGFuPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwic3RhdFwiPiR7VGJkRGF0YS5nZXRNZWRpYW5TcGVlZEZvcldvcmQod29yZCl9PC9zcGFuPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInN0YXRDb250YWluZXJcIj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cImxhYmVsXCI+QmVzdDogPC9zcGFuPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwic3RhdCBnb29kXCI+JHtUYmREYXRhLmdldEZhc3Rlc3RTcGVlZEZvcldvcmQod29yZCl9PC9zcGFuPlxuICAgICAgICA8L2Rpdj5gO1xuICAgICAgICB9XG4gICAgICAgIHdvcmRJbmZvSHRtbCArPSBgPGRpdiBjbGFzcz1cImhlbHBUZXh0XCI+Y2xpY2sgdG8gcmVzZXQgd29yZCBkYXRhPC9kaXY+YDtcbiAgICAgICAgdGhpcy4kd29yZEluZm8uaHRtbCh3b3JkSW5mb0h0bWwpO1xuICAgICAgICB0aGlzLmdldE9yQ3JlYXRlV29yZEVsZW1lbnQod29yZCkuYXBwZW5kKHRoaXMuJHdvcmRJbmZvWzBdKTtcbiAgICAgICAgdGhpcy4kd29yZEluZm8uc2hvdygyMDApO1xuICAgIH1cbn1cbmNsYXNzIFRiZEV2ZW50cyB7XG4gICAgc3RhdGljIGRpc3BhdGNoRXZlbnQobmFtZSwgZGF0YSA9IHt9KSB7XG4gICAgICAgIGNvbnN0IHN1YnNjcmliZXJzID0gdGhpcy5zdWJzY3JpYmVyc1tuYW1lXSB8fCBbXTtcbiAgICAgICAgc3Vic2NyaWJlcnMuZm9yRWFjaCgoc3Vic2NyaWJlcikgPT4ge1xuICAgICAgICAgICAgc3Vic2NyaWJlcihkYXRhKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBhZGRTdWJzY3JpYmVyKG5hbWUsIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShUYmRFdmVudHMuc3Vic2NyaWJlcnNbbmFtZV0pKSB7XG4gICAgICAgICAgICBUYmRFdmVudHMuc3Vic2NyaWJlcnNbbmFtZV0gPSBbXTtcbiAgICAgICAgfVxuICAgICAgICBUYmRFdmVudHMuc3Vic2NyaWJlcnNbbmFtZV0ucHVzaChjYWxsYmFjayk7XG4gICAgfVxufVxuVGJkRXZlbnRzLnN1YnNjcmliZXJzID0ge307XG5UYmRFdmVudHMuZGVib3VuY2VkRGlzcGF0Y2ggPSAoMCwgZGVib3VuY2VfMS5kZWJvdW5jZSkoVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQsIDUwKTtcbmNsYXNzIFRiZERhdGEge1xuICAgIHN0YXRpYyBnZXRBbGwoKSB7XG4gICAgICAgIGlmIChUYmREYXRhLmRhdGEpIHtcbiAgICAgICAgICAgIHJldHVybiBUYmREYXRhLmRhdGE7XG4gICAgICAgIH1cbiAgICAgICAgVGJkRGF0YS5kYXRhID0gVGJkRGF0YS5nZXRGcm9tTG9jYWxTdG9yYWdlKCk7XG4gICAgICAgIHJldHVybiBUYmREYXRhLmRhdGE7XG4gICAgfVxuICAgIHN0YXRpYyBnZXRGcm9tTG9jYWxTdG9yYWdlKCkge1xuICAgICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSB7IHdvcmRzOiB7fSwgY29uZmlnOiB7fSB9O1xuICAgICAgICBjb25zdCBzdG9yZWREYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oVGJkRGF0YS5sb2NhbFN0b3JhZ2VLZXkpO1xuICAgICAgICBpZiAoc3RvcmVkRGF0YSA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gZGVmYXVsdFZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRyeSBwYXJzaW5nIGxvY2FsIHN0b3JhZ2VcbiAgICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShzdG9yZWREYXRhKTtcbiAgICAgICAgaWYgKHR5cGVvZiBwYXJzZWQgPT0gXCJvYmplY3RcIikge1xuICAgICAgICAgICAgcmV0dXJuIHBhcnNlZDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGVmYXVsdFZhbHVlO1xuICAgIH1cbiAgICBzdGF0aWMgdXBkYXRlRGF0YShkYXRhLCBpbW1lZGlhdGVseSA9IGZhbHNlKSB7XG4gICAgICAgIFRiZERhdGEuZGF0YSA9IGRhdGE7XG4gICAgICAgIGlmIChpbW1lZGlhdGVseSkge1xuICAgICAgICAgICAgVGJkRGF0YS51cGRhdGVMb2NhbFN0b3JhZ2UoZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBUYmREYXRhLmRlYm91bmNlZFVwZGF0ZUxvY2FsU3RvcmFnZShkYXRhKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzdGF0aWMgZ2V0RGF0YUZvcldvcmQod29yZCkge1xuICAgICAgICBjb25zdCBkYXRhID0gVGJkRGF0YS5nZXRBbGwoKTtcbiAgICAgICAgaWYgKCFkYXRhLndvcmRzW3dvcmRdKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzcGVlZHM6IFtdLCBtaXNzZWRDb3VudDogMCB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkYXRhLndvcmRzW3dvcmRdO1xuICAgIH1cbiAgICBzdGF0aWMgcmVzZXREYXRhRm9yV29yZCh3b3JkKSB7XG4gICAgICAgIFRiZERhdGEuc2F2ZVdvcmREYXRhKHdvcmQsIHsgc3BlZWRzOiBbXSwgbWlzc2VkQ291bnQ6IDAgfSk7XG4gICAgICAgIFRiZEV2ZW50cy5kaXNwYXRjaEV2ZW50KFwid29yZFJlc2V0XCIsIHsgd29yZDogd29yZCB9KTtcbiAgICB9XG4gICAgc3RhdGljIHJlc2V0RGF0YUZvcldvcmRzKHdvcmRzKSB7XG4gICAgICAgIHdvcmRzLmZvckVhY2goKHdvcmQpID0+IFRiZERhdGEucmVzZXREYXRhRm9yV29yZCh3b3JkKSk7XG4gICAgICAgIFRiZEV2ZW50cy5kaXNwYXRjaEV2ZW50KFwid29yZHNSZXNldFwiLCB7IHdvcmRzOiB3b3JkcyB9KTtcbiAgICB9XG4gICAgc3RhdGljIGhhc1dvcmRCZWVuVHlwZWRGYXN0ZXJUaGFuKHdvcmQsIHRocmVzaG9sZCkge1xuICAgICAgICByZXR1cm4gVGJkRGF0YS5nZXRNZWRpYW5TcGVlZEZvcldvcmQod29yZCkgPiB0aHJlc2hvbGQ7XG4gICAgfVxuICAgIHN0YXRpYyBnZXRTcGVlZHNGb3JXb3JkKHdvcmQpIHtcbiAgICAgICAgcmV0dXJuIFRiZERhdGEuZ2V0RGF0YUZvcldvcmQod29yZCkuc3BlZWRzIHx8IFtdO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0U2xvd2VzdFNwZWVkRm9yV29yZCh3b3JkKSB7XG4gICAgICAgIGNvbnN0IHNwZWVkcyA9IFRiZERhdGEuZ2V0U3BlZWRzRm9yV29yZCh3b3JkKTtcbiAgICAgICAgaWYgKHNwZWVkcy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIE1hdGgubWluKC4uLnNwZWVkcyk7XG4gICAgfVxuICAgIHN0YXRpYyBnZXRGYXN0ZXN0U3BlZWRGb3JXb3JkKHdvcmQpIHtcbiAgICAgICAgY29uc3Qgc3BlZWRzID0gVGJkRGF0YS5nZXRTcGVlZHNGb3JXb3JkKHdvcmQpO1xuICAgICAgICBpZiAoc3BlZWRzLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gTWF0aC5tYXgoLi4uc3BlZWRzKTtcbiAgICB9XG4gICAgc3RhdGljIGdldE1pc3R5cGVkQ291bnRGb3JXb3JkKHdvcmQpIHtcbiAgICAgICAgcmV0dXJuIFRiZERhdGEuZ2V0RGF0YUZvcldvcmQod29yZCkubWlzc2VkQ291bnQ7XG4gICAgfVxuICAgIHN0YXRpYyBnZXRNZWRpYW5TcGVlZEZvcldvcmQod29yZCkge1xuICAgICAgICBjb25zdCB3b3JkU3BlZWRzID0gVGJkRGF0YS5nZXRTcGVlZHNGb3JXb3JkKHdvcmQpO1xuICAgICAgICBpZiAod29yZFNwZWVkcy5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKDAsIG1pc2NfMS5tZWRpYW4pKHdvcmRTcGVlZHMpO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0TWVhblNwZWVkRm9yV29yZCh3b3JkKSB7XG4gICAgICAgIGNvbnN0IHNwZWVkcyA9IFRiZERhdGEuZ2V0U3BlZWRzRm9yV29yZCh3b3JkKTtcbiAgICAgICAgaWYgKHNwZWVkcy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoKDAsIG1pc2NfMS5tZWFuKShzcGVlZHMpKTtcbiAgICB9XG4gICAgc3RhdGljIHNhdmVXb3JkRGF0YSh3b3JkLCB3b3JkRGF0YSkge1xuICAgICAgICBjb25zdCBkYXRhID0gVGJkRGF0YS5nZXRBbGwoKTtcbiAgICAgICAgZGF0YS53b3Jkc1t3b3JkXSA9IHdvcmREYXRhO1xuICAgICAgICBUYmREYXRhLnVwZGF0ZURhdGEoZGF0YSk7XG4gICAgICAgIFRiZEV2ZW50cy5kaXNwYXRjaEV2ZW50KFwid29yZFNhdmVkXCIsIHsgd29yZDogd29yZCwgZGF0YTogd29yZERhdGEgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBhZGRCdXJzdCh3b3JkLCBzcGVlZCkge1xuICAgICAgICBpZiAod29yZCA9PSBcIlwiKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgd29yZERhdGEgPSBUYmREYXRhLmdldERhdGFGb3JXb3JkKHdvcmQpO1xuICAgICAgICB3b3JkRGF0YS5zcGVlZHMucHVzaChzcGVlZCk7XG4gICAgICAgIFRiZERhdGEuc2F2ZVdvcmREYXRhKHdvcmQsIHdvcmREYXRhKTtcbiAgICB9XG4gICAgc3RhdGljIGFkZFRvTWlzc2VkQ291bnQod29yZCwgbWlzc2VkQ291bnQpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IFRiZERhdGEuZ2V0RGF0YUZvcldvcmQod29yZCk7XG4gICAgICAgIGRhdGEubWlzc2VkQ291bnQgKz0gbWlzc2VkQ291bnQ7XG4gICAgICAgIFRiZERhdGEuc2F2ZVdvcmREYXRhKHdvcmQsIGRhdGEpO1xuICAgIH1cbiAgICBzdGF0aWMgdXBkYXRlTG9jYWxTdG9yYWdlKGRhdGEpIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oVGJkRGF0YS5sb2NhbFN0b3JhZ2VLZXksIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICB9XG59XG5UYmREYXRhLmxvY2FsU3RvcmFnZUtleSA9IFwidGJkTW9kZURhdGFcIjtcblRiZERhdGEuZGVib3VuY2VkVXBkYXRlTG9jYWxTdG9yYWdlID0gKDAsIGRlYm91bmNlXzEuZGVib3VuY2UpKFRiZERhdGEudXBkYXRlTG9jYWxTdG9yYWdlLCAxMDAwKTtcbmNsYXNzIFRiZEdyb3VwcyB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuZ3JvdXBzID0gW107XG4gICAgfVxuICAgIHNldEdyb3Vwcyhncm91cHMpIHtcbiAgICAgICAgdGhpcy5ncm91cHMgPSBncm91cHM7XG4gICAgfVxuICAgIGdldEdyb3VwcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ3JvdXBzO1xuICAgIH1cbiAgICBnZXRGaXJzdEluY29tcGxldGVHcm91cCh0YXJnZXRTcGVlZCkge1xuICAgICAgICByZXR1cm4gKHRoaXMuZ3JvdXBzLmZpbmQoKGdyb3VwKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gZ3JvdXBcbiAgICAgICAgICAgICAgICAuZ2V0V29yZHNldCgpXG4gICAgICAgICAgICAgICAgLndvcmRzLnNvbWUoKHdvcmQpID0+ICFUYmREYXRhLmhhc1dvcmRCZWVuVHlwZWRGYXN0ZXJUaGFuKHdvcmQsIHRhcmdldFNwZWVkKSk7XG4gICAgICAgIH0pIHx8IG51bGwpO1xuICAgIH1cbiAgICByZWdlbmVyYXRlR3JvdXBzKHdvcmRzLCBkZXNpcmVkR3JvdXBTaXplKSB7XG4gICAgICAgIHRoaXMuZ3JvdXBzID0gW107XG4gICAgICAgIGlmICh3b3Jkcy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJhbmRvbWx5U29ydGVkID0gd29yZHMuc29ydChUYmRTb3J0aW5nLnJhbmRvbVNvcnRlcik7XG4gICAgICAgIC8vIFRoaXMgaXMgYW4gZWZmb3J0IHRvIGVuc3VyZSB0aGVyZSBhcmUgbm8gdGlueSBncm91cCBzaXplcywgbGlrZSBpZiB0aGVyZSBhcmUgMjAwXG4gICAgICAgIC8vIHdvcmRzIGFuZCBhIGdyb3VwIHNpemUgb2YgMTguIENyZWF0aW5nIGdyb3VwcyBvZiBzaXplIDE4IHdvdWxkIG1lYW4gZ2V0dGluZyAxMSBncm91cHNcbiAgICAgICAgLy8gb2YgMTggYW5kIDEgZ3JvdXAgb2YgMi4gVGhpcyBtZXRob2QgZW5kcyB1cCBjcmVhdGluZyA4IGdyb3VwcyBvZiAxNyAoMTM2KSArIDQgZ3JvdXBzIG9mXG4gICAgICAgIC8vIDE2ICg2NCkuIEknbSBzdXJlIHRoZXJlIGlzIGEgYmV0dGVyIHdheSB0byBjYWxjdWxhdGUgaXQgYnV0IHRoaXMgc2VlbXMgdG8gd29yayBhbmQgSSdtXG4gICAgICAgIC8vIGxhenkgd2hlbiBpdCBjb21lcyB0byBtYXRoLlxuICAgICAgICBjb25zdCB0b3RhbCA9IHdvcmRzLmxlbmd0aDtcbiAgICAgICAgY29uc3QgYWN0dWFsR3JvdXBDb3VudCA9IE1hdGguY2VpbCh0b3RhbCAvIGRlc2lyZWRHcm91cFNpemUpO1xuICAgICAgICBjb25zdCBtYXhHcm91cFNpemUgPSBNYXRoLmNlaWwodG90YWwgLyBhY3R1YWxHcm91cENvdW50KTtcbiAgICAgICAgY29uc3QgcmVkdWNlZEdyb3VwU2l6ZSA9IG1heEdyb3VwU2l6ZSAtIDE7XG4gICAgICAgIGNvbnN0IHNpemVzVG9DcmVhdGUgPSBbXTtcbiAgICAgICAgbGV0IHJlbWFpbmluZ1dvcmRzID0gdG90YWw7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWN0dWFsR3JvdXBDb3VudDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAocmVtYWluaW5nV29yZHMgJSBtYXhHcm91cFNpemUgPT0gMCkge1xuICAgICAgICAgICAgICAgIHNpemVzVG9DcmVhdGUucHVzaChtYXhHcm91cFNpemUpO1xuICAgICAgICAgICAgICAgIHJlbWFpbmluZ1dvcmRzIC09IG1heEdyb3VwU2l6ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNpemVzVG9DcmVhdGUucHVzaChyZWR1Y2VkR3JvdXBTaXplKTtcbiAgICAgICAgICAgICAgICByZW1haW5pbmdXb3JkcyAtPSByZWR1Y2VkR3JvdXBTaXplO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGxldCBzdGFydCA9IDA7XG4gICAgICAgIHNpemVzVG9DcmVhdGUuZm9yRWFjaCgoc2l6ZSkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgd29yZHMgPSByYW5kb21seVNvcnRlZC5zbGljZShzdGFydCwgc3RhcnQgKyBzaXplKTtcbiAgICAgICAgICAgIGNvbnN0IHdvcmRzZXQgPSBuZXcgd29yZHNldF8xLldvcmRzZXQod29yZHMpO1xuICAgICAgICAgICAgdGhpcy5ncm91cHMucHVzaChuZXcgVGJkR3JvdXAod29yZHNldCkpO1xuICAgICAgICAgICAgc3RhcnQgPSBzdGFydCArIHNpemU7XG4gICAgICAgIH0pO1xuICAgICAgICBUYmRFdmVudHMuZGlzcGF0Y2hFdmVudChcImdyb3Vwc1JlZ2VuZXJhdGVkXCIsIHsgZ3JvdXBzOiB0aGlzLmdyb3VwcyB9KTtcbiAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJuZXh0R3JvdXBcIiwge1xuICAgICAgICAgICAgZ3JvdXA6IHRoaXMuZ2V0R3JvdXBzKClbMF0sXG4gICAgICAgICAgICBncm91cE51bWJlcjogMSxcbiAgICAgICAgfSk7XG4gICAgfVxufVxuY2xhc3MgVGJkR3JvdXAge1xuICAgIGNvbnN0cnVjdG9yKHdvcmRzZXQpIHtcbiAgICAgICAgdGhpcy50aHJlc2hvbGQgPSAxO1xuICAgICAgICB0aGlzLndvcmRzZXQgPSB3b3Jkc2V0O1xuICAgIH1cbiAgICBnZXRXb3Jkc2V0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy53b3Jkc2V0O1xuICAgIH1cbiAgICBnZXRUaHJlc2hvbGQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRocmVzaG9sZDtcbiAgICB9XG4gICAgYnVtcFRocmVzaG9sZCgpIHtcbiAgICAgICAgdGhpcy50aHJlc2hvbGQgKz0gMTtcbiAgICAgICAgVGJkRXZlbnRzLmRpc3BhdGNoRXZlbnQoXCJncm91cFRocmVzaG9sZENoYW5nZWRcIiwge1xuICAgICAgICAgICAgdGhyZXNob2xkOiB0aGlzLnRocmVzaG9sZCxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldFVuYmVhdGVuV29yZHNldCgpIHtcbiAgICAgICAgY29uc3QgdW5iZWF0ZW5Xb3JkcyA9IHRoaXMud29yZHNldC53b3Jkcy5maWx0ZXIoKHdvcmQpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAhVGJkRGF0YS5oYXNXb3JkQmVlblR5cGVkRmFzdGVyVGhhbih3b3JkLCB0aGlzLmdldFRocmVzaG9sZCgpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBuZXcgd29yZHNldF8xLldvcmRzZXQodW5iZWF0ZW5Xb3Jkcyk7XG4gICAgfVxuICAgIGluY3JlYXNlVGhyZXNob2xkVW50aWxTb21lV29yZHNBcmVVbmJlYXRlbigpIHtcbiAgICAgICAgaWYgKHRoaXMud29yZHNldC5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHdoaWxlICh0aGlzLmdldFVuYmVhdGVuV29yZHNldCgpLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmJ1bXBUaHJlc2hvbGQoKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbkNvbmZpZ0V2ZW50LnN1YnNjcmliZShoYW5kbGVGdW5ib3hDaGFuZ2UpO1xuZnVuY3Rpb24gaXNUYmRNb2RlKCkge1xuICAgIHJldHVybiBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PSBcInRiZG1vZGVcIjtcbn1cbmZ1bmN0aW9uIGhhbmRsZUZ1bmJveENoYW5nZShrZXksIF9uZXdWYWx1ZSwgX25vc2F2ZSwgX3ByZXZpb3VzVmFsdWUsIF9mdWxsQ29uZmlnKSB7XG4gICAgaWYgKGtleSAhPSBcImZ1bmJveFwiKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGlzVGJkTW9kZSgpICYmICFnZXRUYmRNb2RlKCkpIHtcbiAgICAgICAgY29uc3QgdGJkQ29uZmlnID0gbmV3IFRiZENvbmZpZygpO1xuICAgICAgICB0YmRDb25maWcuaW5pdCgpO1xuICAgICAgICB0YmRNb2RlID0gbmV3IFRiZE1vZGUodGJkQ29uZmlnKTtcbiAgICAgICAgdGJkTW9kZS5pbml0KCk7XG4gICAgICAgIGNvbnN0IHVpID0gbmV3IFRiZFVJKHRiZE1vZGUpO1xuICAgICAgICB1aS5pbml0KCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKCFpc1RiZE1vZGUoKSAmJiBnZXRUYmRNb2RlKCkpIHtcbiAgICAgICAgLy8gVGhpcyB3YXMgdGhlIGVhc2llc3Qgd2F5IEkgY291bGQgdGhpbmsgb2YgdG8gZW5zdXJlIHRoZXJlJ3Mgbm90aGluZyBsZWZ0IG92ZXJcbiAgICAgICAgLy8gYWZ0ZXIgc3dpdGNoaW5nIGZyb20gVEJEIE1vZGUgdG8gc29tZXRoaW5nIGVsc2UuXG4gICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICAgIH1cbn1cbmxldCB0YmRNb2RlO1xuZnVuY3Rpb24gZ2V0VGJkTW9kZSgpIHtcbiAgICByZXR1cm4gdGJkTW9kZTtcbn1cbmV4cG9ydHMuZ2V0VGJkTW9kZSA9IGdldFRiZE1vZGU7XG5Db25maWdTdHVmZi5zZXRGdW5ib3goXCJ0YmRtb2RlXCIpO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudXBkYXRlID0gZXhwb3J0cy5oaWRlID0gZXhwb3J0cy5zaG93ID0gdm9pZCAwO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbi8vIGV4cG9ydCBmdW5jdGlvbiBzaG93KCkge1xuLy8gICAkKFwiI3RvcCAuY29uZmlnXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpLmNzcyhcIm9wYWNpdHlcIiwgMSk7XG4vLyB9XG4vLyBleHBvcnQgZnVuY3Rpb24gaGlkZSgpIHtcbi8vICAgJChcIiN0b3AgLmNvbmZpZ1wiKS5jc3MoXCJvcGFjaXR5XCIsIDApLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuLy8gfVxuZnVuY3Rpb24gc2hvdygpIHtcbiAgICAkKFwiI3RvcCAuY29uZmlnXCIpXG4gICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgIG9wYWNpdHk6IDEsXG4gICAgfSwgMTI1KTtcbn1cbmV4cG9ydHMuc2hvdyA9IHNob3c7XG5mdW5jdGlvbiBoaWRlKCkge1xuICAgICQoXCIjdG9wIC5jb25maWdcIilcbiAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMSlcbiAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiAwLFxuICAgIH0sIDEyNSwgKCkgPT4ge1xuICAgICAgICAkKFwiI3RvcCAuY29uZmlnXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbmZ1bmN0aW9uIHVwZGF0ZShwcmV2aW91cywgY3VycmVudCkge1xuICAgIGlmIChwcmV2aW91cyA9PT0gY3VycmVudClcbiAgICAgICAgcmV0dXJuO1xuICAgICQoXCIjdG9wIC5jb25maWcgLm1vZGUgLnRleHQtYnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICQoXCIjdG9wIC5jb25maWcgLm1vZGUgLnRleHQtYnV0dG9uW21vZGU9J1wiICsgY3VycmVudCArIFwiJ11cIikuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgaWYgKGN1cnJlbnQgPT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAud29yZENvdW50XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC50aW1lXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5jdXN0b21UZXh0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI3RvcCAuY29uZmlnIC5wdW5jdHVhdGlvbk1vZGVcIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgJChcIiN0b3AgLmNvbmZpZyAubnVtYmVyc01vZGVcIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAucHVuY0FuZE51bVwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5wdW5jdHVhdGlvbk1vZGVcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLm51bWJlcnNNb2RlXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5xdW90ZUxlbmd0aFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY3VycmVudCA9PSBcIndvcmRzXCIpIHtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAud29yZENvdW50XCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC50aW1lXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5jdXN0b21UZXh0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiI3RvcCAuY29uZmlnIC5wdW5jdHVhdGlvbk1vZGVcIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgJChcIiN0b3AgLmNvbmZpZyAubnVtYmVyc01vZGVcIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAucHVuY0FuZE51bVwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5wdW5jdHVhdGlvbk1vZGVcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLm51bWJlcnNNb2RlXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5xdW90ZUxlbmd0aFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY3VycmVudCA9PSBcImN1c3RvbVwiKSB7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLndvcmRDb3VudFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAudGltZVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAuY3VzdG9tVGV4dFwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiN0b3AgLmNvbmZpZyAucHVuY3R1YXRpb25Nb2RlXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICQoXCIjdG9wIC5jb25maWcgLm51bWJlcnNNb2RlXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLnB1bmNBbmROdW1cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAucHVuY3R1YXRpb25Nb2RlXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5udW1iZXJzTW9kZVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAucXVvdGVMZW5ndGhcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgfVxuICAgIGVsc2UgaWYgKGN1cnJlbnQgPT0gXCJxdW90ZVwiKSB7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLndvcmRDb3VudFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAudGltZVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAuY3VzdG9tVGV4dFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiN0b3AgLmNvbmZpZyAucHVuY3R1YXRpb25Nb2RlXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICQoXCIjdG9wIC5jb25maWcgLm51bWJlcnNNb2RlXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLnB1bmNBbmROdW1cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAucHVuY3R1YXRpb25Nb2RlXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5udW1iZXJzTW9kZVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgLy8gJChcIiNyZXN1bHQgLnN0YXRzIC5zb3VyY2VcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLnF1b3RlTGVuZ3RoXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjdXJyZW50ID09IFwiemVuXCIpIHtcbiAgICAgICAgLy8gJChcIiN0b3AgLmNvbmZpZyAud29yZENvdW50XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC50aW1lXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5jdXN0b21UZXh0XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5wdW5jdHVhdGlvbk1vZGVcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIC8vICQoXCIjdG9wIC5jb25maWcgLm51bWJlcnNNb2RlXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyAkKFwiI3RvcCAuY29uZmlnIC5xdW90ZUxlbmd0aFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgY29uc3Qgc3VibWVudSA9IHtcbiAgICAgICAgdGltZTogXCJ0aW1lXCIsXG4gICAgICAgIHdvcmRzOiBcIndvcmRDb3VudFwiLFxuICAgICAgICBjdXN0b206IFwiY3VzdG9tVGV4dFwiLFxuICAgICAgICBxdW90ZTogXCJxdW90ZUxlbmd0aFwiLFxuICAgICAgICB6ZW46IFwiXCIsXG4gICAgfTtcbiAgICBjb25zdCBhbmltVGltZSA9IDI1MDtcbiAgICBpZiAoY3VycmVudCA9PSBcInplblwiKSB7XG4gICAgICAgICQoYCN0b3AgLmNvbmZpZyAuJHtzdWJtZW51W3ByZXZpb3VzXX1gKS5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIH0sIGFuaW1UaW1lIC8gMiwgKCkgPT4ge1xuICAgICAgICAgICAgJChgI3RvcCAuY29uZmlnIC4ke3N1Ym1lbnVbcHJldmlvdXNdfWApLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgJChgI3RvcCAuY29uZmlnIC5wdW5jQW5kTnVtYCkuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICB9LCBhbmltVGltZSAvIDIsICgpID0+IHtcbiAgICAgICAgICAgICQoYCN0b3AgLmNvbmZpZyAucHVuY0FuZE51bWApLmFkZENsYXNzKFwiaW52aXNpYmxlXCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAocHJldmlvdXMgPT0gXCJ6ZW5cIikge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICQoYCN0b3AgLmNvbmZpZyAuJHtzdWJtZW51W2N1cnJlbnRdfWApLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChgI3RvcCAuY29uZmlnIC4ke3N1Ym1lbnVbY3VycmVudF19YClcbiAgICAgICAgICAgICAgICAuY3NzKHsgb3BhY2l0eTogMCB9KVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgfSwgYW5pbVRpbWUgLyAyKTtcbiAgICAgICAgICAgICQoYCN0b3AgLmNvbmZpZyAucHVuY0FuZE51bWApLnJlbW92ZUNsYXNzKFwiaW52aXNpYmxlXCIpO1xuICAgICAgICAgICAgJChgI3RvcCAuY29uZmlnIC5wdW5jQW5kTnVtYClcbiAgICAgICAgICAgICAgICAuY3NzKHsgb3BhY2l0eTogMCB9KVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgfSwgYW5pbVRpbWUgLyAyKTtcbiAgICAgICAgfSwgYW5pbVRpbWUgLyAyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBNaXNjLnN3YXBFbGVtZW50cygkKFwiI3RvcCAuY29uZmlnIC5cIiArIHN1Ym1lbnVbcHJldmlvdXNdKSwgJChcIiN0b3AgLmNvbmZpZyAuXCIgKyBzdWJtZW51W2N1cnJlbnRdKSwgYW5pbVRpbWUpO1xufVxuZXhwb3J0cy51cGRhdGUgPSB1cGRhdGU7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5LCBldmVudFZhbHVlLCBfbm9zYXZlLCBldmVudFByZXZpb3VzVmFsdWUpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwibW9kZVwiKSB7XG4gICAgICAgIHVwZGF0ZShldmVudFByZXZpb3VzVmFsdWUsIGV2ZW50VmFsdWUpO1xuICAgIH1cbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucmVzdGFydCA9IGV4cG9ydHMucHVzaEJ1cnN0VG9IaXN0b3J5ID0gZXhwb3J0cy5wdXNoVG9SYXdIaXN0b3J5ID0gZXhwb3J0cy5wdXNoVG9XcG1IaXN0b3J5ID0gZXhwb3J0cy5wdXNoTWlzc2VkV29yZCA9IGV4cG9ydHMucmVzZXRLZXlwcmVzc1RpbWluZ3MgPSBleHBvcnRzLnJlY29yZEtleXByZXNzU3BhY2luZyA9IGV4cG9ydHMuc2V0S2V5cHJlc3NEdXJhdGlvbiA9IGV4cG9ydHMucHVzaEtleXByZXNzRHVyYXRpb24gPSBleHBvcnRzLnNldEtleXByZXNzVGltaW5nc1Rvb0xvbmcgPSBleHBvcnRzLmluY3JlbWVudEFjY3VyYWN5ID0gZXhwb3J0cy5wdXNoS2V5cHJlc3Nlc1RvSGlzdG9yeSA9IGV4cG9ydHMuc2V0QnVyc3RTdGFydCA9IGV4cG9ydHMucHVzaEtleXByZXNzV29yZCA9IGV4cG9ydHMuaW5jcmVtZW50S2V5cHJlc3NFcnJvcnMgPSBleHBvcnRzLnNldEtleXByZXNzTm90QWZrID0gZXhwb3J0cy5pbmNyZW1lbnRLZXlwcmVzc0NvdW50ID0gZXhwb3J0cy51cGRhdGVMYXN0S2V5cHJlc3MgPSBleHBvcnRzLmVuYWJsZVNwYWNpbmdEZWJ1ZyA9IGV4cG9ydHMuc3BhY2luZ0RlYnVnID0gZXhwb3J0cy5zZXRCYWlsb3V0ID0gZXhwb3J0cy5iYWlsb3V0ID0gZXhwb3J0cy5idXJzdEhpc3RvcnkgPSBleHBvcnRzLnJhd0hpc3RvcnkgPSBleHBvcnRzLndwbUhpc3RvcnkgPSBleHBvcnRzLmtleXByZXNzVGltaW5ncyA9IGV4cG9ydHMuYWNjdXJhY3kgPSBleHBvcnRzLm1pc3NlZFdvcmRzID0gZXhwb3J0cy5jdXJyZW50QnVyc3RTdGFydCA9IGV4cG9ydHMubGFzdEtleXByZXNzID0gZXhwb3J0cy5jdXJyZW50S2V5cHJlc3MgPSBleHBvcnRzLmtleXByZXNzUGVyU2Vjb25kID0gZXhwb3J0cy5jb3JyZWN0ZWQgPSBleHBvcnRzLmlucHV0ID0gdm9pZCAwO1xuY29uc3QgVGVzdFdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtd29yZHNcIikpO1xuY29uc3QgbWlzY18xID0gcmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIik7XG5jbGFzcyBJbnB1dCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuY3VycmVudCA9IFwiXCI7XG4gICAgICAgIHRoaXMuaGlzdG9yeSA9IFtdO1xuICAgICAgICB0aGlzLmhpc3RvcnlMZW5ndGggPSAwO1xuICAgICAgICB0aGlzLmxlbmd0aCA9IDA7XG4gICAgfVxuICAgIHJlc2V0KCkge1xuICAgICAgICB0aGlzLmN1cnJlbnQgPSBcIlwiO1xuICAgICAgICB0aGlzLmhpc3RvcnkgPSBbXTtcbiAgICAgICAgdGhpcy5sZW5ndGggPSAwO1xuICAgIH1cbiAgICByZXNldEhpc3RvcnkoKSB7XG4gICAgICAgIHRoaXMuaGlzdG9yeSA9IFtdO1xuICAgICAgICB0aGlzLmxlbmd0aCA9IDA7XG4gICAgfVxuICAgIHNldEN1cnJlbnQodmFsKSB7XG4gICAgICAgIHRoaXMuY3VycmVudCA9IHZhbDtcbiAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLmN1cnJlbnQubGVuZ3RoO1xuICAgIH1cbiAgICBhcHBlbmRDdXJyZW50KHZhbCkge1xuICAgICAgICB0aGlzLmN1cnJlbnQgKz0gdmFsO1xuICAgICAgICB0aGlzLmxlbmd0aCA9IHRoaXMuY3VycmVudC5sZW5ndGg7XG4gICAgfVxuICAgIHJlc2V0Q3VycmVudCgpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50ID0gXCJcIjtcbiAgICB9XG4gICAgZ2V0Q3VycmVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudDtcbiAgICB9XG4gICAgcHVzaEhpc3RvcnkoKSB7XG4gICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKHRoaXMuY3VycmVudCk7XG4gICAgICAgIHRoaXMuaGlzdG9yeUxlbmd0aCA9IHRoaXMuaGlzdG9yeS5sZW5ndGg7XG4gICAgICAgIHRoaXMucmVzZXRDdXJyZW50KCk7XG4gICAgfVxuICAgIHBvcEhpc3RvcnkoKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgcmV0ID0gKF9hID0gdGhpcy5oaXN0b3J5LnBvcCgpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIlwiO1xuICAgICAgICB0aGlzLmhpc3RvcnlMZW5ndGggPSB0aGlzLmhpc3RvcnkubGVuZ3RoO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH1cbiAgICBnZXRIaXN0b3J5KGkpIHtcbiAgICAgICAgaWYgKGkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGlzdG9yeTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmhpc3RvcnlbaV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0SGlzdG9yeUxhc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhpc3RvcnlbdGhpcy5oaXN0b3J5Lmxlbmd0aCAtIDFdO1xuICAgIH1cbn1cbmNsYXNzIENvcnJlY3RlZCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuY3VycmVudCA9IFwiXCI7XG4gICAgICAgIHRoaXMuaGlzdG9yeSA9IFtdO1xuICAgIH1cbiAgICBzZXRDdXJyZW50KHZhbCkge1xuICAgICAgICB0aGlzLmN1cnJlbnQgPSB2YWw7XG4gICAgfVxuICAgIGFwcGVuZEN1cnJlbnQodmFsKSB7XG4gICAgICAgIHRoaXMuY3VycmVudCArPSB2YWw7XG4gICAgfVxuICAgIHJlc2V0Q3VycmVudCgpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50ID0gXCJcIjtcbiAgICB9XG4gICAgcmVzZXRIaXN0b3J5KCkge1xuICAgICAgICB0aGlzLmhpc3RvcnkgPSBbXTtcbiAgICB9XG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMucmVzZXRDdXJyZW50KCk7XG4gICAgICAgIHRoaXMucmVzZXRIaXN0b3J5KCk7XG4gICAgfVxuICAgIGdldEhpc3RvcnkoaSkge1xuICAgICAgICByZXR1cm4gdGhpcy5oaXN0b3J5W2ldO1xuICAgIH1cbiAgICBwb3BIaXN0b3J5KCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHJldHVybiAoX2EgPSB0aGlzLmhpc3RvcnkucG9wKCkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiXCI7XG4gICAgfVxuICAgIHB1c2hIaXN0b3J5KCkge1xuICAgICAgICB0aGlzLmhpc3RvcnkucHVzaCh0aGlzLmN1cnJlbnQpO1xuICAgICAgICB0aGlzLmN1cnJlbnQgPSBcIlwiO1xuICAgIH1cbn1cbmV4cG9ydHMuaW5wdXQgPSBuZXcgSW5wdXQoKTtcbmV4cG9ydHMuY29ycmVjdGVkID0gbmV3IENvcnJlY3RlZCgpO1xuZXhwb3J0cy5rZXlwcmVzc1BlclNlY29uZCA9IFtdO1xuZXhwb3J0cy5jdXJyZW50S2V5cHJlc3MgPSB7XG4gICAgY291bnQ6IDAsXG4gICAgZXJyb3JzOiAwLFxuICAgIHdvcmRzOiBbXSxcbiAgICBhZms6IHRydWUsXG59O1xuZXhwb3J0cy5jdXJyZW50QnVyc3RTdGFydCA9IDA7XG5leHBvcnRzLm1pc3NlZFdvcmRzID0ge307XG5leHBvcnRzLmFjY3VyYWN5ID0ge1xuICAgIGNvcnJlY3Q6IDAsXG4gICAgaW5jb3JyZWN0OiAwLFxufTtcbmV4cG9ydHMua2V5cHJlc3NUaW1pbmdzID0ge1xuICAgIHNwYWNpbmc6IHtcbiAgICAgICAgY3VycmVudDogLTEsXG4gICAgICAgIGFycmF5OiBbXSxcbiAgICB9LFxuICAgIGR1cmF0aW9uOiB7XG4gICAgICAgIGN1cnJlbnQ6IC0xLFxuICAgICAgICBhcnJheTogW10sXG4gICAgfSxcbn07XG5leHBvcnRzLndwbUhpc3RvcnkgPSBbXTtcbmV4cG9ydHMucmF3SGlzdG9yeSA9IFtdO1xuZXhwb3J0cy5idXJzdEhpc3RvcnkgPSBbXTtcbmV4cG9ydHMuYmFpbG91dCA9IGZhbHNlO1xuZnVuY3Rpb24gc2V0QmFpbG91dCh0Zikge1xuICAgIGV4cG9ydHMuYmFpbG91dCA9IHRmO1xufVxuZXhwb3J0cy5zZXRCYWlsb3V0ID0gc2V0QmFpbG91dDtcbmV4cG9ydHMuc3BhY2luZ0RlYnVnID0gZmFsc2U7XG5mdW5jdGlvbiBlbmFibGVTcGFjaW5nRGVidWcoKSB7XG4gICAgZXhwb3J0cy5zcGFjaW5nRGVidWcgPSB0cnVlO1xuICAgIGNvbnNvbGUuY2xlYXIoKTtcbn1cbmV4cG9ydHMuZW5hYmxlU3BhY2luZ0RlYnVnID0gZW5hYmxlU3BhY2luZ0RlYnVnO1xuZnVuY3Rpb24gdXBkYXRlTGFzdEtleXByZXNzKCkge1xuICAgIGV4cG9ydHMubGFzdEtleXByZXNzID0gcGVyZm9ybWFuY2Uubm93KCk7XG59XG5leHBvcnRzLnVwZGF0ZUxhc3RLZXlwcmVzcyA9IHVwZGF0ZUxhc3RLZXlwcmVzcztcbmZ1bmN0aW9uIGluY3JlbWVudEtleXByZXNzQ291bnQoKSB7XG4gICAgZXhwb3J0cy5jdXJyZW50S2V5cHJlc3MuY291bnQrKztcbn1cbmV4cG9ydHMuaW5jcmVtZW50S2V5cHJlc3NDb3VudCA9IGluY3JlbWVudEtleXByZXNzQ291bnQ7XG5mdW5jdGlvbiBzZXRLZXlwcmVzc05vdEFmaygpIHtcbiAgICBleHBvcnRzLmN1cnJlbnRLZXlwcmVzcy5hZmsgPSBmYWxzZTtcbn1cbmV4cG9ydHMuc2V0S2V5cHJlc3NOb3RBZmsgPSBzZXRLZXlwcmVzc05vdEFmaztcbmZ1bmN0aW9uIGluY3JlbWVudEtleXByZXNzRXJyb3JzKCkge1xuICAgIGV4cG9ydHMuY3VycmVudEtleXByZXNzLmVycm9ycysrO1xufVxuZXhwb3J0cy5pbmNyZW1lbnRLZXlwcmVzc0Vycm9ycyA9IGluY3JlbWVudEtleXByZXNzRXJyb3JzO1xuZnVuY3Rpb24gcHVzaEtleXByZXNzV29yZCh3b3JkSW5kZXgpIHtcbiAgICBleHBvcnRzLmN1cnJlbnRLZXlwcmVzcy53b3Jkcy5wdXNoKHdvcmRJbmRleCk7XG59XG5leHBvcnRzLnB1c2hLZXlwcmVzc1dvcmQgPSBwdXNoS2V5cHJlc3NXb3JkO1xuZnVuY3Rpb24gc2V0QnVyc3RTdGFydCh0aW1lKSB7XG4gICAgZXhwb3J0cy5jdXJyZW50QnVyc3RTdGFydCA9IHRpbWU7XG59XG5leHBvcnRzLnNldEJ1cnN0U3RhcnQgPSBzZXRCdXJzdFN0YXJ0O1xuZnVuY3Rpb24gcHVzaEtleXByZXNzZXNUb0hpc3RvcnkoKSB7XG4gICAgZXhwb3J0cy5rZXlwcmVzc1BlclNlY29uZC5wdXNoKGV4cG9ydHMuY3VycmVudEtleXByZXNzKTtcbiAgICBleHBvcnRzLmN1cnJlbnRLZXlwcmVzcyA9IHtcbiAgICAgICAgY291bnQ6IDAsXG4gICAgICAgIGVycm9yczogMCxcbiAgICAgICAgd29yZHM6IFtdLFxuICAgICAgICBhZms6IHRydWUsXG4gICAgfTtcbn1cbmV4cG9ydHMucHVzaEtleXByZXNzZXNUb0hpc3RvcnkgPSBwdXNoS2V5cHJlc3Nlc1RvSGlzdG9yeTtcbmZ1bmN0aW9uIGluY3JlbWVudEFjY3VyYWN5KGNvcnJlY3RpbmNvcnJlY3QpIHtcbiAgICBpZiAoY29ycmVjdGluY29ycmVjdCkge1xuICAgICAgICBleHBvcnRzLmFjY3VyYWN5LmNvcnJlY3QrKztcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGV4cG9ydHMuYWNjdXJhY3kuaW5jb3JyZWN0Kys7XG4gICAgfVxufVxuZXhwb3J0cy5pbmNyZW1lbnRBY2N1cmFjeSA9IGluY3JlbWVudEFjY3VyYWN5O1xuZnVuY3Rpb24gc2V0S2V5cHJlc3NUaW1pbmdzVG9vTG9uZygpIHtcbiAgICBleHBvcnRzLmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmFycmF5ID0gXCJ0b29sb25nXCI7XG4gICAgZXhwb3J0cy5rZXlwcmVzc1RpbWluZ3MuZHVyYXRpb24uYXJyYXkgPSBcInRvb2xvbmdcIjtcbn1cbmV4cG9ydHMuc2V0S2V5cHJlc3NUaW1pbmdzVG9vTG9uZyA9IHNldEtleXByZXNzVGltaW5nc1Rvb0xvbmc7XG5mdW5jdGlvbiBwdXNoS2V5cHJlc3NEdXJhdGlvbih2YWwpIHtcbiAgICBleHBvcnRzLmtleXByZXNzVGltaW5ncy5kdXJhdGlvbi5hcnJheS5wdXNoKCgwLCBtaXNjXzEucm91bmRUbzIpKHZhbCkpO1xufVxuZXhwb3J0cy5wdXNoS2V5cHJlc3NEdXJhdGlvbiA9IHB1c2hLZXlwcmVzc0R1cmF0aW9uO1xuZnVuY3Rpb24gc2V0S2V5cHJlc3NEdXJhdGlvbih2YWwpIHtcbiAgICBleHBvcnRzLmtleXByZXNzVGltaW5ncy5kdXJhdGlvbi5jdXJyZW50ID0gKDAsIG1pc2NfMS5yb3VuZFRvMikodmFsKTtcbn1cbmV4cG9ydHMuc2V0S2V5cHJlc3NEdXJhdGlvbiA9IHNldEtleXByZXNzRHVyYXRpb247XG5mdW5jdGlvbiBwdXNoS2V5cHJlc3NTcGFjaW5nKHZhbCkge1xuICAgIGV4cG9ydHMua2V5cHJlc3NUaW1pbmdzLnNwYWNpbmcuYXJyYXkucHVzaCgoMCwgbWlzY18xLnJvdW5kVG8yKSh2YWwpKTtcbn1cbmZ1bmN0aW9uIHNldEtleXByZXNzU3BhY2luZyh2YWwpIHtcbiAgICBleHBvcnRzLmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmN1cnJlbnQgPSAoMCwgbWlzY18xLnJvdW5kVG8yKSh2YWwpO1xufVxuZnVuY3Rpb24gcmVjb3JkS2V5cHJlc3NTcGFjaW5nKCkge1xuICAgIGNvbnN0IG5vdyA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIGNvbnN0IGRpZmYgPSBNYXRoLmFicyhleHBvcnRzLmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmN1cnJlbnQgLSBub3cpO1xuICAgIGlmIChleHBvcnRzLmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmN1cnJlbnQgIT09IC0xKSB7XG4gICAgICAgIHB1c2hLZXlwcmVzc1NwYWNpbmcoZGlmZik7XG4gICAgICAgIGlmIChleHBvcnRzLnNwYWNpbmdEZWJ1Zykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJzcGFjaW5nIGRlYnVnXCIsIFwicHVzaFwiLCBkaWZmLCBcImxlbmd0aFwiLCBleHBvcnRzLmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmFycmF5Lmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0S2V5cHJlc3NTcGFjaW5nKG5vdyk7XG4gICAgaWYgKGV4cG9ydHMuc3BhY2luZ0RlYnVnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwic3BhY2luZyBkZWJ1Z1wiLCBcInNldFwiLCBub3csIFwibGVuZ3RoXCIsIGV4cG9ydHMua2V5cHJlc3NUaW1pbmdzLnNwYWNpbmcuYXJyYXkubGVuZ3RoKTtcbiAgICB9XG4gICAgaWYgKGV4cG9ydHMuc3BhY2luZ0RlYnVnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwic3BhY2luZyBkZWJ1Z1wiLCBcInJlY29yZGVkXCIsIFwibGVuZ3RoXCIsIGV4cG9ydHMua2V5cHJlc3NUaW1pbmdzLnNwYWNpbmcuYXJyYXkubGVuZ3RoKTtcbiAgICB9XG59XG5leHBvcnRzLnJlY29yZEtleXByZXNzU3BhY2luZyA9IHJlY29yZEtleXByZXNzU3BhY2luZztcbmZ1bmN0aW9uIHJlc2V0S2V5cHJlc3NUaW1pbmdzKCkge1xuICAgIGV4cG9ydHMua2V5cHJlc3NUaW1pbmdzID0ge1xuICAgICAgICBzcGFjaW5nOiB7XG4gICAgICAgICAgICBjdXJyZW50OiBwZXJmb3JtYW5jZS5ub3coKSxcbiAgICAgICAgICAgIGFycmF5OiBbXSxcbiAgICAgICAgfSxcbiAgICAgICAgZHVyYXRpb246IHtcbiAgICAgICAgICAgIGN1cnJlbnQ6IHBlcmZvcm1hbmNlLm5vdygpLFxuICAgICAgICAgICAgYXJyYXk6IFtdLFxuICAgICAgICB9LFxuICAgIH07XG4gICAgaWYgKGV4cG9ydHMuc3BhY2luZ0RlYnVnKVxuICAgICAgICBjb25zb2xlLmNsZWFyKCk7XG59XG5leHBvcnRzLnJlc2V0S2V5cHJlc3NUaW1pbmdzID0gcmVzZXRLZXlwcmVzc1RpbWluZ3M7XG5mdW5jdGlvbiBwdXNoTWlzc2VkV29yZCh3b3JkKSB7XG4gICAgaWYgKCFPYmplY3Qua2V5cyhleHBvcnRzLm1pc3NlZFdvcmRzKS5pbmNsdWRlcyh3b3JkKSkge1xuICAgICAgICBleHBvcnRzLm1pc3NlZFdvcmRzW3dvcmRdID0gMTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGV4cG9ydHMubWlzc2VkV29yZHNbd29yZF0rKztcbiAgICB9XG59XG5leHBvcnRzLnB1c2hNaXNzZWRXb3JkID0gcHVzaE1pc3NlZFdvcmQ7XG5mdW5jdGlvbiBwdXNoVG9XcG1IaXN0b3J5KHdwbSkge1xuICAgIGV4cG9ydHMud3BtSGlzdG9yeS5wdXNoKHdwbSk7XG59XG5leHBvcnRzLnB1c2hUb1dwbUhpc3RvcnkgPSBwdXNoVG9XcG1IaXN0b3J5O1xuZnVuY3Rpb24gcHVzaFRvUmF3SGlzdG9yeShyYXcpIHtcbiAgICBleHBvcnRzLnJhd0hpc3RvcnkucHVzaChyYXcpO1xufVxuZXhwb3J0cy5wdXNoVG9SYXdIaXN0b3J5ID0gcHVzaFRvUmF3SGlzdG9yeTtcbmZ1bmN0aW9uIHB1c2hCdXJzdFRvSGlzdG9yeShzcGVlZCkge1xuICAgIGlmIChleHBvcnRzLmJ1cnN0SGlzdG9yeVtUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGV4cG9ydHMuYnVyc3RIaXN0b3J5LnB1c2goc3BlZWQpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy9yZXBlYXRlZCB3b3JkIC0gb3ZlcnJpZGVcbiAgICAgICAgZXhwb3J0cy5idXJzdEhpc3RvcnlbVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleF0gPSBzcGVlZDtcbiAgICB9XG59XG5leHBvcnRzLnB1c2hCdXJzdFRvSGlzdG9yeSA9IHB1c2hCdXJzdFRvSGlzdG9yeTtcbmZ1bmN0aW9uIHJlc3RhcnQoKSB7XG4gICAgZXhwb3J0cy53cG1IaXN0b3J5ID0gW107XG4gICAgZXhwb3J0cy5yYXdIaXN0b3J5ID0gW107XG4gICAgZXhwb3J0cy5idXJzdEhpc3RvcnkgPSBbXTtcbiAgICBleHBvcnRzLmtleXByZXNzUGVyU2Vjb25kID0gW107XG4gICAgZXhwb3J0cy5jdXJyZW50S2V5cHJlc3MgPSB7XG4gICAgICAgIGNvdW50OiAwLFxuICAgICAgICBlcnJvcnM6IDAsXG4gICAgICAgIHdvcmRzOiBbXSxcbiAgICAgICAgYWZrOiB0cnVlLFxuICAgIH07XG4gICAgZXhwb3J0cy5jdXJyZW50QnVyc3RTdGFydCA9IDA7XG4gICAgZXhwb3J0cy5taXNzZWRXb3JkcyA9IHt9O1xuICAgIGV4cG9ydHMuYWNjdXJhY3kgPSB7XG4gICAgICAgIGNvcnJlY3Q6IDAsXG4gICAgICAgIGluY29ycmVjdDogMCxcbiAgICB9O1xuICAgIGV4cG9ydHMua2V5cHJlc3NUaW1pbmdzID0ge1xuICAgICAgICBzcGFjaW5nOiB7XG4gICAgICAgICAgICBjdXJyZW50OiAtMSxcbiAgICAgICAgICAgIGFycmF5OiBbXSxcbiAgICAgICAgfSxcbiAgICAgICAgZHVyYXRpb246IHtcbiAgICAgICAgICAgIGN1cnJlbnQ6IC0xLFxuICAgICAgICAgICAgYXJyYXk6IFtdLFxuICAgICAgICB9LFxuICAgIH07XG59XG5leHBvcnRzLnJlc3RhcnQgPSByZXN0YXJ0O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5mYWlsID0gZXhwb3J0cy5maW5pc2ggPSBleHBvcnRzLnJldHJ5U2F2aW5nUmVzdWx0ID0gZXhwb3J0cy5hZGRXb3JkID0gZXhwb3J0cy5pbml0ID0gZXhwb3J0cy5yZXN0YXJ0ID0gZXhwb3J0cy5zdGFydFRlc3QgPSBleHBvcnRzLnB1bmN0dWF0ZVdvcmQgPSBleHBvcnRzLnNldE5vdFNpZ25lZEluVWlkID0gZXhwb3J0cy5jbGVhck5vdFNpZ25lZEluUmVzdWx0ID0gZXhwb3J0cy5ub3RTaWduZWRJbkxhc3RSZXN1bHQgPSB2b2lkIDA7XG5jb25zdCBhcGVfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vYXBlXCIpKTtcbmNvbnN0IFRlc3RVSSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXVpXCIpKTtcbmNvbnN0IE1hbnVhbFJlc3RhcnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbWFudWFsLXJlc3RhcnQtdHJhY2tlclwiKSk7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IHF1b3Rlc19jb250cm9sbGVyXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbnRyb2xsZXJzL3F1b3Rlcy1jb250cm9sbGVyXCIpKTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuY29uc3QgQ3VzdG9tVGV4dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jdXN0b20tdGV4dFwiKSk7XG5jb25zdCBUZXN0U3RhdHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC1zdGF0c1wiKSk7XG5jb25zdCBQcmFjdGlzZVdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3ByYWN0aXNlLXdvcmRzXCIpKTtcbmNvbnN0IFNoaWZ0VHJhY2tlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9zaGlmdC10cmFja2VyXCIpKTtcbmNvbnN0IEZvY3VzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2ZvY3VzXCIpKTtcbmNvbnN0IEZ1bmJveCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9mdW5ib3hcIikpO1xuY29uc3QgS2V5bWFwID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9rZXltYXBcIikpO1xuY29uc3QgVGhlbWVDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy90aGVtZS1jb250cm9sbGVyXCIpKTtcbmNvbnN0IFBhY2VDYXJldCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9wYWNlLWNhcmV0XCIpKTtcbmNvbnN0IENhcmV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2NhcmV0XCIpKTtcbmNvbnN0IExpdmVXcG0gPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbGl2ZS13cG1cIikpO1xuY29uc3QgTGl2ZUFjYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9saXZlLWFjY1wiKSk7XG5jb25zdCBMaXZlQnVyc3QgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbGl2ZS1idXJzdFwiKSk7XG5jb25zdCBUaW1lclByb2dyZXNzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3RpbWVyLXByb2dyZXNzXCIpKTtcbmNvbnN0IFF1b3RlU2VhcmNoUG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BvcHVwcy9xdW90ZS1zZWFyY2gtcG9wdXBcIikpO1xuY29uc3QgUXVvdGVTdWJtaXRQb3B1cCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vcG9wdXBzL3F1b3RlLXN1Ym1pdC1wb3B1cFwiKSk7XG5jb25zdCBQYkNyb3duID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3BiLWNyb3duXCIpKTtcbmNvbnN0IFRlc3RUaW1lciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXRpbWVyXCIpKTtcbmNvbnN0IE91dE9mRm9jdXMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vb3V0LW9mLWZvY3VzXCIpKTtcbmNvbnN0IEFjY291bnRCdXR0b24gPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL2FjY291bnQtYnV0dG9uXCIpKTtcbmNvbnN0IERCID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9kYlwiKSk7XG5jb25zdCBSZXBsYXkgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vcmVwbGF5XCIpKTtcbmNvbnN0IFBvZXRyeSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9wb2V0cnlcIikpO1xuY29uc3QgV2lraXBlZGlhID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3dpa2lwZWRpYVwiKSk7XG5jb25zdCBUb2RheVRyYWNrZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdG9kYXktdHJhY2tlclwiKSk7XG5jb25zdCBXZWFrU3BvdCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi93ZWFrLXNwb3RcIikpO1xuY29uc3QgV29yZHNldCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi93b3Jkc2V0XCIpKTtcbmNvbnN0IENoYWxsZW5nZUNvbnRvbGxlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29udHJvbGxlcnMvY2hhbGxlbmdlLWNvbnRyb2xsZXJcIikpO1xuY29uc3QgUXVvdGVSYXRlUG9wdXAgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3BvcHVwcy9xdW90ZS1yYXRlLXBvcHVwXCIpKTtcbmNvbnN0IEJyaXRpc2hFbmdsaXNoID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2JyaXRpc2gtZW5nbGlzaFwiKSk7XG5jb25zdCBMYXp5TW9kZSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9sYXp5LW1vZGVcIikpO1xuY29uc3QgUmVzdWx0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Jlc3VsdFwiKSk7XG5jb25zdCBNb25rZXlQb3dlciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbW9ua2V5LXBvd2VyXCIpKTtcbmNvbnN0IEFjdGl2ZVBhZ2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9hY3RpdmUtcGFnZVwiKSk7XG5jb25zdCBUZXN0QWN0aXZlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvdGVzdC1hY3RpdmVcIikpO1xuY29uc3QgVGVzdElucHV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QtaW5wdXRcIikpO1xuY29uc3QgVGVzdFdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtd29yZHNcIikpO1xuY29uc3QgVGVzdFN0YXRlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtc3RhdGVcIikpO1xuY29uc3QgTW9kZXNOb3RpY2UgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL21vZGVzLW5vdGljZVwiKSk7XG5jb25zdCBQYWdlVHJhbnNpdGlvbiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3BhZ2UtdHJhbnNpdGlvblwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmNvbnN0IFRpbWVyRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL3RpbWVyLWV2ZW50XCIpKTtcbmNvbnN0IFJlc2V0UmVxdWVzdGVkRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL3Jlc2V0LXJlcXVlc3RlZC1ldmVudFwiKSk7XG5jb25zdCBMYXN0MTBBdmVyYWdlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sYXN0LTEwLWF2ZXJhZ2VcIikpO1xuY29uc3QgTW9ua2V5ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL21vbmtleVwiKSk7XG5jb25zdCB0YmRfbW9kZV8xID0gcmVxdWlyZShcIi4vdGJkLW1vZGVcIik7XG5jb25zdCBvYmplY3RfaGFzaF8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJvYmplY3QtaGFzaFwiKSk7XG5jb25zdCBBbmFseXRpY3NDb250cm9sbGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9hbmFseXRpY3MtY29udHJvbGxlclwiKSk7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xubGV0IGZhaWxSZWFzb24gPSBcIlwiO1xuZXhwb3J0cy5ub3RTaWduZWRJbkxhc3RSZXN1bHQgPSBudWxsO1xuZnVuY3Rpb24gY2xlYXJOb3RTaWduZWRJblJlc3VsdCgpIHtcbiAgICBleHBvcnRzLm5vdFNpZ25lZEluTGFzdFJlc3VsdCA9IG51bGw7XG59XG5leHBvcnRzLmNsZWFyTm90U2lnbmVkSW5SZXN1bHQgPSBjbGVhck5vdFNpZ25lZEluUmVzdWx0O1xuZnVuY3Rpb24gc2V0Tm90U2lnbmVkSW5VaWQodWlkKSB7XG4gICAgaWYgKGV4cG9ydHMubm90U2lnbmVkSW5MYXN0UmVzdWx0ID09PSBudWxsKVxuICAgICAgICByZXR1cm47XG4gICAgZXhwb3J0cy5ub3RTaWduZWRJbkxhc3RSZXN1bHQudWlkID0gdWlkO1xuICAgIGRlbGV0ZSBleHBvcnRzLm5vdFNpZ25lZEluTGFzdFJlc3VsdC5oYXNoO1xuICAgIGV4cG9ydHMubm90U2lnbmVkSW5MYXN0UmVzdWx0Lmhhc2ggPSAoMCwgb2JqZWN0X2hhc2hfMS5kZWZhdWx0KShleHBvcnRzLm5vdFNpZ25lZEluTGFzdFJlc3VsdCk7XG59XG5leHBvcnRzLnNldE5vdFNpZ25lZEluVWlkID0gc2V0Tm90U2lnbmVkSW5VaWQ7XG5sZXQgc3BhbmlzaFNlbnRlbmNlVHJhY2tlciA9IFwiXCI7XG5mdW5jdGlvbiBwdW5jdHVhdGVXb3JkKHByZXZpb3VzV29yZCwgY3VycmVudFdvcmQsIGluZGV4LCBtYXhpbmRleCkge1xuICAgIGxldCB3b3JkID0gY3VycmVudFdvcmQ7XG4gICAgY29uc3QgY3VycmVudExhbmd1YWdlID0gY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZS5zcGxpdChcIl9cIilbMF07XG4gICAgY29uc3QgbGFzdENoYXIgPSBNaXNjLmdldExhc3RDaGFyKHByZXZpb3VzV29yZCk7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcIjU4MDA4XCIpIHtcbiAgICAgICAgaWYgKGN1cnJlbnRXb3JkLmxlbmd0aCA+IDMpIHtcbiAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC43NSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNwZWNpYWwgPSBbXCIvXCIsIFwiKlwiLCBcIi1cIiwgXCIrXCJdW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDQpXTtcbiAgICAgICAgICAgICAgICB3b3JkID0gTWlzYy5zZXRDaGFyQXQod29yZCwgTWF0aC5mbG9vcih3b3JkLmxlbmd0aCAvIDIpLCBzcGVjaWFsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKChpbmRleCA9PSAwIHx8IGxhc3RDaGFyID09IFwiLlwiIHx8IGxhc3RDaGFyID09IFwiP1wiIHx8IGxhc3RDaGFyID09IFwiIVwiKSAmJlxuICAgICAgICAgICAgY3VycmVudExhbmd1YWdlICE9IFwiY29kZVwiKSB7XG4gICAgICAgICAgICAvL2Fsd2F5cyBjYXBpdGFsaXNlIHRoZSBmaXJzdCB3b3JkIG9yIGlmIHRoZXJlIHdhcyBhIGRvdCB1bmxlc3MgdXNpbmcgYSBjb2RlIGFscGhhYmV0XG4gICAgICAgICAgICB3b3JkID0gTWlzYy5jYXBpdGFsaXplRmlyc3RMZXR0ZXJPZkVhY2hXb3JkKHdvcmQpO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcInNwYW5pc2hcIiB8fCBjdXJyZW50TGFuZ3VhZ2UgPT0gXCJjYXRhbGFuXCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByYW5kID0gTWF0aC5yYW5kb20oKTtcbiAgICAgICAgICAgICAgICBpZiAocmFuZCA+IDAuOSkge1xuICAgICAgICAgICAgICAgICAgICB3b3JkID0gXCLCv1wiICsgd29yZDtcbiAgICAgICAgICAgICAgICAgICAgc3BhbmlzaFNlbnRlbmNlVHJhY2tlciA9IFwiP1wiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyYW5kID4gMC44KSB7XG4gICAgICAgICAgICAgICAgICAgIHdvcmQgPSBcIsKhXCIgKyB3b3JkO1xuICAgICAgICAgICAgICAgICAgICBzcGFuaXNoU2VudGVuY2VUcmFja2VyID0gXCIhXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKChNYXRoLnJhbmRvbSgpIDwgMC4xICYmXG4gICAgICAgICAgICBsYXN0Q2hhciAhPSBcIi5cIiAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCIsXCIgJiZcbiAgICAgICAgICAgIGluZGV4ICE9IG1heGluZGV4IC0gMikgfHxcbiAgICAgICAgICAgIGluZGV4ID09IG1heGluZGV4IC0gMSkge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcInNwYW5pc2hcIiB8fCBjdXJyZW50TGFuZ3VhZ2UgPT0gXCJjYXRhbGFuXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3BhbmlzaFNlbnRlbmNlVHJhY2tlciA9PSBcIj9cIiB8fCBzcGFuaXNoU2VudGVuY2VUcmFja2VyID09IFwiIVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHdvcmQgKz0gc3BhbmlzaFNlbnRlbmNlVHJhY2tlcjtcbiAgICAgICAgICAgICAgICAgICAgc3BhbmlzaFNlbnRlbmNlVHJhY2tlciA9IFwiXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmFuZCA9IE1hdGgucmFuZG9tKCk7XG4gICAgICAgICAgICAgICAgaWYgKHJhbmQgPD0gMC44KSB7XG4gICAgICAgICAgICAgICAgICAgIHdvcmQgKz0gXCIuXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJhbmQgPiAwLjggJiYgcmFuZCA8IDAuOSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudExhbmd1YWdlID09IFwiZnJlbmNoXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmQgPSBcIj9cIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50TGFuZ3VhZ2UgPT0gXCJhcmFiaWNcIiB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExhbmd1YWdlID09IFwicGVyc2lhblwiIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGFuZ3VhZ2UgPT0gXCJ1cmR1XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmQgKz0gXCLYn1wiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcImdyZWVrXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmQgKz0gXCI7XCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JkICs9IFwiP1wiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudExhbmd1YWdlID09IFwiZnJlbmNoXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmQgPSBcIiFcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmQgKz0gXCIhXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoTWF0aC5yYW5kb20oKSA8IDAuMDEgJiZcbiAgICAgICAgICAgIGxhc3RDaGFyICE9IFwiLFwiICYmXG4gICAgICAgICAgICBsYXN0Q2hhciAhPSBcIi5cIiAmJlxuICAgICAgICAgICAgY3VycmVudExhbmd1YWdlICE9PSBcInJ1c3NpYW5cIikge1xuICAgICAgICAgICAgd29yZCA9IGBcIiR7d29yZH1cImA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoTWF0aC5yYW5kb20oKSA8IDAuMDExICYmXG4gICAgICAgICAgICBsYXN0Q2hhciAhPSBcIixcIiAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCIuXCIgJiZcbiAgICAgICAgICAgIGN1cnJlbnRMYW5ndWFnZSAhPT0gXCJydXNzaWFuXCIgJiZcbiAgICAgICAgICAgIGN1cnJlbnRMYW5ndWFnZSAhPT0gXCJ1a3JhaW5pYW5cIikge1xuICAgICAgICAgICAgd29yZCA9IGAnJHt3b3JkfSdgO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjAxMiAmJiBsYXN0Q2hhciAhPSBcIixcIiAmJiBsYXN0Q2hhciAhPSBcIi5cIikge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcImNvZGVcIikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBNYXRoLnJhbmRvbSgpO1xuICAgICAgICAgICAgICAgIGlmIChyIDwgMC4yNSkge1xuICAgICAgICAgICAgICAgICAgICB3b3JkID0gYCgke3dvcmR9KWA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHIgPCAwLjUpIHtcbiAgICAgICAgICAgICAgICAgICAgd29yZCA9IGB7JHt3b3JkfX1gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyIDwgMC43NSkge1xuICAgICAgICAgICAgICAgICAgICB3b3JkID0gYFske3dvcmR9XWA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB3b3JkID0gYDwke3dvcmR9PmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgd29yZCA9IGAoJHt3b3JkfSlgO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjAxMyAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCIsXCIgJiZcbiAgICAgICAgICAgIGxhc3RDaGFyICE9IFwiLlwiICYmXG4gICAgICAgICAgICBsYXN0Q2hhciAhPSBcIjtcIiAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCLYm1wiICYmXG4gICAgICAgICAgICBsYXN0Q2hhciAhPSBcIjpcIikge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcImZyZW5jaFwiKSB7XG4gICAgICAgICAgICAgICAgd29yZCA9IFwiOlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudExhbmd1YWdlID09IFwiZ3JlZWtcIikge1xuICAgICAgICAgICAgICAgIHdvcmQgPSBcIsK3XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB3b3JkICs9IFwiOlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjAxNCAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCIsXCIgJiZcbiAgICAgICAgICAgIGxhc3RDaGFyICE9IFwiLlwiICYmXG4gICAgICAgICAgICBwcmV2aW91c1dvcmQgIT0gXCItXCIpIHtcbiAgICAgICAgICAgIHdvcmQgPSBcIi1cIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChNYXRoLnJhbmRvbSgpIDwgMC4wMTUgJiZcbiAgICAgICAgICAgIGxhc3RDaGFyICE9IFwiLFwiICYmXG4gICAgICAgICAgICBsYXN0Q2hhciAhPSBcIi5cIiAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCI7XCIgJiZcbiAgICAgICAgICAgIGxhc3RDaGFyICE9IFwi2JtcIiAmJlxuICAgICAgICAgICAgbGFzdENoYXIgIT0gXCI6XCIpIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50TGFuZ3VhZ2UgPT0gXCJmcmVuY2hcIikge1xuICAgICAgICAgICAgICAgIHdvcmQgPSBcIjtcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcImdyZWVrXCIpIHtcbiAgICAgICAgICAgICAgICB3b3JkID0gXCLCt1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudExhbmd1YWdlID09IFwiYXJhYmljXCIpIHtcbiAgICAgICAgICAgICAgICB3b3JkICs9IFwi2JtcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHdvcmQgKz0gXCI7XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoTWF0aC5yYW5kb20oKSA8IDAuMiAmJiBsYXN0Q2hhciAhPSBcIixcIikge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSBcImFyYWJpY1wiIHx8XG4gICAgICAgICAgICAgICAgY3VycmVudExhbmd1YWdlID09IFwidXJkdVwiIHx8XG4gICAgICAgICAgICAgICAgY3VycmVudExhbmd1YWdlID09IFwicGVyc2lhblwiKSB7XG4gICAgICAgICAgICAgICAgd29yZCArPSBcItiMXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB3b3JkICs9IFwiLFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjI1ICYmIGN1cnJlbnRMYW5ndWFnZSA9PSBcImNvZGVcIikge1xuICAgICAgICAgICAgY29uc3Qgc3BlY2lhbHMgPSBbXCJ7XCIsIFwifVwiLCBcIltcIiwgXCJdXCIsIFwiKFwiLCBcIilcIiwgXCI7XCIsIFwiPVwiLCBcIitcIiwgXCIlXCIsIFwiL1wiXTtcbiAgICAgICAgICAgIHdvcmQgPSBNaXNjLnJhbmRvbUVsZW1lbnRGcm9tQXJyYXkoc3BlY2lhbHMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB3b3JkO1xufVxuZXhwb3J0cy5wdW5jdHVhdGVXb3JkID0gcHVuY3R1YXRlV29yZDtcbmZ1bmN0aW9uIHN0YXJ0VGVzdCgpIHtcbiAgICBpZiAoUGFnZVRyYW5zaXRpb24uZ2V0KCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoIVVwZGF0ZUNvbmZpZy5kYkNvbmZpZ0xvYWRlZCkge1xuICAgICAgICBVcGRhdGVDb25maWcuc2V0Q2hhbmdlZEJlZm9yZURiKHRydWUpO1xuICAgIH1cbiAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyICE9PSBudWxsKSB7XG4gICAgICAgIEFuYWx5dGljc0NvbnRyb2xsZXIubG9nKFwidGVzdFN0YXJ0ZWRcIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBBbmFseXRpY3NDb250cm9sbGVyLmxvZyhcInRlc3RTdGFydGVkTm9Mb2dpblwiKTtcbiAgICB9XG4gICAgVGVzdEFjdGl2ZS5zZXQodHJ1ZSk7XG4gICAgUmVwbGF5LnN0YXJ0UmVwbGF5UmVjb3JkaW5nKCk7XG4gICAgUmVwbGF5LnJlcGxheUdldFdvcmRzTGlzdChUZXN0V29yZHMud29yZHMubGlzdCk7XG4gICAgVGVzdElucHV0LnJlc2V0S2V5cHJlc3NUaW1pbmdzKCk7XG4gICAgVGltZXJQcm9ncmVzcy5yZXN0YXJ0KCk7XG4gICAgVGltZXJQcm9ncmVzcy5zaG93KCk7XG4gICAgJChcIiNsaXZlV3BtXCIpLnRleHQoXCIwXCIpO1xuICAgIExpdmVXcG0uc2hvdygpO1xuICAgIExpdmVBY2Muc2hvdygpO1xuICAgIExpdmVCdXJzdC5zaG93KCk7XG4gICAgVGltZXJQcm9ncmVzcy51cGRhdGUoKTtcbiAgICBUZXN0VGltZXIuY2xlYXIoKTtcbiAgICBNb25rZXkuc2hvdygpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJtZW1vcnlcIikge1xuICAgICAgICBGdW5ib3gucmVzZXRNZW1vcnlUaW1lcigpO1xuICAgICAgICAkKFwiI3dvcmRzV3JhcHBlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQucGFjZUNhcmV0ICE9PSBcIm9mZlwiIHx8XG4gICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5yZXBlYXRlZFBhY2UgJiYgVGVzdFN0YXRlLmlzUGFjZVJlcGVhdCkpIHtcbiAgICAgICAgICAgIFBhY2VDYXJldC5zdGFydCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlKSB7IH1cbiAgICAvL3VzZSBhIHJlY3Vyc2l2ZSBzZWxmLWFkanVzdGluZyB0aW1lciB0byBhdm9pZCB0aW1lIGRyaWZ0XG4gICAgVGVzdFN0YXRzLnNldFN0YXJ0KHBlcmZvcm1hbmNlLm5vdygpKTtcbiAgICBUZXN0VGltZXIuc3RhcnQoKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydHMuc3RhcnRUZXN0ID0gc3RhcnRUZXN0O1xuZnVuY3Rpb24gcmVzdGFydCh3aXRoU2FtZVdvcmRzZXQgPSBmYWxzZSwgXywgLy8gdGhpcyBpcyBub3NhdmUgYW5kIHNob3VsZCBiZSByZW5hbWVkIHRvIG5vc2F2ZSB3aGVuIG5lZWRlZFxuZXZlbnQsIHByYWN0aXNlTWlzc2VkID0gZmFsc2UsIG5vQW5pbSA9IGZhbHNlKSB7XG4gICAgaWYgKFRlc3RVSS50ZXN0UmVzdGFydGluZyB8fCBUZXN0VUkucmVzdWx0Q2FsY3VsYXRpbmcpIHtcbiAgICAgICAgZXZlbnQgPT09IG51bGwgfHwgZXZlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT0gXCJ0ZXN0XCIgJiYgIVRlc3RVSS5yZXN1bHRWaXNpYmxlKSB7XG4gICAgICAgIGlmICghTWFudWFsUmVzdGFydC5nZXQoKSkge1xuICAgICAgICAgICAgaWYgKFRlc3RXb3Jkcy5oYXNUYWIpIHtcbiAgICAgICAgICAgICAgICBpZiAoIShldmVudCA9PT0gbnVsbCB8fCBldmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXZlbnQuc2hpZnRLZXkpKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9PSBcInplblwiKVxuICAgICAgICAgICAgICAgIGV2ZW50ID09PSBudWxsIHx8IGV2ZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgaWYgKCFNaXNjLmNhblF1aWNrUmVzdGFydChjb25maWdfMS5kZWZhdWx0Lm1vZGUsIGNvbmZpZ18xLmRlZmF1bHQud29yZHMsIGNvbmZpZ18xLmRlZmF1bHQudGltZSwgQ3VzdG9tVGV4dCkpIHtcbiAgICAgICAgICAgICAgICBsZXQgbWVzc2FnZSA9IFwiVXNlIHlvdXIgbW91c2UgdG8gY29uZmlybS5cIjtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5xdWlja1RhYikge1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gXCJQcmVzcyBzaGlmdCArIHRhYiBvciB1c2UgeW91ciBtb3VzZSB0byBjb25maXJtLlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlF1aWNrIHJlc3RhcnQgZGlzYWJsZWQuIFwiICsgbWVzc2FnZSwgMCwgMyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gfWVsc2V7XG4gICAgICAgICAgICAvLyAgIHJldHVybjtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoVGVzdEFjdGl2ZS5nZXQoKSkge1xuICAgICAgICBUZXN0SW5wdXQucHVzaEtleXByZXNzZXNUb0hpc3RvcnkoKTtcbiAgICAgICAgY29uc3QgdGVzdFNlY29uZHMgPSBUZXN0U3RhdHMuY2FsY3VsYXRlVGVzdFNlY29uZHMocGVyZm9ybWFuY2Uubm93KCkpO1xuICAgICAgICBjb25zdCBhZmtzZWNvbmRzID0gVGVzdFN0YXRzLmNhbGN1bGF0ZUFma1NlY29uZHModGVzdFNlY29uZHMpO1xuICAgICAgICAvLyBpbmNvbXBsZXRlVGVzdFNlY29uZHMgKz0gO1xuICAgICAgICBsZXQgdHQgPSB0ZXN0U2Vjb25kcyAtIGFma3NlY29uZHM7XG4gICAgICAgIGlmICh0dCA8IDApXG4gICAgICAgICAgICB0dCA9IDA7XG4gICAgICAgIGNvbnNvbGUubG9nKGBpbmNyZWFzaW5nIGluY29tcGxldGUgdGltZSBieSAke3R0fXMgKCR7dGVzdFNlY29uZHN9cyAtICR7YWZrc2Vjb25kc31zIGFmaylgKTtcbiAgICAgICAgVGVzdFN0YXRzLmluY3JlbWVudEluY29tcGxldGVTZWNvbmRzKHR0KTtcbiAgICAgICAgVGVzdFN0YXRzLmluY3JlbWVudFJlc3RhcnRDb3VudCgpO1xuICAgICAgICBpZiAodHQgPiA2MDApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGBZb3VyIHRpbWUgdHlwaW5nIGp1c3QgaW5jcmVhc2VkIGJ5ICR7TWlzYy5yb3VuZFRvMih0dCAvIDYwKX0gbWludXRlcy4gSWYgeW91IHRoaW5rIHRoaXMgaXMgaW5jb3JyZWN0IHBsZWFzZSBjb250YWN0IE1pb2RlYyBhbmQgZG9udCByZWZyZXNoIHRoZSB3ZWJzaXRlLmAsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICAvLyByZXN0YXJ0Q291bnQrKztcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiKSB7XG4gICAgICAgICQoXCIjd29yZHNcIikuZW1wdHkoKTtcbiAgICB9XG4gICAgaWYgKFByYWN0aXNlV29yZHMuYmVmb3JlLm1vZGUgIT09IG51bGwgJiZcbiAgICAgICAgIXdpdGhTYW1lV29yZHNldCAmJlxuICAgICAgICAhcHJhY3Rpc2VNaXNzZWQpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJSZXZlcnRpbmcgdG8gcHJldmlvdXMgc2V0dGluZ3MuXCIsIDApO1xuICAgICAgICBpZiAoUHJhY3Rpc2VXb3Jkcy5iZWZvcmUucHVuY3R1YXRpb24gIT09IG51bGwpIHtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRQdW5jdHVhdGlvbihQcmFjdGlzZVdvcmRzLmJlZm9yZS5wdW5jdHVhdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFByYWN0aXNlV29yZHMuYmVmb3JlLm51bWJlcnMgIT09IG51bGwpIHtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXROdW1iZXJzKFByYWN0aXNlV29yZHMuYmVmb3JlLm51bWJlcnMpO1xuICAgICAgICB9XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRNb2RlKFByYWN0aXNlV29yZHMuYmVmb3JlLm1vZGUpO1xuICAgICAgICBQcmFjdGlzZVdvcmRzLnJlc2V0QmVmb3JlKCk7XG4gICAgfVxuICAgIGxldCByZXBlYXRXaXRoUGFjZSA9IGZhbHNlO1xuICAgIGlmIChUZXN0VUkucmVzdWx0VmlzaWJsZSAmJiBjb25maWdfMS5kZWZhdWx0LnJlcGVhdGVkUGFjZSAmJiB3aXRoU2FtZVdvcmRzZXQpIHtcbiAgICAgICAgcmVwZWF0V2l0aFBhY2UgPSB0cnVlO1xuICAgIH1cbiAgICBNYW51YWxSZXN0YXJ0LnJlc2V0KCk7XG4gICAgVGVzdFRpbWVyLmNsZWFyKCk7XG4gICAgVGVzdFN0YXRzLnJlc3RhcnQoKTtcbiAgICBUZXN0SW5wdXQucmVzdGFydCgpO1xuICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQucmVzZXQoKTtcbiAgICBTaGlmdFRyYWNrZXIucmVzZXQoKTtcbiAgICBDYXJldC5oaWRlKCk7XG4gICAgVGVzdEFjdGl2ZS5zZXQoZmFsc2UpO1xuICAgIFJlcGxheS5zdG9wUmVwbGF5UmVjb3JkaW5nKCk7XG4gICAgTGl2ZVdwbS5oaWRlKCk7XG4gICAgTGl2ZUFjYy5oaWRlKCk7XG4gICAgTGl2ZUJ1cnN0LmhpZGUoKTtcbiAgICBUaW1lclByb2dyZXNzLmhpZGUoKTtcbiAgICBSZXBsYXkucGF1c2VSZXBsYXkoKTtcbiAgICBUZXN0SW5wdXQuc2V0QmFpbG91dChmYWxzZSk7XG4gICAgUGFjZUNhcmV0LnJlc2V0KCk7XG4gICAgTW9ua2V5LmhpZGUoKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zaG93QXZlcmFnZSlcbiAgICAgICAgTGFzdDEwQXZlcmFnZS51cGRhdGUoKTtcbiAgICAkKFwiI3Nob3dXb3JkSGlzdG9yeUJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImxvYWRlZFwiKTtcbiAgICAkKFwiI3Jlc3RhcnRUZXN0QnV0dG9uXCIpLmJsdXIoKTtcbiAgICBGdW5ib3gucmVzZXRNZW1vcnlUaW1lcigpO1xuICAgIFF1b3RlUmF0ZVBvcHVwLmNsZWFyUXVvdGVTdGF0cygpO1xuICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09IFwidGVzdFwiICYmIHdpbmRvdy5zY3JvbGxZID4gMCkge1xuICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oeyB0b3A6IDAsIGJlaGF2aW9yOiBcInNtb290aFwiIH0pO1xuICAgIH1cbiAgICAkKFwiI3dvcmRzSW5wdXRcIikudmFsKFwiIFwiKTtcbiAgICBUZXN0VUkucmVzZXQoKTtcbiAgICAkKFwiI3RpbWVyTnVtYmVyXCIpLmNzcyhcIm9wYWNpdHlcIiwgMCk7XG4gICAgbGV0IGVsID0gbnVsbDtcbiAgICBpZiAoVGVzdFVJLnJlc3VsdFZpc2libGUpIHtcbiAgICAgICAgLy9yZXN1bHRzIGFyZSBiZWluZyBkaXNwbGF5ZWRcbiAgICAgICAgZWwgPSAkKFwiI3Jlc3VsdFwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vd29yZHMgYXJlIGJlaW5nIGRpc3BsYXllZFxuICAgICAgICBlbCA9ICQoXCIjdHlwaW5nVGVzdFwiKTtcbiAgICB9XG4gICAgaWYgKFRlc3RVSS5yZXN1bHRWaXNpYmxlKSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnJhbmRvbVRoZW1lICE9PSBcIm9mZlwiICYmXG4gICAgICAgICAgICAhUGFnZVRyYW5zaXRpb24uZ2V0KClcbiAgICAgICAgLy8gJiYgQ29uZmlnLmN1c3RvbVRoZW1lSWQgPT09IFwiXCJcbiAgICAgICAgKSB7XG4gICAgICAgICAgICBUaGVtZUNvbnRyb2xsZXIucmFuZG9taXplVGhlbWUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBUZXN0VUkuc2V0UmVzdWx0VmlzaWJsZShmYWxzZSk7XG4gICAgUGFnZVRyYW5zaXRpb24uc2V0KHRydWUpO1xuICAgIFRlc3RVSS5zZXRUZXN0UmVzdGFydGluZyh0cnVlKTtcbiAgICBlbC5zdG9wKHRydWUsIHRydWUpLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiAwLFxuICAgIH0sIG5vQW5pbSA/IDAgOiAxMjUsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT0gXCJ0ZXN0XCIpXG4gICAgICAgICAgICBGb2N1cy5zZXQoZmFsc2UpO1xuICAgICAgICBUZXN0VUkuZm9jdXNXb3JkcygpO1xuICAgICAgICAkKFwiI21vbmtleSAuZmFzdFwiKS5zdG9wKHRydWUsIHRydWUpLmNzcyhcIm9wYWNpdHlcIiwgMCk7XG4gICAgICAgICQoXCIjbW9ua2V5XCIpLnN0b3AodHJ1ZSwgdHJ1ZSkuY3NzKHsgYW5pbWF0aW9uRHVyYXRpb246IFwiMHNcIiB9KTtcbiAgICAgICAgJChcIiN0eXBpbmdUZXN0XCIpLmNzcyhcIm9wYWNpdHlcIiwgMCkucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjd29yZHNJbnB1dFwiKS52YWwoXCIgXCIpO1xuICAgICAgICBsZXQgc2hvdWxkUXVvdGVSZXBlYXQgPSBmYWxzZTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiICYmXG4gICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0LnJlcGVhdFF1b3RlcyA9PT0gXCJ0eXBpbmdcIiAmJlxuICAgICAgICAgICAgZmFpbFJlYXNvbiAhPT0gXCJcIikge1xuICAgICAgICAgICAgc2hvdWxkUXVvdGVSZXBlYXQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHlpZWxkIEZ1bmJveC5yZW1lbWJlclNldHRpbmdzKCk7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFB1bmN0dWF0aW9uKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXROdW1iZXJzKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCI1ODAwOFwiKSB7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TnVtYmVycyhmYWxzZSwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwic3BlY2lhbHNcIikge1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldFB1bmN0dWF0aW9uKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXROdW1iZXJzKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhc2NpaVwiKSB7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0UHVuY3R1YXRpb24oZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldE51bWJlcnMoZmFsc2UsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh3aXRoU2FtZVdvcmRzZXQgJiZcbiAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJwbHVzX29uZVwiIHx8IGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcInBsdXNfdHdvXCIpKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlNvcnJ5LCB0aGlzIGZ1bmJveCB3b24ndCB3b3JrIHdpdGggcmVwZWF0ZWQgdGVzdHMuXCIsIDAsIDQpO1xuICAgICAgICAgICAgd2l0aFNhbWVXb3Jkc2V0ID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF3aXRoU2FtZVdvcmRzZXQgJiYgIXNob3VsZFF1b3RlUmVwZWF0KSB7XG4gICAgICAgICAgICBUZXN0U3RhdGUuc2V0UmVwZWF0ZWQoZmFsc2UpO1xuICAgICAgICAgICAgVGVzdFN0YXRlLnNldFBhY2VSZXBlYXQocmVwZWF0V2l0aFBhY2UpO1xuICAgICAgICAgICAgVGVzdFdvcmRzLnNldEhhc1RhYihmYWxzZSk7XG4gICAgICAgICAgICB5aWVsZCBpbml0KCk7XG4gICAgICAgICAgICB5aWVsZCBQYWNlQ2FyZXQuaW5pdCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgVGVzdFN0YXRlLnNldFJlcGVhdGVkKHRydWUpO1xuICAgICAgICAgICAgVGVzdFN0YXRlLnNldFBhY2VSZXBlYXQocmVwZWF0V2l0aFBhY2UpO1xuICAgICAgICAgICAgVGVzdEFjdGl2ZS5zZXQoZmFsc2UpO1xuICAgICAgICAgICAgUmVwbGF5LnN0b3BSZXBsYXlSZWNvcmRpbmcoKTtcbiAgICAgICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5yZXNldEN1cnJlbnRJbmRleCgpO1xuICAgICAgICAgICAgVGVzdElucHV0LmlucHV0LnJlc2V0KCk7XG4gICAgICAgICAgICBUZXN0VUkuc2hvd1dvcmRzKCk7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBNb2RlID09PSBcIm5leHRcIiAmJiBjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT09IFwiemVuXCIpIHtcbiAgICAgICAgICAgICAgICBLZXltYXAuaGlnaGxpZ2h0S2V5KFRlc3RXb3Jkcy53b3Jkc1xuICAgICAgICAgICAgICAgICAgICAuZ2V0Q3VycmVudCgpXG4gICAgICAgICAgICAgICAgICAgIC5zdWJzdHJpbmcoVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoLCBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGggKyAxKVxuICAgICAgICAgICAgICAgICAgICAudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgICAgICAudG9VcHBlckNhc2UoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBGdW5ib3gudG9nZ2xlU2NyaXB0KFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KCkpO1xuICAgICAgICAgICAgeWllbGQgUGFjZUNhcmV0LmluaXQoKTtcbiAgICAgICAgfVxuICAgICAgICBmYWlsUmVhc29uID0gXCJcIjtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgICAgICBUZXN0U3RhdGUuc2V0UmVwZWF0ZWQoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmtleW1hcE1vZGUgIT09IFwib2ZmXCIpIHtcbiAgICAgICAgICAgIEtleW1hcC5zaG93KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBLZXltYXAuaGlkZSgpO1xuICAgICAgICB9XG4gICAgICAgIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLndwbVwiKSkuaW5uZXJIVE1MID0gXCIwXCI7XG4gICAgICAgIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLmFjY1wiKSkuaW5uZXJIVE1MID0gXCIxMDAlXCI7XG4gICAgICAgIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLmJ1cnN0XCIpKS5pbm5lckhUTUwgPSBcIjBcIjtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNsaXZlV3BtXCIpLmlubmVySFRNTCA9IFwiMFwiO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xpdmVBY2NcIikuaW5uZXJIVE1MID0gXCIxMDAlXCI7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbGl2ZUJ1cnN0XCIpLmlubmVySFRNTCA9IFwiMFwiO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwibWVtb3J5XCIpIHtcbiAgICAgICAgICAgIEZ1bmJveC5zdGFydE1lbW9yeVRpbWVyKCk7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5rZXltYXBNb2RlID09PSBcIm5leHRcIikge1xuICAgICAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRLZXltYXBNb2RlKFwicmVhY3RcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbW9kZTIgPSBNaXNjLmdldE1vZGUyKGNvbmZpZ18xLmRlZmF1bHQsIFRlc3RXb3Jkcy5yYW5kb21RdW90ZSk7XG4gICAgICAgIGxldCBmYnRleHQgPSBcIlwiO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggIT09IFwibm9uZVwiKSB7XG4gICAgICAgICAgICBmYnRleHQgPSBcIiBcIiArIGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94O1xuICAgICAgICB9XG4gICAgICAgICQoXCIucGFnZVRlc3QgI3ByZW1pZFRlc3RNb2RlXCIpLnRleHQoYCR7Y29uZmlnXzEuZGVmYXVsdC5tb2RlfSAke21vZGUyfSAke2NvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UucmVwbGFjZSgvXy9nLCBcIiBcIil9JHtmYnRleHR9YCk7XG4gICAgICAgICQoXCIucGFnZVRlc3QgI3ByZW1pZFNlY29uZHNMZWZ0XCIpLnRleHQoY29uZmlnXzEuZGVmYXVsdC50aW1lKTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcImxheW91dGZsdWlkXCIpIHtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRMYXlvdXQoY29uZmlnXzEuZGVmYXVsdC5jdXN0b21MYXlvdXRmbHVpZFxuICAgICAgICAgICAgICAgID8gY29uZmlnXzEuZGVmYXVsdC5jdXN0b21MYXlvdXRmbHVpZC5zcGxpdChcIiNcIilbMF1cbiAgICAgICAgICAgICAgICA6IFwicXdlcnR5XCIsIHRydWUpO1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcExheW91dChjb25maWdfMS5kZWZhdWx0LmN1c3RvbUxheW91dGZsdWlkXG4gICAgICAgICAgICAgICAgPyBjb25maWdfMS5kZWZhdWx0LmN1c3RvbUxheW91dGZsdWlkLnNwbGl0KFwiI1wiKVswXVxuICAgICAgICAgICAgICAgIDogXCJxd2VydHlcIiwgdHJ1ZSk7XG4gICAgICAgICAgICBLZXltYXAuaGlnaGxpZ2h0S2V5KFRlc3RXb3Jkcy53b3Jkc1xuICAgICAgICAgICAgICAgIC5nZXRDdXJyZW50KClcbiAgICAgICAgICAgICAgICAuc3Vic3RyaW5nKFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCwgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoICsgMSlcbiAgICAgICAgICAgICAgICAudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgIC50b1VwcGVyQ2FzZSgpKTtcbiAgICAgICAgfVxuICAgICAgICAkKFwiI3Jlc3VsdFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiN0ZXN0TW9kZXNOb3RpY2VcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIikuY3NzKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgIH0pO1xuICAgICAgICAvLyByZXNldFBhY2VDYXJldCgpO1xuICAgICAgICBNb2Rlc05vdGljZS51cGRhdGUoKTtcbiAgICAgICAgJChcIiN0eXBpbmdUZXN0XCIpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgfSwgbm9BbmltID8gMCA6IDEyNSwgKCkgPT4ge1xuICAgICAgICAgICAgVGVzdFVJLnNldFRlc3RSZXN0YXJ0aW5nKGZhbHNlKTtcbiAgICAgICAgICAgIC8vIHJlc2V0UGFjZUNhcmV0KCk7XG4gICAgICAgICAgICBQYkNyb3duLmhpZGUoKTtcbiAgICAgICAgICAgIFRlc3RUaW1lci5jbGVhcigpO1xuICAgICAgICAgICAgaWYgKCQoXCIjY29tbWFuZExpbmVXcmFwcGVyXCIpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICAgICAgICAgVGVzdFVJLmZvY3VzV29yZHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIENoYXJ0Q29udHJvbGxlci5yZXN1bHQudXBkYXRlKCk7XG4gICAgICAgICAgICBQYWdlVHJhbnNpdGlvbi5zZXQoZmFsc2UpO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coVGVzdFN0YXRzLmluY29tcGxldGVTZWNvbmRzKTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFRlc3RTdGF0cy5yZXN0YXJ0Q291bnQpO1xuICAgICAgICB9KTtcbiAgICB9KSk7XG59XG5leHBvcnRzLnJlc3RhcnQgPSByZXN0YXJ0O1xuZnVuY3Rpb24gYXBwbHlGdW5ib3hlc1RvV29yZCh3b3JkLCB3b3Jkc2V0KSB7XG4gICAgdmFyIF9hO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJyQW5Eb01jQXNFXCIpIHtcbiAgICAgICAgbGV0IHJhbmRvbWNhc2V3b3JkID0gXCJcIjtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoaSAlIDIgIT0gMCkge1xuICAgICAgICAgICAgICAgIHJhbmRvbWNhc2V3b3JkICs9IHdvcmRbaV0udG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJhbmRvbWNhc2V3b3JkICs9IHdvcmRbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgd29yZCA9IHJhbmRvbWNhc2V3b3JkO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJjYXBpdGFsc1wiKSB7XG4gICAgICAgIHdvcmQgPSBNaXNjLmNhcGl0YWxpemVGaXJzdExldHRlck9mRWFjaFdvcmQod29yZCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcImdpYmJlcmlzaFwiKSB7XG4gICAgICAgIHdvcmQgPSBNaXNjLmdldEdpYmJlcmlzaCgpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICB3b3JkID0gTWlzYy5nZXRBcnJvd3MoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwiNTgwMDhcIikge1xuICAgICAgICB3b3JkID0gTWlzYy5nZXROdW1iZXJzKDcpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJzcGVjaWFsc1wiKSB7XG4gICAgICAgIHdvcmQgPSBNaXNjLmdldFNwZWNpYWxzKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcImFzY2lpXCIpIHtcbiAgICAgICAgd29yZCA9IE1pc2MuZ2V0QVNDSUkoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAod29yZHNldCAhPT0gdW5kZWZpbmVkICYmIGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcIndlYWtzcG90XCIpIHtcbiAgICAgICAgd29yZCA9IFdlYWtTcG90LmdldFdvcmQod29yZHNldCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHdvcmRzZXQgIT09IHVuZGVmaW5lZCAmJiBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJ0YmRtb2RlXCIpIHtcbiAgICAgICAgd29yZCA9ICgoX2EgPSAoMCwgdGJkX21vZGVfMS5nZXRUYmRNb2RlKSgpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZ2V0V29yZCh3b3Jkc2V0KSkgfHwgd29yZDtcbiAgICB9XG4gICAgcmV0dXJuIHdvcmQ7XG59XG5mdW5jdGlvbiBhcHBseUJyaXRpc2hFbmdsaXNoVG9Xb3JkKHdvcmQpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5icml0aXNoRW5nbGlzaCAmJiAvZW5nbGlzaC8udGVzdChjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKSkge1xuICAgICAgICAgICAgd29yZCA9IHlpZWxkIEJyaXRpc2hFbmdsaXNoLnJlcGxhY2Uod29yZCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHdvcmQ7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBhcHBseUxhenlNb2RlVG9Xb3JkKHdvcmQsIGxhbmd1YWdlKSB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubGF6eU1vZGUgPT09IHRydWUgJiYgIWxhbmd1YWdlLm5vTGF6eU1vZGUpIHtcbiAgICAgICAgd29yZCA9IExhenlNb2RlLnJlcGxhY2VBY2NlbnRzKHdvcmQsIGxhbmd1YWdlLmFjY2VudHMpO1xuICAgIH1cbiAgICByZXR1cm4gd29yZDtcbn1cbmZ1bmN0aW9uIGdldE5leHRXb3JkKHdvcmRzZXQsIGxhbmd1YWdlLCB3b3Jkc0JvdW5kKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBsZXQgcmFuZG9tV29yZCA9IHdvcmRzZXQucmFuZG9tV29yZCgpO1xuICAgICAgICBjb25zdCBwcmV2aW91c1dvcmQgPSBUZXN0V29yZHMud29yZHMuZ2V0KFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGggLSAxLCB0cnVlKTtcbiAgICAgICAgY29uc3QgcHJldmlvdXNXb3JkMiA9IFRlc3RXb3Jkcy53b3Jkcy5nZXQoVGVzdFdvcmRzLndvcmRzLmxlbmd0aCAtIDIsIHRydWUpO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInF1b3RlXCIpIHtcbiAgICAgICAgICAgIHJhbmRvbVdvcmQgPVxuICAgICAgICAgICAgICAgIChfYiA9IChfYSA9IFRlc3RXb3Jkcy5yYW5kb21RdW90ZS50ZXh0U3BsaXQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVtUZXN0V29yZHMud29yZHMubGVuZ3RoXSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogXCJcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgIUN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmXG4gICAgICAgICAgICAhQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20pIHtcbiAgICAgICAgICAgIHJhbmRvbVdvcmQgPSBDdXN0b21UZXh0LnRleHRbVGVzdFdvcmRzLndvcmRzLmxlbmd0aF07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgIChDdXN0b21UZXh0LmlzV29yZFJhbmRvbSB8fCBDdXN0b21UZXh0LmlzVGltZVJhbmRvbSkgJiZcbiAgICAgICAgICAgICh3b3Jkc2V0Lmxlbmd0aCA8IDQgfHwgUHJhY3Rpc2VXb3Jkcy5iZWZvcmUubW9kZSAhPT0gbnVsbCkpIHtcbiAgICAgICAgICAgIHJhbmRvbVdvcmQgPSB3b3Jkc2V0LnJhbmRvbVdvcmQoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGxldCByZWdlbmFyYXRpb25Db3VudCA9IDA7IC8vaW5maW5pdGUgbG9vcCBlbWVyZ2VuY3kgc3RvcCBidXR0b25cbiAgICAgICAgICAgIHdoaWxlIChyZWdlbmFyYXRpb25Db3VudCA8IDEwMCAmJlxuICAgICAgICAgICAgICAgIChwcmV2aW91c1dvcmQgPT0gcmFuZG9tV29yZCB8fFxuICAgICAgICAgICAgICAgICAgICBwcmV2aW91c1dvcmQyID09IHJhbmRvbVdvcmQgfHxcbiAgICAgICAgICAgICAgICAgICAgKCFjb25maWdfMS5kZWZhdWx0LnB1bmN0dWF0aW9uICYmIHJhbmRvbVdvcmQgPT0gXCJJXCIpKSkge1xuICAgICAgICAgICAgICAgIHJlZ2VuYXJhdGlvbkNvdW50Kys7XG4gICAgICAgICAgICAgICAgcmFuZG9tV29yZCA9IHdvcmRzZXQucmFuZG9tV29yZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChyYW5kb21Xb3JkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJhbmRvbVdvcmQgPSB3b3Jkc2V0LnJhbmRvbVdvcmQoKTtcbiAgICAgICAgfVxuICAgICAgICByYW5kb21Xb3JkID0gcmFuZG9tV29yZC5yZXBsYWNlKC8gKy9nbSwgXCIgXCIpO1xuICAgICAgICByYW5kb21Xb3JkID0gcmFuZG9tV29yZC5yZXBsYWNlKC9eIHwgJC9nbSwgXCJcIik7XG4gICAgICAgIHJhbmRvbVdvcmQgPSBhcHBseUxhenlNb2RlVG9Xb3JkKHJhbmRvbVdvcmQsIGxhbmd1YWdlKTtcbiAgICAgICAgcmFuZG9tV29yZCA9IHlpZWxkIGFwcGx5QnJpdGlzaEVuZ2xpc2hUb1dvcmQocmFuZG9tV29yZCk7XG4gICAgICAgIHJhbmRvbVdvcmQgPSBhcHBseUZ1bmJveGVzVG9Xb3JkKHJhbmRvbVdvcmQsIHdvcmRzZXQpO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbikge1xuICAgICAgICAgICAgcmFuZG9tV29yZCA9IHB1bmN0dWF0ZVdvcmQoVGVzdFdvcmRzLndvcmRzLmdldChUZXN0V29yZHMud29yZHMubGVuZ3RoIC0gMSksIHJhbmRvbVdvcmQsIFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGgsIHdvcmRzQm91bmQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm51bWJlcnMpIHtcbiAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC4xKSB7XG4gICAgICAgICAgICAgICAgcmFuZG9tV29yZCA9IE1pc2MuZ2V0TnVtYmVycyg0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmFuZG9tV29yZDtcbiAgICB9KTtcbn1cbmxldCByZW1lbWJlckxhenlNb2RlO1xuZnVuY3Rpb24gaW5pdCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBUZXN0QWN0aXZlLnNldChmYWxzZSk7XG4gICAgICAgIE1vbmtleVBvd2VyLnJlc2V0KCk7XG4gICAgICAgIFJlcGxheS5zdG9wUmVwbGF5UmVjb3JkaW5nKCk7XG4gICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5yZXNldCgpO1xuICAgICAgICBUZXN0VUkuc2V0Q3VycmVudFdvcmRFbGVtZW50SW5kZXgoMCk7XG4gICAgICAgIC8vIGFjY3VyYWN5ID0ge1xuICAgICAgICAvLyAgIGNvcnJlY3Q6IDAsXG4gICAgICAgIC8vICAgaW5jb3JyZWN0OiAwLFxuICAgICAgICAvLyB9O1xuICAgICAgICBUZXN0SW5wdXQuaW5wdXQucmVzZXRIaXN0b3J5KCk7XG4gICAgICAgIFRlc3RJbnB1dC5pbnB1dC5yZXNldEN1cnJlbnQoKTtcbiAgICAgICAgaWYgKEFjdGl2ZVBhZ2UuZ2V0KCkgPT0gXCJ0ZXN0XCIpIHtcbiAgICAgICAgICAgIHlpZWxkIEZ1bmJveC5hY3RpdmF0ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBsYW5ndWFnZSA9IHlpZWxkIE1pc2MuZ2V0TGFuZ3VhZ2UoY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSk7XG4gICAgICAgIGlmIChsYW5ndWFnZSAmJiBsYW5ndWFnZS5uYW1lICE9PSBjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKSB7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TGFuZ3VhZ2UoXCJlbmdsaXNoXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghbGFuZ3VhZ2UpIHtcbiAgICAgICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRMYW5ndWFnZShcImVuZ2xpc2hcIik7XG4gICAgICAgICAgICBsYW5ndWFnZSA9IHlpZWxkIE1pc2MuZ2V0TGFuZ3VhZ2UoY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubGF6eU1vZGUgPT09IHRydWUgJiYgbGFuZ3VhZ2Uubm9MYXp5TW9kZSkge1xuICAgICAgICAgICAgcmVtZW1iZXJMYXp5TW9kZSA9IHRydWU7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlRoaXMgbGFuZ3VhZ2UgZG9lcyBub3Qgc3VwcG9ydCBsYXp5IG1vZGUuXCIsIDApO1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldExhenlNb2RlKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZW1lbWJlckxhenlNb2RlID09PSB0cnVlICYmICFsYW5ndWFnZS5ub0xhenlNb2RlKSB7XG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TGF6eU1vZGUodHJ1ZSwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubGF6eU1vZGUgPT09IGZhbHNlICYmICFsYW5ndWFnZS5ub0xhenlNb2RlKSB7XG4gICAgICAgICAgICByZW1lbWJlckxhenlNb2RlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHdvcmRzQm91bmQgPSAxMDA7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnNob3dBbGxMaW5lcykge1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgICAgICAgICAgd29yZHNCb3VuZCA9IDEwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICAgICAgICAgIGlmIChDdXN0b21UZXh0LmlzV29yZFJhbmRvbSkge1xuICAgICAgICAgICAgICAgICAgICB3b3Jkc0JvdW5kID0gQ3VzdG9tVGV4dC53b3JkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChDdXN0b21UZXh0LmlzVGltZVJhbmRvbSkge1xuICAgICAgICAgICAgICAgICAgICB3b3Jkc0JvdW5kID0gMTAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgd29yZHNCb3VuZCA9IEN1c3RvbVRleHQudGV4dC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9IFwidGltZVwiKSB7XG4gICAgICAgICAgICAgICAgd29yZHNCb3VuZCA9IGNvbmZpZ18xLmRlZmF1bHQud29yZHM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIgJiYgY29uZmlnXzEuZGVmYXVsdC53b3JkcyA8IHdvcmRzQm91bmQpIHtcbiAgICAgICAgICAgICAgICB3b3Jkc0JvdW5kID0gY29uZmlnXzEuZGVmYXVsdC53b3JkcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmXG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC53b3JkIDwgd29yZHNCb3VuZCkge1xuICAgICAgICAgICAgICAgIHdvcmRzQm91bmQgPSBDdXN0b21UZXh0LndvcmQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiY3VzdG9tXCIgJiYgQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20pIHtcbiAgICAgICAgICAgICAgICB3b3Jkc0JvdW5kID0gMTAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICAgICAgIUN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmXG4gICAgICAgICAgICAgICAgIUN1c3RvbVRleHQuaXNUaW1lUmFuZG9tICYmXG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC50ZXh0Lmxlbmd0aCA8IHdvcmRzQm91bmQpIHtcbiAgICAgICAgICAgICAgICB3b3Jkc0JvdW5kID0gQ3VzdG9tVGV4dC50ZXh0Lmxlbmd0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gJiZcbiAgICAgICAgICAgIEN1c3RvbVRleHQud29yZCA9PSAwKSB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQuaXNUaW1lUmFuZG9tICYmXG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC50aW1lID09IDApKSB7XG4gICAgICAgICAgICB3b3Jkc0JvdW5kID0gMTAwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIiAmJiBjb25maWdfMS5kZWZhdWx0LndvcmRzID09PSAwKSB7XG4gICAgICAgICAgICB3b3Jkc0JvdW5kID0gMTAwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJwbHVzX29uZVwiKSB7XG4gICAgICAgICAgICB3b3Jkc0JvdW5kID0gMjtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIiAmJiBjb25maWdfMS5kZWZhdWx0LndvcmRzIDwgd29yZHNCb3VuZCkge1xuICAgICAgICAgICAgICAgIHdvcmRzQm91bmQgPSBjb25maWdfMS5kZWZhdWx0LndvcmRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJwbHVzX3R3b1wiKSB7XG4gICAgICAgICAgICB3b3Jkc0JvdW5kID0gMztcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIiAmJiBjb25maWdfMS5kZWZhdWx0LndvcmRzIDwgd29yZHNCb3VuZCkge1xuICAgICAgICAgICAgICAgIHdvcmRzQm91bmQgPSBjb25maWdfMS5kZWZhdWx0LndvcmRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ0aW1lXCIgfHxcbiAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcIndvcmRzXCIgfHxcbiAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcImN1c3RvbVwiKSB7XG4gICAgICAgICAgICBsZXQgd29yZExpc3QgPSBsYW5ndWFnZS53b3JkcztcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJjdXN0b21cIikge1xuICAgICAgICAgICAgICAgIHdvcmRMaXN0ID0gQ3VzdG9tVGV4dC50ZXh0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgd29yZHNldCA9IFdvcmRzZXQud2l0aFdvcmRzKHdvcmRMaXN0LCBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCk7XG4gICAgICAgICAgICBpZiAoKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09IFwid2lraXBlZGlhXCIgfHwgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT0gXCJwb2V0cnlcIikgJiZcbiAgICAgICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT0gXCJjdXN0b21cIikge1xuICAgICAgICAgICAgICAgIGxldCB3b3JkQ291bnQgPSAwO1xuICAgICAgICAgICAgICAgIC8vIElmIG1vZGUgaXMgd29yZHMsIGdldCBhcyBtYW55IHNlY3Rpb25zIGFzIHlvdSBuZWVkIHVudGlsIHRoZSB3b3JkQ291bnQgaXMgZnVsbGZpbGxlZFxuICAgICAgICAgICAgICAgIHdoaWxlICgoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwid29yZHNcIiAmJiBjb25maWdfMS5kZWZhdWx0LndvcmRzID49IHdvcmRDb3VudCkgfHxcbiAgICAgICAgICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ0aW1lXCIgJiYgd29yZENvdW50IDwgMTAwKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWN0aW9uID0gY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT0gXCJ3aWtpcGVkaWFcIlxuICAgICAgICAgICAgICAgICAgICAgICAgPyB5aWVsZCBXaWtpcGVkaWEuZ2V0U2VjdGlvbihjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKVxuICAgICAgICAgICAgICAgICAgICAgICAgOiB5aWVsZCBQb2V0cnkuZ2V0UG9lbSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VjdGlvbiA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgd29yZCBvZiBzZWN0aW9uLndvcmRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAod29yZENvdW50ID49IGNvbmZpZ18xLmRlZmF1bHQud29yZHMgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwid29yZHNcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgd29yZENvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICBUZXN0V29yZHMud29yZHMucHVzaCh3b3JkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd29yZHNCb3VuZDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhbmRvbVdvcmQgPSB5aWVsZCBnZXROZXh0V29yZCh3b3Jkc2V0LCBsYW5ndWFnZSwgd29yZHNCb3VuZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICgvXFx0L2cudGVzdChyYW5kb21Xb3JkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgVGVzdFdvcmRzLnNldEhhc1RhYih0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoLyArLy50ZXN0KHJhbmRvbVdvcmQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByYW5kb21MaXN0ID0gcmFuZG9tV29yZC5zcGxpdChcIiBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgaWQgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGlkIDwgcmFuZG9tTGlzdC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXN0V29yZHMud29yZHMucHVzaChyYW5kb21MaXN0W2lkXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoVGVzdFdvcmRzLndvcmRzLmxlbmd0aCA9PSB3b3Jkc0JvdW5kICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEN1c3RvbVRleHQuaXNXb3JkUmFuZG9tKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICFDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICFDdXN0b21UZXh0LmlzVGltZVJhbmRvbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpID0gVGVzdFdvcmRzLndvcmRzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBUZXN0V29yZHMud29yZHMucHVzaChyYW5kb21Xb3JkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwicXVvdGVcIikge1xuICAgICAgICAgICAgY29uc3QgcXVvdGVzQ29sbGVjdGlvbiA9IHlpZWxkIHF1b3Rlc19jb250cm9sbGVyXzEuZGVmYXVsdC5nZXRRdW90ZXMoY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSwgY29uZmlnXzEuZGVmYXVsdC5xdW90ZUxlbmd0aCk7XG4gICAgICAgICAgICBpZiAocXVvdGVzQ29sbGVjdGlvbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBUZXN0VUkuc2V0VGVzdFJlc3RhcnRpbmcoZmFsc2UpO1xuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKGBObyAke2NvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UucmVwbGFjZSgvX1xcZCprJC9nLCBcIlwiKX0gcXVvdGVzIGZvdW5kYCwgMCk7XG4gICAgICAgICAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcikge1xuICAgICAgICAgICAgICAgICAgICBRdW90ZVN1Ym1pdFBvcHVwLnNob3coZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0TW9kZShcIndvcmRzXCIpO1xuICAgICAgICAgICAgICAgIHJlc3RhcnQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgcnEgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5xdW90ZUxlbmd0aC5pbmNsdWRlcygtMikgJiYgY29uZmlnXzEuZGVmYXVsdC5xdW90ZUxlbmd0aC5sZW5ndGggPT0gMSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFF1b3RlID0gcXVvdGVzX2NvbnRyb2xsZXJfMS5kZWZhdWx0LmdldFF1b3RlQnlJZChRdW90ZVNlYXJjaFBvcHVwLnNlbGVjdGVkSWQpO1xuICAgICAgICAgICAgICAgIGlmICh0YXJnZXRRdW90ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJxID0gcXVvdGVzQ29sbGVjdGlvbi5ncm91cHNbMF1bMF07XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUXVvdGUgSWQgRG9lcyBOb3QgRXhpc3RcIiwgMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBycSA9IHRhcmdldFF1b3RlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJhbmRvbVF1b3RlID0gcXVvdGVzX2NvbnRyb2xsZXJfMS5kZWZhdWx0LmdldFJhbmRvbVF1b3RlKCk7XG4gICAgICAgICAgICAgICAgaWYgKHJhbmRvbVF1b3RlID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiTm8gcXVvdGVzIGZvdW5kIGZvciBzZWxlY3RlZCBxdW90ZSBsZW5ndGhcIiwgMCk7XG4gICAgICAgICAgICAgICAgICAgIFRlc3RVSS5zZXRUZXN0UmVzdGFydGluZyhmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcnEgPSByYW5kb21RdW90ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChycSA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIHJxLnRleHQgPSBycS50ZXh0LnJlcGxhY2UoLyArL2dtLCBcIiBcIik7XG4gICAgICAgICAgICBycS50ZXh0ID0gcnEudGV4dC5yZXBsYWNlKC9cXFxcXFxcXHQvZ20sIFwiXFx0XCIpO1xuICAgICAgICAgICAgcnEudGV4dCA9IHJxLnRleHQucmVwbGFjZSgvXFxcXFxcXFxuL2dtLCBcIlxcblwiKTtcbiAgICAgICAgICAgIHJxLnRleHQgPSBycS50ZXh0LnJlcGxhY2UoL1xcXFx0L2dtLCBcIlxcdFwiKTtcbiAgICAgICAgICAgIHJxLnRleHQgPSBycS50ZXh0LnJlcGxhY2UoL1xcXFxuL2dtLCBcIlxcblwiKTtcbiAgICAgICAgICAgIHJxLnRleHQgPSBycS50ZXh0LnJlcGxhY2UoLyggKihcXHJcXG58XFxyfFxcbikgKikvZywgXCJcXG4gXCIpO1xuICAgICAgICAgICAgcnEudGV4dCA9IHJxLnRleHQucmVwbGFjZSgv4oCmL2csIFwiLi4uXCIpO1xuICAgICAgICAgICAgcnEudGV4dCA9IHJxLnRleHQudHJpbSgpO1xuICAgICAgICAgICAgcnEudGV4dFNwbGl0ID0gcnEudGV4dC5zcGxpdChcIiBcIik7XG4gICAgICAgICAgICBycS5sYW5ndWFnZSA9IGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UucmVwbGFjZSgvX1xcZCprJC9nLCBcIlwiKTtcbiAgICAgICAgICAgIFRlc3RXb3Jkcy5zZXRSYW5kb21RdW90ZShycSk7XG4gICAgICAgICAgICBjb25zdCB3ID0gVGVzdFdvcmRzLnJhbmRvbVF1b3RlLnRleHRTcGxpdDtcbiAgICAgICAgICAgIGlmICh3ID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuc2hvd0FsbExpbmVzKSB7XG4gICAgICAgICAgICAgICAgd29yZHNCb3VuZCA9IHcubGVuZ3RoO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgd29yZHNCb3VuZCA9IE1hdGgubWluKHdvcmRzQm91bmQsIHcubGVuZ3RoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd29yZHNCb3VuZDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKC9cXHQvZy50ZXN0KHdbaV0pKSB7XG4gICAgICAgICAgICAgICAgICAgIFRlc3RXb3Jkcy5zZXRIYXNUYWIodHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHdbaV0gPSBhcHBseUxhenlNb2RlVG9Xb3JkKHdbaV0sIGxhbmd1YWdlKTtcbiAgICAgICAgICAgICAgICB3W2ldID0geWllbGQgYXBwbHlCcml0aXNoRW5nbGlzaFRvV29yZCh3W2ldKTtcbiAgICAgICAgICAgICAgICB3W2ldID0gYXBwbHlGdW5ib3hlc1RvV29yZCh3W2ldKTtcbiAgICAgICAgICAgICAgICBUZXN0V29yZHMud29yZHMucHVzaCh3W2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvL2hhbmRsZSByaWdodC10by1sZWZ0IGxhbmd1YWdlc1xuICAgICAgICBpZiAobGFuZ3VhZ2UubGVmdFRvUmlnaHQpIHtcbiAgICAgICAgICAgIFRlc3RVSS5hcnJhbmdlQ2hhcmFjdGVyc0xlZnRUb1JpZ2h0KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBUZXN0VUkuYXJyYW5nZUNoYXJhY3RlcnNSaWdodFRvTGVmdCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsYW5ndWFnZS5saWdhdHVyZXMpIHtcbiAgICAgICAgICAgICQoXCIjd29yZHNcIikuYWRkQ2xhc3MoXCJ3aXRoTGlnYXR1cmVzXCIpO1xuICAgICAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLndvcmRzXCIpLmFkZENsYXNzKFwid2l0aExpZ2F0dXJlc1wiKTtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0UmVwbGF5IC53b3Jkc1wiKS5hZGRDbGFzcyhcIndpdGhMaWdhdHVyZXNcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKFwiI3dvcmRzXCIpLnJlbW92ZUNsYXNzKFwid2l0aExpZ2F0dXJlc1wiKTtcbiAgICAgICAgICAgICQoXCIjcmVzdWx0V29yZHNIaXN0b3J5IC53b3Jkc1wiKS5yZW1vdmVDbGFzcyhcIndpdGhMaWdhdHVyZXNcIik7XG4gICAgICAgICAgICAkKFwiI3Jlc3VsdFJlcGxheSAud29yZHNcIikucmVtb3ZlQ2xhc3MoXCJ3aXRoTGlnYXR1cmVzXCIpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGlmIChDb25maWcubW9kZSA9PSBcInplblwiKSB7XG4gICAgICAgIC8vICAgLy8gQ3JlYXRpbmcgYW4gZW1wdHkgYWN0aXZlIHdvcmQgZWxlbWVudCBmb3IgemVuIG1vZGVcbiAgICAgICAgLy8gICAkKFwiI3dvcmRzXCIpLmFwcGVuZCgnPGRpdiBjbGFzcz1cIndvcmQgYWN0aXZlXCI+PC9kaXY+Jyk7XG4gICAgICAgIC8vICAgJChcIiN3b3Jkc1wiKS5jc3MoXCJoZWlnaHRcIiwgXCJhdXRvXCIpO1xuICAgICAgICAvLyAgICQoXCIjd29yZHNXcmFwcGVyXCIpLmNzcyhcImhlaWdodFwiLCBcImF1dG9cIik7XG4gICAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAgIFRlc3RVSS5zaG93V29yZHMoKTtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQua2V5bWFwTW9kZSA9PT0gXCJuZXh0XCIgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9PSBcInplblwiKSB7XG4gICAgICAgICAgICBLZXltYXAuaGlnaGxpZ2h0S2V5KFRlc3RXb3Jkcy53b3Jkc1xuICAgICAgICAgICAgICAgIC5nZXRDdXJyZW50KClcbiAgICAgICAgICAgICAgICAuc3Vic3RyaW5nKFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50Lmxlbmd0aCwgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoICsgMSlcbiAgICAgICAgICAgICAgICAudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgIC50b1VwcGVyQ2FzZSgpKTtcbiAgICAgICAgfVxuICAgICAgICBGdW5ib3gudG9nZ2xlU2NyaXB0KFRlc3RXb3Jkcy53b3Jkcy5nZXRDdXJyZW50KCkpO1xuICAgICAgICAvLyB9XG4gICAgfSk7XG59XG5leHBvcnRzLmluaXQgPSBpbml0O1xuZnVuY3Rpb24gYWRkV29yZCgpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGxldCBib3VuZCA9IDEwMDtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcInBsdXNfb25lXCIpXG4gICAgICAgICAgICBib3VuZCA9IDE7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJwbHVzX3R3b1wiKVxuICAgICAgICAgICAgYm91bmQgPSAyO1xuICAgICAgICBpZiAoVGVzdFdvcmRzLndvcmRzLmxlbmd0aCAtIFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aCA+IGJvdW5kIHx8XG4gICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIgJiZcbiAgICAgICAgICAgICAgICBUZXN0V29yZHMud29yZHMubGVuZ3RoID49IGNvbmZpZ18xLmRlZmF1bHQud29yZHMgJiZcbiAgICAgICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0LndvcmRzID4gMCkgfHxcbiAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgICAgICBDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5sZW5ndGggPj0gQ3VzdG9tVGV4dC53b3JkICYmXG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC53b3JkICE9IDApIHx8XG4gICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICAgICAgIUN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmXG4gICAgICAgICAgICAgICAgIUN1c3RvbVRleHQuaXNUaW1lUmFuZG9tICYmXG4gICAgICAgICAgICAgICAgVGVzdFdvcmRzLndvcmRzLmxlbmd0aCA+PSBDdXN0b21UZXh0LnRleHQubGVuZ3RoKSB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiICYmXG4gICAgICAgICAgICAgICAgVGVzdFdvcmRzLndvcmRzLmxlbmd0aCA+PSAoKF9iID0gKF9hID0gVGVzdFdvcmRzLnJhbmRvbVF1b3RlLnRleHRTcGxpdCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogMCkpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcIndpa2lwZWRpYVwiIHx8IGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09IFwicG9ldHJ5XCIpIHtcbiAgICAgICAgICAgIGlmIChUZXN0V29yZHMud29yZHMubGVuZ3RoIC0gVGVzdFdvcmRzLndvcmRzLmN1cnJlbnRJbmRleCA8IDIwKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VjdGlvbiA9IGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09IFwid2lraXBlZGlhXCJcbiAgICAgICAgICAgICAgICAgICAgPyB5aWVsZCBXaWtpcGVkaWEuZ2V0U2VjdGlvbihjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKVxuICAgICAgICAgICAgICAgICAgICA6IHlpZWxkIFBvZXRyeS5nZXRQb2VtKCk7XG4gICAgICAgICAgICAgICAgaWYgKHNlY3Rpb24gPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGxldCB3b3JkQ291bnQgPSAwO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgd29yZCBvZiBzZWN0aW9uLndvcmRzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh3b3JkQ291bnQgPj0gY29uZmlnXzEuZGVmYXVsdC53b3JkcyAmJiBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ3b3Jkc1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB3b3JkQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgVGVzdFdvcmRzLndvcmRzLnB1c2god29yZCk7XG4gICAgICAgICAgICAgICAgICAgIFRlc3RVSS5hZGRXb3JkKHdvcmQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBsYW5ndWFnZSA9IGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJjdXN0b21cIlxuICAgICAgICAgICAgPyB5aWVsZCBNaXNjLmdldEN1cnJlbnRMYW5ndWFnZShjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKVxuICAgICAgICAgICAgOiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sICh5aWVsZCBNaXNjLmdldEN1cnJlbnRMYW5ndWFnZShjb25maWdfMS5kZWZhdWx0Lmxhbmd1YWdlKSkpLCB7IHdvcmRzOiBDdXN0b21UZXh0LnRleHQgfSk7XG4gICAgICAgIGNvbnN0IHdvcmRzZXQgPSBXb3Jkc2V0LndpdGhXb3JkcyhsYW5ndWFnZS53b3JkcywgY29uZmlnXzEuZGVmYXVsdC5mdW5ib3gpO1xuICAgICAgICBjb25zdCByYW5kb21Xb3JkID0geWllbGQgZ2V0TmV4dFdvcmQod29yZHNldCwgbGFuZ3VhZ2UsIGJvdW5kKTtcbiAgICAgICAgY29uc3Qgc3BsaXQgPSByYW5kb21Xb3JkLnNwbGl0KFwiIFwiKTtcbiAgICAgICAgaWYgKHNwbGl0Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIHNwbGl0LmZvckVhY2goKHdvcmQpID0+IHtcbiAgICAgICAgICAgICAgICBUZXN0V29yZHMud29yZHMucHVzaCh3b3JkKTtcbiAgICAgICAgICAgICAgICBUZXN0VUkuYWRkV29yZCh3b3JkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgVGVzdFdvcmRzLndvcmRzLnB1c2gocmFuZG9tV29yZCk7XG4gICAgICAgICAgICBUZXN0VUkuYWRkV29yZChyYW5kb21Xb3JkKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5hZGRXb3JkID0gYWRkV29yZDtcbmNvbnN0IHJldHJ5U2F2aW5nID0ge1xuICAgIGNvbXBsZXRlZEV2ZW50OiBudWxsLFxuICAgIGNhblJldHJ5OiBmYWxzZSxcbn07XG5mdW5jdGlvbiByZXRyeVNhdmluZ1Jlc3VsdCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCB7IGNvbXBsZXRlZEV2ZW50IH0gPSByZXRyeVNhdmluZztcbiAgICAgICAgaWYgKGNvbXBsZXRlZEV2ZW50ID09PSBudWxsKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkNvdWxkIG5vdCByZXRyeSBzYXZpbmcgdGhlIHJlc3VsdCBhcyB0aGUgcmVzdWx0IG5vIGxvbmdlciBleGlzdHMuXCIsIDAsIC0xKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXJldHJ5U2F2aW5nLmNhblJldHJ5KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmV0cnlTYXZpbmcuY2FuUmV0cnkgPSBmYWxzZTtcbiAgICAgICAgJChcIiNyZXRyeVNhdmluZ1Jlc3VsdEJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgQWNjb3VudEJ1dHRvbi5sb2FkaW5nKHRydWUpO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlJldHJ5aW5nIHRvIHNhdmUuLi5cIik7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5yZXN1bHRzLnNhdmUoY29tcGxldGVkRXZlbnQpO1xuICAgICAgICBBY2NvdW50QnV0dG9uLmxvYWRpbmcoZmFsc2UpO1xuICAgICAgICBSZXN1bHQuaGlkZUNyb3duKCk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgcmV0cnlTYXZpbmcuY2FuUmV0cnkgPSB0cnVlO1xuICAgICAgICAgICAgJChcIiNyZXRyeVNhdmluZ1Jlc3VsdEJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIHJldHVybiBOb3RpZmljYXRpb25zLmFkZChcIlJlc3VsdCBub3Qgc2F2ZWQuIFwiICsgcmVzcG9uc2UubWVzc2FnZSwgLTEpO1xuICAgICAgICB9XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50Ll9pZCA9IHJlc3BvbnNlLmRhdGEuaW5zZXJ0ZWRJZDtcbiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuaXNQYikge1xuICAgICAgICAgICAgY29tcGxldGVkRXZlbnQuaXNQYiA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgREIuc2F2ZUxvY2FsUmVzdWx0KGNvbXBsZXRlZEV2ZW50KTtcbiAgICAgICAgREIudXBkYXRlTG9jYWxTdGF0cyh7XG4gICAgICAgICAgICB0aW1lOiBjb21wbGV0ZWRFdmVudC50ZXN0RHVyYXRpb24gK1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50LmluY29tcGxldGVUZXN0U2Vjb25kcyAtXG4gICAgICAgICAgICAgICAgY29tcGxldGVkRXZlbnQuYWZrRHVyYXRpb24sXG4gICAgICAgICAgICBzdGFydGVkOiBUZXN0U3RhdHMucmVzdGFydENvdW50ICsgMSxcbiAgICAgICAgfSk7XG4gICAgICAgIEFuYWx5dGljc0NvbnRyb2xsZXIubG9nKFwidGVzdENvbXBsZXRlZFwiKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuaXNQYikge1xuICAgICAgICAgICAgLy9uZXcgcGJcbiAgICAgICAgICAgIFJlc3VsdC5zaG93Q3Jvd24oKTtcbiAgICAgICAgICAgIFJlc3VsdC51cGRhdGVDcm93bigpO1xuICAgICAgICAgICAgREIuc2F2ZUxvY2FsUEIoY29uZmlnXzEuZGVmYXVsdC5tb2RlLCBjb21wbGV0ZWRFdmVudC5tb2RlMiwgY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbiwgY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSwgY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5LCBjb25maWdfMS5kZWZhdWx0LmxhenlNb2RlLCBjb21wbGV0ZWRFdmVudC53cG0sIGNvbXBsZXRlZEV2ZW50LmFjYywgY29tcGxldGVkRXZlbnQucmF3V3BtLCBjb21wbGV0ZWRFdmVudC5jb25zaXN0ZW5jeSk7XG4gICAgICAgIH1cbiAgICAgICAgJChcIiNyZXRyeVNhdmluZ1Jlc3VsdEJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJSZXN1bHQgc2F2ZWRcIiwgMSk7XG4gICAgfSk7XG59XG5leHBvcnRzLnJldHJ5U2F2aW5nUmVzdWx0ID0gcmV0cnlTYXZpbmdSZXN1bHQ7XG5mdW5jdGlvbiBidWlsZENvbXBsZXRlZEV2ZW50KGRpZmZpY3VsdHlGYWlsZWQpIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAvL2J1aWxkIGNvbXBsZXRlZCBldmVudCBvYmplY3RcbiAgICBjb25zdCBjb21wbGV0ZWRFdmVudCA9IHtcbiAgICAgICAgd3BtOiB1bmRlZmluZWQsXG4gICAgICAgIHJhd1dwbTogdW5kZWZpbmVkLFxuICAgICAgICBjaGFyU3RhdHM6IHVuZGVmaW5lZCxcbiAgICAgICAgYWNjOiB1bmRlZmluZWQsXG4gICAgICAgIG1vZGU6IGNvbmZpZ18xLmRlZmF1bHQubW9kZSxcbiAgICAgICAgbW9kZTI6IHVuZGVmaW5lZCxcbiAgICAgICAgcXVvdGVMZW5ndGg6IC0xLFxuICAgICAgICBwdW5jdHVhdGlvbjogY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbixcbiAgICAgICAgbnVtYmVyczogY29uZmlnXzEuZGVmYXVsdC5udW1iZXJzLFxuICAgICAgICBsYXp5TW9kZTogY29uZmlnXzEuZGVmYXVsdC5sYXp5TW9kZSxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICBsYW5ndWFnZTogY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSxcbiAgICAgICAgcmVzdGFydENvdW50OiBUZXN0U3RhdHMucmVzdGFydENvdW50LFxuICAgICAgICBpbmNvbXBsZXRlVGVzdFNlY29uZHM6IFRlc3RTdGF0cy5pbmNvbXBsZXRlU2Vjb25kcyA8IDBcbiAgICAgICAgICAgID8gMFxuICAgICAgICAgICAgOiBNaXNjLnJvdW5kVG8yKFRlc3RTdGF0cy5pbmNvbXBsZXRlU2Vjb25kcyksXG4gICAgICAgIGRpZmZpY3VsdHk6IGNvbmZpZ18xLmRlZmF1bHQuZGlmZmljdWx0eSxcbiAgICAgICAgYmxpbmRNb2RlOiBjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSxcbiAgICAgICAgdGFnczogdW5kZWZpbmVkLFxuICAgICAgICBrZXlTcGFjaW5nOiBUZXN0SW5wdXQua2V5cHJlc3NUaW1pbmdzLnNwYWNpbmcuYXJyYXksXG4gICAgICAgIGtleUR1cmF0aW9uOiBUZXN0SW5wdXQua2V5cHJlc3NUaW1pbmdzLmR1cmF0aW9uLmFycmF5LFxuICAgICAgICBjb25zaXN0ZW5jeTogdW5kZWZpbmVkLFxuICAgICAgICBrZXlDb25zaXN0ZW5jeTogdW5kZWZpbmVkLFxuICAgICAgICBmdW5ib3g6IGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94LFxuICAgICAgICBiYWlsZWRPdXQ6IFRlc3RJbnB1dC5iYWlsb3V0LFxuICAgICAgICBjaGFydERhdGE6IHtcbiAgICAgICAgICAgIHdwbTogVGVzdElucHV0LndwbUhpc3RvcnksXG4gICAgICAgICAgICByYXc6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGVycjogdW5kZWZpbmVkLFxuICAgICAgICB9LFxuICAgICAgICBjdXN0b21UZXh0OiB1bmRlZmluZWQsXG4gICAgICAgIHRlc3REdXJhdGlvbjogdW5kZWZpbmVkLFxuICAgICAgICBhZmtEdXJhdGlvbjogdW5kZWZpbmVkLFxuICAgIH07XG4gICAgLy8gc3RhdHNcbiAgICBjb25zdCBzdGF0cyA9IFRlc3RTdGF0cy5jYWxjdWxhdGVTdGF0cygpO1xuICAgIGlmIChzdGF0cy50aW1lICUgMSAhPSAwICYmIGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgVGVzdFN0YXRzLnNldExhc3RTZWNvbmROb3RSb3VuZCgpO1xuICAgIH1cbiAgICBUZXN0U3RhdHMuc2V0TGFzdFRlc3RXcG0oc3RhdHMud3BtKTtcbiAgICBjb21wbGV0ZWRFdmVudC53cG0gPSBzdGF0cy53cG07XG4gICAgY29tcGxldGVkRXZlbnQucmF3V3BtID0gc3RhdHMud3BtUmF3O1xuICAgIGNvbXBsZXRlZEV2ZW50LmNoYXJTdGF0cyA9IFtcbiAgICAgICAgc3RhdHMuY29ycmVjdENoYXJzICsgc3RhdHMuY29ycmVjdFNwYWNlcyxcbiAgICAgICAgc3RhdHMuaW5jb3JyZWN0Q2hhcnMsXG4gICAgICAgIHN0YXRzLmV4dHJhQ2hhcnMsXG4gICAgICAgIHN0YXRzLm1pc3NlZENoYXJzLFxuICAgIF07XG4gICAgY29tcGxldGVkRXZlbnQuYWNjID0gc3RhdHMuYWNjO1xuICAgIC8vIGlmIHRoZSBsYXN0IHNlY29uZCB3YXMgbm90IHJvdW5kZWQsIGFkZCBhbm90aGVyIGRhdGEgcG9pbnQgdG8gdGhlIGhpc3RvcnlcbiAgICBpZiAoVGVzdFN0YXRzLmxhc3RTZWNvbmROb3RSb3VuZCAmJiAhZGlmZmljdWx0eUZhaWxlZCkge1xuICAgICAgICBjb25zdCB3cG1BbmRSYXcgPSBUZXN0U3RhdHMuY2FsY3VsYXRlV3BtQW5kUmF3KCk7XG4gICAgICAgIFRlc3RJbnB1dC5wdXNoVG9XcG1IaXN0b3J5KHdwbUFuZFJhdy53cG0pO1xuICAgICAgICBUZXN0SW5wdXQucHVzaFRvUmF3SGlzdG9yeSh3cG1BbmRSYXcucmF3KTtcbiAgICAgICAgVGVzdElucHV0LnB1c2hLZXlwcmVzc2VzVG9IaXN0b3J5KCk7XG4gICAgfVxuICAgIC8vY29uc2lzdGVuY3lcbiAgICBjb25zdCByYXdQZXJTZWNvbmQgPSBUZXN0SW5wdXQua2V5cHJlc3NQZXJTZWNvbmQubWFwKChmKSA9PiBNYXRoLnJvdW5kKChmLmNvdW50IC8gNSkgKiA2MCkpO1xuICAgIGNvbnN0IHN0ZGRldiA9IE1pc2Muc3RkRGV2KHJhd1BlclNlY29uZCk7XG4gICAgY29uc3QgYXZnID0gTWlzYy5tZWFuKHJhd1BlclNlY29uZCk7XG4gICAgbGV0IGNvbnNpc3RlbmN5ID0gTWlzYy5yb3VuZFRvMihNaXNjLmtvZ2FzYShzdGRkZXYgLyBhdmcpKTtcbiAgICBsZXQga2V5Q29uc2lzdGVuY3lBcnJheSA9IFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3Muc3BhY2luZy5hcnJheSA9PT0gXCJ0b29sb25nXCJcbiAgICAgICAgPyBbXVxuICAgICAgICA6IFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3Muc3BhY2luZy5hcnJheS5zbGljZSgpO1xuICAgIGlmIChrZXlDb25zaXN0ZW5jeUFycmF5Lmxlbmd0aCA+IDApIHtcbiAgICAgICAga2V5Q29uc2lzdGVuY3lBcnJheSA9IGtleUNvbnNpc3RlbmN5QXJyYXkuc2xpY2UoMCwga2V5Q29uc2lzdGVuY3lBcnJheS5sZW5ndGggLSAxKTtcbiAgICB9XG4gICAgbGV0IGtleUNvbnNpc3RlbmN5ID0gTWlzYy5yb3VuZFRvMihNaXNjLmtvZ2FzYShNaXNjLnN0ZERldihrZXlDb25zaXN0ZW5jeUFycmF5KSAvIE1pc2MubWVhbihrZXlDb25zaXN0ZW5jeUFycmF5KSkpO1xuICAgIGlmICghY29uc2lzdGVuY3kgfHwgaXNOYU4oY29uc2lzdGVuY3kpKSB7XG4gICAgICAgIGNvbnNpc3RlbmN5ID0gMDtcbiAgICB9XG4gICAgaWYgKCFrZXlDb25zaXN0ZW5jeSB8fCBpc05hTihrZXlDb25zaXN0ZW5jeSkpIHtcbiAgICAgICAga2V5Q29uc2lzdGVuY3kgPSAwO1xuICAgIH1cbiAgICBjb21wbGV0ZWRFdmVudC5rZXlDb25zaXN0ZW5jeSA9IGtleUNvbnNpc3RlbmN5O1xuICAgIGNvbXBsZXRlZEV2ZW50LmNvbnNpc3RlbmN5ID0gY29uc2lzdGVuY3k7XG4gICAgY29uc3Qgc21vb3RoZWRyYXcgPSBNaXNjLnNtb290aChyYXdQZXJTZWNvbmQsIDEpO1xuICAgIGNvbXBsZXRlZEV2ZW50LmNoYXJ0RGF0YS5yYXcgPSBzbW9vdGhlZHJhdztcbiAgICBjb21wbGV0ZWRFdmVudC5jaGFydERhdGEudW5zbW9vdGhlZFJhdyA9IHJhd1BlclNlY29uZDtcbiAgICAvL3Ntb290aGVkIGNvbnNpc3RlbmN5XG4gICAgY29uc3Qgc3RkZGV2MiA9IE1pc2Muc3RkRGV2KHNtb290aGVkcmF3KTtcbiAgICBjb25zdCBhdmcyID0gTWlzYy5tZWFuKHNtb290aGVkcmF3KTtcbiAgICBjb25zdCBzbW9vdGhDb25zaXN0ZW5jeSA9IE1pc2Mucm91bmRUbzIoTWlzYy5rb2dhc2Eoc3RkZGV2MiAvIGF2ZzIpKTtcbiAgICBjb21wbGV0ZWRFdmVudC5zbW9vdGhDb25zaXN0ZW5jeSA9IHNtb290aENvbnNpc3RlbmN5O1xuICAgIC8vd3BtIGNvbnNpc3RlbmN5XG4gICAgY29uc3Qgc3RkZGV2MyA9IE1pc2Muc3RkRGV2KChfYSA9IGNvbXBsZXRlZEV2ZW50LmNoYXJ0RGF0YS53cG0pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFtdKTtcbiAgICBjb25zdCBhdmczID0gTWlzYy5tZWFuKChfYiA9IGNvbXBsZXRlZEV2ZW50LmNoYXJ0RGF0YS53cG0pICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IFtdKTtcbiAgICBjb25zdCB3cG1Db25zaXN0ZW5jeSA9IE1pc2Mucm91bmRUbzIoTWlzYy5rb2dhc2Eoc3RkZGV2MyAvIGF2ZzMpKTtcbiAgICBjb21wbGV0ZWRFdmVudC53cG1Db25zaXN0ZW5jeSA9IHdwbUNvbnNpc3RlbmN5O1xuICAgIGNvbXBsZXRlZEV2ZW50LnRlc3REdXJhdGlvbiA9IHBhcnNlRmxvYXQoc3RhdHMudGltZS50b1N0cmluZygpKTtcbiAgICBjb21wbGV0ZWRFdmVudC5hZmtEdXJhdGlvbiA9IFRlc3RTdGF0cy5jYWxjdWxhdGVBZmtTZWNvbmRzKGNvbXBsZXRlZEV2ZW50LnRlc3REdXJhdGlvbik7XG4gICAgY29tcGxldGVkRXZlbnQuY2hhcnREYXRhLmVyciA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgVGVzdElucHV0LmtleXByZXNzUGVyU2Vjb25kLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50LmNoYXJ0RGF0YS5lcnIucHVzaChUZXN0SW5wdXQua2V5cHJlc3NQZXJTZWNvbmRbaV0uZXJyb3JzKTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50LnF1b3RlTGVuZ3RoID0gVGVzdFdvcmRzLnJhbmRvbVF1b3RlLmdyb3VwO1xuICAgICAgICBjb21wbGV0ZWRFdmVudC5sYW5nID0gY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZS5yZXBsYWNlKC9fXFxkKmskL2csIFwiXCIpO1xuICAgIH1cbiAgICAvLyBAdHMtaWdub3JlIFRPRE8gZml4IHRoaXNcbiAgICBjb21wbGV0ZWRFdmVudC5tb2RlMiA9IE1pc2MuZ2V0TW9kZTIoY29uZmlnXzEuZGVmYXVsdCwgVGVzdFdvcmRzLnJhbmRvbVF1b3RlKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiKSB7XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50LmN1c3RvbVRleHQgPSB7fTtcbiAgICAgICAgY29tcGxldGVkRXZlbnQuY3VzdG9tVGV4dC50ZXh0TGVuID0gQ3VzdG9tVGV4dC50ZXh0Lmxlbmd0aDtcbiAgICAgICAgY29tcGxldGVkRXZlbnQuY3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gPSBDdXN0b21UZXh0LmlzV29yZFJhbmRvbTtcbiAgICAgICAgY29tcGxldGVkRXZlbnQuY3VzdG9tVGV4dC5pc1RpbWVSYW5kb20gPSBDdXN0b21UZXh0LmlzVGltZVJhbmRvbTtcbiAgICAgICAgY29tcGxldGVkRXZlbnQuY3VzdG9tVGV4dC53b3JkID0gQ3VzdG9tVGV4dC53b3JkO1xuICAgICAgICBjb21wbGV0ZWRFdmVudC5jdXN0b21UZXh0LnRpbWUgPSBDdXN0b21UZXh0LnRpbWU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBkZWxldGUgY29tcGxldGVkRXZlbnQuY3VzdG9tVGV4dDtcbiAgICB9XG4gICAgLy90YWdzXG4gICAgY29uc3QgYWN0aXZlVGFnc0lkcyA9IFtdO1xuICAgIHRyeSB7XG4gICAgICAgIChfYyA9IERCLmdldFNuYXBzaG90KCkudGFncykgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgaWYgKHRhZy5hY3RpdmUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBhY3RpdmVUYWdzSWRzLnB1c2godGFnLl9pZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjYXRjaCAoZSkgeyB9XG4gICAgY29tcGxldGVkRXZlbnQudGFncyA9IGFjdGl2ZVRhZ3NJZHM7XG4gICAgaWYgKGNvbXBsZXRlZEV2ZW50Lm1vZGUgIT0gXCJjdXN0b21cIilcbiAgICAgICAgZGVsZXRlIGNvbXBsZXRlZEV2ZW50LmN1c3RvbVRleHQ7XG4gICAgcmV0dXJuIGNvbXBsZXRlZEV2ZW50O1xufVxuZnVuY3Rpb24gZmluaXNoKGRpZmZpY3VsdHlGYWlsZWQgPSBmYWxzZSkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoIVRlc3RBY3RpdmUuZ2V0KCkpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIiAmJiBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGggIT0gMCkge1xuICAgICAgICAgICAgVGVzdElucHV0LmlucHV0LnB1c2hIaXN0b3J5KCk7XG4gICAgICAgICAgICBUZXN0SW5wdXQuY29ycmVjdGVkLnB1c2hIaXN0b3J5KCk7XG4gICAgICAgICAgICBSZXBsYXkucmVwbGF5R2V0V29yZHNMaXN0KFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5KTtcbiAgICAgICAgfVxuICAgICAgICBUZXN0SW5wdXQucmVjb3JkS2V5cHJlc3NTcGFjaW5nKCk7IC8vdGhpcyBpcyBuZWVkZWQgaW4gY2FzZSB0aGVyZSBpcyBhZmsgdGltZSBhdCB0aGUgZW5kIC0gdG8gbWFrZSBzdXJlIHRlc3QgZHVyYXRpb24gbWFrZXMgc2Vuc2VcbiAgICAgICAgVGVzdFVJLnNldFJlc3VsdENhbGN1bGF0aW5nKHRydWUpO1xuICAgICAgICBUZXN0VUkuc2V0UmVzdWx0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgVGVzdFN0YXRzLnNldEVuZChwZXJmb3JtYW5jZS5ub3coKSk7XG4gICAgICAgIFRlc3RBY3RpdmUuc2V0KGZhbHNlKTtcbiAgICAgICAgUmVwbGF5LnN0b3BSZXBsYXlSZWNvcmRpbmcoKTtcbiAgICAgICAgRm9jdXMuc2V0KGZhbHNlKTtcbiAgICAgICAgQ2FyZXQuaGlkZSgpO1xuICAgICAgICBMaXZlV3BtLmhpZGUoKTtcbiAgICAgICAgUGJDcm93bi5oaWRlKCk7XG4gICAgICAgIExpdmVBY2MuaGlkZSgpO1xuICAgICAgICBMaXZlQnVyc3QuaGlkZSgpO1xuICAgICAgICBUaW1lclByb2dyZXNzLmhpZGUoKTtcbiAgICAgICAgT3V0T2ZGb2N1cy5oaWRlKCk7XG4gICAgICAgIFRlc3RUaW1lci5jbGVhcigpO1xuICAgICAgICBGdW5ib3guY2xlYXIoKTtcbiAgICAgICAgTW9ua2V5LmhpZGUoKTtcbiAgICAgICAgLy9uZWVkIG9uZSBtb3JlIGNhbGN1bGF0aW9uIGZvciB0aGUgbGFzdCB3b3JkIGlmIHRlc3QgYXV0byBlbmRlZFxuICAgICAgICBpZiAoVGVzdElucHV0LmJ1cnN0SGlzdG9yeS5sZW5ndGggIT09IFRlc3RJbnB1dC5pbnB1dC5nZXRIaXN0b3J5KCkubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBidXJzdCA9IFRlc3RTdGF0cy5jYWxjdWxhdGVCdXJzdCgpO1xuICAgICAgICAgICAgVGVzdElucHV0LnB1c2hCdXJzdFRvSGlzdG9yeShidXJzdCk7XG4gICAgICAgIH1cbiAgICAgICAgLy9yZW1vdmUgYWZrIGZyb20gemVuXG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIiB8fCBUZXN0SW5wdXQuYmFpbG91dCkge1xuICAgICAgICAgICAgVGVzdFN0YXRzLnJlbW92ZUFma0RhdGEoKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb21wbGV0ZWRFdmVudCA9IGJ1aWxkQ29tcGxldGVkRXZlbnQoZGlmZmljdWx0eUZhaWxlZCk7XG4gICAgICAgIC8vdG9kbyBjaGVjayBpZiBhbnkgZmllbGRzIGFyZSB1bmRlZmluZWRcbiAgICAgICAgLy8vLy8vLy8vIGNvbXBsZXRlZCBldmVudCByZWFkeVxuICAgICAgICAvL2FmayBjaGVja1xuICAgICAgICBjb25zdCBrcHMgPSBUZXN0SW5wdXQua2V5cHJlc3NQZXJTZWNvbmQuc2xpY2UoLTUpO1xuICAgICAgICBsZXQgYWZrRGV0ZWN0ZWQgPSBrcHMuZXZlcnkoKHNlY29uZCkgPT4gc2Vjb25kLmFmayk7XG4gICAgICAgIGlmIChUZXN0SW5wdXQuYmFpbG91dClcbiAgICAgICAgICAgIGFma0RldGVjdGVkID0gZmFsc2U7XG4gICAgICAgIGxldCB0b29TaG9ydCA9IGZhbHNlO1xuICAgICAgICBsZXQgZG9udFNhdmUgPSBmYWxzZTtcbiAgICAgICAgLy9mYWlsIGNoZWNrc1xuICAgICAgICBpZiAoZGlmZmljdWx0eUZhaWxlZCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoYFRlc3QgZmFpbGVkIC0gJHtmYWlsUmVhc29ufWAsIDAsIDEpO1xuICAgICAgICAgICAgZG9udFNhdmUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGFma0RldGVjdGVkKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIlRlc3QgaW52YWxpZCAtIEFGSyBkZXRlY3RlZFwiLCAwKTtcbiAgICAgICAgICAgIGRvbnRTYXZlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChUZXN0U3RhdGUuaXNSZXBlYXRlZCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJUZXN0IGludmFsaWQgLSByZXBlYXRlZFwiLCAwKTtcbiAgICAgICAgICAgIGRvbnRTYXZlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICgoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInRpbWVcIiAmJlxuICAgICAgICAgICAgY29tcGxldGVkRXZlbnQubW9kZTIgPCAxNSAmJlxuICAgICAgICAgICAgY29tcGxldGVkRXZlbnQubW9kZTIgPiAwKSB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ0aW1lXCIgJiZcbiAgICAgICAgICAgICAgICBjb21wbGV0ZWRFdmVudC5tb2RlMiA9PSAwICYmXG4gICAgICAgICAgICAgICAgY29tcGxldGVkRXZlbnQudGVzdER1cmF0aW9uIDwgMTUpIHx8XG4gICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIgJiZcbiAgICAgICAgICAgICAgICBjb21wbGV0ZWRFdmVudC5tb2RlMiA8IDEwICYmXG4gICAgICAgICAgICAgICAgY29tcGxldGVkRXZlbnQubW9kZTIgPiAwKSB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ3b3Jkc1wiICYmXG4gICAgICAgICAgICAgICAgY29tcGxldGVkRXZlbnQubW9kZTIgPT0gMCAmJlxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50LnRlc3REdXJhdGlvbiA8IDE1KSB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgICAgICFDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgICAgICFDdXN0b21UZXh0LmlzVGltZVJhbmRvbSAmJlxuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQudGV4dC5sZW5ndGggPCAxMCkgfHxcbiAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgICAgICBDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgICAgICFDdXN0b21UZXh0LmlzVGltZVJhbmRvbSAmJlxuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQud29yZCA8IDEwKSB8fFxuICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgICAgICFDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgICAgIEN1c3RvbVRleHQuaXNUaW1lUmFuZG9tICYmXG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC50aW1lIDwgMTUpIHx8XG4gICAgICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInplblwiICYmIGNvbXBsZXRlZEV2ZW50LnRlc3REdXJhdGlvbiA8IDE1KSkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJUZXN0IGludmFsaWQgLSB0b28gc2hvcnRcIiwgMCk7XG4gICAgICAgICAgICB0b29TaG9ydCA9IHRydWU7XG4gICAgICAgICAgICBkb250U2F2ZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29tcGxldGVkRXZlbnQud3BtIDwgMCB8fCBjb21wbGV0ZWRFdmVudC53cG0gPiAzNTApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiVGVzdCBpbnZhbGlkIC0gd3BtXCIsIDApO1xuICAgICAgICAgICAgVGVzdFN0YXRzLnNldEludmFsaWQoKTtcbiAgICAgICAgICAgIGRvbnRTYXZlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb21wbGV0ZWRFdmVudC5hY2MgPCA3NSB8fCBjb21wbGV0ZWRFdmVudC5hY2MgPiAxMDApIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiVGVzdCBpbnZhbGlkIC0gYWNjdXJhY3lcIiwgMCk7XG4gICAgICAgICAgICBUZXN0U3RhdHMuc2V0SW52YWxpZCgpO1xuICAgICAgICAgICAgZG9udFNhdmUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIHRlc3QgaXMgdmFsaWRcbiAgICAgICAgaWYgKCFkb250U2F2ZSkge1xuICAgICAgICAgICAgVG9kYXlUcmFja2VyLmFkZFNlY29uZHMoY29tcGxldGVkRXZlbnQudGVzdER1cmF0aW9uICtcbiAgICAgICAgICAgICAgICAoVGVzdFN0YXRzLmluY29tcGxldGVTZWNvbmRzIDwgMFxuICAgICAgICAgICAgICAgICAgICA/IDBcbiAgICAgICAgICAgICAgICAgICAgOiBNaXNjLnJvdW5kVG8yKFRlc3RTdGF0cy5pbmNvbXBsZXRlU2Vjb25kcykpIC1cbiAgICAgICAgICAgICAgICBjb21wbGV0ZWRFdmVudC5hZmtEdXJhdGlvbik7XG4gICAgICAgICAgICBSZXN1bHQudXBkYXRlVG9kYXlUcmFja2VyKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlciA9PSBudWxsKSB7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0ICNyZXN1bHQgI3JhdGVRdW90ZUJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgI3Jlc3VsdCAjcmVwb3J0UXVvdGVCdXR0b25cIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICBBbmFseXRpY3NDb250cm9sbGVyLmxvZyhcInRlc3RDb21wbGV0ZWROb0xvZ2luXCIpO1xuICAgICAgICAgICAgaWYgKCFkb250U2F2ZSlcbiAgICAgICAgICAgICAgICBleHBvcnRzLm5vdFNpZ25lZEluTGFzdFJlc3VsdCA9IGNvbXBsZXRlZEV2ZW50O1xuICAgICAgICAgICAgZG9udFNhdmUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAjcmVzdWx0ICNyZXBvcnRRdW90ZUJ1dHRvblwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgfVxuICAgICAgICB5aWVsZCBSZXN1bHQudXBkYXRlKGNvbXBsZXRlZEV2ZW50LCBkaWZmaWN1bHR5RmFpbGVkLCBmYWlsUmVhc29uLCBhZmtEZXRlY3RlZCwgVGVzdFN0YXRlLmlzUmVwZWF0ZWQsIHRvb1Nob3J0LCBUZXN0V29yZHMucmFuZG9tUXVvdGUsIGRvbnRTYXZlKTtcbiAgICAgICAgaWYgKGNvbXBsZXRlZEV2ZW50LmNoYXJ0RGF0YSAhPT0gXCJ0b29sb25nXCIpIHtcbiAgICAgICAgICAgIGRlbGV0ZSBjb21wbGV0ZWRFdmVudC5jaGFydERhdGEudW5zbW9vdGhlZFJhdztcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29tcGxldGVkRXZlbnQudGVzdER1cmF0aW9uID4gMTIyKSB7XG4gICAgICAgICAgICBjb21wbGV0ZWRFdmVudC5jaGFydERhdGEgPSBcInRvb2xvbmdcIjtcbiAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50LmtleVNwYWNpbmcgPSBcInRvb2xvbmdcIjtcbiAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50LmtleUR1cmF0aW9uID0gXCJ0b29sb25nXCI7XG4gICAgICAgICAgICBUZXN0SW5wdXQuc2V0S2V5cHJlc3NUaW1pbmdzVG9vTG9uZygpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkb250U2F2ZSkge1xuICAgICAgICAgICAgQW5hbHl0aWNzQ29udHJvbGxlci5sb2coXCJ0ZXN0Q29tcGxldGVkSW52YWxpZFwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyB1c2VyIGlzIGxvZ2dlZCBpblxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ID09IFwibm9ybWFsXCIgfHxcbiAgICAgICAgICAgICgoY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ID09IFwibWFzdGVyXCIgfHwgY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5ID09IFwiZXhwZXJ0XCIpICYmXG4gICAgICAgICAgICAgICAgIWRpZmZpY3VsdHlGYWlsZWQpKSB7XG4gICAgICAgICAgICBUZXN0U3RhdHMucmVzZXRJbmNvbXBsZXRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgY29tcGxldGVkRXZlbnQudWlkID0gKF9hID0gZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudWlkO1xuICAgICAgICBSZXN1bHQudXBkYXRlUmF0ZVF1b3RlKFRlc3RXb3Jkcy5yYW5kb21RdW90ZSk7XG4gICAgICAgIEFjY291bnRCdXR0b24ubG9hZGluZyh0cnVlKTtcbiAgICAgICAgY29tcGxldGVkRXZlbnQuY2hhbGxlbmdlID0gQ2hhbGxlbmdlQ29udG9sbGVyLnZlcmlmeShjb21wbGV0ZWRFdmVudCk7XG4gICAgICAgIGlmIChjb21wbGV0ZWRFdmVudC5jaGFsbGVuZ2UgPT09IG51bGwpXG4gICAgICAgICAgICBjb21wbGV0ZWRFdmVudCA9PT0gbnVsbCB8fCBjb21wbGV0ZWRFdmVudCA9PT0gdm9pZCAwID8gdHJ1ZSA6IGRlbGV0ZSBjb21wbGV0ZWRFdmVudC5jaGFsbGVuZ2U7XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50Lmhhc2ggPSAoMCwgb2JqZWN0X2hhc2hfMS5kZWZhdWx0KShjb21wbGV0ZWRFdmVudCk7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgYXBlXzEuZGVmYXVsdC5yZXN1bHRzLnNhdmUoY29tcGxldGVkRXZlbnQpO1xuICAgICAgICBBY2NvdW50QnV0dG9uLmxvYWRpbmcoZmFsc2UpO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3Igc2F2aW5nIHJlc3VsdFwiLCBjb21wbGV0ZWRFdmVudCk7XG4gICAgICAgICAgICAkKFwiI3JldHJ5U2F2aW5nUmVzdWx0QnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2UgPT09IFwiSW5jb3JyZWN0IHJlc3VsdCBoYXNoXCIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhjb21wbGV0ZWRFdmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXRyeVNhdmluZy5jb21wbGV0ZWRFdmVudCA9IGNvbXBsZXRlZEV2ZW50O1xuICAgICAgICAgICAgcmV0cnlTYXZpbmcuY2FuUmV0cnkgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbnMuYWRkKFwiRmFpbGVkIHRvIHNhdmUgcmVzdWx0OiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICBSZXN1bHQuaGlkZUNyb3duKCk7XG4gICAgICAgIGNvbXBsZXRlZEV2ZW50Ll9pZCA9IHJlc3BvbnNlLmRhdGEuaW5zZXJ0ZWRJZDtcbiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuaXNQYikge1xuICAgICAgICAgICAgY29tcGxldGVkRXZlbnQuaXNQYiA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgREIuc2F2ZUxvY2FsUmVzdWx0KGNvbXBsZXRlZEV2ZW50KTtcbiAgICAgICAgREIudXBkYXRlTG9jYWxTdGF0cyh7XG4gICAgICAgICAgICB0aW1lOiBjb21wbGV0ZWRFdmVudC50ZXN0RHVyYXRpb24gK1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlZEV2ZW50LmluY29tcGxldGVUZXN0U2Vjb25kcyAtXG4gICAgICAgICAgICAgICAgY29tcGxldGVkRXZlbnQuYWZrRHVyYXRpb24sXG4gICAgICAgICAgICBzdGFydGVkOiBUZXN0U3RhdHMucmVzdGFydENvdW50ICsgMSxcbiAgICAgICAgfSk7XG4gICAgICAgIEFuYWx5dGljc0NvbnRyb2xsZXIubG9nKFwidGVzdENvbXBsZXRlZFwiKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuaXNQYikge1xuICAgICAgICAgICAgLy9uZXcgcGJcbiAgICAgICAgICAgIFJlc3VsdC5zaG93Q3Jvd24oKTtcbiAgICAgICAgICAgIFJlc3VsdC51cGRhdGVDcm93bigpO1xuICAgICAgICAgICAgREIuc2F2ZUxvY2FsUEIoY29uZmlnXzEuZGVmYXVsdC5tb2RlLCBjb21wbGV0ZWRFdmVudC5tb2RlMiwgY29uZmlnXzEuZGVmYXVsdC5wdW5jdHVhdGlvbiwgY29uZmlnXzEuZGVmYXVsdC5sYW5ndWFnZSwgY29uZmlnXzEuZGVmYXVsdC5kaWZmaWN1bHR5LCBjb25maWdfMS5kZWZhdWx0LmxhenlNb2RlLCBjb21wbGV0ZWRFdmVudC53cG0sIGNvbXBsZXRlZEV2ZW50LmFjYywgY29tcGxldGVkRXZlbnQucmF3V3BtLCBjb21wbGV0ZWRFdmVudC5jb25zaXN0ZW5jeSk7XG4gICAgICAgIH1cbiAgICAgICAgJChcIiNyZXRyeVNhdmluZ1Jlc3VsdEJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZmluaXNoID0gZmluaXNoO1xuZnVuY3Rpb24gZmFpbChyZWFzb24pIHtcbiAgICBmYWlsUmVhc29uID0gcmVhc29uO1xuICAgIC8vIGlucHV0LnB1c2hIaXN0b3J5KCk7XG4gICAgLy8gY29ycmVjdGVkLnB1c2hIaXN0b3J5KCk7XG4gICAgVGVzdElucHV0LnB1c2hLZXlwcmVzc2VzVG9IaXN0b3J5KCk7XG4gICAgZmluaXNoKHRydWUpO1xuICAgIGNvbnN0IHRlc3RTZWNvbmRzID0gVGVzdFN0YXRzLmNhbGN1bGF0ZVRlc3RTZWNvbmRzKHBlcmZvcm1hbmNlLm5vdygpKTtcbiAgICBjb25zdCBhZmtzZWNvbmRzID0gVGVzdFN0YXRzLmNhbGN1bGF0ZUFma1NlY29uZHModGVzdFNlY29uZHMpO1xuICAgIGxldCB0dCA9IHRlc3RTZWNvbmRzIC0gYWZrc2Vjb25kcztcbiAgICBpZiAodHQgPCAwKVxuICAgICAgICB0dCA9IDA7XG4gICAgVGVzdFN0YXRzLmluY3JlbWVudEluY29tcGxldGVTZWNvbmRzKHR0KTtcbiAgICBUZXN0U3RhdHMuaW5jcmVtZW50UmVzdGFydENvdW50KCk7XG59XG5leHBvcnRzLmZhaWwgPSBmYWlsO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0ZXN0TW9kZXNOb3RpY2UgLnRleHQtYnV0dG9uLnJlc3RhcnRcIiwgKCkgPT4ge1xuICAgIHJlc3RhcnQoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJrZXlwcmVzc1wiLCBcIiNyZXN0YXJ0VGVzdEJ1dHRvblwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgTWFudWFsUmVzdGFydC5yZXNldCgpO1xuICAgICAgICBpZiAoVGVzdEFjdGl2ZS5nZXQoKSAmJlxuICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5yZXBlYXRRdW90ZXMgPT09IFwidHlwaW5nXCIgJiZcbiAgICAgICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgICAgICByZXN0YXJ0KHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdGFydCgpO1xuICAgICAgICB9XG4gICAgfVxufSk7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIjcmVzdGFydFRlc3RCdXR0b25cIiwgKCkgPT4ge1xuICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgaWYgKFRlc3RVSS5yZXN1bHRDYWxjdWxhdGluZylcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChUZXN0QWN0aXZlLmdldCgpICYmXG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQucmVwZWF0UXVvdGVzID09PSBcInR5cGluZ1wiICYmXG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgIHJlc3RhcnQodHJ1ZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXN0YXJ0KCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIjcmV0cnlTYXZpbmdSZXN1bHRCdXR0b25cIiwgcmV0cnlTYXZpbmdSZXN1bHQpO1xuJChkb2N1bWVudCkub24oXCJrZXlwcmVzc1wiLCBcIiNuZXh0VGVzdEJ1dHRvblwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgcmVzdGFydCgpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiI25leHRUZXN0QnV0dG9uXCIsICgpID0+IHtcbiAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgIHJlc3RhcnQoKTtcbn0pO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiI3Jlc3RhcnRUZXN0QnV0dG9uV2l0aFNhbWVXb3Jkc2V0XCIsICgpID0+IHtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJSZXBlYXQgdGVzdCBkaXNhYmxlZCBpbiB6ZW4gbW9kZVwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgIHJlc3RhcnQodHJ1ZSk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwia2V5cHJlc3NcIiwgXCIjcmVzdGFydFRlc3RCdXR0b25XaXRoU2FtZVdvcmRzZXRcIiwgKGV2ZW50KSA9PiB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiUmVwZWF0IHRlc3QgZGlzYWJsZWQgaW4gemVuIG1vZGVcIik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIHJlc3RhcnQodHJ1ZSk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3RvcCAuY29uZmlnIC53b3JkQ291bnQgLnRleHQtYnV0dG9uXCIsIChlKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHdyZCA9IChfYSA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwid29yZENvdW50XCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIjE1XCI7XG4gICAgaWYgKHdyZCAhPSBcImN1c3RvbVwiKSB7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRXb3JkQ291bnQocGFyc2VJbnQod3JkKSk7XG4gICAgICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgICAgIHJlc3RhcnQoKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjdG9wIC5jb25maWcgLnRpbWUgLnRleHQtYnV0dG9uXCIsIChlKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IG1vZGUgPSAoX2EgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcInRpbWVDb25maWdcIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwiMTBcIjtcbiAgICBpZiAobW9kZSAhPSBcImN1c3RvbVwiKSB7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRUaW1lQ29uZmlnKHBhcnNlSW50KG1vZGUpKTtcbiAgICAgICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICAgICAgcmVzdGFydCgpO1xuICAgIH1cbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0b3AgLmNvbmZpZyAucXVvdGVMZW5ndGggLnRleHQtYnV0dG9uXCIsIChlKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGxldCBsZW4gPSBwYXJzZUludCgoX2EgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcInF1b3RlTGVuZ3RoXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIjFcIik7XG4gICAgaWYgKGxlbiAhPSAtMikge1xuICAgICAgICBpZiAobGVuID09IC0xKSB7XG4gICAgICAgICAgICBsZW4gPSBbMCwgMSwgMiwgM107XG4gICAgICAgIH1cbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldFF1b3RlTGVuZ3RoKGxlbiwgZmFsc2UsIGUuc2hpZnRLZXkpO1xuICAgICAgICBNYW51YWxSZXN0YXJ0LnNldCgpO1xuICAgICAgICByZXN0YXJ0KCk7XG4gICAgfVxufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3RvcCAuY29uZmlnIC5wdW5jdHVhdGlvbk1vZGUgLnRleHQtYnV0dG9uXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0UHVuY3R1YXRpb24oIWNvbmZpZ18xLmRlZmF1bHQucHVuY3R1YXRpb24pO1xuICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgcmVzdGFydCgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3RvcCAuY29uZmlnIC5udW1iZXJzTW9kZSAudGV4dC1idXR0b25cIiwgKCkgPT4ge1xuICAgIFVwZGF0ZUNvbmZpZy5zZXROdW1iZXJzKCFjb25maWdfMS5kZWZhdWx0Lm51bWJlcnMpO1xuICAgIE1hbnVhbFJlc3RhcnQuc2V0KCk7XG4gICAgcmVzdGFydCgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3RvcCAuY29uZmlnIC5tb2RlIC50ZXh0LWJ1dHRvblwiLCAoZSkgPT4ge1xuICAgIHZhciBfYTtcbiAgICBpZiAoJChlLmN1cnJlbnRUYXJnZXQpLmhhc0NsYXNzKFwiYWN0aXZlXCIpKVxuICAgICAgICByZXR1cm47XG4gICAgY29uc3QgbW9kZSA9ICgoX2EgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcIm1vZGVcIikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IFwidGltZVwiKTtcbiAgICBpZiAobW9kZSA9PT0gdW5kZWZpbmVkKVxuICAgICAgICByZXR1cm47XG4gICAgVXBkYXRlQ29uZmlnLnNldE1vZGUobW9kZSk7XG4gICAgTWFudWFsUmVzdGFydC5zZXQoKTtcbiAgICByZXN0YXJ0KCk7XG59KTtcbiQoXCIjcHJhY3Rpc2VXb3Jkc1BvcHVwIC5idXR0b24ubWlzc2VkXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIFByYWN0aXNlV29yZHMuaGlkZVBvcHVwKCk7XG4gICAgUHJhY3Rpc2VXb3Jkcy5pbml0KHRydWUsIGZhbHNlKTtcbiAgICByZXN0YXJ0KGZhbHNlLCBmYWxzZSwgdW5kZWZpbmVkLCB0cnVlKTtcbn0pO1xuJChcIiNwcmFjdGlzZVdvcmRzUG9wdXAgLmJ1dHRvbi5zbG93XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIFByYWN0aXNlV29yZHMuaGlkZVBvcHVwKCk7XG4gICAgUHJhY3Rpc2VXb3Jkcy5pbml0KGZhbHNlLCB0cnVlKTtcbiAgICByZXN0YXJ0KGZhbHNlLCBmYWxzZSwgdW5kZWZpbmVkLCB0cnVlKTtcbn0pO1xuJChcIiNwcmFjdGlzZVdvcmRzUG9wdXAgLmJ1dHRvbi5ib3RoXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIFByYWN0aXNlV29yZHMuaGlkZVBvcHVwKCk7XG4gICAgUHJhY3Rpc2VXb3Jkcy5pbml0KHRydWUsIHRydWUpO1xuICAgIHJlc3RhcnQoZmFsc2UsIGZhbHNlLCB1bmRlZmluZWQsIHRydWUpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3F1b3RlU2VhcmNoUG9wdXAgI3F1b3RlU2VhcmNoUmVzdWx0cyAuc2VhcmNoUmVzdWx0XCIsIChlKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJyZXBvcnRcIikpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBzaWQgPSBwYXJzZUludCgoX2EgPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcImlkXCIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBcIlwiKTtcbiAgICBRdW90ZVNlYXJjaFBvcHVwLnNldFNlbGVjdGVkSWQoc2lkKTtcbiAgICBpZiAoUXVvdGVTZWFyY2hQb3B1cC5hcHBseShzaWQpID09PSB0cnVlKVxuICAgICAgICByZXN0YXJ0KCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjdG9wICNtZW51ICNzdGFydFRlc3RCdXR0b24sICN0b3AgLmxvZ29cIiwgKCkgPT4ge1xuICAgIGlmIChBY3RpdmVQYWdlLmdldCgpID09PSBcInRlc3RcIilcbiAgICAgICAgcmVzdGFydCgpO1xufSk7XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5LCBldmVudFZhbHVlLCBub3NhdmUpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiZGlmZmljdWx0eVwiICYmICFub3NhdmUpXG4gICAgICAgIHJlc3RhcnQoZmFsc2UsIG5vc2F2ZSk7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcInNob3dBbGxMaW5lc1wiICYmICFub3NhdmUpXG4gICAgICAgIHJlc3RhcnQoKTtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwia2V5bWFwTW9kZVwiICYmICFub3NhdmUpXG4gICAgICAgIHJlc3RhcnQoZmFsc2UsIG5vc2F2ZSk7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcImxhenlNb2RlXCIgJiYgZXZlbnRWYWx1ZSA9PT0gZmFsc2UgJiYgIW5vc2F2ZSkge1xuICAgICAgICByZW1lbWJlckxhenlNb2RlID0gZmFsc2U7XG4gICAgfVxufSk7XG5UaW1lckV2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXksIGV2ZW50VmFsdWUpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiZmFpbFwiICYmIGV2ZW50VmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICAgICAgZmFpbChldmVudFZhbHVlKTtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiZmluaXNoXCIpXG4gICAgICAgIGZpbmlzaCgpO1xufSk7XG5SZXNldFJlcXVlc3RlZEV2ZW50LnN1YnNjcmliZSgoKSA9PiB7XG4gICAgcmVzdGFydCgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2V0QWN0aXZlQ2hhbGxlbmdlID0gZXhwb3J0cy5zZXRQYWNlUmVwZWF0ID0gZXhwb3J0cy5zZXRSZXBlYXRlZCA9IGV4cG9ydHMuYWN0aXZlQ2hhbGxlbmdlID0gZXhwb3J0cy5pc1BhY2VSZXBlYXQgPSBleHBvcnRzLmlzUmVwZWF0ZWQgPSB2b2lkIDA7XG5leHBvcnRzLmlzUmVwZWF0ZWQgPSBmYWxzZTtcbmV4cG9ydHMuaXNQYWNlUmVwZWF0ID0gZmFsc2U7XG5leHBvcnRzLmFjdGl2ZUNoYWxsZW5nZSA9IG51bGw7XG5mdW5jdGlvbiBzZXRSZXBlYXRlZCh0Zikge1xuICAgIGV4cG9ydHMuaXNSZXBlYXRlZCA9IHRmO1xufVxuZXhwb3J0cy5zZXRSZXBlYXRlZCA9IHNldFJlcGVhdGVkO1xuZnVuY3Rpb24gc2V0UGFjZVJlcGVhdCh0Zikge1xuICAgIGV4cG9ydHMuaXNQYWNlUmVwZWF0ID0gdGY7XG59XG5leHBvcnRzLnNldFBhY2VSZXBlYXQgPSBzZXRQYWNlUmVwZWF0O1xuZnVuY3Rpb24gc2V0QWN0aXZlQ2hhbGxlbmdlKHZhbCkge1xuICAgIGV4cG9ydHMuYWN0aXZlQ2hhbGxlbmdlID0gdmFsO1xufVxuZXhwb3J0cy5zZXRBY3RpdmVDaGFsbGVuZ2UgPSBzZXRBY3RpdmVDaGFsbGVuZ2U7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5jYWxjdWxhdGVTdGF0cyA9IGV4cG9ydHMucmVtb3ZlQWZrRGF0YSA9IGV4cG9ydHMuY2FsY3VsYXRlQWNjdXJhY3kgPSBleHBvcnRzLmNhbGN1bGF0ZUJ1cnN0ID0gZXhwb3J0cy5zZXRMYXN0U2Vjb25kTm90Um91bmQgPSBleHBvcnRzLmNhbGN1bGF0ZUFma1NlY29uZHMgPSBleHBvcnRzLnNldFN0YXJ0ID0gZXhwb3J0cy5zZXRFbmQgPSBleHBvcnRzLmNhbGN1bGF0ZVdwbUFuZFJhdyA9IGV4cG9ydHMuY2FsY3VsYXRlVGVzdFNlY29uZHMgPSBleHBvcnRzLnNldEludmFsaWQgPSBleHBvcnRzLnJlc2V0SW5jb21wbGV0ZSA9IGV4cG9ydHMuaW5jcmVtZW50SW5jb21wbGV0ZVNlY29uZHMgPSBleHBvcnRzLmluY3JlbWVudFJlc3RhcnRDb3VudCA9IGV4cG9ydHMuaW5jb21wbGV0ZVNlY29uZHMgPSBleHBvcnRzLnJlc3RhcnRDb3VudCA9IGV4cG9ydHMucmVzdGFydCA9IGV4cG9ydHMuZ2V0U3RhdHMgPSBleHBvcnRzLnNldExhc3RUZXN0V3BtID0gZXhwb3J0cy5sYXN0VGVzdFdwbSA9IGV4cG9ydHMubGFzdFNlY29uZE5vdFJvdW5kID0gZXhwb3J0cy5lbmQyID0gZXhwb3J0cy5zdGFydDIgPSBleHBvcnRzLmVuZCA9IGV4cG9ydHMuc3RhcnQgPSBleHBvcnRzLmludmFsaWQgPSB2b2lkIDA7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgVGVzdElucHV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QtaW5wdXRcIikpO1xuY29uc3QgVGVzdFdvcmRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3Qtd29yZHNcIikpO1xuZXhwb3J0cy5pbnZhbGlkID0gZmFsc2U7XG5leHBvcnRzLmxhc3RTZWNvbmROb3RSb3VuZCA9IGZhbHNlO1xuZXhwb3J0cy5sYXN0VGVzdFdwbSA9IDA7XG5mdW5jdGlvbiBzZXRMYXN0VGVzdFdwbSh3cG0pIHtcbiAgICBleHBvcnRzLmxhc3RUZXN0V3BtID0gd3BtO1xufVxuZXhwb3J0cy5zZXRMYXN0VGVzdFdwbSA9IHNldExhc3RUZXN0V3BtO1xuZnVuY3Rpb24gZ2V0U3RhdHMoKSB7XG4gICAgY29uc3QgcmV0ID0ge1xuICAgICAgICBzdGFydDogZXhwb3J0cy5zdGFydCxcbiAgICAgICAgZW5kOiBleHBvcnRzLmVuZCxcbiAgICAgICAgd3BtSGlzdG9yeTogVGVzdElucHV0LndwbUhpc3RvcnksXG4gICAgICAgIHJhd0hpc3Rvcnk6IFRlc3RJbnB1dC53cG1IaXN0b3J5LFxuICAgICAgICBidXJzdEhpc3Rvcnk6IFRlc3RJbnB1dC5idXJzdEhpc3RvcnksXG4gICAgICAgIGtleXByZXNzUGVyU2Vjb25kOiBUZXN0SW5wdXQua2V5cHJlc3NQZXJTZWNvbmQsXG4gICAgICAgIGN1cnJlbnRLZXlwcmVzczogVGVzdElucHV0LmN1cnJlbnRLZXlwcmVzcyxcbiAgICAgICAgbGFzdEtleXByZXNzOiBUZXN0SW5wdXQubGFzdEtleXByZXNzLFxuICAgICAgICBjdXJyZW50QnVyc3RTdGFydDogVGVzdElucHV0LmN1cnJlbnRCdXJzdFN0YXJ0LFxuICAgICAgICBsYXN0U2Vjb25kTm90Um91bmQ6IGV4cG9ydHMubGFzdFNlY29uZE5vdFJvdW5kLFxuICAgICAgICBtaXNzZWRXb3JkczogVGVzdElucHV0Lm1pc3NlZFdvcmRzLFxuICAgICAgICBhY2N1cmFjeTogVGVzdElucHV0LmFjY3VyYWN5LFxuICAgICAgICBrZXlwcmVzc1RpbWluZ3M6IFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3MsXG4gICAgfTtcbiAgICB0cnkge1xuICAgICAgICByZXQua2V5U3BhY2luZ1N0YXRzID0ge1xuICAgICAgICAgICAgYXZlcmFnZTogVGVzdElucHV0LmtleXByZXNzVGltaW5ncy5zcGFjaW5nLmFycmF5LnJlZHVjZSgocHJldmlvdXMsIGN1cnJlbnQpID0+IChjdXJyZW50ICs9IHByZXZpb3VzKSkgLyBUZXN0SW5wdXQua2V5cHJlc3NUaW1pbmdzLnNwYWNpbmcuYXJyYXkubGVuZ3RoLFxuICAgICAgICAgICAgc2Q6IE1pc2Muc3RkRGV2KFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3Muc3BhY2luZy5hcnJheSksXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIC8vXG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIHJldC5rZXlEdXJhdGlvblN0YXRzID0ge1xuICAgICAgICAgICAgYXZlcmFnZTogVGVzdElucHV0LmtleXByZXNzVGltaW5ncy5kdXJhdGlvbi5hcnJheS5yZWR1Y2UoKHByZXZpb3VzLCBjdXJyZW50KSA9PiAoY3VycmVudCArPSBwcmV2aW91cykpIC8gVGVzdElucHV0LmtleXByZXNzVGltaW5ncy5kdXJhdGlvbi5hcnJheS5sZW5ndGgsXG4gICAgICAgICAgICBzZDogTWlzYy5zdGREZXYoVGVzdElucHV0LmtleXByZXNzVGltaW5ncy5kdXJhdGlvbi5hcnJheSksXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIC8vXG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59XG5leHBvcnRzLmdldFN0YXRzID0gZ2V0U3RhdHM7XG5mdW5jdGlvbiByZXN0YXJ0KCkge1xuICAgIGV4cG9ydHMuc3RhcnQgPSAwO1xuICAgIGV4cG9ydHMuZW5kID0gMDtcbiAgICBleHBvcnRzLmludmFsaWQgPSBmYWxzZTtcbiAgICBleHBvcnRzLmxhc3RTZWNvbmROb3RSb3VuZCA9IGZhbHNlO1xufVxuZXhwb3J0cy5yZXN0YXJ0ID0gcmVzdGFydDtcbmV4cG9ydHMucmVzdGFydENvdW50ID0gMDtcbmV4cG9ydHMuaW5jb21wbGV0ZVNlY29uZHMgPSAwO1xuZnVuY3Rpb24gaW5jcmVtZW50UmVzdGFydENvdW50KCkge1xuICAgIGV4cG9ydHMucmVzdGFydENvdW50Kys7XG59XG5leHBvcnRzLmluY3JlbWVudFJlc3RhcnRDb3VudCA9IGluY3JlbWVudFJlc3RhcnRDb3VudDtcbmZ1bmN0aW9uIGluY3JlbWVudEluY29tcGxldGVTZWNvbmRzKHZhbCkge1xuICAgIGV4cG9ydHMuaW5jb21wbGV0ZVNlY29uZHMgKz0gdmFsO1xufVxuZXhwb3J0cy5pbmNyZW1lbnRJbmNvbXBsZXRlU2Vjb25kcyA9IGluY3JlbWVudEluY29tcGxldGVTZWNvbmRzO1xuZnVuY3Rpb24gcmVzZXRJbmNvbXBsZXRlKCkge1xuICAgIGV4cG9ydHMucmVzdGFydENvdW50ID0gMDtcbiAgICBleHBvcnRzLmluY29tcGxldGVTZWNvbmRzID0gMDtcbn1cbmV4cG9ydHMucmVzZXRJbmNvbXBsZXRlID0gcmVzZXRJbmNvbXBsZXRlO1xuZnVuY3Rpb24gc2V0SW52YWxpZCgpIHtcbiAgICBleHBvcnRzLmludmFsaWQgPSB0cnVlO1xufVxuZXhwb3J0cy5zZXRJbnZhbGlkID0gc2V0SW52YWxpZDtcbmZ1bmN0aW9uIGNhbGN1bGF0ZVRlc3RTZWNvbmRzKG5vdykge1xuICAgIGlmIChub3cgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb25zdCBlbmRBZmtTZWNvbmRzID0gKGV4cG9ydHMuZW5kIC0gVGVzdElucHV0Lmxhc3RLZXlwcmVzcykgLyAxMDAwO1xuICAgICAgICBpZiAoKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiIHx8IFRlc3RJbnB1dC5iYWlsb3V0KSAmJiBlbmRBZmtTZWNvbmRzIDwgNykge1xuICAgICAgICAgICAgcmV0dXJuIChUZXN0SW5wdXQubGFzdEtleXByZXNzIC0gZXhwb3J0cy5zdGFydCkgLyAxMDAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIChleHBvcnRzLmVuZCAtIGV4cG9ydHMuc3RhcnQpIC8gMTAwMDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIChub3cgLSBleHBvcnRzLnN0YXJ0KSAvIDEwMDA7XG4gICAgfVxufVxuZXhwb3J0cy5jYWxjdWxhdGVUZXN0U2Vjb25kcyA9IGNhbGN1bGF0ZVRlc3RTZWNvbmRzO1xuZnVuY3Rpb24gY2FsY3VsYXRlV3BtQW5kUmF3KCkge1xuICAgIGxldCBjaGFycyA9IDA7XG4gICAgbGV0IGNvcnJlY3RXb3JkQ2hhcnMgPSAwO1xuICAgIGxldCBzcGFjZXMgPSAwO1xuICAgIC8vY2hlY2sgaW5wdXQgaGlzdG9yeVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgVGVzdElucHV0LmlucHV0Lmhpc3RvcnkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3Qgd29yZCA9IGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiXG4gICAgICAgICAgICA/IFRlc3RJbnB1dC5pbnB1dC5nZXRIaXN0b3J5KGkpXG4gICAgICAgICAgICA6IFRlc3RXb3Jkcy53b3Jkcy5nZXQoaSk7XG4gICAgICAgIGlmIChUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKSA9PSB3b3JkKSB7XG4gICAgICAgICAgICAvL3RoZSB3b3JkIGlzIGNvcnJlY3RcbiAgICAgICAgICAgIC8vKzEgZm9yIHNwYWNlXG4gICAgICAgICAgICBjb3JyZWN0V29yZENoYXJzICs9IHdvcmQubGVuZ3RoO1xuICAgICAgICAgICAgaWYgKGkgPCBUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGggLSAxICYmXG4gICAgICAgICAgICAgICAgTWlzYy5nZXRMYXN0Q2hhcihUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKSkgIT09IFwiXFxuXCIpIHtcbiAgICAgICAgICAgICAgICBzcGFjZXMrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjaGFycyArPSBUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKS5sZW5ndGg7XG4gICAgfVxuICAgIGlmIChUZXN0SW5wdXQuaW5wdXQuY3VycmVudCAhPT0gXCJcIikge1xuICAgICAgICBjb25zdCB3b3JkID0gY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCJcbiAgICAgICAgICAgID8gVGVzdElucHV0LmlucHV0LmN1cnJlbnRcbiAgICAgICAgICAgIDogVGVzdFdvcmRzLndvcmRzLmdldEN1cnJlbnQoKTtcbiAgICAgICAgLy9jaGVjayB3aGF0cyBjdXJyZW50bHkgdHlwZWRcbiAgICAgICAgY29uc3QgdG9BZGQgPSB7XG4gICAgICAgICAgICBjb3JyZWN0OiAwLFxuICAgICAgICAgICAgaW5jb3JyZWN0OiAwLFxuICAgICAgICAgICAgbWlzc2VkOiAwLFxuICAgICAgICB9O1xuICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IHdvcmQubGVuZ3RoOyBjKyspIHtcbiAgICAgICAgICAgIGlmIChjIDwgVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgLy9vbiBjaGFyIHRoYXQgc3RpbGwgaGFzIGEgd29yZCBsaXN0IHBhaXJcbiAgICAgICAgICAgICAgICBpZiAoVGVzdElucHV0LmlucHV0LmN1cnJlbnRbY10gPT0gd29yZFtjXSkge1xuICAgICAgICAgICAgICAgICAgICB0b0FkZC5jb3JyZWN0Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b0FkZC5pbmNvcnJlY3QrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL29uIGNoYXIgdGhhdCBpcyBleHRyYVxuICAgICAgICAgICAgICAgIHRvQWRkLm1pc3NlZCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNoYXJzICs9IHRvQWRkLmNvcnJlY3Q7XG4gICAgICAgIGNoYXJzICs9IHRvQWRkLmluY29ycmVjdDtcbiAgICAgICAgY2hhcnMgKz0gdG9BZGQubWlzc2VkO1xuICAgICAgICBpZiAodG9BZGQuaW5jb3JyZWN0ID09IDApIHtcbiAgICAgICAgICAgIC8vd29yZCBpcyBjb3JyZWN0IHNvIGZhciwgYWRkIGNoYXJzXG4gICAgICAgICAgICBjb3JyZWN0V29yZENoYXJzICs9IHRvQWRkLmNvcnJlY3Q7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcIm5vc3BhY2VcIiB8fCBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICBzcGFjZXMgPSAwO1xuICAgIH1cbiAgICBjaGFycyArPSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGg7XG4gICAgY29uc3QgdGVzdFNlY29uZHMgPSBjYWxjdWxhdGVUZXN0U2Vjb25kcyhwZXJmb3JtYW5jZS5ub3coKSk7XG4gICAgY29uc3Qgd3BtID0gTWF0aC5yb3VuZCgoKGNvcnJlY3RXb3JkQ2hhcnMgKyBzcGFjZXMpICogKDYwIC8gdGVzdFNlY29uZHMpKSAvIDUpO1xuICAgIGNvbnN0IHJhdyA9IE1hdGgucm91bmQoKChjaGFycyArIHNwYWNlcykgKiAoNjAgLyB0ZXN0U2Vjb25kcykpIC8gNSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgd3BtOiB3cG0sXG4gICAgICAgIHJhdzogcmF3LFxuICAgIH07XG59XG5leHBvcnRzLmNhbGN1bGF0ZVdwbUFuZFJhdyA9IGNhbGN1bGF0ZVdwbUFuZFJhdztcbmZ1bmN0aW9uIHNldEVuZChlKSB7XG4gICAgZXhwb3J0cy5lbmQgPSBlO1xuICAgIGV4cG9ydHMuZW5kMiA9IERhdGUubm93KCk7XG59XG5leHBvcnRzLnNldEVuZCA9IHNldEVuZDtcbmZ1bmN0aW9uIHNldFN0YXJ0KHMpIHtcbiAgICBleHBvcnRzLnN0YXJ0ID0gcztcbiAgICBleHBvcnRzLnN0YXJ0MiA9IERhdGUubm93KCk7XG59XG5leHBvcnRzLnNldFN0YXJ0ID0gc2V0U3RhcnQ7XG5mdW5jdGlvbiBjYWxjdWxhdGVBZmtTZWNvbmRzKHRlc3RTZWNvbmRzKSB7XG4gICAgbGV0IGV4dHJhQWZrID0gMDtcbiAgICBpZiAodGVzdFNlY29uZHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInRpbWVcIikge1xuICAgICAgICAgICAgZXh0cmFBZmsgPSBNYXRoLnJvdW5kKHRlc3RTZWNvbmRzKSAtIFRlc3RJbnB1dC5rZXlwcmVzc1BlclNlY29uZC5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBleHRyYUFmayA9IE1hdGguY2VpbCh0ZXN0U2Vjb25kcykgLSBUZXN0SW5wdXQua2V5cHJlc3NQZXJTZWNvbmQubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGlmIChleHRyYUFmayA8IDApXG4gICAgICAgICAgICBleHRyYUFmayA9IDA7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiLS0gZXh0cmEgYWZrIGRlYnVnXCIpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcInNob3VsZCBiZSBcIiArIE1hdGguY2VpbCh0ZXN0U2Vjb25kcykpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhrZXlwcmVzc1BlclNlY29uZC5sZW5ndGgpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcbiAgICAgICAgLy8gICBgZ29ubmEgYWRkIGV4dHJhICR7ZXh0cmFBZmt9IHNlY29uZHMgb2YgYWZrIGJlY2F1c2Ugb2Ygbm8ga2V5cHJlc3MgZGF0YWBcbiAgICAgICAgLy8gKTtcbiAgICB9XG4gICAgY29uc3QgcmV0ID0gVGVzdElucHV0LmtleXByZXNzUGVyU2Vjb25kLmZpbHRlcigoeCkgPT4geC5hZmspLmxlbmd0aDtcbiAgICByZXR1cm4gcmV0ICsgZXh0cmFBZms7XG59XG5leHBvcnRzLmNhbGN1bGF0ZUFma1NlY29uZHMgPSBjYWxjdWxhdGVBZmtTZWNvbmRzO1xuZnVuY3Rpb24gc2V0TGFzdFNlY29uZE5vdFJvdW5kKCkge1xuICAgIGV4cG9ydHMubGFzdFNlY29uZE5vdFJvdW5kID0gdHJ1ZTtcbn1cbmV4cG9ydHMuc2V0TGFzdFNlY29uZE5vdFJvdW5kID0gc2V0TGFzdFNlY29uZE5vdFJvdW5kO1xuZnVuY3Rpb24gY2FsY3VsYXRlQnVyc3QoKSB7XG4gICAgY29uc3QgdGltZVRvV3JpdGUgPSAocGVyZm9ybWFuY2Uubm93KCkgLSBUZXN0SW5wdXQuY3VycmVudEJ1cnN0U3RhcnQpIC8gMTAwMDtcbiAgICBsZXQgd29yZExlbmd0aDtcbiAgICB3b3JkTGVuZ3RoID0gVGVzdElucHV0LmlucHV0LmN1cnJlbnQubGVuZ3RoO1xuICAgIGlmICh3b3JkTGVuZ3RoID09IDApIHtcbiAgICAgICAgd29yZExlbmd0aCA9IFRlc3RJbnB1dC5pbnB1dC5nZXRIaXN0b3J5TGFzdCgpLmxlbmd0aDtcbiAgICB9XG4gICAgY29uc3Qgc3BlZWQgPSBNaXNjLnJvdW5kVG8yKCh3b3JkTGVuZ3RoICogKDYwIC8gdGltZVRvV3JpdGUpKSAvIDUpO1xuICAgIHJldHVybiBNYXRoLnJvdW5kKHNwZWVkKTtcbn1cbmV4cG9ydHMuY2FsY3VsYXRlQnVyc3QgPSBjYWxjdWxhdGVCdXJzdDtcbmZ1bmN0aW9uIGNhbGN1bGF0ZUFjY3VyYWN5KCkge1xuICAgIGNvbnN0IGFjYyA9IChUZXN0SW5wdXQuYWNjdXJhY3kuY29ycmVjdCAvXG4gICAgICAgIChUZXN0SW5wdXQuYWNjdXJhY3kuY29ycmVjdCArIFRlc3RJbnB1dC5hY2N1cmFjeS5pbmNvcnJlY3QpKSAqXG4gICAgICAgIDEwMDtcbiAgICByZXR1cm4gaXNOYU4oYWNjKSA/IDEwMCA6IGFjYztcbn1cbmV4cG9ydHMuY2FsY3VsYXRlQWNjdXJhY3kgPSBjYWxjdWxhdGVBY2N1cmFjeTtcbmZ1bmN0aW9uIHJlbW92ZUFma0RhdGEoKSB7XG4gICAgY29uc3QgdGVzdFNlY29uZHMgPSBjYWxjdWxhdGVUZXN0U2Vjb25kcygpO1xuICAgIFRlc3RJbnB1dC5rZXlwcmVzc1BlclNlY29uZC5zcGxpY2UodGVzdFNlY29uZHMpO1xuICAgIFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3MuZHVyYXRpb24uYXJyYXkuc3BsaWNlKHRlc3RTZWNvbmRzKTtcbiAgICBUZXN0SW5wdXQua2V5cHJlc3NUaW1pbmdzLnNwYWNpbmcuYXJyYXkuc3BsaWNlKHRlc3RTZWNvbmRzKTtcbiAgICBUZXN0SW5wdXQud3BtSGlzdG9yeS5zcGxpY2UodGVzdFNlY29uZHMpO1xufVxuZXhwb3J0cy5yZW1vdmVBZmtEYXRhID0gcmVtb3ZlQWZrRGF0YTtcbmZ1bmN0aW9uIGNvdW50Q2hhcnMoKSB7XG4gICAgbGV0IGNvcnJlY3RXb3JkQ2hhcnMgPSAwO1xuICAgIGxldCBjb3JyZWN0Q2hhcnMgPSAwO1xuICAgIGxldCBpbmNvcnJlY3RDaGFycyA9IDA7XG4gICAgbGV0IGV4dHJhQ2hhcnMgPSAwO1xuICAgIGxldCBtaXNzZWRDaGFycyA9IDA7XG4gICAgbGV0IHNwYWNlcyA9IDA7XG4gICAgbGV0IGNvcnJlY3RzcGFjZXMgPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgVGVzdElucHV0LmlucHV0Lmhpc3RvcnkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3Qgd29yZCA9IGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiXG4gICAgICAgICAgICA/IFRlc3RJbnB1dC5pbnB1dC5nZXRIaXN0b3J5KGkpXG4gICAgICAgICAgICA6IFRlc3RXb3Jkcy53b3Jkcy5nZXQoaSk7XG4gICAgICAgIGlmIChUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKSA9PT0gXCJcIikge1xuICAgICAgICAgICAgLy9sYXN0IHdvcmQgdGhhdCB3YXMgbm90IHN0YXJ0ZWRcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKSA9PSB3b3JkKSB7XG4gICAgICAgICAgICAvL3RoZSB3b3JkIGlzIGNvcnJlY3RcbiAgICAgICAgICAgIGNvcnJlY3RXb3JkQ2hhcnMgKz0gd29yZC5sZW5ndGg7XG4gICAgICAgICAgICBjb3JyZWN0Q2hhcnMgKz0gd29yZC5sZW5ndGg7XG4gICAgICAgICAgICBpZiAoaSA8IFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aCAtIDEgJiZcbiAgICAgICAgICAgICAgICBNaXNjLmdldExhc3RDaGFyKFRlc3RJbnB1dC5pbnB1dC5nZXRIaXN0b3J5KGkpKSAhPT0gXCJcXG5cIikge1xuICAgICAgICAgICAgICAgIGNvcnJlY3RzcGFjZXMrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKS5sZW5ndGggPj0gd29yZC5sZW5ndGgpIHtcbiAgICAgICAgICAgIC8vdG9vIG1hbnkgY2hhcnNcbiAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgVGVzdElucHV0LmlucHV0LmdldEhpc3RvcnkoaSkubGVuZ3RoOyBjKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoYyA8IHdvcmQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vb24gY2hhciB0aGF0IHN0aWxsIGhhcyBhIHdvcmQgbGlzdCBwYWlyXG4gICAgICAgICAgICAgICAgICAgIGlmIChUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKVtjXSA9PSB3b3JkW2NdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0Q2hhcnMrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluY29ycmVjdENoYXJzKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vb24gY2hhciB0aGF0IGlzIGV4dHJhXG4gICAgICAgICAgICAgICAgICAgIGV4dHJhQ2hhcnMrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvL25vdCBlbm91Z2ggY2hhcnNcbiAgICAgICAgICAgIGNvbnN0IHRvQWRkID0ge1xuICAgICAgICAgICAgICAgIGNvcnJlY3Q6IDAsXG4gICAgICAgICAgICAgICAgaW5jb3JyZWN0OiAwLFxuICAgICAgICAgICAgICAgIG1pc3NlZDogMCxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IHdvcmQubGVuZ3RoOyBjKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoYyA8IFRlc3RJbnB1dC5pbnB1dC5nZXRIaXN0b3J5KGkpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAvL29uIGNoYXIgdGhhdCBzdGlsbCBoYXMgYSB3b3JkIGxpc3QgcGFpclxuICAgICAgICAgICAgICAgICAgICBpZiAoVGVzdElucHV0LmlucHV0LmdldEhpc3RvcnkoaSlbY10gPT0gd29yZFtjXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9BZGQuY29ycmVjdCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9BZGQuaW5jb3JyZWN0Kys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vb24gY2hhciB0aGF0IGlzIGV4dHJhXG4gICAgICAgICAgICAgICAgICAgIHRvQWRkLm1pc3NlZCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvcnJlY3RDaGFycyArPSB0b0FkZC5jb3JyZWN0O1xuICAgICAgICAgICAgaW5jb3JyZWN0Q2hhcnMgKz0gdG9BZGQuaW5jb3JyZWN0O1xuICAgICAgICAgICAgaWYgKGkgPT09IFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aCAtIDEgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwidGltZVwiKSB7XG4gICAgICAgICAgICAgICAgLy9sYXN0IHdvcmQgLSBjaGVjayBpZiBpdCB3YXMgYWxsIGNvcnJlY3QgLSBhZGQgdG8gY29ycmVjdCB3b3JkIGNoYXJzXG4gICAgICAgICAgICAgICAgaWYgKHRvQWRkLmluY29ycmVjdCA9PT0gMClcbiAgICAgICAgICAgICAgICAgICAgY29ycmVjdFdvcmRDaGFycyArPSB0b0FkZC5jb3JyZWN0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbWlzc2VkQ2hhcnMgKz0gdG9BZGQubWlzc2VkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChpIDwgVGVzdElucHV0LmlucHV0Lmhpc3RvcnkubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgc3BhY2VzKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcIm5vc3BhY2VcIiB8fCBjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICBzcGFjZXMgPSAwO1xuICAgICAgICBjb3JyZWN0c3BhY2VzID0gMDtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc3BhY2VzOiBzcGFjZXMsXG4gICAgICAgIGNvcnJlY3RXb3JkQ2hhcnM6IGNvcnJlY3RXb3JkQ2hhcnMsXG4gICAgICAgIGFsbENvcnJlY3RDaGFyczogY29ycmVjdENoYXJzLFxuICAgICAgICBpbmNvcnJlY3RDaGFyczogY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIgPyBUZXN0SW5wdXQuYWNjdXJhY3kuaW5jb3JyZWN0IDogaW5jb3JyZWN0Q2hhcnMsXG4gICAgICAgIGV4dHJhQ2hhcnM6IGV4dHJhQ2hhcnMsXG4gICAgICAgIG1pc3NlZENoYXJzOiBtaXNzZWRDaGFycyxcbiAgICAgICAgY29ycmVjdFNwYWNlczogY29ycmVjdHNwYWNlcyxcbiAgICB9O1xufVxuZnVuY3Rpb24gY2FsY3VsYXRlU3RhdHMoKSB7XG4gICAgbGV0IHRlc3RTZWNvbmRzID0gY2FsY3VsYXRlVGVzdFNlY29uZHMoKTtcbiAgICAvLyBjb25zb2xlLmxvZygoZW5kMiAtIHN0YXJ0MikgLyAxMDAwKTtcbiAgICAvLyBjb25zb2xlLmxvZyh0ZXN0U2Vjb25kcyk7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPSBcImN1c3RvbVwiKSB7XG4gICAgICAgIHRlc3RTZWNvbmRzID0gTWlzYy5yb3VuZFRvMih0ZXN0U2Vjb25kcyk7XG4gICAgfVxuICAgIGNvbnN0IGNoYXJzID0gY291bnRDaGFycygpO1xuICAgIGNvbnN0IHdwbSA9IE1pc2Mucm91bmRUbzIoKChjaGFycy5jb3JyZWN0V29yZENoYXJzICsgY2hhcnMuY29ycmVjdFNwYWNlcykgKiAoNjAgLyB0ZXN0U2Vjb25kcykpIC8gNSk7XG4gICAgY29uc3Qgd3BtcmF3ID0gTWlzYy5yb3VuZFRvMigoKGNoYXJzLmFsbENvcnJlY3RDaGFycyArXG4gICAgICAgIGNoYXJzLnNwYWNlcyArXG4gICAgICAgIGNoYXJzLmluY29ycmVjdENoYXJzICtcbiAgICAgICAgY2hhcnMuZXh0cmFDaGFycykgKlxuICAgICAgICAoNjAgLyB0ZXN0U2Vjb25kcykpIC9cbiAgICAgICAgNSk7XG4gICAgY29uc3QgYWNjID0gTWlzYy5yb3VuZFRvMihjYWxjdWxhdGVBY2N1cmFjeSgpKTtcbiAgICByZXR1cm4ge1xuICAgICAgICB3cG06IGlzTmFOKHdwbSkgPyAwIDogd3BtLFxuICAgICAgICB3cG1SYXc6IGlzTmFOKHdwbXJhdykgPyAwIDogd3BtcmF3LFxuICAgICAgICBhY2M6IGFjYyxcbiAgICAgICAgY29ycmVjdENoYXJzOiBjaGFycy5jb3JyZWN0V29yZENoYXJzLFxuICAgICAgICBpbmNvcnJlY3RDaGFyczogY2hhcnMuaW5jb3JyZWN0Q2hhcnMsXG4gICAgICAgIG1pc3NlZENoYXJzOiBjaGFycy5taXNzZWRDaGFycyxcbiAgICAgICAgZXh0cmFDaGFyczogY2hhcnMuZXh0cmFDaGFycyxcbiAgICAgICAgYWxsQ2hhcnM6IGNoYXJzLmFsbENvcnJlY3RDaGFycyArXG4gICAgICAgICAgICBjaGFycy5zcGFjZXMgK1xuICAgICAgICAgICAgY2hhcnMuaW5jb3JyZWN0Q2hhcnMgK1xuICAgICAgICAgICAgY2hhcnMuZXh0cmFDaGFycyxcbiAgICAgICAgdGltZTogTWlzYy5yb3VuZFRvMih0ZXN0U2Vjb25kcyksXG4gICAgICAgIHNwYWNlczogY2hhcnMuc3BhY2VzLFxuICAgICAgICBjb3JyZWN0U3BhY2VzOiBjaGFycy5jb3JyZWN0U3BhY2VzLFxuICAgIH07XG59XG5leHBvcnRzLmNhbGN1bGF0ZVN0YXRzID0gY2FsY3VsYXRlU3RhdHM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbi8vbW9zdCBvZiB0aGUgY29kZSBpcyB0aGFua3MgdG9cbi8vaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjk5NzE4OTgvaG93LXRvLWNyZWF0ZS1hbi1hY2N1cmF0ZS10aW1lci1pbi1qYXZhc2NyaXB0XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zdGFydCA9IGV4cG9ydHMuZ2V0VGltZXJTdGF0cyA9IGV4cG9ydHMuY2xlYXIgPSBleHBvcnRzLmVuYWJsZVRpbWVyRGVidWcgPSB2b2lkIDA7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vY29uZmlnXCIpKSwgVXBkYXRlQ29uZmlnID0gY29uZmlnXzE7XG5jb25zdCBDdXN0b21UZXh0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL2N1c3RvbS10ZXh0XCIpKTtcbmNvbnN0IFRpbWVyUHJvZ3Jlc3MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGltZXItcHJvZ3Jlc3NcIikpO1xuY29uc3QgTGl2ZVdwbSA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9saXZlLXdwbVwiKSk7XG5jb25zdCBUZXN0U3RhdHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC1zdGF0c1wiKSk7XG5jb25zdCBUZXN0SW5wdXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC1pbnB1dFwiKSk7XG5jb25zdCBUZXN0V29yZHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC13b3Jkc1wiKSk7XG5jb25zdCBNb25rZXkgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vbW9ua2V5XCIpKTtcbmNvbnN0IE1pc2MgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZWxlbWVudHMvbm90aWZpY2F0aW9uc1wiKSk7XG5jb25zdCBDYXJldCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9jYXJldFwiKSk7XG5jb25zdCBTbG93VGltZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9zbG93LXRpbWVyXCIpKTtcbmNvbnN0IFRlc3RBY3RpdmUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy90ZXN0LWFjdGl2ZVwiKSk7XG5jb25zdCBUaW1lID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvdGltZVwiKSk7XG5jb25zdCBUaW1lckV2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy90aW1lci1ldmVudFwiKSk7XG5sZXQgc2xvd1RpbWVyQ291bnQgPSAwO1xubGV0IHRpbWVyID0gbnVsbDtcbmNvbnN0IGludGVydmFsID0gMTAwMDtcbmxldCBleHBlY3RlZCA9IDA7XG5sZXQgdGltZXJEZWJ1ZyA9IGZhbHNlO1xuZnVuY3Rpb24gZW5hYmxlVGltZXJEZWJ1ZygpIHtcbiAgICB0aW1lckRlYnVnID0gdHJ1ZTtcbn1cbmV4cG9ydHMuZW5hYmxlVGltZXJEZWJ1ZyA9IGVuYWJsZVRpbWVyRGVidWc7XG5mdW5jdGlvbiBjbGVhcigpIHtcbiAgICBUaW1lLnNldCgwKTtcbiAgICBpZiAodGltZXIgIT09IG51bGwpXG4gICAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG59XG5leHBvcnRzLmNsZWFyID0gY2xlYXI7XG5mdW5jdGlvbiBwcmVtaWQoKSB7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZShcInByZW1pZFwiKTtcbiAgICBjb25zdCBwcmVtaWRTZWNvbmRzTGVmdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJlbWlkU2Vjb25kc0xlZnRcIik7XG4gICAgaWYgKHByZW1pZFNlY29uZHNMZWZ0ICE9PSBudWxsKSB7XG4gICAgICAgIHByZW1pZFNlY29uZHNMZWZ0LmlubmVySFRNTCA9IChjb25maWdfMS5kZWZhdWx0LnRpbWUgLSBUaW1lLmdldCgpKS50b1N0cmluZygpO1xuICAgIH1cbiAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgY29uc29sZS50aW1lRW5kKFwicHJlbWlkXCIpO1xufVxuZnVuY3Rpb24gdXBkYXRlVGltZXIoKSB7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZShcInRpbWVyIHByb2dyZXNzIHVwZGF0ZVwiKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInRpbWVcIiB8fFxuICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiICYmIEN1c3RvbVRleHQuaXNUaW1lUmFuZG9tKSkge1xuICAgICAgICBUaW1lclByb2dyZXNzLnVwZGF0ZSgpO1xuICAgIH1cbiAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgY29uc29sZS50aW1lRW5kKFwidGltZXIgcHJvZ3Jlc3MgdXBkYXRlXCIpO1xufVxuZnVuY3Rpb24gY2FsY3VsYXRlV3BtUmF3KCkge1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWUoXCJjYWxjdWxhdGUgd3BtIGFuZCByYXdcIik7XG4gICAgY29uc3Qgd3BtQW5kUmF3ID0gVGVzdFN0YXRzLmNhbGN1bGF0ZVdwbUFuZFJhdygpO1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWVFbmQoXCJjYWxjdWxhdGUgd3BtIGFuZCByYXdcIik7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZShcInVwZGF0ZSBsaXZlIHdwbVwiKTtcbiAgICBMaXZlV3BtLnVwZGF0ZSh3cG1BbmRSYXcud3BtLCB3cG1BbmRSYXcucmF3KTtcbiAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgY29uc29sZS50aW1lRW5kKFwidXBkYXRlIGxpdmUgd3BtXCIpO1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWUoXCJwdXNoIHRvIGhpc3RvcnlcIik7XG4gICAgVGVzdElucHV0LnB1c2hUb1dwbUhpc3Rvcnkod3BtQW5kUmF3LndwbSk7XG4gICAgVGVzdElucHV0LnB1c2hUb1Jhd0hpc3Rvcnkod3BtQW5kUmF3LnJhdyk7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZUVuZChcInB1c2ggdG8gaGlzdG9yeVwiKTtcbiAgICByZXR1cm4gd3BtQW5kUmF3O1xufVxuZnVuY3Rpb24gbW9ua2V5KHdwbUFuZFJhdykge1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWUoXCJ1cGRhdGUgbW9ua2V5XCIpO1xuICAgIGNvbnN0IG51bSA9IGNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlID8gd3BtQW5kUmF3LnJhdyA6IHdwbUFuZFJhdy53cG07XG4gICAgTW9ua2V5LnVwZGF0ZUZhc3RPcGFjaXR5KG51bSk7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZUVuZChcInVwZGF0ZSBtb25rZXlcIik7XG59XG5mdW5jdGlvbiBjYWxjdWxhdGVBY2MoKSB7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZShcImNhbGN1bGF0ZSBhY2NcIik7XG4gICAgY29uc3QgYWNjID0gTWlzYy5yb3VuZFRvMihUZXN0U3RhdHMuY2FsY3VsYXRlQWNjdXJhY3koKSk7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZUVuZChcImNhbGN1bGF0ZSBhY2NcIik7XG4gICAgcmV0dXJuIGFjYztcbn1cbmZ1bmN0aW9uIGxheW91dGZsdWlkKCkge1xuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWUoXCJsYXlvdXRmbHVpZFwiKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5mdW5ib3ggPT09IFwibGF5b3V0Zmx1aWRcIiAmJiBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwidGltZVwiKSB7XG4gICAgICAgIGNvbnN0IGxheW91dHMgPSBjb25maWdfMS5kZWZhdWx0LmN1c3RvbUxheW91dGZsdWlkXG4gICAgICAgICAgICA/IGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tTGF5b3V0Zmx1aWQuc3BsaXQoXCIjXCIpXG4gICAgICAgICAgICA6IFtcInF3ZXJ0eVwiLCBcImR2b3Jha1wiLCBcImNvbGVtYWtcIl07XG4gICAgICAgIGNvbnN0IHN3aXRjaFRpbWUgPSBjb25maWdfMS5kZWZhdWx0LnRpbWUgLyBsYXlvdXRzLmxlbmd0aDtcbiAgICAgICAgY29uc3QgdGltZSA9IFRpbWUuZ2V0KCk7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gTWF0aC5mbG9vcih0aW1lIC8gc3dpdGNoVGltZSk7XG4gICAgICAgIGNvbnN0IGxheW91dCA9IGxheW91dHNbaW5kZXhdO1xuICAgICAgICBjb25zdCBmbG9vcmVkU3dpdGNoVGltZXMgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBsYXlvdXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBmbG9vcmVkU3dpdGNoVGltZXMucHVzaChNYXRoLmZsb29yKHN3aXRjaFRpbWUgKiBpKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZsb29yZWRTd2l0Y2hUaW1lcy5pbmNsdWRlcyh0aW1lICsgMykpIHtcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiM1wiLCAwLCAxKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChmbG9vcmVkU3dpdGNoVGltZXMuaW5jbHVkZXModGltZSArIDIpKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIjJcIiwgMCwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZmxvb3JlZFN3aXRjaFRpbWVzLmluY2x1ZGVzKHRpbWUgKyAxKSkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCIxXCIsIDAsIDEpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmxheW91dCAhPT0gbGF5b3V0ICYmIGxheW91dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChgLS0tICEhISAke2xheW91dH0gISEhIC0tLWAsIDApO1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldExheW91dChsYXlvdXQsIHRydWUpO1xuICAgICAgICAgICAgVXBkYXRlQ29uZmlnLnNldEtleW1hcExheW91dChsYXlvdXQsIHRydWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWVFbmQoXCJsYXlvdXRmbHVpZFwiKTtcbn1cbmZ1bmN0aW9uIGNoZWNrSWZGYWlsZWQod3BtQW5kUmF3LCBhY2MpIHtcbiAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgY29uc29sZS50aW1lKFwiZmFpbCBjb25kaXRpb25zXCIpO1xuICAgIFRlc3RJbnB1dC5wdXNoS2V5cHJlc3Nlc1RvSGlzdG9yeSgpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1pbldwbSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICB3cG1BbmRSYXcud3BtIDwgY29uZmlnXzEuZGVmYXVsdC5taW5XcG1DdXN0b21TcGVlZCAmJlxuICAgICAgICBUZXN0V29yZHMud29yZHMuY3VycmVudEluZGV4ID4gMykge1xuICAgICAgICBpZiAodGltZXIgIT09IG51bGwpXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgICBTbG93VGltZXIuY2xlYXIoKTtcbiAgICAgICAgc2xvd1RpbWVyQ291bnQgPSAwO1xuICAgICAgICBUaW1lckV2ZW50LmRpc3BhdGNoKFwiZmFpbFwiLCBcIm1pbiB3cG1cIik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubWluQWNjID09PSBcImN1c3RvbVwiICYmXG4gICAgICAgIGFjYyA8IGNvbmZpZ18xLmRlZmF1bHQubWluQWNjQ3VzdG9tICYmXG4gICAgICAgIFRlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXggPiAzKSB7XG4gICAgICAgIGlmICh0aW1lciAhPT0gbnVsbClcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgICAgIFNsb3dUaW1lci5jbGVhcigpO1xuICAgICAgICBzbG93VGltZXJDb3VudCA9IDA7XG4gICAgICAgIFRpbWVyRXZlbnQuZGlzcGF0Y2goXCJmYWlsXCIsIFwibWluIGFjY3VyYWN5XCIpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICBjb25zb2xlLnRpbWVFbmQoXCJmYWlsIGNvbmRpdGlvbnNcIik7XG59XG5mdW5jdGlvbiBjaGVja0lmVGltZUlzVXAoKSB7XG4gICAgaWYgKHRpbWVyRGVidWcpXG4gICAgICAgIGNvbnNvbGUudGltZShcInRpbWVzIHVwIGNoZWNrXCIpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ0aW1lXCIgfHxcbiAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJiBDdXN0b21UZXh0LmlzVGltZVJhbmRvbSkpIHtcbiAgICAgICAgaWYgKChUaW1lLmdldCgpID49IGNvbmZpZ18xLmRlZmF1bHQudGltZSAmJlxuICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC50aW1lICE9PSAwICYmXG4gICAgICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwidGltZVwiKSB8fFxuICAgICAgICAgICAgKFRpbWUuZ2V0KCkgPj0gQ3VzdG9tVGV4dC50aW1lICYmXG4gICAgICAgICAgICAgICAgQ3VzdG9tVGV4dC50aW1lICE9PSAwICYmXG4gICAgICAgICAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiKSkge1xuICAgICAgICAgICAgLy90aW1lcyB1cFxuICAgICAgICAgICAgaWYgKHRpbWVyICE9PSBudWxsKVxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgICAgICAgICBDYXJldC5oaWRlKCk7XG4gICAgICAgICAgICBUZXN0SW5wdXQuaW5wdXQucHVzaEhpc3RvcnkoKTtcbiAgICAgICAgICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQucHVzaEhpc3RvcnkoKTtcbiAgICAgICAgICAgIFNsb3dUaW1lci5jbGVhcigpO1xuICAgICAgICAgICAgc2xvd1RpbWVyQ291bnQgPSAwO1xuICAgICAgICAgICAgVGltZXJFdmVudC5kaXNwYXRjaChcImZpbmlzaFwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgY29uc29sZS50aW1lRW5kKFwidGltZXMgdXAgY2hlY2tcIik7XG59XG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmxldCB0aW1lclN0YXRzID0gW107XG5mdW5jdGlvbiBnZXRUaW1lclN0YXRzKCkge1xuICAgIHJldHVybiB0aW1lclN0YXRzO1xufVxuZXhwb3J0cy5nZXRUaW1lclN0YXRzID0gZ2V0VGltZXJTdGF0cztcbmZ1bmN0aW9uIHRpbWVyU3RlcCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAodGltZXJEZWJ1ZylcbiAgICAgICAgICAgIGNvbnNvbGUudGltZShcInRpbWVyIHN0ZXAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cIik7XG4gICAgICAgIFRpbWUuaW5jcmVtZW50KCk7XG4gICAgICAgIHByZW1pZCgpO1xuICAgICAgICB1cGRhdGVUaW1lcigpO1xuICAgICAgICBjb25zdCB3cG1BbmRSYXcgPSBjYWxjdWxhdGVXcG1SYXcoKTtcbiAgICAgICAgY29uc3QgYWNjID0gY2FsY3VsYXRlQWNjKCk7XG4gICAgICAgIG1vbmtleSh3cG1BbmRSYXcpO1xuICAgICAgICBsYXlvdXRmbHVpZCgpO1xuICAgICAgICBjaGVja0lmRmFpbGVkKHdwbUFuZFJhdywgYWNjKTtcbiAgICAgICAgY2hlY2tJZlRpbWVJc1VwKCk7XG4gICAgICAgIGlmICh0aW1lckRlYnVnKVxuICAgICAgICAgICAgY29uc29sZS50aW1lRW5kKFwidGltZXIgc3RlcCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVwiKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHN0YXJ0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIFNsb3dUaW1lci5jbGVhcigpO1xuICAgICAgICBzbG93VGltZXJDb3VudCA9IDA7XG4gICAgICAgIHRpbWVyU3RhdHMgPSBbXTtcbiAgICAgICAgZXhwZWN0ZWQgPSBUZXN0U3RhdHMuc3RhcnQgKyBpbnRlcnZhbDtcbiAgICAgICAgKGZ1bmN0aW9uIGxvb3AoKSB7XG4gICAgICAgICAgICBjb25zdCBkZWxheSA9IGV4cGVjdGVkIC0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgICAgICB0aW1lclN0YXRzLnB1c2goe1xuICAgICAgICAgICAgICAgIGRhdGVOb3c6IERhdGUubm93KCksXG4gICAgICAgICAgICAgICAgbm93OiBwZXJmb3JtYW5jZS5ub3coKSxcbiAgICAgICAgICAgICAgICBleHBlY3RlZDogZXhwZWN0ZWQsXG4gICAgICAgICAgICAgICAgbmV4dERlbGF5OiBkZWxheSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwidGltZVwiICYmIGNvbmZpZ18xLmRlZmF1bHQudGltZSA8IDEzMCAmJiBjb25maWdfMS5kZWZhdWx0LnRpbWUgPiAwKSB8fFxuICAgICAgICAgICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIiAmJiBjb25maWdfMS5kZWZhdWx0LndvcmRzIDwgMjUwICYmIGNvbmZpZ18xLmRlZmF1bHQud29yZHMgPiAwKSkge1xuICAgICAgICAgICAgICAgIGlmIChkZWxheSA8IGludGVydmFsIC8gMikge1xuICAgICAgICAgICAgICAgICAgICAvL3Nsb3cgdGltZXJcbiAgICAgICAgICAgICAgICAgICAgU2xvd1RpbWVyLnNldCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZGVsYXkgPCBpbnRlcnZhbCAvIDEwKSB7XG4gICAgICAgICAgICAgICAgICAgIHNsb3dUaW1lckNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzbG93VGltZXJDb3VudCA+IDUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2xvdyB0aW1lclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluY2x1ZGVzKFwiRWRnXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoJ1RoaXMgYmFkIHBlcmZvcm1hbmNlIGNvdWxkIGJlIGNhdXNlZCBieSBcImVmZmljaWVuY3kgbW9kZVwiIG9uIE1pY3Jvc29mdCBFZGdlLicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoXCJTdG9wcGluZyB0aGUgdGVzdCBkdWUgdG8gYmFkIHBlcmZvcm1hbmNlLiBUaGlzIHdvdWxkIGNhdXNlIHRlc3QgY2FsY3VsYXRpb25zIHRvIGJlIGluY29ycmVjdC4gSWYgdGhpcyBoYXBwZW5zIGEgbG90LCBwbGVhc2UgcmVwb3J0IHRoaXMuXCIsIC0xKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFRpbWVyRXZlbnQuZGlzcGF0Y2goXCJmYWlsXCIsIFwic2xvdyB0aW1lclwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLy8gdGltZSsrO1xuICAgICAgICAgICAgICAgIGlmICghVGVzdEFjdGl2ZS5nZXQoKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGltZXIgIT09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgICAgICAgICAgICAgICBTbG93VGltZXIuY2xlYXIoKTtcbiAgICAgICAgICAgICAgICAgICAgc2xvd1RpbWVyQ291bnQgPSAwO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRpbWVyU3RlcCgpO1xuICAgICAgICAgICAgICAgIGV4cGVjdGVkICs9IGludGVydmFsO1xuICAgICAgICAgICAgICAgIGxvb3AoKTtcbiAgICAgICAgICAgIH0sIGRlbGF5KTtcbiAgICAgICAgfSkoKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc3RhcnQgPSBzdGFydDtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGlnaGxpZ2h0QmFkV29yZCA9IGV4cG9ydHMuYXBwbHlCdXJzdEhlYXRtYXAgPSBleHBvcnRzLnRvZ2dsZVJlc3VsdFdvcmRzID0gZXhwb3J0cy5hcnJhbmdlQ2hhcmFjdGVyc0xlZnRUb1JpZ2h0ID0gZXhwb3J0cy5hcnJhbmdlQ2hhcmFjdGVyc1JpZ2h0VG9MZWZ0ID0gZXhwb3J0cy5saW5lSnVtcCA9IGV4cG9ydHMudXBkYXRlV29yZEVsZW1lbnQgPSBleHBvcnRzLnNjcmVlbnNob3QgPSBleHBvcnRzLmNvbG9yZnVsID0gZXhwb3J0cy5mbGlwQ29sb3JzID0gZXhwb3J0cy5hZGRXb3JkID0gZXhwb3J0cy5zaG93V29yZHMgPSBleHBvcnRzLnVwZGF0ZUFjdGl2ZUVsZW1lbnQgPSBleHBvcnRzLmZvY3VzV29yZHMgPSBleHBvcnRzLnJlc2V0ID0gZXhwb3J0cy5zZXRSZXN1bHRDYWxjdWxhdGluZyA9IGV4cG9ydHMuc2V0VGVzdFJlc3RhcnRpbmcgPSBleHBvcnRzLnNldEFjdGl2ZVdvcmRUb3AgPSBleHBvcnRzLnNldEN1cnJlbnRXb3JkRWxlbWVudEluZGV4ID0gZXhwb3J0cy5zZXRSZXN1bHRWaXNpYmxlID0gZXhwb3J0cy5yZXN1bHRDYWxjdWxhdGluZyA9IGV4cG9ydHMuY3VycmVudFRlc3RMaW5lID0gZXhwb3J0cy5saW5lVHJhbnNpdGlvbiA9IGV4cG9ydHMudGVzdFJlc3RhcnRpbmdQcm9taXNlID0gZXhwb3J0cy50ZXN0UmVzdGFydGluZyA9IGV4cG9ydHMuYWN0aXZlV29yZFRvcCA9IGV4cG9ydHMucmVzdWx0VmlzaWJsZSA9IGV4cG9ydHMuY3VycmVudFdvcmRFbGVtZW50SW5kZXggPSB2b2lkIDA7XG5jb25zdCBOb3RpZmljYXRpb25zID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IFRoZW1lQ29sb3JzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy90aGVtZS1jb2xvcnNcIikpO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSksIFVwZGF0ZUNvbmZpZyA9IGNvbmZpZ18xO1xuY29uc3QgREIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2RiXCIpKTtcbmNvbnN0IFRlc3RXb3JkcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LXdvcmRzXCIpKTtcbmNvbnN0IFRlc3RJbnB1dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LWlucHV0XCIpKTtcbmNvbnN0IEN1c3RvbVRleHQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY3VzdG9tLXRleHRcIikpO1xuY29uc3QgQ2FyZXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY2FyZXRcIikpO1xuY29uc3QgT3V0T2ZGb2N1cyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9vdXQtb2YtZm9jdXNcIikpO1xuY29uc3QgUmVwbGF5ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3JlcGxheVwiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IFNsb3dUaW1lciA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vc3RhdGVzL3Nsb3ctdGltZXJcIikpO1xuY29uc3QgQ29uZmlnRXZlbnQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL29ic2VydmFibGVzL2NvbmZpZy1ldmVudFwiKSk7XG5jb25zdCBmb3JtYXRfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiZGF0ZS1mbnMvZm9ybWF0XCIpKTtcbmNvbnN0IGZpcmViYXNlXzEgPSByZXF1aXJlKFwiLi4vZmlyZWJhc2VcIik7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5LCBldmVudFZhbHVlKSA9PiB7XG4gICAgaWYgKGV2ZW50VmFsdWUgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgZXZlbnRWYWx1ZSAhPT0gXCJib29sZWFuXCIpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiZmxpcFRlc3RDb2xvcnNcIilcbiAgICAgICAgZmxpcENvbG9ycyhldmVudFZhbHVlKTtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwiY29sb3JmdWxNb2RlXCIpXG4gICAgICAgIGNvbG9yZnVsKGV2ZW50VmFsdWUpO1xuICAgIGlmIChldmVudEtleSA9PT0gXCJoaWdobGlnaHRNb2RlXCIpXG4gICAgICAgIHVwZGF0ZVdvcmRFbGVtZW50KGV2ZW50VmFsdWUpO1xuICAgIGlmIChldmVudEtleSA9PT0gXCJidXJzdEhlYXRtYXBcIilcbiAgICAgICAgYXBwbHlCdXJzdEhlYXRtYXAoKTtcbn0pO1xuZXhwb3J0cy5jdXJyZW50V29yZEVsZW1lbnRJbmRleCA9IDA7XG5leHBvcnRzLnJlc3VsdFZpc2libGUgPSBmYWxzZTtcbmV4cG9ydHMuYWN0aXZlV29yZFRvcCA9IDA7XG5leHBvcnRzLnRlc3RSZXN0YXJ0aW5nID0gZmFsc2U7XG5leHBvcnRzLmxpbmVUcmFuc2l0aW9uID0gZmFsc2U7XG5leHBvcnRzLmN1cnJlbnRUZXN0TGluZSA9IDA7XG5leHBvcnRzLnJlc3VsdENhbGN1bGF0aW5nID0gZmFsc2U7XG5mdW5jdGlvbiBzZXRSZXN1bHRWaXNpYmxlKHZhbCkge1xuICAgIGV4cG9ydHMucmVzdWx0VmlzaWJsZSA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0UmVzdWx0VmlzaWJsZSA9IHNldFJlc3VsdFZpc2libGU7XG5mdW5jdGlvbiBzZXRDdXJyZW50V29yZEVsZW1lbnRJbmRleCh2YWwpIHtcbiAgICBleHBvcnRzLmN1cnJlbnRXb3JkRWxlbWVudEluZGV4ID0gdmFsO1xufVxuZXhwb3J0cy5zZXRDdXJyZW50V29yZEVsZW1lbnRJbmRleCA9IHNldEN1cnJlbnRXb3JkRWxlbWVudEluZGV4O1xuZnVuY3Rpb24gc2V0QWN0aXZlV29yZFRvcCh2YWwpIHtcbiAgICBleHBvcnRzLmFjdGl2ZVdvcmRUb3AgPSB2YWw7XG59XG5leHBvcnRzLnNldEFjdGl2ZVdvcmRUb3AgPSBzZXRBY3RpdmVXb3JkVG9wO1xubGV0IHJlc3RhcnRpbmdSZXNvbHZlO1xuZnVuY3Rpb24gc2V0VGVzdFJlc3RhcnRpbmcodmFsKSB7XG4gICAgZXhwb3J0cy50ZXN0UmVzdGFydGluZyA9IHZhbDtcbiAgICBpZiAodmFsID09PSB0cnVlKSB7XG4gICAgICAgIGV4cG9ydHMudGVzdFJlc3RhcnRpbmdQcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgIHJlc3RhcnRpbmdSZXNvbHZlID0gcmVzb2x2ZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAocmVzdGFydGluZ1Jlc29sdmUpXG4gICAgICAgICAgICByZXN0YXJ0aW5nUmVzb2x2ZSgpO1xuICAgICAgICByZXN0YXJ0aW5nUmVzb2x2ZSA9IG51bGw7XG4gICAgfVxufVxuZXhwb3J0cy5zZXRUZXN0UmVzdGFydGluZyA9IHNldFRlc3RSZXN0YXJ0aW5nO1xuZnVuY3Rpb24gc2V0UmVzdWx0Q2FsY3VsYXRpbmcodmFsKSB7XG4gICAgZXhwb3J0cy5yZXN1bHRDYWxjdWxhdGluZyA9IHZhbDtcbn1cbmV4cG9ydHMuc2V0UmVzdWx0Q2FsY3VsYXRpbmcgPSBzZXRSZXN1bHRDYWxjdWxhdGluZztcbmZ1bmN0aW9uIHJlc2V0KCkge1xuICAgIGV4cG9ydHMuY3VycmVudFRlc3RMaW5lID0gMDtcbiAgICBleHBvcnRzLmN1cnJlbnRXb3JkRWxlbWVudEluZGV4ID0gMDtcbn1cbmV4cG9ydHMucmVzZXQgPSByZXNldDtcbmZ1bmN0aW9uIGZvY3VzV29yZHMoKSB7XG4gICAgaWYgKCEkKFwiI3dvcmRzV3JhcHBlclwiKS5oYXNDbGFzcyhcImhpZGRlblwiKSkge1xuICAgICAgICAkKFwiI3dvcmRzSW5wdXRcIikudHJpZ2dlcihcImZvY3VzXCIpO1xuICAgIH1cbn1cbmV4cG9ydHMuZm9jdXNXb3JkcyA9IGZvY3VzV29yZHM7XG5mdW5jdGlvbiB1cGRhdGVBY3RpdmVFbGVtZW50KGJhY2tzcGFjZSkge1xuICAgIGNvbnN0IGFjdGl2ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjd29yZHMgLmFjdGl2ZVwiKTtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIgJiYgYmFja3NwYWNlKSB7XG4gICAgICAgIGFjdGl2ZSA9PT0gbnVsbCB8fCBhY3RpdmUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFjdGl2ZS5yZW1vdmUoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoYWN0aXZlICE9PSBudWxsKSB7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmhpZ2hsaWdodE1vZGUgPT0gXCJ3b3JkXCIpIHtcbiAgICAgICAgICAgIGFjdGl2ZS5xdWVyeVNlbGVjdG9yQWxsKFwibGV0dGVyXCIpLmZvckVhY2goKGUpID0+IHtcbiAgICAgICAgICAgICAgICBlLmNsYXNzTGlzdC5yZW1vdmUoXCJjb3JyZWN0XCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgYWN0aXZlLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIik7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVdvcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiI3dvcmRzIC53b3JkXCIpW2V4cG9ydHMuY3VycmVudFdvcmRFbGVtZW50SW5kZXhdO1xuICAgICAgICBhY3RpdmVXb3JkLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG4gICAgICAgIGFjdGl2ZVdvcmQuY2xhc3NMaXN0LnJlbW92ZShcImVycm9yXCIpO1xuICAgICAgICBleHBvcnRzLmFjdGl2ZVdvcmRUb3AgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3dvcmRzIC5hY3RpdmVcIilcbiAgICAgICAgICAgIC5vZmZzZXRUb3A7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmhpZ2hsaWdodE1vZGUgPT0gXCJ3b3JkXCIpIHtcbiAgICAgICAgICAgIGFjdGl2ZVdvcmQucXVlcnlTZWxlY3RvckFsbChcImxldHRlclwiKS5mb3JFYWNoKChlKSA9PiB7XG4gICAgICAgICAgICAgICAgZS5jbGFzc0xpc3QuYWRkKFwiY29ycmVjdFwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlKSB7IH1cbn1cbmV4cG9ydHMudXBkYXRlQWN0aXZlRWxlbWVudCA9IHVwZGF0ZUFjdGl2ZUVsZW1lbnQ7XG5mdW5jdGlvbiBnZXRXb3JkSFRNTCh3b3JkKSB7XG4gICAgbGV0IG5ld2xpbmVhZnRlciA9IGZhbHNlO1xuICAgIGxldCByZXR2YWwgPSBgPGRpdiBjbGFzcz0nd29yZCc+YDtcbiAgICBmb3IgKGxldCBjID0gMDsgYyA8IHdvcmQubGVuZ3RoOyBjKyspIHtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcImFycm93c1wiKSB7XG4gICAgICAgICAgICBpZiAod29yZC5jaGFyQXQoYykgPT09IFwi4oaRXCIpIHtcbiAgICAgICAgICAgICAgICByZXR2YWwgKz0gYDxsZXR0ZXI+PGkgY2xhc3M9XCJmYXMgZmEtYXJyb3ctdXBcIj48L2k+PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh3b3JkLmNoYXJBdChjKSA9PT0gXCLihpNcIikge1xuICAgICAgICAgICAgICAgIHJldHZhbCArPSBgPGxldHRlcj48aSBjbGFzcz1cImZhcyBmYS1hcnJvdy1kb3duXCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAod29yZC5jaGFyQXQoYykgPT09IFwi4oaQXCIpIHtcbiAgICAgICAgICAgICAgICByZXR2YWwgKz0gYDxsZXR0ZXI+PGkgY2xhc3M9XCJmYXMgZmEtYXJyb3ctbGVmdFwiPjwvaT48L2xldHRlcj5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHdvcmQuY2hhckF0KGMpID09PSBcIuKGklwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dmFsICs9IGA8bGV0dGVyPjxpIGNsYXNzPVwiZmFzIGZhLWFycm93LXJpZ2h0XCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAod29yZC5jaGFyQXQoYykgPT09IFwiXFx0XCIpIHtcbiAgICAgICAgICAgIHJldHZhbCArPSBgPGxldHRlciBjbGFzcz0ndGFiQ2hhcic+PGkgY2xhc3M9XCJmYXMgZmEtbG9uZy1hcnJvdy1hbHQtcmlnaHRcIj48L2k+PC9sZXR0ZXI+YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh3b3JkLmNoYXJBdChjKSA9PT0gXCJcXG5cIikge1xuICAgICAgICAgICAgbmV3bGluZWFmdGVyID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHZhbCArPSBgPGxldHRlciBjbGFzcz0nbmxDaGFyJz48aSBjbGFzcz1cImZhcyBmYS1hbmdsZS1kb3duXCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR2YWwgKz0gXCI8bGV0dGVyPlwiICsgd29yZC5jaGFyQXQoYykgKyBcIjwvbGV0dGVyPlwiO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHZhbCArPSBcIjwvZGl2PlwiO1xuICAgIGlmIChuZXdsaW5lYWZ0ZXIpXG4gICAgICAgIHJldHZhbCArPSBcIjxkaXYgY2xhc3M9J25ld2xpbmUnPjwvZGl2PlwiO1xuICAgIHJldHVybiByZXR2YWw7XG59XG5mdW5jdGlvbiBzaG93V29yZHMoKSB7XG4gICAgJChcIiN3b3Jkc1wiKS5lbXB0eSgpO1xuICAgIGxldCB3b3Jkc0hUTUwgPSBcIlwiO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT09IFwiemVuXCIpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBUZXN0V29yZHMud29yZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHdvcmRzSFRNTCArPSBnZXRXb3JkSFRNTChUZXN0V29yZHMud29yZHMuZ2V0KGkpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgd29yZHNIVE1MID1cbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwid29yZFwiPndvcmQgaGVpZ2h0PC9kaXY+PGRpdiBjbGFzcz1cIndvcmQgYWN0aXZlXCI+PC9kaXY+JztcbiAgICB9XG4gICAgJChcIiN3b3Jkc1wiKS5odG1sKHdvcmRzSFRNTCk7XG4gICAgJChcIiN3b3Jkc1dyYXBwZXJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgY29uc3Qgd29yZEhlaWdodCA9ICgkKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIud29yZFwiKSkub3V0ZXJIZWlnaHQodHJ1ZSkpO1xuICAgIGNvbnN0IHdvcmRzSGVpZ2h0ID0gKCQoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN3b3Jkc1wiKSkub3V0ZXJIZWlnaHQodHJ1ZSkpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnNob3dBbGxMaW5lcyAmJlxuICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT0gXCJ0aW1lXCIgJiZcbiAgICAgICAgIShDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJiBDdXN0b21UZXh0LndvcmQgPT0gMCkgJiZcbiAgICAgICAgIUN1c3RvbVRleHQuaXNUaW1lUmFuZG9tKSB7XG4gICAgICAgICQoXCIjd29yZHNcIikuY3NzKFwiaGVpZ2h0XCIsIFwiYXV0b1wiKTtcbiAgICAgICAgJChcIiN3b3Jkc1dyYXBwZXJcIikuY3NzKFwiaGVpZ2h0XCIsIFwiYXV0b1wiKTtcbiAgICAgICAgbGV0IG5oID0gd29yZEhlaWdodCAqIDM7XG4gICAgICAgIGlmIChuaCA+IHdvcmRzSGVpZ2h0KSB7XG4gICAgICAgICAgICBuaCA9IHdvcmRzSGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgICQoXCIub3V0T2ZGb2N1c1dhcm5pbmdcIikuY3NzKFwibGluZS1oZWlnaHRcIiwgbmggKyBcInB4XCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiN3b3Jkc1wiKVxuICAgICAgICAgICAgLmNzcyhcImhlaWdodFwiLCB3b3JkSGVpZ2h0ICogNCArIFwicHhcIilcbiAgICAgICAgICAgIC5jc3MoXCJvdmVyZmxvd1wiLCBcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiN3b3Jkc1dyYXBwZXJcIilcbiAgICAgICAgICAgIC5jc3MoXCJoZWlnaHRcIiwgd29yZEhlaWdodCAqIDMgKyBcInB4XCIpXG4gICAgICAgICAgICAuY3NzKFwib3ZlcmZsb3dcIiwgXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIub3V0T2ZGb2N1c1dhcm5pbmdcIikuY3NzKFwibGluZS1oZWlnaHRcIiwgd29yZEhlaWdodCAqIDMgKyBcInB4XCIpO1xuICAgIH1cbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInplblwiKSB7XG4gICAgICAgICQoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi53b3JkXCIpKS5yZW1vdmUoKTtcbiAgICB9XG4gICAgdXBkYXRlQWN0aXZlRWxlbWVudCgpO1xuICAgIENhcmV0LnVwZGF0ZVBvc2l0aW9uKCk7XG59XG5leHBvcnRzLnNob3dXb3JkcyA9IHNob3dXb3JkcztcbmZ1bmN0aW9uIGFkZFdvcmQod29yZCkge1xuICAgICQoXCIjd29yZHNcIikuYXBwZW5kKGdldFdvcmRIVE1MKHdvcmQpKTtcbn1cbmV4cG9ydHMuYWRkV29yZCA9IGFkZFdvcmQ7XG5mdW5jdGlvbiBmbGlwQ29sb3JzKHRmKSB7XG4gICAgaWYgKHRmKSB7XG4gICAgICAgICQoXCIjd29yZHNcIikuYWRkQ2xhc3MoXCJmbGlwcGVkXCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcImZsaXBwZWRcIik7XG4gICAgfVxufVxuZXhwb3J0cy5mbGlwQ29sb3JzID0gZmxpcENvbG9ycztcbmZ1bmN0aW9uIGNvbG9yZnVsKHRjKSB7XG4gICAgaWYgKHRjKSB7XG4gICAgICAgICQoXCIjd29yZHNcIikuYWRkQ2xhc3MoXCJjb2xvcmZ1bE1vZGVcIik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiI3dvcmRzXCIpLnJlbW92ZUNsYXNzKFwiY29sb3JmdWxNb2RlXCIpO1xuICAgIH1cbn1cbmV4cG9ydHMuY29sb3JmdWwgPSBjb2xvcmZ1bDtcbmZ1bmN0aW9uIHNjcmVlbnNob3QoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgbGV0IHJldmVhbFJlcGxheSA9IGZhbHNlO1xuICAgICAgICBmdW5jdGlvbiByZXZlcnRTY3JlZW5zaG90KCkge1xuICAgICAgICAgICAgJChcIiNub3RpZmljYXRpb25DZW50ZXJcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiI2NvbW1hbmRMaW5lTW9iaWxlQnV0dG9uXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlVGVzdCAuc3NXYXRlcm1hcmtcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0IC5zc1dhdGVybWFya1wiKS50ZXh0KFwibW9ua2V5dHlwZS5jb21cIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2VUZXN0IC5idXR0b25zXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgaWYgKHJldmVhbFJlcGxheSlcbiAgICAgICAgICAgICAgICAkKFwiI3Jlc3VsdFJlcGxheVwiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIGlmIChmaXJlYmFzZV8xLkF1dGguY3VycmVudFVzZXIgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICQoXCIucGFnZVRlc3QgLmxvZ2luVGlwXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghJChcIiNyZXN1bHRSZXBsYXlcIikuaGFzQ2xhc3MoXCJoaWRkZW5cIikpIHtcbiAgICAgICAgICAgIHJldmVhbFJlcGxheSA9IHRydWU7XG4gICAgICAgICAgICBSZXBsYXkucGF1c2VSZXBsYXkoKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkYXRlTm93ID0gbmV3IERhdGUoRGF0ZS5ub3coKSk7XG4gICAgICAgICQoXCIjcmVzdWx0UmVwbGF5XCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAkKFwiLnBhZ2VUZXN0IC5zc1dhdGVybWFya1wiKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIi5wYWdlVGVzdCAuc3NXYXRlcm1hcmtcIikudGV4dCgoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZU5vdywgXCJkZCBNTU0geXl5eSBISDptbVwiKSArIFwiIHwgbW9ua2V5dHlwZS5jb20gXCIpO1xuICAgICAgICBpZiAoZmlyZWJhc2VfMS5BdXRoLmN1cnJlbnRVc2VyICE9IG51bGwpIHtcbiAgICAgICAgICAgICQoXCIucGFnZVRlc3QgLnNzV2F0ZXJtYXJrXCIpLnRleHQoREIuZ2V0U25hcHNob3QoKS5uYW1lICtcbiAgICAgICAgICAgICAgICBcIiB8IFwiICtcbiAgICAgICAgICAgICAgICAoMCwgZm9ybWF0XzEuZGVmYXVsdCkoZGF0ZU5vdywgXCJkZCBNTU0geXl5eSBISDptbVwiKSArXG4gICAgICAgICAgICAgICAgXCIgfCBtb25rZXl0eXBlLmNvbSAgXCIpO1xuICAgICAgICB9XG4gICAgICAgICQoXCIucGFnZVRlc3QgLmJ1dHRvbnNcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIGNvbnN0IHNyYyA9ICQoXCIjbWlkZGxlXCIpO1xuICAgICAgICBjb25zdCBzb3VyY2VYID0gc3JjLnBvc2l0aW9uKCkubGVmdDsgLypYIHBvc2l0aW9uIGZyb20gZGl2I3RhcmdldCovXG4gICAgICAgIGNvbnN0IHNvdXJjZVkgPSBzcmMucG9zaXRpb24oKS50b3A7IC8qWSBwb3NpdGlvbiBmcm9tIGRpdiN0YXJnZXQqL1xuICAgICAgICBjb25zdCBzb3VyY2VXaWR0aCA9IChzcmMub3V0ZXJXaWR0aCh0cnVlKSk7IC8qY2xpZW50V2lkdGgvb2Zmc2V0V2lkdGggZnJvbSBkaXYjdGFyZ2V0Ki9cbiAgICAgICAgY29uc3Qgc291cmNlSGVpZ2h0ID0gKHNyYy5vdXRlckhlaWdodCh0cnVlKSk7IC8qY2xpZW50SGVpZ2h0L29mZnNldEhlaWdodCBmcm9tIGRpdiN0YXJnZXQqL1xuICAgICAgICAkKFwiI25vdGlmaWNhdGlvbkNlbnRlclwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIiNjb21tYW5kTGluZU1vYmlsZUJ1dHRvblwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgJChcIi5wYWdlVGVzdCAubG9naW5UaXBcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBwYWRkaW5nWCA9IDUwO1xuICAgICAgICAgICAgY29uc3QgcGFkZGluZ1kgPSAyNTtcbiAgICAgICAgICAgIGh0bWwyY2FudmFzKGRvY3VtZW50LmJvZHksIHtcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHlpZWxkIFRoZW1lQ29sb3JzLmdldChcImJnXCIpLFxuICAgICAgICAgICAgICAgIHdpZHRoOiBzb3VyY2VXaWR0aCArIHBhZGRpbmdYICogMixcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHNvdXJjZUhlaWdodCArIHBhZGRpbmdZICogMixcbiAgICAgICAgICAgICAgICB4OiBzb3VyY2VYIC0gcGFkZGluZ1gsXG4gICAgICAgICAgICAgICAgeTogc291cmNlWSAtIHBhZGRpbmdZLFxuICAgICAgICAgICAgfSkudGhlbigoY2FudmFzKSA9PiB7XG4gICAgICAgICAgICAgICAgY2FudmFzLnRvQmxvYigoYmxvYikgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2IgPT09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwiZmlyZWZveFwiKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbihVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXZlcnRTY3JlZW5zaG90KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC53cml0ZShbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBDbGlwYm9hcmRJdGVtKE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwgYmxvYi50eXBlLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYmxvYixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ29waWVkIHRvIGNsaXBib2FyZFwiLCAxLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2ZXJ0U2NyZWVuc2hvdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVycm9yIHNhdmluZyBpbWFnZSB0byBjbGlwYm9hcmQ6IFwiICsgZS5tZXNzYWdlLCAtMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXZlcnRTY3JlZW5zaG90KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkVycm9yIGNyZWF0aW5nIGltYWdlOiBcIiArIGUubWVzc2FnZSwgLTEpO1xuICAgICAgICAgICAgcmV2ZXJ0U2NyZWVuc2hvdCgpO1xuICAgICAgICB9XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgcmV2ZXJ0U2NyZWVuc2hvdCgpO1xuICAgICAgICB9LCAzMDAwKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc2NyZWVuc2hvdCA9IHNjcmVlbnNob3Q7XG5mdW5jdGlvbiB1cGRhdGVXb3JkRWxlbWVudChzaG93RXJyb3IgPSAhY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUpIHtcbiAgICBjb25zdCBpbnB1dCA9IFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50O1xuICAgIGNvbnN0IHdvcmRBdEluZGV4ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN3b3JkcyAud29yZC5hY3RpdmVcIik7XG4gICAgY29uc3QgY3VycmVudFdvcmQgPSBUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpO1xuICAgIGlmICghY3VycmVudFdvcmQgJiYgY29uZmlnXzEuZGVmYXVsdC5tb2RlICE9PSBcInplblwiKVxuICAgICAgICByZXR1cm47XG4gICAgbGV0IHJldCA9IFwiXCI7XG4gICAgbGV0IG5ld2xpbmVhZnRlciA9IGZhbHNlO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiemVuXCIpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBUZXN0SW5wdXQuaW5wdXQuY3VycmVudC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKFRlc3RJbnB1dC5pbnB1dC5jdXJyZW50W2ldID09PSBcIlxcdFwiKSB7XG4gICAgICAgICAgICAgICAgcmV0ICs9IGA8bGV0dGVyIGNsYXNzPSd0YWJDaGFyIGNvcnJlY3QnIHN0eWxlPVwib3BhY2l0eTogMFwiPjxpIGNsYXNzPVwiZmFzIGZhLWxvbmctYXJyb3ctYWx0LXJpZ2h0XCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChUZXN0SW5wdXQuaW5wdXQuY3VycmVudFtpXSA9PT0gXCJcXG5cIikge1xuICAgICAgICAgICAgICAgIG5ld2xpbmVhZnRlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmV0ICs9IGA8bGV0dGVyIGNsYXNzPSdubENoYXIgY29ycmVjdCcgc3R5bGU9XCJvcGFjaXR5OiAwXCI+PGkgY2xhc3M9XCJmYXMgZmEtYW5nbGUtZG93blwiPjwvaT48L2xldHRlcj5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0ICs9IGA8bGV0dGVyIGNsYXNzPVwiY29ycmVjdFwiPiR7VGVzdElucHV0LmlucHV0LmN1cnJlbnRbaV19PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgbGV0IGNvcnJlY3RTb0ZhciA9IGZhbHNlO1xuICAgICAgICAvLyBzbGljZSBlYXJsaWVyIGlmIGlucHV0IGhhcyB0cmFpbGluZyBjb21wb3NlIGNoYXJhY3RlcnNcbiAgICAgICAgY29uc3QgaW5wdXRXaXRob3V0Q29tcG9zZUxlbmd0aCA9IE1pc2MudHJhaWxpbmdDb21wb3NlQ2hhcnMudGVzdChpbnB1dClcbiAgICAgICAgICAgID8gaW5wdXQuc2VhcmNoKE1pc2MudHJhaWxpbmdDb21wb3NlQ2hhcnMpXG4gICAgICAgICAgICA6IGlucHV0Lmxlbmd0aDtcbiAgICAgICAgaWYgKGlucHV0LnNlYXJjaChNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzKSA8IGN1cnJlbnRXb3JkLmxlbmd0aCAmJlxuICAgICAgICAgICAgY3VycmVudFdvcmQuc2xpY2UoMCwgaW5wdXRXaXRob3V0Q29tcG9zZUxlbmd0aCkgPT09XG4gICAgICAgICAgICAgICAgaW5wdXQuc2xpY2UoMCwgaW5wdXRXaXRob3V0Q29tcG9zZUxlbmd0aCkpIHtcbiAgICAgICAgICAgIGNvcnJlY3RTb0ZhciA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHdvcmRIaWdobGlnaHRDbGFzc1N0cmluZyA9IGNvcnJlY3RTb0ZhciA/IFwiY29ycmVjdFwiIDogXCJpbmNvcnJlY3RcIjtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuYmxpbmRNb2RlKSB7XG4gICAgICAgICAgICB3b3JkSGlnaGxpZ2h0Q2xhc3NTdHJpbmcgPSBcImNvcnJlY3RcIjtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlucHV0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBjaGFyQ29ycmVjdCA9IGN1cnJlbnRXb3JkW2ldID09IGlucHV0W2ldO1xuICAgICAgICAgICAgbGV0IGNvcnJlY3RDbGFzcyA9IFwiY29ycmVjdFwiO1xuICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQuaGlnaGxpZ2h0TW9kZSA9PSBcIm9mZlwiKSB7XG4gICAgICAgICAgICAgICAgY29ycmVjdENsYXNzID0gXCJcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBjdXJyZW50TGV0dGVyID0gY3VycmVudFdvcmRbaV07XG4gICAgICAgICAgICBsZXQgdGFiQ2hhciA9IFwiXCI7XG4gICAgICAgICAgICBsZXQgbmxDaGFyID0gXCJcIjtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50TGV0dGVyID09PSBcIuKGkVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMZXR0ZXIgPSBgPGkgY2xhc3M9XCJmYXMgZmEtYXJyb3ctdXBcIj48L2k+YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRMZXR0ZXIgPT09IFwi4oaTXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudExldHRlciA9IGA8aSBjbGFzcz1cImZhcyBmYS1hcnJvdy1kb3duXCI+PC9pPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50TGV0dGVyID09PSBcIuKGkFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMZXR0ZXIgPSBgPGkgY2xhc3M9XCJmYXMgZmEtYXJyb3ctbGVmdFwiPjwvaT5gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudExldHRlciA9PT0gXCLihpJcIikge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGV0dGVyID0gYDxpIGNsYXNzPVwiZmFzIGZhLWFycm93LXJpZ2h0XCI+PC9pPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudExldHRlciA9PT0gXCJcXHRcIikge1xuICAgICAgICAgICAgICAgIHRhYkNoYXIgPSBcInRhYkNoYXJcIjtcbiAgICAgICAgICAgICAgICBjdXJyZW50TGV0dGVyID0gYDxpIGNsYXNzPVwiZmFzIGZhLWxvbmctYXJyb3ctYWx0LXJpZ2h0XCI+PC9pPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50TGV0dGVyID09PSBcIlxcblwiKSB7XG4gICAgICAgICAgICAgICAgbmxDaGFyID0gXCJubENoYXJcIjtcbiAgICAgICAgICAgICAgICBjdXJyZW50TGV0dGVyID0gYDxpIGNsYXNzPVwiZmFzIGZhLWFuZ2xlLWRvd25cIj48L2k+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzLnRlc3QoaW5wdXQpICYmXG4gICAgICAgICAgICAgICAgaSA+IGlucHV0LnNlYXJjaChNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzKSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNoYXJDb3JyZWN0KSB7XG4gICAgICAgICAgICAgICAgcmV0ICs9IGA8bGV0dGVyIGNsYXNzPVwiJHtjb25maWdfMS5kZWZhdWx0LmhpZ2hsaWdodE1vZGUgPT0gXCJ3b3JkXCJcbiAgICAgICAgICAgICAgICAgICAgPyB3b3JkSGlnaGxpZ2h0Q2xhc3NTdHJpbmdcbiAgICAgICAgICAgICAgICAgICAgOiBjb3JyZWN0Q2xhc3N9ICR7dGFiQ2hhcn0ke25sQ2hhcn1cIj4ke2N1cnJlbnRMZXR0ZXJ9PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRMZXR0ZXIgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgICAgICAgIE1pc2MudHJhaWxpbmdDb21wb3NlQ2hhcnMudGVzdChpbnB1dCkgJiZcbiAgICAgICAgICAgICAgICBpID09PSBpbnB1dC5zZWFyY2goTWlzYy50cmFpbGluZ0NvbXBvc2VDaGFycykpIHtcbiAgICAgICAgICAgICAgICByZXQgKz0gYDxsZXR0ZXIgY2xhc3M9XCIke2NvbmZpZ18xLmRlZmF1bHQuaGlnaGxpZ2h0TW9kZSA9PSBcIndvcmRcIiA/IHdvcmRIaWdobGlnaHRDbGFzc1N0cmluZyA6IFwiXCJ9IGRlYWRcIj4ke2N1cnJlbnRMZXR0ZXJ9PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFzaG93RXJyb3IpIHtcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudExldHRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldCArPSBgPGxldHRlciBjbGFzcz1cIiR7Y29uZmlnXzEuZGVmYXVsdC5oaWdobGlnaHRNb2RlID09IFwid29yZFwiXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHdvcmRIaWdobGlnaHRDbGFzc1N0cmluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgOiBjb3JyZWN0Q2xhc3N9ICR7dGFiQ2hhcn0ke25sQ2hhcn1cIj4ke2N1cnJlbnRMZXR0ZXJ9PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50TGV0dGVyID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuaGlkZUV4dHJhTGV0dGVycykge1xuICAgICAgICAgICAgICAgICAgICBsZXQgbGV0dGVyID0gaW5wdXRbaV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChsZXR0ZXIgPT0gXCIgXCIgfHwgbGV0dGVyID09IFwiXFx0XCIgfHwgbGV0dGVyID09IFwiXFxuXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldHRlciA9IFwiX1wiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldCArPSBgPGxldHRlciBjbGFzcz1cIiR7Y29uZmlnXzEuZGVmYXVsdC5oaWdobGlnaHRNb2RlID09IFwid29yZFwiXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHdvcmRIaWdobGlnaHRDbGFzc1N0cmluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgOiBcImluY29ycmVjdFwifSBleHRyYSAke3RhYkNoYXJ9JHtubENoYXJ9XCI+JHtsZXR0ZXJ9PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXQgKz1cbiAgICAgICAgICAgICAgICAgICAgYDxsZXR0ZXIgY2xhc3M9XCIke2NvbmZpZ18xLmRlZmF1bHQuaGlnaGxpZ2h0TW9kZSA9PSBcIndvcmRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgPyB3b3JkSGlnaGxpZ2h0Q2xhc3NTdHJpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgIDogXCJpbmNvcnJlY3RcIn0gJHt0YWJDaGFyfSR7bmxDaGFyfVwiPmAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQuaW5kaWNhdGVUeXBvcyA9PT0gXCJyZXBsYWNlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IGlucHV0W2ldID09IFwiIFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gXCJfXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBpbnB1dFtpXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogY3VycmVudExldHRlcikgK1xuICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQuaW5kaWNhdGVUeXBvcyA9PT0gXCJiZWxvd1wiID8gYDxoaW50PiR7aW5wdXRbaV19PC9oaW50PmAgOiBcIlwiKSArXG4gICAgICAgICAgICAgICAgICAgICAgICBcIjwvbGV0dGVyPlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlucHV0V2l0aFNpbmdsZUNvbXBvc2VMZW5ndGggPSBNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzLnRlc3QoaW5wdXQpXG4gICAgICAgICAgICA/IGlucHV0LnNlYXJjaChNaXNjLnRyYWlsaW5nQ29tcG9zZUNoYXJzKSArIDFcbiAgICAgICAgICAgIDogaW5wdXQubGVuZ3RoO1xuICAgICAgICBpZiAoaW5wdXRXaXRoU2luZ2xlQ29tcG9zZUxlbmd0aCA8IGN1cnJlbnRXb3JkLmxlbmd0aCkge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IGlucHV0V2l0aFNpbmdsZUNvbXBvc2VMZW5ndGg7IGkgPCBjdXJyZW50V29yZC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmZ1bmJveCA9PT0gXCJhcnJvd3NcIikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFdvcmRbaV0gPT09IFwi4oaRXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldCArPSBgPGxldHRlcj48aSBjbGFzcz1cImZhcyBmYS1hcnJvdy11cFwiPjwvaT48L2xldHRlcj5gO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50V29yZFtpXSA9PT0gXCLihpNcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0ICs9IGA8bGV0dGVyPjxpIGNsYXNzPVwiZmFzIGZhLWFycm93LWRvd25cIj48L2k+PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFdvcmRbaV0gPT09IFwi4oaQXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldCArPSBgPGxldHRlcj48aSBjbGFzcz1cImZhcyBmYS1hcnJvdy1sZWZ0XCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRXb3JkW2ldID09PSBcIuKGklwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXQgKz0gYDxsZXR0ZXI+PGkgY2xhc3M9XCJmYXMgZmEtYXJyb3ctcmlnaHRcIj48L2k+PC9sZXR0ZXI+YDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50V29yZFtpXSA9PT0gXCJcXHRcIikge1xuICAgICAgICAgICAgICAgICAgICByZXQgKz0gYDxsZXR0ZXIgY2xhc3M9J3RhYkNoYXInPjxpIGNsYXNzPVwiZmFzIGZhLWxvbmctYXJyb3ctYWx0LXJpZ2h0XCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRXb3JkW2ldID09PSBcIlxcblwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldCArPSBgPGxldHRlciBjbGFzcz0nbmxDaGFyJz48aSBjbGFzcz1cImZhcyBmYS1hbmdsZS1kb3duXCI+PC9pPjwvbGV0dGVyPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXQgKz1cbiAgICAgICAgICAgICAgICAgICAgICAgIGA8bGV0dGVyIGNsYXNzPVwiJHtjb25maWdfMS5kZWZhdWx0LmhpZ2hsaWdodE1vZGUgPT0gXCJ3b3JkXCIgPyB3b3JkSGlnaGxpZ2h0Q2xhc3NTdHJpbmcgOiBcIlwifVwiPmAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRXb3JkW2ldICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIjwvbGV0dGVyPlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5oaWdobGlnaHRNb2RlID09PSBcImxldHRlclwiICYmIGNvbmZpZ18xLmRlZmF1bHQuaGlkZUV4dHJhTGV0dGVycykge1xuICAgICAgICAgICAgaWYgKGlucHV0Lmxlbmd0aCA+IGN1cnJlbnRXb3JkLmxlbmd0aCAmJiAhY29uZmlnXzEuZGVmYXVsdC5ibGluZE1vZGUpIHtcbiAgICAgICAgICAgICAgICAkKHdvcmRBdEluZGV4KS5hZGRDbGFzcyhcImVycm9yXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaW5wdXQubGVuZ3RoID09IGN1cnJlbnRXb3JkLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICQod29yZEF0SW5kZXgpLnJlbW92ZUNsYXNzKFwiZXJyb3JcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgd29yZEF0SW5kZXguaW5uZXJIVE1MID0gcmV0O1xuICAgIGlmIChuZXdsaW5lYWZ0ZXIpXG4gICAgICAgICQoXCIjd29yZHNcIikuYXBwZW5kKFwiPGRpdiBjbGFzcz0nbmV3bGluZSc+PC9kaXY+XCIpO1xufVxuZXhwb3J0cy51cGRhdGVXb3JkRWxlbWVudCA9IHVwZGF0ZVdvcmRFbGVtZW50O1xuZnVuY3Rpb24gbGluZUp1bXAoY3VycmVudFRvcCkge1xuICAgIHZhciBfYTtcbiAgICAvL2xhc3Qgd29yZCBvZiB0aGUgbGluZVxuICAgIGlmIChleHBvcnRzLmN1cnJlbnRUZXN0TGluZSA+IDApIHtcbiAgICAgICAgY29uc3QgaGlkZUJvdW5kID0gY3VycmVudFRvcDtcbiAgICAgICAgY29uc3QgdG9IaWRlID0gW107XG4gICAgICAgIGNvbnN0IHdvcmRFbGVtZW50cyA9ICQoXCIjd29yZHMgLndvcmRcIik7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXhwb3J0cy5jdXJyZW50V29yZEVsZW1lbnRJbmRleDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoJCh3b3JkRWxlbWVudHNbaV0pLmhhc0NsYXNzKFwiaGlkZGVuXCIpKVxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgY29uc3QgZm9yV29yZFRvcCA9IE1hdGguZmxvb3Iod29yZEVsZW1lbnRzW2ldLm9mZnNldFRvcCk7XG4gICAgICAgICAgICBpZiAoZm9yV29yZFRvcCA8IGhpZGVCb3VuZCAtIDEwKSB7XG4gICAgICAgICAgICAgICAgdG9IaWRlLnB1c2goJCgkKFwiI3dvcmRzIC53b3JkXCIpW2ldKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgd29yZEhlaWdodCA9ICgkKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIud29yZFwiKSkub3V0ZXJIZWlnaHQodHJ1ZSkpO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zbW9vdGhMaW5lU2Nyb2xsICYmIHRvSGlkZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBleHBvcnRzLmxpbmVUcmFuc2l0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgICQoXCIjd29yZHNcIikucHJlcGVuZChgPGRpdiBjbGFzcz1cInNtb290aFNjcm9sbGVyXCIgc3R5bGU9XCJwb3NpdGlvbjogZml4ZWQ7aGVpZ2h0OiR7d29yZEhlaWdodH1weDt3aWR0aDoxMDAlXCI+PC9kaXY+YCk7XG4gICAgICAgICAgICAkKFwiI3dvcmRzIC5zbW9vdGhTY3JvbGxlclwiKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDAsXG4gICAgICAgICAgICB9LCBTbG93VGltZXIuZ2V0KCkgPyAwIDogMTI1LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgJChcIiN3b3JkcyAuc21vb3RoU2Nyb2xsZXJcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICQoXCIjcGFjZUNhcmV0XCIpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIHRvcDogKChfYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcGFjZUNhcmV0XCIpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Eub2Zmc2V0VG9wKSAtXG4gICAgICAgICAgICAgICAgICAgIHdvcmRIZWlnaHQsXG4gICAgICAgICAgICB9LCBTbG93VGltZXIuZ2V0KCkgPyAwIDogMTI1KTtcbiAgICAgICAgICAgICQoXCIjd29yZHNcIikuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgbWFyZ2luVG9wOiBgLSR7d29yZEhlaWdodH1weGAsXG4gICAgICAgICAgICB9LCBTbG93VGltZXIuZ2V0KCkgPyAwIDogMTI1LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZXhwb3J0cy5hY3RpdmVXb3JkVG9wID0gKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjd29yZHMgLmFjdGl2ZVwiKSkub2Zmc2V0VG9wO1xuICAgICAgICAgICAgICAgIGV4cG9ydHMuY3VycmVudFdvcmRFbGVtZW50SW5kZXggLT0gdG9IaWRlLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBleHBvcnRzLmxpbmVUcmFuc2l0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdG9IaWRlLmZvckVhY2goKGVsKSA9PiBlbC5yZW1vdmUoKSk7XG4gICAgICAgICAgICAgICAgJChcIiN3b3Jkc1wiKS5jc3MoXCJtYXJnaW5Ub3BcIiwgXCIwXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0b0hpZGUuZm9yRWFjaCgoZWwpID0+IGVsLnJlbW92ZSgpKTtcbiAgICAgICAgICAgIGV4cG9ydHMuY3VycmVudFdvcmRFbGVtZW50SW5kZXggLT0gdG9IaWRlLmxlbmd0aDtcbiAgICAgICAgICAgICQoXCIjcGFjZUNhcmV0XCIpLmNzcyh7XG4gICAgICAgICAgICAgICAgdG9wOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BhY2VDYXJldFwiKS5vZmZzZXRUb3AgLVxuICAgICAgICAgICAgICAgICAgICB3b3JkSGVpZ2h0LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZXhwb3J0cy5jdXJyZW50VGVzdExpbmUrKztcbn1cbmV4cG9ydHMubGluZUp1bXAgPSBsaW5lSnVtcDtcbmZ1bmN0aW9uIGFycmFuZ2VDaGFyYWN0ZXJzUmlnaHRUb0xlZnQoKSB7XG4gICAgJChcIiN3b3Jkc1wiKS5hZGRDbGFzcyhcInJpZ2h0VG9MZWZ0VGVzdFwiKTtcbiAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeSAud29yZHNcIikuYWRkQ2xhc3MoXCJyaWdodFRvTGVmdFRlc3RcIik7XG4gICAgJChcIiNyZXN1bHRSZXBsYXkgLndvcmRzXCIpLmFkZENsYXNzKFwicmlnaHRUb0xlZnRUZXN0XCIpO1xufVxuZXhwb3J0cy5hcnJhbmdlQ2hhcmFjdGVyc1JpZ2h0VG9MZWZ0ID0gYXJyYW5nZUNoYXJhY3RlcnNSaWdodFRvTGVmdDtcbmZ1bmN0aW9uIGFycmFuZ2VDaGFyYWN0ZXJzTGVmdFRvUmlnaHQoKSB7XG4gICAgJChcIiN3b3Jkc1wiKS5yZW1vdmVDbGFzcyhcInJpZ2h0VG9MZWZ0VGVzdFwiKTtcbiAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeSAud29yZHNcIikucmVtb3ZlQ2xhc3MoXCJyaWdodFRvTGVmdFRlc3RcIik7XG4gICAgJChcIiNyZXN1bHRSZXBsYXkgLndvcmRzXCIpLnJlbW92ZUNsYXNzKFwicmlnaHRUb0xlZnRUZXN0XCIpO1xufVxuZXhwb3J0cy5hcnJhbmdlQ2hhcmFjdGVyc0xlZnRUb1JpZ2h0ID0gYXJyYW5nZUNoYXJhY3RlcnNMZWZ0VG9SaWdodDtcbmZ1bmN0aW9uIGxvYWRXb3Jkc0hpc3RvcnkoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLndvcmRzXCIpLmVtcHR5KCk7XG4gICAgICAgIGxldCB3b3Jkc0hUTUwgPSBcIlwiO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aCArIDI7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBUZXN0SW5wdXQuaW5wdXQuZ2V0SGlzdG9yeShpKTtcbiAgICAgICAgICAgIGNvbnN0IHdvcmQgPSBUZXN0V29yZHMud29yZHMuZ2V0KGkpO1xuICAgICAgICAgICAgbGV0IHdvcmRFbCA9IFwiXCI7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGlmIChpbnB1dCA9PT0gXCJcIilcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZW1wdHkgaW5wdXQgd29yZFwiKTtcbiAgICAgICAgICAgICAgICBpZiAoVGVzdElucHV0LmNvcnJlY3RlZC5nZXRIaXN0b3J5KGkpICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgICAgICAgICAgVGVzdElucHV0LmNvcnJlY3RlZC5nZXRIaXN0b3J5KGkpICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHdvcmRFbCA9IGA8ZGl2IGNsYXNzPSd3b3JkJyBidXJzdD1cIiR7VGVzdElucHV0LmJ1cnN0SGlzdG9yeVtpXX1cIiBpbnB1dD1cIiR7VGVzdElucHV0LmNvcnJlY3RlZFxuICAgICAgICAgICAgICAgICAgICAgICAgLmdldEhpc3RvcnkoaSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cIi9nLCBcIiZxdW90O1wiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyAvZywgXCJfXCIpfVwiPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB3b3JkRWwgPSBgPGRpdiBjbGFzcz0nd29yZCcgYnVyc3Q9XCIke1Rlc3RJbnB1dC5idXJzdEhpc3RvcnlbaV19XCIgaW5wdXQ9XCIke2lucHV0LnJlcGxhY2UoL1wiL2csIFwiJnF1b3Q7XCIpLnJlcGxhY2UoLyAvZywgXCJfXCIpfVwiPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpID09PSBUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vbGFzdCB3b3JkXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmRzdGF0cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Q6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmNvcnJlY3Q6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtaXNzZWQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxlbmd0aCA9IGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiID8gaW5wdXQubGVuZ3RoIDogd29yZC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgbGVuZ3RoOyBjKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjIDwgaW5wdXQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9vbiBjaGFyIHRoYXQgc3RpbGwgaGFzIGEgd29yZCBsaXN0IHBhaXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIgfHwgaW5wdXRbY10gPT0gd29yZFtjXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3Jkc3RhdHMuY29ycmVjdCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29yZHN0YXRzLmluY29ycmVjdCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vb24gY2hhciB0aGF0IGlzIGV4dHJhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd29yZHN0YXRzLm1pc3NlZCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh3b3Jkc3RhdHMuaW5jb3JyZWN0ICE9PSAwIHx8IGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT0gXCJ6ZW5cIiAmJiBpbnB1dCAhPT0gd29yZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRFbCA9IGA8ZGl2IGNsYXNzPSd3b3JkIGVycm9yJyBidXJzdD1cIiR7VGVzdElucHV0LmJ1cnN0SGlzdG9yeVtpXX1cIiBpbnB1dD1cIiR7aW5wdXQucmVwbGFjZSgvXCIvZywgXCImcXVvdDtcIikucmVwbGFjZSgvIC9nLCBcIl9cIil9XCI+YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSAhPSBcInplblwiICYmIGlucHV0ICE9PSB3b3JkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JkRWwgPSBgPGRpdiBjbGFzcz0nd29yZCBlcnJvcicgYnVyc3Q9XCIke1Rlc3RJbnB1dC5idXJzdEhpc3RvcnlbaV19XCIgaW5wdXQ9XCIke2lucHV0LnJlcGxhY2UoL1wiL2csIFwiJnF1b3Q7XCIpLnJlcGxhY2UoLyAvZywgXCJfXCIpfVwiPmA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IGxvb3A7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PSBcInplblwiIHx8IGlucHV0Lmxlbmd0aCA+IHdvcmQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vaW5wdXQgaXMgbG9uZ2VyIC0gZXh0cmEgY2hhcmFjdGVycyBwb3NzaWJsZSAobG9vcCBvdmVyIGlucHV0KVxuICAgICAgICAgICAgICAgICAgICBsb29wID0gaW5wdXQubGVuZ3RoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy9pbnB1dCBpcyBzaG9ydGVyIG9yIGVxdWFsIChsb29wIG92ZXIgd29yZCBsaXN0KVxuICAgICAgICAgICAgICAgICAgICBsb29wID0gd29yZC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgbG9vcDsgYysrKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBjb3JyZWN0ZWRDaGFyO1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdGVkQ2hhciA9IFRlc3RJbnB1dC5jb3JyZWN0ZWQuZ2V0SGlzdG9yeShpKVtjXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdGVkQ2hhciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsZXQgZXh0cmFDb3JyZWN0ZWQgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYyArIDEgPT09IGxvb3AgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIFRlc3RJbnB1dC5jb3JyZWN0ZWQuZ2V0SGlzdG9yeShpKSAhPT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBUZXN0SW5wdXQuY29ycmVjdGVkLmdldEhpc3RvcnkoaSkubGVuZ3RoID4gaW5wdXQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHRyYUNvcnJlY3RlZCA9IFwiZXh0cmFDb3JyZWN0ZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIgfHwgd29yZFtjXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIgfHwgaW5wdXRbY10gPT09IHdvcmRbY10pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29ycmVjdGVkQ2hhciA9PT0gaW5wdXRbY10gfHwgY29ycmVjdGVkQ2hhciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRFbCArPSBgPGxldHRlciBjbGFzcz1cImNvcnJlY3QgJHtleHRyYUNvcnJlY3RlZH1cIj4ke2lucHV0W2NdfTwvbGV0dGVyPmA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JkRWwgKz1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA8bGV0dGVyIGNsYXNzPVwiY29ycmVjdGVkICR7ZXh0cmFDb3JyZWN0ZWR9XCI+YCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRbY10gK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiPC9sZXR0ZXI+XCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0W2NdID09PSBUZXN0SW5wdXQuaW5wdXQuY3VycmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JkRWwgKz1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA8bGV0dGVyIGNsYXNzPSdjb3JyZWN0ICR7ZXh0cmFDb3JyZWN0ZWR9Jz5gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JkW2NdICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIjwvbGV0dGVyPlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpbnB1dFtjXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRFbCArPSBcIjxsZXR0ZXI+XCIgKyB3b3JkW2NdICsgXCI8L2xldHRlcj5cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRFbCArPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYDxsZXR0ZXIgY2xhc3M9XCJpbmNvcnJlY3QgJHtleHRyYUNvcnJlY3RlZH1cIj5gICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JkW2NdICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIjwvbGV0dGVyPlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRFbCArPSAnPGxldHRlciBjbGFzcz1cImluY29ycmVjdCBleHRyYVwiPicgKyBpbnB1dFtjXSArIFwiPC9sZXR0ZXI+XCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgd29yZEVsICs9IFwiPC9kaXY+XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHdvcmRFbCA9IFwiPGRpdiBjbGFzcz0nd29yZCc+XCI7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgd29yZC5sZW5ndGg7IGMrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgd29yZEVsICs9IFwiPGxldHRlcj5cIiArIHdvcmRbY10gKyBcIjwvbGV0dGVyPlwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHdvcmRFbCArPSBcIjwvZGl2PlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoX2EpIHsgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd29yZHNIVE1MICs9IHdvcmRFbDtcbiAgICAgICAgfVxuICAgICAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeSAud29yZHNcIikuaHRtbCh3b3Jkc0hUTUwpO1xuICAgICAgICAkKFwiI3Nob3dXb3JkSGlzdG9yeUJ1dHRvblwiKS5hZGRDbGFzcyhcImxvYWRlZFwiKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG59XG5mdW5jdGlvbiB0b2dnbGVSZXN1bHRXb3JkcygpIHtcbiAgICBpZiAoZXhwb3J0cy5yZXN1bHRWaXNpYmxlKSB7XG4gICAgICAgIGlmICgkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeVwiKS5zdG9wKHRydWUsIHRydWUpLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICAgICAvL3Nob3dcbiAgICAgICAgICAgIGlmICghJChcIiNzaG93V29yZEhpc3RvcnlCdXR0b25cIikuaGFzQ2xhc3MoXCJsb2FkZWRcIikpIHtcbiAgICAgICAgICAgICAgICAkKFwiI3dvcmRzXCIpLmh0bWwoYDxkaXYgY2xhc3M9XCJwcmVsb2FkZXJcIj48aSBjbGFzcz1cImZhcyBmYS1mdyBmYS1zcGluIGZhLWNpcmNsZS1ub3RjaFwiPjwvaT48L2Rpdj5gKTtcbiAgICAgICAgICAgICAgICBsb2FkV29yZHNIaXN0b3J5KCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmJ1cnN0SGVhdG1hcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwbHlCdXJzdEhlYXRtYXAoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeVwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zbGlkZURvd24oMjUwLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5idXJzdEhlYXRtYXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBseUJ1cnN0SGVhdG1hcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LmJ1cnN0SGVhdG1hcCkge1xuICAgICAgICAgICAgICAgICAgICBhcHBseUJ1cnN0SGVhdG1hcCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeVwiKVxuICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgICAgICAgICAgLmNzcyhcImRpc3BsYXlcIiwgXCJub25lXCIpXG4gICAgICAgICAgICAgICAgICAgIC5zbGlkZURvd24oMjUwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vaGlkZVxuICAgICAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnlcIikuc2xpZGVVcCgyNTAsICgpID0+IHtcbiAgICAgICAgICAgICAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeVwiKS5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy50b2dnbGVSZXN1bHRXb3JkcyA9IHRvZ2dsZVJlc3VsdFdvcmRzO1xuZnVuY3Rpb24gYXBwbHlCdXJzdEhlYXRtYXAoKSB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5idXJzdEhlYXRtYXApIHtcbiAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLmhlYXRtYXBMZWdlbmRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgIGxldCBidXJzdGxpc3QgPSBbLi4uVGVzdElucHV0LmJ1cnN0SGlzdG9yeV07XG4gICAgICAgIGJ1cnN0bGlzdCA9IGJ1cnN0bGlzdC5maWx0ZXIoKHgpID0+IHggIT09IEluZmluaXR5KTtcbiAgICAgICAgYnVyc3RsaXN0ID0gYnVyc3RsaXN0LmZpbHRlcigoeCkgPT4geCA8IDM1MCk7XG4gICAgICAgIGlmICgoKF9hID0gVGVzdElucHV0LmlucHV0LmdldEhpc3RvcnkoVGVzdElucHV0LmlucHV0LmdldEhpc3RvcnkoKS5sZW5ndGggLSAxKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkgIT09ICgoX2IgPSBUZXN0V29yZHMud29yZHMuZ2V0Q3VycmVudCgpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGVuZ3RoKSkge1xuICAgICAgICAgICAgYnVyc3RsaXN0ID0gYnVyc3RsaXN0LnNwbGljZSgwLCBidXJzdGxpc3QubGVuZ3RoIC0gMSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbWVkaWFuID0gTWlzYy5tZWRpYW4oYnVyc3RsaXN0KTtcbiAgICAgICAgY29uc3QgYWRhdG0gPSBbXTtcbiAgICAgICAgYnVyc3RsaXN0LmZvckVhY2goKGJ1cnN0KSA9PiB7XG4gICAgICAgICAgICBhZGF0bS5wdXNoKE1hdGguYWJzKG1lZGlhbiAtIGJ1cnN0KSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBzdGVwID0gTWlzYy5tZWFuKGFkYXRtKTtcbiAgICAgICAgY29uc3Qgc3RlcHMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsOiAwLFxuICAgICAgICAgICAgICAgIGNsYXNzOiBcImhlYXRtYXAtMFwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWw6IG1lZGlhbiAtIHN0ZXAgKiAxLjUsXG4gICAgICAgICAgICAgICAgY2xhc3M6IFwiaGVhdG1hcC0xXCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhbDogbWVkaWFuIC0gc3RlcCAqIDAuNSxcbiAgICAgICAgICAgICAgICBjbGFzczogXCJoZWF0bWFwLTJcIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsOiBtZWRpYW4gKyBzdGVwICogMC41LFxuICAgICAgICAgICAgICAgIGNsYXNzOiBcImhlYXRtYXAtM1wiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWw6IG1lZGlhbiArIHN0ZXAgKiAxLjUsXG4gICAgICAgICAgICAgICAgY2xhc3M6IFwiaGVhdG1hcC00XCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICBdO1xuICAgICAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeSAud29yZHMgLndvcmRcIikuZWFjaCgoXywgd29yZCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgd29yZEJ1cnN0VmFsID0gcGFyc2VJbnQoJCh3b3JkKS5hdHRyKFwiYnVyc3RcIikpO1xuICAgICAgICAgICAgbGV0IGNscyA9IFwiXCI7XG4gICAgICAgICAgICBzdGVwcy5mb3JFYWNoKChzdGVwKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHdvcmRCdXJzdFZhbCA+IHN0ZXAudmFsKVxuICAgICAgICAgICAgICAgICAgICBjbHMgPSBzdGVwLmNsYXNzO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkKHdvcmQpLmFkZENsYXNzKGNscyk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLmhlYXRtYXBMZWdlbmRcIikuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICQoXCIjcmVzdWx0V29yZHNIaXN0b3J5IC53b3JkcyAud29yZFwiKS5yZW1vdmVDbGFzcyhcImhlYXRtYXAtMFwiKTtcbiAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLndvcmRzIC53b3JkXCIpLnJlbW92ZUNsYXNzKFwiaGVhdG1hcC0xXCIpO1xuICAgICAgICAkKFwiI3Jlc3VsdFdvcmRzSGlzdG9yeSAud29yZHMgLndvcmRcIikucmVtb3ZlQ2xhc3MoXCJoZWF0bWFwLTJcIik7XG4gICAgICAgICQoXCIjcmVzdWx0V29yZHNIaXN0b3J5IC53b3JkcyAud29yZFwiKS5yZW1vdmVDbGFzcyhcImhlYXRtYXAtM1wiKTtcbiAgICAgICAgJChcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLndvcmRzIC53b3JkXCIpLnJlbW92ZUNsYXNzKFwiaGVhdG1hcC00XCIpO1xuICAgIH1cbn1cbmV4cG9ydHMuYXBwbHlCdXJzdEhlYXRtYXAgPSBhcHBseUJ1cnN0SGVhdG1hcDtcbmZ1bmN0aW9uIGhpZ2hsaWdodEJhZFdvcmQoaW5kZXgsIHNob3dFcnJvcikge1xuICAgIGlmICghc2hvd0Vycm9yKVxuICAgICAgICByZXR1cm47XG4gICAgJCgkKFwiI3dvcmRzIC53b3JkXCIpW2luZGV4XSkuYWRkQ2xhc3MoXCJlcnJvclwiKTtcbn1cbmV4cG9ydHMuaGlnaGxpZ2h0QmFkV29yZCA9IGhpZ2hsaWdodEJhZFdvcmQ7XG4kKGRvY3VtZW50LmJvZHkpLm9uKFwiY2xpY2tcIiwgXCIjc2F2ZVNjcmVlbnNob3RCdXR0b25cIiwgKCkgPT4ge1xuICAgIHNjcmVlbnNob3QoKTtcbn0pO1xuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiN0ZXN0TW9kZXNOb3RpY2UgLnRleHQtYnV0dG9uLmJsaW5kXCIsICgpID0+IHtcbiAgICBVcGRhdGVDb25maWcuc2V0QmxpbmRNb2RlKCFjb25maWdfMS5kZWZhdWx0LmJsaW5kTW9kZSk7XG59KTtcbiQoXCIucGFnZVRlc3QgI2NvcHlXb3Jkc0xpc3RCdXR0b25cIikub24oXCJjbGlja1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB0cnkge1xuICAgICAgICBsZXQgd29yZHM7XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIikge1xuICAgICAgICAgICAgd29yZHMgPSBUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5qb2luKFwiIFwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHdvcmRzID0gVGVzdFdvcmRzLndvcmRzLmdldCgpXG4gICAgICAgICAgICAgICAgLnNsaWNlKDAsIFRlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aClcbiAgICAgICAgICAgICAgICAuam9pbihcIiBcIik7XG4gICAgICAgIH1cbiAgICAgICAgeWllbGQgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQod29yZHMpO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkNvcGllZCB0byBjbGlwYm9hcmRcIiwgMCwgMik7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiQ291bGQgbm90IGNvcHkgdG8gY2xpcGJvYXJkOiBcIiArIGUsIC0xKTtcbiAgICB9XG59KSk7XG4kKFwiLnBhZ2VUZXN0ICN0b2dnbGVCdXJzdEhlYXRtYXBcIikub24oXCJjbGlja1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBVcGRhdGVDb25maWcuc2V0QnVyc3RIZWF0bWFwKCFjb25maWdfMS5kZWZhdWx0LmJ1cnN0SGVhdG1hcCk7XG59KSk7XG4kKGRvY3VtZW50KS5vbihcIm1vdXNlbGVhdmVcIiwgXCIjcmVzdWx0V29yZHNIaXN0b3J5IC53b3JkcyAud29yZFwiLCAoKSA9PiB7XG4gICAgJChcIi53b3JkSW5wdXRBZnRlclwiKS5yZW1vdmUoKTtcbn0pO1xuJChcIiN3cG1DaGFydFwiKS5vbihcIm1vdXNlbGVhdmVcIiwgKCkgPT4ge1xuICAgICQoXCIud29yZElucHV0QWZ0ZXJcIikucmVtb3ZlKCk7XG59KTtcbiQoZG9jdW1lbnQpLm9uKFwibW91c2VlbnRlclwiLCBcIiNyZXN1bHRXb3Jkc0hpc3RvcnkgLndvcmRzIC53b3JkXCIsIChlKSA9PiB7XG4gICAgaWYgKGV4cG9ydHMucmVzdWx0VmlzaWJsZSkge1xuICAgICAgICBjb25zdCBpbnB1dCA9ICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiaW5wdXRcIik7XG4gICAgICAgIGNvbnN0IGJ1cnN0ID0gcGFyc2VJbnQoJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoXCJidXJzdFwiKSk7XG4gICAgICAgIGlmIChpbnB1dCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICQoZS5jdXJyZW50VGFyZ2V0KS5hcHBlbmQoYDxkaXYgY2xhc3M9XCJ3b3JkSW5wdXRBZnRlclwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0ZXh0XCI+XG4gICAgICAgICAgJHtpbnB1dFxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXHQvZywgXCJfXCIpXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcbi9nLCBcIl9cIilcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgvPC9nLCBcIiZsdFwiKVxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8+L2csIFwiJmd0XCIpfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJzcGVlZFwiPlxuICAgICAgICAgICR7TWF0aC5yb3VuZChjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0gPyBidXJzdCAqIDUgOiBidXJzdCl9JHtjb25maWdfMS5kZWZhdWx0LmFsd2F5c1Nob3dDUE0gPyBcImNwbVwiIDogXCJ3cG1cIn1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5gKTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuJChcIiN3b3Jkc0lucHV0XCIpLm9uKFwiZm9jdXNcIiwgKCkgPT4ge1xuICAgIGlmICghZXhwb3J0cy5yZXN1bHRWaXNpYmxlICYmIGNvbmZpZ18xLmRlZmF1bHQuc2hvd091dE9mRm9jdXNXYXJuaW5nKSB7XG4gICAgICAgIE91dE9mRm9jdXMuaGlkZSgpO1xuICAgIH1cbiAgICBDYXJldC5zaG93KCk7XG59KTtcbiQoXCIjd29yZHNJbnB1dFwiKS5vbihcImZvY3Vzb3V0XCIsICgpID0+IHtcbiAgICBpZiAoIWV4cG9ydHMucmVzdWx0VmlzaWJsZSAmJiBjb25maWdfMS5kZWZhdWx0LnNob3dPdXRPZkZvY3VzV2FybmluZykge1xuICAgICAgICBPdXRPZkZvY3VzLnNob3coKTtcbiAgICB9XG4gICAgQ2FyZXQuaGlkZSgpO1xufSk7XG4kKGRvY3VtZW50KS5vbihcImtleXByZXNzXCIsIFwiI3Nob3dXb3JkSGlzdG9yeUJ1dHRvblwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgdG9nZ2xlUmVzdWx0V29yZHMoKTtcbiAgICB9XG59KTtcbiQoZG9jdW1lbnQuYm9keSkub24oXCJjbGlja1wiLCBcIiNzaG93V29yZEhpc3RvcnlCdXR0b25cIiwgKCkgPT4ge1xuICAgIHRvZ2dsZVJlc3VsdFdvcmRzKCk7XG59KTtcbiQoXCIjd29yZHNXcmFwcGVyXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGZvY3VzV29yZHMoKTtcbn0pO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnNldEhhc1RhYiA9IGV4cG9ydHMuc2V0UmFuZG9tUXVvdGUgPSBleHBvcnRzLnJhbmRvbVF1b3RlID0gZXhwb3J0cy5oYXNUYWIgPSBleHBvcnRzLndvcmRzID0gdm9pZCAwO1xuY2xhc3MgV29yZHMge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmxpc3QgPSBbXTtcbiAgICAgICAgdGhpcy5sZW5ndGggPSAwO1xuICAgICAgICB0aGlzLmN1cnJlbnRJbmRleCA9IDA7XG4gICAgfVxuICAgIGdldChpLCByYXcgPSBmYWxzZSkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBpZiAoaSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5saXN0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKHJhdykge1xuICAgICAgICAgICAgICAgIHJldHVybiAoX2IgPSAoX2EgPSB0aGlzLmxpc3RbaV0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZXBsYWNlKC9bLj8hXCI6XFwtLF0vZywgXCJcIikpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGlzdFtpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRDdXJyZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5saXN0W3RoaXMuY3VycmVudEluZGV4XTtcbiAgICB9XG4gICAgZ2V0TGFzdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdFt0aGlzLmxpc3QubGVuZ3RoIC0gMV07XG4gICAgfVxuICAgIHB1c2god29yZCkge1xuICAgICAgICB0aGlzLmxpc3QucHVzaCh3b3JkKTtcbiAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLmxpc3QubGVuZ3RoO1xuICAgIH1cbiAgICByZXNldCgpIHtcbiAgICAgICAgdGhpcy5saXN0ID0gW107XG4gICAgICAgIHRoaXMuY3VycmVudEluZGV4ID0gMDtcbiAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLmxpc3QubGVuZ3RoO1xuICAgIH1cbiAgICByZXNldEN1cnJlbnRJbmRleCgpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50SW5kZXggPSAwO1xuICAgIH1cbiAgICBkZWNyZWFzZUN1cnJlbnRJbmRleCgpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50SW5kZXgtLTtcbiAgICB9XG4gICAgaW5jcmVhc2VDdXJyZW50SW5kZXgoKSB7XG4gICAgICAgIHRoaXMuY3VycmVudEluZGV4Kys7XG4gICAgfVxuICAgIGNsZWFuKCkge1xuICAgICAgICBmb3IgKGNvbnN0IHMgb2YgdGhpcy5saXN0KSB7XG4gICAgICAgICAgICBpZiAoLyArLy50ZXN0KHMpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaWQgPSB0aGlzLmxpc3QuaW5kZXhPZihzKTtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wTGlzdCA9IHMuc3BsaXQoXCIgXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMubGlzdC5zcGxpY2UoaWQsIDEpO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGVtcExpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5saXN0LnNwbGljZShpZCArIGksIDAsIHRlbXBMaXN0W2ldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLndvcmRzID0gbmV3IFdvcmRzKCk7XG5leHBvcnRzLmhhc1RhYiA9IGZhbHNlO1xuZXhwb3J0cy5yYW5kb21RdW90ZSA9IG51bGw7XG5mdW5jdGlvbiBzZXRSYW5kb21RdW90ZShycSkge1xuICAgIGV4cG9ydHMucmFuZG9tUXVvdGUgPSBycTtcbn1cbmV4cG9ydHMuc2V0UmFuZG9tUXVvdGUgPSBzZXRSYW5kb21RdW90ZTtcbmZ1bmN0aW9uIHNldEhhc1RhYih0Zikge1xuICAgIGV4cG9ydHMuaGFzVGFiID0gdGY7XG59XG5leHBvcnRzLnNldEhhc1RhYiA9IHNldEhhc1RhYjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZVN0eWxlID0gZXhwb3J0cy51cGRhdGUgPSBleHBvcnRzLnJlc3RhcnQgPSBleHBvcnRzLmhpZGUgPSBleHBvcnRzLnNob3cgPSB2b2lkIDA7XG5jb25zdCBjb25maWdfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcbmNvbnN0IEN1c3RvbVRleHQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vY3VzdG9tLXRleHRcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBUZXN0V29yZHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC13b3Jkc1wiKSk7XG5jb25zdCBUZXN0SW5wdXQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC1pbnB1dFwiKSk7XG5jb25zdCBUaW1lID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9zdGF0ZXMvdGltZVwiKSk7XG5jb25zdCBTbG93VGltZXIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy9zbG93LXRpbWVyXCIpKTtcbmNvbnN0IFRlc3RBY3RpdmUgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL3N0YXRlcy90ZXN0LWFjdGl2ZVwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vb2JzZXJ2YWJsZXMvY29uZmlnLWV2ZW50XCIpKTtcbmZ1bmN0aW9uIHNob3coKSB7XG4gICAgY29uc3Qgb3AgPSBjb25maWdfMS5kZWZhdWx0LnNob3dUaW1lclByb2dyZXNzID8gY29uZmlnXzEuZGVmYXVsdC50aW1lck9wYWNpdHkgOiAwO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgIT0gXCJ6ZW5cIiAmJiBjb25maWdfMS5kZWZhdWx0LnRpbWVyU3R5bGUgPT09IFwiYmFyXCIpIHtcbiAgICAgICAgJChcIiN0aW1lcldyYXBwZXJcIikuc3RvcCh0cnVlLCB0cnVlKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKS5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IG9wLFxuICAgICAgICB9LCAxMjUpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LnRpbWVyU3R5bGUgPT09IFwidGV4dFwiKSB7XG4gICAgICAgICQoXCIjdGltZXJOdW1iZXJcIilcbiAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgIC5jc3MoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiBvcCxcbiAgICAgICAgfSwgMTI1KTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09IFwiemVuXCIgfHwgY29uZmlnXzEuZGVmYXVsdC50aW1lclN0eWxlID09PSBcIm1pbmlcIikge1xuICAgICAgICBpZiAob3AgPiAwKSB7XG4gICAgICAgICAgICAkKFwiI21pbmlUaW1lckFuZExpdmVXcG0gLnRpbWVcIilcbiAgICAgICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiBvcCxcbiAgICAgICAgICAgIH0sIDEyNSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLnNob3cgPSBzaG93O1xuZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAkKFwiI3RpbWVyV3JhcHBlclwiKS5zdG9wKHRydWUsIHRydWUpLmFuaW1hdGUoe1xuICAgICAgICBvcGFjaXR5OiAwLFxuICAgIH0sIDEyNSk7XG4gICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC50aW1lXCIpXG4gICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogMCxcbiAgICB9LCAxMjUsICgpID0+IHtcbiAgICAgICAgJChcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC50aW1lXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xuICAgICQoXCIjdGltZXJOdW1iZXJcIikuc3RvcCh0cnVlLCB0cnVlKS5hbmltYXRlKHtcbiAgICAgICAgb3BhY2l0eTogMCxcbiAgICB9LCAxMjUpO1xufVxuZXhwb3J0cy5oaWRlID0gaGlkZTtcbmZ1bmN0aW9uIHJlc3RhcnQoKSB7XG4gICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQudGltZXJTdHlsZSA9PT0gXCJiYXJcIikge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInRpbWVcIikge1xuICAgICAgICAgICAgJChcIiN0aW1lclwiKS5zdG9wKHRydWUsIHRydWUpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIHdpZHRoOiBcIjEwMHZ3XCIsXG4gICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIiB8fCBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIpIHtcbiAgICAgICAgICAgICQoXCIjdGltZXJcIikuc3RvcCh0cnVlLCB0cnVlKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICB3aWR0aDogXCIwdndcIixcbiAgICAgICAgICAgIH0sIDApO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5yZXN0YXJ0ID0gcmVzdGFydDtcbmNvbnN0IHRpbWVyTnVtYmVyRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjdGltZXJOdW1iZXJcIik7XG5jb25zdCBtaW5pVGltZXJOdW1iZXJFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtaW5pVGltZXJBbmRMaXZlV3BtIC50aW1lXCIpO1xuZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgIHZhciBfYSwgX2IsIF9jO1xuICAgIGNvbnN0IHRpbWUgPSBUaW1lLmdldCgpO1xuICAgIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwidGltZVwiIHx8XG4gICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgJiYgQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20pKSB7XG4gICAgICAgIGxldCBtYXh0aW1lID0gY29uZmlnXzEuZGVmYXVsdC50aW1lO1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiICYmIEN1c3RvbVRleHQuaXNUaW1lUmFuZG9tKSB7XG4gICAgICAgICAgICBtYXh0aW1lID0gQ3VzdG9tVGV4dC50aW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LnRpbWVyU3R5bGUgPT09IFwiYmFyXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IHBlcmNlbnQgPSAxMDAgLSAoKHRpbWUgKyAxKSAvIG1heHRpbWUpICogMTAwO1xuICAgICAgICAgICAgJChcIiN0aW1lclwiKVxuICAgICAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIHdpZHRoOiBwZXJjZW50ICsgXCJ2d1wiLFxuICAgICAgICAgICAgfSwgU2xvd1RpbWVyLmdldCgpID8gMCA6IDEwMDAsIFwibGluZWFyXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQudGltZXJTdHlsZSA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgICAgIGxldCBkaXNwbGF5VGltZSA9IE1pc2Muc2Vjb25kc1RvU3RyaW5nKG1heHRpbWUgLSB0aW1lKTtcbiAgICAgICAgICAgIGlmIChtYXh0aW1lID09PSAwKSB7XG4gICAgICAgICAgICAgICAgZGlzcGxheVRpbWUgPSBNaXNjLnNlY29uZHNUb1N0cmluZyh0aW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aW1lck51bWJlckVsZW1lbnQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aW1lck51bWJlckVsZW1lbnQuaW5uZXJIVE1MID0gXCI8ZGl2PlwiICsgZGlzcGxheVRpbWUgKyBcIjwvZGl2PlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQudGltZXJTdHlsZSA9PT0gXCJtaW5pXCIpIHtcbiAgICAgICAgICAgIGxldCBkaXNwbGF5VGltZSA9IE1pc2Muc2Vjb25kc1RvU3RyaW5nKG1heHRpbWUgLSB0aW1lKTtcbiAgICAgICAgICAgIGlmIChtYXh0aW1lID09PSAwKSB7XG4gICAgICAgICAgICAgICAgZGlzcGxheVRpbWUgPSBNaXNjLnNlY29uZHNUb1N0cmluZyh0aW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChtaW5pVGltZXJOdW1iZXJFbGVtZW50ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgbWluaVRpbWVyTnVtYmVyRWxlbWVudC5pbm5lckhUTUwgPSBkaXNwbGF5VGltZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwid29yZHNcIiB8fFxuICAgICAgICBjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgfHxcbiAgICAgICAgY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcInF1b3RlXCIpIHtcbiAgICAgICAgbGV0IG91dG9mID0gVGVzdFdvcmRzLndvcmRzLmxlbmd0aDtcbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJ3b3Jkc1wiKSB7XG4gICAgICAgICAgICBvdXRvZiA9IGNvbmZpZ18xLmRlZmF1bHQud29yZHM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICAgICAgaWYgKEN1c3RvbVRleHQuaXNXb3JkUmFuZG9tKSB7XG4gICAgICAgICAgICAgICAgb3V0b2YgPSBDdXN0b21UZXh0LndvcmQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBvdXRvZiA9IEN1c3RvbVRleHQudGV4dC5sZW5ndGg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgICAgICBvdXRvZiA9IChfYyA9IChfYiA9IChfYSA9IFRlc3RXb3Jkcy5yYW5kb21RdW90ZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRleHRTcGxpdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmxlbmd0aCkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC50aW1lclN0eWxlID09PSBcImJhclwiKSB7XG4gICAgICAgICAgICBjb25zdCBwZXJjZW50ID0gTWF0aC5mbG9vcigoKFRlc3RXb3Jkcy53b3Jkcy5jdXJyZW50SW5kZXggKyAxKSAvIG91dG9mKSAqIDEwMCk7XG4gICAgICAgICAgICAkKFwiI3RpbWVyXCIpXG4gICAgICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgd2lkdGg6IHBlcmNlbnQgKyBcInZ3XCIsXG4gICAgICAgICAgICB9LCBTbG93VGltZXIuZ2V0KCkgPyAwIDogMjUwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0LnRpbWVyU3R5bGUgPT09IFwidGV4dFwiKSB7XG4gICAgICAgICAgICBpZiAob3V0b2YgPT09IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodGltZXJOdW1iZXJFbGVtZW50ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVyTnVtYmVyRWxlbWVudC5pbm5lckhUTUwgPVxuICAgICAgICAgICAgICAgICAgICAgICAgXCI8ZGl2PlwiICsgYCR7VGVzdElucHV0LmlucHV0Lmhpc3RvcnkubGVuZ3RofWAgKyBcIjwvZGl2PlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aW1lck51bWJlckVsZW1lbnQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGltZXJOdW1iZXJFbGVtZW50LmlubmVySFRNTCA9XG4gICAgICAgICAgICAgICAgICAgICAgICBcIjxkaXY+XCIgKyBgJHtUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGh9LyR7b3V0b2Z9YCArIFwiPC9kaXY+XCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbmZpZ18xLmRlZmF1bHQudGltZXJTdHlsZSA9PT0gXCJtaW5pXCIpIHtcbiAgICAgICAgICAgIGlmIChjb25maWdfMS5kZWZhdWx0LndvcmRzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKG1pbmlUaW1lck51bWJlckVsZW1lbnQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgbWluaVRpbWVyTnVtYmVyRWxlbWVudC5pbm5lckhUTUwgPSBgJHtUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGh9YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAobWluaVRpbWVyTnVtYmVyRWxlbWVudCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBtaW5pVGltZXJOdW1iZXJFbGVtZW50LmlubmVySFRNTCA9IGAke1Rlc3RJbnB1dC5pbnB1dC5oaXN0b3J5Lmxlbmd0aH0vJHtvdXRvZn1gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT0gXCJ6ZW5cIikge1xuICAgICAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC50aW1lclN0eWxlID09PSBcInRleHRcIikge1xuICAgICAgICAgICAgaWYgKHRpbWVyTnVtYmVyRWxlbWVudCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRpbWVyTnVtYmVyRWxlbWVudC5pbm5lckhUTUwgPVxuICAgICAgICAgICAgICAgICAgICBcIjxkaXY+XCIgKyBgJHtUZXN0SW5wdXQuaW5wdXQuaGlzdG9yeS5sZW5ndGh9YCArIFwiPC9kaXY+XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAobWluaVRpbWVyTnVtYmVyRWxlbWVudCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIG1pbmlUaW1lck51bWJlckVsZW1lbnQuaW5uZXJIVE1MID0gYCR7VGVzdElucHV0LmlucHV0Lmhpc3RvcnkubGVuZ3RofWA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLnVwZGF0ZSA9IHVwZGF0ZTtcbmZ1bmN0aW9uIHVwZGF0ZVN0eWxlKCkge1xuICAgIGlmICghVGVzdEFjdGl2ZS5nZXQoKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGhpZGUoKTtcbiAgICB1cGRhdGUoKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgc2hvdygpO1xuICAgIH0sIDEyNSk7XG59XG5leHBvcnRzLnVwZGF0ZVN0eWxlID0gdXBkYXRlU3R5bGU7XG5Db25maWdFdmVudC5zdWJzY3JpYmUoKGV2ZW50S2V5LCBldmVudFZhbHVlKSA9PiB7XG4gICAgaWYgKGV2ZW50S2V5ID09PSBcInNob3dUaW1lclByb2dyZXNzXCIpIHtcbiAgICAgICAgaWYgKGV2ZW50VmFsdWUgPT09IHRydWUgJiYgVGVzdEFjdGl2ZS5nZXQoKSkge1xuICAgICAgICAgICAgc2hvdygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaGlkZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChldmVudEtleSA9PT0gXCJ0aW1lclN0eWxlXCIpXG4gICAgICAgIHVwZGF0ZVN0eWxlKCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmFkZEFsbEZyb21Ub2RheSA9IGV4cG9ydHMuZ2V0U3RyaW5nID0gZXhwb3J0cy5hZGRTZWNvbmRzID0gdm9pZCAwO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jb25zdCBEQiA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vZGJcIikpO1xubGV0IHNlY29uZHMgPSAwO1xubGV0IGFkZGVkQWxsVG9kYXkgPSBmYWxzZTtcbmxldCBkYXlUb2RheTtcbmZ1bmN0aW9uIGFkZFNlY29uZHMocykge1xuICAgIGlmIChhZGRlZEFsbFRvZGF5KSB7XG4gICAgICAgIGNvbnN0IG5vd0RhdGUgPSBuZXcgRGF0ZSgpLmdldERhdGUoKTtcbiAgICAgICAgaWYgKG5vd0RhdGUgPiBkYXlUb2RheSkge1xuICAgICAgICAgICAgc2Vjb25kcyA9IHM7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2Vjb25kcyArPSBzO1xufVxuZXhwb3J0cy5hZGRTZWNvbmRzID0gYWRkU2Vjb25kcztcbmZ1bmN0aW9uIGdldFN0cmluZygpIHtcbiAgICBjb25zdCBzZWNTdHJpbmcgPSBNaXNjLnNlY29uZHNUb1N0cmluZyhNYXRoLnJvdW5kKHNlY29uZHMpLCB0cnVlLCB0cnVlKTtcbiAgICByZXR1cm4gc2VjU3RyaW5nICsgKGFkZGVkQWxsVG9kYXkgPT09IHRydWUgPyBcIiB0b2RheVwiIDogXCIgc2Vzc2lvblwiKTtcbn1cbmV4cG9ydHMuZ2V0U3RyaW5nID0gZ2V0U3RyaW5nO1xuZnVuY3Rpb24gYWRkQWxsRnJvbVRvZGF5KCkge1xuICAgIGNvbnN0IHRvZGF5RGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgdG9kYXlEYXRlLnNldFNlY29uZHMoMCk7XG4gICAgdG9kYXlEYXRlLnNldE1pbnV0ZXMoMCk7XG4gICAgdG9kYXlEYXRlLnNldEhvdXJzKDApO1xuICAgIHRvZGF5RGF0ZS5zZXRNaWxsaXNlY29uZHMoMCk7XG4gICAgZGF5VG9kYXkgPSB0b2RheURhdGUuZ2V0RGF0ZSgpO1xuICAgIGNvbnN0IHRvZGF5RGF0ZU1TID0gdG9kYXlEYXRlLmdldFRpbWUoKTtcbiAgICBzZWNvbmRzID0gMDtcbiAgICBjb25zdCByZXN1bHRzID0gREIuZ2V0U25hcHNob3QoKS5yZXN1bHRzO1xuICAgIHJlc3VsdHMgPT09IG51bGwgfHwgcmVzdWx0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzdWx0cy5mb3JFYWNoKChyZXN1bHQpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0RGF0ZSA9IG5ldyBEYXRlKHJlc3VsdC50aW1lc3RhbXApO1xuICAgICAgICByZXN1bHREYXRlLnNldFNlY29uZHMoMCk7XG4gICAgICAgIHJlc3VsdERhdGUuc2V0TWludXRlcygwKTtcbiAgICAgICAgcmVzdWx0RGF0ZS5zZXRIb3VycygwKTtcbiAgICAgICAgcmVzdWx0RGF0ZS5zZXRNaWxsaXNlY29uZHMoMCk7XG4gICAgICAgIGNvbnN0IHJlc3VsdERhdGVNUyA9IHJlc3VsdERhdGUuZ2V0VGltZSgpO1xuICAgICAgICBpZiAocmVzdWx0RGF0ZU1TID49IHRvZGF5RGF0ZU1TKSB7XG4gICAgICAgICAgICBzZWNvbmRzICs9XG4gICAgICAgICAgICAgICAgcmVzdWx0LnRlc3REdXJhdGlvbiArIHJlc3VsdC5pbmNvbXBsZXRlVGVzdFNlY29uZHMgLSByZXN1bHQuYWZrRHVyYXRpb247XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBhZGRlZEFsbFRvZGF5ID0gdHJ1ZTtcbn1cbmV4cG9ydHMuYWRkQWxsRnJvbVRvZGF5ID0gYWRkQWxsRnJvbVRvZGF5O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5zcGVhayA9IGV4cG9ydHMuY2xlYXIgPSBleHBvcnRzLmluaXQgPSBleHBvcnRzLnNldExhbmd1YWdlID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5jb25zdCBNaXNjID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpKTtcbmNvbnN0IENvbmZpZ0V2ZW50ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xubGV0IHZvaWNlO1xuZnVuY3Rpb24gc2V0TGFuZ3VhZ2UobGFuZyA9IGNvbmZpZ18xLmRlZmF1bHQubGFuZ3VhZ2UpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAoIXZvaWNlKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBsYW5ndWFnZSA9IHlpZWxkIE1pc2MuZ2V0TGFuZ3VhZ2UobGFuZyk7XG4gICAgICAgIGNvbnN0IGJjcCA9IGxhbmd1YWdlLmJjcDQ3ID8gbGFuZ3VhZ2UuYmNwNDcgOiBcImVuLVVTXCI7XG4gICAgICAgIHZvaWNlLmxhbmcgPSBiY3A7XG4gICAgfSk7XG59XG5leHBvcnRzLnNldExhbmd1YWdlID0gc2V0TGFuZ3VhZ2U7XG5mdW5jdGlvbiBpbml0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHZvaWNlID0gbmV3IFNwZWVjaFN5bnRoZXNpc1V0dGVyYW5jZSgpO1xuICAgICAgICBzZXRMYW5ndWFnZSgpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5pbml0ID0gaW5pdDtcbmZ1bmN0aW9uIGNsZWFyKCkge1xuICAgIHZvaWNlID0gdW5kZWZpbmVkO1xufVxuZXhwb3J0cy5jbGVhciA9IGNsZWFyO1xuZnVuY3Rpb24gc3BlYWsodGV4dCkge1xuICAgIHdpbmRvdy5zcGVlY2hTeW50aGVzaXMuY2FuY2VsKCk7XG4gICAgaWYgKHZvaWNlID09PSB1bmRlZmluZWQpXG4gICAgICAgIGluaXQoKTtcbiAgICBpZiAodm9pY2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB2b2ljZS50ZXh0ID0gdGV4dDtcbiAgICAgICAgd2luZG93LnNwZWVjaFN5bnRoZXNpcy5zcGVhayh2b2ljZSk7XG4gICAgfVxufVxuZXhwb3J0cy5zcGVhayA9IHNwZWFrO1xuQ29uZmlnRXZlbnQuc3Vic2NyaWJlKChldmVudEtleSwgZXZlbnRWYWx1ZSkgPT4ge1xuICAgIGlmIChldmVudEtleSA9PT0gXCJmdW5ib3hcIikge1xuICAgICAgICBpZiAoZXZlbnRWYWx1ZSA9PT0gXCJub25lXCIpIHtcbiAgICAgICAgICAgIGNsZWFyKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZXZlbnRWYWx1ZSA9PT0gXCJ0dHNcIikge1xuICAgICAgICAgICAgaW5pdCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChldmVudEtleSA9PT0gXCJsYW5ndWFnZVwiICYmIGNvbmZpZ18xLmRlZmF1bHQuZnVuYm94ID09PSBcInR0c1wiKVxuICAgICAgICBzZXRMYW5ndWFnZSgpO1xufSk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5nZXRXb3JkID0gZXhwb3J0cy51cGRhdGVTY29yZSA9IHZvaWQgMDtcbmNvbnN0IFRlc3RJbnB1dCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi90ZXN0LWlucHV0XCIpKTtcbi8vIENoYW5nZXMgaG93IHF1aWNrbHkgaXQgJ2xlYXJucycgc2NvcmVzIC0gdmVyeSByb3VnaGx5IHRoZSBzY29yZSBmb3IgYSBjaGFyXG4vLyBpcyBiYXNlZCBvbiBsYXN0IHBlckNoYXJDb3VudCBvY2N1cnJlbmNlcy4gTWFrZSBpdCBzbWFsbGVyIHRvIGFkanVzdCBmYXN0ZXIuXG5jb25zdCBwZXJDaGFyQ291bnQgPSA1MDtcbi8vIENob29zZSB0aGUgaGlnaGVzdCBzY29yaW5nIHdvcmQgZnJvbSB0aGlzIG1hbnkgcmFuZG9tIHdvcmRzLiBIaWdoZXIgdmFsdWVzXG4vLyB3aWxsIGNob29zZSB3b3JkcyB3aXRoIG1vcmUgd2VhayBsZXR0ZXJzIG9uIGF2ZXJhZ2UuXG5jb25zdCB3b3JkU2FtcGxlcyA9IDIwO1xuLy8gU2NvcmUgcGVuYXRseSAoaW4gbWlsbGlzZWNvbmRzKSBmb3IgZ2V0dGluZyBhIGxldHRlciB3cm9uZy5cbmNvbnN0IGluY29ycmVjdFBlbmFsdHkgPSA1MDAwO1xuY29uc3Qgc2NvcmVzID0ge307XG5jbGFzcyBTY29yZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuYXZlcmFnZSA9IDAuMDtcbiAgICAgICAgdGhpcy5jb3VudCA9IDA7XG4gICAgfVxuICAgIHVwZGF0ZShzY29yZSkge1xuICAgICAgICBpZiAodGhpcy5jb3VudCA8IHBlckNoYXJDb3VudCkge1xuICAgICAgICAgICAgdGhpcy5jb3VudCsrO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFkanVzdFJhdGUgPSAxLjAgLyB0aGlzLmNvdW50O1xuICAgICAgICAvLyBLZWVwIGFuIGV4cG9uZW50aWFsIG1vdmluZyBhdmVyYWdlIG9mIHRoZSBzY29yZSBvdmVyIHRpbWUuXG4gICAgICAgIHRoaXMuYXZlcmFnZSA9IHNjb3JlICogYWRqdXN0UmF0ZSArIHRoaXMuYXZlcmFnZSAqICgxIC0gYWRqdXN0UmF0ZSk7XG4gICAgfVxufVxuZnVuY3Rpb24gdXBkYXRlU2NvcmUoY2hhciwgaXNDb3JyZWN0KSB7XG4gICAgY29uc3QgdGltaW5ncyA9IFRlc3RJbnB1dC5rZXlwcmVzc1RpbWluZ3Muc3BhY2luZy5hcnJheTtcbiAgICBpZiAodGltaW5ncy5sZW5ndGggPT09IDAgfHwgdHlwZW9mIHRpbWluZ3MgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgc2NvcmUgPSB0aW1pbmdzW3RpbWluZ3MubGVuZ3RoIC0gMV07XG4gICAgaWYgKCFpc0NvcnJlY3QpIHtcbiAgICAgICAgc2NvcmUgKz0gaW5jb3JyZWN0UGVuYWx0eTtcbiAgICB9XG4gICAgaWYgKCEoY2hhciBpbiBzY29yZXMpKSB7XG4gICAgICAgIHNjb3Jlc1tjaGFyXSA9IG5ldyBTY29yZSgpO1xuICAgIH1cbiAgICBzY29yZXNbY2hhcl0udXBkYXRlKHNjb3JlKTtcbn1cbmV4cG9ydHMudXBkYXRlU2NvcmUgPSB1cGRhdGVTY29yZTtcbmZ1bmN0aW9uIHNjb3JlKHdvcmQpIHtcbiAgICBsZXQgdG90YWwgPSAwLjA7XG4gICAgbGV0IG51bUNoYXJzID0gMDtcbiAgICBmb3IgKGNvbnN0IGMgb2Ygd29yZCkge1xuICAgICAgICBpZiAoYyBpbiBzY29yZXMpIHtcbiAgICAgICAgICAgIHRvdGFsICs9IHNjb3Jlc1tjXS5hdmVyYWdlO1xuICAgICAgICAgICAgbnVtQ2hhcnMrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVtQ2hhcnMgPT0gMCA/IDAuMCA6IHRvdGFsIC8gbnVtQ2hhcnM7XG59XG5mdW5jdGlvbiBnZXRXb3JkKHdvcmRzZXQpIHtcbiAgICBsZXQgaGlnaFNjb3JlO1xuICAgIGxldCByYW5kb21Xb3JkID0gXCJcIjtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmRTYW1wbGVzOyBpKyspIHtcbiAgICAgICAgY29uc3QgbmV3V29yZCA9IHdvcmRzZXQucmFuZG9tV29yZCgpO1xuICAgICAgICBjb25zdCBuZXdTY29yZSA9IHNjb3JlKG5ld1dvcmQpO1xuICAgICAgICBpZiAoaSA9PSAwIHx8IGhpZ2hTY29yZSA9PT0gdW5kZWZpbmVkIHx8IG5ld1Njb3JlID4gaGlnaFNjb3JlKSB7XG4gICAgICAgICAgICByYW5kb21Xb3JkID0gbmV3V29yZDtcbiAgICAgICAgICAgIGhpZ2hTY29yZSA9IG5ld1Njb3JlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByYW5kb21Xb3JkO1xufVxuZXhwb3J0cy5nZXRXb3JkID0gZ2V0V29yZDtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZ2V0U2VjdGlvbiA9IGV4cG9ydHMuZ2V0VExEID0gZXhwb3J0cy5TZWN0aW9uID0gdm9pZCAwO1xuY29uc3QgTG9hZGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sb2FkZXJcIikpO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi4vdXRpbHMvbWlzY1wiKSk7XG5jbGFzcyBTZWN0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcih0aXRsZSwgYXV0aG9yLCB3b3Jkcykge1xuICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgICAgIHRoaXMuYXV0aG9yID0gYXV0aG9yO1xuICAgICAgICB0aGlzLndvcmRzID0gd29yZHM7XG4gICAgfVxufVxuZXhwb3J0cy5TZWN0aW9uID0gU2VjdGlvbjtcbmZ1bmN0aW9uIGdldFRMRChsYW5ndWFnZUdyb3VwKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgLy8gbGFuZ3VhZ2UgZ3JvdXAgdG8gdGxkXG4gICAgICAgIHN3aXRjaCAobGFuZ3VhZ2VHcm91cC5uYW1lKSB7XG4gICAgICAgICAgICBjYXNlIFwiZW5nbGlzaFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImVuXCI7XG4gICAgICAgICAgICBjYXNlIFwic3BhbmlzaFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImVzXCI7XG4gICAgICAgICAgICBjYXNlIFwiZnJlbmNoXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiZnJcIjtcbiAgICAgICAgICAgIGNhc2UgXCJnZXJtYW5cIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJkZVwiO1xuICAgICAgICAgICAgY2FzZSBcInBvcnR1Z3Vlc2VcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJwdFwiO1xuICAgICAgICAgICAgY2FzZSBcIml0YWxpYW5cIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJpdFwiO1xuICAgICAgICAgICAgY2FzZSBcImR1dGNoXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwibmxcIjtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiZW5cIjtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRUTEQgPSBnZXRUTEQ7XG5mdW5jdGlvbiBnZXRTZWN0aW9uKGxhbmd1YWdlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJHZXR0aW5nIHNlY3Rpb25cIik7XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIC8vIGdldCBUTEQgZm9yIHdpa2lwZWRpYSBhY2NvcmRpbmcgdG8gbGFuZ3VhZ2UgZ3JvdXBcbiAgICAgICAgbGV0IHVybFRMRCA9IFwiZW5cIjtcbiAgICAgICAgY29uc3QgY3VycmVudExhbmd1YWdlR3JvdXAgPSB5aWVsZCBNaXNjLmZpbmRDdXJyZW50R3JvdXAobGFuZ3VhZ2UpO1xuICAgICAgICBpZiAoY3VycmVudExhbmd1YWdlR3JvdXAgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdXJsVExEID0geWllbGQgZ2V0VExEKGN1cnJlbnRMYW5ndWFnZUdyb3VwKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByYW5kb21Qb3N0VVJMID0gYGh0dHBzOi8vJHt1cmxUTER9Lndpa2lwZWRpYS5vcmcvYXBpL3Jlc3RfdjEvcGFnZS9yYW5kb20vc3VtbWFyeWA7XG4gICAgICAgIGNvbnN0IHNlY3Rpb25PYmogPSB7IHRpdGxlOiBcIlwiLCBhdXRob3I6IFwiXCIgfTtcbiAgICAgICAgY29uc3QgcmFuZG9tUG9zdFJlcSA9IHlpZWxkIGZldGNoKHJhbmRvbVBvc3RVUkwpO1xuICAgICAgICBsZXQgcGFnZWlkID0gMDtcbiAgICAgICAgaWYgKHJhbmRvbVBvc3RSZXEuc3RhdHVzID09IDIwMCkge1xuICAgICAgICAgICAgY29uc3QgcG9zdE9iaiA9IHlpZWxkIHJhbmRvbVBvc3RSZXEuanNvbigpO1xuICAgICAgICAgICAgc2VjdGlvbk9iai50aXRsZSA9IHBvc3RPYmoudGl0bGU7XG4gICAgICAgICAgICBzZWN0aW9uT2JqLmF1dGhvciA9IHBvc3RPYmouYXV0aG9yO1xuICAgICAgICAgICAgcGFnZWlkID0gcG9zdE9iai5wYWdlaWQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4ge1xuICAgICAgICAgICAgaWYgKHJhbmRvbVBvc3RSZXEuc3RhdHVzICE9IDIwMCkge1xuICAgICAgICAgICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgcmVqKHJhbmRvbVBvc3RSZXEuc3RhdHVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHNlY3Rpb25VUkwgPSBgaHR0cHM6Ly8ke3VybFRMRH0ud2lraXBlZGlhLm9yZy93L2FwaS5waHA/YWN0aW9uPXF1ZXJ5JmZvcm1hdD1qc29uJnBhZ2VpZHM9JHtwYWdlaWR9JnByb3A9ZXh0cmFjdHMmZXhpbnRybz10cnVlJm9yaWdpbj0qYDtcbiAgICAgICAgICAgIGNvbnN0IHNlY3Rpb25SZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgIHNlY3Rpb25SZXEub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChzZWN0aW9uUmVxLnJlYWR5U3RhdGUgPT0gNCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VjdGlvblJlcS5zdGF0dXMgPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2VjdGlvblRleHQgPSBKU09OLnBhcnNlKHNlY3Rpb25SZXEucmVzcG9uc2VUZXh0KS5xdWVyeVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wYWdlc1twYWdlaWQudG9TdHJpbmcoKV0uZXh0cmFjdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmRzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgZG91YmxlIHdoaXRlc3BhY2VzIGFuZCBmaW5hbGx5IHRyYWlsaW5nIHdoaXRlc3BhY2VzLlxuICAgICAgICAgICAgICAgICAgICAgICAgc2VjdGlvblRleHQgPSBzZWN0aW9uVGV4dC5yZXBsYWNlKC88XFwvcD48cD4rL2csIFwiIFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlY3Rpb25UZXh0ID0gJChcIjxkaXYvPlwiKS5odG1sKHNlY3Rpb25UZXh0KS50ZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVGV4dCA9IHNlY3Rpb25UZXh0LnJlcGxhY2UoL1xccysvZywgXCIgXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VjdGlvblRleHQgPSBzZWN0aW9uVGV4dC50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAvLyBBZGQgc3BhY2VzXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzZWN0aW9uVGV4dCA9IHNlY3Rpb25UZXh0LnJlcGxhY2UoL1thLXpBLVowLTldezMsfVxcLlthLXpBLVpdL2csICh4KSA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICB4LnJlcGxhY2UoL1xcLi8sIFwiLiBcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVGV4dC5zcGxpdChcIiBcIikuZm9yRWFjaCgod29yZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRzLnB1c2god29yZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlY3Rpb24gPSBuZXcgU2VjdGlvbihzZWN0aW9uT2JqLnRpdGxlLCBzZWN0aW9uT2JqLmF1dGhvciwgd29yZHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgTG9hZGVyLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyhzZWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIExvYWRlci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWooc2VjdGlvblJlcS5zdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHNlY3Rpb25SZXEub3BlbihcIkdFVFwiLCBzZWN0aW9uVVJMKTtcbiAgICAgICAgICAgIHNlY3Rpb25SZXEuc2VuZCgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0U2VjdGlvbiA9IGdldFNlY3Rpb247XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMud2l0aFdvcmRzID0gZXhwb3J0cy5Xb3Jkc2V0ID0gdm9pZCAwO1xuY29uc3QgbWlzY18xID0gcmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIik7XG5sZXQgY3VycmVudFdvcmRzZXQgPSBudWxsO1xubGV0IGN1cnJlbnRXb3JkR2VuZXJhdG9yID0gbnVsbDtcbmNsYXNzIFdvcmRzZXQge1xuICAgIGNvbnN0cnVjdG9yKHdvcmRzKSB7XG4gICAgICAgIHRoaXMud29yZHMgPSB3b3JkcztcbiAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLndvcmRzLmxlbmd0aDtcbiAgICB9XG4gICAgcmFuZG9tV29yZCgpIHtcbiAgICAgICAgcmV0dXJuICgwLCBtaXNjXzEucmFuZG9tRWxlbWVudEZyb21BcnJheSkodGhpcy53b3Jkcyk7XG4gICAgfVxufVxuZXhwb3J0cy5Xb3Jkc2V0ID0gV29yZHNldDtcbmNvbnN0IHByZWZpeFNpemUgPSAyO1xuY2xhc3MgQ2hhckRpc3RyaWJ1dGlvbiB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuY2hhcnMgPSB7fTtcbiAgICAgICAgdGhpcy5jb3VudCA9IDA7XG4gICAgfVxuICAgIGFkZENoYXIoY2hhcikge1xuICAgICAgICB0aGlzLmNvdW50Kys7XG4gICAgICAgIGlmIChjaGFyIGluIHRoaXMuY2hhcnMpIHtcbiAgICAgICAgICAgIHRoaXMuY2hhcnNbY2hhcl0rKztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY2hhcnNbY2hhcl0gPSAxO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJhbmRvbUNoYXIoKSB7XG4gICAgICAgIGNvbnN0IHJhbmRvbUluZGV4ID0gKDAsIG1pc2NfMS5yYW5kb21JbnRGcm9tUmFuZ2UpKDAsIHRoaXMuY291bnQgLSAxKTtcbiAgICAgICAgbGV0IHJ1bm5pbmdDb3VudCA9IDA7XG4gICAgICAgIGZvciAoY29uc3QgW2NoYXIsIGNoYXJDb3VudF0gb2YgT2JqZWN0LmVudHJpZXModGhpcy5jaGFycykpIHtcbiAgICAgICAgICAgIHJ1bm5pbmdDb3VudCArPSBjaGFyQ291bnQ7XG4gICAgICAgICAgICBpZiAocnVubmluZ0NvdW50ID4gcmFuZG9tSW5kZXgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2hhcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcy5jaGFycylbMF07XG4gICAgfVxufVxuY2xhc3MgV29yZEdlbmVyYXRvciBleHRlbmRzIFdvcmRzZXQge1xuICAgIGNvbnN0cnVjdG9yKHdvcmRzKSB7XG4gICAgICAgIHN1cGVyKHdvcmRzKTtcbiAgICAgICAgdGhpcy5uZ3JhbXMgPSB7fTtcbiAgICAgICAgLy8gQ2FuIGdlbmVyYXRlIGFuIHVuYm91bmRlZCBudW1iZXIgb2Ygd29yZHMgaW4gdGhlb3J5LlxuICAgICAgICB0aGlzLmxlbmd0aCA9IEluZmluaXR5O1xuICAgICAgICBmb3IgKGxldCB3b3JkIG9mIHdvcmRzKSB7XG4gICAgICAgICAgICAvLyBNYXJrIHRoZSBlbmQgb2YgZWFjaCB3b3JkIHdpdGggYSBzcGFjZS5cbiAgICAgICAgICAgIHdvcmQgKz0gXCIgXCI7XG4gICAgICAgICAgICBsZXQgcHJlZml4ID0gXCJcIjtcbiAgICAgICAgICAgIGZvciAoY29uc3QgYyBvZiB3b3JkKSB7XG4gICAgICAgICAgICAgICAgLy8gQWRkIGBjYCB0byB0aGUgZGlzdHJpYnV0aW9uIG9mIGNoYXJzIHRoYXQgY2FuIGNvbWUgYWZ0ZXIgYHByZWZpeGAuXG4gICAgICAgICAgICAgICAgaWYgKCEocHJlZml4IGluIHRoaXMubmdyYW1zKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm5ncmFtc1twcmVmaXhdID0gbmV3IENoYXJEaXN0cmlidXRpb24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5uZ3JhbXNbcHJlZml4XS5hZGRDaGFyKGMpO1xuICAgICAgICAgICAgICAgIHByZWZpeCA9IChwcmVmaXggKyBjKS5zdWJzdHIoLXByZWZpeFNpemUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJhbmRvbVdvcmQoKSB7XG4gICAgICAgIGxldCB3b3JkID0gXCJcIjtcbiAgICAgICAgZm9yICg7Oykge1xuICAgICAgICAgICAgY29uc3QgcHJlZml4ID0gd29yZC5zdWJzdHIoLXByZWZpeFNpemUpO1xuICAgICAgICAgICAgY29uc3QgY2hhckRpc3RyaWJ1dGlvbiA9IHRoaXMubmdyYW1zW3ByZWZpeF07XG4gICAgICAgICAgICBpZiAoIWNoYXJEaXN0cmlidXRpb24pIHtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIHNob3VsZG4ndCBoYXBwZW4gaWYgdGhpcy5uZ3JhbXMgaXMgY29tcGxldGUuIElmIGl0IGRvZXNcbiAgICAgICAgICAgICAgICAvLyBzb21laG93LCBzdGFydCBnZW5lcmF0aW5nIGEgbmV3IHdvcmQuXG4gICAgICAgICAgICAgICAgd29yZCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBQaWNrIGEgcmFuZG9tIGNoYXIgZnJvbSB0aGUgZGlzdHJpYnV0aW9uIHRoYXQgY29tZXMgYWZ0ZXIgYHByZWZpeGAuXG4gICAgICAgICAgICBjb25zdCBuZXh0Q2hhciA9IGNoYXJEaXN0cmlidXRpb24ucmFuZG9tQ2hhcigpO1xuICAgICAgICAgICAgaWYgKG5leHRDaGFyID09IFwiIFwiKSB7XG4gICAgICAgICAgICAgICAgLy8gQSBzcGFjZSBtYXJrcyB0aGUgZW5kIG9mIHRoZSB3b3JkLCBzbyBzdG9wIGdlbmVyYXRpbmcgYW5kIHJldHVybi5cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHdvcmQgKz0gbmV4dENoYXI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHdvcmQ7XG4gICAgfVxufVxuZnVuY3Rpb24gd2l0aFdvcmRzKHdvcmRzLCBmdW5ib3gpIHtcbiAgICBpZiAoZnVuYm94ID09IFwicHNldWRvbGFuZ1wiKSB7XG4gICAgICAgIGlmIChjdXJyZW50V29yZEdlbmVyYXRvciA9PSBudWxsIHx8IHdvcmRzICE9PSBjdXJyZW50V29yZEdlbmVyYXRvci53b3Jkcykge1xuICAgICAgICAgICAgY3VycmVudFdvcmRHZW5lcmF0b3IgPSBuZXcgV29yZEdlbmVyYXRvcih3b3Jkcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGN1cnJlbnRXb3JkR2VuZXJhdG9yO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGN1cnJlbnRXb3Jkc2V0ID09IG51bGwgfHwgd29yZHMgIT09IGN1cnJlbnRXb3Jkc2V0LndvcmRzKSB7XG4gICAgICAgICAgICBjdXJyZW50V29yZHNldCA9IG5ldyBXb3Jkc2V0KHdvcmRzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY3VycmVudFdvcmRzZXQ7XG4gICAgfVxufVxuZXhwb3J0cy53aXRoV29yZHMgPSB3aXRoV29yZHM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51cGRhdGVLZXl0aXBzID0gdm9pZCAwO1xuY29uc3QgY29uZmlnXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vY29uZmlnXCIpKTtcbmNvbnN0IENhcmV0ID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3Rlc3QvY2FyZXRcIikpO1xuY29uc3QgTm90aWZpY2F0aW9ucyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9lbGVtZW50cy9ub3RpZmljYXRpb25zXCIpKTtcbmNvbnN0IEN1c3RvbVRleHQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vdGVzdC9jdXN0b20tdGV4dFwiKSk7XG5jb25zdCBUZXN0QWN0aXZlID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL3N0YXRlcy90ZXN0LWFjdGl2ZVwiKSk7XG5jb25zdCBDb25maWdFdmVudCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9vYnNlcnZhYmxlcy9jb25maWctZXZlbnRcIikpO1xuZnVuY3Rpb24gdXBkYXRlS2V5dGlwcygpIHtcbiAgICBpZiAoY29uZmlnXzEuZGVmYXVsdC5zd2FwRXNjQW5kVGFiKSB7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC50aXBcIikuaHRtbChgXG4gICAgdGlwOiBZb3UgY2FuIGFsc28gY2hhbmdlIGFsbCB0aGVzZSBzZXR0aW5ncyBxdWlja2x5IHVzaW5nIHRoZVxuICAgIGNvbW1hbmQgbGluZSAoXG4gICAgPGtleT50YWI8L2tleT5cbiAgICApYCk7XG4gICAgICAgICQoXCIjYm90dG9tIC5rZXlUaXBzXCIpLmh0bWwoYFxuICAgIDxrZXk+ZXNjPC9rZXk+IC0gcmVzdGFydCB0ZXN0PGJyPlxuICAgICAgPGtleT50YWI8L2tleT4gLSBjb21tYW5kIGxpbmVgKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgICQoXCIucGFnZVNldHRpbmdzIC50aXBcIikuaHRtbChgXG4gICAgdGlwOiBZb3UgY2FuIGFsc28gY2hhbmdlIGFsbCB0aGVzZSBzZXR0aW5ncyBxdWlja2x5IHVzaW5nIHRoZVxuICAgIGNvbW1hbmQgbGluZSAoXG4gICAgPGtleT5lc2M8L2tleT5cbiAgICApYCk7XG4gICAgICAgICQoXCIjYm90dG9tIC5rZXlUaXBzXCIpLmh0bWwoYFxuICAgIDxrZXk+dGFiPC9rZXk+IC0gcmVzdGFydCB0ZXN0PGJyPlxuICAgICAgPGtleT5lc2M8L2tleT4gb3IgPGtleT5jdHJsL2NtZDwva2V5Pis8a2V5PnNoaWZ0PC9rZXk+KzxrZXk+cDwva2V5PiAtIGNvbW1hbmQgbGluZWApO1xuICAgIH1cbn1cbmV4cG9ydHMudXBkYXRlS2V5dGlwcyA9IHVwZGF0ZUtleXRpcHM7XG5pZiAod2luZG93LmxvY2F0aW9uLmhvc3RuYW1lID09PSBcImxvY2FsaG9zdFwiKSB7XG4gICAgd2luZG93Lm9uZXJyb3IgPSBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgTm90aWZpY2F0aW9ucy5hZGQoZXJyb3IudG9TdHJpbmcoKSwgLTEpO1xuICAgIH07XG4gICAgJChcIiN0b3AgLmxvZ28gLnRvcFwiKS50ZXh0KFwibG9jYWxob3N0XCIpO1xuICAgICQoXCJoZWFkIHRpdGxlXCIpLnRleHQoJChcImhlYWQgdGl0bGVcIikudGV4dCgpICsgXCIgKGxvY2FsaG9zdClcIik7XG4gICAgJChcImJvZHlcIikuYXBwZW5kKGA8ZGl2IGNsYXNzPVwiZGV2SW5kaWNhdG9yIHRsXCI+bG9jYWw8L2Rpdj48ZGl2IGNsYXNzPVwiZGV2SW5kaWNhdG9yIGJyXCI+bG9jYWw8L2Rpdj5gKTtcbiAgICAkKFwiLnBhZ2VTZXR0aW5ncyAuZGlzY29yZEludGVncmF0aW9uIC5idXR0b25zIGFcIikuYXR0cihcImhyZWZcIiwgXCJodHRwczovL2Rpc2NvcmQuY29tL2FwaS9vYXV0aDIvYXV0aG9yaXplP2NsaWVudF9pZD03OTgyNzIzMzUwMzU0OTg1NTcmcmVkaXJlY3RfdXJpPWh0dHAlM0ElMkYlMkZsb2NhbGhvc3QlM0E1MDAwJTJGdmVyaWZ5JnJlc3BvbnNlX3R5cGU9dG9rZW4mc2NvcGU9aWRlbnRpZnlcIik7XG59XG4vL3N0b3Agc3BhY2Ugc2Nyb2xsaW5nXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoZS5jb2RlID09PSBcIlNwYWNlXCIgJiYgZS50YXJnZXQgPT09IGRvY3VtZW50LmJvZHkpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbn0pO1xud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJiZWZvcmV1bmxvYWRcIiwgKGV2ZW50KSA9PiB7XG4gICAgLy8gQ2FuY2VsIHRoZSBldmVudCBhcyBzdGF0ZWQgYnkgdGhlIHN0YW5kYXJkLlxuICAgIGlmICgoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcIndvcmRzXCIgJiYgY29uZmlnXzEuZGVmYXVsdC53b3JkcyA8IDEwMDApIHx8XG4gICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwidGltZVwiICYmIGNvbmZpZ18xLmRlZmF1bHQudGltZSA8IDM2MDApIHx8XG4gICAgICAgIGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJxdW90ZVwiIHx8XG4gICAgICAgIChjb25maWdfMS5kZWZhdWx0Lm1vZGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgIEN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmXG4gICAgICAgICAgICBDdXN0b21UZXh0LndvcmQgPCAxMDAwKSB8fFxuICAgICAgICAoY29uZmlnXzEuZGVmYXVsdC5tb2RlID09PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICBDdXN0b21UZXh0LmlzVGltZVJhbmRvbSAmJlxuICAgICAgICAgICAgQ3VzdG9tVGV4dC50aW1lIDwgMTAwMCkgfHxcbiAgICAgICAgKGNvbmZpZ18xLmRlZmF1bHQubW9kZSA9PT0gXCJjdXN0b21cIiAmJlxuICAgICAgICAgICAgIUN1c3RvbVRleHQuaXNXb3JkUmFuZG9tICYmXG4gICAgICAgICAgICBDdXN0b21UZXh0LnRleHQubGVuZ3RoIDwgMTAwMCkpIHtcbiAgICAgICAgLy9pZ25vcmVcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChUZXN0QWN0aXZlLmdldCgpKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgLy8gQ2hyb21lIHJlcXVpcmVzIHJldHVyblZhbHVlIHRvIGJlIHNldC5cbiAgICAgICAgICAgIGV2ZW50LnJldHVyblZhbHVlID0gXCJcIjtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuJCh3aW5kb3cpLm9uKFwicmVzaXplXCIsICgpID0+IHtcbiAgICBjb25zb2xlLmxvZyhcIlVwZGF0aW5nIGNhcmV0IHBvc2l0aW9uXCIpO1xuICAgIENhcmV0LnVwZGF0ZVBvc2l0aW9uKCk7XG59KTtcbkNvbmZpZ0V2ZW50LnN1YnNjcmliZSgoZXZlbnRLZXkpID0+IHtcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwic3dhcEVzY0FuZFRhYlwiKVxuICAgICAgICB1cGRhdGVLZXl0aXBzKCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5kZWJvdW5jZSA9IHZvaWQgMDtcbmZ1bmN0aW9uIGRlYm91bmNlKGZuLCBtcyA9IDI1MCkge1xuICAgIGxldCB0aW1lb3V0SWQ7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICguLi5hcmdzKSB7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpO1xuICAgICAgICB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IGZuLmFwcGx5KHRoaXMsIGFyZ3MpLCBtcyk7XG4gICAgfTtcbn1cbmV4cG9ydHMuZGVib3VuY2UgPSBkZWJvdW5jZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucmVnZXhJbmRleE9mID0gZXhwb3J0cy5zZXRDaGFyQXQgPSBleHBvcnRzLmNsZWFyVGltZW91dHMgPSBleHBvcnRzLmNhblF1aWNrUmVzdGFydCA9IGV4cG9ydHMubWFwUmFuZ2UgPSBleHBvcnRzLmlzVXNlcm5hbWVWYWxpZCA9IGV4cG9ydHMuY2xlYW5UeXBvZ3JhcGh5U3ltYm9scyA9IGV4cG9ydHMuZXNjYXBlUmVnRXhwID0gZXhwb3J0cy5yZW1vdmVfbm9uX2FzY2lpID0gZXhwb3J0cy5nZXRXb3JkcyA9IGV4cG9ydHMudG9nZ2xlRnVsbHNjcmVlbiA9IGV4cG9ydHMub2JqZWN0VG9RdWVyeVN0cmluZyA9IGV4cG9ydHMuZmluZEdldFBhcmFtZXRlciA9IGV4cG9ydHMuZ2V0UG9zaXRpb25TdHJpbmcgPSBleHBvcnRzLmdldEFycm93cyA9IGV4cG9ydHMuZ2V0QVNDSUkgPSBleHBvcnRzLmdldFNwZWNpYWxzID0gZXhwb3J0cy5nZXROdW1iZXJzID0gZXhwb3J0cy5zZWNvbmRzVG9TdHJpbmcgPSBleHBvcnRzLmdldEdpYmJlcmlzaCA9IGV4cG9ydHMuZmluZExpbmVCeUxlYXN0U3F1YXJlcyA9IGV4cG9ydHMucm91bmRUbzIgPSBleHBvcnRzLndob3JmID0gZXhwb3J0cy5rb2dhc2EgPSBleHBvcnRzLmlzQVNDSUlMZXR0ZXIgPSBleHBvcnRzLmNhcGl0YWxpemVGaXJzdExldHRlck9mRWFjaFdvcmQgPSBleHBvcnRzLmdldExhc3RDaGFyID0gZXhwb3J0cy5nZXRSZWxlYXNlc0Zyb21HaXRIdWIgPSBleHBvcnRzLm1lZGlhbiA9IGV4cG9ydHMubWVhbiA9IGV4cG9ydHMuc3RkRGV2ID0gZXhwb3J0cy5zbW9vdGggPSBleHBvcnRzLmdldENoYWxsZW5nZUxpc3QgPSBleHBvcnRzLmZpbmRDdXJyZW50R3JvdXAgPSBleHBvcnRzLmdldEN1cnJlbnRMYW5ndWFnZSA9IGV4cG9ydHMuZ2V0TGFuZ3VhZ2UgPSBleHBvcnRzLmdldExhbmd1YWdlR3JvdXBzID0gZXhwb3J0cy5nZXRMYW5ndWFnZUxpc3QgPSBleHBvcnRzLmdldENvbnRyaWJ1dG9yc0xpc3QgPSBleHBvcnRzLmdldFN1cHBvcnRlcnNMaXN0ID0gZXhwb3J0cy5nZXRGb250c0xpc3QgPSBleHBvcnRzLmdldExheW91dCA9IGV4cG9ydHMuZ2V0TGF5b3V0c0xpc3QgPSBleHBvcnRzLmdldEZ1bmJveCA9IGV4cG9ydHMuZ2V0RnVuYm94TGlzdCA9IGV4cG9ydHMuZ2V0U29ydGVkVGhlbWVzTGlzdCA9IGV4cG9ydHMuZ2V0VGhlbWVzTGlzdCA9IGV4cG9ydHMuaXNDb2xvckRhcmsgPSBleHBvcnRzLmlzQ29sb3JMaWdodCA9IGV4cG9ydHMuZ2V0dWlkID0gdm9pZCAwO1xuZXhwb3J0cy5jcmVhdGVFcnJvck1lc3NhZ2UgPSBleHBvcnRzLnJhbmRvbUVsZW1lbnRGcm9tT2JqZWN0ID0gZXhwb3J0cy5yYW5kb21FbGVtZW50RnJvbUFycmF5ID0gZXhwb3J0cy5zaHVmZmxlID0gZXhwb3J0cy5yYW5kb21JbnRGcm9tUmFuZ2UgPSBleHBvcnRzLmRvd25sb2FkUmVzdWx0c0NTViA9IGV4cG9ydHMuZ2V0TW9kZTIgPSBleHBvcnRzLnN3YXBFbGVtZW50cyA9IGV4cG9ydHMuY29udmVydFJlbVRvUGl4ZWxzID0gZXhwb3J0cy50cmFpbGluZ0NvbXBvc2VDaGFycyA9IGV4cG9ydHMuY29udmVydFJHQnRvSEVYID0gdm9pZCAwO1xuY29uc3QgTG9hZGVyID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9lbGVtZW50cy9sb2FkZXJcIikpO1xuY29uc3QgZm9ybWF0XzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImRhdGUtZm5zL2Zvcm1hdFwiKSk7XG5jb25zdCBmaXJlYmFzZV8xID0gcmVxdWlyZShcIi4uL2ZpcmViYXNlXCIpO1xuZnVuY3Rpb24gZ2V0dWlkKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zb2xlLmVycm9yKFwiT25seSBzaGFyZSB0aGlzIHVpZCB3aXRoIE1pb2RlYyBhbmQgbm9ib2R5IGVsc2UhXCIpO1xuICAgIGNvbnNvbGUubG9nKChfYSA9IGZpcmViYXNlXzEuQXV0aC5jdXJyZW50VXNlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnVpZCk7XG4gICAgY29uc29sZS5lcnJvcihcIk9ubHkgc2hhcmUgdGhpcyB1aWQgd2l0aCBNaW9kZWMgYW5kIG5vYm9keSBlbHNlIVwiKTtcbn1cbmV4cG9ydHMuZ2V0dWlkID0gZ2V0dWlkO1xuZnVuY3Rpb24gaGV4VG9IU0woaGV4KSB7XG4gICAgLy8gQ29udmVydCBoZXggdG8gUkdCIGZpcnN0XG4gICAgbGV0IHI7XG4gICAgbGV0IGc7XG4gICAgbGV0IGI7XG4gICAgaWYgKGhleC5sZW5ndGggPT0gNCkge1xuICAgICAgICByID0gKFwiMHhcIiArIGhleFsxXSArIGhleFsxXSk7XG4gICAgICAgIGcgPSAoXCIweFwiICsgaGV4WzJdICsgaGV4WzJdKTtcbiAgICAgICAgYiA9IChcIjB4XCIgKyBoZXhbM10gKyBoZXhbM10pO1xuICAgIH1cbiAgICBlbHNlIGlmIChoZXgubGVuZ3RoID09IDcpIHtcbiAgICAgICAgciA9IChcIjB4XCIgKyBoZXhbMV0gKyBoZXhbMl0pO1xuICAgICAgICBnID0gKFwiMHhcIiArIGhleFszXSArIGhleFs0XSk7XG4gICAgICAgIGIgPSAoXCIweFwiICsgaGV4WzVdICsgaGV4WzZdKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHIgPSAweDAwO1xuICAgICAgICBnID0gMHgwMDtcbiAgICAgICAgYiA9IDB4MDA7XG4gICAgfVxuICAgIC8vIFRoZW4gdG8gSFNMXG4gICAgciAvPSAyNTU7XG4gICAgZyAvPSAyNTU7XG4gICAgYiAvPSAyNTU7XG4gICAgY29uc3QgY21pbiA9IE1hdGgubWluKHIsIGcsIGIpO1xuICAgIGNvbnN0IGNtYXggPSBNYXRoLm1heChyLCBnLCBiKTtcbiAgICBjb25zdCBkZWx0YSA9IGNtYXggLSBjbWluO1xuICAgIGxldCBoID0gMDtcbiAgICBsZXQgcyA9IDA7XG4gICAgbGV0IGwgPSAwO1xuICAgIGlmIChkZWx0YSA9PSAwKVxuICAgICAgICBoID0gMDtcbiAgICBlbHNlIGlmIChjbWF4ID09IHIpXG4gICAgICAgIGggPSAoKGcgLSBiKSAvIGRlbHRhKSAlIDY7XG4gICAgZWxzZSBpZiAoY21heCA9PSBnKVxuICAgICAgICBoID0gKGIgLSByKSAvIGRlbHRhICsgMjtcbiAgICBlbHNlXG4gICAgICAgIGggPSAociAtIGcpIC8gZGVsdGEgKyA0O1xuICAgIGggPSBNYXRoLnJvdW5kKGggKiA2MCk7XG4gICAgaWYgKGggPCAwKVxuICAgICAgICBoICs9IDM2MDtcbiAgICBsID0gKGNtYXggKyBjbWluKSAvIDI7XG4gICAgcyA9IGRlbHRhID09IDAgPyAwIDogZGVsdGEgLyAoMSAtIE1hdGguYWJzKDIgKiBsIC0gMSkpO1xuICAgIHMgPSArKHMgKiAxMDApLnRvRml4ZWQoMSk7XG4gICAgbCA9ICsobCAqIDEwMCkudG9GaXhlZCgxKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBodWU6IGgsXG4gICAgICAgIHNhdDogcyxcbiAgICAgICAgbGd0OiBsLFxuICAgICAgICBzdHJpbmc6IFwiaHNsKFwiICsgaCArIFwiLFwiICsgcyArIFwiJSxcIiArIGwgKyBcIiUpXCIsXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGlzQ29sb3JMaWdodChoZXgpIHtcbiAgICBjb25zdCBoc2wgPSBoZXhUb0hTTChoZXgpO1xuICAgIHJldHVybiBoc2wubGd0ID49IDUwO1xufVxuZXhwb3J0cy5pc0NvbG9yTGlnaHQgPSBpc0NvbG9yTGlnaHQ7XG5mdW5jdGlvbiBpc0NvbG9yRGFyayhoZXgpIHtcbiAgICBjb25zdCBoc2wgPSBoZXhUb0hTTChoZXgpO1xuICAgIHJldHVybiBoc2wubGd0IDwgNTA7XG59XG5leHBvcnRzLmlzQ29sb3JEYXJrID0gaXNDb2xvckRhcms7XG5sZXQgdGhlbWVzTGlzdCA9IFtdO1xuZnVuY3Rpb24gZ2V0VGhlbWVzTGlzdCgpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAodGhlbWVzTGlzdC5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuICQuZ2V0SlNPTihcInRoZW1lcy9fbGlzdC5qc29uXCIsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbGlzdCA9IGRhdGEuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lQSA9IGEubmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lQiA9IGIubmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobmFtZUEgPCBuYW1lQilcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWVBID4gbmFtZUIpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhlbWVzTGlzdCA9IGxpc3Q7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoZW1lc0xpc3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGVtZXNMaXN0O1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmdldFRoZW1lc0xpc3QgPSBnZXRUaGVtZXNMaXN0O1xubGV0IHNvcnRlZFRoZW1lc0xpc3QgPSBbXTtcbmZ1bmN0aW9uIGdldFNvcnRlZFRoZW1lc0xpc3QoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKHNvcnRlZFRoZW1lc0xpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBpZiAodGhlbWVzTGlzdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB5aWVsZCBnZXRUaGVtZXNMaXN0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgc29ydGVkID0gWy4uLnRoZW1lc0xpc3RdO1xuICAgICAgICAgICAgc29ydGVkID0gc29ydGVkLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBiMSA9IGhleFRvSFNMKGEuYmdDb2xvcik7XG4gICAgICAgICAgICAgICAgY29uc3QgYjIgPSBoZXhUb0hTTChiLmJnQ29sb3IpO1xuICAgICAgICAgICAgICAgIHJldHVybiBiMi5sZ3QgLSBiMS5sZ3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNvcnRlZFRoZW1lc0xpc3QgPSBzb3J0ZWQ7XG4gICAgICAgICAgICByZXR1cm4gc29ydGVkVGhlbWVzTGlzdDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBzb3J0ZWRUaGVtZXNMaXN0O1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmdldFNvcnRlZFRoZW1lc0xpc3QgPSBnZXRTb3J0ZWRUaGVtZXNMaXN0O1xubGV0IGZ1bmJveExpc3QgPSBbXTtcbmZ1bmN0aW9uIGdldEZ1bmJveExpc3QoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKGZ1bmJveExpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5nZXRKU09OKFwiZnVuYm94L19saXN0Lmpzb25cIiwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBmdW5ib3hMaXN0ID0gZGF0YS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWVBID0gYS5uYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWVCID0gYi5uYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuYW1lQSA8IG5hbWVCKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgICAgICBpZiAobmFtZUEgPiBuYW1lQilcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuYm94TGlzdDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmJveExpc3Q7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0RnVuYm94TGlzdCA9IGdldEZ1bmJveExpc3Q7XG5mdW5jdGlvbiBnZXRGdW5ib3goZnVuYm94KSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgY29uc3QgbGlzdCA9IHlpZWxkIGdldEZ1bmJveExpc3QoKTtcbiAgICAgICAgcmV0dXJuIGxpc3QuZmluZChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQubmFtZSA9PSBmdW5ib3g7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRGdW5ib3ggPSBnZXRGdW5ib3g7XG5sZXQgbGF5b3V0c0xpc3QgPSB7fTtcbmZ1bmN0aW9uIGdldExheW91dHNMaXN0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhsYXlvdXRzTGlzdCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5nZXRKU09OKFwibGF5b3V0cy9fbGlzdC5qc29uXCIsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgbGF5b3V0c0xpc3QgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHJldHVybiBsYXlvdXRzTGlzdDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGxheW91dHNMaXN0O1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmdldExheW91dHNMaXN0ID0gZ2V0TGF5b3V0c0xpc3Q7XG5mdW5jdGlvbiBnZXRMYXlvdXQobGF5b3V0TmFtZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhsYXlvdXRzTGlzdCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB5aWVsZCBnZXRMYXlvdXRzTGlzdCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsYXlvdXRzTGlzdFtsYXlvdXROYW1lXTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0TGF5b3V0ID0gZ2V0TGF5b3V0O1xubGV0IGZvbnRzTGlzdCA9IFtdO1xuZnVuY3Rpb24gZ2V0Rm9udHNMaXN0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChmb250c0xpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5nZXRKU09OKFwiZm9udHMvX2xpc3QuanNvblwiLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGZvbnRzTGlzdCA9IGRhdGEuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lQSA9IGEubmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lQiA9IGIubmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobmFtZUEgPCBuYW1lQilcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWVBID4gbmFtZUIpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZvbnRzTGlzdDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZvbnRzTGlzdDtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRGb250c0xpc3QgPSBnZXRGb250c0xpc3Q7XG5sZXQgc3VwcG9ydGVyc0xpc3QgPSBbXTtcbmZ1bmN0aW9uIGdldFN1cHBvcnRlcnNMaXN0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChzdXBwb3J0ZXJzTGlzdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiAkLmdldEpTT04oXCJhYm91dC9zdXBwb3J0ZXJzLmpzb25cIiwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBzdXBwb3J0ZXJzTGlzdCA9IGRhdGE7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRlcnNMaXN0O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc3VwcG9ydGVyc0xpc3Q7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0U3VwcG9ydGVyc0xpc3QgPSBnZXRTdXBwb3J0ZXJzTGlzdDtcbmxldCBjb250cmlidXRvcnNMaXN0ID0gW107XG5mdW5jdGlvbiBnZXRDb250cmlidXRvcnNMaXN0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChjb250cmlidXRvcnNMaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuICQuZ2V0SlNPTihcImFib3V0L2NvbnRyaWJ1dG9ycy5qc29uXCIsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgY29udHJpYnV0b3JzTGlzdCA9IGRhdGE7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRyaWJ1dG9yc0xpc3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBjb250cmlidXRvcnNMaXN0O1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmdldENvbnRyaWJ1dG9yc0xpc3QgPSBnZXRDb250cmlidXRvcnNMaXN0O1xubGV0IGxhbmd1YWdlTGlzdCA9IFtdO1xuZnVuY3Rpb24gZ2V0TGFuZ3VhZ2VMaXN0KCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIGlmIChsYW5ndWFnZUxpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5nZXRKU09OKFwibGFuZ3VhZ2VzL19saXN0Lmpzb25cIiwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBsYW5ndWFnZUxpc3QgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHJldHVybiBsYW5ndWFnZUxpc3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBsYW5ndWFnZUxpc3Q7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0TGFuZ3VhZ2VMaXN0ID0gZ2V0TGFuZ3VhZ2VMaXN0O1xubGV0IGxhbmd1YWdlR3JvdXBMaXN0ID0gW107XG5mdW5jdGlvbiBnZXRMYW5ndWFnZUdyb3VwcygpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpZiAobGFuZ3VhZ2VHcm91cExpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5nZXRKU09OKFwibGFuZ3VhZ2VzL19ncm91cHMuanNvblwiLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGxhbmd1YWdlR3JvdXBMaXN0ID0gZGF0YTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbGFuZ3VhZ2VHcm91cExpc3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBsYW5ndWFnZUdyb3VwTGlzdDtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRMYW5ndWFnZUdyb3VwcyA9IGdldExhbmd1YWdlR3JvdXBzO1xubGV0IGN1cnJlbnRMYW5ndWFnZTtcbmZ1bmN0aW9uIGdldExhbmd1YWdlKGxhbmcpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRMYW5ndWFnZSA9PSB1bmRlZmluZWQgfHwgY3VycmVudExhbmd1YWdlLm5hbWUgIT09IGxhbmcpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImdldHRpbmcgbGFuZ3VhZ2UganNvblwiKTtcbiAgICAgICAgICAgICAgICB5aWVsZCAkLmdldEpTT04oYGxhbmd1YWdlcy8ke2xhbmd9Lmpzb25gLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGFuZ3VhZ2UgPSBkYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRMYW5ndWFnZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgZXJyb3IgZ2V0dGluZyBsYW5ndWFnZWApO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgICAgIHlpZWxkICQuZ2V0SlNPTihgbGFuZ3VhZ2VzL2VuZ2xpc2guanNvbmAsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudExhbmd1YWdlID0gZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRMYW5ndWFnZTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRMYW5ndWFnZSA9IGdldExhbmd1YWdlO1xuZnVuY3Rpb24gZ2V0Q3VycmVudExhbmd1YWdlKGxhbmd1YWdlTmFtZSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHJldHVybiB5aWVsZCBnZXRMYW5ndWFnZShsYW5ndWFnZU5hbWUpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRDdXJyZW50TGFuZ3VhZ2UgPSBnZXRDdXJyZW50TGFuZ3VhZ2U7XG5mdW5jdGlvbiBmaW5kQ3VycmVudEdyb3VwKGxhbmd1YWdlKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgbGV0IHJldGdyb3VwO1xuICAgICAgICBjb25zdCBncm91cHMgPSB5aWVsZCBnZXRMYW5ndWFnZUdyb3VwcygpO1xuICAgICAgICBncm91cHMuZm9yRWFjaCgoZ3JvdXApID0+IHtcbiAgICAgICAgICAgIGlmIChyZXRncm91cCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGdyb3VwLmxhbmd1YWdlcy5pbmNsdWRlcyhsYW5ndWFnZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0Z3JvdXAgPSBncm91cDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmV0Z3JvdXA7XG4gICAgfSk7XG59XG5leHBvcnRzLmZpbmRDdXJyZW50R3JvdXAgPSBmaW5kQ3VycmVudEdyb3VwO1xubGV0IGNoYWxsZW5nZUxpc3QgPSBbXTtcbmZ1bmN0aW9uIGdldENoYWxsZW5nZUxpc3QoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgaWYgKGNoYWxsZW5nZUxpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5nZXRKU09OKFwiY2hhbGxlbmdlcy9fbGlzdC5qc29uXCIsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgY2hhbGxlbmdlTGlzdCA9IGRhdGE7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNoYWxsZW5nZUxpc3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBjaGFsbGVuZ2VMaXN0O1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmdldENoYWxsZW5nZUxpc3QgPSBnZXRDaGFsbGVuZ2VMaXN0O1xuZnVuY3Rpb24gc21vb3RoKGFyciwgd2luZG93U2l6ZSwgZ2V0dGVyID0gKHZhbHVlKSA9PiB2YWx1ZSkge1xuICAgIGNvbnN0IGdldCA9IGdldHRlcjtcbiAgICBjb25zdCByZXN1bHQgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBjb25zdCBsZWZ0T2ZmZXNldCA9IGkgLSB3aW5kb3dTaXplO1xuICAgICAgICBjb25zdCBmcm9tID0gbGVmdE9mZmVzZXQgPj0gMCA/IGxlZnRPZmZlc2V0IDogMDtcbiAgICAgICAgY29uc3QgdG8gPSBpICsgd2luZG93U2l6ZSArIDE7XG4gICAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICAgIGxldCBzdW0gPSAwO1xuICAgICAgICBmb3IgKGxldCBqID0gZnJvbTsgaiA8IHRvICYmIGogPCBhcnIubGVuZ3RoOyBqICs9IDEpIHtcbiAgICAgICAgICAgIHN1bSArPSBnZXQoYXJyW2pdKTtcbiAgICAgICAgICAgIGNvdW50ICs9IDE7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0W2ldID0gc3VtIC8gY291bnQ7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5leHBvcnRzLnNtb290aCA9IHNtb290aDtcbmZ1bmN0aW9uIHN0ZERldihhcnJheSkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG4gPSBhcnJheS5sZW5ndGg7XG4gICAgICAgIGNvbnN0IG1lYW4gPSBhcnJheS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiKSAvIG47XG4gICAgICAgIHJldHVybiBNYXRoLnNxcnQoYXJyYXkubWFwKCh4KSA9PiBNYXRoLnBvdyh4IC0gbWVhbiwgMikpLnJlZHVjZSgoYSwgYikgPT4gYSArIGIpIC8gbik7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbn1cbmV4cG9ydHMuc3RkRGV2ID0gc3RkRGV2O1xuZnVuY3Rpb24gbWVhbihhcnJheSkge1xuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiAoYXJyYXkucmVkdWNlKChwcmV2aW91cywgY3VycmVudCkgPT4gKGN1cnJlbnQgKz0gcHJldmlvdXMpKSAvIGFycmF5Lmxlbmd0aCk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbn1cbmV4cG9ydHMubWVhbiA9IG1lYW47XG4vL2h0dHBzOi8vd3d3LnczcmVzb3VyY2UuY29tL2phdmFzY3JpcHQtZXhlcmNpc2VzL2Z1bmRhbWVudGFsL2phdmFzY3JpcHQtZnVuZGFtZW50YWwtZXhlcmNpc2UtODgucGhwXG5mdW5jdGlvbiBtZWRpYW4oYXJyKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbWlkID0gTWF0aC5mbG9vcihhcnIubGVuZ3RoIC8gMiksIG51bXMgPSBbLi4uYXJyXS5zb3J0KChhLCBiKSA9PiBhIC0gYik7XG4gICAgICAgIHJldHVybiBhcnIubGVuZ3RoICUgMiAhPT0gMCA/IG51bXNbbWlkXSA6IChudW1zW21pZCAtIDFdICsgbnVtc1ttaWRdKSAvIDI7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbn1cbmV4cG9ydHMubWVkaWFuID0gbWVkaWFuO1xuZnVuY3Rpb24gZ2V0UmVsZWFzZXNGcm9tR2l0SHViKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHJldHVybiAkLmdldEpTT04oXCJodHRwczovL2FwaS5naXRodWIuY29tL3JlcG9zL01pb2RlYy9tb25rZXl0eXBlL3JlbGVhc2VzXCIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICAkKFwiI2JvdHRvbSAudmVyc2lvbiAudGV4dFwiKS50ZXh0KGRhdGFbMF0ubmFtZSk7XG4gICAgICAgICAgICAkKFwiI2JvdHRvbSAudmVyc2lvblwiKS5jc3MoXCJvcGFjaXR5XCIsIDEpO1xuICAgICAgICAgICAgJChcIiN2ZXJzaW9uSGlzdG9yeSAucmVsZWFzZXNcIikuZW1wdHkoKTtcbiAgICAgICAgICAgIGRhdGEuZm9yRWFjaCgocmVsZWFzZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghcmVsZWFzZS5kcmFmdCAmJiAhcmVsZWFzZS5wcmVyZWxlYXNlKSB7XG4gICAgICAgICAgICAgICAgICAgICQoXCIjdmVyc2lvbkhpc3RvcnkgLnJlbGVhc2VzXCIpLmFwcGVuZChgXG4gICAgICAgICAgPGRpdiBjbGFzcz1cInJlbGVhc2VcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0aXRsZVwiPiR7cmVsZWFzZS5uYW1lfTwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImRhdGVcIj4keygwLCBmb3JtYXRfMS5kZWZhdWx0KShuZXcgRGF0ZShyZWxlYXNlLnB1Ymxpc2hlZF9hdCksIFwiZGQgTU1NIHl5eXlcIil9PC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYm9keVwiPiR7cmVsZWFzZS5ib2R5LnJlcGxhY2UoL1xcclxcbi9nLCBcIjxicj5cIil9PC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIGApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0UmVsZWFzZXNGcm9tR2l0SHViID0gZ2V0UmVsZWFzZXNGcm9tR2l0SHViO1xuLy8gZnVuY3Rpb24gZ2V0UGF0cmVvbk5hbWVzKCkge1xuLy8gICBsZXQgbmFtZXNlbCA9ICQoXCIucGFnZUFib3V0IC5zZWN0aW9uIC5zdXBwb3J0ZXJzXCIpO1xuLy8gICBmaXJlYmFzZVxuLy8gICAgIC5mdW5jdGlvbnMoKVxuLy8gICAgIC5odHRwc0NhbGxhYmxlKFwiZ2V0UGF0cmVvbnNcIikoKVxuLy8gICAgIC50aGVuKChkYXRhKSA9PiB7XG4vLyAgICAgICBsZXQgbmFtZXMgPSBkYXRhLmRhdGE7XG4vLyAgICAgICBuYW1lcy5mb3JFYWNoKChuYW1lKSA9PiB7XG4vLyAgICAgICAgIG5hbWVzZWwuYXBwZW5kKGA8ZGl2PiR7bmFtZX08L2Rpdj5gKTtcbi8vICAgICAgIH0pO1xuLy8gICAgIH0pO1xuLy8gfVxuZnVuY3Rpb24gZ2V0TGFzdENoYXIod29yZCkge1xuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiB3b3JkLmNoYXJBdCh3b3JkLmxlbmd0aCAtIDEpO1xuICAgIH1cbiAgICBjYXRjaCAoX2EpIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxufVxuZXhwb3J0cy5nZXRMYXN0Q2hhciA9IGdldExhc3RDaGFyO1xuZnVuY3Rpb24gY2FwaXRhbGl6ZUZpcnN0TGV0dGVyT2ZFYWNoV29yZChzdHIpIHtcbiAgICByZXR1cm4gc3RyXG4gICAgICAgIC5zcGxpdCgvICsvKVxuICAgICAgICAubWFwKChzKSA9PiBzLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcy5zbGljZSgxKSlcbiAgICAgICAgLmpvaW4oXCIgXCIpO1xufVxuZXhwb3J0cy5jYXBpdGFsaXplRmlyc3RMZXR0ZXJPZkVhY2hXb3JkID0gY2FwaXRhbGl6ZUZpcnN0TGV0dGVyT2ZFYWNoV29yZDtcbmZ1bmN0aW9uIGlzQVNDSUlMZXR0ZXIoYykge1xuICAgIHJldHVybiBjLmxlbmd0aCA9PT0gMSAmJiAvW2Etel0vaS50ZXN0KGMpO1xufVxuZXhwb3J0cy5pc0FTQ0lJTGV0dGVyID0gaXNBU0NJSUxldHRlcjtcbmZ1bmN0aW9uIGtvZ2FzYShjb3YpIHtcbiAgICByZXR1cm4gKDEwMCAqICgxIC0gTWF0aC50YW5oKGNvdiArIE1hdGgucG93KGNvdiwgMykgLyAzICsgTWF0aC5wb3coY292LCA1KSAvIDUpKSk7XG59XG5leHBvcnRzLmtvZ2FzYSA9IGtvZ2FzYTtcbmZ1bmN0aW9uIHdob3JmKHNwZWVkLCB3b3JkbGVuKSB7XG4gICAgcmV0dXJuIE1hdGgubWluKHNwZWVkLCBNYXRoLmZsb29yKHNwZWVkICogTWF0aC5wb3coMS4wMywgLTIgKiAod29yZGxlbiAtIDMpKSkpO1xufVxuZXhwb3J0cy53aG9yZiA9IHdob3JmO1xuZnVuY3Rpb24gcm91bmRUbzIobnVtKSB7XG4gICAgcmV0dXJuIE1hdGgucm91bmQoKG51bSArIE51bWJlci5FUFNJTE9OKSAqIDEwMCkgLyAxMDA7XG59XG5leHBvcnRzLnJvdW5kVG8yID0gcm91bmRUbzI7XG5mdW5jdGlvbiBmaW5kTGluZUJ5TGVhc3RTcXVhcmVzKHZhbHVlc195KSB7XG4gICAgbGV0IHN1bV94ID0gMDtcbiAgICBsZXQgc3VtX3kgPSAwO1xuICAgIGxldCBzdW1feHkgPSAwO1xuICAgIGxldCBzdW1feHggPSAwO1xuICAgIGxldCBjb3VudCA9IDA7XG4gICAgLypcbiAgICAgKiBXZSdsbCB1c2UgdGhvc2UgbGV0aWFibGVzIGZvciBmYXN0ZXIgcmVhZC93cml0ZSBhY2Nlc3MuXG4gICAgICovXG4gICAgbGV0IHggPSAwO1xuICAgIGxldCB5ID0gMDtcbiAgICBjb25zdCB2YWx1ZXNfbGVuZ3RoID0gdmFsdWVzX3kubGVuZ3RoO1xuICAgIC8qXG4gICAgICogTm90aGluZyB0byBkby5cbiAgICAgKi9cbiAgICBpZiAodmFsdWVzX2xlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gW1tdLCBbXV07XG4gICAgfVxuICAgIC8qXG4gICAgICogQ2FsY3VsYXRlIHRoZSBzdW0gZm9yIGVhY2ggb2YgdGhlIHBhcnRzIG5lY2Vzc2FyeS5cbiAgICAgKi9cbiAgICBmb3IgKGxldCB2ID0gMDsgdiA8IHZhbHVlc19sZW5ndGg7IHYrKykge1xuICAgICAgICB4ID0gdiArIDE7XG4gICAgICAgIHkgPSB2YWx1ZXNfeVt2XTtcbiAgICAgICAgc3VtX3ggKz0geDtcbiAgICAgICAgc3VtX3kgKz0geTtcbiAgICAgICAgc3VtX3h4ICs9IHggKiB4O1xuICAgICAgICBzdW1feHkgKz0geCAqIHk7XG4gICAgICAgIGNvdW50Kys7XG4gICAgfVxuICAgIC8qXG4gICAgICogQ2FsY3VsYXRlIG0gYW5kIGIgZm9yIHRoZSBmb3JtdWxhcjpcbiAgICAgKiB5ID0geCAqIG0gKyBiXG4gICAgICovXG4gICAgY29uc3QgbSA9IChjb3VudCAqIHN1bV94eSAtIHN1bV94ICogc3VtX3kpIC8gKGNvdW50ICogc3VtX3h4IC0gc3VtX3ggKiBzdW1feCk7XG4gICAgY29uc3QgYiA9IHN1bV95IC8gY291bnQgLSAobSAqIHN1bV94KSAvIGNvdW50O1xuICAgIGNvbnN0IHJldHVybnBvaW50MSA9IFsxLCAxICogbSArIGJdO1xuICAgIGNvbnN0IHJldHVybnBvaW50MiA9IFt2YWx1ZXNfbGVuZ3RoLCB2YWx1ZXNfbGVuZ3RoICogbSArIGJdO1xuICAgIHJldHVybiBbcmV0dXJucG9pbnQxLCByZXR1cm5wb2ludDJdO1xufVxuZXhwb3J0cy5maW5kTGluZUJ5TGVhc3RTcXVhcmVzID0gZmluZExpbmVCeUxlYXN0U3F1YXJlcztcbmZ1bmN0aW9uIGdldEdpYmJlcmlzaCgpIHtcbiAgICBjb25zdCByYW5kTGVuID0gcmFuZG9tSW50RnJvbVJhbmdlKDEsIDcpO1xuICAgIGxldCByZXQgPSBcIlwiO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmFuZExlbjsgaSsrKSB7XG4gICAgICAgIHJldCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDk3ICsgcmFuZG9tSW50RnJvbVJhbmdlKDAsIDI1KSk7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59XG5leHBvcnRzLmdldEdpYmJlcmlzaCA9IGdldEdpYmJlcmlzaDtcbmZ1bmN0aW9uIHNlY29uZHNUb1N0cmluZyhzZWMsIGFsd2F5c1Nob3dNaW51dGVzID0gZmFsc2UsIGFsd2F5c1Nob3dIb3VycyA9IGZhbHNlLCBkZWxpbWl0ZXIgPSBcIjpcIiwgc2hvd1NlY29uZHMgPSB0cnVlLCBzaG93RGF5cyA9IGZhbHNlKSB7XG4gICAgc2VjID0gTWF0aC5hYnMoc2VjKTtcbiAgICBsZXQgZGF5cyA9IDA7XG4gICAgbGV0IGhvdXJzO1xuICAgIGlmIChzaG93RGF5cykge1xuICAgICAgICBkYXlzID0gTWF0aC5mbG9vcihzZWMgLyA4NjQwMCk7XG4gICAgICAgIGhvdXJzID0gTWF0aC5mbG9vcigoc2VjICUgODY0MDApIC8gMzYwMCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBob3VycyA9IE1hdGguZmxvb3Ioc2VjIC8gMzYwMCk7XG4gICAgfVxuICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKChzZWMgJSAzNjAwKSAvIDYwKTtcbiAgICBjb25zdCBzZWNvbmRzID0gcm91bmRUbzIoKHNlYyAlIDM2MDApICUgNjApO1xuICAgIGxldCBkYXlzU3RyaW5nO1xuICAgIGxldCBob3Vyc1N0cmluZztcbiAgICBsZXQgbWludXRlc1N0cmluZztcbiAgICBsZXQgc2Vjb25kc1N0cmluZztcbiAgICBpZiAoc2hvd0RheXMpIHtcbiAgICAgICAgZGF5cyA8IDEwICYmIGRlbGltaXRlciAhPT0gXCJ0ZXh0XCJcbiAgICAgICAgICAgID8gKGRheXNTdHJpbmcgPSBcIjBcIiArIGRheXMpXG4gICAgICAgICAgICA6IChkYXlzU3RyaW5nID0gZGF5cyk7XG4gICAgfVxuICAgIGhvdXJzIDwgMTAgJiYgZGVsaW1pdGVyICE9PSBcInRleHRcIlxuICAgICAgICA/IChob3Vyc1N0cmluZyA9IFwiMFwiICsgaG91cnMpXG4gICAgICAgIDogKGhvdXJzU3RyaW5nID0gaG91cnMpO1xuICAgIG1pbnV0ZXMgPCAxMCAmJiBkZWxpbWl0ZXIgIT09IFwidGV4dFwiXG4gICAgICAgID8gKG1pbnV0ZXNTdHJpbmcgPSBcIjBcIiArIG1pbnV0ZXMpXG4gICAgICAgIDogKG1pbnV0ZXNTdHJpbmcgPSBtaW51dGVzKTtcbiAgICBzZWNvbmRzIDwgMTAgJiZcbiAgICAgICAgKG1pbnV0ZXMgPiAwIHx8IGhvdXJzID4gMCB8fCBhbHdheXNTaG93TWludXRlcykgJiZcbiAgICAgICAgZGVsaW1pdGVyICE9PSBcInRleHRcIlxuICAgICAgICA/IChzZWNvbmRzU3RyaW5nID0gXCIwXCIgKyBzZWNvbmRzKVxuICAgICAgICA6IChzZWNvbmRzU3RyaW5nID0gc2Vjb25kcyk7XG4gICAgbGV0IHJldCA9IFwiXCI7XG4gICAgaWYgKGRheXMgPiAwICYmIHNob3dEYXlzKSB7XG4gICAgICAgIHJldCArPSBkYXlzU3RyaW5nO1xuICAgICAgICBpZiAoZGVsaW1pdGVyID09PSBcInRleHRcIikge1xuICAgICAgICAgICAgaWYgKGRheXMgPT0gMSkge1xuICAgICAgICAgICAgICAgIHJldCArPSBcIiBkYXkgXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXQgKz0gXCIgZGF5cyBcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldCArPSBkZWxpbWl0ZXI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGhvdXJzID4gMCB8fCBhbHdheXNTaG93SG91cnMpIHtcbiAgICAgICAgcmV0ICs9IGhvdXJzU3RyaW5nO1xuICAgICAgICBpZiAoZGVsaW1pdGVyID09PSBcInRleHRcIikge1xuICAgICAgICAgICAgaWYgKGhvdXJzID09IDEpIHtcbiAgICAgICAgICAgICAgICByZXQgKz0gXCIgaG91ciBcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldCArPSBcIiBob3VycyBcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldCArPSBkZWxpbWl0ZXI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKG1pbnV0ZXMgPiAwIHx8IGhvdXJzID4gMCB8fCBhbHdheXNTaG93TWludXRlcykge1xuICAgICAgICByZXQgKz0gbWludXRlc1N0cmluZztcbiAgICAgICAgaWYgKGRlbGltaXRlciA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgICAgIGlmIChtaW51dGVzID09IDEpIHtcbiAgICAgICAgICAgICAgICByZXQgKz0gXCIgbWludXRlIFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0ICs9IFwiIG1pbnV0ZXMgXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoc2hvd1NlY29uZHMpIHtcbiAgICAgICAgICAgIHJldCArPSBkZWxpbWl0ZXI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHNob3dTZWNvbmRzKSB7XG4gICAgICAgIHJldCArPSBzZWNvbmRzU3RyaW5nO1xuICAgICAgICBpZiAoZGVsaW1pdGVyID09PSBcInRleHRcIikge1xuICAgICAgICAgICAgaWYgKHNlY29uZHMgPT0gMSkge1xuICAgICAgICAgICAgICAgIHJldCArPSBcIiBzZWNvbmRcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldCArPSBcIiBzZWNvbmRzXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGhvdXJzID09PSAwICYmIG1pbnV0ZXMgPT09IDAgJiYgIXNob3dTZWNvbmRzICYmIGRlbGltaXRlciA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgcmV0ID0gXCJsZXNzIHRoYW4gMSBtaW51dGVcIjtcbiAgICB9XG4gICAgcmV0dXJuIHJldC50cmltKCk7XG59XG5leHBvcnRzLnNlY29uZHNUb1N0cmluZyA9IHNlY29uZHNUb1N0cmluZztcbmZ1bmN0aW9uIGdldE51bWJlcnMobGVuKSB7XG4gICAgY29uc3QgcmFuZExlbiA9IHJhbmRvbUludEZyb21SYW5nZSgxLCBsZW4pO1xuICAgIGxldCByZXQgPSBcIlwiO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmFuZExlbjsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHJhbmRvbU51bSA9IHJhbmRvbUludEZyb21SYW5nZSgwLCA5KTtcbiAgICAgICAgcmV0ICs9IHJhbmRvbU51bS50b1N0cmluZygpO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufVxuZXhwb3J0cy5nZXROdW1iZXJzID0gZ2V0TnVtYmVycztcbmZ1bmN0aW9uIGdldFNwZWNpYWxzKCkge1xuICAgIGNvbnN0IHJhbmRMZW4gPSByYW5kb21JbnRGcm9tUmFuZ2UoMSwgNyk7XG4gICAgbGV0IHJldCA9IFwiXCI7XG4gICAgY29uc3Qgc3BlY2lhbHMgPSBbXG4gICAgICAgIFwiIVwiLFxuICAgICAgICBcIkBcIixcbiAgICAgICAgXCIjXCIsXG4gICAgICAgIFwiJFwiLFxuICAgICAgICBcIiVcIixcbiAgICAgICAgXCJeXCIsXG4gICAgICAgIFwiJlwiLFxuICAgICAgICBcIipcIixcbiAgICAgICAgXCIoXCIsXG4gICAgICAgIFwiKVwiLFxuICAgICAgICBcIi1cIixcbiAgICAgICAgXCJfXCIsXG4gICAgICAgIFwiPVwiLFxuICAgICAgICBcIitcIixcbiAgICAgICAgXCJ7XCIsXG4gICAgICAgIFwifVwiLFxuICAgICAgICBcIltcIixcbiAgICAgICAgXCJdXCIsXG4gICAgICAgIFwiJ1wiLFxuICAgICAgICAnXCInLFxuICAgICAgICBcIi9cIixcbiAgICAgICAgXCJcXFxcXCIsXG4gICAgICAgIFwifFwiLFxuICAgIF07XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCByYW5kTGVuOyBpKyspIHtcbiAgICAgICAgcmV0ICs9IHJhbmRvbUVsZW1lbnRGcm9tQXJyYXkoc3BlY2lhbHMpO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufVxuZXhwb3J0cy5nZXRTcGVjaWFscyA9IGdldFNwZWNpYWxzO1xuZnVuY3Rpb24gZ2V0QVNDSUkoKSB7XG4gICAgY29uc3QgcmFuZExlbiA9IHJhbmRvbUludEZyb21SYW5nZSgxLCAxMCk7XG4gICAgbGV0IHJldCA9IFwiXCI7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCByYW5kTGVuOyBpKyspIHtcbiAgICAgICAgbGV0IHJhbiA9IDMzICsgcmFuZG9tSW50RnJvbVJhbmdlKDAsIDkzKTtcbiAgICAgICAgd2hpbGUgKHJhbiA9PSA5NiB8fCByYW4gPT0gOTQpXG4gICAgICAgICAgICByYW4gPSAzMyArIHJhbmRvbUludEZyb21SYW5nZSgwLCA5Myk7IC8vdG9kbyByZW1vdmUgd2hlbiBpbnB1dCByZXdyaXRlIGlzIGZpeGVkXG4gICAgICAgIHJldCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHJhbik7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59XG5leHBvcnRzLmdldEFTQ0lJID0gZ2V0QVNDSUk7XG5mdW5jdGlvbiBnZXRBcnJvd3MoKSB7XG4gICAgY29uc3QgYXJyb3dBcnJheSA9IFtcIuKGkFwiLCBcIuKGkVwiLCBcIuKGklwiLCBcIuKGk1wiXTtcbiAgICBsZXQgYXJyb3dXb3JkID0gXCJcIjtcbiAgICBsZXQgbGFzdGNoYXI7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHtcbiAgICAgICAgbGV0IHJhbmRvbSA9IHJhbmRvbUVsZW1lbnRGcm9tQXJyYXkoYXJyb3dBcnJheSk7XG4gICAgICAgIHdoaWxlIChyYW5kb20gPT09IGxhc3RjaGFyKSB7XG4gICAgICAgICAgICByYW5kb20gPSByYW5kb21FbGVtZW50RnJvbUFycmF5KGFycm93QXJyYXkpO1xuICAgICAgICB9XG4gICAgICAgIGxhc3RjaGFyID0gcmFuZG9tO1xuICAgICAgICBhcnJvd1dvcmQgKz0gcmFuZG9tO1xuICAgIH1cbiAgICByZXR1cm4gYXJyb3dXb3JkO1xufVxuZXhwb3J0cy5nZXRBcnJvd3MgPSBnZXRBcnJvd3M7XG5mdW5jdGlvbiBnZXRQb3NpdGlvblN0cmluZyhudW1iZXIpIHtcbiAgICBsZXQgbnVtZW5kID0gXCJ0aFwiO1xuICAgIGNvbnN0IHQgPSBudW1iZXIgJSAxMDtcbiAgICBjb25zdCBoID0gbnVtYmVyICUgMTAwO1xuICAgIGlmICh0ID09IDEgJiYgaCAhPSAxMSkge1xuICAgICAgICBudW1lbmQgPSBcInN0XCI7XG4gICAgfVxuICAgIGlmICh0ID09IDIgJiYgaCAhPSAxMikge1xuICAgICAgICBudW1lbmQgPSBcIm5kXCI7XG4gICAgfVxuICAgIGlmICh0ID09IDMgJiYgaCAhPSAxMykge1xuICAgICAgICBudW1lbmQgPSBcInJkXCI7XG4gICAgfVxuICAgIHJldHVybiBudW1iZXIgKyBudW1lbmQ7XG59XG5leHBvcnRzLmdldFBvc2l0aW9uU3RyaW5nID0gZ2V0UG9zaXRpb25TdHJpbmc7XG5mdW5jdGlvbiBmaW5kR2V0UGFyYW1ldGVyKHBhcmFtZXRlck5hbWUpIHtcbiAgICBsZXQgcmVzdWx0ID0gbnVsbDtcbiAgICBsZXQgdG1wID0gW107XG4gICAgbG9jYXRpb24uc2VhcmNoXG4gICAgICAgIC5zdWJzdHIoMSlcbiAgICAgICAgLnNwbGl0KFwiJlwiKVxuICAgICAgICAuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICB0bXAgPSBpdGVtLnNwbGl0KFwiPVwiKTtcbiAgICAgICAgaWYgKHRtcFswXSA9PT0gcGFyYW1ldGVyTmFtZSlcbiAgICAgICAgICAgIHJlc3VsdCA9IGRlY29kZVVSSUNvbXBvbmVudCh0bXBbMV0pO1xuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHQ7XG59XG5leHBvcnRzLmZpbmRHZXRQYXJhbWV0ZXIgPSBmaW5kR2V0UGFyYW1ldGVyO1xuZnVuY3Rpb24gb2JqZWN0VG9RdWVyeVN0cmluZyhvYmopIHtcbiAgICBjb25zdCBzdHIgPSBbXTtcbiAgICBmb3IgKGNvbnN0IHAgaW4gb2JqKSB7XG4gICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwKSkge1xuICAgICAgICAgICAgLy8gQXJyYXlzIGdldCBlbmNvZGVkIGFzIGEgY29tbWEoJTJDKS1zZXBhcmF0ZWQgbGlzdFxuICAgICAgICAgICAgc3RyLnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KHApICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQob2JqW3BdKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHN0ci5qb2luKFwiJlwiKTtcbn1cbmV4cG9ydHMub2JqZWN0VG9RdWVyeVN0cmluZyA9IG9iamVjdFRvUXVlcnlTdHJpbmc7XG5mdW5jdGlvbiB0b2dnbGVGdWxsc2NyZWVuKCkge1xuICAgIGNvbnN0IGVsZW0gPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gICAgaWYgKCFkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCAmJlxuICAgICAgICAhZG9jdW1lbnQubW96RnVsbFNjcmVlbkVsZW1lbnQgJiZcbiAgICAgICAgIWRvY3VtZW50LndlYmtpdEZ1bGxzY3JlZW5FbGVtZW50ICYmXG4gICAgICAgICFkb2N1bWVudC5tc0Z1bGxzY3JlZW5FbGVtZW50KSB7XG4gICAgICAgIGlmIChlbGVtLnJlcXVlc3RGdWxsc2NyZWVuKSB7XG4gICAgICAgICAgICBlbGVtLnJlcXVlc3RGdWxsc2NyZWVuKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZWxlbS5tc1JlcXVlc3RGdWxsc2NyZWVuKSB7XG4gICAgICAgICAgICBlbGVtLm1zUmVxdWVzdEZ1bGxzY3JlZW4oKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChlbGVtLm1velJlcXVlc3RGdWxsU2NyZWVuKSB7XG4gICAgICAgICAgICBlbGVtLm1velJlcXVlc3RGdWxsU2NyZWVuKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZWxlbS53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbikge1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgZWxlbS53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbihFbGVtZW50LkFMTE9XX0tFWUJPQVJEX0lOUFVUKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5leGl0RnVsbHNjcmVlbigpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGRvY3VtZW50Lm1zRXhpdEZ1bGxzY3JlZW4pIHtcbiAgICAgICAgICAgIGRvY3VtZW50Lm1zRXhpdEZ1bGxzY3JlZW4oKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChkb2N1bWVudC5tb3pDYW5jZWxGdWxsU2NyZWVuKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5tb3pDYW5jZWxGdWxsU2NyZWVuKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZG9jdW1lbnQud2Via2l0RXhpdEZ1bGxzY3JlZW4pIHtcbiAgICAgICAgICAgIGRvY3VtZW50LndlYmtpdEV4aXRGdWxsc2NyZWVuKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLnRvZ2dsZUZ1bGxzY3JlZW4gPSB0b2dnbGVGdWxsc2NyZWVuO1xuZnVuY3Rpb24gZ2V0V29yZHMoKSB7XG4gICAgY29uc3Qgd29yZHMgPSBbLi4uZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIiN3b3JkcyAud29yZFwiKV1cbiAgICAgICAgLm1hcCgod29yZCkgPT4ge1xuICAgICAgICByZXR1cm4gWy4uLndvcmQucXVlcnlTZWxlY3RvckFsbChcImxldHRlclwiKV1cbiAgICAgICAgICAgIC5tYXAoKGxldHRlcikgPT4gbGV0dGVyLnRleHRDb250ZW50KVxuICAgICAgICAgICAgLmpvaW4oXCJcIik7XG4gICAgfSlcbiAgICAgICAgLmpvaW4oXCIgXCIpO1xuICAgIHJldHVybiB3b3Jkcztcbn1cbmV4cG9ydHMuZ2V0V29yZHMgPSBnZXRXb3Jkcztcbi8vY3JlZGl0OiBodHRwczovL3d3dy53M3Jlc291cmNlLmNvbS9qYXZhc2NyaXB0LWV4ZXJjaXNlcy9qYXZhc2NyaXB0LXN0cmluZy1leGVyY2lzZS0zMi5waHBcbmZ1bmN0aW9uIHJlbW92ZV9ub25fYXNjaWkoc3RyKSB7XG4gICAgaWYgKHN0ciA9PT0gbnVsbCB8fCBzdHIgPT09IFwiXCIpXG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgIGVsc2VcbiAgICAgICAgc3RyID0gc3RyLnRvU3RyaW5nKCk7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bXlxceDIwLVxceDdFXS9nLCBcIlwiKTtcbn1cbmV4cG9ydHMucmVtb3ZlX25vbl9hc2NpaSA9IHJlbW92ZV9ub25fYXNjaWk7XG5mdW5jdGlvbiBlc2NhcGVSZWdFeHAoc3RyKSB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bLiorP14ke30oKXxbXFxdXFxcXF0vZywgXCJcXFxcJCZcIik7XG59XG5leHBvcnRzLmVzY2FwZVJlZ0V4cCA9IGVzY2FwZVJlZ0V4cDtcbmZ1bmN0aW9uIGNsZWFuVHlwb2dyYXBoeVN5bWJvbHModGV4dFRvQ2xlYW4pIHtcbiAgICBjb25zdCBzcGVjaWFscyA9IHtcbiAgICAgICAgXCLigJxcIjogJ1wiJyxcbiAgICAgICAgXCLigJ1cIjogJ1wiJyxcbiAgICAgICAgXCLigJlcIjogXCInXCIsXG4gICAgICAgIFwi4oCYXCI6IFwiJ1wiLFxuICAgICAgICBcIixcIjogXCIsXCIsXG4gICAgICAgIFwi4oCUXCI6IFwiLVwiLFxuICAgICAgICBcIuKAplwiOiBcIi4uLlwiLFxuICAgICAgICBcIsKrXCI6IFwiPDxcIixcbiAgICAgICAgXCLCu1wiOiBcIj4+XCIsXG4gICAgICAgIFwi4oCTXCI6IFwiLVwiLFxuICAgICAgICBcIuKAh1wiOiBcIiBcIixcbiAgICAgICAgXCLigK9cIjogXCIgXCIsXG4gICAgICAgIFwiwqBcIjogXCIgXCIsXG4gICAgfTtcbiAgICByZXR1cm4gdGV4dFRvQ2xlYW4ucmVwbGFjZSgvW+KAnOKAneKAmeKAmOKAlCzigKbCq8K74oCTXFx1MjAwN1xcdTIwMkZcXHUwMEEwXS9nLCAoY2hhcikgPT4gc3BlY2lhbHNbY2hhcl0gfHwgXCJcIik7XG59XG5leHBvcnRzLmNsZWFuVHlwb2dyYXBoeVN5bWJvbHMgPSBjbGVhblR5cG9ncmFwaHlTeW1ib2xzO1xuZnVuY3Rpb24gaXNVc2VybmFtZVZhbGlkKG5hbWUpIHtcbiAgICBpZiAobmFtZSA9PT0gbnVsbCB8fCBuYW1lID09PSB1bmRlZmluZWQgfHwgbmFtZSA9PT0gXCJcIilcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmICgvbWlvZGVjLy50ZXN0KG5hbWUudG9Mb3dlckNhc2UoKSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAoL2JpdGx5Ly50ZXN0KG5hbWUudG9Mb3dlckNhc2UoKSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAobmFtZS5sZW5ndGggPiAxNClcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmICgvXlxcLi4qLy50ZXN0KG5hbWUudG9Mb3dlckNhc2UoKSkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gL15bMC05YS16QS1aXy4tXSskLy50ZXN0KG5hbWUpO1xufVxuZXhwb3J0cy5pc1VzZXJuYW1lVmFsaWQgPSBpc1VzZXJuYW1lVmFsaWQ7XG5mdW5jdGlvbiBtYXBSYW5nZSh4LCBpbl9taW4sIGluX21heCwgb3V0X21pbiwgb3V0X21heCkge1xuICAgIGxldCBudW0gPSAoKHggLSBpbl9taW4pICogKG91dF9tYXggLSBvdXRfbWluKSkgLyAoaW5fbWF4IC0gaW5fbWluKSArIG91dF9taW47XG4gICAgaWYgKG91dF9taW4gPiBvdXRfbWF4KSB7XG4gICAgICAgIGlmIChudW0gPiBvdXRfbWluKSB7XG4gICAgICAgICAgICBudW0gPSBvdXRfbWluO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG51bSA8IG91dF9tYXgpIHtcbiAgICAgICAgICAgIG51bSA9IG91dF9tYXg7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChudW0gPCBvdXRfbWluKSB7XG4gICAgICAgICAgICBudW0gPSBvdXRfbWluO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG51bSA+IG91dF9tYXgpIHtcbiAgICAgICAgICAgIG51bSA9IG91dF9tYXg7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bTtcbn1cbmV4cG9ydHMubWFwUmFuZ2UgPSBtYXBSYW5nZTtcbmZ1bmN0aW9uIGNhblF1aWNrUmVzdGFydChtb2RlLCB3b3JkcywgdGltZSwgQ3VzdG9tVGV4dCkge1xuICAgIGlmICgobW9kZSA9PT0gXCJ3b3Jkc1wiICYmIHdvcmRzIDwgMTAwMCkgfHxcbiAgICAgICAgKG1vZGUgPT09IFwidGltZVwiICYmIHRpbWUgPCAzNjAwKSB8fFxuICAgICAgICBtb2RlID09PSBcInF1b3RlXCIgfHxcbiAgICAgICAgKG1vZGUgPT09IFwiY3VzdG9tXCIgJiYgQ3VzdG9tVGV4dC5pc1dvcmRSYW5kb20gJiYgQ3VzdG9tVGV4dC53b3JkIDwgMTAwMCkgfHxcbiAgICAgICAgKG1vZGUgPT09IFwiY3VzdG9tXCIgJiYgQ3VzdG9tVGV4dC5pc1RpbWVSYW5kb20gJiYgQ3VzdG9tVGV4dC50aW1lIDwgMzYwMCkgfHxcbiAgICAgICAgKG1vZGUgPT09IFwiY3VzdG9tXCIgJiZcbiAgICAgICAgICAgICFDdXN0b21UZXh0LmlzV29yZFJhbmRvbSAmJlxuICAgICAgICAgICAgQ3VzdG9tVGV4dC50ZXh0Lmxlbmd0aCA8IDEwMDApKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cbmV4cG9ydHMuY2FuUXVpY2tSZXN0YXJ0ID0gY2FuUXVpY2tSZXN0YXJ0O1xuZnVuY3Rpb24gY2xlYXJUaW1lb3V0cyh0aW1lb3V0cykge1xuICAgIHRpbWVvdXRzLmZvckVhY2goKHRvKSA9PiB7XG4gICAgICAgIGlmICh0eXBlb2YgdG8gPT09IFwibnVtYmVyXCIpXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodG8pO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodG8pO1xuICAgIH0pO1xufVxuZXhwb3J0cy5jbGVhclRpbWVvdXRzID0gY2xlYXJUaW1lb3V0cztcbi8vaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTQzMTA5NC9ob3ctZG8taS1yZXBsYWNlLWEtY2hhcmFjdGVyLWF0LWEtcGFydGljdWxhci1pbmRleC1pbi1qYXZhc2NyaXB0XG5mdW5jdGlvbiBzZXRDaGFyQXQoc3RyLCBpbmRleCwgY2hyKSB7XG4gICAgaWYgKGluZGV4ID4gc3RyLmxlbmd0aCAtIDEpXG4gICAgICAgIHJldHVybiBzdHI7XG4gICAgcmV0dXJuIHN0ci5zdWJzdHJpbmcoMCwgaW5kZXgpICsgY2hyICsgc3RyLnN1YnN0cmluZyhpbmRleCArIDEpO1xufVxuZXhwb3J0cy5zZXRDaGFyQXQgPSBzZXRDaGFyQXQ7XG4vL2h0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzI3Mzc4OS9pcy10aGVyZS1hLXZlcnNpb24tb2YtamF2YXNjcmlwdHMtc3RyaW5nLWluZGV4b2YtdGhhdC1hbGxvd3MtZm9yLXJlZ3VsYXItZXhwclxuZnVuY3Rpb24gcmVnZXhJbmRleE9mKHN0cmluZywgcmVnZXgsIHN0YXJ0cG9zKSB7XG4gICAgY29uc3QgaW5kZXhPZiA9IHN0cmluZy5zdWJzdHJpbmcoc3RhcnRwb3MgfHwgMCkuc2VhcmNoKHJlZ2V4KTtcbiAgICByZXR1cm4gaW5kZXhPZiA+PSAwID8gaW5kZXhPZiArIChzdGFydHBvcyB8fCAwKSA6IGluZGV4T2Y7XG59XG5leHBvcnRzLnJlZ2V4SW5kZXhPZiA9IHJlZ2V4SW5kZXhPZjtcbmZ1bmN0aW9uIGNvbnZlcnRSR0J0b0hFWChyZ2IpIHtcbiAgICBjb25zdCBtYXRjaCA9IHJnYi5tYXRjaCgvXnJnYlxcKChcXGQrKSwgXFxzKihcXGQrKSwgXFxzKihcXGQrKVxcKSQvKTtcbiAgICBpZiAobWF0Y2ggPT09IG51bGwpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAobWF0Y2gubGVuZ3RoIDwgMylcbiAgICAgICAgcmV0dXJuO1xuICAgIGZ1bmN0aW9uIGhleENvZGUoaSkge1xuICAgICAgICAvLyBUYWtlIHRoZSBsYXN0IDIgY2hhcmFjdGVycyBhbmQgY29udmVydFxuICAgICAgICAvLyB0aGVtIHRvIEhleGFkZWNpbWFsLlxuICAgICAgICByZXR1cm4gKFwiMFwiICsgcGFyc2VJbnQoaSkudG9TdHJpbmcoMTYpKS5zbGljZSgtMik7XG4gICAgfVxuICAgIHJldHVybiBcIiNcIiArIGhleENvZGUobWF0Y2hbMV0pICsgaGV4Q29kZShtYXRjaFsyXSkgKyBoZXhDb2RlKG1hdGNoWzNdKTtcbn1cbmV4cG9ydHMuY29udmVydFJHQnRvSEVYID0gY29udmVydFJHQnRvSEVYO1xuU3RyaW5nLnByb3RvdHlwZS5sYXN0SW5kZXhPZlJlZ2V4ID0gZnVuY3Rpb24gKHJlZ2V4KSB7XG4gICAgY29uc3QgbWF0Y2ggPSB0aGlzLm1hdGNoKHJlZ2V4KTtcbiAgICByZXR1cm4gbWF0Y2ggPyB0aGlzLmxhc3RJbmRleE9mKG1hdGNoW21hdGNoLmxlbmd0aCAtIDFdKSA6IC0xO1xufTtcbmV4cG9ydHMudHJhaWxpbmdDb21wb3NlQ2hhcnMgPSAvW1xcdTAyQjAtXFx1MDJGRmDCtF7CqH5dKyR84o6ELiokLztcbi8vaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzY1MzIzMDcvcmVtLXB4LWluLWphdmFzY3JpcHRcbmZ1bmN0aW9uIGNvbnZlcnRSZW1Ub1BpeGVscyhyZW0pIHtcbiAgICByZXR1cm4gcmVtICogcGFyc2VGbG9hdChnZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuZm9udFNpemUpO1xufVxuZXhwb3J0cy5jb252ZXJ0UmVtVG9QaXhlbHMgPSBjb252ZXJ0UmVtVG9QaXhlbHM7XG5mdW5jdGlvbiBzd2FwRWxlbWVudHMoZWwxLCBlbDIsIHRvdGFsRHVyYXRpb24sIGNhbGxiYWNrID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybjtcbn0sIG1pZGRsZUNhbGxiYWNrID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybjtcbn0pIHtcbiAgICBpZiAoKGVsMS5oYXNDbGFzcyhcImhpZGRlblwiKSAmJiAhZWwyLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB8fFxuICAgICAgICAoIWVsMS5oYXNDbGFzcyhcImhpZGRlblwiKSAmJiBlbDIuaGFzQ2xhc3MoXCJoaWRkZW5cIikpKSB7XG4gICAgICAgIC8vb25lIG9mIHRoZW0gaXMgaGlkZGVuIGFuZCB0aGUgb3RoZXIgaXMgdmlzaWJsZVxuICAgICAgICBpZiAoZWwxLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgICQoZWwxKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpXG4gICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgfSwgdG90YWxEdXJhdGlvbiAvIDIsICgpID0+IHtcbiAgICAgICAgICAgIG1pZGRsZUNhbGxiYWNrKCk7XG4gICAgICAgICAgICAkKGVsMSkuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAkKGVsMilcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgICAgICAgICAgICAuY3NzKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgfSwgdG90YWxEdXJhdGlvbiAvIDIsICgpID0+IHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIGlmIChlbDEuaGFzQ2xhc3MoXCJoaWRkZW5cIikgJiYgZWwyLmhhc0NsYXNzKFwiaGlkZGVuXCIpKSB7XG4gICAgICAgIC8vYm90aCBhcmUgaGlkZGVuLCBvbmx5IGZhZGUgaW4gdGhlIHNlY29uZFxuICAgICAgICAkKGVsMilcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgICAgICAgICAgLmNzcyhcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgIH0sIHRvdGFsRHVyYXRpb24sICgpID0+IHtcbiAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICB9XG4gICAgcmV0dXJuO1xufVxuZXhwb3J0cy5zd2FwRWxlbWVudHMgPSBzd2FwRWxlbWVudHM7XG5mdW5jdGlvbiBnZXRNb2RlMihjb25maWcsIHJhbmRvbVF1b3RlKSB7XG4gICAgY29uc3QgbW9kZSA9IGNvbmZpZy5tb2RlO1xuICAgIGlmIChtb2RlID09PSBcInRpbWVcIikge1xuICAgICAgICByZXR1cm4gY29uZmlnLnRpbWUudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAobW9kZSA9PT0gXCJ3b3Jkc1wiKSB7XG4gICAgICAgIHJldHVybiBjb25maWcud29yZHMudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAobW9kZSA9PT0gXCJjdXN0b21cIikge1xuICAgICAgICByZXR1cm4gXCJjdXN0b21cIjtcbiAgICB9XG4gICAgZWxzZSBpZiAobW9kZSA9PT0gXCJ6ZW5cIikge1xuICAgICAgICByZXR1cm4gXCJ6ZW5cIjtcbiAgICB9XG4gICAgZWxzZSBpZiAobW9kZSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgIHJldHVybiByYW5kb21RdW90ZS5pZC50b1N0cmluZygpO1xuICAgIH1cbiAgICByZXR1cm4gXCJcIjtcbn1cbmV4cG9ydHMuZ2V0TW9kZTIgPSBnZXRNb2RlMjtcbmZ1bmN0aW9uIGRvd25sb2FkUmVzdWx0c0NTVihhcnJheSkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIExvYWRlci5zaG93KCk7XG4gICAgICAgIGNvbnN0IGNzdlN0cmluZyA9IFtcbiAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICBcIl9pZFwiLFxuICAgICAgICAgICAgICAgIFwiaXNQYlwiLFxuICAgICAgICAgICAgICAgIFwid3BtXCIsXG4gICAgICAgICAgICAgICAgXCJhY2NcIixcbiAgICAgICAgICAgICAgICBcInJhd1dwbVwiLFxuICAgICAgICAgICAgICAgIFwiY29uc2lzdGVuY3lcIixcbiAgICAgICAgICAgICAgICBcImNoYXJTdGF0c1wiLFxuICAgICAgICAgICAgICAgIFwibW9kZVwiLFxuICAgICAgICAgICAgICAgIFwibW9kZTJcIixcbiAgICAgICAgICAgICAgICBcInF1b3RlTGVuZ3RoXCIsXG4gICAgICAgICAgICAgICAgXCJyZXN0YXJ0Q291bnRcIixcbiAgICAgICAgICAgICAgICBcInRlc3REdXJhdGlvblwiLFxuICAgICAgICAgICAgICAgIFwiYWZrRHVyYXRpb25cIixcbiAgICAgICAgICAgICAgICBcImluY29tcGxldGVUZXN0U2Vjb25kc1wiLFxuICAgICAgICAgICAgICAgIFwicHVuY3R1YXRpb25cIixcbiAgICAgICAgICAgICAgICBcIm51bWJlcnNcIixcbiAgICAgICAgICAgICAgICBcImxhbmd1YWdlXCIsXG4gICAgICAgICAgICAgICAgXCJmdW5ib3hcIixcbiAgICAgICAgICAgICAgICBcImRpZmZpY3VsdHlcIixcbiAgICAgICAgICAgICAgICBcImxhenlNb2RlXCIsXG4gICAgICAgICAgICAgICAgXCJibGluZE1vZGVcIixcbiAgICAgICAgICAgICAgICBcImJhaWxlZE91dFwiLFxuICAgICAgICAgICAgICAgIFwidGFnc1wiLFxuICAgICAgICAgICAgICAgIFwidGltZXN0YW1wXCIsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgLi4uYXJyYXkubWFwKChpdGVtKSA9PiBbXG4gICAgICAgICAgICAgICAgaXRlbS5faWQsXG4gICAgICAgICAgICAgICAgaXRlbS5pc1BiLFxuICAgICAgICAgICAgICAgIGl0ZW0ud3BtLFxuICAgICAgICAgICAgICAgIGl0ZW0uYWNjLFxuICAgICAgICAgICAgICAgIGl0ZW0ucmF3V3BtLFxuICAgICAgICAgICAgICAgIGl0ZW0uY29uc2lzdGVuY3ksXG4gICAgICAgICAgICAgICAgaXRlbS5jaGFyU3RhdHMuam9pbihcIixcIiksXG4gICAgICAgICAgICAgICAgaXRlbS5tb2RlLFxuICAgICAgICAgICAgICAgIGl0ZW0ubW9kZTIsXG4gICAgICAgICAgICAgICAgaXRlbS5xdW90ZUxlbmd0aCxcbiAgICAgICAgICAgICAgICBpdGVtLnJlc3RhcnRDb3VudCxcbiAgICAgICAgICAgICAgICBpdGVtLnRlc3REdXJhdGlvbixcbiAgICAgICAgICAgICAgICBpdGVtLmFma0R1cmF0aW9uLFxuICAgICAgICAgICAgICAgIGl0ZW0uaW5jb21wbGV0ZVRlc3RTZWNvbmRzLFxuICAgICAgICAgICAgICAgIGl0ZW0ucHVuY3R1YXRpb24sXG4gICAgICAgICAgICAgICAgaXRlbS5udW1iZXJzLFxuICAgICAgICAgICAgICAgIGl0ZW0ubGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgaXRlbS5mdW5ib3gsXG4gICAgICAgICAgICAgICAgaXRlbS5kaWZmaWN1bHR5LFxuICAgICAgICAgICAgICAgIGl0ZW0ubGF6eU1vZGUsXG4gICAgICAgICAgICAgICAgaXRlbS5ibGluZE1vZGUsXG4gICAgICAgICAgICAgICAgaXRlbS5iYWlsZWRPdXQsXG4gICAgICAgICAgICAgICAgaXRlbS50YWdzLmpvaW4oXCIsXCIpLFxuICAgICAgICAgICAgICAgIGl0ZW0udGltZXN0YW1wLFxuICAgICAgICAgICAgXSksXG4gICAgICAgIF1cbiAgICAgICAgICAgIC5tYXAoKGUpID0+IGUuam9pbihcInxcIikpXG4gICAgICAgICAgICAuam9pbihcIlxcblwiKTtcbiAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtjc3ZTdHJpbmddLCB7IHR5cGU6IFwidGV4dC9jc3ZcIiB9KTtcbiAgICAgICAgY29uc3QgaHJlZiA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XG4gICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKFwiaHJlZlwiLCBocmVmKTtcbiAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoXCJkb3dubG9hZFwiLCBcInJlc3VsdHMuY3N2XCIpO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOyAvLyBSZXF1aXJlZCBmb3IgRkZcbiAgICAgICAgbGluay5jbGljaygpO1xuICAgICAgICBsaW5rLnJlbW92ZSgpO1xuICAgICAgICBMb2FkZXIuaGlkZSgpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5kb3dubG9hZFJlc3VsdHNDU1YgPSBkb3dubG9hZFJlc3VsdHNDU1Y7XG4vKipcbiAqIEdldHMgYW4gaW50ZWdlciBiZXR3ZWVuIG1pbiBhbmQgbWF4LCBib3RoIGFyZSBpbmNsdXNpdmUuXG4gKiBAcGFyYW0gbWluXG4gKiBAcGFyYW0gbWF4XG4gKiBAcmV0dXJucyBSYW5kb20gaW50ZWdlciBiZXR3ZW4gbWluIGFuZCBtYXguXG4gKi9cbmZ1bmN0aW9uIHJhbmRvbUludEZyb21SYW5nZShtaW4sIG1heCkge1xuICAgIGNvbnN0IG1pbk5vcm0gPSBNYXRoLmNlaWwobWluKTtcbiAgICBjb25zdCBtYXhOb3JtID0gTWF0aC5mbG9vcihtYXgpO1xuICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4Tm9ybSAtIG1pbk5vcm0gKyAxKSArIG1pbk5vcm0pO1xufVxuZXhwb3J0cy5yYW5kb21JbnRGcm9tUmFuZ2UgPSByYW5kb21JbnRGcm9tUmFuZ2U7XG4vKipcbiAqIFNodWZmbGUgYW4gYXJyYXkgb2YgZWxlbWVudHMgdXNpbmcgdGhlIEZpc2hlcuKAk1lhdGVzIGFsZ29yaXRobS5cbiAqIFRoaXMgZnVuY3Rpb24gbXV0YXRlcyB0aGUgaW5wdXQgYXJyYXkuXG4gKiBAcGFyYW0gZWxlbWVudHNcbiAqL1xuZnVuY3Rpb24gc2h1ZmZsZShlbGVtZW50cykge1xuICAgIGZvciAobGV0IGkgPSBlbGVtZW50cy5sZW5ndGggLSAxOyBpID4gMDsgLS1pKSB7XG4gICAgICAgIGNvbnN0IGogPSByYW5kb21JbnRGcm9tUmFuZ2UoMCwgaSk7XG4gICAgICAgIGNvbnN0IHRlbXAgPSBlbGVtZW50c1tqXTtcbiAgICAgICAgZWxlbWVudHNbal0gPSBlbGVtZW50c1tpXTtcbiAgICAgICAgZWxlbWVudHNbaV0gPSB0ZW1wO1xuICAgIH1cbn1cbmV4cG9ydHMuc2h1ZmZsZSA9IHNodWZmbGU7XG5mdW5jdGlvbiByYW5kb21FbGVtZW50RnJvbUFycmF5KGFycmF5KSB7XG4gICAgcmV0dXJuIGFycmF5W3JhbmRvbUludEZyb21SYW5nZSgwLCBhcnJheS5sZW5ndGggLSAxKV07XG59XG5leHBvcnRzLnJhbmRvbUVsZW1lbnRGcm9tQXJyYXkgPSByYW5kb21FbGVtZW50RnJvbUFycmF5O1xuZnVuY3Rpb24gcmFuZG9tRWxlbWVudEZyb21PYmplY3Qob2JqZWN0KSB7XG4gICAgcmV0dXJuIHJhbmRvbUVsZW1lbnRGcm9tQXJyYXkoT2JqZWN0LnZhbHVlcyhvYmplY3QpKTtcbn1cbmV4cG9ydHMucmFuZG9tRWxlbWVudEZyb21PYmplY3QgPSByYW5kb21FbGVtZW50RnJvbU9iamVjdDtcbmZ1bmN0aW9uIGNyZWF0ZUVycm9yTWVzc2FnZShlcnJvciwgbWVzc2FnZSkge1xuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKVxuICAgICAgICByZXR1cm4gYCR7bWVzc2FnZX06ICR7ZXJyb3IubWVzc2FnZX1gO1xuICAgIHJldHVybiBgJHttZXNzYWdlfWA7XG59XG5leHBvcnRzLmNyZWF0ZUVycm9yTWVzc2FnZSA9IGNyZWF0ZUVycm9yTWVzc2FnZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5idWlsZFNlYXJjaFNlcnZpY2UgPSB2b2lkIDA7XG5jb25zdCBzdGVtbWVyXzEgPSByZXF1aXJlKFwic3RlbW1lclwiKTtcbmNvbnN0IGRhbWVyYXVfbGV2ZW5zaHRlaW5fMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiZGFtZXJhdS1sZXZlbnNodGVpblwiKSk7XG5jb25zdCBERUZBVUxUX09QVElPTlMgPSB7XG4gICAgZnV6enlNYXRjaFNlbnNpdGl2aXR5OiAwLjIsXG4gICAgc2NvcmVGb3JTaW1pbGFyTWF0Y2g6IDAuNSxcbiAgICBzY29yZUZvckV4YWN0TWF0Y2g6IDEsIC8vIFdoZW4gcmFua2luZyByZXN1bHRzLCB0aGUgc2NvcmUgYSBtYXRjaCBnZXRzIGZvciBoYXZpbmcgYW4gZXhhY3QgbWF0Y2ggd2l0aCBhIHRva2VuIGluIHRoZSBzZWFyY2ggcXVlcnkuXG59O1xuZnVuY3Rpb24gaW52ZXJzZURvY3VtZW50RnJlcXVlbmN5KG51bWJlck9mRG9jdW1lbnRzLCBudW1iZXJPZkRvY3VtZW50c1dpdGhUZXJtKSB7XG4gICAgaWYgKG51bWJlck9mRG9jdW1lbnRzV2l0aFRlcm0gPT09IDApIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIHJldHVybiBNYXRoLmxvZzEwKG51bWJlck9mRG9jdW1lbnRzIC8gbnVtYmVyT2ZEb2N1bWVudHNXaXRoVGVybSk7XG59XG5mdW5jdGlvbiB0b2tlbml6ZSh0ZXh0KSB7XG4gICAgcmV0dXJuIHRleHQubWF0Y2goL1teXFxcXFxcXVsuLFwiLyMhPyQlXiYqOzp7fT1cXC1fYH4oKVxcc10rL2cpIHx8IFtdO1xufVxuY29uc3QgYnVpbGRTZWFyY2hTZXJ2aWNlID0gKGRvY3VtZW50cywgZ2V0U2VhcmNoYWJsZVRleHQsIG9wdGlvbnMgPSBERUZBVUxUX09QVElPTlMpID0+IHtcbiAgICBjb25zdCByZXZlcnNlSW5kZXggPSB7fTtcbiAgICBjb25zdCBub3JtYWxpemVkVG9rZW5Ub09yaWdpbmFsID0ge307XG4gICAgZG9jdW1lbnRzLmZvckVhY2goKGRvY3VtZW50LCBkb2N1bWVudEluZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IHJhd1Rva2VucyA9IHRva2VuaXplKGdldFNlYXJjaGFibGVUZXh0KGRvY3VtZW50KSk7XG4gICAgICAgIGNvbnN0IGludGVybmFsRG9jdW1lbnQgPSB7XG4gICAgICAgICAgICBpZDogZG9jdW1lbnRJbmRleCxcbiAgICAgICAgfTtcbiAgICAgICAgcmF3VG9rZW5zLmZvckVhY2goKHRva2VuKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzdGVtbWVkVG9rZW4gPSAoMCwgc3RlbW1lcl8xLnN0ZW1tZXIpKHRva2VuKTtcbiAgICAgICAgICAgIGlmICghKHN0ZW1tZWRUb2tlbiBpbiBub3JtYWxpemVkVG9rZW5Ub09yaWdpbmFsKSkge1xuICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWRUb2tlblRvT3JpZ2luYWxbc3RlbW1lZFRva2VuXSA9IG5ldyBTZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5vcm1hbGl6ZWRUb2tlblRvT3JpZ2luYWxbc3RlbW1lZFRva2VuXS5hZGQodG9rZW4pO1xuICAgICAgICAgICAgaWYgKCEoc3RlbW1lZFRva2VuIGluIHJldmVyc2VJbmRleCkpIHtcbiAgICAgICAgICAgICAgICByZXZlcnNlSW5kZXhbc3RlbW1lZFRva2VuXSA9IG5ldyBTZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldmVyc2VJbmRleFtzdGVtbWVkVG9rZW5dLmFkZChpbnRlcm5hbERvY3VtZW50KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgY29uc3QgdG9rZW5TZXQgPSBPYmplY3Qua2V5cyhyZXZlcnNlSW5kZXgpO1xuICAgIGNvbnN0IHF1ZXJ5ID0gKHNlYXJjaFF1ZXJ5KSA9PiB7XG4gICAgICAgIGNvbnN0IHNlYXJjaFJlc3VsdCA9IHtcbiAgICAgICAgICAgIHJlc3VsdHM6IFtdLFxuICAgICAgICAgICAgbWF0Y2hlZFF1ZXJ5VGVybXM6IFtdLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBub3JtYWxpemVkU2VhcmNoUXVlcnkgPSBuZXcgU2V0KHRva2VuaXplKHNlYXJjaFF1ZXJ5KS5tYXAoKHRva2VuKSA9PiAoMCwgc3RlbW1lcl8xLnN0ZW1tZXIpKHRva2VuKSkpO1xuICAgICAgICBpZiAobm9ybWFsaXplZFNlYXJjaFF1ZXJ5LnNpemUgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBzZWFyY2hSZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IG5ldyBNYXAoKTtcbiAgICAgICAgY29uc3QgbWF0Y2hlZFRva2VucyA9IG5ldyBTZXQoKTtcbiAgICAgICAgbm9ybWFsaXplZFNlYXJjaFF1ZXJ5LmZvckVhY2goKHNlYXJjaFRva2VuKSA9PiB7XG4gICAgICAgICAgICB0b2tlblNldC5mb3JFYWNoKCh0b2tlbikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgc2ltaWxhcml0eSB9ID0gKDAsIGRhbWVyYXVfbGV2ZW5zaHRlaW5fMS5kZWZhdWx0KShzZWFyY2hUb2tlbiwgdG9rZW4pO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoZXNTZWFyY2hUb2tlbiA9IHRva2VuID09PSBzZWFyY2hUb2tlbjtcbiAgICAgICAgICAgICAgICBjb25zdCBpc1NpbWlsYXIgPSBzaW1pbGFyaXR5ID49IDEgLSBvcHRpb25zLmZ1enp5TWF0Y2hTZW5zaXRpdml0eTtcbiAgICAgICAgICAgICAgICBpZiAobWF0Y2hlc1NlYXJjaFRva2VuIHx8IGlzU2ltaWxhcikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkb2N1bWVudE1hdGNoZXMgPSByZXZlcnNlSW5kZXhbdG9rZW5dO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpZGYgPSBpbnZlcnNlRG9jdW1lbnRGcmVxdWVuY3koZG9jdW1lbnRzLmxlbmd0aCwgZG9jdW1lbnRNYXRjaGVzLnNpemUpO1xuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudE1hdGNoZXMuZm9yRWFjaCgoZG9jdW1lbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTY29yZSA9IChfYSA9IHJlc3VsdHMuZ2V0KGRvY3VtZW50LmlkKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNjb3JlRm9yRXhhY3RNYXRjaCA9IG1hdGNoZXNTZWFyY2hUb2tlblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gb3B0aW9ucy5zY29yZUZvckV4YWN0TWF0Y2hcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzY29yZUZvclNpbWlsYXJpdHkgPSBpc1NpbWlsYXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IG9wdGlvbnMuc2NvcmVGb3JTaW1pbGFyTWF0Y2hcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzY29yZSA9IHNjb3JlRm9yRXhhY3RNYXRjaCArIHNjb3JlRm9yU2ltaWxhcml0eTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNjb3JlRm9yVG9rZW4gPSBzY29yZSAqIGlkZjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuc2V0KGRvY3VtZW50LmlkLCBjdXJyZW50U2NvcmUgKyBzY29yZUZvclRva2VuKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWRUb2tlblRvT3JpZ2luYWxbdG9rZW5dLmZvckVhY2goKG9yaWdpbmFsVG9rZW4pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZWRUb2tlbnMuYWRkKG9yaWdpbmFsVG9rZW4pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IG9yZGVyZWRSZXN1bHRzID0gWy4uLnJlc3VsdHNdXG4gICAgICAgICAgICAuc29ydCgobWF0Y2gxLCBtYXRjaDIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBtYXRjaDJbMV0gLSBtYXRjaDFbMV07XG4gICAgICAgIH0pXG4gICAgICAgICAgICAubWFwKChtYXRjaCkgPT4gZG9jdW1lbnRzW21hdGNoWzBdXSk7XG4gICAgICAgIHNlYXJjaFJlc3VsdC5yZXN1bHRzID0gb3JkZXJlZFJlc3VsdHM7XG4gICAgICAgIHNlYXJjaFJlc3VsdC5tYXRjaGVkUXVlcnlUZXJtcyA9IFsuLi5tYXRjaGVkVG9rZW5zXTtcbiAgICAgICAgcmV0dXJuIHNlYXJjaFJlc3VsdDtcbiAgICB9O1xuICAgIHJldHVybiB7XG4gICAgICAgIHF1ZXJ5LFxuICAgIH07XG59O1xuZXhwb3J0cy5idWlsZFNlYXJjaFNlcnZpY2UgPSBidWlsZFNlYXJjaFNlcnZpY2U7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc3BsaXRCeUFuZEtlZXAgPSB2b2lkIDA7XG4vKipcbiAqXG4gKiBAcGFyYW0gdGV4dCBTdHJpbmcgdG8gc3BsaXRcbiAqIEBwYXJhbSBkZWxpbWl0ZXJzIFNpbmdsZSBjaGFyYWN0ZXIgZGVsaW1pdGVycy5cbiAqL1xuZnVuY3Rpb24gc3BsaXRCeUFuZEtlZXAodGV4dCwgZGVsaW1pdGVycykge1xuICAgIGNvbnN0IHNwbGl0U3RyaW5nID0gW107XG4gICAgbGV0IGN1cnJlbnRUb2tlbiA9IFtdO1xuICAgIGNvbnN0IGRlbGltaXRlclNldCA9IG5ldyBTZXQoZGVsaW1pdGVycyk7XG4gICAgZm9yIChjb25zdCBjaGFyIG9mIHRleHQpIHtcbiAgICAgICAgaWYgKGRlbGltaXRlclNldC5oYXMoY2hhcikpIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50VG9rZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHNwbGl0U3RyaW5nLnB1c2goY3VycmVudFRva2VuLmpvaW4oXCJcIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3BsaXRTdHJpbmcucHVzaChjaGFyKTtcbiAgICAgICAgICAgIGN1cnJlbnRUb2tlbiA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY3VycmVudFRva2VuLnB1c2goY2hhcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGN1cnJlbnRUb2tlbi5sZW5ndGggPiAwKSB7XG4gICAgICAgIHNwbGl0U3RyaW5nLnB1c2goY3VycmVudFRva2VuLmpvaW4oXCJcIikpO1xuICAgIH1cbiAgICByZXR1cm4gc3BsaXRTdHJpbmc7XG59XG5leHBvcnRzLnNwbGl0QnlBbmRLZWVwID0gc3BsaXRCeUFuZEtlZXA7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5sb2FkQ3VzdG9tVGhlbWVGcm9tVXJsID0gdm9pZCAwO1xuY29uc3QgTWlzYyA9IF9faW1wb3J0U3RhcihyZXF1aXJlKFwiLi9taXNjXCIpKTtcbmNvbnN0IGNvbmZpZ18xID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuLi9jb25maWdcIikpLCBVcGRhdGVDb25maWcgPSBjb25maWdfMTtcbmNvbnN0IE5vdGlmaWNhdGlvbnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4uL2VsZW1lbnRzL25vdGlmaWNhdGlvbnNcIikpO1xuZnVuY3Rpb24gbG9hZEN1c3RvbVRoZW1lRnJvbVVybCgpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgZ2V0VmFsdWUgPSBNaXNjLmZpbmRHZXRQYXJhbWV0ZXIoXCJjdXN0b21UaGVtZVwiKTtcbiAgICBpZiAoZ2V0VmFsdWUgPT09IG51bGwpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCB1cmxFbmNvZGVkID0gZ2V0VmFsdWUuc3BsaXQoXCIsXCIpO1xuICAgIGxldCBiYXNlNjRkZWNvZGVkID0gbnVsbDtcbiAgICB0cnkge1xuICAgICAgICBiYXNlNjRkZWNvZGVkID0gSlNPTi5wYXJzZSgoX2EgPSBhdG9iKGdldFZhbHVlKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogXCJcIik7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIC8vXG4gICAgfVxuICAgIGxldCBjb2xvckFycmF5ID0gW107XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodXJsRW5jb2RlZCkgJiYgdXJsRW5jb2RlZC5sZW5ndGggPT09IDkpIHtcbiAgICAgICAgY29sb3JBcnJheSA9IHVybEVuY29kZWQ7XG4gICAgfVxuICAgIGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoYmFzZTY0ZGVjb2RlZCkgJiYgYmFzZTY0ZGVjb2RlZC5sZW5ndGggPT09IDkpIHtcbiAgICAgICAgY29sb3JBcnJheSA9IGJhc2U2NGRlY29kZWQ7XG4gICAgfVxuICAgIGlmIChjb2xvckFycmF5Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9ucy5hZGQoXCJJbnZhbGlkIGN1c3RvbSB0aGVtZSBcIiwgMCk7XG4gICAgfVxuICAgIGNvbnN0IG9sZEN1c3RvbVRoZW1lID0gY29uZmlnXzEuZGVmYXVsdC5jdXN0b21UaGVtZTtcbiAgICBjb25zdCBvbGRDdXN0b21UaGVtZUNvbG9ycyA9IGNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tVGhlbWVDb2xvcnM7XG4gICAgdHJ5IHtcbiAgICAgICAgVXBkYXRlQ29uZmlnLnNldEN1c3RvbVRoZW1lQ29sb3JzKGNvbG9yQXJyYXkpO1xuICAgICAgICBOb3RpZmljYXRpb25zLmFkZChcIkN1c3RvbSB0aGVtZSBhcHBsaWVkXCIsIDEpO1xuICAgICAgICBpZiAoIWNvbmZpZ18xLmRlZmF1bHQuY3VzdG9tVGhlbWUpXG4gICAgICAgICAgICBVcGRhdGVDb25maWcuc2V0Q3VzdG9tVGhlbWUodHJ1ZSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIE5vdGlmaWNhdGlvbnMuYWRkKFwiU29tZXRoaW5nIHdlbnQgd3JvbmcuIFJldmVydGluZyB0byBwcmV2aW91cyBzdGF0ZS5cIiwgMCk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZShvbGRDdXN0b21UaGVtZSk7XG4gICAgICAgIFVwZGF0ZUNvbmZpZy5zZXRDdXN0b21UaGVtZUNvbG9ycyhvbGRDdXN0b21UaGVtZUNvbG9ycyk7XG4gICAgfVxufVxuZXhwb3J0cy5sb2FkQ3VzdG9tVGhlbWVGcm9tVXJsID0gbG9hZEN1c3RvbVRoZW1lRnJvbVVybDtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5DTElFTlRfVkVSU0lPTiA9IHZvaWQgMDtcbmV4cG9ydHMuQ0xJRU5UX1ZFUlNJT04gPSBcIkRFVkVMT1BNRU5ULUNMSUVOVFwiO1xuJChkb2N1bWVudC5ib2R5KS5vbihcImNsaWNrXCIsIFwiLnZlcnNpb25cIiwgKGUpID0+IHtcbiAgICBpZiAoZS5zaGlmdEtleSkge1xuICAgICAgICBhbGVydChleHBvcnRzLkNMSUVOVF9WRVJTSU9OKTtcbiAgICB9XG59KTtcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4vLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gX193ZWJwYWNrX21vZHVsZXNfXztcblxuIiwidmFyIGRlZmVycmVkID0gW107XG5fX3dlYnBhY2tfcmVxdWlyZV9fLk8gPSAocmVzdWx0LCBjaHVua0lkcywgZm4sIHByaW9yaXR5KSA9PiB7XG5cdGlmKGNodW5rSWRzKSB7XG5cdFx0cHJpb3JpdHkgPSBwcmlvcml0eSB8fCAwO1xuXHRcdGZvcih2YXIgaSA9IGRlZmVycmVkLmxlbmd0aDsgaSA+IDAgJiYgZGVmZXJyZWRbaSAtIDFdWzJdID4gcHJpb3JpdHk7IGktLSkgZGVmZXJyZWRbaV0gPSBkZWZlcnJlZFtpIC0gMV07XG5cdFx0ZGVmZXJyZWRbaV0gPSBbY2h1bmtJZHMsIGZuLCBwcmlvcml0eV07XG5cdFx0cmV0dXJuO1xuXHR9XG5cdHZhciBub3RGdWxmaWxsZWQgPSBJbmZpbml0eTtcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCBkZWZlcnJlZC5sZW5ndGg7IGkrKykge1xuXHRcdHZhciBbY2h1bmtJZHMsIGZuLCBwcmlvcml0eV0gPSBkZWZlcnJlZFtpXTtcblx0XHR2YXIgZnVsZmlsbGVkID0gdHJ1ZTtcblx0XHRmb3IgKHZhciBqID0gMDsgaiA8IGNodW5rSWRzLmxlbmd0aDsgaisrKSB7XG5cdFx0XHRpZiAoKHByaW9yaXR5ICYgMSA9PT0gMCB8fCBub3RGdWxmaWxsZWQgPj0gcHJpb3JpdHkpICYmIE9iamVjdC5rZXlzKF9fd2VicGFja19yZXF1aXJlX18uTykuZXZlcnkoKGtleSkgPT4gKF9fd2VicGFja19yZXF1aXJlX18uT1trZXldKGNodW5rSWRzW2pdKSkpKSB7XG5cdFx0XHRcdGNodW5rSWRzLnNwbGljZShqLS0sIDEpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZnVsZmlsbGVkID0gZmFsc2U7XG5cdFx0XHRcdGlmKHByaW9yaXR5IDwgbm90RnVsZmlsbGVkKSBub3RGdWxmaWxsZWQgPSBwcmlvcml0eTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYoZnVsZmlsbGVkKSB7XG5cdFx0XHRkZWZlcnJlZC5zcGxpY2UoaS0tLCAxKVxuXHRcdFx0dmFyIHIgPSBmbigpO1xuXHRcdFx0aWYgKHIgIT09IHVuZGVmaW5lZCkgcmVzdWx0ID0gcjtcblx0XHR9XG5cdH1cblx0cmV0dXJuIHJlc3VsdDtcbn07IiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5nID0gKGZ1bmN0aW9uKCkge1xuXHRpZiAodHlwZW9mIGdsb2JhbFRoaXMgPT09ICdvYmplY3QnKSByZXR1cm4gZ2xvYmFsVGhpcztcblx0dHJ5IHtcblx0XHRyZXR1cm4gdGhpcyB8fCBuZXcgRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcblx0fSBjYXRjaCAoZSkge1xuXHRcdGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JykgcmV0dXJuIHdpbmRvdztcblx0fVxufSkoKTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiLy8gbm8gYmFzZVVSSVxuXG4vLyBvYmplY3QgdG8gc3RvcmUgbG9hZGVkIGFuZCBsb2FkaW5nIGNodW5rc1xuLy8gdW5kZWZpbmVkID0gY2h1bmsgbm90IGxvYWRlZCwgbnVsbCA9IGNodW5rIHByZWxvYWRlZC9wcmVmZXRjaGVkXG4vLyBbcmVzb2x2ZSwgcmVqZWN0LCBQcm9taXNlXSA9IGNodW5rIGxvYWRpbmcsIDAgPSBjaHVuayBsb2FkZWRcbnZhciBpbnN0YWxsZWRDaHVua3MgPSB7XG5cdFwibW9ua2V5dHlwZVwiOiAwXG59O1xuXG4vLyBubyBjaHVuayBvbiBkZW1hbmQgbG9hZGluZ1xuXG4vLyBubyBwcmVmZXRjaGluZ1xuXG4vLyBubyBwcmVsb2FkZWRcblxuLy8gbm8gSE1SXG5cbi8vIG5vIEhNUiBtYW5pZmVzdFxuXG5fX3dlYnBhY2tfcmVxdWlyZV9fLk8uaiA9IChjaHVua0lkKSA9PiAoaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID09PSAwKTtcblxuLy8gaW5zdGFsbCBhIEpTT05QIGNhbGxiYWNrIGZvciBjaHVuayBsb2FkaW5nXG52YXIgd2VicGFja0pzb25wQ2FsbGJhY2sgPSAocGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24sIGRhdGEpID0+IHtcblx0dmFyIFtjaHVua0lkcywgbW9yZU1vZHVsZXMsIHJ1bnRpbWVdID0gZGF0YTtcblx0Ly8gYWRkIFwibW9yZU1vZHVsZXNcIiB0byB0aGUgbW9kdWxlcyBvYmplY3QsXG5cdC8vIHRoZW4gZmxhZyBhbGwgXCJjaHVua0lkc1wiIGFzIGxvYWRlZCBhbmQgZmlyZSBjYWxsYmFja1xuXHR2YXIgbW9kdWxlSWQsIGNodW5rSWQsIGkgPSAwO1xuXHRpZihjaHVua0lkcy5zb21lKChpZCkgPT4gKGluc3RhbGxlZENodW5rc1tpZF0gIT09IDApKSkge1xuXHRcdGZvcihtb2R1bGVJZCBpbiBtb3JlTW9kdWxlcykge1xuXHRcdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKG1vcmVNb2R1bGVzLCBtb2R1bGVJZCkpIHtcblx0XHRcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tW21vZHVsZUlkXSA9IG1vcmVNb2R1bGVzW21vZHVsZUlkXTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYocnVudGltZSkgdmFyIHJlc3VsdCA9IHJ1bnRpbWUoX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cdH1cblx0aWYocGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24pIHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uKGRhdGEpO1xuXHRmb3IoO2kgPCBjaHVua0lkcy5sZW5ndGg7IGkrKykge1xuXHRcdGNodW5rSWQgPSBjaHVua0lkc1tpXTtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oaW5zdGFsbGVkQ2h1bmtzLCBjaHVua0lkKSAmJiBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0pIHtcblx0XHRcdGluc3RhbGxlZENodW5rc1tjaHVua0lkXVswXSgpO1xuXHRcdH1cblx0XHRpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPSAwO1xuXHR9XG5cdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fLk8ocmVzdWx0KTtcbn1cblxudmFyIGNodW5rTG9hZGluZ0dsb2JhbCA9IHNlbGZbXCJ3ZWJwYWNrQ2h1bmttb25rZXl0eXBlX2Zyb250ZW5kXCJdID0gc2VsZltcIndlYnBhY2tDaHVua21vbmtleXR5cGVfZnJvbnRlbmRcIl0gfHwgW107XG5jaHVua0xvYWRpbmdHbG9iYWwuZm9yRWFjaCh3ZWJwYWNrSnNvbnBDYWxsYmFjay5iaW5kKG51bGwsIDApKTtcbmNodW5rTG9hZGluZ0dsb2JhbC5wdXNoID0gd2VicGFja0pzb25wQ2FsbGJhY2suYmluZChudWxsLCBjaHVua0xvYWRpbmdHbG9iYWwucHVzaC5iaW5kKGNodW5rTG9hZGluZ0dsb2JhbCkpOyIsIiIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgZGVwZW5kcyBvbiBvdGhlciBsb2FkZWQgY2h1bmtzIGFuZCBleGVjdXRpb24gbmVlZCB0byBiZSBkZWxheWVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18uTyh1bmRlZmluZWQsIFtcInZlbmRvclwiXSwgKCkgPT4gKF9fd2VicGFja19yZXF1aXJlX18oXCIuL3NyYy9zY3JpcHRzL2luZGV4LnRzXCIpKSlcbl9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fLk8oX193ZWJwYWNrX2V4cG9ydHNfXyk7XG4iLCIiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=